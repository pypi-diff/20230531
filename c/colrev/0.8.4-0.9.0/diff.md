# Comparing `tmp/colrev-0.8.4.tar.gz` & `tmp/colrev-0.9.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "colrev-0.8.4.tar", max compression
+gzip compressed data, was "colrev-0.9.0.tar", max compression
```

## Comparing `colrev-0.8.4.tar` & `colrev-0.9.0.tar`

### file list

```diff
@@ -1,361 +1,363 @@
--rw-r--r--   0        0        0     8657 2023-05-19 10:44:57.501876 colrev-0.8.4/CHANGELOG.md
--rw-r--r--   0        0        0     4081 2023-05-19 10:44:57.501876 colrev-0.8.4/CONTRIBUTING.md
--rw-r--r--   0        0        0     1070 2023-05-19 10:44:57.501876 colrev-0.8.4/LICENSE
--rw-r--r--   0        0        0     7383 2023-05-19 10:44:57.501876 colrev-0.8.4/README.md
--rw-r--r--   0        0        0      314 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/__init__.py
--rw-r--r--   0        0        0      128 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/__version__.py
--rw-r--r--   0        0        0    31417 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/advisor.py
--rw-r--r--   0        0        0    31863 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/checker.py
--rw-r--r--   0        0        0    43386 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/dataset.py
--rw-r--r--   0        0        0      105 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/__init__.py
--rw-r--r--   0        0        0    14918 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/environment_manager.py
--rw-r--r--   0        0        0     2198 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/grobid_service.py
--rw-r--r--   0        0        0     3695 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/language_service.py
--rw-r--r--   0        0        0    53571 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/local_index.py
--rw-r--r--   0        0        0    39853 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/package_manager.py
--rw-r--r--   0        0        0     2308 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/resources.py
--rw-r--r--   0        0        0     3971 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/screenshot_service.py
--rw-r--r--   0        0        0    34856 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/tei_parser.py
--rw-r--r--   0        0        0     4696 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/utils.py
--rw-r--r--   0        0        0     2564 2023-05-19 10:44:57.501876 colrev-0.8.4/colrev/env/zotero_translation_service.py
--rw-r--r--   0        0        0    17660 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/exceptions.py
--rw-r--r--   0        0        0      151 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/exit_codes.py
--rw-r--r--   0        0        0       86 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/hooks/__init__.py
--rwxr-xr-x   0        0        0      352 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/hooks/check.py
--rwxr-xr-x   0        0        0      372 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/hooks/format.py
--rwxr-xr-x   0        0        0      468 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/hooks/report.py
--rwxr-xr-x   0        0        0      360 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/hooks/share.py
--rwxr-xr-x   0        0        0     1233 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/hooks/update.py
--rw-r--r--   0        0        0     1903 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/linter/colrev_lint.py
--rw-r--r--   0        0        0      310 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/linter/readme.md
--rw-r--r--   0        0        0     3182 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/logger.py
--rw-r--r--   0        0        0     7802 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/operation.py
--rw-r--r--   0        0        0       92 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/__init__.py
--rw-r--r--   0        0        0      119 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/__init__.py
--rw-r--r--   0        0        0      135 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/__init__.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/bibliography_export.md
--rw-r--r--   0        0        0     9291 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/bibliography_export.py
--rw-r--r--   0        0        0     1084 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/colrev_curation.md
--rw-r--r--   0        0        0    15062 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/colrev_curation.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/github_pages.md
--rw-r--r--   0        0        0    13511 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/github_pages.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/obsidian.md
--rw-r--r--   0        0        0     9253 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/obsidian.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/paper_md.md
--rw-r--r--   0        0        0    32087 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/paper_md.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/prisma.md
--rw-r--r--   0        0        0     9301 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/prisma.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/structured.md
--rw-r--r--   0        0        0    11323 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/data/structured.py
--rw-r--r--   0        0        0      126 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/__init__.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/active_learning_dedup_io.md
--rw-r--r--   0        0        0    42848 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/active_learning_dedup_io.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/curation_dedupe.md
--rw-r--r--   0        0        0    25576 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/curation_dedupe.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/curation_missing_dedupe.md
--rw-r--r--   0        0        0    14416 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/curation_missing_dedupe.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/simple_dedupe.md
--rw-r--r--   0        0        0    14351 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/simple_dedupe.py
--rw-r--r--   0        0        0     1999 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/dedupe/utils.py
--rw-r--r--   0        0        0      135 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/__init__.py
--rw-r--r--   0        0        0      189 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/bib_pybtex_loader.md
--rw-r--r--   0        0        0     5404 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/bib_pybtex_loader.py
--rw-r--r--   0        0        0      189 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/bibutils_loader.md
--rw-r--r--   0        0        0     4481 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/bibutils_loader.py
--rw-r--r--   0        0        0      189 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/markdown_loader.md
--rw-r--r--   0        0        0     2970 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/markdown_loader.py
--rw-r--r--   0        0        0      189 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/table_loader.md
--rw-r--r--   0        0        0     8928 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/table_loader.py
--rw-r--r--   0        0        0      401 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/zotero_loader.md
--rw-r--r--   0        0        0     3477 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/load_conversion/zotero_loader.py
--rw-r--r--   0        0        0      127 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get/__init__.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get/local_index_pdf_get.md
--rw-r--r--   0        0        0     2583 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get/local_index_pdf_get.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get/unpaywall.md
--rw-r--r--   0        0        0     4836 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get/unpaywall.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get/website_screenshot.md
--rw-r--r--   0        0        0     1885 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get/website_screenshot.py
--rw-r--r--   0        0        0      131 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get_man/__init__.py
--rw-r--r--   0        0        0      165 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.md
--rw-r--r--   0        0        0    11024 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py
--rw-r--r--   0        0        0      128 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/__init__.py
--rw-r--r--   0        0        0      161 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/check_ocr.md
--rw-r--r--   0        0        0     4503 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/check_ocr.py
--rw-r--r--   0        0        0      161 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/completeness_validation.md
--rw-r--r--   0        0        0     6964 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/completeness_validation.py
--rw-r--r--   0        0        0      161 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/cover_page.md
--rw-r--r--   0        0        0     7949 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/cover_page.py
--rw-r--r--   0        0        0      161 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/last_page.md
--rw-r--r--   0        0        0     4988 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/last_page.py
--rw-r--r--   0        0        0      161 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/metadata_validation.md
--rw-r--r--   0        0        0     6535 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/metadata_validation.py
--rw-r--r--   0        0        0      161 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/tei_prep.md
--rw-r--r--   0        0        0     2205 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep/tei_prep.py
--rw-r--r--   0        0        0      132 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep_man/__init__.py
--rw-r--r--   0        0        0      167 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.md
--rw-r--r--   0        0        0    10162 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py
--rw-r--r--   0        0        0      124 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/__init__.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/bibtex_crossref_resolution.md
--rw-r--r--   0        0        0     2844 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/bibtex_crossref_resolution.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/citeas_prep.md
--rw-r--r--   0        0        0     4701 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/citeas_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/crossref_metadata_prep.md
--rw-r--r--   0        0        0     2583 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/crossref_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/curation_prep.md
--rw-r--r--   0        0        0     2261 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/curation_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/dblp_metadata_prep.md
--rw-r--r--   0        0        0     2453 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/dblp_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/doi_from_urls_prep.md
--rw-r--r--   0        0        0     4210 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/doi_from_urls_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/doi_metadata_prep.md
--rw-r--r--   0        0        0     2061 2023-05-19 10:44:57.505876 colrev-0.8.4/colrev/ops/built_in/prep/doi_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/europe_pmc_prep.md
--rw-r--r--   0        0        0     1801 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/europe_pmc_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_collections.md
--rw-r--r--   0        0        0     1612 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_collections.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_complementary_materials.md
--rw-r--r--   0        0        0     2385 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_complementary_materials.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_languages.md
--rw-r--r--   0        0        0     5919 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_languages.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_non_latin_alphabets.md
--rw-r--r--   0        0        0     2483 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/general_polish.md
--rw-r--r--   0        0        0     2180 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/general_polish.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/local_index_prep.md
--rw-r--r--   0        0        0     2529 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/local_index_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/open_library_prep.md
--rw-r--r--   0        0        0     2158 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/open_library_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/pubmed_metadata_prep.md
--rw-r--r--   0        0        0     2418 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/pubmed_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/remove_broken_ids.md
--rw-r--r--   0        0        0     2221 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/remove_broken_ids.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/remove_error500_urls.md
--rw-r--r--   0        0        0     2408 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/remove_error500_urls.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/semantic_scholar_prep.md
--rw-r--r--   0        0        0     7091 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/semantic_scholar_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/source_specific_prep.md
--rw-r--r--   0        0        0     3073 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/source_specific_prep.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/update_masterdata_status.md
--rw-r--r--   0        0        0     1510 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/update_masterdata_status.py
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/year_vol_iss_prep.md
--rw-r--r--   0        0        0     7823 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep/year_vol_iss_prep.py
--rw-r--r--   0        0        0      128 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep_man/__init__.py
--rw-r--r--   0        0        0      161 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.md
--rw-r--r--   0        0        0     1983 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py
--rw-r--r--   0        0        0      600 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep_man/prep_man_export.md
--rw-r--r--   0        0        0    13452 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prep_man/prep_man_export.py
--rw-r--r--   0        0        0      129 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/__init__.py
--rw-r--r--   0        0        0      165 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/asreview.md
--rw-r--r--   0        0        0     9888 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/asreview.py
--rw-r--r--   0        0        0      165 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/conditional_prescreen.md
--rw-r--r--   0        0        0     2128 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/conditional_prescreen.py
--rw-r--r--   0        0        0      165 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/prescreen_cli.md
--rw-r--r--   0        0        0     5142 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/prescreen_cli.py
--rw-r--r--   0        0        0      165 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/prescreen_table.md
--rw-r--r--   0        0        0     9738 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/prescreen_table.py
--rw-r--r--   0        0        0      165 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/scope_prescreen.md
--rw-r--r--   0        0        0     9071 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/prescreen/scope_prescreen.py
--rw-r--r--   0        0        0      132 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/__init__.py
--rw-r--r--   0        0        0      509 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/conceptual_review.md
--rw-r--r--   0        0        0     1296 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/conceptual_review.py
--rw-r--r--   0        0        0      507 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/critical_review.md
--rw-r--r--   0        0        0     1349 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/critical_review.py
--rw-r--r--   0        0        0     1141 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/curated_masterdata.md
--rw-r--r--   0        0        0     4705 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/curated_masterdata.py
--rw-r--r--   0        0        0      510 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/descriptive_review.md
--rw-r--r--   0        0        0     1363 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/descriptive_review.py
--rw-r--r--   0        0        0      509 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/literature_review.md
--rw-r--r--   0        0        0     1312 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/literature_review.py
--rw-r--r--   0        0        0      704 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/meta_analysis.md
--rw-r--r--   0        0        0     1845 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/meta_analysis.py
--rw-r--r--   0        0        0      508 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/narrative_review.md
--rw-r--r--   0        0        0     1291 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/narrative_review.py
--rw-r--r--   0        0        0      521 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/qualitative_systematic_review.md
--rw-r--r--   0        0        0     1924 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/qualitative_systematic_review.py
--rw-r--r--   0        0        0      633 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/scientometric.md
--rw-r--r--   0        0        0     1378 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/scientometric.py
--rw-r--r--   0        0        0      506 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/scoping_review.md
--rw-r--r--   0        0        0     1483 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/scoping_review.py
--rw-r--r--   0        0        0      510 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/theoretical_review.md
--rw-r--r--   0        0        0     1442 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/review_types/theoretical_review.py
--rw-r--r--   0        0        0      126 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/screen/__init__.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/screen/screen_cli.md
--rw-r--r--   0        0        0     9843 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/screen/screen_cli.py
--rw-r--r--   0        0        0      159 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/screen/screen_table.md
--rw-r--r--   0        0        0     8939 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/screen/screen_table.py
--rw-r--r--   0        0        0     2703 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/screen/utils.py
--rw-r--r--   0        0        0      133 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/__init__.py
--rw-r--r--   0        0        0      486 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/abi_inform_proquest.md
--rw-r--r--   0        0        0     4476 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/abi_inform_proquest.py
--rw-r--r--   0        0        0      437 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/acm_digital_library.md
--rw-r--r--   0        0        0     4071 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/acm_digital_library.py
--rw-r--r--   0        0        0      766 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/aisel.md
--rw-r--r--   0        0        0    18737 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/aisel.py
--rw-r--r--   0        0        0      373 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/colrev_project.md
--rw-r--r--   0        0        0     9185 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/colrev_project.py
--rw-r--r--   0        0        0      698 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/crossref.md
--rw-r--r--   0        0        0    34666 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/crossref.py
--rw-r--r--   0        0        0      587 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/dblp.md
--rw-r--r--   0        0        0    26608 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/dblp.py
--rw-r--r--   0        0        0     6286 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/doi_org.py
--rw-r--r--   0        0        0      509 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/ebsco_host.md
--rw-r--r--   0        0        0     3156 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/ebsco_host.py
--rw-r--r--   0        0        0      450 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/eric.md
--rw-r--r--   0        0        0     3634 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/eric.py
--rw-r--r--   0        0        0      585 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/europe_pmc.md
--rw-r--r--   0        0        0    20520 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/europe_pmc.py
--rw-r--r--   0        0        0      552 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/google_scholar.md
--rw-r--r--   0        0        0     5022 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/google_scholar.py
--rw-r--r--   0        0        0      433 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/ieee.md
--rw-r--r--   0        0        0     4073 2023-05-19 10:44:57.509876 colrev-0.8.4/colrev/ops/built_in/search_sources/ieee.py
--rw-r--r--   0        0        0      417 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/jstor.md
--rw-r--r--   0        0        0     3733 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/jstor.py
--rw-r--r--   0        0        0      367 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/local_index.md
--rw-r--r--   0        0        0    34266 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/local_index.py
--rw-r--r--   0        0        0      429 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/open_citations_forward_search.md
--rw-r--r--   0        0        0     9323 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/open_citations_forward_search.py
--rw-r--r--   0        0        0      391 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/open_library.md
--rw-r--r--   0        0        0    11641 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/open_library.py
--rw-r--r--   0        0        0      804 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/pdf_backward_search.md
--rw-r--r--   0        0        0    15770 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/pdf_backward_search.py
--rw-r--r--   0        0        0      396 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/pdfs_dir.md
--rw-r--r--   0        0        0    30264 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/pdfs_dir.py
--rw-r--r--   0        0        0      439 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/psycinfo.md
--rw-r--r--   0        0        0     3676 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/psycinfo.py
--rw-r--r--   0        0        0      570 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/pubmed.md
--rw-r--r--   0        0        0    26050 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/pubmed.py
--rw-r--r--   0        0        0      418 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/scopus.md
--rw-r--r--   0        0        0     5562 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/scopus.py
--rw-r--r--   0        0        0      435 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/springer_link.md
--rw-r--r--   0        0        0     6470 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/springer_link.py
--rw-r--r--   0        0        0      480 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/systematic_review_datasets.md
--rw-r--r--   0        0        0     5130 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/systematic_review_datasets.py
--rw-r--r--   0        0        0      442 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/taylor_and_francis.md
--rw-r--r--   0        0        0     3223 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/taylor_and_francis.py
--rw-r--r--   0        0        0      463 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/trid.md
--rw-r--r--   0        0        0     3967 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/trid.py
--rw-r--r--   0        0        0      406 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/unknown_source.md
--rw-r--r--   0        0        0    14314 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/unknown_source.py
--rw-r--r--   0        0        0     5724 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/utils.py
--rw-r--r--   0        0        0      330 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/video_dir.md
--rw-r--r--   0        0        0     6350 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/video_dir.py
--rw-r--r--   0        0        0      443 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/web_of_science.md
--rw-r--r--   0        0        0     4712 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/web_of_science.py
--rw-r--r--   0        0        0     6527 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/website.py
--rw-r--r--   0        0        0      543 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/wiley.md
--rw-r--r--   0        0        0     3768 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/built_in/search_sources/wiley.py
--rw-r--r--   0        0        0     1472 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/clone.py
--rw-r--r--   0        0        0     9585 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/commit.py
--rw-r--r--   0        0        0     7310 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/correct.py
--rw-r--r--   0        0        0    15016 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/data.py
--rw-r--r--   0        0        0    39551 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/dedupe.py
--rw-r--r--   0        0        0     4871 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/distribute.py
--rw-r--r--   0        0        0    16767 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/init.py
--rw-r--r--   0        0        0    40734 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/load.py
--rw-r--r--   0        0        0     9491 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/merge.py
--rw-r--r--   0        0        0    26382 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/pdf_get.py
--rw-r--r--   0        0        0     7993 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/pdf_get_man.py
--rw-r--r--   0        0        0    17836 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/pdf_prep.py
--rw-r--r--   0        0        0    13485 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/pdf_prep_man.py
--rw-r--r--   0        0        0    41735 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/prep.py
--rw-r--r--   0        0        0    11174 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/prep_man.py
--rw-r--r--   0        0        0    12840 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/prescreen.py
--rw-r--r--   0        0        0     1728 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/pull.py
--rw-r--r--   0        0        0     5748 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/push.py
--rw-r--r--   0        0        0     2329 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/remove.py
--rw-r--r--   0        0        0    16311 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/repare.py
--rw-r--r--   0        0        0     1126 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/review_types.py
--rw-r--r--   0        0        0    16117 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/screen.py
--rw-r--r--   0        0        0    24160 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/search.py
--rw-r--r--   0        0        0     1650 2023-05-19 10:44:57.513876 colrev-0.8.4/colrev/ops/search_sources.py
--rwxr-xr-x   0        0        0    22158 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/ops/status.py
--rw-r--r--   0        0        0     8944 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/ops/sync.py
--rw-r--r--   0        0        0     4470 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/ops/trace.py
--rw-r--r--   0        0        0    15102 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/ops/upgrade.py
--rw-r--r--   0        0        0    21985 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/ops/validate.py
--rw-r--r--   0        0        0        0 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/py.typed
--rw-r--r--   0        0        0      112 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/__init__.py
--rw-r--r--   0        0        0       91 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/__init__.py
--rw-r--r--   0        0        0     1152 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/container_title_abbreviated.py
--rw-r--r--   0        0        0     1105 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/doi_not_matching_pattern.py
--rw-r--r--   0        0        0     1207 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/erroneous_symbol_in_field.py
--rw-r--r--   0        0        0     1163 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/erroneous_term_in_field.py
--rw-r--r--   0        0        0     1137 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/erroneous_title_field.py
--rw-r--r--   0        0        0     1571 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/identical_values_between_title_and_container.py
--rw-r--r--   0        0        0     1543 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/incomplete_field.py
--rw-r--r--   0        0        0     1596 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/inconsistent_content.py
--rw-r--r--   0        0        0     2962 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/inconsistent_with_doi_metadata.py
--rw-r--r--   0        0        0     2007 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/inconsistent_with_entrytype.py
--rw-r--r--   0        0        0     2363 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/inconsistent_with_url_metadata.py
--rw-r--r--   0        0        0     1188 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/isbn_not_matching_pattern.py
--rw-r--r--   0        0        0     1279 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/language_format_error.py
--rw-r--r--   0        0        0    10871 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/missing_field.py
--rw-r--r--   0        0        0     1442 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/mostly_all_caps.py
--rw-r--r--   0        0        0     1211 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/name_abbreviated.py
--rw-r--r--   0        0        0     2402 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/name_format_separators.py
--rw-r--r--   0        0        0     1379 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/name_format_titles.py
--rw-r--r--   0        0        0     1754 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/record_not_in_toc.py
--rw-r--r--   0        0        0     1231 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/thesis_with_multiple_authors.py
--rw-r--r--   0        0        0     1018 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/checkers/year_format.py
--rw-r--r--   0        0        0     7163 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/colrev_id.py
--rw-r--r--   0        0        0     1531 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/colrev_pdf_id.py
--rw-r--r--   0        0        0     1760 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/quality_model.py
--rw-r--r--   0        0        0     2967 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/qm/readme.md
--rw-r--r--   0        0        0      104 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/readme.md
--rw-r--r--   0        0        0    90238 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/record.py
--rw-r--r--   0        0        0    25652 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/review_manager.py
--rw-r--r--   0        0        0    11463 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/service.py
--rw-r--r--   0        0        0    19754 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/settings.py
--rw-r--r--   0        0        0     1882 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/custom_scripts/custom_data_script.py
--rw-r--r--   0        0        0     1157 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/custom_scripts/custom_pdf_get_script.py
--rw-r--r--   0        0        0     1427 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/custom_scripts/custom_pdf_prep_script.py
--rw-r--r--   0        0        0     1414 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/custom_scripts/custom_prep_script.py
--rw-r--r--   0        0        0     1891 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/custom_scripts/custom_prescreen_script.py
--rw-r--r--   0        0        0     2407 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/custom_scripts/custom_screen_script.py
--rw-r--r--   0        0        0     3301 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/custom_scripts/custom_search_source_script.py
--rw-r--r--   0        0        0    15707 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/example/30_example_records.bib
--rw-r--r--   0        0        0      143 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/github_pages/README.md
--rw-r--r--   0        0        0      155 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/github_pages/_config.yml
--rw-r--r--   0        0        0       73 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/github_pages/about.md
--rw-r--r--   0        0        0     4953 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/github_pages/index.html
--rw-r--r--   0        0        0      185 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/github_pages/pre-commit-config.yaml
--rw-r--r--   0        0        0    18650 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/LICENSE-CC-BY-4.0.txt
--rw-r--r--   0        0        0     1770 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/colrev_update.yml
--rw-r--r--   0        0        0     1555 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/colrev_update_curation.yml
--rw-r--r--   0        0        0       54 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/gitattributes
--rw-r--r--   0        0        0       85 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/markdownlint.yaml
--rw-r--r--   0        0        0      936 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/pre-commit-config.yaml
--rw-r--r--   0        0        0      480 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/pre-commit.yml
--rw-r--r--   0        0        0      270 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/readme.md
--rw-r--r--   0        0        0     5226 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/init/settings.json
--rw-r--r--   0        0        0      930 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/commit_report_details.txt
--rw-r--r--   0        0        0      271 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/commit_report_header.txt
--rw-r--r--   0        0        0      352 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/complementary_material_keywords.txt
--rw-r--r--   0        0        0      318 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/complementary_material_strings.txt
--rw-r--r--   0        0        0      494 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/masterdata_curations.csv
--rw-r--r--   0        0        0      462 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/pdf_get_man_mail.txt
--rw-r--r--   0        0        0    76341 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/predatory_journals_beall.csv
--rw-r--r--   0        0        0     2729 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/prep_man_curation.ipynb
--rw-r--r--   0        0        0     3830 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/ops/status.txt
--rw-r--r--   0        0        0    50201 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/package_endpoints.json
--rw-r--r--   0        0        0    12922 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/package_status.json
--rw-r--r--   0        0        0       94 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/packages.json
--rw-r--r--   0        0        0    25233 2023-05-19 10:44:57.517876 colrev-0.8.4/colrev/template/paper_md/APA-7.docx
--rw-r--r--   0        0        0      381 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/paper_md/non_sample_references.bib
--rw-r--r--   0        0        0      673 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/paper_md/paper.md
--rw-r--r--   0        0        0     4935 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/prisma/PRISMA.csv
--rw-r--r--   0        0        0     5108 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/prisma/PRISMA_original.csv
--rw-r--r--   0        0        0      872 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/prisma/prisma-refs.bib
--rw-r--r--   0        0        0      262 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/prisma/prisma_text.md
--rw-r--r--   0        0        0     1506 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml
--rw-r--r--   0        0        0      460 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/review_type/curated_masterdata/readme.md
--rw-r--r--   0        0        0      586 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/template/review_type/meta_analysis/paper.md
--rw-r--r--   0        0        0      104 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/ui_cli/__init__.py
--rw-r--r--   0        0        0     5572 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/ui_cli/add_packages.py
--rw-r--r--   0        0        0    76512 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/ui_cli/cli.py
--rw-r--r--   0        0        0      146 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/ui_cli/cli_colors.py
--rw-r--r--   0        0        0     9450 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/ui_cli/cli_status_printer.py
--rw-r--r--   0        0        0     7446 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/ui_cli/cli_validation.py
--rw-r--r--   0        0        0     2891 2023-05-19 10:44:57.521876 colrev-0.8.4/colrev/ui_cli/show_printer.py
--rw-r--r--   0        0        0     2898 2023-05-19 10:44:57.545876 colrev-0.8.4/pyproject.toml
--rw-r--r--   0        0        0    10506 1970-01-01 00:00:00.000000 colrev-0.8.4/PKG-INFO
+-rw-r--r--   0        0        0    10176 2023-05-31 20:23:35.825381 colrev-0.9.0/CHANGELOG.md
+-rw-r--r--   0        0        0     4405 2023-05-31 20:23:35.825381 colrev-0.9.0/CONTRIBUTING.md
+-rw-r--r--   0        0        0     1070 2023-05-31 20:23:35.825381 colrev-0.9.0/LICENSE
+-rw-r--r--   0        0        0     8248 2023-05-31 20:23:35.825381 colrev-0.9.0/README.md
+-rw-r--r--   0        0        0      314 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/__init__.py
+-rw-r--r--   0        0        0      128 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/__version__.py
+-rw-r--r--   0        0        0    31379 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/advisor.py
+-rw-r--r--   0        0        0    31762 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/checker.py
+-rw-r--r--   0        0        0    43268 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/dataset.py
+-rw-r--r--   0        0        0      105 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/env/__init__.py
+-rw-r--r--   0        0        0    15934 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/env/environment_manager.py
+-rw-r--r--   0        0        0     2160 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/env/grobid_service.py
+-rw-r--r--   0        0        0     3657 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/env/language_service.py
+-rw-r--r--   0        0        0    53533 2023-05-31 20:23:35.825381 colrev-0.9.0/colrev/env/local_index.py
+-rw-r--r--   0        0        0    39355 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/env/package_manager.py
+-rw-r--r--   0        0        0     2270 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/env/resources.py
+-rw-r--r--   0        0        0     3933 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/env/screenshot_service.py
+-rw-r--r--   0        0        0    34818 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/env/tei_parser.py
+-rw-r--r--   0        0        0     5724 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/env/utils.py
+-rw-r--r--   0        0        0     2526 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/env/zotero_translation_service.py
+-rw-r--r--   0        0        0    18180 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/exceptions.py
+-rw-r--r--   0        0        0      151 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/exit_codes.py
+-rw-r--r--   0        0        0       86 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/hooks/__init__.py
+-rwxr-xr-x   0        0        0      352 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/hooks/check.py
+-rwxr-xr-x   0        0        0      372 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/hooks/format.py
+-rwxr-xr-x   0        0        0      468 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/hooks/report.py
+-rwxr-xr-x   0        0        0      360 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/hooks/share.py
+-rwxr-xr-x   0        0        0     1233 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/hooks/update.py
+-rw-r--r--   0        0        0     1842 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/linter/colrev_lint.py
+-rw-r--r--   0        0        0      310 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/linter/readme.md
+-rw-r--r--   0        0        0     3082 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/logger.py
+-rw-r--r--   0        0        0     7702 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/operation.py
+-rw-r--r--   0        0        0       92 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/__init__.py
+-rw-r--r--   0        0        0      119 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/__init__.py
+-rw-r--r--   0        0        0      135 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/__init__.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/bibliography_export.md
+-rw-r--r--   0        0        0     9191 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/bibliography_export.py
+-rw-r--r--   0        0        0     1084 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/colrev_curation.md
+-rw-r--r--   0        0        0    14961 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/colrev_curation.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/github_pages.md
+-rw-r--r--   0        0        0    13410 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/github_pages.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/obsidian.md
+-rw-r--r--   0        0        0     9428 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/obsidian.py
+-rw-r--r--   0        0        0     1142 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/paper_md.md
+-rw-r--r--   0        0        0    31983 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/paper_md.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/prisma.md
+-rw-r--r--   0        0        0     9200 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/prisma.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/structured.md
+-rw-r--r--   0        0        0    11223 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/data/structured.py
+-rw-r--r--   0        0        0      126 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/__init__.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/active_learning_dedup_io.md
+-rw-r--r--   0        0        0    42748 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/active_learning_dedup_io.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/curation_dedupe.md
+-rw-r--r--   0        0        0    25476 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/curation_dedupe.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/curation_missing_dedupe.md
+-rw-r--r--   0        0        0    14316 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/curation_missing_dedupe.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/simple_dedupe.md
+-rw-r--r--   0        0        0    14251 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/simple_dedupe.py
+-rw-r--r--   0        0        0     1961 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/dedupe/utils.py
+-rw-r--r--   0        0        0      135 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/__init__.py
+-rw-r--r--   0        0        0      189 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/bib_pybtex_loader.md
+-rw-r--r--   0        0        0     5304 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/bib_pybtex_loader.py
+-rw-r--r--   0        0        0      189 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/bibutils_loader.md
+-rw-r--r--   0        0        0     4381 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/bibutils_loader.py
+-rw-r--r--   0        0        0      189 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/markdown_loader.md
+-rw-r--r--   0        0        0     2870 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/markdown_loader.py
+-rw-r--r--   0        0        0      189 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/table_loader.md
+-rw-r--r--   0        0        0     8828 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/table_loader.py
+-rw-r--r--   0        0        0      401 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/zotero_loader.md
+-rw-r--r--   0        0        0     3377 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/load_conversion/zotero_loader.py
+-rw-r--r--   0        0        0      127 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get/__init__.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get/local_index_pdf_get.md
+-rw-r--r--   0        0        0     2484 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get/local_index_pdf_get.py
+-rw-r--r--   0        0        0      432 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get/unpaywall.md
+-rw-r--r--   0        0        0     5281 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get/unpaywall.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get/website_screenshot.md
+-rw-r--r--   0        0        0     1786 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get/website_screenshot.py
+-rw-r--r--   0        0        0      131 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get_man/__init__.py
+-rw-r--r--   0        0        0      165 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.md
+-rw-r--r--   0        0        0    10924 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py
+-rw-r--r--   0        0        0      128 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/__init__.py
+-rw-r--r--   0        0        0      161 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/check_ocr.md
+-rw-r--r--   0        0        0     4403 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/check_ocr.py
+-rw-r--r--   0        0        0      161 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/completeness_validation.md
+-rw-r--r--   0        0        0     6864 2023-05-31 20:23:35.829381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/completeness_validation.py
+-rw-r--r--   0        0        0      161 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/cover_page.md
+-rw-r--r--   0        0        0     7848 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/cover_page.py
+-rw-r--r--   0        0        0      161 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/last_page.md
+-rw-r--r--   0        0        0     4888 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/last_page.py
+-rw-r--r--   0        0        0      161 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/metadata_validation.md
+-rw-r--r--   0        0        0     6435 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/metadata_validation.py
+-rw-r--r--   0        0        0      161 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/tei_prep.md
+-rw-r--r--   0        0        0     2105 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep/tei_prep.py
+-rw-r--r--   0        0        0      132 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep_man/__init__.py
+-rw-r--r--   0        0        0      167 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.md
+-rw-r--r--   0        0        0    10062 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py
+-rw-r--r--   0        0        0      124 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/__init__.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/bibtex_crossref_resolution.md
+-rw-r--r--   0        0        0     2740 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/bibtex_crossref_resolution.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/citeas_prep.md
+-rw-r--r--   0        0        0     4601 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/citeas_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/crossref_metadata_prep.md
+-rw-r--r--   0        0        0     2483 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/crossref_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/curation_prep.md
+-rw-r--r--   0        0        0     2161 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/curation_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/dblp_metadata_prep.md
+-rw-r--r--   0        0        0     2353 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/dblp_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/doi_from_urls_prep.md
+-rw-r--r--   0        0        0     4110 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/doi_from_urls_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/doi_metadata_prep.md
+-rw-r--r--   0        0        0     1961 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/doi_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/europe_pmc_prep.md
+-rw-r--r--   0        0        0     1701 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/europe_pmc_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_collections.md
+-rw-r--r--   0        0        0     1513 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_collections.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_complementary_materials.md
+-rw-r--r--   0        0        0     2286 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_complementary_materials.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_languages.md
+-rw-r--r--   0        0        0     5819 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_languages.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_non_latin_alphabets.md
+-rw-r--r--   0        0        0     2384 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/general_polish.md
+-rw-r--r--   0        0        0     2076 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/general_polish.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/local_index_prep.md
+-rw-r--r--   0        0        0     2428 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/local_index_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/open_library_prep.md
+-rw-r--r--   0        0        0     2058 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/open_library_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/pubmed_metadata_prep.md
+-rw-r--r--   0        0        0     2318 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/pubmed_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/remove_broken_ids.md
+-rw-r--r--   0        0        0     2121 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/remove_broken_ids.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/remove_error500_urls.md
+-rw-r--r--   0        0        0     2308 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/remove_error500_urls.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/semantic_scholar_prep.md
+-rw-r--r--   0        0        0     6991 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/semantic_scholar_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/source_specific_prep.md
+-rw-r--r--   0        0        0     2974 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/source_specific_prep.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/update_masterdata_status.md
+-rw-r--r--   0        0        0     1410 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/update_masterdata_status.py
+-rw-r--r--   0        0        0     1106 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/utils.py
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/year_vol_iss_prep.md
+-rw-r--r--   0        0        0     7724 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep/year_vol_iss_prep.py
+-rw-r--r--   0        0        0      128 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep_man/__init__.py
+-rw-r--r--   0        0        0      161 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.md
+-rw-r--r--   0        0        0     1882 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py
+-rw-r--r--   0        0        0     1368 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep_man/prep_man_export.md
+-rw-r--r--   0        0        0    13793 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prep_man/prep_man_export.py
+-rw-r--r--   0        0        0      129 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/__init__.py
+-rw-r--r--   0        0        0      165 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/asreview.md
+-rw-r--r--   0        0        0     9793 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/asreview.py
+-rw-r--r--   0        0        0      165 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/conditional_prescreen.md
+-rw-r--r--   0        0        0     2033 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/conditional_prescreen.py
+-rw-r--r--   0        0        0      165 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/prescreen_cli.md
+-rw-r--r--   0        0        0     5047 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/prescreen_cli.py
+-rw-r--r--   0        0        0      165 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/prescreen_table.md
+-rw-r--r--   0        0        0     9643 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/prescreen_table.py
+-rw-r--r--   0        0        0      165 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/scope_prescreen.md
+-rw-r--r--   0        0        0     8976 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/prescreen/scope_prescreen.py
+-rw-r--r--   0        0        0      132 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/__init__.py
+-rw-r--r--   0        0        0      509 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/conceptual_review.md
+-rw-r--r--   0        0        0     1258 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/conceptual_review.py
+-rw-r--r--   0        0        0      507 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/critical_review.md
+-rw-r--r--   0        0        0     1311 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/critical_review.py
+-rw-r--r--   0        0        0     1141 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/curated_masterdata.md
+-rw-r--r--   0        0        0     4667 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/curated_masterdata.py
+-rw-r--r--   0        0        0      510 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/descriptive_review.md
+-rw-r--r--   0        0        0     1325 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/descriptive_review.py
+-rw-r--r--   0        0        0      509 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/literature_review.md
+-rw-r--r--   0        0        0     1274 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/literature_review.py
+-rw-r--r--   0        0        0      704 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/meta_analysis.md
+-rw-r--r--   0        0        0     1807 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/meta_analysis.py
+-rw-r--r--   0        0        0      508 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/narrative_review.md
+-rw-r--r--   0        0        0     1253 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/narrative_review.py
+-rw-r--r--   0        0        0      521 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/qualitative_systematic_review.md
+-rw-r--r--   0        0        0     1886 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/qualitative_systematic_review.py
+-rw-r--r--   0        0        0      633 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/scientometric.md
+-rw-r--r--   0        0        0     1340 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/scientometric.py
+-rw-r--r--   0        0        0      506 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/scoping_review.md
+-rw-r--r--   0        0        0     1445 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/scoping_review.py
+-rw-r--r--   0        0        0      510 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/theoretical_review.md
+-rw-r--r--   0        0        0     1404 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/review_types/theoretical_review.py
+-rw-r--r--   0        0        0      126 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/screen/__init__.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/screen/screen_cli.md
+-rw-r--r--   0        0        0     9743 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/screen/screen_cli.py
+-rw-r--r--   0        0        0      159 2023-05-31 20:23:35.833381 colrev-0.9.0/colrev/ops/built_in/screen/screen_table.md
+-rw-r--r--   0        0        0     8839 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/screen/screen_table.py
+-rw-r--r--   0        0        0     2642 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/screen/utils.py
+-rw-r--r--   0        0        0      133 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/__init__.py
+-rw-r--r--   0        0        0      486 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/abi_inform_proquest.md
+-rw-r--r--   0        0        0     4730 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/abi_inform_proquest.py
+-rw-r--r--   0        0        0      437 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/acm_digital_library.md
+-rw-r--r--   0        0        0     4252 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/acm_digital_library.py
+-rw-r--r--   0        0        0      766 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/aisel.md
+-rw-r--r--   0        0        0    18699 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/aisel.py
+-rw-r--r--   0        0        0      373 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/colrev_project.md
+-rw-r--r--   0        0        0     9151 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/colrev_project.py
+-rw-r--r--   0        0        0      698 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/crossref.md
+-rw-r--r--   0        0        0    34796 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/crossref.py
+-rw-r--r--   0        0        0      587 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/dblp.md
+-rw-r--r--   0        0        0    26791 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/dblp.py
+-rw-r--r--   0        0        0     6348 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/doi_org.py
+-rw-r--r--   0        0        0      509 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/ebsco_host.md
+-rw-r--r--   0        0        0     3118 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/ebsco_host.py
+-rw-r--r--   0        0        0      450 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/eric.md
+-rw-r--r--   0        0        0     3596 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/eric.py
+-rw-r--r--   0        0        0      585 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/europe_pmc.md
+-rw-r--r--   0        0        0    21029 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/europe_pmc.py
+-rw-r--r--   0        0        0      552 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/google_scholar.md
+-rw-r--r--   0        0        0     4984 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/google_scholar.py
+-rw-r--r--   0        0        0      433 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/ieee.md
+-rw-r--r--   0        0        0     4035 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/ieee.py
+-rw-r--r--   0        0        0      417 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/jstor.md
+-rw-r--r--   0        0        0     3695 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/jstor.py
+-rw-r--r--   0        0        0      367 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/local_index.md
+-rw-r--r--   0        0        0    34279 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/local_index.py
+-rw-r--r--   0        0        0      429 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/open_citations_forward_search.md
+-rw-r--r--   0        0        0     9285 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/open_citations_forward_search.py
+-rw-r--r--   0        0        0      391 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/open_library.md
+-rw-r--r--   0        0        0    11541 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/open_library.py
+-rw-r--r--   0        0        0      804 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/pdf_backward_search.md
+-rw-r--r--   0        0        0    15938 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/pdf_backward_search.py
+-rw-r--r--   0        0        0      396 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/pdfs_dir.md
+-rw-r--r--   0        0        0    32716 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/pdfs_dir.py
+-rw-r--r--   0        0        0      439 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/psycinfo.md
+-rw-r--r--   0        0        0     3638 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/psycinfo.py
+-rw-r--r--   0        0        0      570 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/pubmed.md
+-rw-r--r--   0        0        0    26103 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/pubmed.py
+-rw-r--r--   0        0        0      418 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/scopus.md
+-rw-r--r--   0        0        0     5762 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/scopus.py
+-rw-r--r--   0        0        0      435 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/springer_link.md
+-rw-r--r--   0        0        0     6432 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/springer_link.py
+-rw-r--r--   0        0        0      480 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/systematic_review_datasets.md
+-rw-r--r--   0        0        0     5092 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/systematic_review_datasets.py
+-rw-r--r--   0        0        0      442 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/taylor_and_francis.md
+-rw-r--r--   0        0        0     3440 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/taylor_and_francis.py
+-rw-r--r--   0        0        0      463 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/trid.md
+-rw-r--r--   0        0        0     3929 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/trid.py
+-rw-r--r--   0        0        0      406 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/unknown_source.md
+-rw-r--r--   0        0        0    14276 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/unknown_source.py
+-rw-r--r--   0        0        0     5747 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/utils.py
+-rw-r--r--   0        0        0      330 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/video_dir.md
+-rw-r--r--   0        0        0     6312 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/video_dir.py
+-rw-r--r--   0        0        0      443 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/web_of_science.md
+-rw-r--r--   0        0        0     4934 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/web_of_science.py
+-rw-r--r--   0        0        0     6390 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/website.py
+-rw-r--r--   0        0        0      543 2023-05-31 20:23:35.837381 colrev-0.9.0/colrev/ops/built_in/search_sources/wiley.md
+-rw-r--r--   0        0        0     3730 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/built_in/search_sources/wiley.py
+-rw-r--r--   0        0        0     1434 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/clone.py
+-rw-r--r--   0        0        0     9485 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/commit.py
+-rw-r--r--   0        0        0     7210 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/correct.py
+-rw-r--r--   0        0        0    14978 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/data.py
+-rw-r--r--   0        0        0    36862 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/dedupe.py
+-rw-r--r--   0        0        0     4771 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/distribute.py
+-rw-r--r--   0        0        0    16729 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/init.py
+-rw-r--r--   0        0        0    40696 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/load.py
+-rw-r--r--   0        0        0     9391 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/merge.py
+-rw-r--r--   0        0        0    26121 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/pdf_get.py
+-rw-r--r--   0        0        0     7955 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/pdf_get_man.py
+-rw-r--r--   0        0        0    17798 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/pdf_prep.py
+-rw-r--r--   0        0        0    13447 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/pdf_prep_man.py
+-rw-r--r--   0        0        0    45321 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/prep.py
+-rw-r--r--   0        0        0    11241 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/prep_man.py
+-rw-r--r--   0        0        0    13905 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/prescreen.py
+-rw-r--r--   0        0        0     1690 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/pull.py
+-rw-r--r--   0        0        0     5710 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/push.py
+-rw-r--r--   0        0        0     2229 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/remove.py
+-rw-r--r--   0        0        0    16211 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/repare.py
+-rw-r--r--   0        0        0     1088 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/review_types.py
+-rw-r--r--   0        0        0    17173 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/screen.py
+-rw-r--r--   0        0        0    24436 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/search.py
+-rw-r--r--   0        0        0     1612 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/search_sources.py
+-rwxr-xr-x   0        0        0    22099 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/status.py
+-rw-r--r--   0        0        0     8906 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/sync.py
+-rw-r--r--   0        0        0     4181 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/trace.py
+-rw-r--r--   0        0        0    16619 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/upgrade.py
+-rw-r--r--   0        0        0    21877 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/ops/validate.py
+-rw-r--r--   0        0        0        0 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/py.typed
+-rw-r--r--   0        0        0      112 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/__init__.py
+-rw-r--r--   0        0        0       91 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/__init__.py
+-rw-r--r--   0        0        0     1152 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/container_title_abbreviated.py
+-rw-r--r--   0        0        0     1105 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/doi_not_matching_pattern.py
+-rw-r--r--   0        0        0     1207 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/erroneous_symbol_in_field.py
+-rw-r--r--   0        0        0     1532 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/erroneous_term_in_field.py
+-rw-r--r--   0        0        0     1364 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/erroneous_title_field.py
+-rw-r--r--   0        0        0     1571 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/identical_values_between_title_and_container.py
+-rw-r--r--   0        0        0     1543 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/incomplete_field.py
+-rw-r--r--   0        0        0     1596 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/inconsistent_content.py
+-rw-r--r--   0        0        0     3083 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/inconsistent_with_doi_metadata.py
+-rw-r--r--   0        0        0     1957 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/inconsistent_with_entrytype.py
+-rw-r--r--   0        0        0     2363 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/inconsistent_with_url_metadata.py
+-rw-r--r--   0        0        0     1189 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/isbn_not_matching_pattern.py
+-rw-r--r--   0        0        0     1279 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/language_format_error.py
+-rw-r--r--   0        0        0    11720 2023-05-31 20:23:35.841381 colrev-0.9.0/colrev/qm/checkers/missing_field.py
+-rw-r--r--   0        0        0     1442 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/checkers/mostly_all_caps.py
+-rw-r--r--   0        0        0     1211 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/checkers/name_abbreviated.py
+-rw-r--r--   0        0        0     2392 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/checkers/name_format_separators.py
+-rw-r--r--   0        0        0     1379 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/checkers/name_format_titles.py
+-rw-r--r--   0        0        0     1754 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/checkers/record_not_in_toc.py
+-rw-r--r--   0        0        0     1231 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/checkers/thesis_with_multiple_authors.py
+-rw-r--r--   0        0        0     1018 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/checkers/year_format.py
+-rw-r--r--   0        0        0     7063 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/colrev_id.py
+-rw-r--r--   0        0        0     1493 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/colrev_pdf_id.py
+-rw-r--r--   0        0        0     1722 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/quality_model.py
+-rw-r--r--   0        0        0     2967 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/qm/readme.md
+-rw-r--r--   0        0        0      104 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/readme.md
+-rw-r--r--   0        0        0    90460 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/record.py
+-rw-r--r--   0        0        0    25592 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/review_manager.py
+-rw-r--r--   0        0        0    11425 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/service.py
+-rw-r--r--   0        0        0    19654 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/settings.py
+-rw-r--r--   0        0        0     1820 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/custom_scripts/custom_data_script.py
+-rw-r--r--   0        0        0     1096 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/custom_scripts/custom_pdf_get_script.py
+-rw-r--r--   0        0        0     1365 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/custom_scripts/custom_pdf_prep_script.py
+-rw-r--r--   0        0        0     1314 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/custom_scripts/custom_prep_script.py
+-rw-r--r--   0        0        0     1829 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/custom_scripts/custom_prescreen_script.py
+-rw-r--r--   0        0        0     2345 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/custom_scripts/custom_screen_script.py
+-rw-r--r--   0        0        0     3239 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/custom_scripts/custom_search_source_script.py
+-rw-r--r--   0        0        0    15707 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/example/30_example_records.bib
+-rw-r--r--   0        0        0      143 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/github_pages/README.md
+-rw-r--r--   0        0        0      155 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/github_pages/_config.yml
+-rw-r--r--   0        0        0       73 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/github_pages/about.md
+-rw-r--r--   0        0        0     4953 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/github_pages/index.html
+-rw-r--r--   0        0        0      185 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/github_pages/pre-commit-config.yaml
+-rw-r--r--   0        0        0    18650 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/LICENSE-CC-BY-4.0.txt
+-rw-r--r--   0        0        0     1770 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/colrev_update.yml
+-rw-r--r--   0        0        0     1555 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/colrev_update_curation.yml
+-rw-r--r--   0        0        0       54 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/gitattributes
+-rw-r--r--   0        0        0       85 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/markdownlint.yaml
+-rw-r--r--   0        0        0      936 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/pre-commit-config.yaml
+-rw-r--r--   0        0        0      480 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/pre-commit.yml
+-rw-r--r--   0        0        0      276 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/readme.md
+-rw-r--r--   0        0        0     5226 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/init/settings.json
+-rw-r--r--   0        0        0      930 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/commit_report_details.txt
+-rw-r--r--   0        0        0      271 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/commit_report_header.txt
+-rw-r--r--   0        0        0      352 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/complementary_material_keywords.txt
+-rw-r--r--   0        0        0      318 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/complementary_material_strings.txt
+-rw-r--r--   0        0        0      494 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/masterdata_curations.csv
+-rw-r--r--   0        0        0      462 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/pdf_get_man_mail.txt
+-rw-r--r--   0        0        0    76341 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/predatory_journals_beall.csv
+-rw-r--r--   0        0        0     2729 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/prep_man_curation.ipynb
+-rw-r--r--   0        0        0     3830 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/ops/status.txt
+-rw-r--r--   0        0        0    50201 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/package_endpoints.json
+-rw-r--r--   0        0        0    12922 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/package_status.json
+-rw-r--r--   0        0        0       94 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/packages.json
+-rw-r--r--   0        0        0    25233 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/paper_md/APA-7.docx
+-rw-r--r--   0        0        0      381 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/paper_md/non_sample_references.bib
+-rw-r--r--   0        0        0      673 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/paper_md/paper.md
+-rw-r--r--   0        0        0     4935 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/prisma/PRISMA.csv
+-rw-r--r--   0        0        0     5108 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/prisma/PRISMA_original.csv
+-rw-r--r--   0        0        0      872 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/prisma/prisma-refs.bib
+-rw-r--r--   0        0        0      262 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/prisma/prisma_text.md
+-rw-r--r--   0        0        0     1506 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml
+-rw-r--r--   0        0        0      460 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/review_type/curated_masterdata/readme.md
+-rw-r--r--   0        0        0      586 2023-05-31 20:23:35.845381 colrev-0.9.0/colrev/template/review_type/meta_analysis/paper.md
+-rw-r--r--   0        0        0      104 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/__init__.py
+-rw-r--r--   0        0        0     5534 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/add_packages.py
+-rw-r--r--   0        0        0    75497 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/cli.py
+-rw-r--r--   0        0        0      146 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/cli_colors.py
+-rw-r--r--   0        0        0     9349 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/cli_status_printer.py
+-rw-r--r--   0        0        0     7346 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/cli_validation.py
+-rw-r--r--   0        0        0     2757 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/dedupe_errors.py
+-rw-r--r--   0        0        0     2853 2023-05-31 20:23:35.849381 colrev-0.9.0/colrev/ui_cli/show_printer.py
+-rw-r--r--   0        0        0     2932 2023-05-31 20:23:35.881381 colrev-0.9.0/pyproject.toml
+-rw-r--r--   0        0        0    11074 1970-01-01 00:00:00.000000 colrev-0.9.0/PKG-INFO
```

### Comparing `colrev-0.8.4/CHANGELOG.md` & `colrev-0.9.0/CHANGELOG.md`

 * *Files 14% similar despite different names*

```diff
@@ -11,22 +11,60 @@
 
 ### Changed
 
 ### Removed
 
 ### Fixed
 
+## 0.9.0 - 2023-06-01
+
+### Added
+
+- The `quality_model` was created to check for quality defects
+- The `auto_upgrade` flag allows users to enable/disable automated upgrades
+- All-contributors bot to acknowledge contributions to CoLRev
+- Implemented OpenLibrary as a SearchSource
+- Pylint check for direct assignment of colrev_status
+- Test battery for built-in SearchSources (heuristics, load, prep)
+- Backward-search comparison with OpenCitations data
+
+### Changed
+
+- Refactored `language_service`
+- Refactored the tests (`conftest.py` now provides the `base_repo_review_manager` fixture)
+- Changed pdf-hash (pdf to image) from poppler to mupdf for cross-platform compatibility (`cpid1` -> `cpid2`)
+- Local settings changed from yaml to json
+- Quality defects (colrev_masterdata_provenance notes) change
+- The `colrev.global_ids_consistency_check` prep-endpoint is removed (integrated into the quality model)
+- Individual quality checks can be disabled through the `prep/defects_to_ignore` settings
+- Update the Github action workflows in CoLRev repositories
+
+### Removed
+
+- `timeout-decorator` dependency (for better compatibility with MacOS)
+- Docker image `pdf-hash-service` (replaced by mupdf)
+- Redundant fields for the backward search are removed (`cited_by_file` and `cited_by_id`)
+
+### Fixed
+
+- Documentation: typos and inconsistencies
+- Codacy issues and refactored complex files [1](https://app.codacy.com/gh/CoLRev-Environment/colrev/dashboard)
+- Windows paths in `iter_commit` (git history)
+
 ## 0.8.4 - 2023-05-19
 
 ### Changed
 
 - Implemented new quality model
 - Quality defects (colrev_masterdata_provenance notes) change
 - The `colrev.global_ids_consistency_check` prep-endpoint is removed (integrated into the quality model)
 - Individual quality checks can be disabled through the `prep/defects_to_ignore` settings
+
+### Removed
+
 - Redundant fields for the backward search are removed (`cited_by_file` and `cited_by_id`)
 
 ## 0.8.3 - 2023-04-22
 
 ### Changed
 
 - CoLRev pdf IDs are now based on the mupdf library
```

### Comparing `colrev-0.8.4/CONTRIBUTING.md` & `colrev-0.9.0/CONTRIBUTING.md`

 * *Files 8% similar despite different names*

```diff
@@ -102,14 +102,22 @@
 
 ### If you get invalid cross-device link error
 
 It is because the `/tmp` folder is not in same drive as your home drive. Use `pytest --basetemp=<a_path_inside_your_home_folder>`
 
 Beware, everything inside the folder will be deleted, so make sure you use the folder only for test.
 
+### Iterative testing
+
+To test and develop code, it may be helpful to use an example dataset (CoLRev repository) with chained commands, which automatically reset to the previous version and repeat the operation. For example, such a command could look like this:
+
+```
+git reset --hard faaf5d7f5e6 && colrev prep && gitk
+```
+
 ## Pull Request Guidelines
 
 Before you submit a pull request, check that it meets these guidelines:
 
 1. The pull request should include tests.
 2. If the pull request adds functionality, the docs should be updated. Put
    your new functionality into a function with a docstring, and add the
```

### Comparing `colrev-0.8.4/LICENSE` & `colrev-0.9.0/LICENSE`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/README.md` & `colrev-0.9.0/README.md`

 * *Files 10% similar despite different names*

```diff
@@ -16,15 +16,17 @@
 [![pre-commit.ci status](https://results.pre-commit.ci/badge/github/CoLRev-Ecosystem/colrev/main.svg)](https://results.pre-commit.ci/latest/github/CoLRev-Ecosystem/colrev/main)
 ![Coverage](https://raw.githubusercontent.com/CoLRev-Ecosystem/colrev/main/tests/coverage.svg)
 [![Codacy Badge](https://app.codacy.com/project/badge/Grade/bd4e44c6cda646e4b9e494c4c4d9487b)](https://app.codacy.com/gh/CoLRev-Environment/colrev/dashboard?utm_source=gh&utm_medium=referral&utm_content=&utm_campaign=Badge_grade)
 ![GitHub last commit](https://img.shields.io/github/last-commit/CoLRev-Ecosystem/colrev)
 [![Downloads](https://static.pepy.tech/badge/colrev/month)](https://pepy.tech/project/colrev)
 [![OpenSSF Best Practices](https://bestpractices.coreinfrastructure.org/projects/7148/badge)](https://bestpractices.coreinfrastructure.org/projects/7148)
 [![SWH](https://archive.softwareheritage.org/badge/origin/https://github.com/CoLRev-Environment/colrev/)](https://archive.softwareheritage.org/browse/origin/?origin_url=https://github.com/CoLRev-Environment/colrev/)<!-- ALL-CONTRIBUTORS-BADGE:START - Do not remove or modify this section -->
-[![All Contributors](https://img.shields.io/badge/all_contributors-3-orange.svg?style=flat-square)](#contributors-)
+[![All Contributors](https://img.shields.io/badge/all_contributors-4-orange.svg?style=flat-square)](#contributors-)
+[![Average time to resolve an issue](http://isitmaintained.com/badge/resolution/CoLRev-Environment/colrev.svg)](https://isitmaintained.com/project/CoLRev-Environment/colrev)
+[![Percentage of issues still open](http://isitmaintained.com/badge/open/CoLRev-Environment/colrev.svg)](https://isitmaintained.com/project/CoLRev-Environment/colrev)
 <!-- ALL-CONTRIBUTORS-BADGE:END -->
 <!-- ![PyPI](https://img.shields.io/pypi/v/colrev) -->
 <!-- [![](https://img.shields.io/badge/-documentation-green)](https://colrev.readthedocs.io/) -->
 
 </div>
 
 ## Summary
@@ -59,14 +61,15 @@
 <!-- markdownlint-disable -->
 <table>
   <tbody>
     <tr>
       <td align="center" valign="top" width="14.28%"><a href="https://github.com/geritwagner"><img src="https://avatars.githubusercontent.com/u/3872815?v=4?s=100" width="100px;" alt="Gerit Wagner"/><br /><sub><b>Gerit Wagner</b></sub></a><br /><a href="https://github.com/CoLRev-Environment/colrev/commits?author=geritwagner" title="Code"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=geritwagner" title="Documentation"></a> <a href="#data-geritwagner" title="Data"></a> <a href="#content-geritwagner" title="Content"></a> <a href="#example-geritwagner" title="Examples"></a></td>
       <td align="center" valign="top" width="14.28%"><a href="https://julianprester.com"><img src="https://avatars.githubusercontent.com/u/4706870?v=4?s=100" width="100px;" alt="Julian Prester"/><br /><sub><b>Julian Prester</b></sub></a><br /><a href="https://github.com/CoLRev-Environment/colrev/commits?author=julianprester" title="Code"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=julianprester" title="Documentation"></a> <a href="#data-julianprester" title="Data"></a> <a href="#content-julianprester" title="Content"></a> <a href="https://github.com/CoLRev-Environment/colrev/issues?q=author%3Ajulianprester" title="Bug reports"></a> <a href="#ideas-julianprester" title="Ideas, Planning, & Feedback"></a></td>
       <td align="center" valign="top" width="14.28%"><a href="https://github.com/tmahmood"><img src="https://avatars.githubusercontent.com/u/34904?v=4?s=100" width="100px;" alt="Tarin Mahmood"/><br /><sub><b>Tarin Mahmood</b></sub></a><br /><a href="https://github.com/CoLRev-Environment/colrev/commits?author=tmahmood" title="Code"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=tmahmood" title="Tests"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=tmahmood" title="Documentation"></a></td>
+      <td align="center" valign="top" width="14.28%"><a href="https://github.com/dengdenglele"><img src="https://avatars.githubusercontent.com/u/28404427?v=4?s=100" width="100px;" alt="dengdenglele"/><br /><sub><b>dengdenglele</b></sub></a><br /><a href="#data-dengdenglele" title="Data"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=dengdenglele" title="Documentation"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=dengdenglele" title="Tests"></a></td>
     </tr>
   </tbody>
 </table>
 
 <!-- markdownlint-restore -->
 <!-- prettier-ignore-end -->
```

### Comparing `colrev-0.8.4/colrev/advisor.py` & `colrev-0.9.0/colrev/advisor.py`

 * *Files 0% similar despite different names*

```diff
@@ -764,11 +764,7 @@
         msgs = "\n ".join(
             [
                 x["level"] + x["title"] + x.get("msg", "")
                 for x in collaboration_instructions["items"]
             ]
         )
         return {"msg": msgs, "status": status_code}
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/checker.py` & `colrev-0.9.0/colrev/checker.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,28 +4,25 @@
 
 import os
 import re
 import sys
 import typing
 from importlib.metadata import version
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import yaml
 from git.exc import InvalidGitRepositoryError
 
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 from colrev.exit_codes import ExitCodes
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 class Checker:
     """The CoLRev checker makes sure the project setup is ok"""
 
     records: typing.Dict[str, typing.Any] = {}
 
@@ -762,11 +759,7 @@
         failure_items = []
         failure_items.extend(self.check_repo_extended())
         failure_items.extend(self.check_repo_basics())
 
         if failure_items:
             return {"status": ExitCodes.FAIL, "msg": "  " + "\n  ".join(failure_items)}
         return {"status": ExitCodes.SUCCESS, "msg": "Everything ok."}
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/dataset.py` & `colrev-0.9.0/colrev/dataset.py`

 * *Files 1% similar despite different names*

```diff
@@ -8,14 +8,15 @@
 import re
 import string
 import time
 import typing
 from copy import deepcopy
 from pathlib import Path
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import git
 import pybtex.errors
 from git.exc import GitCommandError
 from git.exc import InvalidGitRepositoryError
 from pybtex.database import Person
 from pybtex.database.input import bibtex
@@ -24,19 +25,16 @@
 import colrev.env.language_service
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 import colrev.record
 import colrev.settings
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 # pylint: disable=too-many-public-methods
 # pylint: disable=too-many-lines
 
 
 class Dataset:
     """The CoLRev dataset (records and their history in git)"""
@@ -186,15 +184,15 @@
 
     def get_changed_records(self, *, target_commit: str) -> typing.List[dict]:
         """Get the records that changed in a selected commit"""
 
         revlist = (
             (
                 commit.hexsha,
-                (commit.tree / str(self.RECORDS_FILE_RELATIVE)).data_stream.read(),
+                (commit.tree / "data" / "records.bib").data_stream.read(),
             )
             for commit in self.__git_repo.iter_commits(
                 paths=str(self.RECORDS_FILE_RELATIVE)
             )
         )
         found = False
         records_dict, prior_records_dict = {}, {}
@@ -990,15 +988,15 @@
 
         return self.__git_repo.untracked_files
 
     def __get_last_records_filecontents(self) -> bytes:
         revlist = (
             (
                 commit.hexsha,
-                (commit.tree / str(self.RECORDS_FILE_RELATIVE)).data_stream.read(),
+                (commit.tree / "data" / "records.bib").data_stream.read(),
             )
             for commit in self.__git_repo.iter_commits(
                 paths=str(self.RECORDS_FILE_RELATIVE)
             )
         )
         filecontents = list(revlist)[0][1]
         return filecontents
@@ -1140,11 +1138,7 @@
     def get_remote_url(self) -> str:  # pragma: no cover
         """Get the remote url"""
         remote_url = "NA"
         for remote in self.__git_repo.remotes:
             if remote.name == "origin":
                 remote_url = remote.url
         return remote_url
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/environment_manager.py` & `colrev-0.9.0/colrev/env/environment_manager.py`

 * *Files 7% similar despite different names*

```diff
@@ -15,14 +15,17 @@
 from git.exc import InvalidGitRepositoryError
 from yaml import safe_load
 
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
+from colrev.env.utils import dict_keys_exists
+from colrev.env.utils import dict_set_nested
+from colrev.env.utils import get_by_path
 
 
 class EnvironmentManager:
     """The EnvironmentManager manages environment resources and services"""
 
     colrev_path = Path.home().joinpath("colrev")
     cache_path = colrev_path / Path("prep_requests_cache")
@@ -363,10 +366,25 @@
                             f"{repo_source_path} : {','.join(list(set(outlets)))}"
                         )
             except FileNotFoundError as exc:
                 print(exc)
 
         return curated_outlets
 
-
-if __name__ == "__main__":
-    pass
+    def get_settings_by_key(self, key: str) -> str | None:
+        """Loads setting by the given key"""
+        environment_registry = self.load_environment_registry()
+        keys = key.split(".")
+        if dict_keys_exists(environment_registry, *keys):
+            return get_by_path(environment_registry, keys)
+        return None
+
+    def update_registry(self, key: str, value: str) -> None:
+        """updates given key in the registry with new value"""
+
+        keys = key.split(".")
+        # We don't want to allow user to replace any core settings, so check for packages key
+        if keys[0] != "packages":
+            raise colrev_exceptions.PackageSettingMustStartWithPackagesException(key)
+        self.environment_registry = self.load_environment_registry()
+        dict_set_nested(self.environment_registry, keys, value)
+        self.save_environment_registry(updated_registry=self.environment_registry)
```

### Comparing `colrev-0.8.4/colrev/env/grobid_service.py` & `colrev-0.9.0/colrev/env/grobid_service.py`

 * *Files 2% similar despite different names*

```diff
@@ -65,11 +65,7 @@
             tty=True,
             mem_limit="4g",
             ports={8070: 8070, 8071: 8071},
             detach=True,
         )
 
         self.check_grobid_availability()
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/language_service.py` & `colrev-0.9.0/colrev/env/language_service.py`

 * *Files 8% similar despite different names*

```diff
@@ -95,11 +95,7 @@
         if len(record.data["language"]) != 3:
             if record.data["language"].lower() in self.__lang_code_mapping:
                 record.data["language"] = self.__lang_code_mapping[
                     record.data["language"].lower()
                 ]
 
         self.validate_iso_639_3_language_codes(lang_code_list=[record.data["language"]])
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/local_index.py` & `colrev-0.9.0/colrev/env/local_index.py`

 * *Files 0% similar despite different names*

```diff
@@ -1364,11 +1364,7 @@
         except (
             colrev_exceptions.RecordNotInIndexException,
             colrev_exceptions.NotEnoughDataToIdentifyException,
         ):
             pass
 
         return "unknown"
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/package_manager.py` & `colrev-0.9.0/colrev/env/package_manager.py`

 * *Files 1% similar despite different names*

```diff
@@ -783,26 +783,14 @@
         operation: colrev.operation.Operation,
         ignore_not_available: bool = False,
         instantiate_objects: bool = True,
         only_ci_supported: bool = False,
     ) -> typing.Dict[str, typing.Dict[str, typing.Any]]:
         """Load the packages for a particular package_type"""
 
-        # pylint: disable=import-outside-toplevel
-        # pylint: disable=unnecessary-dict-index-lookup
-        # pylint: disable=too-many-locals
-
-        # Note : when iterating over packages_dict.items(),
-        # changes to the values (or del k) would not persist
-
-        if package_type not in self.package_type_overview:
-            raise colrev_exceptions.MissingDependencyError(
-                f"package_type {package_type} not available"
-            )
-
         packages_dict = self.__get_packages_dict(
             selected_packages=selected_packages,
             package_type=package_type,
             ignore_not_available=ignore_not_available,
         )
 
         self.__drop_broken_packages(
@@ -845,16 +833,15 @@
                         )
                         to_remove.append(package_identifier)
                     else:
                         raise sna_exc
             else:
                 packages_dict[package_identifier] = package_class["endpoint"]
 
-        for i_to_remove in to_remove:
-            del packages_dict[i_to_remove]
+        packages_dict = {k: v for k, v in packages_dict.items() if k not in to_remove}
 
         return packages_dict
 
     def __add_package_endpoints(
         self,
         *,
         package_endpoints_json: dict,
@@ -1005,11 +992,7 @@
 
         json_object = json.dumps(package_status, indent=4)
         with open(
             Path("colrev/template/package_status.json"), "w", encoding="utf-8"
         ) as file:
             file.write(json_object)
             file.write("\n")  # to avoid pre-commit/eof-fix changes
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/resources.py` & `colrev-0.9.0/colrev/env/resources.py`

 * *Files 2% similar despite different names*

```diff
@@ -52,11 +52,7 @@
                     curated_resource=line.replace("colrev env --install ", "")
                 )
         else:
             print(
                 f"Error: repo does not contain a data/records.bib/linked repos {repo_dir}"
             )
         return True
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/screenshot_service.py` & `colrev-0.9.0/colrev/env/screenshot_service.py`

 * *Files 2% similar despite different names*

```diff
@@ -123,11 +123,7 @@
         else:
             print(
                 "URL screenshot retrieval error "
                 f"{ret.status_code}/{record.data['url']}"
             )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/tei_parser.py` & `colrev-0.9.0/colrev/env/tei_parser.py`

 * *Files 0% similar despite different names*

```diff
@@ -831,11 +831,7 @@
             # if settings file available: dedupe_io match agains records
 
         if self.tei_path:
             tree = etree.ElementTree.ElementTree(self.root)
             tree.write(str(self.tei_path))
 
         return self.root
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/env/utils.py` & `colrev-0.9.0/colrev/env/utils.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,13 +1,15 @@
 #!/usr/bin/env python3
 """Collection of utility functions"""
+import operator
 import pkgutil
 import typing
 import unicodedata
 from enum import Enum
+from functools import reduce
 from pathlib import Path
 
 from jinja2 import Environment
 from jinja2 import FunctionLoader
 from jinja2.environment import Template
 
 import colrev.exceptions as colrev_exceptions
@@ -135,9 +137,38 @@
     )
     if filedata:
         complementary_material_keywords = list(filedata.decode("utf-8").splitlines())
 
     return complementary_material_keywords
 
 
-if __name__ == "__main__":
-    pass
+def dict_keys_exists(element: dict, *keys: str) -> bool:
+    """Check if *keys (nested) exists in `element` (dict)."""
+    if len(keys) == 0:
+        raise AttributeError("keys_exists() expects at least two arguments, one given.")
+
+    _element = element
+    for key in keys:
+        try:
+            _element = _element[key]
+        except KeyError:
+            return False
+    return True
+
+
+def get_by_path(root: dict, items: typing.List[str]) -> typing.Any:
+    """Access a nested object in root by item sequence."""
+
+    return reduce(operator.getitem, items, root)
+
+
+def set_by_path(root: dict, items: typing.List[str], value: typing.Any) -> None:
+    """Set a value in a nested object in root by item sequence."""
+
+    get_by_path(root, items[:-1])[items[-1]] = value
+
+
+def dict_set_nested(root: dict, keys: typing.List[str], value: typing.Any) -> None:
+    """Set dict value by nested key, this works on empty dict"""
+    for key in keys[:-1]:
+        root = root.setdefault(key, {})
+    root[keys[-1]] = value
```

### Comparing `colrev-0.8.4/colrev/env/zotero_translation_service.py` & `colrev-0.9.0/colrev/env/zotero_translation_service.py`

 * *Files 2% similar despite different names*

```diff
@@ -74,11 +74,7 @@
                 dep="Zotero (Docker)", detailed_trace=""
             )
 
         except DockerException as exc:
             raise colrev_exceptions.ServiceNotAvailableException(
                 dep="Zotero (Docker)", detailed_trace=exc
             ) from exc
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/exceptions.py` & `colrev-0.9.0/colrev/exceptions.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,21 +1,19 @@
 #! /usr/bin/env python
 """Exceptions of CoLRev."""
 from __future__ import annotations
 
 from pathlib import Path
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.record
+if TYPE_CHECKING:
+    import colrev.record
 
 
 class CoLRevException(Exception):
     """
     Base class for all exceptions raised by this package
     """
 
@@ -587,7 +585,25 @@
 
 class InvalidLanguageCodeException(CoLRevException):
     """Language code field does not comply with the required standard."""
 
     def __init__(self, invalid_language_codes: list) -> None:
         self.invalid_language_codes = invalid_language_codes
         super().__init__(f"Invalid language codes: {', '.join(invalid_language_codes)}")
+
+
+class InvalidRegistryKeyException(CoLRevException):
+    """Invalid registry key provided"""
+
+    def __init__(self, invalid_key: str) -> None:
+        self.invalid_key = invalid_key
+        super().__init__(f"Invalid Registry Key: {invalid_key}")
+
+
+class PackageSettingMustStartWithPackagesException(CoLRevException):
+    """package settings must start with `packages` key"""
+
+    def __init__(self, invalid_key: str) -> None:
+        self.invalid_key = invalid_key
+        super().__init__(
+            f"Package settings must start with `packages` key. {invalid_key}"
+        )
```

### Comparing `colrev-0.8.4/colrev/hooks/update.py` & `colrev-0.9.0/colrev/hooks/update.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/linter/colrev_lint.py` & `colrev-0.9.0/colrev/linter/colrev_lint.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,21 +1,20 @@
 #!/usr/bin/env python3
 """Linter for CoLRev"""
 from __future__ import annotations
 
+from typing import TYPE_CHECKING
+
 from astroid import nodes
 from pylint import checkers
 from pylint import interfaces
 from pylint.checkers.utils import only_required_for_messages
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        from pylint.lint import PyLinter
+if TYPE_CHECKING:
+    from pylint.lint import PyLinter
 
 
 class DirectStatusAssignmentChecker(checkers.BaseChecker):
     """DirectStatusAssignmentChecker"""
 
     __implements__ = interfaces.IAstroidChecker
```

### Comparing `colrev-0.8.4/colrev/logger.py` & `colrev-0.9.0/colrev/logger.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,20 +1,18 @@
 #! /usr/bin/env python
 """Loggers for CoLRev"""
 from __future__ import annotations
 
 import logging
+from typing import TYPE_CHECKING
 
 import colrev.exceptions as colrev_exceptions
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 def setup_logger(
     *, review_manager: colrev.review_manager.ReviewManager, level: int = logging.INFO
 ) -> logging.Logger:
     """Setup the CoLRev logger"""
 
@@ -92,11 +90,7 @@
     file_handler = logging.FileHandler(review_manager.report_path, mode="a")
     file_handler.setLevel(logging.INFO)
     formatter = logging.Formatter(
         fmt="%(asctime)s [%(levelname)s] %(message)s", datefmt="%Y-%m-%d %H:%M:%S"
     )
     file_handler.setFormatter(formatter)
     review_manager.report_logger.addHandler(file_handler)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/operation.py` & `colrev-0.9.0/colrev/operation.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 #!/usr/bin/env python3
 """Types and model of CoLRev operations."""
 from __future__ import annotations
 
 from enum import auto
 from enum import Enum
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import git
 
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 class OperationsType(Enum):
     """Operation types correspond to the main state transitions (see RecordStateModel)"""
 
     # pylint: disable=invalid-name
 
@@ -219,11 +217,7 @@
 
     def __init__(self, *, review_manager: colrev.review_manager.ReviewManager) -> None:
         super().__init__(
             review_manager=review_manager,
             operations_type=OperationsType.check,
             notify_state_transition_operation=False,
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/bibliography_export.py` & `colrev-0.9.0/colrev/ops/built_in/data/bibliography_export.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,29 +3,27 @@
 from __future__ import annotations
 
 import copy
 import json
 from dataclasses import dataclass
 from enum import Enum
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 @dataclass
 class BibFormats(Enum):
     """Enum of available bibliography formats"""
 
     # pylint: disable=invalid-name
@@ -259,11 +257,7 @@
 
         advice = {
             "msg": f"{data_endpoint}"
             + f"\n    - The references are updated automatically ({self.endpoint_path})",
             "detailed_msg": "TODO",
         }
         return advice
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/colrev_curation.md` & `colrev-0.9.0/colrev/ops/built_in/data/colrev_curation.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/colrev_curation.py` & `colrev-0.9.0/colrev/ops/built_in/data/colrev_curation.py`

 * *Files 0% similar despite different names*

```diff
@@ -3,30 +3,27 @@
 from __future__ import annotations
 
 import collections
 import os
 import typing
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 @zope.interface.implementer(colrev.env.package_manager.DataPackageEndpointInterface)
 @dataclass
 class ColrevCuration(JsonSchemaMixin):
     """CoLRev Curation"""
 
@@ -401,11 +398,7 @@
                 "msg": "Curation: masterdata_restrictions not set. See "
                 + "https://github.com/CoLRev-Environment/colrev/blob/main/"
                 + "colrev/ops/built_in/data/colrev_curation.md for details.",
                 "detailed_msg": "records missing language field: ",
             }
 
         return advice
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/github_pages.py` & `colrev-0.9.0/colrev/ops/built_in/data/github_pages.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,29 +1,26 @@
 #! /usr/bin/env python
 """Creation of a github-page for the review as part of the data operations"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import git
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 @zope.interface.implementer(colrev.env.package_manager.DataPackageEndpointInterface)
 @dataclass
 class GithubPages(JsonSchemaMixin):
     """Export the literature review into a Github Page"""
 
@@ -363,11 +360,7 @@
             )
         else:
             advice[
                 "msg"
             ] += "\n    - The page is updated automatically (gh-pages branch)"
 
         return advice
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/obsidian.py` & `colrev-0.9.0/colrev/ops/built_in/data/obsidian.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,28 +1,25 @@
 #! /usr/bin/env python
 """Creation of an Obsidian database as part of the data operations"""
 from __future__ import annotations
 
 from collections import Counter
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.record
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 @zope.interface.implementer(colrev.env.package_manager.DataPackageEndpointInterface)
 @dataclass
 class Obsidian(JsonSchemaMixin):
     """Export the sample into an Obsidian database"""
 
@@ -47,14 +44,17 @@
     OBSIDIAN_PATH_RELATIVE = Path("data/obsidian")
     OBSIDIAN_PAPER_PATH_RELATIVE = Path("data/obsidian/paper")
     OBSIDIAN_INBOX_PATH_RELATIVE = Path("data/obsidian/inbox.md")
     GITIGNORE_LIST = [
         "data/obsidian/.obsidian/core-plugins.json",
         "data/obsidian/.obsidian/workspace.json",
         "data/obsidian/.obsidian/core-plugins-migration.json",
+        "data/obsidian/.obsidian/app.json",
+        "data/obsidian/.obsidian/hotkeys.json",
+        "data/obsidian/.obsidian/appearance.json",
     ]
 
     def __init__(
         self,
         *,
         data_operation: colrev.ops.data.Data,
         settings: dict,
@@ -127,27 +127,28 @@
         if len(missing_records) == 0:
             if not silent_mode:
                 data_operation.review_manager.logger.info(
                     "All records included. Nothing to export."
                 )
             return
 
-        # inbox_text = ""
-        # if self.endpoint_inbox_path.is_file():
-        #     inbox_text = self.endpoint_inbox_path.read_text()
-
-        # if not self.endpoint_inbox_path.is_file():
-        #     with open(self.endpoint_inbox_path, "w", encoding="utf-8") as inbox_file:
-        #         inbox_file.write("Papers to synthesize:\n\n")
+        inbox_text = ""
+        if self.endpoint_inbox_path.is_file():
+            inbox_text = self.endpoint_inbox_path.read_text()
+        self.endpoint_inbox_path.parent.mkdir(exist_ok=True)
+        if not self.endpoint_inbox_path.is_file():
+            with open(self.endpoint_inbox_path, "w", encoding="utf-8") as inbox_file:
+                inbox_file.write("Papers to synthesize:\n\n")
 
         missing_record_entities = {}
-        # with open(self.endpoint_inbox_path, "a", encoding="utf-8") as inbox_file:
+        with open(self.endpoint_inbox_path, "a", encoding="utf-8") as inbox_file:
+            for missing_record in missing_records:
+                if missing_record not in inbox_text:
+                    inbox_file.write(f"- [[{missing_record}]]\n")
         for missing_record in missing_records:
-            # if missing_record not in inbox_text:
-            #     inbox_file.write(f"- [[{missing_record}]]\n")
             paper_summary_path = self.endpoint_paper_path / Path(f"{missing_record}.md")
 
             missing_record_entities[paper_summary_path] = {
                 "keywords": self.__get_keywords(record_dict=records[missing_record])
             }
 
         all_keywords = [x["keywords"] for x in missing_record_entities.values()]
@@ -180,30 +181,30 @@
                 "natural-experiment",
                 "simulation",
                 "structural-equation-modeling",
                 "longitudinal-study",
             ]
         ]
 
-        for (
-            paper_summary_path,
-            missing_record_entity,
-        ) in missing_record_entities.items():
-            if not paper_summary_path.is_file():
-                paper_summary_path.parent.mkdir(exist_ok=True, parents=True)
-                with open(paper_summary_path, "w", encoding="utf-8") as paper_summary:
-                    selected_keywords = [
-                        x
-                        for x in missing_record_entity["keywords"]
-                        if x in frequent_keywords and x not in ["highly_cited"]
-                    ]
-                    # paper_summary.write(f"#paper {' #'.join(selected_keywords)} #todo\n\n")
-                    paper_summary.write(f"#{' #'.join(selected_keywords)}\n\n")
-                    if "highly_cited" in missing_record_entity["keywords"]:
-                        paper_summary.write("highly_cited")
+        # for (
+        #     paper_summary_path,
+        #     missing_record_entity,
+        # ) in missing_record_entities.items():
+        #     if not paper_summary_path.is_file():
+        #         paper_summary_path.parent.mkdir(exist_ok=True, parents=True)
+        #         with open(paper_summary_path, "w", encoding="utf-8") as paper_summary:
+        #             selected_keywords = [
+        #                 x
+        #                 for x in missing_record_entity["keywords"]
+        #                 if x in frequent_keywords and x not in ["highly_cited"]
+        #             ]
+        #             # paper_summary.write(f"#paper {' #'.join(selected_keywords)} #todo\n\n")
+        #             paper_summary.write(f"#{' #'.join(selected_keywords)}\n\n")
+        #             if "highly_cited" in missing_record_entity["keywords"]:
+        #                 paper_summary.write("highly_cited")
 
         # later : export to csl-json (based on bibliography_export)
         # (absolute PDF paths, read-only/hidden/gitignored, no provenance fields)
 
         # data_operation.review_manager.dataset.add_changes(path=self.OBSIDIAN_INBOX_PATH_RELATIVE)
 
     def update_data(
@@ -250,11 +251,7 @@
 
         advice = {
             "msg": f"{data_endpoint}"
             + "\n    - New records are added to the obsidian vault (data/obsidian)",
             "detailed_msg": "TODO",
         }
         return advice
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/paper_md.py` & `colrev-0.9.0/colrev/ops/built_in/data/paper_md.py`

 * *Files 0% similar despite different names*

```diff
@@ -6,33 +6,30 @@
 import re
 import tempfile
 import typing
 from collections import Counter
 from dataclasses import dataclass
 from pathlib import Path
 from threading import Timer
+from typing import TYPE_CHECKING
 
 import docker
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from docker.errors import DockerException
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 @zope.interface.implementer(colrev.env.package_manager.DataPackageEndpointInterface)
 @dataclass
 class PaperMarkdown(JsonSchemaMixin):
     """Synthesize the literature in a markdown paper
 
@@ -116,15 +113,15 @@
         self.settings.paper_output = (
             data_operation.review_manager.output_dir / self.settings.paper_output
         )
 
         self.__create_non_sample_references_bib()
 
         if not data_operation.review_manager.in_ci_environment():
-            self.pandoc_image = "pandoc/latex:2.19.2"
+            self.pandoc_image = "pandoc/latex:3.1"
             data_operation.review_manager.environment_manager.build_docker_image(
                 imagename=self.pandoc_image
             )
 
         self.paper_relative_path = self.settings.paper_path.relative_to(
             data_operation.review_manager.path
         )
@@ -841,11 +838,7 @@
 
 class PaperMarkdownRecordSourceTagError(Exception):
     """NEW_RECORD_SOURCE_TAG not found in paper.md"""
 
     def __init__(self, msg: str) -> None:
         self.message = f" {msg}"
         super().__init__(self.message)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/prisma.py` & `colrev-0.9.0/colrev/ops/built_in/data/prisma.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,32 +3,29 @@
 from __future__ import annotations
 
 import os
 from dataclasses import dataclass
 from dataclasses import field
 from pathlib import Path
 from typing import List
+from typing import TYPE_CHECKING
 
 import docker
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from docker.errors import DockerException
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 @zope.interface.implementer(colrev.env.package_manager.DataPackageEndpointInterface)
 @dataclass
 class PRISMA(JsonSchemaMixin):
     """Create a PRISMA diagram"""
 
@@ -252,11 +249,7 @@
         advice = {
             "msg": f"{data_endpoint}"
             + "\n    - The PRISMA diagram is created automatically "
             + f"({path_str})",
             "detailed_msg": "TODO",
         }
         return advice
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/data/structured.py` & `colrev-0.9.0/colrev/ops/built_in/data/structured.py`

 * *Files 1% similar despite different names*

```diff
@@ -3,31 +3,29 @@
 from __future__ import annotations
 
 import csv
 import typing
 from dataclasses import asdict
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from git.exc import GitCommandError
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 # an option: https://pypi.org/project/csv-schema/
 @dataclass
 class Field(JsonSchemaMixin):
     """Field definition"""
 
@@ -321,11 +319,7 @@
                 "msg": f"{data_endpoint}"
                 + f"\n    - Complete the data extraction ({self.settings.data_path_relative})",
                 "detailed_msg": "TODO",
             }
         else:
             advice = {}
         return advice
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/dedupe/active_learning_dedup_io.py` & `colrev-0.9.0/colrev/ops/built_in/dedupe/active_learning_dedup_io.py`

 * *Files 0% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 import logging
 import os
 import sqlite3
 import statistics
 import typing
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import dedupe as dedupe_io
 import pandas as pd
 import psutil
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from dedupe._typing import RecordDictPair as TrainingExample
@@ -21,19 +22,16 @@
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.dedupe.utils
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.dedupe
+if TYPE_CHECKING:
+    import colrev.ops.dedupe
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=too-many-lines
 
 
 @zope.interface.implementer(colrev.env.package_manager.DedupePackageEndpointInterface)
 @dataclass
@@ -1132,11 +1130,7 @@
                 f"\n{colors.ORANGE}Same source merges to check:{colors.END}"
                 "\n- ".join(info["same_source_merges"]) + "\n"
             )
         else:
             dedupe_operation.review_manager.logger.info(
                 "\nNo same-origin merges detected."
             )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/dedupe/curation_dedupe.py` & `colrev-0.9.0/colrev/ops/built_in/dedupe/curation_dedupe.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,30 +1,28 @@
 #! /usr/bin/env python
 """Dedupe functionality dedicated to curated metadata repositories"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import numpy as np
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from thefuzz import fuzz
 from tqdm import tqdm
 
 import colrev.env.package_manager
 import colrev.ops.built_in.pdf_prep.metadata_validation
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.dedupe
+if TYPE_CHECKING:
+    import colrev.ops.dedupe
 
 # pylint: disable=too-many-arguments
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.DedupePackageEndpointInterface)
@@ -653,11 +651,7 @@
         )
 
         dedupe_operation.review_manager.dataset.add_record_changes()
 
         dedupe_operation.review_manager.create_commit(
             msg="Merge duplicate records",
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/dedupe/curation_missing_dedupe.py` & `colrev-0.9.0/colrev/ops/built_in/dedupe/curation_missing_dedupe.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,29 +1,27 @@
 #! /usr/bin/env python
 """Deduplication of remaining records in curated metadata repositories"""
 from __future__ import annotations
 
 import typing
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.dedupe
+if TYPE_CHECKING:
+    import colrev.ops.dedupe
 
 # pylint: disable=too-many-arguments
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.DedupePackageEndpointInterface)
@@ -364,11 +362,7 @@
             dedupe_operation.review_manager.dataset.add_record_changes()
 
             dedupe_operation.review_manager.create_commit(
                 msg="Add non-duplicate records",
             )
 
         self.__create_dedupe_source_stats(dedupe_operation=dedupe_operation)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/dedupe/simple_dedupe.py` & `colrev-0.9.0/colrev/ops/built_in/dedupe/simple_dedupe.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Simple dedupe functionality (based on similarity thresholds) for small samples"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.dedupe.utils
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.dedupe
+if TYPE_CHECKING:
+    import colrev.ops.dedupe
 
 # pylint: disable=too-many-arguments
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.DedupePackageEndpointInterface)
 @dataclass
@@ -368,11 +366,7 @@
 
         # add and commit
         dedupe_operation.review_manager.dataset.add_record_changes()
         dedupe_operation.review_manager.create_commit(
             msg="Manual labeling of remaining duplicate candidates",
             manual_author=False,
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/dedupe/utils.py` & `colrev-0.9.0/colrev/ops/built_in/dedupe/utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -60,11 +60,7 @@
                     valid_responses = {"y", "n", "u", "f"}
 
                 print(prompt)
                 user_input = input()
                 if user_input in valid_responses:
                     valid_response = True
     return user_input
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/load_conversion/bib_pybtex_loader.py` & `colrev-0.9.0/colrev/ops/built_in/load_conversion/bib_pybtex_loader.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,25 +3,23 @@
 from __future__ import annotations
 
 import os
 import re
 import typing
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.load
+if TYPE_CHECKING:
+    import colrev.ops.load
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=unused-argument
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.LoadConversionPackageEndpointInterface
@@ -145,11 +143,7 @@
         endpoint = endpoint_dict[source.endpoint]
 
         records = endpoint.load_fixes(  # type: ignore
             load_operation, source=source, records=records
         )
 
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/load_conversion/bibutils_loader.py` & `colrev-0.9.0/colrev/ops/built_in/load_conversion/bibutils_loader.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Load conversion of ris, end, enl, copac, isi, med based on bibutils"""
 from __future__ import annotations
 
 from dataclasses import asdict
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import docker
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from docker.errors import DockerException
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.load
+if TYPE_CHECKING:
+    import colrev.ops.load
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
@@ -128,11 +126,7 @@
         endpoint = endpoint_dict[source.endpoint]
 
         records = endpoint.load_fixes(  # type: ignore
             load_operation, source=source, records=records
         )
 
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/load_conversion/markdown_loader.py` & `colrev-0.9.0/colrev/ops/built_in/load_conversion/markdown_loader.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 #! /usr/bin/env python
 """Load conversion of reference sections (bibliographies) in md-documents based on GROBID"""
 from __future__ import annotations
 
 from dataclasses import asdict
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.load
+if TYPE_CHECKING:
+    import colrev.ops.load
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
@@ -87,11 +85,7 @@
         )
         endpoint = endpoint_dict[source.endpoint]
 
         records = endpoint.load_fixes(  # type: ignore
             load_operation, source=source, records=records
         )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/load_conversion/table_loader.py` & `colrev-0.9.0/colrev/ops/built_in/load_conversion/table_loader.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Load conversion of tables (xlsx, csv)"""
 from __future__ import annotations
 
 from dataclasses import asdict
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.load
+if TYPE_CHECKING:
+    import colrev.ops.load
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 class TableLoadUtility:
@@ -255,11 +253,7 @@
         )
         endpoint = endpoint_dict[source.endpoint]
 
         records = endpoint.load_fixes(  # type: ignore
             load_operation, source=source, records=records
         )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/load_conversion/zotero_loader.py` & `colrev-0.9.0/colrev/ops/built_in/load_conversion/zotero_loader.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,27 +1,25 @@
 #! /usr/bin/env python
 """Load conversion based on zotero importers (ris, rdf, json, mods, ...)"""
 from __future__ import annotations
 
 import json
 from dataclasses import asdict
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.load
+if TYPE_CHECKING:
+    import colrev.ops.load
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
@@ -97,11 +95,7 @@
         )
         endpoint = endpoint_dict[source.endpoint]
 
         records = endpoint.load_fixes(  # type: ignore
             load_operation, source=source, records=records
         )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_get/local_index_pdf_get.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_get/local_index_pdf_get.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,28 +1,27 @@
 #! /usr/bin/env python
 """Retrieval of PDFs from the LocalIndex"""
 from __future__ import annotations
 
 import shutil
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
 # pylint: disable=duplicate-code
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
 
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_get
+if TYPE_CHECKING:
+    import colrev.ops.pdf_get
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFGetPackageEndpointInterface)
 @dataclass
 class LocalIndexPDFGet(JsonSchemaMixin):
@@ -72,11 +71,7 @@
                 )
                 if tei_ext_path.is_file():
                     new_path = record.get_tei_filename()
                     new_path.resolve().parent.mkdir(exist_ok=True, parents=True)
                     shutil.copy(tei_ext_path, new_path)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_get/unpaywall.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_get/unpaywall.py`

 * *Files 8% similar despite different names*

```diff
@@ -13,41 +13,56 @@
 from pdfminer.high_level import extract_text
 from pdfminer.pdftypes import PDFException
 
 import colrev.env.package_manager
 import colrev.record
 
 # pylint: disable=duplicate-code
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_get
-
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFGetPackageEndpointInterface)
 @dataclass
 class Unpaywall(JsonSchemaMixin):
     """Get PDFs from unpaywall.org"""
 
     settings_class = colrev.env.package_manager.DefaultSettings
     ci_supported: bool = False
 
+    SETTINGS = {
+        "email": "packages.pdf_get.colrev.unpaywall.email",
+    }
+
     def __init__(
         self,
         *,
         pdf_get_operation: colrev.ops.pdf_get.PDFGet,
         settings: dict,
     ) -> None:
         self.settings = self.settings_class.load_settings(data=settings)
+        self.review_manager = pdf_get_operation.review_manager
+
+        self.email = self.get_email()
 
-        _, self.email = pdf_get_operation.review_manager.get_committer()
+    def get_email(self) -> str:
+        """Get user's name and email,
+
+        if user have specified an email in registry, that will be returned
+        otherwise it will return the email used in git
+        """
+
+        env_mail = self.review_manager.environment_manager.get_settings_by_key(
+            self.SETTINGS["email"]
+        )
+        (
+            _,
+            email,
+        ) = self.review_manager.environment_manager.get_name_mail_from_git()
+        email = env_mail or email
+        return email
 
     def __unpaywall(
         self,
         *,
         review_manager: colrev.review_manager.ReviewManager,
         doi: str,
         retry: int = 0,
@@ -147,11 +162,7 @@
         except (
             requests.exceptions.ConnectionError,
             requests.exceptions.Timeout,
         ):
             pass
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_get/website_screenshot.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_get/website_screenshot.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,26 +1,25 @@
 #! /usr/bin/env python
 """Creation of screenshots (PDFs) for online ENTRYTYPES"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.record
 
 # pylint: disable=duplicate-code
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
 
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_get
+if TYPE_CHECKING:
+    import colrev.ops.pdf_get
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFGetPackageEndpointInterface)
 @dataclass
 class WebsiteScreenshot(JsonSchemaMixin):
@@ -55,11 +54,7 @@
             record=record, pdf_filepath=pdf_filepath
         )
 
         if "file" in record.data:
             pdf_get_operation.import_file(record=record)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,27 +1,25 @@
 #! /usr/bin/env python
 """CLI interface for manual retrieval of PDFs"""
 from __future__ import annotations
 
 import urllib.parse
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.pdf_get
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_get_man
+if TYPE_CHECKING:
+    import colrev.ops.pdf_get_man
 
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=unused-argument
 
 
 @zope.interface.implementer(
@@ -310,11 +308,7 @@
             pdf_get_man_operation.review_manager.logger.info(
                 "Retrieve PDFs manually and copy the files to "
                 f"the {pdf_dir}. Afterwards, use "
                 "colrev pdf-get-man"
             )
 
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_prep/check_ocr.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_prep/check_ocr.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,29 +1,27 @@
 #! /usr/bin/env python
 """OCR as a PDF preparation operation"""
 from __future__ import annotations
 
 import os
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import docker
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.language_service
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFPrepPackageEndpointInterface)
 @dataclass
@@ -124,11 +122,7 @@
             )
             pdf_prep_operation.review_manager.report_logger.error(msg)
             record.add_data_provenance_note(key="file", note="pdf_language_not_english")
             record.data.update(
                 colrev_status=colrev.record.RecordState.pdf_needs_manual_preparation
             )
         return record.data
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_prep/completeness_validation.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_prep/completeness_validation.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Completeness validation as a PDF preparation operation"""
 from __future__ import annotations
 
 import re
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFPrepPackageEndpointInterface)
 @dataclass
@@ -189,11 +187,7 @@
                     key="file", note="nr_pages_not_matching"
                 )
                 record.data.update(
                     colrev_status=colrev.record.RecordState.pdf_needs_manual_preparation
                 )
 
         return record.data
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_prep/cover_page.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_prep/cover_page.py`

 * *Files 5% similar despite different names*

```diff
@@ -2,32 +2,29 @@
 """Cover-page removal as a PDF preparation operation"""
 from __future__ import annotations
 
 import shutil
 import typing
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from PyPDF2 import PdfFileReader
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.qm.colrev_pdf_id
 import colrev.record
 
 # pylint: disable=duplicate-code
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFPrepPackageEndpointInterface)
 @dataclass
 class PDFCoverPage(JsonSchemaMixin):
@@ -201,11 +198,7 @@
                 project_path=pdf_prep_operation.review_manager.path,
                 save_to_path=cp_path,
             )
             pdf_prep_operation.review_manager.report_logger.info(
                 f'removed cover page for ({record.data["ID"]})'
             )
         return record.data
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_prep/last_page.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_prep/last_page.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,30 +2,28 @@
 """Last-page removal as a PDF preparation operation"""
 from __future__ import annotations
 
 import shutil
 import typing
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from PyPDF2 import PdfFileReader
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.record
 
 # pylint: disable=duplicate-code
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFPrepPackageEndpointInterface)
 @dataclass
 class PDFLastPage(JsonSchemaMixin):
@@ -133,11 +131,7 @@
                 project_path=pdf_prep_operation.review_manager.path,
                 save_to_path=lp_path,
             )
             pdf_prep_operation.review_manager.report_logger.info(
                 f'removed last page for ({record.data["ID"]})'
             )
         return record.data
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_prep/metadata_validation.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_prep/metadata_validation.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Metadata validation as a PDF preparation operation"""
 from __future__ import annotations
 
 import re
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFPrepPackageEndpointInterface)
 @dataclass
@@ -168,11 +166,7 @@
             notes = ",".join(validation_info["pdf_prep_hints"])
             record.add_data_provenance_note(key="file", note=notes)
             record.data.update(
                 colrev_status=colrev.record.RecordState.pdf_needs_manual_preparation
             )
 
         return record.data
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_prep/tei_prep.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_prep/tei_prep.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Creation of TEI as a PDF preparation operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFPrepPackageEndpointInterface)
 @dataclass
 class TEIPDFPrep(JsonSchemaMixin):
@@ -60,11 +58,7 @@
             )
             _ = pdf_prep_operation.review_manager.get_tei(
                 pdf_path=Path(record.data["file"]),
                 tei_path=record.get_tei_filename(),
             )
 
         return record.data
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py` & `colrev-0.9.0/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py`

 * *Files 4% similar despite different names*

```diff
@@ -4,28 +4,26 @@
 
 import os
 import platform
 import re
 import webbrowser
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep_man
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep_man
 
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.PDFPrepManPackageEndpointInterface
@@ -282,11 +280,7 @@
             )
 
         return records
 
 
 class QuitPressedException(Exception):
     """Quit-pressed exception"""
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/bibtex_crossref_resolution.py` & `colrev-0.9.0/colrev/ops/built_in/prep/bibtex_crossref_resolution.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,29 +1,27 @@
 #! /usr/bin/env python
 """Resolution of BibTeX crossref fields as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
 # pylint: disable=too-few-public-methods
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
-        import colrev.env.local_index
+if TYPE_CHECKING:
+    import colrev.ops.prep
+    import colrev.env.local_index
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class BibTexCrossrefResolutionPrep(JsonSchemaMixin):
     """Prepares records by resolving BibTex crossref links (e.g., to proceedings)"""
 
@@ -77,11 +75,7 @@
                     value=value,
                     source="crossref_resolution",
                     append_edit=False,
                 )
         del record.data["crossref"]
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/citeas_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/citeas_prep.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on CiteAs API as a prep operation"""
 from __future__ import annotations
 
 import json
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -119,11 +117,7 @@
             pass
         except UnicodeEncodeError:
             prep_operation.review_manager.logger.error(
                 "UnicodeEncodeError - this needs to be fixed at some time"
             )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/crossref_metadata_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/crossref_metadata_prep.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on Crossref API as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.search_sources.crossref as crossref_connector
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -74,11 +72,7 @@
             # Already linked to a crossref record
             return record
 
         self.crossref_source.get_masterdata(
             prep_operation=prep_operation, record=record
         )
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/curation_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/curation_prep.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 #! /usr/bin/env python
 """Preparation of curations"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -69,11 +67,7 @@
             return record
 
         colrev.record.Record(data=record.data).update_masterdata_provenance(
             qm=self.quality_model
         )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/dblp_metadata_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/dblp_metadata_prep.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on DBLP API as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.search_sources.dblp as dblp_connector
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -71,11 +69,7 @@
         ):
             # Already linked to a dblp record
             return record
 
         self.dblp_source.get_masterdata(prep_operation=prep_operation, record=record)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/doi_from_urls_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/doi_from_urls_prep.py`

 * *Files 3% similar despite different names*

```diff
@@ -2,30 +2,28 @@
 """Retrieving DOIs from a papers website/url as a prep operation"""
 from __future__ import annotations
 
 import collections
 import re
 from dataclasses import dataclass
 from sqlite3 import OperationalError
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.search_sources.doi_org as doi_connector
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -115,11 +113,7 @@
         except (
             requests.exceptions.RequestException,
             colrev_exceptions.InvalidMerge,
             colrev_exceptions.RecordNotParsableException,
         ):
             pass
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/doi_metadata_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/doi_metadata_prep.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on DOI metadata as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.search_sources.doi_org as doi_connector
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -58,11 +56,7 @@
             timeout=prep_operation.timeout,
         )
         doi_connector.DOIConnector.get_link_from_doi(
             record=record,
             review_manager=prep_operation.review_manager,
         )
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/europe_pmc_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/europe_pmc_prep.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on Europe PMC API as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.search_sources.europe_pmc as europe_pmc_connector
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -50,11 +48,7 @@
         EuropePMCSearchSource = europe_pmc_connector.EuropePMCSearchSource(
             source_operation=prep_operation
         )
         EuropePMCSearchSource.get_masterdata(
             prep_operation=prep_operation, record=record
         )
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/exclude_collections.py` & `colrev-0.9.0/colrev/ops/built_in/prep/exclude_collections.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,26 +1,25 @@
 #! /usr/bin/env python
 """Exclude collections as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
 
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class ExcludeCollectionsPrep(JsonSchemaMixin):
@@ -47,11 +46,7 @@
     ) -> colrev.record.Record:
         """Prepare records by excluding collections (proceedings)"""
 
         if record.data["ENTRYTYPE"].lower() == "proceedings":
             record.prescreen_exclude(reason="collection/proceedings")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/exclude_complementary_materials.py` & `colrev-0.9.0/colrev/ops/built_in/prep/exclude_complementary_materials.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,27 +1,26 @@
 #! /usr/bin/env python
 """Exclude complementary materials as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from alphabet_detector import AlphabetDetector
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
 
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class ExcludeComplementaryMaterialsPrep(JsonSchemaMixin):
@@ -65,11 +64,7 @@
         ) or any(
             complementary_materials_string == record.data.get("title", "").lower()
             for complementary_materials_string in self.complementary_materials_strings
         ):
             record.prescreen_exclude(reason="complementary material")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/exclude_languages.py` & `colrev-0.9.0/colrev/ops/built_in/prep/exclude_languages.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Exclude records based on language as a prep operation"""
 from __future__ import annotations
 
 import re
 import statistics
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.language_service
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class ExcludeLanguagesPrep(JsonSchemaMixin):
@@ -149,11 +147,7 @@
 
         if record.data.get("language", "") not in self.languages_to_include:
             record.prescreen_exclude(
                 reason=f"language of title not in [{','.join(self.languages_to_include)}]"
             )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py` & `colrev-0.9.0/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,27 +1,26 @@
 #! /usr/bin/env python
 """Exclude records with non-latin alphabets as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from alphabet_detector import AlphabetDetector
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
 
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class ExcludeNonLatinAlphabetsPrep(JsonSchemaMixin):
@@ -70,11 +69,7 @@
                 record.data.get("booktitle", ""),
             ]
         )
         if mostly_latin_alphabet(str_to_check):
             record.prescreen_exclude(reason="non_latin_alphabet")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/general_polish.py` & `colrev-0.9.0/colrev/ops/built_in/prep/general_polish.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,27 +1,25 @@
 #! /usr/bin/env python
 """Genral polishing rules"""
 from __future__ import annotations
 
 import re
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
-        import colrev.env.local_index
+if TYPE_CHECKING:
+    import colrev.ops.prep
+    import colrev.env.local_index
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -78,11 +76,7 @@
             ]
             for acronym in acronyms:
                 record.data["title"] = re.sub(
                     acronym, acronym, record.data["title"], flags=re.I
                 )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/local_index_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/local_index_prep.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,29 +1,26 @@
 #! /usr/bin/env python
 """Conslidation of metadata based on LocalIndex as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.search_sources.local_index as local_index_connector
 import colrev.ops.search_sources
 import colrev.record
 
-
 # pylint: disable=duplicate-code
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class LocalIndexPrep(JsonSchemaMixin):
@@ -67,11 +64,7 @@
                     )
 
         self.local_index_source.get_masterdata(
             prep_operation=prep_operation, record=record
         )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/open_library_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/open_library_prep.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on OpenLibrary API as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.search_sources.open_library as open_library_connector
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -61,11 +59,7 @@
             return record
 
         self.open_library_connector.get_masterdata(
             prep_operation=prep_operation, record=record
         )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/pubmed_metadata_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/pubmed_metadata_prep.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on the Pubmed API as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.search_sources.pubmed as pubmed_connector
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -70,11 +68,7 @@
             for o in record.data["colrev_origin"]
         ):
             # Already linked to a pubmed record
             return record
 
         self.pubmed_source.get_masterdata(prep_operation=prep_operation, record=record)
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/remove_broken_ids.py` & `colrev-0.9.0/colrev/ops/built_in/prep/remove_broken_ids.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 #! /usr/bin/env python
 """Removal of broken IDs as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -60,11 +58,7 @@
             if "isbn" in record.data.get("colrev_masterdata_provenance", {}):
                 if "isbn-not-matching-pattern" in record.data[
                     "colrev_masterdata_provenance"
                 ]["isbn"]["note"].split(","):
                     record.remove_field(key="isbn")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/remove_error500_urls.py` & `colrev-0.9.0/colrev/ops/built_in/prep/remove_error500_urls.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 #! /usr/bin/env python
 """Removal of broken URLs (error 500) a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -70,11 +68,7 @@
                 )
                 if ret.status_code >= 500:
                     record.remove_field(key="fulltext")
         except requests.exceptions.RequestException:
             pass
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/semantic_scholar_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/semantic_scholar_prep.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Consolidation of metadata based on SemanticScholar API as a prep operation"""
 from __future__ import annotations
 
 import json
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.search_sources
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
@@ -184,11 +182,7 @@
 
         except (
             requests.exceptions.RequestException,
             colrev_exceptions.InvalidMerge,
         ):
             pass
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/source_specific_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/source_specific_prep.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,27 +1,26 @@
 #! /usr/bin/env python
 """Source-specific preparation as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
 
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class SourceSpecificPrep(JsonSchemaMixin):
@@ -84,11 +83,7 @@
             "misc" == record.data["ENTRYTYPE"].lower() and "url" in record.data
         ):
             record.update_field(
                 key="ENTRYTYPE", value="online", source="source_specific_prep"
             )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/update_masterdata_status.py` & `colrev-0.9.0/colrev/ops/built_in/prep/update_masterdata_status.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,27 +1,25 @@
 #! /usr/bin/env python
 """Updating of the metadata status as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class UpdateMetadataStatusPrep(JsonSchemaMixin):
@@ -46,11 +44,7 @@
         prep_operation: colrev.ops.prep.Prep,  # pylint: disable=unused-argument
         record: colrev.record.PrepRecord,
     ) -> colrev.record.Record:
         """Prepare the record by updating its metadata status"""
 
         record.update_metadata_status()
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep/year_vol_iss_prep.py` & `colrev-0.9.0/colrev/ops/built_in/prep/year_vol_iss_prep.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,29 +1,28 @@
 #! /usr/bin/env python
 """Completion of metadata based on year-volume-issue dependency as a prep operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.search_sources.crossref as crossref_connector
 import colrev.ops.search_sources
 import colrev.record
 
 # pylint: disable=duplicate-code
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
 
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 @dataclass
 class YearVolIssPrep(JsonSchemaMixin):
@@ -206,11 +205,7 @@
 
         if "year" in record.data:
             return record
 
         self.__get_year_from_crossref(record=record, prep_operation=prep_operation)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py` & `colrev-0.9.0/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,27 +1,24 @@
 #! /usr/bin/env python
 """Jupyter notebook for prep-man operation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.record
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep_man
+if TYPE_CHECKING:
+    import colrev.ops.prep_man
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepManPackageEndpointInterface)
 @dataclass
 class CurationJupyterNotebookManPrep(JsonSchemaMixin):
@@ -55,11 +52,7 @@
 
         input(
             "Navigate to the jupyter notebook available at\n"
             "prep_man/prep_man_curation.ipynb\n"
             "Press Enter to continue."
         )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prep_man/prep_man_export.py` & `colrev-0.9.0/colrev/ops/built_in/prep_man/prep_man_export.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 #! /usr/bin/env python
 """Export of bib/pdfs as a prep-man operation"""
 from __future__ import annotations
 
 import typing
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from PyPDF2 import PdfFileReader
 from PyPDF2 import PdfFileWriter
 
@@ -16,19 +17,16 @@
 import colrev.env.utils
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
 # pylint: disable=duplicate-code
 # pylint: disable=too-few-public-methods
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep_man
+if TYPE_CHECKING:
+    import colrev.ops.prep_man
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepManPackageEndpointInterface)
 @dataclass
 class ExportManPrep(JsonSchemaMixin):
     """Manual preparation based on exported and imported metadata (and PDFs if any)"""
 
@@ -161,44 +159,14 @@
                     man_prep_info.append(
                         {"ID": record["ID"], "field": field, "note": value["note"]}
                     )
 
         man_prep_info_df = pd.DataFrame(man_prep_info)
         man_prep_info_df.to_csv(self.prep_man_csv_path, index=False)
 
-    def __update_provenance(
-        self, *, record: colrev.record.Record, records: dict
-    ) -> None:
-        record_id = record.data["ID"]
-        for k in list(record.data.keys()):
-            if k in [
-                "colrev_status",
-                "colrev_masterdata_provenance",
-                "colrev_data_provenance",
-                "colrev_id",
-            ]:
-                continue
-            if k in records[record_id]:
-                if record.data[k] != records[record_id][k]:
-                    if k in record.data.get("colrev_masterdata_provenance", {}):
-                        record.add_masterdata_provenance(key=k, source="man_prep")
-                    else:
-                        record.add_data_provenance(key=k, source="man_prep")
-            else:
-                if k in records[record_id]:
-                    del records[record_id][k]
-                if k in record.data.get("colrev_masterdata_provenance", {}):
-                    record.add_masterdata_provenance(
-                        key=k, source="man_prep", note="not-missing"
-                    )
-                else:
-                    record.add_data_provenance(
-                        key=k, source="man_prep", note="not-missing"
-                    )
-
     def __drop_unnecessary_provenance_fiels(
         self, *, record: colrev.record.Record
     ) -> None:
         colrev_data_provenance_keys_to_drop = []
         for key, items in record.data.get("colrev_data_provenance", {}).items():
             if key not in record.data and "not-missing" not in items["note"]:
                 colrev_data_provenance_keys_to_drop.append(key)
@@ -214,48 +182,53 @@
         for (
             colrev_masterdata_provenance_key_to_drop
         ) in colrev_masterdata_provenance_keys_to_drop:
             del record.data["colrev_masterdata_provenance"][
                 colrev_masterdata_provenance_key_to_drop
             ]
 
-    def __import_record(
-        self, *, record_dict: dict, records: dict, imported_records: list
+    def __update_original_record_based_on_man_prepped(
+        self, *, original_record: colrev.record.Record, man_prepped_record_dict: dict
     ) -> None:
-        original_record = colrev.record.Record(data=records[record_dict["ID"]])
-        imported_records.append(original_record.data["ID"])
-
-        for key, value in record_dict.items():
-            original_record.data[key] = value
-
         dropped_keys = [
             k
             for k in original_record.data
-            if k in self.__FIELDS_TO_KEEP and k not in record_dict
+            if k in self.__FIELDS_TO_KEEP and k not in man_prepped_record_dict
         ]
+        if man_prepped_record_dict["ENTRYTYPE"] != original_record.data["ENTRYTYPE"]:
+            original_record.data["ENTRYTYPE"] = man_prepped_record_dict["ENTRYTYPE"]
+            original_record.update_masterdata_provenance(qm=self.quality_model)
+
+        for key, value in man_prepped_record_dict.items():
+            if key in ["colrev_status"]:
+                continue
+            if value != original_record.data.get(key, ""):
+                original_record.update_field(
+                    key=key, value=value, source="man_prep", append_edit=False
+                )
+                original_record.remove_masterdata_provenance_note(
+                    key=key, note="missing"
+                )
+
         for dropped_key in dropped_keys:
-            del original_record.data[dropped_key]
+            original_record.remove_field(
+                key=dropped_key, not_missing_note=True, source="man_prep"
+            )
 
+    def __print_stats(self, *, original_record: colrev.record.Record) -> None:
         if (
             original_record.data["colrev_status"]
             == colrev.record.RecordState.rev_prescreen_excluded
         ):
             self.review_manager.logger.info(
                 f" {colors.RED}{original_record.data['ID']}".ljust(46)
                 + "md_needs_manual_preparation   rev_prescreen_excluded"
                 + f"{colors.END}"
             )
-            return
-
-        self.__update_provenance(record=original_record, records=records)
-        self.__drop_unnecessary_provenance_fiels(record=original_record)
-        original_record.update_masterdata_provenance(
-            qm=self.quality_model, set_prepared=True
-        )
-        if (
+        elif (
             original_record.data["colrev_status"]
             == colrev.record.RecordState.md_prepared
         ):
             self.review_manager.logger.info(
                 f" {colors.GREEN}{original_record.data['ID']}".ljust(46)
                 + "md_needs_manual_preparation   md_prepared"
                 + f"{colors.END}"
@@ -268,14 +241,47 @@
             )
             self.review_manager.logger.info(
                 f" {colors.ORANGE}{original_record.data['ID']}".ljust(46)
                 + f"{man_prep_note}"
                 + f"{colors.END}"
             )
 
+    def __import_record(
+        self,
+        *,
+        man_prepped_record_dict: dict,
+        original_record: colrev.record.Record,
+        imported_records: list,
+    ) -> None:
+        imported_records.append(original_record.data["ID"])
+        override = (
+            man_prepped_record_dict["colrev_status"]
+            == colrev.record.RecordState.md_prepared
+        )
+
+        self.__update_original_record_based_on_man_prepped(
+            original_record=original_record,
+            man_prepped_record_dict=man_prepped_record_dict,
+        )
+
+        self.__drop_unnecessary_provenance_fiels(record=original_record)
+        if (
+            man_prepped_record_dict["colrev_status"]
+            != colrev.record.RecordState.rev_prescreen_excluded
+        ):
+            original_record.update_masterdata_provenance(
+                qm=self.quality_model, set_prepared=True
+            )
+        if override:
+            original_record.set_status(
+                target_state=colrev.record.RecordState.md_prepared, force=True
+            )
+
+        self.__print_stats(original_record=original_record)
+
     def __import_prep_man(self) -> None:
         self.review_manager.logger.info(
             "Load import changes from "
             f"{self.prep_man_bib_path.relative_to(self.review_manager.path)}"
         )
 
         with open(self.prep_man_bib_path, encoding="utf8") as target_bib:
@@ -296,21 +302,24 @@
                 ] = colrev.record.RecordState.rev_prescreen_excluded
                 self.review_manager.logger.info(
                     f" {colors.RED}{record_id}".ljust(46)
                     + "md_needs_manual_preparation   rev_prescreen_excluded"
                     + f"{colors.END}"
                 )
 
-        for record_id, record_dict in man_prep_recs.items():
+        for record_id, man_prepped_record_dict in man_prep_recs.items():
             if record_id not in records:
                 print(f"ID no longer in records: {record_id}")
                 continue
+            original_record = colrev.record.Record(
+                data=records[man_prepped_record_dict["ID"]]
+            )
             self.__import_record(
-                record_dict=record_dict,
-                records=records,
+                man_prepped_record_dict=man_prepped_record_dict,
+                original_record=original_record,
                 imported_records=imported_records,
             )
 
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
         self.review_manager.create_commit(msg="Prep-man (ExportManPrep)")
 
@@ -352,11 +361,7 @@
             selected_path = self.prep_man_bib_path.relative_to(
                 prep_man_operation.review_manager.path
             )
             if input(f"Import changes from {selected_path} [y,n]?") == "y":
                 self.__import_prep_man()
 
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prescreen/asreview.py` & `colrev-0.9.0/colrev/ops/built_in/prescreen/asreview.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,17 +12,16 @@
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    if typing.TYPE_CHECKING:
-        import colrev.ops.prescreen.Prescreen
+if typing.TYPE_CHECKING:
+    import colrev.ops.prescreen.Prescreen
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.PrescreenPackageEndpointInterface
@@ -255,11 +254,7 @@
                 if input("create commit [y,n]?") == "y":
                     prescreen_operation.review_manager.create_commit(
                         msg="Pre-screen (asreview)",
                         manual_author=True,
                     )
 
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prescreen/conditional_prescreen.py` & `colrev-0.9.0/colrev/ops/built_in/prescreen/conditional_prescreen.py`

 * *Files 3% similar despite different names*

```diff
@@ -7,17 +7,16 @@
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    if typing.TYPE_CHECKING:
-        import colrev.ops.prescreen.Prescreen
+if typing.TYPE_CHECKING:
+    import colrev.ops.prescreen.Prescreen
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.PrescreenPackageEndpointInterface
@@ -61,11 +60,7 @@
         prescreen_operation.review_manager.dataset.save_records_dict(records=records)
         prescreen_operation.review_manager.dataset.add_record_changes()
         prescreen_operation.review_manager.create_commit(
             msg="Pre-screen (include_all)",
             manual_author=False,
         )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prescreen/prescreen_cli.py` & `colrev-0.9.0/colrev/ops/built_in/prescreen/prescreen_cli.py`

 * *Files 1% similar despite different names*

```diff
@@ -8,17 +8,16 @@
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    if typing.TYPE_CHECKING:
-        import colrev.ops.prescreen.Prescreen
+if typing.TYPE_CHECKING:
+    import colrev.ops.prescreen.Prescreen
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.PrescreenPackageEndpointInterface
 )
@@ -150,11 +149,7 @@
         #     if input("Create commit (y/n)?") != "y":
         #         return records
 
         prescreen_operation.review_manager.create_commit(
             msg="Pre-screening (manual)", manual_author=True
         )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prescreen/prescreen_table.py` & `colrev-0.9.0/colrev/ops/built_in/prescreen/prescreen_table.py`

 * *Files 2% similar despite different names*

```diff
@@ -11,17 +11,16 @@
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    if typing.TYPE_CHECKING:
-        import colrev.ops.prescreen.Prescreen
+if typing.TYPE_CHECKING:
+    import colrev.ops.prescreen.Prescreen
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.PrescreenPackageEndpointInterface
@@ -247,11 +246,7 @@
         if prescreen_operation.review_manager.dataset.has_changes():
             if input("create commit [y,n]?") == "y":
                 prescreen_operation.review_manager.create_commit(
                     msg="Pre-screen (table)",
                     manual_author=True,
                 )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/prescreen/scope_prescreen.py` & `colrev-0.9.0/colrev/ops/built_in/prescreen/scope_prescreen.py`

 * *Files 2% similar despite different names*

```diff
@@ -9,17 +9,16 @@
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.language_service
 import colrev.env.package_manager
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    if typing.TYPE_CHECKING:
-        import colrev.ops.prescreen.Prescreen
+if typing.TYPE_CHECKING:
+    import colrev.ops.prescreen.Prescreen
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.PrescreenPackageEndpointInterface
@@ -226,11 +225,7 @@
         prescreen_operation.review_manager.dataset.save_records_dict(records=records)
         prescreen_operation.review_manager.dataset.add_record_changes()
         prescreen_operation.review_manager.create_commit(
             msg="Pre-screen (scope)",
             manual_author=False,
         )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/conceptual_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/theoretical_review.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #! /usr/bin/env python
-"""Conceptual review"""
+"""Theoretical review"""
 from dataclasses import dataclass
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search
@@ -14,38 +14,39 @@
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.ReviewTypePackageEndpointInterface
 )
 @dataclass
-class ConceptualReview(JsonSchemaMixin):
-    """Conceptual review"""
+class TheoreticalReview(JsonSchemaMixin):
+    """Theoretical review"""
 
     settings_class = colrev.env.package_manager.DefaultSettings
     ci_supported: bool = True
 
     def __init__(
         self, *, operation: colrev.operation.CheckOperation, settings: dict
     ) -> None:
         self.settings = self.settings_class.load_settings(data=settings)
 
     def __str__(self) -> str:
-        return "conceptual review"
+        return "theoretical review"
 
     def initialize(
         self, settings: colrev.settings.Settings
     ) -> colrev.settings.Settings:
-        """Initialize a conceptual review"""
+        """Initialize a theoretical review"""
 
         settings.data.data_package_endpoints = [
             {
+                "endpoint": "colrev.obsidian",
+                "version": "0.1",
+                "config": {},
+            },
+            {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
-            }
+            },
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/critical_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/critical_review.py`

 * *Files 2% similar despite different names*

```diff
@@ -43,11 +43,7 @@
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             },
         ]
 
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/curated_masterdata.md` & `colrev-0.9.0/colrev/ops/built_in/review_types/curated_masterdata.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/curated_masterdata.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/curated_masterdata.py`

 * *Files 2% similar despite different names*

```diff
@@ -126,11 +126,7 @@
             }
         ]
 
         # curated repo: automatically prescreen/screen-include papers
         # (no data endpoint -> automatically rev_synthesized)
 
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/descriptive_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/descriptive_review.py`

 * *Files 3% similar despite different names*

```diff
@@ -42,11 +42,7 @@
             {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             },
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/literature_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/literature_review.py`

 * *Files 4% similar despite different names*

```diff
@@ -41,11 +41,7 @@
             {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             }
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/meta_analysis.md` & `colrev-0.9.0/colrev/ops/built_in/review_types/meta_analysis.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/meta_analysis.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/meta_analysis.py`

 * *Files 6% similar despite different names*

```diff
@@ -56,11 +56,7 @@
             {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             },
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/narrative_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/narrative_review.py`

 * *Files 10% similar despite different names*

```diff
@@ -41,11 +41,7 @@
             {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             }
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/qualitative_systematic_review.md` & `colrev-0.9.0/colrev/ops/built_in/review_types/qualitative_systematic_review.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/qualitative_systematic_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/qualitative_systematic_review.py`

 * *Files 2% similar despite different names*

```diff
@@ -56,11 +56,7 @@
             {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             },
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/scientometric.md` & `colrev-0.9.0/colrev/ops/built_in/review_types/scientometric.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/scientometric.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/scientometric.py`

 * *Files 4% similar despite different names*

```diff
@@ -42,11 +42,7 @@
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             }
         ]
         settings.pdf_get.pdf_required_for_screen_and_synthesis = False
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/scoping_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/scoping_review.py`

 * *Files 5% similar despite different names*

```diff
@@ -47,11 +47,7 @@
             {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
             },
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/review_types/theoretical_review.py` & `colrev-0.9.0/colrev/ops/built_in/review_types/conceptual_review.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #! /usr/bin/env python
-"""Theoretical review"""
+"""Conceptual review"""
 from dataclasses import dataclass
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.search
@@ -14,43 +14,34 @@
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.ReviewTypePackageEndpointInterface
 )
 @dataclass
-class TheoreticalReview(JsonSchemaMixin):
-    """Theoretical review"""
+class ConceptualReview(JsonSchemaMixin):
+    """Conceptual review"""
 
     settings_class = colrev.env.package_manager.DefaultSettings
     ci_supported: bool = True
 
     def __init__(
         self, *, operation: colrev.operation.CheckOperation, settings: dict
     ) -> None:
         self.settings = self.settings_class.load_settings(data=settings)
 
     def __str__(self) -> str:
-        return "theoretical review"
+        return "conceptual review"
 
     def initialize(
         self, settings: colrev.settings.Settings
     ) -> colrev.settings.Settings:
-        """Initialize a theoretical review"""
+        """Initialize a conceptual review"""
 
         settings.data.data_package_endpoints = [
             {
-                "endpoint": "colrev.obsidian",
-                "version": "0.1",
-                "config": {},
-            },
-            {
                 "endpoint": "colrev.paper_md",
                 "version": "1.0",
                 "word_template": "APA-7.docx",
-            },
+            }
         ]
         return settings
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/screen/screen_cli.py` & `colrev-0.9.0/colrev/ops/built_in/screen/screen_cli.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,29 +1,27 @@
 #! /usr/bin/env python
 """Screen based on CLI"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.screen.utils as util_cli_screen
 import colrev.record
 import colrev.settings
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.screen
+if TYPE_CHECKING:
+    import colrev.ops.screen
 
 
 @zope.interface.implementer(colrev.env.package_manager.ScreenPackageEndpointInterface)
 @dataclass
 class CoLRevCLIScreen(JsonSchemaMixin):
     """Screen documents using a CLI"""
 
@@ -289,11 +287,7 @@
         self, screen_operation: colrev.ops.screen.Screen, records: dict, split: list
     ) -> dict:
         """Screen records based on a cli"""
 
         records = self.__screen_cli(screen_operation, split)
 
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/screen/screen_table.py` & `colrev-0.9.0/colrev/ops/built_in/screen/screen_table.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,29 +2,27 @@
 """Screen based on a table"""
 from __future__ import annotations
 
 import csv
 from dataclasses import dataclass
 from pathlib import Path
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import pandas as pd
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.built_in.screen.utils as util_cli_screen
 import colrev.record
 import colrev.settings
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.screen
+if TYPE_CHECKING:
+    import colrev.ops.screen
 
 
 @zope.interface.implementer(colrev.env.package_manager.ScreenPackageEndpointInterface)
 @dataclass
 class TableScreen(JsonSchemaMixin):
     """Screen documents using tables (exported and imported)"""
 
@@ -234,11 +232,7 @@
 
         if screen_operation.review_manager.dataset.has_changes():
             if input("create commit [y,n]?") == "y":
                 screen_operation.review_manager.create_commit(
                     msg="Screen", manual_author=True
                 )
         return records
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/screen/utils.py` & `colrev-0.9.0/colrev/ops/built_in/screen/utils.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,20 +1,19 @@
 #! /usr/bin/env python
 """Screening utilities"""
 from __future__ import annotations
 
+from typing import TYPE_CHECKING
+
 import colrev.env.package_manager
 import colrev.record
 import colrev.settings
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.screen
+if TYPE_CHECKING:
+    import colrev.ops.screen
 
 
 __FULL_SCREEN_EXPLANATION = (
     "Explanation: Screening criteria can be used "
     + """to include or exclude records based on specific reasons.
 Example:
     - short name        (short string): behavioral_treatment
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/abi_inform_proquest.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/abi_inform_proquest.py`

 * *Files 3% similar despite different names*

```diff
@@ -38,22 +38,23 @@
         + "ops/built_in/search_sources/abi_inform_proquest.md"
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
+        self.quality_model = source_operation.review_manager.get_qm()
 
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
         """Source heuristic for ABI/INFORM (ProQuest)"""
 
         result = {"confidence": 0.0}
 
-        if data.count("\n@") > 1:
+        if "www.proquest.com" in data:  # nosec
             if data.count("www.proquest.com") >= data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
     def validate_source(
         self,
@@ -123,20 +124,21 @@
         return records
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for ABI/INFORM (ProQuest)"""
 
+        if record.data.get("journal", "").lower().endswith("conference proceedings."):
+            record.change_entrytype(
+                new_entrytype="inproceedings", qm=self.quality_model
+            )
+
         if "language" in record.data:
             if record.data["language"] in ["ENG", "English"]:
                 record.update_field(
                     key="language",
                     value="eng",
                     source="prep_abi_inform_proquest_source",
                 )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/acm_digital_library.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/eric.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #! /usr/bin/env python
-"""SearchSource: ACM Digital Library"""
+"""SearchSource: ERIC"""
 from __future__ import annotations
 
 import typing
 from dataclasses import dataclass
 from pathlib import Path
 
 import zope.interface
@@ -19,56 +19,34 @@
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 @dataclass
-class ACMDigitalLibrarySearchSource(JsonSchemaMixin):
-    """SearchSource for the ACM digital Library"""
+class ERICSearchSource(JsonSchemaMixin):
+    """SearchSource for ERIC"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
-    # Note : the ID contains the doi
-    # "https://dl.acm.org/doi/{{ID}}"
-    source_identifier = "doi"
+    source_identifier = "url"
     search_type = colrev.settings.SearchType.DB
     api_search_supported = False
     ci_supported: bool = False
-    heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
-    short_name = "ACM Digital Library"
+    heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.oni
+    short_name = "ERIC"
     link = (
-        "https://github.com/CoLRev-Environment/colrev/blob/main/colrev/"
-        + "ops/built_in/search_sources/acm_digital_library.md"
+        "https://github.com/CoLRev-Environment/colrev/blob/main/"
+        + "colrev/ops/built_in/search_sources/eric.md"
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
 
-    @classmethod
-    def heuristic(cls, filename: Path, data: str) -> dict:
-        """Source heuristic for ACM dDigital Library"""
-
-        result = {"confidence": 0.0}
-        # Simple heuristic:
-        if "publisher = {Association for Computing Machinery}," in data:
-            result["confidence"] = 0.7
-            print(data)
-            return result
-        # We may also check whether the ID=doi=url
-        return result
-
-    @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
-        """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
-        raise NotImplementedError
-
     def validate_source(
         self,
         search_operation: colrev.ops.search.Search,
         source: colrev.settings.SearchSource,
     ) -> None:
         """Validate the SearchSource (parameters etc.)"""
 
@@ -87,18 +65,35 @@
                 f"for ({source.filename})"
             )
 
         search_operation.review_manager.logger.debug(
             f"SearchSource {source.filename} validated"
         )
 
+    @classmethod
+    def heuristic(cls, filename: Path, data: str) -> dict:
+        """Source heuristic for ERIC"""
+
+        result = {"confidence": 0.0}
+
+        # Note : no features in bib file for identification
+
+        return result
+
+    @classmethod
+    def add_endpoint(
+        cls, search_operation: colrev.ops.search.Search, query: str
+    ) -> colrev.settings.SearchSource:
+        """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
+        raise NotImplementedError
+
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
-        """Run a search of ACM Digital Library"""
+        """Run a search of ERIC"""
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
@@ -108,22 +103,17 @@
 
     def load_fixes(
         self,
         load_operation: colrev.ops.load.Load,
         source: colrev.settings.SearchSource,
         records: typing.Dict,
     ) -> dict:
-        """Load fixes for ACM Digital Library"""
+        """Load fixes for ERIC"""
 
         return records
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
-        """Source-specific preparation for ACM Digital Library"""
-        record.remove_field(key="url")
+        """Source-specific preparation for ERIC"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/aisel.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/aisel.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/aisel.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/aisel.py`

 * *Files 1% similar despite different names*

```diff
@@ -493,11 +493,7 @@
 
         self.__fix_entrytype(record=record)
         self.__unify_container_titles(record=record)
         self.__format_fields(record=record)
         self.__exclude_complementary_material(record=record)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/colrev_project.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/colrev_project.py`

 * *Files 1% similar despite different names*

```diff
@@ -76,23 +76,23 @@
         )
 
     @classmethod
     def add_endpoint(
         cls, search_operation: colrev.ops.search.Search, query: str
     ) -> colrev.settings.SearchSource:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
-        if query.startswith("http"):
+        if query.startswith("url="):
             filename = search_operation.get_unique_filename(
                 file_path_string=query.split("/")[-1]
             )
             return colrev.settings.SearchSource(
                 endpoint="colrev.colrev_project",
                 filename=filename,
                 search_type=colrev.settings.SearchType.OTHER,
-                search_parameters={"scope": {"url": query}},
+                search_parameters={"scope": {"url": query[4:]}},
                 load_conversion_package_endpoint={"endpoint": "colrev.bibtex"},
                 comment="",
             )
 
         raise NotImplementedError
 
     def __load_records_to_import(self, *, project_url: str, project_name: str) -> dict:
@@ -243,11 +243,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for CoLRev projects"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/crossref.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/crossref.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/crossref.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/crossref.py`

 * *Files 1% similar despite different names*

```diff
@@ -9,14 +9,15 @@
 from copy import deepcopy
 from dataclasses import dataclass
 from importlib.metadata import version
 from multiprocessing import Lock
 from pathlib import Path
 from sqlite3 import OperationalError
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from crossref.restful import Etiquette
 from crossref.restful import Journals
 from crossref.restful import Works
 from dacite import from_dict
@@ -26,20 +27,17 @@
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.search_sources.doi_org as doi_connector
 import colrev.ops.built_in.search_sources.utils as connector_utils
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.search
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.search
+    import colrev.ops.prep
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
@@ -321,15 +319,18 @@
         if "retracted" in record.data.get(
             "warning", ""
         ) or "retracted" in record.data.get("prescreen_exclusion", ""):
             record.prescreen_exclude(reason="retracted")
             record.remove_field(key="warning")
         else:
             assert "" != crossref_source
-            record.set_masterdata_complete(source=crossref_source)
+            record.set_masterdata_complete(
+                source=crossref_source,
+                masterdata_repository=self.review_manager.settings.is_curated_repo(),
+            )
             record.set_status(target_state=colrev.record.RecordState.md_prepared)
 
     def __get_crossref_query_items(
         self, *, record: colrev.record.Record, jour_vol_iss_list: bool, timeout: int
     ) -> list:
         # Note : only returning a multiple-item list for jour_vol_iss_list
         try:
@@ -911,14 +912,13 @@
 
         source_item = [
             x
             for x in record.data["colrev_origin"]
             if str(source.filename).replace("data/search/", "") in x
         ]
         if source_item:
-            record.set_masterdata_complete(source=source_item[0])
+            record.set_masterdata_complete(
+                source=source_item[0],
+                masterdata_repository=self.review_manager.settings.is_curated_repo(),
+            )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/dblp.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/dblp.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/dblp.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/dblp.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 #! /usr/bin/env python
 """SearchSource: DBLP"""
 from __future__ import annotations
 
 import html
 import json
 import re
+import typing
 from dataclasses import dataclass
 from datetime import datetime
 from multiprocessing import Lock
 from pathlib import Path
 from sqlite3 import OperationalError
 from typing import Optional
 
@@ -19,19 +20,14 @@
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.search
 import colrev.record
 import colrev.settings
 
-if False:  # pylint: disable=using-constant-test
-    import typing
-
-    # from typing import TYPE_CHECKING
-
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
@@ -560,15 +556,15 @@
         result = {"confidence": 0.0}
         # Simple heuristic:
         if "dblp_key" in data:
             result["confidence"] = 1.0
             return result
 
         if "dblp computer science bibliography" in data:
-            if data.count("dblp computer science bibliography") > data.count("\n@"):
+            if data.count("dblp computer science bibliography") >= data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
     @classmethod
     def add_endpoint(
         cls, search_operation: colrev.ops.search.Search, query: str
@@ -619,14 +615,18 @@
             # DBLP appends identifiers to non-unique authors
             record.update_field(
                 key="author",
                 value=str(re.sub(r"[0-9]{4}", "", record.data["author"])),
                 source="dblp",
                 keep_source_if_equal=True,
             )
+        record.remove_field(key="bibsource")
+        if any(x in record.data.get("url", "") for x in ["dblp.org", "doi.org"]):
+            record.remove_field(key="url")
+        record.remove_field(key="timestamp")
 
         return record
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
@@ -675,15 +675,16 @@
                         dblp_feed.add_record(record=retrieved_record)
 
                         record.merge(
                             merging_record=retrieved_record,
                             default_source=retrieved_record.data["colrev_origin"][0],
                         )
                         record.set_masterdata_complete(
-                            source=retrieved_record.data["colrev_origin"][0]
+                            source=retrieved_record.data["colrev_origin"][0],
+                            masterdata_repository=self.review_manager.settings.is_curated_repo(),
                         )
                         record.set_status(
                             target_state=colrev.record.RecordState.md_prepared
                         )
                         if "Withdrawn (according to DBLP)" in record.data.get(
                             "warning", ""
                         ):
@@ -701,11 +702,7 @@
                         self.dblp_lock.release()
                         continue
 
         except requests.exceptions.RequestException:
             pass
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/doi_org.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/doi_org.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 #! /usr/bin/env python
 """Connector to doi.org (API)"""
 from __future__ import annotations
 
 import json
 from sqlite3 import OperationalError
+from typing import TYPE_CHECKING
 from urllib.parse import unquote
 
 import requests
 from bs4 import BeautifulSoup
 
+import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.search_sources.utils as connector_utils
 import colrev.record
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # Note: not (yet) implemented as a full search_source
 # (including SearchSourcePackageEndpointInterface, packages_endpoints.json)
 
 # pylint: disable=too-few-public-methods
 
 
@@ -73,22 +71,25 @@
             retrieved_json = json.loads(ret.text)
             language_service = colrev.env.language_service.LanguageService()
             retrieved_record_dict = connector_utils.json_to_record(item=retrieved_json)
             language_service.unify_to_iso_639_3_language_codes(record=record)
             retrieved_record = colrev.record.PrepRecord(data=retrieved_record_dict)
             retrieved_record.add_provenance_all(source=url)
             record.merge(merging_record=retrieved_record, default_source=url)
-            record.set_masterdata_complete(source=url)
+            record.set_masterdata_complete(
+                source=url,
+                masterdata_repository=review_manager.settings.is_curated_repo(),
+            )
             record.set_status(target_state=colrev.record.RecordState.md_prepared)
             if "retracted" in record.data.get("warning", ""):
                 record.prescreen_exclude(reason="retracted")
                 record.remove_field(key="warning")
 
             if "title" in record.data:
-                record.format_if_mostly_upper(key="title")
+                record.format_if_mostly_upper(key="title", case="sentence")
 
         except (
             requests.exceptions.RequestException,
             colrev_exceptions.InvalidMerge,
         ) as exc:
             print(exc)
 
@@ -167,11 +168,7 @@
         except (requests.exceptions.RequestException, TypeError, UnicodeDecodeError):
             pass
         except OperationalError as exc:
             raise colrev_exceptions.ServiceNotAvailableException(
                 "sqlite, required for requests CachedSession "
                 "(possibly caused by concurrent operations)"
             ) from exc
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/ebsco_host.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/ebsco_host.py`

 * *Files 2% similar despite different names*

```diff
@@ -99,11 +99,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for EBSCOHost"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/eric.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/trid.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #! /usr/bin/env python
-"""SearchSource: ERIC"""
+"""SearchSource: Transport Research International Documentation"""
 from __future__ import annotations
 
 import typing
 from dataclasses import dataclass
 from pathlib import Path
 
 import zope.interface
@@ -11,35 +11,36 @@
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.search
 import colrev.record
 
+
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 @dataclass
-class ERICSearchSource(JsonSchemaMixin):
-    """SearchSource for ERIC"""
+class TransportResearchInternationalDocumentation(JsonSchemaMixin):
+    """SearchSource for Transport Research International Documentation"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
-    source_identifier = "url"
+    source_identifier = "biburl"
     search_type = colrev.settings.SearchType.DB
     api_search_supported = False
     ci_supported: bool = False
-    heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.oni
-    short_name = "ERIC"
+    heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
+    short_name = "TRID"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
-        + "colrev/ops/built_in/search_sources/eric.md"
+        + "colrev/ops/built_in/search_sources/trid.md"
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
 
@@ -67,33 +68,34 @@
 
         search_operation.review_manager.logger.debug(
             f"SearchSource {source.filename} validated"
         )
 
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
-        """Source heuristic for ERIC"""
+        """Source heuristic for Transport Research International Documentation"""
 
         result = {"confidence": 0.0}
-
-        # Note : no features in bib file for identification
-
+        # Simple heuristic:
+        if "UR  - https://trid.trb.org/view/" in data:
+            result["confidence"] = 0.9
+            return result
         return result
 
     @classmethod
     def add_endpoint(
         cls, search_operation: colrev.ops.search.Search, query: str
     ) -> colrev.settings.SearchSource:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
-        """Run a search of ERIC"""
+        """Run a search of TRID"""
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
@@ -103,21 +105,17 @@
 
     def load_fixes(
         self,
         load_operation: colrev.ops.load.Load,
         source: colrev.settings.SearchSource,
         records: typing.Dict,
     ) -> dict:
-        """Load fixes for ERIC"""
+        """Load fixes for Transport Research International Documentation"""
 
         return records
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
-        """Source-specific preparation for ERIC"""
+        """Source-specific preparation for Transport Research International Documentation"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/europe_pmc.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/europe_pmc.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/europe_pmc.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/europe_pmc.py`

 * *Files 6% similar despite different names*

```diff
@@ -256,15 +256,18 @@
                     similarity = self.__get_similarity(
                         record=record, retrieved_record=retrieved_record
                     )
 
                     source = (
                         f"{self.__SOURCE_URL}{retrieved_record.data['europe_pmc_id']}"
                     )
-                    retrieved_record.set_masterdata_complete(source=source)
+                    retrieved_record.set_masterdata_complete(
+                        source=source,
+                        masterdata_repository=self.review_manager.settings.is_curated_repo(),
+                    )
 
                     if not most_similar_only:
                         record_list.append(retrieved_record)
 
                     elif most_similar < similarity:
                         most_similar = similarity
                         most_similar_record = retrieved_record.get_data()
@@ -344,15 +347,16 @@
 
                     record.merge(
                         merging_record=retrieved_record,
                         default_source=retrieved_record.data["colrev_origin"][0],
                     )
 
                     record.set_masterdata_complete(
-                        source=retrieved_record.data["colrev_origin"][0]
+                        source=retrieved_record.data["colrev_origin"][0],
+                        masterdata_repository=self.review_manager.settings.is_curated_repo(),
                     )
                     record.set_status(
                         target_state=colrev.record.RecordState.md_prepared
                     )
 
                     europe_pmc_feed.save_feed_file()
                     self.europe_pmc_lock.release()
@@ -462,15 +466,18 @@
                             f"Skipped record: {retrieved_record.data}"
                         )
                         continue
 
                     source = (
                         f"{self.__SOURCE_URL}{retrieved_record.data['europe_pmc_id']}"
                     )
-                    retrieved_record.set_masterdata_complete(source=source)
+                    retrieved_record.set_masterdata_complete(
+                        source=source,
+                        masterdata_repository=self.review_manager.settings.is_curated_repo(),
+                    )
 
                     europe_pmc_feed.set_id(record_dict=retrieved_record.data)
                     added = europe_pmc_feed.add_record(record=retrieved_record)
 
                     if added:
                         search_operation.review_manager.logger.info(
                             " retrieve europe_pmc_id="
@@ -509,14 +516,18 @@
     def heuristic(cls, filename: Path, data: str) -> dict:
         """Source heuristic for Europe PMC"""
 
         result = {"confidence": 0.0}
         if "europe_pmc_id" in data:
             result["confidence"] = 1.0
 
+        if "https://europepmc.org" in data:  # nosec
+            if data.count("https://europepmc.org") >= data.count("\n@"):
+                result["confidence"] = 1.0
+
         return result
 
     @classmethod
     def add_endpoint(
         cls, search_operation: colrev.ops.search.Search, query: str
     ) -> colrev.settings.SearchSource:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
@@ -557,11 +568,7 @@
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Europe PMC"""
         record.data["author"].rstrip(".")
         record.data["title"].rstrip(".")
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/google_scholar.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/google_scholar.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/google_scholar.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/google_scholar.py`

 * *Files 2% similar despite different names*

```diff
@@ -145,11 +145,7 @@
                     source=source + "|extract-from-note",
                 )
         if "abstract" in record.data:
             # Note: abstracts provided by GoogleScholar are very incomplete
             record.remove_field(key="abstract")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/ieee.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/ieee.py`

 * *Files 2% similar despite different names*

```diff
@@ -123,11 +123,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for IEEEXplore"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/jstor.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/jstor.py`

 * *Files 6% similar despite different names*

```diff
@@ -115,11 +115,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for JSTOR"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/local_index.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/local_index.py`

 * *Files 1% similar despite different names*

```diff
@@ -500,21 +500,19 @@
                     "CURATED"
                 ]["source"]
                 assert "#" not in repo_path
                 # otherwise: strip the ID at the end if we add an ID...
                 base_repos.append(repo_path)
 
         base_repos = list(set(base_repos))
-
         environment_manager = colrev.env.environment_manager.EnvironmentManager()
-
         local_base_repos = {
             x["repo_source_url"]: x["repo_source_path"]
             for x in environment_manager.local_repos()
-            if x["repo_source_url"] in base_repos
+            if x.get("repo_source_url", "NA") in base_repos
         }
         return local_base_repos
 
     def __print_changes(self, *, local_base_repo: str, change_itemsets: list) -> list:
         def print_diff(change: tuple) -> str:
             diff = difflib.Differ()
             letters = list(diff.compare(change[1], change[0]))
@@ -581,28 +579,28 @@
         return selected_changes
 
     def apply_correction(self, *, change_itemsets: list) -> None:
         """Apply a correction by opening a pull request in the original repository"""
 
         local_base_repos = self.__get_local_base_repos(change_itemsets=change_itemsets)
 
-        for local_base_repo in local_base_repos:
+        for local_base_repo_url, local_base_repo_path in local_base_repos.items():
             selected_changes = self.__print_changes(
-                local_base_repo=local_base_repo, change_itemsets=change_itemsets
+                local_base_repo=local_base_repo_url, change_itemsets=change_itemsets
             )
 
             response = ""
             while True:
                 response = input("\nConfirm changes? (y/n)")
                 if response in ["y", "n"]:
                     break
 
             if response == "y":
                 self.__apply_correction(
-                    source_url=local_base_repo,
+                    source_url=local_base_repo_path,
                     change_list=selected_changes,
                 )
             elif response == "n":
                 if input("Discard all corrections (y/n)?") == "y":
                     for selected_change in selected_changes:
                         Path(selected_change["file"]).unlink()
 
@@ -916,11 +914,7 @@
         )
 
         if success:
             print(
                 f"\n{colors.GREEN}Thank you for supporting other researchers "
                 f"by sharing your corrections {colors.END}\n"
             )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/open_citations_forward_search.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/open_citations_forward_search.py`

 * *Files 1% similar despite different names*

```diff
@@ -253,11 +253,7 @@
         return records
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for forward searches (OpenCitations)"""
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/open_library.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/open_library.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,28 +4,26 @@
 
 import json
 import typing
 from dataclasses import dataclass
 from multiprocessing import Lock
 from pathlib import Path
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import requests
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # Note: not (yet) implemented as a full search_source
 # (including SearchSourcePackageEndpointInterface, packages_endpoints.json)
 
 
 # pylint: disable=too-few-public-methods
 # pylint: disable=unused-argument
@@ -321,11 +319,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for OpenLibrary"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/pdf_backward_search.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/pdf_backward_search.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/pdf_backward_search.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/pdf_backward_search.py`

 * *Files 5% similar despite different names*

```diff
@@ -231,21 +231,80 @@
                     feed_record.data.update(**backward_references[pos - 1])
                     # del backward_references[pos-1]
                     updated += 1
             self.review_manager.logger.info(
                 f" updated {updated}/{overall} records cited by {parent_record_id}"
             )
 
+    def __run_backward_search_on_pdf(
+        self,
+        *,
+        record: dict,
+        pdf_backward_search_feed: colrev.ops.search.GeneralOriginFeed,
+        search_operation: colrev.ops.search.Search,
+        records: dict,
+        rerun: bool,
+    ) -> None:
+        # Note: IDs generated by GROBID for cited references
+        # may change across grobid versions
+        # -> challenge for key-handling/updating searches...
+
+        self.review_manager.logger.info(f' run backward search for {record["ID"]}')
+
+        pdf_path = self.review_manager.path / Path(record["file"])
+        tei = self.review_manager.get_tei(
+            pdf_path=pdf_path,
+        )
+
+        new_records = tei.get_bibliography(
+            min_intext_citations=self.search_source.search_parameters[
+                "min_intext_citations"
+            ]
+        )
+
+        for new_record in new_records:
+            if "tei_id" in new_record:
+                del new_record["tei_id"]
+            new_record["bwsearch_ref"] = (
+                record["ID"] + "_backward_search_" + new_record["ID"]
+            )
+            try:
+                pdf_backward_search_feed.set_id(record_dict=new_record)
+            except colrev_exceptions.NotFeedIdentifiableException:
+                continue
+
+            prev_record_dict_version = {}
+            if new_record["ID"] in pdf_backward_search_feed.feed_records:
+                prev_record_dict_version = pdf_backward_search_feed.feed_records[
+                    new_record["ID"]
+                ]
+
+            added = pdf_backward_search_feed.add_record(
+                record=colrev.record.Record(data=new_record),
+            )
+
+            if added:
+                pdf_backward_search_feed.nr_added += 1
+            elif rerun:
+                # Note : only re-index/update
+                changed = search_operation.update_existing_record(
+                    records=records,
+                    record_dict=new_record,
+                    prev_record_dict_version=prev_record_dict_version,
+                    source=self.search_source,
+                    update_time_variant_fields=rerun,
+                )
+                if changed:
+                    pdf_backward_search_feed.nr_changed += 1
+
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of PDFs (backward search based on GROBID)"""
 
-        # pylint: disable=too-many-branches
-
         # Do not run in continuous-integration environment
         if search_operation.review_manager.in_ci_environment():
             return
 
         records = search_operation.review_manager.dataset.load_records_dict()
 
         if not records:
@@ -265,66 +324,22 @@
             update_only=(not rerun),
         )
         for record in records.values():
             try:
                 if not self.__bw_search_condition(record=record):
                     continue
 
-                # Note: IDs generated by GROBID for cited references
-                # may change across grobid versions
-                # -> challenge for key-handling/updating searches...
-
-                search_operation.review_manager.logger.info(
-                    f' run backward search for {record["ID"]}'
-                )
-
-                pdf_path = self.review_manager.path / Path(record["file"])
-                tei = search_operation.review_manager.get_tei(
-                    pdf_path=pdf_path,
+                self.__run_backward_search_on_pdf(
+                    record=record,
+                    pdf_backward_search_feed=pdf_backward_search_feed,
+                    search_operation=search_operation,
+                    records=records,
+                    rerun=rerun,
                 )
 
-                new_records = tei.get_bibliography(
-                    min_intext_citations=self.search_source.search_parameters[
-                        "min_intext_citations"
-                    ]
-                )
-
-                for new_record in new_records:
-                    new_record["bwsearch_ref"] = (
-                        record["ID"] + "_backward_search_" + new_record["ID"]
-                    )
-                    try:
-                        pdf_backward_search_feed.set_id(record_dict=new_record)
-                    except colrev_exceptions.NotFeedIdentifiableException:
-                        continue
-
-                    prev_record_dict_version = {}
-                    if new_record["ID"] in pdf_backward_search_feed.feed_records:
-                        prev_record_dict_version = (
-                            pdf_backward_search_feed.feed_records[new_record["ID"]]
-                        )
-
-                    added = pdf_backward_search_feed.add_record(
-                        record=colrev.record.Record(data=new_record),
-                    )
-
-                    if added:
-                        pdf_backward_search_feed.nr_added += 1
-                    elif rerun:
-                        # Note : only re-index/update
-                        changed = search_operation.update_existing_record(
-                            records=records,
-                            record_dict=new_record,
-                            prev_record_dict_version=prev_record_dict_version,
-                            source=self.search_source,
-                            update_time_variant_fields=rerun,
-                        )
-                        if changed:
-                            pdf_backward_search_feed.nr_changed += 1
-
             except colrev_exceptions.TEIException:
                 search_operation.review_manager.logger.info("Eror accessing TEI")
 
         self.__complement_with_open_citations_data(
             pdf_backward_search_feed=pdf_backward_search_feed, records=records
         )
 
@@ -389,15 +404,15 @@
         return record
 
     def prepare(
         self, record: colrev.record.PrepRecord, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for PDF backward searches (GROBID)"""
 
-        record.format_if_mostly_upper(key="title", case="title")
+        record.format_if_mostly_upper(key="title", case="sentence")
         record.format_if_mostly_upper(key="journal", case="title")
         record.format_if_mostly_upper(key="booktitle", case="title")
         record.format_if_mostly_upper(key="author", case="title")
 
         if (
             "multimedia appendix"
             in record.data.get("title", "").lower()
@@ -405,11 +420,7 @@
         ):
             record.prescreen_exclude(reason="grobid-error")
 
         if record.data["ENTRYTYPE"] == "misc" and "publisher" in record.data:
             record.data["ENTRYTYPE"] = "book"
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/pdfs_dir.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/pdfs_dir.py`

 * *Files 4% similar despite different names*

```diff
@@ -735,27 +735,87 @@
                 record_dict=record_dict, params=self.search_source.search_parameters
             )
             record = colrev.record.Record(data=record_dict)
             missing_field_checker.apply_curation_restrictions(record=record)
 
         return records
 
+    def __fix_special_chars(self, *, record: colrev.record.Record) -> None:
+        # TODO : extract to separate scripts and also apply upon loading tei content
+        if "title" in record.data:
+            record.data["title"] = (
+                record.data["title"]
+                .replace("n ", "")
+                .replace("u ", "")
+                .replace(" ", "")
+                .replace("a ", "")
+                .replace("o ", "")
+                .replace("e ", "")
+                .replace("c ", "")
+                .replace("a ", "")
+            )
+
+        if "author" in record.data:
+            record.data["author"] = (
+                record.data["author"]
+                .replace("n ", "")
+                .replace("u ", "")
+                .replace(" ", "")
+                .replace("a ", "")
+                .replace("o ", "")
+                .replace("e ", "")
+                .replace("c ", "")
+                .replace("a ", "")
+            )
+
+    def __fix_title_suffix(self, *, record: colrev.record.Record) -> None:
+        if "title" not in record.data:
+            return
+        if record.data["title"].endswith("Formula 1"):
+            return
+        if re.match(r"\d{4}$", record.data["title"]):
+            return
+        if record.data.get("title", "").endswith(" 1"):
+            record.data["title"] = record.data["title"][:-2]
+
+    def __fix_special_outlets(self, *, record: colrev.record.Record) -> None:
+        # Erroneous suffixes in IS conferences
+        if record.data.get("booktitle", "") in [
+            "Americas Conference on Information Systems",
+            "International Conference on Information Systems",
+            "European Conference on Information Systems",
+        ]:
+            for suffix in [
+                "completed research paper",
+                "completed research",
+                "complete research",
+                "full research paper",
+                "research in progress",
+            ]:
+                if record.data["title"].lower().endswith(suffix):
+                    record.data["title"] = record.data["title"][: -len(suffix)].rstrip(
+                        " -"
+                    )
+        # elif ...
+
     def prepare(
         self, record: colrev.record.PrepRecord, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for PDF directories (GROBID)"""
 
-        record.format_if_mostly_upper(key="title", case="title")
+        record.format_if_mostly_upper(key="title", case="sentence")
         record.format_if_mostly_upper(key="journal", case="title")
         record.format_if_mostly_upper(key="booktitle", case="title")
         record.format_if_mostly_upper(key="author", case="title")
 
         if "author" in record.data:
-            record.data["author"] = record.data["author"].rstrip(
-                " and T I C L E I N F O, A. R"
+            record.data["author"] = (
+                record.data["author"]
+                .replace(" and T I C L E I N F O, A. R", "")
+                .replace(" and Quarterly, Mis", "")
             )
 
         # Typical error in old papers: title fields are equal to journal/booktitle fields
         if record.data.get("title", "no_title").lower() == record.data.get(
             "journal", "no_journal"
         ):
             record.remove_field(key="title", source="pdfs_dir_prepare")
@@ -765,13 +825,12 @@
         if record.data.get("title", "no_title").lower() == record.data.get(
             "booktitle", "no_booktitle"
         ):
             record.remove_field(key="title", source="pdfs_dir_prepare")
             record.set_status(
                 target_state=colrev.record.RecordState.md_needs_manual_preparation
             )
+        self.__fix_title_suffix(record=record)
+        self.__fix_special_chars(record=record)
+        self.__fix_special_outlets(record=record)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/psycinfo.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/psycinfo.py`

 * *Files 4% similar despite different names*

```diff
@@ -113,11 +113,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for PsycINFO"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/pubmed.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/pubmed.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/pubmed.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/pubmed.py`

 * *Files 0% similar despite different names*

```diff
@@ -412,15 +412,16 @@
 
                 record.merge(
                     merging_record=retrieved_record,
                     default_source=retrieved_record.data["colrev_origin"][0],
                 )
 
                 record.set_masterdata_complete(
-                    source=retrieved_record.data["colrev_origin"][0]
+                    source=retrieved_record.data["colrev_origin"][0],
+                    masterdata_repository=self.review_manager.settings.is_curated_repo(),
                 )
                 record.set_status(target_state=colrev.record.RecordState.md_prepared)
                 if save_feed:
                     pubmed_feed.save_feed_file()
                 self.pubmed_lock.release()
                 return record
             except (
@@ -690,11 +691,7 @@
                 input_string=record.data["author"]
             )
 
         # TBD: how to distinguish other types?
         record.change_entrytype(new_entrytype="article", qm=self.quality_model)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/scopus.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/scopus.py`

 * *Files 4% similar despite different names*

```diff
@@ -118,14 +118,19 @@
         return records
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Scopus"""
 
+        if "book" == record.data["ENTRYTYPE"]:
+            if "journal" in record.data and "booktitle" not in record.data:
+                record.rename_field(key="title", new_key="booktitle")
+                record.rename_field(key="journal", new_key="title")
+
         if "document_type" in record.data:
             if record.data["document_type"] == "Conference Paper":
                 record.change_entrytype(
                     new_entrytype="inproceedings", qm=self.quality_model
                 )
 
             elif record.data["document_type"] == "Conference Review":
@@ -153,16 +158,11 @@
                 record.data["cited_by"] = record.data["cited_by"].replace(
                     "cited By ", ""
                 )
 
         if "author" in record.data:
             record.data["author"] = record.data["author"].replace("; ", " and ")
 
-        drop = ["source"]
-        for field_to_drop in drop:
-            record.remove_field(key=field_to_drop)
+        record.remove_field(key="source")
+        record.remove_field(key="art_number")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/springer_link.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/springer_link.py`

 * *Files 1% similar despite different names*

```diff
@@ -176,11 +176,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Springer Link"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/systematic_review_datasets.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/systematic_review_datasets.py`

 * *Files 2% similar despite different names*

```diff
@@ -150,11 +150,7 @@
                 "author",
                 "title",
             ]:
                 if key in retrieved_record.data:
                     record.data[key] = retrieved_record.data[key]
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/taylor_and_francis.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/taylor_and_francis.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,11 +1,12 @@
 #! /usr/bin/env python
 """SearchSource: Taylor and Francis"""
 from __future__ import annotations
 
+import re
 import typing
 from dataclasses import dataclass
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
@@ -97,13 +98,13 @@
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Taylor and Francis"""
 
         # remove eprint and URL fields (they only have dois...)
         record.remove_field(key="url")
         record.remove_field(key="eprint")
+        if "note" in record.data and re.match(r"PMID: \d*", record.data["note"]):
+            record.rename_field(key="note", new_key="pmid")
+            record.data["pmid"] = record.data["pmid"][6:]
+        record.remove_field(key="publisher")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/trid.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/acm_digital_library.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #! /usr/bin/env python
-"""SearchSource: Transport Research International Documentation"""
+"""SearchSource: ACM Digital Library"""
 from __future__ import annotations
 
 import typing
 from dataclasses import dataclass
 from pathlib import Path
 
 import zope.interface
@@ -11,43 +11,64 @@
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.search
 import colrev.record
 
-
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 @dataclass
-class TransportResearchInternationalDocumentation(JsonSchemaMixin):
-    """SearchSource for Transport Research International Documentation"""
+class ACMDigitalLibrarySearchSource(JsonSchemaMixin):
+    """SearchSource for the ACM digital Library"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
-    source_identifier = "biburl"
+    # Note : the ID contains the doi
+    # "https://dl.acm.org/doi/{{ID}}"
+    source_identifier = "doi"
     search_type = colrev.settings.SearchType.DB
     api_search_supported = False
     ci_supported: bool = False
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
-    short_name = "TRID"
+    short_name = "ACM Digital Library"
     link = (
-        "https://github.com/CoLRev-Environment/colrev/blob/main/"
-        + "colrev/ops/built_in/search_sources/trid.md"
+        "https://github.com/CoLRev-Environment/colrev/blob/main/colrev/"
+        + "ops/built_in/search_sources/acm_digital_library.md"
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
 
+    @classmethod
+    def heuristic(cls, filename: Path, data: str) -> dict:
+        """Source heuristic for ACM dDigital Library"""
+
+        result = {"confidence": 0.0}
+        # Simple heuristic:
+        if "publisher = {Association for Computing Machinery}," in data:
+            result["confidence"] = 0.7
+            print(data)
+            return result
+        # We may also check whether the ID=doi=url
+        return result
+
+    @classmethod
+    def add_endpoint(
+        cls, search_operation: colrev.ops.search.Search, query: str
+    ) -> colrev.settings.SearchSource:
+        """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
+        raise NotImplementedError
+
     def validate_source(
         self,
         search_operation: colrev.ops.search.Search,
         source: colrev.settings.SearchSource,
     ) -> None:
         """Validate the SearchSource (parameters etc.)"""
 
@@ -66,36 +87,18 @@
                 f"for ({source.filename})"
             )
 
         search_operation.review_manager.logger.debug(
             f"SearchSource {source.filename} validated"
         )
 
-    @classmethod
-    def heuristic(cls, filename: Path, data: str) -> dict:
-        """Source heuristic for Transport Research International Documentation"""
-
-        result = {"confidence": 0.0}
-        # Simple heuristic:
-        if "UR  - https://trid.trb.org/view/" in data:
-            result["confidence"] = 0.9
-            return result
-        return result
-
-    @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
-        """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
-        raise NotImplementedError
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
-        """Run a search of TRID"""
+        """Run a search of ACM Digital Library"""
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
@@ -105,21 +108,23 @@
 
     def load_fixes(
         self,
         load_operation: colrev.ops.load.Load,
         source: colrev.settings.SearchSource,
         records: typing.Dict,
     ) -> dict:
-        """Load fixes for Transport Research International Documentation"""
+        """Load fixes for ACM Digital Library"""
 
         return records
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
-        """Source-specific preparation for Transport Research International Documentation"""
+        """Source-specific preparation for ACM Digital Library"""
+        record.remove_field(key="url")
+        record.remove_field(key="numpages")
+        record.remove_field(key="issue_date")
+        record.remove_field(key="publisher")
+        record.remove_field(key="address")
+        record.remove_field(key="month")
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/unknown_source.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/unknown_source.py`

 * *Files 1% similar despite different names*

```diff
@@ -371,11 +371,7 @@
         self.__format_fields(record=record)
 
         self.__remove_redundant_fields(record=record)
 
         self.__unify_special_characters(record=record)
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/utils.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -121,20 +121,20 @@
                 value = value[8:]
         record_dict[key] = value
 
     return record_dict
 
 
 def __set_forthcoming(*, record_dict: dict) -> dict:
-    if (
-        not any(x in record_dict for x in ["published-print", "published"])
-        and "year" in record_dict
+    if not any(x in record_dict for x in ["published-print", "published"]) or not any(
+        x in record_dict for x in ["volume", "number"]
     ):
-        record_dict.update(published_online=record_dict["year"])
         record_dict.update(year="forthcoming")
+        if "year" in record_dict:
+            record_dict.update(published_online=record_dict["year"])
     return record_dict
 
 
 def __remove_fields(*, record_dict: dict) -> dict:
     # Drop empty and non-supported fields
     supported_fields = [
         "ENTRYTYPE",
@@ -171,11 +171,7 @@
         record_dict = __remove_fields(record_dict=record_dict)
     except (IndexError, KeyError) as exc:
         raise colrev_exceptions.RecordNotParsableException(
             f"RecordNotParsableException: {exc}"
         ) from exc
 
     return record_dict
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/video_dir.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/video_dir.py`

 * *Files 1% similar despite different names*

```diff
@@ -182,11 +182,7 @@
             if url_record.data.get("title", "") != "":
                 record.update_field(
                     key="title", value=url_record.data["title"], source="website"
                 )
             self.zotero_lock.release()
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/web_of_science.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/web_of_science.py`

 * *Files 17% similar despite different names*

```diff
@@ -135,15 +135,16 @@
         return records
 
     def prepare(
         self, record: colrev.record.PrepRecord, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Web of Science"""
 
-        if record.data.get("title", "UNKNOWN") != "UNKNOWN":
-            record.format_if_mostly_upper(key="title")
-
-        return record
+        record.format_if_mostly_upper(key="title", case="sentence")
+        record.format_if_mostly_upper(key="journal", case="title")
+        record.format_if_mostly_upper(key="booktitle", case="title")
+        record.format_if_mostly_upper(key="author", case="title")
 
+        record.remove_field(key="researcherid-numbers")
+        record.remove_field(key="orcid-numbers")
 
-if __name__ == "__main__":
-    pass
+        return record
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/website.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/website.py`

 * *Files 5% similar despite different names*

```diff
@@ -2,26 +2,24 @@
 """Connector to website (API)"""
 from __future__ import annotations
 
 import json
 import re
 from multiprocessing import Lock
 from typing import Optional
+from typing import TYPE_CHECKING
 from urllib.parse import urlparse
 
 import requests
 
 import colrev.ops.built_in.search_sources.doi_org as doi_connector
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING  # pylint: disable=ungrouped-imports
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # Note: not implemented as a full search_source
 # (including SearchSourcePackageEndpointInterface, packages_endpoints.json)
 
 
 # pylint: disable=too-few-public-methods
 
@@ -182,11 +180,7 @@
             UnicodeEncodeError,
             requests.exceptions.RequestException,
             KeyError,
         ):
             pass
 
         self.zotero_lock.release()
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/wiley.md` & `colrev-0.9.0/colrev/ops/built_in/search_sources/wiley.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ops/built_in/search_sources/wiley.py` & `colrev-0.9.0/colrev/ops/built_in/search_sources/wiley.py`

 * *Files 2% similar despite different names*

```diff
@@ -116,11 +116,7 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Wiley"""
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/clone.py` & `colrev-0.9.0/colrev/ops/clone.py`

 * *Files 3% similar despite different names*

```diff
@@ -37,11 +37,7 @@
             print("Not a CoLRev repository.")
             return
         environment_manager = review_manager.get_environment_manager()
         environment_manager.register_repo(path_to_register=self.local_path)
         local_index = review_manager.get_local_index()
 
         local_index.index_colrev_project(repo_source_path=self.local_path)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/commit.py` & `colrev-0.9.0/colrev/ops/commit.py`

 * *Files 1% similar despite different names*

```diff
@@ -6,25 +6,23 @@
 import os
 import shutil
 import sys
 import tempfile
 from importlib.metadata import version
 from pathlib import Path
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import git
 
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 class Commit:
     """Create commits"""
 
     # pylint: disable=too-many-instance-attributes
     # pylint: disable=too-few-public-methods
@@ -243,11 +241,7 @@
         return False
 
     def update_report(self, *, msg_file: Path) -> None:
         """Update the report"""
         report = self.__get_commit_report()
         with open(msg_file, "a", encoding="utf8") as file:
             file.write(report)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/correct.py` & `colrev-0.9.0/colrev/ops/correct.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 #!/usr/bin/env python3
 """Create and apply record corrections in source repositories."""
 from __future__ import annotations
 
 import json
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 from dictdiffer import diff
 
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 # pylint: disable=too-few-public-methods
 
 
 class Corrections:
     """Handling corrections of metadata"""
 
@@ -218,11 +216,7 @@
                     # if not original_record:
                     #     continue
 
                     self.__create_change_item(
                         original_record=prior_r,
                         corrected_record=corrected_record,
                     )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/data.py` & `colrev-0.9.0/colrev/ops/data.py`

 * *Files 1% similar despite different names*

```diff
@@ -395,11 +395,7 @@
             self.review_manager.settings.data.data_package_endpoints
         )
 
         return {
             "ask_to_commit": self.review_manager.dataset.has_changes(),
             "no_endpoints_registered": no_endpoints_registered,
         }
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/dedupe.py` & `colrev-0.9.0/colrev/ops/dedupe.py`

 * *Files 3% similar despite different names*

```diff
@@ -4,28 +4,26 @@
 
 import re
 import string
 import typing
 from collections import Counter
 from pathlib import Path
 from typing import Optional
+from typing import TYPE_CHECKING
 
 import pandas as pd
 
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 import colrev.record
 import colrev.settings
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 # pylint: disable=too-many-lines
 
 
 class Dedupe(colrev.operation.Operation):
     """Deduplicate records (entity resolution)"""
 
@@ -486,14 +484,16 @@
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
         return set_to_md_processed
 
     def __skip_merge_condition(
         self, *, main_record: colrev.record.Record, dupe_record: colrev.record.Record
     ) -> bool:
+        if self.review_manager.force_mode:
+            return False
         if self.__is_cross_level_merge(
             main_record=main_record, dupe_record=dupe_record
         ):
             self.review_manager.logger.info(
                 "Prevented cross-level merge: "
                 f"{main_record.data['ID']} - {dupe_record.data['ID']}"
             )
@@ -679,20 +679,18 @@
             if unmerged:
                 break
         return records
 
     def __unmerge_previous_id_lists_records(self, *, previous_id_lists: list) -> dict:
         records = self.review_manager.dataset.load_records_dict()
         git_repo = self.review_manager.dataset.get_repo()
+        # print(self.review_manager.dataset.RECORDS_FILE_RELATIVE.is_file())
+        # r_path = join_path_native("data", "records.bib")
         revlist = (
-            (
-                (
-                    commit.tree / str(self.review_manager.dataset.RECORDS_FILE_RELATIVE)
-                ).data_stream.read()
-            )
+            (commit.tree / "data" / "records.bib").data_stream.read()
             for commit in git_repo.iter_commits(
                 paths=str(self.review_manager.dataset.RECORDS_FILE_RELATIVE)
             )
         )
 
         unmerged = False
         for filecontents in revlist:
@@ -772,90 +770,25 @@
             records = self.__unmerge_previous_id_lists_records(
                 previous_id_lists=previous_id_lists
             )
 
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
 
-    def fix_errors(self) -> None:
-        """Fix errors as highlighted in the Excel files"""
-
-        # pylint: disable=too-many-branches
-
-        self.review_manager.report_logger.info("Dedupe: fix errors")
-        self.review_manager.logger.info("Dedupe: fix errors")
-
-        if self.dupe_file.is_file():
-            dupes = pd.read_excel(self.dupe_file)
-            dupes.fillna("", inplace=True)
-            c_to_correct = dupes.loc[dupes["error"] != "", "cluster_id"].to_list()
-            dupes = dupes[dupes["cluster_id"].isin(c_to_correct)]
-            previous_ids_to_unmerge = (
-                dupes.groupby(["cluster_id"], group_keys=False)["ID"]
-                .apply(list)
-                .tolist()
-            )
+    def fix_errors(self, *, false_positives: list, false_negatives: list) -> None:
+        """Fix lists of errors"""
 
-            if previous_ids_to_unmerge:
-                self.unmerge_records(previous_id_lists=previous_ids_to_unmerge)
-
-        if self.non_dupe_file_xlsx.is_file() or self.non_dupe_file_txt.is_file():
-            ids_to_merge = []
-            if self.non_dupe_file_xlsx.is_file():
-                non_dupes = pd.read_excel(self.non_dupe_file_xlsx)
-                non_dupes.fillna("", inplace=True)
-                c_to_correct = non_dupes.loc[
-                    non_dupes["error"] != "", "cluster_id"
-                ].to_list()
-                non_dupes = non_dupes[non_dupes["cluster_id"].isin(c_to_correct)]
-                ids_to_merge = (
-                    non_dupes.groupby(["cluster_id"], group_keys=False)["ID"]
-                    .apply(list)
-                    .tolist()
-                )
-            if self.non_dupe_file_txt.is_file():
-                content = self.non_dupe_file_txt.read_text()
-                ids_to_merge = [x.split(",") for x in content.splitlines()]
-                for id_1, id_2 in ids_to_merge:
-                    print(f"{id_1} - {id_2}")
-
-            dedupe_errors = []
-            for id_list in ids_to_merge:
-                if 2 == len(id_list):
-                    dedupe_errors.append(
-                        {
-                            "ID1": id_list[0],
-                            "ID2": id_list[1],
-                            "decision": "duplicate",
-                        }
-                    )
-                else:
-                    for i, idc in enumerate(id_list):
-                        if 0 == i:
-                            continue
-                        dedupe_errors.append(
-                            {
-                                "ID1": id_list[0],
-                                "ID2": idc,
-                                "decision": "duplicate",
-                            }
-                        )
-            self.apply_merges(results=dedupe_errors, complete_dedupe=False)
+        self.unmerge_records(previous_id_lists=false_positives)
+        self.apply_merges(results=false_negatives, complete_dedupe=False)
 
         if self.review_manager.dataset.records_changed():
             self.review_manager.create_commit(
                 msg="Validate and correct duplicates",
                 manual_author=True,
             )
-        if not (
-            self.dupe_file.is_file()
-            or self.non_dupe_file_xlsx.is_file()
-            or self.non_dupe_file_txt.is_file()
-        ):
-            self.review_manager.logger.error("No file with potential errors found.")
 
     def get_info(self) -> dict:
         """Get info on cuts (overlap of search sources) and same source merges"""
 
         records = self.review_manager.dataset.load_records_dict()
 
         origins = [record["colrev_origin"] for record in records.values()]
@@ -1032,11 +965,7 @@
 
             self.review_manager.dataset.save_records_dict(records=records)
             self.review_manager.dataset.add_record_changes()
             self.review_manager.create_commit(msg="Skip prescreen/include all")
 
         if self.review_manager.in_ci_environment():
             print("\n\n")
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/distribute.py` & `colrev-0.9.0/colrev/ops/distribute.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 #! /usr/bin/env python
 """Distribte records or PDFs to local CoLRev repositories."""
 from __future__ import annotations
 
 import os
 import shutil
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import colrev.operation
 import colrev.settings
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 class Distribute(colrev.operation.Operation):
     """Distribute records to other local CoLRev projects"""
 
     def __init__(self, *, review_manager: colrev.review_manager.ReviewManager) -> None:
         # pylint: disable=duplicate-code
@@ -117,11 +115,7 @@
 
                 import_records_dict = {r["ID"]: r for r in import_records}
                 self.review_manager.dataset.save_records_dict_to_file(
                     records=import_records_dict, save_path=target_bib_file
                 )
 
                 self.review_manager.dataset.add_changes(path=target_bib_file)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/init.py` & `colrev-0.9.0/colrev/ops/init.py`

 * *Files 1% similar despite different names*

```diff
@@ -442,11 +442,7 @@
             Initializer(
                 review_type="colrev.literature_review",
                 local_pdf_collection=True,
             )
             self.logger.info("Created local_pdf_collection repository")
 
         os.chdir(self.target_path)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/load.py` & `colrev-0.9.0/colrev/ops/load.py`

 * *Files 0% similar despite different names*

```diff
@@ -735,15 +735,15 @@
         if source.get_corresponding_bib_file().is_file():
             search_records = self.__getbib(file=source.get_corresponding_bib_file())
             self.review_manager.logger.debug(
                 f"Loaded {source.get_corresponding_bib_file().name} "
                 f"with {len(search_records)} records"
             )
         else:
-            self.review_manager.logger.error(
+            self.review_manager.logger.debug(
                 f"Did not find bib file {source.get_corresponding_bib_file().name} "
             )
             return []
 
         if len(search_records) == 0:
             self.review_manager.logger.info(
                 f"{colors.GREEN}No records to load{colors.END}"
@@ -1018,11 +1018,7 @@
             self.review_manager.create_commit(msg="Load (multiple)")
 
         self.review_manager.logger.info(
             f"{colors.GREEN}Completed load operation{colors.END}"
         )
         if self.review_manager.in_ci_environment():
             print("\n\n")
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/merge.py` & `colrev-0.9.0/colrev/ops/merge.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 #!/usr/bin/env python3
 """Merge branches of CoLRev projects."""
 from __future__ import annotations
 
 import copy
+from typing import TYPE_CHECKING
 
 from dictdiffer import diff
 from git.exc import GitCommandError
 
 import colrev.env.utils
 import colrev.operation
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 # pylint: disable=too-few-public-methods
 
 
 class Merge(colrev.operation.Operation):
     """Merge branches of CoLRev project"""
@@ -245,11 +243,7 @@
         print(
             f"\n{colors.ORANGE}Please add (git add .) and commit (git commit){colors.END}"
         )
 
         # Note : cannot add/create commit yet - not yet supported by gitpython:
         # https://github.com/gitpython-developers/GitPython/issues/1185
         # our_index.write(ignore_extension_data=True)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/pdf_get.py` & `colrev-0.9.0/colrev/ops/pdf_get.py`

 * *Files 0% similar despite different names*

```diff
@@ -627,15 +627,17 @@
 
         records = self.review_manager.dataset.load_records_dict()
         records = self.__set_status_if_file_linked(records=records)
         records = self.check_existing_unlinked_pdfs(records=records)
 
         pdf_get_data = self.__get_data()
 
-        if pdf_get_data["nr_tasks"] > 0:
+        if pdf_get_data["nr_tasks"] == 0:
+            self.review_manager.logger.info("No additional pdfs to retrieve")
+        else:
             self.review_manager.logger.info(
                 "PDFs to get".ljust(38) + f'{pdf_get_data["nr_tasks"]} PDFs'
             )
 
             pool = Pool(4)
             retrieved_record_list = pool.map(self.get_pdf, pdf_get_data["items"])
             pool.close()
@@ -643,28 +645,16 @@
 
             self.review_manager.dataset.save_records_dict(
                 records={r["ID"]: r for r in retrieved_record_list}, partial=True
             )
 
             self._print_stats(retrieved_record_list=retrieved_record_list)
 
-            # Note: rename should be after copy.
-            # Note : do not pass records as an argument.
-            if self.review_manager.settings.pdf_get.rename_pdfs:
-                self.rename_pdfs()
-
-        else:
-            self.review_manager.logger.info("No additional pdfs to retrieve")
-
-            # Note: rename should be after copy.
-            # Note : do not pass records as an argument.
-            if self.review_manager.settings.pdf_get.rename_pdfs:
-                self.rename_pdfs()
+        # Note: rename should be after copy.
+        # Note : do not pass records as an argument.
+        if self.review_manager.settings.pdf_get.rename_pdfs:
+            self.rename_pdfs()
 
         self.review_manager.create_commit(msg="Get PDFs")
         self.review_manager.logger.info(
             f"{colors.GREEN}Completed pdf-get operation{colors.END}"
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/pdf_get_man.py` & `colrev-0.9.0/colrev/ops/pdf_get_man.py`

 * *Files 2% similar despite different names*

```diff
@@ -209,11 +209,7 @@
             pdf_get_man_package_endpoint
         ) in self.review_manager.settings.pdf_get.pdf_get_man_package_endpoints:
             endpoint = self.pdf_get_man_package_endpoints[
                 pdf_get_man_package_endpoint["endpoint"]
             ]
 
             records = endpoint.pdf_get_man(self, records)  # type: ignore
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/pdf_prep.py` & `colrev-0.9.0/colrev/ops/pdf_prep.py`

 * *Files 1% similar despite different names*

```diff
@@ -452,11 +452,7 @@
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
 
         self.review_manager.create_commit(msg="Prepare PDFs")
         self.review_manager.logger.info(
             f"{colors.GREEN}Completed pdf-prep operation{colors.END}"
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/pdf_prep_man.py` & `colrev-0.9.0/colrev/ops/pdf_prep_man.py`

 * *Files 1% similar despite different names*

```diff
@@ -347,11 +347,7 @@
                 selected_packages=pdf_prep_man_package_endpoints,
                 operation=self,
             )
 
             endpoint = endpoint_dict[pdf_prep_man_package_endpoint["endpoint"]]
 
             records = endpoint.pdf_prep_man(self, records)  # type: ignore
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/prep.py` & `colrev-0.9.0/colrev/ops/prep.py`

 * *Files 3% similar despite different names*

```diff
@@ -281,14 +281,72 @@
                     start_time=start_time,
                     prep_round_package_endpoint=prep_round_package_endpoint,
                 )
                 self.review_manager.logger.error(exc)
             else:
                 raise exc
 
+    def __print_post_package_prep_polish_info(
+        self,
+        *,
+        record: colrev.record.PrepRecord,
+        prior_state: colrev.record.RecordState,
+        progress: str,
+    ) -> None:
+        # records in post_md_prepared remain in that state (in polish mode)
+        if (
+            record.data["colrev_status"]
+            in colrev.record.RecordState.get_post_x_states(
+                state=colrev.record.RecordState.md_prepared
+            )
+            and prior_state != colrev.record.RecordState.md_needs_manual_preparation
+        ) or (
+            prior_state == colrev.record.RecordState.md_needs_manual_preparation
+            and record.data["colrev_status"]
+            == colrev.record.RecordState.md_needs_manual_preparation
+        ):
+            self.review_manager.logger.info(
+                f" {record.data['ID']}".ljust(41) + f"{progress} - "
+            )
+        elif (
+            record.data["colrev_status"]
+            == colrev.record.RecordState.rev_prescreen_excluded
+        ):
+            self.review_manager.logger.info(
+                f" {colors.RED}{record.data['ID']}".ljust(46)
+                + f"{progress}{prior_state}   {record.data['colrev_status']}"
+                + f"{colors.END}"
+            )
+        elif (
+            record.data["colrev_status"]
+            == colrev.record.RecordState.md_needs_manual_preparation
+        ):
+            self.review_manager.logger.info(
+                f" {colors.ORANGE}{record.data['ID']}".ljust(46)
+                + f"{progress}{prior_state}   {record.data['colrev_status']}{colors.END}"
+            )
+        elif record.data["colrev_status"] == colrev.record.RecordState.md_prepared:
+            curation_addition = "   "
+            if record.masterdata_is_curated():
+                curation_addition = "  "
+            self.review_manager.logger.info(
+                f" {colors.GREEN}{record.data['ID']}".ljust(46)
+                + f"{progress}{prior_state}   "
+                f"{record.data['colrev_status']}{colors.END}{curation_addition}"
+            )
+
+        elif (
+            record.data["colrev_status"]
+            == colrev.record.RecordState.md_needs_manual_preparation
+        ):
+            self.review_manager.logger.info(
+                f" {colors.ORANGE}{record.data['ID']}".ljust(46)
+                + f"{progress}{prior_state}   {record.data['colrev_status']}{colors.END}"
+            )
+
     def __print_post_package_prep_info(
         self,
         record: colrev.record.PrepRecord,
         item: dict,
         prior_state: colrev.record.RecordState,
     ) -> None:
         # pylint: disable=redefined-outer-name,invalid-name
@@ -296,89 +354,111 @@
             PREP_COUNTER.value += 1  # type: ignore
         progress = ""
         if item["nr_items"] > 100:
             progress = f"({PREP_COUNTER.value}/{item['nr_items']}) ".rjust(  # type: ignore
                 12, " "
             )
 
-        if record.preparation_break_condition():
-            if (
-                colrev.record.RecordState.rev_prescreen_excluded
-                == record.data["colrev_status"]
-            ):
-                if self.review_manager.verbose_mode:
+        if self.polish:
+            self.__print_post_package_prep_polish_info(
+                record=record, prior_state=prior_state, progress=progress
+            )
+        else:
+            if record.preparation_break_condition():
+                if (
+                    colrev.record.RecordState.rev_prescreen_excluded
+                    == record.data["colrev_status"]
+                ):
+                    if self.review_manager.verbose_mode:
+                        self.review_manager.logger.info(
+                            f" {colors.RED}{record.data['ID']}".ljust(46)
+                            + f"Detected: {record.data.get('prescreen_exclusion', 'NA')}"
+                            + f"{colors.END}"
+                        )
+                    target_state = colrev.record.RecordState.rev_prescreen_excluded
                     self.review_manager.logger.info(
                         f" {colors.RED}{record.data['ID']}".ljust(46)
-                        + f"Detected: {record.data.get('prescreen_exclusion', 'NA')}"
+                        + f"{progress}{prior_state}   {target_state}"
                         + f"{colors.END}"
                     )
-                target_state = colrev.record.RecordState.rev_prescreen_excluded
-                if self.polish:
-                    target_state = prior_state
+                else:
+                    target_state = colrev.record.RecordState.md_needs_manual_preparation
+                    self.review_manager.logger.info(
+                        f" {colors.ORANGE}{record.data['ID']}".ljust(46)
+                        + f"{progress}{prior_state}   {target_state}{colors.END}"
+                    )
+
+            elif record.preparation_save_condition():
+                curation_addition = "   "
+                if record.masterdata_is_curated():
+                    curation_addition = "  "
+                target_state = colrev.record.RecordState.md_prepared
                 self.review_manager.logger.info(
-                    f" {colors.RED}{record.data['ID']}".ljust(46)
-                    + f"{progress}{prior_state}   {target_state}"
-                    + f"{colors.END}"
+                    f" {colors.GREEN}{record.data['ID']}".ljust(46)
+                    + f"{progress}{prior_state}   {target_state}{colors.END}{curation_addition}"
                 )
             else:
                 target_state = colrev.record.RecordState.md_needs_manual_preparation
-                if self.polish:
-                    target_state = prior_state
                 self.review_manager.logger.info(
                     f" {colors.ORANGE}{record.data['ID']}".ljust(46)
                     + f"{progress}{prior_state}   {target_state}{colors.END}"
                 )
 
-        elif record.preparation_save_condition():
-            curation_addition = "   "
-            if record.masterdata_is_curated():
-                curation_addition = "  "
-            target_state = colrev.record.RecordState.md_prepared
-            if self.polish:
-                target_state = prior_state
-            self.review_manager.logger.info(
-                f" {colors.GREEN}{record.data['ID']}".ljust(46)
-                + f"{progress}{prior_state}   {target_state}{colors.END}{curation_addition}"
-            )
-        else:
-            target_state = colrev.record.RecordState.md_needs_manual_preparation
-            if self.polish:
-                target_state = prior_state
-            self.review_manager.logger.info(
-                f" {colors.ORANGE}{record.data['ID']}".ljust(46)
-                + f"{progress}{prior_state}   {target_state}{colors.END}"
-            )
-
     def __post_package_prep(
         self,
         record: colrev.record.PrepRecord,
         preparation_record: colrev.record.PrepRecord,
         item: dict,
         prior_state: colrev.record.RecordState,
     ) -> None:
-        if not self.review_manager.verbose_mode:
-            self.__print_post_package_prep_info(
-                record=record, item=item, prior_state=prior_state
-            )
-
         if self.last_round and not self.polish:
             if record.status_to_prepare():
                 for key in list(record.data.keys()):
                     if key not in self.fields_to_keep:
                         record.remove_field(key=key)
                     elif record.data[key] in ["", "NA"]:
                         record.remove_field(key=key)
                 record.update_by_record(update_record=preparation_record)
                 # Note: update_masterdata_provenance sets to md_needs_manual_preparation
                 record.update_masterdata_provenance(
                     qm=self.quality_model, set_prepared=True
                 )
 
         if self.polish:
-            record.set_status(target_state=prior_state)
+            errors_prior = {
+                k: y
+                for k, v in record.data.get("colrev_masterdata_provenance", {}).items()
+                for y in v["note"].split(",")
+                if y not in ["not-missing", "forthcoming"]
+            }
+            record.update_masterdata_provenance(qm=self.quality_model)
+            errors_post = {
+                k: y
+                for k, v in record.data.get("colrev_masterdata_provenance", {}).items()
+                for y in v["note"].split(",")
+                if y not in ["not-missing", "forthcoming"]
+            }
+            additional_errors = set(errors_post.items()) - set(errors_prior.items())
+            if (
+                additional_errors
+                and prior_state != colrev.record.RecordState.rev_prescreen_excluded
+            ):
+                record.set_status(
+                    target_state=colrev.record.RecordState.md_needs_manual_preparation,
+                    force=True,
+                )
+            elif prior_state == colrev.record.RecordState.md_needs_manual_preparation:
+                record.set_status(target_state=colrev.record.RecordState.md_prepared)
+            else:
+                record.set_status(target_state=prior_state, force=True)
+
+        if not self.review_manager.verbose_mode:
+            self.__print_post_package_prep_info(
+                record=record, item=item, prior_state=prior_state
+            )
 
     # Note : no named arguments for multiprocessing
     def prepare(self, item: dict) -> dict:
         """Prepare a record (based on package_endpoints in the settings)"""
 
         record: colrev.record.PrepRecord = item["record"]
 
@@ -444,17 +524,15 @@
 
     def __get_revlist_for_reset(self) -> typing.Iterator[tuple]:
         git_repo = self.review_manager.dataset.get_repo()
         revlist = (
             (
                 commit.hexsha,
                 commit.message,
-                (
-                    commit.tree / str(self.review_manager.dataset.RECORDS_FILE_RELATIVE)
-                ).data_stream.read(),
+                (commit.tree / "data" / "records.bib").data_stream.read(),
             )
             for commit in git_repo.iter_commits(
                 paths=str(self.review_manager.dataset.RECORDS_FILE_RELATIVE)
             )
         )
         return revlist
 
@@ -1113,17 +1191,13 @@
             if 24 == exc.errno:
                 raise colrev_exceptions.ServiceNotAvailableException(
                     "Too many files opened (OSError, Errno24). "
                     "To use a smaller number of parallel processes, run colrev prep --cpu 1"
                 ) from exc
             raise exc
 
-        if not keep_ids and not self.debug_mode:
+        if not keep_ids and not self.debug_mode and not self.polish:
             self.review_manager.logger.info("Set record IDs")
             self.review_manager.dataset.set_ids()
             self.review_manager.create_commit(msg="Set IDs")
 
         self.__post_prep()
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/prep_man.py` & `colrev-0.9.0/colrev/ops/prep_man.py`

 * *Files 1% similar despite different names*

```diff
@@ -243,15 +243,18 @@
         )
         return md_prep_man_data
 
     def set_data(self, *, record_dict: dict) -> None:
         """Set data in the prep_man operation"""
 
         record = colrev.record.PrepRecord(data=record_dict)
-        record.set_masterdata_complete(source="prep_man")
+        record.set_masterdata_complete(
+            source="prep_man",
+            masterdata_repository=self.review_manager.settings.is_curated_repo(),
+        )
         record.set_masterdata_consistent()
         # record.set_fields_complete()
         record.set_status(target_state=colrev.record.RecordState.md_prepared)
         record_dict = record.get_data()
 
         self.review_manager.dataset.save_records_dict(
             records={record_dict["ID"]: record_dict}, partial=True
@@ -277,11 +280,7 @@
             endpoint_dict = package_manager.load_packages(
                 package_type=colrev.env.package_manager.PackageEndpointType.prep_man,
                 selected_packages=self.review_manager.settings.prep.prep_man_package_endpoints,
                 operation=self,
             )
             endpoint = endpoint_dict[prep_man_package_endpoint["endpoint"]]
             records = endpoint.prepare_manual(self, records)  # type: ignore
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/prescreen.py` & `colrev-0.9.0/colrev/ops/prescreen.py`

 * *Files 5% similar despite different names*

```diff
@@ -53,28 +53,58 @@
         records = self.review_manager.dataset.load_records_dict()
         endpoint.import_table(
             prescreen_operation=self,
             records=records,
             import_table_path=import_table_path,
         )
 
+    def __include_all_in_prescreen_precondition(self, *, records: dict) -> bool:
+        if not [
+            r
+            for r in records.values()
+            if r["colrev_status"] == colrev.record.RecordState.md_processed
+        ]:
+            if [
+                r
+                for r in records.values()
+                if r["colrev_status"] == colrev.record.RecordState.pdf_prepared
+            ]:
+                self.review_manager.logger.warning(
+                    "No records to prescreen. Use "
+                    f"{colors.ORANGE}colrev screen --include_all{colors.END} instead"
+                )
+            else:
+                self.review_manager.logger.warning("No records to prescreen.")
+            return False
+        return True
+
     def include_all_in_prescreen(self, *, persist: bool) -> None:
         """Include all records in the prescreen"""
 
         if persist:
             self.review_manager.settings.prescreen.prescreen_package_endpoints = []
             self.review_manager.save_settings()
 
+        records = self.review_manager.dataset.load_records_dict()
+        if not self.__include_all_in_prescreen_precondition(records=records):
+            return
+
+        selected_record_ids = [
+            r["ID"]
+            for r in records.values()
+            if colrev.record.RecordState.md_processed == r["colrev_status"]
+        ]
+
         endpoint = (
             colrev.ops.built_in.prescreen.conditional_prescreen.ConditionalPrescreen(
                 prescreen_operation=self, settings={"endpoint": "include_all"}
             )
         )
-        records = self.review_manager.dataset.load_records_dict()
         endpoint.run_prescreen(self, records, [])
+        self.__print_stats(selected_record_ids=selected_record_ids)
 
     def include_records(self, *, ids: str) -> None:
         """Include records in the prescreen"""
 
         self.__prescreen_records(ids=ids, include=True)
 
     def exclude_records(self, *, ids: str) -> None:
@@ -335,11 +365,7 @@
             self.__print_stats(selected_record_ids=selected_record_ids)
 
         self.review_manager.logger.info(
             "%sCompleted prescreen operation%s", colors.GREEN, colors.END
         )
         if self.review_manager.in_ci_environment():
             print("\n\n")
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/pull.py` & `colrev-0.9.0/colrev/ops/pull.py`

 * *Files 5% similar despite different names*

```diff
@@ -48,11 +48,7 @@
                 f"{colors.GREEN}Updated CoLRev repository{colors.END}"
             )
         else:
             self.review_manager.logger.info(
                 f"{colors.RED}Returned flag {res[0].flags}{colors.END}"
             )
         print()
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/push.py` & `colrev-0.9.0/colrev/ops/push.py`

 * *Files 1% similar despite different names*

```diff
@@ -150,11 +150,7 @@
 
             print(f"\nPlease send the e-mail (prepared in the file {file_path})")
             input("Press Enter to confirm")
 
             for change_item in change_list:
                 if Path(change_item["file"]).is_file():
                     Path(change_item["file"]).unlink()
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/remove.py` & `colrev-0.9.0/colrev/ops/remove.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,21 +1,19 @@
 #!/usr/bin/env python3
 """Remove records, ... from CoLRev projects."""
 from __future__ import annotations
 
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import colrev.env.utils
 import colrev.operation
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 # pylint: disable=too-few-public-methods
 
 
 class Remove(colrev.operation.Operation):
     """Remove records, ... from CoLRev projects."""
@@ -59,11 +57,7 @@
                     )
                     self.review_manager.dataset.add_changes(path=filepath)
 
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
 
         self.review_manager.create_commit(msg="Remove records", manual_author=False)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/repare.py` & `colrev-0.9.0/colrev/ops/repare.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 #!/usr/bin/env python3
 """Repare CoLRev projects."""
 from __future__ import annotations
 
 import os
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 # pylint: disable=too-few-public-methods
 
 
 class Repare(colrev.operation.Operation):
     """Repare a CoLRev project"""
@@ -396,11 +394,7 @@
         #         )
 
         self.__fix_provenance(records=records)
 
         self.__fix_files(records=records)
 
         self.review_manager.dataset.save_records_dict(records=records)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/review_types.py` & `colrev-0.9.0/colrev/ops/review_types.py`

 * *Files 8% similar despite different names*

```diff
@@ -30,11 +30,7 @@
 
         self.packages: dict[str, typing.Any] = package_manager.load_packages(
             package_type=colrev.env.package_manager.PackageEndpointType.review_type,
             selected_packages=packages_to_load,
             operation=check_operation,
             ignore_not_available=False,
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/screen.py` & `colrev-0.9.0/colrev/ops/screen.py`

 * *Files 3% similar despite different names*

```diff
@@ -25,23 +25,52 @@
             review_manager=review_manager,
             operations_type=colrev.operation.OperationsType.screen,
             notify_state_transition_operation=notify_state_transition_operation,
         )
 
         self.verbose = True
 
+    def __include_all_in_screen_precondition(self, *, records: dict) -> bool:
+        if not [
+            r
+            for r in records.values()
+            if r["colrev_status"] == colrev.record.RecordState.pdf_prepared
+        ]:
+            if [
+                r
+                for r in records.values()
+                if r["colrev_status"] == colrev.record.RecordState.md_processed
+            ]:
+                self.review_manager.logger.warning(
+                    "No records to screen. Use "
+                    f"{colors.ORANGE}colrev prescreen --include_all{colors.END} instead"
+                )
+            else:
+                self.review_manager.logger.warning("No records to screen.")
+            return False
+        return True
+
     def include_all_in_screen(self, *, persist: bool) -> None:
         """Include all records in the screen"""
 
         if persist:
             self.review_manager.settings.screen.screen_package_endpoints = []
             self.review_manager.save_settings()
 
         records = self.review_manager.dataset.load_records_dict()
 
+        if not self.__include_all_in_screen_precondition(records=records):
+            return
+
+        selected_record_ids = [
+            r["ID"]
+            for r in records.values()
+            if colrev.record.RecordState.pdf_prepared == r["colrev_status"]
+        ]
+
         screening_criteria = self.get_screening_criteria()
 
         saved_args = locals()
         saved_args["include_all"] = ""
         pad = 50
         for record_id, record in records.items():
             if record["colrev_status"] != colrev.record.RecordState.pdf_prepared:
@@ -55,14 +84,15 @@
                 record.update(
                     screening_criteria=";".join([e + "=in" for e in screening_criteria])
                 )
             record.update(colrev_status=colrev.record.RecordState.rev_included)
 
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
+        self.__print_stats(selected_record_ids=selected_record_ids)
         self.review_manager.create_commit(
             msg="Screen (include_all)",
             manual_author=False,
         )
 
     def get_screening_criteria(self) -> list:
         """Get the list of screening criteria from settings"""
@@ -395,11 +425,7 @@
             self.__print_stats(selected_record_ids=selected_record_ids)
 
         self.review_manager.logger.info(
             f"{colors.GREEN}Completed screen operation{colors.END}"
         )
         if self.review_manager.in_ci_environment():
             print("\n\n")
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/search.py` & `colrev-0.9.0/colrev/ops/search.py`

 * *Files 1% similar despite different names*

```diff
@@ -5,15 +5,14 @@
 import json
 import time
 from copy import deepcopy
 from pathlib import Path
 from random import randint
 from typing import Optional
 
-import requests
 from pybtex.database.input import bibtex
 
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 import colrev.settings
 import colrev.ui_cli.cli_colors as colors
 
@@ -54,17 +53,14 @@
             i += 1
 
         return filename
 
     def add_source(self, *, add_source: colrev.settings.SearchSource) -> None:
         """Add a new source"""
 
-        # pylint: disable=too-many-statements
-        # pylint: disable=too-many-branches
-
         package_manager = self.review_manager.get_package_manager()
         endpoint_dict = package_manager.load_packages(
             package_type=colrev.env.package_manager.PackageEndpointType.search_source,
             selected_packages=[add_source.get_dict()],
             operation=self,
         )
         endpoint = endpoint_dict[add_source.endpoint.lower()]
@@ -74,16 +70,19 @@
         print(add_source)
         self.review_manager.settings.sources.append(add_source)
         self.review_manager.save_settings()
 
         print()
 
         self.main(selection_str=str(add_source.filename), rerun=False, skip_commit=True)
+        fname = add_source.filename
+        if fname.is_absolute():
+            fname = add_source.filename.relative_to(self.review_manager.path)
         self.review_manager.create_commit(
-            msg=f"Add search source {add_source.filename.relative_to(self.review_manager.path)}",
+            msg=f"Add search source {fname}",
         )
 
     def __remove_forthcoming(self, *, source: colrev.settings.SearchSource) -> None:
         with open(source.get_corresponding_bib_file(), encoding="utf8") as bibtex_file:
             records = self.review_manager.dataset.load_records_dict(
                 load_str=bibtex_file.read()
             )
@@ -250,14 +249,16 @@
                     ):
                         continue
                 main_record = colrev.record.Record(data=main_record_dict)
                 if value.replace(" - ", ": ") == main_record.data[key].replace(
                     " - ", ": "
                 ):
                     continue
+                if key == "url" and "dblp.org" in value and key in main_record.data:
+                    continue
                 main_record.update_field(
                     key=key,
                     value=value,
                     source=origin,
                     keep_source_if_equal=True,
                     append_edit=False,
                 )
@@ -389,18 +390,21 @@
                 print()
             self.review_manager.logger.info(
                 f"search [{source.endpoint} > data/search/{source.filename.name}]"
             )
 
             try:
                 endpoint.run_search(search_operation=self, rerun=rerun)  # type: ignore
-            except (requests.exceptions.ConnectionError,) as exc:
-                raise colrev_exceptions.ServiceNotAvailableException(
-                    source.endpoint
-                ) from exc
+            except colrev.exceptions.ServiceNotAvailableException as exc:
+                # requests.exceptions.ConnectionError,
+                if not self.review_manager.force_mode:
+                    raise colrev_exceptions.ServiceNotAvailableException(
+                        source.endpoint
+                    ) from exc
+                self.review_manager.logger.warning("ServiceNotAvailableException")
 
             if source.filename.is_file():
                 if not self.review_manager.settings.search.retrieve_forthcoming:
                     self.__remove_forthcoming(source=source)
 
                 self.review_manager.dataset.format_records_file()
                 self.review_manager.dataset.add_record_changes()
@@ -615,11 +619,7 @@
                     search_operation.review_manager.dataset.add_changes(
                         path=self.feed_file
                     )
                     break
                 except (FileExistsError, OSError, json.decoder.JSONDecodeError):
                     search_operation.review_manager.logger.debug("Wait for git")
                     time.sleep(randint(1, 15))  # nosec
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/search_sources.py` & `colrev-0.9.0/colrev/ops/search_sources.py`

 * *Files 2% similar despite different names*

```diff
@@ -36,11 +36,7 @@
 
         self.packages: dict[str, typing.Any] = package_manager.load_packages(
             package_type=colrev.env.package_manager.PackageEndpointType.search_source,
             selected_packages=[asdict(s) for s in review_manager.settings.sources],
             operation=check_operation,
             ignore_not_available=False,
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/status.py` & `colrev-0.9.0/colrev/ops/status.py`

 * *Files 1% similar despite different names*

```diff
@@ -54,19 +54,19 @@
                 # and get_prior? (levels: aggregated_statistics vs. record-level?)
 
                 data_loaded = yaml.safe_load(var_t)
                 analytics_dict[len(revlist) - ind] = {
                     "commit_id": commit_id,
                     "commit_author": commit_author,
                     "committed_date": committed_date,
-                    "search": data_loaded["colrev_status"]["overall"]["md_retrieved"],
-                    "included": data_loaded["colrev_status"]["overall"]["rev_included"],
+                    "search": data_loaded["overall"]["md_retrieved"],
+                    "included": data_loaded["overall"]["rev_included"],
                 }
-            except (IndexError, KeyError):
-                pass
+            except (IndexError, KeyError) as exc:
+                print(exc)
 
         keys = list(analytics_dict.values())[0].keys()
 
         with open("analytics.csv", "w", newline="", encoding="utf8") as output_file:
             dict_writer = csv.DictWriter(output_file, keys)
             dict_writer.writeheader()
             dict_writer.writerows(reversed(analytics_dict.values()))
@@ -561,11 +561,7 @@
                 # Note : skip md-prep sources
                 if str(search_file.name).startswith("md_"):
                     continue
                 number_search += self.status_stats.review_manager.dataset.get_nr_in_bib(
                     file_path=search_file
                 )
             return number_search
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/sync.py` & `colrev-0.9.0/colrev/ops/sync.py`

 * *Files 2% similar despite different names*

```diff
@@ -246,11 +246,7 @@
             self.logger.info(
                 "%s Loaded %s papers%s", colors.GREEN, len(added), colors.END
             )
 
         records_dict = {r["ID"]: r for r in records if r["ID"] in self.cited_papers}
 
         self.__save_to_bib(records=records_dict, save_path=references_file)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/trace.py` & `colrev-0.9.0/colrev/ops/trace.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 #! /usr/bin/env python
 """Traces records and changes through history."""
 from __future__ import annotations
 
 import time
+from typing import TYPE_CHECKING
 
 import dictdiffer
 
 import colrev.operation
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import git.objects.commit
+if TYPE_CHECKING:
+    import git.objects.commit
 
 
 class Trace(colrev.operation.Operation):
     """Trace a record through history"""
 
     def __init__(self, *, review_manager: colrev.review_manager.ReviewManager) -> None:
         super().__init__(
@@ -91,33 +89,28 @@
 
         self.review_manager.logger.info(f"Trace record by ID: {record_id}")
 
         revlist = self.review_manager.dataset.get_repo().iter_commits()
 
         prev_record: dict = {}
         for commit in reversed(list(revlist)):
-            try:
-                filecontents = (
-                    commit.tree / str(self.review_manager.dataset.RECORDS_FILE_RELATIVE)
-                ).data_stream.read()
+            filecontents = (commit.tree / "data" / "records.bib").data_stream.read()
 
-                commit_message_first_line = str(commit.message).partition("\n")[0]
+            commit_message_first_line = str(commit.message).partition("\n")[0]
 
-                if self.review_manager.verbose_mode:
-                    print(
-                        "\n\n"
-                        + time.strftime(
-                            "%Y-%m-%d %H:%M",
-                            time.gmtime(commit.committed_date),
-                        )
-                        + f" {commit} ".ljust(40, " ")
-                        + f" {commit_message_first_line} (by {commit.author.name})"
+            if self.review_manager.verbose_mode:
+                print(
+                    "\n\n"
+                    + time.strftime(
+                        "%Y-%m-%d %H:%M",
+                        time.gmtime(commit.committed_date),
                     )
-            except KeyError:
-                continue
+                    + f" {commit} ".ljust(40, " ")
+                    + f" {commit_message_first_line} (by {commit.author.name})"
+                )
 
             records_dict = self.review_manager.dataset.load_records_dict(
                 load_str=filecontents.decode("utf-8")
             )
 
             if record_id not in records_dict:
                 if self.review_manager.verbose_mode:
@@ -126,11 +119,7 @@
 
             prev_record = self.__print_record_changes(
                 commit=commit,
                 records_dict=records_dict,
                 record_id=record_id,
                 prev_record=prev_record,
             )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/upgrade.py` & `colrev-0.9.0/colrev/ops/upgrade.py`

 * *Files 8% similar despite different names*

```diff
@@ -3,28 +3,26 @@
 from __future__ import annotations
 
 import json
 import shutil
 import typing
 from importlib.metadata import version
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import git
 from tqdm import tqdm
 
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 # pylint: disable=too-few-public-methods
 
 
 class Upgrade(colrev.operation.Operation):
     """Upgrade a CoLRev project"""
@@ -119,14 +117,20 @@
             },
             {
                 "version": CoLRevVersion("0.8.3"),
                 "target_version": CoLRevVersion("0.8.4"),
                 "script": self.__migrate_0_8_3,
                 "released": True,
             },
+            {
+                "version": CoLRevVersion("0.8.4"),
+                "target_version": CoLRevVersion("0.9.0"),
+                "script": self.__migrate_0_8_4,
+                "released": True,
+            },
         ]
 
         # Note: we should always update the colrev_version in settings.json because the
         # checker.__check_software requires the settings version and
         # the installed version to be identical
 
         # skipping_versions_before_settings_version = True
@@ -296,14 +300,15 @@
 
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
 
         return self.repo.is_dirty()
 
     def __migrate_0_8_3(self) -> bool:
+        # pylint: disable=too-many-branches
         settings = self.__load_settings_dict()
         settings["prep"]["defects_to_ignore"] = []
         if "curated_metadata" in str(self.review_manager.path):
             settings["prep"]["defects_to_ignore"] = [
                 "record-not-in-toc",
                 "inconsistent-with-url-metadata",
             ]
@@ -314,15 +319,15 @@
             p_round["prep_package_endpoints"] = [
                 x
                 for x in p_round["prep_package_endpoints"]
                 if x["endpoint"] != "colrev.global_ids_consistency_check"
             ]
         self.__save_settings(settings)
         self.review_manager = colrev.review_manager.ReviewManager(
-            path_str=str(self.review_manager.path)
+            path_str=str(self.review_manager.path), force_mode=True
         )
         self.review_manager.load_settings()
         self.review_manager.get_load_operation()
         records = self.review_manager.dataset.load_records_dict()
         quality_model = self.review_manager.get_qm()
 
         # delete the masterdata provenance notes and apply the new quality model
@@ -337,25 +342,53 @@
                 prov["note"] = ""
             for key in not_missing_fields:
                 record_dict["colrev_masterdata_provenance"][key]["note"] = "not-missing"
             if "cited_by_file" in record_dict:
                 del record_dict["cited_by_file"]
             if "cited_by_id" in record_dict:
                 del record_dict["cited_by_id"]
+            if "tei_id" in record_dict:
+                del record_dict["tei_id"]
+            if "colrev_data_provenance" in record_dict:
+                if "cited_by_file" in record_dict["colrev_data_provenance"]:
+                    del record_dict["colrev_data_provenance"]["cited_by_file"]
+                if "cited_by_id" in record_dict["colrev_data_provenance"]:
+                    del record_dict["colrev_data_provenance"]["cited_by_id"]
+                if "tei_id" in record_dict["colrev_data_provenance"]:
+                    del record_dict["colrev_data_provenance"]["tei_id"]
+
             record = colrev.record.Record(data=record_dict)
             prior_state = record.data["colrev_status"]
             record.update_masterdata_provenance(qm=quality_model)
             if prior_state == colrev.record.RecordState.rev_prescreen_excluded:
                 record.data[  # pylint: disable=direct-status-assign
                     "colrev_status"
                 ] = colrev.record.RecordState.rev_prescreen_excluded
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
         return self.repo.is_dirty()
 
+    def __migrate_0_8_4(self) -> bool:
+        records = self.review_manager.dataset.load_records_dict()
+        for record in records.values():
+            if "editor" not in record.get("colrev_data_provenance", {}):
+                continue
+            ed_val = record["colrev_data_provenance"]["editor"]
+            del record["colrev_data_provenance"]["editor"]
+            record["colrev_masterdata_provenance"]["editor"] = ed_val
+
+        self.review_manager.dataset.save_records_dict(records=records)
+        self.review_manager.dataset.add_record_changes()
+
+        return self.repo.is_dirty()
+
+
+# Note: we can ask users to make decisions (when defaults are not clear)
+# via input() or simply cancel the process (raise a CoLrevException)
+
 
 class CoLRevVersion:
     """Class for handling the CoLRev version"""
 
     def __init__(self, version_string: str) -> None:
         if "+" in version_string:
             version_string = version_string[: version_string.find("+")]
@@ -376,11 +409,7 @@
             return True
         if self.patch < other.patch:
             return True
         return False
 
     def __str__(self) -> str:
         return f"{self.major}.{self.minor}.{self.patch}"
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ops/validate.py` & `colrev-0.9.0/colrev/ops/validate.py`

 * *Files 1% similar despite different names*

```diff
@@ -28,17 +28,15 @@
 
     def __load_prior_records_dict(self, *, target_commit: str) -> dict:
         git_repo = self.review_manager.dataset.get_repo()
 
         revlist = (
             (
                 commit.hexsha,
-                (
-                    commit.tree / str(self.review_manager.dataset.RECORDS_FILE_RELATIVE)
-                ).data_stream.read(),
+                (commit.tree / "data" / "records.bib").data_stream.read(),
             )
             for commit in git_repo.iter_commits(
                 paths=str(self.review_manager.dataset.RECORDS_FILE_RELATIVE)
             )
         )
 
         found_target_commit = False
@@ -575,11 +573,7 @@
                 )
 
         # Note : merge for git branches
         if filter_setting == "merge":
             validation_details["merge"] = self.validate_merge_changes()
 
         return validation_details
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/container_title_abbreviated.py` & `colrev-0.9.0/colrev/qm/checkers/container_title_abbreviated.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/doi_not_matching_pattern.py` & `colrev-0.9.0/colrev/qm/checkers/doi_not_matching_pattern.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/erroneous_symbol_in_field.py` & `colrev-0.9.0/colrev/qm/checkers/erroneous_symbol_in_field.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/erroneous_term_in_field.py` & `colrev-0.9.0/colrev/qm/checkers/erroneous_term_in_field.py`

 * *Files 24% similar despite different names*

```diff
@@ -6,28 +6,45 @@
 
 # pylint: disable=too-few-public-methods
 
 
 class ErroneousTermInFieldChecker:
     """The ErroneousTermInFieldChecker"""
 
-    erroneous_terms = {"author": ["http", "University"]}
+    erroneous_terms = {
+        "author": [
+            "http",
+            "University",
+            "orcid",
+            "student",
+            "Harvard",
+            "Conference",
+            "Mrs",
+            "Hochschule",
+        ],
+        "title": [
+            "research paper",
+            "completed research",
+            "research in progress",
+            "full research paper",
+        ],
+    }
     msg = "erroneous-term-in-field"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
 
     def run(self, *, record: colrev.record.Record) -> None:
         """Run the erroneous-term-in-field checks"""
 
         for key, erroneous_term_list in self.erroneous_terms.items():
             if key not in record.data:
                 continue
 
-            if any(x in record.data[key] for x in erroneous_term_list):
+            if any(x.lower() in record.data[key].lower() for x in erroneous_term_list):
                 record.add_masterdata_provenance_note(key=key, note=self.msg)
             else:
                 record.remove_masterdata_provenance_note(key=key, note=self.msg)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/erroneous_title_field.py` & `colrev-0.9.0/colrev/qm/checkers/name_format_titles.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,36 +1,43 @@
 #! /usr/bin/env python
-"""Checker for erroneous-title-field."""
+"""Checker for name-format-titles."""
 from __future__ import annotations
 
+import re
+
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
 
 
-class ErroneousTitleFieldChecker:
-    """The ErroneousTitleFieldChecker"""
+class NameFormatTitleChecker:
+    """The NameFormatTitleChecker"""
+
+    fields_to_check = ["author", "editor"]
+    titles = ["MD", "Dr", "PhD", "Prof", "Dipl Ing"]
+    __words_rgx = re.compile(r"(\w[\w']*\w|\w)")
 
-    msg = "erroneous-title-field"
+    msg = "name-format-titles"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
 
     def run(self, *, record: colrev.record.Record) -> None:
-        """Run the erroneous-title-field checks"""
-
-        if "title" not in record.data:
-            return
-
-        if " " not in record.data["title"] and (
-            any(x in record.data["title"] for x in ["_", "."])
-            or any(char.isdigit() for char in record.data["title"])
-        ):
-            record.add_masterdata_provenance_note(key="title", note=self.msg)
+        """Run the name-format-titles checks"""
 
-        else:
-            record.remove_masterdata_provenance_note(key="title", note=self.msg)
+        for key in self.fields_to_check:
+            if key not in record.data:
+                continue
+
+            if self.__title_in_name(name=record.data[key]):
+                record.add_masterdata_provenance_note(key=key, note=self.msg)
+            else:
+                record.remove_masterdata_provenance_note(key=key, note=self.msg)
+
+    def __title_in_name(self, *, name: str) -> bool:
+        name_parts = self.__words_rgx.findall(name.lower())
+        return any(title.lower() in name_parts for title in self.titles)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
-    quality_model.register_checker(ErroneousTitleFieldChecker(quality_model))
+    quality_model.register_checker(NameFormatTitleChecker(quality_model))
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/identical_values_between_title_and_container.py` & `colrev-0.9.0/colrev/qm/checkers/identical_values_between_title_and_container.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/incomplete_field.py` & `colrev-0.9.0/colrev/qm/checkers/incomplete_field.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/inconsistent_content.py` & `colrev-0.9.0/colrev/qm/checkers/inconsistent_content.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/inconsistent_with_doi_metadata.py` & `colrev-0.9.0/colrev/qm/checkers/inconsistent_with_doi_metadata.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,12 @@
 #! /usr/bin/env python
 """Checker for inconsistent-with-doi-metadata."""
 from __future__ import annotations
 
+import requests.exceptions
 from thefuzz import fuzz
 
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.search_sources.crossref as crossref_connector
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
@@ -68,14 +69,16 @@
                     < 60
                 ):
                     return True
 
         except (
             colrev_exceptions.RecordNotFoundInPrepSourceException,
             colrev_exceptions.RecordNotParsableException,
+            requests.exceptions.ConnectionError,
+            requests.exceptions.ReadTimeout,
         ):
             return False
         return False
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/inconsistent_with_entrytype.py` & `colrev-0.9.0/colrev/qm/checkers/inconsistent_with_entrytype.py`

 * *Files 12% similar despite different names*

```diff
@@ -16,14 +16,16 @@
         "incollection": [],
         "inbook": ["journal"],
         "book": ["volume", "issue", "number", "journal"],
         "phdthesis": ["volume", "issue", "number", "journal", "booktitle"],
         "masterthesis": ["volume", "issue", "number", "journal", "booktitle"],
         "techreport": ["volume", "issue", "number", "journal", "booktitle"],
         "unpublished": ["volume", "issue", "number", "journal", "booktitle"],
+        "online": ["journal", "booktitle"],
+        "misc": ["journal", "booktitle"],
     }
     """Fields considered inconsistent with the respective ENTRYTYPE"""
 
     msg = "inconsistent-with-entrytype"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
@@ -33,21 +35,17 @@
 
         if record.data["ENTRYTYPE"] not in self.record_field_inconsistencies:
             return
 
         inconsistent_fields = self.record_field_inconsistencies[
             record.data["ENTRYTYPE"]
         ]
-        for inconsistent_field in inconsistent_fields:
-            if inconsistent_field in record.data:
-                record.add_masterdata_provenance_note(
-                    key=inconsistent_field, note=self.msg
-                )
+        for key in record.data:
+            if key in inconsistent_fields:
+                record.add_masterdata_provenance_note(key=key, note=self.msg)
             else:
-                record.remove_masterdata_provenance_note(
-                    key=inconsistent_field, note=self.msg
-                )
+                record.remove_masterdata_provenance_note(key=key, note=self.msg)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
     quality_model.register_checker(InconsistentWithEntrytypeChecker(quality_model))
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/inconsistent_with_url_metadata.py` & `colrev-0.9.0/colrev/qm/checkers/inconsistent_with_url_metadata.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/isbn_not_matching_pattern.py` & `colrev-0.9.0/colrev/qm/checkers/isbn_not_matching_pattern.py`

 * *Files 1% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 
 class ISBNPatternChecker:
     """The ISBNPatternChecker"""
 
     msg = "isbn-not-matching-pattern"
 
     __ISBN_REGEX = re.compile(
-        "^(?:ISBN(?:-1[03])?:? )?(?=[-0-9 ]{17}$|[-0-9X ]{13}$|[0-9X]{10}$)"
+        "^(?:ISBN(?:-1[03])?:? )?(?=[-0-9 ]{17}$|[-0-9X ]{13}$|[0-9X]{10}$)|"
         "(?:97[89][- ]?)?[0-9]{1,5}[- ]?(?:[0-9]+[- ]?){2}[0-9X]$"
     )
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
 
     def run(self, *, record: colrev.record.Record) -> None:
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/language_format_error.py` & `colrev-0.9.0/colrev/qm/checkers/language_format_error.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/missing_field.py` & `colrev-0.9.0/colrev/qm/checkers/missing_field.py`

 * *Files 6% similar despite different names*

```diff
@@ -14,17 +14,19 @@
 
     # Based on https://en.wikipedia.org/wiki/BibTeX
     record_field_requirements = {
         "article": ["author", "title", "journal", "year", "volume", "number"],
         "inproceedings": ["author", "title", "booktitle", "year"],
         "incollection": ["author", "title", "booktitle", "publisher", "year"],
         "inbook": ["author", "title", "chapter", "publisher", "year"],
-        "proceedings": ["booktitle", "editor"],
+        "proceedings": ["booktitle", "editor", "year"],
+        "conference": ["booktitle", "editor", "year"],
         "book": ["author", "title", "publisher", "year"],
         "phdthesis": ["author", "title", "school", "year"],
+        "bachelorthesis": ["author", "title", "school", "year"],
         "thesis": ["author", "title", "school", "year"],
         "masterthesis": ["author", "title", "school", "year"],
         "techreport": ["author", "title", "institution", "year"],
         "unpublished": ["title", "author", "year"],
         "misc": ["author", "title", "year"],
         "software": ["author", "title", "url"],
         "online": ["author", "title", "url"],
@@ -68,14 +70,15 @@
 
         self.__ignore_exceptions(record=record)
         self.__check_forthcoming(record=record)
 
         if not self.__has_missing_fields(record=record):
             record.set_masterdata_complete(
                 source="update_masterdata_provenance",
+                masterdata_repository=False,
                 replace_source=False,
             )
 
     def __ignore_exceptions(self, *, record: colrev.record.Record) -> None:
         # No authors for complementary materials or errata required
         if (
             any(
@@ -107,27 +110,29 @@
             for x in record.data["colrev_masterdata_provenance"].values()
         ):
             return True
         return False
 
     def __check_forthcoming(self, *, record: colrev.record.Record) -> None:
         if record.data.get("year", "") != "forthcoming":
+            record.remove_masterdata_provenance_note(key="volume", note="forthcoming")
+            record.remove_masterdata_provenance_note(key="number", note="forthcoming")
             return
         source = "NA"
         if "year" in record.data["colrev_masterdata_provenance"]:
             source = record.data["colrev_masterdata_provenance"]["year"]["source"]
         if record.data.get("volume", "") in ["", "UNKNOWN"]:
             record.remove_masterdata_provenance_note(key="volume", note="missing")
             record.add_masterdata_provenance(
-                key="volume", source=source, note="not-missing"
+                key="volume", source=source, note="forthcoming"
             )
         if record.data.get("number", "") in ["", "UNKNOWN"]:
             record.remove_masterdata_provenance_note(key="number", note="missing")
             record.add_masterdata_provenance(
-                key="number", source=source, note="not-missing"
+                key="number", source=source, note="forthcoming"
             )
 
     def __check_completeness(
         self, *, record: colrev.record.Record, curation_restrictions: bool = False
     ) -> None:
         required_fields_keys = self.record_field_requirements["other"]
         if record.data["ENTRYTYPE"] in self.record_field_requirements:
@@ -248,25 +253,36 @@
 
     # Extract the restrictions to a qm-utility function?
     def apply_curation_restrictions(self, *, record: colrev.record.Record) -> None:
         """Apply the curation restrictions"""
         applicable_curation_restrictions = self.__get_applicable_curation_restrictions(
             record=record
         )
-
-        for exact_match in ["ENTRYTYPE", "journal", "booktitle"]:
-            if exact_match in applicable_curation_restrictions:
-                if applicable_curation_restrictions[exact_match] != record.data.get(
-                    exact_match, ""
-                ):
+        if "ENTRYTYPE" in applicable_curation_restrictions:
+            if applicable_curation_restrictions["ENTRYTYPE"] != record.data.get(
+                "ENTRYTYPE", ""
+            ):
+                try:
                     record.change_entrytype(
-                        new_entrytype=applicable_curation_restrictions[exact_match],
+                        new_entrytype=applicable_curation_restrictions["ENTRYTYPE"],
                         qm=self.quality_model,
                     )
+                except colrev_exceptions.MissingRecordQualityRuleSpecification as exc:
+                    print(exc)
 
+        for field in ["journal", "booktitle"]:
+            if field not in applicable_curation_restrictions:
+                continue
+            if applicable_curation_restrictions[field] == record.data.get(field, ""):
+                continue
+            record.update_field(
+                key=field,
+                value=applicable_curation_restrictions[field],
+                source="colrev_curation.curation_restrictions",
+            )
         if (
             "number" in applicable_curation_restrictions
             and not applicable_curation_restrictions["number"]
             and "number" in record.data
         ):
             record.remove_field(
                 key="number",
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/mostly_all_caps.py` & `colrev-0.9.0/colrev/qm/checkers/mostly_all_caps.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/name_abbreviated.py` & `colrev-0.9.0/colrev/qm/checkers/name_abbreviated.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/checkers/name_format_separators.py` & `colrev-0.9.0/colrev/qm/checkers/name_format_separators.py`

 * *Files 2% similar despite different names*

```diff
@@ -60,17 +60,17 @@
             for sanitized_name in sanitized_names_list
             for name_part in sanitized_name.split(",")
         ):
             return True
 
         # Note : patterns like "I N T R O D U C T I O N"
         # that may result from grobid imports
-        if re.search(r"[A-Z] [A-Z] [A-Z] [A-Z]", record.data["author"]):
+        if re.search(r"[A-Z] [A-Z] [A-Z] [A-Z]", record.data[key]):
             return True
-        if len(record.data["author"]) < 5:
+        if len(record.data[key]) < 5:
             return True
 
         return False
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/name_format_titles.py` & `colrev-0.9.0/colrev/qm/checkers/record_not_in_toc.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,43 +1,46 @@
 #! /usr/bin/env python
-"""Checker for name-format-titles."""
+"""Checker for record-not-in-toc."""
 from __future__ import annotations
 
-import re
-
+import colrev.env.local_index
+import colrev.exceptions as colrev_exceptions
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
 
 
-class NameFormatTitleChecker:
-    """The NameFormatTitleChecker"""
-
-    fields_to_check = ["author", "editor"]
-    titles = ["MD", "Dr", "PhD", "Prof", "Dipl Ing"]
-    __words_rgx = re.compile(r"(\w[\w']*\w|\w)")
+class RecordNotInTOCChecker:
+    """The RecordNotInTOCChecker"""
 
-    msg = "name-format-titles"
+    msg = "record-not-in-toc"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
+        self.local_index = colrev.env.local_index.LocalIndex(verbose_mode=False)
 
     def run(self, *, record: colrev.record.Record) -> None:
-        """Run the name-format-titles checks"""
+        """Run the record-not-in-toc checks"""
 
-        for key in self.fields_to_check:
-            if key not in record.data:
-                continue
-
-            if self.__title_in_name(name=record.data[key]):
-                record.add_masterdata_provenance_note(key=key, note=self.msg)
-            else:
-                record.remove_masterdata_provenance_note(key=key, note=self.msg)
-
-    def __title_in_name(self, *, name: str) -> bool:
-        name_parts = self.__words_rgx.findall(name.lower())
-        return any(title.lower() in name_parts for title in self.titles)
+        try:
+            # Search within the table-of-content in local_index
+            self.local_index.retrieve_from_toc(
+                record_dict=record.data,
+                similarity_threshold=0.9,
+                include_file=False,
+            )
+            if "journal" in record.data:
+                record.remove_masterdata_provenance_note(key="journal", note=self.msg)
+            elif "booktitle" in record.data:
+                record.remove_masterdata_provenance_note(key="booktitle", note=self.msg)
+        except colrev.exceptions.RecordNotInIndexException:
+            pass
+        except colrev_exceptions.RecordNotInTOCException:
+            if "journal" in record.data:
+                record.add_masterdata_provenance_note(key="journal", note=self.msg)
+            elif "booktitle" in record.data:
+                record.add_masterdata_provenance_note(key="booktitle", note=self.msg)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
-    quality_model.register_checker(NameFormatTitleChecker(quality_model))
+    quality_model.register_checker(RecordNotInTOCChecker(quality_model))
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/record_not_in_toc.py` & `colrev-0.9.0/colrev/qm/checkers/thesis_with_multiple_authors.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,46 +1,36 @@
 #! /usr/bin/env python
-"""Checker for record-not-in-toc."""
+"""Checker for thesis-with-multiple-authors."""
 from __future__ import annotations
 
-import colrev.env.local_index
-import colrev.exceptions as colrev_exceptions
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
 
 
-class RecordNotInTOCChecker:
-    """The RecordNotInTOCChecker"""
+class ThesisWithMultipleAuthorsChecker:
+    """The ThesisWithMultipleAuthorsChecker"""
 
-    msg = "record-not-in-toc"
+    msg = "thesis-with-multiple-authors"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
-        self.local_index = colrev.env.local_index.LocalIndex(verbose_mode=False)
 
     def run(self, *, record: colrev.record.Record) -> None:
-        """Run the record-not-in-toc checks"""
+        """Run the thesis-with-multiple-authors checks"""
 
-        try:
-            # Search within the table-of-content in local_index
-            self.local_index.retrieve_from_toc(
-                record_dict=record.data,
-                similarity_threshold=0.9,
-                include_file=False,
-            )
-            if "journal" in record.data:
-                record.remove_masterdata_provenance_note(key="journal", note=self.msg)
-            elif "booktitle" in record.data:
-                record.remove_masterdata_provenance_note(key="booktitle", note=self.msg)
-        except colrev.exceptions.RecordNotInIndexException:
-            pass
-        except colrev_exceptions.RecordNotInTOCException:
-            if "journal" in record.data:
-                record.add_masterdata_provenance_note(key="journal", note=self.msg)
-            elif "booktitle" in record.data:
-                record.add_masterdata_provenance_note(key="booktitle", note=self.msg)
+        if self.__multiple_authored_thesis(record=record):
+            record.add_masterdata_provenance_note(key="author", note=self.msg)
+        else:
+            record.remove_masterdata_provenance_note(key="author", note=self.msg)
+
+    def __multiple_authored_thesis(self, *, record: colrev.record.Record) -> bool:
+        if "thesis" in record.data["ENTRYTYPE"] and " and " in record.data.get(
+            "author", ""
+        ):
+            return True
+        return False
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
-    quality_model.register_checker(RecordNotInTOCChecker(quality_model))
+    quality_model.register_checker(ThesisWithMultipleAuthorsChecker(quality_model))
```

### Comparing `colrev-0.8.4/colrev/qm/checkers/year_format.py` & `colrev-0.9.0/colrev/qm/checkers/year_format.py`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/qm/colrev_id.py` & `colrev-0.9.0/colrev/qm/colrev_id.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 #! /usr/bin/env python
 """Generate colrev-ids."""
 from __future__ import annotations
 
 import re
+from typing import TYPE_CHECKING
 
 from nameparser import HumanName
 
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 def __format_author_field_for_cid(input_string: str) -> str:
     input_string = input_string.replace("\n", " ").replace("'", "")
     names = input_string.replace("; ", " and ").split(" and ")
     author_list = []
     for name in names:
@@ -177,11 +175,7 @@
     # Safeguard against titles that are rarely distinct
     if any(x in srep for x in ["|minitrack-introduction|"]):
         raise colrev_exceptions.NotEnoughDataToIdentifyException(
             msg="Title typically non-distinct", missing_fields=["title"]
         )
 
     return srep
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/qm/colrev_pdf_id.py` & `colrev-0.9.0/colrev/qm/colrev_pdf_id.py`

 * *Files 4% similar despite different names*

```diff
@@ -43,11 +43,7 @@
     return average_hash_str
 
 
 def create_colrev_pdf_id(*, pdf_path: Path) -> str:
     """Get the PDF hash"""
 
     return "cpid2:" + get_pdf_hash(pdf_path=pdf_path, page_nr=1, hash_size=32)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/qm/quality_model.py` & `colrev-0.9.0/colrev/qm/quality_model.py`

 * *Files 15% similar despite different names*

```diff
@@ -47,11 +47,7 @@
 
     def run(self, *, record: colrev.record.Record) -> None:
         """Run the checkers"""
         for checker in self.checkers:
             if checker.msg in self.defects_to_ignore:
                 continue
             checker.run(record=record)
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/qm/readme.md` & `colrev-0.9.0/colrev/qm/readme.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/record.py` & `colrev-0.9.0/colrev/record.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,5629 +12,5643 @@
 000000b0: 7874 7772 6170 0a69 6d70 6f72 7420 7479  xtwrap.import ty
 000000c0: 7069 6e67 0a66 726f 6d20 636f 7079 2069  ping.from copy i
 000000d0: 6d70 6f72 7420 6465 6570 636f 7079 0a66  mport deepcopy.f
 000000e0: 726f 6d20 656e 756d 2069 6d70 6f72 7420  rom enum import 
 000000f0: 456e 756d 0a66 726f 6d20 7061 7468 6c69  Enum.from pathli
 00000100: 6220 696d 706f 7274 2050 6174 680a 6672  b import Path.fr
 00000110: 6f6d 2074 7970 696e 6720 696d 706f 7274  om typing import
-00000120: 204f 7074 696f 6e61 6c0a 0a69 6d70 6f72   Optional..impor
-00000130: 7420 6469 6374 6469 6666 6572 0a69 6d70  t dictdiffer.imp
-00000140: 6f72 7420 7061 6e64 6173 2061 7320 7064  ort pandas as pd
-00000150: 0a69 6d70 6f72 7420 7064 666d 696e 6572  .import pdfminer
-00000160: 0a66 726f 6d20 6e61 6d65 7061 7273 6572  .from nameparser
-00000170: 2069 6d70 6f72 7420 4875 6d61 6e4e 616d   import HumanNam
-00000180: 650a 6672 6f6d 2070 6466 6d69 6e65 722e  e.from pdfminer.
-00000190: 636f 6e76 6572 7465 7220 696d 706f 7274  converter import
-000001a0: 2054 6578 7443 6f6e 7665 7274 6572 0a66   TextConverter.f
-000001b0: 726f 6d20 7064 666d 696e 6572 2e70 6466  rom pdfminer.pdf
-000001c0: 646f 6375 6d65 6e74 2069 6d70 6f72 7420  document import 
-000001d0: 5044 4644 6f63 756d 656e 740a 6672 6f6d  PDFDocument.from
-000001e0: 2070 6466 6d69 6e65 722e 7064 6664 6f63   pdfminer.pdfdoc
-000001f0: 756d 656e 7420 696d 706f 7274 2050 4446  ument import PDF
-00000200: 5465 7874 4578 7472 6163 7469 6f6e 4e6f  TextExtractionNo
-00000210: 7441 6c6c 6f77 6564 0a66 726f 6d20 7064  tAllowed.from pd
-00000220: 666d 696e 6572 2e70 6466 696e 7465 7270  fminer.pdfinterp
-00000230: 2069 6d70 6f72 7420 5044 4650 6167 6549   import PDFPageI
-00000240: 6e74 6572 7072 6574 6572 0a66 726f 6d20  nterpreter.from 
-00000250: 7064 666d 696e 6572 2e70 6466 696e 7465  pdfminer.pdfinte
-00000260: 7270 2069 6d70 6f72 7420 5044 4652 6573  rp import PDFRes
-00000270: 6f75 7263 654d 616e 6167 6572 0a66 726f  ourceManager.fro
-00000280: 6d20 7064 666d 696e 6572 2e70 6466 696e  m pdfminer.pdfin
-00000290: 7465 7270 2069 6d70 6f72 7420 7265 736f  terp import reso
-000002a0: 6c76 6531 0a66 726f 6d20 7064 666d 696e  lve1.from pdfmin
-000002b0: 6572 2e70 6466 7061 6765 2069 6d70 6f72  er.pdfpage impor
-000002c0: 7420 5044 4650 6167 650a 6672 6f6d 2070  t PDFPage.from p
-000002d0: 6466 6d69 6e65 722e 7064 6670 6172 7365  dfminer.pdfparse
-000002e0: 7220 696d 706f 7274 2050 4446 5061 7273  r import PDFPars
-000002f0: 6572 0a66 726f 6d20 7064 666d 696e 6572  er.from pdfminer
-00000300: 2e70 6466 7061 7273 6572 2069 6d70 6f72  .pdfparser impor
-00000310: 7420 5044 4653 796e 7461 7845 7272 6f72  t PDFSyntaxError
-00000320: 0a66 726f 6d20 5079 5044 4632 2069 6d70  .from PyPDF2 imp
-00000330: 6f72 7420 5064 6646 696c 6552 6561 6465  ort PdfFileReade
+00000120: 204f 7074 696f 6e61 6c0a 6672 6f6d 2074   Optional.from t
+00000130: 7970 696e 6720 696d 706f 7274 2054 5950  yping import TYP
+00000140: 455f 4348 4543 4b49 4e47 0a0a 696d 706f  E_CHECKING..impo
+00000150: 7274 2064 6963 7464 6966 6665 720a 696d  rt dictdiffer.im
+00000160: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
+00000170: 640a 696d 706f 7274 2070 6466 6d69 6e65  d.import pdfmine
+00000180: 720a 6672 6f6d 206e 616d 6570 6172 7365  r.from nameparse
+00000190: 7220 696d 706f 7274 2048 756d 616e 4e61  r import HumanNa
+000001a0: 6d65 0a66 726f 6d20 7064 666d 696e 6572  me.from pdfminer
+000001b0: 2e63 6f6e 7665 7274 6572 2069 6d70 6f72  .converter impor
+000001c0: 7420 5465 7874 436f 6e76 6572 7465 720a  t TextConverter.
+000001d0: 6672 6f6d 2070 6466 6d69 6e65 722e 7064  from pdfminer.pd
+000001e0: 6664 6f63 756d 656e 7420 696d 706f 7274  fdocument import
+000001f0: 2050 4446 446f 6375 6d65 6e74 0a66 726f   PDFDocument.fro
+00000200: 6d20 7064 666d 696e 6572 2e70 6466 646f  m pdfminer.pdfdo
+00000210: 6375 6d65 6e74 2069 6d70 6f72 7420 5044  cument import PD
+00000220: 4654 6578 7445 7874 7261 6374 696f 6e4e  FTextExtractionN
+00000230: 6f74 416c 6c6f 7765 640a 6672 6f6d 2070  otAllowed.from p
+00000240: 6466 6d69 6e65 722e 7064 6669 6e74 6572  dfminer.pdfinter
+00000250: 7020 696d 706f 7274 2050 4446 5061 6765  p import PDFPage
+00000260: 496e 7465 7270 7265 7465 720a 6672 6f6d  Interpreter.from
+00000270: 2070 6466 6d69 6e65 722e 7064 6669 6e74   pdfminer.pdfint
+00000280: 6572 7020 696d 706f 7274 2050 4446 5265  erp import PDFRe
+00000290: 736f 7572 6365 4d61 6e61 6765 720a 6672  sourceManager.fr
+000002a0: 6f6d 2070 6466 6d69 6e65 722e 7064 6669  om pdfminer.pdfi
+000002b0: 6e74 6572 7020 696d 706f 7274 2072 6573  nterp import res
+000002c0: 6f6c 7665 310a 6672 6f6d 2070 6466 6d69  olve1.from pdfmi
+000002d0: 6e65 722e 7064 6670 6167 6520 696d 706f  ner.pdfpage impo
+000002e0: 7274 2050 4446 5061 6765 0a66 726f 6d20  rt PDFPage.from 
+000002f0: 7064 666d 696e 6572 2e70 6466 7061 7273  pdfminer.pdfpars
+00000300: 6572 2069 6d70 6f72 7420 5044 4650 6172  er import PDFPar
+00000310: 7365 720a 6672 6f6d 2070 6466 6d69 6e65  ser.from pdfmine
+00000320: 722e 7064 6670 6172 7365 7220 696d 706f  r.pdfparser impo
+00000330: 7274 2050 4446 5379 6e74 6178 4572 726f  rt PDFSyntaxErro
 00000340: 720a 6672 6f6d 2050 7950 4446 3220 696d  r.from PyPDF2 im
-00000350: 706f 7274 2050 6466 4669 6c65 5772 6974  port PdfFileWrit
-00000360: 6572 0a66 726f 6d20 7468 6566 757a 7a20  er.from thefuzz 
-00000370: 696d 706f 7274 2066 757a 7a0a 0a69 6d70  import fuzz..imp
-00000380: 6f72 7420 636f 6c72 6576 2e65 6e76 2e75  ort colrev.env.u
-00000390: 7469 6c73 0a69 6d70 6f72 7420 636f 6c72  tils.import colr
-000003a0: 6576 2e65 7863 6570 7469 6f6e 7320 6173  ev.exceptions as
-000003b0: 2063 6f6c 7265 765f 6578 6365 7074 696f   colrev_exceptio
-000003c0: 6e73 0a69 6d70 6f72 7420 636f 6c72 6576  ns.import colrev
-000003d0: 2e71 6d2e 636f 6c72 6576 5f69 640a 696d  .qm.colrev_id.im
-000003e0: 706f 7274 2063 6f6c 7265 762e 716d 2e63  port colrev.qm.c
-000003f0: 6f6c 7265 765f 7064 665f 6964 0a69 6d70  olrev_pdf_id.imp
-00000400: 6f72 7420 636f 6c72 6576 2e75 695f 636c  ort colrev.ui_cl
-00000410: 692e 636c 695f 636f 6c6f 7273 2061 7320  i.cli_colors as 
-00000420: 636f 6c6f 7273 0a0a 6966 2046 616c 7365  colors..if False
-00000430: 3a20 2023 2070 796c 696e 743a 2064 6973  :  # pylint: dis
-00000440: 6162 6c65 3d75 7369 6e67 2d63 6f6e 7374  able=using-const
-00000450: 616e 742d 7465 7374 0a20 2020 2066 726f  ant-test.    fro
-00000460: 6d20 7479 7069 6e67 2069 6d70 6f72 7420  m typing import 
-00000470: 5459 5045 5f43 4845 434b 494e 470a 0a20  TYPE_CHECKING.. 
-00000480: 2020 2069 6620 5459 5045 5f43 4845 434b     if TYPE_CHECK
-00000490: 494e 473a 0a20 2020 2020 2020 2069 6d70  ING:.        imp
-000004a0: 6f72 7420 636f 6c72 6576 2e72 6576 6965  ort colrev.revie
-000004b0: 775f 6d61 6e61 6765 720a 2020 2020 2020  w_manager.      
-000004c0: 2020 696d 706f 7274 2063 6f6c 7265 762e    import colrev.
-000004d0: 716d 2e71 7561 6c69 7479 5f6d 6f64 656c  qm.quality_model
-000004e0: 0a0a 2320 7079 6c69 6e74 3a20 6469 7361  ..# pylint: disa
-000004f0: 626c 653d 746f 6f2d 6d61 6e79 2d6c 696e  ble=too-many-lin
-00000500: 6573 0a23 2070 796c 696e 743a 2064 6973  es.# pylint: dis
-00000510: 6162 6c65 3d74 6f6f 2d6d 616e 792d 7075  able=too-many-pu
-00000520: 626c 6963 2d6d 6574 686f 6473 0a0a 0a63  blic-methods...c
-00000530: 6c61 7373 2052 6563 6f72 643a 0a20 2020  lass Record:.   
-00000540: 2022 2222 5468 6520 5265 636f 7264 2063   """The Record c
-00000550: 6c61 7373 2070 726f 7669 6465 7320 6120  lass provides a 
-00000560: 7261 6e67 6520 6f66 2062 6173 6963 2063  range of basic c
-00000570: 6f6e 7665 6e69 656e 6365 2066 756e 6374  onvenience funct
-00000580: 696f 6e73 2222 220a 0a20 2020 2069 6465  ions"""..    ide
-00000590: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
-000005a0: 6579 7320 3d20 5b0a 2020 2020 2020 2020  eys = [.        
-000005b0: 2274 6974 6c65 222c 0a20 2020 2020 2020  "title",.       
-000005c0: 2022 6175 7468 6f72 222c 0a20 2020 2020   "author",.     
-000005d0: 2020 2022 7965 6172 222c 0a20 2020 2020     "year",.     
-000005e0: 2020 2022 6a6f 7572 6e61 6c22 2c0a 2020     "journal",.  
-000005f0: 2020 2020 2020 2262 6f6f 6b74 6974 6c65        "booktitle
-00000600: 222c 0a20 2020 2020 2020 2022 6368 6170  ",.        "chap
-00000610: 7465 7222 2c0a 2020 2020 2020 2020 2270  ter",.        "p
-00000620: 7562 6c69 7368 6572 222c 0a20 2020 2020  ublisher",.     
-00000630: 2020 2022 766f 6c75 6d65 222c 0a20 2020     "volume",.   
-00000640: 2020 2020 2022 6e75 6d62 6572 222c 0a20       "number",. 
-00000650: 2020 2020 2020 2022 7061 6765 7322 2c0a         "pages",.
-00000660: 2020 2020 5d0a 2020 2020 2222 224b 6579      ].    """Key
-00000670: 7320 6f66 2069 6465 6e74 6966 7969 6e67  s of identifying
-00000680: 2066 6965 6c64 7320 636f 6e73 6964 6572   fields consider
-00000690: 6564 2066 6f72 206d 6173 7465 7264 6174  ed for masterdat
-000006a0: 6120 7072 6f76 656e 616e 6365 2222 220a  a provenance""".
-000006b0: 0a20 2020 2070 726f 7665 6e61 6e63 655f  .    provenance_
-000006c0: 6b65 7973 203d 205b 0a20 2020 2020 2020  keys = [.       
-000006d0: 2022 636f 6c72 6576 5f6d 6173 7465 7264   "colrev_masterd
-000006e0: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
-000006f0: 0a20 2020 2020 2020 2022 636f 6c72 6576  .        "colrev
-00000700: 5f6f 7269 6769 6e22 2c0a 2020 2020 2020  _origin",.      
-00000710: 2020 2263 6f6c 7265 765f 7374 6174 7573    "colrev_status
-00000720: 222c 0a20 2020 2020 2020 2022 636f 6c72  ",.        "colr
-00000730: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
-00000740: 6365 222c 0a20 2020 2020 2020 2022 636f  ce",.        "co
-00000750: 6c72 6576 5f70 6466 5f69 6422 2c0a 2020  lrev_pdf_id",.  
-00000760: 2020 2020 2020 224d 4f56 4544 5f44 5550        "MOVED_DUP
-00000770: 455f 4944 222c 0a20 2020 205d 0a0a 2020  E_ID",.    ]..  
-00000780: 2020 7072 6566 6572 7265 645f 736f 7572    preferred_sour
-00000790: 6365 7320 3d20 5b22 6874 7470 733a 2f2f  ces = ["https://
-000007a0: 6170 692e 6372 6f73 7372 6566 2e6f 7267  api.crossref.org
-000007b0: 2f77 6f72 6b73 2f22 2c20 2263 6974 6561  /works/", "citea
-000007c0: 732e 6f72 6722 5d0a 0a20 2020 2023 2046  s.org"]..    # F
-000007d0: 6965 6c64 7320 7468 6174 2061 7265 2073  ields that are s
-000007e0: 746f 7265 6420 6173 206c 6973 7473 2028  tored as lists (
-000007f0: 6974 656d 7320 7365 7061 7261 7465 6420  items separated 
-00000800: 6279 206e 6577 6c69 6e65 7329 0a20 2020  by newlines).   
-00000810: 206c 6973 745f 6669 656c 6473 5f6b 6579   list_fields_key
-00000820: 7320 3d20 5b0a 2020 2020 2020 2020 2263  s = [.        "c
-00000830: 6f6c 7265 765f 6f72 6967 696e 222c 0a20  olrev_origin",. 
-00000840: 2020 2020 2020 2023 2022 636f 6c72 6576         # "colrev
-00000850: 5f70 6466 5f69 6422 2c0a 2020 2020 2020  _pdf_id",.      
-00000860: 2020 2320 2273 6372 6565 6e69 6e67 5f63    # "screening_c
-00000870: 7269 7465 7269 6122 2c0a 2020 2020 5d0a  riteria",.    ].
-00000880: 2020 2020 6469 6374 5f66 6965 6c64 735f      dict_fields_
-00000890: 6b65 7973 203d 205b 0a20 2020 2020 2020  keys = [.       
-000008a0: 2022 636f 6c72 6576 5f6d 6173 7465 7264   "colrev_masterd
-000008b0: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
-000008c0: 0a20 2020 2020 2020 2022 636f 6c72 6576  .        "colrev
-000008d0: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-000008e0: 222c 0a20 2020 205d 0a0a 2020 2020 7469  ",.    ]..    ti
-000008f0: 6d65 5f76 6172 6961 6e74 5f66 6965 6c64  me_variant_field
-00000900: 7320 3d20 5b22 6369 7465 645f 6279 225d  s = ["cited_by"]
-00000910: 0a0a 2020 2020 7070 203d 2070 7072 696e  ..    pp = pprin
-00000920: 742e 5072 6574 7479 5072 696e 7465 7228  t.PrettyPrinter(
-00000930: 696e 6465 6e74 3d34 2c20 7769 6474 683d  indent=4, width=
-00000940: 3134 302c 2063 6f6d 7061 6374 3d46 616c  140, compact=Fal
-00000950: 7365 290a 0a20 2020 2064 6566 205f 5f69  se)..    def __i
-00000960: 6e69 745f 5f28 7365 6c66 2c20 2a2c 2064  nit__(self, *, d
-00000970: 6174 613a 2064 6963 7429 202d 3e20 4e6f  ata: dict) -> No
-00000980: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
-00000990: 2e64 6174 6120 3d20 6461 7461 0a20 2020  .data = data.   
-000009a0: 2020 2020 2022 2222 4469 6374 696f 6e61       """Dictiona
-000009b0: 7279 2063 6f6e 7461 696e 696e 6720 7468  ry containing th
-000009c0: 6520 7265 636f 7264 2064 6174 6122 2222  e record data"""
-000009d0: 0a20 2020 2020 2020 2023 204e 6f74 6520  .        # Note 
-000009e0: 3a20 6176 6f69 6420 7061 7273 696e 6720  : avoid parsing 
-000009f0: 7570 6f6e 2052 6563 6f72 6420 696e 7374  upon Record inst
-00000a00: 616e 7469 6174 696f 6e20 6173 206d 7563  antiation as muc
-00000a10: 6820 6173 2070 6f73 7369 626c 650a 2020  h as possible.  
-00000a20: 2020 2020 2020 2320 746f 206d 6169 6e74        # to maint
-00000a30: 6169 6e20 6869 6768 2070 6572 666f 726d  ain high perform
-00000a40: 616e 6365 2061 6e64 2065 6e73 7572 6520  ance and ensure 
-00000a50: 7069 636b 6c65 2d61 6269 6c69 6779 2028  pickle-abiligy (
-00000a60: 696e 206d 756c 7469 7072 6f63 6573 7369  in multiprocessi
-00000a70: 6e67 290a 0a20 2020 2064 6566 205f 5f72  ng)..    def __r
-00000a80: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
-00000a90: 7472 3a20 2023 2070 7261 676d 613a 206e  tr:  # pragma: n
-00000aa0: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
-00000ab0: 7265 7475 726e 2073 656c 662e 7070 2e70  return self.pp.p
-00000ac0: 666f 726d 6174 2873 656c 662e 6461 7461  format(self.data
-00000ad0: 290a 0a20 2020 2064 6566 205f 5f73 7472  )..    def __str
-00000ae0: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
-00000af0: 0a20 2020 2020 2020 2069 6465 6e74 6966  .        identif
-00000b00: 7969 6e67 5f6b 6579 735f 6f72 6465 7220  ying_keys_order 
-00000b10: 3d20 5b22 4944 222c 2022 454e 5452 5954  = ["ID", "ENTRYT
-00000b20: 5950 4522 5d20 2b20 5b0a 2020 2020 2020  YPE"] + [.      
-00000b30: 2020 2020 2020 6b20 666f 7220 6b20 696e        k for k in
-00000b40: 2073 656c 662e 6964 656e 7469 6679 696e   self.identifyin
-00000b50: 675f 6669 656c 645f 6b65 7973 2069 6620  g_field_keys if 
-00000b60: 6b20 696e 2073 656c 662e 6461 7461 0a20  k in self.data. 
-00000b70: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00000b80: 2063 6f6d 706c 656d 656e 7461 7279 5f6b   complementary_k
-00000b90: 6579 735f 6f72 6465 7220 3d20 5b0a 2020  eys_order = [.  
-00000ba0: 2020 2020 2020 2020 2020 6b20 666f 7220            k for 
-00000bb0: 6b2c 2076 2069 6e20 7365 6c66 2e64 6174  k, v in self.dat
-00000bc0: 612e 6974 656d 7328 2920 6966 206b 206e  a.items() if k n
-00000bd0: 6f74 2069 6e20 6964 656e 7469 6679 696e  ot in identifyin
-00000be0: 675f 6b65 7973 5f6f 7264 6572 0a20 2020  g_keys_order.   
-00000bf0: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-00000c00: 696b 5f73 6f72 7465 6420 3d20 7b6b 3a20  ik_sorted = {k: 
-00000c10: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
-00000c20: 6c66 2e64 6174 612e 6974 656d 7328 2920  lf.data.items() 
-00000c30: 6966 206b 2069 6e20 6964 656e 7469 6679  if k in identify
-00000c40: 696e 675f 6b65 7973 5f6f 7264 6572 7d0a  ing_keys_order}.
-00000c50: 2020 2020 2020 2020 636b 5f73 6f72 7465          ck_sorte
-00000c60: 6420 3d20 7b0a 2020 2020 2020 2020 2020  d = {.          
-00000c70: 2020 6b3a 2076 2066 6f72 206b 2c20 7620    k: v for k, v 
-00000c80: 696e 2073 656c 662e 6461 7461 2e69 7465  in self.data.ite
-00000c90: 6d73 2829 2069 6620 6b20 696e 2063 6f6d  ms() if k in com
-00000ca0: 706c 656d 656e 7461 7279 5f6b 6579 735f  plementary_keys_
-00000cb0: 6f72 6465 720a 2020 2020 2020 2020 7d0a  order.        }.
-00000cc0: 2020 2020 2020 2020 7265 745f 7374 7220          ret_str 
-00000cd0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00000ce0: 7365 6c66 2e70 702e 7066 6f72 6d61 7428  self.pp.pformat(
-00000cf0: 696b 5f73 6f72 7465 6429 5b3a 2d31 5d20  ik_sorted)[:-1] 
-00000d00: 2b20 225c 6e22 202b 2073 656c 662e 7070  + "\n" + self.pp
-00000d10: 2e70 666f 726d 6174 2863 6b5f 736f 7274  .pformat(ck_sort
-00000d20: 6564 295b 313a 5d0a 2020 2020 2020 2020  ed)[1:].        
-00000d30: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00000d40: 6e20 7265 745f 7374 720a 0a20 2020 2064  n ret_str..    d
-00000d50: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
-00000d60: 6f74 6865 723a 206f 626a 6563 7429 202d  other: object) -
-00000d70: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-00000d80: 7265 7475 726e 2073 656c 662e 5f5f 6469  return self.__di
-00000d90: 6374 5f5f 203d 3d20 6f74 6865 722e 5f5f  ct__ == other.__
-00000da0: 6469 6374 5f5f 0a0a 2020 2020 6465 6620  dict__..    def 
-00000db0: 636f 7079 2873 656c 6629 202d 3e20 5265  copy(self) -> Re
-00000dc0: 636f 7264 3a0a 2020 2020 2020 2020 2222  cord:.        ""
-00000dd0: 2243 6f70 7920 7468 6520 7265 636f 7264  "Copy the record
-00000de0: 206f 626a 6563 7422 2222 0a20 2020 2020   object""".     
-00000df0: 2020 2072 6574 7572 6e20 5265 636f 7264     return Record
-00000e00: 2864 6174 613d 6465 6570 636f 7079 2873  (data=deepcopy(s
-00000e10: 656c 662e 6461 7461 2929 0a0a 2020 2020  elf.data))..    
-00000e20: 6465 6620 636f 7079 5f70 7265 705f 7265  def copy_prep_re
-00000e30: 6328 7365 6c66 2920 2d3e 2050 7265 7052  c(self) -> PrepR
-00000e40: 6563 6f72 643a 0a20 2020 2020 2020 2022  ecord:.        "
-00000e50: 2222 436f 7079 2074 6865 2072 6563 6f72  ""Copy the recor
-00000e60: 6420 6f62 6a65 6374 2028 6173 2061 2050  d object (as a P
-00000e70: 7265 7052 6563 6f72 6429 2222 220a 2020  repRecord)""".  
-00000e80: 2020 2020 2020 7265 7475 726e 2050 7265        return Pre
-00000e90: 7052 6563 6f72 6428 6461 7461 3d64 6565  pRecord(data=dee
-00000ea0: 7063 6f70 7928 7365 6c66 2e64 6174 6129  pcopy(self.data)
-00000eb0: 290a 0a20 2020 2064 6566 2075 7064 6174  )..    def updat
-00000ec0: 655f 6279 5f72 6563 6f72 6428 7365 6c66  e_by_record(self
-00000ed0: 2c20 2a2c 2075 7064 6174 655f 7265 636f  , *, update_reco
-00000ee0: 7264 3a20 5265 636f 7264 2920 2d3e 204e  rd: Record) -> N
-00000ef0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00000f00: 5570 6461 7465 2061 6c6c 2064 6174 6120  Update all data 
-00000f10: 6f66 2061 2072 6563 6f72 6420 6f62 6a65  of a record obje
-00000f20: 6374 2062 6173 6564 206f 6e20 616e 6f74  ct based on anot
-00000f30: 6865 7220 7265 636f 7264 2222 220a 2020  her record""".  
-00000f40: 2020 2020 2020 7365 6c66 2e64 6174 6120        self.data 
-00000f50: 3d20 7570 6461 7465 5f72 6563 6f72 642e  = update_record.
-00000f60: 636f 7079 5f70 7265 705f 7265 6328 292e  copy_prep_rec().
-00000f70: 6765 745f 6461 7461 2829 0a0a 2020 2020  get_data()..    
-00000f80: 6465 6620 6765 745f 6469 6666 280a 2020  def get_diff(.  
-00000f90: 2020 2020 2020 7365 6c66 2c20 2a2c 206f        self, *, o
-00000fa0: 7468 6572 5f72 6563 6f72 643a 2052 6563  ther_record: Rec
-00000fb0: 6f72 642c 2069 6465 6e74 6966 7969 6e67  ord, identifying
-00000fc0: 5f66 6965 6c64 735f 6f6e 6c79 3a20 626f  _fields_only: bo
-00000fd0: 6f6c 203d 2054 7275 650a 2020 2020 2920  ol = True.    ) 
-00000fe0: 2d3e 206c 6973 743a 0a20 2020 2020 2020  -> list:.       
-00000ff0: 2022 2222 4765 7420 6469 6666 2062 6574   """Get diff bet
-00001000: 7765 656e 2072 6563 6f72 6420 6f62 6a65  ween record obje
-00001010: 6374 7322 2222 0a0a 2020 2020 2020 2020  cts"""..        
-00001020: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
-00001030: 653d 746f 6f2d 6d61 6e79 2d62 7261 6e63  e=too-many-branc
-00001040: 6865 730a 0a20 2020 2020 2020 2064 6966  hes..        dif
-00001050: 6620 3d20 5b5d 0a20 2020 2020 2020 2069  f = [].        i
-00001060: 6620 6964 656e 7469 6679 696e 675f 6669  f identifying_fi
-00001070: 656c 6473 5f6f 6e6c 793a 0a20 2020 2020  elds_only:.     
-00001080: 2020 2020 2020 2066 6f72 2073 656c 6563         for selec
-00001090: 7465 645f 7475 706c 6520 696e 206c 6973  ted_tuple in lis
-000010a0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-000010b0: 2020 2064 6963 7464 6966 6665 722e 6469     dictdiffer.di
-000010c0: 6666 2873 656c 662e 6765 745f 6461 7461  ff(self.get_data
-000010d0: 2829 2c20 6f74 6865 725f 7265 636f 7264  (), other_record
-000010e0: 2e67 6574 5f64 6174 6128 2929 0a20 2020  .get_data()).   
-000010f0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-00001100: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00001110: 656c 6563 7465 645f 7475 706c 655b 305d  elected_tuple[0]
-00001120: 203d 3d20 2263 6861 6e67 6522 3a0a 2020   == "change":.  
-00001130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001140: 2020 6966 2073 656c 6563 7465 645f 7475    if selected_tu
-00001150: 706c 655b 315d 2069 6e20 7365 6c66 2e69  ple[1] in self.i
-00001160: 6465 6e74 6966 7969 6e67 5f66 6965 6c64  dentifying_field
-00001170: 5f6b 6579 733a 0a20 2020 2020 2020 2020  _keys:.         
-00001180: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00001190: 6966 662e 6170 7065 6e64 2873 656c 6563  iff.append(selec
-000011a0: 7465 645f 7475 706c 6529 0a20 2020 2020  ted_tuple).     
-000011b0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000011c0: 6c65 6374 6564 5f74 7570 6c65 5b30 5d20  lected_tuple[0] 
-000011d0: 3d3d 2022 6164 6422 3a0a 2020 2020 2020  == "add":.      
-000011e0: 2020 2020 2020 2020 2020 2020 2020 6164                ad
-000011f0: 6469 7469 6f6e 5f6c 6973 743a 2074 7970  dition_list: typ
-00001200: 696e 672e 5475 706c 6520 3d20 2822 6164  ing.Tuple = ("ad
-00001210: 6422 2c20 2222 2c20 5b5d 290a 2020 2020  d", "", []).    
+00000350: 706f 7274 2050 6466 4669 6c65 5265 6164  port PdfFileRead
+00000360: 6572 0a66 726f 6d20 5079 5044 4632 2069  er.from PyPDF2 i
+00000370: 6d70 6f72 7420 5064 6646 696c 6557 7269  mport PdfFileWri
+00000380: 7465 720a 6672 6f6d 2074 6865 6675 7a7a  ter.from thefuzz
+00000390: 2069 6d70 6f72 7420 6675 7a7a 0a0a 696d   import fuzz..im
+000003a0: 706f 7274 2063 6f6c 7265 762e 656e 762e  port colrev.env.
+000003b0: 7574 696c 730a 696d 706f 7274 2063 6f6c  utils.import col
+000003c0: 7265 762e 6578 6365 7074 696f 6e73 2061  rev.exceptions a
+000003d0: 7320 636f 6c72 6576 5f65 7863 6570 7469  s colrev_excepti
+000003e0: 6f6e 730a 696d 706f 7274 2063 6f6c 7265  ons.import colre
+000003f0: 762e 6f70 732e 6275 696c 745f 696e 2e70  v.ops.built_in.p
+00000400: 7265 702e 7574 696c 7320 6173 2070 7265  rep.utils as pre
+00000410: 705f 7574 696c 730a 696d 706f 7274 2063  p_utils.import c
+00000420: 6f6c 7265 762e 716d 2e63 6f6c 7265 765f  olrev.qm.colrev_
+00000430: 6964 0a69 6d70 6f72 7420 636f 6c72 6576  id.import colrev
+00000440: 2e71 6d2e 636f 6c72 6576 5f70 6466 5f69  .qm.colrev_pdf_i
+00000450: 640a 696d 706f 7274 2063 6f6c 7265 762e  d.import colrev.
+00000460: 7569 5f63 6c69 2e63 6c69 5f63 6f6c 6f72  ui_cli.cli_color
+00000470: 7320 6173 2063 6f6c 6f72 730a 0a69 6620  s as colors..if 
+00000480: 5459 5045 5f43 4845 434b 494e 473a 0a20  TYPE_CHECKING:. 
+00000490: 2020 2069 6d70 6f72 7420 636f 6c72 6576     import colrev
+000004a0: 2e72 6576 6965 775f 6d61 6e61 6765 720a  .review_manager.
+000004b0: 2020 2020 696d 706f 7274 2063 6f6c 7265      import colre
+000004c0: 762e 716d 2e71 7561 6c69 7479 5f6d 6f64  v.qm.quality_mod
+000004d0: 656c 0a0a 2320 7079 6c69 6e74 3a20 6469  el..# pylint: di
+000004e0: 7361 626c 653d 746f 6f2d 6d61 6e79 2d6c  sable=too-many-l
+000004f0: 696e 6573 0a23 2070 796c 696e 743a 2064  ines.# pylint: d
+00000500: 6973 6162 6c65 3d74 6f6f 2d6d 616e 792d  isable=too-many-
+00000510: 7075 626c 6963 2d6d 6574 686f 6473 0a0a  public-methods..
+00000520: 0a63 6c61 7373 2052 6563 6f72 643a 0a20  .class Record:. 
+00000530: 2020 2022 2222 5468 6520 5265 636f 7264     """The Record
+00000540: 2063 6c61 7373 2070 726f 7669 6465 7320   class provides 
+00000550: 6120 7261 6e67 6520 6f66 2062 6173 6963  a range of basic
+00000560: 2063 6f6e 7665 6e69 656e 6365 2066 756e   convenience fun
+00000570: 6374 696f 6e73 2222 220a 0a20 2020 2069  ctions"""..    i
+00000580: 6465 6e74 6966 7969 6e67 5f66 6965 6c64  dentifying_field
+00000590: 5f6b 6579 7320 3d20 5b0a 2020 2020 2020  _keys = [.      
+000005a0: 2020 2274 6974 6c65 222c 0a20 2020 2020    "title",.     
+000005b0: 2020 2022 6175 7468 6f72 222c 0a20 2020     "author",.   
+000005c0: 2020 2020 2022 7965 6172 222c 0a20 2020       "year",.   
+000005d0: 2020 2020 2022 6a6f 7572 6e61 6c22 2c0a       "journal",.
+000005e0: 2020 2020 2020 2020 2262 6f6f 6b74 6974          "booktit
+000005f0: 6c65 222c 0a20 2020 2020 2020 2022 6368  le",.        "ch
+00000600: 6170 7465 7222 2c0a 2020 2020 2020 2020  apter",.        
+00000610: 2270 7562 6c69 7368 6572 222c 0a20 2020  "publisher",.   
+00000620: 2020 2020 2022 766f 6c75 6d65 222c 0a20       "volume",. 
+00000630: 2020 2020 2020 2022 6e75 6d62 6572 222c         "number",
+00000640: 0a20 2020 2020 2020 2022 7061 6765 7322  .        "pages"
+00000650: 2c0a 2020 2020 2020 2020 2265 6469 746f  ,.        "edito
+00000660: 7222 2c0a 2020 2020 5d0a 2020 2020 2222  r",.    ].    ""
+00000670: 224b 6579 7320 6f66 2069 6465 6e74 6966  "Keys of identif
+00000680: 7969 6e67 2066 6965 6c64 7320 636f 6e73  ying fields cons
+00000690: 6964 6572 6564 2066 6f72 206d 6173 7465  idered for maste
+000006a0: 7264 6174 6120 7072 6f76 656e 616e 6365  rdata provenance
+000006b0: 2222 220a 0a20 2020 2070 726f 7665 6e61  """..    provena
+000006c0: 6e63 655f 6b65 7973 203d 205b 0a20 2020  nce_keys = [.   
+000006d0: 2020 2020 2022 636f 6c72 6576 5f6d 6173       "colrev_mas
+000006e0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+000006f0: 6365 222c 0a20 2020 2020 2020 2022 636f  ce",.        "co
+00000700: 6c72 6576 5f6f 7269 6769 6e22 2c0a 2020  lrev_origin",.  
+00000710: 2020 2020 2020 2263 6f6c 7265 765f 7374        "colrev_st
+00000720: 6174 7573 222c 0a20 2020 2020 2020 2022  atus",.        "
+00000730: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+00000740: 656e 616e 6365 222c 0a20 2020 2020 2020  enance",.       
+00000750: 2022 636f 6c72 6576 5f70 6466 5f69 6422   "colrev_pdf_id"
+00000760: 2c0a 2020 2020 2020 2020 224d 4f56 4544  ,.        "MOVED
+00000770: 5f44 5550 455f 4944 222c 0a20 2020 205d  _DUPE_ID",.    ]
+00000780: 0a0a 2020 2020 7072 6566 6572 7265 645f  ..    preferred_
+00000790: 736f 7572 6365 7320 3d20 5b22 6874 7470  sources = ["http
+000007a0: 733a 2f2f 6170 692e 6372 6f73 7372 6566  s://api.crossref
+000007b0: 2e6f 7267 2f77 6f72 6b73 2f22 2c20 2263  .org/works/", "c
+000007c0: 6974 6561 732e 6f72 6722 5d0a 0a20 2020  iteas.org"]..   
+000007d0: 2023 2046 6965 6c64 7320 7468 6174 2061   # Fields that a
+000007e0: 7265 2073 746f 7265 6420 6173 206c 6973  re stored as lis
+000007f0: 7473 2028 6974 656d 7320 7365 7061 7261  ts (items separa
+00000800: 7465 6420 6279 206e 6577 6c69 6e65 7329  ted by newlines)
+00000810: 0a20 2020 206c 6973 745f 6669 656c 6473  .    list_fields
+00000820: 5f6b 6579 7320 3d20 5b0a 2020 2020 2020  _keys = [.      
+00000830: 2020 2263 6f6c 7265 765f 6f72 6967 696e    "colrev_origin
+00000840: 222c 0a20 2020 2020 2020 2023 2022 636f  ",.        # "co
+00000850: 6c72 6576 5f70 6466 5f69 6422 2c0a 2020  lrev_pdf_id",.  
+00000860: 2020 2020 2020 2320 2273 6372 6565 6e69        # "screeni
+00000870: 6e67 5f63 7269 7465 7269 6122 2c0a 2020  ng_criteria",.  
+00000880: 2020 5d0a 2020 2020 6469 6374 5f66 6965    ].    dict_fie
+00000890: 6c64 735f 6b65 7973 203d 205b 0a20 2020  lds_keys = [.   
+000008a0: 2020 2020 2022 636f 6c72 6576 5f6d 6173       "colrev_mas
+000008b0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+000008c0: 6365 222c 0a20 2020 2020 2020 2022 636f  ce",.        "co
+000008d0: 6c72 6576 5f64 6174 615f 7072 6f76 656e  lrev_data_proven
+000008e0: 616e 6365 222c 0a20 2020 205d 0a0a 2020  ance",.    ]..  
+000008f0: 2020 7469 6d65 5f76 6172 6961 6e74 5f66    time_variant_f
+00000900: 6965 6c64 7320 3d20 5b22 6369 7465 645f  ields = ["cited_
+00000910: 6279 225d 0a0a 2020 2020 7070 203d 2070  by"]..    pp = p
+00000920: 7072 696e 742e 5072 6574 7479 5072 696e  print.PrettyPrin
+00000930: 7465 7228 696e 6465 6e74 3d34 2c20 7769  ter(indent=4, wi
+00000940: 6474 683d 3134 302c 2063 6f6d 7061 6374  dth=140, compact
+00000950: 3d46 616c 7365 290a 0a20 2020 2064 6566  =False)..    def
+00000960: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00000970: 2a2c 2064 6174 613a 2064 6963 7429 202d  *, data: dict) -
+00000980: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00000990: 7365 6c66 2e64 6174 6120 3d20 6461 7461  self.data = data
+000009a0: 0a20 2020 2020 2020 2022 2222 4469 6374  .        """Dict
+000009b0: 696f 6e61 7279 2063 6f6e 7461 696e 696e  ionary containin
+000009c0: 6720 7468 6520 7265 636f 7264 2064 6174  g the record dat
+000009d0: 6122 2222 0a20 2020 2020 2020 2023 204e  a""".        # N
+000009e0: 6f74 6520 3a20 6176 6f69 6420 7061 7273  ote : avoid pars
+000009f0: 696e 6720 7570 6f6e 2052 6563 6f72 6420  ing upon Record 
+00000a00: 696e 7374 616e 7469 6174 696f 6e20 6173  instantiation as
+00000a10: 206d 7563 6820 6173 2070 6f73 7369 626c   much as possibl
+00000a20: 650a 2020 2020 2020 2020 2320 746f 206d  e.        # to m
+00000a30: 6169 6e74 6169 6e20 6869 6768 2070 6572  aintain high per
+00000a40: 666f 726d 616e 6365 2061 6e64 2065 6e73  formance and ens
+00000a50: 7572 6520 7069 636b 6c65 2d61 6269 6c69  ure pickle-abili
+00000a60: 6779 2028 696e 206d 756c 7469 7072 6f63  gy (in multiproc
+00000a70: 6573 7369 6e67 290a 0a20 2020 2064 6566  essing)..    def
+00000a80: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
+00000a90: 2d3e 2073 7472 3a20 2023 2070 7261 676d  -> str:  # pragm
+00000aa0: 613a 206e 6f20 636f 7665 720a 2020 2020  a: no cover.    
+00000ab0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00000ac0: 7070 2e70 666f 726d 6174 2873 656c 662e  pp.pformat(self.
+00000ad0: 6461 7461 290a 0a20 2020 2064 6566 205f  data)..    def _
+00000ae0: 5f73 7472 5f5f 2873 656c 6629 202d 3e20  _str__(self) -> 
+00000af0: 7374 723a 0a20 2020 2020 2020 2069 6465  str:.        ide
+00000b00: 6e74 6966 7969 6e67 5f6b 6579 735f 6f72  ntifying_keys_or
+00000b10: 6465 7220 3d20 5b22 4944 222c 2022 454e  der = ["ID", "EN
+00000b20: 5452 5954 5950 4522 5d20 2b20 5b0a 2020  TRYTYPE"] + [.  
+00000b30: 2020 2020 2020 2020 2020 6b20 666f 7220            k for 
+00000b40: 6b20 696e 2073 656c 662e 6964 656e 7469  k in self.identi
+00000b50: 6679 696e 675f 6669 656c 645f 6b65 7973  fying_field_keys
+00000b60: 2069 6620 6b20 696e 2073 656c 662e 6461   if k in self.da
+00000b70: 7461 0a20 2020 2020 2020 205d 0a20 2020  ta.        ].   
+00000b80: 2020 2020 2063 6f6d 706c 656d 656e 7461       complementa
+00000b90: 7279 5f6b 6579 735f 6f72 6465 7220 3d20  ry_keys_order = 
+00000ba0: 5b0a 2020 2020 2020 2020 2020 2020 6b20  [.            k 
+00000bb0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+00000bc0: 2e64 6174 612e 6974 656d 7328 2920 6966  .data.items() if
+00000bd0: 206b 206e 6f74 2069 6e20 6964 656e 7469   k not in identi
+00000be0: 6679 696e 675f 6b65 7973 5f6f 7264 6572  fying_keys_order
+00000bf0: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
+00000c00: 2020 2020 696b 5f73 6f72 7465 6420 3d20      ik_sorted = 
+00000c10: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+00000c20: 6e20 7365 6c66 2e64 6174 612e 6974 656d  n self.data.item
+00000c30: 7328 2920 6966 206b 2069 6e20 6964 656e  s() if k in iden
+00000c40: 7469 6679 696e 675f 6b65 7973 5f6f 7264  tifying_keys_ord
+00000c50: 6572 7d0a 2020 2020 2020 2020 636b 5f73  er}.        ck_s
+00000c60: 6f72 7465 6420 3d20 7b0a 2020 2020 2020  orted = {.      
+00000c70: 2020 2020 2020 6b3a 2076 2066 6f72 206b        k: v for k
+00000c80: 2c20 7620 696e 2073 656c 662e 6461 7461  , v in self.data
+00000c90: 2e69 7465 6d73 2829 2069 6620 6b20 696e  .items() if k in
+00000ca0: 2063 6f6d 706c 656d 656e 7461 7279 5f6b   complementary_k
+00000cb0: 6579 735f 6f72 6465 720a 2020 2020 2020  eys_order.      
+00000cc0: 2020 7d0a 2020 2020 2020 2020 7265 745f    }.        ret_
+00000cd0: 7374 7220 3d20 280a 2020 2020 2020 2020  str = (.        
+00000ce0: 2020 2020 7365 6c66 2e70 702e 7066 6f72      self.pp.pfor
+00000cf0: 6d61 7428 696b 5f73 6f72 7465 6429 5b3a  mat(ik_sorted)[:
+00000d00: 2d31 5d20 2b20 225c 6e22 202b 2073 656c  -1] + "\n" + sel
+00000d10: 662e 7070 2e70 666f 726d 6174 2863 6b5f  f.pp.pformat(ck_
+00000d20: 736f 7274 6564 295b 313a 5d0a 2020 2020  sorted)[1:].    
+00000d30: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
+00000d40: 6574 7572 6e20 7265 745f 7374 720a 0a20  eturn ret_str.. 
+00000d50: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
+00000d60: 6c66 2c20 6f74 6865 723a 206f 626a 6563  lf, other: objec
+00000d70: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
+00000d80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00000d90: 5f5f 6469 6374 5f5f 203d 3d20 6f74 6865  __dict__ == othe
+00000da0: 722e 5f5f 6469 6374 5f5f 0a0a 2020 2020  r.__dict__..    
+00000db0: 6465 6620 636f 7079 2873 656c 6629 202d  def copy(self) -
+00000dc0: 3e20 5265 636f 7264 3a0a 2020 2020 2020  > Record:.      
+00000dd0: 2020 2222 2243 6f70 7920 7468 6520 7265    """Copy the re
+00000de0: 636f 7264 206f 626a 6563 7422 2222 0a20  cord object""". 
+00000df0: 2020 2020 2020 2072 6574 7572 6e20 5265         return Re
+00000e00: 636f 7264 2864 6174 613d 6465 6570 636f  cord(data=deepco
+00000e10: 7079 2873 656c 662e 6461 7461 2929 0a0a  py(self.data))..
+00000e20: 2020 2020 6465 6620 636f 7079 5f70 7265      def copy_pre
+00000e30: 705f 7265 6328 7365 6c66 2920 2d3e 2050  p_rec(self) -> P
+00000e40: 7265 7052 6563 6f72 643a 0a20 2020 2020  repRecord:.     
+00000e50: 2020 2022 2222 436f 7079 2074 6865 2072     """Copy the r
+00000e60: 6563 6f72 6420 6f62 6a65 6374 2028 6173  ecord object (as
+00000e70: 2061 2050 7265 7052 6563 6f72 6429 2222   a PrepRecord)""
+00000e80: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00000e90: 2050 7265 7052 6563 6f72 6428 6461 7461   PrepRecord(data
+00000ea0: 3d64 6565 7063 6f70 7928 7365 6c66 2e64  =deepcopy(self.d
+00000eb0: 6174 6129 290a 0a20 2020 2064 6566 2075  ata))..    def u
+00000ec0: 7064 6174 655f 6279 5f72 6563 6f72 6428  pdate_by_record(
+00000ed0: 7365 6c66 2c20 2a2c 2075 7064 6174 655f  self, *, update_
+00000ee0: 7265 636f 7264 3a20 5265 636f 7264 2920  record: Record) 
+00000ef0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00000f00: 2022 2222 5570 6461 7465 2061 6c6c 2064   """Update all d
+00000f10: 6174 6120 6f66 2061 2072 6563 6f72 6420  ata of a record 
+00000f20: 6f62 6a65 6374 2062 6173 6564 206f 6e20  object based on 
+00000f30: 616e 6f74 6865 7220 7265 636f 7264 2222  another record""
+00000f40: 220a 2020 2020 2020 2020 7365 6c66 2e64  ".        self.d
+00000f50: 6174 6120 3d20 7570 6461 7465 5f72 6563  ata = update_rec
+00000f60: 6f72 642e 636f 7079 5f70 7265 705f 7265  ord.copy_prep_re
+00000f70: 6328 292e 6765 745f 6461 7461 2829 0a0a  c().get_data()..
+00000f80: 2020 2020 6465 6620 6765 745f 6469 6666      def get_diff
+00000f90: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00000fa0: 2a2c 206f 7468 6572 5f72 6563 6f72 643a  *, other_record:
+00000fb0: 2052 6563 6f72 642c 2069 6465 6e74 6966   Record, identif
+00000fc0: 7969 6e67 5f66 6965 6c64 735f 6f6e 6c79  ying_fields_only
+00000fd0: 3a20 626f 6f6c 203d 2054 7275 650a 2020  : bool = True.  
+00000fe0: 2020 2920 2d3e 206c 6973 743a 0a20 2020    ) -> list:.   
+00000ff0: 2020 2020 2022 2222 4765 7420 6469 6666       """Get diff
+00001000: 2062 6574 7765 656e 2072 6563 6f72 6420   between record 
+00001010: 6f62 6a65 6374 7322 2222 0a0a 2020 2020  objects"""..    
+00001020: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
+00001030: 7361 626c 653d 746f 6f2d 6d61 6e79 2d62  sable=too-many-b
+00001040: 7261 6e63 6865 730a 0a20 2020 2020 2020  ranches..       
+00001050: 2064 6966 6620 3d20 5b5d 0a20 2020 2020   diff = [].     
+00001060: 2020 2069 6620 6964 656e 7469 6679 696e     if identifyin
+00001070: 675f 6669 656c 6473 5f6f 6e6c 793a 0a20  g_fields_only:. 
+00001080: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00001090: 656c 6563 7465 645f 7475 706c 6520 696e  elected_tuple in
+000010a0: 206c 6973 7428 0a20 2020 2020 2020 2020   list(.         
+000010b0: 2020 2020 2020 2064 6963 7464 6966 6665         dictdiffe
+000010c0: 722e 6469 6666 2873 656c 662e 6765 745f  r.diff(self.get_
+000010d0: 6461 7461 2829 2c20 6f74 6865 725f 7265  data(), other_re
+000010e0: 636f 7264 2e67 6574 5f64 6174 6128 2929  cord.get_data())
+000010f0: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
+00001100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001110: 6966 2073 656c 6563 7465 645f 7475 706c  if selected_tupl
+00001120: 655b 305d 203d 3d20 2263 6861 6e67 6522  e[0] == "change"
+00001130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001140: 2020 2020 2020 6966 2073 656c 6563 7465        if selecte
+00001150: 645f 7475 706c 655b 315d 2069 6e20 7365  d_tuple[1] in se
+00001160: 6c66 2e69 6465 6e74 6966 7969 6e67 5f66  lf.identifying_f
+00001170: 6965 6c64 5f6b 6579 733a 0a20 2020 2020  ield_keys:.     
+00001180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001190: 2020 2064 6966 662e 6170 7065 6e64 2873     diff.append(s
+000011a0: 656c 6563 7465 645f 7475 706c 6529 0a20  elected_tuple). 
+000011b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000011c0: 6620 7365 6c65 6374 6564 5f74 7570 6c65  f selected_tuple
+000011d0: 5b30 5d20 3d3d 2022 6164 6422 3a0a 2020  [0] == "add":.  
+000011e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011f0: 2020 6164 6469 7469 6f6e 5f6c 6973 743a    addition_list:
+00001200: 2074 7970 696e 672e 5475 706c 6520 3d20   typing.Tuple = 
+00001210: 2822 6164 6422 2c20 2222 2c20 5b5d 290a  ("add", "", []).
 00001220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001230: 666f 7220 6164 6469 7469 6f6e 5f69 7465  for addition_ite
-00001240: 6d20 696e 2073 656c 6563 7465 645f 7475  m in selected_tu
-00001250: 706c 655b 325d 3a0a 2020 2020 2020 2020  ple[2]:.        
+00001230: 2020 2020 666f 7220 6164 6469 7469 6f6e      for addition
+00001240: 5f69 7465 6d20 696e 2073 656c 6563 7465  _item in selecte
+00001250: 645f 7475 706c 655b 325d 3a0a 2020 2020  d_tuple[2]:.    
 00001260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001270: 6966 2061 6464 6974 696f 6e5f 6974 656d  if addition_item
-00001280: 5b30 5d20 696e 2073 656c 662e 6964 656e  [0] in self.iden
-00001290: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
-000012a0: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
+00001270: 2020 2020 6966 2061 6464 6974 696f 6e5f      if addition_
+00001280: 6974 656d 5b30 5d20 696e 2073 656c 662e  item[0] in self.
+00001290: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
+000012a0: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
 000012b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012c0: 6164 6469 7469 6f6e 5f6c 6973 745b 325d  addition_list[2]
-000012d0: 2e61 7070 656e 6428 6164 6469 7469 6f6e  .append(addition
-000012e0: 5f69 7465 6d29 0a20 2020 2020 2020 2020  _item).         
-000012f0: 2020 2020 2020 2020 2020 2069 6620 6164             if ad
-00001300: 6469 7469 6f6e 5f6c 6973 745b 325d 3a0a  dition_list[2]:.
-00001310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001320: 2020 2020 2020 2020 6469 6666 2e61 7070          diff.app
-00001330: 656e 6428 6164 6469 7469 6f6e 5f6c 6973  end(addition_lis
-00001340: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00001350: 2020 2069 6620 7365 6c65 6374 6564 5f74     if selected_t
-00001360: 7570 6c65 5b30 5d20 3d3d 2022 7265 6d6f  uple[0] == "remo
-00001370: 7665 223a 0a20 2020 2020 2020 2020 2020  ve":.           
-00001380: 2020 2020 2020 2020 2072 656d 6f76 616c           removal
-00001390: 5f6c 6973 743a 2074 7970 696e 672e 5475  _list: typing.Tu
-000013a0: 706c 6520 3d20 2822 7265 6d6f 7665 222c  ple = ("remove",
-000013b0: 2022 222c 205b 5d29 0a20 2020 2020 2020   "", []).       
-000013c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000013d0: 2072 656d 6f76 616c 5f69 7465 6d20 696e   removal_item in
-000013e0: 2073 656c 6563 7465 645f 7475 706c 655b   selected_tuple[
-000013f0: 325d 3a0a 2020 2020 2020 2020 2020 2020  2]:.            
-00001400: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00001410: 656d 6f76 616c 5f69 7465 6d5b 305d 2069  emoval_item[0] i
-00001420: 6e20 7365 6c66 2e69 6465 6e74 6966 7969  n self.identifyi
-00001430: 6e67 5f66 6965 6c64 5f6b 6579 733a 0a20  ng_field_keys:. 
-00001440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001450: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
-00001460: 616c 5f6c 6973 745b 325d 2e61 7070 656e  al_list[2].appen
-00001470: 6428 7265 6d6f 7661 6c5f 6974 656d 290a  d(removal_item).
-00001480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001490: 2020 2020 6966 2072 656d 6f76 616c 5f6c      if removal_l
-000014a0: 6973 745b 325d 3a0a 2020 2020 2020 2020  ist[2]:.        
+000012c0: 2020 2020 6164 6469 7469 6f6e 5f6c 6973      addition_lis
+000012d0: 745b 325d 2e61 7070 656e 6428 6164 6469  t[2].append(addi
+000012e0: 7469 6f6e 5f69 7465 6d29 0a20 2020 2020  tion_item).     
+000012f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001300: 6620 6164 6469 7469 6f6e 5f6c 6973 745b  f addition_list[
+00001310: 325d 3a0a 2020 2020 2020 2020 2020 2020  2]:.            
+00001320: 2020 2020 2020 2020 2020 2020 6469 6666              diff
+00001330: 2e61 7070 656e 6428 6164 6469 7469 6f6e  .append(addition
+00001340: 5f6c 6973 7429 0a20 2020 2020 2020 2020  _list).         
+00001350: 2020 2020 2020 2069 6620 7365 6c65 6374         if select
+00001360: 6564 5f74 7570 6c65 5b30 5d20 3d3d 2022  ed_tuple[0] == "
+00001370: 7265 6d6f 7665 223a 0a20 2020 2020 2020  remove":.       
+00001380: 2020 2020 2020 2020 2020 2020 2072 656d               rem
+00001390: 6f76 616c 5f6c 6973 743a 2074 7970 696e  oval_list: typin
+000013a0: 672e 5475 706c 6520 3d20 2822 7265 6d6f  g.Tuple = ("remo
+000013b0: 7665 222c 2022 222c 205b 5d29 0a20 2020  ve", "", []).   
+000013c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013d0: 2066 6f72 2072 656d 6f76 616c 5f69 7465   for removal_ite
+000013e0: 6d20 696e 2073 656c 6563 7465 645f 7475  m in selected_tu
+000013f0: 706c 655b 325d 3a0a 2020 2020 2020 2020  ple[2]:.        
+00001400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001410: 6966 2072 656d 6f76 616c 5f69 7465 6d5b  if removal_item[
+00001420: 305d 2069 6e20 7365 6c66 2e69 6465 6e74  0] in self.ident
+00001430: 6966 7969 6e67 5f66 6965 6c64 5f6b 6579  ifying_field_key
+00001440: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00001450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00001460: 656d 6f76 616c 5f6c 6973 745b 325d 2e61  emoval_list[2].a
+00001470: 7070 656e 6428 7265 6d6f 7661 6c5f 6974  ppend(removal_it
+00001480: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+00001490: 2020 2020 2020 2020 6966 2072 656d 6f76          if remov
+000014a0: 616c 5f6c 6973 745b 325d 3a0a 2020 2020  al_list[2]:.    
 000014b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014c0: 6469 6666 2e61 7070 656e 6428 7265 6d6f  diff.append(remo
-000014d0: 7661 6c5f 6c69 7374 290a 2020 2020 2020  val_list).      
-000014e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000014f0: 2020 2020 6469 6666 203d 206c 6973 7428      diff = list(
-00001500: 6469 6374 6469 6666 6572 2e64 6966 6628  dictdiffer.diff(
-00001510: 7365 6c66 2e67 6574 5f64 6174 6128 292c  self.get_data(),
-00001520: 206f 7468 6572 5f72 6563 6f72 642e 6765   other_record.ge
-00001530: 745f 6461 7461 2829 2929 0a0a 2020 2020  t_data()))..    
-00001540: 2020 2020 7265 7475 726e 2064 6966 660a      return diff.
-00001550: 0a20 2020 2064 6566 2066 6f72 6d61 745f  .    def format_
-00001560: 6269 625f 7374 796c 6528 7365 6c66 2920  bib_style(self) 
-00001570: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-00001580: 2222 2253 696d 706c 6520 666f 726d 6174  """Simple format
-00001590: 7465 7220 666f 7220 6269 626c 696f 6772  ter for bibliogr
-000015a0: 6170 6879 2d73 7479 6c65 206f 7574 7075  aphy-style outpu
-000015b0: 7422 2222 0a20 2020 2020 2020 2062 6962  t""".        bib
-000015c0: 5f66 6f72 6d61 7474 6564 203d 2028 0a20  _formatted = (. 
-000015d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000015e0: 6461 7461 2e67 6574 2822 6175 7468 6f72  data.get("author
-000015f0: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
-00001600: 2020 202b 2022 2028 220a 2020 2020 2020     + " (".      
-00001610: 2020 2020 2020 2b20 7365 6c66 2e64 6174        + self.dat
-00001620: 612e 6765 7428 2279 6561 7222 2c20 2222  a.get("year", ""
-00001630: 290a 2020 2020 2020 2020 2020 2020 2b20  ).            + 
-00001640: 2229 2022 0a20 2020 2020 2020 2020 2020  ") ".           
-00001650: 202b 2073 656c 662e 6461 7461 2e67 6574   + self.data.get
-00001660: 2822 7469 746c 6522 2c20 2222 290a 2020  ("title", "").  
-00001670: 2020 2020 2020 2020 2020 2b20 222e 2022            + ". "
-00001680: 0a20 2020 2020 2020 2020 2020 202b 2073  .            + s
-00001690: 656c 662e 6461 7461 2e67 6574 2822 6a6f  elf.data.get("jo
-000016a0: 7572 6e61 6c22 2c20 2222 290a 2020 2020  urnal", "").    
-000016b0: 2020 2020 2020 2020 2b20 7365 6c66 2e64          + self.d
-000016c0: 6174 612e 6765 7428 2262 6f6f 6b74 6974  ata.get("booktit
-000016d0: 6c65 222c 2022 2229 0a20 2020 2020 2020  le", "").       
-000016e0: 2020 2020 202b 2022 2c20 2822 0a20 2020       + ", (".   
-000016f0: 2020 2020 2020 2020 202b 2073 656c 662e           + self.
-00001700: 6461 7461 2e67 6574 2822 766f 6c75 6d65  data.get("volume
-00001710: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
-00001720: 2020 202b 2022 2920 220a 2020 2020 2020     + ") ".      
-00001730: 2020 2020 2020 2b20 7365 6c66 2e64 6174        + self.dat
-00001740: 612e 6765 7428 226e 756d 6265 7222 2c20  a.get("number", 
-00001750: 2222 290a 2020 2020 2020 2020 290a 2020  "").        ).  
-00001760: 2020 2020 2020 7265 7475 726e 2062 6962        return bib
-00001770: 5f66 6f72 6d61 7474 6564 0a0a 2020 2020  _formatted..    
-00001780: 6465 6620 5f5f 7361 7665 5f66 6965 6c64  def __save_field
-00001790: 5f64 6963 7428 7365 6c66 2c20 2a2c 2069  _dict(self, *, i
-000017a0: 6e70 7574 5f64 6963 743a 2064 6963 742c  nput_dict: dict,
-000017b0: 2069 6e70 7574 5f6b 6579 3a20 7374 7229   input_key: str)
-000017c0: 202d 3e20 6c69 7374 3a0a 2020 2020 2020   -> list:.      
-000017d0: 2020 6c69 7374 5f74 6f5f 7265 7475 726e    list_to_return
-000017e0: 203d 205b 5d0a 2020 2020 2020 2020 6173   = [].        as
-000017f0: 7365 7274 2069 6e70 7574 5f6b 6579 2069  sert input_key i
-00001800: 6e20 5b22 636f 6c72 6576 5f6d 6173 7465  n ["colrev_maste
-00001810: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
-00001820: 222c 2022 636f 6c72 6576 5f64 6174 615f  ", "colrev_data_
-00001830: 7072 6f76 656e 616e 6365 225d 0a20 2020  provenance"].   
-00001840: 2020 2020 2069 6620 696e 7075 745f 6b65       if input_ke
-00001850: 7920 3d3d 2022 636f 6c72 6576 5f6d 6173  y == "colrev_mas
-00001860: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00001870: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
-00001880: 2066 6f72 206b 6579 2c20 7661 6c75 6520   for key, value 
-00001890: 696e 2069 6e70 7574 5f64 6963 742e 6974  in input_dict.it
-000018a0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-000018b0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000018c0: 616e 6365 2876 616c 7565 2c20 6469 6374  ance(value, dict
-000018d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000018e0: 2020 2020 2020 2066 6f72 6d61 7465 645f         formated_
-000018f0: 6e6f 6465 203d 2022 2c22 2e6a 6f69 6e28  node = ",".join(
-00001900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001910: 2020 2020 2020 2020 2073 6f72 7465 6428           sorted(
-00001920: 6520 666f 7220 6520 696e 2076 616c 7565  e for e in value
-00001930: 5b22 6e6f 7465 225d 2e73 706c 6974 2822  ["note"].split("
-00001940: 2c22 2920 6966 2022 2220 213d 2065 290a  ,") if "" != e).
-00001950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001960: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00001970: 2020 2020 2020 2020 2020 6c69 7374 5f74            list_t
-00001980: 6f5f 7265 7475 726e 2e61 7070 656e 6428  o_return.append(
-00001990: 6622 7b6b 6579 7d3a 7b76 616c 7565 5b27  f"{key}:{value['
-000019a0: 736f 7572 6365 275d 7d3b 7b66 6f72 6d61  source']};{forma
-000019b0: 7465 645f 6e6f 6465 7d3b 2229 0a0a 2020  ted_node};")..  
-000019c0: 2020 2020 2020 656c 6966 2069 6e70 7574        elif input
-000019d0: 5f6b 6579 203d 3d20 2263 6f6c 7265 765f  _key == "colrev_
-000019e0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-000019f0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00001a00: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
-00001a10: 696e 7075 745f 6469 6374 2e69 7465 6d73  input_dict.items
-00001a20: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00001a30: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00001a40: 6528 7661 6c75 652c 2064 6963 7429 3a0a  e(value, dict):.
-00001a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001a60: 2020 2020 6c69 7374 5f74 6f5f 7265 7475      list_to_retu
-00001a70: 726e 2e61 7070 656e 6428 6622 7b6b 6579  rn.append(f"{key
-00001a80: 7d3a 7b76 616c 7565 5b27 736f 7572 6365  }:{value['source
-00001a90: 275d 7d3b 7b76 616c 7565 5b27 6e6f 7465  ']};{value['note
-00001aa0: 275d 7d3b 2229 0a0a 2020 2020 2020 2020  ']};")..        
-00001ab0: 7265 7475 726e 206c 6973 745f 746f 5f72  return list_to_r
-00001ac0: 6574 7572 6e0a 0a20 2020 2064 6566 2067  eturn..    def g
-00001ad0: 6574 5f64 6174 6128 7365 6c66 2c20 2a2c  et_data(self, *,
-00001ae0: 2073 7472 696e 6769 6679 3a20 626f 6f6c   stringify: bool
-00001af0: 203d 2046 616c 7365 2920 2d3e 2064 6963   = False) -> dic
-00001b00: 743a 0a20 2020 2020 2020 2022 2222 4765  t:.        """Ge
-00001b10: 7420 7468 6520 7265 636f 7264 2064 6174  t the record dat
-00001b20: 6120 286f 7074 696f 6e61 6c6c 793a 2069  a (optionally: i
-00001b30: 6e20 7374 7269 6e67 6966 6965 6420 7665  n stringified ve
-00001b40: 7273 696f 6e2c 2069 2e65 2e2c 2077 6974  rsion, i.e., wit
-00001b50: 686f 7574 206c 6973 7473 2f64 6963 7473  hout lists/dicts
-00001b60: 2922 2222 0a0a 2020 2020 2020 2020 6465  )"""..        de
-00001b70: 6620 5f5f 6765 745f 7374 7269 6e67 6966  f __get_stringif
-00001b80: 6965 645f 7265 636f 7264 2829 202d 3e20  ied_record() -> 
-00001b90: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-00001ba0: 2020 6461 7461 5f63 6f70 7920 3d20 6465    data_copy = de
-00001bb0: 6570 636f 7079 2873 656c 662e 6461 7461  epcopy(self.data
-00001bc0: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00001bd0: 6566 206c 6973 745f 746f 5f73 7472 282a  ef list_to_str(*
-00001be0: 2c20 7661 6c3a 206c 6973 7429 202d 3e20  , val: list) -> 
-00001bf0: 7374 723a 0a20 2020 2020 2020 2020 2020  str:.           
-00001c00: 2020 2020 2072 6574 7572 6e20 2822 5c6e       return ("\n
-00001c10: 2220 2b20 2220 2220 2a20 3336 292e 6a6f  " + " " * 36).jo
-00001c20: 696e 285b 662e 7273 7472 6970 2829 2066  in([f.rstrip() f
-00001c30: 6f72 2066 2069 6e20 7661 6c5d 290a 0a20  or f in val]).. 
-00001c40: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00001c50: 6579 2069 6e20 7365 6c66 2e6c 6973 745f  ey in self.list_
-00001c60: 6669 656c 6473 5f6b 6579 733a 0a20 2020  fields_keys:.   
-00001c70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001c80: 6b65 7920 696e 2064 6174 615f 636f 7079  key in data_copy
-00001c90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001ca0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
-00001cb0: 5b22 636f 6c72 6576 5f6f 7269 6769 6e22  ["colrev_origin"
-00001cc0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00001cd0: 2020 2020 2020 2020 2020 2064 6174 615f             data_
-00001ce0: 636f 7079 5b6b 6579 5d20 3d20 736f 7274  copy[key] = sort
-00001cf0: 6564 286c 6973 7428 7365 7428 6461 7461  ed(list(set(data
-00001d00: 5f63 6f70 795b 6b65 795d 2929 290a 2020  _copy[key]))).  
-00001d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d20: 2020 666f 7220 696e 642c 2076 616c 2069    for ind, val i
-00001d30: 6e20 656e 756d 6572 6174 6528 6461 7461  n enumerate(data
-00001d40: 5f63 6f70 795b 6b65 795d 293a 0a20 2020  _copy[key]):.   
-00001d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d60: 2020 2020 2069 6620 6c65 6e28 7661 6c29       if len(val)
-00001d70: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+000014c0: 2020 2020 6469 6666 2e61 7070 656e 6428      diff.append(
+000014d0: 7265 6d6f 7661 6c5f 6c69 7374 290a 2020  removal_list).  
+000014e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000014f0: 2020 2020 2020 2020 6469 6666 203d 206c          diff = l
+00001500: 6973 7428 6469 6374 6469 6666 6572 2e64  ist(dictdiffer.d
+00001510: 6966 6628 7365 6c66 2e67 6574 5f64 6174  iff(self.get_dat
+00001520: 6128 292c 206f 7468 6572 5f72 6563 6f72  a(), other_recor
+00001530: 642e 6765 745f 6461 7461 2829 2929 0a0a  d.get_data()))..
+00001540: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00001550: 6966 660a 0a20 2020 2064 6566 2066 6f72  iff..    def for
+00001560: 6d61 745f 6269 625f 7374 796c 6528 7365  mat_bib_style(se
+00001570: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
+00001580: 2020 2020 2222 2253 696d 706c 6520 666f      """Simple fo
+00001590: 726d 6174 7465 7220 666f 7220 6269 626c  rmatter for bibl
+000015a0: 696f 6772 6170 6879 2d73 7479 6c65 206f  iography-style o
+000015b0: 7574 7075 7422 2222 0a20 2020 2020 2020  utput""".       
+000015c0: 2062 6962 5f66 6f72 6d61 7474 6564 203d   bib_formatted =
+000015d0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
+000015e0: 656c 662e 6461 7461 2e67 6574 2822 6175  elf.data.get("au
+000015f0: 7468 6f72 222c 2022 2229 0a20 2020 2020  thor", "").     
+00001600: 2020 2020 2020 202b 2022 2028 220a 2020         + " (".  
+00001610: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
+00001620: 2e64 6174 612e 6765 7428 2279 6561 7222  .data.get("year"
+00001630: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
+00001640: 2020 2b20 2229 2022 0a20 2020 2020 2020    + ") ".       
+00001650: 2020 2020 202b 2073 656c 662e 6461 7461       + self.data
+00001660: 2e67 6574 2822 7469 746c 6522 2c20 2222  .get("title", ""
+00001670: 290a 2020 2020 2020 2020 2020 2020 2b20  ).            + 
+00001680: 222e 2022 0a20 2020 2020 2020 2020 2020  ". ".           
+00001690: 202b 2073 656c 662e 6461 7461 2e67 6574   + self.data.get
+000016a0: 2822 6a6f 7572 6e61 6c22 2c20 2222 290a  ("journal", "").
+000016b0: 2020 2020 2020 2020 2020 2020 2b20 7365              + se
+000016c0: 6c66 2e64 6174 612e 6765 7428 2262 6f6f  lf.data.get("boo
+000016d0: 6b74 6974 6c65 222c 2022 2229 0a20 2020  ktitle", "").   
+000016e0: 2020 2020 2020 2020 202b 2022 2c20 2822           + ", ("
+000016f0: 0a20 2020 2020 2020 2020 2020 202b 2073  .            + s
+00001700: 656c 662e 6461 7461 2e67 6574 2822 766f  elf.data.get("vo
+00001710: 6c75 6d65 222c 2022 2229 0a20 2020 2020  lume", "").     
+00001720: 2020 2020 2020 202b 2022 2920 220a 2020         + ") ".  
+00001730: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
+00001740: 2e64 6174 612e 6765 7428 226e 756d 6265  .data.get("numbe
+00001750: 7222 2c20 2222 290a 2020 2020 2020 2020  r", "").        
+00001760: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00001770: 2062 6962 5f66 6f72 6d61 7474 6564 0a0a   bib_formatted..
+00001780: 2020 2020 6465 6620 5f5f 7361 7665 5f66      def __save_f
+00001790: 6965 6c64 5f64 6963 7428 7365 6c66 2c20  ield_dict(self, 
+000017a0: 2a2c 2069 6e70 7574 5f64 6963 743a 2064  *, input_dict: d
+000017b0: 6963 742c 2069 6e70 7574 5f6b 6579 3a20  ict, input_key: 
+000017c0: 7374 7229 202d 3e20 6c69 7374 3a0a 2020  str) -> list:.  
+000017d0: 2020 2020 2020 6c69 7374 5f74 6f5f 7265        list_to_re
+000017e0: 7475 726e 203d 205b 5d0a 2020 2020 2020  turn = [].      
+000017f0: 2020 6173 7365 7274 2069 6e70 7574 5f6b    assert input_k
+00001800: 6579 2069 6e20 5b22 636f 6c72 6576 5f6d  ey in ["colrev_m
+00001810: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+00001820: 616e 6365 222c 2022 636f 6c72 6576 5f64  ance", "colrev_d
+00001830: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+00001840: 0a20 2020 2020 2020 2069 6620 696e 7075  .        if inpu
+00001850: 745f 6b65 7920 3d3d 2022 636f 6c72 6576  t_key == "colrev
+00001860: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00001870: 656e 616e 6365 223a 0a20 2020 2020 2020  enance":.       
+00001880: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
+00001890: 6c75 6520 696e 2069 6e70 7574 5f64 6963  lue in input_dic
+000018a0: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
+000018b0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+000018c0: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
+000018d0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+000018e0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+000018f0: 7465 645f 6e6f 6465 203d 2022 2c22 2e6a  ted_node = ",".j
+00001900: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
+00001910: 2020 2020 2020 2020 2020 2020 2073 6f72               sor
+00001920: 7465 6428 6520 666f 7220 6520 696e 2076  ted(e for e in v
+00001930: 616c 7565 5b22 6e6f 7465 225d 2e73 706c  alue["note"].spl
+00001940: 6974 2822 2c22 2920 6966 2022 2220 213d  it(",") if "" !=
+00001950: 2065 290a 2020 2020 2020 2020 2020 2020   e).            
+00001960: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00001970: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00001980: 7374 5f74 6f5f 7265 7475 726e 2e61 7070  st_to_return.app
+00001990: 656e 6428 6622 7b6b 6579 7d3a 7b76 616c  end(f"{key}:{val
+000019a0: 7565 5b27 736f 7572 6365 275d 7d3b 7b66  ue['source']};{f
+000019b0: 6f72 6d61 7465 645f 6e6f 6465 7d3b 2229  ormated_node};")
+000019c0: 0a0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+000019d0: 6e70 7574 5f6b 6579 203d 3d20 2263 6f6c  nput_key == "col
+000019e0: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+000019f0: 6e63 6522 3a0a 2020 2020 2020 2020 2020  nce":.          
+00001a00: 2020 666f 7220 6b65 792c 2076 616c 7565    for key, value
+00001a10: 2069 6e20 696e 7075 745f 6469 6374 2e69   in input_dict.i
+00001a20: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00001a30: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00001a40: 7461 6e63 6528 7661 6c75 652c 2064 6963  tance(value, dic
+00001a50: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00001a60: 2020 2020 2020 2020 6c69 7374 5f74 6f5f          list_to_
+00001a70: 7265 7475 726e 2e61 7070 656e 6428 6622  return.append(f"
+00001a80: 7b6b 6579 7d3a 7b76 616c 7565 5b27 736f  {key}:{value['so
+00001a90: 7572 6365 275d 7d3b 7b76 616c 7565 5b27  urce']};{value['
+00001aa0: 6e6f 7465 275d 7d3b 2229 0a0a 2020 2020  note']};")..    
+00001ab0: 2020 2020 7265 7475 726e 206c 6973 745f      return list_
+00001ac0: 746f 5f72 6574 7572 6e0a 0a20 2020 2064  to_return..    d
+00001ad0: 6566 2067 6574 5f64 6174 6128 7365 6c66  ef get_data(self
+00001ae0: 2c20 2a2c 2073 7472 696e 6769 6679 3a20  , *, stringify: 
+00001af0: 626f 6f6c 203d 2046 616c 7365 2920 2d3e  bool = False) ->
+00001b00: 2064 6963 743a 0a20 2020 2020 2020 2022   dict:.        "
+00001b10: 2222 4765 7420 7468 6520 7265 636f 7264  ""Get the record
+00001b20: 2064 6174 6120 286f 7074 696f 6e61 6c6c   data (optionall
+00001b30: 793a 2069 6e20 7374 7269 6e67 6966 6965  y: in stringifie
+00001b40: 6420 7665 7273 696f 6e2c 2069 2e65 2e2c  d version, i.e.,
+00001b50: 2077 6974 686f 7574 206c 6973 7473 2f64   without lists/d
+00001b60: 6963 7473 2922 2222 0a0a 2020 2020 2020  icts)"""..      
+00001b70: 2020 6465 6620 5f5f 6765 745f 7374 7269    def __get_stri
+00001b80: 6e67 6966 6965 645f 7265 636f 7264 2829  ngified_record()
+00001b90: 202d 3e20 6469 6374 3a0a 2020 2020 2020   -> dict:.      
+00001ba0: 2020 2020 2020 6461 7461 5f63 6f70 7920        data_copy 
+00001bb0: 3d20 6465 6570 636f 7079 2873 656c 662e  = deepcopy(self.
+00001bc0: 6461 7461 290a 0a20 2020 2020 2020 2020  data)..         
+00001bd0: 2020 2064 6566 206c 6973 745f 746f 5f73     def list_to_s
+00001be0: 7472 282a 2c20 7661 6c3a 206c 6973 7429  tr(*, val: list)
+00001bf0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+00001c00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00001c10: 2822 5c6e 2220 2b20 2220 2220 2a20 3336  ("\n" + " " * 36
+00001c20: 292e 6a6f 696e 285b 662e 7273 7472 6970  ).join([f.rstrip
+00001c30: 2829 2066 6f72 2066 2069 6e20 7661 6c5d  () for f in val]
+00001c40: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00001c50: 6f72 206b 6579 2069 6e20 7365 6c66 2e6c  or key in self.l
+00001c60: 6973 745f 6669 656c 6473 5f6b 6579 733a  ist_fields_keys:
+00001c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001c80: 2069 6620 6b65 7920 696e 2064 6174 615f   if key in data_
+00001c90: 636f 7079 3a0a 2020 2020 2020 2020 2020  copy:.          
+00001ca0: 2020 2020 2020 2020 2020 6966 206b 6579            if key
+00001cb0: 2069 6e20 5b22 636f 6c72 6576 5f6f 7269   in ["colrev_ori
+00001cc0: 6769 6e22 5d3a 0a20 2020 2020 2020 2020  gin"]:.         
+00001cd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00001ce0: 6174 615f 636f 7079 5b6b 6579 5d20 3d20  ata_copy[key] = 
+00001cf0: 736f 7274 6564 286c 6973 7428 7365 7428  sorted(list(set(
+00001d00: 6461 7461 5f63 6f70 795b 6b65 795d 2929  data_copy[key]))
+00001d10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001d20: 2020 2020 2020 666f 7220 696e 642c 2076        for ind, v
+00001d30: 616c 2069 6e20 656e 756d 6572 6174 6528  al in enumerate(
+00001d40: 6461 7461 5f63 6f70 795b 6b65 795d 293a  data_copy[key]):
+00001d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001d60: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00001d70: 7661 6c29 203e 2030 3a0a 2020 2020 2020  val) > 0:.      
 00001d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d90: 2020 6966 2076 616c 5b2d 315d 2021 3d20    if val[-1] != 
-00001da0: 223b 223a 0a20 2020 2020 2020 2020 2020  ";":.           
+00001d90: 2020 2020 2020 6966 2076 616c 5b2d 315d        if val[-1]
+00001da0: 2021 3d20 223b 223a 0a20 2020 2020 2020   != ";":.       
 00001db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001dc0: 2020 2020 2064 6174 615f 636f 7079 5b6b       data_copy[k
-00001dd0: 6579 5d5b 696e 645d 203d 2076 616c 202b  ey][ind] = val +
-00001de0: 2022 3b22 0a20 2020 2020 2020 2020 2020   ";".           
-00001df0: 2020 2020 2020 2020 2064 6174 615f 636f           data_co
-00001e00: 7079 5b6b 6579 5d20 3d20 6c69 7374 5f74  py[key] = list_t
-00001e10: 6f5f 7374 7228 7661 6c3d 6461 7461 5f63  o_str(val=data_c
-00001e20: 6f70 795b 6b65 795d 290a 0a20 2020 2020  opy[key])..     
-00001e30: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-00001e40: 6e20 7365 6c66 2e64 6963 745f 6669 656c  n self.dict_fiel
-00001e50: 6473 5f6b 6579 733a 0a20 2020 2020 2020  ds_keys:.       
-00001e60: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-00001e70: 696e 2064 6174 615f 636f 7079 3a0a 2020  in data_copy:.  
-00001e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001e90: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00001ea0: 6461 7461 5f63 6f70 795b 6b65 795d 2c20  data_copy[key], 
-00001eb0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-00001ec0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00001ed0: 6174 615f 636f 7079 5b6b 6579 5d20 3d20  ata_copy[key] = 
-00001ee0: 7365 6c66 2e5f 5f73 6176 655f 6669 656c  self.__save_fiel
-00001ef0: 645f 6469 6374 280a 2020 2020 2020 2020  d_dict(.        
+00001dc0: 2020 2020 2020 2020 2064 6174 615f 636f           data_co
+00001dd0: 7079 5b6b 6579 5d5b 696e 645d 203d 2076  py[key][ind] = v
+00001de0: 616c 202b 2022 3b22 0a20 2020 2020 2020  al + ";".       
+00001df0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00001e00: 615f 636f 7079 5b6b 6579 5d20 3d20 6c69  a_copy[key] = li
+00001e10: 7374 5f74 6f5f 7374 7228 7661 6c3d 6461  st_to_str(val=da
+00001e20: 7461 5f63 6f70 795b 6b65 795d 290a 0a20  ta_copy[key]).. 
+00001e30: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00001e40: 6579 2069 6e20 7365 6c66 2e64 6963 745f  ey in self.dict_
+00001e50: 6669 656c 6473 5f6b 6579 733a 0a20 2020  fields_keys:.   
+00001e60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001e70: 6b65 7920 696e 2064 6174 615f 636f 7079  key in data_copy
+00001e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001e90: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00001ea0: 6e63 6528 6461 7461 5f63 6f70 795b 6b65  nce(data_copy[ke
+00001eb0: 795d 2c20 6469 6374 293a 0a20 2020 2020  y], dict):.     
+00001ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ed0: 2020 2064 6174 615f 636f 7079 5b6b 6579     data_copy[key
+00001ee0: 5d20 3d20 7365 6c66 2e5f 5f73 6176 655f  ] = self.__save_
+00001ef0: 6669 656c 645f 6469 6374 280a 2020 2020  field_dict(.    
 00001f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f10: 2020 2020 696e 7075 745f 6469 6374 3d64      input_dict=d
-00001f20: 6174 615f 636f 7079 5b6b 6579 5d2c 2069  ata_copy[key], i
-00001f30: 6e70 7574 5f6b 6579 3d6b 6579 0a20 2020  nput_key=key.   
-00001f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00001f60: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00001f70: 696e 7374 616e 6365 2864 6174 615f 636f  instance(data_co
-00001f80: 7079 5b6b 6579 5d2c 206c 6973 7429 3a0a  py[key], list):.
-00001f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fa0: 2020 2020 2020 2020 6461 7461 5f63 6f70          data_cop
-00001fb0: 795b 6b65 795d 203d 206c 6973 745f 746f  y[key] = list_to
-00001fc0: 5f73 7472 2876 616c 3d64 6174 615f 636f  _str(val=data_co
-00001fd0: 7079 5b6b 6579 5d29 0a0a 2020 2020 2020  py[key])..      
-00001fe0: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
-00001ff0: 615f 636f 7079 0a0a 2020 2020 2020 2020  a_copy..        
-00002000: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00002010: 6528 7365 6c66 2e64 6174 612e 6765 7428  e(self.data.get(
-00002020: 2263 6f6c 7265 765f 6f72 6967 696e 222c  "colrev_origin",
-00002030: 205b 5d29 2c20 6c69 7374 293a 0a20 2020   []), list):.   
-00002040: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-00002050: 7461 5b22 636f 6c72 6576 5f6f 7269 6769  ta["colrev_origi
-00002060: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
-00002070: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00002080: 615b 2263 6f6c 7265 765f 6f72 6967 696e  a["colrev_origin
-00002090: 225d 2e72 7374 7269 7028 223b 2229 2e73  "].rstrip(";").s
-000020a0: 706c 6974 2822 3b22 290a 2020 2020 2020  plit(";").      
-000020b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000020c0: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-000020d0: 6528 7365 6c66 2e64 6174 612e 6765 7428  e(self.data.get(
-000020e0: 2263 6f6c 7265 765f 6f72 6967 696e 222c  "colrev_origin",
-000020f0: 205b 5d29 2c20 6c69 7374 290a 0a20 2020   []), list)..   
-00002100: 2020 2020 2069 6620 7374 7269 6e67 6966       if stringif
-00002110: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-00002120: 6574 7572 6e20 5f5f 6765 745f 7374 7269  eturn __get_stri
-00002130: 6e67 6966 6965 645f 7265 636f 7264 2829  ngified_record()
-00002140: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00002150: 2073 656c 662e 6461 7461 0a0a 2020 2020   self.data..    
-00002160: 6465 6620 6d61 7374 6572 6461 7461 5f69  def masterdata_i
-00002170: 735f 6375 7261 7465 6428 7365 6c66 2920  s_curated(self) 
-00002180: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-00002190: 2022 2222 4368 6563 6b20 7768 6574 6865   """Check whethe
-000021a0: 7220 7468 6520 7265 636f 7264 206d 6173  r the record mas
-000021b0: 7465 7264 6174 6120 6973 2063 7572 6174  terdata is curat
-000021c0: 6564 2222 220a 2020 2020 2020 2020 7265  ed""".        re
-000021d0: 7475 726e 2022 4355 5241 5445 4422 2069  turn "CURATED" i
-000021e0: 6e20 7365 6c66 2e64 6174 612e 6765 7428  n self.data.get(
-000021f0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-00002200: 7461 5f70 726f 7665 6e61 6e63 6522 2c20  ta_provenance", 
-00002210: 7b7d 290a 0a20 2020 2064 6566 2073 6574  {})..    def set
-00002220: 5f73 7461 7475 7328 7365 6c66 2c20 2a2c  _status(self, *,
-00002230: 2074 6172 6765 745f 7374 6174 653a 2052   target_state: R
-00002240: 6563 6f72 6453 7461 7465 2920 2d3e 204e  ecordState) -> N
-00002250: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00002260: 5365 7420 7468 6520 7265 636f 7264 2073  Set the record s
-00002270: 7461 7475 7322 2222 0a20 2020 2020 2020  tatus""".       
-00002280: 2069 6620 5265 636f 7264 5374 6174 652e   if RecordState.
-00002290: 6d64 5f70 7265 7061 7265 6420 3d3d 2074  md_prepared == t
-000022a0: 6172 6765 745f 7374 6174 653a 0a20 2020  arget_state:.   
-000022b0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000022c0: 2e68 6173 5f71 7561 6c69 7479 5f64 6566  .has_quality_def
-000022d0: 6563 7473 2829 3a0a 2020 2020 2020 2020  ects():.        
-000022e0: 2020 2020 2020 2020 7461 7267 6574 5f73          target_s
-000022f0: 7461 7465 203d 2052 6563 6f72 6453 7461  tate = RecordSta
-00002300: 7465 2e6d 645f 6e65 6564 735f 6d61 6e75  te.md_needs_manu
-00002310: 616c 5f70 7265 7061 7261 7469 6f6e 0a20  al_preparation. 
-00002320: 2020 2020 2020 2023 2070 796c 696e 743a         # pylint:
-00002330: 2064 6973 6162 6c65 3d64 6972 6563 742d   disable=direct-
-00002340: 7374 6174 7573 2d61 7373 6967 6e0a 2020  status-assign.  
-00002350: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-00002360: 2263 6f6c 7265 765f 7374 6174 7573 225d  "colrev_status"]
-00002370: 203d 2074 6172 6765 745f 7374 6174 650a   = target_state.
-00002380: 0a20 2020 2064 6566 2073 6861 7265 735f  .    def shares_
-00002390: 6f72 6967 696e 7328 7365 6c66 2c20 2a2c  origins(self, *,
-000023a0: 206f 7468 6572 5f72 6563 6f72 643a 2052   other_record: R
-000023b0: 6563 6f72 6429 202d 3e20 626f 6f6c 3a0a  ecord) -> bool:.
-000023c0: 2020 2020 2020 2020 2222 2243 6865 636b          """Check
-000023d0: 2061 7420 6c65 6173 7420 6f6e 6520 6f72   at least one or
-000023e0: 6967 696e 2069 7320 7368 6172 6564 2077  igin is shared w
-000023f0: 6974 6820 7468 6520 6f74 6865 7220 7265  ith the other re
-00002400: 636f 7264 2222 220a 2020 2020 2020 2020  cord""".        
-00002410: 7265 7475 726e 2061 6e79 280a 2020 2020  return any(.    
-00002420: 2020 2020 2020 2020 7820 696e 206f 7468          x in oth
-00002430: 6572 5f72 6563 6f72 642e 6461 7461 2e67  er_record.data.g
-00002440: 6574 2822 636f 6c72 6576 5f6f 7269 6769  et("colrev_origi
-00002450: 6e22 2c20 5b5d 290a 2020 2020 2020 2020  n", []).        
-00002460: 2020 2020 666f 7220 7820 696e 2073 656c      for x in sel
-00002470: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
-00002480: 6576 5f6f 7269 6769 6e22 2c20 5b5d 290a  ev_origin", []).
-00002490: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-000024a0: 6566 2067 6574 5f76 616c 7565 2873 656c  ef get_value(sel
-000024b0: 662c 202a 2c20 6b65 793a 2073 7472 2c20  f, *, key: str, 
-000024c0: 6465 6661 756c 743a 204f 7074 696f 6e61  default: Optiona
-000024d0: 6c5b 7374 725d 203d 204e 6f6e 6529 202d  l[str] = None) -
-000024e0: 3e20 7374 723a 0a20 2020 2020 2020 2022  > str:.        "
-000024f0: 2222 4765 7420 6120 7265 636f 7264 2076  ""Get a record v
-00002500: 616c 7565 2028 6261 7365 6420 6f6e 2074  alue (based on t
-00002510: 6865 206b 6579 2070 6172 616d 6574 6572  he key parameter
-00002520: 2922 2222 0a20 2020 2020 2020 2069 6620  )""".        if 
-00002530: 6465 6661 756c 7420 6973 206e 6f74 204e  default is not N
-00002540: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00002550: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00002560: 2020 2020 2020 7265 7420 3d20 7365 6c66        ret = self
-00002570: 2e64 6174 615b 6b65 795d 0a20 2020 2020  .data[key].     
-00002580: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00002590: 6e20 7265 740a 2020 2020 2020 2020 2020  n ret.          
-000025a0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-000025b0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-000025c0: 2020 2072 6574 7572 6e20 6465 6661 756c     return defaul
-000025d0: 740a 2020 2020 2020 2020 656c 7365 3a0a  t.        else:.
-000025e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000025f0: 726e 2073 656c 662e 6461 7461 5b6b 6579  rn self.data[key
-00002600: 5d0a 0a20 2020 2064 6566 2067 6574 5f63  ]..    def get_c
-00002610: 6f6c 7265 765f 6964 2873 656c 6629 202d  olrev_id(self) -
-00002620: 3e20 6c69 7374 3a0a 2020 2020 2020 2020  > list:.        
-00002630: 2222 2247 6574 2074 6865 2063 6f6c 7265  """Get the colre
-00002640: 765f 6964 206f 6620 6120 7265 636f 7264  v_id of a record
-00002650: 2222 220a 2020 2020 2020 2020 2320 4e6f  """.        # No
-00002660: 7465 203a 2064 6f20 6e6f 7420 6175 746f  te : do not auto
-00002670: 6d61 7469 6361 6c6c 7920 6372 6561 7465  matically create
-00002680: 2063 6f6c 7265 765f 6964 730a 2020 2020   colrev_ids.    
-00002690: 2020 2020 2320 6f72 2061 7420 6c65 6173      # or at leas
-000026a0: 7420 6b65 6570 2069 6e20 6d69 6e64 2074  t keep in mind t
-000026b0: 6861 7420 7468 6973 2077 696c 6c20 6e6f  hat this will no
-000026c0: 7420 6265 2070 6f73 7369 626c 6520 666f  t be possible fo
-000026d0: 7220 736f 6d65 2072 6563 6f72 6473 0a20  r some records. 
-000026e0: 2020 2020 2020 2063 6f6c 7265 765f 6964         colrev_id
-000026f0: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
-00002700: 2022 636f 6c72 6576 5f69 6422 2069 6e20   "colrev_id" in 
-00002710: 7365 6c66 2e64 6174 613a 0a20 2020 2020  self.data:.     
-00002720: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00002730: 616e 6365 2873 656c 662e 6461 7461 5b22  ance(self.data["
-00002740: 636f 6c72 6576 5f69 6422 5d2c 2073 7472  colrev_id"], str
-00002750: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00002760: 2020 2063 6f6c 7265 765f 6964 203d 205b     colrev_id = [
-00002770: 6369 642e 6c73 7472 6970 2829 2066 6f72  cid.lstrip() for
-00002780: 2063 6964 2069 6e20 7365 6c66 2e64 6174   cid in self.dat
-00002790: 615b 2263 6f6c 7265 765f 6964 225d 2e73  a["colrev_id"].s
-000027a0: 706c 6974 2822 3b22 295d 0a20 2020 2020  plit(";")].     
-000027b0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-000027c0: 7374 616e 6365 2873 656c 662e 6461 7461  stance(self.data
-000027d0: 5b22 636f 6c72 6576 5f69 6422 5d2c 206c  ["colrev_id"], l
-000027e0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-000027f0: 2020 2020 2020 636f 6c72 6576 5f69 6420        colrev_id 
-00002800: 3d20 7365 6c66 2e64 6174 615b 2263 6f6c  = self.data["col
-00002810: 7265 765f 6964 225d 0a20 2020 2020 2020  rev_id"].       
-00002820: 2072 6574 7572 6e20 5b63 2066 6f72 2063   return [c for c
-00002830: 2069 6e20 636f 6c72 6576 5f69 6420 6966   in colrev_id if
-00002840: 206c 656e 2863 2920 3e20 3230 5d0a 0a20   len(c) > 20].. 
-00002850: 2020 2064 6566 2068 6173 5f6f 7665 726c     def has_overl
-00002860: 6170 7069 6e67 5f63 6f6c 7265 765f 6964  apping_colrev_id
-00002870: 2873 656c 662c 202a 2c20 7265 636f 7264  (self, *, record
-00002880: 3a20 5265 636f 7264 2920 2d3e 2062 6f6f  : Record) -> boo
-00002890: 6c3a 0a20 2020 2020 2020 2022 2222 4368  l:.        """Ch
-000028a0: 6563 6b20 6966 2061 2072 6563 6f72 6420  eck if a record 
-000028b0: 6861 7320 616e 206f 7665 726c 6170 7069  has an overlappi
-000028c0: 6e67 2063 6f6c 7265 765f 6964 2077 6974  ng colrev_id wit
-000028d0: 6820 7468 6520 6f74 6865 7220 7265 636f  h the other reco
-000028e0: 7264 2222 220a 2020 2020 2020 2020 6f77  rd""".        ow
-000028f0: 6e5f 636f 6c72 6576 5f69 6473 203d 2073  n_colrev_ids = s
-00002900: 656c 662e 6765 745f 636f 6c72 6576 5f69  elf.get_colrev_i
-00002910: 6428 290a 2020 2020 2020 2020 6f74 6865  d().        othe
-00002920: 725f 636f 6c72 6576 5f69 6473 203d 2072  r_colrev_ids = r
-00002930: 6563 6f72 642e 6765 745f 636f 6c72 6576  ecord.get_colrev
-00002940: 5f69 6428 290a 2020 2020 2020 2020 6966  _id().        if
-00002950: 206c 656e 286f 776e 5f63 6f6c 7265 765f   len(own_colrev_
-00002960: 6964 7329 203e 2030 2061 6e64 206c 656e  ids) > 0 and len
-00002970: 286f 7468 6572 5f63 6f6c 7265 765f 6964  (other_colrev_id
-00002980: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
-00002990: 2020 2020 6966 2061 6e79 2863 6964 2069      if any(cid i
-000029a0: 6e20 6f77 6e5f 636f 6c72 6576 5f69 6473  n own_colrev_ids
-000029b0: 2066 6f72 2063 6964 2069 6e20 6f74 6865   for cid in othe
-000029c0: 725f 636f 6c72 6576 5f69 6473 293a 0a20  r_colrev_ids):. 
-000029d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000029e0: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-000029f0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00002a00: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-00002a10: 6669 656c 6428 0a20 2020 2020 2020 2073  field(.        s
-00002a20: 656c 662c 0a20 2020 2020 2020 202a 2c0a  elf,.        *,.
-00002a30: 2020 2020 2020 2020 6b65 793a 2073 7472          key: str
-00002a40: 2c0a 2020 2020 2020 2020 7661 6c75 653a  ,.        value:
-00002a50: 2073 7472 2c0a 2020 2020 2020 2020 736f   str,.        so
-00002a60: 7572 6365 3a20 7374 722c 0a20 2020 2020  urce: str,.     
-00002a70: 2020 206e 6f74 653a 2073 7472 203d 2022     note: str = "
-00002a80: 222c 0a20 2020 2020 2020 206b 6565 705f  ",.        keep_
-00002a90: 736f 7572 6365 5f69 665f 6571 7561 6c3a  source_if_equal:
-00002aa0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00002ab0: 2020 2020 2020 2061 7070 656e 645f 6564         append_ed
-00002ac0: 6974 3a20 626f 6f6c 203d 2054 7275 652c  it: bool = True,
-00002ad0: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
-00002ae0: 2020 2020 2020 2020 2222 2255 7064 6174          """Updat
-00002af0: 6520 6120 7265 636f 7264 2066 6965 6c64  e a record field
-00002b00: 2028 696e 636c 7564 696e 6720 7072 6f76   (including prov
-00002b10: 656e 616e 6365 2069 6e66 6f72 6d61 7469  enance informati
-00002b20: 6f6e 2922 2222 0a20 2020 2020 2020 2069  on)""".        i
-00002b30: 6620 6b65 6570 5f73 6f75 7263 655f 6966  f keep_source_if
-00002b40: 5f65 7175 616c 3a0a 2020 2020 2020 2020  _equal:.        
-00002b50: 2020 2020 6966 206b 6579 2069 6e20 7365      if key in se
-00002b60: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
-00002b70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00002b80: 2e64 6174 615b 6b65 795d 203d 3d20 7661  .data[key] == va
-00002b90: 6c75 653a 0a20 2020 2020 2020 2020 2020  lue:.           
-00002ba0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00002bb0: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
-00002bc0: 696e 2073 656c 662e 6964 656e 7469 6679  in self.identify
-00002bd0: 696e 675f 6669 656c 645f 6b65 7973 3a0a  ing_field_keys:.
-00002be0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00002bf0: 6f74 2073 656c 662e 6d61 7374 6572 6461  ot self.masterda
-00002c00: 7461 5f69 735f 6375 7261 7465 6428 293a  ta_is_curated():
-00002c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002c20: 2069 6620 6170 7065 6e64 5f65 6469 7420   if append_edit 
-00002c30: 616e 6420 6b65 7920 696e 2073 656c 662e  and key in self.
-00002c40: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-00002c50: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00002c60: 2069 6e20 7365 6c66 2e64 6174 612e 6765   in self.data.ge
-00002c70: 7428 2263 6f6c 7265 765f 6d61 7374 6572  t("colrev_master
-00002c80: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-00002c90: 2c20 7b7d 293a 0a20 2020 2020 2020 2020  , {}):.         
-00002ca0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002cb0: 6f75 7263 6520 3d20 280a 2020 2020 2020  ource = (.      
+00001f10: 2020 2020 2020 2020 696e 7075 745f 6469          input_di
+00001f20: 6374 3d64 6174 615f 636f 7079 5b6b 6579  ct=data_copy[key
+00001f30: 5d2c 2069 6e70 7574 5f6b 6579 3d6b 6579  ], input_key=key
+00001f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001f50: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00001f60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001f70: 6620 6973 696e 7374 616e 6365 2864 6174  f isinstance(dat
+00001f80: 615f 636f 7079 5b6b 6579 5d2c 206c 6973  a_copy[key], lis
+00001f90: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00001fa0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00001fb0: 5f63 6f70 795b 6b65 795d 203d 206c 6973  _copy[key] = lis
+00001fc0: 745f 746f 5f73 7472 2876 616c 3d64 6174  t_to_str(val=dat
+00001fd0: 615f 636f 7079 5b6b 6579 5d29 0a0a 2020  a_copy[key])..  
+00001fe0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00001ff0: 2064 6174 615f 636f 7079 0a0a 2020 2020   data_copy..    
+00002000: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00002010: 7461 6e63 6528 7365 6c66 2e64 6174 612e  tance(self.data.
+00002020: 6765 7428 2263 6f6c 7265 765f 6f72 6967  get("colrev_orig
+00002030: 696e 222c 205b 5d29 2c20 6c69 7374 293a  in", []), list):
+00002040: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00002050: 662e 6461 7461 5b22 636f 6c72 6576 5f6f  f.data["colrev_o
+00002060: 7269 6769 6e22 5d20 3d20 280a 2020 2020  rigin"] = (.    
+00002070: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002080: 2e64 6174 615b 2263 6f6c 7265 765f 6f72  .data["colrev_or
+00002090: 6967 696e 225d 2e72 7374 7269 7028 223b  igin"].rstrip(";
+000020a0: 2229 2e73 706c 6974 2822 3b22 290a 2020  ").split(";").  
+000020b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000020c0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+000020d0: 7461 6e63 6528 7365 6c66 2e64 6174 612e  tance(self.data.
+000020e0: 6765 7428 2263 6f6c 7265 765f 6f72 6967  get("colrev_orig
+000020f0: 696e 222c 205b 5d29 2c20 6c69 7374 290a  in", []), list).
+00002100: 0a20 2020 2020 2020 2069 6620 7374 7269  .        if stri
+00002110: 6e67 6966 793a 0a20 2020 2020 2020 2020  ngify:.         
+00002120: 2020 2072 6574 7572 6e20 5f5f 6765 745f     return __get_
+00002130: 7374 7269 6e67 6966 6965 645f 7265 636f  stringified_reco
+00002140: 7264 2829 0a0a 2020 2020 2020 2020 7265  rd()..        re
+00002150: 7475 726e 2073 656c 662e 6461 7461 0a0a  turn self.data..
+00002160: 2020 2020 6465 6620 6d61 7374 6572 6461      def masterda
+00002170: 7461 5f69 735f 6375 7261 7465 6428 7365  ta_is_curated(se
+00002180: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
+00002190: 2020 2020 2022 2222 4368 6563 6b20 7768       """Check wh
+000021a0: 6574 6865 7220 7468 6520 7265 636f 7264  ether the record
+000021b0: 206d 6173 7465 7264 6174 6120 6973 2063   masterdata is c
+000021c0: 7572 6174 6564 2222 220a 2020 2020 2020  urated""".      
+000021d0: 2020 7265 7475 726e 2022 4355 5241 5445    return "CURATE
+000021e0: 4422 2069 6e20 7365 6c66 2e64 6174 612e  D" in self.data.
+000021f0: 6765 7428 2263 6f6c 7265 765f 6d61 7374  get("colrev_mast
+00002200: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00002210: 6522 2c20 7b7d 290a 0a20 2020 2064 6566  e", {})..    def
+00002220: 2073 6574 5f73 7461 7475 7328 7365 6c66   set_status(self
+00002230: 2c20 2a2c 2074 6172 6765 745f 7374 6174  , *, target_stat
+00002240: 653a 2052 6563 6f72 6453 7461 7465 2c20  e: RecordState, 
+00002250: 666f 7263 653a 2062 6f6f 6c20 3d20 4661  force: bool = Fa
+00002260: 6c73 6529 202d 3e20 4e6f 6e65 3a0a 2020  lse) -> None:.  
+00002270: 2020 2020 2020 2222 2253 6574 2074 6865        """Set the
+00002280: 2072 6563 6f72 6420 7374 6174 7573 2222   record status""
+00002290: 220a 2020 2020 2020 2020 6966 2052 6563  ".        if Rec
+000022a0: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
+000022b0: 6172 6564 203d 3d20 7461 7267 6574 5f73  ared == target_s
+000022c0: 7461 7465 2061 6e64 206e 6f74 2066 6f72  tate and not for
+000022d0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000022e0: 6966 2073 656c 662e 6861 735f 7175 616c  if self.has_qual
+000022f0: 6974 795f 6465 6665 6374 7328 293a 0a20  ity_defects():. 
+00002300: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00002310: 6172 6765 745f 7374 6174 6520 3d20 5265  arget_state = Re
+00002320: 636f 7264 5374 6174 652e 6d64 5f6e 6565  cordState.md_nee
+00002330: 6473 5f6d 616e 7561 6c5f 7072 6570 6172  ds_manual_prepar
+00002340: 6174 696f 6e0a 2020 2020 2020 2020 2320  ation.        # 
+00002350: 7079 6c69 6e74 3a20 6469 7361 626c 653d  pylint: disable=
+00002360: 6469 7265 6374 2d73 7461 7475 732d 6173  direct-status-as
+00002370: 7369 676e 0a20 2020 2020 2020 2073 656c  sign.        sel
+00002380: 662e 6461 7461 5b22 636f 6c72 6576 5f73  f.data["colrev_s
+00002390: 7461 7475 7322 5d20 3d20 7461 7267 6574  tatus"] = target
+000023a0: 5f73 7461 7465 0a0a 2020 2020 6465 6620  _state..    def 
+000023b0: 7368 6172 6573 5f6f 7269 6769 6e73 2873  shares_origins(s
+000023c0: 656c 662c 202a 2c20 6f74 6865 725f 7265  elf, *, other_re
+000023d0: 636f 7264 3a20 5265 636f 7264 2920 2d3e  cord: Record) ->
+000023e0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+000023f0: 2222 4368 6563 6b20 6174 206c 6561 7374  ""Check at least
+00002400: 206f 6e65 206f 7269 6769 6e20 6973 2073   one origin is s
+00002410: 6861 7265 6420 7769 7468 2074 6865 206f  hared with the o
+00002420: 7468 6572 2072 6563 6f72 6422 2222 0a20  ther record""". 
+00002430: 2020 2020 2020 2072 6574 7572 6e20 616e         return an
+00002440: 7928 0a20 2020 2020 2020 2020 2020 2078  y(.            x
+00002450: 2069 6e20 6f74 6865 725f 7265 636f 7264   in other_record
+00002460: 2e64 6174 612e 6765 7428 2263 6f6c 7265  .data.get("colre
+00002470: 765f 6f72 6967 696e 222c 205b 5d29 0a20  v_origin", []). 
+00002480: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
+00002490: 2069 6e20 7365 6c66 2e64 6174 612e 6765   in self.data.ge
+000024a0: 7428 2263 6f6c 7265 765f 6f72 6967 696e  t("colrev_origin
+000024b0: 222c 205b 5d29 0a20 2020 2020 2020 2029  ", []).        )
+000024c0: 0a0a 2020 2020 6465 6620 6765 745f 7661  ..    def get_va
+000024d0: 6c75 6528 7365 6c66 2c20 2a2c 206b 6579  lue(self, *, key
+000024e0: 3a20 7374 722c 2064 6566 6175 6c74 3a20  : str, default: 
+000024f0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00002500: 4e6f 6e65 2920 2d3e 2073 7472 3a0a 2020  None) -> str:.  
+00002510: 2020 2020 2020 2222 2247 6574 2061 2072        """Get a r
+00002520: 6563 6f72 6420 7661 6c75 6520 2862 6173  ecord value (bas
+00002530: 6564 206f 6e20 7468 6520 6b65 7920 7061  ed on the key pa
+00002540: 7261 6d65 7465 7229 2222 220a 2020 2020  rameter)""".    
+00002550: 2020 2020 6966 2064 6566 6175 6c74 2069      if default i
+00002560: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00002570: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00002580: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00002590: 203d 2073 656c 662e 6461 7461 5b6b 6579   = self.data[key
+000025a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000025b0: 2020 7265 7475 726e 2072 6574 0a20 2020    return ret.   
+000025c0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000025d0: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
+000025e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000025f0: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
+00002600: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00002610: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+00002620: 6174 615b 6b65 795d 0a0a 2020 2020 6465  ata[key]..    de
+00002630: 6620 6765 745f 636f 6c72 6576 5f69 6428  f get_colrev_id(
+00002640: 7365 6c66 2920 2d3e 206c 6973 743a 0a20  self) -> list:. 
+00002650: 2020 2020 2020 2022 2222 4765 7420 7468         """Get th
+00002660: 6520 636f 6c72 6576 5f69 6420 6f66 2061  e colrev_id of a
+00002670: 2072 6563 6f72 6422 2222 0a20 2020 2020   record""".     
+00002680: 2020 2023 204e 6f74 6520 3a20 646f 206e     # Note : do n
+00002690: 6f74 2061 7574 6f6d 6174 6963 616c 6c79  ot automatically
+000026a0: 2063 7265 6174 6520 636f 6c72 6576 5f69   create colrev_i
+000026b0: 6473 0a20 2020 2020 2020 2023 206f 7220  ds.        # or 
+000026c0: 6174 206c 6561 7374 206b 6565 7020 696e  at least keep in
+000026d0: 206d 696e 6420 7468 6174 2074 6869 7320   mind that this 
+000026e0: 7769 6c6c 206e 6f74 2062 6520 706f 7373  will not be poss
+000026f0: 6962 6c65 2066 6f72 2073 6f6d 6520 7265  ible for some re
+00002700: 636f 7264 730a 2020 2020 2020 2020 636f  cords.        co
+00002710: 6c72 6576 5f69 6420 3d20 5b5d 0a20 2020  lrev_id = [].   
+00002720: 2020 2020 2069 6620 2263 6f6c 7265 765f       if "colrev_
+00002730: 6964 2220 696e 2073 656c 662e 6461 7461  id" in self.data
+00002740: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00002750: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00002760: 2e64 6174 615b 2263 6f6c 7265 765f 6964  .data["colrev_id
+00002770: 225d 2c20 7374 7229 3a0a 2020 2020 2020  "], str):.      
+00002780: 2020 2020 2020 2020 2020 636f 6c72 6576            colrev
+00002790: 5f69 6420 3d20 5b63 6964 2e6c 7374 7269  _id = [cid.lstri
+000027a0: 7028 2920 666f 7220 6369 6420 696e 2073  p() for cid in s
+000027b0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+000027c0: 5f69 6422 5d2e 7370 6c69 7428 223b 2229  _id"].split(";")
+000027d0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+000027e0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+000027f0: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00002800: 6964 225d 2c20 6c69 7374 293a 0a20 2020  id"], list):.   
+00002810: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00002820: 7265 765f 6964 203d 2073 656c 662e 6461  rev_id = self.da
+00002830: 7461 5b22 636f 6c72 6576 5f69 6422 5d0a  ta["colrev_id"].
+00002840: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00002850: 6320 666f 7220 6320 696e 2063 6f6c 7265  c for c in colre
+00002860: 765f 6964 2069 6620 6c65 6e28 6329 203e  v_id if len(c) >
+00002870: 2032 305d 0a0a 2020 2020 6465 6620 6861   20]..    def ha
+00002880: 735f 6f76 6572 6c61 7070 696e 675f 636f  s_overlapping_co
+00002890: 6c72 6576 5f69 6428 7365 6c66 2c20 2a2c  lrev_id(self, *,
+000028a0: 2072 6563 6f72 643a 2052 6563 6f72 6429   record: Record)
+000028b0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+000028c0: 2020 2222 2243 6865 636b 2069 6620 6120    """Check if a 
+000028d0: 7265 636f 7264 2068 6173 2061 6e20 6f76  record has an ov
+000028e0: 6572 6c61 7070 696e 6720 636f 6c72 6576  erlapping colrev
+000028f0: 5f69 6420 7769 7468 2074 6865 206f 7468  _id with the oth
+00002900: 6572 2072 6563 6f72 6422 2222 0a20 2020  er record""".   
+00002910: 2020 2020 206f 776e 5f63 6f6c 7265 765f       own_colrev_
+00002920: 6964 7320 3d20 7365 6c66 2e67 6574 5f63  ids = self.get_c
+00002930: 6f6c 7265 765f 6964 2829 0a20 2020 2020  olrev_id().     
+00002940: 2020 206f 7468 6572 5f63 6f6c 7265 765f     other_colrev_
+00002950: 6964 7320 3d20 7265 636f 7264 2e67 6574  ids = record.get
+00002960: 5f63 6f6c 7265 765f 6964 2829 0a20 2020  _colrev_id().   
+00002970: 2020 2020 2069 6620 6c65 6e28 6f77 6e5f       if len(own_
+00002980: 636f 6c72 6576 5f69 6473 2920 3e20 3020  colrev_ids) > 0 
+00002990: 616e 6420 6c65 6e28 6f74 6865 725f 636f  and len(other_co
+000029a0: 6c72 6576 5f69 6473 2920 3e20 303a 0a20  lrev_ids) > 0:. 
+000029b0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
+000029c0: 7928 6369 6420 696e 206f 776e 5f63 6f6c  y(cid in own_col
+000029d0: 7265 765f 6964 7320 666f 7220 6369 6420  rev_ids for cid 
+000029e0: 696e 206f 7468 6572 5f63 6f6c 7265 765f  in other_colrev_
+000029f0: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
+00002a00: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00002a10: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00002a20: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
+00002a30: 7570 6461 7465 5f66 6965 6c64 280a 2020  update_field(.  
+00002a40: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00002a50: 2020 2020 2a2c 0a20 2020 2020 2020 206b      *,.        k
+00002a60: 6579 3a20 7374 722c 0a20 2020 2020 2020  ey: str,.       
+00002a70: 2076 616c 7565 3a20 7374 722c 0a20 2020   value: str,.   
+00002a80: 2020 2020 2073 6f75 7263 653a 2073 7472       source: str
+00002a90: 2c0a 2020 2020 2020 2020 6e6f 7465 3a20  ,.        note: 
+00002aa0: 7374 7220 3d20 2222 2c0a 2020 2020 2020  str = "",.      
+00002ab0: 2020 6b65 6570 5f73 6f75 7263 655f 6966    keep_source_if
+00002ac0: 5f65 7175 616c 3a20 626f 6f6c 203d 2054  _equal: bool = T
+00002ad0: 7275 652c 0a20 2020 2020 2020 2061 7070  rue,.        app
+00002ae0: 656e 645f 6564 6974 3a20 626f 6f6c 203d  end_edit: bool =
+00002af0: 2054 7275 652c 0a20 2020 2029 202d 3e20   True,.    ) -> 
+00002b00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00002b10: 2255 7064 6174 6520 6120 7265 636f 7264  "Update a record
+00002b20: 2066 6965 6c64 2028 696e 636c 7564 696e   field (includin
+00002b30: 6720 7072 6f76 656e 616e 6365 2069 6e66  g provenance inf
+00002b40: 6f72 6d61 7469 6f6e 2922 2222 0a20 2020  ormation)""".   
+00002b50: 2020 2020 2069 6620 6b65 6570 5f73 6f75       if keep_sou
+00002b60: 7263 655f 6966 5f65 7175 616c 3a0a 2020  rce_if_equal:.  
+00002b70: 2020 2020 2020 2020 2020 6966 206b 6579            if key
+00002b80: 2069 6e20 7365 6c66 2e64 6174 613a 0a20   in self.data:. 
+00002b90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00002ba0: 6620 7365 6c66 2e64 6174 615b 6b65 795d  f self.data[key]
+00002bb0: 203d 3d20 7661 6c75 653a 0a20 2020 2020   == value:.     
+00002bc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002bd0: 6574 7572 6e0a 0a20 2020 2020 2020 2069  eturn..        i
+00002be0: 6620 6b65 7920 696e 2073 656c 662e 6964  f key in self.id
+00002bf0: 656e 7469 6679 696e 675f 6669 656c 645f  entifying_field_
+00002c00: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
+00002c10: 2020 6966 206e 6f74 2073 656c 662e 6d61    if not self.ma
+00002c20: 7374 6572 6461 7461 5f69 735f 6375 7261  sterdata_is_cura
+00002c30: 7465 6428 293a 0a20 2020 2020 2020 2020  ted():.         
+00002c40: 2020 2020 2020 2069 6620 6170 7065 6e64         if append
+00002c50: 5f65 6469 7420 616e 6420 6b65 7920 696e  _edit and key in
+00002c60: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
+00002c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c80: 6966 206b 6579 2069 6e20 7365 6c66 2e64  if key in self.d
+00002c90: 6174 612e 6765 7428 2263 6f6c 7265 765f  ata.get("colrev_
+00002ca0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00002cb0: 6e61 6e63 6522 2c20 7b7d 293a 0a20 2020  nance", {}):.   
 00002cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cd0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-00002ce0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-00002cf0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-00002d00: 6b65 795d 5b22 736f 7572 6365 225d 0a20  key]["source"]. 
-00002d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d20: 2020 2020 2020 2020 2020 202b 2022 7c22             + "|"
-00002d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002d40: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-00002d50: 6f75 7263 650a 2020 2020 2020 2020 2020  ource.          
-00002d60: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00002d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00002d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002da0: 2020 736f 7572 6365 203d 2022 6f72 6967    source = "orig
-00002db0: 696e 616c 7c22 202b 2073 6f75 7263 650a  inal|" + source.
-00002dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002dd0: 7365 6c66 2e61 6464 5f6d 6173 7465 7264  self.add_masterd
-00002de0: 6174 615f 7072 6f76 656e 616e 6365 286b  ata_provenance(k
-00002df0: 6579 3d6b 6579 2c20 736f 7572 6365 3d73  ey=key, source=s
-00002e00: 6f75 7263 652c 206e 6f74 653d 6e6f 7465  ource, note=note
-00002e10: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00002e20: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00002e30: 7070 656e 645f 6564 6974 2061 6e64 206b  ppend_edit and k
-00002e40: 6579 2069 6e20 7365 6c66 2e64 6174 613a  ey in self.data:
-00002e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002e60: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
-00002e70: 6461 7461 2e67 6574 2822 636f 6c72 6576  data.get("colrev
-00002e80: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-00002e90: 222c 207b 7d29 3a0a 2020 2020 2020 2020  ", {}):.        
-00002ea0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-00002eb0: 6365 203d 2028 0a20 2020 2020 2020 2020  ce = (.         
-00002ec0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002ed0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-00002ee0: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-00002ef0: 225d 5b6b 6579 5d5b 2273 6f75 7263 6522  "][key]["source"
-00002f00: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00002f10: 2020 2020 2020 2020 2020 2b20 227c 220a            + "|".
-00002f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f30: 2020 2020 2020 2020 2b20 736f 7572 6365          + source
-00002f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002f50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00002f60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00002f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f80: 2073 6f75 7263 6520 3d20 226f 7269 6769   source = "origi
-00002f90: 6e61 6c7c 2220 2b20 736f 7572 6365 0a20  nal|" + source. 
-00002fa0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00002fb0: 6164 645f 6461 7461 5f70 726f 7665 6e61  add_data_provena
-00002fc0: 6e63 6528 6b65 793d 6b65 792c 2073 6f75  nce(key=key, sou
-00002fd0: 7263 653d 736f 7572 6365 2c20 6e6f 7465  rce=source, note
-00002fe0: 3d6e 6f74 6529 0a20 2020 2020 2020 2073  =note).        s
-00002ff0: 656c 662e 6461 7461 5b6b 6579 5d20 3d20  elf.data[key] = 
-00003000: 7661 6c75 650a 0a20 2020 2064 6566 2072  value..    def r
-00003010: 656e 616d 655f 6669 656c 6428 7365 6c66  ename_field(self
-00003020: 2c20 2a2c 206b 6579 3a20 7374 722c 206e  , *, key: str, n
-00003030: 6577 5f6b 6579 3a20 7374 7229 202d 3e20  ew_key: str) -> 
-00003040: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00003050: 2252 656e 616d 6520 6120 6669 656c 6422  "Rename a field"
-00003060: 2222 0a20 2020 2020 2020 2076 616c 7565  "".        value
-00003070: 203d 2073 656c 662e 6461 7461 5b6b 6579   = self.data[key
-00003080: 5d0a 2020 2020 2020 2020 7365 6c66 2e64  ].        self.d
-00003090: 6174 615b 6e65 775f 6b65 795d 203d 2076  ata[new_key] = v
-000030a0: 616c 7565 0a0a 2020 2020 2020 2020 6966  alue..        if
-000030b0: 206b 6579 2069 6e20 7365 6c66 2e69 6465   key in self.ide
-000030c0: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
-000030d0: 6579 733a 0a20 2020 2020 2020 2020 2020  eys:.           
-000030e0: 2076 616c 7565 5f70 726f 7665 6e61 6e63   value_provenanc
-000030f0: 6520 3d20 7365 6c66 2e64 6174 615b 2263  e = self.data["c
-00003100: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-00003110: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
-00003120: 795d 0a20 2020 2020 2020 2020 2020 2069  y].            i
-00003130: 6620 2273 6f75 7263 6522 2069 6e20 7661  f "source" in va
-00003140: 6c75 655f 7072 6f76 656e 616e 6365 3a0a  lue_provenance:.
-00003150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003160: 7661 6c75 655f 7072 6f76 656e 616e 6365  value_provenance
-00003170: 5b22 736f 7572 6365 225d 202b 3d20 6622  ["source"] += f"
-00003180: 7c72 656e 616d 652d 6672 6f6d 3a7b 6b65  |rename-from:{ke
-00003190: 797d 220a 2020 2020 2020 2020 2020 2020  y}".            
-000031a0: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
-000031b0: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
-000031c0: 7665 6e61 6e63 6522 5d5b 6e65 775f 6b65  venance"][new_ke
-000031d0: 795d 203d 2076 616c 7565 5f70 726f 7665  y] = value_prove
-000031e0: 6e61 6e63 650a 2020 2020 2020 2020 656c  nance.        el
-000031f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00003200: 6966 2022 636f 6c72 6576 5f64 6174 615f  if "colrev_data_
-00003210: 7072 6f76 656e 616e 6365 2220 6e6f 7420  provenance" not 
-00003220: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
-00003230: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003240: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-00003250: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-00003260: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
-00003270: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
-00003280: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
-00003290: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-000032a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000032b0: 2020 7661 6c75 655f 7072 6f76 656e 616e    value_provenan
-000032c0: 6365 203d 2073 656c 662e 6461 7461 5b22  ce = self.data["
-000032d0: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-000032e0: 656e 616e 6365 225d 5b6b 6579 5d0a 2020  enance"][key].  
-000032f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003300: 2022 736f 7572 6365 2220 696e 2076 616c   "source" in val
-00003310: 7565 5f70 726f 7665 6e61 6e63 653a 0a20  ue_provenance:. 
-00003320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003330: 2020 2076 616c 7565 5f70 726f 7665 6e61     value_provena
-00003340: 6e63 655b 2273 6f75 7263 6522 5d20 2b3d  nce["source"] +=
-00003350: 2066 227c 7265 6e61 6d65 2d66 726f 6d3a   f"|rename-from:
-00003360: 7b6b 6579 7d22 0a20 2020 2020 2020 2020  {key}".         
-00003370: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00003380: 2020 2020 2020 2020 2076 616c 7565 5f70           value_p
-00003390: 726f 7665 6e61 6e63 6520 3d20 7b22 736f  rovenance = {"so
-000033a0: 7572 6365 223a 2066 227c 7265 6e61 6d65  urce": f"|rename
-000033b0: 2d66 726f 6d3a 7b6b 6579 7d22 2c20 226e  -from:{key}", "n
-000033c0: 6f74 6522 3a20 2222 7d0a 2020 2020 2020  ote": ""}.      
-000033d0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-000033e0: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
-000033f0: 7665 6e61 6e63 6522 5d5b 6e65 775f 6b65  venance"][new_ke
-00003400: 795d 203d 2076 616c 7565 5f70 726f 7665  y] = value_prove
-00003410: 6e61 6e63 650a 0a20 2020 2020 2020 2073  nance..        s
-00003420: 656c 662e 7265 6d6f 7665 5f66 6965 6c64  elf.remove_field
-00003430: 286b 6579 3d6b 6579 290a 0a20 2020 2064  (key=key)..    d
-00003440: 6566 2063 6861 6e67 655f 656e 7472 7974  ef change_entryt
-00003450: 7970 6528 0a20 2020 2020 2020 2073 656c  ype(.        sel
-00003460: 662c 0a20 2020 2020 2020 202a 2c0a 2020  f,.        *,.  
-00003470: 2020 2020 2020 6e65 775f 656e 7472 7974        new_entryt
-00003480: 7970 653a 2073 7472 2c0a 2020 2020 2020  ype: str,.      
-00003490: 2020 716d 3a20 636f 6c72 6576 2e71 6d2e    qm: colrev.qm.
-000034a0: 7175 616c 6974 795f 6d6f 6465 6c2e 5175  quality_model.Qu
-000034b0: 616c 6974 794d 6f64 656c 2c0a 2020 2020  alityModel,.    
-000034c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000034d0: 2020 2022 2222 4368 616e 6765 2074 6865     """Change the
-000034e0: 2045 4e54 5259 5459 5045 2222 220a 2020   ENTRYTYPE""".  
-000034f0: 2020 2020 2020 666f 7220 7661 6c75 6520        for value 
-00003500: 696e 2073 656c 662e 6461 7461 2e67 6574  in self.data.get
-00003510: 2822 636f 6c72 6576 5f6d 6173 7465 7264  ("colrev_masterd
-00003520: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
-00003530: 207b 7d29 2e76 616c 7565 7328 293a 0a20   {}).values():. 
-00003540: 2020 2020 2020 2020 2020 2069 6620 2269             if "i
-00003550: 6e63 6f6e 7369 7374 656e 742d 7769 7468  nconsistent-with
-00003560: 2d65 6e74 7279 7479 7065 2220 696e 2076  -entrytype" in v
-00003570: 616c 7565 5b22 6e6f 7465 225d 3a0a 2020  alue["note"]:.  
-00003580: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00003590: 6c75 655b 226e 6f74 6522 5d20 3d20 2222  lue["note"] = ""
-000035a0: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
-000035b0: 7461 5b22 454e 5452 5954 5950 4522 5d20  ta["ENTRYTYPE"] 
-000035c0: 3d20 6e65 775f 656e 7472 7974 7970 650a  = new_entrytype.
-000035d0: 2020 2020 2020 2020 6966 206e 6577 5f65          if new_e
-000035e0: 6e74 7279 7479 7065 2069 6e20 5b22 696e  ntrytype in ["in
-000035f0: 7072 6f63 6565 6469 6e67 7322 2c20 2270  proceedings", "p
-00003600: 726f 6365 6564 696e 6773 225d 3a0a 2020  roceedings"]:.  
-00003610: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00003620: 662e 6461 7461 2e67 6574 2822 766f 6c75  f.data.get("volu
-00003630: 6d65 222c 2022 2229 203d 3d20 2255 4e4b  me", "") == "UNK
-00003640: 4e4f 574e 223a 0a20 2020 2020 2020 2020  NOWN":.         
-00003650: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00003660: 7665 5f66 6965 6c64 286b 6579 3d22 766f  ve_field(key="vo
-00003670: 6c75 6d65 2229 0a20 2020 2020 2020 2020  lume").         
-00003680: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
-00003690: 6765 7428 226e 756d 6265 7222 2c20 2222  get("number", ""
-000036a0: 2920 3d3d 2022 554e 4b4e 4f57 4e22 3a0a  ) == "UNKNOWN":.
-000036b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036c0: 7365 6c66 2e72 656d 6f76 655f 6669 656c  self.remove_fiel
-000036d0: 6428 6b65 793d 226e 756d 6265 7222 290a  d(key="number").
-000036e0: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-000036f0: 6a6f 7572 6e61 6c22 2069 6e20 7365 6c66  journal" in self
-00003700: 2e64 6174 6120 616e 6420 2262 6f6f 6b74  .data and "bookt
-00003710: 6974 6c65 2220 6e6f 7420 696e 2073 656c  itle" not in sel
-00003720: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-00003730: 2020 2020 2020 2020 7365 6c66 2e72 656e          self.ren
-00003740: 616d 655f 6669 656c 6428 6b65 793d 226a  ame_field(key="j
-00003750: 6f75 726e 616c 222c 206e 6577 5f6b 6579  ournal", new_key
-00003760: 3d22 626f 6f6b 7469 746c 6522 290a 2020  ="booktitle").  
-00003770: 2020 2020 2020 656c 6966 206e 6577 5f65        elif new_e
-00003780: 6e74 7279 7479 7065 203d 3d20 2261 7274  ntrytype == "art
-00003790: 6963 6c65 223a 0a20 2020 2020 2020 2020  icle":.         
-000037a0: 2020 2069 6620 2262 6f6f 6b74 6974 6c65     if "booktitle
-000037b0: 2220 696e 2073 656c 662e 6461 7461 3a0a  " in self.data:.
-000037c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037d0: 7365 6c66 2e72 656e 616d 655f 6669 656c  self.rename_fiel
-000037e0: 6428 6b65 793d 2262 6f6f 6b74 6974 6c65  d(key="booktitle
-000037f0: 222c 206e 6577 5f6b 6579 3d22 6a6f 7572  ", new_key="jour
-00003800: 6e61 6c22 290a 2020 2020 2020 2020 656c  nal").        el
-00003810: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00003820: 7261 6973 6520 636f 6c72 6576 5f65 7863  raise colrev_exc
-00003830: 6570 7469 6f6e 732e 4d69 7373 696e 6752  eptions.MissingR
-00003840: 6563 6f72 6451 7561 6c69 7479 5275 6c65  ecordQualityRule
-00003850: 5370 6563 6966 6963 6174 696f 6e28 0a20  Specification(. 
-00003860: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00003870: 224e 6f20 454e 5452 5954 5950 4520 7370  "No ENTRYTYPE sp
-00003880: 6563 6966 6963 6174 696f 6e20 287b 6e65  ecification ({ne
-00003890: 775f 656e 7472 7974 7970 657d 2922 0a20  w_entrytype})". 
-000038a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000038b0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-000038c0: 655f 6d61 7374 6572 6461 7461 5f70 726f  e_masterdata_pro
-000038d0: 7665 6e61 6e63 6528 716d 3d71 6d29 0a0a  venance(qm=qm)..
-000038e0: 2020 2020 6465 6620 7265 6d6f 7665 5f66      def remove_f
-000038f0: 6965 6c64 280a 2020 2020 2020 2020 7365  ield(.        se
-00003900: 6c66 2c20 2a2c 206b 6579 3a20 7374 722c  lf, *, key: str,
-00003910: 206e 6f74 5f6d 6973 7369 6e67 5f6e 6f74   not_missing_not
-00003920: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
-00003930: 2073 6f75 7263 653a 2073 7472 203d 2022   source: str = "
-00003940: 220a 2020 2020 2920 2d3e 204e 6f6e 653a  ".    ) -> None:
-00003950: 0a20 2020 2020 2020 2022 2222 5265 6d6f  .        """Remo
-00003960: 7665 2061 2066 6965 6c64 2222 220a 0a20  ve a field""".. 
-00003970: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-00003980: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-00003990: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
-000039a0: 2e64 6174 615b 6b65 795d 0a0a 2020 2020  .data[key]..    
-000039b0: 2020 2020 6966 2022 636f 6c72 6576 5f6d      if "colrev_m
-000039c0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-000039d0: 616e 6365 2220 6e6f 7420 696e 2073 656c  ance" not in sel
-000039e0: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-000039f0: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
-00003a00: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-00003a10: 5f70 726f 7665 6e61 6e63 6522 5d20 3d20  _provenance"] = 
-00003a20: 7b7d 0a0a 2020 2020 2020 2020 6966 206e  {}..        if n
-00003a30: 6f74 5f6d 6973 7369 6e67 5f6e 6f74 6520  ot_missing_note 
-00003a40: 616e 6420 6b65 7920 696e 2073 656c 662e  and key in self.
-00003a50: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
-00003a60: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
-00003a70: 2020 2020 2320 4578 616d 706c 653a 206a      # Example: j
-00003a80: 6f75 726e 616c 2077 6974 686f 7574 206e  ournal without n
-00003a90: 756d 6265 720a 2020 2020 2020 2020 2020  umber.          
-00003aa0: 2020 2320 7765 2073 686f 756c 6420 6b65    # we should ke
-00003ab0: 6570 2074 6861 7420 696e 666f 726d 6174  ep that informat
-00003ac0: 696f 6e20 7468 6174 2061 2070 6172 7469  ion that a parti
-00003ad0: 6375 6c61 7220 6d61 7374 6572 6461 7461  cular masterdata
-00003ae0: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-00003af0: 6965 6c64 2069 7320 6e6f 7420 7265 7175  ield is not requ
-00003b00: 6972 6564 0a20 2020 2020 2020 2020 2020  ired.           
-00003b10: 2069 6620 6b65 7920 6e6f 7420 696e 2073   if key not in s
-00003b20: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-00003b30: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-00003b40: 656e 616e 6365 225d 3a0a 2020 2020 2020  enance"]:.      
-00003b50: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00003b60: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
-00003b70: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-00003b80: 6522 5d5b 6b65 795d 203d 207b 7d0a 2020  e"][key] = {}.  
-00003b90: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00003ba0: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
-00003bb0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-00003bc0: 6522 5d5b 6b65 795d 5b22 6e6f 7465 225d  e"][key]["note"]
-00003bd0: 203d 2022 6e6f 742d 6d69 7373 696e 6722   = "not-missing"
-00003be0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00003bf0: 736f 7572 6365 2021 3d20 2222 3a0a 2020  source != "":.  
-00003c00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003c10: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-00003c20: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-00003c30: 6e61 6e63 6522 5d5b 6b65 795d 5b22 736f  nance"][key]["so
-00003c40: 7572 6365 225d 203d 2073 6f75 7263 650a  urce"] = source.
-00003c50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00003c60: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00003c70: 2069 6e20 7365 6c66 2e69 6465 6e74 6966   in self.identif
-00003c80: 7969 6e67 5f66 6965 6c64 5f6b 6579 733a  ying_field_keys:
-00003c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ca0: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
-00003cb0: 6461 7461 2e67 6574 2822 636f 6c72 6576  data.get("colrev
-00003cc0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-00003cd0: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
-00003ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003cf0: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
-00003d00: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-00003d10: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-00003d20: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
-00003d30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00003d40: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-00003d50: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
-00003d60: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-00003d70: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
-00003d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d90: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
-00003da0: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
-00003db0: 7665 6e61 6e63 6522 5d5b 6b65 795d 0a0a  venance"][key]..
-00003dc0: 2020 2020 6465 6620 7365 745f 6d61 7374      def set_mast
-00003dd0: 6572 6461 7461 5f63 6f6d 706c 6574 6528  erdata_complete(
-00003de0: 0a20 2020 2020 2020 2073 656c 662c 202a  .        self, *
-00003df0: 2c20 736f 7572 6365 3a20 7374 722c 2072  , source: str, r
-00003e00: 6570 6c61 6365 5f73 6f75 7263 653a 2062  eplace_source: b
-00003e10: 6f6f 6c20 3d20 5472 7565 0a20 2020 2029  ool = True.    )
-00003e20: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00003e30: 2020 2222 2253 6574 2074 6865 206d 6173    """Set the mas
-00003e40: 7465 7264 6174 6120 746f 2063 6f6d 706c  terdata to compl
-00003e50: 6574 6522 2222 0a20 2020 2020 2020 2023  ete""".        #
-00003e60: 2070 796c 696e 743a 2064 6973 6162 6c65   pylint: disable
-00003e70: 3d74 6f6f 2d6d 616e 792d 6272 616e 6368  =too-many-branch
-00003e80: 6573 0a20 2020 2020 2020 2069 6620 7365  es.        if se
-00003e90: 6c66 2e6d 6173 7465 7264 6174 615f 6973  lf.masterdata_is
-00003ea0: 5f63 7572 6174 6564 2829 3a0a 2020 2020  _curated():.    
-00003eb0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00003ec0: 2020 2020 2020 2020 6966 2022 636f 6c72          if "colr
-00003ed0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-00003ee0: 6f76 656e 616e 6365 2220 6e6f 7420 696e  ovenance" not in
-00003ef0: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-00003f00: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00003f10: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
-00003f20: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-00003f30: 5d20 3d20 7b7d 0a20 2020 2020 2020 206d  ] = {}.        m
-00003f40: 645f 705f 6469 6374 203d 2073 656c 662e  d_p_dict = self.
-00003f50: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-00003f60: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00003f70: 6365 225d 0a0a 2020 2020 2020 2020 666f  ce"]..        fo
-00003f80: 7220 6964 656e 7469 6679 696e 675f 6669  r identifying_fi
-00003f90: 656c 645f 6b65 7920 696e 2073 656c 662e  eld_key in self.
-00003fa0: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
-00003fb0: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
-00003fc0: 2020 2020 6966 2069 6465 6e74 6966 7969      if identifyi
-00003fd0: 6e67 5f66 6965 6c64 5f6b 6579 2069 6e20  ng_field_key in 
-00003fe0: 5b22 6175 7468 6f72 222c 2022 7469 746c  ["author", "titl
-00003ff0: 6522 2c20 2279 6561 7222 5d3a 0a20 2020  e", "year"]:.   
-00004000: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00004010: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00004020: 2020 6966 2073 656c 662e 6461 7461 2e67    if self.data.g
-00004030: 6574 2869 6465 6e74 6966 7969 6e67 5f66  et(identifying_f
-00004040: 6965 6c64 5f6b 6579 2c20 224e 4122 2920  ield_key, "NA") 
-00004050: 3d3d 2022 554e 4b4e 4f57 4e22 3a0a 2020  == "UNKNOWN":.  
-00004060: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00004070: 6c20 7365 6c66 2e64 6174 615b 6964 656e  l self.data[iden
-00004080: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
-00004090: 795d 0a20 2020 2020 2020 2020 2020 2069  y].            i
-000040a0: 6620 6964 656e 7469 6679 696e 675f 6669  f identifying_fi
-000040b0: 656c 645f 6b65 7920 696e 206d 645f 705f  eld_key in md_p_
-000040c0: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-000040d0: 2020 2020 2020 6e6f 7465 203d 206d 645f        note = md_
-000040e0: 705f 6469 6374 5b69 6465 6e74 6966 7969  p_dict[identifyi
-000040f0: 6e67 5f66 6965 6c64 5f6b 6579 5d5b 226e  ng_field_key]["n
-00004100: 6f74 6522 5d0a 2020 2020 2020 2020 2020  ote"].          
-00004110: 2020 2020 2020 6966 2022 6d69 7373 696e        if "missin
-00004120: 6722 2069 6e20 6e6f 7465 2061 6e64 2022  g" in note and "
-00004130: 6e6f 742d 6d69 7373 696e 6722 206e 6f74  not-missing" not
-00004140: 2069 6e20 6e6f 7465 3a0a 2020 2020 2020   in note:.      
-00004150: 2020 2020 2020 2020 2020 2020 2020 6d64                md
-00004160: 5f70 5f64 6963 745b 6964 656e 7469 6679  _p_dict[identify
-00004170: 696e 675f 6669 656c 645f 6b65 795d 5b22  ing_field_key]["
-00004180: 6e6f 7465 225d 203d 206e 6f74 652e 7265  note"] = note.re
-00004190: 706c 6163 6528 0a20 2020 2020 2020 2020  place(.         
-000041a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000041b0: 6d69 7373 696e 6722 2c20 2222 0a20 2020  missing", "".   
-000041c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041d0: 2029 0a0a 2020 2020 2020 2020 6966 2073   )..        if s
-000041e0: 656c 662e 6461 7461 5b22 454e 5452 5954  elf.data["ENTRYT
-000041f0: 5950 4522 5d20 3d3d 2022 6172 7469 636c  YPE"] == "articl
-00004200: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-00004210: 6966 2022 766f 6c75 6d65 2220 6e6f 7420  if "volume" not 
-00004220: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
-00004230: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004240: 2022 766f 6c75 6d65 2220 696e 2073 656c   "volume" in sel
-00004250: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
-00004260: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-00004270: 616e 6365 225d 3a0a 2020 2020 2020 2020  ance"]:.        
-00004280: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004290: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-000042a0: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-000042b0: 6e63 6522 5d5b 2276 6f6c 756d 6522 5d5b  nce"]["volume"][
-000042c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000042d0: 2020 2020 2020 2020 2022 6e6f 7465 220a           "note".
-000042e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042f0: 2020 2020 5d20 3d20 226e 6f74 2d6d 6973      ] = "not-mis
-00004300: 7369 6e67 220a 2020 2020 2020 2020 2020  sing".          
-00004310: 2020 2020 2020 2020 2020 6966 2072 6570            if rep
-00004320: 6c61 6365 5f73 6f75 7263 653a 0a20 2020  lace_source:.   
-00004330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004340: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-00004350: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-00004360: 615f 7072 6f76 656e 616e 6365 225d 5b22  a_provenance"]["
-00004370: 766f 6c75 6d65 225d 5b0a 2020 2020 2020  volume"][.      
-00004380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004390: 2020 2020 2020 2273 6f75 7263 6522 0a20        "source". 
-000043a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043b0: 2020 2020 2020 205d 203d 2073 6f75 7263         ] = sourc
-000043c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000043d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000043e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000043f0: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-00004400: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-00004410: 6e63 6522 5d5b 2276 6f6c 756d 6522 5d20  nce"]["volume"] 
-00004420: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00004430: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
-00004440: 7263 6522 3a20 736f 7572 6365 2c0a 2020  rce": source,.  
-00004450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004460: 2020 2020 2020 226e 6f74 6522 3a20 226e        "note": "n
-00004470: 6f74 2d6d 6973 7369 6e67 222c 0a20 2020  ot-missing",.   
-00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004490: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-000044a0: 6966 2022 6e75 6d62 6572 2220 6e6f 7420  if "number" not 
-000044b0: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
-000044c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000044d0: 2022 6e75 6d62 6572 2220 696e 2073 656c   "number" in sel
-000044e0: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
-000044f0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-00004500: 616e 6365 225d 3a0a 2020 2020 2020 2020  ance"]:.        
-00004510: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004520: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-00004530: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-00004540: 6e63 6522 5d5b 226e 756d 6265 7222 5d5b  nce"]["number"][
-00004550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004560: 2020 2020 2020 2020 2022 6e6f 7465 220a           "note".
-00004570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004580: 2020 2020 5d20 3d20 226e 6f74 2d6d 6973      ] = "not-mis
-00004590: 7369 6e67 220a 2020 2020 2020 2020 2020  sing".          
-000045a0: 2020 2020 2020 2020 2020 6966 2072 6570            if rep
-000045b0: 6c61 6365 5f73 6f75 7263 653a 0a20 2020  lace_source:.   
-000045c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045d0: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-000045e0: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-000045f0: 615f 7072 6f76 656e 616e 6365 225d 5b22  a_provenance"]["
-00004600: 6e75 6d62 6572 225d 5b0a 2020 2020 2020  number"][.      
-00004610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004620: 2020 2020 2020 2273 6f75 7263 6522 0a20        "source". 
-00004630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004640: 2020 2020 2020 205d 203d 2073 6f75 7263         ] = sourc
-00004650: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00004660: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004670: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004680: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-00004690: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-000046a0: 6e63 6522 5d5b 226e 756d 6265 7222 5d20  nce"]["number"] 
-000046b0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-000046c0: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
-000046d0: 7263 6522 3a20 736f 7572 6365 2c0a 2020  rce": source,.  
-000046e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046f0: 2020 2020 2020 226e 6f74 6522 3a20 226e        "note": "n
-00004700: 6f74 2d6d 6973 7369 6e67 222c 0a20 2020  ot-missing",.   
-00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004720: 207d 0a0a 2020 2020 6465 6620 7365 745f   }..    def set_
-00004730: 6d61 7374 6572 6461 7461 5f63 6f6e 7369  masterdata_consi
-00004740: 7374 656e 7428 7365 6c66 2920 2d3e 204e  stent(self) -> N
-00004750: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00004760: 5365 7420 7468 6520 6d61 7374 6572 6461  Set the masterda
-00004770: 7461 2074 6f20 636f 6e73 6973 7465 6e74  ta to consistent
-00004780: 2222 220a 2020 2020 2020 2020 6966 2022  """.        if "
-00004790: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-000047a0: 615f 7072 6f76 656e 616e 6365 2220 6e6f  a_provenance" no
-000047b0: 7420 696e 2073 656c 662e 6461 7461 3a0a  t in self.data:.
-000047c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000047d0: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-000047e0: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-000047f0: 6e63 6522 5d20 3d20 7b7d 0a20 2020 2020  nce"] = {}.     
-00004800: 2020 206d 645f 705f 6469 6374 203d 2073     md_p_dict = s
-00004810: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-00004820: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-00004830: 656e 616e 6365 225d 0a0a 2020 2020 2020  enance"]..      
-00004840: 2020 666f 7220 6964 656e 7469 6679 696e    for identifyin
-00004850: 675f 6669 656c 645f 6b65 7920 696e 2073  g_field_key in s
-00004860: 656c 662e 6964 656e 7469 6679 696e 675f  elf.identifying_
-00004870: 6669 656c 645f 6b65 7973 3a0a 2020 2020  field_keys:.    
-00004880: 2020 2020 2020 2020 6966 2069 6465 6e74          if ident
-00004890: 6966 7969 6e67 5f66 6965 6c64 5f6b 6579  ifying_field_key
-000048a0: 2069 6e20 6d64 5f70 5f64 6963 743a 0a20   in md_p_dict:. 
-000048b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000048c0: 6f74 6520 3d20 6d64 5f70 5f64 6963 745b  ote = md_p_dict[
-000048d0: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
-000048e0: 645f 6b65 795d 5b22 6e6f 7465 225d 0a20  d_key]["note"]. 
-000048f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004900: 6620 2269 6e63 6f6e 7369 7374 656e 742d  f "inconsistent-
-00004910: 7769 7468 2d65 6e74 7279 7479 7065 2220  with-entrytype" 
-00004920: 696e 206e 6f74 653a 0a20 2020 2020 2020  in note:.       
-00004930: 2020 2020 2020 2020 2020 2020 206d 645f               md_
-00004940: 705f 6469 6374 5b69 6465 6e74 6966 7969  p_dict[identifyi
-00004950: 6e67 5f66 6965 6c64 5f6b 6579 5d5b 226e  ng_field_key]["n
-00004960: 6f74 6522 5d20 3d20 6e6f 7465 2e72 6570  ote"] = note.rep
-00004970: 6c61 6365 280a 2020 2020 2020 2020 2020  lace(.          
-00004980: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-00004990: 6e63 6f6e 7369 7374 656e 742d 7769 7468  nconsistent-with
-000049a0: 2d65 6e74 7279 7479 7065 222c 2022 220a  -entrytype", "".
-000049b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049c0: 2020 2020 290a 0a20 2020 2064 6566 2072      )..    def r
-000049d0: 6573 6574 5f70 6466 5f70 726f 7665 6e61  eset_pdf_provena
-000049e0: 6e63 655f 6e6f 7465 7328 7365 6c66 2920  nce_notes(self) 
-000049f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00004a00: 2022 2222 5265 7365 7420 7468 6520 5044   """Reset the PD
-00004a10: 4620 2866 696c 6529 2070 726f 7665 6e61  F (file) provena
-00004a20: 6e63 6520 6e6f 7465 7322 2222 0a20 2020  nce notes""".   
-00004a30: 2020 2020 2069 6620 2263 6f6c 7265 765f       if "colrev_
-00004a40: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-00004a50: 206e 6f74 2069 6e20 7365 6c66 2e64 6174   not in self.dat
-00004a60: 613a 0a20 2020 2020 2020 2020 2020 2073  a:.            s
-00004a70: 656c 662e 6164 645f 6461 7461 5f70 726f  elf.add_data_pro
-00004a80: 7665 6e61 6e63 655f 6e6f 7465 286b 6579  venance_note(key
-00004a90: 3d22 6669 6c65 222c 206e 6f74 653d 2222  ="file", note=""
-00004aa0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00004ab0: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-00004ac0: 6669 6c65 2220 696e 2073 656c 662e 6461  file" in self.da
-00004ad0: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
-00004ae0: 7072 6f76 656e 616e 6365 225d 3a0a 2020  provenance"]:.  
-00004af0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00004b00: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-00004b10: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-00004b20: 5d5b 2266 696c 6522 5d5b 226e 6f74 6522  ]["file"]["note"
-00004b30: 5d20 3d20 2222 0a20 2020 2020 2020 2020  ] = "".         
-00004b40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00004b50: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-00004b60: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
-00004b70: 7072 6f76 656e 616e 6365 225d 5b22 6669  provenance"]["fi
-00004b80: 6c65 225d 203d 207b 0a20 2020 2020 2020  le"] = {.       
-00004b90: 2020 2020 2020 2020 2020 2020 2022 736f               "so
-00004ba0: 7572 6365 223a 2022 4e41 222c 0a20 2020  urce": "NA",.   
-00004bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bc0: 2022 6e6f 7465 223a 2022 222c 0a20 2020   "note": "",.   
-00004bd0: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
-00004be0: 2020 2020 6465 6620 5f5f 6d65 7267 655f      def __merge_
-00004bf0: 6f72 6967 696e 7328 7365 6c66 2c20 2a2c  origins(self, *,
-00004c00: 206d 6572 6769 6e67 5f72 6563 6f72 643a   merging_record:
-00004c10: 2052 6563 6f72 6429 202d 3e20 4e6f 6e65   Record) -> None
-00004c20: 3a0a 2020 2020 2020 2020 2222 224d 6572  :.        """Mer
-00004c30: 6765 2074 6865 206f 7269 6769 6e73 2077  ge the origins w
-00004c40: 6974 6820 7468 6f73 6520 6f66 2074 6865  ith those of the
-00004c50: 206d 6572 6769 6e67 5f72 6563 6f72 6422   merging_record"
-00004c60: 2222 0a0a 2020 2020 2020 2020 6966 2022  ""..        if "
-00004c70: 636f 6c72 6576 5f6f 7269 6769 6e22 2069  colrev_origin" i
-00004c80: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
-00004c90: 2e64 6174 613a 0a20 2020 2020 2020 2020  .data:.         
-00004ca0: 2020 206f 7269 6769 6e73 203d 2073 656c     origins = sel
-00004cb0: 662e 6461 7461 5b22 636f 6c72 6576 5f6f  f.data["colrev_o
-00004cc0: 7269 6769 6e22 5d20 2b20 6d65 7267 696e  rigin"] + mergin
-00004cd0: 675f 7265 636f 7264 2e64 6174 615b 2263  g_record.data["c
-00004ce0: 6f6c 7265 765f 6f72 6967 696e 225d 0a20  olrev_origin"]. 
-00004cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004d00: 6461 7461 5b22 636f 6c72 6576 5f6f 7269  data["colrev_ori
-00004d10: 6769 6e22 5d20 3d20 736f 7274 6564 286c  gin"] = sorted(l
-00004d20: 6973 7428 7365 7428 6f72 6967 696e 7329  ist(set(origins)
-00004d30: 2929 0a0a 2020 2020 6465 6620 5f5f 6d65  ))..    def __me
-00004d40: 7267 655f 7374 6174 7573 2873 656c 662c  rge_status(self,
-00004d50: 202a 2c20 6d65 7267 696e 675f 7265 636f   *, merging_reco
-00004d60: 7264 3a20 5265 636f 7264 2920 2d3e 204e  rd: Record) -> N
-00004d70: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00004d80: 4d65 7267 6520 7468 6520 7374 6174 7573  Merge the status
-00004d90: 2077 6974 6820 7468 6520 6d65 7267 696e   with the mergin
-00004da0: 675f 7265 636f 7264 2222 220a 0a20 2020  g_record"""..   
-00004db0: 2020 2020 2069 6620 2263 6f6c 7265 765f       if "colrev_
-00004dc0: 7374 6174 7573 2220 696e 206d 6572 6769  status" in mergi
-00004dd0: 6e67 5f72 6563 6f72 642e 6461 7461 3a0a  ng_record.data:.
-00004de0: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
-00004df0: 7420 626f 7468 2073 7461 7475 7320 746f  t both status to
-00004e00: 2074 6865 206c 6174 7465 7220 696e 2074   the latter in t
-00004e10: 6865 2073 7461 7465 206d 6f64 656c 0a20  he state model. 
-00004e20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00004e30: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-00004e40: 7374 6174 7573 225d 203c 206d 6572 6769  status"] < mergi
-00004e50: 6e67 5f72 6563 6f72 642e 6461 7461 5b22  ng_record.data["
-00004e60: 636f 6c72 6576 5f73 7461 7475 7322 5d3a  colrev_status"]:
-00004e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004e80: 2073 656c 662e 7365 745f 7374 6174 7573   self.set_status
-00004e90: 2874 6172 6765 745f 7374 6174 653d 6d65  (target_state=me
-00004ea0: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
-00004eb0: 615b 2263 6f6c 7265 765f 7374 6174 7573  a["colrev_status
-00004ec0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-00004ed0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00004ee0: 2020 2020 2020 6d65 7267 696e 675f 7265        merging_re
-00004ef0: 636f 7264 2e73 6574 5f73 7461 7475 7328  cord.set_status(
-00004f00: 7461 7267 6574 5f73 7461 7465 3d73 656c  target_state=sel
-00004f10: 662e 6461 7461 5b22 636f 6c72 6576 5f73  f.data["colrev_s
-00004f20: 7461 7475 7322 5d29 0a0a 2020 2020 6465  tatus"])..    de
-00004f30: 6620 5f5f 6765 745f 6d65 7267 696e 675f  f __get_merging_
-00004f40: 7661 6c28 7365 6c66 2c20 2a2c 206d 6572  val(self, *, mer
-00004f50: 6769 6e67 5f72 6563 6f72 643a 2052 6563  ging_record: Rec
-00004f60: 6f72 642c 206b 6579 3a20 7374 7229 202d  ord, key: str) -
-00004f70: 3e20 7374 723a 0a20 2020 2020 2020 2076  > str:.        v
-00004f80: 616c 203d 206d 6572 6769 6e67 5f72 6563  al = merging_rec
-00004f90: 6f72 642e 6461 7461 2e67 6574 286b 6579  ord.data.get(key
-00004fa0: 2c20 2222 290a 0a20 2020 2020 2020 2069  , "")..        i
-00004fb0: 6620 7661 6c20 3d3d 2022 223a 0a20 2020  f val == "":.   
-00004fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004fd0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00004fe0: 7420 7661 6c3a 0a20 2020 2020 2020 2020  t val:.         
-00004ff0: 2020 2072 6574 7572 6e20 2222 0a0a 2020     return ""..  
-00005000: 2020 2020 2020 2320 646f 206e 6f74 206f        # do not o
-00005010: 7665 7272 6964 6520 7072 6f76 656e 616e  verride provenan
-00005020: 6365 2c20 4944 2c20 2e2e 2e20 6669 656c  ce, ID, ... fiel
-00005030: 6473 0a20 2020 2020 2020 2069 6620 6b65  ds.        if ke
-00005040: 7920 696e 205b 0a20 2020 2020 2020 2020  y in [.         
-00005050: 2020 2022 4944 222c 0a20 2020 2020 2020     "ID",.       
-00005060: 2020 2020 2022 636f 6c72 6576 5f6d 6173       "colrev_mas
-00005070: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00005080: 6365 222c 0a20 2020 2020 2020 2020 2020  ce",.           
-00005090: 2022 636f 6c72 6576 5f64 6174 615f 7072   "colrev_data_pr
-000050a0: 6f76 656e 616e 6365 222c 0a20 2020 2020  ovenance",.     
-000050b0: 2020 2020 2020 2022 636f 6c72 6576 5f69         "colrev_i
-000050c0: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-000050d0: 2263 6f6c 7265 765f 7374 6174 7573 222c  "colrev_status",
-000050e0: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
-000050f0: 6c72 6576 5f6f 7269 6769 6e22 2c0a 2020  lrev_origin",.  
-00005100: 2020 2020 2020 2020 2020 224d 4f56 4544            "MOVED
-00005110: 5f44 5550 455f 4944 222c 0a20 2020 2020  _DUPE_ID",.     
-00005120: 2020 205d 3a0a 2020 2020 2020 2020 2020     ]:.          
-00005130: 2020 7265 7475 726e 2022 220a 0a20 2020    return ""..   
-00005140: 2020 2020 2072 6574 7572 6e20 7661 6c0a       return val.
-00005150: 0a20 2020 2064 6566 205f 5f70 7265 7665  .    def __preve
-00005160: 6e74 5f69 6e76 616c 6964 5f6d 6572 6765  nt_invalid_merge
-00005170: 7328 7365 6c66 2c20 2a2c 206d 6572 6769  s(self, *, mergi
-00005180: 6e67 5f72 6563 6f72 643a 2052 6563 6f72  ng_record: Recor
-00005190: 6429 202d 3e20 4e6f 6e65 3a0a 2020 2020  d) -> None:.    
-000051a0: 2020 2020 2222 2250 7265 7665 6e74 7320      """Prevents 
-000051b0: 696e 7661 6c69 6420 6d65 7267 6573 206c  invalid merges l
-000051c0: 696b 6520 2e2e 2e20 7061 7274 2031 202f  ike ... part 1 /
-000051d0: 202e 2e2e 2070 6172 7420 3222 2222 0a0a   ... part 2"""..
-000051e0: 2020 2020 2020 2020 6c6f 7765 725f 7469          lower_ti
-000051f0: 746c 655f 6120 3d20 7365 6c66 2e64 6174  tle_a = self.dat
-00005200: 612e 6765 7428 2274 6974 6c65 222c 2022  a.get("title", "
-00005210: 2229 2e6c 6f77 6572 2829 0a20 2020 2020  ").lower().     
-00005220: 2020 206c 6f77 6572 5f74 6974 6c65 5f62     lower_title_b
-00005230: 203d 206d 6572 6769 6e67 5f72 6563 6f72   = merging_recor
-00005240: 642e 6461 7461 2e67 6574 2822 7469 746c  d.data.get("titl
-00005250: 6522 2c20 2222 292e 6c6f 7765 7228 290a  e", "").lower().
-00005260: 0a20 2020 2020 2020 2070 6172 745f 6d61  .        part_ma
-00005270: 7463 685f 6120 3d20 7265 2e66 696e 6461  tch_a = re.finda
-00005280: 6c6c 2872 2270 6172 7420 5b41 2d5a 612d  ll(r"part [A-Za-
-00005290: 7a30 2d39 5d2b 2422 2c20 6c6f 7765 725f  z0-9]+$", lower_
-000052a0: 7469 746c 655f 6129 0a20 2020 2020 2020  title_a).       
-000052b0: 2070 6172 745f 6d61 7463 685f 6220 3d20   part_match_b = 
-000052c0: 7265 2e66 696e 6461 6c6c 2872 2270 6172  re.findall(r"par
-000052d0: 7420 5b41 2d5a 612d 7a30 2d39 5d2b 2422  t [A-Za-z0-9]+$"
-000052e0: 2c20 6c6f 7765 725f 7469 746c 655f 6229  , lower_title_b)
-000052f0: 0a0a 2020 2020 2020 2020 6966 2070 6172  ..        if par
-00005300: 745f 6d61 7463 685f 6120 213d 2070 6172  t_match_a != par
-00005310: 745f 6d61 7463 685f 623a 0a20 2020 2020  t_match_b:.     
-00005320: 2020 2020 2020 2072 6169 7365 2063 6f6c         raise col
-00005330: 7265 765f 6578 6365 7074 696f 6e73 2e49  rev_exceptions.I
-00005340: 6e76 616c 6964 4d65 7267 6528 7265 636f  nvalidMerge(reco
-00005350: 7264 5f61 3d73 656c 662c 2072 6563 6f72  rd_a=self, recor
-00005360: 645f 623d 6d65 7267 696e 675f 7265 636f  d_b=merging_reco
-00005370: 7264 290a 0a20 2020 2020 2020 2074 6572  rd)..        ter
-00005380: 6d73 5f72 6571 7569 7265 645f 746f 5f6d  ms_required_to_m
-00005390: 6174 6368 203d 205b 0a20 2020 2020 2020  atch = [.       
-000053a0: 2020 2020 2022 6572 7261 7475 6d22 2c0a       "erratum",.
-000053b0: 2020 2020 2020 2020 2020 2020 2263 6f72              "cor
-000053c0: 7265 6374 696f 6e22 2c0a 2020 2020 2020  rection",.      
-000053d0: 2020 2020 2020 2263 6f72 7269 6765 6e64        "corrigend
-000053e0: 756d 222c 0a20 2020 2020 2020 2020 2020  um",.           
-000053f0: 2022 636f 6d6d 656e 7422 2c0a 2020 2020   "comment",.    
-00005400: 2020 2020 2020 2020 2263 6f6d 6d65 6e74          "comment
-00005410: 6172 7922 2c0a 2020 2020 2020 2020 2020  ary",.          
-00005420: 2020 2272 6573 706f 6e73 6522 2c0a 2020    "response",.  
-00005430: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00005440: 7465 726d 735f 696e 5f61 203d 205b 7420  terms_in_a = [t 
-00005450: 666f 7220 7420 696e 2074 6572 6d73 5f72  for t in terms_r
-00005460: 6571 7569 7265 645f 746f 5f6d 6174 6368  equired_to_match
-00005470: 2069 6620 7420 696e 206c 6f77 6572 5f74   if t in lower_t
-00005480: 6974 6c65 5f61 5d0a 2020 2020 2020 2020  itle_a].        
-00005490: 7465 726d 735f 696e 5f62 203d 205b 7420  terms_in_b = [t 
-000054a0: 666f 7220 7420 696e 2074 6572 6d73 5f72  for t in terms_r
-000054b0: 6571 7569 7265 645f 746f 5f6d 6174 6368  equired_to_match
-000054c0: 2069 6620 7420 696e 206c 6f77 6572 5f74   if t in lower_t
-000054d0: 6974 6c65 5f62 5d0a 0a20 2020 2020 2020  itle_b]..       
-000054e0: 2069 6620 7465 726d 735f 696e 5f61 2021   if terms_in_a !
-000054f0: 3d20 7465 726d 735f 696e 5f62 3a0a 2020  = terms_in_b:.  
-00005500: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00005510: 636f 6c72 6576 5f65 7863 6570 7469 6f6e  colrev_exception
-00005520: 732e 496e 7661 6c69 644d 6572 6765 2872  s.InvalidMerge(r
-00005530: 6563 6f72 645f 613d 7365 6c66 2c20 7265  ecord_a=self, re
-00005540: 636f 7264 5f62 3d6d 6572 6769 6e67 5f72  cord_b=merging_r
-00005550: 6563 6f72 6429 0a0a 2020 2020 6465 6620  ecord)..    def 
-00005560: 6d65 7267 6528 0a20 2020 2020 2020 2073  merge(.        s
-00005570: 656c 662c 0a20 2020 2020 2020 202a 2c0a  elf,.        *,.
-00005580: 2020 2020 2020 2020 6d65 7267 696e 675f          merging_
-00005590: 7265 636f 7264 3a20 5265 636f 7264 2c0a  record: Record,.
-000055a0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-000055b0: 736f 7572 6365 3a20 7374 722c 0a20 2020  source: str,.   
-000055c0: 2020 2020 2070 7265 6665 7272 6564 5f6d       preferred_m
-000055d0: 6173 7465 7264 6174 615f 736f 7572 6365  asterdata_source
-000055e0: 5f70 7265 6669 7865 733a 204f 7074 696f  _prefixes: Optio
-000055f0: 6e61 6c5b 6c69 7374 5d20 3d20 4e6f 6e65  nal[list] = None
-00005600: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
-00005610: 0a20 2020 2020 2020 2022 2222 4765 6e65  .        """Gene
-00005620: 7261 6c2d 7075 7270 6f73 6520 7265 636f  ral-purpose reco
-00005630: 7264 206d 6572 6769 6e67 0a20 2020 2020  rd merging.     
-00005640: 2020 2066 6f72 2070 7265 7061 7261 7469     for preparati
-00005650: 6f6e 2c20 6375 7261 7465 642f 6e6f 6e2d  on, curated/non-
-00005660: 6375 7261 7465 6420 7265 636f 7264 7320  curated records 
-00005670: 616e 6420 7265 636f 7264 7320 7769 7468  and records with
-00005680: 206f 7269 6769 6e73 0a0a 0a20 2020 2020   origins...     
-00005690: 2020 2041 7070 6c79 2068 6575 7269 7374     Apply heurist
-000056a0: 6963 7320 746f 2063 7265 6174 6520 6120  ics to create a 
-000056b0: 6675 7369 6f6e 206f 6620 7468 6520 6265  fusion of the be
-000056c0: 7374 2066 6965 6c64 7320 6261 7365 6420  st fields based 
-000056d0: 6f6e 0a20 2020 2020 2020 2071 7561 6c69  on.        quali
-000056e0: 7479 2068 6575 7269 7374 6963 7322 2222  ty heuristics"""
-000056f0: 0a0a 2020 2020 2020 2020 2320 7079 6c69  ..        # pyli
-00005700: 6e74 3a20 6469 7361 626c 653d 746f 6f2d  nt: disable=too-
-00005710: 6d61 6e79 2d62 7261 6e63 6865 730a 0a20  many-branches.. 
-00005720: 2020 2020 2020 206d 6572 6769 6e67 5f72         merging_r
-00005730: 6563 6f72 645f 7072 6566 6572 7265 6420  ecord_preferred 
-00005740: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00005750: 6966 2070 7265 6665 7272 6564 5f6d 6173  if preferred_mas
-00005760: 7465 7264 6174 615f 736f 7572 6365 5f70  terdata_source_p
-00005770: 7265 6669 7865 733a 0a20 2020 2020 2020  refixes:.       
-00005780: 2020 2020 2069 6620 616e 7928 0a20 2020       if any(.   
-00005790: 2020 2020 2020 2020 2020 2020 2061 6e79               any
-000057a0: 2870 7320 696e 206f 7269 6769 6e20 666f  (ps in origin fo
-000057b0: 7220 7073 2069 6e20 7072 6566 6572 7265  r ps in preferre
-000057c0: 645f 6d61 7374 6572 6461 7461 5f73 6f75  d_masterdata_sou
-000057d0: 7263 655f 7072 6566 6978 6573 290a 2020  rce_prefixes).  
-000057e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000057f0: 7220 6f72 6967 696e 2069 6e20 6d65 7267  r origin in merg
-00005800: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-00005810: 2263 6f6c 7265 765f 6f72 6967 696e 225d  "colrev_origin"]
-00005820: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-00005830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005840: 6d65 7267 696e 675f 7265 636f 7264 5f70  merging_record_p
-00005850: 7265 6665 7272 6564 203d 2054 7275 650a  referred = True.
-00005860: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
-00005870: 7072 6576 656e 745f 696e 7661 6c69 645f  prevent_invalid_
-00005880: 6d65 7267 6573 286d 6572 6769 6e67 5f72  merges(merging_r
-00005890: 6563 6f72 643d 6d65 7267 696e 675f 7265  ecord=merging_re
-000058a0: 636f 7264 290a 2020 2020 2020 2020 7365  cord).        se
-000058b0: 6c66 2e5f 5f6d 6572 6765 5f6f 7269 6769  lf.__merge_origi
-000058c0: 6e73 286d 6572 6769 6e67 5f72 6563 6f72  ns(merging_recor
-000058d0: 643d 6d65 7267 696e 675f 7265 636f 7264  d=merging_record
-000058e0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-000058f0: 5f6d 6572 6765 5f73 7461 7475 7328 6d65  _merge_status(me
-00005900: 7267 696e 675f 7265 636f 7264 3d6d 6572  rging_record=mer
-00005910: 6769 6e67 5f72 6563 6f72 6429 0a0a 2020  ging_record)..  
-00005920: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00005930: 662e 6d61 7374 6572 6461 7461 5f69 735f  f.masterdata_is_
-00005940: 6375 7261 7465 6428 2920 616e 6420 6d65  curated() and me
-00005950: 7267 696e 675f 7265 636f 7264 2e6d 6173  rging_record.mas
-00005960: 7465 7264 6174 615f 6973 5f63 7572 6174  terdata_is_curat
-00005970: 6564 2829 3a0a 2020 2020 2020 2020 2020  ed():.          
-00005980: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
-00005990: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-000059a0: 726f 7665 6e61 6e63 6522 5d20 3d20 6d65  rovenance"] = me
-000059b0: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
-000059c0: 615b 0a20 2020 2020 2020 2020 2020 2020  a[.             
-000059d0: 2020 2022 636f 6c72 6576 5f6d 6173 7465     "colrev_maste
-000059e0: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
-000059f0: 220a 2020 2020 2020 2020 2020 2020 5d0a  ".            ].
-00005a00: 2020 2020 2020 2020 2020 2020 2320 4e6f              # No
-00005a10: 7465 203a 2072 656d 6f76 6520 616c 6c20  te : remove all 
-00005a20: 6d61 7374 6572 6461 7461 2066 6965 6c64  masterdata field
-00005a30: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
-00005a40: 6265 6361 7573 6520 7468 6520 6375 7261  because the cura
-00005a50: 7465 6420 7265 636f 7264 206d 6179 2068  ted record may h
-00005a60: 6176 6520 6665 7765 7220 6d61 7374 6572  ave fewer master
-00005a70: 6461 7461 2066 6965 6c64 730a 2020 2020  data fields.    
-00005a80: 2020 2020 2020 2020 2320 616e 6420 7765          # and we
-00005a90: 2069 7465 7261 7465 206f 7665 7220 7468   iterate over th
-00005aa0: 6520 6375 7261 7465 6420 7265 636f 7264  e curated record
-00005ab0: 2028 6d65 7267 696e 675f 7265 636f 7264   (merging_record
-00005ac0: 2920 696e 2074 6865 206e 6578 7420 7374  ) in the next st
-00005ad0: 6570 0a20 2020 2020 2020 2020 2020 2066  ep.            f
-00005ae0: 6f72 206b 2069 6e20 6c69 7374 2873 656c  or k in list(sel
-00005af0: 662e 6461 7461 2e6b 6579 7328 2929 3a0a  f.data.keys()):.
-00005b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b10: 6966 206b 2069 6e20 5265 636f 7264 2e69  if k in Record.i
-00005b20: 6465 6e74 6966 7969 6e67 5f66 6965 6c64  dentifying_field
-00005b30: 5f6b 6579 7320 616e 6420 6b20 213d 2022  _keys and k != "
-00005b40: 7061 6765 7322 3a0a 2020 2020 2020 2020  pages":.        
-00005b50: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00005b60: 7365 6c66 2e64 6174 615b 6b5d 0a0a 2020  self.data[k]..  
-00005b70: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
-00005b80: 206c 6973 7428 6d65 7267 696e 675f 7265   list(merging_re
-00005b90: 636f 7264 2e64 6174 612e 6b65 7973 2829  cord.data.keys()
-00005ba0: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
-00005bb0: 616c 203d 2073 656c 662e 5f5f 6765 745f  al = self.__get_
-00005bc0: 6d65 7267 696e 675f 7661 6c28 6d65 7267  merging_val(merg
-00005bd0: 696e 675f 7265 636f 7264 3d6d 6572 6769  ing_record=mergi
-00005be0: 6e67 5f72 6563 6f72 642c 206b 6579 3d6b  ng_record, key=k
-00005bf0: 6579 290a 2020 2020 2020 2020 2020 2020  ey).            
-00005c00: 6966 2076 616c 203d 3d20 2222 3a0a 2020  if val == "":.  
-00005c10: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00005c20: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-00005c30: 2020 2020 6669 656c 645f 7072 6f76 656e      field_proven
-00005c40: 616e 6365 203d 206d 6572 6769 6e67 5f72  ance = merging_r
-00005c50: 6563 6f72 642e 6765 745f 6669 656c 645f  ecord.get_field_
-00005c60: 7072 6f76 656e 616e 6365 280a 2020 2020  provenance(.    
-00005c70: 2020 2020 2020 2020 2020 2020 6b65 793d              key=
-00005c80: 6b65 792c 2064 6566 6175 6c74 5f73 6f75  key, default_sou
-00005c90: 7263 653d 6465 6661 756c 745f 736f 7572  rce=default_sour
-00005ca0: 6365 0a20 2020 2020 2020 2020 2020 2029  ce.            )
-00005cb0: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
-00005cc0: 7263 6520 3d20 6669 656c 645f 7072 6f76  rce = field_prov
-00005cd0: 656e 616e 6365 5b22 736f 7572 6365 225d  enance["source"]
-00005ce0: 0a20 2020 2020 2020 2020 2020 206e 6f74  .            not
-00005cf0: 6520 3d20 6669 656c 645f 7072 6f76 656e  e = field_proven
-00005d00: 616e 6365 5b22 6e6f 7465 225d 0a0a 2020  ance["note"]..  
-00005d10: 2020 2020 2020 2020 2020 2320 416c 7761            # Alwa
-00005d20: 7973 2075 7064 6174 6520 6672 6f6d 2063  ys update from c
-00005d30: 7572 6174 6564 206d 6572 6769 6e67 5f72  urated merging_r
-00005d40: 6563 6f72 6473 0a20 2020 2020 2020 2020  ecords.         
-00005d50: 2020 2069 6620 6d65 7267 696e 675f 7265     if merging_re
-00005d60: 636f 7264 2e6d 6173 7465 7264 6174 615f  cord.masterdata_
-00005d70: 6973 5f63 7572 6174 6564 2829 3a0a 2020  is_curated():.  
-00005d80: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00005d90: 6c66 2e64 6174 615b 6b65 795d 203d 206d  lf.data[key] = m
-00005da0: 6572 6769 6e67 5f72 6563 6f72 642e 6461  erging_record.da
-00005db0: 7461 5b6b 6579 5d0a 2020 2020 2020 2020  ta[key].        
-00005dc0: 2020 2020 2020 2020 6966 206b 6579 206e          if key n
-00005dd0: 6f74 2069 6e20 5265 636f 7264 2e69 6465  ot in Record.ide
-00005de0: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
-00005df0: 6579 7320 2b20 5b22 454e 5452 5954 5950  eys + ["ENTRYTYP
-00005e00: 4522 5d3a 0a20 2020 2020 2020 2020 2020  E"]:.           
-00005e10: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
-00005e20: 645f 6461 7461 5f70 726f 7665 6e61 6e63  d_data_provenanc
-00005e30: 6528 6b65 793d 6b65 792c 2073 6f75 7263  e(key=key, sourc
-00005e40: 653d 736f 7572 6365 2c20 6e6f 7465 3d6e  e=source, note=n
-00005e50: 6f74 6529 0a0a 2020 2020 2020 2020 2020  ote)..          
-00005e60: 2020 2320 446f 206e 6f74 2063 6861 6e67    # Do not chang
-00005e70: 6520 6966 204d 4552 4749 4e47 5f52 4543  e if MERGING_REC
-00005e80: 4f52 4420 6973 206e 6f74 2063 7572 6174  ORD is not curat
-00005e90: 6564 0a20 2020 2020 2020 2020 2020 2065  ed.            e
-00005ea0: 6c69 6620 280a 2020 2020 2020 2020 2020  lif (.          
-00005eb0: 2020 2020 2020 7365 6c66 2e6d 6173 7465        self.maste
+00002cd0: 2020 2020 2073 6f75 7263 6520 3d20 280a       source = (.
+00002ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002cf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002d00: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
+00002d10: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
+00002d20: 6e63 6522 5d5b 6b65 795d 5b22 736f 7572  nce"][key]["sour
+00002d30: 6365 225d 0a20 2020 2020 2020 2020 2020  ce"].           
+00002d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d50: 202b 2022 7c22 0a20 2020 2020 2020 2020   + "|".         
+00002d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d70: 2020 202b 2073 6f75 7263 650a 2020 2020     + source.    
+00002d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d90: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00002da0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00002db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002dc0: 2020 2020 2020 2020 736f 7572 6365 203d          source =
+00002dd0: 2022 6f72 6967 696e 616c 7c22 202b 2073   "original|" + s
+00002de0: 6f75 7263 650a 2020 2020 2020 2020 2020  ource.          
+00002df0: 2020 2020 2020 7365 6c66 2e61 6464 5f6d        self.add_m
+00002e00: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+00002e10: 616e 6365 286b 6579 3d6b 6579 2c20 736f  ance(key=key, so
+00002e20: 7572 6365 3d73 6f75 7263 652c 206e 6f74  urce=source, not
+00002e30: 653d 6e6f 7465 290a 2020 2020 2020 2020  e=note).        
+00002e40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00002e50: 2020 6966 2061 7070 656e 645f 6564 6974    if append_edit
+00002e60: 2061 6e64 206b 6579 2069 6e20 7365 6c66   and key in self
+00002e70: 2e64 6174 613a 0a20 2020 2020 2020 2020  .data:.         
+00002e80: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+00002e90: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
+00002ea0: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+00002eb0: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
+00002ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ed0: 2020 736f 7572 6365 203d 2028 0a20 2020    source = (.   
+00002ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ef0: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
+00002f00: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+00002f10: 656e 616e 6365 225d 5b6b 6579 5d5b 2273  enance"][key]["s
+00002f20: 6f75 7263 6522 5d0a 2020 2020 2020 2020  ource"].        
+00002f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f40: 2b20 227c 220a 2020 2020 2020 2020 2020  + "|".          
+00002f50: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00002f60: 736f 7572 6365 0a20 2020 2020 2020 2020  source.         
+00002f70: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00002f80: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00002f90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00002fa0: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
+00002fb0: 226f 7269 6769 6e61 6c7c 2220 2b20 736f  "original|" + so
+00002fc0: 7572 6365 0a20 2020 2020 2020 2020 2020  urce.           
+00002fd0: 2073 656c 662e 6164 645f 6461 7461 5f70   self.add_data_p
+00002fe0: 726f 7665 6e61 6e63 6528 6b65 793d 6b65  rovenance(key=ke
+00002ff0: 792c 2073 6f75 7263 653d 736f 7572 6365  y, source=source
+00003000: 2c20 6e6f 7465 3d6e 6f74 6529 0a20 2020  , note=note).   
+00003010: 2020 2020 2073 656c 662e 6461 7461 5b6b       self.data[k
+00003020: 6579 5d20 3d20 7661 6c75 650a 0a20 2020  ey] = value..   
+00003030: 2064 6566 2072 656e 616d 655f 6669 656c   def rename_fiel
+00003040: 6428 7365 6c66 2c20 2a2c 206b 6579 3a20  d(self, *, key: 
+00003050: 7374 722c 206e 6577 5f6b 6579 3a20 7374  str, new_key: st
+00003060: 7229 202d 3e20 4e6f 6e65 3a0a 2020 2020  r) -> None:.    
+00003070: 2020 2020 2222 2252 656e 616d 6520 6120      """Rename a 
+00003080: 6669 656c 6422 2222 0a20 2020 2020 2020  field""".       
+00003090: 2076 616c 7565 203d 2073 656c 662e 6461   value = self.da
+000030a0: 7461 5b6b 6579 5d0a 2020 2020 2020 2020  ta[key].        
+000030b0: 7365 6c66 2e64 6174 615b 6e65 775f 6b65  self.data[new_ke
+000030c0: 795d 203d 2076 616c 7565 0a0a 2020 2020  y] = value..    
+000030d0: 2020 2020 6966 206b 6579 2069 6e20 7365      if key in se
+000030e0: 6c66 2e69 6465 6e74 6966 7969 6e67 5f66  lf.identifying_f
+000030f0: 6965 6c64 5f6b 6579 733a 0a20 2020 2020  ield_keys:.     
+00003100: 2020 2020 2020 2076 616c 7565 5f70 726f         value_pro
+00003110: 7665 6e61 6e63 6520 3d20 7365 6c66 2e64  venance = self.d
+00003120: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+00003130: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00003140: 6522 5d5b 6b65 795d 0a20 2020 2020 2020  e"][key].       
+00003150: 2020 2020 2069 6620 2273 6f75 7263 6522       if "source"
+00003160: 2069 6e20 7661 6c75 655f 7072 6f76 656e   in value_proven
+00003170: 616e 6365 3a0a 2020 2020 2020 2020 2020  ance:.          
+00003180: 2020 2020 2020 7661 6c75 655f 7072 6f76        value_prov
+00003190: 656e 616e 6365 5b22 736f 7572 6365 225d  enance["source"]
+000031a0: 202b 3d20 6622 7c72 656e 616d 652d 6672   += f"|rename-fr
+000031b0: 6f6d 3a7b 6b65 797d 220a 2020 2020 2020  om:{key}".      
+000031c0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+000031d0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+000031e0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
+000031f0: 6e65 775f 6b65 795d 203d 2076 616c 7565  new_key] = value
+00003200: 5f70 726f 7665 6e61 6e63 650a 2020 2020  _provenance.    
+00003210: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00003220: 2020 2020 2020 6966 2022 636f 6c72 6576        if "colrev
+00003230: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
+00003240: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+00003250: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00003260: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
+00003270: 6f6c 7265 765f 6461 7461 5f70 726f 7665  olrev_data_prove
+00003280: 6e61 6e63 6522 5d20 3d20 7b7d 0a20 2020  nance"] = {}.   
+00003290: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
+000032a0: 696e 2073 656c 662e 6461 7461 5b22 636f  in self.data["co
+000032b0: 6c72 6576 5f64 6174 615f 7072 6f76 656e  lrev_data_proven
+000032c0: 616e 6365 225d 3a0a 2020 2020 2020 2020  ance"]:.        
+000032d0: 2020 2020 2020 2020 7661 6c75 655f 7072          value_pr
+000032e0: 6f76 656e 616e 6365 203d 2073 656c 662e  ovenance = self.
+000032f0: 6461 7461 5b22 636f 6c72 6576 5f64 6174  data["colrev_dat
+00003300: 615f 7072 6f76 656e 616e 6365 225d 5b6b  a_provenance"][k
+00003310: 6579 5d0a 2020 2020 2020 2020 2020 2020  ey].            
+00003320: 2020 2020 6966 2022 736f 7572 6365 2220      if "source" 
+00003330: 696e 2076 616c 7565 5f70 726f 7665 6e61  in value_provena
+00003340: 6e63 653a 0a20 2020 2020 2020 2020 2020  nce:.           
+00003350: 2020 2020 2020 2020 2076 616c 7565 5f70           value_p
+00003360: 726f 7665 6e61 6e63 655b 2273 6f75 7263  rovenance["sourc
+00003370: 6522 5d20 2b3d 2066 227c 7265 6e61 6d65  e"] += f"|rename
+00003380: 2d66 726f 6d3a 7b6b 6579 7d22 0a20 2020  -from:{key}".   
+00003390: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000033a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000033b0: 616c 7565 5f70 726f 7665 6e61 6e63 6520  alue_provenance 
+000033c0: 3d20 7b22 736f 7572 6365 223a 2066 227c  = {"source": f"|
+000033d0: 7265 6e61 6d65 2d66 726f 6d3a 7b6b 6579  rename-from:{key
+000033e0: 7d22 2c20 226e 6f74 6522 3a20 2222 7d0a  }", "note": ""}.
+000033f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003400: 2e64 6174 615b 2263 6f6c 7265 765f 6461  .data["colrev_da
+00003410: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
+00003420: 6e65 775f 6b65 795d 203d 2076 616c 7565  new_key] = value
+00003430: 5f70 726f 7665 6e61 6e63 650a 0a20 2020  _provenance..   
+00003440: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
+00003450: 5f66 6965 6c64 286b 6579 3d6b 6579 290a  _field(key=key).
+00003460: 0a20 2020 2064 6566 2063 6861 6e67 655f  .    def change_
+00003470: 656e 7472 7974 7970 6528 0a20 2020 2020  entrytype(.     
+00003480: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00003490: 202a 2c0a 2020 2020 2020 2020 6e65 775f   *,.        new_
+000034a0: 656e 7472 7974 7970 653a 2073 7472 2c0a  entrytype: str,.
+000034b0: 2020 2020 2020 2020 716d 3a20 636f 6c72          qm: colr
+000034c0: 6576 2e71 6d2e 7175 616c 6974 795f 6d6f  ev.qm.quality_mo
+000034d0: 6465 6c2e 5175 616c 6974 794d 6f64 656c  del.QualityModel
+000034e0: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
+000034f0: 0a20 2020 2020 2020 2022 2222 4368 616e  .        """Chan
+00003500: 6765 2074 6865 2045 4e54 5259 5459 5045  ge the ENTRYTYPE
+00003510: 2222 220a 2020 2020 2020 2020 666f 7220  """.        for 
+00003520: 7661 6c75 6520 696e 2073 656c 662e 6461  value in self.da
+00003530: 7461 2e67 6574 2822 636f 6c72 6576 5f6d  ta.get("colrev_m
+00003540: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+00003550: 616e 6365 222c 207b 7d29 2e76 616c 7565  ance", {}).value
+00003560: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00003570: 2069 6620 2269 6e63 6f6e 7369 7374 656e   if "inconsisten
+00003580: 742d 7769 7468 2d65 6e74 7279 7479 7065  t-with-entrytype
+00003590: 2220 696e 2076 616c 7565 5b22 6e6f 7465  " in value["note
+000035a0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+000035b0: 2020 2020 7661 6c75 655b 226e 6f74 6522      value["note"
+000035c0: 5d20 3d20 2222 0a20 2020 2020 2020 2020  ] = "".         
+000035d0: 2020 2069 6620 226d 6973 7369 6e67 2220     if "missing" 
+000035e0: 696e 2076 616c 7565 5b22 6e6f 7465 225d  in value["note"]
+000035f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003600: 2020 7661 6c75 655b 226e 6f74 6522 5d20    value["note"] 
+00003610: 3d20 2222 0a20 2020 2020 2020 206d 6973  = "".        mis
+00003620: 7369 6e67 5f66 6965 6c64 7320 3d20 5b6b  sing_fields = [k
+00003630: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
+00003640: 662e 6461 7461 2e69 7465 6d73 2829 2069  f.data.items() i
+00003650: 6620 7620 3d3d 2022 554e 4b4e 4f57 4e22  f v == "UNKNOWN"
+00003660: 5d0a 2020 2020 2020 2020 666f 7220 6d69  ].        for mi
+00003670: 7373 696e 675f 6669 656c 6420 696e 206d  ssing_field in m
+00003680: 6973 7369 6e67 5f66 6965 6c64 733a 0a20  issing_fields:. 
+00003690: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000036a0: 7265 6d6f 7665 5f66 6965 6c64 286b 6579  remove_field(key
+000036b0: 3d6d 6973 7369 6e67 5f66 6965 6c64 290a  =missing_field).
+000036c0: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
+000036d0: 7461 5b22 454e 5452 5954 5950 4522 5d20  ta["ENTRYTYPE"] 
+000036e0: 3d20 6e65 775f 656e 7472 7974 7970 650a  = new_entrytype.
+000036f0: 2020 2020 2020 2020 6966 206e 6577 5f65          if new_e
+00003700: 6e74 7279 7479 7065 2069 6e20 5b22 696e  ntrytype in ["in
+00003710: 7072 6f63 6565 6469 6e67 7322 2c20 2270  proceedings", "p
+00003720: 726f 6365 6564 696e 6773 225d 3a0a 2020  roceedings"]:.  
+00003730: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00003740: 662e 6461 7461 2e67 6574 2822 766f 6c75  f.data.get("volu
+00003750: 6d65 222c 2022 2229 203d 3d20 2255 4e4b  me", "") == "UNK
+00003760: 4e4f 574e 223a 0a20 2020 2020 2020 2020  NOWN":.         
+00003770: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
+00003780: 7665 5f66 6965 6c64 286b 6579 3d22 766f  ve_field(key="vo
+00003790: 6c75 6d65 2229 0a20 2020 2020 2020 2020  lume").         
+000037a0: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
+000037b0: 6765 7428 226e 756d 6265 7222 2c20 2222  get("number", ""
+000037c0: 2920 3d3d 2022 554e 4b4e 4f57 4e22 3a0a  ) == "UNKNOWN":.
+000037d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037e0: 7365 6c66 2e72 656d 6f76 655f 6669 656c  self.remove_fiel
+000037f0: 6428 6b65 793d 226e 756d 6265 7222 290a  d(key="number").
+00003800: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+00003810: 6a6f 7572 6e61 6c22 2069 6e20 7365 6c66  journal" in self
+00003820: 2e64 6174 6120 616e 6420 2262 6f6f 6b74  .data and "bookt
+00003830: 6974 6c65 2220 6e6f 7420 696e 2073 656c  itle" not in sel
+00003840: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00003850: 2020 2020 2020 2020 7365 6c66 2e72 656e          self.ren
+00003860: 616d 655f 6669 656c 6428 6b65 793d 226a  ame_field(key="j
+00003870: 6f75 726e 616c 222c 206e 6577 5f6b 6579  ournal", new_key
+00003880: 3d22 626f 6f6b 7469 746c 6522 290a 2020  ="booktitle").  
+00003890: 2020 2020 2020 656c 6966 206e 6577 5f65        elif new_e
+000038a0: 6e74 7279 7479 7065 203d 3d20 2261 7274  ntrytype == "art
+000038b0: 6963 6c65 223a 0a20 2020 2020 2020 2020  icle":.         
+000038c0: 2020 2069 6620 2262 6f6f 6b74 6974 6c65     if "booktitle
+000038d0: 2220 696e 2073 656c 662e 6461 7461 3a0a  " in self.data:.
+000038e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038f0: 7365 6c66 2e72 656e 616d 655f 6669 656c  self.rename_fiel
+00003900: 6428 6b65 793d 2262 6f6f 6b74 6974 6c65  d(key="booktitle
+00003910: 222c 206e 6577 5f6b 6579 3d22 6a6f 7572  ", new_key="jour
+00003920: 6e61 6c22 290a 2020 2020 2020 2020 656c  nal").        el
+00003930: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00003940: 7261 6973 6520 636f 6c72 6576 5f65 7863  raise colrev_exc
+00003950: 6570 7469 6f6e 732e 4d69 7373 696e 6752  eptions.MissingR
+00003960: 6563 6f72 6451 7561 6c69 7479 5275 6c65  ecordQualityRule
+00003970: 5370 6563 6966 6963 6174 696f 6e28 0a20  Specification(. 
+00003980: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00003990: 224e 6f20 454e 5452 5954 5950 4520 7370  "No ENTRYTYPE sp
+000039a0: 6563 6966 6963 6174 696f 6e20 287b 6e65  ecification ({ne
+000039b0: 775f 656e 7472 7974 7970 657d 2922 0a20  w_entrytype})". 
+000039c0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000039d0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+000039e0: 655f 6d61 7374 6572 6461 7461 5f70 726f  e_masterdata_pro
+000039f0: 7665 6e61 6e63 6528 716d 3d71 6d29 0a0a  venance(qm=qm)..
+00003a00: 2020 2020 6465 6620 7265 6d6f 7665 5f66      def remove_f
+00003a10: 6965 6c64 280a 2020 2020 2020 2020 7365  ield(.        se
+00003a20: 6c66 2c20 2a2c 206b 6579 3a20 7374 722c  lf, *, key: str,
+00003a30: 206e 6f74 5f6d 6973 7369 6e67 5f6e 6f74   not_missing_not
+00003a40: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
+00003a50: 2073 6f75 7263 653a 2073 7472 203d 2022   source: str = "
+00003a60: 220a 2020 2020 2920 2d3e 204e 6f6e 653a  ".    ) -> None:
+00003a70: 0a20 2020 2020 2020 2022 2222 5265 6d6f  .        """Remo
+00003a80: 7665 2061 2066 6965 6c64 2222 220a 0a20  ve a field""".. 
+00003a90: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+00003aa0: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
+00003ab0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+00003ac0: 2e64 6174 615b 6b65 795d 0a0a 2020 2020  .data[key]..    
+00003ad0: 2020 2020 6966 2022 636f 6c72 6576 5f6d      if "colrev_m
+00003ae0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+00003af0: 616e 6365 2220 6e6f 7420 696e 2073 656c  ance" not in sel
+00003b00: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00003b10: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
+00003b20: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
+00003b30: 5f70 726f 7665 6e61 6e63 6522 5d20 3d20  _provenance"] = 
+00003b40: 7b7d 0a0a 2020 2020 2020 2020 6966 206e  {}..        if n
+00003b50: 6f74 5f6d 6973 7369 6e67 5f6e 6f74 6520  ot_missing_note 
+00003b60: 616e 6420 6b65 7920 696e 2073 656c 662e  and key in self.
+00003b70: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
+00003b80: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
+00003b90: 2020 2020 2320 4578 616d 706c 653a 206a      # Example: j
+00003ba0: 6f75 726e 616c 2077 6974 686f 7574 206e  ournal without n
+00003bb0: 756d 6265 720a 2020 2020 2020 2020 2020  umber.          
+00003bc0: 2020 2320 7765 2073 686f 756c 6420 6b65    # we should ke
+00003bd0: 6570 2074 6861 7420 696e 666f 726d 6174  ep that informat
+00003be0: 696f 6e20 7468 6174 2061 2070 6172 7469  ion that a parti
+00003bf0: 6375 6c61 7220 6d61 7374 6572 6461 7461  cular masterdata
+00003c00: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
+00003c10: 6965 6c64 2069 7320 6e6f 7420 7265 7175  ield is not requ
+00003c20: 6972 6564 0a20 2020 2020 2020 2020 2020  ired.           
+00003c30: 2069 6620 6b65 7920 6e6f 7420 696e 2073   if key not in s
+00003c40: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+00003c50: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00003c60: 656e 616e 6365 225d 3a0a 2020 2020 2020  enance"]:.      
+00003c70: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00003c80: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+00003c90: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00003ca0: 6522 5d5b 6b65 795d 203d 207b 7d0a 2020  e"][key] = {}.  
+00003cb0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00003cc0: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+00003cd0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00003ce0: 6522 5d5b 6b65 795d 5b22 6e6f 7465 225d  e"][key]["note"]
+00003cf0: 203d 2022 6e6f 742d 6d69 7373 696e 6722   = "not-missing"
+00003d00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003d10: 736f 7572 6365 2021 3d20 2222 3a0a 2020  source != "":.  
+00003d20: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003d30: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00003d40: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00003d50: 6e61 6e63 6522 5d5b 6b65 795d 5b22 736f  nance"][key]["so
+00003d60: 7572 6365 225d 203d 2073 6f75 7263 650a  urce"] = source.
+00003d70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00003d80: 2020 2020 2020 2020 2020 6966 206b 6579            if key
+00003d90: 2069 6e20 7365 6c66 2e69 6465 6e74 6966   in self.identif
+00003da0: 7969 6e67 5f66 6965 6c64 5f6b 6579 733a  ying_field_keys:
+00003db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003dc0: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
+00003dd0: 6461 7461 2e67 6574 2822 636f 6c72 6576  data.get("colrev
+00003de0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00003df0: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
+00003e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e10: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
+00003e20: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+00003e30: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
+00003e40: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
+00003e50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00003e60: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+00003e70: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
+00003e80: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+00003e90: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
+00003ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003eb0: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
+00003ec0: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
+00003ed0: 7665 6e61 6e63 6522 5d5b 6b65 795d 0a0a  venance"][key]..
+00003ee0: 2020 2020 6465 6620 7365 745f 6d61 7374      def set_mast
+00003ef0: 6572 6461 7461 5f63 6f6d 706c 6574 6528  erdata_complete(
+00003f00: 0a20 2020 2020 2020 2073 656c 662c 202a  .        self, *
+00003f10: 2c20 736f 7572 6365 3a20 7374 722c 206d  , source: str, m
+00003f20: 6173 7465 7264 6174 615f 7265 706f 7369  asterdata_reposi
+00003f30: 746f 7279 3a20 626f 6f6c 2c20 7265 706c  tory: bool, repl
+00003f40: 6163 655f 736f 7572 6365 3a20 626f 6f6c  ace_source: bool
+00003f50: 203d 2054 7275 650a 2020 2020 2920 2d3e   = True.    ) ->
+00003f60: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00003f70: 2222 5365 7420 7468 6520 6d61 7374 6572  ""Set the master
+00003f80: 6461 7461 2074 6f20 636f 6d70 6c65 7465  data to complete
+00003f90: 2222 220a 2020 2020 2020 2020 2320 7079  """.        # py
+00003fa0: 6c69 6e74 3a20 6469 7361 626c 653d 746f  lint: disable=to
+00003fb0: 6f2d 6d61 6e79 2d62 7261 6e63 6865 730a  o-many-branches.
+00003fc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003fd0: 6d61 7374 6572 6461 7461 5f69 735f 6375  masterdata_is_cu
+00003fe0: 7261 7465 6428 2920 6f72 206d 6173 7465  rated() or maste
+00003ff0: 7264 6174 615f 7265 706f 7369 746f 7279  rdata_repository
+00004000: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00004010: 7475 726e 0a0a 2020 2020 2020 2020 6966  turn..        if
+00004020: 2022 636f 6c72 6576 5f6d 6173 7465 7264   "colrev_masterd
+00004030: 6174 615f 7072 6f76 656e 616e 6365 2220  ata_provenance" 
+00004040: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
+00004050: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00004060: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00004070: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00004080: 6e61 6e63 6522 5d20 3d20 7b7d 0a20 2020  nance"] = {}.   
+00004090: 2020 2020 206d 645f 705f 6469 6374 203d       md_p_dict =
+000040a0: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+000040b0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+000040c0: 6f76 656e 616e 6365 225d 0a0a 2020 2020  ovenance"]..    
+000040d0: 2020 2020 666f 7220 6964 656e 7469 6679      for identify
+000040e0: 696e 675f 6669 656c 645f 6b65 7920 696e  ing_field_key in
+000040f0: 2073 656c 662e 6964 656e 7469 6679 696e   self.identifyin
+00004100: 675f 6669 656c 645f 6b65 7973 3a0a 2020  g_field_keys:.  
+00004110: 2020 2020 2020 2020 2020 6966 2069 6465            if ide
+00004120: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
+00004130: 6579 2069 6e20 5b22 6175 7468 6f72 222c  ey in ["author",
+00004140: 2022 7469 746c 6522 2c20 2279 6561 7222   "title", "year"
+00004150: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00004160: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00004170: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00004180: 6461 7461 2e67 6574 2869 6465 6e74 6966  data.get(identif
+00004190: 7969 6e67 5f66 6965 6c64 5f6b 6579 2c20  ying_field_key, 
+000041a0: 224e 4122 2920 3d3d 2022 554e 4b4e 4f57  "NA") == "UNKNOW
+000041b0: 4e22 3a0a 2020 2020 2020 2020 2020 2020  N":.            
+000041c0: 2020 2020 6465 6c20 7365 6c66 2e64 6174      del self.dat
+000041d0: 615b 6964 656e 7469 6679 696e 675f 6669  a[identifying_fi
+000041e0: 656c 645f 6b65 795d 0a20 2020 2020 2020  eld_key].       
+000041f0: 2020 2020 2069 6620 6964 656e 7469 6679       if identify
+00004200: 696e 675f 6669 656c 645f 6b65 7920 696e  ing_field_key in
+00004210: 206d 645f 705f 6469 6374 3a0a 2020 2020   md_p_dict:.    
+00004220: 2020 2020 2020 2020 2020 2020 6e6f 7465              note
+00004230: 203d 206d 645f 705f 6469 6374 5b69 6465   = md_p_dict[ide
+00004240: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
+00004250: 6579 5d5b 226e 6f74 6522 5d0a 2020 2020  ey]["note"].    
+00004260: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+00004270: 6d69 7373 696e 6722 2069 6e20 6e6f 7465  missing" in note
+00004280: 2061 6e64 2022 6e6f 742d 6d69 7373 696e   and "not-missin
+00004290: 6722 206e 6f74 2069 6e20 6e6f 7465 3a0a  g" not in note:.
+000042a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000042b0: 2020 2020 6d64 5f70 5f64 6963 745b 6964      md_p_dict[id
+000042c0: 656e 7469 6679 696e 675f 6669 656c 645f  entifying_field_
+000042d0: 6b65 795d 5b22 6e6f 7465 225d 203d 206e  key]["note"] = n
+000042e0: 6f74 652e 7265 706c 6163 6528 0a20 2020  ote.replace(.   
+000042f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004300: 2020 2020 2022 6d69 7373 696e 6722 2c20       "missing", 
+00004310: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
+00004320: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00004330: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
+00004340: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
+00004350: 6172 7469 636c 6522 3a0a 2020 2020 2020  article":.      
+00004360: 2020 2020 2020 6966 2022 766f 6c75 6d65        if "volume
+00004370: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+00004380: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00004390: 2020 2020 6966 2022 766f 6c75 6d65 2220      if "volume" 
+000043a0: 696e 2073 656c 662e 6461 7461 5b22 636f  in self.data["co
+000043b0: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
+000043c0: 7072 6f76 656e 616e 6365 225d 3a0a 2020  provenance"]:.  
+000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043e0: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+000043f0: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+00004400: 726f 7665 6e61 6e63 6522 5d5b 2276 6f6c  rovenance"]["vol
+00004410: 756d 6522 5d5b 0a20 2020 2020 2020 2020  ume"][.         
+00004420: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00004430: 6e6f 7465 220a 2020 2020 2020 2020 2020  note".          
+00004440: 2020 2020 2020 2020 2020 5d20 3d20 226e            ] = "n
+00004450: 6f74 2d6d 6973 7369 6e67 220a 2020 2020  ot-missing".    
+00004460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004470: 6966 2072 6570 6c61 6365 5f73 6f75 7263  if replace_sourc
+00004480: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004490: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000044a0: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+000044b0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+000044c0: 6365 225d 5b22 766f 6c75 6d65 225d 5b0a  ce"]["volume"][.
+000044d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044e0: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
+000044f0: 7263 6522 0a20 2020 2020 2020 2020 2020  rce".           
+00004500: 2020 2020 2020 2020 2020 2020 205d 203d               ] =
+00004510: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
+00004520: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00004530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004540: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+00004550: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+00004560: 726f 7665 6e61 6e63 6522 5d5b 2276 6f6c  rovenance"]["vol
+00004570: 756d 6522 5d20 3d20 7b0a 2020 2020 2020  ume"] = {.      
+00004580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004590: 2020 2273 6f75 7263 6522 3a20 736f 7572    "source": sour
+000045a0: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+000045b0: 2020 2020 2020 2020 2020 2020 226e 6f74              "not
+000045c0: 6522 3a20 226e 6f74 2d6d 6973 7369 6e67  e": "not-missing
+000045d0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+000045e0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+000045f0: 2020 2020 2020 6966 2022 6e75 6d62 6572        if "number
+00004600: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+00004610: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00004620: 2020 2020 6966 2022 6e75 6d62 6572 2220      if "number" 
+00004630: 696e 2073 656c 662e 6461 7461 5b22 636f  in self.data["co
+00004640: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
+00004650: 7072 6f76 656e 616e 6365 225d 3a0a 2020  provenance"]:.  
+00004660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004670: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+00004680: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+00004690: 726f 7665 6e61 6e63 6522 5d5b 226e 756d  rovenance"]["num
+000046a0: 6265 7222 5d5b 0a20 2020 2020 2020 2020  ber"][.         
+000046b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000046c0: 6e6f 7465 220a 2020 2020 2020 2020 2020  note".          
+000046d0: 2020 2020 2020 2020 2020 5d20 3d20 226e            ] = "n
+000046e0: 6f74 2d6d 6973 7369 6e67 220a 2020 2020  ot-missing".    
+000046f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004700: 6966 2072 6570 6c61 6365 5f73 6f75 7263  if replace_sourc
+00004710: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004720: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004730: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+00004740: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+00004750: 6365 225d 5b22 6e75 6d62 6572 225d 5b0a  ce"]["number"][.
+00004760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004770: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
+00004780: 7263 6522 0a20 2020 2020 2020 2020 2020  rce".           
+00004790: 2020 2020 2020 2020 2020 2020 205d 203d               ] =
+000047a0: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
+000047b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000047c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000047d0: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+000047e0: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+000047f0: 726f 7665 6e61 6e63 6522 5d5b 226e 756d  rovenance"]["num
+00004800: 6265 7222 5d20 3d20 7b0a 2020 2020 2020  ber"] = {.      
+00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004820: 2020 2273 6f75 7263 6522 3a20 736f 7572    "source": sour
+00004830: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+00004840: 2020 2020 2020 2020 2020 2020 226e 6f74              "not
+00004850: 6522 3a20 226e 6f74 2d6d 6973 7369 6e67  e": "not-missing
+00004860: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00004870: 2020 2020 2020 207d 0a0a 2020 2020 6465         }..    de
+00004880: 6620 7365 745f 6d61 7374 6572 6461 7461  f set_masterdata
+00004890: 5f63 6f6e 7369 7374 656e 7428 7365 6c66  _consistent(self
+000048a0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000048b0: 2020 2022 2222 5365 7420 7468 6520 6d61     """Set the ma
+000048c0: 7374 6572 6461 7461 2074 6f20 636f 6e73  sterdata to cons
+000048d0: 6973 7465 6e74 2222 220a 2020 2020 2020  istent""".      
+000048e0: 2020 6966 2022 636f 6c72 6576 5f6d 6173    if "colrev_mas
+000048f0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+00004900: 6365 2220 6e6f 7420 696e 2073 656c 662e  ce" not in self.
+00004910: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00004920: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+00004930: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+00004940: 726f 7665 6e61 6e63 6522 5d20 3d20 7b7d  rovenance"] = {}
+00004950: 0a20 2020 2020 2020 206d 645f 705f 6469  .        md_p_di
+00004960: 6374 203d 2073 656c 662e 6461 7461 5b22  ct = self.data["
+00004970: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
+00004980: 615f 7072 6f76 656e 616e 6365 225d 0a0a  a_provenance"]..
+00004990: 2020 2020 2020 2020 666f 7220 6964 656e          for iden
+000049a0: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
+000049b0: 7920 696e 2073 656c 662e 6964 656e 7469  y in self.identi
+000049c0: 6679 696e 675f 6669 656c 645f 6b65 7973  fying_field_keys
+000049d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000049e0: 2069 6465 6e74 6966 7969 6e67 5f66 6965   identifying_fie
+000049f0: 6c64 5f6b 6579 2069 6e20 6d64 5f70 5f64  ld_key in md_p_d
+00004a00: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
+00004a10: 2020 2020 206e 6f74 6520 3d20 6d64 5f70       note = md_p
+00004a20: 5f64 6963 745b 6964 656e 7469 6679 696e  _dict[identifyin
+00004a30: 675f 6669 656c 645f 6b65 795d 5b22 6e6f  g_field_key]["no
+00004a40: 7465 225d 0a20 2020 2020 2020 2020 2020  te"].           
+00004a50: 2020 2020 2069 6620 2269 6e63 6f6e 7369       if "inconsi
+00004a60: 7374 656e 742d 7769 7468 2d65 6e74 7279  stent-with-entry
+00004a70: 7479 7065 2220 696e 206e 6f74 653a 0a20  type" in note:. 
+00004a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a90: 2020 206d 645f 705f 6469 6374 5b69 6465     md_p_dict[ide
+00004aa0: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
+00004ab0: 6579 5d5b 226e 6f74 6522 5d20 3d20 6e6f  ey]["note"] = no
+00004ac0: 7465 2e72 6570 6c61 6365 280a 2020 2020  te.replace(.    
+00004ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ae0: 2020 2020 2269 6e63 6f6e 7369 7374 656e      "inconsisten
+00004af0: 742d 7769 7468 2d65 6e74 7279 7479 7065  t-with-entrytype
+00004b00: 222c 2022 220a 2020 2020 2020 2020 2020  ", "".          
+00004b10: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00004b20: 2064 6566 2072 6573 6574 5f70 6466 5f70   def reset_pdf_p
+00004b30: 726f 7665 6e61 6e63 655f 6e6f 7465 7328  rovenance_notes(
+00004b40: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00004b50: 2020 2020 2020 2022 2222 5265 7365 7420         """Reset 
+00004b60: 7468 6520 5044 4620 2866 696c 6529 2070  the PDF (file) p
+00004b70: 726f 7665 6e61 6e63 6520 6e6f 7465 7322  rovenance notes"
+00004b80: 2222 0a20 2020 2020 2020 2069 6620 2263  "".        if "c
+00004b90: 6f6c 7265 765f 6461 7461 5f70 726f 7665  olrev_data_prove
+00004ba0: 6e61 6e63 6522 206e 6f74 2069 6e20 7365  nance" not in se
+00004bb0: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
+00004bc0: 2020 2020 2073 656c 662e 6164 645f 6461       self.add_da
+00004bd0: 7461 5f70 726f 7665 6e61 6e63 655f 6e6f  ta_provenance_no
+00004be0: 7465 286b 6579 3d22 6669 6c65 222c 206e  te(key="file", n
+00004bf0: 6f74 653d 2222 290a 2020 2020 2020 2020  ote="").        
+00004c00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00004c10: 2020 6966 2022 6669 6c65 2220 696e 2073    if "file" in s
+00004c20: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+00004c30: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
+00004c40: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+00004c50: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
+00004c60: 6f6c 7265 765f 6461 7461 5f70 726f 7665  olrev_data_prove
+00004c70: 6e61 6e63 6522 5d5b 2266 696c 6522 5d5b  nance"]["file"][
+00004c80: 226e 6f74 6522 5d20 3d20 2222 0a20 2020  "note"] = "".   
+00004c90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00004ca0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004cb0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+00004cc0: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
+00004cd0: 225d 5b22 6669 6c65 225d 203d 207b 0a20  "]["file"] = {. 
+00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cf0: 2020 2022 736f 7572 6365 223a 2022 4e41     "source": "NA
+00004d00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00004d10: 2020 2020 2020 2022 6e6f 7465 223a 2022         "note": "
+00004d20: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00004d30: 2020 207d 0a0a 2020 2020 6465 6620 5f5f     }..    def __
+00004d40: 6d65 7267 655f 6f72 6967 696e 7328 7365  merge_origins(se
+00004d50: 6c66 2c20 2a2c 206d 6572 6769 6e67 5f72  lf, *, merging_r
+00004d60: 6563 6f72 643a 2052 6563 6f72 6429 202d  ecord: Record) -
+00004d70: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00004d80: 2222 224d 6572 6765 2074 6865 206f 7269  """Merge the ori
+00004d90: 6769 6e73 2077 6974 6820 7468 6f73 6520  gins with those 
+00004da0: 6f66 2074 6865 206d 6572 6769 6e67 5f72  of the merging_r
+00004db0: 6563 6f72 6422 2222 0a0a 2020 2020 2020  ecord"""..      
+00004dc0: 2020 6966 2022 636f 6c72 6576 5f6f 7269    if "colrev_ori
+00004dd0: 6769 6e22 2069 6e20 6d65 7267 696e 675f  gin" in merging_
+00004de0: 7265 636f 7264 2e64 6174 613a 0a20 2020  record.data:.   
+00004df0: 2020 2020 2020 2020 206f 7269 6769 6e73           origins
+00004e00: 203d 2073 656c 662e 6461 7461 5b22 636f   = self.data["co
+00004e10: 6c72 6576 5f6f 7269 6769 6e22 5d20 2b20  lrev_origin"] + 
+00004e20: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+00004e30: 6174 615b 2263 6f6c 7265 765f 6f72 6967  ata["colrev_orig
+00004e40: 696e 225d 0a20 2020 2020 2020 2020 2020  in"].           
+00004e50: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+00004e60: 6576 5f6f 7269 6769 6e22 5d20 3d20 736f  ev_origin"] = so
+00004e70: 7274 6564 286c 6973 7428 7365 7428 6f72  rted(list(set(or
+00004e80: 6967 696e 7329 2929 0a0a 2020 2020 6465  igins)))..    de
+00004e90: 6620 5f5f 6d65 7267 655f 7374 6174 7573  f __merge_status
+00004ea0: 2873 656c 662c 202a 2c20 6d65 7267 696e  (self, *, mergin
+00004eb0: 675f 7265 636f 7264 3a20 5265 636f 7264  g_record: Record
+00004ec0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00004ed0: 2020 2022 2222 4d65 7267 6520 7468 6520     """Merge the 
+00004ee0: 7374 6174 7573 2077 6974 6820 7468 6520  status with the 
+00004ef0: 6d65 7267 696e 675f 7265 636f 7264 2222  merging_record""
+00004f00: 220a 0a20 2020 2020 2020 2069 6620 2263  "..        if "c
+00004f10: 6f6c 7265 765f 7374 6174 7573 2220 696e  olrev_status" in
+00004f20: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
+00004f30: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00004f40: 2020 2320 5365 7420 626f 7468 2073 7461    # Set both sta
+00004f50: 7475 7320 746f 2074 6865 206c 6174 7465  tus to the latte
+00004f60: 7220 696e 2074 6865 2073 7461 7465 206d  r in the state m
+00004f70: 6f64 656c 0a20 2020 2020 2020 2020 2020  odel.           
+00004f80: 2069 6620 7365 6c66 2e64 6174 615b 2263   if self.data["c
+00004f90: 6f6c 7265 765f 7374 6174 7573 225d 203c  olrev_status"] <
+00004fa0: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
+00004fb0: 6461 7461 5b22 636f 6c72 6576 5f73 7461  data["colrev_sta
+00004fc0: 7475 7322 5d3a 0a20 2020 2020 2020 2020  tus"]:.         
+00004fd0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+00004fe0: 7374 6174 7573 2874 6172 6765 745f 7374  status(target_st
+00004ff0: 6174 653d 6d65 7267 696e 675f 7265 636f  ate=merging_reco
+00005000: 7264 2e64 6174 615b 2263 6f6c 7265 765f  rd.data["colrev_
+00005010: 7374 6174 7573 225d 290a 2020 2020 2020  status"]).      
+00005020: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00005030: 2020 2020 2020 2020 2020 2020 6d65 7267              merg
+00005040: 696e 675f 7265 636f 7264 2e73 6574 5f73  ing_record.set_s
+00005050: 7461 7475 7328 7461 7267 6574 5f73 7461  tatus(target_sta
+00005060: 7465 3d73 656c 662e 6461 7461 5b22 636f  te=self.data["co
+00005070: 6c72 6576 5f73 7461 7475 7322 5d29 0a0a  lrev_status"])..
+00005080: 2020 2020 6465 6620 5f5f 6765 745f 6d65      def __get_me
+00005090: 7267 696e 675f 7661 6c28 7365 6c66 2c20  rging_val(self, 
+000050a0: 2a2c 206d 6572 6769 6e67 5f72 6563 6f72  *, merging_recor
+000050b0: 643a 2052 6563 6f72 642c 206b 6579 3a20  d: Record, key: 
+000050c0: 7374 7229 202d 3e20 7374 723a 0a20 2020  str) -> str:.   
+000050d0: 2020 2020 2076 616c 203d 206d 6572 6769       val = mergi
+000050e0: 6e67 5f72 6563 6f72 642e 6461 7461 2e67  ng_record.data.g
+000050f0: 6574 286b 6579 2c20 2222 290a 0a20 2020  et(key, "")..   
+00005100: 2020 2020 2069 6620 7661 6c20 3d3d 2022       if val == "
+00005110: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
+00005120: 6574 7572 6e20 2222 0a20 2020 2020 2020  eturn "".       
+00005130: 2069 6620 6e6f 7420 7661 6c3a 0a20 2020   if not val:.   
+00005140: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00005150: 2222 0a0a 2020 2020 2020 2020 2320 646f  ""..        # do
+00005160: 206e 6f74 206f 7665 7272 6964 6520 7072   not override pr
+00005170: 6f76 656e 616e 6365 2c20 4944 2c20 2e2e  ovenance, ID, ..
+00005180: 2e20 6669 656c 6473 0a20 2020 2020 2020  . fields.       
+00005190: 2069 6620 6b65 7920 696e 205b 0a20 2020   if key in [.   
+000051a0: 2020 2020 2020 2020 2022 4944 222c 0a20           "ID",. 
+000051b0: 2020 2020 2020 2020 2020 2022 636f 6c72             "colr
+000051c0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+000051d0: 6f76 656e 616e 6365 222c 0a20 2020 2020  ovenance",.     
+000051e0: 2020 2020 2020 2022 636f 6c72 6576 5f64         "colrev_d
+000051f0: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
+00005200: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
+00005210: 6c72 6576 5f69 6422 2c0a 2020 2020 2020  lrev_id",.      
+00005220: 2020 2020 2020 2263 6f6c 7265 765f 7374        "colrev_st
+00005230: 6174 7573 222c 0a20 2020 2020 2020 2020  atus",.         
+00005240: 2020 2022 636f 6c72 6576 5f6f 7269 6769     "colrev_origi
+00005250: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
+00005260: 224d 4f56 4544 5f44 5550 455f 4944 222c  "MOVED_DUPE_ID",
+00005270: 0a20 2020 2020 2020 205d 3a0a 2020 2020  .        ]:.    
+00005280: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+00005290: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+000052a0: 6e20 7661 6c0a 0a20 2020 2064 6566 205f  n val..    def _
+000052b0: 5f70 7265 7665 6e74 5f69 6e76 616c 6964  _prevent_invalid
+000052c0: 5f6d 6572 6765 7328 7365 6c66 2c20 2a2c  _merges(self, *,
+000052d0: 206d 6572 6769 6e67 5f72 6563 6f72 643a   merging_record:
+000052e0: 2052 6563 6f72 6429 202d 3e20 4e6f 6e65   Record) -> None
+000052f0: 3a0a 2020 2020 2020 2020 2222 2250 7265  :.        """Pre
+00005300: 7665 6e74 7320 696e 7661 6c69 6420 6d65  vents invalid me
+00005310: 7267 6573 206c 696b 6520 2e2e 2e20 7061  rges like ... pa
+00005320: 7274 2031 202f 202e 2e2e 2070 6172 7420  rt 1 / ... part 
+00005330: 3222 2222 0a0a 2020 2020 2020 2020 6c6f  2"""..        lo
+00005340: 7765 725f 7469 746c 655f 6120 3d20 7365  wer_title_a = se
+00005350: 6c66 2e64 6174 612e 6765 7428 2274 6974  lf.data.get("tit
+00005360: 6c65 222c 2022 2229 2e6c 6f77 6572 2829  le", "").lower()
+00005370: 0a20 2020 2020 2020 206c 6f77 6572 5f74  .        lower_t
+00005380: 6974 6c65 5f62 203d 206d 6572 6769 6e67  itle_b = merging
+00005390: 5f72 6563 6f72 642e 6461 7461 2e67 6574  _record.data.get
+000053a0: 2822 7469 746c 6522 2c20 2222 292e 6c6f  ("title", "").lo
+000053b0: 7765 7228 290a 0a20 2020 2020 2020 2070  wer()..        p
+000053c0: 6172 745f 6d61 7463 685f 6120 3d20 7265  art_match_a = re
+000053d0: 2e66 696e 6461 6c6c 2872 2270 6172 7420  .findall(r"part 
+000053e0: 5b41 2d5a 612d 7a30 2d39 5d2b 2422 2c20  [A-Za-z0-9]+$", 
+000053f0: 6c6f 7765 725f 7469 746c 655f 6129 0a20  lower_title_a). 
+00005400: 2020 2020 2020 2070 6172 745f 6d61 7463         part_matc
+00005410: 685f 6220 3d20 7265 2e66 696e 6461 6c6c  h_b = re.findall
+00005420: 2872 2270 6172 7420 5b41 2d5a 612d 7a30  (r"part [A-Za-z0
+00005430: 2d39 5d2b 2422 2c20 6c6f 7765 725f 7469  -9]+$", lower_ti
+00005440: 746c 655f 6229 0a0a 2020 2020 2020 2020  tle_b)..        
+00005450: 6966 2070 6172 745f 6d61 7463 685f 6120  if part_match_a 
+00005460: 213d 2070 6172 745f 6d61 7463 685f 623a  != part_match_b:
+00005470: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00005480: 7365 2063 6f6c 7265 765f 6578 6365 7074  se colrev_except
+00005490: 696f 6e73 2e49 6e76 616c 6964 4d65 7267  ions.InvalidMerg
+000054a0: 6528 7265 636f 7264 5f61 3d73 656c 662c  e(record_a=self,
+000054b0: 2072 6563 6f72 645f 623d 6d65 7267 696e   record_b=mergin
+000054c0: 675f 7265 636f 7264 290a 0a20 2020 2020  g_record)..     
+000054d0: 2020 2074 6572 6d73 5f72 6571 7569 7265     terms_require
+000054e0: 645f 746f 5f6d 6174 6368 203d 205b 0a20  d_to_match = [. 
+000054f0: 2020 2020 2020 2020 2020 2022 6572 7261             "erra
+00005500: 7475 6d22 2c0a 2020 2020 2020 2020 2020  tum",.          
+00005510: 2020 2263 6f72 7265 6374 696f 6e22 2c0a    "correction",.
+00005520: 2020 2020 2020 2020 2020 2020 2263 6f72              "cor
+00005530: 7269 6765 6e64 756d 222c 0a20 2020 2020  rigendum",.     
+00005540: 2020 2020 2020 2022 636f 6d6d 656e 7422         "comment"
+00005550: 2c0a 2020 2020 2020 2020 2020 2020 2263  ,.            "c
+00005560: 6f6d 6d65 6e74 6172 7922 2c0a 2020 2020  ommentary",.    
+00005570: 2020 2020 2020 2020 2272 6573 706f 6e73          "respons
+00005580: 6522 2c0a 2020 2020 2020 2020 5d0a 2020  e",.        ].  
+00005590: 2020 2020 2020 7465 726d 735f 696e 5f61        terms_in_a
+000055a0: 203d 205b 7420 666f 7220 7420 696e 2074   = [t for t in t
+000055b0: 6572 6d73 5f72 6571 7569 7265 645f 746f  erms_required_to
+000055c0: 5f6d 6174 6368 2069 6620 7420 696e 206c  _match if t in l
+000055d0: 6f77 6572 5f74 6974 6c65 5f61 5d0a 2020  ower_title_a].  
+000055e0: 2020 2020 2020 7465 726d 735f 696e 5f62        terms_in_b
+000055f0: 203d 205b 7420 666f 7220 7420 696e 2074   = [t for t in t
+00005600: 6572 6d73 5f72 6571 7569 7265 645f 746f  erms_required_to
+00005610: 5f6d 6174 6368 2069 6620 7420 696e 206c  _match if t in l
+00005620: 6f77 6572 5f74 6974 6c65 5f62 5d0a 0a20  ower_title_b].. 
+00005630: 2020 2020 2020 2069 6620 7465 726d 735f         if terms_
+00005640: 696e 5f61 2021 3d20 7465 726d 735f 696e  in_a != terms_in
+00005650: 5f62 3a0a 2020 2020 2020 2020 2020 2020  _b:.            
+00005660: 7261 6973 6520 636f 6c72 6576 5f65 7863  raise colrev_exc
+00005670: 6570 7469 6f6e 732e 496e 7661 6c69 644d  eptions.InvalidM
+00005680: 6572 6765 2872 6563 6f72 645f 613d 7365  erge(record_a=se
+00005690: 6c66 2c20 7265 636f 7264 5f62 3d6d 6572  lf, record_b=mer
+000056a0: 6769 6e67 5f72 6563 6f72 6429 0a0a 2020  ging_record)..  
+000056b0: 2020 6465 6620 6d65 7267 6528 0a20 2020    def merge(.   
+000056c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000056d0: 2020 202a 2c0a 2020 2020 2020 2020 6d65     *,.        me
+000056e0: 7267 696e 675f 7265 636f 7264 3a20 5265  rging_record: Re
+000056f0: 636f 7264 2c0a 2020 2020 2020 2020 6465  cord,.        de
+00005700: 6661 756c 745f 736f 7572 6365 3a20 7374  fault_source: st
+00005710: 722c 0a20 2020 2020 2020 2070 7265 6665  r,.        prefe
+00005720: 7272 6564 5f6d 6173 7465 7264 6174 615f  rred_masterdata_
+00005730: 736f 7572 6365 5f70 7265 6669 7865 733a  source_prefixes:
+00005740: 204f 7074 696f 6e61 6c5b 6c69 7374 5d20   Optional[list] 
+00005750: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+00005760: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00005770: 2222 4765 6e65 7261 6c2d 7075 7270 6f73  ""General-purpos
+00005780: 6520 7265 636f 7264 206d 6572 6769 6e67  e record merging
+00005790: 0a20 2020 2020 2020 2066 6f72 2070 7265  .        for pre
+000057a0: 7061 7261 7469 6f6e 2c20 6375 7261 7465  paration, curate
+000057b0: 642f 6e6f 6e2d 6375 7261 7465 6420 7265  d/non-curated re
+000057c0: 636f 7264 7320 616e 6420 7265 636f 7264  cords and record
+000057d0: 7320 7769 7468 206f 7269 6769 6e73 0a0a  s with origins..
+000057e0: 0a20 2020 2020 2020 2041 7070 6c79 2068  .        Apply h
+000057f0: 6575 7269 7374 6963 7320 746f 2063 7265  euristics to cre
+00005800: 6174 6520 6120 6675 7369 6f6e 206f 6620  ate a fusion of 
+00005810: 7468 6520 6265 7374 2066 6965 6c64 7320  the best fields 
+00005820: 6261 7365 6420 6f6e 0a20 2020 2020 2020  based on.       
+00005830: 2071 7561 6c69 7479 2068 6575 7269 7374   quality heurist
+00005840: 6963 7322 2222 0a0a 2020 2020 2020 2020  ics"""..        
+00005850: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
+00005860: 653d 746f 6f2d 6d61 6e79 2d62 7261 6e63  e=too-many-branc
+00005870: 6865 730a 0a20 2020 2020 2020 206d 6572  hes..        mer
+00005880: 6769 6e67 5f72 6563 6f72 645f 7072 6566  ging_record_pref
+00005890: 6572 7265 6420 3d20 4661 6c73 650a 2020  erred = False.  
+000058a0: 2020 2020 2020 6966 2070 7265 6665 7272        if preferr
+000058b0: 6564 5f6d 6173 7465 7264 6174 615f 736f  ed_masterdata_so
+000058c0: 7572 6365 5f70 7265 6669 7865 733a 0a20  urce_prefixes:. 
+000058d0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
+000058e0: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
+000058f0: 2020 2061 6e79 2870 7320 696e 206f 7269     any(ps in ori
+00005900: 6769 6e20 666f 7220 7073 2069 6e20 7072  gin for ps in pr
+00005910: 6566 6572 7265 645f 6d61 7374 6572 6461  eferred_masterda
+00005920: 7461 5f73 6f75 7263 655f 7072 6566 6978  ta_source_prefix
+00005930: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00005940: 2020 2020 666f 7220 6f72 6967 696e 2069      for origin i
+00005950: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
+00005960: 2e64 6174 615b 2263 6f6c 7265 765f 6f72  .data["colrev_or
+00005970: 6967 696e 225d 0a20 2020 2020 2020 2020  igin"].         
+00005980: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00005990: 2020 2020 2020 6d65 7267 696e 675f 7265        merging_re
+000059a0: 636f 7264 5f70 7265 6665 7272 6564 203d  cord_preferred =
+000059b0: 2054 7275 650a 0a20 2020 2020 2020 2073   True..        s
+000059c0: 656c 662e 5f5f 7072 6576 656e 745f 696e  elf.__prevent_in
+000059d0: 7661 6c69 645f 6d65 7267 6573 286d 6572  valid_merges(mer
+000059e0: 6769 6e67 5f72 6563 6f72 643d 6d65 7267  ging_record=merg
+000059f0: 696e 675f 7265 636f 7264 290a 2020 2020  ing_record).    
+00005a00: 2020 2020 7365 6c66 2e5f 5f6d 6572 6765      self.__merge
+00005a10: 5f6f 7269 6769 6e73 286d 6572 6769 6e67  _origins(merging
+00005a20: 5f72 6563 6f72 643d 6d65 7267 696e 675f  _record=merging_
+00005a30: 7265 636f 7264 290a 2020 2020 2020 2020  record).        
+00005a40: 7365 6c66 2e5f 5f6d 6572 6765 5f73 7461  self.__merge_sta
+00005a50: 7475 7328 6d65 7267 696e 675f 7265 636f  tus(merging_reco
+00005a60: 7264 3d6d 6572 6769 6e67 5f72 6563 6f72  rd=merging_recor
+00005a70: 6429 0a0a 2020 2020 2020 2020 6966 206e  d)..        if n
+00005a80: 6f74 2073 656c 662e 6d61 7374 6572 6461  ot self.masterda
+00005a90: 7461 5f69 735f 6375 7261 7465 6428 2920  ta_is_curated() 
+00005aa0: 616e 6420 6d65 7267 696e 675f 7265 636f  and merging_reco
+00005ab0: 7264 2e6d 6173 7465 7264 6174 615f 6973  rd.masterdata_is
+00005ac0: 5f63 7572 6174 6564 2829 3a0a 2020 2020  _curated():.    
+00005ad0: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00005ae0: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
+00005af0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+00005b00: 5d20 3d20 6d65 7267 696e 675f 7265 636f  ] = merging_reco
+00005b10: 7264 2e64 6174 615b 0a20 2020 2020 2020  rd.data[.       
+00005b20: 2020 2020 2020 2020 2022 636f 6c72 6576           "colrev
+00005b30: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00005b40: 656e 616e 6365 220a 2020 2020 2020 2020  enance".        
+00005b50: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+00005b60: 2020 2320 4e6f 7465 203a 2072 656d 6f76    # Note : remov
+00005b70: 6520 616c 6c20 6d61 7374 6572 6461 7461  e all masterdata
+00005b80: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
+00005b90: 2020 2020 2320 6265 6361 7573 6520 7468      # because th
+00005ba0: 6520 6375 7261 7465 6420 7265 636f 7264  e curated record
+00005bb0: 206d 6179 2068 6176 6520 6665 7765 7220   may have fewer 
+00005bc0: 6d61 7374 6572 6461 7461 2066 6965 6c64  masterdata field
+00005bd0: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
+00005be0: 616e 6420 7765 2069 7465 7261 7465 206f  and we iterate o
+00005bf0: 7665 7220 7468 6520 6375 7261 7465 6420  ver the curated 
+00005c00: 7265 636f 7264 2028 6d65 7267 696e 675f  record (merging_
+00005c10: 7265 636f 7264 2920 696e 2074 6865 206e  record) in the n
+00005c20: 6578 7420 7374 6570 0a20 2020 2020 2020  ext step.       
+00005c30: 2020 2020 2066 6f72 206b 2069 6e20 6c69       for k in li
+00005c40: 7374 2873 656c 662e 6461 7461 2e6b 6579  st(self.data.key
+00005c50: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
+00005c60: 2020 2020 2020 6966 206b 2069 6e20 5265        if k in Re
+00005c70: 636f 7264 2e69 6465 6e74 6966 7969 6e67  cord.identifying
+00005c80: 5f66 6965 6c64 5f6b 6579 7320 616e 6420  _field_keys and 
+00005c90: 6b20 213d 2022 7061 6765 7322 3a0a 2020  k != "pages":.  
+00005ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005cb0: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
+00005cc0: 6b5d 0a0a 2020 2020 2020 2020 666f 7220  k]..        for 
+00005cd0: 6b65 7920 696e 206c 6973 7428 6d65 7267  key in list(merg
+00005ce0: 696e 675f 7265 636f 7264 2e64 6174 612e  ing_record.data.
+00005cf0: 6b65 7973 2829 293a 0a20 2020 2020 2020  keys()):.       
+00005d00: 2020 2020 2076 616c 203d 2073 656c 662e       val = self.
+00005d10: 5f5f 6765 745f 6d65 7267 696e 675f 7661  __get_merging_va
+00005d20: 6c28 6d65 7267 696e 675f 7265 636f 7264  l(merging_record
+00005d30: 3d6d 6572 6769 6e67 5f72 6563 6f72 642c  =merging_record,
+00005d40: 206b 6579 3d6b 6579 290a 2020 2020 2020   key=key).      
+00005d50: 2020 2020 2020 6966 2076 616c 203d 3d20        if val == 
+00005d60: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+00005d70: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+00005d80: 2020 2020 2020 2020 2020 6669 656c 645f            field_
+00005d90: 7072 6f76 656e 616e 6365 203d 206d 6572  provenance = mer
+00005da0: 6769 6e67 5f72 6563 6f72 642e 6765 745f  ging_record.get_
+00005db0: 6669 656c 645f 7072 6f76 656e 616e 6365  field_provenance
+00005dc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005dd0: 2020 6b65 793d 6b65 792c 2064 6566 6175    key=key, defau
+00005de0: 6c74 5f73 6f75 7263 653d 6465 6661 756c  lt_source=defaul
+00005df0: 745f 736f 7572 6365 0a20 2020 2020 2020  t_source.       
+00005e00: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005e10: 2020 2073 6f75 7263 6520 3d20 6669 656c     source = fiel
+00005e20: 645f 7072 6f76 656e 616e 6365 5b22 736f  d_provenance["so
+00005e30: 7572 6365 225d 0a20 2020 2020 2020 2020  urce"].         
+00005e40: 2020 206e 6f74 6520 3d20 6669 656c 645f     note = field_
+00005e50: 7072 6f76 656e 616e 6365 5b22 6e6f 7465  provenance["note
+00005e60: 225d 0a0a 2020 2020 2020 2020 2020 2020  "]..            
+00005e70: 2320 416c 7761 7973 2075 7064 6174 6520  # Always update 
+00005e80: 6672 6f6d 2063 7572 6174 6564 206d 6572  from curated mer
+00005e90: 6769 6e67 5f72 6563 6f72 6473 0a20 2020  ging_records.   
+00005ea0: 2020 2020 2020 2020 2069 6620 6d65 7267           if merg
+00005eb0: 696e 675f 7265 636f 7264 2e6d 6173 7465  ing_record.maste
 00005ec0: 7264 6174 615f 6973 5f63 7572 6174 6564  rdata_is_curated
-00005ed0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00005ee0: 2020 2061 6e64 206e 6f74 206d 6572 6769     and not mergi
-00005ef0: 6e67 5f72 6563 6f72 642e 6d61 7374 6572  ng_record.master
-00005f00: 6461 7461 5f69 735f 6375 7261 7465 6428  data_is_curated(
-00005f10: 290a 2020 2020 2020 2020 2020 2020 293a  ).            ):
-00005f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005f30: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
-00005f40: 2020 2020 2020 2023 2050 6172 7420 313a         # Part 1:
-00005f50: 2069 6465 6e74 6966 7969 6e67 2066 6965   identifying fie
-00005f60: 6c64 730a 2020 2020 2020 2020 2020 2020  lds.            
-00005f70: 6966 206b 6579 2069 6e20 5265 636f 7264  if key in Record
-00005f80: 2e69 6465 6e74 6966 7969 6e67 5f66 6965  .identifying_fie
-00005f90: 6c64 5f6b 6579 733a 0a20 2020 2020 2020  ld_keys:.       
-00005fa0: 2020 2020 2020 2020 2069 6620 7072 6566           if pref
-00005fb0: 6572 7265 645f 6d61 7374 6572 6461 7461  erred_masterdata
-00005fc0: 5f73 6f75 7263 655f 7072 6566 6978 6573  _source_prefixes
-00005fd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005fe0: 2020 2020 2020 6966 206d 6572 6769 6e67        if merging
-00005ff0: 5f72 6563 6f72 645f 7072 6566 6572 7265  _record_preferre
-00006000: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00006010: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006020: 7570 6461 7465 5f66 6965 6c64 280a 2020  update_field(.  
-00006030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006040: 2020 2020 2020 2020 2020 6b65 793d 6b65            key=ke
-00006050: 792c 2076 616c 7565 3d73 7472 2876 616c  y, value=str(val
-00006060: 292c 2073 6f75 7263 653d 736f 7572 6365  ), source=source
-00006070: 2c20 6170 7065 6e64 5f65 6469 743d 4661  , append_edit=Fa
-00006080: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00006090: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-000060a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000060b0: 2046 7573 6520 6265 7374 2066 6965 6c64   Fuse best field
-000060c0: 7320 6966 206e 6f6e 6520 6973 2063 7572  s if none is cur
-000060d0: 6174 6564 0a20 2020 2020 2020 2020 2020  ated.           
-000060e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000060f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006100: 656c 662e 5f5f 6675 7365 5f62 6573 745f  elf.__fuse_best_
-00006110: 6669 656c 6428 0a20 2020 2020 2020 2020  field(.         
-00006120: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00006130: 6572 6769 6e67 5f72 6563 6f72 643d 6d65  erging_record=me
-00006140: 7267 696e 675f 7265 636f 7264 2c0a 2020  rging_record,.  
-00006150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006160: 2020 2020 2020 6b65 793d 6b65 792c 0a20        key=key,. 
-00006170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006180: 2020 2020 2020 2076 616c 3d73 7472 2876         val=str(v
-00006190: 616c 292c 0a20 2020 2020 2020 2020 2020  al),.           
-000061a0: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
-000061b0: 7263 653d 736f 7572 6365 2c0a 2020 2020  rce=source,.    
-000061c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061d0: 2020 2020 6e6f 7465 3d6e 6f74 652c 0a20      note=note,. 
+00005ed0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00005ee0: 2020 2020 7365 6c66 2e64 6174 615b 6b65      self.data[ke
+00005ef0: 795d 203d 206d 6572 6769 6e67 5f72 6563  y] = merging_rec
+00005f00: 6f72 642e 6461 7461 5b6b 6579 5d0a 2020  ord.data[key].  
+00005f10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00005f20: 206b 6579 206e 6f74 2069 6e20 5265 636f   key not in Reco
+00005f30: 7264 2e69 6465 6e74 6966 7969 6e67 5f66  rd.identifying_f
+00005f40: 6965 6c64 5f6b 6579 7320 2b20 5b22 454e  ield_keys + ["EN
+00005f50: 5452 5954 5950 4522 5d3a 0a20 2020 2020  TRYTYPE"]:.     
+00005f60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00005f70: 656c 662e 6164 645f 6461 7461 5f70 726f  elf.add_data_pro
+00005f80: 7665 6e61 6e63 6528 6b65 793d 6b65 792c  venance(key=key,
+00005f90: 2073 6f75 7263 653d 736f 7572 6365 2c20   source=source, 
+00005fa0: 6e6f 7465 3d6e 6f74 6529 0a0a 2020 2020  note=note)..    
+00005fb0: 2020 2020 2020 2020 2320 446f 206e 6f74          # Do not
+00005fc0: 2063 6861 6e67 6520 6966 204d 4552 4749   change if MERGI
+00005fd0: 4e47 5f52 4543 4f52 4420 6973 206e 6f74  NG_RECORD is not
+00005fe0: 2063 7572 6174 6564 0a20 2020 2020 2020   curated.       
+00005ff0: 2020 2020 2065 6c69 6620 280a 2020 2020       elif (.    
+00006000: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006010: 2e6d 6173 7465 7264 6174 615f 6973 5f63  .masterdata_is_c
+00006020: 7572 6174 6564 2829 0a20 2020 2020 2020  urated().       
+00006030: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
+00006040: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
+00006050: 6d61 7374 6572 6461 7461 5f69 735f 6375  masterdata_is_cu
+00006060: 7261 7465 6428 290a 2020 2020 2020 2020  rated().        
+00006070: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00006080: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00006090: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
+000060a0: 6172 7420 313a 2069 6465 6e74 6966 7969  art 1: identifyi
+000060b0: 6e67 2066 6965 6c64 730a 2020 2020 2020  ng fields.      
+000060c0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+000060d0: 5265 636f 7264 2e69 6465 6e74 6966 7969  Record.identifyi
+000060e0: 6e67 5f66 6965 6c64 5f6b 6579 733a 0a20  ng_field_keys:. 
+000060f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006100: 6620 7072 6566 6572 7265 645f 6d61 7374  f preferred_mast
+00006110: 6572 6461 7461 5f73 6f75 7263 655f 7072  erdata_source_pr
+00006120: 6566 6978 6573 3a0a 2020 2020 2020 2020  efixes:.        
+00006130: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00006140: 6572 6769 6e67 5f72 6563 6f72 645f 7072  erging_record_pr
+00006150: 6566 6572 7265 643a 0a20 2020 2020 2020  eferred:.       
+00006160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006170: 2073 656c 662e 7570 6461 7465 5f66 6965   self.update_fie
+00006180: 6c64 280a 2020 2020 2020 2020 2020 2020  ld(.            
+00006190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061a0: 6b65 793d 6b65 792c 2076 616c 7565 3d73  key=key, value=s
+000061b0: 7472 2876 616c 292c 2073 6f75 7263 653d  tr(val), source=
+000061c0: 736f 7572 6365 2c20 6170 7065 6e64 5f65  source, append_e
+000061d0: 6469 743d 4661 6c73 650a 2020 2020 2020  dit=False.      
 000061e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061f0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00006200: 2020 2320 5061 7274 2032 3a20 6f74 6865    # Part 2: othe
-00006210: 7220 6669 656c 6473 0a20 2020 2020 2020  r fields.       
-00006220: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00006230: 2020 2020 2020 2020 2020 2023 206b 6565             # kee
-00006240: 7020 6578 6973 7469 6e67 2076 616c 7565  p existing value
-00006250: 7320 7065 7220 6465 6661 756c 740a 2020  s per default.  
-00006260: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00006270: 6c66 2e75 7064 6174 655f 6669 656c 6428  lf.update_field(
-00006280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006290: 2020 2020 206b 6579 3d6b 6579 2c0a 2020       key=key,.  
-000062a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062b0: 2020 7661 6c75 653d 7374 7228 7661 6c29    value=str(val)
-000062c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000062d0: 2020 2020 2020 736f 7572 6365 3d73 6f75        source=sou
-000062e0: 7263 652c 0a20 2020 2020 2020 2020 2020  rce,.           
-000062f0: 2020 2020 2020 2020 206e 6f74 653d 6e6f           note=no
-00006300: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-00006310: 2020 2020 2020 2020 6b65 6570 5f73 6f75          keep_sou
-00006320: 7263 655f 6966 5f65 7175 616c 3d54 7275  rce_if_equal=Tru
-00006330: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00006340: 2020 2020 2020 2061 7070 656e 645f 6564         append_ed
-00006350: 6974 3d46 616c 7365 2c0a 2020 2020 2020  it=False,.      
-00006360: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00006370: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00006380: 2020 6465 6620 5f5f 7365 6c65 6374 5f62    def __select_b
-00006390: 6573 745f 6175 7468 6f72 280a 2020 2020  est_author(.    
-000063a0: 2020 2020 636c 732c 202a 2c20 7265 636f      cls, *, reco
-000063b0: 7264 3a20 5265 636f 7264 2c20 6d65 7267  rd: Record, merg
-000063c0: 696e 675f 7265 636f 7264 3a20 5265 636f  ing_record: Reco
-000063d0: 7264 2c20 7072 6566 6572 7265 645f 736f  rd, preferred_so
-000063e0: 7572 6365 733a 206c 6973 740a 2020 2020  urces: list.    
-000063f0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-00006400: 2020 2320 7079 6c69 6e74 3a20 6469 7361    # pylint: disa
-00006410: 626c 653d 746f 6f2d 6d61 6e79 2d72 6574  ble=too-many-ret
-00006420: 7572 6e2d 7374 6174 656d 656e 7473 0a20  urn-statements. 
-00006430: 2020 2020 2020 2069 6620 2263 6f6c 7265         if "colre
-00006440: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
-00006450: 7665 6e61 6e63 6522 206e 6f74 2069 6e20  venance" not in 
-00006460: 7265 636f 7264 2e64 6174 613a 0a20 2020  record.data:.   
-00006470: 2020 2020 2020 2020 2072 6563 6f72 642e           record.
-00006480: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-00006490: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-000064a0: 6365 225d 203d 207b 7d0a 2020 2020 2020  ce"] = {}.      
-000064b0: 2020 7265 636f 7264 5f61 5f70 726f 7620    record_a_prov 
-000064c0: 3d20 7265 636f 7264 2e64 6174 615b 2263  = record.data["c
-000064d0: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-000064e0: 5f70 726f 7665 6e61 6e63 6522 5d0a 0a20  _provenance"].. 
-000064f0: 2020 2020 2020 2069 6620 2263 6f6c 7265         if "colre
-00006500: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
-00006510: 7665 6e61 6e63 6522 206e 6f74 2069 6e20  venance" not in 
-00006520: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
-00006530: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-00006540: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
-00006550: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-00006560: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00006570: 6365 225d 203d 207b 7d0a 2020 2020 2020  ce"] = {}.      
-00006580: 2020 6d65 7267 696e 675f 7265 636f 7264    merging_record
-00006590: 5f61 5f70 726f 7620 3d20 6d65 7267 696e  _a_prov = mergin
-000065a0: 675f 7265 636f 7264 2e64 6174 615b 2263  g_record.data["c
-000065b0: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-000065c0: 5f70 726f 7665 6e61 6e63 6522 5d0a 0a20  _provenance"].. 
-000065d0: 2020 2020 2020 2069 6620 2261 7574 686f         if "autho
-000065e0: 7222 2069 6e20 7265 636f 7264 5f61 5f70  r" in record_a_p
-000065f0: 726f 7620 616e 6420 2261 7574 686f 7222  rov and "author"
-00006600: 206e 6f74 2069 6e20 6d65 7267 696e 675f   not in merging_
-00006610: 7265 636f 7264 5f61 5f70 726f 763a 0a20  record_a_prov:. 
-00006620: 2020 2020 2020 2020 2020 2023 2050 7265             # Pre
-00006630: 6665 7220 6e6f 6e2d 6465 6665 6374 2076  fer non-defect v
-00006640: 6572 7369 6f6e 0a20 2020 2020 2020 2020  ersion.         
-00006650: 2020 2069 6620 2271 7561 6c69 7479 5f64     if "quality_d
-00006660: 6566 6563 7422 2069 6e20 7265 636f 7264  efect" in record
-00006670: 5f61 5f70 726f 765b 2261 7574 686f 7222  _a_prov["author"
-00006680: 5d2e 6765 7428 226e 6f74 6522 2c20 2222  ].get("note", ""
-00006690: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000066a0: 2020 2072 6574 7572 6e20 6d65 7267 696e     return mergin
-000066b0: 675f 7265 636f 7264 2e64 6174 615b 2261  g_record.data["a
-000066c0: 7574 686f 7222 5d0a 2020 2020 2020 2020  uthor"].        
-000066d0: 2020 2020 2320 5072 6566 6572 2063 6f6d      # Prefer com
-000066e0: 706c 6574 6520 7665 7273 696f 6e0a 2020  plete version.  
-000066f0: 2020 2020 2020 2020 2020 6966 2022 696e            if "in
-00006700: 636f 6d70 6c65 7465 2220 696e 2072 6563  complete" in rec
-00006710: 6f72 645f 615f 7072 6f76 5b22 6175 7468  ord_a_prov["auth
-00006720: 6f72 225d 2e67 6574 2822 6e6f 7465 222c  or"].get("note",
-00006730: 2022 2229 3a0a 2020 2020 2020 2020 2020   ""):.          
-00006740: 2020 2020 2020 7265 7475 726e 206d 6572        return mer
-00006750: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
-00006760: 5b22 6175 7468 6f72 225d 0a20 2020 2020  ["author"].     
-00006770: 2020 2065 6c69 6620 2261 7574 686f 7222     elif "author"
-00006780: 2069 6e20 7265 636f 7264 5f61 5f70 726f   in record_a_pro
-00006790: 7620 616e 6420 2261 7574 686f 7222 2069  v and "author" i
-000067a0: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
-000067b0: 5f61 5f70 726f 763a 0a20 2020 2020 2020  _a_prov:.       
-000067c0: 2020 2020 2023 2050 7265 6665 7220 6e6f       # Prefer no
-000067d0: 6e2d 6465 6665 6374 2076 6572 7369 6f6e  n-defect version
-000067e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000067f0: 2271 7561 6c69 7479 5f64 6566 6563 7422  "quality_defect"
-00006800: 2069 6e20 7265 636f 7264 5f61 5f70 726f   in record_a_pro
-00006810: 765b 2261 7574 686f 7222 5d2e 6765 7428  v["author"].get(
-00006820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006830: 2022 6e6f 7465 222c 2022 220a 2020 2020   "note", "".    
-00006840: 2020 2020 2020 2020 2920 616e 6420 2271          ) and "q
-00006850: 7561 6c69 7479 5f64 6566 6563 7422 206e  uality_defect" n
-00006860: 6f74 2069 6e20 6d65 7267 696e 675f 7265  ot in merging_re
-00006870: 636f 7264 5f61 5f70 726f 765b 2261 7574  cord_a_prov["aut
-00006880: 686f 7222 5d2e 6765 7428 0a20 2020 2020  hor"].get(.     
-00006890: 2020 2020 2020 2020 2020 2022 6e6f 7465             "note
-000068a0: 222c 2022 220a 2020 2020 2020 2020 2020  ", "".          
-000068b0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-000068c0: 2020 2020 2072 6574 7572 6e20 6d65 7267       return merg
-000068d0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-000068e0: 2261 7574 686f 7222 5d0a 0a20 2020 2020  "author"]..     
-000068f0: 2020 2020 2020 2023 2050 7265 6665 7220         # Prefer 
-00006900: 636f 6d70 6c65 7465 2076 6572 7369 6f6e  complete version
-00006910: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00006920: 2269 6e63 6f6d 706c 6574 6522 2069 6e20  "incomplete" in 
-00006930: 7265 636f 7264 5f61 5f70 726f 765b 2261  record_a_prov["a
-00006940: 7574 686f 7222 5d2e 6765 7428 0a20 2020  uthor"].get(.   
-00006950: 2020 2020 2020 2020 2020 2020 2022 6e6f               "no
-00006960: 7465 222c 2022 220a 2020 2020 2020 2020  te", "".        
-00006970: 2020 2020 2920 616e 6420 2269 6e63 6f6d      ) and "incom
-00006980: 706c 6574 6522 206e 6f74 2069 6e20 6d65  plete" not in me
-00006990: 7267 696e 675f 7265 636f 7264 5f61 5f70  rging_record_a_p
-000069a0: 726f 765b 2261 7574 686f 7222 5d2e 6765  rov["author"].ge
-000069b0: 7428 226e 6f74 6522 2c20 2222 293a 0a20  t("note", ""):. 
-000069c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000069d0: 6574 7572 6e20 6d65 7267 696e 675f 7265  eturn merging_re
-000069e0: 636f 7264 2e64 6174 615b 2261 7574 686f  cord.data["autho
-000069f0: 7222 5d0a 0a20 2020 2020 2020 2069 6620  r"]..        if 
-00006a00: 6c65 6e28 7265 636f 7264 2e64 6174 615b  len(record.data[
-00006a10: 2261 7574 686f 7222 5d29 203e 2030 2061  "author"]) > 0 a
-00006a20: 6e64 206c 656e 286d 6572 6769 6e67 5f72  nd len(merging_r
-00006a30: 6563 6f72 642e 6461 7461 5b22 6175 7468  ecord.data["auth
-00006a40: 6f72 225d 2920 3e20 303a 0a20 2020 2020  or"]) > 0:.     
-00006a50: 2020 2020 2020 2064 6566 6175 6c74 5f6d         default_m
-00006a60: 6f73 746c 795f 7570 7065 7220 3d20 280a  ostly_upper = (.
-00006a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a80: 636f 6c72 6576 2e65 6e76 2e75 7469 6c73  colrev.env.utils
-00006a90: 2e70 6572 6365 6e74 5f75 7070 6572 5f63  .percent_upper_c
-00006aa0: 6861 7273 2872 6563 6f72 642e 6461 7461  hars(record.data
-00006ab0: 5b22 6175 7468 6f72 225d 2920 3e20 302e  ["author"]) > 0.
-00006ac0: 380a 2020 2020 2020 2020 2020 2020 290a  8.            ).
-00006ad0: 2020 2020 2020 2020 2020 2020 6361 6e64              cand
-00006ae0: 6964 6174 655f 6d6f 7374 6c79 5f75 7070  idate_mostly_upp
-00006af0: 6572 203d 2028 0a20 2020 2020 2020 2020  er = (.         
-00006b00: 2020 2020 2020 2063 6f6c 7265 762e 656e         colrev.en
-00006b10: 762e 7574 696c 732e 7065 7263 656e 745f  v.utils.percent_
-00006b20: 7570 7065 725f 6368 6172 7328 6d65 7267  upper_chars(merg
-00006b30: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-00006b40: 2261 7574 686f 7222 5d29 0a20 2020 2020  "author"]).     
-00006b50: 2020 2020 2020 2020 2020 203e 2030 2e38             > 0.8
-00006b60: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00006b70: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
-00006b80: 6566 6572 2074 6974 6c65 2063 6173 6520  efer title case 
-00006b90: 286e 6f74 2061 6c6c 2d63 6170 7329 0a20  (not all-caps). 
-00006ba0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00006bb0: 6661 756c 745f 6d6f 7374 6c79 5f75 7070  fault_mostly_upp
-00006bc0: 6572 2061 6e64 206e 6f74 2063 616e 6469  er and not candi
-00006bd0: 6461 7465 5f6d 6f73 746c 795f 7570 7065  date_mostly_uppe
-00006be0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00006bf0: 2020 2072 6574 7572 6e20 6d65 7267 696e     return mergin
-00006c00: 675f 7265 636f 7264 2e64 6174 615b 2261  g_record.data["a
-00006c10: 7574 686f 7222 5d0a 0a20 2020 2020 2020  uthor"]..       
-00006c20: 2023 2050 7265 6665 7220 736f 7572 6365   # Prefer source
-00006c30: 730a 2020 2020 2020 2020 6966 2022 6175  s.        if "au
-00006c40: 7468 6f72 2220 696e 206d 6572 6769 6e67  thor" in merging
-00006c50: 5f72 6563 6f72 645f 615f 7072 6f76 3a0a  _record_a_prov:.
-00006c60: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00006c70: 6e79 280a 2020 2020 2020 2020 2020 2020  ny(.            
-00006c80: 2020 2020 7820 696e 206d 6572 6769 6e67      x in merging
-00006c90: 5f72 6563 6f72 645f 615f 7072 6f76 5b22  _record_a_prov["
-00006ca0: 6175 7468 6f72 225d 5b22 736f 7572 6365  author"]["source
-00006cb0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-00006cc0: 2020 2066 6f72 2078 2069 6e20 7072 6566     for x in pref
-00006cd0: 6572 7265 645f 736f 7572 6365 730a 2020  erred_sources.  
-00006ce0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00006cf0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00006d00: 7572 6e20 6d65 7267 696e 675f 7265 636f  urn merging_reco
-00006d10: 7264 2e64 6174 615b 2261 7574 686f 7222  rd.data["author"
-00006d20: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00006d30: 2072 6563 6f72 642e 6461 7461 5b22 6175   record.data["au
-00006d40: 7468 6f72 225d 0a0a 2020 2020 4063 6c61  thor"]..    @cla
-00006d50: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00006d60: 205f 5f73 656c 6563 745f 6265 7374 5f70   __select_best_p
-00006d70: 6167 6573 280a 2020 2020 2020 2020 636c  ages(.        cl
-00006d80: 732c 0a20 2020 2020 2020 202a 2c0a 2020  s,.        *,.  
-00006d90: 2020 2020 2020 7265 636f 7264 3a20 5265        record: Re
-00006da0: 636f 7264 2c0a 2020 2020 2020 2020 6d65  cord,.        me
-00006db0: 7267 696e 675f 7265 636f 7264 3a20 5265  rging_record: Re
-00006dc0: 636f 7264 2c0a 2020 2020 2020 2020 7072  cord,.        pr
-00006dd0: 6566 6572 7265 645f 736f 7572 6365 733a  eferred_sources:
-00006de0: 206c 6973 742c 2020 2320 7079 6c69 6e74   list,  # pylint
-00006df0: 3a20 6469 7361 626c 653d 756e 7573 6564  : disable=unused
-00006e00: 2d61 7267 756d 656e 740a 2020 2020 2920  -argument.    ) 
-00006e10: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-00006e20: 6265 7374 5f70 6167 6573 203d 2072 6563  best_pages = rec
-00006e30: 6f72 642e 6461 7461 5b22 7061 6765 7322  ord.data["pages"
-00006e40: 5d0a 2020 2020 2020 2020 6966 2022 2d2d  ].        if "--
-00006e50: 2220 696e 206d 6572 6769 6e67 5f72 6563  " in merging_rec
-00006e60: 6f72 642e 6461 7461 5b22 7061 6765 7322  ord.data["pages"
-00006e70: 5d20 616e 6420 222d 2d22 206e 6f74 2069  ] and "--" not i
-00006e80: 6e20 7265 636f 7264 2e64 6174 615b 2270  n record.data["p
-00006e90: 6167 6573 225d 3a0a 2020 2020 2020 2020  ages"]:.        
-00006ea0: 2020 2020 6265 7374 5f70 6167 6573 203d      best_pages =
-00006eb0: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
-00006ec0: 6461 7461 5b22 7061 6765 7322 5d0a 2020  data["pages"].  
-00006ed0: 2020 2020 2020 7265 7475 726e 2062 6573        return bes
-00006ee0: 745f 7061 6765 730a 0a20 2020 2040 636c  t_pages..    @cl
-00006ef0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00006f00: 6620 5f5f 7365 6c65 6374 5f62 6573 745f  f __select_best_
-00006f10: 7469 746c 6528 0a20 2020 2020 2020 2063  title(.        c
-00006f20: 6c73 2c0a 2020 2020 2020 2020 2a2c 0a20  ls,.        *,. 
-00006f30: 2020 2020 2020 2072 6563 6f72 643a 2052         record: R
-00006f40: 6563 6f72 642c 0a20 2020 2020 2020 206d  ecord,.        m
-00006f50: 6572 6769 6e67 5f72 6563 6f72 643a 2052  erging_record: R
-00006f60: 6563 6f72 642c 0a20 2020 2020 2020 2070  ecord,.        p
-00006f70: 7265 6665 7272 6564 5f73 6f75 7263 6573  referred_sources
-00006f80: 3a20 6c69 7374 2c20 2023 2070 796c 696e  : list,  # pylin
-00006f90: 743a 2064 6973 6162 6c65 3d75 6e75 7365  t: disable=unuse
-00006fa0: 642d 6172 6775 6d65 6e74 0a20 2020 2029  d-argument.    )
-00006fb0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00006fc0: 2064 6566 6175 6c74 203d 2072 6563 6f72   default = recor
-00006fd0: 642e 6461 7461 5b22 7469 746c 6522 5d0a  d.data["title"].
-00006fe0: 2020 2020 2020 2020 6361 6e64 6964 6174          candidat
-00006ff0: 6520 3d20 6d65 7267 696e 675f 7265 636f  e = merging_reco
-00007000: 7264 2e64 6174 615b 2274 6974 6c65 225d  rd.data["title"]
-00007010: 0a20 2020 2020 2020 2062 6573 745f 7469  .        best_ti
-00007020: 746c 6520 3d20 7265 636f 7264 2e64 6174  tle = record.dat
-00007030: 615b 2274 6974 6c65 225d 0a0a 2020 2020  a["title"]..    
-00007040: 2020 2020 2320 4e6f 7465 203a 2061 766f      # Note : avo
-00007050: 6964 2073 7769 7463 6869 6e67 2074 6974  id switching tit
-00007060: 6c65 730a 2020 2020 2020 2020 6966 2064  les.        if d
-00007070: 6566 6175 6c74 2e72 6570 6c61 6365 2822  efault.replace("
-00007080: 202d 2022 2c20 223a 2022 2920 3d3d 2063   - ", ": ") == c
-00007090: 616e 6469 6461 7465 2e72 6570 6c61 6365  andidate.replace
-000070a0: 2822 202d 2022 2c20 223a 2022 293a 0a20  (" - ", ": "):. 
-000070b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000070c0: 6e20 6465 6661 756c 740a 0a20 2020 2020  n default..     
-000070d0: 2020 2064 6566 6175 6c74 5f75 7070 6572     default_upper
-000070e0: 203d 2063 6f6c 7265 762e 656e 762e 7574   = colrev.env.ut
-000070f0: 696c 732e 7065 7263 656e 745f 7570 7065  ils.percent_uppe
-00007100: 725f 6368 6172 7328 6465 6661 756c 7429  r_chars(default)
-00007110: 0a20 2020 2020 2020 2063 616e 6469 6461  .        candida
-00007120: 7465 5f75 7070 6572 203d 2063 6f6c 7265  te_upper = colre
-00007130: 762e 656e 762e 7574 696c 732e 7065 7263  v.env.utils.perc
-00007140: 656e 745f 7570 7065 725f 6368 6172 7328  ent_upper_chars(
-00007150: 6361 6e64 6964 6174 6529 0a0a 2020 2020  candidate)..    
-00007160: 2020 2020 6966 2063 616e 6469 6461 7465      if candidate
-00007170: 5b2d 315d 206e 6f74 2069 6e20 5b22 2a22  [-1] not in ["*"
-00007180: 2c20 2231 222c 2022 3222 5d3a 0a20 2020  , "1", "2"]:.   
-00007190: 2020 2020 2020 2020 2023 2052 656c 6174           # Relat
-000071a0: 6976 656c 7920 7369 6d70 6c65 2072 756c  ively simple rul
-000071b0: 652e 2e2e 0a20 2020 2020 2020 2020 2020  e....           
-000071c0: 2023 2063 6174 6368 6573 2063 6173 6573   # catches cases
-000071d0: 2077 6865 6e20 6465 6661 756c 7420 6973   when default is
-000071e0: 2061 6c6c 2075 7070 6572 206f 7220 7469   all upper or ti
-000071f0: 746c 6520 6361 7365 0a20 2020 2020 2020  tle case.       
-00007200: 2020 2020 2069 6620 6465 6661 756c 745f       if default_
-00007210: 7570 7065 7220 3e20 6361 6e64 6964 6174  upper > candidat
-00007220: 655f 7570 7065 723a 0a20 2020 2020 2020  e_upper:.       
-00007230: 2020 2020 2020 2020 2062 6573 745f 7469           best_ti
-00007240: 746c 6520 3d20 6361 6e64 6964 6174 650a  tle = candidate.
-00007250: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-00007260: 6573 745f 7469 746c 650a 0a20 2020 2040  est_title..    @
-00007270: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00007280: 6465 6620 5f5f 7365 6c65 6374 5f62 6573  def __select_bes
-00007290: 745f 6a6f 7572 6e61 6c28 0a20 2020 2020  t_journal(.     
-000072a0: 2020 2063 6c73 2c0a 2020 2020 2020 2020     cls,.        
-000072b0: 2a2c 0a20 2020 2020 2020 2072 6563 6f72  *,.        recor
-000072c0: 643a 2052 6563 6f72 642c 0a20 2020 2020  d: Record,.     
-000072d0: 2020 206d 6572 6769 6e67 5f72 6563 6f72     merging_recor
-000072e0: 643a 2052 6563 6f72 642c 0a20 2020 2020  d: Record,.     
-000072f0: 2020 2070 7265 6665 7272 6564 5f73 6f75     preferred_sou
-00007300: 7263 6573 3a20 6c69 7374 2c20 2023 2070  rces: list,  # p
-00007310: 796c 696e 743a 2064 6973 6162 6c65 3d75  ylint: disable=u
-00007320: 6e75 7365 642d 6172 6775 6d65 6e74 0a20  nused-argument. 
-00007330: 2020 2029 202d 3e20 7374 723a 0a20 2020     ) -> str:.   
-00007340: 2020 2020 2072 6574 7572 6e20 636c 732e       return cls.
-00007350: 5f5f 7365 6c65 6374 5f62 6573 745f 636f  __select_best_co
-00007360: 6e74 6169 6e65 725f 7469 746c 6528 0a20  ntainer_title(. 
-00007370: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007380: 6c74 3d72 6563 6f72 642e 6461 7461 5b22  lt=record.data["
-00007390: 6a6f 7572 6e61 6c22 5d2c 2063 616e 6469  journal"], candi
-000073a0: 6461 7465 3d6d 6572 6769 6e67 5f72 6563  date=merging_rec
-000073b0: 6f72 642e 6461 7461 5b22 6a6f 7572 6e61  ord.data["journa
-000073c0: 6c22 5d0a 2020 2020 2020 2020 290a 0a20  l"].        ).. 
-000073d0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-000073e0: 2020 2020 6465 6620 5f5f 7365 6c65 6374      def __select
-000073f0: 5f62 6573 745f 626f 6f6b 7469 746c 6528  _best_booktitle(
-00007400: 0a20 2020 2020 2020 2063 6c73 2c0a 2020  .        cls,.  
-00007410: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
-00007420: 2072 6563 6f72 643a 2052 6563 6f72 642c   record: Record,
-00007430: 0a20 2020 2020 2020 206d 6572 6769 6e67  .        merging
-00007440: 5f72 6563 6f72 643a 2052 6563 6f72 642c  _record: Record,
-00007450: 0a20 2020 2020 2020 2070 7265 6665 7272  .        preferr
-00007460: 6564 5f73 6f75 7263 6573 3a20 6c69 7374  ed_sources: list
-00007470: 2c20 2023 2070 796c 696e 743a 2064 6973  ,  # pylint: dis
-00007480: 6162 6c65 3d75 6e75 7365 642d 6172 6775  able=unused-argu
-00007490: 6d65 6e74 0a20 2020 2029 202d 3e20 7374  ment.    ) -> st
-000074a0: 723a 0a20 2020 2020 2020 2072 6574 7572  r:.        retur
-000074b0: 6e20 636c 732e 5f5f 7365 6c65 6374 5f62  n cls.__select_b
-000074c0: 6573 745f 636f 6e74 6169 6e65 725f 7469  est_container_ti
-000074d0: 746c 6528 0a20 2020 2020 2020 2020 2020  tle(.           
-000074e0: 2064 6566 6175 6c74 3d72 6563 6f72 642e   default=record.
-000074f0: 6461 7461 5b22 626f 6f6b 7469 746c 6522  data["booktitle"
-00007500: 5d2c 2063 616e 6469 6461 7465 3d6d 6572  ], candidate=mer
-00007510: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
-00007520: 5b22 626f 6f6b 7469 746c 6522 5d0a 2020  ["booktitle"].  
-00007530: 2020 2020 2020 290a 0a20 2020 2040 636c        )..    @cl
-00007540: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00007550: 6620 5f5f 7365 6c65 6374 5f62 6573 745f  f __select_best_
-00007560: 636f 6e74 6169 6e65 725f 7469 746c 6528  container_title(
-00007570: 636c 732c 202a 2c20 6465 6661 756c 743a  cls, *, default:
-00007580: 2073 7472 2c20 6361 6e64 6964 6174 653a   str, candidate:
-00007590: 2073 7472 2920 2d3e 2073 7472 3a0a 2020   str) -> str:.  
-000075a0: 2020 2020 2020 6265 7374 5f6a 6f75 726e        best_journ
-000075b0: 616c 203d 2064 6566 6175 6c74 0a0a 2020  al = default..  
-000075c0: 2020 2020 2020 6465 6661 756c 745f 7570        default_up
-000075d0: 7065 7220 3d20 636f 6c72 6576 2e65 6e76  per = colrev.env
-000075e0: 2e75 7469 6c73 2e70 6572 6365 6e74 5f75  .utils.percent_u
-000075f0: 7070 6572 5f63 6861 7273 2864 6566 6175  pper_chars(defau
-00007600: 6c74 290a 2020 2020 2020 2020 6361 6e64  lt).        cand
-00007610: 6964 6174 655f 7570 7065 7220 3d20 636f  idate_upper = co
-00007620: 6c72 6576 2e65 6e76 2e75 7469 6c73 2e70  lrev.env.utils.p
-00007630: 6572 6365 6e74 5f75 7070 6572 5f63 6861  ercent_upper_cha
-00007640: 7273 2863 616e 6469 6461 7465 290a 0a20  rs(candidate).. 
-00007650: 2020 2020 2020 2023 2053 696d 706c 6520         # Simple 
-00007660: 6865 7572 6973 7469 6320 746f 2061 766f  heuristic to avo
-00007670: 6964 2061 6262 7265 7669 6174 696f 6e73  id abbreviations
-00007680: 0a20 2020 2020 2020 2069 6620 222e 2220  .        if "." 
-00007690: 696e 2064 6566 6175 6c74 2061 6e64 2022  in default and "
-000076a0: 2e22 206e 6f74 2069 6e20 6361 6e64 6964  ." not in candid
-000076b0: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
-000076c0: 2062 6573 745f 6a6f 7572 6e61 6c20 3d20   best_journal = 
-000076d0: 6361 6e64 6964 6174 650a 2020 2020 2020  candidate.      
-000076e0: 2020 2320 5265 6c61 7469 7665 6c79 2073    # Relatively s
-000076f0: 696d 706c 6520 7275 6c65 2e2e 2e0a 2020  imple rule....  
-00007700: 2020 2020 2020 2320 6361 7463 6865 7320        # catches 
-00007710: 6361 7365 7320 7768 656e 2064 6566 6175  cases when defau
-00007720: 6c74 2069 7320 616c 6c20 7570 7065 7220  lt is all upper 
-00007730: 6f72 2074 6974 6c65 2063 6173 650a 2020  or title case.  
-00007740: 2020 2020 2020 6966 2064 6566 6175 6c74        if default
-00007750: 5f75 7070 6572 203e 2063 616e 6469 6461  _upper > candida
-00007760: 7465 5f75 7070 6572 3a0a 2020 2020 2020  te_upper:.      
-00007770: 2020 2020 2020 6265 7374 5f6a 6f75 726e        best_journ
-00007780: 616c 203d 2063 616e 6469 6461 7465 0a20  al = candidate. 
-00007790: 2020 2020 2020 2072 6574 7572 6e20 6265         return be
-000077a0: 7374 5f6a 6f75 726e 616c 0a0a 2020 2020  st_journal..    
-000077b0: 6465 6620 5f5f 6675 7365 5f62 6573 745f  def __fuse_best_
-000077c0: 6669 656c 6428 0a20 2020 2020 2020 2073  field(.        s
-000077d0: 656c 662c 0a20 2020 2020 2020 202a 2c0a  elf,.        *,.
-000077e0: 2020 2020 2020 2020 6d65 7267 696e 675f          merging_
-000077f0: 7265 636f 7264 3a20 5265 636f 7264 2c0a  record: Record,.
-00007800: 2020 2020 2020 2020 6b65 793a 2073 7472          key: str
-00007810: 2c0a 2020 2020 2020 2020 7661 6c3a 2073  ,.        val: s
-00007820: 7472 2c0a 2020 2020 2020 2020 736f 7572  tr,.        sour
-00007830: 6365 3a20 7374 722c 0a20 2020 2020 2020  ce: str,.       
-00007840: 206e 6f74 653a 2073 7472 2c20 2023 2070   note: str,  # p
-00007850: 796c 696e 743a 2064 6973 6162 6c65 3d75  ylint: disable=u
-00007860: 6e75 7365 642d 6172 6775 6d65 6e74 0a20  nused-argument. 
-00007870: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-00007880: 2020 2020 2020 2320 4e6f 7465 203a 2074        # Note : t
-00007890: 6865 2061 7373 756d 7074 696f 6e20 6973  he assumption is
-000078a0: 2074 6861 7420 7765 206e 6565 6420 6d61   that we need ma
-000078b0: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-000078c0: 6e63 6520 6e6f 7465 730a 2020 2020 2020  nce notes.      
-000078d0: 2020 2320 6f6e 6c79 2066 6f72 2061 7574    # only for aut
-000078e0: 686f 7273 0a0a 2020 2020 2020 2020 6375  hors..        cu
-000078f0: 7374 6f6d 5f66 6965 6c64 5f73 656c 6563  stom_field_selec
-00007900: 746f 7273 203d 207b 0a20 2020 2020 2020  tors = {.       
-00007910: 2020 2020 2022 6175 7468 6f72 223a 2073       "author": s
-00007920: 656c 662e 5f5f 7365 6c65 6374 5f62 6573  elf.__select_bes
-00007930: 745f 6175 7468 6f72 2c0a 2020 2020 2020  t_author,.      
-00007940: 2020 2020 2020 2270 6167 6573 223a 2073        "pages": s
-00007950: 656c 662e 5f5f 7365 6c65 6374 5f62 6573  elf.__select_bes
-00007960: 745f 7061 6765 732c 0a20 2020 2020 2020  t_pages,.       
-00007970: 2020 2020 2022 7469 746c 6522 3a20 7365       "title": se
-00007980: 6c66 2e5f 5f73 656c 6563 745f 6265 7374  lf.__select_best
-00007990: 5f74 6974 6c65 2c0a 2020 2020 2020 2020  _title,.        
-000079a0: 2020 2020 226a 6f75 726e 616c 223a 2073      "journal": s
-000079b0: 656c 662e 5f5f 7365 6c65 6374 5f62 6573  elf.__select_bes
-000079c0: 745f 6a6f 7572 6e61 6c2c 0a20 2020 2020  t_journal,.     
-000079d0: 2020 2020 2020 2022 626f 6f6b 7469 746c         "booktitl
-000079e0: 6522 3a20 7365 6c66 2e5f 5f73 656c 6563  e": self.__selec
-000079f0: 745f 6265 7374 5f62 6f6f 6b74 6974 6c65  t_best_booktitle
-00007a00: 2c0a 2020 2020 2020 2020 7d0a 0a20 2020  ,.        }..   
-00007a10: 2020 2020 2069 6620 6b65 7920 696e 2063       if key in c
-00007a20: 7573 746f 6d5f 6669 656c 645f 7365 6c65  ustom_field_sele
-00007a30: 6374 6f72 733a 0a20 2020 2020 2020 2020  ctors:.         
-00007a40: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
-00007a50: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-00007a60: 2020 2020 2020 2020 6265 7374 5f76 616c          best_val
-00007a70: 7565 203d 2063 7573 746f 6d5f 6669 656c  ue = custom_fiel
-00007a80: 645f 7365 6c65 6374 6f72 735b 6b65 795d  d_selectors[key]
-00007a90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007aa0: 2020 2020 2020 7265 636f 7264 3d73 656c        record=sel
-00007ab0: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-00007ac0: 2020 2020 2020 206d 6572 6769 6e67 5f72         merging_r
-00007ad0: 6563 6f72 643d 6d65 7267 696e 675f 7265  ecord=merging_re
-00007ae0: 636f 7264 2c0a 2020 2020 2020 2020 2020  cord,.          
-00007af0: 2020 2020 2020 2020 2020 7072 6566 6572            prefer
-00007b00: 7265 645f 736f 7572 6365 733d 7365 6c66  red_sources=self
-00007b10: 2e70 7265 6665 7272 6564 5f73 6f75 7263  .preferred_sourc
-00007b20: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00007b30: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00007b40: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
-00007b50: 7461 5b6b 6579 5d20 213d 2062 6573 745f  ta[key] != best_
-00007b60: 7661 6c75 653a 0a20 2020 2020 2020 2020  value:.         
-00007b70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007b80: 7570 6461 7465 5f66 6965 6c64 280a 2020  update_field(.  
-00007b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ba0: 2020 2020 2020 6b65 793d 6b65 792c 2076        key=key, v
-00007bb0: 616c 7565 3d62 6573 745f 7661 6c75 652c  alue=best_value,
-00007bc0: 2073 6f75 7263 653d 736f 7572 6365 2c20   source=source, 
-00007bd0: 6170 7065 6e64 5f65 6469 743d 4661 6c73  append_edit=Fals
-00007be0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00007bf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00007c00: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00007c10: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-00007c20: 7064 6174 655f 6669 656c 6428 6b65 793d  pdate_field(key=
-00007c30: 6b65 792c 2076 616c 7565 3d76 616c 2c20  key, value=val, 
-00007c40: 736f 7572 6365 3d73 6f75 7263 652c 2061  source=source, a
-00007c50: 7070 656e 645f 6564 6974 3d46 616c 7365  ppend_edit=False
-00007c60: 290a 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00007c70: 6b65 7920 3d3d 2022 6669 6c65 223a 0a20  key == "file":. 
-00007c80: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-00007c90: 7920 696e 2073 656c 662e 6461 7461 3a0a  y in self.data:.
-00007ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007cb0: 7365 6c66 2e64 6174 615b 6b65 795d 203d  self.data[key] =
-00007cc0: 2073 656c 662e 6461 7461 5b6b 6579 5d20   self.data[key] 
-00007cd0: 2b20 223b 2220 2b20 6d65 7267 696e 675f  + ";" + merging_
-00007ce0: 7265 636f 7264 2e64 6174 612e 6765 7428  record.data.get(
-00007cf0: 6b65 792c 2022 2229 0a20 2020 2020 2020  key, "").       
-00007d00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00007d10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007d20: 6461 7461 5b6b 6579 5d20 3d20 6d65 7267  data[key] = merg
-00007d30: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-00007d40: 6b65 795d 0a20 2020 2020 2020 2065 6c69  key].        eli
-00007d50: 6620 6b65 7920 696e 205b 2275 726c 222c  f key in ["url",
-00007d60: 2022 6c69 6e6b 225d 3a0a 2020 2020 2020   "link"]:.      
-00007d70: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-00007d80: 2020 2020 2020 2020 2020 206b 6579 2069             key i
-00007d90: 6e20 7365 6c66 2e64 6174 610a 2020 2020  n self.data.    
-00007da0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00007db0: 7365 6c66 2e64 6174 615b 6b65 795d 2e72  self.data[key].r
-00007dc0: 7374 7269 7028 222f 2229 2021 3d20 6d65  strip("/") != me
-00007dd0: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
-00007de0: 615b 6b65 795d 2e72 7374 7269 7028 222f  a[key].rstrip("/
-00007df0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00007e00: 2020 2061 6e64 2022 6874 7470 7322 206e     and "https" n
-00007e10: 6f74 2069 6e20 7365 6c66 2e64 6174 615b  ot in self.data[
-00007e20: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
-00007e30: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00007e40: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-00007e50: 6669 656c 6428 6b65 793d 6b65 792c 2076  field(key=key, v
-00007e60: 616c 7565 3d76 616c 2c20 736f 7572 6365  alue=val, source
-00007e70: 3d73 6f75 7263 652c 2061 7070 656e 645f  =source, append_
-00007e80: 6564 6974 3d46 616c 7365 290a 0a20 2020  edit=False)..   
-00007e90: 2020 2020 2065 6c69 6620 2255 4e4b 4e4f       elif "UNKNO
-00007ea0: 574e 2220 3d3d 2073 656c 662e 6461 7461  WN" == self.data
-00007eb0: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
-00007ec0: 2020 6b65 792c 2022 220a 2020 2020 2020    key, "".      
-00007ed0: 2020 2920 616e 6420 2255 4e4b 4e4f 574e    ) and "UNKNOWN
-00007ee0: 2220 213d 206d 6572 6769 6e67 5f72 6563  " != merging_rec
-00007ef0: 6f72 642e 6461 7461 2e67 6574 286b 6579  ord.data.get(key
-00007f00: 2c20 2222 293a 0a20 2020 2020 2020 2020  , ""):.         
-00007f10: 2020 2073 656c 662e 6461 7461 5b6b 6579     self.data[key
-00007f20: 5d20 3d20 6d65 7267 696e 675f 7265 636f  ] = merging_reco
-00007f30: 7264 2e64 6174 615b 6b65 795d 0a20 2020  rd.data[key].   
-00007f40: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-00007f50: 696e 2073 656c 662e 6964 656e 7469 6679  in self.identify
-00007f60: 696e 675f 6669 656c 645f 6b65 7973 3a0a  ing_field_keys:.
-00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f80: 7365 6c66 2e61 6464 5f6d 6173 7465 7264  self.add_masterd
-00007f90: 6174 615f 7072 6f76 656e 616e 6365 286b  ata_provenance(k
-00007fa0: 6579 3d6b 6579 2c20 736f 7572 6365 3d73  ey=key, source=s
-00007fb0: 6f75 7263 6529 0a20 2020 2020 2020 2020  ource).         
-00007fc0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007fd0: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
-00007fe0: 645f 6461 7461 5f70 726f 7665 6e61 6e63  d_data_provenanc
-00007ff0: 6528 6b65 793d 6b65 792c 2073 6f75 7263  e(key=key, sourc
-00008000: 653d 736f 7572 6365 290a 0a20 2020 2020  e=source)..     
-00008010: 2020 2023 2065 6c69 6620 6d65 7267 696e     # elif mergin
-00008020: 675f 7265 636f 7264 2e64 6174 612e 6765  g_record.data.ge
-00008030: 7428 6b65 792c 2022 554e 4b4e 4f57 4e22  t(key, "UNKNOWN"
-00008040: 2920 3d3d 2022 554e 4b4e 4f57 4e22 3a0a  ) == "UNKNOWN":.
-00008050: 2020 2020 2020 2020 2320 2020 2020 7061          #     pa
-00008060: 7373 0a20 2020 2020 2020 2023 204e 6f74  ss.        # Not
-00008070: 6520 3a20 7468 6520 666f 6c6c 6f77 696e  e : the followin
-00008080: 6720 6973 2064 6561 6374 6976 6174 6564  g is deactivated
-00008090: 2074 6f20 6176 6f69 6420 6672 6571 7565   to avoid freque
-000080a0: 6e74 2063 6861 6e67 6573 2069 6e20 6d65  nt changes in me
-000080b0: 7267 6564 2072 6563 6f72 6473 0a20 2020  rged records.   
-000080c0: 2020 2020 2023 2065 6c73 653a 0a20 2020       # else:.   
-000080d0: 2020 2020 2023 2020 2020 2074 7279 3a0a       #     try:.
-000080e0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-000080f0: 2020 6966 206b 6579 2069 6e20 7365 6c66    if key in self
-00008100: 2e69 6465 6e74 6966 7969 6e67 5f66 6965  .identifying_fie
-00008110: 6c64 5f6b 6579 733a 0a20 2020 2020 2020  ld_keys:.       
-00008120: 2023 2020 2020 2020 2020 2020 2020 2073   #             s
-00008130: 6f75 7263 6520 3d20 6d65 7267 696e 675f  ource = merging_
-00008140: 7265 636f 7264 2e64 6174 615b 2263 6f6c  record.data["col
-00008150: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00008160: 726f 7665 6e61 6e63 6522 5d5b 6b65 795d  rovenance"][key]
-00008170: 5b0a 2020 2020 2020 2020 2320 2020 2020  [.        #     
-00008180: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
-00008190: 7263 6522 0a20 2020 2020 2020 2023 2020  rce".        #  
-000081a0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-000081b0: 2020 2020 2023 2020 2020 2020 2020 2065       #         e
-000081c0: 6c73 653a 0a20 2020 2020 2020 2023 2020  lse:.        #  
-000081d0: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-000081e0: 6520 3d20 6d65 7267 696e 675f 7265 636f  e = merging_reco
-000081f0: 7264 2e64 6174 615b 2263 6f6c 7265 765f  rd.data["colrev_
-00008200: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-00008210: 5d5b 6b65 795d 5b0a 2020 2020 2020 2020  ][key][.        
-00008220: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00008230: 2020 2273 6f75 7263 6522 0a20 2020 2020    "source".     
-00008240: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00008250: 205d 0a20 2020 2020 2020 2023 2020 2020   ].        #    
-00008260: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-00008270: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-00008280: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00008290: 2023 2069 6620 7661 6c20 213d 2073 7472   # if val != str
-000082a0: 286d 6572 6769 6e67 5f72 6563 6f72 642e  (merging_record.
-000082b0: 6461 7461 5b6b 6579 5d29 3a0a 2020 2020  data[key]):.    
-000082c0: 2020 2020 2320 2020 2020 7365 6c66 2e75      #     self.u
-000082d0: 7064 6174 655f 6669 656c 6428 0a20 2020  pdate_field(.   
-000082e0: 2020 2020 2023 2020 2020 2020 2020 206b       #         k
-000082f0: 6579 3d6b 6579 2c0a 2020 2020 2020 2020  ey=key,.        
-00008300: 2320 2020 2020 2020 2020 7661 6c75 653d  #         value=
-00008310: 7374 7228 6d65 7267 696e 675f 7265 636f  str(merging_reco
-00008320: 7264 2e64 6174 615b 6b65 795d 292c 0a20  rd.data[key]),. 
-00008330: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00008340: 2073 6f75 7263 653d 736f 7572 6365 2c0a   source=source,.
-00008350: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00008360: 2020 6e6f 7465 3d6e 6f74 652c 0a20 2020    note=note,.   
-00008370: 2020 2020 2023 2020 2020 2029 0a20 2020       #     ).   
-00008380: 2020 2020 2023 2073 656c 662e 7570 6461       # self.upda
-00008390: 7465 5f66 6965 6c64 286b 6579 3d6b 6579  te_field(key=key
-000083a0: 2c20 7661 6c75 653d 7661 6c2c 2073 6f75  , value=val, sou
-000083b0: 7263 653d 736f 7572 6365 2c20 6e6f 7465  rce=source, note
-000083c0: 3d6e 6f74 6529 0a0a 2020 2020 4063 6c61  =note)..    @cla
-000083d0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-000083e0: 2067 6574 5f72 6563 6f72 645f 6368 616e   get_record_chan
-000083f0: 6765 5f73 636f 7265 2863 6c73 2c20 2a2c  ge_score(cls, *,
-00008400: 2072 6563 6f72 645f 613a 2052 6563 6f72   record_a: Recor
-00008410: 642c 2072 6563 6f72 645f 623a 2052 6563  d, record_b: Rec
-00008420: 6f72 6429 202d 3e20 666c 6f61 743a 0a20  ord) -> float:. 
-00008430: 2020 2020 2020 2022 2222 4465 7465 726d         """Determ
-00008440: 696e 6520 686f 7720 6d75 6368 2072 6563  ine how much rec
-00008450: 6f72 6473 2063 6861 6e67 6564 0a0a 2020  ords changed..  
-00008460: 2020 2020 2020 5468 6973 206d 6574 686f        This metho
-00008470: 6420 6973 206c 6573 7320 7365 6e73 6974  d is less sensit
-00008480: 6976 6520 7468 616e 2067 6574 5f72 6563  ive than get_rec
-00008490: 6f72 645f 7369 6d69 6c61 7269 7479 2c20  ord_similarity, 
-000084a0: 6573 7065 6369 616c 6c79 2077 6865 6e0a  especially when.
-000084b0: 2020 2020 2020 2020 6669 656c 6473 2061          fields a
-000084c0: 7265 206d 6973 7369 6e67 2e20 466f 7220  re missing. For 
-000084d0: 6578 616d 706c 652c 2069 6620 7468 6520  example, if the 
-000084e0: 6a6f 7572 6e61 6c20 6669 656c 6420 6973  journal field is
-000084f0: 206d 6973 7369 6e67 2069 6e20 626f 7468   missing in both
-00008500: 0a20 2020 2020 2020 2072 6563 6f72 6473  .        records
-00008510: 2c20 6765 745f 7369 6d69 6c61 7269 7479  , get_similarity
-00008520: 2077 696c 6c20 7265 7475 726e 2061 2076   will return a v
-00008530: 616c 7565 203e 2031 2e30 2e20 5468 6520  alue > 1.0. The 
-00008540: 6765 745f 7265 636f 7264 5f63 6861 6e67  get_record_chang
-00008550: 6573 0a20 2020 2020 2020 2077 696c 6c20  es.        will 
-00008560: 7265 7475 726e 2030 2e30 2028 6966 2061  return 0.0 (if a
-00008570: 6c6c 206f 7468 6572 2066 6965 6c64 7320  ll other fields 
-00008580: 6172 6520 6571 7561 6c29 2e22 2222 0a0a  are equal)."""..
-00008590: 2020 2020 2020 2020 2320 4174 2073 6f6d          # At som
-000085a0: 6520 706f 696e 742c 2074 6869 7320 6d61  e point, this ma
-000085b0: 7920 6265 636f 6d65 206d 6f72 6520 7365  y become more se
-000085c0: 6e73 6974 6976 6520 746f 206d 616a 6f72  nsitive to major
-000085d0: 2063 6861 6e67 6573 0a20 2020 2020 2020   changes.       
-000085e0: 2073 7472 5f61 203d 2028 0a20 2020 2020   str_a = (.     
-000085f0: 2020 2020 2020 2066 227b 7265 636f 7264         f"{record
-00008600: 5f61 2e64 6174 612e 6765 7428 2761 7574  _a.data.get('aut
-00008610: 686f 7227 2c20 2727 297d 2028 7b72 6563  hor', '')} ({rec
-00008620: 6f72 645f 612e 6461 7461 2e67 6574 2827  ord_a.data.get('
-00008630: 7965 6172 272c 2027 2729 7d29 2022 0a20  year', '')}) ". 
-00008640: 2020 2020 2020 2020 2020 202b 2066 227b             + f"{
-00008650: 7265 636f 7264 5f61 2e64 6174 612e 6765  record_a.data.ge
-00008660: 7428 2774 6974 6c65 272c 2027 2729 7d2e  t('title', '')}.
-00008670: 2022 0a20 2020 2020 2020 2020 2020 202b   ".            +
-00008680: 2066 227b 7265 636f 7264 5f61 2e64 6174   f"{record_a.dat
-00008690: 612e 6765 7428 276a 6f75 726e 616c 272c  a.get('journal',
-000086a0: 2027 2729 7d7b 7265 636f 7264 5f61 2e64   '')}{record_a.d
-000086b0: 6174 612e 6765 7428 2762 6f6f 6b74 6974  ata.get('booktit
-000086c0: 6c65 272c 2027 2729 7d2c 2022 0a20 2020  le', '')}, ".   
-000086d0: 2020 2020 2020 2020 202b 2066 227b 7265           + f"{re
-000086e0: 636f 7264 5f61 2e64 6174 612e 6765 7428  cord_a.data.get(
-000086f0: 2776 6f6c 756d 6527 2c20 2727 297d 2028  'volume', '')} (
-00008700: 7b72 6563 6f72 645f 612e 6461 7461 2e67  {record_a.data.g
-00008710: 6574 2827 6e75 6d62 6572 272c 2027 2729  et('number', '')
-00008720: 7d29 220a 2020 2020 2020 2020 290a 2020  })".        ).  
-00008730: 2020 2020 2020 7374 725f 6220 3d20 280a        str_b = (.
-00008740: 2020 2020 2020 2020 2020 2020 6622 7b72              f"{r
-00008750: 6563 6f72 645f 622e 6461 7461 2e67 6574  ecord_b.data.get
-00008760: 2827 6175 7468 6f72 272c 2027 2729 7d20  ('author', '')} 
-00008770: 287b 7265 636f 7264 5f62 2e64 6174 612e  ({record_b.data.
-00008780: 6765 7428 2779 6561 7227 2c20 2727 297d  get('year', '')}
-00008790: 2920 220a 2020 2020 2020 2020 2020 2020  ) ".            
-000087a0: 2b20 6622 7b72 6563 6f72 645f 622e 6461  + f"{record_b.da
-000087b0: 7461 2e67 6574 2827 7469 746c 6527 2c20  ta.get('title', 
-000087c0: 2727 297d 2e20 220a 2020 2020 2020 2020  '')}. ".        
-000087d0: 2020 2020 2b20 6622 7b72 6563 6f72 645f      + f"{record_
-000087e0: 622e 6461 7461 2e67 6574 2827 6a6f 7572  b.data.get('jour
-000087f0: 6e61 6c27 2c20 2727 297d 7b72 6563 6f72  nal', '')}{recor
-00008800: 645f 622e 6461 7461 2e67 6574 2827 626f  d_b.data.get('bo
-00008810: 6f6b 7469 746c 6527 2c20 2727 297d 2c20  oktitle', '')}, 
-00008820: 220a 2020 2020 2020 2020 2020 2020 2b20  ".            + 
-00008830: 6622 7b72 6563 6f72 645f 622e 6461 7461  f"{record_b.data
-00008840: 2e67 6574 2827 766f 6c75 6d65 272c 2027  .get('volume', '
-00008850: 2729 7d20 287b 7265 636f 7264 5f62 2e64  ')} ({record_b.d
-00008860: 6174 612e 6765 7428 276e 756d 6265 7227  ata.get('number'
-00008870: 2c20 2727 297d 2922 0a20 2020 2020 2020  , '')})".       
-00008880: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00008890: 6e20 3120 2d20 6675 7a7a 2e72 6174 696f  n 1 - fuzz.ratio
-000088a0: 2873 7472 5f61 2e6c 6f77 6572 2829 2c20  (str_a.lower(), 
-000088b0: 7374 725f 622e 6c6f 7765 7228 2929 202f  str_b.lower()) /
-000088c0: 2031 3030 0a0a 2020 2020 4063 6c61 7373   100..    @class
-000088d0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-000088e0: 6574 5f72 6563 6f72 645f 7369 6d69 6c61  et_record_simila
-000088f0: 7269 7479 2863 6c73 2c20 2a2c 2072 6563  rity(cls, *, rec
-00008900: 6f72 645f 613a 2052 6563 6f72 642c 2072  ord_a: Record, r
-00008910: 6563 6f72 645f 623a 2052 6563 6f72 6429  ecord_b: Record)
-00008920: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
-00008930: 2020 2022 2222 4465 7465 726d 696e 6520     """Determine 
-00008940: 7468 6520 7369 6d69 6c61 7269 7479 2062  the similarity b
-00008950: 6574 7765 656e 2074 776f 2072 6563 6f72  etween two recor
-00008960: 6473 2028 7468 6569 7220 6d61 7374 6572  ds (their master
-00008970: 6461 7461 2922 2222 0a20 2020 2020 2020  data)""".       
-00008980: 2072 6563 6f72 645f 615f 6469 6374 203d   record_a_dict =
-00008990: 2072 6563 6f72 645f 612e 636f 7079 2829   record_a.copy()
-000089a0: 2e67 6574 5f64 6174 6128 290a 2020 2020  .get_data().    
-000089b0: 2020 2020 7265 636f 7264 5f62 5f64 6963      record_b_dic
-000089c0: 7420 3d20 7265 636f 7264 5f62 2e63 6f70  t = record_b.cop
-000089d0: 7928 292e 6765 745f 6461 7461 2829 0a0a  y().get_data()..
-000089e0: 2020 2020 2020 2020 6d61 6e64 6174 6f72          mandator
-000089f0: 795f 6669 656c 6473 203d 205b 0a20 2020  y_fields = [.   
-00008a00: 2020 2020 2020 2020 2022 7469 746c 6522           "title"
-00008a10: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
-00008a20: 7574 686f 7222 2c0a 2020 2020 2020 2020  uthor",.        
-00008a30: 2020 2020 2279 6561 7222 2c0a 2020 2020      "year",.    
-00008a40: 2020 2020 2020 2020 226a 6f75 726e 616c          "journal
-00008a50: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00008a60: 766f 6c75 6d65 222c 0a20 2020 2020 2020  volume",.       
-00008a70: 2020 2020 2022 6e75 6d62 6572 222c 0a20       "number",. 
-00008a80: 2020 2020 2020 2020 2020 2022 7061 6765             "page
-00008a90: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-00008aa0: 2262 6f6f 6b74 6974 6c65 222c 0a20 2020  "booktitle",.   
-00008ab0: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-00008ac0: 666f 7220 6d61 6e64 6174 6f72 795f 6669  for mandatory_fi
-00008ad0: 656c 6420 696e 206d 616e 6461 746f 7279  eld in mandatory
-00008ae0: 5f66 6965 6c64 733a 0a20 2020 2020 2020  _fields:.       
-00008af0: 2020 2020 2069 6620 7265 636f 7264 5f61       if record_a
-00008b00: 5f64 6963 742e 6765 7428 6d61 6e64 6174  _dict.get(mandat
-00008b10: 6f72 795f 6669 656c 642c 2022 554e 4b4e  ory_field, "UNKN
-00008b20: 4f57 4e22 2920 3d3d 2022 554e 4b4e 4f57  OWN") == "UNKNOW
-00008b30: 4e22 3a0a 2020 2020 2020 2020 2020 2020  N":.            
-00008b40: 2020 2020 7265 636f 7264 5f61 5f64 6963      record_a_dic
-00008b50: 745b 6d61 6e64 6174 6f72 795f 6669 656c  t[mandatory_fiel
-00008b60: 645d 203d 2022 220a 2020 2020 2020 2020  d] = "".        
-00008b70: 2020 2020 6966 2072 6563 6f72 645f 625f      if record_b_
-00008b80: 6469 6374 2e67 6574 286d 616e 6461 746f  dict.get(mandato
-00008b90: 7279 5f66 6965 6c64 2c20 2255 4e4b 4e4f  ry_field, "UNKNO
-00008ba0: 574e 2229 203d 3d20 2255 4e4b 4e4f 574e  WN") == "UNKNOWN
-00008bb0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00008bc0: 2020 2072 6563 6f72 645f 625f 6469 6374     record_b_dict
-00008bd0: 5b6d 616e 6461 746f 7279 5f66 6965 6c64  [mandatory_field
-00008be0: 5d20 3d20 2222 0a0a 2020 2020 2020 2020  ] = ""..        
-00008bf0: 6966 2022 636f 6e74 6169 6e65 725f 7469  if "container_ti
-00008c00: 746c 6522 206e 6f74 2069 6e20 7265 636f  tle" not in reco
-00008c10: 7264 5f61 5f64 6963 743a 0a20 2020 2020  rd_a_dict:.     
-00008c20: 2020 2020 2020 2072 6563 6f72 645f 615f         record_a_
-00008c30: 6469 6374 5b22 636f 6e74 6169 6e65 725f  dict["container_
-00008c40: 7469 746c 6522 5d20 3d20 280a 2020 2020  title"] = (.    
-00008c50: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00008c60: 7264 5f61 5f64 6963 742e 6765 7428 226a  rd_a_dict.get("j
-00008c70: 6f75 726e 616c 222c 2022 2229 0a20 2020  ournal", "").   
-00008c80: 2020 2020 2020 2020 2020 2020 202b 2072               + r
-00008c90: 6563 6f72 645f 615f 6469 6374 2e67 6574  ecord_a_dict.get
-00008ca0: 2822 626f 6f6b 7469 746c 6522 2c20 2222  ("booktitle", ""
-00008cb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00008cc0: 2020 2b20 7265 636f 7264 5f61 5f64 6963    + record_a_dic
-00008cd0: 742e 6765 7428 2273 6572 6965 7322 2c20  t.get("series", 
-00008ce0: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
-00008cf0: 290a 0a20 2020 2020 2020 2069 6620 2263  )..        if "c
-00008d00: 6f6e 7461 696e 6572 5f74 6974 6c65 2220  ontainer_title" 
-00008d10: 6e6f 7420 696e 2072 6563 6f72 645f 625f  not in record_b_
-00008d20: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-00008d30: 2020 7265 636f 7264 5f62 5f64 6963 745b    record_b_dict[
-00008d40: 2263 6f6e 7461 696e 6572 5f74 6974 6c65  "container_title
-00008d50: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-00008d60: 2020 2020 2020 2072 6563 6f72 645f 625f         record_b_
-00008d70: 6469 6374 2e67 6574 2822 6a6f 7572 6e61  dict.get("journa
-00008d80: 6c22 2c20 2222 290a 2020 2020 2020 2020  l", "").        
-00008d90: 2020 2020 2020 2020 2b20 7265 636f 7264          + record
-00008da0: 5f62 5f64 6963 742e 6765 7428 2262 6f6f  _b_dict.get("boo
-00008db0: 6b74 6974 6c65 222c 2022 2229 0a20 2020  ktitle", "").   
-00008dc0: 2020 2020 2020 2020 2020 2020 202b 2072               + r
-00008dd0: 6563 6f72 645f 625f 6469 6374 2e67 6574  ecord_b_dict.get
-00008de0: 2822 7365 7269 6573 222c 2022 2229 0a20  ("series", ""). 
-00008df0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00008e00: 2020 2020 2020 6466 5f61 203d 2070 642e        df_a = pd.
-00008e10: 4461 7461 4672 616d 652e 6672 6f6d 5f64  DataFrame.from_d
-00008e20: 6963 7428 5b72 6563 6f72 645f 615f 6469  ict([record_a_di
-00008e30: 6374 5d29 2020 2320 7479 7065 3a20 6967  ct])  # type: ig
-00008e40: 6e6f 7265 0a20 2020 2020 2020 2064 665f  nore.        df_
-00008e50: 6220 3d20 7064 2e44 6174 6146 7261 6d65  b = pd.DataFrame
-00008e60: 2e66 726f 6d5f 6469 6374 285b 7265 636f  .from_dict([reco
-00008e70: 7264 5f62 5f64 6963 745d 2920 2023 2074  rd_b_dict])  # t
-00008e80: 7970 653a 2069 676e 6f72 650a 0a20 2020  ype: ignore..   
-00008e90: 2020 2020 2072 6574 7572 6e20 5265 636f       return Reco
-00008ea0: 7264 2e67 6574 5f73 696d 696c 6172 6974  rd.get_similarit
-00008eb0: 7928 6466 5f61 3d64 665f 612e 696c 6f63  y(df_a=df_a.iloc
-00008ec0: 5b30 5d2c 2064 665f 623d 6466 5f62 2e69  [0], df_b=df_b.i
-00008ed0: 6c6f 635b 305d 290a 0a20 2020 2040 636c  loc[0])..    @cl
-00008ee0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00008ef0: 6620 6765 745f 7369 6d69 6c61 7269 7479  f get_similarity
-00008f00: 2863 6c73 2c20 2a2c 2064 665f 613a 2064  (cls, *, df_a: d
-00008f10: 6963 742c 2064 665f 623a 2064 6963 7429  ict, df_b: dict)
-00008f20: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
-00008f30: 2020 2022 2222 4465 7465 726d 696e 6520     """Determine 
-00008f40: 7468 6520 7369 6d69 6c61 7269 7479 2062  the similarity b
-00008f50: 6574 7765 656e 2074 776f 2072 6563 6f72  etween two recor
-00008f60: 6473 2222 220a 0a20 2020 2020 2020 2064  ds"""..        d
-00008f70: 6574 6169 6c73 203d 2052 6563 6f72 642e  etails = Record.
-00008f80: 6765 745f 7369 6d69 6c61 7269 7479 5f64  get_similarity_d
-00008f90: 6574 6169 6c65 6428 7265 636f 7264 5f61  etailed(record_a
-00008fa0: 3d64 665f 612c 2072 6563 6f72 645f 623d  =df_a, record_b=
-00008fb0: 6466 5f62 290a 2020 2020 2020 2020 7265  df_b).        re
-00008fc0: 7475 726e 2064 6574 6169 6c73 5b22 7363  turn details["sc
-00008fd0: 6f72 6522 5d0a 0a20 2020 2040 636c 6173  ore"]..    @clas
-00008fe0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00008ff0: 6765 745f 7369 6d69 6c61 7269 7479 5f64  get_similarity_d
-00009000: 6574 6169 6c65 6428 636c 732c 202a 2c20  etailed(cls, *, 
-00009010: 7265 636f 7264 5f61 3a20 6469 6374 2c20  record_a: dict, 
-00009020: 7265 636f 7264 5f62 3a20 6469 6374 2920  record_b: dict) 
-00009030: 2d3e 2064 6963 743a 0a20 2020 2020 2020  -> dict:.       
-00009040: 2022 2222 4465 7465 726d 696e 6520 7468   """Determine th
-00009050: 6520 6465 7461 696c 6564 2073 696d 696c  e detailed simil
-00009060: 6172 6974 6965 7320 6265 7477 6565 6e20  arities between 
-00009070: 7265 636f 7264 7322 2222 0a20 2020 2020  records""".     
-00009080: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00009090: 2020 2020 6175 7468 6f72 5f73 696d 696c      author_simil
-000090a0: 6172 6974 7920 3d20 6675 7a7a 2e72 6174  arity = fuzz.rat
-000090b0: 696f 2872 6563 6f72 645f 615b 2261 7574  io(record_a["aut
-000090c0: 686f 7222 5d2c 2072 6563 6f72 645f 625b  hor"], record_b[
-000090d0: 2261 7574 686f 7222 5d29 202f 2031 3030  "author"]) / 100
-000090e0: 0a0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
-000090f0: 746c 655f 7369 6d69 6c61 7269 7479 203d  tle_similarity =
-00009100: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00009110: 2020 2066 757a 7a2e 7261 7469 6f28 0a20     fuzz.ratio(. 
-00009120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009130: 2020 2072 6563 6f72 645f 615b 2274 6974     record_a["tit
-00009140: 6c65 225d 2e6c 6f77 6572 2829 2e72 6570  le"].lower().rep
-00009150: 6c61 6365 2822 3a22 2c20 2222 292e 7265  lace(":", "").re
-00009160: 706c 6163 6528 222d 222c 2022 2229 2c0a  place("-", ""),.
-00009170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009180: 2020 2020 7265 636f 7264 5f62 5b22 7469      record_b["ti
-00009190: 746c 6522 5d2e 6c6f 7765 7228 292e 7265  tle"].lower().re
-000091a0: 706c 6163 6528 223a 222c 2022 2229 2e72  place(":", "").r
-000091b0: 6570 6c61 6365 2822 2d22 2c20 2222 292c  eplace("-", ""),
-000091c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000091d0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000091e0: 2020 202f 2031 3030 0a20 2020 2020 2020     / 100.       
-000091f0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00009200: 2020 2020 2320 7061 7274 6961 6c20 7261      # partial ra
-00009210: 7469 6f20 2863 6174 6368 696e 6720 3230  tio (catching 20
-00009220: 3130 2d31 3020 6f72 2032 3030 312d 3230  10-10 or 2001-20
-00009230: 3032 290a 2020 2020 2020 2020 2020 2020  02).            
-00009240: 7965 6172 5f73 696d 696c 6172 6974 7920  year_similarity 
-00009250: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00009260: 2020 2020 6675 7a7a 2e72 6174 696f 2873      fuzz.ratio(s
-00009270: 7472 2872 6563 6f72 645f 615b 2279 6561  tr(record_a["yea
-00009280: 7222 5d29 2c20 7374 7228 7265 636f 7264  r"]), str(record
-00009290: 5f62 5b22 7965 6172 225d 2929 202f 2031  _b["year"])) / 1
-000092a0: 3030 0a20 2020 2020 2020 2020 2020 2029  00.            )
-000092b0: 0a0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-000092c0: 746c 6574 5f73 696d 696c 6172 6974 7920  tlet_similarity 
-000092d0: 3d20 302e 300a 2020 2020 2020 2020 2020  = 0.0.          
-000092e0: 2020 6966 2072 6563 6f72 645f 625b 2263    if record_b["c
-000092f0: 6f6e 7461 696e 6572 5f74 6974 6c65 225d  ontainer_title"]
-00009300: 2061 6e64 2072 6563 6f72 645f 615b 2263   and record_a["c
-00009310: 6f6e 7461 696e 6572 5f74 6974 6c65 225d  ontainer_title"]
-00009320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009330: 2020 6f75 746c 6574 5f73 696d 696c 6172    outlet_similar
-00009340: 6974 7920 3d20 280a 2020 2020 2020 2020  ity = (.        
-00009350: 2020 2020 2020 2020 2020 2020 6675 7a7a              fuzz
-00009360: 2e72 6174 696f 2872 6563 6f72 645f 615b  .ratio(record_a[
-00009370: 2263 6f6e 7461 696e 6572 5f74 6974 6c65  "container_title
-00009380: 225d 2c20 7265 636f 7264 5f62 5b22 636f  "], record_b["co
-00009390: 6e74 6169 6e65 725f 7469 746c 6522 5d29  ntainer_title"])
-000093a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000093b0: 2020 2020 202f 2031 3030 0a20 2020 2020       / 100.     
-000093c0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000093d0: 2020 2020 2020 2020 2020 6966 2073 7472            if str
-000093e0: 2872 6563 6f72 645f 615b 226a 6f75 726e  (record_a["journ
-000093f0: 616c 225d 2920 213d 2022 6e61 6e22 3a0a  al"]) != "nan":.
-00009400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009410: 2320 4e6f 7465 3a20 666f 7220 6a6f 7572  # Note: for jour
-00009420: 6e61 6c73 2070 6170 6572 732c 2077 6520  nals papers, we 
-00009430: 6578 7065 6374 206d 6f72 6520 6465 7461  expect more deta
-00009440: 696c 730a 2020 2020 2020 2020 2020 2020  ils.            
-00009450: 2020 2020 766f 6c75 6d65 5f73 696d 696c      volume_simil
-00009460: 6172 6974 7920 3d20 280a 2020 2020 2020  arity = (.      
-00009470: 2020 2020 2020 2020 2020 2020 2020 3120                1 
-00009480: 6966 2028 7265 636f 7264 5f61 5b22 766f  if (record_a["vo
-00009490: 6c75 6d65 225d 203d 3d20 7265 636f 7264  lume"] == record
-000094a0: 5f62 5b22 766f 6c75 6d65 225d 2920 656c  _b["volume"]) el
-000094b0: 7365 2030 0a20 2020 2020 2020 2020 2020  se 0.           
-000094c0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000094d0: 2020 2020 2020 2020 6e75 6d62 6572 5f73          number_s
-000094e0: 696d 696c 6172 6974 7920 3d20 280a 2020  imilarity = (.  
-000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009500: 2020 3120 6966 2028 7265 636f 7264 5f61    1 if (record_a
-00009510: 5b22 6e75 6d62 6572 225d 203d 3d20 7265  ["number"] == re
-00009520: 636f 7264 5f62 5b22 6e75 6d62 6572 225d  cord_b["number"]
-00009530: 2920 656c 7365 2030 0a20 2020 2020 2020  ) else 0.       
-00009540: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00009550: 2020 2020 2020 2020 2020 2020 2320 7061              # pa
-00009560: 6765 2073 696d 696c 6172 6974 7920 6973  ge similarity is
-00009570: 206e 6f74 2063 6f6e 7369 6465 7265 6420   not considered 
-00009580: 6174 2074 6865 206d 6f6d 656e 742e 0a20  at the moment.. 
-00009590: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000095a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000095b0: 2023 2073 6f6d 6574 696d 6573 2c20 6f6e   # sometimes, on
-000095c0: 6c79 2074 6865 2066 6972 7374 2070 6167  ly the first pag
-000095d0: 6520 6973 2070 726f 7669 6465 642e 0a20  e is provided.. 
-000095e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000095f0: 2069 6620 7374 7228 7265 636f 7264 5f61   if str(record_a
-00009600: 5b22 7061 6765 7322 5d29 203d 3d20 226e  ["pages"]) == "n
-00009610: 616e 2220 6f72 2073 7472 2872 6563 6f72  an" or str(recor
-00009620: 645f 625b 2270 6167 6573 225d 2920 3d3d  d_b["pages"]) ==
-00009630: 2022 6e61 6e22 3a0a 2020 2020 2020 2020   "nan":.        
-00009640: 2020 2020 2020 2020 2320 2020 2020 7061          #     pa
-00009650: 6765 735f 7369 6d69 6c61 7269 7479 203d  ges_similarity =
-00009660: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00009670: 2020 2023 2065 6c73 653a 0a20 2020 2020     # else:.     
-00009680: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00009690: 2069 6620 7265 636f 7264 5f61 5b22 7061   if record_a["pa
-000096a0: 6765 7322 5d20 3d3d 2072 6563 6f72 645f  ges"] == record_
-000096b0: 625b 2270 6167 6573 225d 3a0a 2020 2020  b["pages"]:.    
-000096c0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-000096d0: 2020 2020 2020 7061 6765 735f 7369 6d69        pages_simi
-000096e0: 6c61 7269 7479 203d 2031 0a20 2020 2020  larity = 1.     
-000096f0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00009700: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00009710: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00009720: 2069 6620 7265 636f 7264 5f61 5b22 7061   if record_a["pa
-00009730: 6765 7322 5d2e 7370 6c69 7428 222d 2229  ges"].split("-")
-00009740: 5b30 5d20 3d3d 2072 6563 6f72 645f 625b  [0] == record_b[
-00009750: 2270 6167 6573 225d 2e73 706c 6974 2822  "pages"].split("
-00009760: 2d22 295b 305d 3a0a 2020 2020 2020 2020  -")[0]:.        
-00009770: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00009780: 2020 2020 2020 7061 6765 735f 7369 6d69        pages_simi
-00009790: 6c61 7269 7479 203d 2031 0a20 2020 2020  larity = 1.     
-000097a0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-000097b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000097c0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-000097d0: 2020 2020 2020 2020 7061 6765 735f 7369          pages_si
-000097e0: 6d69 6c61 7269 7479 203d 2030 0a0a 2020  milarity = 0..  
-000097f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009800: 5075 7420 6d6f 7265 2077 6569 6768 7420  Put more weight 
-00009810: 6f6e 206f 7468 6572 2066 6965 6c64 7320  on other fields 
-00009820: 6966 2074 6865 2074 6974 6c65 2069 7320  if the title is 
-00009830: 7665 7279 2063 6f6d 6d6f 6e0a 2020 2020  very common.    
-00009840: 2020 2020 2020 2020 2020 2020 2320 6965              # ie
-00009850: 2e2c 206e 6f6e 2d64 6973 7469 6e63 7469  ., non-distincti
-00009860: 7665 0a20 2020 2020 2020 2020 2020 2020  ve.             
-00009870: 2020 2023 2054 6865 206c 6973 7420 6973     # The list is
-00009880: 2062 6173 6564 206f 6e20 6120 6c61 7267   based on a larg
-00009890: 6520 6578 706f 7274 206f 6620 6469 7374  e export of dist
-000098a0: 696e 6374 2070 6170 6572 732c 2074 6162  inct papers, tab
-000098b0: 756c 6174 6564 0a20 2020 2020 2020 2020  ulated.         
-000098c0: 2020 2020 2020 2023 2061 6363 6f72 6469         # accordi
-000098d0: 6e67 2074 6f20 7469 746c 6573 2061 6e64  ng to titles and
-000098e0: 2073 6f72 7465 6420 6279 2066 7265 7175   sorted by frequ
-000098f0: 656e 6379 0a20 2020 2020 2020 2020 2020  ency.           
-00009900: 2020 2020 2069 6620 5b72 6563 6f72 645f       if [record_
-00009910: 615b 2274 6974 6c65 225d 2c20 7265 636f  a["title"], reco
-00009920: 7264 5f62 5b22 7469 746c 6522 5d5d 2069  rd_b["title"]] i
-00009930: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
-00009940: 2020 2020 2020 2020 5b22 6564 6974 6f72          ["editor
-00009950: 6961 6c22 2c20 2265 6469 746f 7269 616c  ial", "editorial
-00009960: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-00009970: 2020 2020 2020 2020 5b22 6564 6974 6f72          ["editor
-00009980: 6961 6c20 696e 7472 6f64 7563 7469 6f6e  ial introduction
-00009990: 222c 2022 6564 6974 6f72 6961 6c20 696e  ", "editorial in
-000099a0: 7472 6f64 7563 7469 6f6e 225d 2c0a 2020  troduction"],.  
-000099b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099c0: 2020 5b22 6564 6974 6f72 6961 6c20 6e6f    ["editorial no
-000099d0: 7465 7322 2c20 2265 6469 746f 7269 616c  tes", "editorial
-000099e0: 206e 6f74 6573 225d 2c0a 2020 2020 2020   notes"],.      
-000099f0: 2020 2020 2020 2020 2020 2020 2020 5b22                ["
-00009a00: 6564 6974 6f72 2773 2063 6f6d 6d65 6e74  editor's comment
-00009a10: 7322 2c20 2265 6469 746f 7227 7320 636f  s", "editor's co
-00009a20: 6d6d 656e 7473 225d 2c0a 2020 2020 2020  mments"],.      
-00009a30: 2020 2020 2020 2020 2020 2020 2020 5b22                ["
-00009a40: 626f 6f6b 2072 6576 6965 7773 222c 2022  book reviews", "
-00009a50: 626f 6f6b 2072 6576 6965 7773 225d 2c0a  book reviews"],.
-00009a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a70: 2020 2020 5b22 6564 6974 6f72 6961 6c20      ["editorial 
-00009a80: 6e6f 7465 222c 2022 6564 6974 6f72 6961  note", "editoria
-00009a90: 6c20 6e6f 7465 225d 2c0a 2020 2020 2020  l note"],.      
-00009aa0: 2020 2020 2020 2020 2020 2020 2020 5b22                ["
-00009ab0: 7265 7669 6577 6572 2061 636b 6f77 6c65  reviewer ackowle
-00009ac0: 6467 6d65 6e74 222c 2022 7265 7669 6577  dgment", "review
-00009ad0: 6572 2061 636b 6f77 6c65 6467 6d65 6e74  er ackowledgment
-00009ae0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-00009af0: 2020 2020 5d3a 0a20 2020 2020 2020 2020      ]:.         
-00009b00: 2020 2020 2020 2020 2020 2077 6569 6768             weigh
-00009b10: 7473 203d 205b 302e 3137 352c 2030 2c20  ts = [0.175, 0, 
-00009b20: 302e 3137 352c 2030 2e31 3735 2c20 302e  0.175, 0.175, 0.
-00009b30: 3237 352c 2030 2e32 5d0a 2020 2020 2020  275, 0.2].      
-00009b40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b60: 2020 2020 7765 6967 6874 7320 3d20 5b30      weights = [0
-00009b70: 2e32 2c20 302e 3235 2c20 302e 3133 2c20  .2, 0.25, 0.13, 
-00009b80: 302e 322c 2030 2e31 322c 2030 2e31 5d0a  0.2, 0.12, 0.1].
-00009b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009ba0: 2073 696d 5f6e 616d 6573 203d 205b 0a20   sim_names = [. 
-00009bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bc0: 2020 2022 6175 7468 6f72 7322 2c0a 2020     "authors",.  
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009be0: 2020 2274 6974 6c65 222c 0a20 2020 2020    "title",.     
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00009c00: 7965 6172 222c 0a20 2020 2020 2020 2020  year",.         
-00009c10: 2020 2020 2020 2020 2020 2022 6f75 746c             "outl
-00009c20: 6574 222c 0a20 2020 2020 2020 2020 2020  et",.           
-00009c30: 2020 2020 2020 2020 2022 766f 6c75 6d65           "volume
-00009c40: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00009c50: 2020 2020 2020 2022 6e75 6d62 6572 222c         "number",
-00009c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009c70: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
-00009c80: 2020 2073 696d 696c 6172 6974 6965 7320     similarities 
-00009c90: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-00009ca0: 2020 2020 2020 2020 6175 7468 6f72 5f73          author_s
-00009cb0: 696d 696c 6172 6974 792c 0a20 2020 2020  imilarity,.     
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00009cd0: 6974 6c65 5f73 696d 696c 6172 6974 792c  itle_similarity,
-00009ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009cf0: 2020 2020 2079 6561 725f 7369 6d69 6c61       year_simila
-00009d00: 7269 7479 2c0a 2020 2020 2020 2020 2020  rity,.          
-00009d10: 2020 2020 2020 2020 2020 6f75 746c 6574            outlet
-00009d20: 5f73 696d 696c 6172 6974 792c 0a20 2020  _similarity,.   
-00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d40: 2076 6f6c 756d 655f 7369 6d69 6c61 7269   volume_similari
-00009d50: 7479 2c0a 2020 2020 2020 2020 2020 2020  ty,.            
-00009d60: 2020 2020 2020 2020 6e75 6d62 6572 5f73          number_s
-00009d70: 696d 696c 6172 6974 792c 0a20 2020 2020  imilarity,.     
-00009d80: 2020 2020 2020 2020 2020 205d 0a0a 2020             ]..  
-00009d90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000061f0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00006200: 2020 2020 2023 2046 7573 6520 6265 7374       # Fuse best
+00006210: 2066 6965 6c64 7320 6966 206e 6f6e 6520   fields if none 
+00006220: 6973 2063 7572 6174 6564 0a20 2020 2020  is curated.     
+00006230: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00006240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006250: 2020 2020 2073 656c 662e 5f5f 6675 7365       self.__fuse
+00006260: 5f62 6573 745f 6669 656c 6428 0a20 2020  _best_field(.   
+00006270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006280: 2020 2020 206d 6572 6769 6e67 5f72 6563       merging_rec
+00006290: 6f72 643d 6d65 7267 696e 675f 7265 636f  ord=merging_reco
+000062a0: 7264 2c0a 2020 2020 2020 2020 2020 2020  rd,.            
+000062b0: 2020 2020 2020 2020 2020 2020 6b65 793d              key=
+000062c0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
+000062d0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000062e0: 3d73 7472 2876 616c 292c 0a20 2020 2020  =str(val),.     
+000062f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006300: 2020 2073 6f75 7263 653d 736f 7572 6365     source=source
+00006310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006320: 2020 2020 2020 2020 2020 6e6f 7465 3d6e            note=n
+00006330: 6f74 652c 0a20 2020 2020 2020 2020 2020  ote,.           
+00006340: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00006350: 2020 2020 2020 2020 2320 5061 7274 2032          # Part 2
+00006360: 3a20 6f74 6865 7220 6669 656c 6473 0a20  : other fields. 
+00006370: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00006380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006390: 2023 206b 6565 7020 6578 6973 7469 6e67   # keep existing
+000063a0: 2076 616c 7565 7320 7065 7220 6465 6661   values per defa
+000063b0: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
+000063c0: 2020 2020 6966 206b 6579 2069 6e20 7365      if key in se
+000063d0: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
+000063e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000063f0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00006400: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+00006410: 655f 6669 656c 6428 0a20 2020 2020 2020  e_field(.       
+00006420: 2020 2020 2020 2020 2020 2020 206b 6579               key
+00006430: 3d6b 6579 2c0a 2020 2020 2020 2020 2020  =key,.          
+00006440: 2020 2020 2020 2020 2020 7661 6c75 653d            value=
+00006450: 7374 7228 7661 6c29 2c0a 2020 2020 2020  str(val),.      
+00006460: 2020 2020 2020 2020 2020 2020 2020 736f                so
+00006470: 7572 6365 3d73 6f75 7263 652c 0a20 2020  urce=source,.   
+00006480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006490: 206e 6f74 653d 6e6f 7465 2c0a 2020 2020   note=note,.    
+000064a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064b0: 6b65 6570 5f73 6f75 7263 655f 6966 5f65  keep_source_if_e
+000064c0: 7175 616c 3d54 7275 652c 0a20 2020 2020  qual=True,.     
+000064d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000064e0: 7070 656e 645f 6564 6974 3d46 616c 7365  ppend_edit=False
+000064f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006500: 2020 290a 0a20 2020 2040 636c 6173 736d    )..    @classm
+00006510: 6574 686f 640a 2020 2020 6465 6620 5f5f  ethod.    def __
+00006520: 7365 6c65 6374 5f62 6573 745f 6175 7468  select_best_auth
+00006530: 6f72 280a 2020 2020 2020 2020 636c 732c  or(.        cls,
+00006540: 202a 2c20 7265 636f 7264 3a20 5265 636f   *, record: Reco
+00006550: 7264 2c20 6d65 7267 696e 675f 7265 636f  rd, merging_reco
+00006560: 7264 3a20 5265 636f 7264 2c20 7072 6566  rd: Record, pref
+00006570: 6572 7265 645f 736f 7572 6365 733a 206c  erred_sources: l
+00006580: 6973 740a 2020 2020 2920 2d3e 2073 7472  ist.    ) -> str
+00006590: 3a0a 2020 2020 2020 2020 2320 7079 6c69  :.        # pyli
+000065a0: 6e74 3a20 6469 7361 626c 653d 746f 6f2d  nt: disable=too-
+000065b0: 6d61 6e79 2d72 6574 7572 6e2d 7374 6174  many-return-stat
+000065c0: 656d 656e 7473 0a20 2020 2020 2020 2069  ements.        i
+000065d0: 6620 2263 6f6c 7265 765f 6d61 7374 6572  f "colrev_master
+000065e0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+000065f0: 206e 6f74 2069 6e20 7265 636f 7264 2e64   not in record.d
+00006600: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+00006610: 2072 6563 6f72 642e 6461 7461 5b22 636f   record.data["co
+00006620: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
+00006630: 7072 6f76 656e 616e 6365 225d 203d 207b  provenance"] = {
+00006640: 7d0a 2020 2020 2020 2020 7265 636f 7264  }.        record
+00006650: 5f61 5f70 726f 7620 3d20 7265 636f 7264  _a_prov = record
+00006660: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
+00006670: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
+00006680: 6e63 6522 5d0a 0a20 2020 2020 2020 2069  nce"]..        i
+00006690: 6620 2263 6f6c 7265 765f 6d61 7374 6572  f "colrev_master
+000066a0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+000066b0: 206e 6f74 2069 6e20 6d65 7267 696e 675f   not in merging_
+000066c0: 7265 636f 7264 2e64 6174 613a 0a20 2020  record.data:.   
+000066d0: 2020 2020 2020 2020 206d 6572 6769 6e67           merging
+000066e0: 5f72 6563 6f72 642e 6461 7461 5b22 636f  _record.data["co
+000066f0: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
+00006700: 7072 6f76 656e 616e 6365 225d 203d 207b  provenance"] = {
+00006710: 7d0a 2020 2020 2020 2020 6d65 7267 696e  }.        mergin
+00006720: 675f 7265 636f 7264 5f61 5f70 726f 7620  g_record_a_prov 
+00006730: 3d20 6d65 7267 696e 675f 7265 636f 7264  = merging_record
+00006740: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
+00006750: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
+00006760: 6e63 6522 5d0a 0a20 2020 2020 2020 2069  nce"]..        i
+00006770: 6620 2261 7574 686f 7222 2069 6e20 7265  f "author" in re
+00006780: 636f 7264 5f61 5f70 726f 7620 616e 6420  cord_a_prov and 
+00006790: 2261 7574 686f 7222 206e 6f74 2069 6e20  "author" not in 
+000067a0: 6d65 7267 696e 675f 7265 636f 7264 5f61  merging_record_a
+000067b0: 5f70 726f 763a 0a20 2020 2020 2020 2020  _prov:.         
+000067c0: 2020 2023 2050 7265 6665 7220 6e6f 6e2d     # Prefer non-
+000067d0: 6465 6665 6374 2076 6572 7369 6f6e 0a20  defect version. 
+000067e0: 2020 2020 2020 2020 2020 2069 6620 2271             if "q
+000067f0: 7561 6c69 7479 5f64 6566 6563 7422 2069  uality_defect" i
+00006800: 6e20 7265 636f 7264 5f61 5f70 726f 765b  n record_a_prov[
+00006810: 2261 7574 686f 7222 5d2e 6765 7428 226e  "author"].get("n
+00006820: 6f74 6522 2c20 2222 293a 0a20 2020 2020  ote", ""):.     
+00006830: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00006840: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
+00006850: 2e64 6174 615b 2261 7574 686f 7222 5d0a  .data["author"].
+00006860: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
+00006870: 6566 6572 2063 6f6d 706c 6574 6520 7665  efer complete ve
+00006880: 7273 696f 6e0a 2020 2020 2020 2020 2020  rsion.          
+00006890: 2020 6966 2022 696e 636f 6d70 6c65 7465    if "incomplete
+000068a0: 2220 696e 2072 6563 6f72 645f 615f 7072  " in record_a_pr
+000068b0: 6f76 5b22 6175 7468 6f72 225d 2e67 6574  ov["author"].get
+000068c0: 2822 6e6f 7465 222c 2022 2229 3a0a 2020  ("note", ""):.  
+000068d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000068e0: 7475 726e 206d 6572 6769 6e67 5f72 6563  turn merging_rec
+000068f0: 6f72 642e 6461 7461 5b22 6175 7468 6f72  ord.data["author
+00006900: 225d 0a20 2020 2020 2020 2065 6c69 6620  "].        elif 
+00006910: 2261 7574 686f 7222 2069 6e20 7265 636f  "author" in reco
+00006920: 7264 5f61 5f70 726f 7620 616e 6420 2261  rd_a_prov and "a
+00006930: 7574 686f 7222 2069 6e20 6d65 7267 696e  uthor" in mergin
+00006940: 675f 7265 636f 7264 5f61 5f70 726f 763a  g_record_a_prov:
+00006950: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
+00006960: 7265 6665 7220 6e6f 6e2d 6465 6665 6374  refer non-defect
+00006970: 2076 6572 7369 6f6e 0a20 2020 2020 2020   version.       
+00006980: 2020 2020 2069 6620 2271 7561 6c69 7479       if "quality
+00006990: 5f64 6566 6563 7422 2069 6e20 7265 636f  _defect" in reco
+000069a0: 7264 5f61 5f70 726f 765b 2261 7574 686f  rd_a_prov["autho
+000069b0: 7222 5d2e 6765 7428 0a20 2020 2020 2020  r"].get(.       
+000069c0: 2020 2020 2020 2020 2022 6e6f 7465 222c           "note",
+000069d0: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
+000069e0: 2920 616e 6420 2271 7561 6c69 7479 5f64  ) and "quality_d
+000069f0: 6566 6563 7422 206e 6f74 2069 6e20 6d65  efect" not in me
+00006a00: 7267 696e 675f 7265 636f 7264 5f61 5f70  rging_record_a_p
+00006a10: 726f 765b 2261 7574 686f 7222 5d2e 6765  rov["author"].ge
+00006a20: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00006a30: 2020 2022 6e6f 7465 222c 2022 220a 2020     "note", "".  
+00006a40: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00006a50: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00006a60: 7572 6e20 6d65 7267 696e 675f 7265 636f  urn merging_reco
+00006a70: 7264 2e64 6174 615b 2261 7574 686f 7222  rd.data["author"
+00006a80: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+00006a90: 2050 7265 6665 7220 636f 6d70 6c65 7465   Prefer complete
+00006aa0: 2076 6572 7369 6f6e 0a20 2020 2020 2020   version.       
+00006ab0: 2020 2020 2069 6620 2269 6e63 6f6d 706c       if "incompl
+00006ac0: 6574 6522 2069 6e20 7265 636f 7264 5f61  ete" in record_a
+00006ad0: 5f70 726f 765b 2261 7574 686f 7222 5d2e  _prov["author"].
+00006ae0: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
+00006af0: 2020 2020 2022 6e6f 7465 222c 2022 220a       "note", "".
+00006b00: 2020 2020 2020 2020 2020 2020 2920 616e              ) an
+00006b10: 6420 2269 6e63 6f6d 706c 6574 6522 206e  d "incomplete" n
+00006b20: 6f74 2069 6e20 6d65 7267 696e 675f 7265  ot in merging_re
+00006b30: 636f 7264 5f61 5f70 726f 765b 2261 7574  cord_a_prov["aut
+00006b40: 686f 7222 5d2e 6765 7428 226e 6f74 6522  hor"].get("note"
+00006b50: 2c20 2222 293a 0a20 2020 2020 2020 2020  , ""):.         
+00006b60: 2020 2020 2020 2072 6574 7572 6e20 6d65         return me
+00006b70: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
+00006b80: 615b 2261 7574 686f 7222 5d0a 0a20 2020  a["author"]..   
+00006b90: 2020 2020 2069 6620 6c65 6e28 7265 636f       if len(reco
+00006ba0: 7264 2e64 6174 615b 2261 7574 686f 7222  rd.data["author"
+00006bb0: 5d29 203e 2030 2061 6e64 206c 656e 286d  ]) > 0 and len(m
+00006bc0: 6572 6769 6e67 5f72 6563 6f72 642e 6461  erging_record.da
+00006bd0: 7461 5b22 6175 7468 6f72 225d 2920 3e20  ta["author"]) > 
+00006be0: 303a 0a20 2020 2020 2020 2020 2020 2064  0:.            d
+00006bf0: 6566 6175 6c74 5f6d 6f73 746c 795f 7570  efault_mostly_up
+00006c00: 7065 7220 3d20 280a 2020 2020 2020 2020  per = (.        
+00006c10: 2020 2020 2020 2020 636f 6c72 6576 2e65          colrev.e
+00006c20: 6e76 2e75 7469 6c73 2e70 6572 6365 6e74  nv.utils.percent
+00006c30: 5f75 7070 6572 5f63 6861 7273 2872 6563  _upper_chars(rec
+00006c40: 6f72 642e 6461 7461 5b22 6175 7468 6f72  ord.data["author
+00006c50: 225d 2920 3e20 302e 380a 2020 2020 2020  "]) > 0.8.      
+00006c60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006c70: 2020 2020 6361 6e64 6964 6174 655f 6d6f      candidate_mo
+00006c80: 7374 6c79 5f75 7070 6572 203d 2028 0a20  stly_upper = (. 
+00006c90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006ca0: 6f6c 7265 762e 656e 762e 7574 696c 732e  olrev.env.utils.
+00006cb0: 7065 7263 656e 745f 7570 7065 725f 6368  percent_upper_ch
+00006cc0: 6172 7328 6d65 7267 696e 675f 7265 636f  ars(merging_reco
+00006cd0: 7264 2e64 6174 615b 2261 7574 686f 7222  rd.data["author"
+00006ce0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00006cf0: 2020 203e 2030 2e38 0a20 2020 2020 2020     > 0.8.       
+00006d00: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00006d10: 2020 2020 2320 5072 6566 6572 2074 6974      # Prefer tit
+00006d20: 6c65 2063 6173 6520 286e 6f74 2061 6c6c  le case (not all
+00006d30: 2d63 6170 7329 0a20 2020 2020 2020 2020  -caps).         
+00006d40: 2020 2069 6620 6465 6661 756c 745f 6d6f     if default_mo
+00006d50: 7374 6c79 5f75 7070 6572 2061 6e64 206e  stly_upper and n
+00006d60: 6f74 2063 616e 6469 6461 7465 5f6d 6f73  ot candidate_mos
+00006d70: 746c 795f 7570 7065 723a 0a20 2020 2020  tly_upper:.     
+00006d80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00006d90: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
+00006da0: 2e64 6174 615b 2261 7574 686f 7222 5d0a  .data["author"].
+00006db0: 0a20 2020 2020 2020 2023 2050 7265 6665  .        # Prefe
+00006dc0: 7220 736f 7572 6365 730a 2020 2020 2020  r sources.      
+00006dd0: 2020 6966 2022 6175 7468 6f72 2220 696e    if "author" in
+00006de0: 206d 6572 6769 6e67 5f72 6563 6f72 645f   merging_record_
+00006df0: 615f 7072 6f76 3a0a 2020 2020 2020 2020  a_prov:.        
+00006e00: 2020 2020 6966 2061 6e79 280a 2020 2020      if any(.    
+00006e10: 2020 2020 2020 2020 2020 2020 7820 696e              x in
+00006e20: 206d 6572 6769 6e67 5f72 6563 6f72 645f   merging_record_
+00006e30: 615f 7072 6f76 5b22 6175 7468 6f72 225d  a_prov["author"]
+00006e40: 5b22 736f 7572 6365 225d 0a20 2020 2020  ["source"].     
+00006e50: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
+00006e60: 2069 6e20 7072 6566 6572 7265 645f 736f   in preferred_so
+00006e70: 7572 6365 730a 2020 2020 2020 2020 2020  urces.          
+00006e80: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00006e90: 2020 2020 2072 6574 7572 6e20 6d65 7267       return merg
+00006ea0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
+00006eb0: 2261 7574 686f 7222 5d0a 2020 2020 2020  "author"].      
+00006ec0: 2020 7265 7475 726e 2072 6563 6f72 642e    return record.
+00006ed0: 6461 7461 5b22 6175 7468 6f72 225d 0a0a  data["author"]..
+00006ee0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00006ef0: 0a20 2020 2064 6566 205f 5f73 656c 6563  .    def __selec
+00006f00: 745f 6265 7374 5f70 6167 6573 280a 2020  t_best_pages(.  
+00006f10: 2020 2020 2020 636c 732c 0a20 2020 2020        cls,.     
+00006f20: 2020 202a 2c0a 2020 2020 2020 2020 7265     *,.        re
+00006f30: 636f 7264 3a20 5265 636f 7264 2c0a 2020  cord: Record,.  
+00006f40: 2020 2020 2020 6d65 7267 696e 675f 7265        merging_re
+00006f50: 636f 7264 3a20 5265 636f 7264 2c0a 2020  cord: Record,.  
+00006f60: 2020 2020 2020 7072 6566 6572 7265 645f        preferred_
+00006f70: 736f 7572 6365 733a 206c 6973 742c 2020  sources: list,  
+00006f80: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
+00006f90: 653d 756e 7573 6564 2d61 7267 756d 656e  e=unused-argumen
+00006fa0: 740a 2020 2020 2920 2d3e 2073 7472 3a0a  t.    ) -> str:.
+00006fb0: 2020 2020 2020 2020 6265 7374 5f70 6167          best_pag
+00006fc0: 6573 203d 2072 6563 6f72 642e 6461 7461  es = record.data
+00006fd0: 5b22 7061 6765 7322 5d0a 2020 2020 2020  ["pages"].      
+00006fe0: 2020 6966 2022 2d2d 2220 696e 206d 6572    if "--" in mer
+00006ff0: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
+00007000: 5b22 7061 6765 7322 5d20 616e 6420 222d  ["pages"] and "-
+00007010: 2d22 206e 6f74 2069 6e20 7265 636f 7264  -" not in record
+00007020: 2e64 6174 615b 2270 6167 6573 225d 3a0a  .data["pages"]:.
+00007030: 2020 2020 2020 2020 2020 2020 6265 7374              best
+00007040: 5f70 6167 6573 203d 206d 6572 6769 6e67  _pages = merging
+00007050: 5f72 6563 6f72 642e 6461 7461 5b22 7061  _record.data["pa
+00007060: 6765 7322 5d0a 2020 2020 2020 2020 7265  ges"].        re
+00007070: 7475 726e 2062 6573 745f 7061 6765 730a  turn best_pages.
+00007080: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00007090: 640a 2020 2020 6465 6620 5f5f 7365 6c65  d.    def __sele
+000070a0: 6374 5f62 6573 745f 7469 746c 6528 0a20  ct_best_title(. 
+000070b0: 2020 2020 2020 2063 6c73 2c0a 2020 2020         cls,.    
+000070c0: 2020 2020 2a2c 0a20 2020 2020 2020 2072      *,.        r
+000070d0: 6563 6f72 643a 2052 6563 6f72 642c 0a20  ecord: Record,. 
+000070e0: 2020 2020 2020 206d 6572 6769 6e67 5f72         merging_r
+000070f0: 6563 6f72 643a 2052 6563 6f72 642c 0a20  ecord: Record,. 
+00007100: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
+00007110: 5f73 6f75 7263 6573 3a20 6c69 7374 2c20  _sources: list, 
+00007120: 2023 2070 796c 696e 743a 2064 6973 6162   # pylint: disab
+00007130: 6c65 3d75 6e75 7365 642d 6172 6775 6d65  le=unused-argume
+00007140: 6e74 0a20 2020 2029 202d 3e20 7374 723a  nt.    ) -> str:
+00007150: 0a20 2020 2020 2020 2064 6566 6175 6c74  .        default
+00007160: 203d 2072 6563 6f72 642e 6461 7461 5b22   = record.data["
+00007170: 7469 746c 6522 5d0a 2020 2020 2020 2020  title"].        
+00007180: 6361 6e64 6964 6174 6520 3d20 6d65 7267  candidate = merg
+00007190: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
+000071a0: 2274 6974 6c65 225d 0a20 2020 2020 2020  "title"].       
+000071b0: 2062 6573 745f 7469 746c 6520 3d20 7265   best_title = re
+000071c0: 636f 7264 2e64 6174 615b 2274 6974 6c65  cord.data["title
+000071d0: 225d 0a0a 2020 2020 2020 2020 2320 4e6f  "]..        # No
+000071e0: 7465 203a 2061 766f 6964 2073 7769 7463  te : avoid switc
+000071f0: 6869 6e67 2074 6974 6c65 730a 2020 2020  hing titles.    
+00007200: 2020 2020 6966 2064 6566 6175 6c74 2e72      if default.r
+00007210: 6570 6c61 6365 2822 202d 2022 2c20 223a  eplace(" - ", ":
+00007220: 2022 2920 3d3d 2063 616e 6469 6461 7465   ") == candidate
+00007230: 2e72 6570 6c61 6365 2822 202d 2022 2c20  .replace(" - ", 
+00007240: 223a 2022 293a 0a20 2020 2020 2020 2020  ": "):.         
+00007250: 2020 2072 6574 7572 6e20 6465 6661 756c     return defaul
+00007260: 740a 0a20 2020 2020 2020 2064 6566 6175  t..        defau
+00007270: 6c74 5f75 7070 6572 203d 2063 6f6c 7265  lt_upper = colre
+00007280: 762e 656e 762e 7574 696c 732e 7065 7263  v.env.utils.perc
+00007290: 656e 745f 7570 7065 725f 6368 6172 7328  ent_upper_chars(
+000072a0: 6465 6661 756c 7429 0a20 2020 2020 2020  default).       
+000072b0: 2063 616e 6469 6461 7465 5f75 7070 6572   candidate_upper
+000072c0: 203d 2063 6f6c 7265 762e 656e 762e 7574   = colrev.env.ut
+000072d0: 696c 732e 7065 7263 656e 745f 7570 7065  ils.percent_uppe
+000072e0: 725f 6368 6172 7328 6361 6e64 6964 6174  r_chars(candidat
+000072f0: 6529 0a0a 2020 2020 2020 2020 6966 2063  e)..        if c
+00007300: 616e 6469 6461 7465 5b2d 315d 206e 6f74  andidate[-1] not
+00007310: 2069 6e20 5b22 2a22 2c20 2231 222c 2022   in ["*", "1", "
+00007320: 3222 5d3a 0a20 2020 2020 2020 2020 2020  2"]:.           
+00007330: 2023 2052 656c 6174 6976 656c 7920 7369   # Relatively si
+00007340: 6d70 6c65 2072 756c 652e 2e2e 0a20 2020  mple rule....   
+00007350: 2020 2020 2020 2020 2023 2063 6174 6368           # catch
+00007360: 6573 2063 6173 6573 2077 6865 6e20 6465  es cases when de
+00007370: 6661 756c 7420 6973 2061 6c6c 2075 7070  fault is all upp
+00007380: 6572 206f 7220 7469 746c 6520 6361 7365  er or title case
+00007390: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000073a0: 6465 6661 756c 745f 7570 7065 7220 3e20  default_upper > 
+000073b0: 6361 6e64 6964 6174 655f 7570 7065 723a  candidate_upper:
+000073c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000073d0: 2062 6573 745f 7469 746c 6520 3d20 6361   best_title = ca
+000073e0: 6e64 6964 6174 650a 2020 2020 2020 2020  ndidate.        
+000073f0: 7265 7475 726e 2062 6573 745f 7469 746c  return best_titl
+00007400: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
+00007410: 686f 640a 2020 2020 6465 6620 5f5f 7365  hod.    def __se
+00007420: 6c65 6374 5f62 6573 745f 6a6f 7572 6e61  lect_best_journa
+00007430: 6c28 0a20 2020 2020 2020 2063 6c73 2c0a  l(.        cls,.
+00007440: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+00007450: 2020 2072 6563 6f72 643a 2052 6563 6f72     record: Recor
+00007460: 642c 0a20 2020 2020 2020 206d 6572 6769  d,.        mergi
+00007470: 6e67 5f72 6563 6f72 643a 2052 6563 6f72  ng_record: Recor
+00007480: 642c 0a20 2020 2020 2020 2070 7265 6665  d,.        prefe
+00007490: 7272 6564 5f73 6f75 7263 6573 3a20 6c69  rred_sources: li
+000074a0: 7374 2c20 2023 2070 796c 696e 743a 2064  st,  # pylint: d
+000074b0: 6973 6162 6c65 3d75 6e75 7365 642d 6172  isable=unused-ar
+000074c0: 6775 6d65 6e74 0a20 2020 2029 202d 3e20  gument.    ) -> 
+000074d0: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
+000074e0: 7572 6e20 636c 732e 5f5f 7365 6c65 6374  urn cls.__select
+000074f0: 5f62 6573 745f 636f 6e74 6169 6e65 725f  _best_container_
+00007500: 7469 746c 6528 0a20 2020 2020 2020 2020  title(.         
+00007510: 2020 2064 6566 6175 6c74 3d72 6563 6f72     default=recor
+00007520: 642e 6461 7461 5b22 6a6f 7572 6e61 6c22  d.data["journal"
+00007530: 5d2c 2063 616e 6469 6461 7465 3d6d 6572  ], candidate=mer
+00007540: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
+00007550: 5b22 6a6f 7572 6e61 6c22 5d0a 2020 2020  ["journal"].    
+00007560: 2020 2020 290a 0a20 2020 2040 636c 6173      )..    @clas
+00007570: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00007580: 5f5f 7365 6c65 6374 5f62 6573 745f 626f  __select_best_bo
+00007590: 6f6b 7469 746c 6528 0a20 2020 2020 2020  oktitle(.       
+000075a0: 2063 6c73 2c0a 2020 2020 2020 2020 2a2c   cls,.        *,
+000075b0: 0a20 2020 2020 2020 2072 6563 6f72 643a  .        record:
+000075c0: 2052 6563 6f72 642c 0a20 2020 2020 2020   Record,.       
+000075d0: 206d 6572 6769 6e67 5f72 6563 6f72 643a   merging_record:
+000075e0: 2052 6563 6f72 642c 0a20 2020 2020 2020   Record,.       
+000075f0: 2070 7265 6665 7272 6564 5f73 6f75 7263   preferred_sourc
+00007600: 6573 3a20 6c69 7374 2c20 2023 2070 796c  es: list,  # pyl
+00007610: 696e 743a 2064 6973 6162 6c65 3d75 6e75  int: disable=unu
+00007620: 7365 642d 6172 6775 6d65 6e74 0a20 2020  sed-argument.   
+00007630: 2029 202d 3e20 7374 723a 0a20 2020 2020   ) -> str:.     
+00007640: 2020 2072 6574 7572 6e20 636c 732e 5f5f     return cls.__
+00007650: 7365 6c65 6374 5f62 6573 745f 636f 6e74  select_best_cont
+00007660: 6169 6e65 725f 7469 746c 6528 0a20 2020  ainer_title(.   
+00007670: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00007680: 3d72 6563 6f72 642e 6461 7461 5b22 626f  =record.data["bo
+00007690: 6f6b 7469 746c 6522 5d2c 2063 616e 6469  oktitle"], candi
+000076a0: 6461 7465 3d6d 6572 6769 6e67 5f72 6563  date=merging_rec
+000076b0: 6f72 642e 6461 7461 5b22 626f 6f6b 7469  ord.data["bookti
+000076c0: 746c 6522 5d0a 2020 2020 2020 2020 290a  tle"].        ).
+000076d0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+000076e0: 640a 2020 2020 6465 6620 5f5f 7365 6c65  d.    def __sele
+000076f0: 6374 5f62 6573 745f 636f 6e74 6169 6e65  ct_best_containe
+00007700: 725f 7469 746c 6528 636c 732c 202a 2c20  r_title(cls, *, 
+00007710: 6465 6661 756c 743a 2073 7472 2c20 6361  default: str, ca
+00007720: 6e64 6964 6174 653a 2073 7472 2920 2d3e  ndidate: str) ->
+00007730: 2073 7472 3a0a 2020 2020 2020 2020 6265   str:.        be
+00007740: 7374 5f6a 6f75 726e 616c 203d 2064 6566  st_journal = def
+00007750: 6175 6c74 0a0a 2020 2020 2020 2020 6465  ault..        de
+00007760: 6661 756c 745f 7570 7065 7220 3d20 636f  fault_upper = co
+00007770: 6c72 6576 2e65 6e76 2e75 7469 6c73 2e70  lrev.env.utils.p
+00007780: 6572 6365 6e74 5f75 7070 6572 5f63 6861  ercent_upper_cha
+00007790: 7273 2864 6566 6175 6c74 290a 2020 2020  rs(default).    
+000077a0: 2020 2020 6361 6e64 6964 6174 655f 7570      candidate_up
+000077b0: 7065 7220 3d20 636f 6c72 6576 2e65 6e76  per = colrev.env
+000077c0: 2e75 7469 6c73 2e70 6572 6365 6e74 5f75  .utils.percent_u
+000077d0: 7070 6572 5f63 6861 7273 2863 616e 6469  pper_chars(candi
+000077e0: 6461 7465 290a 0a20 2020 2020 2020 2023  date)..        #
+000077f0: 2053 696d 706c 6520 6865 7572 6973 7469   Simple heuristi
+00007800: 6320 746f 2061 766f 6964 2061 6262 7265  c to avoid abbre
+00007810: 7669 6174 696f 6e73 0a20 2020 2020 2020  viations.       
+00007820: 2069 6620 222e 2220 696e 2064 6566 6175   if "." in defau
+00007830: 6c74 2061 6e64 2022 2e22 206e 6f74 2069  lt and "." not i
+00007840: 6e20 6361 6e64 6964 6174 653a 0a20 2020  n candidate:.   
+00007850: 2020 2020 2020 2020 2062 6573 745f 6a6f           best_jo
+00007860: 7572 6e61 6c20 3d20 6361 6e64 6964 6174  urnal = candidat
+00007870: 650a 2020 2020 2020 2020 2320 5265 6c61  e.        # Rela
+00007880: 7469 7665 6c79 2073 696d 706c 6520 7275  tively simple ru
+00007890: 6c65 2e2e 2e0a 2020 2020 2020 2020 2320  le....        # 
+000078a0: 6361 7463 6865 7320 6361 7365 7320 7768  catches cases wh
+000078b0: 656e 2064 6566 6175 6c74 2069 7320 616c  en default is al
+000078c0: 6c20 7570 7065 7220 6f72 2074 6974 6c65  l upper or title
+000078d0: 2063 6173 650a 2020 2020 2020 2020 6966   case.        if
+000078e0: 2064 6566 6175 6c74 5f75 7070 6572 203e   default_upper >
+000078f0: 2063 616e 6469 6461 7465 5f75 7070 6572   candidate_upper
+00007900: 3a0a 2020 2020 2020 2020 2020 2020 6265  :.            be
+00007910: 7374 5f6a 6f75 726e 616c 203d 2063 616e  st_journal = can
+00007920: 6469 6461 7465 0a20 2020 2020 2020 2072  didate.        r
+00007930: 6574 7572 6e20 6265 7374 5f6a 6f75 726e  eturn best_journ
+00007940: 616c 0a0a 2020 2020 6465 6620 5f5f 6675  al..    def __fu
+00007950: 7365 5f62 6573 745f 6669 656c 6428 0a20  se_best_field(. 
+00007960: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00007970: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
+00007980: 6d65 7267 696e 675f 7265 636f 7264 3a20  merging_record: 
+00007990: 5265 636f 7264 2c0a 2020 2020 2020 2020  Record,.        
+000079a0: 6b65 793a 2073 7472 2c0a 2020 2020 2020  key: str,.      
+000079b0: 2020 7661 6c3a 2073 7472 2c0a 2020 2020    val: str,.    
+000079c0: 2020 2020 736f 7572 6365 3a20 7374 722c      source: str,
+000079d0: 0a20 2020 2020 2020 206e 6f74 653a 2073  .        note: s
+000079e0: 7472 2c20 2023 2070 796c 696e 743a 2064  tr,  # pylint: d
+000079f0: 6973 6162 6c65 3d75 6e75 7365 642d 6172  isable=unused-ar
+00007a00: 6775 6d65 6e74 0a20 2020 2029 202d 3e20  gument.    ) -> 
+00007a10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2320  None:.        # 
+00007a20: 4e6f 7465 203a 2074 6865 2061 7373 756d  Note : the assum
+00007a30: 7074 696f 6e20 6973 2074 6861 7420 7765  ption is that we
+00007a40: 206e 6565 6420 6d61 7374 6572 6461 7461   need masterdata
+00007a50: 5f70 726f 7665 6e61 6e63 6520 6e6f 7465  _provenance note
+00007a60: 730a 2020 2020 2020 2020 2320 6f6e 6c79  s.        # only
+00007a70: 2066 6f72 2061 7574 686f 7273 0a0a 2020   for authors..  
+00007a80: 2020 2020 2020 6375 7374 6f6d 5f66 6965        custom_fie
+00007a90: 6c64 5f73 656c 6563 746f 7273 203d 207b  ld_selectors = {
+00007aa0: 0a20 2020 2020 2020 2020 2020 2022 6175  .            "au
+00007ab0: 7468 6f72 223a 2073 656c 662e 5f5f 7365  thor": self.__se
+00007ac0: 6c65 6374 5f62 6573 745f 6175 7468 6f72  lect_best_author
+00007ad0: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
+00007ae0: 6167 6573 223a 2073 656c 662e 5f5f 7365  ages": self.__se
+00007af0: 6c65 6374 5f62 6573 745f 7061 6765 732c  lect_best_pages,
+00007b00: 0a20 2020 2020 2020 2020 2020 2022 7469  .            "ti
+00007b10: 746c 6522 3a20 7365 6c66 2e5f 5f73 656c  tle": self.__sel
+00007b20: 6563 745f 6265 7374 5f74 6974 6c65 2c0a  ect_best_title,.
+00007b30: 2020 2020 2020 2020 2020 2020 226a 6f75              "jou
+00007b40: 726e 616c 223a 2073 656c 662e 5f5f 7365  rnal": self.__se
+00007b50: 6c65 6374 5f62 6573 745f 6a6f 7572 6e61  lect_best_journa
+00007b60: 6c2c 0a20 2020 2020 2020 2020 2020 2022  l,.            "
+00007b70: 626f 6f6b 7469 746c 6522 3a20 7365 6c66  booktitle": self
+00007b80: 2e5f 5f73 656c 6563 745f 6265 7374 5f62  .__select_best_b
+00007b90: 6f6f 6b74 6974 6c65 2c0a 2020 2020 2020  ooktitle,.      
+00007ba0: 2020 7d0a 0a20 2020 2020 2020 2069 6620    }..        if 
+00007bb0: 6b65 7920 696e 2063 7573 746f 6d5f 6669  key in custom_fi
+00007bc0: 656c 645f 7365 6c65 6374 6f72 733a 0a20  eld_selectors:. 
+00007bd0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
+00007be0: 7920 696e 2073 656c 662e 6461 7461 3a0a  y in self.data:.
+00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c00: 6265 7374 5f76 616c 7565 203d 2063 7573  best_value = cus
+00007c10: 746f 6d5f 6669 656c 645f 7365 6c65 6374  tom_field_select
+00007c20: 6f72 735b 6b65 795d 280a 2020 2020 2020  ors[key](.      
+00007c30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00007c40: 636f 7264 3d73 656c 662c 0a20 2020 2020  cord=self,.     
+00007c50: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00007c60: 6572 6769 6e67 5f72 6563 6f72 643d 6d65  erging_record=me
+00007c70: 7267 696e 675f 7265 636f 7264 2c0a 2020  rging_record,.  
+00007c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c90: 2020 7072 6566 6572 7265 645f 736f 7572    preferred_sour
+00007ca0: 6365 733d 7365 6c66 2e70 7265 6665 7272  ces=self.preferr
+00007cb0: 6564 5f73 6f75 7263 6573 2c0a 2020 2020  ed_sources,.    
+00007cc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007cd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00007ce0: 2073 656c 662e 6461 7461 5b6b 6579 5d20   self.data[key] 
+00007cf0: 213d 2062 6573 745f 7661 6c75 653a 0a20  != best_value:. 
+00007d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d10: 2020 2073 656c 662e 7570 6461 7465 5f66     self.update_f
+00007d20: 6965 6c64 280a 2020 2020 2020 2020 2020  ield(.          
+00007d30: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+00007d40: 793d 6b65 792c 2076 616c 7565 3d62 6573  y=key, value=bes
+00007d50: 745f 7661 6c75 652c 2073 6f75 7263 653d  t_value, source=
+00007d60: 736f 7572 6365 2c20 6170 7065 6e64 5f65  source, append_e
+00007d70: 6469 743d 4661 6c73 650a 2020 2020 2020  dit=False.      
+00007d80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00007d90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00007da0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007db0: 2020 7365 6c66 2e75 7064 6174 655f 6669    self.update_fi
+00007dc0: 656c 6428 6b65 793d 6b65 792c 2076 616c  eld(key=key, val
+00007dd0: 7565 3d76 616c 2c20 736f 7572 6365 3d73  ue=val, source=s
+00007de0: 6f75 7263 652c 2061 7070 656e 645f 6564  ource, append_ed
+00007df0: 6974 3d46 616c 7365 290a 0a20 2020 2020  it=False)..     
+00007e00: 2020 2065 6c69 6620 6b65 7920 3d3d 2022     elif key == "
+00007e10: 6669 6c65 223a 0a20 2020 2020 2020 2020  file":.         
+00007e20: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
+00007e30: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00007e40: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00007e50: 615b 6b65 795d 203d 2073 656c 662e 6461  a[key] = self.da
+00007e60: 7461 5b6b 6579 5d20 2b20 223b 2220 2b20  ta[key] + ";" + 
+00007e70: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+00007e80: 6174 612e 6765 7428 6b65 792c 2022 2229  ata.get(key, "")
+00007e90: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00007ea0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00007eb0: 2020 2073 656c 662e 6461 7461 5b6b 6579     self.data[key
+00007ec0: 5d20 3d20 6d65 7267 696e 675f 7265 636f  ] = merging_reco
+00007ed0: 7264 2e64 6174 615b 6b65 795d 0a20 2020  rd.data[key].   
+00007ee0: 2020 2020 2065 6c69 6620 6b65 7920 696e       elif key in
+00007ef0: 205b 2275 726c 222c 2022 6c69 6e6b 225d   ["url", "link"]
+00007f00: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00007f10: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00007f20: 2020 206b 6579 2069 6e20 7365 6c66 2e64     key in self.d
+00007f30: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
+00007f40: 2020 2020 616e 6420 7365 6c66 2e64 6174      and self.dat
+00007f50: 615b 6b65 795d 2e72 7374 7269 7028 222f  a[key].rstrip("/
+00007f60: 2229 2021 3d20 6d65 7267 696e 675f 7265  ") != merging_re
+00007f70: 636f 7264 2e64 6174 615b 6b65 795d 2e72  cord.data[key].r
+00007f80: 7374 7269 7028 222f 2229 0a20 2020 2020  strip("/").     
+00007f90: 2020 2020 2020 2020 2020 2061 6e64 2022             and "
+00007fa0: 6874 7470 7322 206e 6f74 2069 6e20 7365  https" not in se
+00007fb0: 6c66 2e64 6174 615b 6b65 795d 0a20 2020  lf.data[key].   
+00007fc0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00007fd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007fe0: 2e75 7064 6174 655f 6669 656c 6428 6b65  .update_field(ke
+00007ff0: 793d 6b65 792c 2076 616c 7565 3d76 616c  y=key, value=val
+00008000: 2c20 736f 7572 6365 3d73 6f75 7263 652c  , source=source,
+00008010: 2061 7070 656e 645f 6564 6974 3d46 616c   append_edit=Fal
+00008020: 7365 290a 0a20 2020 2020 2020 2065 6c69  se)..        eli
+00008030: 6620 2255 4e4b 4e4f 574e 2220 3d3d 2073  f "UNKNOWN" == s
+00008040: 656c 662e 6461 7461 2e67 6574 280a 2020  elf.data.get(.  
+00008050: 2020 2020 2020 2020 2020 6b65 792c 2022            key, "
+00008060: 220a 2020 2020 2020 2020 2920 616e 6420  ".        ) and 
+00008070: 2255 4e4b 4e4f 574e 2220 213d 206d 6572  "UNKNOWN" != mer
+00008080: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
+00008090: 2e67 6574 286b 6579 2c20 2222 293a 0a20  .get(key, ""):. 
+000080a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000080b0: 6461 7461 5b6b 6579 5d20 3d20 6d65 7267  data[key] = merg
+000080c0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
+000080d0: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
+000080e0: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
+000080f0: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
+00008100: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
+00008110: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+00008120: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00008130: 656e 616e 6365 286b 6579 3d6b 6579 2c20  enance(key=key, 
+00008140: 736f 7572 6365 3d73 6f75 7263 6529 0a20  source=source). 
+00008150: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00008160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008170: 2073 656c 662e 6164 645f 6461 7461 5f70   self.add_data_p
+00008180: 726f 7665 6e61 6e63 6528 6b65 793d 6b65  rovenance(key=ke
+00008190: 792c 2073 6f75 7263 653d 736f 7572 6365  y, source=source
+000081a0: 290a 0a20 2020 2020 2020 2023 2065 6c69  )..        # eli
+000081b0: 6620 6d65 7267 696e 675f 7265 636f 7264  f merging_record
+000081c0: 2e64 6174 612e 6765 7428 6b65 792c 2022  .data.get(key, "
+000081d0: 554e 4b4e 4f57 4e22 2920 3d3d 2022 554e  UNKNOWN") == "UN
+000081e0: 4b4e 4f57 4e22 3a0a 2020 2020 2020 2020  KNOWN":.        
+000081f0: 2320 2020 2020 7061 7373 0a20 2020 2020  #     pass.     
+00008200: 2020 2023 204e 6f74 6520 3a20 7468 6520     # Note : the 
+00008210: 666f 6c6c 6f77 696e 6720 6973 2064 6561  following is dea
+00008220: 6374 6976 6174 6564 2074 6f20 6176 6f69  ctivated to avoi
+00008230: 6420 6672 6571 7565 6e74 2063 6861 6e67  d frequent chang
+00008240: 6573 2069 6e20 6d65 7267 6564 2072 6563  es in merged rec
+00008250: 6f72 6473 0a20 2020 2020 2020 2023 2065  ords.        # e
+00008260: 6c73 653a 0a20 2020 2020 2020 2023 2020  lse:.        #  
+00008270: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00008280: 2320 2020 2020 2020 2020 6966 206b 6579  #         if key
+00008290: 2069 6e20 7365 6c66 2e69 6465 6e74 6966   in self.identif
+000082a0: 7969 6e67 5f66 6965 6c64 5f6b 6579 733a  ying_field_keys:
+000082b0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+000082c0: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
+000082d0: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+000082e0: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+000082f0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00008300: 6522 5d5b 6b65 795d 5b0a 2020 2020 2020  e"][key][.      
+00008310: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00008320: 2020 2020 2273 6f75 7263 6522 0a20 2020      "source".   
+00008330: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+00008340: 2020 205d 0a20 2020 2020 2020 2023 2020     ].        #  
+00008350: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00008360: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+00008370: 2020 2073 6f75 7263 6520 3d20 6d65 7267     source = merg
+00008380: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
+00008390: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
+000083a0: 7665 6e61 6e63 6522 5d5b 6b65 795d 5b0a  venance"][key][.
+000083b0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+000083c0: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+000083d0: 6522 0a20 2020 2020 2020 2023 2020 2020  e".        #    
+000083e0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+000083f0: 2020 2023 2020 2020 2065 7863 6570 7420     #     except 
+00008400: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
+00008410: 2020 2320 2020 2020 2020 2020 7061 7373    #         pass
+00008420: 0a20 2020 2020 2020 2023 2069 6620 7661  .        # if va
+00008430: 6c20 213d 2073 7472 286d 6572 6769 6e67  l != str(merging
+00008440: 5f72 6563 6f72 642e 6461 7461 5b6b 6579  _record.data[key
+00008450: 5d29 3a0a 2020 2020 2020 2020 2320 2020  ]):.        #   
+00008460: 2020 7365 6c66 2e75 7064 6174 655f 6669    self.update_fi
+00008470: 656c 6428 0a20 2020 2020 2020 2023 2020  eld(.        #  
+00008480: 2020 2020 2020 206b 6579 3d6b 6579 2c0a         key=key,.
+00008490: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+000084a0: 2020 7661 6c75 653d 7374 7228 6d65 7267    value=str(merg
+000084b0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
+000084c0: 6b65 795d 292c 0a20 2020 2020 2020 2023  key]),.        #
+000084d0: 2020 2020 2020 2020 2073 6f75 7263 653d           source=
+000084e0: 736f 7572 6365 2c0a 2020 2020 2020 2020  source,.        
+000084f0: 2320 2020 2020 2020 2020 6e6f 7465 3d6e  #         note=n
+00008500: 6f74 652c 0a20 2020 2020 2020 2023 2020  ote,.        #  
+00008510: 2020 2029 0a20 2020 2020 2020 2023 2073     ).        # s
+00008520: 656c 662e 7570 6461 7465 5f66 6965 6c64  elf.update_field
+00008530: 286b 6579 3d6b 6579 2c20 7661 6c75 653d  (key=key, value=
+00008540: 7661 6c2c 2073 6f75 7263 653d 736f 7572  val, source=sour
+00008550: 6365 2c20 6e6f 7465 3d6e 6f74 6529 0a0a  ce, note=note)..
+00008560: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00008570: 0a20 2020 2064 6566 2067 6574 5f72 6563  .    def get_rec
+00008580: 6f72 645f 6368 616e 6765 5f73 636f 7265  ord_change_score
+00008590: 2863 6c73 2c20 2a2c 2072 6563 6f72 645f  (cls, *, record_
+000085a0: 613a 2052 6563 6f72 642c 2072 6563 6f72  a: Record, recor
+000085b0: 645f 623a 2052 6563 6f72 6429 202d 3e20  d_b: Record) -> 
+000085c0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
+000085d0: 2222 4465 7465 726d 696e 6520 686f 7720  ""Determine how 
+000085e0: 6d75 6368 2072 6563 6f72 6473 2063 6861  much records cha
+000085f0: 6e67 6564 0a0a 2020 2020 2020 2020 5468  nged..        Th
+00008600: 6973 206d 6574 686f 6420 6973 206c 6573  is method is les
+00008610: 7320 7365 6e73 6974 6976 6520 7468 616e  s sensitive than
+00008620: 2067 6574 5f72 6563 6f72 645f 7369 6d69   get_record_simi
+00008630: 6c61 7269 7479 2c20 6573 7065 6369 616c  larity, especial
+00008640: 6c79 2077 6865 6e0a 2020 2020 2020 2020  ly when.        
+00008650: 6669 656c 6473 2061 7265 206d 6973 7369  fields are missi
+00008660: 6e67 2e20 466f 7220 6578 616d 706c 652c  ng. For example,
+00008670: 2069 6620 7468 6520 6a6f 7572 6e61 6c20   if the journal 
+00008680: 6669 656c 6420 6973 206d 6973 7369 6e67  field is missing
+00008690: 2069 6e20 626f 7468 0a20 2020 2020 2020   in both.       
+000086a0: 2072 6563 6f72 6473 2c20 6765 745f 7369   records, get_si
+000086b0: 6d69 6c61 7269 7479 2077 696c 6c20 7265  milarity will re
+000086c0: 7475 726e 2061 2076 616c 7565 203e 2031  turn a value > 1
+000086d0: 2e30 2e20 5468 6520 6765 745f 7265 636f  .0. The get_reco
+000086e0: 7264 5f63 6861 6e67 6573 0a20 2020 2020  rd_changes.     
+000086f0: 2020 2077 696c 6c20 7265 7475 726e 2030     will return 0
+00008700: 2e30 2028 6966 2061 6c6c 206f 7468 6572  .0 (if all other
+00008710: 2066 6965 6c64 7320 6172 6520 6571 7561   fields are equa
+00008720: 6c29 2e22 2222 0a0a 2020 2020 2020 2020  l)."""..        
+00008730: 2320 4174 2073 6f6d 6520 706f 696e 742c  # At some point,
+00008740: 2074 6869 7320 6d61 7920 6265 636f 6d65   this may become
+00008750: 206d 6f72 6520 7365 6e73 6974 6976 6520   more sensitive 
+00008760: 746f 206d 616a 6f72 2063 6861 6e67 6573  to major changes
+00008770: 0a20 2020 2020 2020 2073 7472 5f61 203d  .        str_a =
+00008780: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
+00008790: 227b 7265 636f 7264 5f61 2e64 6174 612e  "{record_a.data.
+000087a0: 6765 7428 2761 7574 686f 7227 2c20 2727  get('author', ''
+000087b0: 297d 2028 7b72 6563 6f72 645f 612e 6461  )} ({record_a.da
+000087c0: 7461 2e67 6574 2827 7965 6172 272c 2027  ta.get('year', '
+000087d0: 2729 7d29 2022 0a20 2020 2020 2020 2020  ')}) ".         
+000087e0: 2020 202b 2066 227b 7265 636f 7264 5f61     + f"{record_a
+000087f0: 2e64 6174 612e 6765 7428 2774 6974 6c65  .data.get('title
+00008800: 272c 2027 2729 7d2e 2022 0a20 2020 2020  ', '')}. ".     
+00008810: 2020 2020 2020 202b 2066 227b 7265 636f         + f"{reco
+00008820: 7264 5f61 2e64 6174 612e 6765 7428 276a  rd_a.data.get('j
+00008830: 6f75 726e 616c 272c 2027 2729 7d7b 7265  ournal', '')}{re
+00008840: 636f 7264 5f61 2e64 6174 612e 6765 7428  cord_a.data.get(
+00008850: 2762 6f6f 6b74 6974 6c65 272c 2027 2729  'booktitle', '')
+00008860: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
+00008870: 202b 2066 227b 7265 636f 7264 5f61 2e64   + f"{record_a.d
+00008880: 6174 612e 6765 7428 2776 6f6c 756d 6527  ata.get('volume'
+00008890: 2c20 2727 297d 2028 7b72 6563 6f72 645f  , '')} ({record_
+000088a0: 612e 6461 7461 2e67 6574 2827 6e75 6d62  a.data.get('numb
+000088b0: 6572 272c 2027 2729 7d29 220a 2020 2020  er', '')})".    
+000088c0: 2020 2020 290a 2020 2020 2020 2020 7374      ).        st
+000088d0: 725f 6220 3d20 280a 2020 2020 2020 2020  r_b = (.        
+000088e0: 2020 2020 6622 7b72 6563 6f72 645f 622e      f"{record_b.
+000088f0: 6461 7461 2e67 6574 2827 6175 7468 6f72  data.get('author
+00008900: 272c 2027 2729 7d20 287b 7265 636f 7264  ', '')} ({record
+00008910: 5f62 2e64 6174 612e 6765 7428 2779 6561  _b.data.get('yea
+00008920: 7227 2c20 2727 297d 2920 220a 2020 2020  r', '')}) ".    
+00008930: 2020 2020 2020 2020 2b20 6622 7b72 6563          + f"{rec
+00008940: 6f72 645f 622e 6461 7461 2e67 6574 2827  ord_b.data.get('
+00008950: 7469 746c 6527 2c20 2727 297d 2e20 220a  title', '')}. ".
+00008960: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
+00008970: 7b72 6563 6f72 645f 622e 6461 7461 2e67  {record_b.data.g
+00008980: 6574 2827 6a6f 7572 6e61 6c27 2c20 2727  et('journal', ''
+00008990: 297d 7b72 6563 6f72 645f 622e 6461 7461  )}{record_b.data
+000089a0: 2e67 6574 2827 626f 6f6b 7469 746c 6527  .get('booktitle'
+000089b0: 2c20 2727 297d 2c20 220a 2020 2020 2020  , '')}, ".      
+000089c0: 2020 2020 2020 2b20 6622 7b72 6563 6f72        + f"{recor
+000089d0: 645f 622e 6461 7461 2e67 6574 2827 766f  d_b.data.get('vo
+000089e0: 6c75 6d65 272c 2027 2729 7d20 287b 7265  lume', '')} ({re
+000089f0: 636f 7264 5f62 2e64 6174 612e 6765 7428  cord_b.data.get(
+00008a00: 276e 756d 6265 7227 2c20 2727 297d 2922  'number', '')})"
+00008a10: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00008a20: 2020 2072 6574 7572 6e20 3120 2d20 6675     return 1 - fu
+00008a30: 7a7a 2e72 6174 696f 2873 7472 5f61 2e6c  zz.ratio(str_a.l
+00008a40: 6f77 6572 2829 2c20 7374 725f 622e 6c6f  ower(), str_b.lo
+00008a50: 7765 7228 2929 202f 2031 3030 0a0a 2020  wer()) / 100..  
+00008a60: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00008a70: 2020 2064 6566 2067 6574 5f72 6563 6f72     def get_recor
+00008a80: 645f 7369 6d69 6c61 7269 7479 2863 6c73  d_similarity(cls
+00008a90: 2c20 2a2c 2072 6563 6f72 645f 613a 2052  , *, record_a: R
+00008aa0: 6563 6f72 642c 2072 6563 6f72 645f 623a  ecord, record_b:
+00008ab0: 2052 6563 6f72 6429 202d 3e20 666c 6f61   Record) -> floa
+00008ac0: 743a 0a20 2020 2020 2020 2022 2222 4465  t:.        """De
+00008ad0: 7465 726d 696e 6520 7468 6520 7369 6d69  termine the simi
+00008ae0: 6c61 7269 7479 2062 6574 7765 656e 2074  larity between t
+00008af0: 776f 2072 6563 6f72 6473 2028 7468 6569  wo records (thei
+00008b00: 7220 6d61 7374 6572 6461 7461 2922 2222  r masterdata)"""
+00008b10: 0a20 2020 2020 2020 2072 6563 6f72 645f  .        record_
+00008b20: 615f 6469 6374 203d 2072 6563 6f72 645f  a_dict = record_
+00008b30: 612e 636f 7079 2829 2e67 6574 5f64 6174  a.copy().get_dat
+00008b40: 6128 290a 2020 2020 2020 2020 7265 636f  a().        reco
+00008b50: 7264 5f62 5f64 6963 7420 3d20 7265 636f  rd_b_dict = reco
+00008b60: 7264 5f62 2e63 6f70 7928 292e 6765 745f  rd_b.copy().get_
+00008b70: 6461 7461 2829 0a0a 2020 2020 2020 2020  data()..        
+00008b80: 6d61 6e64 6174 6f72 795f 6669 656c 6473  mandatory_fields
+00008b90: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00008ba0: 2022 7469 746c 6522 2c0a 2020 2020 2020   "title",.      
+00008bb0: 2020 2020 2020 2261 7574 686f 7222 2c0a        "author",.
+00008bc0: 2020 2020 2020 2020 2020 2020 2279 6561              "yea
+00008bd0: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
+00008be0: 226a 6f75 726e 616c 222c 0a20 2020 2020  "journal",.     
+00008bf0: 2020 2020 2020 2022 766f 6c75 6d65 222c         "volume",
+00008c00: 0a20 2020 2020 2020 2020 2020 2022 6e75  .            "nu
+00008c10: 6d62 6572 222c 0a20 2020 2020 2020 2020  mber",.         
+00008c20: 2020 2022 7061 6765 7322 2c0a 2020 2020     "pages",.    
+00008c30: 2020 2020 2020 2020 2262 6f6f 6b74 6974          "booktit
+00008c40: 6c65 222c 0a20 2020 2020 2020 205d 0a0a  le",.        ]..
+00008c50: 2020 2020 2020 2020 666f 7220 6d61 6e64          for mand
+00008c60: 6174 6f72 795f 6669 656c 6420 696e 206d  atory_field in m
+00008c70: 616e 6461 746f 7279 5f66 6965 6c64 733a  andatory_fields:
+00008c80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008c90: 7265 636f 7264 5f61 5f64 6963 742e 6765  record_a_dict.ge
+00008ca0: 7428 6d61 6e64 6174 6f72 795f 6669 656c  t(mandatory_fiel
+00008cb0: 642c 2022 554e 4b4e 4f57 4e22 2920 3d3d  d, "UNKNOWN") ==
+00008cc0: 2022 554e 4b4e 4f57 4e22 3a0a 2020 2020   "UNKNOWN":.    
+00008cd0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00008ce0: 7264 5f61 5f64 6963 745b 6d61 6e64 6174  rd_a_dict[mandat
+00008cf0: 6f72 795f 6669 656c 645d 203d 2022 220a  ory_field] = "".
+00008d00: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00008d10: 6563 6f72 645f 625f 6469 6374 2e67 6574  ecord_b_dict.get
+00008d20: 286d 616e 6461 746f 7279 5f66 6965 6c64  (mandatory_field
+00008d30: 2c20 2255 4e4b 4e4f 574e 2229 203d 3d20  , "UNKNOWN") == 
+00008d40: 2255 4e4b 4e4f 574e 223a 0a20 2020 2020  "UNKNOWN":.     
+00008d50: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00008d60: 645f 625f 6469 6374 5b6d 616e 6461 746f  d_b_dict[mandato
+00008d70: 7279 5f66 6965 6c64 5d20 3d20 2222 0a0a  ry_field] = ""..
+00008d80: 2020 2020 2020 2020 6966 2022 636f 6e74          if "cont
+00008d90: 6169 6e65 725f 7469 746c 6522 206e 6f74  ainer_title" not
+00008da0: 2069 6e20 7265 636f 7264 5f61 5f64 6963   in record_a_dic
+00008db0: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
+00008dc0: 6563 6f72 645f 615f 6469 6374 5b22 636f  ecord_a_dict["co
+00008dd0: 6e74 6169 6e65 725f 7469 746c 6522 5d20  ntainer_title"] 
+00008de0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00008df0: 2020 2020 7265 636f 7264 5f61 5f64 6963      record_a_dic
+00008e00: 742e 6765 7428 226a 6f75 726e 616c 222c  t.get("journal",
+00008e10: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
+00008e20: 2020 2020 202b 2072 6563 6f72 645f 615f       + record_a_
+00008e30: 6469 6374 2e67 6574 2822 626f 6f6b 7469  dict.get("bookti
+00008e40: 746c 6522 2c20 2222 290a 2020 2020 2020  tle", "").      
+00008e50: 2020 2020 2020 2020 2020 2b20 7265 636f            + reco
+00008e60: 7264 5f61 5f64 6963 742e 6765 7428 2273  rd_a_dict.get("s
+00008e70: 6572 6965 7322 2c20 2222 290a 2020 2020  eries", "").    
+00008e80: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00008e90: 2020 2069 6620 2263 6f6e 7461 696e 6572     if "container
+00008ea0: 5f74 6974 6c65 2220 6e6f 7420 696e 2072  _title" not in r
+00008eb0: 6563 6f72 645f 625f 6469 6374 3a0a 2020  ecord_b_dict:.  
+00008ec0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00008ed0: 5f62 5f64 6963 745b 2263 6f6e 7461 696e  _b_dict["contain
+00008ee0: 6572 5f74 6974 6c65 225d 203d 2028 0a20  er_title"] = (. 
+00008ef0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00008f00: 6563 6f72 645f 625f 6469 6374 2e67 6574  ecord_b_dict.get
+00008f10: 2822 6a6f 7572 6e61 6c22 2c20 2222 290a  ("journal", "").
+00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f30: 2b20 7265 636f 7264 5f62 5f64 6963 742e  + record_b_dict.
+00008f40: 6765 7428 2262 6f6f 6b74 6974 6c65 222c  get("booktitle",
+00008f50: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
+00008f60: 2020 2020 202b 2072 6563 6f72 645f 625f       + record_b_
+00008f70: 6469 6374 2e67 6574 2822 7365 7269 6573  dict.get("series
+00008f80: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
+00008f90: 2020 2029 0a0a 2020 2020 2020 2020 6466     )..        df
+00008fa0: 5f61 203d 2070 642e 4461 7461 4672 616d  _a = pd.DataFram
+00008fb0: 652e 6672 6f6d 5f64 6963 7428 5b72 6563  e.from_dict([rec
+00008fc0: 6f72 645f 615f 6469 6374 5d29 2020 2320  ord_a_dict])  # 
+00008fd0: 7479 7065 3a20 6967 6e6f 7265 0a20 2020  type: ignore.   
+00008fe0: 2020 2020 2064 665f 6220 3d20 7064 2e44       df_b = pd.D
+00008ff0: 6174 6146 7261 6d65 2e66 726f 6d5f 6469  ataFrame.from_di
+00009000: 6374 285b 7265 636f 7264 5f62 5f64 6963  ct([record_b_dic
+00009010: 745d 2920 2023 2074 7970 653a 2069 676e  t])  # type: ign
+00009020: 6f72 650a 0a20 2020 2020 2020 2072 6574  ore..        ret
+00009030: 7572 6e20 5265 636f 7264 2e67 6574 5f73  urn Record.get_s
+00009040: 696d 696c 6172 6974 7928 6466 5f61 3d64  imilarity(df_a=d
+00009050: 665f 612e 696c 6f63 5b30 5d2c 2064 665f  f_a.iloc[0], df_
+00009060: 623d 6466 5f62 2e69 6c6f 635b 305d 290a  b=df_b.iloc[0]).
+00009070: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00009080: 640a 2020 2020 6465 6620 6765 745f 7369  d.    def get_si
+00009090: 6d69 6c61 7269 7479 2863 6c73 2c20 2a2c  milarity(cls, *,
+000090a0: 2064 665f 613a 2064 6963 742c 2064 665f   df_a: dict, df_
+000090b0: 623a 2064 6963 7429 202d 3e20 666c 6f61  b: dict) -> floa
+000090c0: 743a 0a20 2020 2020 2020 2022 2222 4465  t:.        """De
+000090d0: 7465 726d 696e 6520 7468 6520 7369 6d69  termine the simi
+000090e0: 6c61 7269 7479 2062 6574 7765 656e 2074  larity between t
+000090f0: 776f 2072 6563 6f72 6473 2222 220a 0a20  wo records""".. 
+00009100: 2020 2020 2020 2064 6574 6169 6c73 203d         details =
+00009110: 2052 6563 6f72 642e 6765 745f 7369 6d69   Record.get_simi
+00009120: 6c61 7269 7479 5f64 6574 6169 6c65 6428  larity_detailed(
+00009130: 7265 636f 7264 5f61 3d64 665f 612c 2072  record_a=df_a, r
+00009140: 6563 6f72 645f 623d 6466 5f62 290a 2020  ecord_b=df_b).  
+00009150: 2020 2020 2020 7265 7475 726e 2064 6574        return det
+00009160: 6169 6c73 5b22 7363 6f72 6522 5d0a 0a20  ails["score"].. 
+00009170: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00009180: 2020 2020 6465 6620 6765 745f 7369 6d69      def get_simi
+00009190: 6c61 7269 7479 5f64 6574 6169 6c65 6428  larity_detailed(
+000091a0: 636c 732c 202a 2c20 7265 636f 7264 5f61  cls, *, record_a
+000091b0: 3a20 6469 6374 2c20 7265 636f 7264 5f62  : dict, record_b
+000091c0: 3a20 6469 6374 2920 2d3e 2064 6963 743a  : dict) -> dict:
+000091d0: 0a20 2020 2020 2020 2022 2222 4465 7465  .        """Dete
+000091e0: 726d 696e 6520 7468 6520 6465 7461 696c  rmine the detail
+000091f0: 6564 2073 696d 696c 6172 6974 6965 7320  ed similarities 
+00009200: 6265 7477 6565 6e20 7265 636f 7264 7322  between records"
+00009210: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
+00009220: 2020 2020 2020 2020 2020 2020 6175 7468              auth
+00009230: 6f72 5f73 696d 696c 6172 6974 7920 3d20  or_similarity = 
+00009240: 6675 7a7a 2e72 6174 696f 2872 6563 6f72  fuzz.ratio(recor
+00009250: 645f 615b 2261 7574 686f 7222 5d2c 2072  d_a["author"], r
+00009260: 6563 6f72 645f 625b 2261 7574 686f 7222  ecord_b["author"
+00009270: 5d29 202f 2031 3030 0a0a 2020 2020 2020  ]) / 100..      
+00009280: 2020 2020 2020 7469 746c 655f 7369 6d69        title_simi
+00009290: 6c61 7269 7479 203d 2028 0a20 2020 2020  larity = (.     
+000092a0: 2020 2020 2020 2020 2020 2066 757a 7a2e             fuzz.
+000092b0: 7261 7469 6f28 0a20 2020 2020 2020 2020  ratio(.         
+000092c0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+000092d0: 645f 615b 2274 6974 6c65 225d 2e6c 6f77  d_a["title"].low
+000092e0: 6572 2829 2e72 6570 6c61 6365 2822 3a22  er().replace(":"
+000092f0: 2c20 2222 292e 7265 706c 6163 6528 222d  , "").replace("-
+00009300: 222c 2022 2229 2c0a 2020 2020 2020 2020  ", ""),.        
+00009310: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00009320: 7264 5f62 5b22 7469 746c 6522 5d2e 6c6f  rd_b["title"].lo
+00009330: 7765 7228 292e 7265 706c 6163 6528 223a  wer().replace(":
+00009340: 222c 2022 2229 2e72 6570 6c61 6365 2822  ", "").replace("
+00009350: 2d22 2c20 2222 292c 0a20 2020 2020 2020  -", ""),.       
+00009360: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00009370: 2020 2020 2020 2020 2020 202f 2031 3030             / 100
+00009380: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00009390: 2020 2020 2020 2020 2020 2020 2320 7061              # pa
+000093a0: 7274 6961 6c20 7261 7469 6f20 2863 6174  rtial ratio (cat
+000093b0: 6368 696e 6720 3230 3130 2d31 3020 6f72  ching 2010-10 or
+000093c0: 2032 3030 312d 3230 3032 290a 2020 2020   2001-2002).    
+000093d0: 2020 2020 2020 2020 7965 6172 5f73 696d          year_sim
+000093e0: 696c 6172 6974 7920 3d20 280a 2020 2020  ilarity = (.    
+000093f0: 2020 2020 2020 2020 2020 2020 6675 7a7a              fuzz
+00009400: 2e72 6174 696f 2873 7472 2872 6563 6f72  .ratio(str(recor
+00009410: 645f 615b 2279 6561 7222 5d29 2c20 7374  d_a["year"]), st
+00009420: 7228 7265 636f 7264 5f62 5b22 7965 6172  r(record_b["year
+00009430: 225d 2929 202f 2031 3030 0a20 2020 2020  "])) / 100.     
+00009440: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00009450: 2020 2020 2020 6f75 746c 6574 5f73 696d        outlet_sim
+00009460: 696c 6172 6974 7920 3d20 302e 300a 2020  ilarity = 0.0.  
+00009470: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
+00009480: 6f72 645f 625b 2263 6f6e 7461 696e 6572  ord_b["container
+00009490: 5f74 6974 6c65 225d 2061 6e64 2072 6563  _title"] and rec
+000094a0: 6f72 645f 615b 2263 6f6e 7461 696e 6572  ord_a["container
+000094b0: 5f74 6974 6c65 225d 3a0a 2020 2020 2020  _title"]:.      
+000094c0: 2020 2020 2020 2020 2020 6f75 746c 6574            outlet
+000094d0: 5f73 696d 696c 6172 6974 7920 3d20 280a  _similarity = (.
+000094e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094f0: 2020 2020 6675 7a7a 2e72 6174 696f 2872      fuzz.ratio(r
+00009500: 6563 6f72 645f 615b 2263 6f6e 7461 696e  ecord_a["contain
+00009510: 6572 5f74 6974 6c65 225d 2c20 7265 636f  er_title"], reco
+00009520: 7264 5f62 5b22 636f 6e74 6169 6e65 725f  rd_b["container_
+00009530: 7469 746c 6522 5d29 0a20 2020 2020 2020  title"]).       
+00009540: 2020 2020 2020 2020 2020 2020 202f 2031               / 1
+00009550: 3030 0a20 2020 2020 2020 2020 2020 2020  00.             
+00009560: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+00009570: 2020 6966 2073 7472 2872 6563 6f72 645f    if str(record_
+00009580: 615b 226a 6f75 726e 616c 225d 2920 213d  a["journal"]) !=
+00009590: 2022 6e61 6e22 3a0a 2020 2020 2020 2020   "nan":.        
+000095a0: 2020 2020 2020 2020 2320 4e6f 7465 3a20          # Note: 
+000095b0: 666f 7220 6a6f 7572 6e61 6c73 2070 6170  for journals pap
+000095c0: 6572 732c 2077 6520 6578 7065 6374 206d  ers, we expect m
+000095d0: 6f72 6520 6465 7461 696c 730a 2020 2020  ore details.    
+000095e0: 2020 2020 2020 2020 2020 2020 766f 6c75              volu
+000095f0: 6d65 5f73 696d 696c 6172 6974 7920 3d20  me_similarity = 
+00009600: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009610: 2020 2020 2020 3120 6966 2028 7265 636f        1 if (reco
+00009620: 7264 5f61 5b22 766f 6c75 6d65 225d 203d  rd_a["volume"] =
+00009630: 3d20 7265 636f 7264 5f62 5b22 766f 6c75  = record_b["volu
+00009640: 6d65 225d 2920 656c 7365 2030 0a20 2020  me"]) else 0.   
+00009650: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009670: 6e75 6d62 6572 5f73 696d 696c 6172 6974  number_similarit
+00009680: 7920 3d20 280a 2020 2020 2020 2020 2020  y = (.          
+00009690: 2020 2020 2020 2020 2020 3120 6966 2028            1 if (
+000096a0: 7265 636f 7264 5f61 5b22 6e75 6d62 6572  record_a["number
+000096b0: 225d 203d 3d20 7265 636f 7264 5f62 5b22  "] == record_b["
+000096c0: 6e75 6d62 6572 225d 2920 656c 7365 2030  number"]) else 0
+000096d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000096e0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+000096f0: 2020 2020 2320 7061 6765 2073 696d 696c      # page simil
+00009700: 6172 6974 7920 6973 206e 6f74 2063 6f6e  arity is not con
+00009710: 7369 6465 7265 6420 6174 2074 6865 206d  sidered at the m
+00009720: 6f6d 656e 742e 0a20 2020 2020 2020 2020  oment..         
+00009730: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
+00009740: 2020 2020 2020 2020 2023 2073 6f6d 6574           # somet
+00009750: 696d 6573 2c20 6f6e 6c79 2074 6865 2066  imes, only the f
+00009760: 6972 7374 2070 6167 6520 6973 2070 726f  irst page is pro
+00009770: 7669 6465 642e 0a20 2020 2020 2020 2020  vided..         
+00009780: 2020 2020 2020 2023 2069 6620 7374 7228         # if str(
+00009790: 7265 636f 7264 5f61 5b22 7061 6765 7322  record_a["pages"
+000097a0: 5d29 203d 3d20 226e 616e 2220 6f72 2073  ]) == "nan" or s
+000097b0: 7472 2872 6563 6f72 645f 625b 2270 6167  tr(record_b["pag
+000097c0: 6573 225d 2920 3d3d 2022 6e61 6e22 3a0a  es"]) == "nan":.
+000097d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097e0: 2320 2020 2020 7061 6765 735f 7369 6d69  #     pages_simi
+000097f0: 6c61 7269 7479 203d 2031 0a20 2020 2020  larity = 1.     
+00009800: 2020 2020 2020 2020 2020 2023 2065 6c73             # els
+00009810: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009820: 2020 2023 2020 2020 2069 6620 7265 636f     #     if reco
+00009830: 7264 5f61 5b22 7061 6765 7322 5d20 3d3d  rd_a["pages"] ==
+00009840: 2072 6563 6f72 645f 625b 2270 6167 6573   record_b["pages
+00009850: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+00009860: 2020 2020 2320 2020 2020 2020 2020 7061      #         pa
+00009870: 6765 735f 7369 6d69 6c61 7269 7479 203d  ges_similarity =
+00009880: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00009890: 2020 2023 2020 2020 2065 6c73 653a 0a20     #     else:. 
+000098a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000098b0: 2020 2020 2020 2020 2069 6620 7265 636f           if reco
+000098c0: 7264 5f61 5b22 7061 6765 7322 5d2e 7370  rd_a["pages"].sp
+000098d0: 6c69 7428 222d 2229 5b30 5d20 3d3d 2072  lit("-")[0] == r
+000098e0: 6563 6f72 645f 625b 2270 6167 6573 225d  ecord_b["pages"]
+000098f0: 2e73 706c 6974 2822 2d22 295b 305d 3a0a  .split("-")[0]:.
+00009900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009910: 2320 2020 2020 2020 2020 2020 2020 7061  #             pa
+00009920: 6765 735f 7369 6d69 6c61 7269 7479 203d  ges_similarity =
+00009930: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00009940: 2020 2023 2020 2020 2020 2020 2065 6c73     #         els
+00009950: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009960: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009970: 7061 6765 735f 7369 6d69 6c61 7269 7479  pages_similarity
+00009980: 203d 2030 0a0a 2020 2020 2020 2020 2020   = 0..          
+00009990: 2020 2020 2020 2320 5075 7420 6d6f 7265        # Put more
+000099a0: 2077 6569 6768 7420 6f6e 206f 7468 6572   weight on other
+000099b0: 2066 6965 6c64 7320 6966 2074 6865 2074   fields if the t
+000099c0: 6974 6c65 2069 7320 7665 7279 2063 6f6d  itle is very com
+000099d0: 6d6f 6e0a 2020 2020 2020 2020 2020 2020  mon.            
+000099e0: 2020 2020 2320 6965 2e2c 206e 6f6e 2d64      # ie., non-d
+000099f0: 6973 7469 6e63 7469 7665 0a20 2020 2020  istinctive.     
+00009a00: 2020 2020 2020 2020 2020 2023 2054 6865             # The
+00009a10: 206c 6973 7420 6973 2062 6173 6564 206f   list is based o
+00009a20: 6e20 6120 6c61 7267 6520 6578 706f 7274  n a large export
+00009a30: 206f 6620 6469 7374 696e 6374 2070 6170   of distinct pap
+00009a40: 6572 732c 2074 6162 756c 6174 6564 0a20  ers, tabulated. 
+00009a50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009a60: 2061 6363 6f72 6469 6e67 2074 6f20 7469   according to ti
+00009a70: 746c 6573 2061 6e64 2073 6f72 7465 6420  tles and sorted 
+00009a80: 6279 2066 7265 7175 656e 6379 0a20 2020  by frequency.   
+00009a90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009aa0: 5b72 6563 6f72 645f 615b 2274 6974 6c65  [record_a["title
+00009ab0: 225d 2c20 7265 636f 7264 5f62 5b22 7469  "], record_b["ti
+00009ac0: 746c 6522 5d5d 2069 6e20 5b0a 2020 2020  tle"]] in [.    
+00009ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ae0: 5b22 6564 6974 6f72 6961 6c22 2c20 2265  ["editorial", "e
+00009af0: 6469 746f 7269 616c 225d 2c0a 2020 2020  ditorial"],.    
+00009b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b10: 5b22 6564 6974 6f72 6961 6c20 696e 7472  ["editorial intr
+00009b20: 6f64 7563 7469 6f6e 222c 2022 6564 6974  oduction", "edit
+00009b30: 6f72 6961 6c20 696e 7472 6f64 7563 7469  orial introducti
+00009b40: 6f6e 225d 2c0a 2020 2020 2020 2020 2020  on"],.          
+00009b50: 2020 2020 2020 2020 2020 5b22 6564 6974            ["edit
+00009b60: 6f72 6961 6c20 6e6f 7465 7322 2c20 2265  orial notes", "e
+00009b70: 6469 746f 7269 616c 206e 6f74 6573 225d  ditorial notes"]
+00009b80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009b90: 2020 2020 2020 5b22 6564 6974 6f72 2773        ["editor's
+00009ba0: 2063 6f6d 6d65 6e74 7322 2c20 2265 6469   comments", "edi
+00009bb0: 746f 7227 7320 636f 6d6d 656e 7473 225d  tor's comments"]
+00009bc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009bd0: 2020 2020 2020 5b22 626f 6f6b 2072 6576        ["book rev
+00009be0: 6965 7773 222c 2022 626f 6f6b 2072 6576  iews", "book rev
+00009bf0: 6965 7773 225d 2c0a 2020 2020 2020 2020  iews"],.        
+00009c00: 2020 2020 2020 2020 2020 2020 5b22 6564              ["ed
+00009c10: 6974 6f72 6961 6c20 6e6f 7465 222c 2022  itorial note", "
+00009c20: 6564 6974 6f72 6961 6c20 6e6f 7465 225d  editorial note"]
+00009c30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009c40: 2020 2020 2020 5b22 7265 7669 6577 6572        ["reviewer
+00009c50: 2061 636b 6f77 6c65 6467 6d65 6e74 222c   ackowledgment",
+00009c60: 2022 7265 7669 6577 6572 2061 636b 6f77   "reviewer ackow
+00009c70: 6c65 6467 6d65 6e74 225d 2c0a 2020 2020  ledgment"],.    
+00009c80: 2020 2020 2020 2020 2020 2020 5d3a 0a20              ]:. 
+00009c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ca0: 2020 2077 6569 6768 7473 203d 205b 302e     weights = [0.
+00009cb0: 3137 352c 2030 2c20 302e 3137 352c 2030  175, 0, 0.175, 0
+00009cc0: 2e31 3735 2c20 302e 3237 352c 2030 2e32  .175, 0.275, 0.2
+00009cd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00009ce0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00009cf0: 2020 2020 2020 2020 2020 2020 7765 6967              weig
+00009d00: 6874 7320 3d20 5b30 2e32 2c20 302e 3235  hts = [0.2, 0.25
+00009d10: 2c20 302e 3133 2c20 302e 322c 2030 2e31  , 0.13, 0.2, 0.1
+00009d20: 322c 2030 2e31 5d0a 0a20 2020 2020 2020  2, 0.1]..       
+00009d30: 2020 2020 2020 2020 2073 696d 5f6e 616d           sim_nam
+00009d40: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
+00009d50: 2020 2020 2020 2020 2020 2022 6175 7468             "auth
+00009d60: 6f72 7322 2c0a 2020 2020 2020 2020 2020  ors",.          
+00009d70: 2020 2020 2020 2020 2020 2274 6974 6c65            "title
+00009d80: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00009d90: 2020 2020 2020 2022 7965 6172 222c 0a20         "year",. 
 00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009db0: 7765 6967 6874 7320 3d20 5b30 2e31 352c  weights = [0.15,
-00009dc0: 2030 2e37 352c 2030 2e30 352c 2030 2e30   0.75, 0.05, 0.0
-00009dd0: 355d 0a20 2020 2020 2020 2020 2020 2020  5].             
-00009de0: 2020 2073 696d 5f6e 616d 6573 203d 205b     sim_names = [
-00009df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009e00: 2020 2020 2022 6175 7468 6f72 222c 0a20       "author",. 
-00009e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e20: 2020 2022 7469 746c 6522 2c0a 2020 2020     "title",.    
+00009db0: 2020 2022 6f75 746c 6574 222c 0a20 2020     "outlet",.   
+00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009dd0: 2022 766f 6c75 6d65 222c 0a20 2020 2020   "volume",.     
+00009de0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00009df0: 6e75 6d62 6572 222c 0a20 2020 2020 2020  number",.       
+00009e00: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+00009e10: 2020 2020 2020 2020 2020 2073 696d 696c             simil
+00009e20: 6172 6974 6965 7320 3d20 5b0a 2020 2020  arities = [.    
 00009e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e40: 2279 6561 7222 2c0a 2020 2020 2020 2020  "year",.        
-00009e50: 2020 2020 2020 2020 2020 2020 226f 7574              "out
-00009e60: 6c65 7422 2c0a 2020 2020 2020 2020 2020  let",.          
-00009e70: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00009e80: 2020 2020 2020 2020 7369 6d69 6c61 7269          similari
-00009e90: 7469 6573 203d 205b 0a20 2020 2020 2020  ties = [.       
-00009ea0: 2020 2020 2020 2020 2020 2020 2061 7574               aut
-00009eb0: 686f 725f 7369 6d69 6c61 7269 7479 2c0a  hor_similarity,.
-00009ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ed0: 2020 2020 7469 746c 655f 7369 6d69 6c61      title_simila
-00009ee0: 7269 7479 2c0a 2020 2020 2020 2020 2020  rity,.          
-00009ef0: 2020 2020 2020 2020 2020 7965 6172 5f73            year_s
-00009f00: 696d 696c 6172 6974 792c 0a20 2020 2020  imilarity,.     
-00009f10: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00009f20: 7574 6c65 745f 7369 6d69 6c61 7269 7479  utlet_similarity
-00009f30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009f40: 2020 5d0a 0a20 2020 2020 2020 2020 2020    ]..           
-00009f50: 2077 6569 6768 7465 645f 6176 6572 6167   weighted_averag
-00009f60: 6520 3d20 7375 6d28 0a20 2020 2020 2020  e = sum(.       
-00009f70: 2020 2020 2020 2020 2073 696d 696c 6172           similar
-00009f80: 6974 6965 735b 675d 202a 2077 6569 6768  ities[g] * weigh
-00009f90: 7473 5b67 5d20 666f 7220 6720 696e 2072  ts[g] for g in r
-00009fa0: 616e 6765 286c 656e 2873 696d 696c 6172  ange(len(similar
-00009fb0: 6974 6965 7329 290a 2020 2020 2020 2020  ities)).        
-00009fc0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00009fd0: 2020 2064 6574 6169 6c73 203d 2028 0a20     details = (. 
-00009fe0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00009ff0: 5b22 0a20 2020 2020 2020 2020 2020 2020  [".             
-0000a000: 2020 202b 2022 2c22 2e6a 6f69 6e28 5b73     + ",".join([s
-0000a010: 696d 5f6e 616d 6573 5b67 5d20 666f 7220  im_names[g] for 
-0000a020: 6720 696e 2072 616e 6765 286c 656e 2873  g in range(len(s
-0000a030: 696d 696c 6172 6974 6965 7329 295d 290a  imilarities))]).
-0000a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a050: 2b20 225d 220a 2020 2020 2020 2020 2020  + "]".          
-0000a060: 2020 2020 2020 2b20 222a 7765 6967 6874        + "*weight
-0000a070: 735f 7665 636f 725e 5420 3d20 220a 2020  s_vecor^T = ".  
-0000a080: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000a090: 225b 220a 2020 2020 2020 2020 2020 2020  "[".            
-0000a0a0: 2020 2020 2b20 222c 222e 6a6f 696e 285b      + ",".join([
-0000a0b0: 7374 7228 7369 6d69 6c61 7269 7469 6573  str(similarities
-0000a0c0: 5b67 5d29 2066 6f72 2067 2069 6e20 7261  [g]) for g in ra
-0000a0d0: 6e67 6528 6c65 6e28 7369 6d69 6c61 7269  nge(len(similari
-0000a0e0: 7469 6573 2929 5d29 0a20 2020 2020 2020  ties))]).       
-0000a0f0: 2020 2020 2020 2020 202b 2022 5d2a 220a           + "]*".
-0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a110: 2b20 225b 220a 2020 2020 2020 2020 2020  + "[".          
-0000a120: 2020 2020 2020 2b20 222c 222e 6a6f 696e        + ",".join
-0000a130: 285b 7374 7228 7765 6967 6874 735b 675d  ([str(weights[g]
-0000a140: 2920 666f 7220 6720 696e 2072 616e 6765  ) for g in range
-0000a150: 286c 656e 2873 696d 696c 6172 6974 6965  (len(similaritie
-0000a160: 7329 295d 290a 2020 2020 2020 2020 2020  s))]).          
-0000a170: 2020 2020 2020 2b20 225d 5e54 220a 2020        + "]^T".  
-0000a180: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000a190: 2020 2020 2020 2020 7369 6d69 6c61 7269          similari
-0000a1a0: 7479 5f73 636f 7265 203d 2072 6f75 6e64  ty_score = round
-0000a1b0: 2877 6569 6768 7465 645f 6176 6572 6167  (weighted_averag
-0000a1c0: 652c 2034 290a 2020 2020 2020 2020 6578  e, 4).        ex
-0000a1d0: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-0000a1e0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000a1f0: 2073 696d 696c 6172 6974 795f 7363 6f72   similarity_scor
-0000a200: 6520 3d20 300a 2020 2020 2020 2020 2020  e = 0.          
-0000a210: 2020 6465 7461 696c 7320 3d20 2222 0a20    details = "". 
-0000a220: 2020 2020 2020 2072 6574 7572 6e20 7b22         return {"
-0000a230: 7363 6f72 6522 3a20 7369 6d69 6c61 7269  score": similari
-0000a240: 7479 5f73 636f 7265 2c20 2264 6574 6169  ty_score, "detai
-0000a250: 6c73 223a 2064 6574 6169 6c73 7d0a 0a20  ls": details}.. 
-0000a260: 2020 2064 6566 2067 6574 5f66 6965 6c64     def get_field
-0000a270: 5f70 726f 7665 6e61 6e63 6528 0a20 2020  _provenance(.   
-0000a280: 2020 2020 2073 656c 662c 202a 2c20 6b65       self, *, ke
-0000a290: 793a 2073 7472 2c20 6465 6661 756c 745f  y: str, default_
-0000a2a0: 736f 7572 6365 3a20 7374 7220 3d20 224f  source: str = "O
-0000a2b0: 5249 4749 4e41 4c22 0a20 2020 2029 202d  RIGINAL".    ) -
-0000a2c0: 3e20 6469 6374 3a0a 2020 2020 2020 2020  > dict:.        
-0000a2d0: 2222 2247 6574 2074 6865 2070 726f 7665  """Get the prove
-0000a2e0: 6e61 6e63 6520 666f 7220 6120 7365 6c65  nance for a sele
-0000a2f0: 6374 6564 2066 6965 6c64 2028 6b65 7929  cted field (key)
-0000a300: 2222 220a 2020 2020 2020 2020 6465 6661  """.        defa
-0000a310: 756c 745f 6e6f 7465 203d 2022 220a 2020  ult_note = "".  
-0000a320: 2020 2020 2020 6e6f 7465 203d 2064 6566        note = def
-0000a330: 6175 6c74 5f6e 6f74 650a 2020 2020 2020  ault_note.      
-0000a340: 2020 736f 7572 6365 203d 2064 6566 6175    source = defau
-0000a350: 6c74 5f73 6f75 7263 650a 2020 2020 2020  lt_source.      
-0000a360: 2020 6966 206b 6579 2069 6e20 7365 6c66    if key in self
-0000a370: 2e69 6465 6e74 6966 7969 6e67 5f66 6965  .identifying_fie
-0000a380: 6c64 5f6b 6579 733a 0a20 2020 2020 2020  ld_keys:.       
-0000a390: 2020 2020 2069 6620 2263 6f6c 7265 765f       if "colrev_
-0000a3a0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000a3b0: 6e61 6e63 6522 2069 6e20 7365 6c66 2e64  nance" in self.d
-0000a3c0: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-0000a3d0: 2020 2020 2069 6620 6b65 7920 696e 2073       if key in s
-0000a3e0: 656c 662e 6461 7461 2e67 6574 2822 636f  elf.data.get("co
-0000a3f0: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-0000a400: 7072 6f76 656e 616e 6365 222c 207b 7d29  provenance", {})
-0000a410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a420: 2020 2020 2020 6966 2022 736f 7572 6365        if "source
-0000a430: 2220 696e 2073 656c 662e 6461 7461 5b22  " in self.data["
-0000a440: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-0000a450: 615f 7072 6f76 656e 616e 6365 225d 5b6b  a_provenance"][k
-0000a460: 6579 5d3a 0a20 2020 2020 2020 2020 2020  ey]:.           
-0000a470: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
-0000a480: 7263 6520 3d20 7365 6c66 2e64 6174 615b  rce = self.data[
-0000a490: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000a4a0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-0000a4b0: 6b65 795d 5b0a 2020 2020 2020 2020 2020  key][.          
-0000a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4d0: 2020 2273 6f75 7263 6522 0a20 2020 2020    "source".     
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
-0000a500: 2020 2020 2020 2020 2069 6620 226e 6f74           if "not
-0000a510: 6522 2069 6e20 7365 6c66 2e64 6174 615b  e" in self.data[
-0000a520: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000a530: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-0000a540: 6b65 795d 3a0a 2020 2020 2020 2020 2020  key]:.          
-0000a550: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-0000a560: 7465 203d 2073 656c 662e 6461 7461 5b22  te = self.data["
-0000a570: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-0000a580: 615f 7072 6f76 656e 616e 6365 225d 5b6b  a_provenance"][k
-0000a590: 6579 5d5b 226e 6f74 6522 5d0a 2020 2020  ey]["note"].    
-0000a5a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000a5b0: 2020 2020 2020 6966 2022 636f 6c72 6576        if "colrev
-0000a5c0: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-0000a5d0: 2220 696e 2073 656c 662e 6461 7461 3a0a  " in self.data:.
-0000a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5f0: 6966 206b 6579 2069 6e20 7365 6c66 2e64  if key in self.d
-0000a600: 6174 615b 2263 6f6c 7265 765f 6461 7461  ata["colrev_data
-0000a610: 5f70 726f 7665 6e61 6e63 6522 5d3a 0a20  _provenance"]:. 
-0000a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a630: 2020 2069 6620 2273 6f75 7263 6522 2069     if "source" i
-0000a640: 6e20 7365 6c66 2e64 6174 615b 2263 6f6c  n self.data["col
-0000a650: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
-0000a660: 6e63 6522 5d5b 6b65 795d 3a0a 2020 2020  nce"][key]:.    
-0000a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a680: 2020 2020 736f 7572 6365 203d 2073 656c      source = sel
-0000a690: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
-0000a6a0: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-0000a6b0: 5b6b 6579 5d5b 2273 6f75 7263 6522 5d0a  [key]["source"].
-0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6d0: 2020 2020 6966 2022 6e6f 7465 2220 696e      if "note" in
-0000a6e0: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
-0000a6f0: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
-0000a700: 6365 225d 5b6b 6579 5d3a 0a20 2020 2020  ce"][key]:.     
-0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a720: 2020 206e 6f74 6520 3d20 7365 6c66 2e64     note = self.d
-0000a730: 6174 615b 2263 6f6c 7265 765f 6461 7461  ata["colrev_data
-0000a740: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
-0000a750: 795d 5b22 6e6f 7465 225d 0a0a 2020 2020  y]["note"]..    
-0000a760: 2020 2020 7265 7475 726e 207b 2273 6f75      return {"sou
-0000a770: 7263 6522 3a20 736f 7572 6365 2c20 226e  rce": source, "n
-0000a780: 6f74 6522 3a20 6e6f 7465 7d0a 0a20 2020  ote": note}..   
-0000a790: 2064 6566 2072 656d 6f76 655f 6d61 7374   def remove_mast
-0000a7a0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-0000a7b0: 655f 6e6f 7465 2873 656c 662c 202a 2c20  e_note(self, *, 
-0000a7c0: 6b65 793a 2073 7472 2c20 6e6f 7465 3a20  key: str, note: 
-0000a7d0: 7374 7229 202d 3e20 4e6f 6e65 3a0a 2020  str) -> None:.  
-0000a7e0: 2020 2020 2020 2222 2252 656d 6f76 6520        """Remove 
-0000a7f0: 6120 6d61 7374 6572 6461 7461 2070 726f  a masterdata pro
-0000a800: 7665 6e61 6e63 6520 6e6f 7465 2222 220a  venance note""".
-0000a810: 2020 2020 2020 2020 6966 2022 636f 6c72          if "colr
-0000a820: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-0000a830: 6f76 656e 616e 6365 2220 6e6f 7420 696e  ovenance" not in
-0000a840: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-0000a850: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0000a860: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-0000a870: 7420 696e 2073 656c 662e 6461 7461 5b22  t in self.data["
-0000a880: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-0000a890: 615f 7072 6f76 656e 616e 6365 225d 3a0a  a_provenance"]:.
-0000a8a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a8b0: 726e 0a20 2020 2020 2020 206e 6f74 6573  rn.        notes
-0000a8c0: 203d 2073 656c 662e 6461 7461 5b22 636f   = self.data["co
-0000a8d0: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-0000a8e0: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
-0000a8f0: 5d5b 226e 6f74 6522 5d2e 7370 6c69 7428  ]["note"].split(
-0000a900: 222c 2229 0a20 2020 2020 2020 2069 6620  ",").        if 
-0000a910: 6e6f 7465 206e 6f74 2069 6e20 6e6f 7465  note not in note
-0000a920: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0000a930: 6574 7572 6e0a 2020 2020 2020 2020 7365  eturn.        se
-0000a940: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000a950: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000a960: 6e61 6e63 6522 5d5b 6b65 795d 5b22 6e6f  nance"][key]["no
-0000a970: 7465 225d 203d 2022 2c22 2e6a 6f69 6e28  te"] = ",".join(
-0000a980: 0a20 2020 2020 2020 2020 2020 206e 2066  .            n f
-0000a990: 6f72 206e 2069 6e20 6e6f 7465 7320 6966  or n in notes if
-0000a9a0: 206e 2021 3d20 6e6f 7465 0a20 2020 2020   n != note.     
-0000a9b0: 2020 2029 0a0a 2020 2020 6465 6620 6164     )..    def ad
-0000a9c0: 645f 6d61 7374 6572 6461 7461 5f70 726f  d_masterdata_pro
-0000a9d0: 7665 6e61 6e63 655f 6e6f 7465 2873 656c  venance_note(sel
-0000a9e0: 662c 202a 2c20 6b65 793a 2073 7472 2c20  f, *, key: str, 
-0000a9f0: 6e6f 7465 3a20 7374 7229 202d 3e20 4e6f  note: str) -> No
-0000aa00: 6e65 3a0a 2020 2020 2020 2020 2222 2241  ne:.        """A
-0000aa10: 6464 2061 206d 6173 7465 7264 6174 6120  dd a masterdata 
-0000aa20: 7072 6f76 656e 616e 6365 206e 6f74 6520  provenance note 
-0000aa30: 2862 6173 6564 206f 6e20 6120 6b65 7929  (based on a key)
-0000aa40: 2222 220a 2020 2020 2020 2020 6966 2022  """.        if "
-0000aa50: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-0000aa60: 615f 7072 6f76 656e 616e 6365 2220 6e6f  a_provenance" no
-0000aa70: 7420 696e 2073 656c 662e 6461 7461 3a0a  t in self.data:.
-0000aa80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000aa90: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-0000aaa0: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-0000aab0: 6e63 6522 5d20 3d20 7b7d 0a20 2020 2020  nce"] = {}.     
-0000aac0: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
-0000aad0: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
-0000aae0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-0000aaf0: 6f76 656e 616e 6365 222c 207b 7d29 3a0a  ovenance", {}):.
-0000ab00: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0000ab10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ab20: 2022 2220 3d3d 2073 656c 662e 6461 7461   "" == self.data
-0000ab30: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
-0000ab40: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-0000ab50: 5b6b 6579 5d5b 226e 6f74 6522 5d0a 2020  [key]["note"].  
-0000ab60: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0000ab70: 2022 2220 3d3d 206e 6f74 650a 2020 2020   "" == note.    
-0000ab80: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000ab90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000aba0: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-0000abb0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-0000abc0: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
-0000abd0: 5d20 3d20 6e6f 7465 0a20 2020 2020 2020  ] = note.       
-0000abe0: 2020 2020 2065 6c69 6620 6e6f 7465 206e       elif note n
-0000abf0: 6f74 2069 6e20 7365 6c66 2e64 6174 615b  ot in self.data[
-0000ac00: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000ac10: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-0000ac20: 6b65 795d 5b0a 2020 2020 2020 2020 2020  key][.          
-0000ac30: 2020 2020 2020 226e 6f74 6522 0a20 2020        "note".   
-0000ac40: 2020 2020 2020 2020 205d 2e73 706c 6974           ].split
-0000ac50: 2822 2c22 293a 0a20 2020 2020 2020 2020  (","):.         
-0000ac60: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-0000ac70: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
-0000ac80: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-0000ac90: 5b6b 6579 5d5b 226e 6f74 6522 5d20 2b3d  [key]["note"] +=
-0000aca0: 2066 222c 7b6e 6f74 657d 220a 2020 2020   f",{note}".    
-0000acb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000acc0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-0000acd0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000ace0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-0000acf0: 6b65 795d 203d 207b 0a20 2020 2020 2020  key] = {.       
-0000ad00: 2020 2020 2020 2020 2022 736f 7572 6365           "source
-0000ad10: 223a 2022 4f52 4947 494e 414c 222c 0a20  ": "ORIGINAL",. 
-0000ad20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000ad30: 6e6f 7465 223a 206e 6f74 652c 0a20 2020  note": note,.   
-0000ad40: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-0000ad50: 2020 2020 6578 6973 7469 6e67 5f6e 6f74      existing_not
-0000ad60: 6520 3d20 7365 6c66 2e64 6174 615b 2263  e = self.data["c
-0000ad70: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-0000ad80: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
-0000ad90: 795d 5b22 6e6f 7465 225d 0a20 2020 2020  y]["note"].     
-0000ada0: 2020 2069 6620 2271 7561 6c69 7479 5f64     if "quality_d
-0000adb0: 6566 6563 7422 2069 6e20 6578 6973 7469  efect" in existi
-0000adc0: 6e67 5f6e 6f74 6520 616e 6420 616e 7928  ng_note and any(
-0000add0: 0a20 2020 2020 2020 2020 2020 2078 2069  .            x i
-0000ade0: 6e20 6578 6973 7469 6e67 5f6e 6f74 6520  n existing_note 
-0000adf0: 666f 7220 7820 696e 205b 226d 6973 7369  for x in ["missi
-0000ae00: 6e67 222c 2022 6469 7361 6772 6565 6d65  ng", "disagreeme
-0000ae10: 6e74 225d 0a20 2020 2020 2020 2029 3a0a  nt"].        ):.
-0000ae20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ae30: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-0000ae40: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-0000ae50: 6e63 6522 5d5b 6b65 795d 5b22 6e6f 7465  nce"][key]["note
-0000ae60: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-0000ae70: 2020 2020 2020 2065 7869 7374 696e 675f         existing_
-0000ae80: 6e6f 7465 2e72 6570 6c61 6365 2822 7175  note.replace("qu
-0000ae90: 616c 6974 795f 6465 6665 6374 222c 2022  ality_defect", "
-0000aea0: 2229 2e72 7374 7269 7028 222c 2229 2e6c  ").rstrip(",").l
-0000aeb0: 7374 7269 7028 222c 2229 0a20 2020 2020  strip(",").     
-0000aec0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000aed0: 6620 6164 645f 6461 7461 5f70 726f 7665  f add_data_prove
-0000aee0: 6e61 6e63 655f 6e6f 7465 2873 656c 662c  nance_note(self,
-0000aef0: 202a 2c20 6b65 793a 2073 7472 2c20 6e6f   *, key: str, no
-0000af00: 7465 3a20 7374 7229 202d 3e20 4e6f 6e65  te: str) -> None
-0000af10: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
-0000af20: 2061 2064 6174 6120 7072 6f76 656e 616e   a data provenan
-0000af30: 6365 206e 6f74 6520 2862 6173 6564 206f  ce note (based o
-0000af40: 6e20 6120 6b65 7929 2222 220a 2020 2020  n a key)""".    
-0000af50: 2020 2020 6966 2022 636f 6c72 6576 5f64      if "colrev_d
-0000af60: 6174 615f 7072 6f76 656e 616e 6365 2220  ata_provenance" 
-0000af70: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
-0000af80: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000af90: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000afa0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-0000afb0: 5d20 3d20 7b7d 0a20 2020 2020 2020 2069  ] = {}.        i
-0000afc0: 6620 6b65 7920 696e 2073 656c 662e 6461  f key in self.da
-0000afd0: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
-0000afe0: 7072 6f76 656e 616e 6365 225d 3a0a 2020  provenance"]:.  
-0000aff0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000b000: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
-0000b010: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-0000b020: 5b6b 6579 5d5b 226e 6f74 6522 5d20 3d3d  [key]["note"] ==
-0000b030: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-0000b040: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-0000b050: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-0000b060: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
-0000b070: 6f74 6522 5d20 3d20 6e6f 7465 0a20 2020  ote"] = note.   
-0000b080: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
-0000b090: 7465 206e 6f74 2069 6e20 7365 6c66 2e64  te not in self.d
-0000b0a0: 6174 615b 2263 6f6c 7265 765f 6461 7461  ata["colrev_data
-0000b0b0: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
-0000b0c0: 795d 5b22 6e6f 7465 225d 2e73 706c 6974  y]["note"].split
-0000b0d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000b0e0: 2020 222c 220a 2020 2020 2020 2020 2020    ",".          
-0000b0f0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000b100: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-0000b110: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-0000b120: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
-0000b130: 6f74 6522 5d20 2b3d 2066 222c 7b6e 6f74  ote"] += f",{not
-0000b140: 657d 220a 2020 2020 2020 2020 656c 7365  e}".        else
-0000b150: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000b160: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000b170: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-0000b180: 5d5b 6b65 795d 203d 207b 0a20 2020 2020  ][key] = {.     
-0000b190: 2020 2020 2020 2020 2020 2022 736f 7572             "sour
-0000b1a0: 6365 223a 2022 4f52 4947 494e 414c 222c  ce": "ORIGINAL",
-0000b1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b1c0: 2022 6e6f 7465 223a 206e 6f74 652c 0a20   "note": note,. 
-0000b1d0: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
-0000b1e0: 2020 6465 6620 6164 645f 6d61 7374 6572    def add_master
-0000b1f0: 6461 7461 5f70 726f 7665 6e61 6e63 6528  data_provenance(
-0000b200: 0a20 2020 2020 2020 2073 656c 662c 202a  .        self, *
-0000b210: 2c20 6b65 793a 2073 7472 2c20 736f 7572  , key: str, sour
-0000b220: 6365 3a20 7374 722c 206e 6f74 653a 2073  ce: str, note: s
-0000b230: 7472 203d 2022 220a 2020 2020 2920 2d3e  tr = "".    ) ->
-0000b240: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-0000b250: 2222 4164 6420 6120 6d61 7374 6572 6461  ""Add a masterda
-0000b260: 7461 2070 726f 7665 6e61 6e63 652c 2069  ta provenance, i
-0000b270: 6e63 6c75 6469 6e67 2073 6f75 7263 6520  ncluding source 
-0000b280: 616e 6420 6e6f 7465 2028 6261 7365 6420  and note (based 
-0000b290: 6f6e 2061 206b 6579 2922 2222 0a20 2020  on a key)""".   
-0000b2a0: 2020 2020 2069 6620 2263 6f6c 7265 765f       if "colrev_
-0000b2b0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000b2c0: 6e61 6e63 6522 206e 6f74 2069 6e20 7365  nance" not in se
-0000b2d0: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
-0000b2e0: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-0000b2f0: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-0000b300: 615f 7072 6f76 656e 616e 6365 225d 203d  a_provenance"] =
-0000b310: 207b 7d0a 2020 2020 2020 2020 6d64 5f70   {}.        md_p
-0000b320: 5f64 6963 7420 3d20 7365 6c66 2e64 6174  _dict = self.dat
-0000b330: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
-0000b340: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-0000b350: 5d0a 0a20 2020 2020 2020 2069 6620 6b65  ]..        if ke
-0000b360: 7920 696e 206d 645f 705f 6469 6374 3a0a  y in md_p_dict:.
-0000b370: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0000b380: 645f 705f 6469 6374 5b6b 6579 5d5b 226e  d_p_dict[key]["n
-0000b390: 6f74 6522 5d20 3d3d 2022 2220 6f72 2022  ote"] == "" or "
-0000b3a0: 2220 3d3d 206e 6f74 653a 0a20 2020 2020  " == note:.     
-0000b3b0: 2020 2020 2020 2020 2020 206d 645f 705f             md_p_
-0000b3c0: 6469 6374 5b6b 6579 5d5b 226e 6f74 6522  dict[key]["note"
-0000b3d0: 5d20 3d20 6e6f 7465 0a20 2020 2020 2020  ] = note.       
-0000b3e0: 2020 2020 2065 6c69 6620 226d 6973 7369       elif "missi
-0000b3f0: 6e67 2220 3d3d 206e 6f74 6520 616e 6420  ng" == note and 
-0000b400: 226e 6f74 2d6d 6973 7369 6e67 2220 696e  "not-missing" in
-0000b410: 206d 645f 705f 6469 6374 5b6b 6579 5d5b   md_p_dict[key][
-0000b420: 226e 6f74 6522 5d2e 7370 6c69 7428 0a20  "note"].split(. 
-0000b430: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000b440: 2c22 0a20 2020 2020 2020 2020 2020 2029  ,".            )
-0000b450: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b460: 2020 6d64 5f70 5f64 6963 745b 6b65 795d    md_p_dict[key]
-0000b470: 5b22 6e6f 7465 225d 203d 2022 6d69 7373  ["note"] = "miss
-0000b480: 696e 6722 0a20 2020 2020 2020 2020 2020  ing".           
-0000b490: 2065 6c69 6620 6e6f 7465 206e 6f74 2069   elif note not i
-0000b4a0: 6e20 6d64 5f70 5f64 6963 745b 6b65 795d  n md_p_dict[key]
-0000b4b0: 5b22 6e6f 7465 225d 2e73 706c 6974 2822  ["note"].split("
-0000b4c0: 2c22 293a 0a20 2020 2020 2020 2020 2020  ,"):.           
-0000b4d0: 2020 2020 206d 645f 705f 6469 6374 5b6b       md_p_dict[k
-0000b4e0: 6579 5d5b 226e 6f74 6522 5d20 2b3d 2066  ey]["note"] += f
-0000b4f0: 222c 7b6e 6f74 657d 220a 2020 2020 2020  ",{note}".      
-0000b500: 2020 2020 2020 6d64 5f70 5f64 6963 745b        md_p_dict[
-0000b510: 6b65 795d 5b22 736f 7572 6365 225d 203d  key]["source"] =
-0000b520: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
-0000b530: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b540: 2020 6d64 5f70 5f64 6963 745b 6b65 795d    md_p_dict[key]
-0000b550: 203d 207b 2273 6f75 7263 6522 3a20 736f   = {"source": so
-0000b560: 7572 6365 2c20 226e 6f74 6522 3a20 6622  urce, "note": f"
-0000b570: 7b6e 6f74 657d 227d 0a0a 2020 2020 6465  {note}"}..    de
-0000b580: 6620 6164 645f 7072 6f76 656e 616e 6365  f add_provenance
-0000b590: 5f61 6c6c 2873 656c 662c 202a 2c20 736f  _all(self, *, so
-0000b5a0: 7572 6365 3a20 7374 7229 202d 3e20 4e6f  urce: str) -> No
-0000b5b0: 6e65 3a0a 2020 2020 2020 2020 2222 2241  ne:.        """A
-0000b5c0: 6464 2061 2064 6174 6120 7072 6f76 656e  dd a data proven
-0000b5d0: 616e 6365 2028 736f 7572 6365 2920 746f  ance (source) to
-0000b5e0: 2061 6c6c 2066 6965 6c64 7322 2222 0a20   all fields""". 
-0000b5f0: 2020 2020 2020 2069 6620 2263 6f6c 7265         if "colre
-0000b600: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
-0000b610: 7665 6e61 6e63 6522 206e 6f74 2069 6e20  venance" not in 
-0000b620: 7365 6c66 2e64 6174 613a 0a20 2020 2020  self.data:.     
-0000b630: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-0000b640: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
-0000b650: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-0000b660: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
-0000b670: 2022 636f 6c72 6576 5f64 6174 615f 7072   "colrev_data_pr
-0000b680: 6f76 656e 616e 6365 2220 6e6f 7420 696e  ovenance" not in
-0000b690: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-0000b6a0: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-0000b6b0: 615b 2263 6f6c 7265 765f 6461 7461 5f70  a["colrev_data_p
-0000b6c0: 726f 7665 6e61 6e63 6522 5d20 3d20 7b7d  rovenance"] = {}
-0000b6d0: 0a0a 2020 2020 2020 2020 6d64 5f70 5f64  ..        md_p_d
-0000b6e0: 6963 7420 3d20 7365 6c66 2e64 6174 615b  ict = self.data[
-0000b6f0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000b700: 7461 5f70 726f 7665 6e61 6e63 6522 5d0a  ta_provenance"].
-0000b710: 2020 2020 2020 2020 645f 705f 6469 6374          d_p_dict
-0000b720: 203d 2073 656c 662e 6461 7461 5b22 636f   = self.data["co
-0000b730: 6c72 6576 5f64 6174 615f 7072 6f76 656e  lrev_data_proven
-0000b740: 616e 6365 225d 0a20 2020 2020 2020 2066  ance"].        f
-0000b750: 6f72 206b 6579 2069 6e20 7365 6c66 2e64  or key in self.d
-0000b760: 6174 612e 6b65 7973 2829 3a0a 2020 2020  ata.keys():.    
-0000b770: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
-0000b780: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
-0000b790: 2020 2020 2245 4e54 5259 5459 5045 222c      "ENTRYTYPE",
-0000b7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b7b0: 2022 636f 6c72 6576 5f64 6174 615f 7072   "colrev_data_pr
-0000b7c0: 6f76 656e 616e 6365 222c 0a20 2020 2020  ovenance",.     
-0000b7d0: 2020 2020 2020 2020 2020 2022 636f 6c72             "colr
-0000b7e0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-0000b7f0: 6f76 656e 616e 6365 222c 0a20 2020 2020  ovenance",.     
-0000b800: 2020 2020 2020 2020 2020 2022 636f 6c72             "colr
-0000b810: 6576 5f73 7461 7475 7322 2c0a 2020 2020  ev_status",.    
-0000b820: 2020 2020 2020 2020 2020 2020 2263 6f6c              "col
-0000b830: 7265 765f 6964 222c 0a20 2020 2020 2020  rev_id",.       
-0000b840: 2020 2020 205d 3a0a 2020 2020 2020 2020       ]:.        
-0000b850: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0000b860: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000b870: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000b880: 2020 6b65 7920 696e 2073 656c 662e 6964    key in self.id
-0000b890: 656e 7469 6679 696e 675f 6669 656c 645f  entifying_field_
-0000b8a0: 6b65 7973 0a20 2020 2020 2020 2020 2020  keys.           
-0000b8b0: 2020 2020 2061 6e64 2022 4355 5241 5445       and "CURATE
-0000b8c0: 4422 206e 6f74 2069 6e20 7365 6c66 2e64  D" not in self.d
-0000b8d0: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
-0000b8e0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-0000b8f0: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-0000b900: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b910: 2020 206d 645f 705f 6469 6374 5b6b 6579     md_p_dict[key
-0000b920: 5d20 3d20 7b22 736f 7572 6365 223a 2073  ] = {"source": s
-0000b930: 6f75 7263 652c 2022 6e6f 7465 223a 2022  ource, "note": "
-0000b940: 227d 0a20 2020 2020 2020 2020 2020 2065  "}.            e
-0000b950: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000b960: 2020 2020 2064 5f70 5f64 6963 745b 6b65       d_p_dict[ke
-0000b970: 795d 203d 207b 2273 6f75 7263 6522 3a20  y] = {"source": 
-0000b980: 736f 7572 6365 2c20 226e 6f74 6522 3a20  source, "note": 
-0000b990: 2222 7d0a 0a20 2020 2064 6566 2061 6464  ""}..    def add
-0000b9a0: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-0000b9b0: 2873 656c 662c 202a 2c20 6b65 793a 2073  (self, *, key: s
-0000b9c0: 7472 2c20 736f 7572 6365 3a20 7374 722c  tr, source: str,
-0000b9d0: 206e 6f74 653a 2073 7472 203d 2022 2229   note: str = "")
-0000b9e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000b9f0: 2020 2222 2241 6464 2061 2064 6174 6120    """Add a data 
-0000ba00: 7072 6f76 656e 616e 6365 2c20 696e 636c  provenance, incl
-0000ba10: 7564 696e 6720 736f 7572 6365 2061 6e64  uding source and
-0000ba20: 206e 6f74 6520 2862 6173 6564 206f 6e20   note (based on 
-0000ba30: 6120 6b65 7929 2222 220a 2020 2020 2020  a key)""".      
-0000ba40: 2020 6966 2022 636f 6c72 6576 5f64 6174    if "colrev_dat
-0000ba50: 615f 7072 6f76 656e 616e 6365 2220 6e6f  a_provenance" no
-0000ba60: 7420 696e 2073 656c 662e 6461 7461 3a0a  t in self.data:.
-0000ba70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ba80: 2e64 6174 615b 2263 6f6c 7265 765f 6461  .data["colrev_da
-0000ba90: 7461 5f70 726f 7665 6e61 6e63 6522 5d20  ta_provenance"] 
-0000baa0: 3d20 7b7d 0a20 2020 2020 2020 206d 645f  = {}.        md_
-0000bab0: 705f 6469 6374 203d 2073 656c 662e 6461  p_dict = self.da
-0000bac0: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
-0000bad0: 7072 6f76 656e 616e 6365 225d 0a20 2020  provenance"].   
-0000bae0: 2020 2020 2069 6620 6b65 7920 696e 206d       if key in m
-0000baf0: 645f 705f 6469 6374 3a0a 2020 2020 2020  d_p_dict:.      
-0000bb00: 2020 2020 2020 6966 206e 6f74 6520 213d        if note !=
-0000bb10: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-0000bb20: 2020 2020 206d 645f 705f 6469 6374 5b6b       md_p_dict[k
-0000bb30: 6579 5d5b 226e 6f74 6522 5d20 2b3d 2066  ey]["note"] += f
-0000bb40: 222c 7b6e 6f74 657d 220a 2020 2020 2020  ",{note}".      
-0000bb50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000bb60: 2020 2020 2020 2020 2020 2020 6d64 5f70              md_p
-0000bb70: 5f64 6963 745b 6b65 795d 5b22 6e6f 7465  _dict[key]["note
-0000bb80: 225d 203d 2022 220a 2020 2020 2020 2020  "] = "".        
-0000bb90: 2020 2020 6d64 5f70 5f64 6963 745b 6b65      md_p_dict[ke
-0000bba0: 795d 5b22 736f 7572 6365 225d 203d 2073  y]["source"] = s
-0000bbb0: 6f75 7263 650a 2020 2020 2020 2020 656c  ource.        el
-0000bbc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000bbd0: 6d64 5f70 5f64 6963 745b 6b65 795d 203d  md_p_dict[key] =
-0000bbe0: 207b 2273 6f75 7263 6522 3a20 736f 7572   {"source": sour
-0000bbf0: 6365 2c20 226e 6f74 6522 3a20 6622 7b6e  ce, "note": f"{n
-0000bc00: 6f74 657d 227d 0a0a 2020 2020 6465 6620  ote}"}..    def 
-0000bc10: 636f 6d70 6c65 7465 5f70 726f 7665 6e61  complete_provena
-0000bc20: 6e63 6528 7365 6c66 2c20 2a2c 2073 6f75  nce(self, *, sou
-0000bc30: 7263 655f 696e 666f 3a20 7374 7229 202d  rce_info: str) -
-0000bc40: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-0000bc50: 2222 2243 6f6d 706c 6574 6520 7072 6f76  """Complete prov
-0000bc60: 656e 616e 6365 2069 6e66 6f72 6d61 7469  enance informati
-0000bc70: 6f6e 2066 6f72 2069 6e64 6578 696e 6722  on for indexing"
-0000bc80: 2222 0a0a 2020 2020 2020 2020 666f 7220  ""..        for 
-0000bc90: 6b65 7920 696e 206c 6973 7428 7365 6c66  key in list(self
-0000bca0: 2e64 6174 612e 6b65 7973 2829 293a 0a20  .data.keys()):. 
-0000bcb0: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
-0000bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcd0: 6b65 790a 2020 2020 2020 2020 2020 2020  key.            
-0000bce0: 2020 2020 696e 205b 0a20 2020 2020 2020      in [.       
-0000bcf0: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-0000bd00: 6c72 6576 5f69 6422 2c0a 2020 2020 2020  lrev_id",.      
-0000bd10: 2020 2020 2020 2020 2020 2020 2020 2245                "E
-0000bd20: 4e54 5259 5459 5045 222c 0a20 2020 2020  NTRYTYPE",.     
-0000bd30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000bd40: 4944 222c 0a20 2020 2020 2020 2020 2020  ID",.           
-0000bd50: 2020 2020 2020 2020 2022 6d65 7461 6461           "metada
-0000bd60: 7461 5f73 6f75 7263 655f 7265 706f 7369  ta_source_reposi
-0000bd70: 746f 7279 5f70 6174 6873 222c 0a20 2020  tory_paths",.   
-0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd90: 2022 6c6f 6361 6c5f 6375 7261 7465 645f   "local_curated_
-0000bda0: 6d65 7461 6461 7461 222c 0a20 2020 2020  metadata",.     
-0000bdb0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-0000bdc0: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-0000bdd0: 656c 662e 7072 6f76 656e 616e 6365 5f6b  elf.provenance_k
-0000bde0: 6579 730a 2020 2020 2020 2020 2020 2020  eys.            
-0000bdf0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000be00: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-0000be10: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-0000be20: 696e 2073 656c 662e 6964 656e 7469 6679  in self.identify
-0000be30: 696e 675f 6669 656c 645f 6b65 7973 3a0a  ing_field_keys:.
-0000be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be50: 6966 206e 6f74 2073 656c 662e 6d61 7374  if not self.mast
-0000be60: 6572 6461 7461 5f69 735f 6375 7261 7465  erdata_is_curate
-0000be70: 6428 293a 0a20 2020 2020 2020 2020 2020  d():.           
-0000be80: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
-0000be90: 645f 6d61 7374 6572 6461 7461 5f70 726f  d_masterdata_pro
-0000bea0: 7665 6e61 6e63 6528 6b65 793d 6b65 792c  venance(key=key,
-0000beb0: 2073 6f75 7263 653d 736f 7572 6365 5f69   source=source_i
-0000bec0: 6e66 6f2c 206e 6f74 653d 2222 290a 2020  nfo, note="").  
-0000bed0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00009e40: 6175 7468 6f72 5f73 696d 696c 6172 6974  author_similarit
+00009e50: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00009e60: 2020 2020 2020 2074 6974 6c65 5f73 696d         title_sim
+00009e70: 696c 6172 6974 792c 0a20 2020 2020 2020  ilarity,.       
+00009e80: 2020 2020 2020 2020 2020 2020 2079 6561               yea
+00009e90: 725f 7369 6d69 6c61 7269 7479 2c0a 2020  r_similarity,.  
+00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009eb0: 2020 6f75 746c 6574 5f73 696d 696c 6172    outlet_similar
+00009ec0: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
+00009ed0: 2020 2020 2020 2020 2076 6f6c 756d 655f           volume_
+00009ee0: 7369 6d69 6c61 7269 7479 2c0a 2020 2020  similarity,.    
+00009ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f00: 6e75 6d62 6572 5f73 696d 696c 6172 6974  number_similarit
+00009f10: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00009f20: 2020 205d 0a0a 2020 2020 2020 2020 2020     ]..          
+00009f30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00009f40: 2020 2020 2020 2020 7765 6967 6874 7320          weights 
+00009f50: 3d20 5b30 2e31 352c 2030 2e37 352c 2030  = [0.15, 0.75, 0
+00009f60: 2e30 352c 2030 2e30 355d 0a20 2020 2020  .05, 0.05].     
+00009f70: 2020 2020 2020 2020 2020 2073 696d 5f6e             sim_n
+00009f80: 616d 6573 203d 205b 0a20 2020 2020 2020  ames = [.       
+00009f90: 2020 2020 2020 2020 2020 2020 2022 6175               "au
+00009fa0: 7468 6f72 222c 0a20 2020 2020 2020 2020  thor",.         
+00009fb0: 2020 2020 2020 2020 2020 2022 7469 746c             "titl
+00009fc0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+00009fd0: 2020 2020 2020 2020 2279 6561 7222 2c0a          "year",.
+00009fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ff0: 2020 2020 226f 7574 6c65 7422 2c0a 2020      "outlet",.  
+0000a000: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a020: 7369 6d69 6c61 7269 7469 6573 203d 205b  similarities = [
+0000a030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a040: 2020 2020 2061 7574 686f 725f 7369 6d69       author_simi
+0000a050: 6c61 7269 7479 2c0a 2020 2020 2020 2020  larity,.        
+0000a060: 2020 2020 2020 2020 2020 2020 7469 746c              titl
+0000a070: 655f 7369 6d69 6c61 7269 7479 2c0a 2020  e_similarity,.  
+0000a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a090: 2020 7965 6172 5f73 696d 696c 6172 6974    year_similarit
+0000a0a0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+0000a0b0: 2020 2020 2020 206f 7574 6c65 745f 7369         outlet_si
+0000a0c0: 6d69 6c61 7269 7479 2c0a 2020 2020 2020  milarity,.      
+0000a0d0: 2020 2020 2020 2020 2020 5d0a 0a20 2020            ]..   
+0000a0e0: 2020 2020 2020 2020 2077 6569 6768 7465           weighte
+0000a0f0: 645f 6176 6572 6167 6520 3d20 7375 6d28  d_average = sum(
+0000a100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a110: 2073 696d 696c 6172 6974 6965 735b 675d   similarities[g]
+0000a120: 202a 2077 6569 6768 7473 5b67 5d20 666f   * weights[g] fo
+0000a130: 7220 6720 696e 2072 616e 6765 286c 656e  r g in range(len
+0000a140: 2873 696d 696c 6172 6974 6965 7329 290a  (similarities)).
+0000a150: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000a160: 2020 2020 2020 2020 2020 2064 6574 6169             detai
+0000a170: 6c73 203d 2028 0a20 2020 2020 2020 2020  ls = (.         
+0000a180: 2020 2020 2020 2022 5b22 0a20 2020 2020         "[".     
+0000a190: 2020 2020 2020 2020 2020 202b 2022 2c22             + ","
+0000a1a0: 2e6a 6f69 6e28 5b73 696d 5f6e 616d 6573  .join([sim_names
+0000a1b0: 5b67 5d20 666f 7220 6720 696e 2072 616e  [g] for g in ran
+0000a1c0: 6765 286c 656e 2873 696d 696c 6172 6974  ge(len(similarit
+0000a1d0: 6965 7329 295d 290a 2020 2020 2020 2020  ies))]).        
+0000a1e0: 2020 2020 2020 2020 2b20 225d 220a 2020          + "]".  
+0000a1f0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000a200: 222a 7765 6967 6874 735f 7665 636f 725e  "*weights_vecor^
+0000a210: 5420 3d20 220a 2020 2020 2020 2020 2020  T = ".          
+0000a220: 2020 2020 2020 2b20 225b 220a 2020 2020        + "[".    
+0000a230: 2020 2020 2020 2020 2020 2020 2b20 222c              + ",
+0000a240: 222e 6a6f 696e 285b 7374 7228 7369 6d69  ".join([str(simi
+0000a250: 6c61 7269 7469 6573 5b67 5d29 2066 6f72  larities[g]) for
+0000a260: 2067 2069 6e20 7261 6e67 6528 6c65 6e28   g in range(len(
+0000a270: 7369 6d69 6c61 7269 7469 6573 2929 5d29  similarities))])
+0000a280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a290: 202b 2022 5d2a 220a 2020 2020 2020 2020   + "]*".        
+0000a2a0: 2020 2020 2020 2020 2b20 225b 220a 2020          + "[".  
+0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000a2c0: 222c 222e 6a6f 696e 285b 7374 7228 7765  ",".join([str(we
+0000a2d0: 6967 6874 735b 675d 2920 666f 7220 6720  ights[g]) for g 
+0000a2e0: 696e 2072 616e 6765 286c 656e 2873 696d  in range(len(sim
+0000a2f0: 696c 6172 6974 6965 7329 295d 290a 2020  ilarities))]).  
+0000a300: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000a310: 225d 5e54 220a 2020 2020 2020 2020 2020  "]^T".          
+0000a320: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000a330: 7369 6d69 6c61 7269 7479 5f73 636f 7265  similarity_score
+0000a340: 203d 2072 6f75 6e64 2877 6569 6768 7465   = round(weighte
+0000a350: 645f 6176 6572 6167 652c 2034 290a 2020  d_average, 4).  
+0000a360: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
+0000a370: 7269 6275 7465 4572 726f 723a 0a20 2020  ributeError:.   
+0000a380: 2020 2020 2020 2020 2073 696d 696c 6172           similar
+0000a390: 6974 795f 7363 6f72 6520 3d20 300a 2020  ity_score = 0.  
+0000a3a0: 2020 2020 2020 2020 2020 6465 7461 696c            detail
+0000a3b0: 7320 3d20 2222 0a20 2020 2020 2020 2072  s = "".        r
+0000a3c0: 6574 7572 6e20 7b22 7363 6f72 6522 3a20  eturn {"score": 
+0000a3d0: 7369 6d69 6c61 7269 7479 5f73 636f 7265  similarity_score
+0000a3e0: 2c20 2264 6574 6169 6c73 223a 2064 6574  , "details": det
+0000a3f0: 6169 6c73 7d0a 0a20 2020 2064 6566 2067  ails}..    def g
+0000a400: 6574 5f66 6965 6c64 5f70 726f 7665 6e61  et_field_provena
+0000a410: 6e63 6528 0a20 2020 2020 2020 2073 656c  nce(.        sel
+0000a420: 662c 202a 2c20 6b65 793a 2073 7472 2c20  f, *, key: str, 
+0000a430: 6465 6661 756c 745f 736f 7572 6365 3a20  default_source: 
+0000a440: 7374 7220 3d20 224f 5249 4749 4e41 4c22  str = "ORIGINAL"
+0000a450: 0a20 2020 2029 202d 3e20 6469 6374 3a0a  .    ) -> dict:.
+0000a460: 2020 2020 2020 2020 2222 2247 6574 2074          """Get t
+0000a470: 6865 2070 726f 7665 6e61 6e63 6520 666f  he provenance fo
+0000a480: 7220 6120 7365 6c65 6374 6564 2066 6965  r a selected fie
+0000a490: 6c64 2028 6b65 7929 2222 220a 2020 2020  ld (key)""".    
+0000a4a0: 2020 2020 6465 6661 756c 745f 6e6f 7465      default_note
+0000a4b0: 203d 2022 220a 2020 2020 2020 2020 6e6f   = "".        no
+0000a4c0: 7465 203d 2064 6566 6175 6c74 5f6e 6f74  te = default_not
+0000a4d0: 650a 2020 2020 2020 2020 736f 7572 6365  e.        source
+0000a4e0: 203d 2064 6566 6175 6c74 5f73 6f75 7263   = default_sourc
+0000a4f0: 650a 2020 2020 2020 2020 6966 206b 6579  e.        if key
+0000a500: 2069 6e20 7365 6c66 2e69 6465 6e74 6966   in self.identif
+0000a510: 7969 6e67 5f66 6965 6c64 5f6b 6579 733a  ying_field_keys:
+0000a520: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000a530: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+0000a540: 7461 5f70 726f 7665 6e61 6e63 6522 2069  ta_provenance" i
+0000a550: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
+0000a560: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a570: 6b65 7920 696e 2073 656c 662e 6461 7461  key in self.data
+0000a580: 2e67 6574 2822 636f 6c72 6576 5f6d 6173  .get("colrev_mas
+0000a590: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+0000a5a0: 6365 222c 207b 7d29 3a0a 2020 2020 2020  ce", {}):.      
+0000a5b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000a5c0: 2022 736f 7572 6365 2220 696e 2073 656c   "source" in sel
+0000a5d0: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
+0000a5e0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+0000a5f0: 616e 6365 225d 5b6b 6579 5d3a 0a20 2020  ance"][key]:.   
+0000a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a610: 2020 2020 2073 6f75 7263 6520 3d20 7365       source = se
+0000a620: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000a630: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+0000a640: 6e61 6e63 6522 5d5b 6b65 795d 5b0a 2020  nance"][key][.  
+0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a660: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+0000a670: 6522 0a20 2020 2020 2020 2020 2020 2020  e".             
+0000a680: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
+0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6a0: 2069 6620 226e 6f74 6522 2069 6e20 7365   if "note" in se
+0000a6b0: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000a6c0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+0000a6d0: 6e61 6e63 6522 5d5b 6b65 795d 3a0a 2020  nance"][key]:.  
+0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6f0: 2020 2020 2020 6e6f 7465 203d 2073 656c        note = sel
+0000a700: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
+0000a710: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+0000a720: 616e 6365 225d 5b6b 6579 5d5b 226e 6f74  ance"][key]["not
+0000a730: 6522 5d0a 2020 2020 2020 2020 656c 7365  e"].        else
+0000a740: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000a750: 2022 636f 6c72 6576 5f64 6174 615f 7072   "colrev_data_pr
+0000a760: 6f76 656e 616e 6365 2220 696e 2073 656c  ovenance" in sel
+0000a770: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+0000a780: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
+0000a790: 6e20 7365 6c66 2e64 6174 615b 2263 6f6c  n self.data["col
+0000a7a0: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+0000a7b0: 6e63 6522 5d3a 0a20 2020 2020 2020 2020  nce"]:.         
+0000a7c0: 2020 2020 2020 2020 2020 2069 6620 2273             if "s
+0000a7d0: 6f75 7263 6522 2069 6e20 7365 6c66 2e64  ource" in self.d
+0000a7e0: 6174 615b 2263 6f6c 7265 765f 6461 7461  ata["colrev_data
+0000a7f0: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
+0000a800: 795d 3a0a 2020 2020 2020 2020 2020 2020  y]:.            
+0000a810: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0000a820: 6365 203d 2073 656c 662e 6461 7461 5b22  ce = self.data["
+0000a830: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+0000a840: 656e 616e 6365 225d 5b6b 6579 5d5b 2273  enance"][key]["s
+0000a850: 6f75 7263 6522 5d0a 2020 2020 2020 2020  ource"].        
+0000a860: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+0000a870: 6e6f 7465 2220 696e 2073 656c 662e 6461  note" in self.da
+0000a880: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
+0000a890: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
+0000a8a0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0000a8b0: 2020 2020 2020 2020 2020 206e 6f74 6520             note 
+0000a8c0: 3d20 7365 6c66 2e64 6174 615b 2263 6f6c  = self.data["col
+0000a8d0: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+0000a8e0: 6e63 6522 5d5b 6b65 795d 5b22 6e6f 7465  nce"][key]["note
+0000a8f0: 225d 0a0a 2020 2020 2020 2020 7265 7475  "]..        retu
+0000a900: 726e 207b 2273 6f75 7263 6522 3a20 736f  rn {"source": so
+0000a910: 7572 6365 2c20 226e 6f74 6522 3a20 6e6f  urce, "note": no
+0000a920: 7465 7d0a 0a20 2020 2064 6566 2072 656d  te}..    def rem
+0000a930: 6f76 655f 6d61 7374 6572 6461 7461 5f70  ove_masterdata_p
+0000a940: 726f 7665 6e61 6e63 655f 6e6f 7465 2873  rovenance_note(s
+0000a950: 656c 662c 202a 2c20 6b65 793a 2073 7472  elf, *, key: str
+0000a960: 2c20 6e6f 7465 3a20 7374 7229 202d 3e20  , note: str) -> 
+0000a970: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000a980: 2252 656d 6f76 6520 6120 6d61 7374 6572  "Remove a master
+0000a990: 6461 7461 2070 726f 7665 6e61 6e63 6520  data provenance 
+0000a9a0: 6e6f 7465 2222 220a 2020 2020 2020 2020  note""".        
+0000a9b0: 6966 2022 636f 6c72 6576 5f6d 6173 7465  if "colrev_maste
+0000a9c0: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000a9d0: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+0000a9e0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0000a9f0: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
+0000aa00: 6620 6b65 7920 6e6f 7420 696e 2073 656c  f key not in sel
+0000aa10: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
+0000aa20: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+0000aa30: 616e 6365 225d 3a0a 2020 2020 2020 2020  ance"]:.        
+0000aa40: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+0000aa50: 2020 206e 6f74 6573 203d 2073 656c 662e     notes = self.
+0000aa60: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+0000aa70: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+0000aa80: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
+0000aa90: 5d2e 7370 6c69 7428 222c 2229 0a20 2020  ].split(",").   
+0000aaa0: 2020 2020 2069 6620 6e6f 7465 206e 6f74       if note not
+0000aab0: 2069 6e20 6e6f 7465 733a 0a20 2020 2020   in notes:.     
+0000aac0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+0000aad0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+0000aae0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+0000aaf0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
+0000ab00: 6b65 795d 5b22 6e6f 7465 225d 203d 2022  key]["note"] = "
+0000ab10: 2c22 2e6a 6f69 6e28 0a20 2020 2020 2020  ,".join(.       
+0000ab20: 2020 2020 206e 2066 6f72 206e 2069 6e20       n for n in 
+0000ab30: 6e6f 7465 7320 6966 206e 2021 3d20 6e6f  notes if n != no
+0000ab40: 7465 0a20 2020 2020 2020 2029 0a0a 2020  te.        )..  
+0000ab50: 2020 6465 6620 6164 645f 6d61 7374 6572    def add_master
+0000ab60: 6461 7461 5f70 726f 7665 6e61 6e63 655f  data_provenance_
+0000ab70: 6e6f 7465 2873 656c 662c 202a 2c20 6b65  note(self, *, ke
+0000ab80: 793a 2073 7472 2c20 6e6f 7465 3a20 7374  y: str, note: st
+0000ab90: 7229 202d 3e20 4e6f 6e65 3a0a 2020 2020  r) -> None:.    
+0000aba0: 2020 2020 2222 2241 6464 2061 206d 6173      """Add a mas
+0000abb0: 7465 7264 6174 6120 7072 6f76 656e 616e  terdata provenan
+0000abc0: 6365 206e 6f74 6520 2862 6173 6564 206f  ce note (based o
+0000abd0: 6e20 6120 6b65 7929 2222 220a 2020 2020  n a key)""".    
+0000abe0: 2020 2020 6966 2022 636f 6c72 6576 5f6d      if "colrev_m
+0000abf0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+0000ac00: 616e 6365 2220 6e6f 7420 696e 2073 656c  ance" not in sel
+0000ac10: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+0000ac20: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
+0000ac30: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
+0000ac40: 5f70 726f 7665 6e61 6e63 6522 5d20 3d20  _provenance"] = 
+0000ac50: 7b7d 0a20 2020 2020 2020 2069 6620 6b65  {}.        if ke
+0000ac60: 7920 696e 2073 656c 662e 6461 7461 2e67  y in self.data.g
+0000ac70: 6574 2822 636f 6c72 6576 5f6d 6173 7465  et("colrev_maste
+0000ac80: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000ac90: 222c 207b 7d29 3a0a 2020 2020 2020 2020  ", {}):.        
+0000aca0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+0000acb0: 2020 2020 2020 2020 2022 2220 3d3d 2073           "" == s
+0000acc0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+0000acd0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+0000ace0: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
+0000acf0: 6f74 6522 5d0a 2020 2020 2020 2020 2020  ote"].          
+0000ad00: 2020 2020 2020 6f72 2022 2220 3d3d 206e        or "" == n
+0000ad10: 6f74 650a 2020 2020 2020 2020 2020 2020  ote.            
+0000ad20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000ad30: 2020 2073 656c 662e 6461 7461 5b22 636f     self.data["co
+0000ad40: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
+0000ad50: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
+0000ad60: 5d5b 226e 6f74 6522 5d20 3d20 6e6f 7465  ]["note"] = note
+0000ad70: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000ad80: 6620 6e6f 7465 206e 6f74 2069 6e20 7365  f note not in se
+0000ad90: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000ada0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+0000adb0: 6e61 6e63 6522 5d5b 6b65 795d 5b0a 2020  nance"][key][.  
+0000adc0: 2020 2020 2020 2020 2020 2020 2020 226e                "n
+0000add0: 6f74 6522 0a20 2020 2020 2020 2020 2020  ote".           
+0000ade0: 205d 2e73 706c 6974 2822 2c22 293a 0a20   ].split(","):. 
+0000adf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ae00: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+0000ae10: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+0000ae20: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
+0000ae30: 6f74 6522 5d20 2b3d 2066 222c 7b6e 6f74  ote"] += f",{not
+0000ae40: 657d 220a 2020 2020 2020 2020 656c 7365  e}".        else
+0000ae50: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000ae60: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000ae70: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+0000ae80: 6e61 6e63 6522 5d5b 6b65 795d 203d 207b  nance"][key] = {
+0000ae90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aea0: 2022 736f 7572 6365 223a 2022 4f52 4947   "source": "ORIG
+0000aeb0: 494e 414c 222c 0a20 2020 2020 2020 2020  INAL",.         
+0000aec0: 2020 2020 2020 2022 6e6f 7465 223a 206e         "note": n
+0000aed0: 6f74 652c 0a20 2020 2020 2020 2020 2020  ote,.           
+0000aee0: 207d 0a0a 2020 2020 2020 2020 6578 6973   }..        exis
+0000aef0: 7469 6e67 5f6e 6f74 6520 3d20 7365 6c66  ting_note = self
+0000af00: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
+0000af10: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
+0000af20: 6e63 6522 5d5b 6b65 795d 5b22 6e6f 7465  nce"][key]["note
+0000af30: 225d 0a20 2020 2020 2020 2069 6620 2271  "].        if "q
+0000af40: 7561 6c69 7479 5f64 6566 6563 7422 2069  uality_defect" i
+0000af50: 6e20 6578 6973 7469 6e67 5f6e 6f74 6520  n existing_note 
+0000af60: 616e 6420 616e 7928 0a20 2020 2020 2020  and any(.       
+0000af70: 2020 2020 2078 2069 6e20 6578 6973 7469       x in existi
+0000af80: 6e67 5f6e 6f74 6520 666f 7220 7820 696e  ng_note for x in
+0000af90: 205b 226d 6973 7369 6e67 222c 2022 6469   ["missing", "di
+0000afa0: 7361 6772 6565 6d65 6e74 225d 0a20 2020  sagreement"].   
+0000afb0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0000afc0: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
+0000afd0: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
+0000afe0: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
+0000aff0: 795d 5b22 6e6f 7465 225d 203d 2028 0a20  y]["note"] = (. 
+0000b000: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000b010: 7869 7374 696e 675f 6e6f 7465 2e72 6570  xisting_note.rep
+0000b020: 6c61 6365 2822 7175 616c 6974 795f 6465  lace("quality_de
+0000b030: 6665 6374 222c 2022 2229 2e72 7374 7269  fect", "").rstri
+0000b040: 7028 222c 2229 2e6c 7374 7269 7028 222c  p(",").lstrip(",
+0000b050: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+0000b060: 0a0a 2020 2020 6465 6620 6164 645f 6461  ..    def add_da
+0000b070: 7461 5f70 726f 7665 6e61 6e63 655f 6e6f  ta_provenance_no
+0000b080: 7465 2873 656c 662c 202a 2c20 6b65 793a  te(self, *, key:
+0000b090: 2073 7472 2c20 6e6f 7465 3a20 7374 7229   str, note: str)
+0000b0a0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000b0b0: 2020 2222 2241 6464 2061 2064 6174 6120    """Add a data 
+0000b0c0: 7072 6f76 656e 616e 6365 206e 6f74 6520  provenance note 
+0000b0d0: 2862 6173 6564 206f 6e20 6120 6b65 7929  (based on a key)
+0000b0e0: 2222 220a 2020 2020 2020 2020 6966 2022  """.        if "
+0000b0f0: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+0000b100: 656e 616e 6365 2220 6e6f 7420 696e 2073  enance" not in s
+0000b110: 656c 662e 6461 7461 3a0a 2020 2020 2020  elf.data:.      
+0000b120: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+0000b130: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
+0000b140: 7665 6e61 6e63 6522 5d20 3d20 7b7d 0a20  venance"] = {}. 
+0000b150: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+0000b160: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+0000b170: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+0000b180: 6365 225d 3a0a 2020 2020 2020 2020 2020  ce"]:.          
+0000b190: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
+0000b1a0: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+0000b1b0: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
+0000b1c0: 6f74 6522 5d20 3d3d 2022 223a 0a20 2020  ote"] == "":.   
+0000b1d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000b1e0: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
+0000b1f0: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+0000b200: 5b6b 6579 5d5b 226e 6f74 6522 5d20 3d20  [key]["note"] = 
+0000b210: 6e6f 7465 0a20 2020 2020 2020 2020 2020  note.           
+0000b220: 2065 6c69 6620 6e6f 7465 206e 6f74 2069   elif note not i
+0000b230: 6e20 7365 6c66 2e64 6174 615b 2263 6f6c  n self.data["col
+0000b240: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+0000b250: 6e63 6522 5d5b 6b65 795d 5b22 6e6f 7465  nce"][key]["note
+0000b260: 225d 2e73 706c 6974 280a 2020 2020 2020  "].split(.      
+0000b270: 2020 2020 2020 2020 2020 222c 220a 2020            ",".  
+0000b280: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+0000b290: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000b2a0: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
+0000b2b0: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+0000b2c0: 5b6b 6579 5d5b 226e 6f74 6522 5d20 2b3d  [key]["note"] +=
+0000b2d0: 2066 222c 7b6e 6f74 657d 220a 2020 2020   f",{note}".    
+0000b2e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000b2f0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+0000b300: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
+0000b310: 7665 6e61 6e63 6522 5d5b 6b65 795d 203d  venance"][key] =
+0000b320: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0000b330: 2020 2022 736f 7572 6365 223a 2022 4f52     "source": "OR
+0000b340: 4947 494e 414c 222c 0a20 2020 2020 2020  IGINAL",.       
+0000b350: 2020 2020 2020 2020 2022 6e6f 7465 223a           "note":
+0000b360: 206e 6f74 652c 0a20 2020 2020 2020 2020   note,.         
+0000b370: 2020 207d 0a0a 2020 2020 6465 6620 6164     }..    def ad
+0000b380: 645f 6d61 7374 6572 6461 7461 5f70 726f  d_masterdata_pro
+0000b390: 7665 6e61 6e63 6528 0a20 2020 2020 2020  venance(.       
+0000b3a0: 2073 656c 662c 202a 2c20 6b65 793a 2073   self, *, key: s
+0000b3b0: 7472 2c20 736f 7572 6365 3a20 7374 722c  tr, source: str,
+0000b3c0: 206e 6f74 653a 2073 7472 203d 2022 220a   note: str = "".
+0000b3d0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+0000b3e0: 2020 2020 2020 2022 2222 4164 6420 6120         """Add a 
+0000b3f0: 6d61 7374 6572 6461 7461 2070 726f 7665  masterdata prove
+0000b400: 6e61 6e63 652c 2069 6e63 6c75 6469 6e67  nance, including
+0000b410: 2073 6f75 7263 6520 616e 6420 6e6f 7465   source and note
+0000b420: 2028 6261 7365 6420 6f6e 2061 206b 6579   (based on a key
+0000b430: 2922 2222 0a20 2020 2020 2020 2069 6620  )""".        if 
+0000b440: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+0000b450: 7461 5f70 726f 7665 6e61 6e63 6522 206e  ta_provenance" n
+0000b460: 6f74 2069 6e20 7365 6c66 2e64 6174 613a  ot in self.data:
+0000b470: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b480: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
+0000b490: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+0000b4a0: 616e 6365 225d 203d 207b 7d0a 2020 2020  ance"] = {}.    
+0000b4b0: 2020 2020 6d64 5f70 5f64 6963 7420 3d20      md_p_dict = 
+0000b4c0: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+0000b4d0: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+0000b4e0: 7665 6e61 6e63 6522 5d0a 0a20 2020 2020  venance"]..     
+0000b4f0: 2020 2069 6620 6b65 7920 696e 206d 645f     if key in md_
+0000b500: 705f 6469 6374 3a0a 2020 2020 2020 2020  p_dict:.        
+0000b510: 2020 2020 6966 206d 645f 705f 6469 6374      if md_p_dict
+0000b520: 5b6b 6579 5d5b 226e 6f74 6522 5d20 3d3d  [key]["note"] ==
+0000b530: 2022 2220 6f72 2022 2220 3d3d 206e 6f74   "" or "" == not
+0000b540: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000b550: 2020 206d 645f 705f 6469 6374 5b6b 6579     md_p_dict[key
+0000b560: 5d5b 226e 6f74 6522 5d20 3d20 6e6f 7465  ]["note"] = note
+0000b570: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000b580: 6620 226d 6973 7369 6e67 2220 3d3d 206e  f "missing" == n
+0000b590: 6f74 6520 616e 6420 226e 6f74 2d6d 6973  ote and "not-mis
+0000b5a0: 7369 6e67 2220 696e 206d 645f 705f 6469  sing" in md_p_di
+0000b5b0: 6374 5b6b 6579 5d5b 226e 6f74 6522 5d2e  ct[key]["note"].
+0000b5c0: 7370 6c69 7428 0a20 2020 2020 2020 2020  split(.         
+0000b5d0: 2020 2020 2020 2022 2c22 0a20 2020 2020         ",".     
+0000b5e0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+0000b5f0: 2020 2020 2020 2020 2020 6d64 5f70 5f64            md_p_d
+0000b600: 6963 745b 6b65 795d 5b22 6e6f 7465 225d  ict[key]["note"]
+0000b610: 203d 2022 6d69 7373 696e 6722 0a20 2020   = "missing".   
+0000b620: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
+0000b630: 7465 206e 6f74 2069 6e20 6d64 5f70 5f64  te not in md_p_d
+0000b640: 6963 745b 6b65 795d 5b22 6e6f 7465 225d  ict[key]["note"]
+0000b650: 2e73 706c 6974 2822 2c22 293a 0a20 2020  .split(","):.   
+0000b660: 2020 2020 2020 2020 2020 2020 206d 645f               md_
+0000b670: 705f 6469 6374 5b6b 6579 5d5b 226e 6f74  p_dict[key]["not
+0000b680: 6522 5d20 2b3d 2066 222c 7b6e 6f74 657d  e"] += f",{note}
+0000b690: 220a 2020 2020 2020 2020 2020 2020 6d64  ".            md
+0000b6a0: 5f70 5f64 6963 745b 6b65 795d 5b22 736f  _p_dict[key]["so
+0000b6b0: 7572 6365 225d 203d 2073 6f75 7263 650a  urce"] = source.
+0000b6c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000b6d0: 2020 2020 2020 2020 2020 6d64 5f70 5f64            md_p_d
+0000b6e0: 6963 745b 6b65 795d 203d 207b 2273 6f75  ict[key] = {"sou
+0000b6f0: 7263 6522 3a20 736f 7572 6365 2c20 226e  rce": source, "n
+0000b700: 6f74 6522 3a20 6622 7b6e 6f74 657d 227d  ote": f"{note}"}
+0000b710: 0a0a 2020 2020 6465 6620 6164 645f 7072  ..    def add_pr
+0000b720: 6f76 656e 616e 6365 5f61 6c6c 2873 656c  ovenance_all(sel
+0000b730: 662c 202a 2c20 736f 7572 6365 3a20 7374  f, *, source: st
+0000b740: 7229 202d 3e20 4e6f 6e65 3a0a 2020 2020  r) -> None:.    
+0000b750: 2020 2020 2222 2241 6464 2061 2064 6174      """Add a dat
+0000b760: 6120 7072 6f76 656e 616e 6365 2028 736f  a provenance (so
+0000b770: 7572 6365 2920 746f 2061 6c6c 2066 6965  urce) to all fie
+0000b780: 6c64 7322 2222 0a20 2020 2020 2020 2069  lds""".        i
+0000b790: 6620 2263 6f6c 7265 765f 6d61 7374 6572  f "colrev_master
+0000b7a0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+0000b7b0: 206e 6f74 2069 6e20 7365 6c66 2e64 6174   not in self.dat
+0000b7c0: 613a 0a20 2020 2020 2020 2020 2020 2073  a:.            s
+0000b7d0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+0000b7e0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+0000b7f0: 656e 616e 6365 225d 203d 207b 7d0a 2020  enance"] = {}.  
+0000b800: 2020 2020 2020 6966 2022 636f 6c72 6576        if "colrev
+0000b810: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
+0000b820: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+0000b830: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0000b840: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+0000b850: 765f 6461 7461 5f70 726f 7665 6e61 6e63  v_data_provenanc
+0000b860: 6522 5d20 3d20 7b7d 0a0a 2020 2020 2020  e"] = {}..      
+0000b870: 2020 6d64 5f70 5f64 6963 7420 3d20 7365    md_p_dict = se
+0000b880: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000b890: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+0000b8a0: 6e61 6e63 6522 5d0a 2020 2020 2020 2020  nance"].        
+0000b8b0: 645f 705f 6469 6374 203d 2073 656c 662e  d_p_dict = self.
+0000b8c0: 6461 7461 5b22 636f 6c72 6576 5f64 6174  data["colrev_dat
+0000b8d0: 615f 7072 6f76 656e 616e 6365 225d 0a20  a_provenance"]. 
+0000b8e0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+0000b8f0: 6e20 7365 6c66 2e64 6174 612e 6b65 7973  n self.data.keys
+0000b900: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000b910: 6966 206b 6579 2069 6e20 5b0a 2020 2020  if key in [.    
+0000b920: 2020 2020 2020 2020 2020 2020 2245 4e54              "ENT
+0000b930: 5259 5459 5045 222c 0a20 2020 2020 2020  RYTYPE",.       
+0000b940: 2020 2020 2020 2020 2022 636f 6c72 6576           "colrev
+0000b950: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
+0000b960: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000b970: 2020 2022 636f 6c72 6576 5f6d 6173 7465     "colrev_maste
+0000b980: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000b990: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000b9a0: 2020 2022 636f 6c72 6576 5f73 7461 7475     "colrev_statu
+0000b9b0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+0000b9c0: 2020 2020 2263 6f6c 7265 765f 6964 222c      "colrev_id",
+0000b9d0: 0a20 2020 2020 2020 2020 2020 205d 3a0a  .            ]:.
+0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9f0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0000ba00: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+0000ba10: 2020 2020 2020 2020 2020 6b65 7920 696e            key in
+0000ba20: 2073 656c 662e 6964 656e 7469 6679 696e   self.identifyin
+0000ba30: 675f 6669 656c 645f 6b65 7973 0a20 2020  g_field_keys.   
+0000ba40: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0000ba50: 2022 4355 5241 5445 4422 206e 6f74 2069   "CURATED" not i
+0000ba60: 6e20 7365 6c66 2e64 6174 615b 2263 6f6c  n self.data["col
+0000ba70: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+0000ba80: 726f 7665 6e61 6e63 6522 5d0a 2020 2020  rovenance"].    
+0000ba90: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+0000baa0: 2020 2020 2020 2020 2020 206d 645f 705f             md_p_
+0000bab0: 6469 6374 5b6b 6579 5d20 3d20 7b22 736f  dict[key] = {"so
+0000bac0: 7572 6365 223a 2073 6f75 7263 652c 2022  urce": source, "
+0000bad0: 6e6f 7465 223a 2022 227d 0a20 2020 2020  note": ""}.     
+0000bae0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000baf0: 2020 2020 2020 2020 2020 2020 2064 5f70               d_p
+0000bb00: 5f64 6963 745b 6b65 795d 203d 207b 2273  _dict[key] = {"s
+0000bb10: 6f75 7263 6522 3a20 736f 7572 6365 2c20  ource": source, 
+0000bb20: 226e 6f74 6522 3a20 2222 7d0a 0a20 2020  "note": ""}..   
+0000bb30: 2064 6566 2061 6464 5f64 6174 615f 7072   def add_data_pr
+0000bb40: 6f76 656e 616e 6365 2873 656c 662c 202a  ovenance(self, *
+0000bb50: 2c20 6b65 793a 2073 7472 2c20 736f 7572  , key: str, sour
+0000bb60: 6365 3a20 7374 722c 206e 6f74 653a 2073  ce: str, note: s
+0000bb70: 7472 203d 2022 2229 202d 3e20 4e6f 6e65  tr = "") -> None
+0000bb80: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
+0000bb90: 2061 2064 6174 6120 7072 6f76 656e 616e   a data provenan
+0000bba0: 6365 2c20 696e 636c 7564 696e 6720 736f  ce, including so
+0000bbb0: 7572 6365 2061 6e64 206e 6f74 6520 2862  urce and note (b
+0000bbc0: 6173 6564 206f 6e20 6120 6b65 7929 2222  ased on a key)""
+0000bbd0: 220a 2020 2020 2020 2020 6966 2022 636f  ".        if "co
+0000bbe0: 6c72 6576 5f64 6174 615f 7072 6f76 656e  lrev_data_proven
+0000bbf0: 616e 6365 2220 6e6f 7420 696e 2073 656c  ance" not in sel
+0000bc00: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+0000bc10: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
+0000bc20: 6f6c 7265 765f 6461 7461 5f70 726f 7665  olrev_data_prove
+0000bc30: 6e61 6e63 6522 5d20 3d20 7b7d 0a20 2020  nance"] = {}.   
+0000bc40: 2020 2020 206d 645f 705f 6469 6374 203d       md_p_dict =
+0000bc50: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+0000bc60: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+0000bc70: 6365 225d 0a20 2020 2020 2020 2069 6620  ce"].        if 
+0000bc80: 6b65 7920 696e 206d 645f 705f 6469 6374  key in md_p_dict
+0000bc90: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000bca0: 206e 6f74 6520 213d 2022 223a 0a20 2020   note != "":.   
+0000bcb0: 2020 2020 2020 2020 2020 2020 206d 645f               md_
+0000bcc0: 705f 6469 6374 5b6b 6579 5d5b 226e 6f74  p_dict[key]["not
+0000bcd0: 6522 5d20 2b3d 2066 222c 7b6e 6f74 657d  e"] += f",{note}
+0000bce0: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
+0000bcf0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000bd00: 2020 2020 6d64 5f70 5f64 6963 745b 6b65      md_p_dict[ke
+0000bd10: 795d 5b22 6e6f 7465 225d 203d 2022 220a  y]["note"] = "".
+0000bd20: 2020 2020 2020 2020 2020 2020 6d64 5f70              md_p
+0000bd30: 5f64 6963 745b 6b65 795d 5b22 736f 7572  _dict[key]["sour
+0000bd40: 6365 225d 203d 2073 6f75 7263 650a 2020  ce"] = source.  
+0000bd50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000bd60: 2020 2020 2020 2020 6d64 5f70 5f64 6963          md_p_dic
+0000bd70: 745b 6b65 795d 203d 207b 2273 6f75 7263  t[key] = {"sourc
+0000bd80: 6522 3a20 736f 7572 6365 2c20 226e 6f74  e": source, "not
+0000bd90: 6522 3a20 6622 7b6e 6f74 657d 227d 0a0a  e": f"{note}"}..
+0000bda0: 2020 2020 6465 6620 636f 6d70 6c65 7465      def complete
+0000bdb0: 5f70 726f 7665 6e61 6e63 6528 7365 6c66  _provenance(self
+0000bdc0: 2c20 2a2c 2073 6f75 7263 655f 696e 666f  , *, source_info
+0000bdd0: 3a20 7374 7229 202d 3e20 626f 6f6c 3a0a  : str) -> bool:.
+0000bde0: 2020 2020 2020 2020 2222 2243 6f6d 706c          """Compl
+0000bdf0: 6574 6520 7072 6f76 656e 616e 6365 2069  ete provenance i
+0000be00: 6e66 6f72 6d61 7469 6f6e 2066 6f72 2069  nformation for i
+0000be10: 6e64 6578 696e 6722 2222 0a0a 2020 2020  ndexing"""..    
+0000be20: 2020 2020 666f 7220 6b65 7920 696e 206c      for key in l
+0000be30: 6973 7428 7365 6c66 2e64 6174 612e 6b65  ist(self.data.ke
+0000be40: 7973 2829 293a 0a20 2020 2020 2020 2020  ys()):.         
+0000be50: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+0000be60: 2020 2020 2020 2020 6b65 790a 2020 2020          key.    
+0000be70: 2020 2020 2020 2020 2020 2020 696e 205b              in [
+0000be80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000be90: 2020 2020 2022 636f 6c72 6576 5f69 6422       "colrev_id"
+0000bea0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000beb0: 2020 2020 2020 2245 4e54 5259 5459 5045        "ENTRYTYPE
+0000bec0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000bed0: 2020 2020 2020 2022 4944 222c 0a20 2020         "ID",.   
 0000bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bef0: 7365 6c66 2e61 6464 5f64 6174 615f 7072  self.add_data_pr
-0000bf00: 6f76 656e 616e 6365 286b 6579 3d6b 6579  ovenance(key=key
-0000bf10: 2c20 736f 7572 6365 3d73 6f75 7263 655f  , source=source_
-0000bf20: 696e 666f 2c20 6e6f 7465 3d22 2229 0a0a  info, note="")..
-0000bf30: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0000bf40: 7275 650a 0a20 2020 2064 6566 2068 6173  rue..    def has
-0000bf50: 5f71 7561 6c69 7479 5f64 6566 6563 7473  _quality_defects
-0000bf60: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
-0000bf70: 2020 2020 2020 2020 2222 2243 6865 636b          """Check
-0000bf80: 2077 6865 7468 6572 2061 2072 6563 6f72   whether a recor
-0000bf90: 6420 6861 7320 7175 616c 6974 7920 6465  d has quality de
-0000bfa0: 6665 6374 7322 2222 0a20 2020 2020 2020  fects""".       
-0000bfb0: 2072 6574 7572 6e20 616e 7928 0a20 2020   return any(.   
-0000bfc0: 2020 2020 2020 2020 2078 5b22 6e6f 7465           x["note
-0000bfd0: 225d 2021 3d20 2222 0a20 2020 2020 2020  "] != "".       
-0000bfe0: 2020 2020 2066 6f72 2078 2069 6e20 7365       for x in se
-0000bff0: 6c66 2e64 6174 612e 6765 7428 2263 6f6c  lf.data.get("col
-0000c000: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-0000c010: 726f 7665 6e61 6e63 6522 2c20 7b7d 292e  rovenance", {}).
-0000c020: 7661 6c75 6573 2829 0a20 2020 2020 2020  values().       
-0000c030: 2020 2020 2069 6620 6e6f 7420 616e 7928       if not any(
-0000c040: 7920 3d3d 2078 5b22 6e6f 7465 225d 2066  y == x["note"] f
-0000c050: 6f72 2079 2069 6e20 5b22 6e6f 742d 6d69  or y in ["not-mi
-0000c060: 7373 696e 6722 5d29 0a20 2020 2020 2020  ssing"]).       
-0000c070: 2029 0a0a 2020 2020 6465 6620 6765 745f   )..    def get_
-0000c080: 636f 6e74 6169 6e65 725f 7469 746c 6528  container_title(
-0000c090: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
-0000c0a0: 2020 2020 2020 2222 2247 6574 2074 6865        """Get the
-0000c0b0: 2072 6563 6f72 6427 7320 636f 6e74 6169   record's contai
-0000c0c0: 6e65 7220 7469 746c 6520 286a 6f75 726e  ner title (journ
-0000c0d0: 616c 206e 616d 652c 2062 6f6f 6b74 6974  al name, booktit
-0000c0e0: 6c65 2c20 6574 632e 2922 2222 0a20 2020  le, etc.)""".   
-0000c0f0: 2020 2020 2063 6f6e 7461 696e 6572 5f74       container_t
-0000c100: 6974 6c65 203d 2022 4e41 220a 2020 2020  itle = "NA".    
-0000c110: 2020 2020 6966 2022 454e 5452 5954 5950      if "ENTRYTYP
-0000c120: 4522 206e 6f74 2069 6e20 7365 6c66 2e64  E" not in self.d
-0000c130: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-0000c140: 2063 6f6e 7461 696e 6572 5f74 6974 6c65   container_title
-0000c150: 203d 2073 656c 662e 6461 7461 2e67 6574   = self.data.get
-0000c160: 2822 6a6f 7572 6e61 6c22 2c20 7365 6c66  ("journal", self
-0000c170: 2e64 6174 612e 6765 7428 2262 6f6f 6b74  .data.get("bookt
-0000c180: 6974 6c65 222c 2022 4e41 2229 290a 2020  itle", "NA")).  
-0000c190: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000c1a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000c1b0: 6461 7461 5b22 454e 5452 5954 5950 4522  data["ENTRYTYPE"
-0000c1c0: 5d20 3d3d 2022 6172 7469 636c 6522 3a0a  ] == "article":.
-0000c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1e0: 636f 6e74 6169 6e65 725f 7469 746c 6520  container_title 
-0000c1f0: 3d20 7365 6c66 2e64 6174 612e 6765 7428  = self.data.get(
-0000c200: 226a 6f75 726e 616c 222c 2022 4e41 2229  "journal", "NA")
-0000c210: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c220: 7365 6c66 2e64 6174 615b 2245 4e54 5259  self.data["ENTRY
-0000c230: 5459 5045 225d 203d 3d20 2269 6e70 726f  TYPE"] == "inpro
-0000c240: 6365 6564 696e 6773 223a 0a20 2020 2020  ceedings":.     
-0000c250: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-0000c260: 696e 6572 5f74 6974 6c65 203d 2073 656c  iner_title = sel
-0000c270: 662e 6461 7461 2e67 6574 2822 626f 6f6b  f.data.get("book
-0000c280: 7469 746c 6522 2c20 224e 4122 290a 2020  title", "NA").  
-0000c290: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000c2a0: 662e 6461 7461 5b22 454e 5452 5954 5950  f.data["ENTRYTYP
-0000c2b0: 4522 5d20 3d3d 2022 626f 6f6b 223a 0a20  E"] == "book":. 
-0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000c2d0: 6f6e 7461 696e 6572 5f74 6974 6c65 203d  ontainer_title =
-0000c2e0: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
-0000c2f0: 7469 746c 6522 2c20 224e 4122 290a 2020  title", "NA").  
-0000c300: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000c310: 662e 6461 7461 5b22 454e 5452 5954 5950  f.data["ENTRYTYP
-0000c320: 4522 5d20 3d3d 2022 696e 626f 6f6b 223a  E"] == "inbook":
-0000c330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c340: 2063 6f6e 7461 696e 6572 5f74 6974 6c65   container_title
-0000c350: 203d 2073 656c 662e 6461 7461 2e67 6574   = self.data.get
-0000c360: 2822 626f 6f6b 7469 746c 6522 2c20 224e  ("booktitle", "N
-0000c370: 4122 290a 2020 2020 2020 2020 7265 7475  A").        retu
-0000c380: 726e 2063 6f6e 7461 696e 6572 5f74 6974  rn container_tit
-0000c390: 6c65 0a0a 2020 2020 6465 6620 6372 6561  le..    def crea
-0000c3a0: 7465 5f63 6f6c 7265 765f 6964 280a 2020  te_colrev_id(.  
-0000c3b0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000c3c0: 2020 2020 2a2c 0a20 2020 2020 2020 2061      *,.        a
-0000c3d0: 7373 756d 655f 636f 6d70 6c65 7465 3a20  ssume_complete: 
-0000c3e0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0000c3f0: 2020 2920 2d3e 2073 7472 3a0a 2020 2020    ) -> str:.    
-0000c400: 2020 2020 2222 2252 6574 7572 6e73 2074      """Returns t
-0000c410: 6865 2063 6f6c 7265 765f 6964 206f 6620  he colrev_id of 
-0000c420: 7468 6520 5265 636f 7264 2e22 2222 0a0a  the Record."""..
-0000c430: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0000c440: 6f6c 7265 762e 716d 2e63 6f6c 7265 765f  olrev.qm.colrev_
-0000c450: 6964 2e63 7265 6174 655f 636f 6c72 6576  id.create_colrev
-0000c460: 5f69 6428 0a20 2020 2020 2020 2020 2020  _id(.           
-0000c470: 2072 6563 6f72 643d 7365 6c66 2c0a 2020   record=self,.  
-0000c480: 2020 2020 2020 2020 2020 6173 7375 6d65            assume
-0000c490: 5f63 6f6d 706c 6574 653d 6173 7375 6d65  _complete=assume
-0000c4a0: 5f63 6f6d 706c 6574 652c 0a20 2020 2020  _complete,.     
-0000c4b0: 2020 2029 0a0a 2020 2020 6465 6620 7072     )..    def pr
-0000c4c0: 6573 6372 6565 6e5f 6578 636c 7564 6528  escreen_exclude(
-0000c4d0: 7365 6c66 2c20 2a2c 2072 6561 736f 6e3a  self, *, reason:
-0000c4e0: 2073 7472 2c20 7072 696e 745f 7761 726e   str, print_warn
-0000c4f0: 696e 673a 2062 6f6f 6c20 3d20 4661 6c73  ing: bool = Fals
-0000c500: 6529 202d 3e20 4e6f 6e65 3a0a 2020 2020  e) -> None:.    
-0000c510: 2020 2020 2222 2250 7265 7363 7265 656e      """Prescreen
-0000c520: 2d65 7863 6c75 6465 2061 2072 6563 6f72  -exclude a recor
-0000c530: 6422 2222 0a20 2020 2020 2020 2023 2057  d""".        # W
-0000c540: 6172 6e20 7768 656e 2073 6574 7469 6e67  arn when setting
-0000c550: 2072 6576 5f73 796e 7468 6573 697a 6564   rev_synthesized
-0000c560: 2f72 6576 5f69 6e63 6c75 6465 6420 746f  /rev_included to
-0000c570: 2070 7265 7363 7265 656e 5f65 7863 6c75   prescreen_exclu
-0000c580: 6465 640a 2020 2020 2020 2020 2320 4573  ded.        # Es
-0000c590: 7065 6369 616c 6c79 2069 6e20 6361 7365  pecially in case
-0000c5a0: 7320 696e 2077 6869 6368 2074 6865 2070  s in which the p
-0000c5b0: 7265 7363 7265 656e 2d65 7863 6c75 7369  rescreen-exclusi
-0000c5c0: 6f6e 2064 6563 6973 696f 6e0a 2020 2020  on decision.    
-0000c5d0: 2020 2020 2320 6973 2072 6576 6973 6564      # is revised
-0000c5e0: 2028 652e 672e 2c20 6265 6361 7573 6520   (e.g., because 
-0000c5f0: 6120 7061 7065 7220 7761 7320 7265 7472  a paper was retr
-0000c600: 6163 7465 6429 0a20 2020 2020 2020 2023  acted).        #
-0000c610: 2049 6e20 7468 6573 6520 6361 7365 732c   In these cases,
-0000c620: 2074 6865 2070 6170 6572 206d 6179 2061   the paper may a
-0000c630: 6c72 6561 6479 2062 6520 696e 2074 6865  lready be in the
-0000c640: 2064 6174 6120 6578 7472 6163 7469 6f6e   data extraction
-0000c650: 2f73 796e 7468 6573 6973 0a20 2020 2020  /synthesis.     
-0000c660: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
-0000c670: 6765 7428 2263 6f6c 7265 765f 7374 6174  get("colrev_stat
-0000c680: 7573 222c 2022 4e41 2229 2069 6e20 5b0a  us", "NA") in [.
-0000c690: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-0000c6a0: 7264 5374 6174 652e 7265 765f 7379 6e74  rdState.rev_synt
-0000c6b0: 6865 7369 7a65 642c 0a20 2020 2020 2020  hesized,.       
-0000c6c0: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
-0000c6d0: 2e72 6576 5f69 6e63 6c75 6465 642c 0a20  .rev_included,. 
-0000c6e0: 2020 2020 2020 205d 3a0a 2020 2020 2020         ]:.      
-0000c6f0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-0000c700: 2020 2020 2020 2020 2020 2020 2066 225c               f"\
-0000c710: 6e7b 636f 6c6f 7273 2e52 4544 7d57 6172  n{colors.RED}War
-0000c720: 6e69 6e67 3a20 7365 7474 696e 6720 7061  ning: setting pa
-0000c730: 7065 7220 746f 2070 7265 7363 7265 656e  per to prescreen
-0000c740: 5f65 7863 6c75 6465 642e 2050 6c65 6173  _excluded. Pleas
-0000c750: 6520 6368 6563 6b20 616e 6420 220a 2020  e check and ".  
-0000c760: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000c770: 7265 6d6f 7665 2066 726f 6d20 7379 6e74  remove from synt
-0000c780: 6865 7369 733a 207b 7365 6c66 2e64 6174  hesis: {self.dat
-0000c790: 615b 2749 4427 5d7d 7b63 6f6c 6f72 732e  a['ID']}{colors.
-0000c7a0: 454e 447d 5c6e 220a 2020 2020 2020 2020  END}\n".        
-0000c7b0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-0000c7c0: 656c 662e 7365 745f 7374 6174 7573 2874  elf.set_status(t
-0000c7d0: 6172 6765 745f 7374 6174 653d 5265 636f  arget_state=Reco
-0000c7e0: 7264 5374 6174 652e 7265 765f 7072 6573  rdState.rev_pres
-0000c7f0: 6372 6565 6e5f 6578 636c 7564 6564 290a  creen_excluded).
-0000c800: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
-0000c810: 2020 2020 2020 2020 2020 2272 6574 7261            "retra
-0000c820: 6374 6564 2220 6e6f 7420 696e 2073 656c  cted" not in sel
-0000c830: 662e 6461 7461 2e67 6574 2822 7072 6573  f.data.get("pres
-0000c840: 6372 6565 6e5f 6578 636c 7573 696f 6e22  creen_exclusion"
-0000c850: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
-0000c860: 2020 616e 6420 2272 6574 7261 6374 6564    and "retracted
-0000c870: 2220 3d3d 2072 6561 736f 6e0a 2020 2020  " == reason.    
-0000c880: 2020 2020 2020 2020 616e 6420 7072 696e          and prin
-0000c890: 745f 7761 726e 696e 670a 2020 2020 2020  t_warning.      
-0000c8a0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000c8b0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-0000c8c0: 2020 2020 2020 2020 6622 5c6e 7b63 6f6c          f"\n{col
-0000c8d0: 6f72 732e 5245 447d 5061 7065 7220 7265  ors.RED}Paper re
-0000c8e0: 7472 6163 7465 6420 616e 6420 7072 6573  tracted and pres
-0000c8f0: 6372 6565 6e20 220a 2020 2020 2020 2020  creen ".        
-0000c900: 2020 2020 2020 2020 6622 6578 636c 7564          f"exclud
-0000c910: 6564 3a20 7b73 656c 662e 6461 7461 5b27  ed: {self.data['
-0000c920: 4944 275d 7d7b 636f 6c6f 7273 2e45 4e44  ID']}{colors.END
-0000c930: 7d5c 6e22 0a20 2020 2020 2020 2020 2020  }\n".           
-0000c940: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-0000c950: 2e64 6174 615b 2270 7265 7363 7265 656e  .data["prescreen
-0000c960: 5f65 7863 6c75 7369 6f6e 225d 203d 2072  _exclusion"] = r
-0000c970: 6561 736f 6e0a 0a20 2020 2020 2020 2023  eason..        #
-0000c980: 204e 6f74 653a 2077 6865 6e20 7265 636f   Note: when reco
-0000c990: 7264 7320 6172 6520 7072 6573 6372 6565  rds are prescree
-0000c9a0: 6e2d 6578 636c 7564 6564 2064 7572 696e  n-excluded durin
-0000c9b0: 6720 7072 6570 3a0a 2020 2020 2020 2020  g prep:.        
-0000c9c0: 746f 5f64 726f 7020 3d20 5b5d 0a20 2020  to_drop = [].   
-0000c9d0: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
-0000c9e0: 6c75 6520 696e 2073 656c 662e 6461 7461  lue in self.data
-0000c9f0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0000ca00: 2020 2020 2020 6966 2076 616c 7565 203d        if value =
-0000ca10: 3d20 2255 4e4b 4e4f 574e 223a 0a20 2020  = "UNKNOWN":.   
-0000ca20: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
-0000ca30: 6472 6f70 2e61 7070 656e 6428 6b65 7929  drop.append(key)
-0000ca40: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
-0000ca50: 2069 6e20 746f 5f64 726f 703a 0a20 2020   in to_drop:.   
-0000ca60: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-0000ca70: 6d6f 7665 5f66 6965 6c64 286b 6579 3d6b  move_field(key=k
-0000ca80: 6579 290a 0a20 2020 2064 6566 2065 7874  ey)..    def ext
-0000ca90: 7261 6374 5f74 6578 745f 6279 5f70 6167  ract_text_by_pag
-0000caa0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0000cab0: 202a 2c20 7061 6765 733a 204f 7074 696f   *, pages: Optio
-0000cac0: 6e61 6c5b 6c69 7374 5d20 3d20 4e6f 6e65  nal[list] = None
-0000cad0: 2c20 7072 6f6a 6563 745f 7061 7468 3a20  , project_path: 
-0000cae0: 5061 7468 0a20 2020 2029 202d 3e20 7374  Path.    ) -> st
-0000caf0: 723a 0a20 2020 2020 2020 2022 2222 4578  r:.        """Ex
-0000cb00: 7472 6163 7420 7468 6520 7465 7874 2066  tract the text f
-0000cb10: 726f 6d20 7468 6520 5044 4620 666f 7220  rom the PDF for 
-0000cb20: 6120 6769 7665 6e20 6e75 6d62 6572 206f  a given number o
-0000cb30: 6620 7061 6765 7322 2222 0a20 2020 2020  f pages""".     
-0000cb40: 2020 2074 6578 745f 6c69 7374 3a20 6c69     text_list: li
-0000cb50: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-0000cb60: 7064 665f 7061 7468 203d 2070 726f 6a65  pdf_path = proje
-0000cb70: 6374 5f70 6174 6820 2f20 5061 7468 2873  ct_path / Path(s
-0000cb80: 656c 662e 6461 7461 5b22 6669 6c65 225d  elf.data["file"]
-0000cb90: 290a 0a20 2020 2020 2020 2023 2068 7474  )..        # htt
-0000cba0: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
-0000cbb0: 6f77 2e63 6f6d 2f71 7565 7374 696f 6e73  ow.com/questions
-0000cbc0: 2f34 3934 3537 3434 332f 7079 7468 6f6e  /49457443/python
-0000cbd0: 2d70 6466 6d69 6e65 722d 636f 6e76 6572  -pdfminer-conver
-0000cbe0: 7473 2d70 6466 2d66 696c 652d 696e 746f  ts-pdf-file-into
-0000cbf0: 2d6f 6e65 2d63 6875 6e6b 2d6f 662d 7374  -one-chunk-of-st
-0000cc00: 7269 6e67 2d77 6974 682d 6e6f 2d73 7061  ring-with-no-spa
-0000cc10: 6365 732d 6265 7477 6565 0a20 2020 2020  ces-betwee.     
-0000cc20: 2020 206c 6170 6172 616d 7320 3d20 7064     laparams = pd
-0000cc30: 666d 696e 6572 2e6c 6179 6f75 742e 4c41  fminer.layout.LA
-0000cc40: 5061 7261 6d73 2829 0a20 2020 2020 2020  Params().       
-0000cc50: 2073 6574 6174 7472 286c 6170 6172 616d   setattr(laparam
-0000cc60: 732c 2022 616c 6c5f 7465 7874 7322 2c20  s, "all_texts", 
-0000cc70: 5472 7565 290a 0a20 2020 2020 2020 2077  True)..        w
-0000cc80: 6974 6820 6f70 656e 2870 6466 5f70 6174  ith open(pdf_pat
-0000cc90: 682c 2022 7262 2229 2061 7320 7064 665f  h, "rb") as pdf_
-0000cca0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-0000ccb0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000ccc0: 2020 2020 2020 2066 6f72 2070 6167 6520         for page 
-0000ccd0: 696e 2050 4446 5061 6765 2e67 6574 5f70  in PDFPage.get_p
-0000cce0: 6167 6573 280a 2020 2020 2020 2020 2020  ages(.          
-0000ccf0: 2020 2020 2020 2020 2020 7064 665f 6669            pdf_fi
-0000cd00: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-0000cd10: 2020 2020 2020 2020 7061 6765 6e6f 733d          pagenos=
-0000cd20: 7061 6765 732c 2020 2320 6e6f 7465 3a20  pages,  # note: 
-0000cd30: 6d61 7962 6520 736b 6970 2070 6f74 656e  maybe skip poten
-0000cd40: 7469 616c 2063 6f76 6572 2070 6167 6573  tial cover pages
-0000cd50: 3f0a 2020 2020 2020 2020 2020 2020 2020  ?.              
-0000cd60: 2020 2020 2020 6361 6368 696e 673d 5472        caching=Tr
-0000cd70: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0000cd80: 2020 2020 2020 2020 6368 6563 6b5f 6578          check_ex
-0000cd90: 7472 6163 7461 626c 653d 5472 7565 2c0a  tractable=True,.
-0000cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdb0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000cdc0: 2020 2020 2020 2072 6573 6f75 7263 655f         resource_
-0000cdd0: 6d61 6e61 6765 7220 3d20 5044 4652 6573  manager = PDFRes
-0000cde0: 6f75 7263 654d 616e 6167 6572 2829 0a20  ourceManager(). 
-0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce00: 2020 2066 616b 655f 6669 6c65 5f68 616e     fake_file_han
-0000ce10: 646c 6520 3d20 696f 2e53 7472 696e 6749  dle = io.StringI
-0000ce20: 4f28 290a 2020 2020 2020 2020 2020 2020  O().            
-0000ce30: 2020 2020 2020 2020 636f 6e76 6572 7465          converte
-0000ce40: 7220 3d20 5465 7874 436f 6e76 6572 7465  r = TextConverte
-0000ce50: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000ce60: 2020 2020 2020 2020 2020 2072 6573 6f75             resou
-0000ce70: 7263 655f 6d61 6e61 6765 722c 2066 616b  rce_manager, fak
-0000ce80: 655f 6669 6c65 5f68 616e 646c 652c 206c  e_file_handle, l
-0000ce90: 6170 6172 616d 733d 6c61 7061 7261 6d73  aparams=laparams
-0000cea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ceb0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000cec0: 2020 2020 2020 2020 2020 2070 6167 655f             page_
-0000ced0: 696e 7465 7270 7265 7465 7220 3d20 5044  interpreter = PD
-0000cee0: 4650 6167 6549 6e74 6572 7072 6574 6572  FPageInterpreter
-0000cef0: 2872 6573 6f75 7263 655f 6d61 6e61 6765  (resource_manage
-0000cf00: 722c 2063 6f6e 7665 7274 6572 290a 2020  r, converter).  
+0000bef0: 2022 6d65 7461 6461 7461 5f73 6f75 7263   "metadata_sourc
+0000bf00: 655f 7265 706f 7369 746f 7279 5f70 6174  e_repository_pat
+0000bf10: 6873 222c 0a20 2020 2020 2020 2020 2020  hs",.           
+0000bf20: 2020 2020 2020 2020 2022 6c6f 6361 6c5f           "local_
+0000bf30: 6375 7261 7465 645f 6d65 7461 6461 7461  curated_metadata
+0000bf40: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000bf50: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0000bf60: 2020 2020 202b 2073 656c 662e 7072 6f76       + self.prov
+0000bf70: 656e 616e 6365 5f6b 6579 730a 2020 2020  enance_keys.    
+0000bf80: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+0000bf90: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0000bfa0: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
+0000bfb0: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
+0000bfc0: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
+0000bfd0: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
+0000bfe0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000bff0: 656c 662e 6d61 7374 6572 6461 7461 5f69  elf.masterdata_i
+0000c000: 735f 6375 7261 7465 6428 293a 0a20 2020  s_curated():.   
+0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c020: 2073 656c 662e 6164 645f 6d61 7374 6572   self.add_master
+0000c030: 6461 7461 5f70 726f 7665 6e61 6e63 6528  data_provenance(
+0000c040: 6b65 793d 6b65 792c 2073 6f75 7263 653d  key=key, source=
+0000c050: 736f 7572 6365 5f69 6e66 6f2c 206e 6f74  source_info, not
+0000c060: 653d 2222 290a 2020 2020 2020 2020 2020  e="").          
+0000c070: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000c080: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+0000c090: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
+0000c0a0: 286b 6579 3d6b 6579 2c20 736f 7572 6365  (key=key, source
+0000c0b0: 3d73 6f75 7263 655f 696e 666f 2c20 6e6f  =source_info, no
+0000c0c0: 7465 3d22 2229 0a0a 2020 2020 2020 2020  te="")..        
+0000c0d0: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
+0000c0e0: 2064 6566 2068 6173 5f71 7561 6c69 7479   def has_quality
+0000c0f0: 5f64 6566 6563 7473 2873 656c 6629 202d  _defects(self) -
+0000c100: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
+0000c110: 2222 2243 6865 636b 2077 6865 7468 6572  """Check whether
+0000c120: 2061 2072 6563 6f72 6420 6861 7320 7175   a record has qu
+0000c130: 616c 6974 7920 6465 6665 6374 7322 2222  ality defects"""
+0000c140: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c150: 616e 7928 0a20 2020 2020 2020 2020 2020  any(.           
+0000c160: 2078 5b22 6e6f 7465 225d 2021 3d20 2222   x["note"] != ""
+0000c170: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000c180: 2078 2069 6e20 7365 6c66 2e64 6174 612e   x in self.data.
+0000c190: 6765 7428 2263 6f6c 7265 765f 6d61 7374  get("colrev_mast
+0000c1a0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+0000c1b0: 6522 2c20 7b7d 292e 7661 6c75 6573 2829  e", {}).values()
+0000c1c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c1d0: 6e6f 7420 616e 7928 7920 3d3d 2078 5b22  not any(y == x["
+0000c1e0: 6e6f 7465 225d 2066 6f72 2079 2069 6e20  note"] for y in 
+0000c1f0: 5b22 6e6f 742d 6d69 7373 696e 6722 5d29  ["not-missing"])
+0000c200: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000c210: 6465 6620 6765 745f 636f 6e74 6169 6e65  def get_containe
+0000c220: 725f 7469 746c 6528 7365 6c66 2920 2d3e  r_title(self) ->
+0000c230: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
+0000c240: 2247 6574 2074 6865 2072 6563 6f72 6427  "Get the record'
+0000c250: 7320 636f 6e74 6169 6e65 7220 7469 746c  s container titl
+0000c260: 6520 286a 6f75 726e 616c 206e 616d 652c  e (journal name,
+0000c270: 2062 6f6f 6b74 6974 6c65 2c20 6574 632e   booktitle, etc.
+0000c280: 2922 2222 0a20 2020 2020 2020 2063 6f6e  )""".        con
+0000c290: 7461 696e 6572 5f74 6974 6c65 203d 2022  tainer_title = "
+0000c2a0: 4e41 220a 2020 2020 2020 2020 6966 2022  NA".        if "
+0000c2b0: 454e 5452 5954 5950 4522 206e 6f74 2069  ENTRYTYPE" not i
+0000c2c0: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
+0000c2d0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+0000c2e0: 6572 5f74 6974 6c65 203d 2073 656c 662e  er_title = self.
+0000c2f0: 6461 7461 2e67 6574 2822 6a6f 7572 6e61  data.get("journa
+0000c300: 6c22 2c20 7365 6c66 2e64 6174 612e 6765  l", self.data.ge
+0000c310: 7428 2262 6f6f 6b74 6974 6c65 222c 2022  t("booktitle", "
+0000c320: 4e41 2229 290a 2020 2020 2020 2020 656c  NA")).        el
+0000c330: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000c340: 6966 2073 656c 662e 6461 7461 5b22 454e  if self.data["EN
+0000c350: 5452 5954 5950 4522 5d20 3d3d 2022 6172  TRYTYPE"] == "ar
+0000c360: 7469 636c 6522 3a0a 2020 2020 2020 2020  ticle":.        
+0000c370: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
+0000c380: 725f 7469 746c 6520 3d20 7365 6c66 2e64  r_title = self.d
+0000c390: 6174 612e 6765 7428 226a 6f75 726e 616c  ata.get("journal
+0000c3a0: 222c 2022 4e41 2229 0a20 2020 2020 2020  ", "NA").       
+0000c3b0: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
+0000c3c0: 615b 2245 4e54 5259 5459 5045 225d 203d  a["ENTRYTYPE"] =
+0000c3d0: 3d20 2269 6e70 726f 6365 6564 696e 6773  = "inproceedings
+0000c3e0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000c3f0: 2020 2063 6f6e 7461 696e 6572 5f74 6974     container_tit
+0000c400: 6c65 203d 2073 656c 662e 6461 7461 2e67  le = self.data.g
+0000c410: 6574 2822 626f 6f6b 7469 746c 6522 2c20  et("booktitle", 
+0000c420: 224e 4122 290a 2020 2020 2020 2020 2020  "NA").          
+0000c430: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
+0000c440: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
+0000c450: 626f 6f6b 223a 0a20 2020 2020 2020 2020  book":.         
+0000c460: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
+0000c470: 5f74 6974 6c65 203d 2073 656c 662e 6461  _title = self.da
+0000c480: 7461 2e67 6574 2822 7469 746c 6522 2c20  ta.get("title", 
+0000c490: 224e 4122 290a 2020 2020 2020 2020 2020  "NA").          
+0000c4a0: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
+0000c4b0: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
+0000c4c0: 696e 626f 6f6b 223a 0a20 2020 2020 2020  inbook":.       
+0000c4d0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+0000c4e0: 6572 5f74 6974 6c65 203d 2073 656c 662e  er_title = self.
+0000c4f0: 6461 7461 2e67 6574 2822 626f 6f6b 7469  data.get("bookti
+0000c500: 746c 6522 2c20 224e 4122 290a 2020 2020  tle", "NA").    
+0000c510: 2020 2020 7265 7475 726e 2063 6f6e 7461      return conta
+0000c520: 696e 6572 5f74 6974 6c65 0a0a 2020 2020  iner_title..    
+0000c530: 6465 6620 6372 6561 7465 5f63 6f6c 7265  def create_colre
+0000c540: 765f 6964 280a 2020 2020 2020 2020 7365  v_id(.        se
+0000c550: 6c66 2c0a 2020 2020 2020 2020 2a2c 0a20  lf,.        *,. 
+0000c560: 2020 2020 2020 2061 7373 756d 655f 636f         assume_co
+0000c570: 6d70 6c65 7465 3a20 626f 6f6c 203d 2046  mplete: bool = F
+0000c580: 616c 7365 2c0a 2020 2020 2920 2d3e 2073  alse,.    ) -> s
+0000c590: 7472 3a0a 2020 2020 2020 2020 2222 2252  tr:.        """R
+0000c5a0: 6574 7572 6e73 2074 6865 2063 6f6c 7265  eturns the colre
+0000c5b0: 765f 6964 206f 6620 7468 6520 5265 636f  v_id of the Reco
+0000c5c0: 7264 2e22 2222 0a0a 2020 2020 2020 2020  rd."""..        
+0000c5d0: 7265 7475 726e 2063 6f6c 7265 762e 716d  return colrev.qm
+0000c5e0: 2e63 6f6c 7265 765f 6964 2e63 7265 6174  .colrev_id.creat
+0000c5f0: 655f 636f 6c72 6576 5f69 6428 0a20 2020  e_colrev_id(.   
+0000c600: 2020 2020 2020 2020 2072 6563 6f72 643d           record=
+0000c610: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+0000c620: 2020 6173 7375 6d65 5f63 6f6d 706c 6574    assume_complet
+0000c630: 653d 6173 7375 6d65 5f63 6f6d 706c 6574  e=assume_complet
+0000c640: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+0000c650: 2020 6465 6620 7072 6573 6372 6565 6e5f    def prescreen_
+0000c660: 6578 636c 7564 6528 7365 6c66 2c20 2a2c  exclude(self, *,
+0000c670: 2072 6561 736f 6e3a 2073 7472 2c20 7072   reason: str, pr
+0000c680: 696e 745f 7761 726e 696e 673a 2062 6f6f  int_warning: boo
+0000c690: 6c20 3d20 4661 6c73 6529 202d 3e20 4e6f  l = False) -> No
+0000c6a0: 6e65 3a0a 2020 2020 2020 2020 2222 2250  ne:.        """P
+0000c6b0: 7265 7363 7265 656e 2d65 7863 6c75 6465  rescreen-exclude
+0000c6c0: 2061 2072 6563 6f72 6422 2222 0a20 2020   a record""".   
+0000c6d0: 2020 2020 2023 2057 6172 6e20 7768 656e       # Warn when
+0000c6e0: 2073 6574 7469 6e67 2072 6576 5f73 796e   setting rev_syn
+0000c6f0: 7468 6573 697a 6564 2f72 6576 5f69 6e63  thesized/rev_inc
+0000c700: 6c75 6465 6420 746f 2070 7265 7363 7265  luded to prescre
+0000c710: 656e 5f65 7863 6c75 6465 640a 2020 2020  en_excluded.    
+0000c720: 2020 2020 2320 4573 7065 6369 616c 6c79      # Especially
+0000c730: 2069 6e20 6361 7365 7320 696e 2077 6869   in cases in whi
+0000c740: 6368 2074 6865 2070 7265 7363 7265 656e  ch the prescreen
+0000c750: 2d65 7863 6c75 7369 6f6e 2064 6563 6973  -exclusion decis
+0000c760: 696f 6e0a 2020 2020 2020 2020 2320 6973  ion.        # is
+0000c770: 2072 6576 6973 6564 2028 652e 672e 2c20   revised (e.g., 
+0000c780: 6265 6361 7573 6520 6120 7061 7065 7220  because a paper 
+0000c790: 7761 7320 7265 7472 6163 7465 6429 0a20  was retracted). 
+0000c7a0: 2020 2020 2020 2023 2049 6e20 7468 6573         # In thes
+0000c7b0: 6520 6361 7365 732c 2074 6865 2070 6170  e cases, the pap
+0000c7c0: 6572 206d 6179 2061 6c72 6561 6479 2062  er may already b
+0000c7d0: 6520 696e 2074 6865 2064 6174 6120 6578  e in the data ex
+0000c7e0: 7472 6163 7469 6f6e 2f73 796e 7468 6573  traction/synthes
+0000c7f0: 6973 0a20 2020 2020 2020 2069 6620 7365  is.        if se
+0000c800: 6c66 2e64 6174 612e 6765 7428 2263 6f6c  lf.data.get("col
+0000c810: 7265 765f 7374 6174 7573 222c 2022 4e41  rev_status", "NA
+0000c820: 2229 2069 6e20 5b0a 2020 2020 2020 2020  ") in [.        
+0000c830: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
+0000c840: 7265 765f 7379 6e74 6865 7369 7a65 642c  rev_synthesized,
+0000c850: 0a20 2020 2020 2020 2020 2020 2052 6563  .            Rec
+0000c860: 6f72 6453 7461 7465 2e72 6576 5f69 6e63  ordState.rev_inc
+0000c870: 6c75 6465 642c 0a20 2020 2020 2020 205d  luded,.        ]
+0000c880: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0000c890: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0000c8a0: 2020 2020 2066 225c 6e7b 636f 6c6f 7273       f"\n{colors
+0000c8b0: 2e52 4544 7d57 6172 6e69 6e67 3a20 7365  .RED}Warning: se
+0000c8c0: 7474 696e 6720 7061 7065 7220 746f 2070  tting paper to p
+0000c8d0: 7265 7363 7265 656e 5f65 7863 6c75 6465  rescreen_exclude
+0000c8e0: 642e 2050 6c65 6173 6520 6368 6563 6b20  d. Please check 
+0000c8f0: 616e 6420 220a 2020 2020 2020 2020 2020  and ".          
+0000c900: 2020 2020 2020 6622 7265 6d6f 7665 2066        f"remove f
+0000c910: 726f 6d20 7379 6e74 6865 7369 733a 207b  rom synthesis: {
+0000c920: 7365 6c66 2e64 6174 615b 2749 4427 5d7d  self.data['ID']}
+0000c930: 7b63 6f6c 6f72 732e 454e 447d 5c6e 220a  {colors.END}\n".
+0000c940: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000c950: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+0000c960: 7374 6174 7573 2874 6172 6765 745f 7374  status(target_st
+0000c970: 6174 653d 5265 636f 7264 5374 6174 652e  ate=RecordState.
+0000c980: 7265 765f 7072 6573 6372 6565 6e5f 6578  rev_prescreen_ex
+0000c990: 636c 7564 6564 290a 0a20 2020 2020 2020  cluded)..       
+0000c9a0: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+0000c9b0: 2020 2272 6574 7261 6374 6564 2220 6e6f    "retracted" no
+0000c9c0: 7420 696e 2073 656c 662e 6461 7461 2e67  t in self.data.g
+0000c9d0: 6574 2822 7072 6573 6372 6565 6e5f 6578  et("prescreen_ex
+0000c9e0: 636c 7573 696f 6e22 2c20 2222 290a 2020  clusion", "").  
+0000c9f0: 2020 2020 2020 2020 2020 616e 6420 2272            and "r
+0000ca00: 6574 7261 6374 6564 2220 3d3d 2072 6561  etracted" == rea
+0000ca10: 736f 6e0a 2020 2020 2020 2020 2020 2020  son.            
+0000ca20: 616e 6420 7072 696e 745f 7761 726e 696e  and print_warnin
+0000ca30: 670a 2020 2020 2020 2020 293a 0a20 2020  g.        ):.   
+0000ca40: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+0000ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca60: 6622 5c6e 7b63 6f6c 6f72 732e 5245 447d  f"\n{colors.RED}
+0000ca70: 5061 7065 7220 7265 7472 6163 7465 6420  Paper retracted 
+0000ca80: 616e 6420 7072 6573 6372 6565 6e20 220a  and prescreen ".
+0000ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000caa0: 6622 6578 636c 7564 6564 3a20 7b73 656c  f"excluded: {sel
+0000cab0: 662e 6461 7461 5b27 4944 275d 7d7b 636f  f.data['ID']}{co
+0000cac0: 6c6f 7273 2e45 4e44 7d5c 6e22 0a20 2020  lors.END}\n".   
+0000cad0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000cae0: 2020 2020 7365 6c66 2e64 6174 615b 2270      self.data["p
+0000caf0: 7265 7363 7265 656e 5f65 7863 6c75 7369  rescreen_exclusi
+0000cb00: 6f6e 225d 203d 2072 6561 736f 6e0a 0a20  on"] = reason.. 
+0000cb10: 2020 2020 2020 2023 204e 6f74 653a 2077         # Note: w
+0000cb20: 6865 6e20 7265 636f 7264 7320 6172 6520  hen records are 
+0000cb30: 7072 6573 6372 6565 6e2d 6578 636c 7564  prescreen-exclud
+0000cb40: 6564 2064 7572 696e 6720 7072 6570 3a0a  ed during prep:.
+0000cb50: 2020 2020 2020 2020 746f 5f64 726f 7020          to_drop 
+0000cb60: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+0000cb70: 206b 6579 2c20 7661 6c75 6520 696e 2073   key, value in s
+0000cb80: 656c 662e 6461 7461 2e69 7465 6d73 2829  elf.data.items()
+0000cb90: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000cba0: 2076 616c 7565 203d 3d20 2255 4e4b 4e4f   value == "UNKNO
+0000cbb0: 574e 223a 0a20 2020 2020 2020 2020 2020  WN":.           
+0000cbc0: 2020 2020 2074 6f5f 6472 6f70 2e61 7070       to_drop.app
+0000cbd0: 656e 6428 6b65 7929 0a20 2020 2020 2020  end(key).       
+0000cbe0: 2066 6f72 206b 6579 2069 6e20 746f 5f64   for key in to_d
+0000cbf0: 726f 703a 0a20 2020 2020 2020 2020 2020  rop:.           
+0000cc00: 2073 656c 662e 7265 6d6f 7665 5f66 6965   self.remove_fie
+0000cc10: 6c64 286b 6579 3d6b 6579 290a 0a20 2020  ld(key=key)..   
+0000cc20: 2064 6566 2065 7874 7261 6374 5f74 6578   def extract_tex
+0000cc30: 745f 6279 5f70 6167 6528 0a20 2020 2020  t_by_page(.     
+0000cc40: 2020 2073 656c 662c 202a 2c20 7061 6765     self, *, page
+0000cc50: 733a 204f 7074 696f 6e61 6c5b 6c69 7374  s: Optional[list
+0000cc60: 5d20 3d20 4e6f 6e65 2c20 7072 6f6a 6563  ] = None, projec
+0000cc70: 745f 7061 7468 3a20 5061 7468 0a20 2020  t_path: Path.   
+0000cc80: 2029 202d 3e20 7374 723a 0a20 2020 2020   ) -> str:.     
+0000cc90: 2020 2022 2222 4578 7472 6163 7420 7468     """Extract th
+0000cca0: 6520 7465 7874 2066 726f 6d20 7468 6520  e text from the 
+0000ccb0: 5044 4620 666f 7220 6120 6769 7665 6e20  PDF for a given 
+0000ccc0: 6e75 6d62 6572 206f 6620 7061 6765 7322  number of pages"
+0000ccd0: 2222 0a20 2020 2020 2020 2074 6578 745f  "".        text_
+0000cce0: 6c69 7374 3a20 6c69 7374 203d 205b 5d0a  list: list = [].
+0000ccf0: 2020 2020 2020 2020 7064 665f 7061 7468          pdf_path
+0000cd00: 203d 2070 726f 6a65 6374 5f70 6174 6820   = project_path 
+0000cd10: 2f20 5061 7468 2873 656c 662e 6461 7461  / Path(self.data
+0000cd20: 5b22 6669 6c65 225d 290a 0a20 2020 2020  ["file"])..     
+0000cd30: 2020 2023 2068 7474 7073 3a2f 2f73 7461     # https://sta
+0000cd40: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
+0000cd50: 7565 7374 696f 6e73 2f34 3934 3537 3434  uestions/4945744
+0000cd60: 332f 7079 7468 6f6e 2d70 6466 6d69 6e65  3/python-pdfmine
+0000cd70: 722d 636f 6e76 6572 7473 2d70 6466 2d66  r-converts-pdf-f
+0000cd80: 696c 652d 696e 746f 2d6f 6e65 2d63 6875  ile-into-one-chu
+0000cd90: 6e6b 2d6f 662d 7374 7269 6e67 2d77 6974  nk-of-string-wit
+0000cda0: 682d 6e6f 2d73 7061 6365 732d 6265 7477  h-no-spaces-betw
+0000cdb0: 6565 0a20 2020 2020 2020 206c 6170 6172  ee.        lapar
+0000cdc0: 616d 7320 3d20 7064 666d 696e 6572 2e6c  ams = pdfminer.l
+0000cdd0: 6179 6f75 742e 4c41 5061 7261 6d73 2829  ayout.LAParams()
+0000cde0: 0a20 2020 2020 2020 2073 6574 6174 7472  .        setattr
+0000cdf0: 286c 6170 6172 616d 732c 2022 616c 6c5f  (laparams, "all_
+0000ce00: 7465 7874 7322 2c20 5472 7565 290a 0a20  texts", True).. 
+0000ce10: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0000ce20: 2870 6466 5f70 6174 682c 2022 7262 2229  (pdf_path, "rb")
+0000ce30: 2061 7320 7064 665f 6669 6c65 3a0a 2020   as pdf_file:.  
+0000ce40: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000ce50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ce60: 6f72 2070 6167 6520 696e 2050 4446 5061  or page in PDFPa
+0000ce70: 6765 2e67 6574 5f70 6167 6573 280a 2020  ge.get_pages(.  
+0000ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce90: 2020 7064 665f 6669 6c65 2c0a 2020 2020    pdf_file,.    
+0000cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ceb0: 7061 6765 6e6f 733d 7061 6765 732c 2020  pagenos=pages,  
+0000cec0: 2320 6e6f 7465 3a20 6d61 7962 6520 736b  # note: maybe sk
+0000ced0: 6970 2070 6f74 656e 7469 616c 2063 6f76  ip potential cov
+0000cee0: 6572 2070 6167 6573 3f0a 2020 2020 2020  er pages?.      
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+0000cf00: 6368 696e 673d 5472 7565 2c0a 2020 2020  ching=True,.    
 0000cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf20: 2020 7061 6765 5f69 6e74 6572 7072 6574    page_interpret
-0000cf30: 6572 2e70 726f 6365 7373 5f70 6167 6528  er.process_page(
-0000cf40: 7061 6765 290a 0a20 2020 2020 2020 2020  page)..         
-0000cf50: 2020 2020 2020 2020 2020 2074 6578 7420             text 
-0000cf60: 3d20 6661 6b65 5f66 696c 655f 6861 6e64  = fake_file_hand
-0000cf70: 6c65 2e67 6574 7661 6c75 6528 290a 2020  le.getvalue().  
-0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 2020 7465 7874 5f6c 6973 7420 2b3d 2074    text_list += t
-0000cfa0: 6578 740a 0a20 2020 2020 2020 2020 2020  ext..           
-0000cfb0: 2020 2020 2020 2020 2023 2063 6c6f 7365           # close
-0000cfc0: 206f 7065 6e20 6861 6e64 6c65 730a 2020   open handles.  
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfe0: 2020 636f 6e76 6572 7465 722e 636c 6f73    converter.clos
-0000cff0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0000d000: 2020 2020 2020 2020 6661 6b65 5f66 696c          fake_fil
-0000d010: 655f 6861 6e64 6c65 2e63 6c6f 7365 2829  e_handle.close()
-0000d020: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0000d030: 6570 7420 2854 7970 6545 7272 6f72 2c20  ept (TypeError, 
-0000d040: 4b65 7945 7272 6f72 293a 2020 2320 7072  KeyError):  # pr
-0000d050: 6167 6d61 3a20 6e6f 2063 6f76 6572 0a20  agma: no cover. 
-0000d060: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d070: 6173 730a 2020 2020 2020 2020 7265 7475  ass.        retu
-0000d080: 726e 2022 222e 6a6f 696e 2874 6578 745f  rn "".join(text_
-0000d090: 6c69 7374 290a 0a20 2020 2064 6566 2073  list)..    def s
-0000d0a0: 6574 5f70 6167 6573 5f69 6e5f 7064 6628  et_pages_in_pdf(
-0000d0b0: 7365 6c66 2c20 2a2c 2070 726f 6a65 6374  self, *, project
-0000d0c0: 5f70 6174 683a 2050 6174 6829 202d 3e20  _path: Path) -> 
-0000d0d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000d0e0: 2253 6574 2074 6865 2070 6167 6573 5f69  "Set the pages_i
-0000d0f0: 6e5f 6669 6c65 2066 6965 6c64 2062 6173  n_file field bas
-0000d100: 6564 206f 6e20 7468 6520 5044 4622 2222  ed on the PDF"""
-0000d110: 0a20 2020 2020 2020 2070 6466 5f70 6174  .        pdf_pat
-0000d120: 6820 3d20 7072 6f6a 6563 745f 7061 7468  h = project_path
-0000d130: 202f 2050 6174 6828 7365 6c66 2e64 6174   / Path(self.dat
-0000d140: 615b 2266 696c 6522 5d29 0a20 2020 2020  a["file"]).     
-0000d150: 2020 2077 6974 6820 6f70 656e 2870 6466     with open(pdf
-0000d160: 5f70 6174 682c 2022 7262 2229 2061 7320  _path, "rb") as 
-0000d170: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-0000d180: 2020 7061 7273 6572 203d 2050 4446 5061    parser = PDFPa
-0000d190: 7273 6572 2866 696c 6529 0a20 2020 2020  rser(file).     
-0000d1a0: 2020 2020 2020 2064 6f63 756d 656e 7420         document 
-0000d1b0: 3d20 5044 4644 6f63 756d 656e 7428 7061  = PDFDocument(pa
-0000d1c0: 7273 6572 290a 2020 2020 2020 2020 2020  rser).          
-0000d1d0: 2020 7061 6765 735f 696e 5f66 696c 6520    pages_in_file 
-0000d1e0: 3d20 7265 736f 6c76 6531 2864 6f63 756d  = resolve1(docum
-0000d1f0: 656e 742e 6361 7461 6c6f 675b 2250 6167  ent.catalog["Pag
-0000d200: 6573 225d 295b 2243 6f75 6e74 225d 0a20  es"])["Count"]. 
-0000d210: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-0000d220: 5b22 7061 6765 735f 696e 5f66 696c 6522  ["pages_in_file"
-0000d230: 5d20 3d20 7061 6765 735f 696e 5f66 696c  ] = pages_in_fil
-0000d240: 650a 0a20 2020 2064 6566 2073 6574 5f74  e..    def set_t
-0000d250: 6578 745f 6672 6f6d 5f70 6466 2873 656c  ext_from_pdf(sel
-0000d260: 662c 202a 2c20 7072 6f6a 6563 745f 7061  f, *, project_pa
-0000d270: 7468 3a20 5061 7468 2920 2d3e 204e 6f6e  th: Path) -> Non
-0000d280: 653a 0a20 2020 2020 2020 2022 2222 5365  e:.        """Se
-0000d290: 7420 7468 6520 7465 7874 5f66 726f 6d5f  t the text_from_
-0000d2a0: 7064 6620 6669 656c 6420 6261 7365 6420  pdf field based 
-0000d2b0: 6f6e 2074 6865 2050 4446 2222 220a 2020  on the PDF""".  
-0000d2c0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-0000d2d0: 2274 6578 745f 6672 6f6d 5f70 6466 225d  "text_from_pdf"]
-0000d2e0: 203d 2022 220a 2020 2020 2020 2020 7472   = "".        tr
-0000d2f0: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-0000d300: 656c 662e 7365 745f 7061 6765 735f 696e  elf.set_pages_in
-0000d310: 5f70 6466 2870 726f 6a65 6374 5f70 6174  _pdf(project_pat
-0000d320: 683d 7072 6f6a 6563 745f 7061 7468 290a  h=project_path).
-0000d330: 2020 2020 2020 2020 2020 2020 7465 7874              text
-0000d340: 203d 2073 656c 662e 6578 7472 6163 745f   = self.extract_
-0000d350: 7465 7874 5f62 795f 7061 6765 2870 6167  text_by_page(pag
-0000d360: 6573 3d5b 302c 2031 2c20 325d 2c20 7072  es=[0, 1, 2], pr
-0000d370: 6f6a 6563 745f 7061 7468 3d70 726f 6a65  oject_path=proje
-0000d380: 6374 5f70 6174 6829 0a20 2020 2020 2020  ct_path).       
-0000d390: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-0000d3a0: 7465 7874 5f66 726f 6d5f 7064 6622 5d20  text_from_pdf"] 
-0000d3b0: 3d20 7465 7874 2e72 6570 6c61 6365 2822  = text.replace("
-0000d3c0: 5c6e 222c 2022 2022 292e 7265 706c 6163  \n", " ").replac
-0000d3d0: 6528 225c 7830 6322 2c20 2222 290a 0a20  e("\x0c", "").. 
-0000d3e0: 2020 2020 2020 2065 7863 6570 7420 5044         except PD
-0000d3f0: 4653 796e 7461 7845 7272 6f72 3a20 2023  FSyntaxError:  #
-0000d400: 2070 7261 676d 613a 206e 6f20 636f 7665   pragma: no cove
-0000d410: 720a 2020 2020 2020 2020 2020 2020 7365  r.            se
-0000d420: 6c66 2e61 6464 5f64 6174 615f 7072 6f76  lf.add_data_prov
-0000d430: 656e 616e 6365 5f6e 6f74 6528 6b65 793d  enance_note(key=
-0000d440: 2266 696c 6522 2c20 6e6f 7465 3d22 7064  "file", note="pd
-0000d450: 665f 7265 6164 6572 5f65 7272 6f72 2229  f_reader_error")
-0000d460: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000d470: 662e 6461 7461 2e75 7064 6174 6528 636f  f.data.update(co
-0000d480: 6c72 6576 5f73 7461 7475 733d 5265 636f  lrev_status=Reco
-0000d490: 7264 5374 6174 652e 7064 665f 6e65 6564  rdState.pdf_need
-0000d4a0: 735f 6d61 6e75 616c 5f70 7265 7061 7261  s_manual_prepara
-0000d4b0: 7469 6f6e 290a 2020 2020 2020 2020 6578  tion).        ex
-0000d4c0: 6365 7074 2050 4446 5465 7874 4578 7472  cept PDFTextExtr
-0000d4d0: 6163 7469 6f6e 4e6f 7441 6c6c 6f77 6564  actionNotAllowed
-0000d4e0: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
-0000d4f0: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
-0000d500: 2020 7365 6c66 2e61 6464 5f64 6174 615f    self.add_data_
-0000d510: 7072 6f76 656e 616e 6365 5f6e 6f74 6528  provenance_note(
-0000d520: 6b65 793d 2266 696c 6522 2c20 6e6f 7465  key="file", note
-0000d530: 3d22 7064 665f 7072 6f74 6563 7465 6422  ="pdf_protected"
-0000d540: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000d550: 6c66 2e64 6174 612e 7570 6461 7465 2863  lf.data.update(c
-0000d560: 6f6c 7265 765f 7374 6174 7573 3d52 6563  olrev_status=Rec
-0000d570: 6f72 6453 7461 7465 2e70 6466 5f6e 6565  ordState.pdf_nee
-0000d580: 6473 5f6d 616e 7561 6c5f 7072 6570 6172  ds_manual_prepar
-0000d590: 6174 696f 6e29 0a0a 2020 2020 6465 6620  ation)..    def 
-0000d5a0: 6578 7472 6163 745f 7061 6765 7328 0a20  extract_pages(. 
-0000d5b0: 2020 2020 2020 2073 656c 662c 202a 2c20         self, *, 
-0000d5c0: 7061 6765 733a 206c 6973 742c 2070 726f  pages: list, pro
-0000d5d0: 6a65 6374 5f70 6174 683a 2050 6174 682c  ject_path: Path,
-0000d5e0: 2073 6176 655f 746f 5f70 6174 683a 204f   save_to_path: O
-0000d5f0: 7074 696f 6e61 6c5b 5061 7468 5d20 3d20  ptional[Path] = 
-0000d600: 4e6f 6e65 0a20 2020 2029 202d 3e20 4e6f  None.    ) -> No
-0000d610: 6e65 3a20 2023 2070 7261 676d 613a 206e  ne:  # pragma: n
-0000d620: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
-0000d630: 2222 2245 7874 7261 6374 2070 6167 6573  """Extract pages
-0000d640: 2066 726f 6d20 7468 6520 5044 4620 2873   from the PDF (s
-0000d650: 6176 6569 6e67 2074 6865 6d20 746f 2074  aveing them to t
-0000d660: 6865 2073 6176 655f 746f 5f70 6174 6829  he save_to_path)
-0000d670: 2222 220a 2020 2020 2020 2020 7064 665f  """.        pdf_
-0000d680: 7061 7468 203d 2070 726f 6a65 6374 5f70  path = project_p
-0000d690: 6174 6820 2f20 5061 7468 2873 656c 662e  ath / Path(self.
-0000d6a0: 6461 7461 5b22 6669 6c65 225d 290a 2020  data["file"]).  
-0000d6b0: 2020 2020 2020 7064 665f 7265 6164 6572        pdf_reader
-0000d6c0: 203d 2050 6466 4669 6c65 5265 6164 6572   = PdfFileReader
-0000d6d0: 2873 7472 2870 6466 5f70 6174 6829 2c20  (str(pdf_path), 
-0000d6e0: 7374 7269 6374 3d46 616c 7365 290a 2020  strict=False).  
-0000d6f0: 2020 2020 2020 7772 6974 6572 203d 2050        writer = P
-0000d700: 6466 4669 6c65 5772 6974 6572 2829 0a20  dfFileWriter(). 
-0000d710: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000d720: 7261 6e67 6528 302c 206c 656e 2870 6466  range(0, len(pdf
-0000d730: 5f72 6561 6465 722e 7061 6765 7329 293a  _reader.pages)):
-0000d740: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d750: 6920 696e 2070 6167 6573 3a0a 2020 2020  i in pages:.    
-0000d760: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000d770: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0000d780: 2077 7269 7465 722e 6164 6450 6167 6528   writer.addPage(
-0000d790: 7064 665f 7265 6164 6572 2e67 6574 5061  pdf_reader.getPa
-0000d7a0: 6765 2869 2929 0a20 2020 2020 2020 2077  ge(i)).        w
-0000d7b0: 6974 6820 6f70 656e 2870 6466 5f70 6174  ith open(pdf_pat
-0000d7c0: 682c 2022 7762 2229 2061 7320 6f75 7466  h, "wb") as outf
-0000d7d0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-0000d7e0: 2077 7269 7465 722e 7772 6974 6528 6f75   writer.write(ou
-0000d7f0: 7466 696c 6529 0a0a 2020 2020 2020 2020  tfile)..        
-0000d800: 6966 2073 6176 655f 746f 5f70 6174 683a  if save_to_path:
-0000d810: 0a20 2020 2020 2020 2020 2020 2077 7269  .            wri
-0000d820: 7465 725f 6370 203d 2050 6466 4669 6c65  ter_cp = PdfFile
-0000d830: 5772 6974 6572 2829 0a20 2020 2020 2020  Writer().       
-0000d840: 2020 2020 2066 6f72 2070 6167 6520 696e       for page in
-0000d850: 2070 6167 6573 3a0a 2020 2020 2020 2020   pages:.        
-0000d860: 2020 2020 2020 2020 7772 6974 6572 5f63          writer_c
-0000d870: 702e 6164 6450 6167 6528 7064 665f 7265  p.addPage(pdf_re
-0000d880: 6164 6572 2e67 6574 5061 6765 2870 6167  ader.getPage(pag
-0000d890: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0000d8a0: 6669 6c65 7061 7468 203d 2050 6174 6828  filepath = Path(
-0000d8b0: 7064 665f 7061 7468 290a 2020 2020 2020  pdf_path).      
-0000d8c0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-0000d8d0: 7361 7665 5f74 6f5f 7061 7468 202f 2066  save_to_path / f
-0000d8e0: 696c 6570 6174 682e 6e61 6d65 2c20 2277  ilepath.name, "w
-0000d8f0: 6222 2920 6173 206f 7574 6669 6c65 3a0a  b") as outfile:.
-0000d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d910: 7772 6974 6572 5f63 702e 7772 6974 6528  writer_cp.write(
-0000d920: 6f75 7466 696c 6529 0a0a 2020 2020 4063  outfile)..    @c
-0000d930: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0000d940: 6566 2067 6574 5f63 6f6c 7265 765f 7064  ef get_colrev_pd
-0000d950: 665f 6964 280a 2020 2020 2020 2020 636c  f_id(.        cl
-0000d960: 732c 0a20 2020 2020 2020 202a 2c0a 2020  s,.        *,.  
-0000d970: 2020 2020 2020 7064 665f 7061 7468 3a20        pdf_path: 
-0000d980: 5061 7468 2c0a 2020 2020 2920 2d3e 2073  Path,.    ) -> s
-0000d990: 7472 3a20 2023 2070 7261 676d 613a 206e  tr:  # pragma: n
-0000d9a0: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
-0000d9b0: 2222 2247 656e 6572 6174 6520 7468 6520  """Generate the 
-0000d9c0: 636f 6c72 6576 5f70 6466 5f69 6422 2222  colrev_pdf_id"""
-0000d9d0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000d9e0: 2063 6f6c 7265 762e 716d 2e63 6f6c 7265   colrev.qm.colre
-0000d9f0: 765f 7064 665f 6964 2e63 7265 6174 655f  v_pdf_id.create_
-0000da00: 636f 6c72 6576 5f70 6466 5f69 6428 7064  colrev_pdf_id(pd
-0000da10: 665f 7061 7468 3d70 6466 5f70 6174 6829  f_path=pdf_path)
-0000da20: 0a0a 2020 2020 6465 6620 6765 745f 746f  ..    def get_to
-0000da30: 635f 6b65 7928 7365 6c66 2920 2d3e 2073  c_key(self) -> s
-0000da40: 7472 3a0a 2020 2020 2020 2020 2222 2247  tr:.        """G
-0000da50: 6574 2074 6865 2072 6563 6f72 6427 7320  et the record's 
-0000da60: 746f 632d 6b65 7922 2222 0a0a 2020 2020  toc-key"""..    
-0000da70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000da80: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
-0000da90: 615b 2245 4e54 5259 5459 5045 225d 203d  a["ENTRYTYPE"] =
-0000daa0: 3d20 2261 7274 6963 6c65 223a 0a20 2020  = "article":.   
-0000dab0: 2020 2020 2020 2020 2020 2020 2074 6f63               toc
-0000dac0: 5f6b 6579 203d 2028 0a20 2020 2020 2020  _key = (.       
-0000dad0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000dae0: 662e 6461 7461 5b22 6a6f 7572 6e61 6c22  f.data["journal"
-0000daf0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000db00: 2020 2020 2020 2e72 6570 6c61 6365 2822        .replace("
-0000db10: 2022 2c20 222d 2229 0a20 2020 2020 2020   ", "-").       
-0000db20: 2020 2020 2020 2020 2020 2020 202e 7265               .re
-0000db30: 706c 6163 6528 225c 5c22 2c20 2222 290a  place("\\", "").
-0000db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db50: 2020 2020 2e72 6570 6c61 6365 2822 2622      .replace("&"
-0000db60: 2c20 2261 6e64 2229 0a20 2020 2020 2020  , "and").       
-0000db70: 2020 2020 2020 2020 2020 2020 202e 6c6f               .lo
-0000db80: 7765 7228 290a 2020 2020 2020 2020 2020  wer().          
-0000db90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000dba0: 2020 2020 2020 2020 746f 635f 6b65 7920          toc_key 
-0000dbb0: 2b3d 2028 0a20 2020 2020 2020 2020 2020  += (.           
-0000dbc0: 2020 2020 2020 2020 2066 227c 7b73 656c           f"|{sel
-0000dbd0: 662e 6461 7461 5b27 766f 6c75 6d65 275d  f.data['volume']
-0000dbe0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0000dbf0: 2020 2020 2020 2069 6620 2822 554e 4b4e         if ("UNKN
-0000dc00: 4f57 4e22 2021 3d20 7365 6c66 2e64 6174  OWN" != self.dat
-0000dc10: 612e 6765 7428 2276 6f6c 756d 6522 2c20  a.get("volume", 
-0000dc20: 2255 4e4b 4e4f 574e 2229 290a 2020 2020  "UNKNOWN")).    
-0000dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc40: 656c 7365 2022 7c2d 220a 2020 2020 2020  else "|-".      
-0000dc50: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000dc60: 2020 2020 2020 2020 2020 2020 746f 635f              toc_
-0000dc70: 6b65 7920 2b3d 2028 0a20 2020 2020 2020  key += (.       
-0000dc80: 2020 2020 2020 2020 2020 2020 2066 227c               f"|
-0000dc90: 7b73 656c 662e 6461 7461 5b27 6e75 6d62  {self.data['numb
-0000dca0: 6572 275d 7d22 0a20 2020 2020 2020 2020  er']}".         
-0000dcb0: 2020 2020 2020 2020 2020 2069 6620 2822             if ("
-0000dcc0: 554e 4b4e 4f57 4e22 2021 3d20 7365 6c66  UNKNOWN" != self
-0000dcd0: 2e64 6174 612e 6765 7428 226e 756d 6265  .data.get("numbe
-0000dce0: 7222 2c20 2255 4e4b 4e4f 574e 2229 290a  r", "UNKNOWN")).
-0000dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd00: 2020 2020 656c 7365 2022 7c2d 220a 2020      else "|-".  
-0000dd10: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000dd20: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000dd30: 6620 7365 6c66 2e64 6174 615b 2245 4e54  f self.data["ENT
-0000dd40: 5259 5459 5045 225d 203d 3d20 2269 6e70  RYTYPE"] == "inp
-0000dd50: 726f 6365 6564 696e 6773 223a 0a20 2020  roceedings":.   
-0000dd60: 2020 2020 2020 2020 2020 2020 2074 6f63               toc
-0000dd70: 5f6b 6579 203d 2028 0a20 2020 2020 2020  _key = (.       
-0000dd80: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000dd90: 662e 6461 7461 5b22 626f 6f6b 7469 746c  f.data["booktitl
-0000dda0: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-0000ddb0: 2020 2020 2020 2020 2e72 6570 6c61 6365          .replace
-0000ddc0: 2822 2022 2c20 222d 2229 0a20 2020 2020  (" ", "-").     
-0000ddd0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-0000dde0: 7265 706c 6163 6528 225c 5c22 2c20 2222  replace("\\", ""
-0000ddf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000de00: 2020 2020 2020 2e72 6570 6c61 6365 2822        .replace("
-0000de10: 2622 2c20 2261 6e64 2229 0a20 2020 2020  &", "and").     
-0000de20: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-0000de30: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-0000de40: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
-0000de50: 7c7b 7365 6c66 2e64 6174 612e 6765 7428  |{self.data.get(
-0000de60: 2779 6561 7227 2c20 2727 297d 220a 2020  'year', '')}".  
-0000de70: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000de80: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000de90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dea0: 2020 6d73 6720 3d20 280a 2020 2020 2020    msg = (.      
-0000deb0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000dec0: 454e 5452 5954 5950 4520 7b73 656c 662e  ENTRYTYPE {self.
-0000ded0: 6461 7461 5b27 454e 5452 5954 5950 4527  data['ENTRYTYPE'
-0000dee0: 5d7d 2022 0a20 2020 2020 2020 2020 2020  ]} ".           
-0000def0: 2020 2020 2020 2020 202b 2066 2228 7b73           + f"({s
-0000df00: 656c 662e 6461 7461 5b27 4944 275d 7d29  elf.data['ID']})
-0000df10: 206e 6f74 2074 6f63 2d69 6465 6e74 6966   not toc-identif
-0000df20: 6961 626c 6522 0a20 2020 2020 2020 2020  iable".         
-0000df30: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000df40: 2020 2020 2020 2020 2072 6169 7365 2063           raise c
-0000df50: 6f6c 7265 765f 6578 6365 7074 696f 6e73  olrev_exceptions
-0000df60: 2e4e 6f74 544f 4349 6465 6e74 6966 6961  .NotTOCIdentifia
-0000df70: 626c 6545 7863 6570 7469 6f6e 286d 7367  bleException(msg
-0000df80: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0000df90: 204b 6579 4572 726f 7220 6173 2065 7863   KeyError as exc
-0000dfa0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000dfb0: 6973 6520 636f 6c72 6576 5f65 7863 6570  ise colrev_excep
-0000dfc0: 7469 6f6e 732e 4e6f 7454 4f43 4964 656e  tions.NotTOCIden
-0000dfd0: 7469 6669 6162 6c65 4578 6365 7074 696f  tifiableExceptio
-0000dfe0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0000dff0: 2020 2066 226d 6973 7369 6e67 206b 6579     f"missing key
-0000e000: 207b 6578 637d 220a 2020 2020 2020 2020   {exc}".        
-0000e010: 2020 2020 2920 6672 6f6d 2065 7863 0a0a      ) from exc..
-0000e020: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0000e030: 6f63 5f6b 6579 0a0a 2020 2020 6465 6620  oc_key..    def 
-0000e040: 7072 696e 745f 6369 7461 7469 6f6e 5f66  print_citation_f
-0000e050: 6f72 6d61 7428 7365 6c66 2920 2d3e 204e  ormat(self) -> N
-0000e060: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000e070: 5072 696e 7420 7468 6520 7265 636f 7264  Print the record
-0000e080: 2061 7320 6120 6369 7461 7469 6f6e 2222   as a citation""
-0000e090: 220a 2020 2020 2020 2020 666f 726d 6174  ".        format
-0000e0a0: 7465 645f 7265 6620 3d20 280a 2020 2020  ted_ref = (.    
-0000e0b0: 2020 2020 2020 2020 6622 7b73 656c 662e          f"{self.
-0000e0c0: 6461 7461 2e67 6574 2827 6175 7468 6f72  data.get('author
-0000e0d0: 272c 2027 2729 7d20 287b 7365 6c66 2e64  ', '')} ({self.d
-0000e0e0: 6174 612e 6765 7428 2779 6561 7227 2c20  ata.get('year', 
-0000e0f0: 2727 297d 2920 220a 2020 2020 2020 2020  '')}) ".        
-0000e100: 2020 2020 2b20 6622 7b73 656c 662e 6461      + f"{self.da
-0000e110: 7461 2e67 6574 2827 7469 746c 6527 2c20  ta.get('title', 
-0000e120: 2727 297d 2e20 220a 2020 2020 2020 2020  '')}. ".        
-0000e130: 2020 2020 2b20 6622 7b73 656c 662e 6461      + f"{self.da
-0000e140: 7461 2e67 6574 2827 6a6f 7572 6e61 6c27  ta.get('journal'
-0000e150: 2c20 2727 297d 7b73 656c 662e 6461 7461  , '')}{self.data
-0000e160: 2e67 6574 2827 626f 6f6b 7469 746c 6527  .get('booktitle'
-0000e170: 2c20 2727 297d 2c20 220a 2020 2020 2020  , '')}, ".      
-0000e180: 2020 2020 2020 2b20 6622 7b73 656c 662e        + f"{self.
-0000e190: 6461 7461 2e67 6574 2827 766f 6c75 6d65  data.get('volume
-0000e1a0: 272c 2027 2729 7d20 287b 7365 6c66 2e64  ', '')} ({self.d
-0000e1b0: 6174 612e 6765 7428 276e 756d 6265 7227  ata.get('number'
-0000e1c0: 2c20 2727 297d 2922 0a20 2020 2020 2020  , '')})".       
-0000e1d0: 2029 0a20 2020 2020 2020 2070 7269 6e74   ).        print
-0000e1e0: 2866 6f72 6d61 7474 6564 5f72 6566 290a  (formatted_ref).
-0000e1f0: 0a20 2020 2064 6566 2067 6574 5f74 6569  .    def get_tei
-0000e200: 5f66 696c 656e 616d 6528 7365 6c66 2920  _filename(self) 
-0000e210: 2d3e 2050 6174 683a 0a20 2020 2020 2020  -> Path:.       
-0000e220: 2022 2222 4765 7420 7468 6520 5445 4920   """Get the TEI 
-0000e230: 6669 6c65 6e61 6d65 2061 7373 6f63 6961  filename associa
-0000e240: 7465 6420 7769 7468 2074 6865 2066 696c  ted with the fil
-0000e250: 6520 2850 4446 2922 2222 0a20 2020 2020  e (PDF)""".     
-0000e260: 2020 2074 6569 5f66 696c 656e 616d 6520     tei_filename 
-0000e270: 3d20 5061 7468 2866 272e 7465 692f 7b73  = Path(f'.tei/{s
-0000e280: 656c 662e 6461 7461 5b22 4944 225d 7d2e  elf.data["ID"]}.
-0000e290: 7465 692e 786d 6c27 290a 2020 2020 2020  tei.xml').      
-0000e2a0: 2020 6966 2022 6669 6c65 2220 696e 2073    if "file" in s
-0000e2b0: 656c 662e 6461 7461 3a0a 2020 2020 2020  elf.data:.      
-0000e2c0: 2020 2020 2020 7465 695f 6669 6c65 6e61        tei_filena
-0000e2d0: 6d65 203d 2050 6174 6828 0a20 2020 2020  me = Path(.     
-0000e2e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e2f0: 6461 7461 5b22 6669 6c65 225d 2e72 6570  data["file"].rep
-0000e300: 6c61 6365 2822 7064 6673 2f22 2c20 222e  lace("pdfs/", ".
-0000e310: 7465 692f 2229 0a20 2020 2020 2020 2020  tei/").         
-0000e320: 2020 2029 2e77 6974 685f 7375 6666 6978     ).with_suffix
-0000e330: 2822 2e74 6569 2e78 6d6c 2229 0a20 2020  (".tei.xml").   
-0000e340: 2020 2020 2072 6574 7572 6e20 7465 695f       return tei_
-0000e350: 6669 6c65 6e61 6d65 0a0a 2020 2020 4063  filename..    @c
-0000e360: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0000e370: 6566 2070 7269 6e74 5f64 6966 665f 7061  ef print_diff_pa
-0000e380: 6972 2863 6c73 2c20 2a2c 2072 6563 6f72  ir(cls, *, recor
-0000e390: 645f 7061 6972 3a20 6c69 7374 2c20 6b65  d_pair: list, ke
-0000e3a0: 7973 3a20 6c69 7374 2920 2d3e 204e 6f6e  ys: list) -> Non
-0000e3b0: 653a 0a20 2020 2020 2020 2022 2222 5072  e:.        """Pr
-0000e3c0: 696e 7420 7468 6520 6469 6666 2062 6574  int the diff bet
-0000e3d0: 7765 656e 2074 776f 2072 6563 6f72 6473  ween two records
-0000e3e0: 2222 220a 0a20 2020 2020 2020 2064 6566  """..        def
-0000e3f0: 2070 7269 6e74 5f64 6966 6628 6368 616e   print_diff(chan
-0000e400: 6765 3a20 7475 706c 6529 202d 3e20 7374  ge: tuple) -> st
-0000e410: 723a 0a20 2020 2020 2020 2020 2020 2064  r:.            d
-0000e420: 6966 6620 3d20 6469 6666 6c69 622e 4469  iff = difflib.Di
-0000e430: 6666 6572 2829 0a20 2020 2020 2020 2020  ffer().         
-0000e440: 2020 206c 6574 7465 7273 203d 206c 6973     letters = lis
-0000e450: 7428 6469 6666 2e63 6f6d 7061 7265 2863  t(diff.compare(c
-0000e460: 6861 6e67 655b 315d 2c20 6368 616e 6765  hange[1], change
-0000e470: 5b30 5d29 290a 2020 2020 2020 2020 2020  [0])).          
-0000e480: 2020 666f 7220 692c 206c 6574 7465 7220    for i, letter 
-0000e490: 696e 2065 6e75 6d65 7261 7465 286c 6574  in enumerate(let
-0000e4a0: 7465 7273 293a 0a20 2020 2020 2020 2020  ters):.         
-0000e4b0: 2020 2020 2020 2069 6620 6c65 7474 6572         if letter
-0000e4c0: 2e73 7461 7274 7377 6974 6828 2220 2022  .startswith("  "
-0000e4d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000e4e0: 2020 2020 2020 206c 6574 7465 7273 5b69         letters[i
-0000e4f0: 5d20 3d20 6c65 7474 6572 735b 695d 5b2d  ] = letters[i][-
-0000e500: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-0000e510: 2020 2065 6c69 6620 6c65 7474 6572 2e73     elif letter.s
-0000e520: 7461 7274 7377 6974 6828 222b 2022 293a  tartswith("+ "):
-0000e530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e540: 2020 2020 206c 6574 7465 7273 5b69 5d20       letters[i] 
-0000e550: 3d20 6622 7b63 6f6c 6f72 732e 5245 447d  = f"{colors.RED}
-0000e560: 2220 2b20 6c65 7474 6572 735b 695d 5b2d  " + letters[i][-
-0000e570: 315d 202b 2066 227b 636f 6c6f 7273 2e45  1] + f"{colors.E
-0000e580: 4e44 7d22 0a20 2020 2020 2020 2020 2020  ND}".           
-0000e590: 2020 2020 2065 6c69 6620 6c65 7474 6572       elif letter
-0000e5a0: 2e73 7461 7274 7377 6974 6828 222d 2022  .startswith("- "
-0000e5b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000e5c0: 2020 2020 2020 206c 6574 7465 7273 5b69         letters[i
-0000e5d0: 5d20 3d20 6622 7b63 6f6c 6f72 732e 4752  ] = f"{colors.GR
-0000e5e0: 4545 4e7d 2220 2b20 6c65 7474 6572 735b  EEN}" + letters[
-0000e5f0: 695d 5b2d 315d 202b 2066 227b 636f 6c6f  i][-1] + f"{colo
-0000e600: 7273 2e45 4e44 7d22 0a20 2020 2020 2020  rs.END}".       
-0000e610: 2020 2020 2072 6573 203d 2022 222e 6a6f       res = "".jo
-0000e620: 696e 286c 6574 7465 7273 292e 7265 706c  in(letters).repl
-0000e630: 6163 6528 225c 6e22 2c20 2220 2229 0a20  ace("\n", " "). 
-0000e640: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e650: 6e20 7265 730a 0a20 2020 2020 2020 2066  n res..        f
-0000e660: 6f72 206b 6579 2069 6e20 6b65 7973 3a0a  or key in keys:.
-0000e670: 2020 2020 2020 2020 2020 2020 7072 6576              prev
-0000e680: 5f76 616c 203d 2022 5f46 4952 5354 5f56  _val = "_FIRST_V
-0000e690: 414c 220a 2020 2020 2020 2020 2020 2020  AL".            
-0000e6a0: 666f 7220 7265 6320 696e 2072 6563 6f72  for rec in recor
-0000e6b0: 645f 7061 6972 3a0a 2020 2020 2020 2020  d_pair:.        
-0000e6c0: 2020 2020 2020 2020 6966 2070 7265 765f          if prev_
-0000e6d0: 7661 6c20 3d3d 2072 6563 2e67 6574 286b  val == rec.get(k
-0000e6e0: 6579 2c20 2222 2920 6f72 2070 7265 765f  ey, "") or prev_
-0000e6f0: 7661 6c20 3d3d 2022 5f46 4952 5354 5f56  val == "_FIRST_V
-0000e700: 414c 223a 0a20 2020 2020 2020 2020 2020  AL":.           
-0000e710: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-0000e720: 6622 7b72 6563 2e67 6574 286b 6579 2c20  f"{rec.get(key, 
-0000e730: 2727 297d 220a 2020 2020 2020 2020 2020  '')}".          
-0000e740: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e760: 7369 6d69 6c61 7269 7479 203d 2030 2e30  similarity = 0.0
-0000e770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e780: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-0000e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7a0: 2020 7072 6576 5f76 616c 2069 7320 6e6f    prev_val is no
-0000e7b0: 7420 4e6f 6e65 0a20 2020 2020 2020 2020  t None.         
-0000e7c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000e7d0: 6e64 2072 6563 2e67 6574 286b 6579 2c20  nd rec.get(key, 
-0000e7e0: 2222 2920 213d 2022 220a 2020 2020 2020  "") != "".      
-0000e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e800: 2020 616e 6420 7072 6576 5f76 616c 2021    and prev_val !
-0000e810: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
-0000e820: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0000e830: 2072 6563 5b6b 6579 5d20 6973 206e 6f74   rec[key] is not
-0000e840: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0000e850: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-0000e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e870: 2020 2020 2073 696d 696c 6172 6974 7920       similarity 
-0000e880: 3d20 6675 7a7a 2e70 6172 7469 616c 5f72  = fuzz.partial_r
-0000e890: 6174 696f 2870 7265 765f 7661 6c2c 2072  atio(prev_val, r
-0000e8a0: 6563 5b6b 6579 5d29 202f 2031 3030 0a20  ec[key]) / 100. 
-0000e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8c0: 2020 2020 2020 2023 204e 6f74 6520 3a20         # Note : 
-0000e8d0: 7468 6520 6675 7a7a 2e70 6172 7469 616c  the fuzz.partial
-0000e8e0: 5f72 6174 696f 2077 6f72 6b73 2062 6574  _ratio works bet
-0000e8f0: 7465 7220 666f 7220 7061 7274 6961 6c20  ter for partial 
-0000e900: 7375 6273 7472 696e 6773 0a20 2020 2020  substrings.     
-0000e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e920: 2020 2023 2066 726f 6d20 6469 6666 6c69     # from diffli
-0000e930: 6220 696d 706f 7274 2053 6571 7565 6e63  b import Sequenc
-0000e940: 654d 6174 6368 6572 0a20 2020 2020 2020  eMatcher.       
+0000cf20: 6368 6563 6b5f 6578 7472 6163 7461 626c  check_extractabl
+0000cf30: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+0000cf40: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000cf60: 6573 6f75 7263 655f 6d61 6e61 6765 7220  esource_manager 
+0000cf70: 3d20 5044 4652 6573 6f75 7263 654d 616e  = PDFResourceMan
+0000cf80: 6167 6572 2829 0a20 2020 2020 2020 2020  ager().         
+0000cf90: 2020 2020 2020 2020 2020 2066 616b 655f             fake_
+0000cfa0: 6669 6c65 5f68 616e 646c 6520 3d20 696f  file_handle = io
+0000cfb0: 2e53 7472 696e 6749 4f28 290a 2020 2020  .StringIO().    
+0000cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfd0: 636f 6e76 6572 7465 7220 3d20 5465 7874  converter = Text
+0000cfe0: 436f 6e76 6572 7465 7228 0a20 2020 2020  Converter(.     
+0000cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d000: 2020 2072 6573 6f75 7263 655f 6d61 6e61     resource_mana
+0000d010: 6765 722c 2066 616b 655f 6669 6c65 5f68  ger, fake_file_h
+0000d020: 616e 646c 652c 206c 6170 6172 616d 733d  andle, laparams=
+0000d030: 6c61 7061 7261 6d73 0a20 2020 2020 2020  laparams.       
+0000d040: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d060: 2020 2070 6167 655f 696e 7465 7270 7265     page_interpre
+0000d070: 7465 7220 3d20 5044 4650 6167 6549 6e74  ter = PDFPageInt
+0000d080: 6572 7072 6574 6572 2872 6573 6f75 7263  erpreter(resourc
+0000d090: 655f 6d61 6e61 6765 722c 2063 6f6e 7665  e_manager, conve
+0000d0a0: 7274 6572 290a 2020 2020 2020 2020 2020  rter).          
+0000d0b0: 2020 2020 2020 2020 2020 7061 6765 5f69            page_i
+0000d0c0: 6e74 6572 7072 6574 6572 2e70 726f 6365  nterpreter.proce
+0000d0d0: 7373 5f70 6167 6528 7061 6765 290a 0a20  ss_page(page).. 
+0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0f0: 2020 2074 6578 7420 3d20 6661 6b65 5f66     text = fake_f
+0000d100: 696c 655f 6861 6e64 6c65 2e67 6574 7661  ile_handle.getva
+0000d110: 6c75 6528 290a 2020 2020 2020 2020 2020  lue().          
+0000d120: 2020 2020 2020 2020 2020 7465 7874 5f6c            text_l
+0000d130: 6973 7420 2b3d 2074 6578 740a 0a20 2020  ist += text..   
+0000d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d150: 2023 2063 6c6f 7365 206f 7065 6e20 6861   # close open ha
+0000d160: 6e64 6c65 730a 2020 2020 2020 2020 2020  ndles.          
+0000d170: 2020 2020 2020 2020 2020 636f 6e76 6572            conver
+0000d180: 7465 722e 636c 6f73 6528 290a 2020 2020  ter.close().    
+0000d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1a0: 6661 6b65 5f66 696c 655f 6861 6e64 6c65  fake_file_handle
+0000d1b0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+0000d1c0: 2020 2020 2065 7863 6570 7420 2854 7970       except (Typ
+0000d1d0: 6545 7272 6f72 2c20 4b65 7945 7272 6f72  eError, KeyError
+0000d1e0: 293a 2020 2320 7072 6167 6d61 3a20 6e6f  ):  # pragma: no
+0000d1f0: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
+0000d200: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0000d210: 2020 2020 7265 7475 726e 2022 222e 6a6f      return "".jo
+0000d220: 696e 2874 6578 745f 6c69 7374 290a 0a20  in(text_list).. 
+0000d230: 2020 2064 6566 2073 6574 5f70 6167 6573     def set_pages
+0000d240: 5f69 6e5f 7064 6628 7365 6c66 2c20 2a2c  _in_pdf(self, *,
+0000d250: 2070 726f 6a65 6374 5f70 6174 683a 2050   project_path: P
+0000d260: 6174 6829 202d 3e20 4e6f 6e65 3a0a 2020  ath) -> None:.  
+0000d270: 2020 2020 2020 2222 2253 6574 2074 6865        """Set the
+0000d280: 2070 6167 6573 5f69 6e5f 6669 6c65 2066   pages_in_file f
+0000d290: 6965 6c64 2062 6173 6564 206f 6e20 7468  ield based on th
+0000d2a0: 6520 5044 4622 2222 0a20 2020 2020 2020  e PDF""".       
+0000d2b0: 2070 6466 5f70 6174 6820 3d20 7072 6f6a   pdf_path = proj
+0000d2c0: 6563 745f 7061 7468 202f 2050 6174 6828  ect_path / Path(
+0000d2d0: 7365 6c66 2e64 6174 615b 2266 696c 6522  self.data["file"
+0000d2e0: 5d29 0a20 2020 2020 2020 2077 6974 6820  ]).        with 
+0000d2f0: 6f70 656e 2870 6466 5f70 6174 682c 2022  open(pdf_path, "
+0000d300: 7262 2229 2061 7320 6669 6c65 3a0a 2020  rb") as file:.  
+0000d310: 2020 2020 2020 2020 2020 7061 7273 6572            parser
+0000d320: 203d 2050 4446 5061 7273 6572 2866 696c   = PDFParser(fil
+0000d330: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
+0000d340: 6f63 756d 656e 7420 3d20 5044 4644 6f63  ocument = PDFDoc
+0000d350: 756d 656e 7428 7061 7273 6572 290a 2020  ument(parser).  
+0000d360: 2020 2020 2020 2020 2020 7061 6765 735f            pages_
+0000d370: 696e 5f66 696c 6520 3d20 7265 736f 6c76  in_file = resolv
+0000d380: 6531 2864 6f63 756d 656e 742e 6361 7461  e1(document.cata
+0000d390: 6c6f 675b 2250 6167 6573 225d 295b 2243  log["Pages"])["C
+0000d3a0: 6f75 6e74 225d 0a20 2020 2020 2020 2073  ount"].        s
+0000d3b0: 656c 662e 6461 7461 5b22 7061 6765 735f  elf.data["pages_
+0000d3c0: 696e 5f66 696c 6522 5d20 3d20 7061 6765  in_file"] = page
+0000d3d0: 735f 696e 5f66 696c 650a 0a20 2020 2064  s_in_file..    d
+0000d3e0: 6566 2073 6574 5f74 6578 745f 6672 6f6d  ef set_text_from
+0000d3f0: 5f70 6466 2873 656c 662c 202a 2c20 7072  _pdf(self, *, pr
+0000d400: 6f6a 6563 745f 7061 7468 3a20 5061 7468  oject_path: Path
+0000d410: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000d420: 2020 2022 2222 5365 7420 7468 6520 7465     """Set the te
+0000d430: 7874 5f66 726f 6d5f 7064 6620 6669 656c  xt_from_pdf fiel
+0000d440: 6420 6261 7365 6420 6f6e 2074 6865 2050  d based on the P
+0000d450: 4446 2222 220a 2020 2020 2020 2020 7365  DF""".        se
+0000d460: 6c66 2e64 6174 615b 2274 6578 745f 6672  lf.data["text_fr
+0000d470: 6f6d 5f70 6466 225d 203d 2022 220a 2020  om_pdf"] = "".  
+0000d480: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000d490: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+0000d4a0: 7061 6765 735f 696e 5f70 6466 2870 726f  pages_in_pdf(pro
+0000d4b0: 6a65 6374 5f70 6174 683d 7072 6f6a 6563  ject_path=projec
+0000d4c0: 745f 7061 7468 290a 2020 2020 2020 2020  t_path).        
+0000d4d0: 2020 2020 7465 7874 203d 2073 656c 662e      text = self.
+0000d4e0: 6578 7472 6163 745f 7465 7874 5f62 795f  extract_text_by_
+0000d4f0: 7061 6765 2870 6167 6573 3d5b 302c 2031  page(pages=[0, 1
+0000d500: 2c20 325d 2c20 7072 6f6a 6563 745f 7061  , 2], project_pa
+0000d510: 7468 3d70 726f 6a65 6374 5f70 6174 6829  th=project_path)
+0000d520: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000d530: 662e 6461 7461 5b22 7465 7874 5f66 726f  f.data["text_fro
+0000d540: 6d5f 7064 6622 5d20 3d20 7465 7874 2e72  m_pdf"] = text.r
+0000d550: 6570 6c61 6365 2822 5c6e 222c 2022 2022  eplace("\n", " "
+0000d560: 292e 7265 706c 6163 6528 225c 7830 6322  ).replace("\x0c"
+0000d570: 2c20 2222 290a 0a20 2020 2020 2020 2065  , "")..        e
+0000d580: 7863 6570 7420 5044 4653 796e 7461 7845  xcept PDFSyntaxE
+0000d590: 7272 6f72 3a20 2023 2070 7261 676d 613a  rror:  # pragma:
+0000d5a0: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+0000d5b0: 2020 2020 2020 7365 6c66 2e61 6464 5f64        self.add_d
+0000d5c0: 6174 615f 7072 6f76 656e 616e 6365 5f6e  ata_provenance_n
+0000d5d0: 6f74 6528 6b65 793d 2266 696c 6522 2c20  ote(key="file", 
+0000d5e0: 6e6f 7465 3d22 7064 665f 7265 6164 6572  note="pdf_reader
+0000d5f0: 5f65 7272 6f72 2229 0a20 2020 2020 2020  _error").       
+0000d600: 2020 2020 2073 656c 662e 6461 7461 2e75       self.data.u
+0000d610: 7064 6174 6528 636f 6c72 6576 5f73 7461  pdate(colrev_sta
+0000d620: 7475 733d 5265 636f 7264 5374 6174 652e  tus=RecordState.
+0000d630: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
+0000d640: 5f70 7265 7061 7261 7469 6f6e 290a 2020  _preparation).  
+0000d650: 2020 2020 2020 6578 6365 7074 2050 4446        except PDF
+0000d660: 5465 7874 4578 7472 6163 7469 6f6e 4e6f  TextExtractionNo
+0000d670: 7441 6c6c 6f77 6564 3a20 2023 2070 7261  tAllowed:  # pra
+0000d680: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
+0000d690: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000d6a0: 6464 5f64 6174 615f 7072 6f76 656e 616e  dd_data_provenan
+0000d6b0: 6365 5f6e 6f74 6528 6b65 793d 2266 696c  ce_note(key="fil
+0000d6c0: 6522 2c20 6e6f 7465 3d22 7064 665f 7072  e", note="pdf_pr
+0000d6d0: 6f74 6563 7465 6422 290a 2020 2020 2020  otected").      
+0000d6e0: 2020 2020 2020 7365 6c66 2e64 6174 612e        self.data.
+0000d6f0: 7570 6461 7465 2863 6f6c 7265 765f 7374  update(colrev_st
+0000d700: 6174 7573 3d52 6563 6f72 6453 7461 7465  atus=RecordState
+0000d710: 2e70 6466 5f6e 6565 6473 5f6d 616e 7561  .pdf_needs_manua
+0000d720: 6c5f 7072 6570 6172 6174 696f 6e29 0a0a  l_preparation)..
+0000d730: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
+0000d740: 7061 6765 7328 0a20 2020 2020 2020 2073  pages(.        s
+0000d750: 656c 662c 202a 2c20 7061 6765 733a 206c  elf, *, pages: l
+0000d760: 6973 742c 2070 726f 6a65 6374 5f70 6174  ist, project_pat
+0000d770: 683a 2050 6174 682c 2073 6176 655f 746f  h: Path, save_to
+0000d780: 5f70 6174 683a 204f 7074 696f 6e61 6c5b  _path: Optional[
+0000d790: 5061 7468 5d20 3d20 4e6f 6e65 0a20 2020  Path] = None.   
+0000d7a0: 2029 202d 3e20 4e6f 6e65 3a20 2023 2070   ) -> None:  # p
+0000d7b0: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
+0000d7c0: 2020 2020 2020 2020 2222 2245 7874 7261          """Extra
+0000d7d0: 6374 2070 6167 6573 2066 726f 6d20 7468  ct pages from th
+0000d7e0: 6520 5044 4620 2873 6176 6569 6e67 2074  e PDF (saveing t
+0000d7f0: 6865 6d20 746f 2074 6865 2073 6176 655f  hem to the save_
+0000d800: 746f 5f70 6174 6829 2222 220a 2020 2020  to_path)""".    
+0000d810: 2020 2020 7064 665f 7061 7468 203d 2070      pdf_path = p
+0000d820: 726f 6a65 6374 5f70 6174 6820 2f20 5061  roject_path / Pa
+0000d830: 7468 2873 656c 662e 6461 7461 5b22 6669  th(self.data["fi
+0000d840: 6c65 225d 290a 2020 2020 2020 2020 7064  le"]).        pd
+0000d850: 665f 7265 6164 6572 203d 2050 6466 4669  f_reader = PdfFi
+0000d860: 6c65 5265 6164 6572 2873 7472 2870 6466  leReader(str(pdf
+0000d870: 5f70 6174 6829 2c20 7374 7269 6374 3d46  _path), strict=F
+0000d880: 616c 7365 290a 2020 2020 2020 2020 7772  alse).        wr
+0000d890: 6974 6572 203d 2050 6466 4669 6c65 5772  iter = PdfFileWr
+0000d8a0: 6974 6572 2829 0a20 2020 2020 2020 2066  iter().        f
+0000d8b0: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
+0000d8c0: 206c 656e 2870 6466 5f72 6561 6465 722e   len(pdf_reader.
+0000d8d0: 7061 6765 7329 293a 0a20 2020 2020 2020  pages)):.       
+0000d8e0: 2020 2020 2069 6620 6920 696e 2070 6167       if i in pag
+0000d8f0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0000d900: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0000d910: 2020 2020 2020 2020 2077 7269 7465 722e           writer.
+0000d920: 6164 6450 6167 6528 7064 665f 7265 6164  addPage(pdf_read
+0000d930: 6572 2e67 6574 5061 6765 2869 2929 0a20  er.getPage(i)). 
+0000d940: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0000d950: 2870 6466 5f70 6174 682c 2022 7762 2229  (pdf_path, "wb")
+0000d960: 2061 7320 6f75 7466 696c 653a 0a20 2020   as outfile:.   
+0000d970: 2020 2020 2020 2020 2077 7269 7465 722e           writer.
+0000d980: 7772 6974 6528 6f75 7466 696c 6529 0a0a  write(outfile)..
+0000d990: 2020 2020 2020 2020 6966 2073 6176 655f          if save_
+0000d9a0: 746f 5f70 6174 683a 0a20 2020 2020 2020  to_path:.       
+0000d9b0: 2020 2020 2077 7269 7465 725f 6370 203d       writer_cp =
+0000d9c0: 2050 6466 4669 6c65 5772 6974 6572 2829   PdfFileWriter()
+0000d9d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000d9e0: 2070 6167 6520 696e 2070 6167 6573 3a0a   page in pages:.
+0000d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da00: 7772 6974 6572 5f63 702e 6164 6450 6167  writer_cp.addPag
+0000da10: 6528 7064 665f 7265 6164 6572 2e67 6574  e(pdf_reader.get
+0000da20: 5061 6765 2870 6167 6529 290a 2020 2020  Page(page)).    
+0000da30: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+0000da40: 203d 2050 6174 6828 7064 665f 7061 7468   = Path(pdf_path
+0000da50: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
+0000da60: 7468 206f 7065 6e28 7361 7665 5f74 6f5f  th open(save_to_
+0000da70: 7061 7468 202f 2066 696c 6570 6174 682e  path / filepath.
+0000da80: 6e61 6d65 2c20 2277 6222 2920 6173 206f  name, "wb") as o
+0000da90: 7574 6669 6c65 3a0a 2020 2020 2020 2020  utfile:.        
+0000daa0: 2020 2020 2020 2020 7772 6974 6572 5f63          writer_c
+0000dab0: 702e 7772 6974 6528 6f75 7466 696c 6529  p.write(outfile)
+0000dac0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0000dad0: 6f64 0a20 2020 2064 6566 2067 6574 5f63  od.    def get_c
+0000dae0: 6f6c 7265 765f 7064 665f 6964 280a 2020  olrev_pdf_id(.  
+0000daf0: 2020 2020 2020 636c 732c 0a20 2020 2020        cls,.     
+0000db00: 2020 202a 2c0a 2020 2020 2020 2020 7064     *,.        pd
+0000db10: 665f 7061 7468 3a20 5061 7468 2c0a 2020  f_path: Path,.  
+0000db20: 2020 2920 2d3e 2073 7472 3a20 2023 2070    ) -> str:  # p
+0000db30: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
+0000db40: 2020 2020 2020 2020 2222 2247 656e 6572          """Gener
+0000db50: 6174 6520 7468 6520 636f 6c72 6576 5f70  ate the colrev_p
+0000db60: 6466 5f69 6422 2222 0a0a 2020 2020 2020  df_id"""..      
+0000db70: 2020 7265 7475 726e 2063 6f6c 7265 762e    return colrev.
+0000db80: 716d 2e63 6f6c 7265 765f 7064 665f 6964  qm.colrev_pdf_id
+0000db90: 2e63 7265 6174 655f 636f 6c72 6576 5f70  .create_colrev_p
+0000dba0: 6466 5f69 6428 7064 665f 7061 7468 3d70  df_id(pdf_path=p
+0000dbb0: 6466 5f70 6174 6829 0a0a 2020 2020 6465  df_path)..    de
+0000dbc0: 6620 6765 745f 746f 635f 6b65 7928 7365  f get_toc_key(se
+0000dbd0: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
+0000dbe0: 2020 2020 2222 2247 6574 2074 6865 2072      """Get the r
+0000dbf0: 6563 6f72 6427 7320 746f 632d 6b65 7922  ecord's toc-key"
+0000dc00: 2222 0a0a 2020 2020 2020 2020 7472 793a  ""..        try:
+0000dc10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000dc20: 7365 6c66 2e64 6174 615b 2245 4e54 5259  self.data["ENTRY
+0000dc30: 5459 5045 225d 203d 3d20 2261 7274 6963  TYPE"] == "artic
+0000dc40: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
+0000dc50: 2020 2020 2074 6f63 5f6b 6579 203d 2028       toc_key = (
+0000dc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dc70: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
+0000dc80: 6a6f 7572 6e61 6c22 5d0a 2020 2020 2020  journal"].      
+0000dc90: 2020 2020 2020 2020 2020 2020 2020 2e72                .r
+0000dca0: 6570 6c61 6365 2822 2022 2c20 222d 2229  eplace(" ", "-")
+0000dcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dcc0: 2020 2020 202e 7265 706c 6163 6528 225c       .replace("\
+0000dcd0: 5c22 2c20 2222 290a 2020 2020 2020 2020  \", "").        
+0000dce0: 2020 2020 2020 2020 2020 2020 2e72 6570              .rep
+0000dcf0: 6c61 6365 2822 2622 2c20 2261 6e64 2229  lace("&", "and")
+0000dd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd10: 2020 2020 202e 6c6f 7765 7228 290a 2020       .lower().  
+0000dd20: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd40: 746f 635f 6b65 7920 2b3d 2028 0a20 2020  toc_key += (.   
+0000dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd60: 2066 227c 7b73 656c 662e 6461 7461 5b27   f"|{self.data['
+0000dd70: 766f 6c75 6d65 275d 7d22 0a20 2020 2020  volume']}".     
+0000dd80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000dd90: 6620 2822 554e 4b4e 4f57 4e22 2021 3d20  f ("UNKNOWN" != 
+0000dda0: 7365 6c66 2e64 6174 612e 6765 7428 2276  self.data.get("v
+0000ddb0: 6f6c 756d 6522 2c20 2255 4e4b 4e4f 574e  olume", "UNKNOWN
+0000ddc0: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+0000ddd0: 2020 2020 2020 2020 656c 7365 2022 7c2d          else "|-
+0000dde0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000ddf0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000de00: 2020 2020 746f 635f 6b65 7920 2b3d 2028      toc_key += (
+0000de10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de20: 2020 2020 2066 227c 7b73 656c 662e 6461       f"|{self.da
+0000de30: 7461 5b27 6e75 6d62 6572 275d 7d22 0a20  ta['number']}". 
+0000de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de50: 2020 2069 6620 2822 554e 4b4e 4f57 4e22     if ("UNKNOWN"
+0000de60: 2021 3d20 7365 6c66 2e64 6174 612e 6765   != self.data.ge
+0000de70: 7428 226e 756d 6265 7222 2c20 2255 4e4b  t("number", "UNK
+0000de80: 4e4f 574e 2229 290a 2020 2020 2020 2020  NOWN")).        
+0000de90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000dea0: 2022 7c2d 220a 2020 2020 2020 2020 2020   "|-".          
+0000deb0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000dec0: 2020 2020 2065 6c69 6620 7365 6c66 2e64       elif self.d
+0000ded0: 6174 615b 2245 4e54 5259 5459 5045 225d  ata["ENTRYTYPE"]
+0000dee0: 203d 3d20 2269 6e70 726f 6365 6564 696e   == "inproceedin
+0000def0: 6773 223a 0a20 2020 2020 2020 2020 2020  gs":.           
+0000df00: 2020 2020 2074 6f63 5f6b 6579 203d 2028       toc_key = (
+0000df10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000df20: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
+0000df30: 626f 6f6b 7469 746c 6522 5d0a 2020 2020  booktitle"].    
+0000df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df50: 2e72 6570 6c61 6365 2822 2022 2c20 222d  .replace(" ", "-
+0000df60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000df70: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
+0000df80: 225c 5c22 2c20 2222 290a 2020 2020 2020  "\\", "").      
+0000df90: 2020 2020 2020 2020 2020 2020 2020 2e72                .r
+0000dfa0: 6570 6c61 6365 2822 2622 2c20 2261 6e64  eplace("&", "and
+0000dfb0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000dfc0: 2020 2020 2020 202e 6c6f 7765 7228 290a         .lower().
+0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfe0: 2020 2020 2b20 6622 7c7b 7365 6c66 2e64      + f"|{self.d
+0000dff0: 6174 612e 6765 7428 2779 6561 7227 2c20  ata.get('year', 
+0000e000: 2727 297d 220a 2020 2020 2020 2020 2020  '')}".          
+0000e010: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000e020: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000e030: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+0000e040: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e050: 2020 2020 2020 6622 454e 5452 5954 5950        f"ENTRYTYP
+0000e060: 4520 7b73 656c 662e 6461 7461 5b27 454e  E {self.data['EN
+0000e070: 5452 5954 5950 4527 5d7d 2022 0a20 2020  TRYTYPE']} ".   
+0000e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e090: 202b 2066 2228 7b73 656c 662e 6461 7461   + f"({self.data
+0000e0a0: 5b27 4944 275d 7d29 206e 6f74 2074 6f63  ['ID']}) not toc
+0000e0b0: 2d69 6465 6e74 6966 6961 626c 6522 0a20  -identifiable". 
+0000e0c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000e0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e0e0: 2072 6169 7365 2063 6f6c 7265 765f 6578   raise colrev_ex
+0000e0f0: 6365 7074 696f 6e73 2e4e 6f74 544f 4349  ceptions.NotTOCI
+0000e100: 6465 6e74 6966 6961 626c 6545 7863 6570  dentifiableExcep
+0000e110: 7469 6f6e 286d 7367 290a 2020 2020 2020  tion(msg).      
+0000e120: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+0000e130: 7220 6173 2065 7863 3a0a 2020 2020 2020  r as exc:.      
+0000e140: 2020 2020 2020 7261 6973 6520 636f 6c72        raise colr
+0000e150: 6576 5f65 7863 6570 7469 6f6e 732e 4e6f  ev_exceptions.No
+0000e160: 7454 4f43 4964 656e 7469 6669 6162 6c65  tTOCIdentifiable
+0000e170: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
+0000e180: 2020 2020 2020 2020 2020 2066 226d 6973             f"mis
+0000e190: 7369 6e67 206b 6579 207b 6578 637d 220a  sing key {exc}".
+0000e1a0: 2020 2020 2020 2020 2020 2020 2920 6672              ) fr
+0000e1b0: 6f6d 2065 7863 0a0a 2020 2020 2020 2020  om exc..        
+0000e1c0: 7265 7475 726e 2074 6f63 5f6b 6579 0a0a  return toc_key..
+0000e1d0: 2020 2020 6465 6620 7072 696e 745f 6369      def print_ci
+0000e1e0: 7461 7469 6f6e 5f66 6f72 6d61 7428 7365  tation_format(se
+0000e1f0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000e200: 2020 2020 2022 2222 5072 696e 7420 7468       """Print th
+0000e210: 6520 7265 636f 7264 2061 7320 6120 6369  e record as a ci
+0000e220: 7461 7469 6f6e 2222 220a 2020 2020 2020  tation""".      
+0000e230: 2020 666f 726d 6174 7465 645f 7265 6620    formatted_ref 
+0000e240: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000e250: 6622 7b73 656c 662e 6461 7461 2e67 6574  f"{self.data.get
+0000e260: 2827 6175 7468 6f72 272c 2027 2729 7d20  ('author', '')} 
+0000e270: 287b 7365 6c66 2e64 6174 612e 6765 7428  ({self.data.get(
+0000e280: 2779 6561 7227 2c20 2727 297d 2920 220a  'year', '')}) ".
+0000e290: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
+0000e2a0: 7b73 656c 662e 6461 7461 2e67 6574 2827  {self.data.get('
+0000e2b0: 7469 746c 6527 2c20 2727 297d 2e20 220a  title', '')}. ".
+0000e2c0: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
+0000e2d0: 7b73 656c 662e 6461 7461 2e67 6574 2827  {self.data.get('
+0000e2e0: 6a6f 7572 6e61 6c27 2c20 2727 297d 7b73  journal', '')}{s
+0000e2f0: 656c 662e 6461 7461 2e67 6574 2827 626f  elf.data.get('bo
+0000e300: 6f6b 7469 746c 6527 2c20 2727 297d 2c20  oktitle', '')}, 
+0000e310: 220a 2020 2020 2020 2020 2020 2020 2b20  ".            + 
+0000e320: 6622 7b73 656c 662e 6461 7461 2e67 6574  f"{self.data.get
+0000e330: 2827 766f 6c75 6d65 272c 2027 2729 7d20  ('volume', '')} 
+0000e340: 287b 7365 6c66 2e64 6174 612e 6765 7428  ({self.data.get(
+0000e350: 276e 756d 6265 7227 2c20 2727 297d 2922  'number', '')})"
+0000e360: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000e370: 2020 2070 7269 6e74 2866 6f72 6d61 7474     print(formatt
+0000e380: 6564 5f72 6566 290a 0a20 2020 2064 6566  ed_ref)..    def
+0000e390: 2067 6574 5f74 6569 5f66 696c 656e 616d   get_tei_filenam
+0000e3a0: 6528 7365 6c66 2920 2d3e 2050 6174 683a  e(self) -> Path:
+0000e3b0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+0000e3c0: 7468 6520 5445 4920 6669 6c65 6e61 6d65  the TEI filename
+0000e3d0: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+0000e3e0: 2074 6865 2066 696c 6520 2850 4446 2922   the file (PDF)"
+0000e3f0: 2222 0a20 2020 2020 2020 2074 6569 5f66  "".        tei_f
+0000e400: 696c 656e 616d 6520 3d20 5061 7468 2866  ilename = Path(f
+0000e410: 272e 7465 692f 7b73 656c 662e 6461 7461  '.tei/{self.data
+0000e420: 5b22 4944 225d 7d2e 7465 692e 786d 6c27  ["ID"]}.tei.xml'
+0000e430: 290a 2020 2020 2020 2020 6966 2022 6669  ).        if "fi
+0000e440: 6c65 2220 696e 2073 656c 662e 6461 7461  le" in self.data
+0000e450: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
+0000e460: 695f 6669 6c65 6e61 6d65 203d 2050 6174  i_filename = Pat
+0000e470: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
+0000e480: 2020 2073 656c 662e 6461 7461 5b22 6669     self.data["fi
+0000e490: 6c65 225d 2e72 6570 6c61 6365 2822 7064  le"].replace("pd
+0000e4a0: 6673 2f22 2c20 222e 7465 692f 2229 0a20  fs/", ".tei/"). 
+0000e4b0: 2020 2020 2020 2020 2020 2029 2e77 6974             ).wit
+0000e4c0: 685f 7375 6666 6978 2822 2e74 6569 2e78  h_suffix(".tei.x
+0000e4d0: 6d6c 2229 0a20 2020 2020 2020 2072 6574  ml").        ret
+0000e4e0: 7572 6e20 7465 695f 6669 6c65 6e61 6d65  urn tei_filename
+0000e4f0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0000e500: 6f64 0a20 2020 2064 6566 2070 7269 6e74  od.    def print
+0000e510: 5f64 6966 665f 7061 6972 2863 6c73 2c20  _diff_pair(cls, 
+0000e520: 2a2c 2072 6563 6f72 645f 7061 6972 3a20  *, record_pair: 
+0000e530: 6c69 7374 2c20 6b65 7973 3a20 6c69 7374  list, keys: list
+0000e540: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000e550: 2020 2022 2222 5072 696e 7420 7468 6520     """Print the 
+0000e560: 6469 6666 2062 6574 7765 656e 2074 776f  diff between two
+0000e570: 2072 6563 6f72 6473 2222 220a 0a20 2020   records"""..   
+0000e580: 2020 2020 2064 6566 2070 7269 6e74 5f64       def print_d
+0000e590: 6966 6628 6368 616e 6765 3a20 7475 706c  iff(change: tupl
+0000e5a0: 6529 202d 3e20 7374 723a 0a20 2020 2020  e) -> str:.     
+0000e5b0: 2020 2020 2020 2064 6966 6620 3d20 6469         diff = di
+0000e5c0: 6666 6c69 622e 4469 6666 6572 2829 0a20  fflib.Differ(). 
+0000e5d0: 2020 2020 2020 2020 2020 206c 6574 7465             lette
+0000e5e0: 7273 203d 206c 6973 7428 6469 6666 2e63  rs = list(diff.c
+0000e5f0: 6f6d 7061 7265 2863 6861 6e67 655b 315d  ompare(change[1]
+0000e600: 2c20 6368 616e 6765 5b30 5d29 290a 2020  , change[0])).  
+0000e610: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+0000e620: 206c 6574 7465 7220 696e 2065 6e75 6d65   letter in enume
+0000e630: 7261 7465 286c 6574 7465 7273 293a 0a20  rate(letters):. 
+0000e640: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000e650: 6620 6c65 7474 6572 2e73 7461 7274 7377  f letter.startsw
+0000e660: 6974 6828 2220 2022 293a 0a20 2020 2020  ith("  "):.     
+0000e670: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000e680: 6574 7465 7273 5b69 5d20 3d20 6c65 7474  etters[i] = lett
+0000e690: 6572 735b 695d 5b2d 315d 0a20 2020 2020  ers[i][-1].     
+0000e6a0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000e6b0: 6c65 7474 6572 2e73 7461 7274 7377 6974  letter.startswit
+0000e6c0: 6828 222b 2022 293a 0a20 2020 2020 2020  h("+ "):.       
+0000e6d0: 2020 2020 2020 2020 2020 2020 206c 6574               let
+0000e6e0: 7465 7273 5b69 5d20 3d20 6622 7b63 6f6c  ters[i] = f"{col
+0000e6f0: 6f72 732e 5245 447d 2220 2b20 6c65 7474  ors.RED}" + lett
+0000e700: 6572 735b 695d 5b2d 315d 202b 2066 227b  ers[i][-1] + f"{
+0000e710: 636f 6c6f 7273 2e45 4e44 7d22 0a20 2020  colors.END}".   
+0000e720: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0000e730: 6620 6c65 7474 6572 2e73 7461 7274 7377  f letter.startsw
+0000e740: 6974 6828 222d 2022 293a 0a20 2020 2020  ith("- "):.     
+0000e750: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000e760: 6574 7465 7273 5b69 5d20 3d20 6622 7b63  etters[i] = f"{c
+0000e770: 6f6c 6f72 732e 4752 4545 4e7d 2220 2b20  olors.GREEN}" + 
+0000e780: 6c65 7474 6572 735b 695d 5b2d 315d 202b  letters[i][-1] +
+0000e790: 2066 227b 636f 6c6f 7273 2e45 4e44 7d22   f"{colors.END}"
+0000e7a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000e7b0: 203d 2022 222e 6a6f 696e 286c 6574 7465   = "".join(lette
+0000e7c0: 7273 292e 7265 706c 6163 6528 225c 6e22  rs).replace("\n"
+0000e7d0: 2c20 2220 2229 0a20 2020 2020 2020 2020  , " ").         
+0000e7e0: 2020 2072 6574 7572 6e20 7265 730a 0a20     return res.. 
+0000e7f0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+0000e800: 6e20 6b65 7973 3a0a 2020 2020 2020 2020  n keys:.        
+0000e810: 2020 2020 7072 6576 5f76 616c 203d 2022      prev_val = "
+0000e820: 5f46 4952 5354 5f56 414c 220a 2020 2020  _FIRST_VAL".    
+0000e830: 2020 2020 2020 2020 666f 7220 7265 6320          for rec 
+0000e840: 696e 2072 6563 6f72 645f 7061 6972 3a0a  in record_pair:.
+0000e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e860: 6966 2070 7265 765f 7661 6c20 3d3d 2072  if prev_val == r
+0000e870: 6563 2e67 6574 286b 6579 2c20 2222 2920  ec.get(key, "") 
+0000e880: 6f72 2070 7265 765f 7661 6c20 3d3d 2022  or prev_val == "
+0000e890: 5f46 4952 5354 5f56 414c 223a 0a20 2020  _FIRST_VAL":.   
+0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8b0: 206c 696e 6520 3d20 6622 7b72 6563 2e67   line = f"{rec.g
+0000e8c0: 6574 286b 6579 2c20 2727 297d 220a 2020  et(key, '')}".  
+0000e8d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000e8e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000e8f0: 2020 2020 2020 2020 7369 6d69 6c61 7269          similari
+0000e900: 7479 203d 2030 2e30 0a20 2020 2020 2020  ty = 0.0.       
+0000e910: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000e920: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e930: 2020 2020 2020 2020 2020 7072 6576 5f76            prev_v
+0000e940: 616c 2069 7320 6e6f 7420 4e6f 6e65 0a20  al is not None. 
 0000e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e960: 2023 2073 696d 696c 6172 6974 7920 3d20   # similarity = 
-0000e970: 5365 7175 656e 6365 4d61 7463 6865 7228  SequenceMatcher(
-0000e980: 4e6f 6e65 2c20 7072 6576 5f76 616c 2c20  None, prev_val, 
-0000e990: 7265 635b 6b65 795d 292e 7261 7469 6f28  rec[key]).ratio(
-0000e9a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e9b0: 2020 2020 2020 6966 2073 696d 696c 6172        if similar
-0000e9c0: 6974 7920 3c20 302e 3520 6f72 206b 6579  ity < 0.5 or key
-0000e9d0: 2069 6e20 5b0a 2020 2020 2020 2020 2020   in [.          
-0000e9e0: 2020 2020 2020 2020 2020 2020 2020 2276                "v
-0000e9f0: 6f6c 756d 6522 2c0a 2020 2020 2020 2020  olume",.        
-0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea10: 226e 756d 6265 7222 2c0a 2020 2020 2020  "number",.      
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 2020 2279 6561 7222 2c0a 2020 2020 2020    "year",.      
-0000ea40: 2020 2020 2020 2020 2020 2020 2020 5d3a                ]:
-0000ea50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ea60: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-0000ea70: 6622 7b63 6f6c 6f72 732e 5245 447d 7b72  f"{colors.RED}{r
-0000ea80: 6563 2e67 6574 286b 6579 2c20 2727 297d  ec.get(key, '')}
-0000ea90: 7b63 6f6c 6f72 732e 454e 447d 220a 2020  {colors.END}".  
-0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eab0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ead0: 6c69 6e65 203d 2070 7269 6e74 5f64 6966  line = print_dif
-0000eae0: 6628 2870 7265 765f 7661 6c2c 2072 6563  f((prev_val, rec
-0000eaf0: 2e67 6574 286b 6579 2c20 2222 2929 290a  .get(key, ""))).
-0000eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb10: 7072 696e 7428 6622 7b6b 6579 7d20 3a20  print(f"{key} : 
-0000eb20: 7b6c 696e 657d 2229 0a20 2020 2020 2020  {line}").       
-0000eb30: 2020 2020 2020 2020 2070 7265 765f 7661           prev_va
-0000eb40: 6c20 3d20 7265 632e 6765 7428 6b65 792c  l = rec.get(key,
-0000eb50: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
-0000eb60: 2070 7269 6e74 2829 0a0a 2020 2020 6465   print()..    de
-0000eb70: 6620 636c 6561 6e75 705f 7064 665f 7072  f cleanup_pdf_pr
-0000eb80: 6f63 6573 7369 6e67 5f66 6965 6c64 7328  ocessing_fields(
-0000eb90: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000eba0: 2020 2020 2020 2022 2222 436c 6561 6e75         """Cleanu
-0000ebb0: 7020 7468 6520 5044 4620 7072 6f63 6573  p the PDF proces
-0000ebc0: 7369 6e67 2066 6965 6c73 2028 7465 7874  sing fiels (text
-0000ebd0: 5f66 726f 6d5f 7064 662c 2070 6167 6573  _from_pdf, pages
-0000ebe0: 5f69 6e5f 6669 6c65 2922 2222 0a20 2020  _in_file)""".   
-0000ebf0: 2020 2020 2069 6620 2274 6578 745f 6672       if "text_fr
-0000ec00: 6f6d 5f70 6466 2220 696e 2073 656c 662e  om_pdf" in self.
-0000ec10: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0000ec20: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
-0000ec30: 2274 6578 745f 6672 6f6d 5f70 6466 225d  "text_from_pdf"]
-0000ec40: 0a20 2020 2020 2020 2069 6620 2270 6167  .        if "pag
-0000ec50: 6573 5f69 6e5f 6669 6c65 2220 696e 2073  es_in_file" in s
-0000ec60: 656c 662e 6461 7461 3a0a 2020 2020 2020  elf.data:.      
-0000ec70: 2020 2020 2020 6465 6c20 7365 6c66 2e64        del self.d
-0000ec80: 6174 615b 2270 6167 6573 5f69 6e5f 6669  ata["pages_in_fi
-0000ec90: 6c65 225d 0a0a 2020 2020 6465 6620 7570  le"]..    def up
-0000eca0: 6461 7465 5f6d 6173 7465 7264 6174 615f  date_masterdata_
-0000ecb0: 7072 6f76 656e 616e 6365 280a 2020 2020  provenance(.    
-0000ecc0: 2020 2020 7365 6c66 2c20 2a2c 2071 6d3a      self, *, qm:
-0000ecd0: 2063 6f6c 7265 762e 716d 2e71 7561 6c69   colrev.qm.quali
-0000ece0: 7479 5f6d 6f64 656c 2e51 7561 6c69 7479  ty_model.Quality
-0000ecf0: 4d6f 6465 6c2c 2073 6574 5f70 7265 7061  Model, set_prepa
-0000ed00: 7265 643a 2062 6f6f 6c20 3d20 4661 6c73  red: bool = Fals
-0000ed10: 650a 2020 2020 2920 2d3e 204e 6f6e 653a  e.    ) -> None:
-0000ed20: 0a20 2020 2020 2020 2022 2222 5570 6461  .        """Upda
-0000ed30: 7465 2074 6865 206d 6173 7465 7264 6174  te the masterdat
-0000ed40: 6120 7072 6f76 656e 616e 6365 2222 220a  a provenance""".
-0000ed50: 0a20 2020 2020 2020 2069 6620 2263 6f6c  .        if "col
-0000ed60: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-0000ed70: 726f 7665 6e61 6e63 6522 206e 6f74 2069  rovenance" not i
-0000ed80: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
-0000ed90: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-0000eda0: 7461 5b22 636f 6c72 6576 5f6d 6173 7465  ta["colrev_maste
-0000edb0: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
-0000edc0: 225d 203d 207b 7d0a 0a20 2020 2020 2020  "] = {}..       
-0000edd0: 2069 6620 7365 6c66 2e6d 6173 7465 7264   if self.masterd
-0000ede0: 6174 615f 6973 5f63 7572 6174 6564 2829  ata_is_curated()
-0000edf0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000ee00: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
-0000ee10: 4170 706c 7920 7468 6520 6368 6563 6b65  Apply the checke
-0000ee20: 7273 2028 696e 636c 7564 696e 6720 6669  rs (including fi
-0000ee30: 656c 6420 6b65 7920 7265 7175 6972 656d  eld key requirem
-0000ee40: 656e 7473 2065 7463 2e29 0a20 2020 2020  ents etc.).     
-0000ee50: 2020 2071 6d2e 7275 6e28 7265 636f 7264     qm.run(record
-0000ee60: 3d73 656c 6629 0a0a 2020 2020 2020 2020  =self)..        
-0000ee70: 6966 2073 656c 662e 6861 735f 7175 616c  if self.has_qual
-0000ee80: 6974 795f 6465 6665 6374 7328 293a 0a20  ity_defects():. 
-0000ee90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000eea0: 7365 745f 7374 6174 7573 2874 6172 6765  set_status(targe
-0000eeb0: 745f 7374 6174 653d 5265 636f 7264 5374  t_state=RecordSt
-0000eec0: 6174 652e 6d64 5f6e 6565 6473 5f6d 616e  ate.md_needs_man
-0000eed0: 7561 6c5f 7072 6570 6172 6174 696f 6e29  ual_preparation)
-0000eee0: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-0000eef0: 745f 7072 6570 6172 6564 3a0a 2020 2020  t_prepared:.    
-0000ef00: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-0000ef10: 5f73 7461 7475 7328 7461 7267 6574 5f73  _status(target_s
-0000ef20: 7461 7465 3d52 6563 6f72 6453 7461 7465  tate=RecordState
-0000ef30: 2e6d 645f 7072 6570 6172 6564 290a 0a20  .md_prepared).. 
-0000ef40: 2020 2064 6566 2063 6865 636b 5f70 6f74     def check_pot
-0000ef50: 656e 7469 616c 5f72 6574 7261 6374 7328  ential_retracts(
-0000ef60: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
-0000ef70: 2020 2020 2020 2022 2222 4368 6563 6b20         """Check 
-0000ef80: 666f 7220 706f 7465 6e74 6961 6c20 7265  for potential re
-0000ef90: 7472 6163 7473 2222 220a 2020 2020 2020  tracts""".      
-0000efa0: 2020 2320 4e6f 7465 203a 2077 6520 7265    # Note : we re
-0000efb0: 7472 6965 7665 6420 6d65 7461 6461 7461  trieved metadata
-0000efc0: 2069 6e20 6765 745f 6d61 7374 6572 6461   in get_masterda
-0000efd0: 7461 5f66 726f 6d5f 6372 6f73 7372 6566  ta_from_crossref
-0000efe0: 2829 0a20 2020 2020 2020 2069 6620 7365  ().        if se
-0000eff0: 6c66 2e64 6174 612e 6765 7428 2263 726f  lf.data.get("cro
-0000f000: 7373 6d61 726b 222c 2022 2229 203d 3d20  ssmark", "") == 
-0000f010: 2254 7275 6522 3a0a 2020 2020 2020 2020  "True":.        
-0000f020: 2020 2020 7365 6c66 2e70 7265 7363 7265      self.prescre
-0000f030: 656e 5f65 7863 6c75 6465 2872 6561 736f  en_exclude(reaso
-0000f040: 6e3d 2272 6574 7261 6374 6564 222c 2070  n="retracted", p
-0000f050: 7269 6e74 5f77 6172 6e69 6e67 3d54 7275  rint_warning=Tru
-0000f060: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-0000f070: 656c 662e 7265 6d6f 7665 5f66 6965 6c64  elf.remove_field
-0000f080: 286b 6579 3d22 6372 6f73 736d 6172 6b22  (key="crossmark"
-0000f090: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0000f0a0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0000f0b0: 2020 6966 2073 656c 662e 6461 7461 2e67    if self.data.g
-0000f0c0: 6574 2822 7761 726e 696e 6722 2c20 2222  et("warning", ""
-0000f0d0: 2920 3d3d 2022 5769 7468 6472 6177 6e20  ) == "Withdrawn 
-0000f0e0: 2861 6363 6f72 6469 6e67 2074 6f20 4442  (according to DB
-0000f0f0: 4c50 2922 3a0a 2020 2020 2020 2020 2020  LP)":.          
-0000f100: 2020 7365 6c66 2e70 7265 7363 7265 656e    self.prescreen
-0000f110: 5f65 7863 6c75 6465 2872 6561 736f 6e3d  _exclude(reason=
-0000f120: 2272 6574 7261 6374 6564 222c 2070 7269  "retracted", pri
-0000f130: 6e74 5f77 6172 6e69 6e67 3d54 7275 6529  nt_warning=True)
-0000f140: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f150: 662e 7265 6d6f 7665 5f66 6965 6c64 286b  f.remove_field(k
-0000f160: 6579 3d22 7761 726e 696e 6722 290a 2020  ey="warning").  
-0000f170: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000f180: 2054 7275 650a 2020 2020 2020 2020 7265   True.        re
-0000f190: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-0000f1a0: 6465 6620 7072 696e 745f 7072 6573 6372  def print_prescr
-0000f1b0: 6565 6e5f 7265 636f 7264 2873 656c 6629  een_record(self)
-0000f1c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000f1d0: 2020 2222 2250 7269 6e74 2074 6865 2072    """Print the r
-0000f1e0: 6563 6f72 6420 666f 7220 7072 6573 6372  ecord for prescr
-0000f1f0: 6565 6e20 6f70 6572 6174 696f 6e73 2222  een operations""
-0000f200: 220a 0a20 2020 2020 2020 2072 6574 5f73  "..        ret_s
-0000f210: 7472 203d 2066 2220 2049 443a 207b 7365  tr = f"  ID: {se
-0000f220: 6c66 2e64 6174 615b 2749 4427 5d7d 2028  lf.data['ID']} (
-0000f230: 7b73 656c 662e 6461 7461 5b27 454e 5452  {self.data['ENTR
-0000f240: 5954 5950 4527 5d7d 2922 0a20 2020 2020  YTYPE']})".     
-0000f250: 2020 2072 6574 5f73 7472 202b 3d20 280a     ret_str += (.
-0000f260: 2020 2020 2020 2020 2020 2020 6622 5c6e              f"\n
-0000f270: 2020 7b63 6f6c 6f72 732e 4752 4545 4e7d    {colors.GREEN}
-0000f280: 7b73 656c 662e 6461 7461 2e67 6574 2827  {self.data.get('
-0000f290: 7469 746c 6527 2c20 276e 6f20 7469 746c  title', 'no titl
-0000f2a0: 6527 297d 7b63 6f6c 6f72 732e 454e 447d  e')}{colors.END}
-0000f2b0: 220a 2020 2020 2020 2020 2020 2020 6622  ".            f"
-0000f2c0: 5c6e 2020 7b73 656c 662e 6461 7461 2e67  \n  {self.data.g
-0000f2d0: 6574 2827 6175 7468 6f72 272c 2027 6e6f  et('author', 'no
-0000f2e0: 2d61 7574 686f 7227 297d 220a 2020 2020  -author')}".    
-0000f2f0: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-0000f300: 2073 656c 662e 6461 7461 5b22 454e 5452   self.data["ENTR
-0000f310: 5954 5950 4522 5d20 3d3d 2022 6172 7469  YTYPE"] == "arti
-0000f320: 636c 6522 3a0a 2020 2020 2020 2020 2020  cle":.          
-0000f330: 2020 7265 745f 7374 7220 2b3d 2028 0a20    ret_str += (. 
-0000f340: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000f350: 225c 6e20 207b 7365 6c66 2e64 6174 612e  "\n  {self.data.
-0000f360: 6765 7428 276a 6f75 726e 616c 272c 2027  get('journal', '
-0000f370: 6e6f 2d6a 6f75 726e 616c 2729 7d20 220a  no-journal')} ".
-0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f390: 6622 287b 7365 6c66 2e64 6174 612e 6765  f"({self.data.ge
-0000f3a0: 7428 2779 6561 7227 2c20 276e 6f2d 7965  t('year', 'no-ye
-0000f3b0: 6172 2729 7d29 2022 0a20 2020 2020 2020  ar')}) ".       
-0000f3c0: 2020 2020 2020 2020 2066 227b 7365 6c66           f"{self
-0000f3d0: 2e64 6174 612e 6765 7428 2776 6f6c 756d  .data.get('volum
-0000f3e0: 6527 2c20 276e 6f2d 766f 6c75 6d65 2729  e', 'no-volume')
-0000f3f0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0000f400: 2020 2066 2228 7b73 656c 662e 6461 7461     f"({self.data
-0000f410: 2e67 6574 2827 6e75 6d62 6572 272c 2027  .get('number', '
-0000f420: 2729 7d29 220a 2020 2020 2020 2020 2020  ')})".          
-0000f430: 2020 290a 2020 2020 2020 2020 656c 6966    ).        elif
-0000f440: 2073 656c 662e 6461 7461 5b22 454e 5452   self.data["ENTR
-0000f450: 5954 5950 4522 5d20 3d3d 2022 696e 7072  YTYPE"] == "inpr
-0000f460: 6f63 6565 6469 6e67 7322 3a0a 2020 2020  oceedings":.    
-0000f470: 2020 2020 2020 2020 7265 745f 7374 7220          ret_str 
-0000f480: 2b3d 2066 225c 6e20 207b 7365 6c66 2e64  += f"\n  {self.d
-0000f490: 6174 612e 6765 7428 2762 6f6f 6b74 6974  ata.get('booktit
-0000f4a0: 6c65 272c 2027 6e6f 2d62 6f6f 6b74 6974  le', 'no-booktit
-0000f4b0: 6c65 2729 7d22 0a20 2020 2020 2020 2069  le')}".        i
-0000f4c0: 6620 2261 6273 7472 6163 7422 2069 6e20  f "abstract" in 
-0000f4d0: 7365 6c66 2e64 6174 613a 0a20 2020 2020  self.data:.     
-0000f4e0: 2020 2020 2020 206c 696e 6573 203d 2074         lines = t
-0000f4f0: 6578 7477 7261 702e 7772 6170 2873 656c  extwrap.wrap(sel
-0000f500: 662e 6461 7461 5b22 6162 7374 7261 6374  f.data["abstract
-0000f510: 225d 2c20 3130 302c 2062 7265 616b 5f6c  "], 100, break_l
-0000f520: 6f6e 675f 776f 7264 733d 4661 6c73 6529  ong_words=False)
-0000f530: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000f540: 6c69 6e65 733a 0a20 2020 2020 2020 2020  lines:.         
-0000f550: 2020 2020 2020 2072 6574 5f73 7472 202b         ret_str +
-0000f560: 3d20 6622 5c6e 2020 4162 7374 7261 6374  = f"\n  Abstract
-0000f570: 3a20 7b6c 696e 6573 2e70 6f70 2830 297d  : {lines.pop(0)}
-0000f580: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-0000f590: 2020 2020 7265 745f 7374 7220 2b3d 2022      ret_str += "
-0000f5a0: 5c6e 2020 222e 6a6f 696e 286c 696e 6573  \n  ".join(lines
-0000f5b0: 2920 2b20 2222 0a0a 2020 2020 2020 2020  ) + ""..        
-0000f5c0: 6966 2022 7572 6c22 2069 6e20 7365 6c66  if "url" in self
-0000f5d0: 2e64 6174 613a 0a20 2020 2020 2020 2020  .data:.         
-0000f5e0: 2020 2072 6574 5f73 7472 202b 3d20 6622     ret_str += f"
-0000f5f0: 5c6e 2020 7572 6c3a 207b 7365 6c66 2e64  \n  url: {self.d
-0000f600: 6174 615b 2775 726c 275d 7d22 0a0a 2020  ata['url']}"..  
-0000f610: 2020 2020 2020 6966 2022 6669 6c65 2220        if "file" 
-0000f620: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
-0000f630: 2020 2020 2020 2020 2020 7265 745f 7374            ret_st
-0000f640: 7220 2b3d 2066 225c 6e20 2066 696c 653a  r += f"\n  file:
-0000f650: 207b 7365 6c66 2e64 6174 615b 2766 696c   {self.data['fil
-0000f660: 6527 5d7d 220a 0a20 2020 2020 2020 2070  e']}"..        p
-0000f670: 7269 6e74 2872 6574 5f73 7472 290a 0a20  rint(ret_str).. 
-0000f680: 2020 2064 6566 2070 7269 6e74 5f70 6466     def print_pdf
-0000f690: 5f70 7265 705f 6d61 6e28 7365 6c66 2920  _prep_man(self) 
-0000f6a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000f6b0: 2022 2222 5072 696e 7420 7468 6520 7265   """Print the re
-0000f6c0: 636f 7264 2066 6f72 2070 6466 2d70 7265  cord for pdf-pre
-0000f6d0: 702d 6d61 6e20 6f70 6572 6174 696f 6e73  p-man operations
-0000f6e0: 2222 220a 2020 2020 2020 2020 2320 7079  """.        # py
-0000f6f0: 6c69 6e74 3a20 6469 7361 626c 653d 746f  lint: disable=to
-0000f700: 6f2d 6d61 6e79 2d62 7261 6e63 6865 730a  o-many-branches.
-0000f710: 2020 2020 2020 2020 7265 745f 7374 7220          ret_str 
-0000f720: 3d20 2222 0a20 2020 2020 2020 2069 6620  = "".        if 
-0000f730: 2266 696c 6522 2069 6e20 7365 6c66 2e64  "file" in self.d
-0000f740: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-0000f750: 2072 6574 5f73 7472 202b 3d20 6622 5c6e   ret_str += f"\n
-0000f760: 6669 6c65 3a20 7b63 6f6c 6f72 732e 4f52  file: {colors.OR
-0000f770: 414e 4745 7d7b 7365 6c66 2e64 6174 615b  ANGE}{self.data[
-0000f780: 2766 696c 6527 5d7d 7b63 6f6c 6f72 732e  'file']}{colors.
-0000f790: 454e 447d 5c6e 5c6e 220a 0a20 2020 2020  END}\n\n"..     
-0000f7a0: 2020 2070 6466 5f70 7265 705f 6e6f 7465     pdf_prep_note
-0000f7b0: 203d 2073 656c 662e 6765 745f 6669 656c   = self.get_fiel
-0000f7c0: 645f 7072 6f76 656e 616e 6365 286b 6579  d_provenance(key
-0000f7d0: 3d22 6669 6c65 2229 0a0a 2020 2020 2020  ="file")..      
-0000f7e0: 2020 6966 2022 6175 7468 6f72 5f6e 6f74    if "author_not
-0000f7f0: 5f69 6e5f 6669 7273 745f 7061 6765 7322  _in_first_pages"
-0000f800: 2069 6e20 7064 665f 7072 6570 5f6e 6f74   in pdf_prep_not
-0000f810: 655b 226e 6f74 6522 5d3a 0a20 2020 2020  e["note"]:.     
-0000f820: 2020 2020 2020 2072 6574 5f73 7472 202b         ret_str +
-0000f830: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000f840: 2020 2020 6622 7b63 6f6c 6f72 732e 5245      f"{colors.RE
-0000f850: 447d 7b73 656c 662e 6461 7461 2e67 6574  D}{self.data.get
-0000f860: 2827 6175 7468 6f72 272c 2027 6e6f 2d61  ('author', 'no-a
-0000f870: 7574 686f 7227 297d 7b63 6f6c 6f72 732e  uthor')}{colors.
-0000f880: 454e 447d 5c6e 220a 2020 2020 2020 2020  END}\n".        
-0000f890: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-0000f8a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000f8b0: 7265 745f 7374 7220 2b3d 2028 0a20 2020  ret_str += (.   
-0000f8c0: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-0000f8d0: 636f 6c6f 7273 2e47 5245 454e 7d7b 7365  colors.GREEN}{se
-0000f8e0: 6c66 2e64 6174 612e 6765 7428 2761 7574  lf.data.get('aut
-0000f8f0: 686f 7227 2c20 276e 6f2d 6175 7468 6f72  hor', 'no-author
-0000f900: 2729 7d7b 636f 6c6f 7273 2e45 4e44 7d5c  ')}{colors.END}\
-0000f910: 6e22 0a20 2020 2020 2020 2020 2020 2029  n".            )
-0000f920: 0a0a 2020 2020 2020 2020 6966 2022 7469  ..        if "ti
-0000f930: 746c 655f 6e6f 745f 696e 5f66 6972 7374  tle_not_in_first
-0000f940: 5f70 6167 6573 2220 696e 2070 6466 5f70  _pages" in pdf_p
-0000f950: 7265 705f 6e6f 7465 5b22 6e6f 7465 225d  rep_note["note"]
-0000f960: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000f970: 745f 7374 7220 2b3d 2066 227b 636f 6c6f  t_str += f"{colo
-0000f980: 7273 2e52 4544 7d7b 7365 6c66 2e64 6174  rs.RED}{self.dat
-0000f990: 612e 6765 7428 2774 6974 6c65 272c 2027  a.get('title', '
-0000f9a0: 6e6f 2074 6974 6c65 2729 7d7b 636f 6c6f  no title')}{colo
-0000f9b0: 7273 2e45 4e44 7d5c 6e22 0a20 2020 2020  rs.END}\n".     
-0000f9c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000f9d0: 2020 2020 2072 6574 5f73 7472 202b 3d20       ret_str += 
-0000f9e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000f9f0: 2020 6622 7b63 6f6c 6f72 732e 4752 4545    f"{colors.GREE
-0000fa00: 4e7d 7b73 656c 662e 6461 7461 2e67 6574  N}{self.data.get
-0000fa10: 2827 7469 746c 6527 2c20 276e 6f20 7469  ('title', 'no ti
-0000fa20: 746c 6527 297d 7b63 6f6c 6f72 732e 454e  tle')}{colors.EN
-0000fa30: 447d 5c6e 220a 2020 2020 2020 2020 2020  D}\n".          
-0000fa40: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-0000fa50: 7365 6c66 2e64 6174 615b 2245 4e54 5259  self.data["ENTRY
-0000fa60: 5459 5045 225d 203d 3d20 2261 7274 6963  TYPE"] == "artic
-0000fa70: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
-0000fa80: 2072 6574 5f73 7472 202b 3d20 280a 2020   ret_str += (.  
-0000fa90: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000faa0: 7b73 656c 662e 6461 7461 2e67 6574 2827  {self.data.get('
-0000fab0: 6a6f 7572 6e61 6c27 2c20 276e 6f2d 6a6f  journal', 'no-jo
-0000fac0: 7572 6e61 6c27 297d 2022 0a20 2020 2020  urnal')} ".     
-0000fad0: 2020 2020 2020 2020 2020 2066 2228 7b73             f"({s
-0000fae0: 656c 662e 6461 7461 2e67 6574 2827 7965  elf.data.get('ye
-0000faf0: 6172 272c 2027 6e6f 2d79 6561 7227 297d  ar', 'no-year')}
-0000fb00: 2920 220a 2020 2020 2020 2020 2020 2020  ) ".            
-0000fb10: 2020 2020 6622 7b73 656c 662e 6461 7461      f"{self.data
-0000fb20: 2e67 6574 2827 766f 6c75 6d65 272c 2027  .get('volume', '
-0000fb30: 6e6f 2d76 6f6c 756d 6527 297d 220a 2020  no-volume')}".  
-0000fb40: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000fb50: 287b 7365 6c66 2e64 6174 612e 6765 7428  ({self.data.get(
-0000fb60: 276e 756d 6265 7227 2c20 2727 297d 2922  'number', '')})"
-0000fb70: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000fb80: 2020 2020 2020 2020 2020 2069 6620 2270             if "p
-0000fb90: 6167 6573 2220 696e 2073 656c 662e 6461  ages" in self.da
-0000fba0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0000fbb0: 2020 2020 6966 2022 6e72 5f70 6167 6573      if "nr_pages
-0000fbc0: 5f6e 6f74 5f6d 6174 6368 696e 6722 2069  _not_matching" i
-0000fbd0: 6e20 7064 665f 7072 6570 5f6e 6f74 655b  n pdf_prep_note[
-0000fbe0: 226e 6f74 6522 5d3a 0a20 2020 2020 2020  "note"]:.       
-0000fbf0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000fc00: 5f73 7472 202b 3d20 6622 2c20 7b63 6f6c  _str += f", {col
-0000fc10: 6f72 732e 5245 447d 7070 2e7b 7365 6c66  ors.RED}pp.{self
-0000fc20: 2e64 6174 615b 2770 6167 6573 275d 7d7b  .data['pages']}{
-0000fc30: 636f 6c6f 7273 2e45 4e44 7d5c 6e22 0a20  colors.END}\n". 
-0000fc40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000fc50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000fc60: 2020 2020 2020 2020 2072 6574 5f73 7472           ret_str
-0000fc70: 202b 3d20 6622 2c20 7070 2e7b 636f 6c6f   += f", pp.{colo
-0000fc80: 7273 2e47 5245 454e 7d7b 7365 6c66 2e64  rs.GREEN}{self.d
-0000fc90: 6174 615b 2770 6167 6573 275d 7d7b 636f  ata['pages']}{co
-0000fca0: 6c6f 7273 2e45 4e44 7d5c 6e22 0a20 2020  lors.END}\n".   
-0000fcb0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000fcc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000fcd0: 6574 5f73 7472 202b 3d20 225c 6e22 0a20  et_str += "\n". 
-0000fce0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-0000fcf0: 2e64 6174 615b 2245 4e54 5259 5459 5045  .data["ENTRYTYPE
-0000fd00: 225d 203d 3d20 2269 6e70 726f 6365 6564  "] == "inproceed
-0000fd10: 696e 6773 223a 0a20 2020 2020 2020 2020  ings":.         
-0000fd20: 2020 2072 6574 5f73 7472 202b 3d20 6622     ret_str += f"
-0000fd30: 7b73 656c 662e 6461 7461 2e67 6574 2827  {self.data.get('
-0000fd40: 626f 6f6b 7469 746c 6527 2c20 276e 6f2d  booktitle', 'no-
-0000fd50: 626f 6f6b 7469 746c 6527 297d 5c6e 220a  booktitle')}\n".
-0000fd60: 2020 2020 2020 2020 6966 2022 6162 7374          if "abst
-0000fd70: 7261 6374 2220 696e 2073 656c 662e 6461  ract" in self.da
-0000fd80: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0000fd90: 6c69 6e65 7320 3d20 7465 7874 7772 6170  lines = textwrap
-0000fda0: 2e77 7261 7028 7365 6c66 2e64 6174 615b  .wrap(self.data[
-0000fdb0: 2261 6273 7472 6163 7422 5d2c 2031 3030  "abstract"], 100
-0000fdc0: 2c20 6272 6561 6b5f 6c6f 6e67 5f77 6f72  , break_long_wor
-0000fdd0: 6473 3d46 616c 7365 290a 2020 2020 2020  ds=False).      
-0000fde0: 2020 2020 2020 7265 745f 7374 7220 2b3d        ret_str +=
-0000fdf0: 2066 225c 6e41 6273 7472 6163 743a 207b   f"\nAbstract: {
-0000fe00: 6c69 6e65 732e 706f 7028 3029 7d5c 6e22  lines.pop(0)}\n"
-0000fe10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000fe20: 5f73 7472 202b 3d20 225c 6e22 2e6a 6f69  _str += "\n".joi
-0000fe30: 6e28 6c69 6e65 7329 202b 2022 5c6e 220a  n(lines) + "\n".
-0000fe40: 0a20 2020 2020 2020 2069 6620 2275 726c  .        if "url
-0000fe50: 2220 696e 2073 656c 662e 6461 7461 3a0a  " in self.data:.
-0000fe60: 2020 2020 2020 2020 2020 2020 7265 745f              ret_
-0000fe70: 7374 7220 2b3d 2066 225c 6e75 726c 3a20  str += f"\nurl: 
-0000fe80: 7b73 656c 662e 6461 7461 5b27 7572 6c27  {self.data['url'
-0000fe90: 5d7d 5c6e 220a 0a20 2020 2020 2020 2070  ]}\n"..        p
-0000fea0: 7269 6e74 2872 6574 5f73 7472 290a 0a0a  rint(ret_str)...
-0000feb0: 636c 6173 7320 5072 6570 5265 636f 7264  class PrepRecord
-0000fec0: 2852 6563 6f72 6429 3a0a 2020 2020 2222  (Record):.    ""
-0000fed0: 2254 6865 2050 7265 7052 6563 6f72 6420  "The PrepRecord 
-0000fee0: 636c 6173 7320 7072 6f76 6964 6573 2061  class provides a
-0000fef0: 2072 616e 6765 206f 6620 636f 6e76 656e   range of conven
-0000ff00: 6965 6e63 6520 6675 6e63 7469 6f6e 7320  ience functions 
-0000ff10: 666f 7220 7265 636f 7264 2070 7265 7061  for record prepa
-0000ff20: 7261 7469 6f6e 2222 220a 0a20 2020 2040  ration"""..    @
-0000ff30: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0000ff40: 6465 6620 666f 726d 6174 5f61 7574 686f  def format_autho
-0000ff50: 725f 6669 656c 6428 636c 732c 202a 2c20  r_field(cls, *, 
-0000ff60: 696e 7075 745f 7374 7269 6e67 3a20 7374  input_string: st
-0000ff70: 7229 202d 3e20 7374 723a 0a20 2020 2020  r) -> str:.     
-0000ff80: 2020 2022 2222 466f 726d 6174 2074 6865     """Format the
-0000ff90: 2061 7574 686f 7220 6669 656c 6420 2872   author field (r
-0000ffa0: 6563 6f67 6e69 7a69 6e67 2066 6972 7374  ecognizing first
-0000ffb0: 2f6c 6173 7420 6e61 6d65 7320 6261 7365  /last names base
-0000ffc0: 6420 6f6e 2048 756d 616e 4e61 6d65 2070  d on HumanName p
-0000ffd0: 6172 7365 7229 2222 220a 0a20 2020 2020  arser)"""..     
-0000ffe0: 2020 2064 6566 206d 6f73 746c 795f 7570     def mostly_up
-0000fff0: 7065 725f 6361 7365 2869 6e70 7574 5f73  per_case(input_s
-00010000: 7472 696e 673a 2073 7472 2920 2d3e 2062  tring: str) -> b
-00010010: 6f6f 6c3a 0a20 2020 2020 2020 2020 2020  ool:.           
-00010020: 2069 6620 6e6f 7420 7265 2e6d 6174 6368   if not re.match
-00010030: 2872 225b 612d 7a41 2d5a 5d2b 222c 2069  (r"[a-zA-Z]+", i
-00010040: 6e70 7574 5f73 7472 696e 6729 3a0a 2020  nput_string):.  
-00010050: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00010060: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00010070: 2020 2020 2020 2069 6e70 7574 5f73 7472         input_str
-00010080: 696e 6720 3d20 696e 7075 745f 7374 7269  ing = input_stri
-00010090: 6e67 2e72 6570 6c61 6365 2822 2e22 2c20  ng.replace(".", 
-000100a0: 2222 292e 7265 706c 6163 6528 222c 222c  "").replace(",",
-000100b0: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
-000100c0: 2077 6f72 6473 203d 2069 6e70 7574 5f73   words = input_s
-000100d0: 7472 696e 672e 7370 6c69 7428 290a 2020  tring.split().  
-000100e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000100f0: 2073 756d 2877 6f72 642e 6973 7570 7065   sum(word.isuppe
-00010100: 7228 2920 666f 7220 776f 7264 2069 6e20  r() for word in 
-00010110: 776f 7264 7329 202f 206c 656e 2877 6f72  words) / len(wor
-00010120: 6473 2920 3e20 302e 380a 0a20 2020 2020  ds) > 0.8..     
-00010130: 2020 2069 6e70 7574 5f73 7472 696e 6720     input_string 
-00010140: 3d20 696e 7075 745f 7374 7269 6e67 2e72  = input_string.r
-00010150: 6570 6c61 6365 2822 5c6e 222c 2022 2022  eplace("\n", " "
-00010160: 290a 2020 2020 2020 2020 2320 4442 4c50  ).        # DBLP
-00010170: 2061 7070 656e 6473 2069 6465 6e74 6966   appends identif
-00010180: 6965 7273 2074 6f20 6e6f 6e2d 756e 6971  iers to non-uniq
-00010190: 7565 2061 7574 686f 7273 0a20 2020 2020  ue authors.     
-000101a0: 2020 2069 6e70 7574 5f73 7472 696e 6720     input_string 
-000101b0: 3d20 7374 7228 7265 2e73 7562 2872 225b  = str(re.sub(r"[
-000101c0: 302d 395d 7b34 7d22 2c20 2222 2c20 696e  0-9]{4}", "", in
-000101d0: 7075 745f 7374 7269 6e67 2929 0a0a 2020  put_string))..  
-000101e0: 2020 2020 2020 6966 2022 2061 6e64 2022        if " and "
-000101f0: 2069 6e20 696e 7075 745f 7374 7269 6e67   in input_string
-00010200: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
-00010210: 6d65 7320 3d20 696e 7075 745f 7374 7269  mes = input_stri
-00010220: 6e67 2e73 706c 6974 2822 2061 6e64 2022  ng.split(" and "
-00010230: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-00010240: 6e70 7574 5f73 7472 696e 672e 636f 756e  nput_string.coun
-00010250: 7428 222c 2229 203e 2031 3a0a 2020 2020  t(",") > 1:.    
-00010260: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
-00010270: 696e 7075 745f 7374 7269 6e67 2e73 706c  input_string.spl
-00010280: 6974 2822 2c20 2229 0a20 2020 2020 2020  it(", ").       
-00010290: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000102a0: 2020 206e 616d 6573 203d 205b 696e 7075     names = [inpu
-000102b0: 745f 7374 7269 6e67 5d0a 2020 2020 2020  t_string].      
-000102c0: 2020 6175 7468 6f72 5f73 7472 696e 6720    author_string 
-000102d0: 3d20 2222 0a20 2020 2020 2020 2066 6f72  = "".        for
-000102e0: 206e 616d 6520 696e 206e 616d 6573 3a0a   name in names:.
-000102f0: 2020 2020 2020 2020 2020 2020 2320 4e6f              # No
-00010300: 7465 3a20 6874 7470 733a 2f2f 6769 7468  te: https://gith
-00010310: 7562 2e63 6f6d 2f64 6572 656b 3733 2f70  ub.com/derek73/p
-00010320: 7974 686f 6e2d 6e61 6d65 7061 7273 6572  ython-nameparser
-00010330: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-00010340: 7320 7665 7279 2065 6666 6563 7469 7665  s very effective
-00010350: 2028 6d61 7962 6520 6e6f 7420 7065 7266   (maybe not perf
-00010360: 6563 7429 0a0a 2020 2020 2020 2020 2020  ect)..          
-00010370: 2020 7061 7273 6564 5f6e 616d 6520 3d20    parsed_name = 
-00010380: 4875 6d61 6e4e 616d 6528 6e61 6d65 290a  HumanName(name).
-00010390: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-000103a0: 6f73 746c 795f 7570 7065 725f 6361 7365  ostly_upper_case
-000103b0: 2869 6e70 7574 5f73 7472 696e 672e 7265  (input_string.re
-000103c0: 706c 6163 6528 2220 616e 6420 222c 2022  place(" and ", "
-000103d0: 2229 2e72 6570 6c61 6365 2822 4a72 222c  ").replace("Jr",
-000103e0: 2022 2229 293a 0a20 2020 2020 2020 2020   "")):.         
-000103f0: 2020 2020 2020 2070 6172 7365 645f 6e61         parsed_na
-00010400: 6d65 2e63 6170 6974 616c 697a 6528 666f  me.capitalize(fo
-00010410: 7263 653d 5472 7565 290a 0a20 2020 2020  rce=True)..     
-00010420: 2020 2020 2020 2023 2046 6978 2074 7970         # Fix typ
-00010430: 6963 616c 2070 6172 7365 7220 6572 726f  ical parser erro
-00010440: 720a 2020 2020 2020 2020 2020 2020 6966  r.            if
-00010450: 2070 6172 7365 645f 6e61 6d65 2e6c 6173   parsed_name.las
-00010460: 7420 3d3d 2022 2220 616e 6420 7061 7273  t == "" and pars
-00010470: 6564 5f6e 616d 652e 7469 746c 6520 213d  ed_name.title !=
-00010480: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00010490: 2020 2020 2070 6172 7365 645f 6e61 6d65       parsed_name
-000104a0: 2e6c 6173 7420 3d20 7061 7273 6564 5f6e  .last = parsed_n
-000104b0: 616d 652e 7469 746c 650a 0a20 2020 2020  ame.title..     
-000104c0: 2020 2020 2020 2023 2070 796c 696e 743a         # pylint:
-000104d0: 2064 6973 6162 6c65 3d63 6861 696e 6564   disable=chained
-000104e0: 2d63 6f6d 7061 7269 736f 6e0a 2020 2020  -comparison.    
-000104f0: 2020 2020 2020 2020 2320 4669 783a 2077          # Fix: w
-00010500: 6865 6e20 6669 7273 7420 6e61 6d65 7320  hen first names 
-00010510: 6172 6520 6162 6272 6576 6961 7465 642c  are abbreviated,
-00010520: 206e 616d 6570 6172 7365 7220 6372 6561   nameparser crea
-00010530: 7465 7320 6572 726f 7273 3a0a 2020 2020  tes errors:.    
-00010540: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00010550: 2020 2020 2020 2020 2020 2020 206c 656e               len
-00010560: 2870 6172 7365 645f 6e61 6d65 2e6c 6173  (parsed_name.las
-00010570: 7429 203c 3d20 330a 2020 2020 2020 2020  t) <= 3.        
-00010580: 2020 2020 2020 2020 616e 6420 7061 7273          and pars
-00010590: 6564 5f6e 616d 652e 6c61 7374 2e69 7375  ed_name.last.isu
-000105a0: 7070 6572 2829 0a20 2020 2020 2020 2020  pper().         
-000105b0: 2020 2020 2020 2061 6e64 206c 656e 2870         and len(p
-000105c0: 6172 7365 645f 6e61 6d65 2e66 6972 7374  arsed_name.first
-000105d0: 2920 3e20 330a 2020 2020 2020 2020 2020  ) > 3.          
-000105e0: 2020 2020 2020 616e 6420 6e6f 7420 7061        and not pa
-000105f0: 7273 6564 5f6e 616d 652e 6669 7273 742e  rsed_name.first.
-00010600: 6973 7570 7065 7228 290a 2020 2020 2020  isupper().      
-00010610: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00010620: 2020 2020 2020 2020 2023 2069 6e20 7468           # in th
-00010630: 6573 6520 6361 7365 6573 2c20 6669 7273  ese casees, firs
-00010640: 7420 616e 6420 6c61 7374 206e 616d 6573  t and last names
-00010650: 2061 7265 2063 6f6e 6675 7365 640a 2020   are confused.  
-00010660: 2020 2020 2020 2020 2020 2020 2020 6175                au
-00010670: 7468 6f72 5f6e 616d 655f 7374 7269 6e67  thor_name_string
-00010680: 203d 2070 6172 7365 645f 6e61 6d65 2e66   = parsed_name.f
-00010690: 6972 7374 202b 2022 2c20 2220 2b20 7061  irst + ", " + pa
-000106a0: 7273 6564 5f6e 616d 652e 6c61 7374 0a20  rsed_name.last. 
-000106b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000106c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000106d0: 2070 6172 7365 645f 6e61 6d65 2e73 7472   parsed_name.str
-000106e0: 696e 675f 666f 726d 6174 203d 2022 7b6c  ing_format = "{l
-000106f0: 6173 747d 207b 7375 6666 6978 7d2c 207b  ast} {suffix}, {
-00010700: 6669 7273 747d 207b 6d69 6464 6c65 7d22  first} {middle}"
-00010710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010720: 2023 2027 7b6c 6173 747d 207b 7375 6666   # '{last} {suff
-00010730: 6978 7d2c 207b 6669 7273 747d 2028 7b6e  ix}, {first} ({n
-00010740: 6963 6b6e 616d 657d 2920 7b6d 6964 646c  ickname}) {middl
-00010750: 657d 270a 2020 2020 2020 2020 2020 2020  e}'.            
-00010760: 2020 2020 6175 7468 6f72 5f6e 616d 655f      author_name_
-00010770: 7374 7269 6e67 203d 2073 7472 2870 6172  string = str(par
-00010780: 7365 645f 6e61 6d65 292e 7265 706c 6163  sed_name).replac
-00010790: 6528 2220 2c20 222c 2022 2c20 2229 0a20  e(" , ", ", "). 
-000107a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000107b0: 204e 6f74 653a 2074 6865 7265 2061 7265   Note: there are
-000107c0: 2065 7272 6f72 7320 666f 7220 7468 6520   errors for the 
-000107d0: 666f 6c6c 6f77 696e 6720 6175 7468 6f72  following author
-000107e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000107f0: 2020 2320 4a52 2043 726f 6d77 656c 6c20    # JR Cromwell 
-00010800: 616e 6420 484b 2047 6172 646e 6572 0a20  and HK Gardner. 
-00010810: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00010820: 2054 6865 204a 5220 6973 2070 726f 6261   The JR is proba
-00010830: 626c 7920 7265 636f 676e 697a 6564 2061  bly recognized a
-00010840: 7320 4a75 6e69 6f72 2e0a 2020 2020 2020  s Junior..      
-00010850: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-00010860: 6b20 7768 6574 6865 7220 7468 6973 2069  k whether this i
-00010870: 7320 6669 7865 6420 696e 2074 6865 2047  s fixed in the G
-00010880: 726f 6269 6420 6e61 6d65 2070 6172 7365  robid name parse
-00010890: 720a 0a20 2020 2020 2020 2020 2020 2069  r..            i
-000108a0: 6620 6175 7468 6f72 5f73 7472 696e 6720  f author_string 
-000108b0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-000108c0: 2020 2020 2020 2061 7574 686f 725f 7374         author_st
-000108d0: 7269 6e67 203d 2061 7574 686f 725f 6e61  ring = author_na
-000108e0: 6d65 5f73 7472 696e 670a 2020 2020 2020  me_string.      
-000108f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010900: 2020 2020 2020 2020 2020 2020 6175 7468              auth
-00010910: 6f72 5f73 7472 696e 6720 3d20 6175 7468  or_string = auth
-00010920: 6f72 5f73 7472 696e 6720 2b20 2220 616e  or_string + " an
-00010930: 6420 2220 2b20 6175 7468 6f72 5f6e 616d  d " + author_nam
-00010940: 655f 7374 7269 6e67 0a0a 2020 2020 2020  e_string..      
-00010950: 2020 7265 7475 726e 2061 7574 686f 725f    return author_
-00010960: 7374 7269 6e67 0a0a 2020 2020 4063 6c61  string..    @cla
-00010970: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00010980: 205f 5f66 6f72 6d61 745f 6175 7468 6f72   __format_author
-00010990: 735f 7374 7269 6e67 5f66 6f72 5f63 6f6d  s_string_for_com
-000109a0: 7061 7269 736f 6e28 636c 732c 202a 2c20  parison(cls, *, 
-000109b0: 7265 636f 7264 3a20 5265 636f 7264 2920  record: Record) 
-000109c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000109d0: 2069 6620 2261 7574 686f 7222 206e 6f74   if "author" not
-000109e0: 2069 6e20 7265 636f 7264 2e64 6174 613a   in record.data:
-000109f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00010a00: 7572 6e0a 2020 2020 2020 2020 6175 7468  urn.        auth
-00010a10: 6f72 7320 3d20 7265 636f 7264 2e64 6174  ors = record.dat
-00010a20: 615b 2261 7574 686f 7222 5d0a 2020 2020  a["author"].    
-00010a30: 2020 2020 6175 7468 6f72 7320 3d20 7374      authors = st
-00010a40: 7228 6175 7468 6f72 7329 2e6c 6f77 6572  r(authors).lower
-00010a50: 2829 0a20 2020 2020 2020 2061 7574 686f  ().        autho
-00010a60: 7273 5f73 7472 696e 6720 3d20 2222 0a20  rs_string = "". 
-00010a70: 2020 2020 2020 2061 7574 686f 7273 203d         authors =
-00010a80: 2063 6f6c 7265 762e 656e 762e 7574 696c   colrev.env.util
-00010a90: 732e 7265 6d6f 7665 5f61 6363 656e 7473  s.remove_accents
-00010aa0: 2869 6e70 7574 5f73 7472 3d61 7574 686f  (input_str=autho
-00010ab0: 7273 290a 0a20 2020 2020 2020 2023 2061  rs)..        # a
-00010ac0: 6262 7265 7669 6174 6520 6669 7273 7420  bbreviate first 
-00010ad0: 6e61 6d65 730a 2020 2020 2020 2020 2320  names.        # 
-00010ae0: 2257 6562 7374 6572 2c20 4a61 6e65 2220  "Webster, Jane" 
-00010af0: 2d3e 2022 5765 6273 7465 722c 204a 220a  -> "Webster, J".
-00010b00: 2020 2020 2020 2020 2320 616c 736f 2072          # also r
-00010b10: 656d 6f76 6520 616c 6c20 7370 6563 6961  emove all specia
-00010b20: 6c20 6368 6172 6163 7465 7273 2061 6e64  l characters and
-00010b30: 2064 6f20 6e6f 7420 696e 636c 7564 6520   do not include 
-00010b40: 7365 7061 7261 746f 7273 2028 616e 6429  separators (and)
-00010b50: 0a20 2020 2020 2020 2066 6f72 2061 7574  .        for aut
-00010b60: 686f 7220 696e 2061 7574 686f 7273 2e73  hor in authors.s
-00010b70: 706c 6974 2822 2061 6e64 2022 293a 0a20  plit(" and "):. 
-00010b80: 2020 2020 2020 2020 2020 2069 6620 222c             if ",
-00010b90: 2220 696e 2061 7574 686f 723a 0a20 2020  " in author:.   
-00010ba0: 2020 2020 2020 2020 2020 2020 206c 6173               las
-00010bb0: 745f 6e61 6d65 7320 3d20 5b0a 2020 2020  t_names = [.    
-00010bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bd0: 776f 7264 5b30 5d20 666f 7220 776f 7264  word[0] for word
-00010be0: 2069 6e20 6175 7468 6f72 2e73 706c 6974   in author.split
-00010bf0: 2822 2c22 295b 315d 2e73 706c 6974 2822  (",")[1].split("
-00010c00: 2022 2920 6966 206c 656e 2877 6f72 6429   ") if len(word)
-00010c10: 203e 2030 0a20 2020 2020 2020 2020 2020   > 0.           
-00010c20: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
-00010c30: 2020 2020 2020 2061 7574 686f 7273 5f73         authors_s
-00010c40: 7472 696e 6720 3d20 280a 2020 2020 2020  tring = (.      
-00010c50: 2020 2020 2020 2020 2020 2020 2020 6175                au
-00010c60: 7468 6f72 735f 7374 7269 6e67 0a20 2020  thors_string.   
-00010c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c80: 202b 2061 7574 686f 722e 7370 6c69 7428   + author.split(
-00010c90: 222c 2229 5b30 5d0a 2020 2020 2020 2020  ",")[0].        
-00010ca0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-00010cb0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00010cc0: 2020 2020 2020 2b20 2220 222e 6a6f 696e        + " ".join
-00010cd0: 286c 6173 745f 6e61 6d65 7329 0a20 2020  (last_names).   
-00010ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cf0: 202b 2022 2022 0a20 2020 2020 2020 2020   + " ".         
-00010d00: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00010d10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00010d20: 2020 2020 2020 2020 2020 2061 7574 686f             autho
-00010d30: 7273 5f73 7472 696e 6720 3d20 6175 7468  rs_string = auth
-00010d40: 6f72 735f 7374 7269 6e67 202b 2061 7574  ors_string + aut
-00010d50: 686f 7220 2b20 2220 220a 2020 2020 2020  hor + " ".      
-00010d60: 2020 6175 7468 6f72 735f 7374 7269 6e67    authors_string
-00010d70: 203d 2072 652e 7375 6228 7222 5b5e 412d   = re.sub(r"[^A-
-00010d80: 5a61 2d7a 302d 392c 205d 2b22 2c20 2222  Za-z0-9, ]+", ""
-00010d90: 2c20 6175 7468 6f72 735f 7374 7269 6e67  , authors_string
-00010da0: 2e72 7374 7269 7028 2929 0a20 2020 2020  .rstrip()).     
-00010db0: 2020 2072 6563 6f72 642e 6461 7461 5b22     record.data["
-00010dc0: 6175 7468 6f72 225d 203d 2061 7574 686f  author"] = autho
-00010dd0: 7273 5f73 7472 696e 670a 0a20 2020 2064  rs_string..    d
-00010de0: 6566 2063 6f6e 7461 696e 6572 5f69 735f  ef container_is_
-00010df0: 6162 6272 6576 6961 7465 6428 7365 6c66  abbreviated(self
-00010e00: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-00010e10: 2020 2022 2222 4368 6563 6b20 7768 6574     """Check whet
-00010e20: 6865 7220 7468 6520 636f 6e74 6169 6e65  her the containe
-00010e30: 7220 7469 746c 6520 6973 2061 6262 7265  r title is abbre
-00010e40: 7669 6174 6564 2222 220a 2020 2020 2020  viated""".      
-00010e50: 2020 6966 2022 6a6f 7572 6e61 6c22 2069    if "journal" i
-00010e60: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
-00010e70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00010e80: 2e64 6174 615b 226a 6f75 726e 616c 225d  .data["journal"]
-00010e90: 2e63 6f75 6e74 2822 2e22 2920 3e20 323a  .count(".") > 2:
-00010ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010eb0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-00010ec0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00010ed0: 2e64 6174 615b 226a 6f75 726e 616c 225d  .data["journal"]
-00010ee0: 2e69 7375 7070 6572 2829 3a0a 2020 2020  .isupper():.    
-00010ef0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00010f00: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
-00010f10: 6966 2022 626f 6f6b 7469 746c 6522 2069  if "booktitle" i
-00010f20: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
-00010f30: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00010f40: 2e64 6174 615b 2262 6f6f 6b74 6974 6c65  .data["booktitle
-00010f50: 225d 2e63 6f75 6e74 2822 2e22 2920 3e20  "].count(".") > 
-00010f60: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00010f70: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-00010f80: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00010f90: 6c66 2e64 6174 615b 2262 6f6f 6b74 6974  lf.data["booktit
-00010fa0: 6c65 225d 2e69 7375 7070 6572 2829 3a0a  le"].isupper():.
-00010fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fc0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
-00010fd0: 2020 2020 2320 6164 6420 6865 7572 6973      # add heuris
-00010fe0: 7469 6373 3f20 2865 2e67 2e2c 2048 6177  tics? (e.g., Haw
-00010ff0: 6169 6920 496e 7420 436f 6e66 2053 7973  aii Int Conf Sys
-00011000: 7420 5363 6929 0a20 2020 2020 2020 2072  t Sci).        r
-00011010: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-00011020: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00011030: 2020 6465 6620 5f5f 6162 6272 6576 6961    def __abbrevia
-00011040: 7465 5f63 6f6e 7461 696e 6572 5f74 6974  te_container_tit
-00011050: 6c65 7328 0a20 2020 2020 2020 2063 6c73  les(.        cls
-00011060: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
-00011070: 2020 2020 2072 6563 6f72 643a 2063 6f6c       record: col
-00011080: 7265 762e 7265 636f 7264 2e50 7265 7052  rev.record.PrepR
-00011090: 6563 6f72 642c 0a20 2020 2020 2020 2072  ecord,.        r
-000110a0: 6574 7269 6576 6564 5f72 6563 6f72 643a  etrieved_record:
-000110b0: 2063 6f6c 7265 762e 7265 636f 7264 2e50   colrev.record.P
-000110c0: 7265 7052 6563 6f72 642c 0a20 2020 2029  repRecord,.    )
-000110d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000110e0: 2020 6465 6620 6162 6272 6576 6961 7465    def abbreviate
-000110f0: 5f63 6f6e 7461 696e 6572 282a 2c20 7265  _container(*, re
-00011100: 636f 7264 3a20 636f 6c72 6576 2e72 6563  cord: colrev.rec
-00011110: 6f72 642e 5265 636f 7264 2c20 6d69 6e5f  ord.Record, min_
-00011120: 6c65 6e3a 2069 6e74 2920 2d3e 204e 6f6e  len: int) -> Non
-00011130: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00011140: 6620 226a 6f75 726e 616c 2220 696e 2072  f "journal" in r
-00011150: 6563 6f72 642e 6461 7461 3a0a 2020 2020  ecord.data:.    
-00011160: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00011170: 7264 2e64 6174 615b 226a 6f75 726e 616c  rd.data["journal
-00011180: 225d 203d 2022 2022 2e6a 6f69 6e28 0a20  "] = " ".join(. 
-00011190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111a0: 2020 205b 785b 3a6d 696e 5f6c 656e 5d20     [x[:min_len] 
-000111b0: 666f 7220 7820 696e 2072 6563 6f72 642e  for x in record.
-000111c0: 6461 7461 5b22 6a6f 7572 6e61 6c22 5d2e  data["journal"].
-000111d0: 7370 6c69 7428 2220 2229 5d0a 2020 2020  split(" ")].    
-000111e0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-000111f0: 2020 2020 2020 2064 6566 2067 6574 5f61         def get_a
-00011200: 6262 7265 765f 636f 6e74 6169 6e65 725f  bbrev_container_
-00011210: 6d69 6e5f 6c65 6e28 2a2c 2072 6563 6f72  min_len(*, recor
-00011220: 643a 2063 6f6c 7265 762e 7265 636f 7264  d: colrev.record
-00011230: 2e52 6563 6f72 6429 202d 3e20 696e 743a  .Record) -> int:
-00011240: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-00011250: 5f6c 656e 203d 202d 310a 2020 2020 2020  _len = -1.      
-00011260: 2020 2020 2020 6966 2022 6a6f 7572 6e61        if "journa
-00011270: 6c22 2069 6e20 7265 636f 7264 2e64 6174  l" in record.dat
-00011280: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-00011290: 2020 206d 696e 5f6c 656e 203d 206d 696e     min_len = min
-000112a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000112b0: 2020 2020 2020 6c65 6e28 7829 2066 6f72        len(x) for
-000112c0: 2078 2069 6e20 7265 636f 7264 2e64 6174   x in record.dat
-000112d0: 615b 226a 6f75 726e 616c 225d 2e72 6570  a["journal"].rep
-000112e0: 6c61 6365 2822 2e22 2c20 2222 292e 7370  lace(".", "").sp
-000112f0: 6c69 7428 2220 2229 0a20 2020 2020 2020  lit(" ").       
-00011300: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00011310: 2020 2020 2020 2069 6620 2262 6f6f 6b74         if "bookt
-00011320: 6974 6c65 2220 696e 2072 6563 6f72 642e  itle" in record.
-00011330: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-00011340: 2020 2020 2020 6d69 6e5f 6c65 6e20 3d20        min_len = 
-00011350: 6d69 6e28 0a20 2020 2020 2020 2020 2020  min(.           
-00011360: 2020 2020 2020 2020 206c 656e 2878 2920           len(x) 
-00011370: 666f 7220 7820 696e 2072 6563 6f72 642e  for x in record.
-00011380: 6461 7461 5b22 626f 6f6b 7469 746c 6522  data["booktitle"
-00011390: 5d2e 7265 706c 6163 6528 222e 222c 2022  ].replace(".", "
-000113a0: 2229 2e73 706c 6974 2822 2022 290a 2020  ").split(" ").  
-000113b0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000113c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000113d0: 726e 206d 696e 5f6c 656e 0a0a 2020 2020  rn min_len..    
-000113e0: 2020 2020 6966 2072 6563 6f72 642e 636f      if record.co
-000113f0: 6e74 6169 6e65 725f 6973 5f61 6262 7265  ntainer_is_abbre
-00011400: 7669 6174 6564 2829 3a0a 2020 2020 2020  viated():.      
-00011410: 2020 2020 2020 6d69 6e5f 6c65 6e20 3d20        min_len = 
-00011420: 6765 745f 6162 6272 6576 5f63 6f6e 7461  get_abbrev_conta
-00011430: 696e 6572 5f6d 696e 5f6c 656e 2872 6563  iner_min_len(rec
-00011440: 6f72 643d 7265 636f 7264 290a 2020 2020  ord=record).    
-00011450: 2020 2020 2020 2020 6162 6272 6576 6961          abbrevia
-00011460: 7465 5f63 6f6e 7461 696e 6572 2872 6563  te_container(rec
-00011470: 6f72 643d 7265 7472 6965 7665 645f 7265  ord=retrieved_re
-00011480: 636f 7264 2c20 6d69 6e5f 6c65 6e3d 6d69  cord, min_len=mi
-00011490: 6e5f 6c65 6e29 0a20 2020 2020 2020 2020  n_len).         
-000114a0: 2020 2061 6262 7265 7669 6174 655f 636f     abbreviate_co
-000114b0: 6e74 6169 6e65 7228 7265 636f 7264 3d72  ntainer(record=r
-000114c0: 6563 6f72 642c 206d 696e 5f6c 656e 3d6d  ecord, min_len=m
-000114d0: 696e 5f6c 656e 290a 2020 2020 2020 2020  in_len).        
-000114e0: 6966 2072 6574 7269 6576 6564 5f72 6563  if retrieved_rec
-000114f0: 6f72 642e 636f 6e74 6169 6e65 725f 6973  ord.container_is
-00011500: 5f61 6262 7265 7669 6174 6564 2829 3a0a  _abbreviated():.
-00011510: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-00011520: 6c65 6e20 3d20 6765 745f 6162 6272 6576  len = get_abbrev
-00011530: 5f63 6f6e 7461 696e 6572 5f6d 696e 5f6c  _container_min_l
-00011540: 656e 2872 6563 6f72 643d 7265 7472 6965  en(record=retrie
-00011550: 7665 645f 7265 636f 7264 290a 2020 2020  ved_record).    
-00011560: 2020 2020 2020 2020 6162 6272 6576 6961          abbrevia
-00011570: 7465 5f63 6f6e 7461 696e 6572 2872 6563  te_container(rec
-00011580: 6f72 643d 7265 636f 7264 2c20 6d69 6e5f  ord=record, min_
-00011590: 6c65 6e3d 6d69 6e5f 6c65 6e29 0a20 2020  len=min_len).   
-000115a0: 2020 2020 2020 2020 2061 6262 7265 7669           abbrevi
-000115b0: 6174 655f 636f 6e74 6169 6e65 7228 7265  ate_container(re
-000115c0: 636f 7264 3d72 6574 7269 6576 6564 5f72  cord=retrieved_r
-000115d0: 6563 6f72 642c 206d 696e 5f6c 656e 3d6d  ecord, min_len=m
-000115e0: 696e 5f6c 656e 290a 0a20 2020 2040 636c  in_len)..    @cl
-000115f0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00011600: 6620 5f5f 7072 6570 5f72 6563 6f72 6473  f __prep_records
-00011610: 5f66 6f72 5f73 696d 696c 6172 6974 7928  _for_similarity(
-00011620: 0a20 2020 2020 2020 2063 6c73 2c0a 2020  .        cls,.  
-00011630: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
-00011640: 2072 6563 6f72 643a 2063 6f6c 7265 762e   record: colrev.
-00011650: 7265 636f 7264 2e50 7265 7052 6563 6f72  record.PrepRecor
-00011660: 642c 0a20 2020 2020 2020 2072 6574 7269  d,.        retri
-00011670: 6576 6564 5f72 6563 6f72 643a 2063 6f6c  eved_record: col
-00011680: 7265 762e 7265 636f 7264 2e50 7265 7052  rev.record.PrepR
-00011690: 6563 6f72 642c 0a20 2020 2029 202d 3e20  ecord,.    ) -> 
-000116a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 636c  None:.        cl
-000116b0: 732e 5f5f 6162 6272 6576 6961 7465 5f63  s.__abbreviate_c
-000116c0: 6f6e 7461 696e 6572 5f74 6974 6c65 7328  ontainer_titles(
-000116d0: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-000116e0: 6f72 643d 7265 636f 7264 2c20 7265 7472  ord=record, retr
-000116f0: 6965 7665 645f 7265 636f 7264 3d72 6574  ieved_record=ret
-00011700: 7269 6576 6564 5f72 6563 6f72 640a 2020  rieved_record.  
-00011710: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00011720: 2069 6620 2274 6974 6c65 2220 696e 2072   if "title" in r
-00011730: 6563 6f72 642e 6461 7461 3a0a 2020 2020  ecord.data:.    
-00011740: 2020 2020 2020 2020 7265 636f 7264 2e64          record.d
-00011750: 6174 615b 2274 6974 6c65 225d 203d 2072  ata["title"] = r
-00011760: 6563 6f72 642e 6461 7461 5b22 7469 746c  ecord.data["titl
-00011770: 6522 5d5b 3a39 305d 0a20 2020 2020 2020  e"][:90].       
-00011780: 2069 6620 2274 6974 6c65 2220 696e 2072   if "title" in r
-00011790: 6574 7269 6576 6564 5f72 6563 6f72 642e  etrieved_record.
-000117a0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-000117b0: 2020 7265 7472 6965 7665 645f 7265 636f    retrieved_reco
-000117c0: 7264 2e64 6174 615b 2274 6974 6c65 225d  rd.data["title"]
-000117d0: 203d 2072 6574 7269 6576 6564 5f72 6563   = retrieved_rec
-000117e0: 6f72 642e 6461 7461 5b22 7469 746c 6522  ord.data["title"
-000117f0: 5d5b 3a39 305d 0a0a 2020 2020 2020 2020  ][:90]..        
-00011800: 6966 2022 6175 7468 6f72 2220 696e 2072  if "author" in r
-00011810: 6563 6f72 642e 6461 7461 3a0a 2020 2020  ecord.data:.    
-00011820: 2020 2020 2020 2020 636c 732e 5f5f 666f          cls.__fo
-00011830: 726d 6174 5f61 7574 686f 7273 5f73 7472  rmat_authors_str
-00011840: 696e 675f 666f 725f 636f 6d70 6172 6973  ing_for_comparis
-00011850: 6f6e 2872 6563 6f72 643d 7265 636f 7264  on(record=record
-00011860: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00011870: 636f 7264 2e64 6174 615b 2261 7574 686f  cord.data["autho
-00011880: 7222 5d20 3d20 7265 636f 7264 2e64 6174  r"] = record.dat
-00011890: 615b 2261 7574 686f 7222 5d5b 3a34 355d  a["author"][:45]
-000118a0: 0a20 2020 2020 2020 2069 6620 2261 7574  .        if "aut
-000118b0: 686f 7222 2069 6e20 7265 7472 6965 7665  hor" in retrieve
-000118c0: 645f 7265 636f 7264 2e64 6174 613a 0a20  d_record.data:. 
-000118d0: 2020 2020 2020 2020 2020 2063 6c73 2e5f             cls._
-000118e0: 5f66 6f72 6d61 745f 6175 7468 6f72 735f  _format_authors_
-000118f0: 7374 7269 6e67 5f66 6f72 5f63 6f6d 7061  string_for_compa
-00011900: 7269 736f 6e28 7265 636f 7264 3d72 6574  rison(record=ret
-00011910: 7269 6576 6564 5f72 6563 6f72 6429 0a20  rieved_record). 
-00011920: 2020 2020 2020 2020 2020 2072 6574 7269             retri
-00011930: 6576 6564 5f72 6563 6f72 642e 6461 7461  eved_record.data
-00011940: 5b22 6175 7468 6f72 225d 203d 2072 6574  ["author"] = ret
-00011950: 7269 6576 6564 5f72 6563 6f72 642e 6461  rieved_record.da
-00011960: 7461 5b22 6175 7468 6f72 225d 5b3a 3435  ta["author"][:45
-00011970: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
-00011980: 2028 2276 6f6c 756d 6522 2069 6e20 7265   ("volume" in re
-00011990: 636f 7264 2e64 6174 6120 616e 6420 2276  cord.data and "v
-000119a0: 6f6c 756d 6522 2069 6e20 7265 7472 6965  olume" in retrie
-000119b0: 7665 645f 7265 636f 7264 2e64 6174 6129  ved_record.data)
-000119c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000119d0: 636f 7264 2e64 6174 615b 2276 6f6c 756d  cord.data["volum
-000119e0: 6522 5d20 3d20 226e 616e 220a 2020 2020  e"] = "nan".    
-000119f0: 2020 2020 2020 2020 7265 7472 6965 7665          retrieve
-00011a00: 645f 7265 636f 7264 2e64 6174 615b 2276  d_record.data["v
-00011a10: 6f6c 756d 6522 5d20 3d20 226e 616e 220a  olume"] = "nan".
-00011a20: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
-00011a30: 226e 756d 6265 7222 2069 6e20 7265 636f  "number" in reco
-00011a40: 7264 2e64 6174 6120 616e 6420 226e 756d  rd.data and "num
-00011a50: 6265 7222 2069 6e20 7265 7472 6965 7665  ber" in retrieve
-00011a60: 645f 7265 636f 7264 2e64 6174 6129 3a0a  d_record.data):.
-00011a70: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00011a80: 7264 2e64 6174 615b 226e 756d 6265 7222  rd.data["number"
-00011a90: 5d20 3d20 226e 616e 220a 2020 2020 2020  ] = "nan".      
-00011aa0: 2020 2020 2020 7265 7472 6965 7665 645f        retrieved_
-00011ab0: 7265 636f 7264 2e64 6174 615b 226e 756d  record.data["num
-00011ac0: 6265 7222 5d20 3d20 226e 616e 220a 2020  ber"] = "nan".  
-00011ad0: 2020 2020 2020 6966 206e 6f74 2028 2270        if not ("p
-00011ae0: 6167 6573 2220 696e 2072 6563 6f72 642e  ages" in record.
-00011af0: 6461 7461 2061 6e64 2022 7061 6765 7322  data and "pages"
-00011b00: 2069 6e20 7265 7472 6965 7665 645f 7265   in retrieved_re
-00011b10: 636f 7264 2e64 6174 6129 3a0a 2020 2020  cord.data):.    
-00011b20: 2020 2020 2020 2020 7265 636f 7264 2e64          record.d
-00011b30: 6174 615b 2270 6167 6573 225d 203d 2022  ata["pages"] = "
-00011b40: 6e61 6e22 0a20 2020 2020 2020 2020 2020  nan".           
-00011b50: 2072 6574 7269 6576 6564 5f72 6563 6f72   retrieved_recor
-00011b60: 642e 6461 7461 5b22 7061 6765 7322 5d20  d.data["pages"] 
-00011b70: 3d20 226e 616e 220a 2020 2020 2020 2020  = "nan".        
-00011b80: 2320 536f 6d65 7469 6d65 732c 2074 6865  # Sometimes, the
-00011b90: 206e 756d 6265 7220 6f66 2070 6167 6573   number of pages
-00011ba0: 2069 7320 7072 6f76 6964 6564 2028 6e6f   is provided (no
-00011bb0: 7420 7468 6520 7261 6e67 6529 0a20 2020  t the range).   
-00011bc0: 2020 2020 2065 6c69 6620 6e6f 7420 280a       elif not (.
-00011bd0: 2020 2020 2020 2020 2020 2020 222d 2d22              "--"
-00011be0: 2069 6e20 7265 636f 7264 2e64 6174 615b   in record.data[
-00011bf0: 2270 6167 6573 225d 2061 6e64 2022 2d2d  "pages"] and "--
-00011c00: 2220 696e 2072 6574 7269 6576 6564 5f72  " in retrieved_r
-00011c10: 6563 6f72 642e 6461 7461 5b22 7061 6765  ecord.data["page
-00011c20: 7322 5d0a 2020 2020 2020 2020 293a 0a20  s"].        ):. 
-00011c30: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-00011c40: 642e 6461 7461 5b22 7061 6765 7322 5d20  d.data["pages"] 
-00011c50: 3d20 226e 616e 220a 2020 2020 2020 2020  = "nan".        
-00011c60: 2020 2020 7265 7472 6965 7665 645f 7265      retrieved_re
-00011c70: 636f 7264 2e64 6174 615b 2270 6167 6573  cord.data["pages
-00011c80: 225d 203d 2022 6e61 6e22 0a0a 2020 2020  "] = "nan"..    
-00011c90: 2020 2020 6966 2022 7965 6172 2220 696e      if "year" in
-00011ca0: 2072 6563 6f72 642e 6461 7461 2061 6e64   record.data and
-00011cb0: 2022 7965 6172 2220 696e 2072 6574 7269   "year" in retri
-00011cc0: 6576 6564 5f72 6563 6f72 642e 6461 7461  eved_record.data
-00011cd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00011ce0: 2072 6563 6f72 642e 6461 7461 5b22 7965   record.data["ye
-00011cf0: 6172 225d 203d 3d20 2266 6f72 7468 636f  ar"] == "forthco
-00011d00: 6d69 6e67 223a 0a20 2020 2020 2020 2020  ming":.         
-00011d10: 2020 2020 2020 2072 6563 6f72 642e 6461         record.da
-00011d20: 7461 5b22 7965 6172 225d 203d 2072 6574  ta["year"] = ret
-00011d30: 7269 6576 6564 5f72 6563 6f72 642e 6461  rieved_record.da
-00011d40: 7461 5b22 7965 6172 225d 0a20 2020 2020  ta["year"].     
-00011d50: 2020 2020 2020 2069 6620 7265 7472 6965         if retrie
-00011d60: 7665 645f 7265 636f 7264 2e64 6174 615b  ved_record.data[
-00011d70: 2279 6561 7222 5d20 3d3d 2022 666f 7274  "year"] == "fort
-00011d80: 6863 6f6d 696e 6722 3a0a 2020 2020 2020  hcoming":.      
-00011d90: 2020 2020 2020 2020 2020 7265 7472 6965            retrie
-00011da0: 7665 645f 7265 636f 7264 2e64 6174 615b  ved_record.data[
-00011db0: 2279 6561 7222 5d20 3d20 7265 636f 7264  "year"] = record
-00011dc0: 2e64 6174 615b 2279 6561 7222 5d0a 0a20  .data["year"].. 
-00011dd0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00011de0: 2020 2020 6465 6620 6765 745f 7265 7472      def get_retr
-00011df0: 6965 7661 6c5f 7369 6d69 6c61 7269 7479  ieval_similarity
-00011e00: 280a 2020 2020 2020 2020 636c 732c 0a20  (.        cls,. 
-00011e10: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
-00011e20: 2020 7265 636f 7264 5f6f 7269 6769 6e61    record_origina
-00011e30: 6c3a 2052 6563 6f72 642c 0a20 2020 2020  l: Record,.     
-00011e40: 2020 2072 6574 7269 6576 6564 5f72 6563     retrieved_rec
-00011e50: 6f72 645f 6f72 6967 696e 616c 3a20 5265  ord_original: Re
-00011e60: 636f 7264 2c0a 2020 2020 2020 2020 7361  cord,.        sa
-00011e70: 6d65 5f72 6563 6f72 645f 7479 7065 5f72  me_record_type_r
-00011e80: 6571 7569 7265 643a 2062 6f6f 6c20 3d20  equired: bool = 
-00011e90: 5472 7565 2c0a 2020 2020 2920 2d3e 2066  True,.    ) -> f
-00011ea0: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
-00011eb0: 2247 6574 2074 6865 2072 6574 7269 6576  "Get the retriev
-00011ec0: 616c 2073 696d 696c 6172 6974 7920 6265  al similarity be
-00011ed0: 7477 6565 6e20 7468 6520 7265 636f 7264  tween the record
-00011ee0: 2061 6e64 2061 2072 6574 7269 6576 6564   and a retrieved
-00011ef0: 2072 6563 6f72 6422 2222 0a0a 2020 2020   record"""..    
-00011f00: 2020 2020 6966 2073 616d 655f 7265 636f      if same_reco
-00011f10: 7264 5f74 7970 655f 7265 7175 6972 6564  rd_type_required
-00011f20: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00011f30: 2072 6563 6f72 645f 6f72 6967 696e 616c   record_original
-00011f40: 2e64 6174 612e 6765 7428 0a20 2020 2020  .data.get(.     
-00011f50: 2020 2020 2020 2020 2020 2022 454e 5452             "ENTR
-00011f60: 5954 5950 4522 2c20 2261 220a 2020 2020  YTYPE", "a".    
-00011f70: 2020 2020 2020 2020 2920 213d 2072 6574          ) != ret
-00011f80: 7269 6576 6564 5f72 6563 6f72 645f 6f72  rieved_record_or
-00011f90: 6967 696e 616c 2e64 6174 612e 6765 7428  iginal.data.get(
-00011fa0: 2245 4e54 5259 5459 5045 222c 2022 6222  "ENTRYTYPE", "b"
-00011fb0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00011fc0: 2020 2072 6574 7572 6e20 302e 300a 0a20     return 0.0.. 
-00011fd0: 2020 2020 2020 2072 6563 6f72 6420 3d20         record = 
-00011fe0: 7265 636f 7264 5f6f 7269 6769 6e61 6c2e  record_original.
-00011ff0: 636f 7079 5f70 7265 705f 7265 6328 290a  copy_prep_rec().
-00012000: 2020 2020 2020 2020 7265 7472 6965 7665          retrieve
-00012010: 645f 7265 636f 7264 203d 2072 6574 7269  d_record = retri
-00012020: 6576 6564 5f72 6563 6f72 645f 6f72 6967  eved_record_orig
-00012030: 696e 616c 2e63 6f70 795f 7072 6570 5f72  inal.copy_prep_r
-00012040: 6563 2829 0a0a 2020 2020 2020 2020 636c  ec()..        cl
-00012050: 732e 5f5f 7072 6570 5f72 6563 6f72 6473  s.__prep_records
-00012060: 5f66 6f72 5f73 696d 696c 6172 6974 7928  _for_similarity(
-00012070: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-00012080: 6f72 643d 7265 636f 7264 2c20 7265 7472  ord=record, retr
-00012090: 6965 7665 645f 7265 636f 7264 3d72 6574  ieved_record=ret
-000120a0: 7269 6576 6564 5f72 6563 6f72 640a 2020  rieved_record.  
-000120b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000120c0: 2069 6620 2265 6469 746f 7269 616c 2220   if "editorial" 
-000120d0: 696e 2072 6563 6f72 642e 6461 7461 2e67  in record.data.g
-000120e0: 6574 2822 7469 746c 6522 2c20 224e 4122  et("title", "NA"
-000120f0: 292e 6c6f 7765 7228 293a 0a20 2020 2020  ).lower():.     
-00012100: 2020 2020 2020 2069 6620 6e6f 7420 616c         if not al
-00012110: 6c28 7820 696e 2072 6563 6f72 642e 6461  l(x in record.da
-00012120: 7461 2066 6f72 2078 2069 6e20 5b22 766f  ta for x in ["vo
-00012130: 6c75 6d65 222c 2022 6e75 6d62 6572 225d  lume", "number"]
-00012140: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00012150: 2020 2072 6574 7572 6e20 302e 300a 0a20     return 0.0.. 
-00012160: 2020 2020 2020 2073 696d 696c 6172 6974         similarit
-00012170: 7920 3d20 5265 636f 7264 2e67 6574 5f72  y = Record.get_r
-00012180: 6563 6f72 645f 7369 6d69 6c61 7269 7479  ecord_similarity
-00012190: 280a 2020 2020 2020 2020 2020 2020 7265  (.            re
-000121a0: 636f 7264 5f61 3d72 6563 6f72 642c 2072  cord_a=record, r
-000121b0: 6563 6f72 645f 623d 7265 7472 6965 7665  ecord_b=retrieve
-000121c0: 645f 7265 636f 7264 0a20 2020 2020 2020  d_record.       
-000121d0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-000121e0: 6e20 7369 6d69 6c61 7269 7479 0a0a 2020  n similarity..  
-000121f0: 2020 6465 6620 666f 726d 6174 5f69 665f    def format_if_
-00012200: 6d6f 7374 6c79 5f75 7070 6572 2873 656c  mostly_upper(sel
-00012210: 662c 202a 2c20 6b65 793a 2073 7472 2c20  f, *, key: str, 
-00012220: 6361 7365 3a20 7374 7220 3d20 2263 6170  case: str = "cap
-00012230: 6974 616c 697a 6522 2920 2d3e 204e 6f6e  italize") -> Non
-00012240: 653a 0a20 2020 2020 2020 2022 2222 466f  e:.        """Fo
-00012250: 726d 6174 2074 6865 2066 6965 6c64 2069  rmat the field i
-00012260: 6620 6974 2069 7320 6d6f 7374 6c79 2069  f it is mostly i
-00012270: 6e20 7570 7065 7220 6361 7365 2222 220a  n upper case""".
-00012280: 2020 2020 2020 2020 2320 6966 206e 6f74          # if not
-00012290: 2072 652e 6d61 7463 6828 7222 5e5b 612d   re.match(r"^[a-
-000122a0: 7a41 2d5a 5c22 5c7b 5c7d 205d 2b24 222c  zA-Z\"\{\} ]+$",
-000122b0: 2073 656c 662e 6461 7461 5b6b 6579 5d29   self.data[key])
-000122c0: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-000122d0: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
-000122e0: 6620 6b65 7920 6e6f 7420 696e 2073 656c  f key not in sel
-000122f0: 662e 6461 7461 206f 7220 7365 6c66 2e64  f.data or self.d
-00012300: 6174 615b 6b65 795d 203d 3d20 2255 4e4b  ata[key] == "UNK
-00012310: 4e4f 574e 223a 0a20 2020 2020 2020 2020  NOWN":.         
-00012320: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-00012330: 2020 7365 6c66 2e64 6174 615b 6b65 795d    self.data[key]
-00012340: 203d 2073 656c 662e 6461 7461 5b6b 6579   = self.data[key
-00012350: 5d2e 7265 706c 6163 6528 225c 6e22 2c20  ].replace("\n", 
-00012360: 2220 2229 0a0a 2020 2020 2020 2020 6966  " ")..        if
-00012370: 2063 6f6c 7265 762e 656e 762e 7574 696c   colrev.env.util
-00012380: 732e 7065 7263 656e 745f 7570 7065 725f  s.percent_upper_
-00012390: 6368 6172 7328 7365 6c66 2e64 6174 615b  chars(self.data[
-000123a0: 6b65 795d 2920 3e20 302e 383a 0a20 2020  key]) > 0.8:.   
-000123b0: 2020 2020 2020 2020 2069 6620 6361 7365           if case
-000123c0: 203d 3d20 2263 6170 6974 616c 697a 6522   == "capitalize"
-000123d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000123e0: 2020 7365 6c66 2e64 6174 615b 6b65 795d    self.data[key]
-000123f0: 203d 2073 656c 662e 6461 7461 5b6b 6579   = self.data[key
-00012400: 5d2e 6361 7069 7461 6c69 7a65 2829 0a20  ].capitalize(). 
-00012410: 2020 2020 2020 2020 2020 2069 6620 6361             if ca
-00012420: 7365 203d 3d20 2274 6974 6c65 223a 0a20  se == "title":. 
-00012430: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012440: 656c 662e 6461 7461 5b6b 6579 5d20 3d20  elf.data[key] = 
-00012450: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00012460: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-00012470: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
-00012480: 2020 2020 2020 2020 202e 7469 746c 6528           .title(
-00012490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000124a0: 2020 2020 2020 2e72 6570 6c61 6365 2822        .replace("
-000124b0: 204f 6620 222c 2022 206f 6620 2229 0a20   Of ", " of "). 
-000124c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124d0: 2020 202e 7265 706c 6163 6528 2220 466f     .replace(" Fo
-000124e0: 7220 222c 2022 2066 6f72 2022 290a 2020  r ", " for ").  
-000124f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012500: 2020 2e72 6570 6c61 6365 2822 2054 6865    .replace(" The
-00012510: 2022 2c20 2220 7468 6520 2229 0a20 2020   ", " the ").   
-00012520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012530: 202e 7265 706c 6163 6528 2249 6565 6522   .replace("Ieee"
-00012540: 2c20 2249 4545 4522 290a 2020 2020 2020  , "IEEE").      
-00012550: 2020 2020 2020 2020 2020 2020 2020 2e72                .r
-00012560: 6570 6c61 6365 2822 4163 6d22 2c20 2241  eplace("Acm", "A
-00012570: 434d 2229 0a20 2020 2020 2020 2020 2020  CM").           
-00012580: 2020 2020 2020 2020 202e 7265 706c 6163           .replac
-00012590: 6528 2220 416e 6420 222c 2022 2061 6e64  e(" And ", " and
-000125a0: 2022 290a 2020 2020 2020 2020 2020 2020   ").            
-000125b0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-000125c0: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
-000125d0: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
-000125e0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-000125f0: 6f76 656e 616e 6365 222c 207b 7d29 3a0a  ovenance", {}):.
-00012600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012610: 6e6f 7465 203d 2073 656c 662e 6461 7461  note = self.data
-00012620: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
-00012630: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-00012640: 5b6b 6579 5d5b 226e 6f74 6522 5d0a 2020  [key]["note"].  
-00012650: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00012660: 2022 7175 616c 6974 795f 6465 6665 6374   "quality_defect
-00012670: 2220 696e 206e 6f74 653a 0a20 2020 2020  " in note:.     
-00012680: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012690: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-000126a0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-000126b0: 656e 616e 6365 225d 5b6b 6579 5d5b 0a20  enance"][key][. 
-000126c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126d0: 2020 2020 2020 2022 6e6f 7465 220a 2020         "note".  
-000126e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126f0: 2020 5d20 3d20 6e6f 7465 2e72 6570 6c61    ] = note.repla
-00012700: 6365 2822 7175 616c 6974 795f 6465 6665  ce("quality_defe
-00012710: 6374 222c 2022 2229 0a0a 2020 2020 6465  ct", "")..    de
-00012720: 6620 7265 6e61 6d65 5f66 6965 6c64 735f  f rename_fields_
-00012730: 6261 7365 645f 6f6e 5f6d 6170 7069 6e67  based_on_mapping
-00012740: 2873 656c 662c 202a 2c20 6d61 7070 696e  (self, *, mappin
-00012750: 673a 2064 6963 7429 202d 3e20 4e6f 6e65  g: dict) -> None
-00012760: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
-00012770: 7665 6e69 656e 6365 2066 756e 6374 696f  venience functio
-00012780: 6e20 666f 7220 7468 6520 7072 6570 2073  n for the prep s
-00012790: 6372 6970 7473 2028 746f 2072 656e 616d  cripts (to renam
-000127a0: 6520 6669 656c 6473 2922 2222 0a0a 2020  e fields)"""..  
-000127b0: 2020 2020 2020 6d61 7070 696e 6720 3d20        mapping = 
-000127c0: 7b6b 2e6c 6f77 6572 2829 3a20 762e 6c6f  {k.lower(): v.lo
-000127d0: 7765 7228 2920 666f 7220 6b2c 2076 2069  wer() for k, v i
-000127e0: 6e20 6d61 7070 696e 672e 6974 656d 7328  n mapping.items(
-000127f0: 297d 0a20 2020 2020 2020 2070 7269 6f72  )}.        prior
-00012800: 5f6b 6579 7320 3d20 6c69 7374 2873 656c  _keys = list(sel
-00012810: 662e 6461 7461 2e6b 6579 7328 2929 0a20  f.data.keys()). 
-00012820: 2020 2020 2020 2023 204e 6f74 6520 3a20         # Note : 
-00012830: 7761 726e 696e 673a 2064 6f20 6e6f 7420  warning: do not 
-00012840: 6372 6561 7465 2061 206e 6577 2064 6963  create a new dic
-00012850: 742e 0a20 2020 2020 2020 2066 6f72 206b  t..        for k
-00012860: 6579 2069 6e20 7072 696f 725f 6b65 7973  ey in prior_keys
-00012870: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00012880: 206b 6579 2e6c 6f77 6572 2829 2069 6e20   key.lower() in 
-00012890: 6d61 7070 696e 673a 0a20 2020 2020 2020  mapping:.       
-000128a0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-000128b0: 6e61 6d65 5f66 6965 6c64 286b 6579 3d6b  name_field(key=k
-000128c0: 6579 2c20 6e65 775f 6b65 793d 6d61 7070  ey, new_key=mapp
-000128d0: 696e 675b 6b65 792e 6c6f 7765 7228 295d  ing[key.lower()]
-000128e0: 290a 0a20 2020 2064 6566 2075 6e69 6679  )..    def unify
-000128f0: 5f70 6167 6573 5f66 6965 6c64 2873 656c  _pages_field(sel
-00012900: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00012910: 2020 2020 2222 2255 6e69 6679 2074 6865      """Unify the
-00012920: 2066 6f72 6d61 7420 6f66 2074 6865 2070   format of the p
-00012930: 6167 6520 6669 656c 6422 2222 0a20 2020  age field""".   
-00012940: 2020 2020 2069 6620 2270 6167 6573 2220       if "pages" 
-00012950: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
-00012960: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00012970: 7475 726e 0a20 2020 2020 2020 2069 6620  turn.        if 
-00012980: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
-00012990: 656c 662e 6461 7461 5b22 7061 6765 7322  elf.data["pages"
-000129a0: 5d2c 2073 7472 293a 0a20 2020 2020 2020  ], str):.       
-000129b0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-000129c0: 2020 2020 6966 2031 203d 3d20 7365 6c66      if 1 == self
-000129d0: 2e64 6174 615b 2270 6167 6573 225d 2e63  .data["pages"].c
-000129e0: 6f75 6e74 2822 2d22 293a 0a20 2020 2020  ount("-"):.     
-000129f0: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-00012a00: 5b22 7061 6765 7322 5d20 3d20 7365 6c66  ["pages"] = self
-00012a10: 2e64 6174 615b 2270 6167 6573 225d 2e72  .data["pages"].r
-00012a20: 6570 6c61 6365 2822 2d22 2c20 222d 2d22  eplace("-", "--"
-00012a30: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
-00012a40: 6174 615b 2270 6167 6573 225d 203d 2028  ata["pages"] = (
-00012a50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00012a60: 662e 6461 7461 5b22 7061 6765 7322 5d0a  f.data["pages"].
-00012a70: 2020 2020 2020 2020 2020 2020 2e72 6570              .rep
-00012a80: 6c61 6365 2822 e280 9322 2c20 222d 2d22  lace("...", "--"
-00012a90: 290a 2020 2020 2020 2020 2020 2020 2e72  ).            .r
-00012aa0: 6570 6c61 6365 2822 2d2d 2d2d 222c 2022  eplace("----", "
-00012ab0: 2d2d 2229 0a20 2020 2020 2020 2020 2020  --").           
-00012ac0: 202e 7265 706c 6163 6528 2220 2d2d 2022   .replace(" -- "
-00012ad0: 2c20 222d 2d22 290a 2020 2020 2020 2020  , "--").        
-00012ae0: 2020 2020 2e72 7374 7269 7028 222e 2229      .rstrip(".")
-00012af0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00012b00: 6465 6620 7072 6570 6172 6174 696f 6e5f  def preparation_
-00012b10: 7361 7665 5f63 6f6e 6469 7469 6f6e 2873  save_condition(s
-00012b20: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
-00012b30: 2020 2020 2020 2222 2243 6865 636b 2077        """Check w
-00012b40: 6865 7468 6572 2074 6865 2073 6176 6520  hether the save 
-00012b50: 636f 6e64 6974 696f 6e20 666f 7220 7468  condition for th
-00012b60: 6520 7072 6570 206f 7065 7261 7469 6f6e  e prep operation
-00012b70: 2069 7320 6769 7665 6e22 2222 0a0a 2020   is given"""..  
-00012b80: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
-00012b90: 7461 2e67 6574 2822 636f 6c72 6576 5f73  ta.get("colrev_s
-00012ba0: 7461 7475 7322 2c20 224e 4122 2920 696e  tatus", "NA") in
-00012bb0: 205b 0a20 2020 2020 2020 2020 2020 2052   [.            R
-00012bc0: 6563 6f72 6453 7461 7465 2e72 6576 5f70  ecordState.rev_p
-00012bd0: 7265 7363 7265 656e 5f65 7863 6c75 6465  rescreen_exclude
-00012be0: 642c 0a20 2020 2020 2020 2020 2020 2052  d,.            R
-00012bf0: 6563 6f72 6453 7461 7465 2e6d 645f 7072  ecordState.md_pr
-00012c00: 6570 6172 6564 2c0a 2020 2020 2020 2020  epared,.        
-00012c10: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
-00012c20: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-00012c30: 2020 2020 6966 2061 6e79 280a 2020 2020      if any(.    
-00012c40: 2020 2020 2020 2020 2264 6973 6167 7265          "disagre
-00012c50: 656d 656e 7420 7769 7468 2022 2069 6e20  ement with " in 
-00012c60: 785b 226e 6f74 6522 5d0a 2020 2020 2020  x["note"].      
-00012c70: 2020 2020 2020 666f 7220 7820 696e 2073        for x in s
-00012c80: 656c 662e 6461 7461 2e67 6574 2822 636f  elf.data.get("co
-00012c90: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-00012ca0: 7072 6f76 656e 616e 6365 222c 207b 7d29  provenance", {})
-00012cb0: 2e76 616c 7565 7328 290a 2020 2020 2020  .values().      
-00012cc0: 2020 2920 6f72 2061 6e79 280a 2020 2020    ) or any(.    
-00012cd0: 2020 2020 2020 2020 2272 6563 6f72 645f          "record_
-00012ce0: 6e6f 745f 696e 5f74 6f63 2220 696e 2078  not_in_toc" in x
-00012cf0: 5b22 6e6f 7465 225d 0a20 2020 2020 2020  ["note"].       
-00012d00: 2020 2020 2066 6f72 2078 2069 6e20 7365       for x in se
-00012d10: 6c66 2e64 6174 612e 6765 7428 2263 6f6c  lf.data.get("col
-00012d20: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00012d30: 726f 7665 6e61 6e63 6522 2c20 7b7d 292e  rovenance", {}).
-00012d40: 7661 6c75 6573 2829 0a20 2020 2020 2020  values().       
-00012d50: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00012d60: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
-00012d70: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00012d80: 650a 0a20 2020 2064 6566 2070 7265 7061  e..    def prepa
-00012d90: 7261 7469 6f6e 5f62 7265 616b 5f63 6f6e  ration_break_con
-00012da0: 6469 7469 6f6e 2873 656c 6629 202d 3e20  dition(self) -> 
-00012db0: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
-00012dc0: 2243 6865 636b 2077 6865 7468 6572 2074  "Check whether t
-00012dd0: 6865 2062 7265 616b 2063 6f6e 6469 7469  he break conditi
-00012de0: 6f6e 2066 6f72 2074 6865 2070 7265 7020  on for the prep 
-00012df0: 6f70 6572 6174 696f 6e20 6973 2067 6976  operation is giv
-00012e00: 656e 2222 220a 2020 2020 2020 2020 6966  en""".        if
-00012e10: 2061 6e79 280a 2020 2020 2020 2020 2020   any(.          
-00012e20: 2020 2264 6973 6167 7265 656d 656e 7420    "disagreement 
-00012e30: 7769 7468 2022 2069 6e20 785b 226e 6f74  with " in x["not
-00012e40: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-00012e50: 666f 7220 7820 696e 2073 656c 662e 6461  for x in self.da
-00012e60: 7461 2e67 6574 2822 636f 6c72 6576 5f6d  ta.get("colrev_m
-00012e70: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-00012e80: 616e 6365 222c 207b 7d29 2e76 616c 7565  ance", {}).value
-00012e90: 7328 290a 2020 2020 2020 2020 2920 6f72  s().        ) or
-00012ea0: 2061 6e79 280a 2020 2020 2020 2020 2020   any(.          
-00012eb0: 2020 2272 6563 6f72 645f 6e6f 745f 696e    "record_not_in
-00012ec0: 5f74 6f63 2220 696e 2078 5b22 6e6f 7465  _toc" in x["note
-00012ed0: 225d 0a20 2020 2020 2020 2020 2020 2066  "].            f
-00012ee0: 6f72 2078 2069 6e20 7365 6c66 2e64 6174  or x in self.dat
-00012ef0: 612e 6765 7428 2263 6f6c 7265 765f 6d61  a.get("colrev_ma
-00012f00: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-00012f10: 6e63 6522 2c20 7b7d 292e 7661 6c75 6573  nce", {}).values
-00012f20: 2829 0a20 2020 2020 2020 2029 3a0a 2020  ().        ):.  
-00012f30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012f40: 2054 7275 650a 0a20 2020 2020 2020 2069   True..        i
-00012f50: 6620 7365 6c66 2e64 6174 612e 6765 7428  f self.data.get(
-00012f60: 2263 6f6c 7265 765f 7374 6174 7573 222c  "colrev_status",
-00012f70: 2022 4e41 2229 2069 6e20 5b0a 2020 2020   "NA") in [.    
-00012f80: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
-00012f90: 6174 652e 7265 765f 7072 6573 6372 6565  ate.rev_prescree
-00012fa0: 6e5f 6578 636c 7564 6564 2c0a 2020 2020  n_excluded,.    
-00012fb0: 2020 2020 5d3a 0a20 2020 2020 2020 2020      ]:.         
-00012fc0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-00012fd0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00012fe0: 6c73 650a 0a20 2020 2064 6566 2073 7461  lse..    def sta
-00012ff0: 7475 735f 746f 5f70 7265 7061 7265 2873  tus_to_prepare(s
-00013000: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
-00013010: 2020 2020 2020 2222 2243 6865 636b 2077        """Check w
-00013020: 6865 7468 6572 2074 6865 2072 6563 6f72  hether the recor
-00013030: 6420 6e65 6564 7320 746f 2062 6520 7072  d needs to be pr
-00013040: 6570 6172 6564 2222 220a 2020 2020 2020  epared""".      
-00013050: 2020 7265 7475 726e 2073 656c 662e 6461    return self.da
-00013060: 7461 2e67 6574 2822 636f 6c72 6576 5f73  ta.get("colrev_s
-00013070: 7461 7475 7322 2c20 224e 4122 2920 696e  tatus", "NA") in
-00013080: 205b 0a20 2020 2020 2020 2020 2020 2052   [.            R
-00013090: 6563 6f72 6453 7461 7465 2e6d 645f 6e65  ecordState.md_ne
-000130a0: 6564 735f 6d61 6e75 616c 5f70 7265 7061  eds_manual_prepa
-000130b0: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
-000130c0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-000130d0: 6d64 5f69 6d70 6f72 7465 642c 0a20 2020  md_imported,.   
-000130e0: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
-000130f0: 7461 7465 2e6d 645f 7072 6570 6172 6564  tate.md_prepared
-00013100: 2c0a 2020 2020 2020 2020 5d0a 0a20 2020  ,.        ]..   
-00013110: 2064 6566 2075 7064 6174 655f 6d65 7461   def update_meta
-00013120: 6461 7461 5f73 7461 7475 7328 0a20 2020  data_status(.   
-00013130: 2020 2020 2073 656c 662c 0a20 2020 2029       self,.    )
-00013140: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00013150: 2020 2222 2255 7064 6174 6520 7468 6520    """Update the 
-00013160: 6d65 7461 6461 7461 2073 7461 7475 7320  metadata status 
-00013170: 2872 6574 7261 6374 732c 2069 6e63 6f6d  (retracts, incom
-00013180: 706c 6574 656e 6573 732c 2069 6e63 6f6e  pleteness, incon
-00013190: 7369 7374 656e 6369 6573 2c20 6574 632e  sistencies, etc.
-000131a0: 290a 2020 2020 2020 2020 616e 6420 7365  ).        and se
-000131b0: 7474 696e 6720 7468 6520 7374 6174 7573  tting the status
-000131c0: 2061 6363 6f72 6469 6e67 6c79 2222 220a   accordingly""".
-000131d0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-000131e0: 6563 6b5f 706f 7465 6e74 6961 6c5f 7265  eck_potential_re
-000131f0: 7472 6163 7473 2829 0a0a 2020 2020 2020  tracts()..      
-00013200: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00013210: 2020 2063 6f6c 7265 762e 7265 636f 7264     colrev.record
-00013220: 2e52 6563 6f72 6453 7461 7465 2e72 6576  .RecordState.rev
-00013230: 5f70 7265 7363 7265 656e 5f65 7863 6c75  _prescreen_exclu
-00013240: 6465 640a 2020 2020 2020 2020 2020 2020  ded.            
-00013250: 3d3d 2073 656c 662e 6461 7461 5b22 636f  == self.data["co
-00013260: 6c72 6576 5f73 7461 7475 7322 5d0a 2020  lrev_status"].  
-00013270: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00013280: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-00013290: 2020 2020 2069 6620 7365 6c66 2e6d 6173       if self.mas
-000132a0: 7465 7264 6174 615f 6973 5f63 7572 6174  terdata_is_curat
-000132b0: 6564 2829 3a0a 2020 2020 2020 2020 2020  ed():.          
-000132c0: 2020 7365 6c66 2e73 6574 5f73 7461 7475    self.set_statu
-000132d0: 7328 7461 7267 6574 5f73 7461 7465 3d52  s(target_state=R
-000132e0: 6563 6f72 6453 7461 7465 2e6d 645f 7072  ecordState.md_pr
-000132f0: 6570 6172 6564 290a 2020 2020 2020 2020  epared).        
-00013300: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00013310: 2020 2020 6966 2073 656c 662e 6861 735f      if self.has_
-00013320: 7175 616c 6974 795f 6465 6665 6374 7328  quality_defects(
-00013330: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00013340: 656c 662e 7365 745f 7374 6174 7573 2874  elf.set_status(t
-00013350: 6172 6765 745f 7374 6174 653d 5265 636f  arget_state=Reco
-00013360: 7264 5374 6174 652e 6d64 5f6e 6565 6473  rdState.md_needs
-00013370: 5f6d 616e 7561 6c5f 7072 6570 6172 6174  _manual_preparat
-00013380: 696f 6e29 0a20 2020 2020 2020 2065 6c73  ion).        els
-00013390: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-000133a0: 656c 662e 7365 745f 7374 6174 7573 2874  elf.set_status(t
-000133b0: 6172 6765 745f 7374 6174 653d 5265 636f  arget_state=Reco
-000133c0: 7264 5374 6174 652e 6d64 5f70 7265 7061  rdState.md_prepa
-000133d0: 7265 6429 0a0a 0a63 6c61 7373 2052 6563  red)...class Rec
-000133e0: 6f72 6453 7461 7465 2845 6e75 6d29 3a0a  ordState(Enum):.
-000133f0: 2020 2020 2222 2254 6865 2070 6f73 7369      """The possi
-00013400: 626c 6520 5265 636f 7264 5374 6174 6573  ble RecordStates
-00013410: 2073 746f 7265 6420 696e 2074 6865 2063   stored in the c
-00013420: 6f6c 7265 765f 7374 6174 7573 2066 6965  olrev_status fie
-00013430: 6c64 0a20 2020 2028 636f 7272 6573 706f  ld.    (correspo
-00013440: 6e64 696e 6720 746f 2074 6865 2052 6563  nding to the Rec
-00013450: 6f72 6453 7461 7465 4d6f 6465 6c29 2222  ordStateModel)""
-00013460: 220a 0a20 2020 2023 2070 796c 696e 743a  "..    # pylint:
-00013470: 2064 6973 6162 6c65 3d69 6e76 616c 6964   disable=invalid
-00013480: 2d6e 616d 650a 0a20 2020 2023 2077 6974  -name..    # wit
-00013490: 686f 7574 2074 6865 206d 645f 7265 7472  hout the md_retr
-000134a0: 6965 7665 6420 7374 6174 652c 2077 6520  ieved state, we 
-000134b0: 636f 756c 6420 6e6f 7420 6469 7370 6c61  could not displa
-000134c0: 7920 7468 6520 6c6f 6164 2074 7261 6e73  y the load trans
-000134d0: 6974 696f 6e0a 2020 2020 6d64 5f72 6574  ition.    md_ret
-000134e0: 7269 6576 6564 203d 2031 0a20 2020 2022  rieved = 1.    "
-000134f0: 2222 5265 636f 7264 2069 7320 7265 7472  ""Record is retr
-00013500: 6965 7665 6420 616e 6420 7374 6f72 6564  ieved and stored
-00013510: 2069 6e20 7468 6520 2e2f 7365 6172 6368   in the ./search
-00013520: 2064 6972 6563 746f 7279 2222 220a 2020   directory""".  
-00013530: 2020 6d64 5f69 6d70 6f72 7465 6420 3d20    md_imported = 
-00013540: 320a 2020 2020 2222 2252 6563 6f72 6420  2.    """Record 
-00013550: 6973 2069 6d70 6f72 7465 6420 696e 746f  is imported into
-00013560: 2074 6865 2052 4543 4f52 4453 5f46 494c   the RECORDS_FIL
-00013570: 4522 2222 0a20 2020 206d 645f 6e65 6564  E""".    md_need
-00013580: 735f 6d61 6e75 616c 5f70 7265 7061 7261  s_manual_prepara
-00013590: 7469 6f6e 203d 2033 0a20 2020 2022 2222  tion = 3.    """
-000135a0: 5265 636f 7264 2072 6571 7569 7265 7320  Record requires 
-000135b0: 6d61 6e75 616c 2070 7265 7061 7261 7469  manual preparati
-000135c0: 6f6e 0a20 2020 2028 636f 6c72 6576 5f6d  on.    (colrev_m
-000135d0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-000135e0: 616e 6365 2070 726f 7669 6465 7320 6869  ance provides hi
-000135f0: 6e74 7329 2222 220a 2020 2020 6d64 5f70  nts)""".    md_p
-00013600: 7265 7061 7265 6420 3d20 340a 2020 2020  repared = 4.    
-00013610: 2222 2252 6563 6f72 6420 6973 2070 7265  """Record is pre
-00013620: 7061 7265 6420 286e 6f20 6d69 7373 696e  pared (no missin
-00013630: 6720 6f72 2069 6e63 6f6d 706c 6574 6520  g or incomplete 
-00013640: 6669 656c 6473 2c20 696e 636f 6e73 6973  fields, inconsis
-00013650: 7465 6e63 6965 7320 6368 6563 6b65 6429  tencies checked)
-00013660: 2222 220a 2020 2020 6d64 5f70 726f 6365  """.    md_proce
-00013670: 7373 6564 203d 2035 0a20 2020 2022 2222  ssed = 5.    """
-00013680: 5265 636f 7264 2068 6173 2062 6565 6e20  Record has been 
-00013690: 6368 6563 6b65 6420 666f 7220 6475 706c  checked for dupl
-000136a0: 6963 6174 6520 6173 736f 6369 6174 696f  icate associatio
-000136b0: 6e73 0a20 2020 2077 6974 6820 616e 7920  ns.    with any 
-000136c0: 7265 636f 7264 2069 6e20 5265 636f 7264  record in Record
-000136d0: 5374 6174 6520 6d64 5f70 726f 6365 7373  State md_process
-000136e0: 6564 206f 7220 6c61 7465 7222 2222 0a20  ed or later""". 
-000136f0: 2020 2072 6576 5f70 7265 7363 7265 656e     rev_prescreen
-00013700: 5f65 7863 6c75 6465 6420 3d20 360a 2020  _excluded = 6.  
-00013710: 2020 2222 2252 6563 6f72 6420 7761 7320    """Record was 
-00013720: 6578 636c 7564 6564 2069 6e20 7468 6520  excluded in the 
-00013730: 7072 6573 6372 6565 6e20 2862 6173 6564  prescreen (based
-00013740: 206f 6e20 7469 746c 6573 2f61 6273 7472   on titles/abstr
-00013750: 6163 7473 2922 2222 0a20 2020 2072 6576  acts)""".    rev
-00013760: 5f70 7265 7363 7265 656e 5f69 6e63 6c75  _prescreen_inclu
-00013770: 6465 6420 3d20 370a 2020 2020 2222 2252  ded = 7.    """R
-00013780: 6563 6f72 6420 7761 7320 696e 636c 7564  ecord was includ
-00013790: 6564 2069 6e20 7468 6520 7072 6573 6372  ed in the prescr
-000137a0: 6565 6e20 2862 6173 6564 206f 6e20 7469  een (based on ti
-000137b0: 746c 6573 2f61 6273 7472 6163 7473 2922  tles/abstracts)"
-000137c0: 2222 0a20 2020 2070 6466 5f6e 6565 6473  "".    pdf_needs
-000137d0: 5f6d 616e 7561 6c5f 7265 7472 6965 7661  _manual_retrieva
-000137e0: 6c20 3d20 380a 2020 2020 2222 2252 6563  l = 8.    """Rec
-000137f0: 6f72 6420 6d61 726b 6564 2066 6f72 206d  ord marked for m
-00013800: 616e 7561 6c20 5044 4620 7265 7472 6965  anual PDF retrie
-00013810: 7661 6c22 2222 0a20 2020 2070 6466 5f69  val""".    pdf_i
-00013820: 6d70 6f72 7465 6420 3d20 390a 2020 2020  mported = 9.    
-00013830: 2222 2250 4446 2069 6d70 6f72 7465 6420  """PDF imported 
-00013840: 616e 6420 6d61 726b 6564 2066 6f72 2070  and marked for p
-00013850: 7265 7061 7261 7469 6f6e 2222 220a 2020  reparation""".  
-00013860: 2020 7064 665f 6e6f 745f 6176 6169 6c61    pdf_not_availa
-00013870: 626c 6520 3d20 3130 0a20 2020 2022 2222  ble = 10.    """
-00013880: 5044 4620 6973 206e 6f74 2061 7661 696c  PDF is not avail
-00013890: 6162 6c65 2222 220a 2020 2020 7064 665f  able""".    pdf_
-000138a0: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
-000138b0: 7061 7261 7469 6f6e 203d 2031 310a 2020  paration = 11.  
-000138c0: 2020 2222 2250 4446 206d 6172 6b65 6420    """PDF marked 
-000138d0: 666f 7220 6d61 6e75 616c 2070 7265 7061  for manual prepa
-000138e0: 7261 7469 6f6e 2222 220a 2020 2020 7064  ration""".    pd
-000138f0: 665f 7072 6570 6172 6564 203d 2031 320a  f_prepared = 12.
-00013900: 2020 2020 2222 2250 4446 2070 7265 7061      """PDF prepa
-00013910: 7265 6422 2222 0a20 2020 2072 6576 5f65  red""".    rev_e
-00013920: 7863 6c75 6465 6420 3d20 3133 0a20 2020  xcluded = 13.   
-00013930: 2022 2222 5265 636f 7264 2065 7863 6c75   """Record exclu
-00013940: 6465 6420 696e 2073 6372 6565 6e20 2866  ded in screen (f
-00013950: 756c 6c2d 7465 7874 2922 2222 0a20 2020  ull-text)""".   
-00013960: 2072 6576 5f69 6e63 6c75 6465 6420 3d20   rev_included = 
-00013970: 3134 0a20 2020 2022 2222 5265 636f 7264  14.    """Record
-00013980: 2069 6e63 6c75 6465 6420 696e 2073 6372   included in scr
-00013990: 6565 6e20 2866 756c 6c2d 7465 7874 2922  een (full-text)"
-000139a0: 2222 0a20 2020 2072 6576 5f73 796e 7468  "".    rev_synth
-000139b0: 6573 697a 6564 203d 2031 350a 2020 2020  esized = 15.    
-000139c0: 2222 2252 6563 6f72 6420 7379 6e74 6865  """Record synthe
-000139d0: 7369 7a65 6422 2222 0a20 2020 2023 204e  sized""".    # N
-000139e0: 6f74 6520 3a20 5442 443a 2072 6576 5f63  ote : TBD: rev_c
-000139f0: 6f64 6564 0a0a 2020 2020 6465 6620 5f5f  oded..    def __
-00013a00: 7374 725f 5f28 7365 6c66 2920 2d3e 2073  str__(self) -> s
-00013a10: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
-00013a20: 726e 2066 227b 7365 6c66 2e6e 616d 657d  rn f"{self.name}
-00013a30: 220a 0a20 2020 2064 6566 205f 5f6c 745f  "..    def __lt_
-00013a40: 5f28 7365 6c66 2c20 6f74 6865 7229 202d  _(self, other) -
-00013a50: 3e20 626f 6f6c 3a20 2023 2074 7970 653a  > bool:  # type:
-00013a60: 2069 676e 6f72 650a 2020 2020 2020 2020   ignore.        
-00013a70: 6966 2073 656c 662e 5f5f 636c 6173 735f  if self.__class_
-00013a80: 5f20 3d3d 2052 6563 6f72 6453 7461 7465  _ == RecordState
-00013a90: 2061 6e64 206f 7468 6572 2e5f 5f63 6c61   and other.__cla
-00013aa0: 7373 5f5f 203d 3d20 5265 636f 7264 5374  ss__ == RecordSt
-00013ab0: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
-00013ac0: 2072 6574 7572 6e20 7365 6c66 2e76 616c   return self.val
-00013ad0: 7565 203c 206f 7468 6572 2e76 616c 7565  ue < other.value
-00013ae0: 0a20 2020 2020 2020 2072 6169 7365 204e  .        raise N
-00013af0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-00013b00: 6f72 0a0a 2020 2020 4063 6c61 7373 6d65  or..    @classme
-00013b10: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00013b20: 5f6e 6f6e 5f70 726f 6365 7373 6564 5f73  _non_processed_s
-00013b30: 7461 7465 7328 636c 7329 202d 3e20 6c69  tates(cls) -> li
-00013b40: 7374 3a0a 2020 2020 2020 2020 2222 2247  st:.        """G
-00013b50: 6574 2074 6865 2073 7461 7465 7320 7468  et the states th
-00013b60: 6174 2063 6f72 7265 7370 6f6e 6420 746f  at correspond to
-00013b70: 206e 6f74 2d79 6574 2d70 726f 6365 7373   not-yet-process
-00013b80: 6564 2222 220a 2020 2020 2020 2020 7265  ed""".        re
-00013b90: 7475 726e 205b 0a20 2020 2020 2020 2020  turn [.         
-00013ba0: 2020 2063 6f6c 7265 762e 7265 636f 7264     colrev.record
-00013bb0: 2e52 6563 6f72 6453 7461 7465 2e6d 645f  .RecordState.md_
-00013bc0: 7265 7472 6965 7665 642c 0a20 2020 2020  retrieved,.     
-00013bd0: 2020 2020 2020 2063 6f6c 7265 762e 7265         colrev.re
-00013be0: 636f 7264 2e52 6563 6f72 6453 7461 7465  cord.RecordState
-00013bf0: 2e6d 645f 696d 706f 7274 6564 2c0a 2020  .md_imported,.  
-00013c00: 2020 2020 2020 2020 2020 636f 6c72 6576            colrev
-00013c10: 2e72 6563 6f72 642e 5265 636f 7264 5374  .record.RecordSt
-00013c20: 6174 652e 6d64 5f70 7265 7061 7265 642c  ate.md_prepared,
-00013c30: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00013c40: 7265 762e 7265 636f 7264 2e52 6563 6f72  rev.record.Recor
-00013c50: 6453 7461 7465 2e6d 645f 6e65 6564 735f  dState.md_needs_
-00013c60: 6d61 6e75 616c 5f70 7265 7061 7261 7469  manual_preparati
-00013c70: 6f6e 2c0a 2020 2020 2020 2020 5d0a 0a20  on,.        ].. 
-00013c80: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00013c90: 2020 2020 6465 6620 6765 745f 706f 7374      def get_post
-00013ca0: 5f78 5f73 7461 7465 7328 636c 732c 202a  _x_states(cls, *
-00013cb0: 2c20 7374 6174 653a 2052 6563 6f72 6453  , state: RecordS
-00013cc0: 7461 7465 2920 2d3e 2074 7970 696e 672e  tate) -> typing.
-00013cd0: 5365 745b 5265 636f 7264 5374 6174 655d  Set[RecordState]
-00013ce0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-00013cf0: 2074 6865 2073 7461 7465 7320 6166 7465   the states afte
-00013d00: 7220 7374 6174 6520 7820 2870 6173 7365  r state x (passe
-00013d10: 6420 6173 2061 2070 6172 616d 6574 6572  d as a parameter
-00013d20: 2922 2222 0a20 2020 2020 2020 2069 6620  )""".        if 
-00013d30: 7374 6174 6520 3d3d 2052 6563 6f72 6453  state == RecordS
-00013d40: 7461 7465 2e6d 645f 7072 6570 6172 6564  tate.md_prepared
-00013d50: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00013d60: 7475 726e 207b 0a20 2020 2020 2020 2020  turn {.         
-00013d70: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-00013d80: 7465 2e6d 645f 7072 6570 6172 6564 2c0a  te.md_prepared,.
-00013d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013da0: 5265 636f 7264 5374 6174 652e 6d64 5f70  RecordState.md_p
-00013db0: 726f 6365 7373 6564 2c0a 2020 2020 2020  rocessed,.      
-00013dc0: 2020 2020 2020 2020 2020 5265 636f 7264            Record
-00013dd0: 5374 6174 652e 7265 765f 7072 6573 6372  State.rev_prescr
-00013de0: 6565 6e5f 696e 636c 7564 6564 2c0a 2020  een_included,.  
-00013df0: 2020 2020 2020 2020 2020 2020 2020 5265                Re
-00013e00: 636f 7264 5374 6174 652e 7265 765f 7072  cordState.rev_pr
-00013e10: 6573 6372 6565 6e5f 6578 636c 7564 6564  escreen_excluded
-00013e20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013e30: 2020 5265 636f 7264 5374 6174 652e 7064    RecordState.pd
-00013e40: 665f 6e65 6564 735f 6d61 6e75 616c 5f72  f_needs_manual_r
-00013e50: 6574 7269 6576 616c 2c0a 2020 2020 2020  etrieval,.      
-00013e60: 2020 2020 2020 2020 2020 5265 636f 7264            Record
-00013e70: 5374 6174 652e 7064 665f 696d 706f 7274  State.pdf_import
-00013e80: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-00013e90: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-00013ea0: 7064 665f 6e6f 745f 6176 6169 6c61 626c  pdf_not_availabl
-00013eb0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00013ec0: 2020 2052 6563 6f72 6453 7461 7465 2e70     RecordState.p
-00013ed0: 6466 5f6e 6565 6473 5f6d 616e 7561 6c5f  df_needs_manual_
-00013ee0: 7072 6570 6172 6174 696f 6e2c 0a20 2020  preparation,.   
-00013ef0: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
-00013f00: 6f72 6453 7461 7465 2e70 6466 5f70 7265  ordState.pdf_pre
-00013f10: 7061 7265 642c 0a20 2020 2020 2020 2020  pared,.         
-00013f20: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-00013f30: 7465 2e72 6576 5f65 7863 6c75 6465 642c  te.rev_excluded,
-00013f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013f50: 2052 6563 6f72 6453 7461 7465 2e72 6576   RecordState.rev
-00013f60: 5f69 6e63 6c75 6465 642c 0a20 2020 2020  _included,.     
-00013f70: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
-00013f80: 6453 7461 7465 2e72 6576 5f73 796e 7468  dState.rev_synth
-00013f90: 6573 697a 6564 2c0a 2020 2020 2020 2020  esized,.        
-00013fa0: 2020 2020 7d0a 2020 2020 2020 2020 6966      }.        if
-00013fb0: 2073 7461 7465 203d 3d20 5265 636f 7264   state == Record
-00013fc0: 5374 6174 652e 6d64 5f70 726f 6365 7373  State.md_process
-00013fd0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00013fe0: 7265 7475 726e 207b 0a20 2020 2020 2020  return {.       
-00013ff0: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
-00014000: 7461 7465 2e6d 645f 7072 6f63 6573 7365  tate.md_processe
-00014010: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-00014020: 2020 2052 6563 6f72 6453 7461 7465 2e72     RecordState.r
-00014030: 6576 5f70 7265 7363 7265 656e 5f69 6e63  ev_prescreen_inc
-00014040: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
-00014050: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-00014060: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
-00014070: 5f65 7863 6c75 6465 642c 0a20 2020 2020  _excluded,.     
-00014080: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
-00014090: 6453 7461 7465 2e70 6466 5f6e 6565 6473  dState.pdf_needs
-000140a0: 5f6d 616e 7561 6c5f 7265 7472 6965 7661  _manual_retrieva
-000140b0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-000140c0: 2020 2052 6563 6f72 6453 7461 7465 2e70     RecordState.p
-000140d0: 6466 5f69 6d70 6f72 7465 642c 0a20 2020  df_imported,.   
-000140e0: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
-000140f0: 6f72 6453 7461 7465 2e70 6466 5f6e 6f74  ordState.pdf_not
-00014100: 5f61 7661 696c 6162 6c65 2c0a 2020 2020  _available,.    
-00014110: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-00014120: 7264 5374 6174 652e 7064 665f 6e65 6564  rdState.pdf_need
-00014130: 735f 6d61 6e75 616c 5f70 7265 7061 7261  s_manual_prepara
-00014140: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00014150: 2020 2020 2020 5265 636f 7264 5374 6174        RecordStat
-00014160: 652e 7064 665f 7072 6570 6172 6564 2c0a  e.pdf_prepared,.
-00014170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014180: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
-00014190: 6578 636c 7564 6564 2c0a 2020 2020 2020  excluded,.      
-000141a0: 2020 2020 2020 2020 2020 5265 636f 7264            Record
-000141b0: 5374 6174 652e 7265 765f 696e 636c 7564  State.rev_includ
-000141c0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-000141d0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-000141e0: 7265 765f 7379 6e74 6865 7369 7a65 642c  rev_synthesized,
-000141f0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-00014200: 2020 2020 2020 2069 6620 7374 6174 6520         if state 
-00014210: 3d3d 2052 6563 6f72 6453 7461 7465 2e72  == RecordState.r
-00014220: 6576 5f70 7265 7363 7265 656e 5f69 6e63  ev_prescreen_inc
-00014230: 6c75 6465 643a 0a20 2020 2020 2020 2020  luded:.         
-00014240: 2020 2072 6574 7572 6e20 7b0a 2020 2020     return {.    
-00014250: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-00014260: 7264 5374 6174 652e 7265 765f 7072 6573  rdState.rev_pres
-00014270: 6372 6565 6e5f 696e 636c 7564 6564 2c0a  creen_included,.
-00014280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014290: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
-000142a0: 7072 6573 6372 6565 6e5f 6578 636c 7564  prescreen_exclud
-000142b0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-000142c0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-000142d0: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
-000142e0: 5f72 6574 7269 6576 616c 2c0a 2020 2020  _retrieval,.    
-000142f0: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-00014300: 7264 5374 6174 652e 7064 665f 696d 706f  rdState.pdf_impo
-00014310: 7274 6564 2c0a 2020 2020 2020 2020 2020  rted,.          
-00014320: 2020 2020 2020 5265 636f 7264 5374 6174        RecordStat
-00014330: 652e 7064 665f 6e6f 745f 6176 6169 6c61  e.pdf_not_availa
-00014340: 626c 652c 0a20 2020 2020 2020 2020 2020  ble,.           
-00014350: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
-00014360: 2e70 6466 5f6e 6565 6473 5f6d 616e 7561  .pdf_needs_manua
-00014370: 6c5f 7072 6570 6172 6174 696f 6e2c 0a20  l_preparation,. 
-00014380: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-00014390: 6563 6f72 6453 7461 7465 2e70 6466 5f70  ecordState.pdf_p
-000143a0: 7265 7061 7265 642c 0a20 2020 2020 2020  repared,.       
-000143b0: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
-000143c0: 7461 7465 2e72 6576 5f65 7863 6c75 6465  tate.rev_exclude
-000143d0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000143e0: 2020 2052 6563 6f72 6453 7461 7465 2e72     RecordState.r
-000143f0: 6576 5f69 6e63 6c75 6465 642c 0a20 2020  ev_included,.   
-00014400: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
-00014410: 6f72 6453 7461 7465 2e72 6576 5f73 796e  ordState.rev_syn
-00014420: 7468 6573 697a 6564 2c0a 2020 2020 2020  thesized,.      
-00014430: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00014440: 6966 2073 7461 7465 203d 3d20 5265 636f  if state == Reco
-00014450: 7264 5374 6174 652e 7064 665f 7072 6570  rdState.pdf_prep
-00014460: 6172 6564 3a0a 2020 2020 2020 2020 2020  ared:.          
-00014470: 2020 7265 7475 726e 207b 0a20 2020 2020    return {.     
-00014480: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
-00014490: 6453 7461 7465 2e70 6466 5f70 7265 7061  dState.pdf_prepa
-000144a0: 7265 642c 0a20 2020 2020 2020 2020 2020  red,.           
-000144b0: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
-000144c0: 2e72 6576 5f65 7863 6c75 6465 642c 0a20  .rev_excluded,. 
-000144d0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-000144e0: 6563 6f72 6453 7461 7465 2e72 6576 5f69  ecordState.rev_i
-000144f0: 6e63 6c75 6465 642c 0a20 2020 2020 2020  ncluded,.       
-00014500: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
-00014510: 7461 7465 2e72 6576 5f73 796e 7468 6573  tate.rev_synthes
-00014520: 697a 6564 2c0a 2020 2020 2020 2020 2020  ized,.          
-00014530: 2020 7d0a 0a20 2020 2020 2020 2069 6620    }..        if 
-00014540: 7374 6174 6520 3d3d 2052 6563 6f72 6453  state == RecordS
-00014550: 7461 7465 2e72 6576 5f69 6e63 6c75 6465  tate.rev_include
-00014560: 643a 0a20 2020 2020 2020 2020 2020 2072  d:.            r
-00014570: 6574 7572 6e20 7b0a 2020 2020 2020 2020  eturn {.        
-00014580: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
-00014590: 6174 652e 7265 765f 6578 636c 7564 6564  ate.rev_excluded
-000145a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000145b0: 2020 5265 636f 7264 5374 6174 652e 7265    RecordState.re
-000145c0: 765f 696e 636c 7564 6564 2c0a 2020 2020  v_included,.    
-000145d0: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-000145e0: 7264 5374 6174 652e 7265 765f 7379 6e74  rdState.rev_synt
-000145f0: 6865 7369 7a65 642c 0a20 2020 2020 2020  hesized,.       
-00014600: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00014610: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
-00014620: 653d 6e6f 2d6d 656d 6265 720a 2020 2020  e=no-member.    
-00014630: 2020 2020 7261 6973 6520 636f 6c72 6576      raise colrev
-00014640: 5f65 7863 6570 7469 6f6e 732e 5061 7261  _exceptions.Para
-00014650: 6d65 7465 7245 7272 6f72 280a 2020 2020  meterError(.    
-00014660: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
-00014670: 723d 2273 7461 7465 222c 2076 616c 7565  r="state", value
-00014680: 3d22 7374 6174 6522 2c20 6f70 7469 6f6e  ="state", option
-00014690: 733d 636c 732e 5f6d 656d 6265 725f 6e61  s=cls._member_na
-000146a0: 6d65 735f 0a20 2020 2020 2020 2029 0a0a  mes_.        )..
-000146b0: 0a6e 6f6e 5f70 726f 6365 7373 696e 675f  .non_processing_
-000146c0: 7472 616e 7369 7469 6f6e 7320 3d20 5b0a  transitions = [.
-000146d0: 2020 2020 5b0a 2020 2020 2020 2020 7b0a      [.        {.
-000146e0: 2020 2020 2020 2020 2020 2020 2274 7269              "tri
-000146f0: 6767 6572 223a 2022 666f 726d 6174 222c  gger": "format",
-00014700: 0a20 2020 2020 2020 2020 2020 2022 736f  .            "so
-00014710: 7572 6365 223a 2073 7461 7465 2c0a 2020  urce": state,.  
-00014720: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
-00014730: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
-00014740: 207d 2c0a 2020 2020 2020 2020 7b0a 2020   },.        {.  
-00014750: 2020 2020 2020 2020 2020 2274 7269 6767            "trigg
-00014760: 6572 223a 2022 6578 706c 6f72 6522 2c0a  er": "explore",.
-00014770: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
-00014780: 7263 6522 3a20 7374 6174 652c 0a20 2020  rce": state,.   
-00014790: 2020 2020 2020 2020 2022 6465 7374 223a           "dest":
-000147a0: 2073 7461 7465 2c0a 2020 2020 2020 2020   state,.        
-000147b0: 7d2c 0a20 2020 2020 2020 207b 0a20 2020  },.        {.   
-000147c0: 2020 2020 2020 2020 2022 7472 6967 6765           "trigge
-000147d0: 7222 3a20 2263 6865 636b 222c 0a20 2020  r": "check",.   
-000147e0: 2020 2020 2020 2020 2022 736f 7572 6365           "source
-000147f0: 223a 2073 7461 7465 2c0a 2020 2020 2020  ": state,.      
-00014800: 2020 2020 2020 2264 6573 7422 3a20 7374        "dest": st
-00014810: 6174 652c 0a20 2020 2020 2020 207d 2c0a  ate,.        },.
-00014820: 2020 2020 5d0a 2020 2020 666f 7220 7374      ].    for st
-00014830: 6174 6520 696e 206c 6973 7428 5265 636f  ate in list(Reco
-00014840: 7264 5374 6174 6529 0a5d 0a0a 0a63 6c61  rdState).]...cla
-00014850: 7373 2052 6563 6f72 6453 7461 7465 4d6f  ss RecordStateMo
-00014860: 6465 6c3a 0a20 2020 2022 2222 5468 6520  del:.    """The 
-00014870: 5265 636f 7264 5374 6174 654d 6f64 656c  RecordStateModel
-00014880: 2064 6573 6372 6962 6573 2074 7261 6e73   describes trans
-00014890: 6974 696f 6e73 2062 6574 7765 656e 2052  itions between R
-000148a0: 6563 6f72 6453 7461 7465 7322 2222 0a0a  ecordStates"""..
-000148b0: 2020 2020 7472 616e 7369 7469 6f6e 7320      transitions 
-000148c0: 3d20 5b0a 2020 2020 2020 2020 7b0a 2020  = [.        {.  
-000148d0: 2020 2020 2020 2020 2020 2274 7269 6767            "trigg
-000148e0: 6572 223a 2022 6c6f 6164 222c 0a20 2020  er": "load",.   
-000148f0: 2020 2020 2020 2020 2022 736f 7572 6365           "source
-00014900: 223a 2052 6563 6f72 6453 7461 7465 2e6d  ": RecordState.m
-00014910: 645f 7265 7472 6965 7665 642c 0a20 2020  d_retrieved,.   
-00014920: 2020 2020 2020 2020 2022 6465 7374 223a           "dest":
-00014930: 2052 6563 6f72 6453 7461 7465 2e6d 645f   RecordState.md_
-00014940: 696d 706f 7274 6564 2c0a 2020 2020 2020  imported,.      
-00014950: 2020 7d2c 0a20 2020 2020 2020 207b 0a20    },.        {. 
-00014960: 2020 2020 2020 2020 2020 2022 7472 6967             "trig
-00014970: 6765 7222 3a20 2270 7265 7022 2c0a 2020  ger": "prep",.  
-00014980: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
-00014990: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
-000149a0: 6d64 5f69 6d70 6f72 7465 642c 0a20 2020  md_imported,.   
-000149b0: 2020 2020 2020 2020 2022 6465 7374 223a           "dest":
-000149c0: 2052 6563 6f72 6453 7461 7465 2e6d 645f   RecordState.md_
-000149d0: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
-000149e0: 7061 7261 7469 6f6e 2c0a 2020 2020 2020  paration,.      
-000149f0: 2020 7d2c 0a20 2020 2020 2020 207b 0a20    },.        {. 
-00014a00: 2020 2020 2020 2020 2020 2022 7472 6967             "trig
-00014a10: 6765 7222 3a20 2270 7265 7022 2c0a 2020  ger": "prep",.  
-00014a20: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
-00014a30: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
-00014a40: 6d64 5f69 6d70 6f72 7465 642c 0a20 2020  md_imported,.   
-00014a50: 2020 2020 2020 2020 2022 6465 7374 223a           "dest":
-00014a60: 2052 6563 6f72 6453 7461 7465 2e6d 645f   RecordState.md_
-00014a70: 7072 6570 6172 6564 2c0a 2020 2020 2020  prepared,.      
-00014a80: 2020 7d2c 0a20 2020 2020 2020 207b 0a20    },.        {. 
-00014a90: 2020 2020 2020 2020 2020 2022 7472 6967             "trig
-00014aa0: 6765 7222 3a20 2270 7265 705f 6d61 6e22  ger": "prep_man"
-00014ab0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00014ac0: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
-00014ad0: 6174 652e 6d64 5f6e 6565 6473 5f6d 616e  ate.md_needs_man
-00014ae0: 7561 6c5f 7072 6570 6172 6174 696f 6e2c  ual_preparation,
-00014af0: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
-00014b00: 7374 223a 2052 6563 6f72 6453 7461 7465  st": RecordState
-00014b10: 2e6d 645f 7072 6570 6172 6564 2c0a 2020  .md_prepared,.  
-00014b20: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-00014b30: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-00014b40: 7472 6967 6765 7222 3a20 2264 6564 7570  trigger": "dedup
-00014b50: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00014b60: 2273 6f75 7263 6522 3a20 5265 636f 7264  "source": Record
-00014b70: 5374 6174 652e 6d64 5f70 7265 7061 7265  State.md_prepare
-00014b80: 642c 0a20 2020 2020 2020 2020 2020 2022  d,.            "
-00014b90: 6465 7374 223a 2052 6563 6f72 6453 7461  dest": RecordSta
-00014ba0: 7465 2e6d 645f 7072 6f63 6573 7365 642c  te.md_processed,
-00014bb0: 0a20 2020 2020 2020 207d 2c0a 2020 2020  .        },.    
-00014bc0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00014bd0: 2020 2274 7269 6767 6572 223a 2022 7072    "trigger": "pr
-00014be0: 6573 6372 6565 6e22 2c0a 2020 2020 2020  escreen",.      
-00014bf0: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
-00014c00: 5265 636f 7264 5374 6174 652e 6d64 5f70  RecordState.md_p
-00014c10: 726f 6365 7373 6564 2c0a 2020 2020 2020  rocessed,.      
-00014c20: 2020 2020 2020 2264 6573 7422 3a20 5265        "dest": Re
-00014c30: 636f 7264 5374 6174 652e 7265 765f 7072  cordState.rev_pr
-00014c40: 6573 6372 6565 6e5f 6578 636c 7564 6564  escreen_excluded
-00014c50: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
-00014c60: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00014c70: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
-00014c80: 7265 7363 7265 656e 222c 0a20 2020 2020  rescreen",.     
-00014c90: 2020 2020 2020 2022 736f 7572 6365 223a         "source":
-00014ca0: 2052 6563 6f72 6453 7461 7465 2e6d 645f   RecordState.md_
-00014cb0: 7072 6f63 6573 7365 642c 0a20 2020 2020  processed,.     
-00014cc0: 2020 2020 2020 2022 6465 7374 223a 2052         "dest": R
-00014cd0: 6563 6f72 6453 7461 7465 2e72 6576 5f70  ecordState.rev_p
-00014ce0: 7265 7363 7265 656e 5f69 6e63 6c75 6465  rescreen_include
-00014cf0: 642c 0a20 2020 2020 2020 207d 2c0a 2020  d,.        },.  
-00014d00: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-00014d10: 2020 2020 2274 7269 6767 6572 223a 2022      "trigger": "
-00014d20: 7064 665f 6765 7422 2c0a 2020 2020 2020  pdf_get",.      
-00014d30: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
-00014d40: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
-00014d50: 7072 6573 6372 6565 6e5f 696e 636c 7564  prescreen_includ
-00014d60: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-00014d70: 2264 6573 7422 3a20 5265 636f 7264 5374  "dest": RecordSt
-00014d80: 6174 652e 7064 665f 696d 706f 7274 6564  ate.pdf_imported
-00014d90: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
-00014da0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00014db0: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
-00014dc0: 6466 5f67 6574 222c 0a20 2020 2020 2020  df_get",.       
-00014dd0: 2020 2020 2022 736f 7572 6365 223a 2052       "source": R
-00014de0: 6563 6f72 6453 7461 7465 2e72 6576 5f70  ecordState.rev_p
-00014df0: 7265 7363 7265 656e 5f69 6e63 6c75 6465  rescreen_include
-00014e00: 642c 0a20 2020 2020 2020 2020 2020 2022  d,.            "
-00014e10: 6465 7374 223a 2052 6563 6f72 6453 7461  dest": RecordSta
-00014e20: 7465 2e70 6466 5f6e 6565 6473 5f6d 616e  te.pdf_needs_man
-00014e30: 7561 6c5f 7265 7472 6965 7661 6c2c 0a20  ual_retrieval,. 
-00014e40: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
-00014e50: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-00014e60: 2274 7269 6767 6572 223a 2022 7064 665f  "trigger": "pdf_
-00014e70: 6765 745f 6d61 6e22 2c0a 2020 2020 2020  get_man",.      
-00014e80: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
-00014e90: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
-00014ea0: 6e65 6564 735f 6d61 6e75 616c 5f72 6574  needs_manual_ret
-00014eb0: 7269 6576 616c 2c0a 2020 2020 2020 2020  rieval,.        
-00014ec0: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
-00014ed0: 7264 5374 6174 652e 7064 665f 6e6f 745f  rdState.pdf_not_
-00014ee0: 6176 6169 6c61 626c 652c 0a20 2020 2020  available,.     
-00014ef0: 2020 207d 2c0a 2020 2020 2020 2020 7b0a     },.        {.
-00014f00: 2020 2020 2020 2020 2020 2020 2274 7269              "tri
-00014f10: 6767 6572 223a 2022 7064 665f 6765 745f  gger": "pdf_get_
-00014f20: 6d61 6e22 2c0a 2020 2020 2020 2020 2020  man",.          
-00014f30: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
-00014f40: 7264 5374 6174 652e 7064 665f 6e65 6564  rdState.pdf_need
-00014f50: 735f 6d61 6e75 616c 5f72 6574 7269 6576  s_manual_retriev
-00014f60: 616c 2c0a 2020 2020 2020 2020 2020 2020  al,.            
-00014f70: 2264 6573 7422 3a20 5265 636f 7264 5374  "dest": RecordSt
-00014f80: 6174 652e 7064 665f 696d 706f 7274 6564  ate.pdf_imported
-00014f90: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
-00014fa0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00014fb0: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
-00014fc0: 6466 5f70 7265 7022 2c0a 2020 2020 2020  df_prep",.      
-00014fd0: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
-00014fe0: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
-00014ff0: 696d 706f 7274 6564 2c0a 2020 2020 2020  imported,.      
-00015000: 2020 2020 2020 2264 6573 7422 3a20 5265        "dest": Re
-00015010: 636f 7264 5374 6174 652e 7064 665f 6e65  cordState.pdf_ne
-00015020: 6564 735f 6d61 6e75 616c 5f70 7265 7061  eds_manual_prepa
-00015030: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
-00015040: 7d2c 0a20 2020 2020 2020 207b 0a20 2020  },.        {.   
-00015050: 2020 2020 2020 2020 2022 7472 6967 6765           "trigge
-00015060: 7222 3a20 2270 6466 5f70 7265 7022 2c0a  r": "pdf_prep",.
-00015070: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
-00015080: 7263 6522 3a20 5265 636f 7264 5374 6174  rce": RecordStat
-00015090: 652e 7064 665f 696d 706f 7274 6564 2c0a  e.pdf_imported,.
-000150a0: 2020 2020 2020 2020 2020 2020 2264 6573              "des
-000150b0: 7422 3a20 5265 636f 7264 5374 6174 652e  t": RecordState.
-000150c0: 7064 665f 7072 6570 6172 6564 2c0a 2020  pdf_prepared,.  
-000150d0: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-000150e0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-000150f0: 7472 6967 6765 7222 3a20 2270 6466 5f70  trigger": "pdf_p
-00015100: 7265 705f 6d61 6e22 2c0a 2020 2020 2020  rep_man",.      
-00015110: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
-00015120: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
-00015130: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
-00015140: 7061 7261 7469 6f6e 2c0a 2020 2020 2020  paration,.      
-00015150: 2020 2020 2020 2264 6573 7422 3a20 5265        "dest": Re
-00015160: 636f 7264 5374 6174 652e 7064 665f 7072  cordState.pdf_pr
-00015170: 6570 6172 6564 2c0a 2020 2020 2020 2020  epared,.        
-00015180: 7d2c 0a20 2020 2020 2020 207b 0a20 2020  },.        {.   
-00015190: 2020 2020 2020 2020 2022 7472 6967 6765           "trigge
-000151a0: 7222 3a20 2273 6372 6565 6e22 2c0a 2020  r": "screen",.  
-000151b0: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
-000151c0: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
-000151d0: 7064 665f 7072 6570 6172 6564 2c0a 2020  pdf_prepared,.  
-000151e0: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
-000151f0: 3a20 5265 636f 7264 5374 6174 652e 7265  : RecordState.re
-00015200: 765f 6578 636c 7564 6564 2c0a 2020 2020  v_excluded,.    
-00015210: 2020 2020 7d2c 0a20 2020 2020 2020 207b      },.        {
-00015220: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
-00015230: 6967 6765 7222 3a20 2273 6372 6565 6e22  igger": "screen"
-00015240: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00015250: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
-00015260: 6174 652e 7064 665f 7072 6570 6172 6564  ate.pdf_prepared
-00015270: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
-00015280: 6573 7422 3a20 5265 636f 7264 5374 6174  est": RecordStat
-00015290: 652e 7265 765f 696e 636c 7564 6564 2c0a  e.rev_included,.
-000152a0: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
-000152b0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-000152c0: 2022 7472 6967 6765 7222 3a20 2264 6174   "trigger": "dat
-000152d0: 6122 2c0a 2020 2020 2020 2020 2020 2020  a",.            
-000152e0: 2273 6f75 7263 6522 3a20 5265 636f 7264  "source": Record
-000152f0: 5374 6174 652e 7265 765f 696e 636c 7564  State.rev_includ
-00015300: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-00015310: 2264 6573 7422 3a20 5265 636f 7264 5374  "dest": RecordSt
-00015320: 6174 652e 7265 765f 7379 6e74 6865 7369  ate.rev_synthesi
-00015330: 7a65 642c 0a20 2020 2020 2020 207d 2c0a  zed,.        },.
-00015340: 2020 2020 5d0a 0a20 2020 2074 7261 6e73      ]..    trans
-00015350: 6974 696f 6e73 5f6e 6f6e 5f70 726f 6365  itions_non_proce
-00015360: 7373 696e 6720 3d20 5b0a 2020 2020 2020  ssing = [.      
-00015370: 2020 6974 656d 2066 6f72 2073 7562 6c69    item for subli
-00015380: 7374 2069 6e20 6e6f 6e5f 7072 6f63 6573  st in non_proces
-00015390: 7369 6e67 5f74 7261 6e73 6974 696f 6e73  sing_transitions
-000153a0: 2066 6f72 2069 7465 6d20 696e 2073 7562   for item in sub
-000153b0: 6c69 7374 0a20 2020 205d 0a0a 2020 2020  list.    ]..    
-000153c0: 2320 6672 6f6d 2074 7261 6e73 6974 696f  # from transitio
-000153d0: 6e73 2069 6d70 6f72 7420 4d61 6368 696e  ns import Machin
-000153e0: 650a 2020 2020 2320 6465 6620 5f5f 696e  e.    # def __in
-000153f0: 6974 5f5f 280a 2020 2020 2320 2020 2020  it__(.    #     
-00015400: 7365 6c66 2c0a 2020 2020 2320 2020 2020  self,.    #     
-00015410: 2a2c 0a20 2020 2023 2020 2020 2073 7461  *,.    #     sta
-00015420: 7465 3a20 5265 636f 7264 5374 6174 652c  te: RecordState,
-00015430: 0a20 2020 2023 2029 202d 3e20 4e6f 6e65  .    # ) -> None
-00015440: 3a0a 2020 2020 2320 2020 2020 7365 6c66  :.    #     self
-00015450: 2e73 7461 7465 203d 2073 7461 7465 0a0a  .state = state..
-00015460: 2020 2020 2320 2020 2020 7365 6c66 2e6d      #     self.m
-00015470: 6163 6869 6e65 203d 204d 6163 6869 6e65  achine = Machine
-00015480: 280a 2020 2020 2320 2020 2020 2020 2020  (.    #         
-00015490: 6d6f 6465 6c3d 7365 6c66 2c0a 2020 2020  model=self,.    
-000154a0: 2320 2020 2020 2020 2020 7374 6174 6573  #         states
-000154b0: 3d52 6563 6f72 6453 7461 7465 2c0a 2020  =RecordState,.  
-000154c0: 2020 2320 2020 2020 2020 2020 7472 616e    #         tran
-000154d0: 7369 7469 6f6e 733d 7365 6c66 2e74 7261  sitions=self.tra
-000154e0: 6e73 6974 696f 6e73 202b 2073 656c 662e  nsitions + self.
-000154f0: 7472 616e 7369 7469 6f6e 735f 6e6f 6e5f  transitions_non_
-00015500: 7072 6f63 6573 7369 6e67 2c0a 2020 2020  processing,.    
-00015510: 2320 2020 2020 2020 2020 696e 6974 6961  #         initia
-00015520: 6c3d 7365 6c66 2e73 7461 7465 2c0a 2020  l=self.state,.  
-00015530: 2020 2320 2020 2020 290a 0a20 2020 2040    #     )..    @
-00015540: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00015550: 6465 6620 6765 745f 7661 6c69 645f 7472  def get_valid_tr
-00015560: 616e 7369 7469 6f6e 7328 636c 732c 202a  ansitions(cls, *
-00015570: 2c20 7374 6174 653a 2052 6563 6f72 6453  , state: RecordS
-00015580: 7461 7465 2920 2d3e 2073 6574 3a0a 2020  tate) -> set:.  
-00015590: 2020 2020 2020 2222 2247 6574 2074 6865        """Get the
-000155a0: 206c 6973 7420 6f66 2076 616c 6964 2074   list of valid t
-000155b0: 7261 6e73 6974 696f 6e73 2222 220a 2020  ransitions""".  
-000155c0: 2020 2020 2020 6c6f 6767 696e 672e 6765        logging.ge
-000155d0: 744c 6f67 6765 7228 2274 7261 6e73 6974  tLogger("transit
-000155e0: 696f 6e73 2229 2e73 6574 4c65 7665 6c28  ions").setLevel(
-000155f0: 6c6f 6767 696e 672e 5741 524e 494e 4729  logging.WARNING)
-00015600: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015610: 7365 7428 7b78 5b22 7472 6967 6765 7222  set({x["trigger"
-00015620: 5d20 666f 7220 7820 696e 2063 6c73 2e74  ] for x in cls.t
-00015630: 7261 6e73 6974 696f 6e73 2069 6620 785b  ransitions if x[
-00015640: 2273 6f75 7263 6522 5d20 3d3d 2073 7461  "source"] == sta
-00015650: 7465 7d29 0a0a 2020 2020 4063 6c61 7373  te})..    @class
-00015660: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-00015670: 6574 5f70 7265 6365 6469 6e67 5f73 7461  et_preceding_sta
-00015680: 7465 7328 636c 732c 202a 2c20 7374 6174  tes(cls, *, stat
-00015690: 653a 2052 6563 6f72 6453 7461 7465 2920  e: RecordState) 
-000156a0: 2d3e 2073 6574 3a0a 2020 2020 2020 2020  -> set:.        
-000156b0: 2222 2247 6574 2074 6865 2073 7461 7465  """Get the state
-000156c0: 7320 7072 6563 6564 696e 6720 7468 6520  s preceding the 
-000156d0: 7374 6174 6520 7468 6174 2069 7320 6769  state that is gi
-000156e0: 7665 6e20 6173 2061 2070 6172 616d 6574  ven as a paramet
-000156f0: 6572 2222 220a 0a20 2020 2020 2020 206c  er"""..        l
-00015700: 6f67 6769 6e67 2e67 6574 4c6f 6767 6572  ogging.getLogger
-00015710: 2822 7472 616e 7369 7469 6f6e 7322 292e  ("transitions").
-00015720: 7365 744c 6576 656c 286c 6f67 6769 6e67  setLevel(logging
-00015730: 2e57 4152 4e49 4e47 290a 2020 2020 2020  .WARNING).      
-00015740: 2020 7072 6563 6564 696e 675f 7374 6174    preceding_stat
-00015750: 6573 3a20 7365 745b 5265 636f 7264 5374  es: set[RecordSt
-00015760: 6174 655d 203d 2073 6574 2829 0a20 2020  ate] = set().   
-00015770: 2020 2020 2061 6464 6564 203d 2054 7275       added = Tru
-00015780: 650a 2020 2020 2020 2020 7768 696c 6520  e.        while 
-00015790: 6164 6465 643a 0a20 2020 2020 2020 2020  added:.         
-000157a0: 2020 2070 7265 6365 6469 6e67 5f73 7461     preceding_sta
-000157b0: 7465 735f 7369 7a65 203d 206c 656e 2870  tes_size = len(p
-000157c0: 7265 6365 6469 6e67 5f73 7461 7465 7329  receding_states)
-000157d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000157e0: 2074 7261 6e73 6974 696f 6e20 696e 2052   transition in R
-000157f0: 6563 6f72 6453 7461 7465 4d6f 6465 6c2e  ecordStateModel.
-00015800: 7472 616e 7369 7469 6f6e 733a 0a20 2020  transitions:.   
-00015810: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015820: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00015830: 2020 2020 2020 7472 616e 7369 7469 6f6e        transition
-00015840: 5b22 6465 7374 225d 2069 6e20 7072 6563  ["dest"] in prec
-00015850: 6564 696e 675f 7374 6174 6573 0a20 2020  eding_states.   
-00015860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015870: 206f 7220 7374 6174 6520 3d3d 2074 7261   or state == tra
-00015880: 6e73 6974 696f 6e5b 2264 6573 7422 5d0a  nsition["dest"].
-00015890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000158b0: 2020 2020 2020 2070 7265 6365 6469 6e67         preceding
-000158c0: 5f73 7461 7465 732e 6164 6428 7472 616e  _states.add(tran
-000158d0: 7369 7469 6f6e 5b22 736f 7572 6365 225d  sition["source"]
-000158e0: 2920 2023 2074 7970 653a 2069 676e 6f72  )  # type: ignor
-000158f0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00015900: 2070 7265 6365 6469 6e67 5f73 7461 7465   preceding_state
-00015910: 735f 7369 7a65 203d 3d20 6c65 6e28 7072  s_size == len(pr
-00015920: 6563 6564 696e 675f 7374 6174 6573 293a  eceding_states):
-00015930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015940: 2061 6464 6564 203d 2046 616c 7365 0a20   added = False. 
-00015950: 2020 2020 2020 2072 6574 7572 6e20 7072         return pr
-00015960: 6563 6564 696e 675f 7374 6174 6573 0a0a  eceding_states..
-00015970: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00015980: 0a20 2020 2064 6566 2063 6865 636b 5f6f  .    def check_o
-00015990: 7065 7261 7469 6f6e 5f70 7265 636f 6e64  peration_precond
-000159a0: 6974 696f 6e28 0a20 2020 2020 2020 2063  ition(.        c
-000159b0: 6c73 2c20 2a2c 206f 7065 7261 7469 6f6e  ls, *, operation
-000159c0: 3a20 636f 6c72 6576 2e6f 7065 7261 7469  : colrev.operati
-000159d0: 6f6e 2e4f 7065 7261 7469 6f6e 0a20 2020  on.Operation.   
-000159e0: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
-000159f0: 2020 2020 2222 2243 6865 636b 2074 6865      """Check the
-00015a00: 2070 7265 636f 6e64 6974 696f 6e73 2066   preconditions f
-00015a10: 6f72 2061 6e20 6f70 6572 6174 696f 6e22  or an operation"
-00015a20: 2222 0a0a 2020 2020 2020 2020 6465 6620  ""..        def 
-00015a30: 6765 745f 7374 6174 6573 5f73 6574 2829  get_states_set()
-00015a40: 202d 3e20 7365 743a 0a20 2020 2020 2020   -> set:.       
-00015a50: 2020 2020 2069 6620 6e6f 7420 6f70 6572       if not oper
-00015a60: 6174 696f 6e2e 7265 7669 6577 5f6d 616e  ation.review_man
-00015a70: 6167 6572 2e64 6174 6173 6574 2e72 6563  ager.dataset.rec
-00015a80: 6f72 6473 5f66 696c 652e 6973 5f66 696c  ords_file.is_fil
-00015a90: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
-00015aa0: 2020 2020 2072 6574 7572 6e20 7365 7428       return set(
-00015ab0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00015ac0: 636f 7264 735f 6865 6164 6572 7320 3d20  cords_headers = 
-00015ad0: 6f70 6572 6174 696f 6e2e 7265 7669 6577  operation.review
-00015ae0: 5f6d 616e 6167 6572 2e64 6174 6173 6574  _manager.dataset
-00015af0: 2e6c 6f61 645f 7265 636f 7264 735f 6469  .load_records_di
-00015b00: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-00015b10: 2020 2020 6865 6164 6572 5f6f 6e6c 793d      header_only=
-00015b20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00015b30: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-00015b40: 6563 6f72 645f 6865 6164 6572 5f6c 6973  ecord_header_lis
-00015b50: 7420 3d20 6c69 7374 2872 6563 6f72 6473  t = list(records
-00015b60: 5f68 6561 6465 7273 2e76 616c 7565 7328  _headers.values(
-00015b70: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00015b80: 7265 7475 726e 207b 656c 5b22 636f 6c72  return {el["colr
-00015b90: 6576 5f73 7461 7475 7322 5d20 666f 7220  ev_status"] for 
-00015ba0: 656c 2069 6e20 7265 636f 7264 5f68 6561  el in record_hea
-00015bb0: 6465 725f 6c69 7374 7d0a 0a20 2020 2020  der_list}..     
-00015bc0: 2020 2069 6620 6f70 6572 6174 696f 6e2e     if operation.
-00015bd0: 7265 7669 6577 5f6d 616e 6167 6572 2e73  review_manager.s
-00015be0: 6574 7469 6e67 732e 7072 6f6a 6563 742e  ettings.project.
-00015bf0: 6465 6c61 795f 6175 746f 6d61 7465 645f  delay_automated_
-00015c00: 7072 6f63 6573 7369 6e67 3a0a 2020 2020  processing:.    
-00015c10: 2020 2020 2020 2020 7374 6172 745f 7374          start_st
-00015c20: 6174 6573 3a20 6c69 7374 5b73 7472 5d20  ates: list[str] 
-00015c30: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-00015c40: 2020 2020 7374 7228 785b 2273 6f75 7263      str(x["sourc
-00015c50: 6522 5d29 0a20 2020 2020 2020 2020 2020  e"]).           
-00015c60: 2020 2020 2066 6f72 2078 2069 6e20 636f       for x in co
-00015c70: 6c72 6576 2e72 6563 6f72 642e 5265 636f  lrev.record.Reco
-00015c80: 7264 5374 6174 654d 6f64 656c 2e74 7261  rdStateModel.tra
-00015c90: 6e73 6974 696f 6e73 0a20 2020 2020 2020  nsitions.       
-00015ca0: 2020 2020 2020 2020 2069 6620 7374 7228           if str(
-00015cb0: 6f70 6572 6174 696f 6e2e 7479 7065 2920  operation.type) 
-00015cc0: 3d3d 2078 5b22 7472 6967 6765 7222 5d0a  == x["trigger"].
-00015cd0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-00015ce0: 2020 2020 2020 2020 2020 7374 6174 6520            state 
-00015cf0: 3d20 636f 6c72 6576 2e72 6563 6f72 642e  = colrev.record.
-00015d00: 5265 636f 7264 5374 6174 655b 7374 6172  RecordState[star
-00015d10: 745f 7374 6174 6573 5b30 5d5d 0a0a 2020  t_states[0]]..  
-00015d20: 2020 2020 2020 2020 2020 6375 725f 7374            cur_st
-00015d30: 6174 655f 6c69 7374 203d 2067 6574 5f73  ate_list = get_s
-00015d40: 7461 7465 735f 7365 7428 290a 2020 2020  tates_set().    
-00015d50: 2020 2020 2020 2020 2320 7365 6c66 2e72          # self.r
-00015d60: 6576 6965 775f 6d61 6e61 6765 722e 6c6f  eview_manager.lo
-00015d70: 6767 6572 2e64 6562 7567 2866 2263 7572  gger.debug(f"cur
-00015d80: 5f73 7461 7465 5f6c 6973 743a 207b 6375  _state_list: {cu
-00015d90: 725f 7374 6174 655f 6c69 7374 7d22 290a  r_state_list}").
-00015da0: 2020 2020 2020 2020 2020 2020 2320 7365              # se
-00015db0: 6c66 2e72 6576 6965 775f 6d61 6e61 6765  lf.review_manage
-00015dc0: 722e 6c6f 6767 6572 2e64 6562 7567 2866  r.logger.debug(f
-00015dd0: 2270 7265 636f 6e64 6974 696f 6e3a 207b  "precondition: {
-00015de0: 7365 6c66 2e73 7461 7465 7d22 290a 2020  self.state}").  
-00015df0: 2020 2020 2020 2020 2020 7265 7175 6972            requir
-00015e00: 6564 5f61 6273 656e 7420 3d20 636c 732e  ed_absent = cls.
-00015e10: 6765 745f 7072 6563 6564 696e 675f 7374  get_preceding_st
-00015e20: 6174 6573 2873 7461 7465 3d73 7461 7465  ates(state=state
-00015e30: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00015e40: 7365 6c66 2e72 6576 6965 775f 6d61 6e61  self.review_mana
-00015e50: 6765 722e 6c6f 6767 6572 2e64 6562 7567  ger.logger.debug
-00015e60: 2866 2272 6571 7569 7265 645f 6162 7365  (f"required_abse
-00015e70: 6e74 3a20 7b72 6571 7569 7265 645f 6162  nt: {required_ab
-00015e80: 7365 6e74 7d22 290a 2020 2020 2020 2020  sent}").        
-00015e90: 2020 2020 696e 7465 7273 6563 7469 6f6e      intersection
-00015ea0: 203d 2063 7572 5f73 7461 7465 5f6c 6973   = cur_state_lis
-00015eb0: 742e 696e 7465 7273 6563 7469 6f6e 2872  t.intersection(r
-00015ec0: 6571 7569 7265 645f 6162 7365 6e74 290a  equired_absent).
-00015ed0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00015ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ef0: 206c 656e 2863 7572 5f73 7461 7465 5f6c   len(cur_state_l
-00015f00: 6973 7429 203d 3d20 300a 2020 2020 2020  ist) == 0.      
-00015f10: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
-00015f20: 7420 6f70 6572 6174 696f 6e2e 7479 7065  t operation.type
-00015f30: 2e6e 616d 6520 3d3d 2022 6c6f 6164 2220  .name == "load" 
-00015f40: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
-00015f50: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00015f60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00015f70: 6169 7365 2063 6f6c 7265 765f 6578 6365  aise colrev_exce
-00015f80: 7074 696f 6e73 2e4e 6f52 6563 6f72 6473  ptions.NoRecords
-00015f90: 4572 726f 7228 290a 2020 2020 2020 2020  Error().        
-00015fa0: 2020 2020 6966 206c 656e 2869 6e74 6572      if len(inter
-00015fb0: 7365 6374 696f 6e29 2021 3d20 303a 0a20  section) != 0:. 
-00015fc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00015fd0: 6169 7365 2063 6f6c 7265 765f 6578 6365  aise colrev_exce
-00015fe0: 7074 696f 6e73 2e50 726f 6365 7373 4f72  ptions.ProcessOr
-00015ff0: 6465 7256 696f 6c61 7469 6f6e 280a 2020  derViolation(.  
-00016000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016010: 2020 6f70 6572 6174 696f 6e2e 7479 7065    operation.type
-00016020: 2e6e 616d 652c 2073 7472 2873 7461 7465  .name, str(state
-00016030: 292c 206c 6973 7428 696e 7465 7273 6563  ), list(intersec
-00016040: 7469 6f6e 290a 2020 2020 2020 2020 2020  tion).          
-00016050: 2020 2020 2020 290a 0a0a 6966 205f 5f6e        )...if __n
-00016060: 616d 655f 5f20 3d3d 2022 5f5f 6d61 696e  ame__ == "__main
-00016070: 5f5f 223a 0a20 2020 2070 6173 730a       __":.    pass.
+0000e960: 2020 2020 2020 2061 6e64 2072 6563 2e67         and rec.g
+0000e970: 6574 286b 6579 2c20 2222 2920 213d 2022  et(key, "") != "
+0000e980: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000e990: 2020 2020 2020 2020 2020 616e 6420 7072            and pr
+0000e9a0: 6576 5f76 616c 2021 3d20 2222 0a20 2020  ev_val != "".   
+0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9c0: 2020 2020 2061 6e64 2072 6563 5b6b 6579       and rec[key
+0000e9d0: 5d20 6973 206e 6f74 204e 6f6e 650a 2020  ] is not None.  
+0000e9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9f0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000ea00: 2020 2020 2020 2020 2020 2020 2073 696d               sim
+0000ea10: 696c 6172 6974 7920 3d20 6675 7a7a 2e70  ilarity = fuzz.p
+0000ea20: 6172 7469 616c 5f72 6174 696f 2870 7265  artial_ratio(pre
+0000ea30: 765f 7661 6c2c 2072 6563 5b6b 6579 5d29  v_val, rec[key])
+0000ea40: 202f 2031 3030 0a20 2020 2020 2020 2020   / 100.         
+0000ea50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000ea60: 204e 6f74 6520 3a20 7468 6520 6675 7a7a   Note : the fuzz
+0000ea70: 2e70 6172 7469 616c 5f72 6174 696f 2077  .partial_ratio w
+0000ea80: 6f72 6b73 2062 6574 7465 7220 666f 7220  orks better for 
+0000ea90: 7061 7274 6961 6c20 7375 6273 7472 696e  partial substrin
+0000eaa0: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
+0000eab0: 2020 2020 2020 2020 2020 2023 2066 726f             # fro
+0000eac0: 6d20 6469 6666 6c69 6220 696d 706f 7274  m difflib import
+0000ead0: 2053 6571 7565 6e63 654d 6174 6368 6572   SequenceMatcher
+0000eae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eaf0: 2020 2020 2020 2020 2023 2073 696d 696c           # simil
+0000eb00: 6172 6974 7920 3d20 5365 7175 656e 6365  arity = Sequence
+0000eb10: 4d61 7463 6865 7228 4e6f 6e65 2c20 7072  Matcher(None, pr
+0000eb20: 6576 5f76 616c 2c20 7265 635b 6b65 795d  ev_val, rec[key]
+0000eb30: 292e 7261 7469 6f28 290a 2020 2020 2020  ).ratio().      
+0000eb40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000eb50: 2073 696d 696c 6172 6974 7920 3c20 302e   similarity < 0.
+0000eb60: 3520 6f72 206b 6579 2069 6e20 5b0a 2020  5 or key in [.  
+0000eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb80: 2020 2020 2020 2276 6f6c 756d 6522 2c0a        "volume",.
+0000eb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eba0: 2020 2020 2020 2020 226e 756d 6265 7222          "number"
+0000ebb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ebc0: 2020 2020 2020 2020 2020 2279 6561 7222            "year"
+0000ebd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ebe0: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
+0000ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec00: 206c 696e 6520 3d20 6622 7b63 6f6c 6f72   line = f"{color
+0000ec10: 732e 5245 447d 7b72 6563 2e67 6574 286b  s.RED}{rec.get(k
+0000ec20: 6579 2c20 2727 297d 7b63 6f6c 6f72 732e  ey, '')}{colors.
+0000ec30: 454e 447d 220a 2020 2020 2020 2020 2020  END}".          
+0000ec40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec60: 2020 2020 2020 2020 6c69 6e65 203d 2070          line = p
+0000ec70: 7269 6e74 5f64 6966 6628 2870 7265 765f  rint_diff((prev_
+0000ec80: 7661 6c2c 2072 6563 2e67 6574 286b 6579  val, rec.get(key
+0000ec90: 2c20 2222 2929 290a 2020 2020 2020 2020  , ""))).        
+0000eca0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+0000ecb0: 7b6b 6579 7d20 3a20 7b6c 696e 657d 2229  {key} : {line}")
+0000ecc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ecd0: 2070 7265 765f 7661 6c20 3d20 7265 632e   prev_val = rec.
+0000ece0: 6765 7428 6b65 792c 2022 2229 0a20 2020  get(key, "").   
+0000ecf0: 2020 2020 2020 2020 2070 7269 6e74 2829           print()
+0000ed00: 0a0a 2020 2020 6465 6620 636c 6561 6e75  ..    def cleanu
+0000ed10: 705f 7064 665f 7072 6f63 6573 7369 6e67  p_pdf_processing
+0000ed20: 5f66 6965 6c64 7328 7365 6c66 2920 2d3e  _fields(self) ->
+0000ed30: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000ed40: 2222 436c 6561 6e75 7020 7468 6520 5044  ""Cleanup the PD
+0000ed50: 4620 7072 6f63 6573 7369 6e67 2066 6965  F processing fie
+0000ed60: 6c73 2028 7465 7874 5f66 726f 6d5f 7064  ls (text_from_pd
+0000ed70: 662c 2070 6167 6573 5f69 6e5f 6669 6c65  f, pages_in_file
+0000ed80: 2922 2222 0a20 2020 2020 2020 2069 6620  )""".        if 
+0000ed90: 2274 6578 745f 6672 6f6d 5f70 6466 2220  "text_from_pdf" 
+0000eda0: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
+0000edb0: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
+0000edc0: 6c66 2e64 6174 615b 2274 6578 745f 6672  lf.data["text_fr
+0000edd0: 6f6d 5f70 6466 225d 0a20 2020 2020 2020  om_pdf"].       
+0000ede0: 2069 6620 2270 6167 6573 5f69 6e5f 6669   if "pages_in_fi
+0000edf0: 6c65 2220 696e 2073 656c 662e 6461 7461  le" in self.data
+0000ee00: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+0000ee10: 6c20 7365 6c66 2e64 6174 615b 2270 6167  l self.data["pag
+0000ee20: 6573 5f69 6e5f 6669 6c65 225d 0a0a 2020  es_in_file"]..  
+0000ee30: 2020 6465 6620 7570 6461 7465 5f6d 6173    def update_mas
+0000ee40: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+0000ee50: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
+0000ee60: 2c20 2a2c 2071 6d3a 2063 6f6c 7265 762e  , *, qm: colrev.
+0000ee70: 716d 2e71 7561 6c69 7479 5f6d 6f64 656c  qm.quality_model
+0000ee80: 2e51 7561 6c69 7479 4d6f 6465 6c2c 2073  .QualityModel, s
+0000ee90: 6574 5f70 7265 7061 7265 643a 2062 6f6f  et_prepared: boo
+0000eea0: 6c20 3d20 4661 6c73 650a 2020 2020 2920  l = False.    ) 
+0000eeb0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000eec0: 2022 2222 5570 6461 7465 2074 6865 206d   """Update the m
+0000eed0: 6173 7465 7264 6174 6120 7072 6f76 656e  asterdata proven
+0000eee0: 616e 6365 2222 220a 0a20 2020 2020 2020  ance"""..       
+0000eef0: 2069 6620 2263 6f6c 7265 765f 6d61 7374   if "colrev_mast
+0000ef00: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+0000ef10: 6522 206e 6f74 2069 6e20 7365 6c66 2e64  e" not in self.d
+0000ef20: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+0000ef30: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+0000ef40: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+0000ef50: 6f76 656e 616e 6365 225d 203d 207b 7d0a  ovenance"] = {}.
+0000ef60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000ef70: 2e6d 6173 7465 7264 6174 615f 6973 5f63  .masterdata_is_c
+0000ef80: 7572 6174 6564 2829 3a0a 2020 2020 2020  urated():.      
+0000ef90: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0000efa0: 2020 2020 2020 2320 4170 706c 7920 7468        # Apply th
+0000efb0: 6520 6368 6563 6b65 7273 2028 696e 636c  e checkers (incl
+0000efc0: 7564 696e 6720 6669 656c 6420 6b65 7920  uding field key 
+0000efd0: 7265 7175 6972 656d 656e 7473 2065 7463  requirements etc
+0000efe0: 2e29 0a20 2020 2020 2020 2071 6d2e 7275  .).        qm.ru
+0000eff0: 6e28 7265 636f 7264 3d73 656c 6629 0a0a  n(record=self)..
+0000f000: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000f010: 6861 735f 7175 616c 6974 795f 6465 6665  has_quality_defe
+0000f020: 6374 7328 293a 0a20 2020 2020 2020 2020  cts():.         
+0000f030: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+0000f040: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
+0000f050: 5265 636f 7264 5374 6174 652e 6d64 5f6e  RecordState.md_n
+0000f060: 6565 6473 5f6d 616e 7561 6c5f 7072 6570  eeds_manual_prep
+0000f070: 6172 6174 696f 6e29 0a20 2020 2020 2020  aration).       
+0000f080: 2065 6c69 6620 7365 745f 7072 6570 6172   elif set_prepar
+0000f090: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0000f0a0: 7365 6c66 2e73 6574 5f73 7461 7475 7328  self.set_status(
+0000f0b0: 7461 7267 6574 5f73 7461 7465 3d52 6563  target_state=Rec
+0000f0c0: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
+0000f0d0: 6172 6564 290a 0a20 2020 2064 6566 2063  ared)..    def c
+0000f0e0: 6865 636b 5f70 6f74 656e 7469 616c 5f72  heck_potential_r
+0000f0f0: 6574 7261 6374 7328 7365 6c66 2920 2d3e  etracts(self) ->
+0000f100: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+0000f110: 2222 4368 6563 6b20 666f 7220 706f 7465  ""Check for pote
+0000f120: 6e74 6961 6c20 7265 7472 6163 7473 2222  ntial retracts""
+0000f130: 220a 2020 2020 2020 2020 2320 4e6f 7465  ".        # Note
+0000f140: 203a 2077 6520 7265 7472 6965 7665 6420   : we retrieved 
+0000f150: 6d65 7461 6461 7461 2069 6e20 6765 745f  metadata in get_
+0000f160: 6d61 7374 6572 6461 7461 5f66 726f 6d5f  masterdata_from_
+0000f170: 6372 6f73 7372 6566 2829 0a20 2020 2020  crossref().     
+0000f180: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
+0000f190: 6765 7428 2263 726f 7373 6d61 726b 222c  get("crossmark",
+0000f1a0: 2022 2229 203d 3d20 2254 7275 6522 3a0a   "") == "True":.
+0000f1b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f1c0: 2e70 7265 7363 7265 656e 5f65 7863 6c75  .prescreen_exclu
+0000f1d0: 6465 2872 6561 736f 6e3d 2272 6574 7261  de(reason="retra
+0000f1e0: 6374 6564 222c 2070 7269 6e74 5f77 6172  cted", print_war
+0000f1f0: 6e69 6e67 3d54 7275 6529 0a20 2020 2020  ning=True).     
+0000f200: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
+0000f210: 7665 5f66 6965 6c64 286b 6579 3d22 6372  ve_field(key="cr
+0000f220: 6f73 736d 6172 6b22 290a 2020 2020 2020  ossmark").      
+0000f230: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0000f240: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
+0000f250: 662e 6461 7461 2e67 6574 2822 7761 726e  f.data.get("warn
+0000f260: 696e 6722 2c20 2222 2920 3d3d 2022 5769  ing", "") == "Wi
+0000f270: 7468 6472 6177 6e20 2861 6363 6f72 6469  thdrawn (accordi
+0000f280: 6e67 2074 6f20 4442 4c50 2922 3a0a 2020  ng to DBLP)":.  
+0000f290: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000f2a0: 7265 7363 7265 656e 5f65 7863 6c75 6465  rescreen_exclude
+0000f2b0: 2872 6561 736f 6e3d 2272 6574 7261 6374  (reason="retract
+0000f2c0: 6564 222c 2070 7269 6e74 5f77 6172 6e69  ed", print_warni
+0000f2d0: 6e67 3d54 7275 6529 0a20 2020 2020 2020  ng=True).       
+0000f2e0: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
+0000f2f0: 5f66 6965 6c64 286b 6579 3d22 7761 726e  _field(key="warn
+0000f300: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+0000f310: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0000f320: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000f330: 7365 0a0a 2020 2020 6465 6620 7072 696e  se..    def prin
+0000f340: 745f 7072 6573 6372 6565 6e5f 7265 636f  t_prescreen_reco
+0000f350: 7264 2873 656c 6629 202d 3e20 4e6f 6e65  rd(self) -> None
+0000f360: 3a0a 2020 2020 2020 2020 2222 2250 7269  :.        """Pri
+0000f370: 6e74 2074 6865 2072 6563 6f72 6420 666f  nt the record fo
+0000f380: 7220 7072 6573 6372 6565 6e20 6f70 6572  r prescreen oper
+0000f390: 6174 696f 6e73 2222 220a 0a20 2020 2020  ations"""..     
+0000f3a0: 2020 2072 6574 5f73 7472 203d 2066 2220     ret_str = f" 
+0000f3b0: 2049 443a 207b 7365 6c66 2e64 6174 615b   ID: {self.data[
+0000f3c0: 2749 4427 5d7d 2028 7b73 656c 662e 6461  'ID']} ({self.da
+0000f3d0: 7461 5b27 454e 5452 5954 5950 4527 5d7d  ta['ENTRYTYPE']}
+0000f3e0: 2922 0a20 2020 2020 2020 2072 6574 5f73  )".        ret_s
+0000f3f0: 7472 202b 3d20 280a 2020 2020 2020 2020  tr += (.        
+0000f400: 2020 2020 6622 5c6e 2020 7b63 6f6c 6f72      f"\n  {color
+0000f410: 732e 4752 4545 4e7d 7b73 656c 662e 6461  s.GREEN}{self.da
+0000f420: 7461 2e67 6574 2827 7469 746c 6527 2c20  ta.get('title', 
+0000f430: 276e 6f20 7469 746c 6527 297d 7b63 6f6c  'no title')}{col
+0000f440: 6f72 732e 454e 447d 220a 2020 2020 2020  ors.END}".      
+0000f450: 2020 2020 2020 6622 5c6e 2020 7b73 656c        f"\n  {sel
+0000f460: 662e 6461 7461 2e67 6574 2827 6175 7468  f.data.get('auth
+0000f470: 6f72 272c 2027 6e6f 2d61 7574 686f 7227  or', 'no-author'
+0000f480: 297d 220a 2020 2020 2020 2020 290a 2020  )}".        ).  
+0000f490: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
+0000f4a0: 7461 5b22 454e 5452 5954 5950 4522 5d20  ta["ENTRYTYPE"] 
+0000f4b0: 3d3d 2022 6172 7469 636c 6522 3a0a 2020  == "article":.  
+0000f4c0: 2020 2020 2020 2020 2020 7265 745f 7374            ret_st
+0000f4d0: 7220 2b3d 2028 0a20 2020 2020 2020 2020  r += (.         
+0000f4e0: 2020 2020 2020 2066 225c 6e20 207b 7365         f"\n  {se
+0000f4f0: 6c66 2e64 6174 612e 6765 7428 276a 6f75  lf.data.get('jou
+0000f500: 726e 616c 272c 2027 6e6f 2d6a 6f75 726e  rnal', 'no-journ
+0000f510: 616c 2729 7d20 220a 2020 2020 2020 2020  al')} ".        
+0000f520: 2020 2020 2020 2020 6622 287b 7365 6c66          f"({self
+0000f530: 2e64 6174 612e 6765 7428 2779 6561 7227  .data.get('year'
+0000f540: 2c20 276e 6f2d 7965 6172 2729 7d29 2022  , 'no-year')}) "
+0000f550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f560: 2066 227b 7365 6c66 2e64 6174 612e 6765   f"{self.data.ge
+0000f570: 7428 2776 6f6c 756d 6527 2c20 276e 6f2d  t('volume', 'no-
+0000f580: 766f 6c75 6d65 2729 7d22 0a20 2020 2020  volume')}".     
+0000f590: 2020 2020 2020 2020 2020 2066 2228 7b73             f"({s
+0000f5a0: 656c 662e 6461 7461 2e67 6574 2827 6e75  elf.data.get('nu
+0000f5b0: 6d62 6572 272c 2027 2729 7d29 220a 2020  mber', '')})".  
+0000f5c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000f5d0: 2020 2020 656c 6966 2073 656c 662e 6461      elif self.da
+0000f5e0: 7461 5b22 454e 5452 5954 5950 4522 5d20  ta["ENTRYTYPE"] 
+0000f5f0: 3d3d 2022 696e 7072 6f63 6565 6469 6e67  == "inproceeding
+0000f600: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+0000f610: 7265 745f 7374 7220 2b3d 2066 225c 6e20  ret_str += f"\n 
+0000f620: 207b 7365 6c66 2e64 6174 612e 6765 7428   {self.data.get(
+0000f630: 2762 6f6f 6b74 6974 6c65 272c 2027 6e6f  'booktitle', 'no
+0000f640: 2d62 6f6f 6b74 6974 6c65 2729 7d22 0a20  -booktitle')}". 
+0000f650: 2020 2020 2020 2069 6620 2261 6273 7472         if "abstr
+0000f660: 6163 7422 2069 6e20 7365 6c66 2e64 6174  act" in self.dat
+0000f670: 613a 0a20 2020 2020 2020 2020 2020 206c  a:.            l
+0000f680: 696e 6573 203d 2074 6578 7477 7261 702e  ines = textwrap.
+0000f690: 7772 6170 2873 656c 662e 6461 7461 5b22  wrap(self.data["
+0000f6a0: 6162 7374 7261 6374 225d 2c20 3130 302c  abstract"], 100,
+0000f6b0: 2062 7265 616b 5f6c 6f6e 675f 776f 7264   break_long_word
+0000f6c0: 733d 4661 6c73 6529 0a20 2020 2020 2020  s=False).       
+0000f6d0: 2020 2020 2069 6620 6c69 6e65 733a 0a20       if lines:. 
+0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000f6f0: 6574 5f73 7472 202b 3d20 6622 5c6e 2020  et_str += f"\n  
+0000f700: 4162 7374 7261 6374 3a20 7b6c 696e 6573  Abstract: {lines
+0000f710: 2e70 6f70 2830 297d 5c6e 220a 2020 2020  .pop(0)}\n".    
+0000f720: 2020 2020 2020 2020 2020 2020 7265 745f              ret_
+0000f730: 7374 7220 2b3d 2022 5c6e 2020 222e 6a6f  str += "\n  ".jo
+0000f740: 696e 286c 696e 6573 2920 2b20 2222 0a0a  in(lines) + ""..
+0000f750: 2020 2020 2020 2020 6966 2022 7572 6c22          if "url"
+0000f760: 2069 6e20 7365 6c66 2e64 6174 613a 0a20   in self.data:. 
+0000f770: 2020 2020 2020 2020 2020 2072 6574 5f73             ret_s
+0000f780: 7472 202b 3d20 6622 5c6e 2020 7572 6c3a  tr += f"\n  url:
+0000f790: 207b 7365 6c66 2e64 6174 615b 2775 726c   {self.data['url
+0000f7a0: 275d 7d22 0a0a 2020 2020 2020 2020 6966  ']}"..        if
+0000f7b0: 2022 6669 6c65 2220 696e 2073 656c 662e   "file" in self.
+0000f7c0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0000f7d0: 2020 7265 745f 7374 7220 2b3d 2066 225c    ret_str += f"\
+0000f7e0: 6e20 2066 696c 653a 207b 7365 6c66 2e64  n  file: {self.d
+0000f7f0: 6174 615b 2766 696c 6527 5d7d 220a 0a20  ata['file']}".. 
+0000f800: 2020 2020 2020 2070 7269 6e74 2872 6574         print(ret
+0000f810: 5f73 7472 290a 0a20 2020 2064 6566 2070  _str)..    def p
+0000f820: 7269 6e74 5f70 6466 5f70 7265 705f 6d61  rint_pdf_prep_ma
+0000f830: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
+0000f840: 0a20 2020 2020 2020 2022 2222 5072 696e  .        """Prin
+0000f850: 7420 7468 6520 7265 636f 7264 2066 6f72  t the record for
+0000f860: 2070 6466 2d70 7265 702d 6d61 6e20 6f70   pdf-prep-man op
+0000f870: 6572 6174 696f 6e73 2222 220a 2020 2020  erations""".    
+0000f880: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
+0000f890: 7361 626c 653d 746f 6f2d 6d61 6e79 2d62  sable=too-many-b
+0000f8a0: 7261 6e63 6865 730a 2020 2020 2020 2020  ranches.        
+0000f8b0: 7265 745f 7374 7220 3d20 2222 0a20 2020  ret_str = "".   
+0000f8c0: 2020 2020 2069 6620 2266 696c 6522 2069       if "file" i
+0000f8d0: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
+0000f8e0: 2020 2020 2020 2020 2072 6574 5f73 7472           ret_str
+0000f8f0: 202b 3d20 6622 5c6e 6669 6c65 3a20 7b63   += f"\nfile: {c
+0000f900: 6f6c 6f72 732e 4f52 414e 4745 7d7b 7365  olors.ORANGE}{se
+0000f910: 6c66 2e64 6174 615b 2766 696c 6527 5d7d  lf.data['file']}
+0000f920: 7b63 6f6c 6f72 732e 454e 447d 5c6e 5c6e  {colors.END}\n\n
+0000f930: 220a 0a20 2020 2020 2020 2070 6466 5f70  "..        pdf_p
+0000f940: 7265 705f 6e6f 7465 203d 2073 656c 662e  rep_note = self.
+0000f950: 6765 745f 6669 656c 645f 7072 6f76 656e  get_field_proven
+0000f960: 616e 6365 286b 6579 3d22 6669 6c65 2229  ance(key="file")
+0000f970: 0a0a 2020 2020 2020 2020 6966 2022 6175  ..        if "au
+0000f980: 7468 6f72 5f6e 6f74 5f69 6e5f 6669 7273  thor_not_in_firs
+0000f990: 745f 7061 6765 7322 2069 6e20 7064 665f  t_pages" in pdf_
+0000f9a0: 7072 6570 5f6e 6f74 655b 226e 6f74 6522  prep_note["note"
+0000f9b0: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
+0000f9c0: 6574 5f73 7472 202b 3d20 280a 2020 2020  et_str += (.    
+0000f9d0: 2020 2020 2020 2020 2020 2020 6622 7b63              f"{c
+0000f9e0: 6f6c 6f72 732e 5245 447d 7b73 656c 662e  olors.RED}{self.
+0000f9f0: 6461 7461 2e67 6574 2827 6175 7468 6f72  data.get('author
+0000fa00: 272c 2027 6e6f 2d61 7574 686f 7227 297d  ', 'no-author')}
+0000fa10: 7b63 6f6c 6f72 732e 454e 447d 5c6e 220a  {colors.END}\n".
+0000fa20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000fa30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000fa40: 2020 2020 2020 2020 7265 745f 7374 7220          ret_str 
+0000fa50: 2b3d 2028 0a20 2020 2020 2020 2020 2020  += (.           
+0000fa60: 2020 2020 2066 227b 636f 6c6f 7273 2e47       f"{colors.G
+0000fa70: 5245 454e 7d7b 7365 6c66 2e64 6174 612e  REEN}{self.data.
+0000fa80: 6765 7428 2761 7574 686f 7227 2c20 276e  get('author', 'n
+0000fa90: 6f2d 6175 7468 6f72 2729 7d7b 636f 6c6f  o-author')}{colo
+0000faa0: 7273 2e45 4e44 7d5c 6e22 0a20 2020 2020  rs.END}\n".     
+0000fab0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000fac0: 2020 6966 2022 7469 746c 655f 6e6f 745f    if "title_not_
+0000fad0: 696e 5f66 6972 7374 5f70 6167 6573 2220  in_first_pages" 
+0000fae0: 696e 2070 6466 5f70 7265 705f 6e6f 7465  in pdf_prep_note
+0000faf0: 5b22 6e6f 7465 225d 3a0a 2020 2020 2020  ["note"]:.      
+0000fb00: 2020 2020 2020 7265 745f 7374 7220 2b3d        ret_str +=
+0000fb10: 2066 227b 636f 6c6f 7273 2e52 4544 7d7b   f"{colors.RED}{
+0000fb20: 7365 6c66 2e64 6174 612e 6765 7428 2774  self.data.get('t
+0000fb30: 6974 6c65 272c 2027 6e6f 2074 6974 6c65  itle', 'no title
+0000fb40: 2729 7d7b 636f 6c6f 7273 2e45 4e44 7d5c  ')}{colors.END}\
+0000fb50: 6e22 0a20 2020 2020 2020 2065 6c73 653a  n".        else:
+0000fb60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000fb70: 5f73 7472 202b 3d20 280a 2020 2020 2020  _str += (.      
+0000fb80: 2020 2020 2020 2020 2020 6622 7b63 6f6c            f"{col
+0000fb90: 6f72 732e 4752 4545 4e7d 7b73 656c 662e  ors.GREEN}{self.
+0000fba0: 6461 7461 2e67 6574 2827 7469 746c 6527  data.get('title'
+0000fbb0: 2c20 276e 6f20 7469 746c 6527 297d 7b63  , 'no title')}{c
+0000fbc0: 6f6c 6f72 732e 454e 447d 5c6e 220a 2020  olors.END}\n".  
+0000fbd0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000fbe0: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
+0000fbf0: 615b 2245 4e54 5259 5459 5045 225d 203d  a["ENTRYTYPE"] =
+0000fc00: 3d20 2261 7274 6963 6c65 223a 0a20 2020  = "article":.   
+0000fc10: 2020 2020 2020 2020 2072 6574 5f73 7472           ret_str
+0000fc20: 202b 3d20 280a 2020 2020 2020 2020 2020   += (.          
+0000fc30: 2020 2020 2020 6622 7b73 656c 662e 6461        f"{self.da
+0000fc40: 7461 2e67 6574 2827 6a6f 7572 6e61 6c27  ta.get('journal'
+0000fc50: 2c20 276e 6f2d 6a6f 7572 6e61 6c27 297d  , 'no-journal')}
+0000fc60: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000fc70: 2020 2066 2228 7b73 656c 662e 6461 7461     f"({self.data
+0000fc80: 2e67 6574 2827 7965 6172 272c 2027 6e6f  .get('year', 'no
+0000fc90: 2d79 6561 7227 297d 2920 220a 2020 2020  -year')}) ".    
+0000fca0: 2020 2020 2020 2020 2020 2020 6622 7b73              f"{s
+0000fcb0: 656c 662e 6461 7461 2e67 6574 2827 766f  elf.data.get('vo
+0000fcc0: 6c75 6d65 272c 2027 6e6f 2d76 6f6c 756d  lume', 'no-volum
+0000fcd0: 6527 297d 220a 2020 2020 2020 2020 2020  e')}".          
+0000fce0: 2020 2020 2020 6622 287b 7365 6c66 2e64        f"({self.d
+0000fcf0: 6174 612e 6765 7428 276e 756d 6265 7227  ata.get('number'
+0000fd00: 2c20 2727 297d 2922 0a20 2020 2020 2020  , '')})".       
+0000fd10: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000fd20: 2020 2069 6620 2270 6167 6573 2220 696e     if "pages" in
+0000fd30: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
+0000fd40: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+0000fd50: 6e72 5f70 6167 6573 5f6e 6f74 5f6d 6174  nr_pages_not_mat
+0000fd60: 6368 696e 6722 2069 6e20 7064 665f 7072  ching" in pdf_pr
+0000fd70: 6570 5f6e 6f74 655b 226e 6f74 6522 5d3a  ep_note["note"]:
+0000fd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fd90: 2020 2020 2072 6574 5f73 7472 202b 3d20       ret_str += 
+0000fda0: 6622 2c20 7b63 6f6c 6f72 732e 5245 447d  f", {colors.RED}
+0000fdb0: 7070 2e7b 7365 6c66 2e64 6174 615b 2770  pp.{self.data['p
+0000fdc0: 6167 6573 275d 7d7b 636f 6c6f 7273 2e45  ages']}{colors.E
+0000fdd0: 4e44 7d5c 6e22 0a20 2020 2020 2020 2020  ND}\n".         
+0000fde0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe00: 2072 6574 5f73 7472 202b 3d20 6622 2c20   ret_str += f", 
+0000fe10: 7070 2e7b 636f 6c6f 7273 2e47 5245 454e  pp.{colors.GREEN
+0000fe20: 7d7b 7365 6c66 2e64 6174 615b 2770 6167  }{self.data['pag
+0000fe30: 6573 275d 7d7b 636f 6c6f 7273 2e45 4e44  es']}{colors.END
+0000fe40: 7d5c 6e22 0a20 2020 2020 2020 2020 2020  }\n".           
+0000fe50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000fe60: 2020 2020 2020 2072 6574 5f73 7472 202b         ret_str +
+0000fe70: 3d20 225c 6e22 0a20 2020 2020 2020 2065  = "\n".        e
+0000fe80: 6c69 6620 7365 6c66 2e64 6174 615b 2245  lif self.data["E
+0000fe90: 4e54 5259 5459 5045 225d 203d 3d20 2269  NTRYTYPE"] == "i
+0000fea0: 6e70 726f 6365 6564 696e 6773 223a 0a20  nproceedings":. 
+0000feb0: 2020 2020 2020 2020 2020 2072 6574 5f73             ret_s
+0000fec0: 7472 202b 3d20 6622 7b73 656c 662e 6461  tr += f"{self.da
+0000fed0: 7461 2e67 6574 2827 626f 6f6b 7469 746c  ta.get('booktitl
+0000fee0: 6527 2c20 276e 6f2d 626f 6f6b 7469 746c  e', 'no-booktitl
+0000fef0: 6527 297d 5c6e 220a 2020 2020 2020 2020  e')}\n".        
+0000ff00: 6966 2022 6162 7374 7261 6374 2220 696e  if "abstract" in
+0000ff10: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
+0000ff20: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
+0000ff30: 7465 7874 7772 6170 2e77 7261 7028 7365  textwrap.wrap(se
+0000ff40: 6c66 2e64 6174 615b 2261 6273 7472 6163  lf.data["abstrac
+0000ff50: 7422 5d2c 2031 3030 2c20 6272 6561 6b5f  t"], 100, break_
+0000ff60: 6c6f 6e67 5f77 6f72 6473 3d46 616c 7365  long_words=False
+0000ff70: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000ff80: 745f 7374 7220 2b3d 2066 225c 6e41 6273  t_str += f"\nAbs
+0000ff90: 7472 6163 743a 207b 6c69 6e65 732e 706f  tract: {lines.po
+0000ffa0: 7028 3029 7d5c 6e22 0a20 2020 2020 2020  p(0)}\n".       
+0000ffb0: 2020 2020 2072 6574 5f73 7472 202b 3d20       ret_str += 
+0000ffc0: 225c 6e22 2e6a 6f69 6e28 6c69 6e65 7329  "\n".join(lines)
+0000ffd0: 202b 2022 5c6e 220a 0a20 2020 2020 2020   + "\n"..       
+0000ffe0: 2069 6620 2275 726c 2220 696e 2073 656c   if "url" in sel
+0000fff0: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00010000: 2020 2020 7265 745f 7374 7220 2b3d 2066      ret_str += f
+00010010: 225c 6e75 726c 3a20 7b73 656c 662e 6461  "\nurl: {self.da
+00010020: 7461 5b27 7572 6c27 5d7d 5c6e 220a 0a20  ta['url']}\n".. 
+00010030: 2020 2020 2020 2070 7269 6e74 2872 6574         print(ret
+00010040: 5f73 7472 290a 0a0a 636c 6173 7320 5072  _str)...class Pr
+00010050: 6570 5265 636f 7264 2852 6563 6f72 6429  epRecord(Record)
+00010060: 3a0a 2020 2020 2222 2254 6865 2050 7265  :.    """The Pre
+00010070: 7052 6563 6f72 6420 636c 6173 7320 7072  pRecord class pr
+00010080: 6f76 6964 6573 2061 2072 616e 6765 206f  ovides a range o
+00010090: 6620 636f 6e76 656e 6965 6e63 6520 6675  f convenience fu
+000100a0: 6e63 7469 6f6e 7320 666f 7220 7265 636f  nctions for reco
+000100b0: 7264 2070 7265 7061 7261 7469 6f6e 2222  rd preparation""
+000100c0: 220a 0a20 2020 2040 636c 6173 736d 6574  "..    @classmet
+000100d0: 686f 640a 2020 2020 6465 6620 666f 726d  hod.    def form
+000100e0: 6174 5f61 7574 686f 725f 6669 656c 6428  at_author_field(
+000100f0: 636c 732c 202a 2c20 696e 7075 745f 7374  cls, *, input_st
+00010100: 7269 6e67 3a20 7374 7229 202d 3e20 7374  ring: str) -> st
+00010110: 723a 0a20 2020 2020 2020 2022 2222 466f  r:.        """Fo
+00010120: 726d 6174 2074 6865 2061 7574 686f 7220  rmat the author 
+00010130: 6669 656c 6420 2872 6563 6f67 6e69 7a69  field (recognizi
+00010140: 6e67 2066 6972 7374 2f6c 6173 7420 6e61  ng first/last na
+00010150: 6d65 7320 6261 7365 6420 6f6e 2048 756d  mes based on Hum
+00010160: 616e 4e61 6d65 2070 6172 7365 7229 2222  anName parser)""
+00010170: 220a 0a20 2020 2020 2020 2064 6566 206d  "..        def m
+00010180: 6f73 746c 795f 7570 7065 725f 6361 7365  ostly_upper_case
+00010190: 2869 6e70 7574 5f73 7472 696e 673a 2073  (input_string: s
+000101a0: 7472 2920 2d3e 2062 6f6f 6c3a 0a20 2020  tr) -> bool:.   
+000101b0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000101c0: 7265 2e6d 6174 6368 2872 225b 612d 7a41  re.match(r"[a-zA
+000101d0: 2d5a 5d2b 222c 2069 6e70 7574 5f73 7472  -Z]+", input_str
+000101e0: 696e 6729 3a0a 2020 2020 2020 2020 2020  ing):.          
+000101f0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00010200: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
+00010210: 6e70 7574 5f73 7472 696e 6720 3d20 696e  nput_string = in
+00010220: 7075 745f 7374 7269 6e67 2e72 6570 6c61  put_string.repla
+00010230: 6365 2822 2e22 2c20 2222 292e 7265 706c  ce(".", "").repl
+00010240: 6163 6528 222c 222c 2022 2229 0a20 2020  ace(",", "").   
+00010250: 2020 2020 2020 2020 2077 6f72 6473 203d           words =
+00010260: 2069 6e70 7574 5f73 7472 696e 672e 7370   input_string.sp
+00010270: 6c69 7428 290a 2020 2020 2020 2020 2020  lit().          
+00010280: 2020 7265 7475 726e 2073 756d 2877 6f72    return sum(wor
+00010290: 642e 6973 7570 7065 7228 2920 666f 7220  d.isupper() for 
+000102a0: 776f 7264 2069 6e20 776f 7264 7329 202f  word in words) /
+000102b0: 206c 656e 2877 6f72 6473 2920 3e20 302e   len(words) > 0.
+000102c0: 380a 0a20 2020 2020 2020 2069 6e70 7574  8..        input
+000102d0: 5f73 7472 696e 6720 3d20 696e 7075 745f  _string = input_
+000102e0: 7374 7269 6e67 2e72 6570 6c61 6365 2822  string.replace("
+000102f0: 5c6e 222c 2022 2022 290a 2020 2020 2020  \n", " ").      
+00010300: 2020 2320 4442 4c50 2061 7070 656e 6473    # DBLP appends
+00010310: 2069 6465 6e74 6966 6965 7273 2074 6f20   identifiers to 
+00010320: 6e6f 6e2d 756e 6971 7565 2061 7574 686f  non-unique autho
+00010330: 7273 0a20 2020 2020 2020 2069 6e70 7574  rs.        input
+00010340: 5f73 7472 696e 6720 3d20 7374 7228 7265  _string = str(re
+00010350: 2e73 7562 2872 225b 302d 395d 7b34 7d22  .sub(r"[0-9]{4}"
+00010360: 2c20 2222 2c20 696e 7075 745f 7374 7269  , "", input_stri
+00010370: 6e67 2929 0a0a 2020 2020 2020 2020 6966  ng))..        if
+00010380: 2022 2061 6e64 2022 2069 6e20 696e 7075   " and " in inpu
+00010390: 745f 7374 7269 6e67 3a0a 2020 2020 2020  t_string:.      
+000103a0: 2020 2020 2020 6e61 6d65 7320 3d20 696e        names = in
+000103b0: 7075 745f 7374 7269 6e67 2e73 706c 6974  put_string.split
+000103c0: 2822 2061 6e64 2022 290a 2020 2020 2020  (" and ").      
+000103d0: 2020 656c 6966 2069 6e70 7574 5f73 7472    elif input_str
+000103e0: 696e 672e 636f 756e 7428 222c 2229 203e  ing.count(",") >
+000103f0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00010400: 6e61 6d65 7320 3d20 696e 7075 745f 7374  names = input_st
+00010410: 7269 6e67 2e73 706c 6974 2822 2c20 2229  ring.split(", ")
+00010420: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00010430: 2020 2020 2020 2020 2020 206e 616d 6573             names
+00010440: 203d 205b 696e 7075 745f 7374 7269 6e67   = [input_string
+00010450: 5d0a 2020 2020 2020 2020 6175 7468 6f72  ].        author
+00010460: 5f73 7472 696e 6720 3d20 2222 0a20 2020  _string = "".   
+00010470: 2020 2020 2066 6f72 206e 616d 6520 696e       for name in
+00010480: 206e 616d 6573 3a0a 2020 2020 2020 2020   names:.        
+00010490: 2020 2020 2320 4e6f 7465 3a20 6874 7470      # Note: http
+000104a0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f64  s://github.com/d
+000104b0: 6572 656b 3733 2f70 7974 686f 6e2d 6e61  erek73/python-na
+000104c0: 6d65 7061 7273 6572 0a20 2020 2020 2020  meparser.       
+000104d0: 2020 2020 2023 2069 7320 7665 7279 2065       # is very e
+000104e0: 6666 6563 7469 7665 2028 6d61 7962 6520  ffective (maybe 
+000104f0: 6e6f 7420 7065 7266 6563 7429 0a0a 2020  not perfect)..  
+00010500: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
+00010510: 5f6e 616d 6520 3d20 4875 6d61 6e4e 616d  _name = HumanNam
+00010520: 6528 6e61 6d65 290a 2020 2020 2020 2020  e(name).        
+00010530: 2020 2020 6966 206d 6f73 746c 795f 7570      if mostly_up
+00010540: 7065 725f 6361 7365 2869 6e70 7574 5f73  per_case(input_s
+00010550: 7472 696e 672e 7265 706c 6163 6528 2220  tring.replace(" 
+00010560: 616e 6420 222c 2022 2229 2e72 6570 6c61  and ", "").repla
+00010570: 6365 2822 4a72 222c 2022 2229 293a 0a20  ce("Jr", "")):. 
+00010580: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00010590: 6172 7365 645f 6e61 6d65 2e63 6170 6974  arsed_name.capit
+000105a0: 616c 697a 6528 666f 7263 653d 5472 7565  alize(force=True
+000105b0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+000105c0: 2046 6978 2074 7970 6963 616c 2070 6172   Fix typical par
+000105d0: 7365 7220 6572 726f 720a 2020 2020 2020  ser error.      
+000105e0: 2020 2020 2020 6966 2070 6172 7365 645f        if parsed_
+000105f0: 6e61 6d65 2e6c 6173 7420 3d3d 2022 2220  name.last == "" 
+00010600: 616e 6420 7061 7273 6564 5f6e 616d 652e  and parsed_name.
+00010610: 7469 746c 6520 213d 2022 223a 0a20 2020  title != "":.   
+00010620: 2020 2020 2020 2020 2020 2020 2070 6172               par
+00010630: 7365 645f 6e61 6d65 2e6c 6173 7420 3d20  sed_name.last = 
+00010640: 7061 7273 6564 5f6e 616d 652e 7469 746c  parsed_name.titl
+00010650: 650a 0a20 2020 2020 2020 2020 2020 2023  e..            #
+00010660: 2070 796c 696e 743a 2064 6973 6162 6c65   pylint: disable
+00010670: 3d63 6861 696e 6564 2d63 6f6d 7061 7269  =chained-compari
+00010680: 736f 6e0a 2020 2020 2020 2020 2020 2020  son.            
+00010690: 2320 4669 783a 2077 6865 6e20 6669 7273  # Fix: when firs
+000106a0: 7420 6e61 6d65 7320 6172 6520 6162 6272  t names are abbr
+000106b0: 6576 6961 7465 642c 206e 616d 6570 6172  eviated, namepar
+000106c0: 7365 7220 6372 6561 7465 7320 6572 726f  ser creates erro
+000106d0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+000106e0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+000106f0: 2020 2020 206c 656e 2870 6172 7365 645f       len(parsed_
+00010700: 6e61 6d65 2e6c 6173 7429 203c 3d20 330a  name.last) <= 3.
+00010710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010720: 616e 6420 7061 7273 6564 5f6e 616d 652e  and parsed_name.
+00010730: 6c61 7374 2e69 7375 7070 6572 2829 0a20  last.isupper(). 
+00010740: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00010750: 6e64 206c 656e 2870 6172 7365 645f 6e61  nd len(parsed_na
+00010760: 6d65 2e66 6972 7374 2920 3e20 330a 2020  me.first) > 3.  
+00010770: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00010780: 6420 6e6f 7420 7061 7273 6564 5f6e 616d  d not parsed_nam
+00010790: 652e 6669 7273 742e 6973 7570 7065 7228  e.first.isupper(
+000107a0: 290a 2020 2020 2020 2020 2020 2020 293a  ).            ):
+000107b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000107c0: 2023 2069 6e20 7468 6573 6520 6361 7365   # in these case
+000107d0: 6573 2c20 6669 7273 7420 616e 6420 6c61  es, first and la
+000107e0: 7374 206e 616d 6573 2061 7265 2063 6f6e  st names are con
+000107f0: 6675 7365 640a 2020 2020 2020 2020 2020  fused.          
+00010800: 2020 2020 2020 6175 7468 6f72 5f6e 616d        author_nam
+00010810: 655f 7374 7269 6e67 203d 2070 6172 7365  e_string = parse
+00010820: 645f 6e61 6d65 2e66 6972 7374 202b 2022  d_name.first + "
+00010830: 2c20 2220 2b20 7061 7273 6564 5f6e 616d  , " + parsed_nam
+00010840: 652e 6c61 7374 0a20 2020 2020 2020 2020  e.last.         
+00010850: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00010860: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
+00010870: 6e61 6d65 2e73 7472 696e 675f 666f 726d  name.string_form
+00010880: 6174 203d 2022 7b6c 6173 747d 207b 7375  at = "{last} {su
+00010890: 6666 6978 7d2c 207b 6669 7273 747d 207b  ffix}, {first} {
+000108a0: 6d69 6464 6c65 7d22 0a20 2020 2020 2020  middle}".       
+000108b0: 2020 2020 2020 2020 2023 2027 7b6c 6173           # '{las
+000108c0: 747d 207b 7375 6666 6978 7d2c 207b 6669  t} {suffix}, {fi
+000108d0: 7273 747d 2028 7b6e 6963 6b6e 616d 657d  rst} ({nickname}
+000108e0: 2920 7b6d 6964 646c 657d 270a 2020 2020  ) {middle}'.    
+000108f0: 2020 2020 2020 2020 2020 2020 6175 7468              auth
+00010900: 6f72 5f6e 616d 655f 7374 7269 6e67 203d  or_name_string =
+00010910: 2073 7472 2870 6172 7365 645f 6e61 6d65   str(parsed_name
+00010920: 292e 7265 706c 6163 6528 2220 2c20 222c  ).replace(" , ",
+00010930: 2022 2c20 2229 0a20 2020 2020 2020 2020   ", ").         
+00010940: 2020 2020 2020 2023 204e 6f74 653a 2074         # Note: t
+00010950: 6865 7265 2061 7265 2065 7272 6f72 7320  here are errors 
+00010960: 666f 7220 7468 6520 666f 6c6c 6f77 696e  for the followin
+00010970: 6720 6175 7468 6f72 3a0a 2020 2020 2020  g author:.      
+00010980: 2020 2020 2020 2020 2020 2320 4a52 2043            # JR C
+00010990: 726f 6d77 656c 6c20 616e 6420 484b 2047  romwell and HK G
+000109a0: 6172 646e 6572 0a20 2020 2020 2020 2020  ardner.         
+000109b0: 2020 2020 2020 2023 2054 6865 204a 5220         # The JR 
+000109c0: 6973 2070 726f 6261 626c 7920 7265 636f  is probably reco
+000109d0: 676e 697a 6564 2061 7320 4a75 6e69 6f72  gnized as Junior
+000109e0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000109f0: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
+00010a00: 7220 7468 6973 2069 7320 6669 7865 6420  r this is fixed 
+00010a10: 696e 2074 6865 2047 726f 6269 6420 6e61  in the Grobid na
+00010a20: 6d65 2070 6172 7365 720a 0a20 2020 2020  me parser..     
+00010a30: 2020 2020 2020 2069 6620 6175 7468 6f72         if author
+00010a40: 5f73 7472 696e 6720 3d3d 2022 223a 0a20  _string == "":. 
+00010a50: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00010a60: 7574 686f 725f 7374 7269 6e67 203d 2061  uthor_string = a
+00010a70: 7574 686f 725f 6e61 6d65 5f73 7472 696e  uthor_name_strin
+00010a80: 670a 2020 2020 2020 2020 2020 2020 656c  g.            el
+00010a90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00010aa0: 2020 2020 6175 7468 6f72 5f73 7472 696e      author_strin
+00010ab0: 6720 3d20 6175 7468 6f72 5f73 7472 696e  g = author_strin
+00010ac0: 6720 2b20 2220 616e 6420 2220 2b20 6175  g + " and " + au
+00010ad0: 7468 6f72 5f6e 616d 655f 7374 7269 6e67  thor_name_string
+00010ae0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00010af0: 2061 7574 686f 725f 7374 7269 6e67 0a0a   author_string..
+00010b00: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00010b10: 0a20 2020 2064 6566 205f 5f66 6f72 6d61  .    def __forma
+00010b20: 745f 6175 7468 6f72 735f 7374 7269 6e67  t_authors_string
+00010b30: 5f66 6f72 5f63 6f6d 7061 7269 736f 6e28  _for_comparison(
+00010b40: 636c 732c 202a 2c20 7265 636f 7264 3a20  cls, *, record: 
+00010b50: 5265 636f 7264 2920 2d3e 204e 6f6e 653a  Record) -> None:
+00010b60: 0a20 2020 2020 2020 2069 6620 2261 7574  .        if "aut
+00010b70: 686f 7222 206e 6f74 2069 6e20 7265 636f  hor" not in reco
+00010b80: 7264 2e64 6174 613a 0a20 2020 2020 2020  rd.data:.       
+00010b90: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00010ba0: 2020 2020 6175 7468 6f72 7320 3d20 7265      authors = re
+00010bb0: 636f 7264 2e64 6174 615b 2261 7574 686f  cord.data["autho
+00010bc0: 7222 5d0a 2020 2020 2020 2020 6175 7468  r"].        auth
+00010bd0: 6f72 7320 3d20 7374 7228 6175 7468 6f72  ors = str(author
+00010be0: 7329 2e6c 6f77 6572 2829 0a20 2020 2020  s).lower().     
+00010bf0: 2020 2061 7574 686f 7273 5f73 7472 696e     authors_strin
+00010c00: 6720 3d20 2222 0a20 2020 2020 2020 2061  g = "".        a
+00010c10: 7574 686f 7273 203d 2063 6f6c 7265 762e  uthors = colrev.
+00010c20: 656e 762e 7574 696c 732e 7265 6d6f 7665  env.utils.remove
+00010c30: 5f61 6363 656e 7473 2869 6e70 7574 5f73  _accents(input_s
+00010c40: 7472 3d61 7574 686f 7273 290a 0a20 2020  tr=authors)..   
+00010c50: 2020 2020 2023 2061 6262 7265 7669 6174       # abbreviat
+00010c60: 6520 6669 7273 7420 6e61 6d65 730a 2020  e first names.  
+00010c70: 2020 2020 2020 2320 2257 6562 7374 6572        # "Webster
+00010c80: 2c20 4a61 6e65 2220 2d3e 2022 5765 6273  , Jane" -> "Webs
+00010c90: 7465 722c 204a 220a 2020 2020 2020 2020  ter, J".        
+00010ca0: 2320 616c 736f 2072 656d 6f76 6520 616c  # also remove al
+00010cb0: 6c20 7370 6563 6961 6c20 6368 6172 6163  l special charac
+00010cc0: 7465 7273 2061 6e64 2064 6f20 6e6f 7420  ters and do not 
+00010cd0: 696e 636c 7564 6520 7365 7061 7261 746f  include separato
+00010ce0: 7273 2028 616e 6429 0a20 2020 2020 2020  rs (and).       
+00010cf0: 2066 6f72 2061 7574 686f 7220 696e 2061   for author in a
+00010d00: 7574 686f 7273 2e73 706c 6974 2822 2061  uthors.split(" a
+00010d10: 6e64 2022 293a 0a20 2020 2020 2020 2020  nd "):.         
+00010d20: 2020 2069 6620 222c 2220 696e 2061 7574     if "," in aut
+00010d30: 686f 723a 0a20 2020 2020 2020 2020 2020  hor:.           
+00010d40: 2020 2020 206c 6173 745f 6e61 6d65 7320       last_names 
+00010d50: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00010d60: 2020 2020 2020 2020 776f 7264 5b30 5d20          word[0] 
+00010d70: 666f 7220 776f 7264 2069 6e20 6175 7468  for word in auth
+00010d80: 6f72 2e73 706c 6974 2822 2c22 295b 315d  or.split(",")[1]
+00010d90: 2e73 706c 6974 2822 2022 2920 6966 206c  .split(" ") if l
+00010da0: 656e 2877 6f72 6429 203e 2030 0a20 2020  en(word) > 0.   
+00010db0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+00010dc0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00010dd0: 7574 686f 7273 5f73 7472 696e 6720 3d20  uthors_string = 
+00010de0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010df0: 2020 2020 2020 6175 7468 6f72 735f 7374        authors_st
+00010e00: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
+00010e10: 2020 2020 2020 2020 202b 2061 7574 686f           + autho
+00010e20: 722e 7370 6c69 7428 222c 2229 5b30 5d0a  r.split(",")[0].
+00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e40: 2020 2020 2b20 2220 220a 2020 2020 2020      + " ".      
+00010e50: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00010e60: 2220 222e 6a6f 696e 286c 6173 745f 6e61  " ".join(last_na
+00010e70: 6d65 7329 0a20 2020 2020 2020 2020 2020  mes).           
+00010e80: 2020 2020 2020 2020 202b 2022 2022 0a20           + " ". 
+00010e90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00010ea0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00010eb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00010ec0: 2020 2061 7574 686f 7273 5f73 7472 696e     authors_strin
+00010ed0: 6720 3d20 6175 7468 6f72 735f 7374 7269  g = authors_stri
+00010ee0: 6e67 202b 2061 7574 686f 7220 2b20 2220  ng + author + " 
+00010ef0: 220a 2020 2020 2020 2020 6175 7468 6f72  ".        author
+00010f00: 735f 7374 7269 6e67 203d 2072 652e 7375  s_string = re.su
+00010f10: 6228 7222 5b5e 412d 5a61 2d7a 302d 392c  b(r"[^A-Za-z0-9,
+00010f20: 205d 2b22 2c20 2222 2c20 6175 7468 6f72   ]+", "", author
+00010f30: 735f 7374 7269 6e67 2e72 7374 7269 7028  s_string.rstrip(
+00010f40: 2929 0a20 2020 2020 2020 2072 6563 6f72  )).        recor
+00010f50: 642e 6461 7461 5b22 6175 7468 6f72 225d  d.data["author"]
+00010f60: 203d 2061 7574 686f 7273 5f73 7472 696e   = authors_strin
+00010f70: 670a 0a20 2020 2064 6566 2063 6f6e 7461  g..    def conta
+00010f80: 696e 6572 5f69 735f 6162 6272 6576 6961  iner_is_abbrevia
+00010f90: 7465 6428 7365 6c66 2920 2d3e 2062 6f6f  ted(self) -> boo
+00010fa0: 6c3a 0a20 2020 2020 2020 2022 2222 4368  l:.        """Ch
+00010fb0: 6563 6b20 7768 6574 6865 7220 7468 6520  eck whether the 
+00010fc0: 636f 6e74 6169 6e65 7220 7469 746c 6520  container title 
+00010fd0: 6973 2061 6262 7265 7669 6174 6564 2222  is abbreviated""
+00010fe0: 220a 2020 2020 2020 2020 6966 2022 6a6f  ".        if "jo
+00010ff0: 7572 6e61 6c22 2069 6e20 7365 6c66 2e64  urnal" in self.d
+00011000: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+00011010: 2069 6620 7365 6c66 2e64 6174 615b 226a   if self.data["j
+00011020: 6f75 726e 616c 225d 2e63 6f75 6e74 2822  ournal"].count("
+00011030: 2e22 2920 3e20 323a 0a20 2020 2020 2020  .") > 2:.       
+00011040: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011050: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00011060: 2069 6620 7365 6c66 2e64 6174 615b 226a   if self.data["j
+00011070: 6f75 726e 616c 225d 2e69 7375 7070 6572  ournal"].isupper
+00011080: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00011090: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+000110a0: 2020 2020 2020 2020 6966 2022 626f 6f6b          if "book
+000110b0: 7469 746c 6522 2069 6e20 7365 6c66 2e64  title" in self.d
+000110c0: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+000110d0: 2069 6620 7365 6c66 2e64 6174 615b 2262   if self.data["b
+000110e0: 6f6f 6b74 6974 6c65 225d 2e63 6f75 6e74  ooktitle"].count
+000110f0: 2822 2e22 2920 3e20 323a 0a20 2020 2020  (".") > 2:.     
+00011100: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011110: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
+00011120: 2020 2069 6620 7365 6c66 2e64 6174 615b     if self.data[
+00011130: 2262 6f6f 6b74 6974 6c65 225d 2e69 7375  "booktitle"].isu
+00011140: 7070 6572 2829 3a0a 2020 2020 2020 2020  pper():.        
+00011150: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00011160: 7275 650a 2020 2020 2020 2020 2320 6164  rue.        # ad
+00011170: 6420 6865 7572 6973 7469 6373 3f20 2865  d heuristics? (e
+00011180: 2e67 2e2c 2048 6177 6169 6920 496e 7420  .g., Hawaii Int 
+00011190: 436f 6e66 2053 7973 7420 5363 6929 0a20  Conf Syst Sci). 
+000111a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000111b0: 6c73 650a 0a20 2020 2040 636c 6173 736d  lse..    @classm
+000111c0: 6574 686f 640a 2020 2020 6465 6620 5f5f  ethod.    def __
+000111d0: 6162 6272 6576 6961 7465 5f63 6f6e 7461  abbreviate_conta
+000111e0: 696e 6572 5f74 6974 6c65 7328 0a20 2020  iner_titles(.   
+000111f0: 2020 2020 2063 6c73 2c0a 2020 2020 2020       cls,.      
+00011200: 2020 2a2c 0a20 2020 2020 2020 2072 6563    *,.        rec
+00011210: 6f72 643a 2063 6f6c 7265 762e 7265 636f  ord: colrev.reco
+00011220: 7264 2e50 7265 7052 6563 6f72 642c 0a20  rd.PrepRecord,. 
+00011230: 2020 2020 2020 2072 6574 7269 6576 6564         retrieved
+00011240: 5f72 6563 6f72 643a 2063 6f6c 7265 762e  _record: colrev.
+00011250: 7265 636f 7264 2e50 7265 7052 6563 6f72  record.PrepRecor
+00011260: 642c 0a20 2020 2029 202d 3e20 4e6f 6e65  d,.    ) -> None
+00011270: 3a0a 2020 2020 2020 2020 6465 6620 6162  :.        def ab
+00011280: 6272 6576 6961 7465 5f63 6f6e 7461 696e  breviate_contain
+00011290: 6572 282a 2c20 7265 636f 7264 3a20 636f  er(*, record: co
+000112a0: 6c72 6576 2e72 6563 6f72 642e 5265 636f  lrev.record.Reco
+000112b0: 7264 2c20 6d69 6e5f 6c65 6e3a 2069 6e74  rd, min_len: int
+000112c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000112d0: 2020 2020 2020 2069 6620 226a 6f75 726e         if "journ
+000112e0: 616c 2220 696e 2072 6563 6f72 642e 6461  al" in record.da
+000112f0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00011300: 2020 2020 7265 636f 7264 2e64 6174 615b      record.data[
+00011310: 226a 6f75 726e 616c 225d 203d 2022 2022  "journal"] = " "
+00011320: 2e6a 6f69 6e28 0a20 2020 2020 2020 2020  .join(.         
+00011330: 2020 2020 2020 2020 2020 205b 785b 3a6d             [x[:m
+00011340: 696e 5f6c 656e 5d20 666f 7220 7820 696e  in_len] for x in
+00011350: 2072 6563 6f72 642e 6461 7461 5b22 6a6f   record.data["jo
+00011360: 7572 6e61 6c22 5d2e 7370 6c69 7428 2220  urnal"].split(" 
+00011370: 2229 5d0a 2020 2020 2020 2020 2020 2020  ")].            
+00011380: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+00011390: 6566 2067 6574 5f61 6262 7265 765f 636f  ef get_abbrev_co
+000113a0: 6e74 6169 6e65 725f 6d69 6e5f 6c65 6e28  ntainer_min_len(
+000113b0: 2a2c 2072 6563 6f72 643a 2063 6f6c 7265  *, record: colre
+000113c0: 762e 7265 636f 7264 2e52 6563 6f72 6429  v.record.Record)
+000113d0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+000113e0: 2020 2020 206d 696e 5f6c 656e 203d 202d       min_len = -
+000113f0: 310a 2020 2020 2020 2020 2020 2020 6966  1.            if
+00011400: 2022 6a6f 7572 6e61 6c22 2069 6e20 7265   "journal" in re
+00011410: 636f 7264 2e64 6174 613a 0a20 2020 2020  cord.data:.     
+00011420: 2020 2020 2020 2020 2020 206d 696e 5f6c             min_l
+00011430: 656e 203d 206d 696e 280a 2020 2020 2020  en = min(.      
+00011440: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+00011450: 6e28 7829 2066 6f72 2078 2069 6e20 7265  n(x) for x in re
+00011460: 636f 7264 2e64 6174 615b 226a 6f75 726e  cord.data["journ
+00011470: 616c 225d 2e72 6570 6c61 6365 2822 2e22  al"].replace("."
+00011480: 2c20 2222 292e 7370 6c69 7428 2220 2229  , "").split(" ")
+00011490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000114a0: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+000114b0: 6620 2262 6f6f 6b74 6974 6c65 2220 696e  f "booktitle" in
+000114c0: 2072 6563 6f72 642e 6461 7461 3a0a 2020   record.data:.  
+000114d0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+000114e0: 6e5f 6c65 6e20 3d20 6d69 6e28 0a20 2020  n_len = min(.   
+000114f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011500: 206c 656e 2878 2920 666f 7220 7820 696e   len(x) for x in
+00011510: 2072 6563 6f72 642e 6461 7461 5b22 626f   record.data["bo
+00011520: 6f6b 7469 746c 6522 5d2e 7265 706c 6163  oktitle"].replac
+00011530: 6528 222e 222c 2022 2229 2e73 706c 6974  e(".", "").split
+00011540: 2822 2022 290a 2020 2020 2020 2020 2020  (" ").          
+00011550: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011560: 2020 2020 7265 7475 726e 206d 696e 5f6c      return min_l
+00011570: 656e 0a0a 2020 2020 2020 2020 6966 2072  en..        if r
+00011580: 6563 6f72 642e 636f 6e74 6169 6e65 725f  ecord.container_
+00011590: 6973 5f61 6262 7265 7669 6174 6564 2829  is_abbreviated()
+000115a0: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
+000115b0: 6e5f 6c65 6e20 3d20 6765 745f 6162 6272  n_len = get_abbr
+000115c0: 6576 5f63 6f6e 7461 696e 6572 5f6d 696e  ev_container_min
+000115d0: 5f6c 656e 2872 6563 6f72 643d 7265 636f  _len(record=reco
+000115e0: 7264 290a 2020 2020 2020 2020 2020 2020  rd).            
+000115f0: 6162 6272 6576 6961 7465 5f63 6f6e 7461  abbreviate_conta
+00011600: 696e 6572 2872 6563 6f72 643d 7265 7472  iner(record=retr
+00011610: 6965 7665 645f 7265 636f 7264 2c20 6d69  ieved_record, mi
+00011620: 6e5f 6c65 6e3d 6d69 6e5f 6c65 6e29 0a20  n_len=min_len). 
+00011630: 2020 2020 2020 2020 2020 2061 6262 7265             abbre
+00011640: 7669 6174 655f 636f 6e74 6169 6e65 7228  viate_container(
+00011650: 7265 636f 7264 3d72 6563 6f72 642c 206d  record=record, m
+00011660: 696e 5f6c 656e 3d6d 696e 5f6c 656e 290a  in_len=min_len).
+00011670: 2020 2020 2020 2020 6966 2072 6574 7269          if retri
+00011680: 6576 6564 5f72 6563 6f72 642e 636f 6e74  eved_record.cont
+00011690: 6169 6e65 725f 6973 5f61 6262 7265 7669  ainer_is_abbrevi
+000116a0: 6174 6564 2829 3a0a 2020 2020 2020 2020  ated():.        
+000116b0: 2020 2020 6d69 6e5f 6c65 6e20 3d20 6765      min_len = ge
+000116c0: 745f 6162 6272 6576 5f63 6f6e 7461 696e  t_abbrev_contain
+000116d0: 6572 5f6d 696e 5f6c 656e 2872 6563 6f72  er_min_len(recor
+000116e0: 643d 7265 7472 6965 7665 645f 7265 636f  d=retrieved_reco
+000116f0: 7264 290a 2020 2020 2020 2020 2020 2020  rd).            
+00011700: 6162 6272 6576 6961 7465 5f63 6f6e 7461  abbreviate_conta
+00011710: 696e 6572 2872 6563 6f72 643d 7265 636f  iner(record=reco
+00011720: 7264 2c20 6d69 6e5f 6c65 6e3d 6d69 6e5f  rd, min_len=min_
+00011730: 6c65 6e29 0a20 2020 2020 2020 2020 2020  len).           
+00011740: 2061 6262 7265 7669 6174 655f 636f 6e74   abbreviate_cont
+00011750: 6169 6e65 7228 7265 636f 7264 3d72 6574  ainer(record=ret
+00011760: 7269 6576 6564 5f72 6563 6f72 642c 206d  rieved_record, m
+00011770: 696e 5f6c 656e 3d6d 696e 5f6c 656e 290a  in_len=min_len).
+00011780: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00011790: 640a 2020 2020 6465 6620 5f5f 7072 6570  d.    def __prep
+000117a0: 5f72 6563 6f72 6473 5f66 6f72 5f73 696d  _records_for_sim
+000117b0: 696c 6172 6974 7928 0a20 2020 2020 2020  ilarity(.       
+000117c0: 2063 6c73 2c0a 2020 2020 2020 2020 2a2c   cls,.        *,
+000117d0: 0a20 2020 2020 2020 2072 6563 6f72 643a  .        record:
+000117e0: 2063 6f6c 7265 762e 7265 636f 7264 2e50   colrev.record.P
+000117f0: 7265 7052 6563 6f72 642c 0a20 2020 2020  repRecord,.     
+00011800: 2020 2072 6574 7269 6576 6564 5f72 6563     retrieved_rec
+00011810: 6f72 643a 2063 6f6c 7265 762e 7265 636f  ord: colrev.reco
+00011820: 7264 2e50 7265 7052 6563 6f72 642c 0a20  rd.PrepRecord,. 
+00011830: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+00011840: 2020 2020 2020 636c 732e 5f5f 6162 6272        cls.__abbr
+00011850: 6576 6961 7465 5f63 6f6e 7461 696e 6572  eviate_container
+00011860: 5f74 6974 6c65 7328 0a20 2020 2020 2020  _titles(.       
+00011870: 2020 2020 2072 6563 6f72 643d 7265 636f       record=reco
+00011880: 7264 2c20 7265 7472 6965 7665 645f 7265  rd, retrieved_re
+00011890: 636f 7264 3d72 6574 7269 6576 6564 5f72  cord=retrieved_r
+000118a0: 6563 6f72 640a 2020 2020 2020 2020 290a  ecord.        ).
+000118b0: 0a20 2020 2020 2020 2069 6620 2274 6974  .        if "tit
+000118c0: 6c65 2220 696e 2072 6563 6f72 642e 6461  le" in record.da
+000118d0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+000118e0: 7265 636f 7264 2e64 6174 615b 2274 6974  record.data["tit
+000118f0: 6c65 225d 203d 2072 6563 6f72 642e 6461  le"] = record.da
+00011900: 7461 5b22 7469 746c 6522 5d5b 3a39 305d  ta["title"][:90]
+00011910: 0a20 2020 2020 2020 2069 6620 2274 6974  .        if "tit
+00011920: 6c65 2220 696e 2072 6574 7269 6576 6564  le" in retrieved
+00011930: 5f72 6563 6f72 642e 6461 7461 3a0a 2020  _record.data:.  
+00011940: 2020 2020 2020 2020 2020 7265 7472 6965            retrie
+00011950: 7665 645f 7265 636f 7264 2e64 6174 615b  ved_record.data[
+00011960: 2274 6974 6c65 225d 203d 2072 6574 7269  "title"] = retri
+00011970: 6576 6564 5f72 6563 6f72 642e 6461 7461  eved_record.data
+00011980: 5b22 7469 746c 6522 5d5b 3a39 305d 0a0a  ["title"][:90]..
+00011990: 2020 2020 2020 2020 6966 2022 6175 7468          if "auth
+000119a0: 6f72 2220 696e 2072 6563 6f72 642e 6461  or" in record.da
+000119b0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+000119c0: 636c 732e 5f5f 666f 726d 6174 5f61 7574  cls.__format_aut
+000119d0: 686f 7273 5f73 7472 696e 675f 666f 725f  hors_string_for_
+000119e0: 636f 6d70 6172 6973 6f6e 2872 6563 6f72  comparison(recor
+000119f0: 643d 7265 636f 7264 290a 2020 2020 2020  d=record).      
+00011a00: 2020 2020 2020 7265 636f 7264 2e64 6174        record.dat
+00011a10: 615b 2261 7574 686f 7222 5d20 3d20 7265  a["author"] = re
+00011a20: 636f 7264 2e64 6174 615b 2261 7574 686f  cord.data["autho
+00011a30: 7222 5d5b 3a34 355d 0a20 2020 2020 2020  r"][:45].       
+00011a40: 2069 6620 2261 7574 686f 7222 2069 6e20   if "author" in 
+00011a50: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
+00011a60: 2e64 6174 613a 0a20 2020 2020 2020 2020  .data:.         
+00011a70: 2020 2063 6c73 2e5f 5f66 6f72 6d61 745f     cls.__format_
+00011a80: 6175 7468 6f72 735f 7374 7269 6e67 5f66  authors_string_f
+00011a90: 6f72 5f63 6f6d 7061 7269 736f 6e28 7265  or_comparison(re
+00011aa0: 636f 7264 3d72 6574 7269 6576 6564 5f72  cord=retrieved_r
+00011ab0: 6563 6f72 6429 0a20 2020 2020 2020 2020  ecord).         
+00011ac0: 2020 2072 6574 7269 6576 6564 5f72 6563     retrieved_rec
+00011ad0: 6f72 642e 6461 7461 5b22 6175 7468 6f72  ord.data["author
+00011ae0: 225d 203d 2072 6574 7269 6576 6564 5f72  "] = retrieved_r
+00011af0: 6563 6f72 642e 6461 7461 5b22 6175 7468  ecord.data["auth
+00011b00: 6f72 225d 5b3a 3435 5d0a 2020 2020 2020  or"][:45].      
+00011b10: 2020 6966 206e 6f74 2028 2276 6f6c 756d    if not ("volum
+00011b20: 6522 2069 6e20 7265 636f 7264 2e64 6174  e" in record.dat
+00011b30: 6120 616e 6420 2276 6f6c 756d 6522 2069  a and "volume" i
+00011b40: 6e20 7265 7472 6965 7665 645f 7265 636f  n retrieved_reco
+00011b50: 7264 2e64 6174 6129 3a0a 2020 2020 2020  rd.data):.      
+00011b60: 2020 2020 2020 7265 636f 7264 2e64 6174        record.dat
+00011b70: 615b 2276 6f6c 756d 6522 5d20 3d20 226e  a["volume"] = "n
+00011b80: 616e 220a 2020 2020 2020 2020 2020 2020  an".            
+00011b90: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
+00011ba0: 2e64 6174 615b 2276 6f6c 756d 6522 5d20  .data["volume"] 
+00011bb0: 3d20 226e 616e 220a 2020 2020 2020 2020  = "nan".        
+00011bc0: 6966 206e 6f74 2028 226e 756d 6265 7222  if not ("number"
+00011bd0: 2069 6e20 7265 636f 7264 2e64 6174 6120   in record.data 
+00011be0: 616e 6420 226e 756d 6265 7222 2069 6e20  and "number" in 
+00011bf0: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
+00011c00: 2e64 6174 6129 3a0a 2020 2020 2020 2020  .data):.        
+00011c10: 2020 2020 7265 636f 7264 2e64 6174 615b      record.data[
+00011c20: 226e 756d 6265 7222 5d20 3d20 226e 616e  "number"] = "nan
+00011c30: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+00011c40: 7472 6965 7665 645f 7265 636f 7264 2e64  trieved_record.d
+00011c50: 6174 615b 226e 756d 6265 7222 5d20 3d20  ata["number"] = 
+00011c60: 226e 616e 220a 2020 2020 2020 2020 6966  "nan".        if
+00011c70: 206e 6f74 2028 2270 6167 6573 2220 696e   not ("pages" in
+00011c80: 2072 6563 6f72 642e 6461 7461 2061 6e64   record.data and
+00011c90: 2022 7061 6765 7322 2069 6e20 7265 7472   "pages" in retr
+00011ca0: 6965 7665 645f 7265 636f 7264 2e64 6174  ieved_record.dat
+00011cb0: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
+00011cc0: 7265 636f 7264 2e64 6174 615b 2270 6167  record.data["pag
+00011cd0: 6573 225d 203d 2022 6e61 6e22 0a20 2020  es"] = "nan".   
+00011ce0: 2020 2020 2020 2020 2072 6574 7269 6576           retriev
+00011cf0: 6564 5f72 6563 6f72 642e 6461 7461 5b22  ed_record.data["
+00011d00: 7061 6765 7322 5d20 3d20 226e 616e 220a  pages"] = "nan".
+00011d10: 2020 2020 2020 2020 2320 536f 6d65 7469          # Someti
+00011d20: 6d65 732c 2074 6865 206e 756d 6265 7220  mes, the number 
+00011d30: 6f66 2070 6167 6573 2069 7320 7072 6f76  of pages is prov
+00011d40: 6964 6564 2028 6e6f 7420 7468 6520 7261  ided (not the ra
+00011d50: 6e67 6529 0a20 2020 2020 2020 2065 6c69  nge).        eli
+00011d60: 6620 6e6f 7420 280a 2020 2020 2020 2020  f not (.        
+00011d70: 2020 2020 222d 2d22 2069 6e20 7265 636f      "--" in reco
+00011d80: 7264 2e64 6174 615b 2270 6167 6573 225d  rd.data["pages"]
+00011d90: 2061 6e64 2022 2d2d 2220 696e 2072 6574   and "--" in ret
+00011da0: 7269 6576 6564 5f72 6563 6f72 642e 6461  rieved_record.da
+00011db0: 7461 5b22 7061 6765 7322 5d0a 2020 2020  ta["pages"].    
+00011dc0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00011dd0: 2020 2072 6563 6f72 642e 6461 7461 5b22     record.data["
+00011de0: 7061 6765 7322 5d20 3d20 226e 616e 220a  pages"] = "nan".
+00011df0: 2020 2020 2020 2020 2020 2020 7265 7472              retr
+00011e00: 6965 7665 645f 7265 636f 7264 2e64 6174  ieved_record.dat
+00011e10: 615b 2270 6167 6573 225d 203d 2022 6e61  a["pages"] = "na
+00011e20: 6e22 0a0a 2020 2020 2020 2020 6966 2022  n"..        if "
+00011e30: 7965 6172 2220 696e 2072 6563 6f72 642e  year" in record.
+00011e40: 6461 7461 2061 6e64 2022 7965 6172 2220  data and "year" 
+00011e50: 696e 2072 6574 7269 6576 6564 5f72 6563  in retrieved_rec
+00011e60: 6f72 642e 6461 7461 3a0a 2020 2020 2020  ord.data:.      
+00011e70: 2020 2020 2020 6966 2072 6563 6f72 642e        if record.
+00011e80: 6461 7461 5b22 7965 6172 225d 203d 3d20  data["year"] == 
+00011e90: 2266 6f72 7468 636f 6d69 6e67 223a 0a20  "forthcoming":. 
+00011ea0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00011eb0: 6563 6f72 642e 6461 7461 5b22 7965 6172  ecord.data["year
+00011ec0: 225d 203d 2072 6574 7269 6576 6564 5f72  "] = retrieved_r
+00011ed0: 6563 6f72 642e 6461 7461 5b22 7965 6172  ecord.data["year
+00011ee0: 225d 0a20 2020 2020 2020 2020 2020 2069  "].            i
+00011ef0: 6620 7265 7472 6965 7665 645f 7265 636f  f retrieved_reco
+00011f00: 7264 2e64 6174 615b 2279 6561 7222 5d20  rd.data["year"] 
+00011f10: 3d3d 2022 666f 7274 6863 6f6d 696e 6722  == "forthcoming"
+00011f20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011f30: 2020 7265 7472 6965 7665 645f 7265 636f    retrieved_reco
+00011f40: 7264 2e64 6174 615b 2279 6561 7222 5d20  rd.data["year"] 
+00011f50: 3d20 7265 636f 7264 2e64 6174 615b 2279  = record.data["y
+00011f60: 6561 7222 5d0a 0a20 2020 2040 636c 6173  ear"]..    @clas
+00011f70: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00011f80: 6765 745f 7265 7472 6965 7661 6c5f 7369  get_retrieval_si
+00011f90: 6d69 6c61 7269 7479 280a 2020 2020 2020  milarity(.      
+00011fa0: 2020 636c 732c 0a20 2020 2020 2020 202a    cls,.        *
+00011fb0: 2c0a 2020 2020 2020 2020 7265 636f 7264  ,.        record
+00011fc0: 5f6f 7269 6769 6e61 6c3a 2052 6563 6f72  _original: Recor
+00011fd0: 642c 0a20 2020 2020 2020 2072 6574 7269  d,.        retri
+00011fe0: 6576 6564 5f72 6563 6f72 645f 6f72 6967  eved_record_orig
+00011ff0: 696e 616c 3a20 5265 636f 7264 2c0a 2020  inal: Record,.  
+00012000: 2020 2020 2020 7361 6d65 5f72 6563 6f72        same_recor
+00012010: 645f 7479 7065 5f72 6571 7569 7265 643a  d_type_required:
+00012020: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+00012030: 2020 2920 2d3e 2066 6c6f 6174 3a0a 2020    ) -> float:.  
+00012040: 2020 2020 2020 2222 2247 6574 2074 6865        """Get the
+00012050: 2072 6574 7269 6576 616c 2073 696d 696c   retrieval simil
+00012060: 6172 6974 7920 6265 7477 6565 6e20 7468  arity between th
+00012070: 6520 7265 636f 7264 2061 6e64 2061 2072  e record and a r
+00012080: 6574 7269 6576 6564 2072 6563 6f72 6422  etrieved record"
+00012090: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
+000120a0: 616d 655f 7265 636f 7264 5f74 7970 655f  ame_record_type_
+000120b0: 7265 7175 6972 6564 3a0a 2020 2020 2020  required:.      
+000120c0: 2020 2020 2020 6966 2072 6563 6f72 645f        if record_
+000120d0: 6f72 6967 696e 616c 2e64 6174 612e 6765  original.data.ge
+000120e0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+000120f0: 2020 2022 454e 5452 5954 5950 4522 2c20     "ENTRYTYPE", 
+00012100: 2261 220a 2020 2020 2020 2020 2020 2020  "a".            
+00012110: 2920 213d 2072 6574 7269 6576 6564 5f72  ) != retrieved_r
+00012120: 6563 6f72 645f 6f72 6967 696e 616c 2e64  ecord_original.d
+00012130: 6174 612e 6765 7428 2245 4e54 5259 5459  ata.get("ENTRYTY
+00012140: 5045 222c 2022 6222 293a 0a20 2020 2020  PE", "b"):.     
+00012150: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00012160: 6e20 302e 300a 0a20 2020 2020 2020 2072  n 0.0..        r
+00012170: 6563 6f72 6420 3d20 7265 636f 7264 5f6f  ecord = record_o
+00012180: 7269 6769 6e61 6c2e 636f 7079 5f70 7265  riginal.copy_pre
+00012190: 705f 7265 6328 290a 2020 2020 2020 2020  p_rec().        
+000121a0: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
+000121b0: 203d 2072 6574 7269 6576 6564 5f72 6563   = retrieved_rec
+000121c0: 6f72 645f 6f72 6967 696e 616c 2e63 6f70  ord_original.cop
+000121d0: 795f 7072 6570 5f72 6563 2829 0a0a 2020  y_prep_rec()..  
+000121e0: 2020 2020 2020 636c 732e 5f5f 7072 6570        cls.__prep
+000121f0: 5f72 6563 6f72 6473 5f66 6f72 5f73 696d  _records_for_sim
+00012200: 696c 6172 6974 7928 0a20 2020 2020 2020  ilarity(.       
+00012210: 2020 2020 2072 6563 6f72 643d 7265 636f       record=reco
+00012220: 7264 2c20 7265 7472 6965 7665 645f 7265  rd, retrieved_re
+00012230: 636f 7264 3d72 6574 7269 6576 6564 5f72  cord=retrieved_r
+00012240: 6563 6f72 640a 2020 2020 2020 2020 290a  ecord.        ).
+00012250: 0a20 2020 2020 2020 2069 6620 2265 6469  .        if "edi
+00012260: 746f 7269 616c 2220 696e 2072 6563 6f72  torial" in recor
+00012270: 642e 6461 7461 2e67 6574 2822 7469 746c  d.data.get("titl
+00012280: 6522 2c20 224e 4122 292e 6c6f 7765 7228  e", "NA").lower(
+00012290: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+000122a0: 6620 6e6f 7420 616c 6c28 7820 696e 2072  f not all(x in r
+000122b0: 6563 6f72 642e 6461 7461 2066 6f72 2078  ecord.data for x
+000122c0: 2069 6e20 5b22 766f 6c75 6d65 222c 2022   in ["volume", "
+000122d0: 6e75 6d62 6572 225d 293a 0a20 2020 2020  number"]):.     
+000122e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000122f0: 6e20 302e 300a 0a20 2020 2020 2020 2073  n 0.0..        s
+00012300: 696d 696c 6172 6974 7920 3d20 5265 636f  imilarity = Reco
+00012310: 7264 2e67 6574 5f72 6563 6f72 645f 7369  rd.get_record_si
+00012320: 6d69 6c61 7269 7479 280a 2020 2020 2020  milarity(.      
+00012330: 2020 2020 2020 7265 636f 7264 5f61 3d72        record_a=r
+00012340: 6563 6f72 642c 2072 6563 6f72 645f 623d  ecord, record_b=
+00012350: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
+00012360: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00012370: 2020 2072 6574 7572 6e20 7369 6d69 6c61     return simila
+00012380: 7269 7479 0a0a 2020 2020 6465 6620 666f  rity..    def fo
+00012390: 726d 6174 5f69 665f 6d6f 7374 6c79 5f75  rmat_if_mostly_u
+000123a0: 7070 6572 2873 656c 662c 202a 2c20 6b65  pper(self, *, ke
+000123b0: 793a 2073 7472 2c20 6361 7365 3a20 7374  y: str, case: st
+000123c0: 7220 3d20 2273 656e 7465 6e63 6522 2920  r = "sentence") 
+000123d0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+000123e0: 2022 2222 466f 726d 6174 2074 6865 2066   """Format the f
+000123f0: 6965 6c64 2069 6620 6974 2069 7320 6d6f  ield if it is mo
+00012400: 7374 6c79 2069 6e20 7570 7065 7220 6361  stly in upper ca
+00012410: 7365 2222 220a 0a20 2020 2020 2020 2069  se"""..        i
+00012420: 6620 6b65 7920 6e6f 7420 696e 2073 656c  f key not in sel
+00012430: 662e 6461 7461 206f 7220 7365 6c66 2e64  f.data or self.d
+00012440: 6174 615b 6b65 795d 203d 3d20 2255 4e4b  ata[key] == "UNK
+00012450: 4e4f 574e 223a 0a20 2020 2020 2020 2020  NOWN":.         
+00012460: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+00012470: 2020 2069 6620 636f 6c72 6576 2e65 6e76     if colrev.env
+00012480: 2e75 7469 6c73 2e70 6572 6365 6e74 5f75  .utils.percent_u
+00012490: 7070 6572 5f63 6861 7273 2873 656c 662e  pper_chars(self.
+000124a0: 6461 7461 5b6b 6579 5d29 203c 2030 2e36  data[key]) < 0.6
+000124b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000124c0: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
+000124d0: 4e6f 7465 3a20 7468 6520 7472 7565 6361  Note: the trueca
+000124e0: 7365 2070 6163 6b61 6765 2069 7320 6e6f  se package is no
+000124f0: 7420 7665 7279 2072 656c 6961 626c 6520  t very reliable 
+00012500: 2879 6574 290a 0a20 2020 2020 2020 2073  (yet)..        s
+00012510: 656c 662e 6461 7461 5b6b 6579 5d20 3d20  elf.data[key] = 
+00012520: 7365 6c66 2e64 6174 615b 6b65 795d 2e72  self.data[key].r
+00012530: 6570 6c61 6365 2822 5c6e 222c 2022 2022  eplace("\n", " "
+00012540: 290a 0a20 2020 2020 2020 2069 6620 6361  )..        if ca
+00012550: 7365 203d 3d20 2273 656e 7465 6e63 6522  se == "sentence"
+00012560: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00012570: 6c66 2e64 6174 615b 6b65 795d 203d 2073  lf.data[key] = s
+00012580: 656c 662e 6461 7461 5b6b 6579 5d2e 6361  elf.data[key].ca
+00012590: 7069 7461 6c69 7a65 2829 0a20 2020 2020  pitalize().     
+000125a0: 2020 2065 6c69 6620 6361 7365 203d 3d20     elif case == 
+000125b0: 2274 6974 6c65 223a 0a20 2020 2020 2020  "title":.       
+000125c0: 2020 2020 2073 656c 662e 6461 7461 5b6b       self.data[k
+000125d0: 6579 5d20 3d20 7365 6c66 2e64 6174 615b  ey] = self.data[
+000125e0: 6b65 795d 2e74 6974 6c65 2829 0a20 2020  key].title().   
+000125f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00012600: 2020 2020 2020 2072 6169 7365 2063 6f6c         raise col
+00012610: 7265 765f 6578 6365 7074 696f 6e73 2e50  rev_exceptions.P
+00012620: 6172 616d 6574 6572 4572 726f 7228 0a20  arameterError(. 
+00012630: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00012640: 6172 616d 6574 6572 3d22 6361 7365 222c  arameter="case",
+00012650: 2076 616c 7565 3d63 6173 652c 206f 7074   value=case, opt
+00012660: 696f 6e73 3d5b 2273 656e 7465 6e63 6522  ions=["sentence"
+00012670: 2c20 2274 6974 6c65 225d 0a20 2020 2020  , "title"].     
+00012680: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00012690: 2020 7365 6c66 2e64 6174 615b 6b65 795d    self.data[key]
+000126a0: 203d 2070 7265 705f 7574 696c 732e 6361   = prep_utils.ca
+000126b0: 7069 7461 6c69 7a65 5f65 6e74 6974 6965  pitalize_entitie
+000126c0: 7328 7365 6c66 2e64 6174 615b 6b65 795d  s(self.data[key]
+000126d0: 290a 0a20 2020 2020 2020 2069 6620 6b65  )..        if ke
+000126e0: 7920 696e 2073 656c 662e 6461 7461 2e67  y in self.data.g
+000126f0: 6574 2822 636f 6c72 6576 5f6d 6173 7465  et("colrev_maste
+00012700: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+00012710: 222c 207b 7d29 3a0a 2020 2020 2020 2020  ", {}):.        
+00012720: 2020 2020 6e6f 7465 203d 2073 656c 662e      note = self.
+00012730: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+00012740: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+00012750: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
+00012760: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00012770: 2022 7175 616c 6974 795f 6465 6665 6374   "quality_defect
+00012780: 2220 696e 206e 6f74 653a 0a20 2020 2020  " in note:.     
+00012790: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000127a0: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+000127b0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+000127c0: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
+000127d0: 5d20 3d20 6e6f 7465 2e72 6570 6c61 6365  ] = note.replace
+000127e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000127f0: 2020 2020 2020 2271 7561 6c69 7479 5f64        "quality_d
+00012800: 6566 6563 7422 2c20 2222 0a20 2020 2020  efect", "".     
+00012810: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00012820: 2020 6465 6620 7265 6e61 6d65 5f66 6965    def rename_fie
+00012830: 6c64 735f 6261 7365 645f 6f6e 5f6d 6170  lds_based_on_map
+00012840: 7069 6e67 2873 656c 662c 202a 2c20 6d61  ping(self, *, ma
+00012850: 7070 696e 673a 2064 6963 7429 202d 3e20  pping: dict) -> 
+00012860: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00012870: 2243 6f6e 7665 6e69 656e 6365 2066 756e  "Convenience fun
+00012880: 6374 696f 6e20 666f 7220 7468 6520 7072  ction for the pr
+00012890: 6570 2073 6372 6970 7473 2028 746f 2072  ep scripts (to r
+000128a0: 656e 616d 6520 6669 656c 6473 2922 2222  ename fields)"""
+000128b0: 0a0a 2020 2020 2020 2020 6d61 7070 696e  ..        mappin
+000128c0: 6720 3d20 7b6b 2e6c 6f77 6572 2829 3a20  g = {k.lower(): 
+000128d0: 762e 6c6f 7765 7228 2920 666f 7220 6b2c  v.lower() for k,
+000128e0: 2076 2069 6e20 6d61 7070 696e 672e 6974   v in mapping.it
+000128f0: 656d 7328 297d 0a20 2020 2020 2020 2070  ems()}.        p
+00012900: 7269 6f72 5f6b 6579 7320 3d20 6c69 7374  rior_keys = list
+00012910: 2873 656c 662e 6461 7461 2e6b 6579 7328  (self.data.keys(
+00012920: 2929 0a20 2020 2020 2020 2023 204e 6f74  )).        # Not
+00012930: 6520 3a20 7761 726e 696e 673a 2064 6f20  e : warning: do 
+00012940: 6e6f 7420 6372 6561 7465 2061 206e 6577  not create a new
+00012950: 2064 6963 742e 0a20 2020 2020 2020 2066   dict..        f
+00012960: 6f72 206b 6579 2069 6e20 7072 696f 725f  or key in prior_
+00012970: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
+00012980: 2020 6966 206b 6579 2e6c 6f77 6572 2829    if key.lower()
+00012990: 2069 6e20 6d61 7070 696e 673a 0a20 2020   in mapping:.   
+000129a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000129b0: 662e 7265 6e61 6d65 5f66 6965 6c64 286b  f.rename_field(k
+000129c0: 6579 3d6b 6579 2c20 6e65 775f 6b65 793d  ey=key, new_key=
+000129d0: 6d61 7070 696e 675b 6b65 792e 6c6f 7765  mapping[key.lowe
+000129e0: 7228 295d 290a 0a20 2020 2064 6566 2075  r()])..    def u
+000129f0: 6e69 6679 5f70 6167 6573 5f66 6965 6c64  nify_pages_field
+00012a00: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00012a10: 2020 2020 2020 2020 2222 2255 6e69 6679          """Unify
+00012a20: 2074 6865 2066 6f72 6d61 7420 6f66 2074   the format of t
+00012a30: 6865 2070 6167 6520 6669 656c 6422 2222  he page field"""
+00012a40: 0a20 2020 2020 2020 2069 6620 2270 6167  .        if "pag
+00012a50: 6573 2220 6e6f 7420 696e 2073 656c 662e  es" not in self.
+00012a60: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00012a70: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00012a80: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00012a90: 6365 2873 656c 662e 6461 7461 5b22 7061  ce(self.data["pa
+00012aa0: 6765 7322 5d2c 2073 7472 293a 0a20 2020  ges"], str):.   
+00012ab0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00012ac0: 2020 2020 2020 2020 6966 2031 203d 3d20          if 1 == 
+00012ad0: 7365 6c66 2e64 6174 615b 2270 6167 6573  self.data["pages
+00012ae0: 225d 2e63 6f75 6e74 2822 2d22 293a 0a20  "].count("-"):. 
+00012af0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00012b00: 6461 7461 5b22 7061 6765 7322 5d20 3d20  data["pages"] = 
+00012b10: 7365 6c66 2e64 6174 615b 2270 6167 6573  self.data["pages
+00012b20: 225d 2e72 6570 6c61 6365 2822 2d22 2c20  "].replace("-", 
+00012b30: 222d 2d22 290a 2020 2020 2020 2020 7365  "--").        se
+00012b40: 6c66 2e64 6174 615b 2270 6167 6573 225d  lf.data["pages"]
+00012b50: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00012b60: 2073 656c 662e 6461 7461 5b22 7061 6765   self.data["page
+00012b70: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
+00012b80: 2e72 6570 6c61 6365 2822 e280 9322 2c20  .replace("...", 
+00012b90: 222d 2d22 290a 2020 2020 2020 2020 2020  "--").          
+00012ba0: 2020 2e72 6570 6c61 6365 2822 2d2d 2d2d    .replace("----
+00012bb0: 222c 2022 2d2d 2229 0a20 2020 2020 2020  ", "--").       
+00012bc0: 2020 2020 202e 7265 706c 6163 6528 2220       .replace(" 
+00012bd0: 2d2d 2022 2c20 222d 2d22 290a 2020 2020  -- ", "--").    
+00012be0: 2020 2020 2020 2020 2e72 7374 7269 7028          .rstrip(
+00012bf0: 222e 2229 0a20 2020 2020 2020 2029 0a0a  ".").        )..
+00012c00: 2020 2020 6465 6620 7072 6570 6172 6174      def preparat
+00012c10: 696f 6e5f 7361 7665 5f63 6f6e 6469 7469  ion_save_conditi
+00012c20: 6f6e 2873 656c 6629 202d 3e20 626f 6f6c  on(self) -> bool
+00012c30: 3a0a 2020 2020 2020 2020 2222 2243 6865  :.        """Che
+00012c40: 636b 2077 6865 7468 6572 2074 6865 2073  ck whether the s
+00012c50: 6176 6520 636f 6e64 6974 696f 6e20 666f  ave condition fo
+00012c60: 7220 7468 6520 7072 6570 206f 7065 7261  r the prep opera
+00012c70: 7469 6f6e 2069 7320 6769 7665 6e22 2222  tion is given"""
+00012c80: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00012c90: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+00012ca0: 6576 5f73 7461 7475 7322 2c20 224e 4122  ev_status", "NA"
+00012cb0: 2920 696e 205b 0a20 2020 2020 2020 2020  ) in [.         
+00012cc0: 2020 2052 6563 6f72 6453 7461 7465 2e72     RecordState.r
+00012cd0: 6576 5f70 7265 7363 7265 656e 5f65 7863  ev_prescreen_exc
+00012ce0: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
+00012cf0: 2020 2052 6563 6f72 6453 7461 7465 2e6d     RecordState.m
+00012d00: 645f 7072 6570 6172 6564 2c0a 2020 2020  d_prepared,.    
+00012d10: 2020 2020 5d3a 0a20 2020 2020 2020 2020      ]:.         
+00012d20: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
+00012d30: 2020 2020 2020 2020 6966 2061 6e79 280a          if any(.
+00012d40: 2020 2020 2020 2020 2020 2020 2264 6973              "dis
+00012d50: 6167 7265 656d 656e 7420 7769 7468 2022  agreement with "
+00012d60: 2069 6e20 785b 226e 6f74 6522 5d0a 2020   in x["note"].  
+00012d70: 2020 2020 2020 2020 2020 666f 7220 7820            for x 
+00012d80: 696e 2073 656c 662e 6461 7461 2e67 6574  in self.data.get
+00012d90: 2822 636f 6c72 6576 5f6d 6173 7465 7264  ("colrev_masterd
+00012da0: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
+00012db0: 207b 7d29 2e76 616c 7565 7328 290a 2020   {}).values().  
+00012dc0: 2020 2020 2020 2920 6f72 2061 6e79 280a        ) or any(.
+00012dd0: 2020 2020 2020 2020 2020 2020 2272 6563              "rec
+00012de0: 6f72 645f 6e6f 745f 696e 5f74 6f63 2220  ord_not_in_toc" 
+00012df0: 696e 2078 5b22 6e6f 7465 225d 0a20 2020  in x["note"].   
+00012e00: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
+00012e10: 6e20 7365 6c66 2e64 6174 612e 6765 7428  n self.data.get(
+00012e20: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+00012e30: 7461 5f70 726f 7665 6e61 6e63 6522 2c20  ta_provenance", 
+00012e40: 7b7d 292e 7661 6c75 6573 2829 0a20 2020  {}).values().   
+00012e50: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00012e60: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+00012e70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012e80: 4661 6c73 650a 0a20 2020 2064 6566 2070  False..    def p
+00012e90: 7265 7061 7261 7469 6f6e 5f62 7265 616b  reparation_break
+00012ea0: 5f63 6f6e 6469 7469 6f6e 2873 656c 6629  _condition(self)
+00012eb0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00012ec0: 2020 2222 2243 6865 636b 2077 6865 7468    """Check wheth
+00012ed0: 6572 2074 6865 2062 7265 616b 2063 6f6e  er the break con
+00012ee0: 6469 7469 6f6e 2066 6f72 2074 6865 2070  dition for the p
+00012ef0: 7265 7020 6f70 6572 6174 696f 6e20 6973  rep operation is
+00012f00: 2067 6976 656e 2222 220a 2020 2020 2020   given""".      
+00012f10: 2020 6966 2061 6e79 280a 2020 2020 2020    if any(.      
+00012f20: 2020 2020 2020 2264 6973 6167 7265 656d        "disagreem
+00012f30: 656e 7420 7769 7468 2022 2069 6e20 785b  ent with " in x[
+00012f40: 226e 6f74 6522 5d0a 2020 2020 2020 2020  "note"].        
+00012f50: 2020 2020 666f 7220 7820 696e 2073 656c      for x in sel
+00012f60: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+00012f70: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+00012f80: 6f76 656e 616e 6365 222c 207b 7d29 2e76  ovenance", {}).v
+00012f90: 616c 7565 7328 290a 2020 2020 2020 2020  alues().        
+00012fa0: 2920 6f72 2061 6e79 280a 2020 2020 2020  ) or any(.      
+00012fb0: 2020 2020 2020 2272 6563 6f72 645f 6e6f        "record_no
+00012fc0: 745f 696e 5f74 6f63 2220 696e 2078 5b22  t_in_toc" in x["
+00012fd0: 6e6f 7465 225d 0a20 2020 2020 2020 2020  note"].         
+00012fe0: 2020 2066 6f72 2078 2069 6e20 7365 6c66     for x in self
+00012ff0: 2e64 6174 612e 6765 7428 2263 6f6c 7265  .data.get("colre
+00013000: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+00013010: 7665 6e61 6e63 6522 2c20 7b7d 292e 7661  venance", {}).va
+00013020: 6c75 6573 2829 0a20 2020 2020 2020 2029  lues().        )
+00013030: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00013040: 7475 726e 2054 7275 650a 0a20 2020 2020  turn True..     
+00013050: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
+00013060: 6765 7428 2263 6f6c 7265 765f 7374 6174  get("colrev_stat
+00013070: 7573 222c 2022 4e41 2229 2069 6e20 5b0a  us", "NA") in [.
+00013080: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
+00013090: 7264 5374 6174 652e 7265 765f 7072 6573  rdState.rev_pres
+000130a0: 6372 6565 6e5f 6578 636c 7564 6564 2c0a  creen_excluded,.
+000130b0: 2020 2020 2020 2020 5d3a 0a20 2020 2020          ]:.     
+000130c0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+000130d0: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
+000130e0: 6e20 4661 6c73 650a 0a20 2020 2064 6566  n False..    def
+000130f0: 2073 7461 7475 735f 746f 5f70 7265 7061   status_to_prepa
+00013100: 7265 2873 656c 6629 202d 3e20 626f 6f6c  re(self) -> bool
+00013110: 3a0a 2020 2020 2020 2020 2222 2243 6865  :.        """Che
+00013120: 636b 2077 6865 7468 6572 2074 6865 2072  ck whether the r
+00013130: 6563 6f72 6420 6e65 6564 7320 746f 2062  ecord needs to b
+00013140: 6520 7072 6570 6172 6564 2222 220a 2020  e prepared""".  
+00013150: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00013160: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+00013170: 6576 5f73 7461 7475 7322 2c20 224e 4122  ev_status", "NA"
+00013180: 2920 696e 205b 0a20 2020 2020 2020 2020  ) in [.         
+00013190: 2020 2052 6563 6f72 6453 7461 7465 2e6d     RecordState.m
+000131a0: 645f 6e65 6564 735f 6d61 6e75 616c 5f70  d_needs_manual_p
+000131b0: 7265 7061 7261 7469 6f6e 2c0a 2020 2020  reparation,.    
+000131c0: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+000131d0: 6174 652e 6d64 5f69 6d70 6f72 7465 642c  ate.md_imported,
+000131e0: 0a20 2020 2020 2020 2020 2020 2052 6563  .            Rec
+000131f0: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
+00013200: 6172 6564 2c0a 2020 2020 2020 2020 5d0a  ared,.        ].
+00013210: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
+00013220: 6d65 7461 6461 7461 5f73 7461 7475 7328  metadata_status(
+00013230: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00013240: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+00013250: 2020 2020 2020 2222 2255 7064 6174 6520        """Update 
+00013260: 7468 6520 6d65 7461 6461 7461 2073 7461  the metadata sta
+00013270: 7475 7320 2872 6574 7261 6374 732c 2069  tus (retracts, i
+00013280: 6e63 6f6d 706c 6574 656e 6573 732c 2069  ncompleteness, i
+00013290: 6e63 6f6e 7369 7374 656e 6369 6573 2c20  nconsistencies, 
+000132a0: 6574 632e 290a 2020 2020 2020 2020 616e  etc.).        an
+000132b0: 6420 7365 7474 696e 6720 7468 6520 7374  d setting the st
+000132c0: 6174 7573 2061 6363 6f72 6469 6e67 6c79  atus accordingly
+000132d0: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+000132e0: 662e 6368 6563 6b5f 706f 7465 6e74 6961  f.check_potentia
+000132f0: 6c5f 7265 7472 6163 7473 2829 0a0a 2020  l_retracts()..  
+00013300: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00013310: 2020 2020 2020 2063 6f6c 7265 762e 7265         colrev.re
+00013320: 636f 7264 2e52 6563 6f72 6453 7461 7465  cord.RecordState
+00013330: 2e72 6576 5f70 7265 7363 7265 656e 5f65  .rev_prescreen_e
+00013340: 7863 6c75 6465 640a 2020 2020 2020 2020  xcluded.        
+00013350: 2020 2020 3d3d 2073 656c 662e 6461 7461      == self.data
+00013360: 5b22 636f 6c72 6576 5f73 7461 7475 7322  ["colrev_status"
+00013370: 5d0a 2020 2020 2020 2020 293a 0a20 2020  ].        ):.   
+00013380: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00013390: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000133a0: 2e6d 6173 7465 7264 6174 615f 6973 5f63  .masterdata_is_c
+000133b0: 7572 6174 6564 2829 3a0a 2020 2020 2020  urated():.      
+000133c0: 2020 2020 2020 7365 6c66 2e73 6574 5f73        self.set_s
+000133d0: 7461 7475 7328 7461 7267 6574 5f73 7461  tatus(target_sta
+000133e0: 7465 3d52 6563 6f72 6453 7461 7465 2e6d  te=RecordState.m
+000133f0: 645f 7072 6570 6172 6564 290a 2020 2020  d_prepared).    
+00013400: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00013410: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013420: 6861 735f 7175 616c 6974 795f 6465 6665  has_quality_defe
+00013430: 6374 7328 293a 0a20 2020 2020 2020 2020  cts():.         
+00013440: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+00013450: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
+00013460: 5265 636f 7264 5374 6174 652e 6d64 5f6e  RecordState.md_n
+00013470: 6565 6473 5f6d 616e 7561 6c5f 7072 6570  eeds_manual_prep
+00013480: 6172 6174 696f 6e29 0a20 2020 2020 2020  aration).       
+00013490: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000134a0: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+000134b0: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
+000134c0: 5265 636f 7264 5374 6174 652e 6d64 5f70  RecordState.md_p
+000134d0: 7265 7061 7265 6429 0a0a 0a63 6c61 7373  repared)...class
+000134e0: 2052 6563 6f72 6453 7461 7465 2845 6e75   RecordState(Enu
+000134f0: 6d29 3a0a 2020 2020 2222 2254 6865 2070  m):.    """The p
+00013500: 6f73 7369 626c 6520 5265 636f 7264 5374  ossible RecordSt
+00013510: 6174 6573 2073 746f 7265 6420 696e 2074  ates stored in t
+00013520: 6865 2063 6f6c 7265 765f 7374 6174 7573  he colrev_status
+00013530: 2066 6965 6c64 0a20 2020 2028 636f 7272   field.    (corr
+00013540: 6573 706f 6e64 696e 6720 746f 2074 6865  esponding to the
+00013550: 2052 6563 6f72 6453 7461 7465 4d6f 6465   RecordStateMode
+00013560: 6c29 2222 220a 0a20 2020 2023 2070 796c  l)"""..    # pyl
+00013570: 696e 743a 2064 6973 6162 6c65 3d69 6e76  int: disable=inv
+00013580: 616c 6964 2d6e 616d 650a 0a20 2020 2023  alid-name..    #
+00013590: 2077 6974 686f 7574 2074 6865 206d 645f   without the md_
+000135a0: 7265 7472 6965 7665 6420 7374 6174 652c  retrieved state,
+000135b0: 2077 6520 636f 756c 6420 6e6f 7420 6469   we could not di
+000135c0: 7370 6c61 7920 7468 6520 6c6f 6164 2074  splay the load t
+000135d0: 7261 6e73 6974 696f 6e0a 2020 2020 6d64  ransition.    md
+000135e0: 5f72 6574 7269 6576 6564 203d 2031 0a20  _retrieved = 1. 
+000135f0: 2020 2022 2222 5265 636f 7264 2069 7320     """Record is 
+00013600: 7265 7472 6965 7665 6420 616e 6420 7374  retrieved and st
+00013610: 6f72 6564 2069 6e20 7468 6520 2e2f 7365  ored in the ./se
+00013620: 6172 6368 2064 6972 6563 746f 7279 2222  arch directory""
+00013630: 220a 2020 2020 6d64 5f69 6d70 6f72 7465  ".    md_importe
+00013640: 6420 3d20 320a 2020 2020 2222 2252 6563  d = 2.    """Rec
+00013650: 6f72 6420 6973 2069 6d70 6f72 7465 6420  ord is imported 
+00013660: 696e 746f 2074 6865 2052 4543 4f52 4453  into the RECORDS
+00013670: 5f46 494c 4522 2222 0a20 2020 206d 645f  _FILE""".    md_
+00013680: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
+00013690: 7061 7261 7469 6f6e 203d 2033 0a20 2020  paration = 3.   
+000136a0: 2022 2222 5265 636f 7264 2072 6571 7569   """Record requi
+000136b0: 7265 7320 6d61 6e75 616c 2070 7265 7061  res manual prepa
+000136c0: 7261 7469 6f6e 0a20 2020 2028 636f 6c72  ration.    (colr
+000136d0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+000136e0: 6f76 656e 616e 6365 2070 726f 7669 6465  ovenance provide
+000136f0: 7320 6869 6e74 7329 2222 220a 2020 2020  s hints)""".    
+00013700: 6d64 5f70 7265 7061 7265 6420 3d20 340a  md_prepared = 4.
+00013710: 2020 2020 2222 2252 6563 6f72 6420 6973      """Record is
+00013720: 2070 7265 7061 7265 6420 286e 6f20 6d69   prepared (no mi
+00013730: 7373 696e 6720 6f72 2069 6e63 6f6d 706c  ssing or incompl
+00013740: 6574 6520 6669 656c 6473 2c20 696e 636f  ete fields, inco
+00013750: 6e73 6973 7465 6e63 6965 7320 6368 6563  nsistencies chec
+00013760: 6b65 6429 2222 220a 2020 2020 6d64 5f70  ked)""".    md_p
+00013770: 726f 6365 7373 6564 203d 2035 0a20 2020  rocessed = 5.   
+00013780: 2022 2222 5265 636f 7264 2068 6173 2062   """Record has b
+00013790: 6565 6e20 6368 6563 6b65 6420 666f 7220  een checked for 
+000137a0: 6475 706c 6963 6174 6520 6173 736f 6369  duplicate associ
+000137b0: 6174 696f 6e73 0a20 2020 2077 6974 6820  ations.    with 
+000137c0: 616e 7920 7265 636f 7264 2069 6e20 5265  any record in Re
+000137d0: 636f 7264 5374 6174 6520 6d64 5f70 726f  cordState md_pro
+000137e0: 6365 7373 6564 206f 7220 6c61 7465 7222  cessed or later"
+000137f0: 2222 0a20 2020 2072 6576 5f70 7265 7363  "".    rev_presc
+00013800: 7265 656e 5f65 7863 6c75 6465 6420 3d20  reen_excluded = 
+00013810: 360a 2020 2020 2222 2252 6563 6f72 6420  6.    """Record 
+00013820: 7761 7320 6578 636c 7564 6564 2069 6e20  was excluded in 
+00013830: 7468 6520 7072 6573 6372 6565 6e20 2862  the prescreen (b
+00013840: 6173 6564 206f 6e20 7469 746c 6573 2f61  ased on titles/a
+00013850: 6273 7472 6163 7473 2922 2222 0a20 2020  bstracts)""".   
+00013860: 2072 6576 5f70 7265 7363 7265 656e 5f69   rev_prescreen_i
+00013870: 6e63 6c75 6465 6420 3d20 370a 2020 2020  ncluded = 7.    
+00013880: 2222 2252 6563 6f72 6420 7761 7320 696e  """Record was in
+00013890: 636c 7564 6564 2069 6e20 7468 6520 7072  cluded in the pr
+000138a0: 6573 6372 6565 6e20 2862 6173 6564 206f  escreen (based o
+000138b0: 6e20 7469 746c 6573 2f61 6273 7472 6163  n titles/abstrac
+000138c0: 7473 2922 2222 0a20 2020 2070 6466 5f6e  ts)""".    pdf_n
+000138d0: 6565 6473 5f6d 616e 7561 6c5f 7265 7472  eeds_manual_retr
+000138e0: 6965 7661 6c20 3d20 380a 2020 2020 2222  ieval = 8.    ""
+000138f0: 2252 6563 6f72 6420 6d61 726b 6564 2066  "Record marked f
+00013900: 6f72 206d 616e 7561 6c20 5044 4620 7265  or manual PDF re
+00013910: 7472 6965 7661 6c22 2222 0a20 2020 2070  trieval""".    p
+00013920: 6466 5f69 6d70 6f72 7465 6420 3d20 390a  df_imported = 9.
+00013930: 2020 2020 2222 2250 4446 2069 6d70 6f72      """PDF impor
+00013940: 7465 6420 616e 6420 6d61 726b 6564 2066  ted and marked f
+00013950: 6f72 2070 7265 7061 7261 7469 6f6e 2222  or preparation""
+00013960: 220a 2020 2020 7064 665f 6e6f 745f 6176  ".    pdf_not_av
+00013970: 6169 6c61 626c 6520 3d20 3130 0a20 2020  ailable = 10.   
+00013980: 2022 2222 5044 4620 6973 206e 6f74 2061   """PDF is not a
+00013990: 7661 696c 6162 6c65 2222 220a 2020 2020  vailable""".    
+000139a0: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
+000139b0: 5f70 7265 7061 7261 7469 6f6e 203d 2031  _preparation = 1
+000139c0: 310a 2020 2020 2222 2250 4446 206d 6172  1.    """PDF mar
+000139d0: 6b65 6420 666f 7220 6d61 6e75 616c 2070  ked for manual p
+000139e0: 7265 7061 7261 7469 6f6e 2222 220a 2020  reparation""".  
+000139f0: 2020 7064 665f 7072 6570 6172 6564 203d    pdf_prepared =
+00013a00: 2031 320a 2020 2020 2222 2250 4446 2070   12.    """PDF p
+00013a10: 7265 7061 7265 6422 2222 0a20 2020 2072  repared""".    r
+00013a20: 6576 5f65 7863 6c75 6465 6420 3d20 3133  ev_excluded = 13
+00013a30: 0a20 2020 2022 2222 5265 636f 7264 2065  .    """Record e
+00013a40: 7863 6c75 6465 6420 696e 2073 6372 6565  xcluded in scree
+00013a50: 6e20 2866 756c 6c2d 7465 7874 2922 2222  n (full-text)"""
+00013a60: 0a20 2020 2072 6576 5f69 6e63 6c75 6465  .    rev_include
+00013a70: 6420 3d20 3134 0a20 2020 2022 2222 5265  d = 14.    """Re
+00013a80: 636f 7264 2069 6e63 6c75 6465 6420 696e  cord included in
+00013a90: 2073 6372 6565 6e20 2866 756c 6c2d 7465   screen (full-te
+00013aa0: 7874 2922 2222 0a20 2020 2072 6576 5f73  xt)""".    rev_s
+00013ab0: 796e 7468 6573 697a 6564 203d 2031 350a  ynthesized = 15.
+00013ac0: 2020 2020 2222 2252 6563 6f72 6420 7379      """Record sy
+00013ad0: 6e74 6865 7369 7a65 6422 2222 0a20 2020  nthesized""".   
+00013ae0: 2023 204e 6f74 6520 3a20 5442 443a 2072   # Note : TBD: r
+00013af0: 6576 5f63 6f64 6564 0a0a 2020 2020 6465  ev_coded..    de
+00013b00: 6620 5f5f 7374 725f 5f28 7365 6c66 2920  f __str__(self) 
+00013b10: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+00013b20: 7265 7475 726e 2066 227b 7365 6c66 2e6e  return f"{self.n
+00013b30: 616d 657d 220a 0a20 2020 2064 6566 205f  ame}"..    def _
+00013b40: 5f6c 745f 5f28 7365 6c66 2c20 6f74 6865  _lt__(self, othe
+00013b50: 7229 202d 3e20 626f 6f6c 3a20 2023 2074  r) -> bool:  # t
+00013b60: 7970 653a 2069 676e 6f72 650a 2020 2020  ype: ignore.    
+00013b70: 2020 2020 6966 2073 656c 662e 5f5f 636c      if self.__cl
+00013b80: 6173 735f 5f20 3d3d 2052 6563 6f72 6453  ass__ == RecordS
+00013b90: 7461 7465 2061 6e64 206f 7468 6572 2e5f  tate and other._
+00013ba0: 5f63 6c61 7373 5f5f 203d 3d20 5265 636f  _class__ == Reco
+00013bb0: 7264 5374 6174 653a 0a20 2020 2020 2020  rdState:.       
+00013bc0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013bd0: 2e76 616c 7565 203c 206f 7468 6572 2e76  .value < other.v
+00013be0: 616c 7565 0a20 2020 2020 2020 2072 6169  alue.        rai
+00013bf0: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+00013c00: 6445 7272 6f72 0a0a 2020 2020 4063 6c61  dError..    @cla
+00013c10: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00013c20: 2067 6574 5f6e 6f6e 5f70 726f 6365 7373   get_non_process
+00013c30: 6564 5f73 7461 7465 7328 636c 7329 202d  ed_states(cls) -
+00013c40: 3e20 6c69 7374 3a0a 2020 2020 2020 2020  > list:.        
+00013c50: 2222 2247 6574 2074 6865 2073 7461 7465  """Get the state
+00013c60: 7320 7468 6174 2063 6f72 7265 7370 6f6e  s that correspon
+00013c70: 6420 746f 206e 6f74 2d79 6574 2d70 726f  d to not-yet-pro
+00013c80: 6365 7373 6564 2222 220a 2020 2020 2020  cessed""".      
+00013c90: 2020 7265 7475 726e 205b 0a20 2020 2020    return [.     
+00013ca0: 2020 2020 2020 2063 6f6c 7265 762e 7265         colrev.re
+00013cb0: 636f 7264 2e52 6563 6f72 6453 7461 7465  cord.RecordState
+00013cc0: 2e6d 645f 7265 7472 6965 7665 642c 0a20  .md_retrieved,. 
+00013cd0: 2020 2020 2020 2020 2020 2063 6f6c 7265             colre
+00013ce0: 762e 7265 636f 7264 2e52 6563 6f72 6453  v.record.RecordS
+00013cf0: 7461 7465 2e6d 645f 696d 706f 7274 6564  tate.md_imported
+00013d00: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00013d10: 6c72 6576 2e72 6563 6f72 642e 5265 636f  lrev.record.Reco
+00013d20: 7264 5374 6174 652e 6d64 5f70 7265 7061  rdState.md_prepa
+00013d30: 7265 642c 0a20 2020 2020 2020 2020 2020  red,.           
+00013d40: 2063 6f6c 7265 762e 7265 636f 7264 2e52   colrev.record.R
+00013d50: 6563 6f72 6453 7461 7465 2e6d 645f 6e65  ecordState.md_ne
+00013d60: 6564 735f 6d61 6e75 616c 5f70 7265 7061  eds_manual_prepa
+00013d70: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
+00013d80: 5d0a 0a20 2020 2040 636c 6173 736d 6574  ]..    @classmet
+00013d90: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+00013da0: 706f 7374 5f78 5f73 7461 7465 7328 636c  post_x_states(cl
+00013db0: 732c 202a 2c20 7374 6174 653a 2052 6563  s, *, state: Rec
+00013dc0: 6f72 6453 7461 7465 2920 2d3e 2074 7970  ordState) -> typ
+00013dd0: 696e 672e 5365 745b 5265 636f 7264 5374  ing.Set[RecordSt
+00013de0: 6174 655d 3a0a 2020 2020 2020 2020 2222  ate]:.        ""
+00013df0: 2247 6574 2074 6865 2073 7461 7465 7320  "Get the states 
+00013e00: 6166 7465 7220 7374 6174 6520 7820 2870  after state x (p
+00013e10: 6173 7365 6420 6173 2061 2070 6172 616d  assed as a param
+00013e20: 6574 6572 2922 2222 0a20 2020 2020 2020  eter)""".       
+00013e30: 2069 6620 7374 6174 6520 3d3d 2052 6563   if state == Rec
+00013e40: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
+00013e50: 6172 6564 3a0a 2020 2020 2020 2020 2020  ared:.          
+00013e60: 2020 7265 7475 726e 207b 0a20 2020 2020    return {.     
+00013e70: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
+00013e80: 6453 7461 7465 2e6d 645f 7072 6570 6172  dState.md_prepar
+00013e90: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00013ea0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
+00013eb0: 6d64 5f70 726f 6365 7373 6564 2c0a 2020  md_processed,.  
+00013ec0: 2020 2020 2020 2020 2020 2020 2020 5265                Re
+00013ed0: 636f 7264 5374 6174 652e 7265 765f 7072  cordState.rev_pr
+00013ee0: 6573 6372 6565 6e5f 696e 636c 7564 6564  escreen_included
+00013ef0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013f00: 2020 5265 636f 7264 5374 6174 652e 7265    RecordState.re
+00013f10: 765f 7072 6573 6372 6565 6e5f 6578 636c  v_prescreen_excl
+00013f20: 7564 6564 2c0a 2020 2020 2020 2020 2020  uded,.          
+00013f30: 2020 2020 2020 5265 636f 7264 5374 6174        RecordStat
+00013f40: 652e 7064 665f 6e65 6564 735f 6d61 6e75  e.pdf_needs_manu
+00013f50: 616c 5f72 6574 7269 6576 616c 2c0a 2020  al_retrieval,.  
+00013f60: 2020 2020 2020 2020 2020 2020 2020 5265                Re
+00013f70: 636f 7264 5374 6174 652e 7064 665f 696d  cordState.pdf_im
+00013f80: 706f 7274 6564 2c0a 2020 2020 2020 2020  ported,.        
+00013f90: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+00013fa0: 6174 652e 7064 665f 6e6f 745f 6176 6169  ate.pdf_not_avai
+00013fb0: 6c61 626c 652c 0a20 2020 2020 2020 2020  lable,.         
+00013fc0: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+00013fd0: 7465 2e70 6466 5f6e 6565 6473 5f6d 616e  te.pdf_needs_man
+00013fe0: 7561 6c5f 7072 6570 6172 6174 696f 6e2c  ual_preparation,
+00013ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014000: 2052 6563 6f72 6453 7461 7465 2e70 6466   RecordState.pdf
+00014010: 5f70 7265 7061 7265 642c 0a20 2020 2020  _prepared,.     
+00014020: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
+00014030: 6453 7461 7465 2e72 6576 5f65 7863 6c75  dState.rev_exclu
+00014040: 6465 642c 0a20 2020 2020 2020 2020 2020  ded,.           
+00014050: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
+00014060: 2e72 6576 5f69 6e63 6c75 6465 642c 0a20  .rev_included,. 
+00014070: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00014080: 6563 6f72 6453 7461 7465 2e72 6576 5f73  ecordState.rev_s
+00014090: 796e 7468 6573 697a 6564 2c0a 2020 2020  ynthesized,.    
+000140a0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+000140b0: 2020 6966 2073 7461 7465 203d 3d20 5265    if state == Re
+000140c0: 636f 7264 5374 6174 652e 6d64 5f70 726f  cordState.md_pro
+000140d0: 6365 7373 6564 3a0a 2020 2020 2020 2020  cessed:.        
+000140e0: 2020 2020 7265 7475 726e 207b 0a20 2020      return {.   
+000140f0: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
+00014100: 6f72 6453 7461 7465 2e6d 645f 7072 6f63  ordState.md_proc
+00014110: 6573 7365 642c 0a20 2020 2020 2020 2020  essed,.         
+00014120: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+00014130: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
+00014140: 5f69 6e63 6c75 6465 642c 0a20 2020 2020  _included,.     
+00014150: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
+00014160: 6453 7461 7465 2e72 6576 5f70 7265 7363  dState.rev_presc
+00014170: 7265 656e 5f65 7863 6c75 6465 642c 0a20  reen_excluded,. 
+00014180: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00014190: 6563 6f72 6453 7461 7465 2e70 6466 5f6e  ecordState.pdf_n
+000141a0: 6565 6473 5f6d 616e 7561 6c5f 7265 7472  eeds_manual_retr
+000141b0: 6965 7661 6c2c 0a20 2020 2020 2020 2020  ieval,.         
+000141c0: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+000141d0: 7465 2e70 6466 5f69 6d70 6f72 7465 642c  te.pdf_imported,
+000141e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000141f0: 2052 6563 6f72 6453 7461 7465 2e70 6466   RecordState.pdf
+00014200: 5f6e 6f74 5f61 7661 696c 6162 6c65 2c0a  _not_available,.
+00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014220: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00014230: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
+00014240: 7061 7261 7469 6f6e 2c0a 2020 2020 2020  paration,.      
+00014250: 2020 2020 2020 2020 2020 5265 636f 7264            Record
+00014260: 5374 6174 652e 7064 665f 7072 6570 6172  State.pdf_prepar
+00014270: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00014280: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
+00014290: 7265 765f 6578 636c 7564 6564 2c0a 2020  rev_excluded,.  
+000142a0: 2020 2020 2020 2020 2020 2020 2020 5265                Re
+000142b0: 636f 7264 5374 6174 652e 7265 765f 696e  cordState.rev_in
+000142c0: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+000142d0: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+000142e0: 6174 652e 7265 765f 7379 6e74 6865 7369  ate.rev_synthesi
+000142f0: 7a65 642c 0a20 2020 2020 2020 2020 2020  zed,.           
+00014300: 207d 0a20 2020 2020 2020 2069 6620 7374   }.        if st
+00014310: 6174 6520 3d3d 2052 6563 6f72 6453 7461  ate == RecordSta
+00014320: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
+00014330: 5f69 6e63 6c75 6465 643a 0a20 2020 2020  _included:.     
+00014340: 2020 2020 2020 2072 6574 7572 6e20 7b0a         return {.
+00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014360: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
+00014370: 7072 6573 6372 6565 6e5f 696e 636c 7564  prescreen_includ
+00014380: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00014390: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
+000143a0: 7265 765f 7072 6573 6372 6565 6e5f 6578  rev_prescreen_ex
+000143b0: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+000143c0: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+000143d0: 6174 652e 7064 665f 6e65 6564 735f 6d61  ate.pdf_needs_ma
+000143e0: 6e75 616c 5f72 6574 7269 6576 616c 2c0a  nual_retrieval,.
+000143f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014400: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00014410: 696d 706f 7274 6564 2c0a 2020 2020 2020  imported,.      
+00014420: 2020 2020 2020 2020 2020 5265 636f 7264            Record
+00014430: 5374 6174 652e 7064 665f 6e6f 745f 6176  State.pdf_not_av
+00014440: 6169 6c61 626c 652c 0a20 2020 2020 2020  ailable,.       
+00014450: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
+00014460: 7461 7465 2e70 6466 5f6e 6565 6473 5f6d  tate.pdf_needs_m
+00014470: 616e 7561 6c5f 7072 6570 6172 6174 696f  anual_preparatio
+00014480: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00014490: 2020 2052 6563 6f72 6453 7461 7465 2e70     RecordState.p
+000144a0: 6466 5f70 7265 7061 7265 642c 0a20 2020  df_prepared,.   
+000144b0: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
+000144c0: 6f72 6453 7461 7465 2e72 6576 5f65 7863  ordState.rev_exc
+000144d0: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
+000144e0: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+000144f0: 7465 2e72 6576 5f69 6e63 6c75 6465 642c  te.rev_included,
+00014500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014510: 2052 6563 6f72 6453 7461 7465 2e72 6576   RecordState.rev
+00014520: 5f73 796e 7468 6573 697a 6564 2c0a 2020  _synthesized,.  
+00014530: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00014540: 2020 2020 6966 2073 7461 7465 203d 3d20      if state == 
+00014550: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00014560: 7072 6570 6172 6564 3a0a 2020 2020 2020  prepared:.      
+00014570: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
+00014580: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00014590: 6563 6f72 6453 7461 7465 2e70 6466 5f70  ecordState.pdf_p
+000145a0: 7265 7061 7265 642c 0a20 2020 2020 2020  repared,.       
+000145b0: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
+000145c0: 7461 7465 2e72 6576 5f65 7863 6c75 6465  tate.rev_exclude
+000145d0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+000145e0: 2020 2052 6563 6f72 6453 7461 7465 2e72     RecordState.r
+000145f0: 6576 5f69 6e63 6c75 6465 642c 0a20 2020  ev_included,.   
+00014600: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
+00014610: 6f72 6453 7461 7465 2e72 6576 5f73 796e  ordState.rev_syn
+00014620: 7468 6573 697a 6564 2c0a 2020 2020 2020  thesized,.      
+00014630: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00014640: 2069 6620 7374 6174 6520 3d3d 2052 6563   if state == Rec
+00014650: 6f72 6453 7461 7465 2e72 6576 5f69 6e63  ordState.rev_inc
+00014660: 6c75 6465 643a 0a20 2020 2020 2020 2020  luded:.         
+00014670: 2020 2072 6574 7572 6e20 7b0a 2020 2020     return {.    
+00014680: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
+00014690: 7264 5374 6174 652e 7265 765f 6578 636c  rdState.rev_excl
+000146a0: 7564 6564 2c0a 2020 2020 2020 2020 2020  uded,.          
+000146b0: 2020 2020 2020 5265 636f 7264 5374 6174        RecordStat
+000146c0: 652e 7265 765f 696e 636c 7564 6564 2c0a  e.rev_included,.
+000146d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146e0: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
+000146f0: 7379 6e74 6865 7369 7a65 642c 0a20 2020  synthesized,.   
+00014700: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+00014710: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
+00014720: 7361 626c 653d 6e6f 2d6d 656d 6265 720a  sable=no-member.
+00014730: 2020 2020 2020 2020 7261 6973 6520 636f          raise co
+00014740: 6c72 6576 5f65 7863 6570 7469 6f6e 732e  lrev_exceptions.
+00014750: 5061 7261 6d65 7465 7245 7272 6f72 280a  ParameterError(.
+00014760: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00014770: 6d65 7465 723d 2273 7461 7465 222c 2076  meter="state", v
+00014780: 616c 7565 3d22 7374 6174 6522 2c20 6f70  alue="state", op
+00014790: 7469 6f6e 733d 636c 732e 5f6d 656d 6265  tions=cls._membe
+000147a0: 725f 6e61 6d65 735f 0a20 2020 2020 2020  r_names_.       
+000147b0: 2029 0a0a 0a6e 6f6e 5f70 726f 6365 7373   )...non_process
+000147c0: 696e 675f 7472 616e 7369 7469 6f6e 7320  ing_transitions 
+000147d0: 3d20 5b0a 2020 2020 5b0a 2020 2020 2020  = [.    [.      
+000147e0: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+000147f0: 2274 7269 6767 6572 223a 2022 666f 726d  "trigger": "form
+00014800: 6174 222c 0a20 2020 2020 2020 2020 2020  at",.           
+00014810: 2022 736f 7572 6365 223a 2073 7461 7465   "source": state
+00014820: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
+00014830: 6573 7422 3a20 7374 6174 652c 0a20 2020  est": state,.   
+00014840: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00014850: 7b0a 2020 2020 2020 2020 2020 2020 2274  {.            "t
+00014860: 7269 6767 6572 223a 2022 6578 706c 6f72  rigger": "explor
+00014870: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+00014880: 2273 6f75 7263 6522 3a20 7374 6174 652c  "source": state,
+00014890: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+000148a0: 7374 223a 2073 7461 7465 2c0a 2020 2020  st": state,.    
+000148b0: 2020 2020 7d2c 0a20 2020 2020 2020 207b      },.        {
+000148c0: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+000148d0: 6967 6765 7222 3a20 2263 6865 636b 222c  igger": "check",
+000148e0: 0a20 2020 2020 2020 2020 2020 2022 736f  .            "so
+000148f0: 7572 6365 223a 2073 7461 7465 2c0a 2020  urce": state,.  
+00014900: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+00014910: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
+00014920: 207d 2c0a 2020 2020 5d0a 2020 2020 666f   },.    ].    fo
+00014930: 7220 7374 6174 6520 696e 206c 6973 7428  r state in list(
+00014940: 5265 636f 7264 5374 6174 6529 0a5d 0a0a  RecordState).]..
+00014950: 0a63 6c61 7373 2052 6563 6f72 6453 7461  .class RecordSta
+00014960: 7465 4d6f 6465 6c3a 0a20 2020 2022 2222  teModel:.    """
+00014970: 5468 6520 5265 636f 7264 5374 6174 654d  The RecordStateM
+00014980: 6f64 656c 2064 6573 6372 6962 6573 2074  odel describes t
+00014990: 7261 6e73 6974 696f 6e73 2062 6574 7765  ransitions betwe
+000149a0: 656e 2052 6563 6f72 6453 7461 7465 7322  en RecordStates"
+000149b0: 2222 0a0a 2020 2020 7472 616e 7369 7469  ""..    transiti
+000149c0: 6f6e 7320 3d20 5b0a 2020 2020 2020 2020  ons = [.        
+000149d0: 7b0a 2020 2020 2020 2020 2020 2020 2274  {.            "t
+000149e0: 7269 6767 6572 223a 2022 6c6f 6164 222c  rigger": "load",
+000149f0: 0a20 2020 2020 2020 2020 2020 2022 736f  .            "so
+00014a00: 7572 6365 223a 2052 6563 6f72 6453 7461  urce": RecordSta
+00014a10: 7465 2e6d 645f 7265 7472 6965 7665 642c  te.md_retrieved,
+00014a20: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+00014a30: 7374 223a 2052 6563 6f72 6453 7461 7465  st": RecordState
+00014a40: 2e6d 645f 696d 706f 7274 6564 2c0a 2020  .md_imported,.  
+00014a50: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+00014a60: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+00014a70: 7472 6967 6765 7222 3a20 2270 7265 7022  trigger": "prep"
+00014a80: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00014a90: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
+00014aa0: 6174 652e 6d64 5f69 6d70 6f72 7465 642c  ate.md_imported,
+00014ab0: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+00014ac0: 7374 223a 2052 6563 6f72 6453 7461 7465  st": RecordState
+00014ad0: 2e6d 645f 6e65 6564 735f 6d61 6e75 616c  .md_needs_manual
+00014ae0: 5f70 7265 7061 7261 7469 6f6e 2c0a 2020  _preparation,.  
+00014af0: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+00014b00: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+00014b10: 7472 6967 6765 7222 3a20 2270 7265 7022  trigger": "prep"
+00014b20: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00014b30: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
+00014b40: 6174 652e 6d64 5f69 6d70 6f72 7465 642c  ate.md_imported,
+00014b50: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+00014b60: 7374 223a 2052 6563 6f72 6453 7461 7465  st": RecordState
+00014b70: 2e6d 645f 7072 6570 6172 6564 2c0a 2020  .md_prepared,.  
+00014b80: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+00014b90: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+00014ba0: 7472 6967 6765 7222 3a20 2270 7265 705f  trigger": "prep_
+00014bb0: 6d61 6e22 2c0a 2020 2020 2020 2020 2020  man",.          
+00014bc0: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
+00014bd0: 7264 5374 6174 652e 6d64 5f6e 6565 6473  rdState.md_needs
+00014be0: 5f6d 616e 7561 6c5f 7072 6570 6172 6174  _manual_preparat
+00014bf0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00014c00: 2022 6465 7374 223a 2052 6563 6f72 6453   "dest": RecordS
+00014c10: 7461 7465 2e6d 645f 7072 6570 6172 6564  tate.md_prepared
+00014c20: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
+00014c30: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00014c40: 2020 2022 7472 6967 6765 7222 3a20 2264     "trigger": "d
+00014c50: 6564 7570 6522 2c0a 2020 2020 2020 2020  edupe",.        
+00014c60: 2020 2020 2273 6f75 7263 6522 3a20 5265      "source": Re
+00014c70: 636f 7264 5374 6174 652e 6d64 5f70 7265  cordState.md_pre
+00014c80: 7061 7265 642c 0a20 2020 2020 2020 2020  pared,.         
+00014c90: 2020 2022 6465 7374 223a 2052 6563 6f72     "dest": Recor
+00014ca0: 6453 7461 7465 2e6d 645f 7072 6f63 6573  dState.md_proces
+00014cb0: 7365 642c 0a20 2020 2020 2020 207d 2c0a  sed,.        },.
+00014cc0: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
+00014cd0: 2020 2020 2020 2274 7269 6767 6572 223a        "trigger":
+00014ce0: 2022 7072 6573 6372 6565 6e22 2c0a 2020   "prescreen",.  
+00014cf0: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+00014d00: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+00014d10: 6d64 5f70 726f 6365 7373 6564 2c0a 2020  md_processed,.  
+00014d20: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+00014d30: 3a20 5265 636f 7264 5374 6174 652e 7265  : RecordState.re
+00014d40: 765f 7072 6573 6372 6565 6e5f 6578 636c  v_prescreen_excl
+00014d50: 7564 6564 2c0a 2020 2020 2020 2020 7d2c  uded,.        },
+00014d60: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+00014d70: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
+00014d80: 3a20 2270 7265 7363 7265 656e 222c 0a20  : "prescreen",. 
+00014d90: 2020 2020 2020 2020 2020 2022 736f 7572             "sour
+00014da0: 6365 223a 2052 6563 6f72 6453 7461 7465  ce": RecordState
+00014db0: 2e6d 645f 7072 6f63 6573 7365 642c 0a20  .md_processed,. 
+00014dc0: 2020 2020 2020 2020 2020 2022 6465 7374             "dest
+00014dd0: 223a 2052 6563 6f72 6453 7461 7465 2e72  ": RecordState.r
+00014de0: 6576 5f70 7265 7363 7265 656e 5f69 6e63  ev_prescreen_inc
+00014df0: 6c75 6465 642c 0a20 2020 2020 2020 207d  luded,.        }
+00014e00: 2c0a 2020 2020 2020 2020 7b0a 2020 2020  ,.        {.    
+00014e10: 2020 2020 2020 2020 2274 7269 6767 6572          "trigger
+00014e20: 223a 2022 7064 665f 6765 7422 2c0a 2020  ": "pdf_get",.  
+00014e30: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+00014e40: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+00014e50: 7265 765f 7072 6573 6372 6565 6e5f 696e  rev_prescreen_in
+00014e60: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+00014e70: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
+00014e80: 7264 5374 6174 652e 7064 665f 696d 706f  rdState.pdf_impo
+00014e90: 7274 6564 2c0a 2020 2020 2020 2020 7d2c  rted,.        },
+00014ea0: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+00014eb0: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
+00014ec0: 3a20 2270 6466 5f67 6574 222c 0a20 2020  : "pdf_get",.   
+00014ed0: 2020 2020 2020 2020 2022 736f 7572 6365           "source
+00014ee0: 223a 2052 6563 6f72 6453 7461 7465 2e72  ": RecordState.r
+00014ef0: 6576 5f70 7265 7363 7265 656e 5f69 6e63  ev_prescreen_inc
+00014f00: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
+00014f10: 2020 2022 6465 7374 223a 2052 6563 6f72     "dest": Recor
+00014f20: 6453 7461 7465 2e70 6466 5f6e 6565 6473  dState.pdf_needs
+00014f30: 5f6d 616e 7561 6c5f 7265 7472 6965 7661  _manual_retrieva
+00014f40: 6c2c 0a20 2020 2020 2020 207d 2c0a 2020  l,.        },.  
+00014f50: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+00014f60: 2020 2020 2274 7269 6767 6572 223a 2022      "trigger": "
+00014f70: 7064 665f 6765 745f 6d61 6e22 2c0a 2020  pdf_get_man",.  
+00014f80: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+00014f90: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+00014fa0: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
+00014fb0: 5f72 6574 7269 6576 616c 2c0a 2020 2020  _retrieval,.    
+00014fc0: 2020 2020 2020 2020 2264 6573 7422 3a20          "dest": 
+00014fd0: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00014fe0: 6e6f 745f 6176 6169 6c61 626c 652c 0a20  not_available,. 
+00014ff0: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
+00015000: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+00015010: 2274 7269 6767 6572 223a 2022 7064 665f  "trigger": "pdf_
+00015020: 6765 745f 6d61 6e22 2c0a 2020 2020 2020  get_man",.      
+00015030: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
+00015040: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00015050: 6e65 6564 735f 6d61 6e75 616c 5f72 6574  needs_manual_ret
+00015060: 7269 6576 616c 2c0a 2020 2020 2020 2020  rieval,.        
+00015070: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
+00015080: 7264 5374 6174 652e 7064 665f 696d 706f  rdState.pdf_impo
+00015090: 7274 6564 2c0a 2020 2020 2020 2020 7d2c  rted,.        },
+000150a0: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+000150b0: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
+000150c0: 3a20 2270 6466 5f70 7265 7022 2c0a 2020  : "pdf_prep",.  
+000150d0: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+000150e0: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+000150f0: 7064 665f 696d 706f 7274 6564 2c0a 2020  pdf_imported,.  
+00015100: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+00015110: 3a20 5265 636f 7264 5374 6174 652e 7064  : RecordState.pd
+00015120: 665f 6e65 6564 735f 6d61 6e75 616c 5f70  f_needs_manual_p
+00015130: 7265 7061 7261 7469 6f6e 2c0a 2020 2020  reparation,.    
+00015140: 2020 2020 7d2c 0a20 2020 2020 2020 207b      },.        {
+00015150: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+00015160: 6967 6765 7222 3a20 2270 6466 5f70 7265  igger": "pdf_pre
+00015170: 7022 2c0a 2020 2020 2020 2020 2020 2020  p",.            
+00015180: 2273 6f75 7263 6522 3a20 5265 636f 7264  "source": Record
+00015190: 5374 6174 652e 7064 665f 696d 706f 7274  State.pdf_import
+000151a0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+000151b0: 2264 6573 7422 3a20 5265 636f 7264 5374  "dest": RecordSt
+000151c0: 6174 652e 7064 665f 7072 6570 6172 6564  ate.pdf_prepared
+000151d0: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
+000151e0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+000151f0: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
+00015200: 6466 5f70 7265 705f 6d61 6e22 2c0a 2020  df_prep_man",.  
+00015210: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+00015220: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+00015230: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
+00015240: 5f70 7265 7061 7261 7469 6f6e 2c0a 2020  _preparation,.  
+00015250: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+00015260: 3a20 5265 636f 7264 5374 6174 652e 7064  : RecordState.pd
+00015270: 665f 7072 6570 6172 6564 2c0a 2020 2020  f_prepared,.    
+00015280: 2020 2020 7d2c 0a20 2020 2020 2020 207b      },.        {
+00015290: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+000152a0: 6967 6765 7222 3a20 2273 6372 6565 6e22  igger": "screen"
+000152b0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+000152c0: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
+000152d0: 6174 652e 7064 665f 7072 6570 6172 6564  ate.pdf_prepared
+000152e0: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
+000152f0: 6573 7422 3a20 5265 636f 7264 5374 6174  est": RecordStat
+00015300: 652e 7265 765f 6578 636c 7564 6564 2c0a  e.rev_excluded,.
+00015310: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+00015320: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00015330: 2022 7472 6967 6765 7222 3a20 2273 6372   "trigger": "scr
+00015340: 6565 6e22 2c0a 2020 2020 2020 2020 2020  een",.          
+00015350: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
+00015360: 7264 5374 6174 652e 7064 665f 7072 6570  rdState.pdf_prep
+00015370: 6172 6564 2c0a 2020 2020 2020 2020 2020  ared,.          
+00015380: 2020 2264 6573 7422 3a20 5265 636f 7264    "dest": Record
+00015390: 5374 6174 652e 7265 765f 696e 636c 7564  State.rev_includ
+000153a0: 6564 2c0a 2020 2020 2020 2020 7d2c 0a20  ed,.        },. 
+000153b0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
+000153c0: 2020 2020 2022 7472 6967 6765 7222 3a20       "trigger": 
+000153d0: 2264 6174 6122 2c0a 2020 2020 2020 2020  "data",.        
+000153e0: 2020 2020 2273 6f75 7263 6522 3a20 5265      "source": Re
+000153f0: 636f 7264 5374 6174 652e 7265 765f 696e  cordState.rev_in
+00015400: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+00015410: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
+00015420: 7264 5374 6174 652e 7265 765f 7379 6e74  rdState.rev_synt
+00015430: 6865 7369 7a65 642c 0a20 2020 2020 2020  hesized,.       
+00015440: 207d 2c0a 2020 2020 5d0a 0a20 2020 2074   },.    ]..    t
+00015450: 7261 6e73 6974 696f 6e73 5f6e 6f6e 5f70  ransitions_non_p
+00015460: 726f 6365 7373 696e 6720 3d20 5b0a 2020  rocessing = [.  
+00015470: 2020 2020 2020 6974 656d 2066 6f72 2073        item for s
+00015480: 7562 6c69 7374 2069 6e20 6e6f 6e5f 7072  ublist in non_pr
+00015490: 6f63 6573 7369 6e67 5f74 7261 6e73 6974  ocessing_transit
+000154a0: 696f 6e73 2066 6f72 2069 7465 6d20 696e  ions for item in
+000154b0: 2073 7562 6c69 7374 0a20 2020 205d 0a0a   sublist.    ]..
+000154c0: 2020 2020 2320 6672 6f6d 2074 7261 6e73      # from trans
+000154d0: 6974 696f 6e73 2069 6d70 6f72 7420 4d61  itions import Ma
+000154e0: 6368 696e 650a 2020 2020 2320 6465 6620  chine.    # def 
+000154f0: 5f5f 696e 6974 5f5f 280a 2020 2020 2320  __init__(.    # 
+00015500: 2020 2020 7365 6c66 2c0a 2020 2020 2320      self,.    # 
+00015510: 2020 2020 2a2c 0a20 2020 2023 2020 2020      *,.    #    
+00015520: 2073 7461 7465 3a20 5265 636f 7264 5374   state: RecordSt
+00015530: 6174 652c 0a20 2020 2023 2029 202d 3e20  ate,.    # ) -> 
+00015540: 4e6f 6e65 3a0a 2020 2020 2320 2020 2020  None:.    #     
+00015550: 7365 6c66 2e73 7461 7465 203d 2073 7461  self.state = sta
+00015560: 7465 0a0a 2020 2020 2320 2020 2020 7365  te..    #     se
+00015570: 6c66 2e6d 6163 6869 6e65 203d 204d 6163  lf.machine = Mac
+00015580: 6869 6e65 280a 2020 2020 2320 2020 2020  hine(.    #     
+00015590: 2020 2020 6d6f 6465 6c3d 7365 6c66 2c0a      model=self,.
+000155a0: 2020 2020 2320 2020 2020 2020 2020 7374      #         st
+000155b0: 6174 6573 3d52 6563 6f72 6453 7461 7465  ates=RecordState
+000155c0: 2c0a 2020 2020 2320 2020 2020 2020 2020  ,.    #         
+000155d0: 7472 616e 7369 7469 6f6e 733d 7365 6c66  transitions=self
+000155e0: 2e74 7261 6e73 6974 696f 6e73 202b 2073  .transitions + s
+000155f0: 656c 662e 7472 616e 7369 7469 6f6e 735f  elf.transitions_
+00015600: 6e6f 6e5f 7072 6f63 6573 7369 6e67 2c0a  non_processing,.
+00015610: 2020 2020 2320 2020 2020 2020 2020 696e      #         in
+00015620: 6974 6961 6c3d 7365 6c66 2e73 7461 7465  itial=self.state
+00015630: 2c0a 2020 2020 2320 2020 2020 290a 0a20  ,.    #     ).. 
+00015640: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00015650: 2020 2020 6465 6620 6765 745f 7661 6c69      def get_vali
+00015660: 645f 7472 616e 7369 7469 6f6e 7328 636c  d_transitions(cl
+00015670: 732c 202a 2c20 7374 6174 653a 2052 6563  s, *, state: Rec
+00015680: 6f72 6453 7461 7465 2920 2d3e 2073 6574  ordState) -> set
+00015690: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+000156a0: 2074 6865 206c 6973 7420 6f66 2076 616c   the list of val
+000156b0: 6964 2074 7261 6e73 6974 696f 6e73 2222  id transitions""
+000156c0: 220a 2020 2020 2020 2020 6c6f 6767 696e  ".        loggin
+000156d0: 672e 6765 744c 6f67 6765 7228 2274 7261  g.getLogger("tra
+000156e0: 6e73 6974 696f 6e73 2229 2e73 6574 4c65  nsitions").setLe
+000156f0: 7665 6c28 6c6f 6767 696e 672e 5741 524e  vel(logging.WARN
+00015700: 494e 4729 0a20 2020 2020 2020 2072 6574  ING).        ret
+00015710: 7572 6e20 7365 7428 7b78 5b22 7472 6967  urn set({x["trig
+00015720: 6765 7222 5d20 666f 7220 7820 696e 2063  ger"] for x in c
+00015730: 6c73 2e74 7261 6e73 6974 696f 6e73 2069  ls.transitions i
+00015740: 6620 785b 2273 6f75 7263 6522 5d20 3d3d  f x["source"] ==
+00015750: 2073 7461 7465 7d29 0a0a 2020 2020 4063   state})..    @c
+00015760: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00015770: 6566 2067 6574 5f70 7265 6365 6469 6e67  ef get_preceding
+00015780: 5f73 7461 7465 7328 636c 732c 202a 2c20  _states(cls, *, 
+00015790: 7374 6174 653a 2052 6563 6f72 6453 7461  state: RecordSta
+000157a0: 7465 2920 2d3e 2073 6574 3a0a 2020 2020  te) -> set:.    
+000157b0: 2020 2020 2222 2247 6574 2074 6865 2073      """Get the s
+000157c0: 7461 7465 7320 7072 6563 6564 696e 6720  tates preceding 
+000157d0: 7468 6520 7374 6174 6520 7468 6174 2069  the state that i
+000157e0: 7320 6769 7665 6e20 6173 2061 2070 6172  s given as a par
+000157f0: 616d 6574 6572 2222 220a 0a20 2020 2020  ameter"""..     
+00015800: 2020 206c 6f67 6769 6e67 2e67 6574 4c6f     logging.getLo
+00015810: 6767 6572 2822 7472 616e 7369 7469 6f6e  gger("transition
+00015820: 7322 292e 7365 744c 6576 656c 286c 6f67  s").setLevel(log
+00015830: 6769 6e67 2e57 4152 4e49 4e47 290a 2020  ging.WARNING).  
+00015840: 2020 2020 2020 7072 6563 6564 696e 675f        preceding_
+00015850: 7374 6174 6573 3a20 7365 745b 5265 636f  states: set[Reco
+00015860: 7264 5374 6174 655d 203d 2073 6574 2829  rdState] = set()
+00015870: 0a20 2020 2020 2020 2061 6464 6564 203d  .        added =
+00015880: 2054 7275 650a 2020 2020 2020 2020 7768   True.        wh
+00015890: 696c 6520 6164 6465 643a 0a20 2020 2020  ile added:.     
+000158a0: 2020 2020 2020 2070 7265 6365 6469 6e67         preceding
+000158b0: 5f73 7461 7465 735f 7369 7a65 203d 206c  _states_size = l
+000158c0: 656e 2870 7265 6365 6469 6e67 5f73 7461  en(preceding_sta
+000158d0: 7465 7329 0a20 2020 2020 2020 2020 2020  tes).           
+000158e0: 2066 6f72 2074 7261 6e73 6974 696f 6e20   for transition 
+000158f0: 696e 2052 6563 6f72 6453 7461 7465 4d6f  in RecordStateMo
+00015900: 6465 6c2e 7472 616e 7369 7469 6f6e 733a  del.transitions:
+00015910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015920: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00015930: 2020 2020 2020 2020 2020 7472 616e 7369            transi
+00015940: 7469 6f6e 5b22 6465 7374 225d 2069 6e20  tion["dest"] in 
+00015950: 7072 6563 6564 696e 675f 7374 6174 6573  preceding_states
+00015960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015970: 2020 2020 206f 7220 7374 6174 6520 3d3d       or state ==
+00015980: 2074 7261 6e73 6974 696f 6e5b 2264 6573   transition["des
+00015990: 7422 5d0a 2020 2020 2020 2020 2020 2020  t"].            
+000159a0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+000159b0: 2020 2020 2020 2020 2020 2070 7265 6365             prece
+000159c0: 6469 6e67 5f73 7461 7465 732e 6164 6428  ding_states.add(
+000159d0: 7472 616e 7369 7469 6f6e 5b22 736f 7572  transition["sour
+000159e0: 6365 225d 2920 2023 2074 7970 653a 2069  ce"])  # type: i
+000159f0: 676e 6f72 650a 2020 2020 2020 2020 2020  gnore.          
+00015a00: 2020 6966 2070 7265 6365 6469 6e67 5f73    if preceding_s
+00015a10: 7461 7465 735f 7369 7a65 203d 3d20 6c65  tates_size == le
+00015a20: 6e28 7072 6563 6564 696e 675f 7374 6174  n(preceding_stat
+00015a30: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+00015a40: 2020 2020 2061 6464 6564 203d 2046 616c       added = Fal
+00015a50: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+00015a60: 6e20 7072 6563 6564 696e 675f 7374 6174  n preceding_stat
+00015a70: 6573 0a0a 2020 2020 4063 6c61 7373 6d65  es..    @classme
+00015a80: 7468 6f64 0a20 2020 2064 6566 2063 6865  thod.    def che
+00015a90: 636b 5f6f 7065 7261 7469 6f6e 5f70 7265  ck_operation_pre
+00015aa0: 636f 6e64 6974 696f 6e28 0a20 2020 2020  condition(.     
+00015ab0: 2020 2063 6c73 2c20 2a2c 206f 7065 7261     cls, *, opera
+00015ac0: 7469 6f6e 3a20 636f 6c72 6576 2e6f 7065  tion: colrev.ope
+00015ad0: 7261 7469 6f6e 2e4f 7065 7261 7469 6f6e  ration.Operation
+00015ae0: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+00015af0: 2020 2020 2020 2020 2222 2243 6865 636b          """Check
+00015b00: 2074 6865 2070 7265 636f 6e64 6974 696f   the preconditio
+00015b10: 6e73 2066 6f72 2061 6e20 6f70 6572 6174  ns for an operat
+00015b20: 696f 6e22 2222 0a0a 2020 2020 2020 2020  ion"""..        
+00015b30: 6465 6620 6765 745f 7374 6174 6573 5f73  def get_states_s
+00015b40: 6574 2829 202d 3e20 7365 743a 0a20 2020  et() -> set:.   
+00015b50: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00015b60: 6f70 6572 6174 696f 6e2e 7265 7669 6577  operation.review
+00015b70: 5f6d 616e 6167 6572 2e64 6174 6173 6574  _manager.dataset
+00015b80: 2e72 6563 6f72 6473 5f66 696c 652e 6973  .records_file.is
+00015b90: 5f66 696c 6528 293a 0a20 2020 2020 2020  _file():.       
+00015ba0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00015bb0: 7365 7428 290a 2020 2020 2020 2020 2020  set().          
+00015bc0: 2020 7265 636f 7264 735f 6865 6164 6572    records_header
+00015bd0: 7320 3d20 6f70 6572 6174 696f 6e2e 7265  s = operation.re
+00015be0: 7669 6577 5f6d 616e 6167 6572 2e64 6174  view_manager.dat
+00015bf0: 6173 6574 2e6c 6f61 645f 7265 636f 7264  aset.load_record
+00015c00: 735f 6469 6374 280a 2020 2020 2020 2020  s_dict(.        
+00015c10: 2020 2020 2020 2020 6865 6164 6572 5f6f          header_o
+00015c20: 6e6c 793d 5472 7565 0a20 2020 2020 2020  nly=True.       
+00015c30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00015c40: 2020 2072 6563 6f72 645f 6865 6164 6572     record_header
+00015c50: 5f6c 6973 7420 3d20 6c69 7374 2872 6563  _list = list(rec
+00015c60: 6f72 6473 5f68 6561 6465 7273 2e76 616c  ords_headers.val
+00015c70: 7565 7328 2929 0a0a 2020 2020 2020 2020  ues())..        
+00015c80: 2020 2020 7265 7475 726e 207b 656c 5b22      return {el["
+00015c90: 636f 6c72 6576 5f73 7461 7475 7322 5d20  colrev_status"] 
+00015ca0: 666f 7220 656c 2069 6e20 7265 636f 7264  for el in record
+00015cb0: 5f68 6561 6465 725f 6c69 7374 7d0a 0a20  _header_list}.. 
+00015cc0: 2020 2020 2020 2069 6620 6f70 6572 6174         if operat
+00015cd0: 696f 6e2e 7265 7669 6577 5f6d 616e 6167  ion.review_manag
+00015ce0: 6572 2e73 6574 7469 6e67 732e 7072 6f6a  er.settings.proj
+00015cf0: 6563 742e 6465 6c61 795f 6175 746f 6d61  ect.delay_automa
+00015d00: 7465 645f 7072 6f63 6573 7369 6e67 3a0a  ted_processing:.
+00015d10: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00015d20: 745f 7374 6174 6573 3a20 6c69 7374 5b73  t_states: list[s
+00015d30: 7472 5d20 3d20 5b0a 2020 2020 2020 2020  tr] = [.        
+00015d40: 2020 2020 2020 2020 7374 7228 785b 2273          str(x["s
+00015d50: 6f75 7263 6522 5d29 0a20 2020 2020 2020  ource"]).       
+00015d60: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
+00015d70: 6e20 636f 6c72 6576 2e72 6563 6f72 642e  n colrev.record.
+00015d80: 5265 636f 7264 5374 6174 654d 6f64 656c  RecordStateModel
+00015d90: 2e74 7261 6e73 6974 696f 6e73 0a20 2020  .transitions.   
+00015da0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00015db0: 7374 7228 6f70 6572 6174 696f 6e2e 7479  str(operation.ty
+00015dc0: 7065 2920 3d3d 2078 5b22 7472 6967 6765  pe) == x["trigge
+00015dd0: 7222 5d0a 2020 2020 2020 2020 2020 2020  r"].            
+00015de0: 5d0a 2020 2020 2020 2020 2020 2020 7374  ].            st
+00015df0: 6174 6520 3d20 636f 6c72 6576 2e72 6563  ate = colrev.rec
+00015e00: 6f72 642e 5265 636f 7264 5374 6174 655b  ord.RecordState[
+00015e10: 7374 6172 745f 7374 6174 6573 5b30 5d5d  start_states[0]]
+00015e20: 0a0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+00015e30: 725f 7374 6174 655f 6c69 7374 203d 2067  r_state_list = g
+00015e40: 6574 5f73 7461 7465 735f 7365 7428 290a  et_states_set().
+00015e50: 2020 2020 2020 2020 2020 2020 2320 7365              # se
+00015e60: 6c66 2e72 6576 6965 775f 6d61 6e61 6765  lf.review_manage
+00015e70: 722e 6c6f 6767 6572 2e64 6562 7567 2866  r.logger.debug(f
+00015e80: 2263 7572 5f73 7461 7465 5f6c 6973 743a  "cur_state_list:
+00015e90: 207b 6375 725f 7374 6174 655f 6c69 7374   {cur_state_list
+00015ea0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00015eb0: 2320 7365 6c66 2e72 6576 6965 775f 6d61  # self.review_ma
+00015ec0: 6e61 6765 722e 6c6f 6767 6572 2e64 6562  nager.logger.deb
+00015ed0: 7567 2866 2270 7265 636f 6e64 6974 696f  ug(f"preconditio
+00015ee0: 6e3a 207b 7365 6c66 2e73 7461 7465 7d22  n: {self.state}"
+00015ef0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00015f00: 7175 6972 6564 5f61 6273 656e 7420 3d20  quired_absent = 
+00015f10: 636c 732e 6765 745f 7072 6563 6564 696e  cls.get_precedin
+00015f20: 675f 7374 6174 6573 2873 7461 7465 3d73  g_states(state=s
+00015f30: 7461 7465 290a 2020 2020 2020 2020 2020  tate).          
+00015f40: 2020 2320 7365 6c66 2e72 6576 6965 775f    # self.review_
+00015f50: 6d61 6e61 6765 722e 6c6f 6767 6572 2e64  manager.logger.d
+00015f60: 6562 7567 2866 2272 6571 7569 7265 645f  ebug(f"required_
+00015f70: 6162 7365 6e74 3a20 7b72 6571 7569 7265  absent: {require
+00015f80: 645f 6162 7365 6e74 7d22 290a 2020 2020  d_absent}").    
+00015f90: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
+00015fa0: 7469 6f6e 203d 2063 7572 5f73 7461 7465  tion = cur_state
+00015fb0: 5f6c 6973 742e 696e 7465 7273 6563 7469  _list.intersecti
+00015fc0: 6f6e 2872 6571 7569 7265 645f 6162 7365  on(required_abse
+00015fd0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+00015fe0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00015ff0: 2020 2020 206c 656e 2863 7572 5f73 7461       len(cur_sta
+00016000: 7465 5f6c 6973 7429 203d 3d20 300a 2020  te_list) == 0.  
+00016010: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00016020: 6420 6e6f 7420 6f70 6572 6174 696f 6e2e  d not operation.
+00016030: 7479 7065 2e6e 616d 6520 3d3d 2022 6c6f  type.name == "lo
+00016040: 6164 2220 2023 2074 7970 653a 2069 676e  ad"  # type: ign
+00016050: 6f72 650a 2020 2020 2020 2020 2020 2020  ore.            
+00016060: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00016070: 2020 2072 6169 7365 2063 6f6c 7265 765f     raise colrev_
+00016080: 6578 6365 7074 696f 6e73 2e4e 6f52 6563  exceptions.NoRec
+00016090: 6f72 6473 4572 726f 7228 290a 2020 2020  ordsError().    
+000160a0: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+000160b0: 6e74 6572 7365 6374 696f 6e29 2021 3d20  ntersection) != 
+000160c0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000160d0: 2020 2072 6169 7365 2063 6f6c 7265 765f     raise colrev_
+000160e0: 6578 6365 7074 696f 6e73 2e50 726f 6365  exceptions.Proce
+000160f0: 7373 4f72 6465 7256 696f 6c61 7469 6f6e  ssOrderViolation
+00016100: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00016110: 2020 2020 2020 6f70 6572 6174 696f 6e2e        operation.
+00016120: 7479 7065 2e6e 616d 652c 2073 7472 2873  type.name, str(s
+00016130: 7461 7465 292c 206c 6973 7428 696e 7465  tate), list(inte
+00016140: 7273 6563 7469 6f6e 290a 2020 2020 2020  rsection).      
+00016150: 2020 2020 2020 2020 2020 290a                      ).
```

### Comparing `colrev-0.8.4/colrev/review_manager.py` & `colrev-0.9.0/colrev/review_manager.py`

 * *Files 0% similar despite different names*

```diff
@@ -145,19 +145,18 @@
             if (self.path / Path(".git")).is_dir():
                 if git.Repo().active_branch.name == "gh-pages":
                     raise colrev_exceptions.RepoSetupError(
                         msg="Currently on gh-pages branch. Switch to main: "
                         + f"{colors.ORANGE}git switch main{colors.END}"
                     )
 
-            if force_mode:
-                if debug_mode:
-                    self.logger.debug(exc)
-            else:
+            if not force_mode:
                 raise exc
+            if debug_mode:
+                self.logger.debug(exc)
 
     def __check_update(self) -> None:
         # Once the following has run for all repositories,
         # it should only be called when the versions differ.
         # last_version, current_version = self.get_colrev_versions()
         # if last_version != current_version:
         upgrade_operation = self.get_upgrade()
@@ -750,11 +749,7 @@
         review_type=review_type,
         example=example,
         light=light,
         local_pdf_collection=local_pdf_collection,
         target_path=target_path,
         exact_call=exact_call,
     )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/service.py` & `colrev-0.9.0/colrev/service.py`

 * *Files 1% similar despite different names*

```diff
@@ -312,11 +312,7 @@
 
                 if 0 == self.service_queue.qsize():
                     time.sleep(1)
                     continue
                 self.service_queue.task_done()
         except KeyboardInterrupt:
             print("Shutting down service")
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/settings.py` & `colrev-0.9.0/colrev/settings.py`

 * *Files 1% similar despite different names*

```diff
@@ -6,30 +6,28 @@
 import json
 import typing
 import warnings
 from dataclasses import asdict
 from dataclasses import dataclass
 from enum import Enum
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import dacite
 from dacite import from_dict
 from dacite.exceptions import MissingValueError
 from dacite.exceptions import WrongTypeError
 from dataclasses_jsonschema import FieldEncoder
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.review_manager
+if TYPE_CHECKING:
+    import colrev.review_manager
 
 
 # Note : to avoid performance issues on startup (ReviewManager, parsing settings)
 # the settings dataclasses should be in one file (13s compared to 0.3s)
 
 
 # Project
@@ -679,11 +677,7 @@
     exported_dict = asdict(
         review_manager.settings, dict_factory=colrev.env.utils.custom_asdict_factory
     )
 
     with open("settings.json", "w", encoding="utf-8") as outfile:
         json.dump(exported_dict, outfile, indent=4)
     review_manager.dataset.add_changes(path=Path("settings.json"))
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/template/custom_scripts/custom_data_script.py` & `colrev-0.9.0/colrev/template/custom_scripts/custom_data_script.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 #! /usr/bin/env python
 """Template for a custom data PackageEndpoint"""
 from __future__ import annotations
 
+from typing import TYPE_CHECKING
+
 import zope.interface
 from dacite import from_dict
 
 import colrev.operation
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.data
+if TYPE_CHECKING:
+    import colrev.ops.data
 
 
 @zope.interface.implementer(colrev.env.package_manager.DataPackageEndpointInterface)
 class CustomData:
     """Class for custom data scripts"""
 
     settings_class = colrev.env.package_manager.DefaultSettings
```

### Comparing `colrev-0.8.4/colrev/template/custom_scripts/custom_pdf_get_script.py` & `colrev-0.9.0/colrev/template/custom_scripts/custom_pdf_get_script.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,21 +1,20 @@
 #! /usr/bin/env python
 """Template for a custom PDFGet PackageEndpoint"""
 from __future__ import annotations
 
+from typing import TYPE_CHECKING
+
 import zope.interface
 from dacite import from_dict
 
 import colrev.operation
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_get
+if TYPE_CHECKING:
+    import colrev.ops.pdf_get
 
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFGetPackageEndpointInterface)
 class CustomPDFGet:
```

### Comparing `colrev-0.8.4/colrev/template/custom_scripts/custom_pdf_prep_script.py` & `colrev-0.9.0/colrev/template/custom_scripts/custom_pdf_prep_script.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,24 +1,22 @@
 #! /usr/bin/env python
 """Template for a custom PDFPrep PackageEndpoint"""
 from __future__ import annotations
 
 import random
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dacite import from_dict
 
 import colrev.operation
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.pdf_prep
+if TYPE_CHECKING:
+    import colrev.ops.pdf_prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PDFPrepPackageEndpointInterface)
 class CustomPDFPrep:
     """Class for custom pdf-prep scripts"""
```

### Comparing `colrev-0.8.4/colrev/template/custom_scripts/custom_prep_script.py` & `colrev-0.9.0/colrev/template/custom_scripts/custom_prep_script.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 #!/usr/bin/env python3
 """Template for a custom Prep PackageEndpoint"""
 from __future__ import annotations
 
+from typing import TYPE_CHECKING
+
 import zope.interface
 from dacite import from_dict
 
 import colrev.operation
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prep
+if TYPE_CHECKING:
+    import colrev.ops.prep
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.PrepPackageEndpointInterface)
 class CustomPrep:
     """Class for custom prep scripts"""
@@ -43,11 +41,7 @@
         if "journal" in record.data:
             if record.data["journal"] == "MISQ":
                 record.update_field(
                     key="journal", value="MIS Quarterly", source="custom_prep"
                 )
 
         return record
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/template/custom_scripts/custom_prescreen_script.py` & `colrev-0.9.0/colrev/template/custom_scripts/custom_prescreen_script.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,24 +1,22 @@
 #! /usr/bin/env python
 """Template for a custom Prescreen PackageEndpoint"""
 from __future__ import annotations
 
 import random
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dacite import from_dict
 
 import colrev.operation
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.prescreen
+if TYPE_CHECKING:
+    import colrev.ops.prescreen
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.PrescreenPackageEndpointInterface
 )
```

### Comparing `colrev-0.8.4/colrev/template/custom_scripts/custom_screen_script.py` & `colrev-0.9.0/colrev/template/custom_scripts/custom_screen_script.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,24 +1,22 @@
 #! /usr/bin/env python
 """Template for a custom Screen PackageEndpoint"""
 from __future__ import annotations
 
 import random
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dacite import from_dict
 
 import colrev.operation
 import colrev.record
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.screen.Screen
+if TYPE_CHECKING:
+    import colrev.screen.Screen
 
 # pylint: disable=too-few-public-methods
 
 
 @zope.interface.implementer(colrev.env.package_manager.ScreenPackageEndpointInterface)
 class CustomScreen:
     """Class for custom screen scripts"""
```

### Comparing `colrev-0.8.4/colrev/template/custom_scripts/custom_search_source_script.py` & `colrev-0.9.0/colrev/template/custom_scripts/custom_search_source_script.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,24 +1,22 @@
 #! /usr/bin/env python
 """Template for a custom SearchSource PackageEndpoint"""
 from __future__ import annotations
 
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import zope.interface
 from dacite import from_dict
 
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.search.Search
+if TYPE_CHECKING:
+    import colrev.ops.search.Search
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 class CustomSearch:
     """Class for custom search scripts"""
```

### Comparing `colrev-0.8.4/colrev/template/example/30_example_records.bib` & `colrev-0.9.0/colrev/template/example/30_example_records.bib`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/github_pages/index.html` & `colrev-0.9.0/colrev/template/github_pages/index.html`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/init/LICENSE-CC-BY-4.0.txt` & `colrev-0.9.0/colrev/template/init/LICENSE-CC-BY-4.0.txt`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/init/colrev_update.yml` & `colrev-0.9.0/colrev/template/init/colrev_update.yml`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/init/colrev_update_curation.yml` & `colrev-0.9.0/colrev/template/init/colrev_update_curation.yml`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/init/pre-commit-config.yaml` & `colrev-0.9.0/colrev/template/init/pre-commit-config.yaml`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/init/settings.json` & `colrev-0.9.0/colrev/template/init/settings.json`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/ops/commit_report_details.txt` & `colrev-0.9.0/colrev/template/ops/commit_report_details.txt`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/ops/predatory_journals_beall.csv` & `colrev-0.9.0/colrev/template/ops/predatory_journals_beall.csv`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/ops/prep_man_curation.ipynb` & `colrev-0.9.0/colrev/template/ops/prep_man_curation.ipynb`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/ops/status.txt` & `colrev-0.9.0/colrev/template/ops/status.txt`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/package_endpoints.json` & `colrev-0.9.0/colrev/template/package_endpoints.json`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/package_status.json` & `colrev-0.9.0/colrev/template/package_status.json`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/paper_md/APA-7.docx` & `colrev-0.9.0/colrev/template/paper_md/APA-7.docx`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/paper_md/paper.md` & `colrev-0.9.0/colrev/template/paper_md/paper.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/prisma/PRISMA.csv` & `colrev-0.9.0/colrev/template/prisma/PRISMA.csv`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/prisma/PRISMA_original.csv` & `colrev-0.9.0/colrev/template/prisma/PRISMA_original.csv`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/prisma/prisma-refs.bib` & `colrev-0.9.0/colrev/template/prisma/prisma-refs.bib`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml` & `colrev-0.9.0/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/template/review_type/meta_analysis/paper.md` & `colrev-0.9.0/colrev/template/review_type/meta_analysis/paper.md`

 * *Files identical despite different names*

### Comparing `colrev-0.8.4/colrev/ui_cli/add_packages.py` & `colrev-0.9.0/colrev/ui_cli/add_packages.py`

 * *Files 2% similar despite different names*

```diff
@@ -139,11 +139,7 @@
     review_manager = colrev.review_manager.ReviewManager(force_mode=True)
     data_operation = colrev.ops.data.Data(review_manager=review_manager)
 
     data_operation.main(selection_list=["colrev.bibliography_export"], silent_mode=True)
     data_operation.review_manager.logger.info(
         f"{colors.GREEN}Successfully added {add} data endpoint{colors.END}"
     )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ui_cli/cli.py` & `colrev-0.9.0/colrev/ui_cli/cli.py`

 * *Files 6% similar despite different names*

```diff
@@ -5,32 +5,36 @@
 import logging
 import os
 import subprocess  # nosec
 import sys
 import time
 import typing
 import webbrowser
+from functools import partial
+from functools import wraps
 from pathlib import Path
 
 import click
 import click_completion.core
 import pandas as pd
 
 import colrev.exceptions as colrev_exceptions
 import colrev.record
 import colrev.review_manager
 import colrev.ui_cli.cli_colors as colors
 import colrev.ui_cli.cli_status_printer
 import colrev.ui_cli.cli_validation
+import colrev.ui_cli.dedupe_errors
 
 # pylint: disable=too-many-lines
 # pylint: disable=redefined-builtin
 # pylint: disable=redefined-outer-name
 # pylint: disable=too-many-arguments
 # pylint: disable=unused-argument
+# pylint: disable=superfluous-parens
 # Note: autocompletion needs bash/... activation:
 # https://click.palletsprojects.com/en/7.x/bashcomplete/
 
 EXACT_CALL = "colrev " + subprocess.list2cmdline(sys.argv[1:])  # nosec
 
 
 def __custom_startswith(string: str, incomplete: str) -> bool:
@@ -78,14 +82,32 @@
             cmd = super(SpecialHelpOrder, self).command(*args, **kwargs)(fun)
             help_priorities[cmd.name] = help_priority
             return cmd
 
         return decorator
 
 
+def catch_exception(func=None, *, handle) -> typing.Any:  # type: ignore
+    """Catch typical cli exceptions (e.g., CoLRevException)"""
+    if not func:
+        return partial(catch_exception, handle=handle)
+
+    # pylint: disable=inconsistent-return-statements
+    @wraps(func)
+    def wrapper(*args, **kwargs) -> None:  # type: ignore
+        try:
+            return func(*args, **kwargs)
+        except colrev_exceptions.CoLRevException as exc:
+            if kwargs["force"]:
+                raise exc
+            print(exc)
+
+    return wrapper
+
+
 @click.group(cls=SpecialHelpOrder)
 @click.pass_context
 def main(ctx: click.core.Context) -> None:
     """CoLRev commands:
 
     \b
     status        Shows status, how to proceed, and checks for errors
@@ -144,40 +166,35 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode: conduct full search again",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def init(
     ctx: click.core.Context,
     type: str,
     example: bool,
     light: bool,
     local_pdf_collection: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Initialize (define review objectives and type)"""
     # pylint: disable=import-outside-toplevel
     import colrev.ops.init
 
-    try:
-        colrev.review_manager.get_init_operation(
-            review_type=type,
-            example=example,
-            light=light,
-            local_pdf_collection=local_pdf_collection,
-            exact_call=EXACT_CALL,
-        )
-
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    colrev.review_manager.get_init_operation(
+        review_type=type,
+        example=example,
+        light=light,
+        local_pdf_collection=local_pdf_collection,
+        exact_call=EXACT_CALL,
+    )
 
 
 @main.command(help_priority=2)
 @click.option(
     "-a",
     "--analytics",
     is_flag=True,
@@ -195,14 +212,15 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def status(
     ctx: click.core.Context,
     analytics: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Show status"""
@@ -221,18 +239,14 @@
 
         colrev.ui_cli.cli_status_printer.print_project_status(status_operation)
 
     except KeyboardInterrupt:
         print("Stopped...")
     except colrev_exceptions.RepoSetupError as exc:
         print(exc)
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
 
 
 @main.command(help_priority=3)
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
@@ -243,14 +257,15 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def retrieve(
     ctx: click.core.Context,
     verbose: bool,
     force: bool,
 ) -> None:
     """Retrieve, a high-level operation, consists of search, load, prep, and dedupe.
 
@@ -259,69 +274,61 @@
     - Copy files (*.bib, *.ris, *.xlsx, ...) to the directory data/search or
     - Copy PDF files to the directory data/pdfs or
     - Add an API-based search, as described in the documentation:
 
     https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/search.html
     """
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            verbose_mode=verbose, force_mode=force, high_level_operation=True
-        )
-
-        if not any(review_manager.search_dir.iterdir()) and not any(
-            review_manager.pdf_dir.iterdir()
-        ):
-            # Note : API-based searches automatically retrieve files
-            # when they are added, i.e., the following message should
-            # not be shown.
-            print(
-                "To retrieve search results,\n"
-                " - copy files (*.bib, *.ris, *.xlsx, ...) "
-                f"to the directory {review_manager.SEARCHDIR_RELATIVE} or\n"
-                f" - copy PDF files to the directory {review_manager.PDF_DIR_RELATIVE} or \n"
-                " - add an API-based search, as described in the documentation:\n"
-                "https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/search.html"
-            )
-            return
+    review_manager = colrev.review_manager.ReviewManager(
+        verbose_mode=verbose, force_mode=force, high_level_operation=True
+    )
 
-        review_manager.logger.info("Retrieve")
-        review_manager.logger.info(
-            "Retrieve is a high-level operation consisting of search, load, prep, and dedupe:"
+    if not any(review_manager.search_dir.iterdir()) and not any(
+        review_manager.pdf_dir.iterdir()
+    ):
+        # Note : API-based searches automatically retrieve files
+        # when they are added, i.e., the following message should
+        # not be shown.
+        print(
+            "To retrieve search results,\n"
+            " - copy files (*.bib, *.ris, *.xlsx, ...) "
+            f"to the directory {review_manager.SEARCHDIR_RELATIVE} or\n"
+            f" - copy PDF files to the directory {review_manager.PDF_DIR_RELATIVE} or \n"
+            " - add an API-based search, as described in the documentation:\n"
+            "https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/search.html"
         )
-        print()
+        return
 
-        search_operation = review_manager.get_search_operation()
-        search_operation.main(rerun=False)
+    review_manager.logger.info("Retrieve")
+    review_manager.logger.info(
+        "Retrieve is a high-level operation consisting of search, load, prep, and dedupe:"
+    )
+    print()
 
-        print()
+    search_operation = review_manager.get_search_operation()
+    search_operation.main(rerun=False)
 
-        review_manager.exact_call = "colrev prep"
-        load_operation = review_manager.get_load_operation()
-        new_sources = load_operation.get_new_sources(skip_query=True)
-        load_operation = review_manager.get_load_operation(hide_load_explanation=True)
-        load_operation.main(
-            new_sources=new_sources, keep_ids=False, combine_commits=False
-        )
+    print()
 
-        print()
-        review_manager.exact_call = "colrev prep"
-        prep_operation = review_manager.get_prep_operation()
-        prep_operation.main()
+    review_manager.exact_call = "colrev prep"
+    load_operation = review_manager.get_load_operation()
+    new_sources = load_operation.get_new_sources(skip_query=True)
+    load_operation = review_manager.get_load_operation(hide_load_explanation=True)
+    load_operation.main(new_sources=new_sources, keep_ids=False, combine_commits=False)
 
-        print()
+    print()
+    review_manager.exact_call = "colrev prep"
+    prep_operation = review_manager.get_prep_operation()
+    prep_operation.main()
 
-        review_manager.exact_call = "colrev dedupe"
-        dedupe_operation = review_manager.get_dedupe_operation()
-        dedupe_operation.main()
+    print()
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    review_manager.exact_call = "colrev dedupe"
+    dedupe_operation = review_manager.get_dedupe_operation()
+    dedupe_operation.main()
 
 
 @main.command(help_priority=4)
 @click.option(
     "-a",
     "--add",
     type=str,
@@ -369,14 +376,15 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def search(
     ctx: click.core.Context,
     add: str,
     view: bool,
     selected: str,
     rerun: bool,
     setup_custom_script: bool,
@@ -384,41 +392,35 @@
     force: bool,
 ) -> None:
     """Search for records"""
 
     # pylint: disable=import-outside-toplevel
     import colrev.ui_cli.add_packages
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        search_operation = review_manager.get_search_operation()
-
-        if add:
-            colrev.ui_cli.add_packages.add_search_source(
-                search_operation=search_operation,
-                query=add,
-            )
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    search_operation = review_manager.get_search_operation()
 
-        elif view:
-            search_operation.view_sources()
+    if add:
+        colrev.ui_cli.add_packages.add_search_source(
+            search_operation=search_operation,
+            query=add,
+        )
 
-        elif setup_custom_script:
-            search_operation.setup_custom_script()
-            print("Activated custom_search_script.py.")
-            print("Please update the source in settings.json and commit.")
+    elif view:
+        search_operation.view_sources()
 
-        else:
-            search_operation.main(selection_str=selected, rerun=rerun)
+    elif setup_custom_script:
+        search_operation.setup_custom_script()
+        print("Activated custom_search_script.py.")
+        print("Please update the source in settings.json and commit.")
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    else:
+        search_operation.main(selection_str=selected, rerun=rerun)
 
 
 @main.command(help_priority=5)
 @click.option(
     "-k",
     "--keep_ids",
     is_flag=True,
@@ -450,49 +452,42 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def load(
     ctx: click.core.Context,
     keep_ids: bool,
     combine_commits: bool,
     skip_query: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Load records"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        # already start LocalIndex (for set_ids)
-        load_operation = review_manager.get_load_operation()
-
-        new_sources = load_operation.get_new_sources(skip_query=skip_query)
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    # already start LocalIndex (for set_ids)
+    load_operation = review_manager.get_load_operation()
 
-        if combine_commits:
-            logging.info(
-                "Combine mode: all search sources will be loaded in one commit"
-            )
+    new_sources = load_operation.get_new_sources(skip_query=skip_query)
 
-        # Note : reinitialize to load new scripts:
-        load_operation = review_manager.get_load_operation(hide_load_explanation=True)
+    if combine_commits:
+        logging.info("Combine mode: all search sources will be loaded in one commit")
 
-        load_operation.main(
-            new_sources=new_sources, keep_ids=keep_ids, combine_commits=combine_commits
-        )
+    # Note : reinitialize to load new scripts:
+    load_operation = review_manager.get_load_operation(hide_load_explanation=True)
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    load_operation.main(
+        new_sources=new_sources, keep_ids=keep_ids, combine_commits=combine_commits
+    )
 
 
 @main.command(help_priority=6)
 @click.option(
     "-k",
     "--keep_ids",
     is_flag=True,
@@ -568,14 +563,15 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def prep(
     ctx: click.core.Context,
     keep_ids: bool,
     polish: bool,
     reset_records: str,
     reset_ids: bool,
     set_ids: bool,
@@ -628,18 +624,14 @@
         prep_operation.main(keep_ids=keep_ids, cpu=cpu, polish=polish)
 
     except colrev_exceptions.ServiceNotAvailableException as exc:
         print(exc)
         print("You can use the force mode to override")
         print(f"  {colors.ORANGE}colrev prep -f{colors.END}")
         return
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
 
 
 @main.command(help_priority=7)
 @click.option(
     "--stats",
     is_flag=True,
     default=False,
@@ -663,38 +655,33 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def prep_man(
     ctx: click.core.Context, stats: bool, languages: bool, verbose: bool, force: bool
 ) -> None:
     """Prepare records manually"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        prep_man_operation = review_manager.get_prep_man_operation()
-        if languages:
-            prep_man_operation.prep_man_langs()
-            return
-
-        if stats:
-            prep_man_operation.prep_man_stats()
-            return
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    prep_man_operation = review_manager.get_prep_man_operation()
+    if languages:
+        prep_man_operation.prep_man_langs()
+        return
 
-        prep_man_operation.main()
+    if stats:
+        prep_man_operation.prep_man_stats()
+        return
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    prep_man_operation.main()
 
 
 def __view_dedupe_details(dedupe_operation: colrev.ops.dedupe.Dedupe) -> None:
     info = dedupe_operation.get_info()
 
     if len(info["same_source_merges"]) > 0:
         print(f"\n\n{colors.RED}Same source merges to check:{colors.END}")
@@ -741,66 +728,81 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def dedupe(
     ctx: click.core.Context,
     merge: str,
     unmerge: str,
     fix_errors: bool,
     gid: bool,
     view: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Deduplicate records"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        state_transition_operation = not view
-        dedupe_operation = review_manager.get_dedupe_operation(
-            notify_state_transition_operation=state_transition_operation
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    state_transition_operation = not view
+    dedupe_operation = review_manager.get_dedupe_operation(
+        notify_state_transition_operation=state_transition_operation
+    )
+
+    if merge:
+        review_manager.settings.dedupe.same_source_merges = (
+            colrev.settings.SameSourceMergePolicy.warn
         )
+        dedupe_operation.merge_records(merge=merge)
+        return
 
-        if merge:
-            review_manager.settings.dedupe.same_source_merges = (
-                colrev.settings.SameSourceMergePolicy.warn
-            )
-            dedupe_operation.merge_records(merge=merge)
+    if unmerge:
+        dedupe_operation.unmerge_records(current_record_ids=unmerge.split(","))
+        return
+    if gid:
+        dedupe_operation.merge_based_on_global_ids(apply=True)
+        return
+    if fix_errors:
+        review_manager.report_logger.info("Dedupe: fix errors")
+        review_manager.logger.info("Dedupe: fix errors")
+        if not (
+            dedupe_operation.dupe_file.is_file()
+            or dedupe_operation.non_dupe_file_xlsx.is_file()
+            or dedupe_operation.non_dupe_file_txt.is_file()
+        ):
+            review_manager.logger.error("No file with potential errors found.")
             return
 
-        if unmerge:
-            dedupe_operation.unmerge_records(current_record_ids=unmerge.split(","))
-            return
-        if gid:
-            dedupe_operation.merge_based_on_global_ids(apply=True)
-            return
-        if fix_errors:
-            dedupe_operation.fix_errors()
-            print(
-                "You can manually remove the duplicates_to_validate.xlsx, "
-                "non_duplicates_to_validate.xlsx, and dupes.txt files."
-            )
-            return
+        false_positives = colrev.ui_cli.dedupe_errors.load_dedupe_false_positives(
+            dedupe_operation=dedupe_operation
+        )
+        false_negatives = colrev.ui_cli.dedupe_errors.load_dedupe_false_negatives(
+            dedupe_operation=dedupe_operation
+        )
 
-        if view:
-            __view_dedupe_details(dedupe_operation)
-            return
+        dedupe_operation.fix_errors(
+            false_positives=false_positives,
+            false_negatives=false_negatives,
+        )
+        print(
+            "You can manually remove the duplicates_to_validate.xlsx, "
+            "non_duplicates_to_validate.xlsx, and dupes.txt files."
+        )
+        return
 
-        dedupe_operation.main()
+    if view:
+        __view_dedupe_details(dedupe_operation)
+        return
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    dedupe_operation.main()
 
 
 @main.command(help_priority=9)
 @click.option(
     "--include_all",
     is_flag=True,
     default=False,
@@ -864,14 +866,15 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def prescreen(
     ctx: click.core.Context,
     include_all: bool,
     include_all_always: bool,
     export_format: str,
     import_table: str,
     create_split: int,
@@ -881,66 +884,58 @@
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Pre-screen exclusion based on metadata (titles and abstracts)"""
 
     # pylint: disable=too-many-locals
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        prescreen_operation = review_manager.get_prescreen_operation()
-
-        if export_format:
-            prescreen_operation.export_table(export_table_format=export_format)
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    prescreen_operation = review_manager.get_prescreen_operation()
 
-        elif import_table:
-            prescreen_operation.import_table(import_table_path=import_table)
+    if export_format:
+        prescreen_operation.export_table(export_table_format=export_format)
 
-        elif include_all or include_all_always:
-            prescreen_operation.include_all_in_prescreen(persist=include_all_always)
+    elif import_table:
+        prescreen_operation.import_table(import_table_path=import_table)
 
-        elif create_split:
-            splits = prescreen_operation.create_prescreen_split(
-                create_split=create_split
-            )
-            for created_split in splits:
-                print(created_split + "\n")
+    elif include_all or include_all_always:
+        prescreen_operation.include_all_in_prescreen(persist=include_all_always)
 
-        elif include:
-            prescreen_operation.include_records(ids=include)
+    elif create_split:
+        splits = prescreen_operation.create_prescreen_split(create_split=create_split)
+        for created_split in splits:
+            print(created_split + "\n")
 
-        elif exclude:
-            prescreen_operation.exclude_records(ids=include)
+    elif include:
+        prescreen_operation.include_records(ids=include)
 
-        elif setup_custom_script:
-            prescreen_operation.setup_custom_script()
-            print("Activated custom_prescreen_script.py.")
+    elif exclude:
+        prescreen_operation.exclude_records(ids=include)
 
-        else:
-            review_manager.logger.info("Prescreen")
-            review_manager.logger.info(
-                "Exclude irrelevant records based on metadata (i.e., titles and abstracts)."
-            )
-            review_manager.logger.info("Remaining records are retained provisionally")
-            review_manager.logger.info(
-                "In the screen, they can be included or excluded based on full-text documents."
-            )
-            review_manager.logger.info(
-                "See https://colrev.readthedocs.io/en/"
-                "latest/manual/metadata_prescreen/prescreen.html"
-            )
+    elif setup_custom_script:
+        prescreen_operation.setup_custom_script()
+        print("Activated custom_prescreen_script.py.")
 
-            prescreen_operation.main(split_str=split)
+    else:
+        review_manager.logger.info("Prescreen")
+        review_manager.logger.info(
+            "Exclude irrelevant records based on metadata (i.e., titles and abstracts)."
+        )
+        review_manager.logger.info("Remaining records are retained provisionally")
+        review_manager.logger.info(
+            "In the screen, they can be included or excluded based on full-text documents."
+        )
+        review_manager.logger.info(
+            "See https://colrev.readthedocs.io/en/"
+            "latest/manual/metadata_prescreen/prescreen.html"
+        )
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+        prescreen_operation.main(split_str=split)
 
 
 @main.command(help_priority=10)
 @click.option(
     "--include_all",
     is_flag=True,
     default=False,
@@ -995,59 +990,54 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def screen(
     ctx: click.core.Context,
     include_all: bool,
     include_all_always: bool,
     add_criterion: str,
     delete_criterion: str,
     create_split: int,
     split: str,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Screen based on PDFs and inclusion/exclusion criteria"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        screen_operation = review_manager.get_screen_operation()
-
-        if include_all or include_all_always:
-            screen_operation.include_all_in_screen(persist=include_all_always)
-            return
-        if add_criterion:
-            screen_operation.add_criterion(criterion_to_add=add_criterion)
-            return
-        if delete_criterion:
-            screen_operation.delete_criterion(criterion_to_delete=delete_criterion)
-            return
-        if create_split:
-            splits = screen_operation.create_screen_split(create_split=create_split)
-            for created_split in splits:
-                print(created_split + "\n")
-            return
-        if setup_custom_script:
-            screen_operation.setup_custom_script()
-            print("Activated custom_screen_script.py.")
-            return
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    screen_operation = review_manager.get_screen_operation()
 
-        screen_operation.main(split_str=split)
+    if include_all or include_all_always:
+        screen_operation.include_all_in_screen(persist=include_all_always)
+        return
+    if add_criterion:
+        screen_operation.add_criterion(criterion_to_add=add_criterion)
+        return
+    if delete_criterion:
+        screen_operation.delete_criterion(criterion_to_delete=delete_criterion)
+        return
+    if create_split:
+        splits = screen_operation.create_screen_split(create_split=create_split)
+        for created_split in splits:
+            print(created_split + "\n")
+        return
+    if setup_custom_script:
+        screen_operation.setup_custom_script()
+        print("Activated custom_screen_script.py.")
+        return
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    screen_operation.main(split_str=split)
 
 
 @main.command(help_priority=11)
 @click.option(
     "--discard",
     is_flag=True,
     default=False,
@@ -1071,69 +1061,64 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdfs(
     ctx: click.core.Context,
     discard: bool,
     dir: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Retrieve and prepare PDFs"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force,
-            verbose_mode=verbose,
-            high_level_operation=True,
-            exact_call=EXACT_CALL,
-        )
-
-        if dir:
-            # pylint: disable=import-outside-toplevel
-            # pylint: disable=consider-using-with
-            # pylint: disable=no-member
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force,
+        verbose_mode=verbose,
+        high_level_operation=True,
+        exact_call=EXACT_CALL,
+    )
 
-            path = review_manager.path / Path("data/pdfs")
-            webbrowser.open(str(path))
-            return
+    if dir:
+        # pylint: disable=import-outside-toplevel
+        # pylint: disable=consider-using-with
+        # pylint: disable=no-member
 
-        if discard:
-            pdf_prep_man_operation = review_manager.get_pdf_prep_man_operation()
-            pdf_prep_man_operation.discard()
+        path = review_manager.path / Path("data/pdfs")
+        webbrowser.open(str(path))
+        return
 
-            pdf_get_man_operation = review_manager.get_pdf_get_man_operation()
-            pdf_get_man_operation.discard()
+    if discard:
+        pdf_prep_man_operation = review_manager.get_pdf_prep_man_operation()
+        pdf_prep_man_operation.discard()
 
-            return
+        pdf_get_man_operation = review_manager.get_pdf_get_man_operation()
+        pdf_get_man_operation.discard()
 
-        review_manager.logger.info("PDFs")
-        review_manager.logger.info(
-            "PDFs is a high-level operation consisting of pdf-get and pdf-prep:"
-        )
-        print()
+        return
 
-        pdf_get_operation = review_manager.get_pdf_get_operation(
-            notify_state_transition_operation=True
-        )
-        pdf_get_operation.main()
+    review_manager.logger.info("PDFs")
+    review_manager.logger.info(
+        "PDFs is a high-level operation consisting of pdf-get and pdf-prep:"
+    )
+    print()
 
-        print()
+    pdf_get_operation = review_manager.get_pdf_get_operation(
+        notify_state_transition_operation=True
+    )
+    pdf_get_operation.main()
 
-        pdf_prep_operation = review_manager.get_pdf_prep_operation()
-        pdf_prep_operation.main(batch_size=0)
+    print()
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    pdf_prep_operation = review_manager.get_pdf_prep_operation()
+    pdf_prep_operation.main(batch_size=0)
 
 
 @main.command(help_priority=12)
 @click.option(
     "-c",
     "--copy-to-repo",
     is_flag=True,
@@ -1171,55 +1156,50 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_get(
     ctx: click.core.Context,
     copy_to_repo: bool,
     rename: bool,
     relink_files: bool,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Get PDFs"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-
-        state_transition_operation = not relink_files and not setup_custom_script
-        pdf_get_operation = review_manager.get_pdf_get_operation(
-            notify_state_transition_operation=state_transition_operation
-        )
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
 
-        if relink_files:
-            pdf_get_operation.relink_files()
-            return
-        if copy_to_repo:
-            pdf_get_operation.copy_pdfs_to_repo()
-            return
-        if rename:
-            pdf_get_operation.rename_pdfs()
-            return
-        if setup_custom_script:
-            pdf_get_operation.setup_custom_script()
-            print("Activated custom_pdf_get_script.py.")
-            return
+    state_transition_operation = not relink_files and not setup_custom_script
+    pdf_get_operation = review_manager.get_pdf_get_operation(
+        notify_state_transition_operation=state_transition_operation
+    )
 
-        pdf_get_operation.main()
+    if relink_files:
+        pdf_get_operation.relink_files()
+        return
+    if copy_to_repo:
+        pdf_get_operation.copy_pdfs_to_repo()
+        return
+    if rename:
+        pdf_get_operation.rename_pdfs()
+        return
+    if setup_custom_script:
+        pdf_get_operation.setup_custom_script()
+        print("Activated custom_pdf_get_script.py.")
+        return
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    pdf_get_operation.main()
 
 
 @main.command(help_priority=13)
 @click.option(
     "-e",
     "--export",
     is_flag=True,
@@ -1243,72 +1223,67 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_get_man(
     ctx: click.core.Context,
     export: bool,
     discard: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Get PDFs manually"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        pdf_get_man_operation = review_manager.get_pdf_get_man_operation()
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    pdf_get_man_operation = review_manager.get_pdf_get_man_operation()
 
-        if export:
-            records = pdf_get_man_operation.review_manager.dataset.load_records_dict()
-            pdf_get_man_records = [
-                r
-                for r in records.values()
-                if r["colrev_status"]
-                in [
-                    colrev.record.RecordState.pdf_needs_manual_retrieval,
-                    colrev.record.RecordState.rev_prescreen_included,
-                ]
+    if export:
+        records = pdf_get_man_operation.review_manager.dataset.load_records_dict()
+        pdf_get_man_records = [
+            r
+            for r in records.values()
+            if r["colrev_status"]
+            in [
+                colrev.record.RecordState.pdf_needs_manual_retrieval,
+                colrev.record.RecordState.rev_prescreen_included,
             ]
-            pdf_get_man_records_df = pd.DataFrame.from_records(pdf_get_man_records)
-            pdf_get_man_records_df = pdf_get_man_records_df[
-                pdf_get_man_records_df.columns.intersection(
-                    [
-                        "ID",
-                        "author",
-                        "year",
-                        "title",
-                        "journal",
-                        "booktitle",
-                        "volume",
-                        "number",
-                        "url",
-                        "doi",
-                    ]
-                )
-            ]
-            pdf_get_man_records_df.to_csv("pdf_get_man_records.csv", index=False)
-            pdf_get_man_operation.review_manager.logger.info(
-                "Created pdf_get_man_records.csv"
+        ]
+        pdf_get_man_records_df = pd.DataFrame.from_records(pdf_get_man_records)
+        pdf_get_man_records_df = pdf_get_man_records_df[
+            pdf_get_man_records_df.columns.intersection(
+                [
+                    "ID",
+                    "author",
+                    "year",
+                    "title",
+                    "journal",
+                    "booktitle",
+                    "volume",
+                    "number",
+                    "url",
+                    "doi",
+                ]
             )
-            return
-        if discard:
-            pdf_get_man_operation.discard()
-            return
-
-        pdf_get_man_operation.main()
+        ]
+        pdf_get_man_records_df.to_csv("pdf_get_man_records.csv", index=False)
+        pdf_get_man_operation.review_manager.logger.info(
+            "Created pdf_get_man_records.csv"
+        )
+        return
+    if discard:
+        pdf_get_man_operation.discard()
+        return
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    pdf_get_man_operation.main()
 
 
 def __extract_coverpage(*, cover: Path) -> None:
     cp_path = Path.home().joinpath("colrev") / Path(".coverpages")
     cp_path.mkdir(exist_ok=True)
 
     assert Path(cover).suffix == ".pdf"
@@ -1412,14 +1387,15 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_prep(
     ctx: click.core.Context,
     batch_size: int,
     update_colrev_pdf_ids: bool,
     reprocess: bool,
     pdf_hash: Path,
     setup_custom_script: bool,
@@ -1450,18 +1426,14 @@
             pdf_prep_operation.setup_custom_script()
             print("Activated custom_pdf_prep_script.py.")
         elif tei:
             pdf_prep_operation.generate_tei()
         else:
             pdf_prep_operation.main(batch_size=batch_size)
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
     except KeyboardInterrupt:
         print("Stopped the process")
 
 
 def __delete_first_pages_cli(
     pdf_prep_man_operation: colrev.ops.pdf_prep_man.PDFPrepMan, record_id: str
 ) -> None:
@@ -1527,54 +1499,49 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_prep_man(
     ctx: click.core.Context,
     delete_first_page: str,
     stats: bool,
     discard: bool,
     extract: bool,
     apply: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Prepare PDFs manually"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        pdf_prep_man_operation = review_manager.get_pdf_prep_man_operation()
-
-        if delete_first_page:
-            __delete_first_pages_cli(pdf_prep_man_operation, delete_first_page)
-            return
-        if discard:
-            pdf_prep_man_operation.discard()
-            return
-        if stats:
-            pdf_prep_man_operation.pdf_prep_man_stats()
-            return
-        if extract:
-            pdf_prep_man_operation.extract_needs_pdf_prep_man()
-            return
-        if apply:
-            pdf_prep_man_operation.apply_pdf_prep_man()
-            return
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    pdf_prep_man_operation = review_manager.get_pdf_prep_man_operation()
 
-        pdf_prep_man_operation.main()
+    if delete_first_page:
+        __delete_first_pages_cli(pdf_prep_man_operation, delete_first_page)
+        return
+    if discard:
+        pdf_prep_man_operation.discard()
+        return
+    if stats:
+        pdf_prep_man_operation.pdf_prep_man_stats()
+        return
+    if extract:
+        pdf_prep_man_operation.extract_needs_pdf_prep_man()
+        return
+    if apply:
+        pdf_prep_man_operation.apply_pdf_prep_man()
+        return
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    pdf_prep_man_operation.main()
 
 
 @main.command(help_priority=16)
 @click.option(
     "--profile",
     is_flag=True,
     default=False,
@@ -1610,84 +1577,77 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def data(
     ctx: click.core.Context,
     profile: bool,
     reading_heuristics: bool,
     add: str,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Complete selected forms of data analysis and synthesis"""
 
     # pylint: disable=import-outside-toplevel
     import colrev.ui_cli.add_packages
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=(force or profile), verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        data_operation = review_manager.get_data_operation()
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=(force or profile), verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    data_operation = review_manager.get_data_operation()
 
-        if profile:
-            data_operation.profile()
-            return
-        if reading_heuristics:
-            heuristic_results = data_operation.reading_heuristics()
-            review_manager.p_printer.pprint(heuristic_results)
-            return
-        if setup_custom_script:
-            data_operation.setup_custom_script()
-            print("Activated custom_data_script.py.")
-            print("Please update the data_format in settings.json and commit.")
-            return
+    if profile:
+        data_operation.profile()
+        return
+    if reading_heuristics:
+        heuristic_results = data_operation.reading_heuristics()
+        review_manager.p_printer.pprint(heuristic_results)
+        return
+    if setup_custom_script:
+        data_operation.setup_custom_script()
+        print("Activated custom_data_script.py.")
+        print("Please update the data_format in settings.json and commit.")
+        return
 
-        if add:
-            colrev.ui_cli.add_packages.add_data(
-                data_operation=data_operation,
-                add=add,
-            )
-            return
+    if add:
+        colrev.ui_cli.add_packages.add_data(
+            data_operation=data_operation,
+            add=add,
+        )
+        return
 
-        ret = data_operation.main()
-        if data_operation.review_manager.in_ci_environment():
-            if ret["ask_to_commit"]:
+    ret = data_operation.main()
+    if data_operation.review_manager.in_ci_environment():
+        if ret["ask_to_commit"]:
+            review_manager.create_commit(msg="Data and synthesis", manual_author=True)
+    else:
+        if ret["ask_to_commit"]:
+            if input("Create commit (y/n)?") == "y":
                 review_manager.create_commit(
                     msg="Data and synthesis", manual_author=True
                 )
-        else:
-            if ret["ask_to_commit"]:
-                if input("Create commit (y/n)?") == "y":
-                    review_manager.create_commit(
-                        msg="Data and synthesis", manual_author=True
-                    )
-            if ret["no_endpoints_registered"]:
-                print(
-                    "No data format not specified. "
-                    "To register a data endpoint, "
-                    "use one (or several) of the following \n"
-                    "    colrev data --add colrev.paper_md\n"
-                    "    colrev data --add colrev.structured\n"
-                    "    colrev data --add colrev.bibliography_export\n"
-                    "    colrev data --add colrev.prisma\n"
-                    "    colrev data --add colrev.github_pages\n"
-                    "    colrev data --add colrev.zettlr\n"
-                    "    colrev data --add colrev.colrev_curation"
-                )
-
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+        if ret["no_endpoints_registered"]:
+            print(
+                "No data format not specified. "
+                "To register a data endpoint, "
+                "use one (or several) of the following \n"
+                "    colrev data --add colrev.paper_md\n"
+                "    colrev data --add colrev.structured\n"
+                "    colrev data --add colrev.bibliography_export\n"
+                "    colrev data --add colrev.prisma\n"
+                "    colrev data --add colrev.github_pages\n"
+                "    colrev data --add colrev.zettlr\n"
+                "    colrev data --add colrev.colrev_curation"
+            )
 
 
 @main.command(help_priority=17)
 @click.argument("scope", nargs=1)
 @click.option(
     "--filter",
     type=click.Choice(["prepare", "dedupe", "merge", "all"], case_sensitive=False),
@@ -1717,14 +1677,15 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def validate(
     ctx: click.core.Context,
     scope: str,
     filter: str,
     threshold: float,
     properties: bool,
     verbose: bool,
@@ -1737,39 +1698,33 @@
     - a commit-sha,
     - a commit tree,
     - '.' for the latest commit,
     - HEAD~4 for commit 4 before HEAD
     - a contributor name
     """
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        validate_operation = review_manager.get_validate_operation()
-
-        validation_details = validate_operation.main(
-            scope=scope,
-            filter_setting=filter,
-            properties=properties,
-        )
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    validate_operation = review_manager.get_validate_operation()
 
-        if validation_details:
-            colrev.ui_cli.cli_validation.validate(
-                validate_operation=validate_operation,
-                validation_details=validation_details,
-                threshold=threshold,
-            )
+    validation_details = validate_operation.main(
+        scope=scope,
+        filter_setting=filter,
+        properties=properties,
+    )
 
-        review_manager.logger.info("%sCompleted validation%s", colors.GREEN, colors.END)
+    if validation_details:
+        colrev.ui_cli.cli_validation.validate(
+            validate_operation=validate_operation,
+            validation_details=validation_details,
+            threshold=threshold,
+        )
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    review_manager.logger.info("%sCompleted validation%s", colors.GREEN, colors.END)
 
 
 @main.command(help_priority=18)
 @click.option(
     "--id",  # pylint: disable=invalid-name
     help="Record ID to trace (citation_key).",
     required=True,
@@ -1785,32 +1740,28 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def trace(
     ctx: click.core.Context,
     id: str,  # pylint: disable=invalid-name
     verbose: bool,
     force: bool,
 ) -> None:
     """Trace a record"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        trace_operation = review_manager.get_trace_operation()
-        trace_operation.main(record_id=id)
-
-    except colrev_exceptions.InvalidSettingsError as exc:
-        print(exc)
-        return
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    trace_operation = review_manager.get_trace_operation()
+    trace_operation.main(record_id=id)
 
 
 def __select_target_repository(environment_registry: list) -> Path:
     while True:
         for i, local_source in enumerate(environment_registry):
             print(
                 f"{i+1} - {local_source['repo_name']} ({local_source['repo_source_path']})"
@@ -1840,35 +1791,30 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def distribute(ctx: click.core.Context, path: Path, verbose: bool, force: bool) -> None:
     """Distribute records to other local repositories"""
 
-    try:
-        if not path:
-            path = Path.cwd()
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=True, verbose_mode=verbose
-        )
-        distribute_operation = review_manager.get_distribute_operation()
-        environment_registry = distribute_operation.get_environment_registry()
+    if not path:
+        path = Path.cwd()
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=True, verbose_mode=verbose
+    )
+    distribute_operation = review_manager.get_distribute_operation()
+    environment_registry = distribute_operation.get_environment_registry()
 
-        target = __select_target_repository(environment_registry=environment_registry)
-        # Note : add a "distribution mode" option?
-        # (whole file -> add as source/load vs. records individually like a prescreen)
-        distribute_operation.main(path=path, target=target)
-
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    target = __select_target_repository(environment_registry=environment_registry)
+    # Note : add a "distribution mode" option?
+    # (whole file -> add as source/load vs. records individually like a prescreen)
+    distribute_operation.main(path=path, target=target)
 
 
 def __print_environment_status(
     review_manager: colrev.review_manager.ReviewManager,
 ) -> None:
     environment_manager = review_manager.get_environment_manager()
     environment_details = environment_manager.get_environment_details()
@@ -2106,18 +2052,24 @@
 @click.option(
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
+@click.option(
+    "-g",
+    "--update-global",
+    help="Global settings to update",
+)
 @click.pass_context
 def settings(
     ctx: click.core.Context,
     update_hooks: bool,
+    update_global: str,
     modify: str,
     verbose: bool,
     force: bool,
 ) -> None:
     """Settings of the CoLRev project"""
 
     # pylint: disable=import-outside-toplevel
@@ -2154,14 +2106,21 @@
             check_call(script_to_call, stdout=DEVNULL, stderr=STDOUT)  # nosec
 
         review_manager.dataset.add_changes(path=Path(".pre-commit-config.yaml"))
         review_manager.create_commit(msg="Update pre-commit hooks")
         print("Successfully updated pre-commit hooks")
         return
 
+    if update_global:
+        from colrev.env.environment_manager import EnvironmentManager
+
+        env_man = EnvironmentManager()
+        path, value_string = update_global.split("=")
+        print(f"Updating registry settings:\n{path} = {value_string}")
+        env_man.update_registry(path, value_string)
     if modify:
         # TBD: maybe use glom.delete?
         # There is no simply append...
         # (we could replace the (last) position element with
         # keywords like prescreen.sripts.LAST_POSITION)
         # maybe prescreen.scripts.1.REPLACE/ADD/DELETE = ....
         # modify = 'dedupe.dedupe_package_endpoints='
@@ -2177,15 +2136,14 @@
         glom.assign(project_settings, path, value)
 
         with open("settings.json", "w", encoding="utf-8") as outfile:
             json.dump(project_settings, outfile, indent=4)
 
         review_manager.dataset.add_changes(path=Path("settings.json"))
         review_manager.create_commit(msg="Change settings", manual_author=True)
-        return
 
     # import colrev_ui.ui_web.settings_editor
 
     # review_manager = colrev.review_manager.ReviewManager(
     #     force_mode=True, verbose_mode=verbose
     # )
     # settings_operation = colrev.ui_web.settings_editor.SettingsEditor(
@@ -2299,33 +2257,28 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pull(
     ctx: click.core.Context,
     verbose: bool,
     force: bool,
 ) -> None:
     """Pull CoLRev project remote and record updates"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        pull_operation = review_manager.get_pull_operation()
-
-        pull_operation.main()
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    pull_operation = review_manager.get_pull_operation()
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    pull_operation.main()
 
 
 @main.command(help_priority=24)
 @click.argument("git_url")
 @click.option(
     "-v",
     "--verbose",
@@ -2388,38 +2341,33 @@
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
+@catch_exception(handle=(colrev_exceptions.CoLRevException))
 def push(
     ctx: click.core.Context,
     records_only: bool,
     project_only: bool,
     all: bool,
     verbose: bool,
     force: bool,
 ) -> None:
     """Push CoLRev project remote and record updates"""
 
-    try:
-        review_manager = colrev.review_manager.ReviewManager(
-            force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
-        )
-        push_operation = review_manager.get_push_operation()
-
-        push_operation.main(
-            records_only=records_only, project_only=project_only, all_records=all
-        )
+    review_manager = colrev.review_manager.ReviewManager(
+        force_mode=force, verbose_mode=verbose, exact_call=EXACT_CALL
+    )
+    push_operation = review_manager.get_push_operation()
 
-    except colrev_exceptions.CoLRevException as exc:
-        if verbose:
-            raise exc
-        print(exc)
+    push_operation.main(
+        records_only=records_only, project_only=project_only, all_records=all
+    )
 
 
 @main.command(hidden=True, help_priority=26)
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
```

### Comparing `colrev-0.8.4/colrev/ui_cli/cli_status_printer.py` & `colrev-0.9.0/colrev/ui_cli/cli_status_printer.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,27 +1,24 @@
 #!/usr/bin/env python3
 """Scripts to print the CoLRev status (cli)."""
 from __future__ import annotations
 
 import sys
 import typing
 from time import sleep
+from typing import TYPE_CHECKING
 
 from tqdm import tqdm
 
 import colrev.exceptions as colrev_exceptions
 import colrev.ui_cli.cli_colors as colors
 from colrev.exit_codes import ExitCodes
 
-
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.status
+if TYPE_CHECKING:
+    import colrev.ops.status
 
 
 def print_review_instructions(review_instructions: dict) -> None:
     """Print the review instructions on cli"""
 
     print("Next operation")
 
@@ -262,11 +259,7 @@
 
     if status_operation.review_manager.verbose_mode:
         print(
             "Documentation: https://colrev.readthedocs.io/en/latest/manual/manual.html"
         )
     else:
         print(f"For more details: {colors.ORANGE}colrev status -v{colors.END}")
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ui_cli/cli_validation.py` & `colrev-0.9.0/colrev/ui_cli/cli_validation.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 #!/usr/bin/env python3
 """Scripts to print the CoLRev status (cli)."""
 from __future__ import annotations
 
 import os
 import subprocess  # nosec
+from typing import TYPE_CHECKING
 
 import colrev.record
 import colrev.ui_cli.cli_colors as colors
 
-if False:  # pylint: disable=using-constant-test
-    from typing import TYPE_CHECKING
-
-    if TYPE_CHECKING:
-        import colrev.ops.status
+if TYPE_CHECKING:
+    import colrev.ops.status
 
 # pylint: disable=duplicate-code
 keys = [
     "author",
     "title",
     "journal",
     "booktitle",
@@ -212,11 +210,7 @@
 
         else:
             print("Not yet implemented")
             print(validation_details)
 
     if validate_operation.review_manager.dataset.records_changed():
         validate_operation.review_manager.create_commit(msg="validate")
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/colrev/ui_cli/show_printer.py` & `colrev-0.9.0/colrev/ui_cli/show_printer.py`

 * *Files 1% similar despite different names*

```diff
@@ -66,11 +66,7 @@
         print("To deactivate virtualenv, run")
         print(f"  {colors.ORANGE}deactivate{colors.END}")
     else:
         print(
             "Platform not detected... "
             "cannot provide infos in how to activate virtualenv"
         )
-
-
-if __name__ == "__main__":
-    pass
```

### Comparing `colrev-0.8.4/pyproject.toml` & `colrev-0.9.0/pyproject.toml`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [tool.poetry]
 name = "colrev"
-version = "0.8.4"
+version = "0.9.0"
 description = "CoLRev: An open-source environment for collaborative reviews"
 authors = ["Gerit Wagner <gerit.wagner@hec.ca>", "Julian Prester <julian.prester@sydney.edu.au>"]
 license = "MIT"
 readme = "README.md"
 homepage="https://colrev.readthedocs.io/en/latest/"
 repository = "https://github.com/CoLRev-Environment/colrev"
 documentation = "https://colrev.readthedocs.io/en/latest/"
@@ -35,15 +35,14 @@
 [tool.poetry.dependencies]
 python = ">=3.8, <4"
 alphabet-detector = "^0.0.7"
 beautifulsoup4 = "^4.11.1"
 click8 = "^8.0.1"
 click_completion = "^0.5.2"
 crossrefapi = "^1.5.0"
-cx-Freeze = "^6.11.1"
 dacite = "^1.6.0"
 daff = "^1.3.46"
 dedupe = "^2.0.20"
 dictdiffer = "^0.9.0"
 docker = "6.0.0"
 GitPython= "^3.1.29"
 lingua-language-detector = ">1.3"
@@ -51,35 +50,35 @@
 nameparser = "^1.1.2"
 pandas = "^1.5.0"
 pandasql = "^0.7.3"
 "pdfminer.six" = "^20220524"
 psutil = "^5.9.2"
 pybtex = "^0.24.0"
 PyPDF2 = "^1.28.6"
-"python-Levenshtein" = "^0.12.2"
 PyYAML = "^6.0.0"
 requests = "^2.28.1"
 requests-cache = "^0.9.6"
 thefuzz = "^0.19.0"
 tqdm = "^4.64.1"
 transitions = "^0.8.11"
 "zope.interface" = "^5.5.0"
 pycountry = "^22.3.5"
 glom = "^22.1.0"
 pre-commit = "^2.20.0"
 Jinja2 = "^3.1.2"
 dataclasses-jsonschema = "^2.15.3"
-Flask-Cors = "^3.0.10"
 watchdog = "^2.2.1"
 openpyxl = "^3.1.2"
 pylint = "^2.17.2"
 pymupdf = "^1.22.0"
 imagehash = "^4.3.1"
 defusedxml = "^0.7.1"
 asreview = "^1.2"
+requests-mock = "^1.10.0"
+levenshtein = "^0.21.0" # faster implementation of levenshtein distance (for thefuzz)
 
 [tool.poetry.group.docs.dependencies]
 Sphinx = "^5.2.3"
 sphinx-autodoc-typehints = "^1.19.4"
 sphinx-click = "^4.3.0"
 sphinx-rtd-theme = "^1.1.1"
 "sphinxcontrib.datatemplates" = "^0.9.2"
```

### Comparing `colrev-0.8.4/PKG-INFO` & `colrev-0.9.0/PKG-INFO`

 * *Files 6% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: colrev
-Version: 0.8.4
+Version: 0.9.0
 Summary: CoLRev: An open-source environment for collaborative reviews
 Home-page: https://colrev.readthedocs.io/en/latest/
 License: MIT
 Keywords: research,reproducible research,open science,literature,literature review,systematic review,systematic literature review
 Author: Gerit Wagner
 Author-email: gerit.wagner@hec.ca
 Requires-Python: >=3.8,<4
@@ -13,58 +13,52 @@
 Classifier: Natural Language :: English
 Classifier: Operating System :: OS Independent
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.8
 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
-Classifier: Programming Language :: Python :: 3
-Classifier: Programming Language :: Python :: 3.10
-Classifier: Programming Language :: Python :: 3.11
-Classifier: Programming Language :: Python :: 3.8
-Classifier: Programming Language :: Python :: 3.9
 Classifier: Topic :: Scientific/Engineering
 Classifier: Typing :: Typed
-Requires-Dist: Flask-Cors (>=3.0.10,<4.0.0)
 Requires-Dist: GitPython (>=3.1.29,<4.0.0)
 Requires-Dist: Jinja2 (>=3.1.2,<4.0.0)
 Requires-Dist: PyPDF2 (>=1.28.6,<2.0.0)
 Requires-Dist: PyYAML (>=6.0.0,<7.0.0)
 Requires-Dist: alphabet-detector (>=0.0.7,<0.0.8)
 Requires-Dist: asreview (>=1.2,<2.0)
 Requires-Dist: beautifulsoup4 (>=4.11.1,<5.0.0)
 Requires-Dist: click8 (>=8.0.1,<9.0.0)
 Requires-Dist: click_completion (>=0.5.2,<0.6.0)
 Requires-Dist: crossrefapi (>=1.5.0,<2.0.0)
-Requires-Dist: cx-Freeze (>=6.11.1,<7.0.0)
 Requires-Dist: dacite (>=1.6.0,<2.0.0)
 Requires-Dist: daff (>=1.3.46,<2.0.0)
 Requires-Dist: dataclasses-jsonschema (>=2.15.3,<3.0.0)
 Requires-Dist: dedupe (>=2.0.20,<3.0.0)
 Requires-Dist: defusedxml (>=0.7.1,<0.8.0)
 Requires-Dist: dictdiffer (>=0.9.0,<0.10.0)
 Requires-Dist: docker (==6.0.0)
 Requires-Dist: glom (>=22.1.0,<23.0.0)
 Requires-Dist: imagehash (>=4.3.1,<5.0.0)
+Requires-Dist: levenshtein (>=0.21.0,<0.22.0)
 Requires-Dist: lingua-language-detector (>1.3)
 Requires-Dist: lxml (>=4.9.1,<5.0.0)
 Requires-Dist: nameparser (>=1.1.2,<2.0.0)
 Requires-Dist: openpyxl (>=3.1.2,<4.0.0)
 Requires-Dist: pandas (>=1.5.0,<2.0.0)
 Requires-Dist: pandasql (>=0.7.3,<0.8.0)
 Requires-Dist: pdfminer.six (>=20220524,<20220525)
 Requires-Dist: pre-commit (>=2.20.0,<3.0.0)
 Requires-Dist: psutil (>=5.9.2,<6.0.0)
 Requires-Dist: pybtex (>=0.24.0,<0.25.0)
 Requires-Dist: pycountry (>=22.3.5,<23.0.0)
 Requires-Dist: pylint (>=2.17.2,<3.0.0)
 Requires-Dist: pymupdf (>=1.22.0,<2.0.0)
-Requires-Dist: python-Levenshtein (>=0.12.2,<0.13.0)
 Requires-Dist: requests (>=2.28.1,<3.0.0)
 Requires-Dist: requests-cache (>=0.9.6,<0.10.0)
+Requires-Dist: requests-mock (>=1.10.0,<2.0.0)
 Requires-Dist: thefuzz (>=0.19.0,<0.20.0)
 Requires-Dist: tqdm (>=4.64.1,<5.0.0)
 Requires-Dist: transitions (>=0.8.11,<0.9.0)
 Requires-Dist: watchdog (>=2.2.1,<3.0.0)
 Requires-Dist: zope.interface (>=5.5.0,<6.0.0)
 Project-URL: Documentation, https://colrev.readthedocs.io/en/latest/
 Project-URL: Repository, https://github.com/CoLRev-Environment/colrev
@@ -88,15 +82,17 @@
 [![pre-commit.ci status](https://results.pre-commit.ci/badge/github/CoLRev-Ecosystem/colrev/main.svg)](https://results.pre-commit.ci/latest/github/CoLRev-Ecosystem/colrev/main)
 ![Coverage](https://raw.githubusercontent.com/CoLRev-Ecosystem/colrev/main/tests/coverage.svg)
 [![Codacy Badge](https://app.codacy.com/project/badge/Grade/bd4e44c6cda646e4b9e494c4c4d9487b)](https://app.codacy.com/gh/CoLRev-Environment/colrev/dashboard?utm_source=gh&utm_medium=referral&utm_content=&utm_campaign=Badge_grade)
 ![GitHub last commit](https://img.shields.io/github/last-commit/CoLRev-Ecosystem/colrev)
 [![Downloads](https://static.pepy.tech/badge/colrev/month)](https://pepy.tech/project/colrev)
 [![OpenSSF Best Practices](https://bestpractices.coreinfrastructure.org/projects/7148/badge)](https://bestpractices.coreinfrastructure.org/projects/7148)
 [![SWH](https://archive.softwareheritage.org/badge/origin/https://github.com/CoLRev-Environment/colrev/)](https://archive.softwareheritage.org/browse/origin/?origin_url=https://github.com/CoLRev-Environment/colrev/)<!-- ALL-CONTRIBUTORS-BADGE:START - Do not remove or modify this section -->
-[![All Contributors](https://img.shields.io/badge/all_contributors-3-orange.svg?style=flat-square)](#contributors-)
+[![All Contributors](https://img.shields.io/badge/all_contributors-4-orange.svg?style=flat-square)](#contributors-)
+[![Average time to resolve an issue](http://isitmaintained.com/badge/resolution/CoLRev-Environment/colrev.svg)](https://isitmaintained.com/project/CoLRev-Environment/colrev)
+[![Percentage of issues still open](http://isitmaintained.com/badge/open/CoLRev-Environment/colrev.svg)](https://isitmaintained.com/project/CoLRev-Environment/colrev)
 <!-- ALL-CONTRIBUTORS-BADGE:END -->
 <!-- ![PyPI](https://img.shields.io/pypi/v/colrev) -->
 <!-- [![](https://img.shields.io/badge/-documentation-green)](https://colrev.readthedocs.io/) -->
 
 </div>
 
 ## Summary
@@ -131,14 +127,15 @@
 <!-- markdownlint-disable -->
 <table>
   <tbody>
     <tr>
       <td align="center" valign="top" width="14.28%"><a href="https://github.com/geritwagner"><img src="https://avatars.githubusercontent.com/u/3872815?v=4?s=100" width="100px;" alt="Gerit Wagner"/><br /><sub><b>Gerit Wagner</b></sub></a><br /><a href="https://github.com/CoLRev-Environment/colrev/commits?author=geritwagner" title="Code"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=geritwagner" title="Documentation"></a> <a href="#data-geritwagner" title="Data"></a> <a href="#content-geritwagner" title="Content"></a> <a href="#example-geritwagner" title="Examples"></a></td>
       <td align="center" valign="top" width="14.28%"><a href="https://julianprester.com"><img src="https://avatars.githubusercontent.com/u/4706870?v=4?s=100" width="100px;" alt="Julian Prester"/><br /><sub><b>Julian Prester</b></sub></a><br /><a href="https://github.com/CoLRev-Environment/colrev/commits?author=julianprester" title="Code"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=julianprester" title="Documentation"></a> <a href="#data-julianprester" title="Data"></a> <a href="#content-julianprester" title="Content"></a> <a href="https://github.com/CoLRev-Environment/colrev/issues?q=author%3Ajulianprester" title="Bug reports"></a> <a href="#ideas-julianprester" title="Ideas, Planning, & Feedback"></a></td>
       <td align="center" valign="top" width="14.28%"><a href="https://github.com/tmahmood"><img src="https://avatars.githubusercontent.com/u/34904?v=4?s=100" width="100px;" alt="Tarin Mahmood"/><br /><sub><b>Tarin Mahmood</b></sub></a><br /><a href="https://github.com/CoLRev-Environment/colrev/commits?author=tmahmood" title="Code"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=tmahmood" title="Tests"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=tmahmood" title="Documentation"></a></td>
+      <td align="center" valign="top" width="14.28%"><a href="https://github.com/dengdenglele"><img src="https://avatars.githubusercontent.com/u/28404427?v=4?s=100" width="100px;" alt="dengdenglele"/><br /><sub><b>dengdenglele</b></sub></a><br /><a href="#data-dengdenglele" title="Data"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=dengdenglele" title="Documentation"></a> <a href="https://github.com/CoLRev-Environment/colrev/commits?author=dengdenglele" title="Tests"></a></td>
     </tr>
   </tbody>
 </table>
 
 <!-- markdownlint-restore -->
 <!-- prettier-ignore-end -->
```

