# Comparing `tmp/pyBIA-1.3.2.tar.gz` & `tmp/pyBIA-1.3.3.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "pyBIA-1.3.2.tar", last modified: Tue Mar  7 08:01:11 2023, max compression
+gzip compressed data, was "pyBIA-1.3.3.tar", last modified: Tue May 30 23:04:22 2023, max compression
```

## Comparing `pyBIA-1.3.2.tar` & `pyBIA-1.3.3.tar`

### file list

```diff
@@ -1,28 +1,28 @@
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-07 08:01:11.037512 pyBIA-1.3.2/
--rw-r--r--   0 daniel     (501) staff       (20)    35149 2022-09-02 05:09:52.000000 pyBIA-1.3.2/LICENSE
--rw-r--r--   0 daniel     (501) staff       (20)       21 2022-09-02 05:09:52.000000 pyBIA-1.3.2/MANIFEST.in
--rw-r--r--   0 daniel     (501) staff       (20)      574 2023-03-07 08:01:11.037116 pyBIA-1.3.2/PKG-INFO
--rw-r--r--   0 daniel     (501) staff       (20)      875 2022-09-02 05:09:52.000000 pyBIA-1.3.2/README.md
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-07 08:01:11.030900 pyBIA-1.3.2/pyBIA/
--rw-r--r--   0 daniel     (501) staff       (20)       27 2022-09-02 05:09:52.000000 pyBIA-1.3.2/pyBIA/__init__.py
--rw-r--r--   0 daniel     (501) staff       (20)    63905 2023-03-06 22:24:32.000000 pyBIA-1.3.2/pyBIA/catalog.py
--rw-r--r--   0 daniel     (501) staff       (20)    66467 2023-03-07 07:58:53.000000 pyBIA-1.3.2/pyBIA/cnn_model.py
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-07 08:01:11.036414 pyBIA-1.3.2/pyBIA/data/
--rw-r--r--   0 daniel     (501) staff       (20)        0 2022-09-02 05:09:52.000000 pyBIA-1.3.2/pyBIA/data/__init.py__
--rw-r--r--   0 daniel     (501) staff       (20)      115 2022-09-02 05:09:52.000000 pyBIA-1.3.2/pyBIA/data/obj_name_5
--rw-r--r--   0 daniel     (501) staff       (20)    17965 2022-09-02 05:09:52.000000 pyBIA-1.3.2/pyBIA/data/obj_name_779
--rw-r--r--   0 daniel     (501) staff       (20)     1840 2022-09-02 05:09:52.000000 pyBIA-1.3.2/pyBIA/data/obj_name_80
--rw-r--r--   0 daniel     (501) staff       (20)    13233 2023-03-06 22:30:16.000000 pyBIA-1.3.2/pyBIA/data_augmentation.py
--rw-r--r--   0 daniel     (501) staff       (20)    13205 2023-02-23 21:17:20.000000 pyBIA-1.3.2/pyBIA/data_processing.py
--rw-r--r--   0 daniel     (501) staff       (20)    54270 2023-03-07 06:16:07.000000 pyBIA-1.3.2/pyBIA/ensemble_model.py
--rw-r--r--   0 daniel     (501) staff       (20)    13062 2023-01-28 21:52:31.000000 pyBIA-1.3.2/pyBIA/image_moments.py
--rw-r--r--   0 daniel     (501) staff       (20)    99029 2023-03-07 06:55:01.000000 pyBIA-1.3.2/pyBIA/optimization.py
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-07 08:01:11.033451 pyBIA-1.3.2/pyBIA.egg-info/
--rw-r--r--   0 daniel     (501) staff       (20)      574 2023-03-07 08:01:10.000000 pyBIA-1.3.2/pyBIA.egg-info/PKG-INFO
--rw-r--r--   0 daniel     (501) staff       (20)      464 2023-03-07 08:01:11.000000 pyBIA-1.3.2/pyBIA.egg-info/SOURCES.txt
--rw-r--r--   0 daniel     (501) staff       (20)        1 2023-03-07 08:01:10.000000 pyBIA-1.3.2/pyBIA.egg-info/dependency_links.txt
--rw-r--r--   0 daniel     (501) staff       (20)      178 2023-03-07 08:01:10.000000 pyBIA-1.3.2/pyBIA.egg-info/requires.txt
--rw-r--r--   0 daniel     (501) staff       (20)        6 2023-03-07 08:01:10.000000 pyBIA-1.3.2/pyBIA.egg-info/top_level.txt
--rw-r--r--   0 daniel     (501) staff       (20)      411 2023-03-07 06:54:26.000000 pyBIA-1.3.2/pyproject.toml
--rw-r--r--   0 daniel     (501) staff       (20)       38 2023-03-07 08:01:11.037627 pyBIA-1.3.2/setup.cfg
--rwxr-xr-x   0 daniel     (501) staff       (20)     1160 2023-03-07 06:54:46.000000 pyBIA-1.3.2/setup.py
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-05-30 23:04:22.022369 pyBIA-1.3.3/
+-rw-r--r--   0 daniel     (501) staff       (20)    35149 2022-09-02 05:09:52.000000 pyBIA-1.3.3/LICENSE
+-rw-r--r--   0 daniel     (501) staff       (20)       21 2022-09-02 05:09:52.000000 pyBIA-1.3.3/MANIFEST.in
+-rw-r--r--   0 daniel     (501) staff       (20)      574 2023-05-30 23:04:22.021432 pyBIA-1.3.3/PKG-INFO
+-rw-r--r--   0 daniel     (501) staff       (20)      875 2023-04-22 05:29:30.000000 pyBIA-1.3.3/README.md
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-05-30 23:04:21.993198 pyBIA-1.3.3/pyBIA/
+-rw-r--r--   0 daniel     (501) staff       (20)       27 2022-09-02 05:09:52.000000 pyBIA-1.3.3/pyBIA/__init__.py
+-rw-r--r--   0 daniel     (501) staff       (20)    83871 2023-05-29 03:52:11.000000 pyBIA-1.3.3/pyBIA/catalog.py
+-rw-r--r--   0 daniel     (501) staff       (20)   216629 2023-05-30 22:56:43.000000 pyBIA-1.3.3/pyBIA/cnn_model.py
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-05-30 23:04:22.019982 pyBIA-1.3.3/pyBIA/data/
+-rw-r--r--   0 daniel     (501) staff       (20)        0 2022-09-02 05:09:52.000000 pyBIA-1.3.3/pyBIA/data/__init.py__
+-rw-r--r--   0 daniel     (501) staff       (20)      115 2022-09-02 05:09:52.000000 pyBIA-1.3.3/pyBIA/data/obj_name_5
+-rw-r--r--   0 daniel     (501) staff       (20)    17965 2022-09-02 05:09:52.000000 pyBIA-1.3.3/pyBIA/data/obj_name_779
+-rw-r--r--   0 daniel     (501) staff       (20)     1840 2022-09-02 05:09:52.000000 pyBIA-1.3.3/pyBIA/data/obj_name_80
+-rw-r--r--   0 daniel     (501) staff       (20)    36381 2023-05-19 21:52:50.000000 pyBIA-1.3.3/pyBIA/data_augmentation.py
+-rw-r--r--   0 daniel     (501) staff       (20)    13205 2023-04-10 18:55:13.000000 pyBIA-1.3.3/pyBIA/data_processing.py
+-rw-r--r--   0 daniel     (501) staff       (20)    56914 2023-05-29 03:51:42.000000 pyBIA-1.3.3/pyBIA/ensemble_model.py
+-rw-r--r--   0 daniel     (501) staff       (20)    13062 2023-01-28 21:52:31.000000 pyBIA-1.3.3/pyBIA/image_moments.py
+-rw-r--r--   0 daniel     (501) staff       (20)   138053 2023-05-30 22:57:07.000000 pyBIA-1.3.3/pyBIA/optimization.py
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-05-30 23:04:22.014793 pyBIA-1.3.3/pyBIA.egg-info/
+-rw-r--r--   0 daniel     (501) staff       (20)      574 2023-05-30 23:04:21.000000 pyBIA-1.3.3/pyBIA.egg-info/PKG-INFO
+-rw-r--r--   0 daniel     (501) staff       (20)      464 2023-05-30 23:04:21.000000 pyBIA-1.3.3/pyBIA.egg-info/SOURCES.txt
+-rw-r--r--   0 daniel     (501) staff       (20)        1 2023-05-30 23:04:21.000000 pyBIA-1.3.3/pyBIA.egg-info/dependency_links.txt
+-rw-r--r--   0 daniel     (501) staff       (20)      178 2023-05-30 23:04:21.000000 pyBIA-1.3.3/pyBIA.egg-info/requires.txt
+-rw-r--r--   0 daniel     (501) staff       (20)        6 2023-05-30 23:04:21.000000 pyBIA-1.3.3/pyBIA.egg-info/top_level.txt
+-rw-r--r--   0 daniel     (501) staff       (20)      428 2023-04-02 21:32:46.000000 pyBIA-1.3.3/pyproject.toml
+-rw-r--r--   0 daniel     (501) staff       (20)       38 2023-05-30 23:04:22.022651 pyBIA-1.3.3/setup.cfg
+-rwxr-xr-x   0 daniel     (501) staff       (20)     1160 2023-05-30 23:00:12.000000 pyBIA-1.3.3/setup.py
```

### Comparing `pyBIA-1.3.2/LICENSE` & `pyBIA-1.3.3/LICENSE`

 * *Files identical despite different names*

### Comparing `pyBIA-1.3.2/PKG-INFO` & `pyBIA-1.3.3/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pyBIA
-Version: 1.3.2
+Version: 1.3.3
 Summary: Convolutional Neural Network for Ly-alpha Blob Detection
 Home-page: https://github.com/Professor-G/pyBIA
 Author: Daniel Godines
 Author-email: danielgodinez123@gmail.com
 License: GPL-3.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `pyBIA-1.3.2/README.md` & `pyBIA-1.3.3/README.md`

 * *Files identical despite different names*

### Comparing `pyBIA-1.3.2/pyBIA/catalog.py` & `pyBIA-1.3.3/pyBIA/catalog.py`

 * *Files 15% similar despite different names*

```diff
@@ -6,19 +6,19 @@
 """
 from astropy.utils.exceptions import AstropyWarning
 from warnings import warn, filterwarnings, simplefilter
 filterwarnings("ignore", category=AstropyWarning) #Ignore NaN & inf warnings
 filterwarnings("ignore", category=RuntimeWarning) #Ignore sigma_clipping NaN warning
 from astropy.io import fits 
 from astropy.wcs import WCS
-import matplotlib.pyplot as plt
-#plt.style.use('/Users/daniel/Documents/plot_style.txt') 
-import matplotlib.ticker as tck 
 import numpy as np
 import pandas as pd
+import matplotlib.pyplot as plt
+import matplotlib.ticker as tck
+from cycler import cycler 
 
 from photutils.detection import DAOStarFinder
 from photutils import detect_threshold, detect_sources, deblend_sources, segmentation
 from photutils.aperture import ApertureStats, CircularAperture, CircularAnnulus
 from astropy.stats import sigma_clipped_stats, SigmaClip, gaussian_fwhm_to_sigma
 from astropy.convolution import Gaussian2DKernel, convolve
 
@@ -852,15 +852,15 @@
         elif median_bkg == 0:
             new_data -= median_bkg 
         else:
             new_data -= median_bkg[i]
 
         segm, convolved_data = segm_find(new_data, nsig=nsig, kernel_size=kernel_size, deblend=deblend)
         props = segmentation.SourceCatalog(new_data, segm, convolved_data=convolved_data)
-
+        #return segm.data
         with plt.rc_context({'axes.edgecolor':'silver', 'axes.linewidth':5, 'xtick.color':'black', 
             'ytick.color':'black', 'figure.facecolor':'white', 'axes.titlesize':22}):
             fig, (ax1, ax2) = plt.subplots(2, 1, sharex=True)
             ax1 = plt.subplot(2,1,1)
             ax2 = plt.subplot(2,1,2, sharex=ax1, sharey=ax1)
             #plt.tight_layout()
             index = np.where(np.isfinite(new_data))
@@ -930,24 +930,25 @@
             ax2.set_yticks(ticks)
             ax2.set_yticklabels(x_label_list)
 
             ax1.tick_params(axis="both", which='minor', length=5, color='w', direction='in')
             ax2.tick_params(axis="both", which='minor', length=5, color='w', direction='in')
 
             if savefig is True:
+                _set_style_()
                 if path is None:
                     print("No path specified, saving catalog to local home directory.")
                     path = str(Path.home())+'/'
-                fig.savefig(path+name, dpi=dpi, bbox_inches='tight')
+                fig.savefig(path+name+'.png', dpi=dpi, bbox_inches='tight')
+                plt.clf(); plt.style.use('default')
                 return
-            plt.show()
-
+            plt.show()           
 
 def plot_three_segm(data, xpix=None, ypix=None, size=100, median_bkg=None, nsig=[0.1, 0.5, 0.9], kernel_size=21, invert=False,
-    deblend=False, pix_conversion=5, cmap='viridis', path=None, name='', title='Source Detection Threshold', savefig=False):
+    deblend=False, pix_conversion=5, cmap='viridis', path=None, name='segm_image', title='Source Detection Threshold', savefig=False):
     """
     This is the function used to generate Figure 1 of the paper, used to visualize
     how the segmentation object differs when applying varying sigma thresholds.
 
     If no x & y positions are input, the whole image will be used. If there are
     position areguments then a subimage of area size x size will be cropped out 
     first, centered around a given (x, y). By default size=100, although this should
@@ -1001,15 +1002,15 @@
         if isinstance(median_bkg, np.ndarray) is False:
             median_bkg = np.array(median_bkg)
 
     if len(data.shape) != 2:
         raise ValueError('Data must be 2 dimensional, 3d images not currently supported.')
     try:
         if len(median_bkg) != len(xpix):
-                raise ValueError('If more than one median_bkg is input, the size of the array must be the number of sources (xpix, ypix) input.')
+            raise ValueError('If more than one median_bkg is input, the size of the array must be the number of sources (xpix, ypix) input.')
     except:
         pass
 
     if data.shape[1] < size:
        size = data.shape[1]
     if data.shape[1] < 70: 
         r_out = data.shape[1]-1
@@ -1226,15 +1227,383 @@
 
            # ax1.tick_params(axis="both", colors="black", labeltop=False, labelleft=True, labelright=False, labelbottom=False, labelsize=14)
            # ax2.tick_params(axis="both", colors="black", labeltop=True, labelleft=False, labelright=True, labelbottom=False, labelsize=14)
            # ax3.tick_params(axis="both", colors="black", labeltop=False, labelleft=False, labelright=True, labelbottom=True, labelsize=14)
            # ax4.tick_params(axis="both", colors="black", labeltop=False, labelleft=True, labelright=False, labelbottom=True, labelsize=14)
 
             if savefig is True:
+                _set_style_()
+                if path is None:
+                    print("No path specified, saving catalog to local home directory.")
+                    path = str(Path.home())+'/'
+                fig.savefig(path+name+'.png', dpi=300, bbox_inches='tight')
+                plt.clf(); plt.style.use('default')
+                return
+            plt.show()
+
+
+def plot_two_filters(data1, data2, xpix=None, ypix=None, size=100, median_bkg1=None, median_bkg2=None, nsig=[0.5, 0.5], kernel_size=21, invert=False,
+    deblend=False, pix_conversion=5, cmap='viridis', path=None, filter1='Bw', filter2='Rw', name='Source Detection Threshold', savefig=False):
+    """
+    This is the function used to generate Figure 1 of the paper, used to visualize
+    how the segmentation object differs when applying varying sigma thresholds.
+
+    If no x & y positions are input, the whole image will be used. If there are
+    position areguments then a subimage of area size x size will be cropped out 
+    first, centered around a given (x, y). By default size=100, although this should
+    be a window size that comfortably encapsulates all objects. If this is too large
+    the automatic background measurements will be less robust.
+
+    Args:
+        data (ndarray): 2D array of a single image.
+        xpix (ndarray, optional): 1D array or list containing the x-pixel position.
+            Can contain one position or multiple samples. Defaults to None, in which case
+            the whole image is plotted.
+        ypix (ndarray, optional): 1D array or list containing the y-pixel position.
+            Can contain one position or multiple samples. Defaults to None, in which case
+            the whole image is plotted.
+        size (int): length/width of the output image. Defaults to
+            100 pixels or data.shape[0] if image is small.
+        median_bkg (ndarray, optional): If None then the median background will be
+            subtracted using the median value within an annuli around the source. 
+            If data is already background subtracted set median_bkg = 0. If this is
+            an array, it must contain the local medium background around each source as
+            this scalar will be subtracted locally.        
+        nsig (float): The sigma detection limit. Objects brighter than nsig standard 
+            deviations from the background will be detected during segmentation. Defaults to 0.7.
+        kernel_size (int): The size lenght of the square Gaussian filter kernel used to convolve 
+            the data. This length must be odd. Defaults to 21.
+        invert (bool): If True the x & y coordinates will be switched
+            when cropping out the object, see Note below. Defaults to False. 
+        deblend (bool, optional): If True, the objects are deblended during the segmentation
+            procedure, thus deblending the objects before the morphological features
+            are computed. Defaults to False so as to keep blobs as one segmentation object.
+        pix_conversion (int): Pixels per arcseconds conversion factor. This is used to set
+            the image axes. 
+        cmap (str): Colormap to use when generating the image.
+        path (str, optional): By default the text file containing the photometry will be
+            saved to the local directory, unless an absolute path to a directory is entered here.
+        filter1 (str, ndarray, optional): The title of the image. This can be an array containing
+            multiple names, in which case it must contain a name for each object.
+        savefig (bool, optional): If True the plot will be saved to the specified
+        dpi (int, optional): Dots per inch (resolution) when savefig=True. 
+            Set dpi='figure' to use the image's dpi. Defaults to 300.
+       
+    Returns:
+        AxesImage.
+
+    """
+
+    if isinstance(nsig, np.ndarray) is False:
+        nsig = np.array(nsig)
+
+    if median_bkg1 != 0 and median_bkg1 is not None:
+        if isinstance(median_bkg1, np.ndarray) is False:
+            median_bkg1 = np.array(median_bkg1)
+    if median_bkg2 != 0 and median_bkg2 is not None:
+        if isinstance(median_bkg2, np.ndarray) is False:
+            median_bkg2 = np.array(median_bkg2)
+
+    if len(data1.shape) != 2:
+        raise ValueError('Data must be 2 dimensional, 3d images not currently supported.')
+    try:
+        if len(median_bkg1) != len(xpix):
+            raise ValueError('If more than one median_bkg1 is input, the size of the array must be the number of sources (xpix, ypix) input.')
+        if len(median_bkg2) != len(xpix):
+            raise ValueError('If more than one median_bkg2 is input, the size of the array must be the number of sources (xpix, ypix) input.')
+    except:
+        pass
+
+    if data1.shape[1] < size:
+       size = data1.shape[1]
+    if data1.shape[1] < 70: 
+        r_out = data1.shape[1]-1
+        r_in = r_out - 15 #This is a 15 pixel annulus. 
+    elif data1.shape[1] >= 72:
+        r_out = 35
+        r_in = 20 #Default annulus used to calculate the median bkg
+    
+    if xpix is None and ypix is None:
+        xpix, ypix = data1.shape[1]/2, data1.shape[1]/2
+        size = data1.shape[1]
+
+    try: 
+        len(xpix)
+    except TypeError:
+        xpix = [xpix]
+    try:
+        len(ypix)
+    except TypeError:
+        ypix = [ypix]
+    try:
+        len(median_bkg1)
+    except TypeError:
+        if median_bkg1 is not None:
+            median_bkg1 = [median_bkg1]
+    try:
+        len(median_bkg2)
+    except TypeError:
+        if median_bkg2 is not None:
+            median_bkg2 = [median_bkg2]
+            
+    for i in range(len(xpix)):
+        if size == data1.shape[1]:
+            new_data1 = data1
+            new_data2 = data2
+        else: 
+            new_data1 = data_processing.crop_image(data1, int(xpix[i]), int(ypix[i]), size, invert=invert)
+            new_data2 = data_processing.crop_image(data2, int(xpix[i]), int(ypix[i]), size, invert=invert)
+
+        if median_bkg1 is None: #Hard coding annuli size, inner:25 -> outer:35
+            if new_data1.shape[0] > 200 and len(xpix) == 1:
+                print('Calculating background in local regions, this will take a while... if data is background subtracted set median_bkg=0.')
+                new_data1 = subtract_background(new_data1)
+                new_data2 = subtract_background(new_data2)
+            else:
+                annulus_apertures = CircularAnnulus((new_data1.shape[1]/2, new_data1.shape[0]/2), r_in=r_in, r_out=r_out)
+                bkg_stats = ApertureStats(new_data1, annulus_apertures, sigma_clip=SigmaClip())
+                new_data1 -= bkg_stats.median
+                bkg_stats = ApertureStats(new_data2, annulus_apertures, sigma_clip=SigmaClip())
+                new_data2 -= bkg_stats.median
+        elif median_bkg1 == 0:
+            new_data1 -= median_bkg1
+            new_data2 -= median_bkg2 
+        else:
+            new_data1 -= median_bkg1[i]
+            new_data2 -= median_bkg2[i]
+
+        segm1, convolved_data1 = segm_find(new_data1, nsig=nsig[0], kernel_size=kernel_size, deblend=deblend)
+        segm2, convolved_data2 = segm_find(new_data2, nsig=nsig[1], kernel_size=kernel_size, deblend=deblend)
+        #props = segmentation.SourceCatalog(new_data, segm, convolved_data=convolved_data)
+
+        plt.rcParams["mathtext.fontset"] = "stix"
+        plt.rcParams["font.family"] = "STIXGeneral"
+        plt.rcParams["axes.formatter.use_mathtext"]=True
+        plt.rcParams['text.usetex']=False
+
+        with plt.rc_context({'axes.edgecolor':'white', 'xtick.color':'white', 
+            'ytick.color':'white', 'figure.facecolor':'black'}):#, 'axes.titlesize':22}):
+            fig, axes = plt.subplots(ncols=2, nrows=2, sharex=True, sharey=True, figsize=(8,8))
+            fig.suptitle(name, x=.5, y=0.98, color='black', fontsize=16)
+            ((ax1, ax2), (ax4, ax3)) = axes
+            ax1.set_aspect('equal')
+            ax2.set_aspect('equal')
+            ax3.set_aspect('equal')
+            ax4.set_aspect('equal')
+
+            index = np.where(np.isfinite(new_data1))
+            std = np.median(np.abs(new_data1[index] - np.median(new_data1[index])))
+            vmin, vmax = np.median(new_data1[index]) - 3*std, np.median(new_data1[index]) + 10*std
+            ax1.imshow(new_data1, vmin=vmin, vmax=vmax, cmap=cmap)
+
+            index = np.where(np.isfinite(new_data2))
+            std = np.median(np.abs(new_data2[index] - np.median(new_data2[index])))
+            vmin, vmax = np.median(new_data2[index]) - 3*std, np.median(new_data2[index]) + 10*std
+            ax2.imshow(new_data2, vmin=vmin, vmax=vmax, cmap=cmap)
+            
+            ax4.imshow(segm1.data, origin='lower', cmap=segm2.make_cmap(seed=19))
+            ax3.imshow(segm2.data, origin='lower', cmap=segm2.make_cmap(seed=19))
+            """
+            ax2.plot(0,0,label=str(nsig[0])+r'$\sigma$', color='none')
+            leg1 = ax2.legend(handlelength=0, handletextpad=0, fancybox=True, loc='upper right', prop={'size':16})
+            for item in leg1.legendHandles:
+                item.set_visible(False)
+
+            ax3.plot(0,0,label=str(nsig[1])+r'$\sigma$', color='none')
+            leg2 = ax3.legend(handlelength=0, handletextpad=0, fancybox=True, loc='lower right', prop={'size':16})
+            for item in leg2.legendHandles:
+                item.set_visible(False)
+                
+            ax4.plot(0,0,label=str(nsig[2])+r'$\sigma$', color='none')
+            leg3 = ax4.legend(handlelength=0, handletextpad=0, fancybox=True, loc='lower left', prop={'size':16})
+            for item in leg3.legendHandles:
+                item.set_visible(False)  
+            """
+            #'seismic', 'twilight', 'YlGnBu_r', 'bone', 'cividis' #best cmaps
+            
+            plt.gcf().set_facecolor("white")
+            fig.subplots_adjust(wspace=0, hspace=0)
+            ax1.grid(True, color='k', alpha=0.35, linewidth=1.5, linestyle='--')
+            ax2.grid(True, alpha=0.35, linestyle='--')
+            ax3.grid(True, alpha=0.35, linestyle='--')
+            ax4.grid(True, alpha=0.35, linestyle='--')
+
+            """ 
+            ax1.tick_params(axis="both", which="both", colors="white", direction="in", labeltop=False, labelbottom=False,
+                labelright=False, length=10, width=2, bottom=False, top=False, left=False, right=False, labelsize=12)
+            ax2.tick_params(axis="both", which="both", colors="white", direction="in", labeltop=False, labelbottom=False,
+                labelleft=False, length=10, width=2, bottom=False, top=False, left=False, right=False, labelsize=12)
+            ax3.tick_params(axis="both", which="both", colors="white", direction="in", labeltop=False, labelbottom=False,
+                labelleft=False, length=10, width=2, bottom=False, top=False, left=False, right=False, labelsize=12)
+            ax4.tick_params(axis="both", which="both", colors="white", direction="in", labeltop=False, labelbottom=False,
+                labelleft=False, length=10, width=2, bottom=False, top=False, left=False, right=False, labelsize=12)
+            """
+           # ax1.set_xticks([-10, -5, 0, 5, 10])
+           # ax2.set_xticks([-10, -5, 0, 5])
+            for axis in ['right', 'left', 'bottom', 'top']:
+                ax1.spines[axis].set_color("silver")
+                ax1.spines[axis].set_linewidth(0.95)
+                ax1.spines[axis].set_visible(True)
+                ax2.spines[axis].set_color("silver")
+                ax2.spines[axis].set_linewidth(0.95)
+                ax2.spines[axis].set_visible(True)
+                ax3.spines[axis].set_color("silver")
+                ax3.spines[axis].set_linewidth(0.95)
+                ax3.spines[axis].set_visible(True)
+                ax4.spines[axis].set_color("silver")
+                ax4.spines[axis].set_linewidth(0.95)
+                ax4.spines[axis].set_visible(True)
+            
+            ax1.xaxis.set_visible(True)
+            ax1.yaxis.set_visible(True)
+            ax2.xaxis.set_visible(True)
+            ax2.yaxis.set_visible(True)
+            ax3.xaxis.set_visible(True)
+            ax3.yaxis.set_visible(True)
+            ax4.xaxis.set_visible(True)
+            ax4.yaxis.set_visible(True)
+            
+            if isinstance(filter1, str):
+                ax1.set_title(filter1, color='black', size=18)
+            else:
+                ax1.title(filter1[i], color='black', size=18)
+
+            if isinstance(filter2, str):
+                ax2.set_title(filter2, color='black', size=18)
+            else:
+                ax2.title(filter2[i], color='black', size=18)
+
+            ax1.set_ylabel(r'$\Delta\delta \ \rm [arcsec]$', color='black', size=17)
+            ax4.set_xlabel(r'$\Delta\alpha \ \rm [arcsec]$', color='black', size=17)
+            ax4.set_ylabel(r'$\Delta\delta \ \rm [arcsec]$', color='black', size=17)
+            ax3.set_xlabel(r'$\Delta\alpha \ \rm [arcsec]$', color='black', size=17)
+            
+            #ax2_twin.set_ylabel(r'$\Delta\delta$ [arcsec]', fontweight='ultralight', color='snow', size=18)
+            #ax3_twin.set_ylabel(r'$\Delta\delta$ [arcsec]', fontweight='ultralight', color='snow', size=18)
+            #ax1.yaxis.tick_right()
+
+            ax1.xaxis.set_major_locator(plt.MaxNLocator(5))
+            ax1.yaxis.set_major_locator(plt.MaxNLocator(5))
+            ax2.yaxis.set_major_locator(plt.MaxNLocator(5))
+            ax2.xaxis.set_major_locator(plt.MaxNLocator(5))
+            ax3.xaxis.set_major_locator(plt.MaxNLocator(5))
+            ax3.yaxis.set_major_locator(plt.MaxNLocator(5))
+            ax4.yaxis.set_major_locator(plt.MaxNLocator(5))
+            ax4.xaxis.set_major_locator(plt.MaxNLocator(5))
+
+            ax1.yaxis.set_minor_locator(tck.AutoMinorLocator(2))
+            ax1.xaxis.set_minor_locator(tck.AutoMinorLocator(2))
+            ax2.xaxis.set_minor_locator(tck.AutoMinorLocator(2))
+            ax2.yaxis.set_minor_locator(tck.AutoMinorLocator(2))
+            ax3.yaxis.set_minor_locator(tck.AutoMinorLocator(2))
+            ax3.xaxis.set_minor_locator(tck.AutoMinorLocator(2))
+            ax4.xaxis.set_minor_locator(tck.AutoMinorLocator(2))
+            ax4.yaxis.set_minor_locator(tck.AutoMinorLocator(2))
+
+            
+            #ax1.tick_params(axis="both", which='minor', length=5, width=2, color='black', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+            #ax2.tick_params(axis="both", which='minor', length=5, width=2, color='w', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+            #ax3.tick_params(axis="both", which='minor', length=5, width=2, color='w', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+            #ax4.tick_params(axis="both", which='minor', length=5, width=2, color='w', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+            
+            #ax1.tick_params(axis="both", which='major', length=10, width=2, color='black', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+            #ax2.tick_params(axis="both", which='major', length=10, width=2, color='w', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+            #ax3.tick_params(axis="both", which='major', length=10, width=2, color='w', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+            #ax4.tick_params(axis="both", which='major', length=10, width=2, color='w', direction='in', top=True, left=True, right=True, bottom=True, labelsize=16)
+
+            length = new_data1.shape[0]
+            x_label_list_1 = [str(length/-2./pix_conversion), str(length/-4./pix_conversion), 0, str(length/4./pix_conversion), str(length/2./pix_conversion)]
+            ticks_1 = [0,length-3*length/4,length-length/2,length-length/4,length]
+
+            x_label_list_2 = [str(length/-4./pix_conversion), 0, str(length/4./pix_conversion)]
+            ticks_2 = [length-3*length/4,length-length/2,length-length/4]
+
+            ax1.set_frame_on(True)
+            ax1.set_xticks(ticks_2)
+            ax1.set_xticklabels(x_label_list_2, color='black', fontsize=16)
+            ax1.set_yticks(ticks_2)
+            ax1.set_yticklabels(x_label_list_2, color='black', fontsize=16)
+
+            ax2.set_frame_on(True)
+            ax2.set_xticks(ticks_2)
+            ax2.set_xticklabels(x_label_list_2, color='black', fontsize=16)
+            ax2.set_yticks(ticks_2)
+            ax2.set_yticklabels(x_label_list_2, color='black', fontsize=16)
+
+            ax3.set_frame_on(True)
+            ax3.set_xticks(ticks_2)
+            ax3.set_xticklabels(x_label_list_2, color='black', fontsize=16)
+            ax3.set_yticks(ticks_2)
+            ax3.set_yticklabels(x_label_list_2, color='black', fontsize=16)
+
+            ax4.set_frame_on(True)
+            ax4.set_xticks(ticks_2)
+            ax4.set_xticklabels(x_label_list_2, color='black', fontsize=16)
+            ax4.set_yticks(ticks_2)
+            ax4.set_yticklabels(x_label_list_2, color='black', fontsize=16)
+
+           # ax1.tick_params(axis="both", colors="black", labeltop=False, labelleft=True, labelright=False, labelbottom=False, labelsize=14)
+           # ax2.tick_params(axis="both", colors="black", labeltop=True, labelleft=False, labelright=True, labelbottom=False, labelsize=14)
+           # ax3.tick_params(axis="both", colors="black", labeltop=False, labelleft=False, labelright=True, labelbottom=True, labelsize=14)
+           # ax4.tick_params(axis="both", colors="black", labeltop=False, labelleft=True, labelright=False, labelbottom=True, labelsize=14)
+
+            if savefig is True:
+                _set_style_()
                 if path is None:
                     print("No path specified, saving catalog to local home directory.")
                     path = str(Path.home())+'/'
-                fig.savefig(path+name, dpi=300, bbox_inches='tight')
-                plt.clf()
+                fig.savefig(path+name+'.png', dpi=300, bbox_inches='tight')
+                plt.clf(); plt.style.use('default')
                 return
             plt.show()
 
+
+def _set_style_():
+    """Function to configure the matplotlib.pyplot style. This function is called before any images are saved.
+    """
+    plt.rcParams["xtick.color"] = "323034"
+    plt.rcParams["ytick.color"] = "323034"
+    plt.rcParams["text.color"] = "323034"
+    plt.rcParams["lines.markeredgecolor"] = "black"
+    plt.rcParams["patch.facecolor"] = "bc80bd"
+    plt.rcParams["patch.force_edgecolor"] = True
+    plt.rcParams["patch.linewidth"] = 0.8
+    plt.rcParams["scatter.edgecolors"] = "black"
+    plt.rcParams["grid.color"] = "b1afb5"
+    plt.rcParams["axes.titlesize"] = 16
+    plt.rcParams["legend.title_fontsize"] = 12
+    plt.rcParams["xtick.labelsize"] = 16
+    plt.rcParams["ytick.labelsize"] = 16
+    plt.rcParams["font.size"] = 15
+    plt.rcParams["axes.prop_cycle"] = (cycler('color', ['bc80bd' ,'fb8072', 'b3de69','fdb462','fccde5','8dd3c7','ffed6f','bebada','80b1d3', 'ccebc5', 'd9d9d9']))
+    plt.rcParams["mathtext.fontset"] = "stix"
+    plt.rcParams["font.family"] = "STIXGeneral"
+    plt.rcParams["lines.linewidth"] = 2
+    plt.rcParams["lines.markersize"] = 6
+    plt.rcParams["legend.frameon"] = True
+    plt.rcParams["legend.framealpha"] = 0.8
+    plt.rcParams["legend.fontsize"] = 13
+    plt.rcParams["legend.edgecolor"] = "black"
+    plt.rcParams["legend.borderpad"] = 0.2
+    plt.rcParams["legend.columnspacing"] = 1.5
+    plt.rcParams["legend.labelspacing"] = 0.4
+    plt.rcParams["text.usetex"] = False
+    plt.rcParams["axes.labelsize"] = 17
+    plt.rcParams["axes.titlelocation"] = "center"
+    plt.rcParams["axes.formatter.use_mathtext"] = True
+    plt.rcParams["axes.autolimit_mode"] = "round_numbers"
+    plt.rcParams["axes.labelpad"] = 3
+    plt.rcParams["axes.formatter.limits"] = (-4, 4)
+    plt.rcParams["axes.labelcolor"] = "black"
+    plt.rcParams["axes.edgecolor"] = "black"
+    plt.rcParams["axes.linewidth"] = 1
+    plt.rcParams["axes.grid"] = False
+    plt.rcParams["axes.spines.right"] = True
+    plt.rcParams["axes.spines.left"] = True
+    plt.rcParams["axes.spines.top"] = True
+    plt.rcParams["figure.titlesize"] = 18
+    plt.rcParams["figure.autolayout"] = True
+    plt.rcParams["figure.dpi"] = 300
+
+    return
+
+
```

### Comparing `pyBIA-1.3.2/pyBIA/cnn_model.py` & `pyBIA-1.3.3/pyBIA/ensemble_model.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,395 +1,235 @@
 #!/usr/bin/env python3
 # -*- coding: utf-8 -*-
 """
-Created on Thu Sep 16 22:40:39 2021
+Created on Wed Sep 8 10:04:23 2021
 
 @author: daniel
 """
 import os
-import tensorflow as tf
-os.environ['PYTHONHASHSEED'], os.environ["TF_DETERMINISTIC_OPS"] = '0', '1'
-os.environ['CUDA_VISIBLE_DEVICES'], os.environ['TF_CPP_MIN_LOG_LEVEL'] = '-1', '3'
-
-import joblib
+import copy 
+import joblib 
+import random
+import itertools
 import numpy as np
-import pkg_resources
-from pathlib import Path
+import pandas as pd
 import matplotlib.pyplot as plt
-import matplotlib.colors as mcolors
-from keras.utils import to_categorical 
-from imblearn.over_sampling import SMOTE
-
-import random as python_random
-##https://keras.io/getting_started/faq/#how-can-i-obtain-reproducible-results-using-keras-during-development##
-np.random.seed(1909), python_random.seed(1909), tf.random.set_seed(1909)
-
-from tensorflow.keras import backend as K
-from tensorflow.keras.regularizers import l2
-from tensorflow.keras.callbacks import ModelCheckpoint
-from tensorflow.keras.backend import clear_session 
-from tensorflow.keras.models import Sequential, save_model, load_model, Model
-from tensorflow.keras.initializers import VarianceScaling
-from tensorflow.keras.optimizers import SGD, Adagrad, Adam, RMSprop
-from tensorflow.keras.losses import categorical_crossentropy, Hinge, SquaredHinge, KLDivergence, LogCosh
-from tensorflow.keras.layers import Input, Activation, Dense, Dropout, Conv2D, MaxPool2D, \
-    AveragePooling2D, GlobalAveragePooling2D, Flatten, BatchNormalization, Lambda, concatenate
+import matplotlib.colors as mcolors 
+from matplotlib.ticker import ScalarFormatter,AutoMinorLocator
+from cycler import cycler
+from warnings import warn
+from pathlib import Path
+from collections import Counter  
 
-from optuna.importance import get_param_importances, FanovaImportanceEvaluator
-from pyBIA.data_processing import process_class, create_training_set, concat_channels
-from pyBIA.data_augmentation import augmentation, resize
-from pyBIA import optimization
+from sklearn import decomposition
+from sklearn.preprocessing import MinMaxScaler
+from sklearn.ensemble import RandomForestClassifier
+from sklearn.neural_network import MLPClassifier
+from sklearn.metrics import confusion_matrix, auc, RocCurveDisplay
+from sklearn.model_selection import KFold, StratifiedKFold, train_test_split
+from sklearn.manifold import TSNE
 
+from optuna.importance import get_param_importances, FanovaImportanceEvaluator
+from pyBIA.optimization import hyper_opt, borutashap_opt, KNN_imputation
+from xgboost import XGBClassifier
+import scikitplot as skplt
 
 class Classifier:
     """
-    Creates and trains the convolutional neural network. The built-in methods can be used predict new samples, and also optimize the engine and output visualizations.
+    Creates a machine learning classifier object. The built-in methods can be used to optimize the engine and output visualizations.
 
     Args:
-        positive_class (ndarray): The samples for the first class should be passed, which will automatically 
-            be assigned the positive label '1'.
-        negative_class (ndarray, str): The samples for the second class should be passed, which will automatically 
-            be assigned the negative label '0'.
-        val_positive (ndarray, optional): Positive class data to be used for validation. Defaults to None.
-        val_negative (ndarray, optional): Negative class data to be used for validation. Defaults to None.
-        test_positive (ndarray, optional): Positive class data to be used for post-trial testing. Defaults to None.
-        test_negative (ndarray, optional): Negative class data to be used for post-trial testing. Defaults to None.
+        data_x (ndarray): 2D array of size (n x m), where n is the
+            number of samples, and m the number of features.
+        data_y (ndarray, str): 1D array containing the corresponing labels.
+        clf (str): The machine learning classifier to optimize. Can either be
+            'rf' for Random Forest, 'nn' for Neural Network, or 'xgb' for Extreme Gradient Boosting. 
+            Defaults to 'rf'.
         optimize (bool): If True the Boruta algorithm will be run to identify the features
-            that contain useful information, after which the optimal Random Forest hyperparameters will be calculated 
-            using Bayesian optimization. 
-        n_iter (int): The maximum number of iterations to perform during the hyperparameter search. Defaults to 25. 
-        train_epochs (int): Number of epochs to the train the CNN to during the optimization trials. Defaults to 25.
-        img_num_channels (int): The number of filters. Defaults to 1.
-        normalize (bool, optional): If True the data will be min-max normalized using the 
-            input min and max pixels. Defaults to True.
-        min_pixel (int, optional): The minimum pixel count, pixels with counts 
-            below this threshold will be set to this limit. Defaults to 0.
-        max_pixel (int, list, optional): The maximum pixel count, pixels with counts 
-            above this threshold will be set to this limit. Defaults to 100. If img_num_channels
-            is not 1, the max_pixel should be a list containing two values, one for each band.
-        metric (str): Assesment metric to use when both pruning and scoring the hyperparameter optimization trial.
-            Defaults to 'loss'. Options include: 'loss' 'binary_accuracy', 'f1_score' 'all' or the validation equivalents (e.g. 'val_loss').
-        patience (int): Number of epochs without improvement before the optimization trial is terminated. Defaults to 0, which
-            disables this feature.
-        average (bool): If False, the designated metric will be calculated according to its value at the end of the train_epochs. 
-            If True, the metric will be averaged out across all train_epochs. Defaults to True.
-        opt_model (bool): If True, the architecture parameters will be optimized. Defaults to True.
-        opt_aug (bool): If True, the augmentation procedure will be optimized. Defaults to False.
-        batch_min (int): The minimum number of augmentations to perform per image on the positive class, only applicable 
-            if opt_aug=True. Defaults to 2.
-        batch_max (int): The maximum number of augmentations to perform per image on the positive class, only applicable 
-            if opt_aug=True. Defaults to 25.
-        image_size_min (int): The minimum image size to assess, only applicable if opt_aug=True. Defaults to 50.
-        image_size_max (int): The maximum image size to assess, only applicable if opt_aug=True. Defaults to 100.
-        opt_max_min_pix (int, optional): The minimum max pixel value to use when tuning the normalization procedure, 
-            only applicable if opt_aug=True. Defaults to None.
-        opt_max_max_pix (int, optional): The maximum max pixel value to use when tuning the normalization procedure, 
-            only applicable if opt_aug=True. Defaults to None.
-        shift (int): The max allowed vertical/horizontal shifts to use during the data augmentation routine, only applicable
-            if opt_aug=True. Defaults to 10 pixels.
-        mask_size (int, optional): If enabled, this will set the pixel length of a square cutout, to be randomly placed
-            somewhere in the augmented image. This cutout will replace the image values with 0, therefore serving as a 
-            regularizear. Only applicable if opt_aug=True. Defaults to None.
-        num_masks (int, optional): The number of masks to create, to be used alongside the mask_size parameter. If 
-            this is set to a value greater than one, overlap may occur. 
-        verbose (int): Controls the amount of output printed during the training process. A value of 0 is for silent mode, 
-            a value of 1 is used for progress bar mode, and 2 for one line per epoch mode. Defaults to 1.
+            that contain useful information, after which the optimal Random Forest hyperparameters
+            will be calculated using Bayesian optimization. 
         opt_cv (int): Cross-validations to perform when assesing the performance at each
             hyperparameter optimization trial. For example, if cv=3, then each optimization trial
             will be assessed according to the 3-fold cross validation accuracy. Defaults to 10.
             NOTE: The higher this number, the longer the optimization will take.
-        balance (bool, optional): This will determine whether the two classes
-            are kept the same size during optimization, applicable if tuning the augmentation
-            parameters. Defaults to True.
-        limit_search (bool): If False, the AlexNet layer paremters will be tuned, including the number of filters to learn
-            as well as the convolution sizes and strides. Defaults to False due to memory allocation issues when handling
-            lots of tunable parameters.
-        train_acc_threshold (float, optional): A value between 0 and 1 that designates the training binary_accuracy threshold that should
-            not be exceeded. As soon as the training exceeds this limit, the trial is stopped early. Defaults to None.
-        monitor1 (str, optional): The first metric to monitor, can take the same values as the metric argument. Defaults to None.
-        monitor2 (str, optional): The second metric to monitor, can take the same values as the metric argument. Defaults to None.
-        monitor1_thresh (float, optional): The threshold value of the first monitor metric. If the metric is loss-related
-            the training will stop early if the value falls below this threshold. Similarly, if the metric is accuracy-related,
-            then the training will stop early if the value falls above this threshold. Defaults to None.
-        monitor2_thresh (float, optional): The threshold value of the second monitor metric. If the metric is loss-related
-            the training will stop early if the value falls below this threshold. Similarly, if the metric is accuracy-related,
-            then the training will stop early if the value falls above this threshold. Defaults to None.
-        smote_sampling (float): The smote_sampling parameter is used in the SMOTE algorithm to specify the desired 
-            ratio of the minority class to the majority class. Defaults to 0 which disables the procedure.
-    
-    Note:
-        The smote_sampling parameter is used in the SMOTE algorithm to specify the desired 
-        ratio of the minority class to the majority class after oversampling the majority.
-
-        If smote_sampling=1.0, the minority class will be oversampled to have the same number 
-        of instances as the majority class, resulting in a balanced dataset.
-
-        If smote_sampling=0.5, the minority class will be oversampled to have 50% of the number 
-        of instances of the majority class.
-
-        If smote_sampling='auto', SMOTE will automatically set the desired ratio between the minority 
-        and majority classes to balance the dataset.
+        limit_search (bool): If True, the search space for the parameters will be expanded,
+            as there are some hyperparameters that can range from 0 to inf. Defaults to False.
+        impute (bool): If False no data imputation will be performed. Defaults to True,
+            which will result in two outputs, the classifier and the imputer to save
+            for future transformations. 
+        imp_method (str): The imputation techinque to apply, can either be 'KNN' for k-nearest
+            neighbors imputation, or...?. Defaults to 'KNN'.
+        n_iter (int): The maximum number of iterations to perform during 
+            the hyperparameter search. Defaults to 25. 
+        boruta_trials (int): The number of trials to run when running Boruta for
+            feature selection. Set to 0 for no feature selection. Defaults to 50.
+        boruta_model (str): The ensemble to use when calculating the feature importance
+            to be utilized by the Boruta algorithm. Can either be 'rf' or 'xgb'. Note
+            that this does not have to be the same as the machine learning classifier, clf.
+        balance (bool, optional): If True, a weights array will be calculated and used
+            when fitting the classifier. This can improve classification when classes
+            are imbalanced. This is only applied if the classification is a binary task. 
+            Defaults to True.        
+        csv_file (DataFrame, optional): The csv file output after generating the training set. This can be
+            input in lieu of the data_x and data_y arguments.
     """
 
-    def __init__(self, positive_class=None, negative_class=None, val_positive=None, val_negative=None, img_num_channels=1, 
-        optimize=True, n_iter=25, normalize=True, min_pixel=0, max_pixel=1000, epochs=25, train_epochs=25, 
-        patience=5, opt_model=True, opt_aug=False, batch_min=2, batch_max=25, image_size_min=50, image_size_max=100, 
-        balance=True, opt_max_min_pix=None, opt_max_max_pix=None, metric='loss', average=True, test_positive=None, 
-        test_negative=None, shift=10, opt_cv=None, mask_size=None, num_masks=None, verbose=0, train_acc_threshold=None,
-        limit_search=True, monitor1=None, monitor2=None, monitor1_thresh=None, monitor2_thresh=None, smote_sampling=0):
-
-        self.positive_class = positive_class
-        self.negative_class = negative_class
+    def __init__(self, data_x=None, data_y=None, clf='rf', optimize=False, opt_cv=10, 
+        limit_search=True, impute=True, imp_method='KNN', n_iter=25, 
+        boruta_trials=50, boruta_model='rf', balance=True, csv_file=None):
+
+        self.data_x = data_x
+        self.data_y = data_y
+        self.clf = clf
         self.optimize = optimize 
-        self.metric = metric 
-        self.average = average
-        self.n_iter = n_iter
-        self.img_num_channels = img_num_channels
-        self.normalize = normalize 
-        self.min_pixel = min_pixel
-        self.max_pixel = max_pixel
-        self.val_positive = val_positive
-        self.val_negative = val_negative
-        self.epochs = epochs
-        self.train_epochs = train_epochs
-        self.patience = patience
-
-        self.opt_model = opt_model 
-        self.opt_aug = opt_aug
-        self.batch_min = batch_min 
-        self.batch_max = batch_max 
-        self.image_size_min = image_size_min
-        self.image_size_max = image_size_max
-        self.balance = balance
-        self.opt_max_min_pix = opt_max_min_pix
-        self.opt_max_max_pix = opt_max_max_pix
-        self.test_positive = test_positive
-        self.test_negative = test_negative
-        self.shift = shift  
         self.opt_cv = opt_cv 
-        self.mask_size = mask_size
-        self.num_masks = num_masks
-        self.verbose = verbose
-        self.train_acc_threshold = train_acc_threshold
         self.limit_search = limit_search
-
-        self.monitor1 = monitor1
-        self.monitor2 = monitor2
-        self.monitor1_thresh = monitor1_thresh
-        self.monitor2_thresh = monitor2_thresh
-        self.smote_sampling = smote_sampling
+        self.impute = impute
+        self.imp_method = imp_method
+        self.n_iter = n_iter
+        self.boruta_trials = boruta_trials
+        self.boruta_model = boruta_model 
+        self.balance = balance 
+        self.csv_file = csv_file
 
         self.model = None
-        self.history = None 
-        self.best_params = None 
+        self.imputer = None
+        self.feats_to_use = None
+
+        self.feature_history = None  
         self.optimization_results = None 
+        self.best_params = None 
+
+        if self.csv_file is not None:
+            self.data_x = np.array(csv_file[csv_file.columns[:-1]])
+            self.data_y = csv_file.label
+            print('Successfully loaded the data_x and data_y arrays from the input csv_file!')
+        else:
+            if self.data_x is None or self.data_y is None:
+                print('NOTE: data_x and data_y parameters are required to output visualizations.')
+        
+        if self.data_y is not None:
+            self.data_y_ = copy.deepcopy(self.data_y) #For plotting purposes, save the original label array as it will be overwrite with the numerical labels when plotting only
+            if self.clf == 'xgb':
+                if all(isinstance(val, (int, str)) for val in self.data_y):
+                    print('XGBoost classifier requires numerical class labels! Converting class labels as follows:')
+                    print('________________________________')
+                    y = np.zeros(len(self.data_y))
+                    for i in range(len(np.unique(self.data_y))):
+                        print(str(np.unique(self.data_y)[i]).ljust(10)+'  ------------->     '+str(i))
+                        index = np.where(self.data_y == np.unique(self.data_y)[i])[0]
+                        y[index] = i
+                    self.data_y = y 
+                    print('________________________________')
+        else:
+            self.data_y_ = None 
 
     def create(self):
         """
-        Creates the CNN machine learning engine.
+        Creates the machine learning engine, current options are either a
+        Random Forest, XGBoost, or a Neural Network classifier. 
         
         Returns:
-            Trained classifier.
+            Trained and optimized classifier.
         """
+        if self.optimize is False:
+            if len(np.unique(self.data_y)) == 2:
+                counter = Counter(self.data_y)
+                if counter[np.unique(self.data_y)[0]] != counter[np.unique(self.data_y)[1]]:
+                    if self.balance: #If balance is True but optimize is False
+                        print('Unbalanced dataset detected, to apply weights set optimize=True.')
+
+        if self.clf == 'rf':
+            model = RandomForestClassifier(random_state=1909)
+        elif self.clf == 'nn':
+            model = MLPClassifier(random_state=1909)
+        elif self.clf == 'xgb':
+            model = XGBClassifier(random_state=1909)
+            if all(isinstance(val, (int, str)) for val in self.data_y):
+                print('XGBoost classifier requires numerical class labels! Converting class labels as follows:')
+                print('________________________________')
+                y = np.zeros(len(self.data_y))
+                for i in range(len(np.unique(self.data_y))):
+                    print(str(np.unique(self.data_y)[i]).ljust(10)+'  ------------->     '+str(i))
+                    index = np.where(self.data_y == np.unique(self.data_y)[i])[0]
+                    y[index] = i
+                self.data_y = y 
+                print('________________________________')
 
-        if self.optimize is False and self.best_params is None:
-            print("Returning base AlexNet model...")
-            self.model, self.history = AlexNet(self.positive_class, self.negative_class, img_num_channels=self.img_num_channels, normalize=self.normalize,
-                min_pixel=self.min_pixel, max_pixel=self.max_pixel, val_positive=self.val_positive, val_negative=self.val_negative, epochs=self.epochs, 
-                smote_sampling=self.smote_sampling)
-            
-            return      
-
-        if self.best_params is None:
-            self.best_params, self.optimization_results = optimization.hyper_opt(self.positive_class, self.negative_class, clf='cnn', metric=self.metric, average=self.average, 
-                n_iter=self.n_iter, return_study=True, img_num_channels=self.img_num_channels, normalize=self.normalize, min_pixel=self.min_pixel, max_pixel=self.max_pixel, 
-                val_X=self.val_positive, val_Y=self.val_negative, train_epochs=self.train_epochs, patience=self.patience, opt_model=self.opt_model, opt_aug=self.opt_aug, 
-                batch_min=self.batch_min, batch_max=self.batch_max, image_size_min=self.image_size_min, image_size_max=self.image_size_max, balance=self.balance,
-                opt_max_min_pix=self.opt_max_min_pix, opt_max_max_pix=self.opt_max_max_pix, test_positive=self.test_positive, test_negative=self.test_negative, shift=self.shift, opt_cv=self.opt_cv, 
-                mask_size=self.mask_size, num_masks=self.num_masks, verbose=self.verbose, train_acc_threshold=self.train_acc_threshold, limit_search=self.limit_search,
-                monitor1=self.monitor1, monitor2=self.monitor2, monitor1_thresh=self.monitor1_thresh, monitor2_thresh=self.monitor2_thresh, smote_sampling=self.smote_sampling)
-            print("Fitting and returning final model...")
         else:
-            print('Fitting model using the loaded best_params...')
+            raise ValueError('clf argument must either be "rf", "nn", or "xgb".')
+        
+        if self.impute is False and self.optimize is False:
+            if np.any(np.isfinite(self.data_x)==False):
+                raise ValueError('data_x array contains nan values but impute is set to False! Set impute=True and run again.')
+            print("Returning base {} model...".format(self.clf))
+            model.fit(self.data_x, self.data_y)
+            self.model = model
+            return
+
+        if self.impute:
+            if self.imp_method == 'KNN':
+                data, self.imputer = KNN_imputation(data=self.data_x, imputer=None)
+            else:
+                raise ValueError('Invalid imputation method, currently only k-NN is supported.')
             
-        if self.epochs != 0:
-
-            clear_session()
-
-            if self.opt_max_min_pix is not None:
-                self.normalize = True #In case it's mistakenly set to False by user
-                min_pix, max_pix = 0.0, []
-                if self.img_num_channels >= 1:
-                    max_pix.append(self.best_params['max_pixel_1'])
-                if self.img_num_channels >= 2:
-                    max_pix.append(self.best_params['max_pixel_2'])
-                if self.img_num_channels == 3:
-                    max_pix.append(self.best_params['max_pixel_3'])
-            else:
-                min_pix, max_pix = self.min_pixel, self.max_pixel
-
-            if self.opt_aug:
-                if self.img_num_channels == 1:
-                    channel1, channel2, channel3 = copy.deepcopy(self.positive_class), None, None 
-                elif self.img_num_channels == 2:
-                    channel1, channel2, channel3 = copy.deepcopy(self.positive_class[:,:,:,0]), copy.deepcopy(self.positive_class[:,:,:,1]), None 
-                elif self.img_num_channels == 3:
-                    channel1, channel2, channel3 = copy.deepcopy(self.positive_class[:,:,:,0]), copy.deepcopy(self.positive_class[:,:,:,1]), copy.deepcopy(self.positive_class[:,:,:,2])
-                else:
-                    raise ValueError('Only three filters are supported!')
-
-                augmented_images = augmentation(channel1=channel1, channel2=channel2, channel3=channel3, batch=self.best_params['num_aug'], 
-                    width_shift=self.shift, height_shift=self.shift, horizontal=True, vertical=True, rotation=False,#self.best_params['rotation'], 
-                    image_size=self.best_params['image_size'], mask_size=self.mask_size, num_masks=self.num_masks)
-
-                if self.img_num_channels > 1:
-                    class_1=[]
-                    if self.img_num_channels == 2:
-                        for i in range(len(augmented_images[0])):
-                            class_1.append(concat_channels(augmented_images[0][i], augmented_images[1][i]))
-                    else:
-                        for i in range(len(augmented_images[0])):
-                            class_1.append(concat_channels(augmented_images[0][i], augmented_images[1][i], augmented_images[2][i]))
-                    class_1 = np.array(class_1)
-                else:
-                    class_1 = augmented_images
-
-                #Perform same augmentation techniques on other data, batch=1
-                if self.img_num_channels == 1:
-                    channel1, channel2, channel3 = copy.deepcopy(self.negative_class), None, None 
-                elif self.img_num_channels == 2:
-                    channel1, channel2, channel3 = copy.deepcopy(self.negative_class[:,:,:,0]), copy.deepcopy(self.negative_class[:,:,:,1]), None 
-                elif self.img_num_channels == 3:
-                    channel1, channel2, channel3 = copy.deepcopy(self.negative_class[:,:,:,0]), copy.deepcopy(self.negative_class[:,:,:,1]), copy.deepcopy(self.negative_class[:,:,:,2])
+            if self.optimize is False:
+                data[data>1e7], data[(data<1e-7)&(data>0)], data[data<-1e7] = 1e7, 1e-7, -1e7
+                print("Returning base {} model...".format(self.clf))
+                model.fit(data, self.data_y)
+                self.model = model 
+                return
                 
-                augmented_images_negative = augmentation(channel1=channel1, channel2=channel2, channel3=channel3, batch=1, 
-                    width_shift=self.shift, height_shift=self.shift, horizontal=horizontal, vertical=vertical, rotation=False, 
-                    image_size=image_size, mask_size=self.mask_size, num_masks=self.num_masks)
-
-                #The augmentation routine returns an output for each filter, e.g. 3 outputs for RGB
-                if self.img_num_channels > 1:
-                    class_2=[]
-                    if self.img_num_channels == 2:
-                        for i in range(len(augmented_images_negative[0])):
-                            class_2.append(data_processing.concat_channels(augmented_images_negative[0][i], augmented_images_negative[1][i]))
-                    else:
-                        for i in range(len(augmented_images_negative[0])):
-                            class_2.append(data_processing.concat_channels(augmented_images_negative[0][i], augmented_images_negative[1][i], augmented_images_negative[2][i]))
-                    class_2 = np.array(class_2)
-                else:
-                    class_2 = augmented_images_negative
-
-                #Balance the class sizes
-                if self.balance:
-                    class_2 = class_2[:len(class_1)]     
-
-                if self.img_num_channels == 1:
-                    class_2 = resize(class_2, size=self.best_params['image_size'])
-                else:
-                    channel1 = resize(class_2[:,:,:,0], size=self.best_params['image_size'])
-                    channel2 = resize(class_2[:,:,:,1], size=self.best_params['image_size'])
-                    if self.img_num_channels == 2:
-                        class_2 = data_processing.concat_channels(channel1, channel2)
-                    else:
-                        channel3 = resize(class_2[:,:,:,2], size=self.best_params['image_size'])
-                        class_2 = data_processing.concat_channels(channel1, channel2, channel3)
-
-                if self.val_positive is not None:
-                    if self.img_num_channels == 1:
-                        val_class_1 = resize(self.val_positive, size=self.best_params['image_size'])
-                    else:
-                        val_channel1 = resize(self.val_positive[:,:,:,0], size=self.best_params['image_size'])
-                        val_channel2 = resize(self.val_positive[:,:,:,1], size=self.best_params['image_size'])
-                        if self.img_num_channels == 2:
-                            val_class_1 = data_processing.concat_channels(val_channel1, val_channel2)
-                        else:
-                            val_channel3 = resize(self.val_positive[:,:,:,2], size=self.best_params['image_size'])
-                            val_class_1 = data_processing.concat_channels(val_channel1, val_channel2, val_channel3)
-                else:
-                    val_class_1 = None
-
-                if self.val_negative is not None:
-                    if self.img_num_channels == 1:
-                        val_class_2 = resize(self.val_negative, size=self.best_params['image_size'])
-                    elif self.img_num_channels > 1:
-                        val_channel1 = resize(self.val_negative[:,:,:,0], size=self.best_params['image_size'])
-                        val_channel2 = resize(self.val_negative[:,:,:,1], size=self.best_params['image_size'])
-                        if self.img_num_channels == 2:
-                            val_class_2 = data_processing.concat_channels(val_channel1, val_channel2)
-                        else:
-                            val_channel3 = resize(self.val_negative[:,:,:,2], size=self.best_params['image_size'])
-                            val_class_2 = data_processing.concat_channels(val_channel1, val_channel2, val_channel3)
-                else:
-                    val_class_2 = None
-            else:
-                class_1, class_2 = self.positive_class, self.negative_class
-                val_class_1, val_class_2 = self.val_positive, self.val_negative
+        else:
+            data = self.data_x[:]
+            data[data>1e7], data[(data<1e-7)&(data>0)], data[data<-1e7] = 1e7, 1e-7, -1e7
 
-            if self.opt_model:
-                if self.best_params['optimizer'] != 'adam' and self.best_params['optimizer'] != 'adagrad':
-                    decay = self.best_params['decay']
-                    if self.best_params['optimizer'] == 'sgd':
-                        momentum = self.best_params['momentum']
-                        nesterov = self.best_params['nesterov']
-                    else:
-                        momentum, nesterov = 0.0, False
-                else:
-                    decay, momentum, nesterov = 0.0, 0.0, False
+        if self.feats_to_use is None:
+            self.feats_to_use, self.feature_history = borutashap_opt(data, self.data_y, boruta_trials=self.boruta_trials, model=self.boruta_model)
+            if len(self.feats_to_use) == 0:
+                print('No features selected, increase the number of n_trials when running pyBIA.optimization.borutashap_opt(). Using all features...')
+                self.feats_to_use = np.arange(data.shape[1])
+        else:
+            print('feats_to_use attribute already exists, skipping feature selection...')
 
-                if self.limit_search:
-                    self.model, self.history = AlexNet(class_1, class_2, img_num_channels=self.img_num_channels, 
-                        normalize=self.normalize, min_pixel=min_pix, max_pixel=max_pix, val_positive=val_class_1, val_negative=val_class_2, 
-                        epochs=self.train_epochs, batch_size=self.best_params['batch_size'], optimizer=self.best_params['optimizer'], 
-                        lr=self.best_params['lr'], momentum=momentum, decay=decay, nesterov=nesterov, loss=self.best_params['loss'], 
-                        model_reg=self.best_params['model_reg'], activation_conv=self.best_params['activation_conv'], activation_dense=self.best_params['activation_dense'], 
-                        pooling_1=self.best_params['pooling_1'], pooling_2=self.best_params['pooling_2'], pooling_3=self.best_params['pooling_3'],  
-                        conv_init=self.best_params['conv_init'], dense_init=self.best_params['dense_init'], conv_reg=self.best_params['conv_reg'], dense_reg=self.best_params['dense_reg'], 
-                        smote_sampling=self.smote_sampling, verbose=self.verbose)
-                else:
-                    self.model, self.history = AlexNet(class_1, class_2, img_num_channels=self.img_num_channels, 
-                        normalize=self.normalize, min_pixel=min_pix, max_pixel=max_pix, val_positive=val_class_1, val_negative=val_class_2, 
-                        epochs=self.train_epochs, batch_size=self.best_params['batch_size'], optimizer=self.best_params['optimizer'], lr=self.best_params['lr'], momentum=momentum, decay=decay, nesterov=nesterov, 
-                        loss=self.best_params['loss'], model_reg=self.best_params['model_reg'], activation_conv=self.best_params['activation_conv'], 
-                        activation_dense=self.best_params['activation_dense'], pooling_1=self.best_params['pooling_1'], pooling_2=self.best_params['pooling_2'], 
-                        pooling_3=self.best_params['pooling_3'], pool_size_1=self.best_params['pool_size_1'], pool_stride_1=self.best_params['pool_stride_1'], 
-                        pool_size_2=self.best_params['pool_size_2'], pool_stride_2=self.best_params['pool_stride_2'], pool_size_3=self.best_params['pool_size_3'], 
-                        pool_stride_3=self.best_params['pool_stride_3'], filter_1=self.best_params['filter_1'], filter_size_1=self.best_params['filter_size_1'], 
-                        strides_1=self.best_params['strides_1'], filter_2=self.best_params['filter_2'], filter_size_2=self.best_params['filter_size_2'], 
-                        strides_2=self.best_params['strides_2'], filter_3=self.best_params['filter_3'], filter_size_3=self.best_params['filter_size_3'], 
-                        strides_3=self.best_params['strides_3'], filter_4=self.best_params['filter_4'], filter_size_4=self.best_params['filter_size_4'], 
-                        strides_4=self.best_params['strides_4'], filter_5=self.best_params['filter_5'], filter_size_5=self.best_params['filter_size_5'], 
-                        strides_5=self.best_params['strides_5'], dense_neurons_1=self.best_params['dense_neurons_1'], dense_neurons_2=self.best_params['dense_neurons_2'], 
-                        dropout_1=self.best_params['dropout_1'], dropout_2=self.best_params['dropout_2'], conv_init=self.best_params['conv_init'], dense_init=self.best_params['dense_init'],
-                        conv_reg=self.best_params['conv_reg'], dense_reg=self.best_params['dense_reg'], smote_sampling=self.smote_sampling, verbose=self.verbose)
-            else: 
-                self.model, self.history = AlexNet(class_1, class_2, img_num_channels=self.img_num_channels, normalize=self.normalize,
-                    min_pixel=min_pix, max_pixel=max_pix, val_positive=val_class_1, val_negative=val_class_2, epochs=self.epochs, optimizer=self.best_params['optimizer'],
-                    smote_sampling=self.smote_sampling, verbose=self.verbose)
-       
-        return 
+        #Re-construct the imputer with the selected features as
+        #new predictions will only compute these metrics, need to fit again!
+        if self.imp_method == 'KNN':
+            data_x, self.imputer = KNN_imputation(data=self.data_x[:,self.feats_to_use], imputer=None)
+        else: 
+            data_x = self.data_x[:,self.feats_to_use]
+
+        if self.n_iter > 0:
+            self.model, self.best_params, self.optimization_results = hyper_opt(data_x, self.data_y, clf=self.clf, n_iter=self.n_iter, 
+                balance=self.balance, return_study=True, limit_search=self.limit_search, opt_cv=self.opt_cv)
+        else:
+            print("Fitting and returning final model...")
+            self.model = hyper_opt(data_x, self.data_y, clf=self.clf, n_iter=self.n_iter, 
+                balance=self.balance, return_study=True, limit_search=self.limit_search, opt_cv=self.opt_cv)
 
+        self.model.fit(data_x, self.data_y)
+        
     def save(self, dirname=None, path=None, overwrite=False):
         """
-        Saves the trained classifier in a new directory named 'pyBIA_models', 
-        as well as the imputer and the features to use, if applicable.
+        Saves the trained classifier in a new directory named 'pyBIA_ensemble_model', 
+        as well as the imputer and the features to use attributes, if not None.
         
         Args:
             dirname (str): The name of the directory where the model folder will be saved.
                 This directory will be created, and therefore if it already exists
                 in the system an error will appear.
             path (str): Absolute path where the data folder will be saved
                 Defaults to None, in which case the directory is saved to the
                 local home directory.
-            overwrite (bool, optional): If True the 'pyBIA_cnn_model' folder this
+            overwrite (bool, optional): If True the 'pyBIA_ensemble_model' folder this
                 function creates in the specified path will be deleted if it exists
                 and created anew to avoid duplicate files. 
         """
-
-        if self.model is None:
-            print('The model has not been created!')
+        if self.model is None and self.imputer is None and self.feats_to_use is None:
+            raise ValueError('The models have not been created! Run the create() method first.')
 
         if path is None:
             path = str(Path.home())
         if path[-1] != '/':
             path+='/'
 
         if dirname is not None:
@@ -398,130 +238,492 @@
             path = path+dirname
             try:
                 os.makedirs(path)
             except FileExistsError:
                 raise ValueError('The dirname folder already exists!')
 
         try:
-            os.mkdir(path+'pyBIA_cnn_model')
+            os.mkdir(path+'pyBIA_ensemble_model')
         except FileExistsError:
             if overwrite:
                 try:
-                    os.rmdir(path+'pyBIA_cnn_model')
+                    os.rmdir(path+'pyBIA_ensemble_model')
                 except OSError:
-                    for file in os.listdir(path+'pyBIA_cnn_model'):
-                        os.remove(path+'pyBIA_cnn_model/'+file)
-                    os.rmdir(path+'pyBIA_cnn_model')
-                os.mkdir(path+'pyBIA_cnn_model')
+                    for file in os.listdir(path+'pyBIA_ensemble_model'):
+                        os.remove(path+'pyBIA_ensemble_model/'+file)
+                    os.rmdir(path+'pyBIA_ensemble_model')
+                os.mkdir(path+'pyBIA_ensemble_model')
             else:
-                raise ValueError('Tried to create "pyBIA_cnn_model" directory in specified path but folder already exists! If you wish to overwrite set overwrite=True.')
+                raise ValueError('Tried to create "pyBIA_ensemble_model" directory in specified path but folder already exists! If you wish to overwrite set overwrite=True.')
         
-        path += 'pyBIA_cnn_model/'
-        if self.model is not None:      
-            np.savetxt(path+'model_acc', self.history.history['binary_accuracy'])
-            np.savetxt(path+'model_loss', self.history.history['loss'])
-            np.savetxt(path+'model_f1', self.history.history['f1_score'])
-            if self.val_positive is not None:
-                np.savetxt(path+'model_val_acc', self.history.history['val_binary_accuracy'])
-                np.savetxt(path+'model_val_loss', self.history.history['val_loss'])
-                np.savetxt(path+'model_val_f1', self.history.history['val_f1_score'])
-
-            save_model(self.model, path+'Keras_Model.h5')#,  custom_objects={'f1_score': f1_score})
-
-        if self.best_params is not None:
-            joblib.dump(self.best_params, path+'Best_Params')
+        path += 'pyBIA_ensemble_model/'
+        if self.model is not None:
+            joblib.dump(self.model, path+'Model')
+        if self.imputer is not None:
+            joblib.dump(self.imputer, path+'Imputer')
+        if self.feats_to_use is not None:
+            joblib.dump(self.feats_to_use, path+'Feats_Index')
         if self.optimization_results is not None:
             joblib.dump(self.optimization_results, path+'HyperOpt_Results')
+        if self.best_params is not None:
+            joblib.dump(self.best_params, path+'Best_Params')
+        if self.feature_history is not None:
+            joblib.dump(self.feature_history, path+'FeatureOpt_Results')
         print('Files saved in: {}'.format(path))
 
         self.path = path
 
         return 
 
     def load(self, path=None):
         """ 
         Loads the model, imputer, and feats to use, if created and saved.
         This function will look for a folder named 'pyBIA_models' in the
         local home directory, unless a path argument is set. 
 
         Args:
-            path (str): Path where the directory 'pyBIA_cnn_model' is saved. 
-            Defaults to None, in which case the folder is assumed to be in the 
-            local home directory.
+            path (str): Path where the directory 'pyBIA_models' is saved. 
+                Defaults to None, in which case the folder is assumed to be in the 
+                local home directory.
         """
 
         if path is None:
             path = str(Path.home())
         if path[-1] != '/':
             path+='/'
 
-        path += 'pyBIA_cnn_model/'
+        path += 'pyBIA_ensemble_model/'
 
         try:
-            self.model = load_model(path+'Keras_Model.h5', custom_objects={'f1_score': f1_score})
+            self.model = joblib.load(path+'Model')
             model = 'model'
-        except:
+        except FileNotFoundError:
             model = ''
             pass
 
         try:
-            self.optimization_results = joblib.load(path+'HyperOpt_Results')
-            optimization_results = ', optimization_results,'
-        except:
-            optimization_results = '' 
+            self.imputer = joblib.load(path+'Imputer')
+            imputer = ', imputer'
+        except FileNotFoundError:
+            imputer = ''
+            pass 
+
+        try:
+            self.feats_to_use = joblib.load(path+'Feats_Index')
+            feats_to_use = ', feats_to_use'
+        except FileNotFoundError:
+            feats_to_use = ''
             pass
 
         try:
             self.best_params = joblib.load(path+'Best_Params')
             best_params = ', best_params'
-        except:
-            best_params = '' 
-            pass        
+        except FileNotFoundError:
+            best_params = ''
+            pass
 
-        print('Successfully loaded the following class attributes: {}{}{}'.format(model, optimization_results, best_params))
+        try:
+            self.feature_history = joblib.load(path+'FeatureOpt_Results')
+            feature_opt_results = ', feature_selection_results'
+        except FileNotFoundError:
+            feature_opt_results = ''
+            pass
+
+        try:
+            self.optimization_results = joblib.load(path+'HyperOpt_Results')
+            optimization_results = ', optimization_results'
+        except FileNotFoundError:
+            optimization_results = '' 
+            pass
+
+        print('Successfully loaded the following class attributes: {}{}{}{}{}{}'.format(model, imputer, feats_to_use, best_params, feature_opt_results, optimization_results))
         
         self.path = path
-        
+
         return
 
-    def predict(self, data, target='ML', return_proba=False):
+    def predict(self, data):
         """
-        Returns the class prediction. The input can either be a single 2D array 
-        or a 3D array if there are multiple samples.
+        Predics the class label of new, unseen data.
 
         Args:
-            data: 2D array for single image, 3D array for multiple images.
-            target (str): The name of the target class, assuming binary classification in 
-                which there is an 'OTHER' class. Defaults to 'ML'. 
-            return_proba (bool): If True the output will return the probability prediction.
-                Defaults to False. 
+            data (ndarray): 2D array of size (n x m), where n is the
+                number of samples, and m the number of features.
 
         Returns:
-            The class prediction(s).
+            2D array containing the classes and the corresponding probability prediction
         """
-      
-        data = process_class(data, normalize=self.normalize, min_pixel=self.min_pixel, max_pixel=self.max_pixel, img_num_channels=self.img_num_channels)
-        predictions = self.model.predict(data)
 
-        output, probas = [], [] 
-        for i in range(len(predictions)):
-            if np.argmax(predictions[i]) == 1:
-                prediction = target
-                probas.append(predictions[i][1])
+        data[data>1e7], data[(data<1e-7)&(data>0)], data[data<-1e7] = 1e7, 1e-7, -1e7
+        classes = self.model.classes_
+        output = []
+
+        if self.imputer is None and self.feats_to_use is None:
+            proba = self.model.predict_proba(data)
+            for i in range(len(proba)):
+                index = np.argmax(proba[i])
+                output.append([classes[index], proba[i][index]])
+            return np.array(output)
+
+        if self.feats_to_use is not None:
+            if len(data.shape) == 1:
+                data = data[self.feats_to_use].reshape(1,-1)
             else:
-                prediction = 'OTHER'
-                probas.append(predictions[i][0])
+                data = data[:,self.feats_to_use]
+                
+            if self.imputer is not None:
+                data = self.imputer.transform(data)
 
-            output.append(prediction)
+            proba = self.model.predict_proba(data)
 
-        if return_proba:
-            output = np.c_[output, probas]
+            for i in range(len(proba)):
+                index = np.argmax(proba[i])
+                output.append([classes[index], proba[i][index]])
+            return np.array(output)
+
+        if self.imputer is not None:
+            data = self.imputer.transform(data)
+
+        proba = self.model.predict_proba(data)
+        for i in range(len(proba)):
+            index = np.argmax(proba[i])
+            output.append([classes[index], proba[i][index]])
             
         return np.array(output)
 
+    def plot_tsne(self, data_y=None, special_class=None, norm=True, pca=False, 
+        legend_loc='upper center', title='Feature Parameter Space', savefig=False):
+        """
+        Plots a t-SNE projection using the sklearn.manifold.TSNE() method.
+
+        Note:
+            To highlight individual samples, use the data_y optional input
+            and set that sample's data_y value to a unique name, and set that 
+            same label in the special_class variable so that it can be visualized 
+            clearly.
+
+        Args:
+            data_y (ndarray, optional): A custom labels array, that coincides with
+                the labels in model.data_y. Defaults to None, in which case the
+                model.data_y labels are used.
+            special_class (optional): The class label that you wish to highlight,
+                setting this optional parameter will increase the size and alpha parameter
+                for these points in the plot.
+            norm (bool): If True the data will be min-max normalized. Defaults
+                to True.
+            pca (bool): If True the data will be fit to a Principal Component
+                Analysis and all of the corresponding principal components will 
+                be used to generate the t-SNE plot. Defaults to False.
+            legend_loc (str): Location of legend, using matplotlib style.
+            title (str): Title of the figure.
+            savefig (bool): If True the figure will not disply but will be saved instead.
+                Defaults to False. 
+
+        Returns:
+            AxesImage. 
+        """
+
+        if self.feats_to_use is not None:
+            if len(self.data_x.shape) == 1:
+                data = self.data_x[self.feats_to_use].reshape(1,-1)
+            else:
+                data = self.data_x[:,self.feats_to_use]
+        else:
+            data = self.data_x[:]
+
+        if np.any(np.isnan(data)):
+            #print('Automatically imputing NaN values with KNN imputation...')
+            if self.imputer is not None and self.imp_method == 'KNN':
+                data = KNN_imputation(data=data, imputer=self.imputer)
+            else:
+                data = KNN_imputation(data=data)[0]
+
+        data[data>1e7], data[(data<1e-7)&(data>0)], data[data<-1e7] = 1e7, 1e-7, -1e7
+        
+        if len(data) > 5e3:
+            method = 'barnes_hut' #Scales with O(N)
+        else:
+            method = 'exact' #Scales with O(N^2)
+
+        if norm:
+            scaler = MinMaxScaler()
+            data = scaler.fit_transform(data)
+
+        if pca:
+            pca_transformation = decomposition.PCA(n_components=data.shape[1], whiten=True, svd_solver='auto')
+            pca_transformation.fit(data) 
+            data = pca_transformation.transform(data)
+
+        feats = TSNE(n_components=2, method=method, learning_rate=1000, 
+            perplexity=35, init='random').fit_transform(data)
+        x, y = feats[:,0], feats[:,1]
+     
+        markers = ['o', 's', '+', 'v', '.', 'x', 'h', 'p', '<', '>', '*']
+        #color = ['b', 'g', 'r', 'c', 'm', 'y', 'k', 'b', 'g', 'r', 'c']
+        color = ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#e41a1c', '#377eb8'] #Update the last two!
+
+        if data_y is None:
+            if self.data_y_ is None:
+                if self.csv_file is None:
+                    if data_y is None:
+                        data_y = self.data_y
+                        feats = np.unique(self.data_y)
+                    else:
+                        if isinstance(data_y, np.ndarray) is False: 
+                            if type(data_y) == list:
+                                data_y = np.array(data_y)
+                            else:
+                                raise ValueError('data_y argument must either be a list or an array!')
+                        feats = np.unique(data_y)
+                else:
+                    data_y = np.array(self.csv_file.label)
+                    feats = np.unique(data_y)
+            else:
+                data_y = self.data_y_ 
+                feats = np.unique(self.data_y_)
+        else:
+            if isinstance(data_y, list):
+                data_y = np.array(data_y)
+            feats = np.unique(data_y) 
+
+        for count, feat in enumerate(feats):
+            if count+1 > len(markers):
+                count = -1
+            mask = np.where(data_y == feat)[0]
+            if feat == special_class:
+                pass
+            else:
+                plt.scatter(x[mask], y[mask], marker=markers[count], c=color[count], label=str(feat), alpha=0.44)
+
+        if special_class is not None:
+            mask = np.where(data_y == special_class)[0]
+            if len(mask) == 0:
+                raise ValueError('The data_y array does not contain the value input in the special_class parameter.')
+            plt.scatter(x[mask], y[mask], marker='*', c='red', label=special_class, s=200, alpha=1.0)
+        
+        plt.legend(loc=legend_loc, ncol=len(np.unique(data_y)), frameon=False, handlelength=2)#prop={'size': 14}
+        plt.title(title)#, size=18)
+        plt.xticks()#fontsize=14)
+        plt.yticks()#fontsize=14)
+        plt.ylabel('t-SNE Dimension 1')
+        plt.xlabel('t-SNE Dimension 2')
+
+        if savefig:
+            _set_style_()
+            plt.savefig('tSNE_Projection.png', bbox_inches='tight', dpi=300)
+            plt.clf(); plt.style.use('default')
+        else:
+            plt.show()
+
+    def plot_conf_matrix(self, data_y=None, norm=False, pca=False, k_fold=10, normalize=True, 
+        title='Confusion Matrix', savefig=False):
+        """
+        Returns a confusion matrix with k-fold validation.
+
+        Args:
+            data_y (ndarray, str, optional): 1D array containing the corresponing labels.
+                Only use if using XGB algorithm as this method converts labels to numerical,
+                in which case it may be desired to input the original label array using
+                this parameter. Defaults to None, which uses the data_y attribute.
+            norm (bool): If True the data will be min-max normalized. Defaults
+                to False. NOTE: Set this to True if pca=True.
+            pca (bool): If True the data will be fit to a Principal Component
+                Analysis and all of the corresponding principal components will 
+                be used to evaluate the classifier and construct the matrix. 
+                Defaults to False.
+            k_fold (int, optional): The number of cross-validations to perform.
+                The output confusion matrix will display the mean accuracy across
+                all k_fold iterations. Defaults to 10.
+            normalize (bool, optional): If False the confusion matrix will display the
+                total number of objects in the sample. Defaults to True, in which case
+                the values are normalized between 0 and 1.
+            title (str): Title of the figure.
+            savefig (bool): If True the figure will not disply but will be saved instead.
+                Defaults to False. 
+        Returns:
+            AxesImage.
+        """
+
+        if self.data_x is None or self.data_y is None:
+            raise ValueError('Input data_x and data_y!')
+        if self.model is None:
+            raise ValueError('No model has been created! Run .create() first.')
+
+        if data_y is not None:
+            classes = [str(label) for label in np.unique(data_y)]
+        else:
+            if self.data_y_ is None:
+                if self.csv_file is None:
+                    classes = [str(label) for label in np.unique(self.data_y)]
+                else:
+                    classes = [str(label) for label in np.unique(np.array(self.csv_file.label))]
+            else:
+                classes = [str(label) for label in np.unique(self.data_y_)]
+
+        if self.feats_to_use is not None:
+            if len(self.data_x.shape) == 1:
+                data = self.data_x[self.feats_to_use].reshape(1,-1)
+            else:
+                data = self.data_x[:,self.feats_to_use]
+        else:
+            data = self.data_x[:]
+
+        if np.any(np.isnan(data)):
+            #print('Automatically imputing NaN values with KNN imputation...')
+            if self.imputer is not None and self.imp_method == 'KNN':
+                data = KNN_imputation(data=data, imputer=self.imputer)
+            else:
+                data = KNN_imputation(data=data)[0]
+
+        data[data>1e7], data[(data<1e-7)&(data>0)], data[data<-1e7] = 1e7, 1e-7, -1e7
+
+        if norm:
+            scaler = MinMaxScaler()
+            scaler.fit_transform(data)
+
+        if pca:
+            pca_transformation = decomposition.PCA(n_components=data.shape[1], whiten=True, svd_solver='auto')
+            pca_transformation.fit(data) 
+            pca_data = pca_transformation.transform(data)
+            data = np.asarray(pca_data).astype('float64')
+
+        predicted_target, actual_target = evaluate_model(self.model, data, self.data_y, normalize=normalize, k_fold=k_fold)
+        generate_matrix(predicted_target, actual_target, normalize=normalize, classes=classes, title=title, savefig=savefig)
+
+    def plot_roc_curve(self, k_fold=10, pca=False, title="Receiver Operating Characteristic Curve", 
+        savefig=False):
+        """
+        Plots ROC curve with k-fold cross-validation, as such the 
+        standard deviation variations are also plotted.
+        
+        Args:
+            classifier: The machine learning classifier to optimize.
+            data_x (ndarray): 2D array of size (n x m), where n is the
+                number of samples, and m the number of features.
+            data_y (ndarray, str): 1D array containing the corresponing labels.
+            k_fold (int, optional): The number of cross-validations to perform.
+                The output confusion matrix will display the mean accuracy across
+                all k_fold iterations. Defaults to 10.
+            title (str, optional): The title of the output plot.
+            savefig (bool): If True the figure will not disply but will be saved instead.
+                Defaults to False. 
+        
+        Returns:
+            AxesImage
+        """
+        if self.model is None:
+            raise ValueError('No model has been created! Run model.create() first.')
+
+        if self.feats_to_use is not None:
+            if len(self.data_x.shape) == 1:
+                data = self.data_x[self.feats_to_use].reshape(1,-1)
+            else:
+                data = self.data_x[:,self.feats_to_use]
+        else:
+            data = self.data_x[:]
+
+        if np.any(np.isnan(data)):
+            print('Automatically imputing NaN values with KNN imputation...')
+            if self.imputer is not None and self.imp_method == 'KNN':
+                data = KNN_imputation(data=data, imputer=self.imputer)
+            else:
+                data = KNN_imputation(data=data)[0]
+
+        data[data>1e7], data[(data<1e-7)&(data>0)], data[data<-1e7] = 1e7, 1e-7, -1e7
+
+        if pca:
+            pca_transformation = decomposition.PCA(n_components=data.shape[1], whiten=True, svd_solver='auto')
+            pca_transformation.fit(data) 
+            pca_data = pca_transformation.transform(data)
+            data = np.asarray(pca_data).astype('float64')
+        
+        model0 = self.model
+        if len(np.unique(self.data_y)) != 2:
+            X_train, X_test, y_train, y_test = train_test_split(data, self.data_y, test_size=0.2, random_state=0)
+            model0.fit(X_train, y_train)
+            y_probas = model0.predict_proba(X_test)
+            skplt.metrics.plot_roc(y_test, y_probas, text_fontsize='large', title='ROC Curve', cmap='cividis', plot_macro=False, plot_micro=False)
+            plt.show()
+            return
+
+        cv = StratifiedKFold(n_splits=k_fold)
+        
+        tprs = []
+        aucs = []
+        mean_fpr = np.linspace(0, 1, 100)
+
+        train = data
+        fig, ax = plt.subplots()
+
+        for i, (data_x, test) in enumerate(cv.split(train, self.data_y)):
+            model0.fit(train[data_x], self.data_y[data_x])
+            viz = RocCurveDisplay.from_estimator(
+                model0,
+                train[test],
+                self.data_y[test],
+                alpha=0,#0.3,
+                lw=1,
+                ax=ax,
+                name="ROC fold {}".format(i+1),
+            )
+            interp_tpr = np.interp(mean_fpr, viz.fpr, viz.tpr)
+            interp_tpr[0] = 0.0
+            tprs.append(interp_tpr)
+            aucs.append(viz.roc_auc)
+
+        mean_tpr = np.mean(tprs, axis=0)
+        mean_tpr[-1] = 1.0
+        mean_auc = auc(mean_fpr, mean_tpr)
+        std_auc = np.std(aucs)
+        lns1, = ax.plot(
+            mean_fpr,
+            mean_tpr,
+            color="b",
+            #label=r"Mean ROC (AUC = %0.2f $\pm$ %0.2f)" % (mean_auc, std_auc),
+            label=r"Mean (AUC = %0.2f)" % (mean_auc),
+            lw=2,
+            alpha=0.8,
+        )
+
+        std_tpr = np.std(tprs, axis=0)
+        tprs_upper = np.minimum(mean_tpr + std_tpr, 1)
+        tprs_lower = np.maximum(mean_tpr - std_tpr, 0)
+        lns_sigma = ax.fill_between(
+            mean_fpr,
+            tprs_lower,
+            tprs_upper,
+            color="grey",
+            alpha=0.2,
+            label=r"$\pm$ 1$\sigma$",
+        )
+
+        ax.set(
+            xlim=[0, 1.0],
+            ylim=[0.0, 1.0],
+            title="Receiver Operating Characteristic Curve",
+        )
+        
+        lns2, = ax.plot([0, 1], [0, 1], linestyle="--", lw=2, color="r", label="Random (AUC=0.5)", alpha=0.8)
+
+        #handles, labels = ax.get_legend_handles_labels()
+        #ax.legend(handles[-3:], labels[-3:], loc="lower center", ncol=3, frameon=False, handlelength=2)
+        ax.legend([lns2, (lns1, lns_sigma)], ['Random (AUC = 0.5)', r"Mean (AUC = %0.2f)" % (mean_auc)], loc='lower center', ncol=2, frameon=False, handlelength=2)
+
+        ax.set_facecolor("white")
+        plt.ylabel('True Positive Rate')#, size=14)
+        plt.xlabel('False Positive Rate')#, size=14)
+        plt.title(label=title)#,fontsize=18)
+
+        if savefig:
+            _set_style_()
+            plt.savefig('Ensemble_ROC_Curve.png', bbox_inches='tight', dpi=300)
+            plt.clf(); plt.style.use('default')
+        else:
+            plt.show()
+
     def plot_hyper_opt(self, baseline=None, xlim=None, ylim=None, xlog=True, ylog=False, 
         savefig=False):
         """
         Plots the hyperparameter optimization history.
     
         Args:
             baseline (float): Baseline accuracy achieved when using only
@@ -537,21 +739,19 @@
             savefig (bool): If True the figure will not disply but will be saved instead.
                 Defaults to False. 
 
         Returns:
             AxesImage
         """
 
+        #fig = plot_optimization_history(self.optimization_results)
         trials = self.optimization_results.get_trials()
         trial_values, best_value = [], []
         for trial in range(len(trials)):
-            try:
-                value = trials[trial].values[0]
-            except TypeError:
-                value = np.min(trial_values) 
+            value = trials[trial].values[0]
             trial_values.append(value)
             if trial == 0:
                 best_value.append(value)
             else:
                 if any(y > value for y in best_value): #If there are any numbers in best values that are higher than current one
                     best_value.append(np.array(best_value)[trial-1])
                 else:
@@ -567,30 +767,23 @@
 
         if baseline is not None:
             plt.axhline(y=baseline, color='k', linestyle='--', label='Baseline Model')
             ncol=3
         else:
             ncol=2
 
-        if self.metric == 'val_accuracy':
-            ylabel = 'Validation Accuracy'
-        elif self.metric == 'accuracy':
-            ylabel = 'Training Accuracy'
-        elif self.metric == 'val_loss':
-            ylabel = '1 - Validation Loss'
-        elif self.metric == 'loss':
-            ylabel = '1 - Training Loss'
-        else:
-            ylabel = 'Optimization Metric'
-
         plt.plot(range(len(trials)), best_value, color='r', alpha=0.83, linestyle='-', label='Best Model')
         plt.scatter(range(len(trials)), trial_values, c='b', marker='+', s=35, alpha=0.45, label='Trial')
         plt.xlabel('Trial #', alpha=1, color='k')
-        plt.ylabel(ylabel, alpha=1, color='k')
-        plt.title('CNN Hyperparameter Optimization')#, size=18) Make this a f" string option!!
+        plt.ylabel('Accuracy', alpha=1, color='k')
+       # if self.clf == 'xgb':
+        plt.title('Hyperparameter Optimization')#, size=18) Make this a f" string option!!
+        #plt.xticks(fontsize=14)#, color='k')
+        #plt.yticks(fontsize=14)#, color='k')
+        #plt.grid(True, color='k', alpha=0.35, linewidth=1.5, linestyle='--')
         plt.grid(False)
         if xlim is not None:
             plt.xlim(xlim)
         else:
             plt.xlim((1, len(trials)))
         if ylim is not None:
             plt.ylim(ylim)
@@ -600,16 +793,199 @@
             plt.yscale('log')
         #plt.tight_layout()
         #plt.legend(prop={'size': 12}, loc='upper left')
         plt.legend(loc='upper center', ncol=ncol, frameon=False)#, handlelength=4)#prop={'size': 14}
         plt.rcParams['axes.facecolor']='white'
         
         if savefig:
-            plt.savefig('CNN_Hyperparameter_Optimization.png', bbox_inches='tight', dpi=300)
-            plt.clf()
+            _set_style_()
+            plt.savefig('Ensemble_Hyperparameter_Optimization.png', bbox_inches='tight', dpi=300)
+            plt.clf(); plt.style.use('default')
+        else:
+            plt.show()
+
+    def plot_feature_opt(self, feat_names=None, top='all', include_other=True, include_shadow=True, 
+        include_rejected=False, flip_axes=True, save_data=False, savefig=False):
+        """
+        Returns whisker plot displaying the z-score distribution of each feature
+        across all trials.
+    
+        Note:
+            The following can be used to output the plot from the original BorutaShap API.
+
+            model.feature_history.plot(which_features='accepted', X_size=14)
+
+            Can designate to display either 'all', 'accepted', or 'tentative'
+
+        Args: 
+            feat_names (ndarry, optional): A list or array containing the names
+                of the features in the data_x matrix, in order. Defaults to None,
+                in which case the respective indices will appear instead.
+            top (float, optional): Designates how many features to plot. If set to 3, it 
+                will plot the top 3 performing features. Can be 'all' in which casee all features
+                that were accepted are plotted. Defaults to 'all'.
+            include_other (bool): Whether to include the features that are not in the top designation,
+                if True these features will be averaged out and displayed. Defaults to True.
+            include_shadow (bool): Whether to include the max shadow feature that was used as a 
+                baseline for 'random' behavior. Defaults to True.
+            include_rejected (bool): Whether to include the rejected features, if True these features 
+                will be averaged out and displayed.
+            flip_axes (bool): Whether transpose the figure. Defaults to True.
+            save_data (bool): Whether to save the feature importances as a csv file, defaults to False.
+            savefig (bool): If True the figure will not disply but will be saved instead.
+                Defaults to False. 
+
+        Returns:
+            AxesImage
+        """
+
+        fname = str(Path.home())+'/__borutaimportances__' #Temporary file
+        try:
+            self.feature_history.results_to_csv(filename=fname)
+        except AttributeError:
+            raise ValueError('No optimization history found for feature selection, run .create() with optimize=True!')
+
+        csv_data = pd.read_csv(fname+'.csv')
+        #os.remove(fname+'.csv')
+        accepted_indices = np.where(csv_data.Decision == 'Accepted')[0]
+        if top == 'all':
+            top = len(accepted_indices)
+        else:
+            if top > len(accepted_indices):
+                top = len(accepted_indices)
+                print('The top parameter exceeds the number of accepted variables, setting to the maximum value of {}'.format(str(top)))
+
+        x, y, y_err = [], [], []
+
+        for i in accepted_indices[:top]:
+            if feat_names is None:
+                if self.csv_file is None:
+                    x.append(int(i))
+                else:
+                    x.append(int(csv_data.iloc[i].Features))
+            else:
+                x.append(int(csv_data.iloc[i].Features))
+            y.append(float(csv_data.iloc[i]['Average Feature Importance']))
+            y_err.append(float(csv_data.iloc[i]['Standard Deviation Importance']))
+            
+        if len(accepted_indices) == top:
+            include_other = False
+
+        if include_other:
+            mean, std = [], []
+            for j in accepted_indices[top:]:
+                mean.append(float(csv_data.iloc[j]['Average Feature Importance']))
+                std.append(float(csv_data.iloc[j]['Standard Deviation Importance']))
+            x.append(0), y.append(np.mean(mean)), y_err.append(np.mean(std))
+
+        if include_shadow:
+            ix = np.where(csv_data.Features == 'Max_Shadow')[0]
+            y.append(float(csv_data.iloc[ix]['Average Feature Importance']))
+            y_err.append(float(csv_data.iloc[ix]['Standard Deviation Importance']))
+            x.append(int(ix))
+
+        if feat_names is not None:  
+            if isinstance(feat_names, np.ndarray) is False: 
+                feat_names = np.array(feat_names)
+            if include_shadow is False:
+                if include_other is False:
+                    x_names = feat_names[x] #By default x is the index of the feature
+                else:
+                    x_names = np.r_[feat_names[x[:-1]], ['Other Accepted']]
+            else:
+                if include_other is False:
+                    x_names = np.r_[feat_names[x[:-1]], ['Max Shadow']]
+                else:
+                    x_names = np.r_[feat_names[x[:-2]], ['Other Accepted'], ['Max Shadow']]
+        else:
+            if self.csv_file is None:
+                if include_other is False:
+                    if include_shadow is False:
+                        x_names = csv_data.iloc[x].Features
+                    else:
+                        x_names = np.r_[csv_data.iloc[x[:-1]].Features, ['Max Shadow']]
+                else:
+                    if include_shadow is False:
+                        x_names = np.r_[csv_data.iloc[x[:-1]].Features, ['Max Shadow']]
+                    else:
+                        x_names = np.r_[csv_data.iloc[x[:-2]].Features, ['Other Accepted'], ['Max Shadow']]
+            else:
+                if include_other is False:
+                    if include_shadow is False:
+                        x_names = self.csv_file.columns[x[:-1]]
+                    else:
+                        x_names = np.r_[self.csv_file.columns[x[:-1]], ['Max Shadow']]
+                else:
+                    if include_shadow is False:
+                        x_names = np.r_[self.csv_file.columns[x[:-1]], ['Max Shadow']]
+                    else:
+                        x_names = np.r_[self.csv_file.columns[x[:-2]], ['Other Accepted'], ['Max Shadow']]
+
+        if include_rejected:
+            x = []
+            rejected_indices = np.where(csv_data.Decision == 'Rejected')[0]
+            for i in rejected_indices:
+                if feat_names is None:
+                    if self.csv_file is None:
+                        x.append(int(i))
+                    else:
+                        x.append(int(csv_data.iloc[i].Features))
+                else:
+                    x.append(int(csv_data.iloc[i].Features))
+                y.append(float(csv_data.iloc[i]['Average Feature Importance']))
+                y_err.append(float(csv_data.iloc[i]['Standard Deviation Importance']))
+
+            if feat_names is None:
+                if self.csv_file is None:
+                    x_names = np.r_[x_names, csv_data.iloc[x].Features]
+                else:
+                    x_names = np.r_[x_names, self.csv_file.columns[x]]
+            else:
+                x_names = np.r_[x_names, feat_names[x]]
+        
+        y, y_err = np.array(y), np.array(y_err)
+        fig, ax = plt.subplots()
+        if flip_axes:
+            lns, = ax.plot(y, np.arange(len(x_names)), 'k*--', lw=0.77)
+            lns_sigma = ax.fill_betweenx(np.arange(len(x_names)), y-y_err, y+y_err, color="grey", alpha=0.2)
+            ax.set_xlabel('Z Score', alpha=1, color='k')
+            ax.set_yticks(np.arange(len(x_names)), x_names)#, rotation=90)
+            for t in ax.get_yticklabels():
+                txt = t.get_text()
+                if 'Max Shadow' in txt:
+                    t.set_color('red')
+                    if include_rejected is False:
+                        ax.plot(y[-1], np.arange(len(x_names))[-1], marker='*', color='red')
+                    else:
+                        idx = 1 + len(rejected_indices)
+                        ax.plot(y[-idx], np.arange(len(x_names))[-idx], marker='*', color='red')
+
+            ax.set_ylim((np.arange(len(x_names))[0]-0.5, np.arange(len(x_names))[-1]+0.5))
+            ax.set_xlim((np.min(y)-1, np.max(y)+1))
+            ax.invert_yaxis(), ax.invert_xaxis()
+        else:
+            lns, = ax.plot(np.arange(len(x_names)), y, 'k*--', lw=0.77)#, label='XGBoost', lw=0.77)
+            lns_sigma = ax.fill_between(np.arange(len(x_names)), y-y_err, y+y_err, color="grey", alpha=0.2)
+            ax.set_ylabel('Z Score', alpha=1, color='k')
+            ax.set_xticks(np.arange(len(x_names)), x_names, rotation=90)
+            for t in ax.get_xticklabels():
+                txt = t.get_text()
+                if 'Max Shadow' in txt:
+                    t.set_color('red')
+                    ax.plot(np.arange(len(x_names))[-1], y[-1], marker='*', color='red')
+            ax.set_xlim((np.arange(len(x_names))[0]-0.5, np.arange(len(x_names))[-1]+0.5))
+            ax.set_ylim((np.min(y)-1, np.max(y)+1))
+
+        ax.set_title('Feature Importance')#, size=18)
+        ax.legend([(lns, lns_sigma)], [r'$\pm$ 1$\sigma$'], loc='upper right', ncol=1, frameon=False, handlelength=2)
+
+        if savefig:
+            _set_style_()
+            plt.savefig('Feature_Importance.png', bbox_inches='tight', dpi=300)
+            plt.clf(); plt.style.use('default')
         else:
             plt.show()
 
     def plot_hyper_param_importance(self, plot_time=True, savefig=False):
         """
         Plots the hyperparameter optimization history.
     
@@ -659,19 +1035,20 @@
         ax.set_xscale('log')
         plt.gca().invert_yaxis()
         plt.xlim((0, 1.))#np.max(importance+duration_importance)))#np.max(importance+duration_importance)))
         #fig = plot_param_importances(self.optimization_results)
         #fig = plot_param_importances(self.optimization_results, target=lambda t: t.duration.total_seconds(), target_name="duration")
         #plt.tight_layout()
         if savefig:
+            _set_style_()
             if plot_time:
-                plt.savefig('CNN_Hyperparameter_Importance.png', bbox_inches='tight', dpi=300)
+                plt.savefig('Ensemble_Hyperparameter_Importance.png', bbox_inches='tight', dpi=300)
             else:
-                plt.savefig('CNN_Hyperparameter_Duration_Importance.png', bbox_inches='tight', dpi=300)
-            plt.clf()
+                plt.savefig('Ensemble_Hyperparameter_Duration_Importance.png', bbox_inches='tight', dpi=300)
+            plt.clf(); plt.style.use('default')
         else:
             plt.show()
 
     def save_hyper_importance(self):
         """
         Calculates and saves binary files containing
         dictionaries with importance information, one
@@ -681,15 +1058,15 @@
             This procedure is time-consuming but must be run once before
             plotting the importances. This function will save
             two files in the model folder for future use. 
 
         Returns:
             Saves two binary files, importance and duration importance.
         """
-
+        
         print('Calculating and saving importances, this could take up to an hour...')
 
         try:
             if isinstance(self.path, str):
                 path = self.path  
             else:
                 path = str(Path.home())
@@ -705,554 +1082,224 @@
         
         print(f"Files saved in: {path}")
 
         self.path = path
 
         return  
 
-    def plot_performance(self, metric='binary_accuracy', combine=False, ylabel=None, title=None,
-        xlim=None, ylim=None, xlog=False, ylog=True, savefig=False):
-        """
-        Plots the training/performance histories.
-    
-        Args:
-            metric (str): Metric to plot, options are: 'binary_accuracy', 'f1_score', 'loss'. Defaults to 'binary_accuracy'
-            combine (bool): If True the validation history will also be included, if applicable.
-            ylabel (str, optional): The y-label of the plot.
-            title (str, optional): The title of the plot.
-            xlim (tuple, optional): The xlim range, matplotlib style.
-            ylim (tuple, optional): The ylim range, matplotlib style.
-            xlog (bool): Whether to log-scale the x-axis. Defaults to False.
-            ylog (bool): Whether to log-scale the y-axis. Defaults to False.
-            savefig (bool): If True the figure will not disply but will be saved instead. Defaults to False. 
-
-        Returns:
-            AxesImage
-        """
-
-        metric1 = np.loadtxt(self.path+'model_'+metric)
-
-        if combine:
-            if 'val' not in metric:
-                metric2 = np.loadtxt(self.path+'model_val_'+metric)
-                label1, label2 = 'Training', 'Validation'
-            else:
-                metric2 = np.loadtxt(self.path+'model_'+metric)
-                label1, label2 = 'Validation', 'Training'
-        else:
-            if 'val' not in metric:
-                label1 = 'Training'
-            else:
-                label1 = 'Validation'
-
-        plt.plot(range(1, len(metric1)+1), metric1, color='r', alpha=0.83, linestyle='-', label=label1)
-        if combine:
-            plt.plot(range(1, len(metric2)+1), metric2, color='b', alpha=0.83, linestyle='--', label=label2)
-
-        if ylabel is None:
-            ylabel = metric
-        if title is None:
-            title = metric
-
-        plt.ylabel(ylabel, alpha=1, color='k')
-        plt.title(title)
-        plt.xlabel('Epoch', alpha=1, color='k'), plt.grid(False)
-        if xlim is not None:
-            plt.xlim(xlim)
-        else:
-            plt.xlim((1, len(metric1)))
-        if ylim is not None:
-            plt.ylim(ylim)
-        if xlog:
-            plt.xscale('log')
-        if ylog:
-            plt.yscale('log')
-        plt.legend(loc='upper center', frameon=False) #ncol
-        plt.rcParams['axes.facecolor']='white'
-        
-        if savefig:
-            plt.savefig('CNN_Training_History_'+metric+'.png', bbox_inches='tight', dpi=300)
-            plt.clf()
-        else:
-            plt.show()
-
-
-def AlexNet(positive_class, negative_class, img_num_channels=1, normalize=True, 
-        min_pixel=0, max_pixel=100, val_positive=None, val_negative=None, epochs=100, 
-        batch_size=32, lr=0.0001, momentum=0.9, decay=0.0, nesterov=False, 
-        loss='binary_crossentropy', conv_init='uniform_scaling', dense_init='TruncatedNormal',
-        activation_conv='relu', activation_dense='relu', model_reg='local_response', padding='same', 
-        pooling_1='max', pooling_2='max', pooling_3='max', pool_size_1=3, pool_stride_1=2, pool_size_2=3, 
-        pool_stride_2=2, pool_size_3=3, pool_stride_3=2, filter_1=96, filter_size_1=11, strides_1=4, 
-        filter_2=256, filter_size_2=5, strides_2=1, filter_3=384, filter_size_3=3, strides_3=1, filter_4=384, 
-        filter_size_4=3, strides_4=1, filter_5=256, filter_size_5=3, strides_5=1, dense_neurons_1=4096, 
-        dense_neurons_2=4096, dropout_1=0.5, dropout_2=0.5, conv_reg=0, dense_reg=0, optimizer='sgd', 
-        smote_sampling=0, early_stop_callback=None, checkpoint=False, verbose=1):
-        """
-        The CNN model infrastructure presented by the 2012 ImageNet Large Scale 
-        Visual Recognition Challenge, AlexNet. Parameters were adapted for
-        our astronomy case of detecting diffuse emission.
-
-        To avoid exploding gradients we need to normalize our pixels to be 
-        between 0 and 1. By default normalize=True, which will perform
-        min-max normalization using the min_pixel and max_pixel arguments, 
-        which should be set carefully.
-
-        Note:
-            SMOTE expects a 2D input array that represents the feature space of the minority class. 
-            In the case of image classification, the feature space is usually flattened to a 1D vector 
-            for each image. This means that each row of the 2D input array represents a single image 
-            from the minority class, and each column represents a feature (pixel) of that image.
-
-            SMOTE expects a 2D input array because it works by computing the k-nearest neighbors of each minority 
-            class sample in the feature space and generating synthetic samples by interpolating between those neighbors.
-
-            By working in the feature space, SMOTE is able to generate synthetic samples that are similar 
-            to the existing minority class samples, and therefore more representative of the true distribution 
-            of the minority class. The resulting synthetic samples can then be added to the training set to 
-            balance the class distribution.
-
-            Once SMOTE has generated the synthetic samples, the 2D array can be reshaped back into its 
-            original image format to be used as input to a CNN model.
-
-        Args:
-            positive_class (ndarray): 3D array containing more than one image of diffuse objects.
-            negative_class (ndarray): 3D array containing more than one image of non-diffuse objects.
-            img_num_channels (int): The number of filters used. Defaults to 1, as pyBIA version 1
-                has been trained with only blue broadband data.
-            normalize (bool, optional): If True the data will be min-max normalized using the 
-                input min and max pixels. Defaults to True.
-            min_pixel (int, optional): The minimum pixel count, defaults to 638. 
-                Pixels with counts below this threshold will be set to this limit.
-            max_pixel (int, optional): The maximum pixel count, defaults to 3000. 
-                Pixels with counts above this threshold will be set to this limit.
-            val_positive (array, optional): 3D matrix containing the 2D arrays (images)
-                to be used for validationm, for the positive class. Defaults to None.
-            val_negative(array, optional): 3D matrix containing the 2D arrays (images)
-                to be used for validationm, for the negative class. Defaults to None.
-            epochs (int): Number of epochs used for training. 
-            batch_size (int): The size of each sub-sample used during the training
-                epoch. Large batches are likely to get stuck in local minima. Defaults to 32.
-            lr (float): Learning rate, the rate at which the model updates the gradient. Defaults to 0.0001
-            momentum (float): Momentum is a float greater than 0 that accelerates gradient descent. Defaults to 0.9.
-            decay (float): The rate of learning rate decay applied after each epoch. Defaults to 0.0005. It is recommended
-                to set decay to the learning rate divded by the total number of epochs.
-            nesterov (bool): Whether to apply Nesterov momentum or not. Defaults to False.
-            loss (str): The loss function used to calculate the gradients. Defaults to 'categorical_crossentropy'.
-                Loss functions can be set by calling the Keras API losses module.
-            conv_init (str): Weight initializer for the convolutional layers.
-            dense_init (str): Weight initializer for the dense layers.
-            activation_conv (str): Activation function to use for the convolutional layer. Default is 'relu'.'
-            activation_dense (str): Activation function to use for the dense layers. Default is 'tanh'.
-            model_reg (str): The model regularization technique to use, can be None.
-            padding (str): Either 'same' or 'valid'. When set to 'valid', the dimensions reduce as the boundary 
-                that doesn't make it within even convolutions get cuts off. Defaults to 'same', which applies
-                zero-value padding around the boundary, ensuring even convolutional steps across each dimension.
-            dropout (float): Droupout rate after the dense layers. This is the percentage of dense neurons
-                that are turned off at each epoch. This prevents inter-neuron depedency, and thus overfitting. 
-            pooling (bool): True to enable max pooling, false to disable. 
-                Note: Max pooling can result in loss of positional information, it computation allows
-                setting pooling=False may yield more robust accuracy.
-            pool_size (int, optional): The pool size of the max pooling layers. Defaults to 3.
-            pool_stride (int, optional): The stride to use in the max pooling layers. Defaults to 2.
-            early_stop_callback (list, optional): Callbacks for early stopping and pruning with Optuna, defaults
-                to None. Should only be used during optimization, refer to pyBIA.optimization.objective_cnn().
-            checkpoint (bool, optional): If False no checkpoint will be saved. Defaults to True.
-            verbose (int): Controls the amount of output printed during the training process. A value of 0 is for silent mode, 
-                a value of 1 is used for progress bar mode, and 2 for one line per epoch mode. Defaults to 1.
-            smote_sampling (float): The smote_sampling parameter is used in the SMOTE algorithm to specify the desired 
-                ratio of the minority class to the majority class. Defaults to 0 which disables the procedure.
-
-        Returns:
-            The trained CNN model and accompanying history.
-        """
-        
-        if batch_size < 16 and model_reg == 'batch_norm':
-            print("Batch Normalization can be unstable with low batch sizes, if loss returns nan try a larger batch size and/or smaller learning rate.")
-        
-        if val_positive is not None:
-            val_X1, val_Y1 = process_class(val_positive, label=1, img_num_channels=img_num_channels, 
-                min_pixel=min_pixel, max_pixel=max_pixel, normalize=normalize)
-            if val_negative is None:
-                val_X, val_Y = val_X1, val_Y1
-            else:
-                val_X2, val_Y2 = process_class(val_negative, label=0, img_num_channels=img_num_channels, 
-                    min_pixel=min_pixel, max_pixel=max_pixel, normalize=normalize)
-                val_X, val_Y = np.r_[val_X1, val_X2], np.r_[val_Y1, val_Y2]
-        else:
-            if val_negative is None:
-                val_X, val_Y = None, None
-            else:
-                val_X2, val_Y2 = process_class(val_negative, label=0, img_num_channels=img_num_channels, 
-                    min_pixel=min_pixel, max_pixel=max_pixel, normalize=normalize)
-                val_X, val_Y = val_X2, val_Y2
-
-        img_width = positive_class[0].shape[0]
-        img_height = positive_class[0].shape[1]
-        
-        ix = np.random.permutation(len(positive_class))
-        positive_class = positive_class[ix]
-
-        ix = np.random.permutation(len(negative_class))
-        negative_class = negative_class[ix]
-
-        X_train, Y_train = create_training_set(positive_class, negative_class, normalize=normalize, 
-            min_pixel=min_pixel, max_pixel=max_pixel, img_num_channels=img_num_channels)
-
-        if normalize:
-            X_train[X_train > 1] = 1
-            X_train[X_train < 0] = 0
-            
-        #Apply SMOTE to oversample the minority class
-        if smote_sampling > 0:
-            smote = SMOTE(sampling_strategy=smote_sampling, random_state=1909)
-            #Reshape X_train into a 2D array
-            X_2d = np.reshape(X_train, (X_train.shape[0], -1))
-            X_res, Y_train_res = smote.fit_resample(X_2d, Y_train)
-            #Reshape X_res back into a 4D array
-            X_train_res = np.reshape(X_res, (X_res.shape[0], img_height, img_width, img_num_channels))
-            Y_train_res = to_categorical(Y_train_res, num_classes=2)
-        elif smote_sampling == 0:
-            X_train_res, Y_train_res = X_train, Y_train
-        else:
-            raise ValueError('smote_sampling must be a float between 0.0 and 1.0!')
-
-        num_classes, input_shape = 2, (img_width, img_height, img_num_channels)
-       
-        if verbose == 1:
-            print_params(batch_size, lr, decay, momentum, nesterov, loss, optimizer, model_reg, 
-                conv_init, activation_conv, dense_init, activation_dense, filter_size_1, filter_size_2, 
-                filter_size_3, filter_size_4, filter_size_5, pooling_1, pooling_2, pooling_3, 
-                pool_size_1, pool_size_2, pool_size_3, conv_reg, dense_reg)
-
-        #Uniform scaling initializer
-        if conv_init == 'uniform_scaling':
-            conv_init = VarianceScaling(scale=1.0, mode='fan_in', distribution='uniform', seed=None)
-        if dense_init == 'uniform_scaling':
-            dense_init = VarianceScaling(scale=1.0, mode='fan_in', distribution='uniform', seed=None)
-
-        #Call the appropriate tf.keras.losses.Loss function
-        loss = get_loss_function(loss)
-
-        #Model configuration
-        model = Sequential()
-        
-        #Convolutional layers
-        model.add(Conv2D(filter_1, filter_size_1, strides=strides_1, activation=activation_conv, input_shape=input_shape,
-                         padding=padding, kernel_initializer=conv_init, kernel_regularizer=l2(conv_reg)))
-        if pooling_1 == 'min':
-            model.add(tf.keras.layers.Lambda(lambda x: -tf.nn.max_pool2d(-x, ksize=(pool_size_1, pool_size_1), strides=(pool_stride_1, pool_stride_1), padding='SAME')))
-        elif pooling_1 == 'max':
-            model.add(MaxPool2D(pool_size=pool_size_1, strides=pool_stride_1, padding=padding))
-        elif pooling_1 == 'average':
-            model.add(AveragePooling2D(pool_size=pool_size_1, strides=pool_stride_1, padding=padding)) 
-        if model_reg == 'local_response':
-            model.add(Lambda(lambda x: tf.nn.local_response_normalization(x, depth_radius=5, bias=2, alpha=1e-4, beta=0.75))) #Lambda allows for the application of the lambda function to the input tensor
-        elif model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-
-        model.add(Conv2D(filter_2, filter_size_2, strides=strides_2, activation=activation_conv, padding=padding,
-                         kernel_initializer=conv_init, kernel_regularizer=l2(conv_reg)))
-        if pooling_2 == 'min':
-            model.add(tf.keras.layers.Lambda(lambda x: -tf.nn.max_pool2d(-x, ksize=(pool_size_2, pool_size_2), strides=(pool_stride_2, pool_stride_2), padding='SAME')))
-        elif pooling_2 == 'max':
-            model.add(MaxPool2D(pool_size=pool_size_2, strides=pool_stride_2, padding=padding))
-        elif pooling_2 == 'average':
-            model.add(AveragePooling2D(pool_size=pool_size_2, strides=pool_stride_2, padding=padding))            
-        if model_reg == 'local_response':
-            model.add(Lambda(lambda x: tf.nn.local_response_normalization(x, depth_radius=5, bias=2, alpha=1e-4, beta=0.75)))
-        elif model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-
-        model.add(Conv2D(filter_3, filter_size_3, strides=strides_3, activation=activation_conv, padding=padding,
-                         kernel_initializer=conv_init, kernel_regularizer=l2(conv_reg)))
-        if model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-
-        model.add(Conv2D(filter_4, filter_size_4, strides=strides_4, activation=activation_conv, padding=padding,
-                         kernel_initializer=conv_init, kernel_regularizer=l2(conv_reg)))
-        if model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-
-        model.add(Conv2D(filter_5, filter_size_5, strides=strides_5, activation=activation_conv, padding=padding,
-                         kernel_initializer=conv_init, kernel_regularizer=l2(conv_reg)))
-        if pooling_3 == 'min':
-            model.add(tf.keras.layers.Lambda(lambda x: -tf.nn.max_pool2d(-x, ksize=(pool_size_3, pool_size_3), strides=(pool_stride_3, pool_stride_3), padding='SAME')))
-        if pooling_3 == 'max':
-            model.add(MaxPool2D(pool_size=pool_size_3, strides=pool_stride_3, padding=padding))
-        elif pooling_3 == 'average':
-            model.add(AveragePooling2D(pool_size=pool_size_3, strides=pool_stride_3, padding=padding))            
-        if model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-
-        #Dense layers
-        model.add(Flatten())
-
-        #FCC 1
-        model.add(Dense(dense_neurons_1, activation=activation_dense, kernel_initializer=dense_init, kernel_regularizer=l2(dense_reg)))
-        model.add(Dropout(dropout_1))
-        if model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-        
-        #FCC 2
-        model.add(Dense(dense_neurons_2, activation=activation_dense, kernel_initializer=dense_init, kernel_regularizer=l2(dense_reg)))
-        model.add(Dropout(dropout_2))
-        if model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-
-        #Output layer
-        model.add(Dense(num_classes, activation='sigmoid', kernel_initializer=dense_init)) #adding a kernel model_reg has no effect if sigmoid is being used, but works for layers with trainable weights like softmax
-        if model_reg == 'batch_norm':
-            model.add(BatchNormalization())
-
-        #Call the appropriate tf.keras.optimizers function
-        optimizer = get_optimizer(optimizer, lr, momentum=momentum, decay=decay, nesterov=nesterov)
-
-        #Compile the Model
-        model.compile(loss=loss, optimizer=optimizer, metrics=[tf.keras.metrics.BinaryAccuracy(), f1_score])
-        
-        #Optional checkpoint callback, with the monitor hardcoded to loss of the validation data.
-        callbacks_list = []
-        if checkpoint:
-            callbacks_list.append(ModelCheckpoint(str(Path.home())+'/'+'checkpoint.hdf5', monitor='val_binary_loss', verbose=2, save_best_only=True, mode='min'))
-        
-        #Early stop callback for use during the optimization routine
-        if early_stop_callback is not None:
-            callbacks_list.append(early_stop_callback)
-
-        #Fit the Model
-        if val_X is None:
-            history = model.fit(X_train_res, Y_train_res, batch_size=batch_size, epochs=epochs, callbacks=callbacks_list, verbose=verbose)
-        else:
-            history = model.fit(X_train_res, Y_train_res, batch_size=batch_size, validation_data=(val_X, val_Y), epochs=epochs, callbacks=callbacks_list, verbose=verbose)
 
-        return model, history
-
-
-### Score and Loss Functions ###
-
-def f1_score(y_true, y_pred):
+#Helper functions below to generate confusion matrix
+def format_labels(labels: list) -> list:
     """
-    Computes the F1 score between true and predicted labels.
-
+    Takes a list of labels and returns the list with all words capitalized and underscores removed.
+    Also replaces 'eta' with 'Learning Rate' and 'n_estimators' with 'Number of Trees'.
+    
     Args:
-        y_true (tensor): The true labels.
-        y_pred (tensor): The predicted labels.
-
+        labels (list): A list of strings.
+    
     Returns:
-        The F1 score between true and predicted labels.
+        Reformatted list, of same lenght.
     """
 
-    tp = tf.keras.backend.sum(tf.keras.backend.round(tf.keras.backend.clip(y_true * y_pred, 0, 1)))
-    fp = tf.keras.backend.sum(tf.keras.backend.round(tf.keras.backend.clip(y_pred - y_true, 0, 1)))
-    fn = tf.keras.backend.sum(tf.keras.backend.round(tf.keras.backend.clip(y_true - y_pred, 0, 1)))
-
-    precision = tp / (tp + fp + tf.keras.backend.epsilon())
-    recall = tp / (tp + fn + tf.keras.backend.epsilon())
+    new_labels = []
+    for label in labels:
+        label = label.replace("_", " ")
+        if label == "eta":
+            new_labels.append("Learning Rate")
+            continue
+        if label == "n estimators":
+            new_labels.append("Num of Trees")
+            continue
+        if label == "colsample bytree":
+            new_labels.append("ColSample ByTree")
+            continue
+        new_labels.append(label.title())
 
-    return 2.0 * precision * recall / (precision + recall + tf.keras.backend.epsilon())
+    return new_labels
 
-def focal_loss(y_true, y_pred, gamma=2.0, alpha=0.25):
+def evaluate_model(classifier, data_x, data_y, normalize=True, k_fold=10):
     """
-    This function computes focal loss, which is used to address class imbalance in classification tasks.
+    Cross-checks model accuracy and outputs both the predicted
+    and the true class labels. 
 
     Args:
-        y_true (Tensor): The ground truth labels.
-        y_pred (Tensor): The predicted labels.
-        gamma (float, optional): The focusing parameter. Defaults to 2.0.
-        alpha (float, optional): The weighting parameter. Defaults to 0.25.
+        classifier: The machine learning classifier to optimize.
+        data_x (ndarray): 2D array of size (n x m), where n is the
+            number of samples, and m the number of features.
+        data_y (ndarray, str): 1D array containing the corresponing labels.
+        normalize (bool, optional): If False the confusion matrix will display the
+            total number of objects in the sample. Defaults to True, in which case
+            the values are normalized between 0 and 1. 
+        k_fold (int, optional): The number of cross-validations to perform.
+            The output confusion matrix will display the mean accuracy across
+            all k_fold iterations. Defaults to 10.
 
     Returns:
-        Tensor: The computed focal loss.
+        The first output is the 1D array of the true class labels.
+        The second output is the 1D array of the predicted class labels.
     """
 
-    ce = tf.keras.backend.binary_crossentropy(y_true, y_pred, from_logits=True)
-    pt = tf.math.exp(-ce)
+    k_fold = KFold(k_fold, shuffle=True)#, random_state=1)
+    #k_fold = StratifiedKFold(k_fold, shuffle=False)#, random_state=8)
 
-    return alpha * tf.math.pow(1.0 - pt, gamma) * ce
+    predicted_targets = np.array([])
+    actual_targets = np.array([])
 
-def dice_loss(y_true, y_pred, smooth=1e-7):
-    """
-    This function computes the Dice loss, which is a similarity metric commonly used in segmentation tasks.
+    for train_ix, test_ix in k_fold.split(data_x, data_y):
+        train_x, train_y, test_x, test_y = data_x[train_ix], data_y[train_ix], data_x[test_ix], data_y[test_ix]
+        # Fit the classifier
+        classifier.fit(train_x, train_y)
+        # Predict the labels of the test set samples
+        predicted_labels = classifier.predict(test_x)
+        predicted_targets = np.append(predicted_targets, predicted_labels)
+        actual_targets = np.append(actual_targets, test_y)
 
-    Args:
-        y_true (Tensor): The ground truth labels.
-        y_pred (Tensor): The predicted labels.
-        smooth (float, optional): A smoothing parameter to prevent division by zero. Defaults to 1e-7.
+    return predicted_targets, actual_targets
 
-    Returns:
-        Tensor: The computed Dice loss.
+def generate_matrix(predicted_labels_list, actual_targets, classes, normalize=True, 
+    title='Confusion Matrix', savefig=False):
     """
-
-    intersection = tf.reduce_sum(y_true * y_pred)
-    union = tf.reduce_sum(y_true) + tf.reduce_sum(y_pred)
-    dice = (2.0 * intersection + smooth) / (union + smooth)
-
-    return 1.0 - dice
-
-def jaccard_loss(y_true, y_pred, smooth=1e-7):
-    """
-    This function computes the Jaccard loss, which is another similarity metric used in segmentation tasks.
+    Generates the confusion matrix using the output from the evaluate_model() function.
 
     Args:
-        y_true (Tensor): The ground truth labels.
-        y_pred (Tensor): The predicted labels.
-        smooth (float, optional): A smoothing parameter to prevent division by zero. Defaults to 1e-7.
+        predicted_labels_list: 1D array containing the predicted class labels.
+        actual_targets: 1D array containing the actual class labels.
+        classes (list): A list containing the label of the two training bags. This
+            will be used to set the axis. Ex) classes = ['DIFFUSE', 'OTHER']
+        normalize (bool, optional): If True the matrix accuracy will be normalized
+            and displayed as a percentage accuracy. Defaults to True.
+        title (str, optional): The title of the output plot. 
+        savefig (bool): If True the figure will not disply but will be saved instead. Defaults to False. 
 
     Returns:
-        Tensor: The computed Jaccard loss.
+        AxesImage.
     """
 
-    intersection = tf.reduce_sum(y_true * y_pred)
-    union = tf.reduce_sum(y_true) + tf.reduce_sum(y_pred) - intersection
-    jaccard = (intersection + smooth) / (union + smooth)
-
-    return 1.0 - jaccard
-
-
-### AlexNet Helper Functions ###
-
-def get_optimizer(optimizer, lr, momentum=None, decay=None, nesterov=False):
-    """
-    Returns an optimizer object based on the specified parameters.
-
-    Args:
-        optimizer (str): Name of the optimizer.
-        lr (float): Learning rate.
-        momentum (float): Momentum for SGD optimizer (default=None).
-        decay (float): Learning rate decay for RMSprop optimizer (default=None).
-        nesterov (bool): Whether to use Nesterov momentum for SGD optimizer (default=False).
-
-    Returns:
-        optimizer: Optimizer object.
-
-    Raises:
-        ValueError: If an invalid optimizer name is provided.
-    """
+    conf_matrix = confusion_matrix(actual_targets, predicted_labels_list)
+    np.set_printoptions(precision=2)
 
-    if optimizer == 'sgd':
-        optimizer = SGD(learning_rate=lr, momentum=momentum, decay=decay, nesterov=nesterov)
-    elif optimizer == 'adam':
-        optimizer = Adam(learning_rate=lr)
-    elif optimizer == 'rmsprop':
-        optimizer = RMSprop(learning_rate=lr, decay=decay)
-    elif optimizer == 'adagrad':
-        optimizer = Adagrad(learning_rate=lr)
+    plt.figure()
+    if normalize:
+        generate_plot(conf_matrix, classes=classes, normalize=normalize, title=title)
+    elif normalize == False:
+        generate_plot(conf_matrix, classes=classes, normalize=normalize, title=title)
+    
+    if savefig:
+        _set_style_()
+        plt.savefig('Ensemble_Confusion_Matrix.png', bbox_inches='tight', dpi=300)
+        plt.clf(); plt.style.use('default')
     else:
-        raise ValueError("If an invalid optimizer name is provided, options are: 'sgd', 'adam', 'rmsprop', 'adagrad'")
-
-    return optimizer
-
-def get_loss_function(loss):
+        plt.show()
+    
+def generate_plot(conf_matrix, classes, normalize=False, title='Confusion Matrix'):
     """
-    Returns the specified loss function as a Keras loss object.
-
+    Generates the confusion matrix figure object, but does not plot.
+    
     Args:
-        loss (str): The name of the loss function to use. Possible values are: 'hinge', 'squared_hinge', 'kld', 
-            'logcosh', 'focal_loss', 'dice_loss', and 'jaccard_loss'.
+        conf_matrix: The confusion matrix generated using the generate_matrix() function.
+        classes (list): A list containing the label of the two training bags. This
+            will be used to set the axis. Defaults to a list containing 'DIFFUSE' & 'OTHER'. 
+        normalize (bool, optional): If True the matrix accuracy will be normalized
+            and displayed as a percentage accuracy. Defaults to True.
+        title (str, optional): The title of the output plot. 
 
     Returns:
-        tf.keras.losses.Loss: The Keras loss object for the specified loss function.
-
-    Raises:
-        ValueError: If an invalid loss function name is provided, options are: 'hinge', 'square_hinge', 'kld', 'logcosh', 'focal_loss', 'dice_loss', 'jaccard_loss'
+        AxesImage object. 
     """
 
-    if loss == 'binary_crossentropy':
-        return loss 
-    elif loss == 'hinge':
-        return Hinge()
-    elif loss == 'squared_hinge':
-        return SquaredHinge()
-    elif loss == 'kld':
-        return KLDivergence()
-    elif loss == 'logcosh':
-        return LogCosh()
-    elif loss == 'focal_loss':
-        return focal_loss
-    elif loss == 'dice_loss':
-        return dice_loss
-    elif loss == 'jaccard_loss':
-        return jaccard_loss
-    else:
-        raise ValueError("Invalid loss function name")
-   
-def print_params(batch_size, lr, decay, momentum, nesterov, loss, optimizer, 
-    model_reg, conv_init, activation_conv, dense_init, activation_dense,
-    filter_size_1, filter_size_2, filter_size_3, filter_size_4, filter_size_5, 
-    pooling_1, pooling_2, pooling_3, pool_size_1, pool_size_2, pool_size_3,
-    conv_reg, dense_reg):
-    """
-    Prints the model training parameters and architecture parameters.
+    if normalize:
+        conf_matrix = conf_matrix.astype('float') / conf_matrix.sum(axis=1)[:, np.newaxis]
 
-    Args:
-        batch_size (int): The number of samples per gradient update.
-        lr (float): The learning rate for the model.
-        decay (float): The learning rate decay over each update.
-        momentum (float): The SGD optimizer momentum.
-        nesterov (bool): Whether to apply Nesterov momentum.
-        loss (str): The loss function used for the model.
-        optimizer (str): The optimization algorithm used to train the model.
-        model_reg (str): The regularization method used to prevent overfitting.
-        conv_init (str): The initialization method used for the convolutional layers.
-        activation_conv (str): The activation function used for the convolutional layers.
-        dense_init (str): The initialization method used for the dense layers.
-        activation_dense (str): The activation function used for the dense layers.
-    """
+    plt.imshow(conf_matrix, interpolation='nearest', cmap=plt.get_cmap('Blues'))
+    plt.title(title)#, fontsize=20)
+    plt.colorbar()
+
+    tick_marks = np.arange(len(classes))
+    plt.xticks(tick_marks, classes, alpha=1, color='k')#rotation=45, fontsize=14,
+    plt.yticks(tick_marks, classes, alpha=1, color='k', rotation=90)#fontsize=14,
+    #plt.xticks(tick_marks, ['DIFFUSE','OTHER'], rotation=45, fontsize=14)
+    #plt.yticks(tick_marks, ['DIFFUSE','OTHER'], fontsize=14)
+
+    fmt = '.4f' if normalize is True else 'd'
+    thresh = conf_matrix.max() / 2.
+
+    for i, j in itertools.product(range(conf_matrix.shape[0]), range(conf_matrix.shape[1])):
+        plt.text(j, i, format(conf_matrix[i, j], fmt), horizontalalignment="center",
+                 color="white" if conf_matrix[i, j] > thresh else "black")#fontsize=14,
+
+    plt.grid(False)
+    plt.ylabel('True label', alpha=1, color='k')#fontsize=18
+    plt.xlabel('Predicted label',alpha=1, color='k')#fontsize=18
+    plt.tight_layout()
 
-    print()
-    print('===== Training Parameters =====')
-    print()
-    print('|| Batch Size : '+str(batch_size), '|| Loss Function : '+loss, '||')
-    if optimizer == 'sgd':
-        print('|| Optimizer : '+optimizer, '|| lr : '+str(lr), '|| Decay : '+str(decay), '|| Momentum : '+str(momentum), '|| Nesterov : '+str(nesterov)+' ||')
-    elif optimizer == 'rmsprop':
-        print('|| Optimizer : '+optimizer, '|| lr : '+str(lr), '|| Decay : '+str(decay)+' ||')
-    else:
-        print('|| Optimizer : '+optimizer, '|| lr : '+str(lr)+' ||')
-    print()
-    print('=== Architecture Parameters ===')
-    print()
-    print('Model Regularizer : '+ model_reg)
-    print('Convolutional L2 Regularizer : '+ str(conv_reg))
-    print('Convolutional Initializer : '+ conv_init)
-    print('Convolutional Activation Fn : '+ activation_conv)
-    print('Dense L2 Regularizer : '+ str(dense_reg))
-    print('Dense Initializer : '+ dense_init)
-    print('Dense Activation Fn : '+ activation_dense)
-    print()
-    print('======= Layer Parameters ======')
-    print()
-    print('Filter 1 || Size : {}, Pooling : {}, Pooling Size : {}'.format(filter_size_1, pooling_1, pool_size_1))
-    print('Filter 2 || Size : {}, Pooling : {}, Pooling Size : {}'.format(filter_size_2, pooling_2, pool_size_2))
-    print('Filter 3 || Size : {}, Pooling : {}, Pooling Size : {}'.format(filter_size_3, pooling_3, pool_size_3))
-    print('Filter 4 || Size : {}'.format(filter_size_4))
-    print('Filter 5 || Size : {}'.format(filter_size_5))
-    print()
-    print('===============================')
-    print()
+    return conf_matrix
 
-def format_labels(labels: list) -> list:
+def min_max_norm(data_x):
     """
-    Takes a list of labels and returns the list with all words capitalized and underscores removed.
-    Also replaces 'eta' with 'Learning Rate' and 'n_estimators' with 'Number of Trees'.
+    Normalizes the data to be between 0 and 1. NaN values are ignored.
+    The transformation matrix will be returned as it will be needed
+    to consitently normalize new data.
     
     Args:
-        labels (list): A list of strings.
-    
+        data_x (ndarray): 2D array of size (n x m), where n is the number of samples, and m the number of features.
+
     Returns:
-        Reformatted list.
+        Normalized data array.
     """
 
-    new_labels = []
-    for label in labels:
-        label = label.replace("_", " ")
-        if label == "lr":
-            new_labels.append("Learning Rate")
-            continue
-        new_labels.append(label.title())
-
-    return new_labels
-
-
+    Ny, Nx = data_x.shape
+    new_array = np.zeros((Ny, Nx))
+    
+    for i in range(Nx):
+        print((np.max(data_x[:,i]) - np.min(data_x[:,i])))
+        new_array[:,i] = (data_x[:,i] - np.min(data_x[:,i])) / (np.max(data_x[:,i]) - np.min(data_x[:,i]))
 
+    return new_array
+    
+def _set_style_():
+    """Function to configure the matplotlib.pyplot style. This function is called before any images are saved.
+    """
+    plt.rcParams["xtick.color"] = "323034"
+    plt.rcParams["ytick.color"] = "323034"
+    plt.rcParams["text.color"] = "323034"
+    plt.rcParams["lines.markeredgecolor"] = "black"
+    plt.rcParams["patch.facecolor"] = "bc80bd"
+    plt.rcParams["patch.force_edgecolor"] = True
+    plt.rcParams["patch.linewidth"] = 0.8
+    plt.rcParams["scatter.edgecolors"] = "black"
+    plt.rcParams["grid.color"] = "b1afb5"
+    plt.rcParams["axes.titlesize"] = 16
+    plt.rcParams["legend.title_fontsize"] = 12
+    plt.rcParams["xtick.labelsize"] = 16
+    plt.rcParams["ytick.labelsize"] = 16
+    plt.rcParams["font.size"] = 15
+    plt.rcParams["axes.prop_cycle"] = (cycler('color', ['bc80bd' ,'fb8072', 'b3de69','fdb462','fccde5','8dd3c7','ffed6f','bebada','80b1d3', 'ccebc5', 'd9d9d9']))
+    plt.rcParams["mathtext.fontset"] = "stix"
+    plt.rcParams["font.family"] = "STIXGeneral"
+    plt.rcParams["lines.linewidth"] = 2
+    plt.rcParams["lines.markersize"] = 6
+    plt.rcParams["legend.frameon"] = True
+    plt.rcParams["legend.framealpha"] = 0.8
+    plt.rcParams["legend.fontsize"] = 13
+    plt.rcParams["legend.edgecolor"] = "black"
+    plt.rcParams["legend.borderpad"] = 0.2
+    plt.rcParams["legend.columnspacing"] = 1.5
+    plt.rcParams["legend.labelspacing"] = 0.4
+    plt.rcParams["text.usetex"] = False
+    plt.rcParams["axes.labelsize"] = 17
+    plt.rcParams["axes.titlelocation"] = "center"
+    plt.rcParams["axes.formatter.use_mathtext"] = True
+    plt.rcParams["axes.autolimit_mode"] = "round_numbers"
+    plt.rcParams["axes.labelpad"] = 3
+    plt.rcParams["axes.formatter.limits"] = (-4, 4)
+    plt.rcParams["axes.labelcolor"] = "black"
+    plt.rcParams["axes.edgecolor"] = "black"
+    plt.rcParams["axes.linewidth"] = 1
+    plt.rcParams["axes.grid"] = False
+    plt.rcParams["axes.spines.right"] = True
+    plt.rcParams["axes.spines.left"] = True
+    plt.rcParams["axes.spines.top"] = True
+    plt.rcParams["figure.titlesize"] = 18
+    plt.rcParams["figure.autolayout"] = True
+    plt.rcParams["figure.dpi"] = 300
 
+    return
```

### Comparing `pyBIA-1.3.2/pyBIA/data/obj_name_779` & `pyBIA-1.3.3/pyBIA/data/obj_name_779`

 * *Files identical despite different names*

### Comparing `pyBIA-1.3.2/pyBIA/data/obj_name_80` & `pyBIA-1.3.3/pyBIA/data/obj_name_80`

 * *Files identical despite different names*

### Comparing `pyBIA-1.3.2/pyBIA/data_processing.py` & `pyBIA-1.3.3/pyBIA/data_processing.py`

 * *Files identical despite different names*

### Comparing `pyBIA-1.3.2/pyBIA/image_moments.py` & `pyBIA-1.3.3/pyBIA/image_moments.py`

 * *Files identical despite different names*

### Comparing `pyBIA-1.3.2/pyBIA/optimization.py` & `pyBIA-1.3.3/pyBIA/optimization.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,6190 +1,8629 @@
 00000000: 2321 2f75 7372 2f62 696e 2f65 6e76 2070  #!/usr/bin/env p
 00000010: 7974 686f 6e33 0a23 202d 2a2d 2063 6f64  ython3.# -*- cod
 00000020: 696e 673a 2075 7466 2d38 202d 2a2d 0a22  ing: utf-8 -*-."
 00000030: 2222 0a43 7265 6174 6564 206f 6e20 5765  "".Created on We
 00000040: 6420 5365 7020 2031 3120 3132 3a30 343a  d Sep  11 12:04:
 00000050: 3233 2032 3032 310a 0a40 6175 7468 6f72  23 2021..@author
 00000060: 3a20 6461 6e69 656c 0a22 2222 0a69 6d70  : daniel.""".imp
-00000070: 6f72 7420 6f73 2c20 7379 730a 696d 706f  ort os, sys.impo
-00000080: 7274 2063 6f70 792c 2067 630a 696d 706f  rt copy, gc.impo
-00000090: 7274 2074 656e 736f 7266 6c6f 7720 6173  rt tensorflow as
-000000a0: 2074 660a 6f73 2e65 6e76 6972 6f6e 5b27   tf.os.environ['
-000000b0: 5059 5448 4f4e 4841 5348 5345 4544 275d  PYTHONHASHSEED']
-000000c0: 3d20 2730 2720 232c 206f 732e 656e 7669  = '0' #, os.envi
-000000d0: 726f 6e5b 2254 465f 4445 5445 524d 494e  ron["TF_DETERMIN
-000000e0: 4953 5449 435f 4f50 5322 5d20 3d31 0a69  ISTIC_OPS"] =1.i
-000000f0: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
-00000100: 700a 696d 706f 7274 2072 616e 646f 6d20  p.import random 
-00000110: 6173 2070 7974 686f 6e5f 7261 6e64 6f6d  as python_random
-00000120: 0a23 2368 7474 7073 3a2f 2f6b 6572 6173  .##https://keras
-00000130: 2e69 6f2f 6765 7474 696e 675f 7374 6172  .io/getting_star
-00000140: 7465 642f 6661 712f 2368 6f77 2d63 616e  ted/faq/#how-can
-00000150: 2d69 2d6f 6274 6169 6e2d 7265 7072 6f64  -i-obtain-reprod
-00000160: 7563 6962 6c65 2d72 6573 756c 7473 2d75  ucible-results-u
-00000170: 7369 6e67 2d6b 6572 6173 2d64 7572 696e  sing-keras-durin
-00000180: 672d 6465 7665 6c6f 706d 656e 7423 230a  g-development##.
-00000190: 6e70 2e72 616e 646f 6d2e 7365 6564 2831  np.random.seed(1
-000001a0: 3930 3929 2c20 7079 7468 6f6e 5f72 616e  909), python_ran
-000001b0: 646f 6d2e 7365 6564 2831 3930 3929 2c20  dom.seed(1909), 
-000001c0: 7466 2e72 616e 646f 6d2e 7365 745f 7365  tf.random.set_se
-000001d0: 6564 2831 3930 3929 0a66 726f 6d20 7061  ed(1909).from pa
-000001e0: 6e64 6173 2069 6d70 6f72 7420 4461 7461  ndas import Data
-000001f0: 4672 616d 650a 6672 6f6d 2077 6172 6e69  Frame.from warni
-00000200: 6e67 7320 696d 706f 7274 2066 696c 7465  ngs import filte
-00000210: 7277 6172 6e69 6e67 730a 6669 6c74 6572  rwarnings.filter
-00000220: 7761 726e 696e 6773 2822 6967 6e6f 7265  warnings("ignore
-00000230: 222c 2063 6174 6567 6f72 793d 4675 7475  ", category=Futu
-00000240: 7265 5761 726e 696e 6729 0a66 726f 6d20  reWarning).from 
-00000250: 636f 6c6c 6563 7469 6f6e 7320 696d 706f  collections impo
-00000260: 7274 2043 6f75 6e74 6572 200a 0a69 6d70  rt Counter ..imp
-00000270: 6f72 7420 736b 6c65 6172 6e2e 6e65 6967  ort sklearn.neig
-00000280: 6862 6f72 732e 5f62 6173 650a 7379 732e  hbors._base.sys.
-00000290: 6d6f 6475 6c65 735b 2773 6b6c 6561 726e  modules['sklearn
-000002a0: 2e6e 6569 6768 626f 7273 2e62 6173 6527  .neighbors.base'
-000002b0: 5d20 3d20 736b 6c65 6172 6e2e 6e65 6967  ] = sklearn.neig
-000002c0: 6862 6f72 732e 5f62 6173 650a 6672 6f6d  hbors._base.from
-000002d0: 2073 6b6c 6561 726e 2e69 6d70 7574 6520   sklearn.impute 
-000002e0: 696d 706f 7274 204b 4e4e 496d 7075 7465  import KNNImpute
-000002f0: 720a 6672 6f6d 2073 6b6c 6561 726e 2e65  r.from sklearn.e
-00000300: 6e73 656d 626c 6520 696d 706f 7274 2052  nsemble import R
-00000310: 616e 646f 6d46 6f72 6573 7443 6c61 7373  andomForestClass
-00000320: 6966 6965 720a 6672 6f6d 2073 6b6c 6561  ifier.from sklea
-00000330: 726e 2e6e 6575 7261 6c5f 6e65 7477 6f72  rn.neural_networ
-00000340: 6b20 696d 706f 7274 204d 4c50 436c 6173  k import MLPClas
-00000350: 7369 6669 6572 0a66 726f 6d20 736b 6c65  sifier.from skle
-00000360: 6172 6e2e 6d65 7472 6963 7320 696d 706f  arn.metrics impo
-00000370: 7274 2061 6363 7572 6163 795f 7363 6f72  rt accuracy_scor
-00000380: 650a 6672 6f6d 2073 6b6c 6561 726e 2e6d  e.from sklearn.m
-00000390: 6f64 656c 5f73 656c 6563 7469 6f6e 2069  odel_selection i
-000003a0: 6d70 6f72 7420 7472 6169 6e5f 7465 7374  mport train_test
-000003b0: 5f73 706c 6974 2c20 6372 6f73 735f 7661  _split, cross_va
-000003c0: 6c69 6461 7465 2c20 6372 6f73 735f 7661  lidate, cross_va
-000003d0: 6c5f 7363 6f72 650a 0a66 726f 6d20 736b  l_score..from sk
-000003e0: 6f70 7420 696d 706f 7274 2042 6179 6573  opt import Bayes
-000003f0: 5365 6172 6368 4356 2c20 706c 6f74 732c  SearchCV, plots,
-00000400: 2067 705f 6d69 6e69 6d69 7a65 0a66 726f   gp_minimize.fro
-00000410: 6d20 736b 6f70 742e 706c 6f74 7320 696d  m skopt.plots im
-00000420: 706f 7274 2070 6c6f 745f 636f 6e76 6572  port plot_conver
-00000430: 6765 6e63 652c 2070 6c6f 745f 6f62 6a65  gence, plot_obje
-00000440: 6374 6976 650a 6672 6f6d 2073 6b6f 7074  ctive.from skopt
-00000450: 2e73 7061 6365 2069 6d70 6f72 7420 5265  .space import Re
-00000460: 616c 2c20 496e 7465 6765 722c 2043 6174  al, Integer, Cat
-00000470: 6567 6f72 6963 616c 200a 6672 6f6d 2074  egorical .from t
-00000480: 656e 736f 7266 6c6f 772e 6b65 7261 732e  ensorflow.keras.
-00000490: 6261 636b 656e 6420 696d 706f 7274 2063  backend import c
-000004a0: 6c65 6172 5f73 6573 7369 6f6e 200a 6672  lear_session .fr
-000004b0: 6f6d 2074 656e 736f 7266 6c6f 772e 6b65  om tensorflow.ke
-000004c0: 7261 732e 6361 6c6c 6261 636b 7320 696d  ras.callbacks im
-000004d0: 706f 7274 2045 6172 6c79 5374 6f70 7069  port EarlyStoppi
-000004e0: 6e67 2c20 4361 6c6c 6261 636b 0a0a 696d  ng, Callback..im
-000004f0: 706f 7274 206f 7074 756e 610a 6672 6f6d  port optuna.from
-00000500: 2062 6f72 7574 6120 696d 706f 7274 2042   boruta import B
-00000510: 6f72 7574 6150 790a 6672 6f6d 2042 6f72  orutaPy.from Bor
-00000520: 7574 6153 6861 7020 696d 706f 7274 2042  utaShap import B
-00000530: 6f72 7574 6153 6861 700a 6672 6f6d 2078  orutaShap.from x
-00000540: 6762 6f6f 7374 2069 6d70 6f72 7420 5847  gboost import XG
-00000550: 4243 6c61 7373 6966 6965 722c 2044 4d61  BClassifier, DMa
-00000560: 7472 6978 2c20 7472 6169 6e0a 6672 6f6d  trix, train.from
-00000570: 206f 7074 756e 612e 696e 7465 6772 6174   optuna.integrat
-00000580: 696f 6e20 696d 706f 7274 2054 464b 6572  ion import TFKer
-00000590: 6173 5072 756e 696e 6743 616c 6c62 6163  asPruningCallbac
-000005a0: 6b0a 6f70 7475 6e61 2e6c 6f67 6769 6e67  k.optuna.logging
-000005b0: 2e73 6574 5f76 6572 626f 7369 7479 286f  .set_verbosity(o
-000005c0: 7074 756e 612e 6c6f 6767 696e 672e 5741  ptuna.logging.WA
-000005d0: 524e 494e 4729 0a66 726f 6d20 7079 4249  RNING).from pyBI
-000005e0: 412e 6461 7461 5f61 7567 6d65 6e74 6174  A.data_augmentat
-000005f0: 696f 6e20 696d 706f 7274 2061 7567 6d65  ion import augme
-00000600: 6e74 6174 696f 6e2c 2072 6573 697a 650a  ntation, resize.
-00000610: 6672 6f6d 2070 7942 4941 2069 6d70 6f72  from pyBIA impor
-00000620: 7420 6461 7461 5f70 726f 6365 7373 696e  t data_processin
-00000630: 672c 2063 6e6e 5f6d 6f64 656c 0a0a 0a63  g, cnn_model...c
-00000640: 6c61 7373 206f 626a 6563 7469 7665 5f63  lass objective_c
-00000650: 6e6e 286f 626a 6563 7429 3a0a 2020 2020  nn(object):.    
-00000660: 2222 220a 2020 2020 4f70 7469 6d69 7a61  """.    Optimiza
-00000670: 7469 6f6e 206f 626a 6563 7469 7665 2066  tion objective f
-00000680: 756e 6374 696f 6e20 666f 7220 7079 4249  unction for pyBI
-00000690: 4127 7320 636f 6e76 6f6c 7574 696f 6e61  A's convolutiona
-000006a0: 6c20 6e65 7572 616c 206e 6574 776f 726b  l neural network
-000006b0: 2e20 0a20 2020 2054 6869 7320 6973 2070  . .    This is p
-000006c0: 6173 7365 6420 7468 726f 7567 6820 7468  assed through th
-000006d0: 6520 6879 7065 725f 6f70 7428 2920 6675  e hyper_opt() fu
-000006e0: 6e63 7469 6f6e 2077 6865 6e20 6f70 7469  nction when opti
-000006f0: 6d69 7a69 6e67 2077 6974 680a 2020 2020  mizing with.    
-00000700: 4f70 7475 6e61 2e20 5468 6520 4f70 7475  Optuna. The Optu
-00000710: 6e61 2073 6f66 7477 6172 6520 666f 7220  na software for 
-00000720: 6879 7065 7270 6172 616d 6574 6572 206f  hyperparameter o
-00000730: 7074 696d 697a 6174 696f 6e20 7761 7320  ptimization was 
-00000740: 7075 626c 6973 6865 6420 696e 200a 2020  published in .  
-00000750: 2020 3230 3139 2062 7920 416b 6962 6120    2019 by Akiba 
-00000760: 6574 2061 6c2e 2050 6170 6572 3a20 6874  et al. Paper: ht
-00000770: 7470 733a 2f2f 6172 7869 762e 6f72 672f  tps://arxiv.org/
-00000780: 6162 732f 3139 3037 2e31 3039 3032 0a0a  abs/1907.10902..
-00000790: 2020 2020 556e 6c69 6b65 2074 6865 206f      Unlike the o
-000007a0: 626a 6563 7469 7665 2066 756e 6374 696f  bjective functio
-000007b0: 6e73 2066 6f72 2074 6865 2065 6e73 656d  ns for the ensem
-000007c0: 626c 6520 616c 676f 7269 7468 6d73 2c20  ble algorithms, 
-000007d0: 7468 6973 2074 616b 6573 2061 7320 696e  this takes as in
-000007e0: 7075 740a 2020 2020 7468 6520 7477 6f20  put.    the two 
-000007f0: 636c 6173 7365 7320 6469 7265 6374 6c79  classes directly
-00000800: 2c20 706f 7369 7469 7665 5f63 6c61 7373  , positive_class
-00000810: 2026 206e 6567 6174 6976 655f 636c 6173   & negative_clas
-00000820: 732c 2069 6e73 7465 6164 206f 6620 7468  s, instead of th
-00000830: 6520 7472 6164 6974 696f 6e61 6c20 0a20  e traditional . 
-00000840: 2020 2064 6174 6120 2864 6174 615f 7829     data (data_x)
-00000850: 2061 6e64 2061 6363 6f6d 7061 6e79 696e   and accompanyin
-00000860: 6720 6c61 6265 6c20 6172 7261 7920 2864  g label array (d
-00000870: 6174 615f 7929 2e20 5468 6973 2069 7320  ata_y). This is 
-00000880: 6265 6361 7573 6520 7468 6520 636e 6e5f  because the cnn_
-00000890: 6d6f 6465 6c2e 416c 6578 4e65 7428 2920  model.AlexNet() 
-000008a0: 0a20 2020 2066 756e 6374 696f 6e20 7461  .    function ta
-000008b0: 6b65 7320 6173 2069 6e70 7574 2074 6865  kes as input the
-000008c0: 2074 776f 2063 6c61 7373 6573 2073 6570   two classes sep
-000008d0: 6172 6174 656c 792c 2061 6674 6572 2077  arately, after w
-000008e0: 6869 6368 2069 7420 6175 746f 6d61 7469  hich it automati
-000008f0: 6361 6c6c 7920 6173 7369 676e 7320 7468  cally assigns th
-00000900: 6520 3120 0a20 2020 2061 6e64 2030 206c  e 1 .    and 0 l
-00000910: 6162 656c 732c 2072 6573 7065 6374 6976  abels, respectiv
-00000920: 656c 792e 0a0a 2020 2020 4279 2064 6566  ely...    By def
-00000930: 6175 6c74 2c20 6f70 745f 6d6f 6465 6c3d  ault, opt_model=
-00000940: 5472 7565 2061 6e64 206f 7074 5f61 7567  True and opt_aug
-00000950: 3d46 616c 7365 2e20 4966 206f 7074 5f61  =False. If opt_a
-00000960: 7567 3d54 7275 652c 2074 6865 2069 6d61  ug=True, the ima
-00000970: 6765 2073 697a 6520 616e 640a 2020 2020  ge size and.    
-00000980: 6e75 6d62 6572 206f 6620 6175 676d 656e  number of augmen
-00000990: 7461 7469 6f6e 7320 746f 2070 6572 666f  tations to perfo
-000009a0: 726d 206f 6e20 6561 6368 2069 6d61 6765  rm on each image
-000009b0: 2077 696c 6c20 6265 2069 6e63 6c75 6465   will be include
-000009c0: 6420 6173 206f 7074 696d 697a 6162 6c65  d as optimizable
-000009d0: 2076 6172 6961 626c 6573 2e0a 2020 2020   variables..    
-000009e0: 4966 2074 6865 206f 7074 5f6d 6178 5f6d  If the opt_max_m
-000009f0: 696e 5f70 6978 2061 6e64 206f 7074 5f6d  in_pix and opt_m
-00000a00: 6178 5f6d 6178 5f70 6978 2061 7265 2073  ax_max_pix are s
-00000a10: 6574 2c20 7468 6520 6f70 7469 6d61 6c20  et, the optimal 
-00000a20: 6d61 7869 6d75 6d20 7069 7865 6c20 7661  maximum pixel va
-00000a30: 6c75 6520 746f 2075 7365 0a20 2020 2077  lue to use.    w
-00000a40: 6865 6e20 6d69 6e2d 6d61 7820 6e6f 726d  hen min-max norm
-00000a50: 616c 697a 696e 6720 6561 6368 2062 616e  alizing each ban
-00000a60: 6420 7769 6c6c 2061 6c73 6f20 6265 206f  d will also be o
-00000a70: 7074 696d 697a 6162 6c65 2076 6172 6961  ptimizable varia
-00000a80: 626c 6573 2074 6861 7420 7769 6c6c 2062  bles that will b
-00000a90: 6520 7475 6e65 6420 616e 6420 7265 7475  e tuned and retu
-00000aa0: 726e 6564 2e0a 2020 2020 4966 206f 7074  rned..    If opt
-00000ab0: 5f6d 6f64 656c 3d54 7275 652c 2061 6464  _model=True, add
-00000ac0: 6974 696f 6e61 6c20 6172 6368 6974 6563  itional architec
-00000ad0: 7475 7265 2070 6172 616d 6574 6572 7320  ture parameters 
-00000ae0: 7769 6c6c 2061 6c73 6f20 6265 2074 756e  will also be tun
-00000af0: 6564 2e20 496e 2062 6f74 6820 696e 7374  ed. In both inst
-00000b00: 616e 6365 7320 7468 6520 7472 6169 6e69  ances the traini
-00000b10: 6e67 2070 6172 616d 6574 6572 7320 0a20  ng parameters . 
-00000b20: 2020 2077 696c 6c20 6265 206f 7074 696d     will be optim
-00000b30: 697a 6564 2c20 7768 6963 6820 696e 636c  ized, which incl
-00000b40: 7564 6520 7468 6520 6f70 7469 6d69 7a65  ude the optimize
-00000b50: 722c 206c 6561 726e 696e 6720 7261 7465  r, learning rate
-00000b60: 2c20 6465 6361 792c 2061 6e64 206d 6f6d  , decay, and mom
-00000b70: 656e 7475 6d2c 2069 6620 6170 706c 6963  entum, if applic
-00000b80: 6162 6c65 2e0a 0a20 2020 204e 6f74 653a  able...    Note:
-00000b90: 0a20 2020 2020 2020 2049 6620 6f70 745f  .        If opt_
-00000ba0: 6175 6720 6973 2065 6e61 626c 6564 2c20  aug is enabled, 
-00000bb0: 7468 656e 2074 6865 2070 6f73 6974 6976  then the positiv
-00000bc0: 655f 636c 6173 7320 7361 6d70 6c65 2077  e_class sample w
-00000bd0: 696c 6c20 6265 2074 6865 2064 6174 6120  ill be the data 
-00000be0: 7468 6174 2077 696c 6c20 6175 676d 656e  that will augmen
-00000bf0: 7465 642e 0a20 2020 2020 2020 2049 7420  ted..        It 
-00000c00: 6973 2062 6573 7420 746f 206b 6565 7020  is best to keep 
-00000c10: 626f 7468 2063 6c61 7373 2073 697a 6573  both class sizes
-00000c20: 2074 6865 2073 616d 6520 6166 7465 7220   the same after 
-00000c30: 6175 676d 656e 7461 7469 6f6e 2c20 7468  augmentation, th
-00000c40: 6572 6566 6f72 6520 6261 6c61 6e63 653d  erefore balance=
-00000c50: 5472 7565 0a20 2020 2020 2020 2062 7920  True.        by 
-00000c60: 6465 6661 756c 742c 2077 6869 6368 2077  default, which w
-00000c70: 696c 6c20 7472 756e 6361 7465 2074 6865  ill truncate the
-00000c80: 206e 6567 6174 6976 655f 636c 6173 7320   negative_class 
-00000c90: 7361 6d70 6c65 2074 6f20 6d61 7463 6820  sample to match 
-00000ca0: 7468 6520 6175 676d 656e 7465 6420 706f  the augmented po
-00000cb0: 7369 7469 7665 5f63 6c61 7373 2073 697a  sitive_class siz
-00000cc0: 652e 0a20 2020 2020 2020 2054 6865 206f  e..        The o
-00000cd0: 7468 6572 2063 6c61 7373 2077 696c 6c20  ther class will 
-00000ce0: 616c 736f 2075 6e64 6572 676f 2074 6865  also undergo the
-00000cf0: 2073 616d 6520 6461 7461 2061 7567 6d65   same data augme
-00000d00: 6e74 6174 696f 6e20 7465 6368 6e69 7175  ntation techniqu
-00000d10: 6520 6275 7420 6f6e 6c79 206f 6e65 2069  e but only one i
-00000d20: 6d61 6765 2077 696c 6c20 6265 2072 6574  mage will be ret
-00000d30: 7572 6e65 640a 2020 2020 2020 2020 7065  urned.        pe
-00000d40: 7220 7361 6d70 6c65 2c20 7468 6973 2069  r sample, this i
-00000d50: 7320 746f 2065 6e73 7572 6520 626f 7468  s to ensure both
-00000d60: 2063 6c61 7373 6573 2063 6f6e 7461 696e   classes contain
-00000d70: 2074 6865 2073 616d 6520 6c65 7665 6c20   the same level 
-00000d80: 6f66 2076 6172 6961 7469 6f6e 2c20 6573  of variation, es
-00000d90: 7065 6369 616c 6c79 2069 6d70 6f72 7461  pecially importa
-00000da0: 6e74 0a20 2020 2020 2020 2077 6865 6e20  nt.        when 
-00000db0: 6170 706c 7969 6e67 2074 6865 206d 6173  applying the mas
-00000dc0: 6b2d 6375 746f 7574 2074 6563 686e 6971  k-cutout techniq
-00000dd0: 7565 2074 6f20 7468 6520 6175 676d 656e  ue to the augmen
-00000de0: 7461 7469 6f6e 2070 726f 6365 6475 7265  tation procedure
-00000df0: 2e0a 0a20 2020 2020 2020 2053 696e 6365  ...        Since
-00000e00: 2074 6865 206d 6178 696d 756d 206e 756d   the maximum num
-00000e10: 6265 7220 6f66 2061 7567 6d65 6e74 6174  ber of augmentat
-00000e20: 696f 6e73 2061 6c6c 6f77 6564 2069 7320  ions allowed is 
-00000e30: 6261 7463 685f 6d61 7820 7065 7220 6561  batch_max per ea
-00000e40: 6368 2073 616d 706c 652c 2069 6e20 7072  ch sample, in pr
-00000e50: 6163 7469 6365 206e 6567 6174 6976 655f  actice negative_
-00000e60: 636c 6173 7320 0a20 2020 2020 2020 2073  class .        s
-00000e70: 686f 756c 6420 636f 6e74 6169 6e20 6261  hould contain ba
-00000e80: 7463 685f 6d61 7820 7469 6d65 7320 7468  tch_max times th
-00000e90: 6520 7369 7a65 206f 6620 706f 7369 7469  e size of positi
-00000ea0: 7665 5f63 6c61 7373 2e20 4475 7269 6e67  ve_class. During
-00000eb0: 2074 6865 206f 7074 696d 697a 6174 696f   the optimizatio
-00000ec0: 6e20 7072 6f63 6564 7572 652c 2069 6620  n procedure, if 
-00000ed0: 616e 200a 2020 2020 2020 2020 6175 676d  an .        augm
-00000ee0: 656e 7461 7469 6f6e 2062 6174 6368 2073  entation batch s
-00000ef0: 697a 6520 6f66 2031 3030 2069 7320 6173  ize of 100 is as
-00000f00: 7365 7365 6420 616e 6420 706f 7369 7469  sesed and positi
-00000f10: 7665 2063 6c61 7373 2063 6f6e 7461 696e  ve class contain
-00000f20: 7320 6e20 7361 6d70 6c65 732c 2074 6865  s n samples, the
-00000f30: 6e20 3130 302a 6e20 6175 676d 656e 7465  n 100*n augmente
-00000f40: 6420 696d 6167 6573 2077 696c 6c20 6265  d images will be
-00000f50: 2063 7265 6174 6564 2c20 0a20 2020 2020   created, .     
-00000f60: 2020 2061 6e64 2074 6865 7265 666f 7265     and therefore
-00000f70: 2064 7572 696e 6720 7468 6174 2070 6172   during that par
-00000f80: 7469 6375 6c61 7220 7472 6961 6c20 7468  ticular trial th
-00000f90: 6520 6669 7273 7420 3130 302a 6e20 7361  e first 100*n sa
-00000fa0: 6d70 6c65 7320 6672 6f6d 206e 6567 6174  mples from negat
-00000fb0: 6976 655f 636c 6173 7320 7769 6c6c 2062  ive_class will b
-00000fc0: 6520 7573 6564 2c20 6966 2061 7661 696c  e used, if avail
-00000fd0: 6162 6c65 2e20 0a20 2020 2020 2020 2054  able. .        T
-00000fe0: 6f20 7573 6520 7468 6520 656e 7469 7265  o use the entire
-00000ff0: 206e 6567 6174 6976 655f 636c 6173 7320   negative_class 
-00001000: 7361 6d70 6c65 2072 6567 6172 646c 6573  sample regardles
-00001010: 7320 6f66 2074 6865 206e 756d 6265 7220  s of the number 
-00001020: 6175 676d 656e 7461 7469 6f6e 7320 7065  augmentations pe
-00001030: 7266 6f72 6d65 642c 2073 6574 2062 616c  rformed, set bal
-00001040: 616e 6365 3d46 616c 7365 2e0a 2020 2020  ance=False..    
-00001050: 0a20 2020 2020 2020 2054 6865 206d 696e  .        The min
-00001060: 5f70 6978 656c 2061 6e64 206d 6178 5f70  _pixel and max_p
-00001070: 6978 656c 2076 616c 7565 2077 696c 6c20  ixel value will 
-00001080: 6265 2075 7365 6420 746f 206d 696e 2d6d  be used to min-m
-00001090: 6178 206e 6f72 6d61 6c69 7a65 2074 6865  ax normalize the
-000010a0: 2069 6d61 6765 732c 2069 6620 6e6f 726d   images, if norm
-000010b0: 616c 697a 653d 5472 7565 2e20 5468 6520  alize=True. The 
-000010c0: 6f70 745f 6d61 785f 6d69 6e5f 7069 780a  opt_max_min_pix.
-000010d0: 2020 2020 2020 2020 616e 6420 6f70 745f          and opt_
-000010e0: 6d61 785f 6d61 785f 7069 782c 2077 6865  max_max_pix, whe
-000010f0: 6e20 7365 742c 2077 696c 6c20 6265 2075  n set, will be u
-00001100: 7365 6420 696e 7374 6561 6420 6475 7269  sed instead duri
-00001110: 6e67 2074 6865 206f 7074 696d 697a 6174  ng the optimizat
-00001120: 696f 6e20 7072 6f63 6564 7572 652c 2073  ion procedure, s
-00001130: 6f20 6173 2074 6f20 6465 7465 726d 696e  o as to determin
-00001140: 650a 2020 2020 2020 2020 7768 6174 206f  e.        what o
-00001150: 7074 696d 616c 206d 6178 696d 756d 2076  ptimal maximum v
-00001160: 616c 7565 2074 6f20 7573 6520 7768 656e  alue to use when
-00001170: 206e 6f72 6d61 6c69 7a69 6e67 2074 6865   normalizing the
-00001180: 2069 6d61 6765 732e 2054 6869 7320 6973   images. This is
-00001190: 2069 6d70 6f72 7461 6e74 2077 6865 6e20   important when 
-000011a0: 6465 616c 696e 6720 7769 7468 2064 6565  dealing with dee
-000011b0: 702d 7375 7276 6579 2064 6174 612e 200a  p-survey data. .
-000011c0: 2020 2020 2020 2020 4966 206f 7074 696d          If optim
-000011d0: 697a 696e 6720 7468 6520 6e6f 726d 616c  izing the normal
-000011e0: 697a 6174 696f 6e20 7363 6865 6d65 2c20  ization scheme, 
-000011f0: 7468 6520 6465 6661 756c 7420 6d69 6e5f  the default min_
-00001200: 7069 7865 6c20 7769 6c6c 2062 6520 7365  pixel will be se
-00001210: 7420 746f 207a 6572 6f2c 2061 7320 7375  t to zero, as su
-00001220: 6368 206f 6e6c 7920 7468 6520 6f70 7469  ch only the opti
-00001230: 6d61 6c20 6d61 785f 7069 7865 6c20 0a20  mal max_pixel . 
-00001240: 2020 2020 2020 2066 6f72 2065 7665 7279         for every
-00001250: 2062 616e 6420 7769 6c6c 2062 6520 6f75   band will be ou
-00001260: 7470 7574 2e0a 0a20 2020 2041 7267 733a  tput...    Args:
-00001270: 0a20 2020 2020 2020 2070 6f73 6974 6976  .        positiv
-00001280: 655f 636c 6173 7320 286e 6461 7272 6179  e_class (ndarray
-00001290: 293a 2054 6865 2073 616d 706c 6573 2066  ): The samples f
-000012a0: 6f72 2074 6865 2066 6972 7374 2063 6c61  or the first cla
-000012b0: 7373 2073 686f 756c 6420 6265 2070 6173  ss should be pas
-000012c0: 7365 642c 2077 6869 6368 2077 696c 6c20  sed, which will 
-000012d0: 6175 746f 6d61 7469 6361 6c6c 7920 0a20  automatically . 
-000012e0: 2020 2020 2020 2020 2020 2062 6520 6173             be as
-000012f0: 7369 676e 6564 2074 6865 2070 6f73 6974  signed the posit
-00001300: 6976 6520 6c61 6265 6c20 2731 272e 0a20  ive label '1'.. 
-00001310: 2020 2020 2020 206e 6567 6174 6976 655f         negative_
-00001320: 636c 6173 7320 286e 6461 7272 6179 293a  class (ndarray):
-00001330: 2054 6865 2073 616d 706c 6573 2066 6f72   The samples for
-00001340: 2074 6865 2073 6563 6f6e 6420 636c 6173   the second clas
-00001350: 7320 7368 6f75 6c64 2062 6520 7061 7373  s should be pass
-00001360: 6564 2c20 7768 6963 6820 7769 6c6c 2061  ed, which will a
-00001370: 7574 6f6d 6174 6963 616c 6c79 200a 2020  utomatically .  
-00001380: 2020 2020 2020 2020 2020 6265 2061 7373            be ass
-00001390: 6967 6e65 6420 7468 6520 6e65 6761 7469  igned the negati
-000013a0: 7665 206c 6162 656c 2027 3027 2e0a 2020  ve label '0'..  
-000013b0: 2020 2020 2020 696d 675f 6e75 6d5f 6368        img_num_ch
-000013c0: 616e 6e65 6c73 2028 696e 7429 3a20 5468  annels (int): Th
-000013d0: 6520 6e75 6d62 6572 206f 6620 6669 6c74  e number of filt
-000013e0: 6572 732e 2044 6566 6175 6c74 7320 746f  ers. Defaults to
-000013f0: 2031 2e0a 2020 2020 2020 2020 6e6f 726d   1..        norm
-00001400: 616c 697a 6520 2862 6f6f 6c2c 206f 7074  alize (bool, opt
-00001410: 696f 6e61 6c29 3a20 4966 2054 7275 6520  ional): If True 
-00001420: 7468 6520 6461 7461 2077 696c 6c20 6265  the data will be
-00001430: 206d 696e 2d6d 6178 206e 6f72 6d61 6c69   min-max normali
-00001440: 7a65 6420 7573 696e 6720 7468 6520 0a20  zed using the . 
-00001450: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-00001460: 206d 696e 2061 6e64 206d 6178 2070 6978   min and max pix
-00001470: 656c 732e 2044 6566 6175 6c74 7320 746f  els. Defaults to
-00001480: 2054 7275 652e 0a20 2020 2020 2020 206d   True..        m
-00001490: 696e 5f70 6978 656c 2028 696e 742c 206f  in_pixel (int, o
-000014a0: 7074 696f 6e61 6c29 3a20 5468 6520 6d69  ptional): The mi
-000014b0: 6e69 6d75 6d20 7069 7865 6c20 636f 756e  nimum pixel coun
-000014c0: 742c 2070 6978 656c 7320 7769 7468 2063  t, pixels with c
-000014d0: 6f75 6e74 7320 0a20 2020 2020 2020 2020  ounts .         
-000014e0: 2020 2062 656c 6f77 2074 6869 7320 7468     below this th
-000014f0: 7265 7368 6f6c 6420 7769 6c6c 2062 6520  reshold will be 
-00001500: 7365 7420 746f 2074 6869 7320 6c69 6d69  set to this limi
-00001510: 742e 2044 6566 6175 6c74 7320 746f 2030  t. Defaults to 0
-00001520: 2e0a 2020 2020 2020 2020 6d61 785f 7069  ..        max_pi
-00001530: 7865 6c20 2869 6e74 2c20 6c69 7374 2c20  xel (int, list, 
-00001540: 6f70 7469 6f6e 616c 293a 2054 6865 206d  optional): The m
-00001550: 6178 696d 756d 2070 6978 656c 2063 6f75  aximum pixel cou
-00001560: 6e74 2c20 7069 7865 6c73 2077 6974 6820  nt, pixels with 
-00001570: 636f 756e 7473 200a 2020 2020 2020 2020  counts .        
-00001580: 2020 2020 6162 6f76 6520 7468 6973 2074      above this t
-00001590: 6872 6573 686f 6c64 2077 696c 6c20 6265  hreshold will be
-000015a0: 2073 6574 2074 6f20 7468 6973 206c 696d   set to this lim
-000015b0: 6974 2e20 4465 6661 756c 7473 2074 6f20  it. Defaults to 
-000015c0: 3130 302e 2049 6620 696d 675f 6e75 6d5f  100. If img_num_
-000015d0: 6368 616e 6e65 6c73 0a20 2020 2020 2020  channels.       
-000015e0: 2020 2020 2069 7320 6e6f 7420 312c 2074       is not 1, t
-000015f0: 6865 206d 6178 5f70 6978 656c 2073 686f  he max_pixel sho
-00001600: 756c 6420 6265 2061 206c 6973 7420 636f  uld be a list co
-00001610: 6e74 6169 6e69 6e67 2074 776f 2076 616c  ntaining two val
-00001620: 7565 732c 206f 6e65 2066 6f72 2065 6163  ues, one for eac
-00001630: 6820 6261 6e64 2e0a 2020 2020 2020 2020  h band..        
-00001640: 7661 6c5f 706f 7369 7469 7665 2028 6e64  val_positive (nd
-00001650: 6172 7261 792c 206f 7074 696f 6e61 6c29  array, optional)
-00001660: 3a20 506f 7369 7469 7665 2063 6c61 7373  : Positive class
-00001670: 2064 6174 6120 746f 2062 6520 7573 6564   data to be used
-00001680: 2066 6f72 2076 616c 6964 6174 696f 6e2e   for validation.
-00001690: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-000016a0: 652e 0a20 2020 2020 2020 2076 616c 5f6e  e..        val_n
-000016b0: 6567 6174 6976 6520 286e 6461 7272 6179  egative (ndarray
-000016c0: 2c20 6f70 7469 6f6e 616c 293a 204e 6567  , optional): Neg
-000016d0: 6174 6976 6520 636c 6173 7320 6461 7461  ative class data
-000016e0: 2074 6f20 6265 2075 7365 6420 666f 7220   to be used for 
-000016f0: 7661 6c69 6461 7469 6f6e 2e20 4465 6661  validation. Defa
-00001700: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
-00001710: 2020 2020 2020 7465 7374 5f70 6f73 6974        test_posit
-00001720: 6976 6520 286e 6461 7272 6179 2c20 6f70  ive (ndarray, op
-00001730: 7469 6f6e 616c 293a 2050 6f73 6974 6976  tional): Positiv
-00001740: 6520 636c 6173 7320 6461 7461 2074 6f20  e class data to 
-00001750: 6265 2075 7365 6420 666f 7220 706f 7374  be used for post
-00001760: 2d74 7269 616c 2074 6573 7469 6e67 2e20  -trial testing. 
-00001770: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-00001780: 2e0a 2020 2020 2020 2020 7465 7374 5f6e  ..        test_n
-00001790: 6567 6174 6976 6520 286e 6461 7272 6179  egative (ndarray
-000017a0: 2c20 6f70 7469 6f6e 616c 293a 204e 6567  , optional): Neg
-000017b0: 6174 6976 6520 636c 6173 7320 6461 7461  ative class data
-000017c0: 2074 6f20 6265 2075 7365 6420 666f 7220   to be used for 
-000017d0: 706f 7374 2d74 7269 616c 2074 6573 7469  post-trial testi
-000017e0: 6e67 2e20 4465 6661 756c 7473 2074 6f20  ng. Defaults to 
-000017f0: 4e6f 6e65 2e0a 2020 2020 2020 2020 7472  None..        tr
-00001800: 6169 6e5f 6570 6f63 6873 2028 696e 7429  ain_epochs (int)
-00001810: 3a20 4e75 6d62 6572 206f 6620 6570 6f63  : Number of epoc
-00001820: 6873 2074 6f20 7468 6520 7472 6169 6e20  hs to the train 
-00001830: 7468 6520 434e 4e20 746f 2064 7572 696e  the CNN to durin
-00001840: 6720 7468 6520 6f70 7469 6d69 7a61 7469  g the optimizati
-00001850: 6f6e 2074 7269 616c 732e 2044 6566 6175  on trials. Defau
-00001860: 6c74 7320 746f 2032 352e 0a20 2020 2020  lts to 25..     
-00001870: 2020 206d 6574 7269 6320 2873 7472 293a     metric (str):
-00001880: 2041 7373 6573 6d65 6e74 206d 6574 7269   Assesment metri
-00001890: 6320 746f 2075 7365 2077 6865 6e20 626f  c to use when bo
-000018a0: 7468 2070 7275 6e69 6e67 2061 6e64 2073  th pruning and s
-000018b0: 636f 7269 6e67 2074 6865 2068 7970 6572  coring the hyper
-000018c0: 7061 7261 6d65 7465 7220 6f70 7469 6d69  parameter optimi
-000018d0: 7a61 7469 6f6e 2074 7269 616c 2e0a 2020  zation trial..  
-000018e0: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
-000018f0: 7473 2074 6f20 276c 6f73 7327 2e20 4f70  ts to 'loss'. Op
-00001900: 7469 6f6e 7320 696e 636c 7564 653a 2027  tions include: '
-00001910: 6c6f 7373 2720 2762 696e 6172 795f 6163  loss' 'binary_ac
-00001920: 6375 7261 6379 272c 2027 6631 5f73 636f  curacy', 'f1_sco
-00001930: 7265 2720 2761 6c6c 2720 6f72 2074 6865  re' 'all' or the
-00001940: 2076 616c 6964 6174 696f 6e20 6571 7569   validation equi
-00001950: 7661 6c65 6e74 7320 2865 2e67 2e20 2776  valents (e.g. 'v
-00001960: 616c 5f6c 6f73 7327 292e 0a20 2020 2020  al_loss')..     
-00001970: 2020 2070 6174 6965 6e63 6520 2869 6e74     patience (int
-00001980: 293a 204e 756d 6265 7220 6f66 2065 706f  ): Number of epo
-00001990: 6368 7320 7769 7468 6f75 7420 696d 7072  chs without impr
-000019a0: 6f76 656d 656e 7420 6265 666f 7265 2074  ovement before t
-000019b0: 6865 206f 7074 696d 697a 6174 696f 6e20  he optimization 
-000019c0: 7472 6961 6c20 6973 2074 6572 6d69 6e61  trial is termina
-000019d0: 7465 642e 2044 6566 6175 6c74 7320 746f  ted. Defaults to
-000019e0: 2030 2c20 7768 6963 680a 2020 2020 2020   0, which.      
-000019f0: 2020 2020 2020 6469 7361 626c 6573 2074        disables t
-00001a00: 6869 7320 6665 6174 7572 652e 0a20 2020  his feature..   
-00001a10: 2020 2020 2061 7665 7261 6765 2028 626f       average (bo
-00001a20: 6f6c 293a 2049 6620 4661 6c73 652c 2074  ol): If False, t
-00001a30: 6865 2064 6573 6967 6e61 7465 6420 6d65  he designated me
-00001a40: 7472 6963 2077 696c 6c20 6265 2063 616c  tric will be cal
-00001a50: 6375 6c61 7465 6420 6163 636f 7264 696e  culated accordin
-00001a60: 6720 746f 2069 7473 2076 616c 7565 2061  g to its value a
-00001a70: 7420 7468 6520 656e 6420 6f66 2074 6865  t the end of the
-00001a80: 2074 7261 696e 5f65 706f 6368 732e 200a   train_epochs. .
-00001a90: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00001aa0: 7275 652c 2074 6865 206d 6574 7269 6320  rue, the metric 
-00001ab0: 7769 6c6c 2062 6520 6176 6572 6167 6564  will be averaged
-00001ac0: 206f 7574 2061 6372 6f73 7320 616c 6c20   out across all 
-00001ad0: 7472 6169 6e5f 6570 6f63 6873 2e20 4465  train_epochs. De
-00001ae0: 6661 756c 7473 2074 6f20 5472 7565 2e0a  faults to True..
-00001af0: 2020 2020 2020 2020 6f70 745f 6d6f 6465          opt_mode
-00001b00: 6c20 2862 6f6f 6c29 3a20 4966 2054 7275  l (bool): If Tru
-00001b10: 652c 2074 6865 2061 7263 6869 7465 6374  e, the architect
-00001b20: 7572 6520 7061 7261 6d65 7465 7273 2077  ure parameters w
-00001b30: 696c 6c20 6265 206f 7074 696d 697a 6564  ill be optimized
-00001b40: 2e20 4465 6661 756c 7473 2074 6f20 5472  . Defaults to Tr
-00001b50: 7565 2e0a 2020 2020 2020 2020 6f70 745f  ue..        opt_
-00001b60: 6175 6720 2862 6f6f 6c29 3a20 4966 2054  aug (bool): If T
-00001b70: 7275 652c 2074 6865 2061 7567 6d65 6e74  rue, the augment
-00001b80: 6174 696f 6e20 7072 6f63 6564 7572 6520  ation procedure 
-00001b90: 7769 6c6c 2062 6520 6f70 7469 6d69 7a65  will be optimize
-00001ba0: 642e 2044 6566 6175 6c74 7320 746f 2046  d. Defaults to F
-00001bb0: 616c 7365 2e0a 2020 2020 2020 2020 6261  alse..        ba
-00001bc0: 7463 685f 6d69 6e20 2869 6e74 293a 2054  tch_min (int): T
-00001bd0: 6865 206d 696e 696d 756d 206e 756d 6265  he minimum numbe
-00001be0: 7220 6f66 2061 7567 6d65 6e74 6174 696f  r of augmentatio
-00001bf0: 6e73 2074 6f20 7065 7266 6f72 6d20 7065  ns to perform pe
-00001c00: 7220 696d 6167 6520 6f6e 2074 6865 2070  r image on the p
-00001c10: 6f73 6974 6976 6520 636c 6173 732c 206f  ositive class, o
-00001c20: 6e6c 7920 6170 706c 6963 6162 6c65 200a  nly applicable .
-00001c30: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00001c40: 7074 5f61 7567 3d54 7275 652e 2044 6566  pt_aug=True. Def
-00001c50: 6175 6c74 7320 746f 2032 2e0a 2020 2020  aults to 2..    
-00001c60: 2020 2020 6261 7463 685f 6d61 7820 2869      batch_max (i
-00001c70: 6e74 293a 2054 6865 206d 6178 696d 756d  nt): The maximum
-00001c80: 206e 756d 6265 7220 6f66 2061 7567 6d65   number of augme
-00001c90: 6e74 6174 696f 6e73 2074 6f20 7065 7266  ntations to perf
-00001ca0: 6f72 6d20 7065 7220 696d 6167 6520 6f6e  orm per image on
-00001cb0: 2074 6865 2070 6f73 6974 6976 6520 636c   the positive cl
-00001cc0: 6173 732c 206f 6e6c 7920 6170 706c 6963  ass, only applic
-00001cd0: 6162 6c65 200a 2020 2020 2020 2020 2020  able .          
-00001ce0: 2020 6966 206f 7074 5f61 7567 3d54 7275    if opt_aug=Tru
-00001cf0: 652e 2044 6566 6175 6c74 7320 746f 2032  e. Defaults to 2
-00001d00: 352e 0a20 2020 2020 2020 2069 6d61 6765  5..        image
-00001d10: 5f73 697a 655f 6d69 6e20 2869 6e74 293a  _size_min (int):
-00001d20: 2054 6865 206d 696e 696d 756d 2069 6d61   The minimum ima
-00001d30: 6765 2073 697a 6520 746f 2061 7373 6573  ge size to asses
-00001d40: 732c 206f 6e6c 7920 6170 706c 6963 6162  s, only applicab
-00001d50: 6c65 2069 6620 6f70 745f 6175 673d 5472  le if opt_aug=Tr
-00001d60: 7565 2e20 4465 6661 756c 7473 2074 6f20  ue. Defaults to 
-00001d70: 3530 2e0a 2020 2020 2020 2020 696d 6167  50..        imag
-00001d80: 655f 7369 7a65 5f6d 6178 2028 696e 7429  e_size_max (int)
-00001d90: 3a20 5468 6520 6d61 7869 6d75 6d20 696d  : The maximum im
-00001da0: 6167 6520 7369 7a65 2074 6f20 6173 7365  age size to asse
-00001db0: 7373 2c20 6f6e 6c79 2061 7070 6c69 6361  ss, only applica
-00001dc0: 626c 6520 6966 206f 7074 5f61 7567 3d54  ble if opt_aug=T
-00001dd0: 7275 652e 2044 6566 6175 6c74 7320 746f  rue. Defaults to
-00001de0: 2031 3030 2e0a 2020 2020 2020 2020 6f70   100..        op
-00001df0: 745f 6d61 785f 6d69 6e5f 7069 7820 2869  t_max_min_pix (i
-00001e00: 6e74 2c20 6f70 7469 6f6e 616c 293a 2054  nt, optional): T
-00001e10: 6865 206d 696e 696d 756d 206d 6178 2070  he minimum max p
-00001e20: 6978 656c 2076 616c 7565 2074 6f20 7573  ixel value to us
-00001e30: 6520 7768 656e 2074 756e 696e 6720 7468  e when tuning th
-00001e40: 6520 6e6f 726d 616c 697a 6174 696f 6e20  e normalization 
-00001e50: 7072 6f63 6564 7572 652c 200a 2020 2020  procedure, .    
-00001e60: 2020 2020 2020 2020 6f6e 6c79 2061 7070          only app
-00001e70: 6c69 6361 626c 6520 6966 206f 7074 5f61  licable if opt_a
-00001e80: 7567 3d54 7275 652e 2044 6566 6175 6c74  ug=True. Default
-00001e90: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-00001ea0: 2020 206f 7074 5f6d 6178 5f6d 6178 5f70     opt_max_max_p
-00001eb0: 6978 2028 696e 742c 206f 7074 696f 6e61  ix (int, optiona
-00001ec0: 6c29 3a20 5468 6520 6d61 7869 6d75 6d20  l): The maximum 
-00001ed0: 6d61 7820 7069 7865 6c20 7661 6c75 6520  max pixel value 
-00001ee0: 746f 2075 7365 2077 6865 6e20 7475 6e69  to use when tuni
-00001ef0: 6e67 2074 6865 206e 6f72 6d61 6c69 7a61  ng the normaliza
-00001f00: 7469 6f6e 2070 726f 6365 6475 7265 2c20  tion procedure, 
-00001f10: 0a20 2020 2020 2020 2020 2020 206f 6e6c  .            onl
-00001f20: 7920 6170 706c 6963 6162 6c65 2069 6620  y applicable if 
-00001f30: 6f70 745f 6175 673d 5472 7565 2e20 4465  opt_aug=True. De
-00001f40: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
-00001f50: 2020 2020 2020 2020 7368 6966 7420 2869          shift (i
-00001f60: 6e74 293a 2054 6865 206d 6178 2061 6c6c  nt): The max all
-00001f70: 6f77 6564 2076 6572 7469 6361 6c2f 686f  owed vertical/ho
-00001f80: 7269 7a6f 6e74 616c 2073 6869 6674 7320  rizontal shifts 
-00001f90: 746f 2075 7365 2064 7572 696e 6720 7468  to use during th
-00001fa0: 6520 6461 7461 2061 7567 6d65 6e74 6174  e data augmentat
-00001fb0: 696f 6e20 726f 7574 696e 652c 206f 6e6c  ion routine, onl
-00001fc0: 7920 6170 706c 6963 6162 6c65 0a20 2020  y applicable.   
-00001fd0: 2020 2020 2020 2020 2069 6620 6f70 745f           if opt_
-00001fe0: 6175 673d 5472 7565 2e20 4465 6661 756c  aug=True. Defaul
-00001ff0: 7473 2074 6f20 3130 2070 6978 656c 732e  ts to 10 pixels.
-00002000: 0a20 2020 2020 2020 206d 6173 6b5f 7369  .        mask_si
-00002010: 7a65 2028 696e 742c 206f 7074 696f 6e61  ze (int, optiona
-00002020: 6c29 3a20 4966 2065 6e61 626c 6564 2c20  l): If enabled, 
-00002030: 7468 6973 2077 696c 6c20 7365 7420 7468  this will set th
-00002040: 6520 7069 7865 6c20 6c65 6e67 7468 206f  e pixel length o
-00002050: 6620 6120 7371 7561 7265 2063 7574 6f75  f a square cutou
-00002060: 742c 2074 6f20 6265 2072 616e 646f 6d6c  t, to be randoml
-00002070: 7920 706c 6163 6564 0a20 2020 2020 2020  y placed.       
-00002080: 2020 2020 2073 6f6d 6577 6865 7265 2069       somewhere i
-00002090: 6e20 7468 6520 6175 676d 656e 7465 6420  n the augmented 
-000020a0: 696d 6167 652e 2054 6869 7320 6375 746f  image. This cuto
-000020b0: 7574 2077 696c 6c20 7265 706c 6163 6520  ut will replace 
-000020c0: 7468 6520 696d 6167 6520 7661 6c75 6573  the image values
-000020d0: 2077 6974 6820 302c 2074 6865 7265 666f   with 0, therefo
-000020e0: 7265 2073 6572 7669 6e67 2061 7320 6120  re serving as a 
-000020f0: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
-00002100: 756c 6172 697a 6572 2e20 4f6e 6c79 2061  ularizer. Only a
-00002110: 7070 6c69 6361 626c 6520 6966 206f 7074  pplicable if opt
-00002120: 5f61 7567 3d54 7275 652e 2044 6566 6175  _aug=True. Defau
-00002130: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
-00002140: 2020 2020 206e 756d 5f6d 6173 6b73 2028       num_masks (
-00002150: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
-00002160: 5468 6520 6e75 6d62 6572 206f 6620 6d61  The number of ma
-00002170: 736b 7320 746f 2063 7265 6174 652c 2074  sks to create, t
-00002180: 6f20 6265 2075 7365 6420 616c 6f6e 6773  o be used alongs
-00002190: 6964 6520 7468 6520 6d61 736b 5f73 697a  ide the mask_siz
-000021a0: 6520 7061 7261 6d65 7465 722e 2049 6620  e parameter. If 
-000021b0: 0a20 2020 2020 2020 2020 2020 2074 6869  .            thi
-000021c0: 7320 6973 2073 6574 2074 6f20 6120 7661  s is set to a va
-000021d0: 6c75 6520 6772 6561 7465 7220 7468 616e  lue greater than
-000021e0: 206f 6e65 2c20 6f76 6572 6c61 7020 6d61   one, overlap ma
-000021f0: 7920 6f63 6375 722e 200a 2020 2020 2020  y occur. .      
-00002200: 2020 7665 7262 6f73 6520 2869 6e74 293a    verbose (int):
-00002210: 2043 6f6e 7472 6f6c 7320 7468 6520 616d   Controls the am
-00002220: 6f75 6e74 206f 6620 6f75 7470 7574 2070  ount of output p
-00002230: 7269 6e74 6564 2064 7572 696e 6720 7468  rinted during th
-00002240: 6520 7472 6169 6e69 6e67 2070 726f 6365  e training proce
-00002250: 7373 2e20 4120 7661 6c75 6520 6f66 2030  ss. A value of 0
-00002260: 2069 7320 666f 7220 7369 6c65 6e74 206d   is for silent m
-00002270: 6f64 652c 200a 2020 2020 2020 2020 2020  ode, .          
-00002280: 2020 6120 7661 6c75 6520 6f66 2031 2069    a value of 1 i
-00002290: 7320 7573 6564 2066 6f72 2070 726f 6772  s used for progr
-000022a0: 6573 7320 6261 7220 6d6f 6465 2c20 616e  ess bar mode, an
-000022b0: 6420 3220 666f 7220 6f6e 6520 6c69 6e65  d 2 for one line
-000022c0: 2070 6572 2065 706f 6368 206d 6f64 652e   per epoch mode.
-000022d0: 2044 6566 6175 6c74 7320 746f 2031 2e0a   Defaults to 1..
-000022e0: 2020 2020 2020 2020 6f70 745f 6376 2028          opt_cv (
-000022f0: 696e 7429 3a20 4372 6f73 732d 7661 6c69  int): Cross-vali
-00002300: 6461 7469 6f6e 7320 746f 2070 6572 666f  dations to perfo
-00002310: 726d 2077 6865 6e20 6173 7365 7373 696e  rm when assessin
-00002320: 6720 7468 6520 7065 7266 6f72 6d61 6e63  g the performanc
-00002330: 6520 6174 2065 6163 680a 2020 2020 2020  e at each.      
-00002340: 2020 2020 2020 6879 7065 7270 6172 616d        hyperparam
-00002350: 6574 6572 206f 7074 696d 697a 6174 696f  eter optimizatio
-00002360: 6e20 7472 6961 6c2e 2046 6f72 2065 7861  n trial. For exa
-00002370: 6d70 6c65 2c20 6966 2063 763d 332c 2074  mple, if cv=3, t
-00002380: 6865 6e20 6561 6368 206f 7074 696d 697a  hen each optimiz
-00002390: 6174 696f 6e20 7472 6961 6c0a 2020 2020  ation trial.    
-000023a0: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-000023b0: 6173 7365 7373 6564 2061 6363 6f72 6469  assessed accordi
-000023c0: 6e67 2074 6f20 7468 6520 332d 666f 6c64  ng to the 3-fold
-000023d0: 2063 726f 7373 2076 616c 6964 6174 696f   cross validatio
-000023e0: 6e20 6163 6375 7261 6379 2e20 4465 6661  n accuracy. Defa
-000023f0: 756c 7473 2074 6f20 3130 2e0a 2020 2020  ults to 10..    
-00002400: 2020 2020 2020 2020 4e4f 5445 3a20 5468          NOTE: Th
-00002410: 6520 6869 6768 6572 2074 6869 7320 6e75  e higher this nu
-00002420: 6d62 6572 2c20 7468 6520 6c6f 6e67 6572  mber, the longer
-00002430: 2074 6865 206f 7074 696d 697a 6174 696f   the optimizatio
-00002440: 6e20 7769 6c6c 2074 616b 652e 0a20 2020  n will take..   
-00002450: 2020 2020 2062 616c 616e 6365 2028 626f       balance (bo
-00002460: 6f6c 2c20 6f70 7469 6f6e 616c 293a 2054  ol, optional): T
-00002470: 6869 7320 7769 6c6c 2064 6574 6572 6d69  his will determi
-00002480: 6e65 2077 6865 7468 6572 2074 6865 2074  ne whether the t
-00002490: 776f 2063 6c61 7373 6573 0a20 2020 2020  wo classes.     
-000024a0: 2020 2020 2020 2061 7265 206b 6570 7420         are kept 
-000024b0: 7468 6520 7361 6d65 2073 697a 6520 6475  the same size du
-000024c0: 7269 6e67 206f 7074 696d 697a 6174 696f  ring optimizatio
-000024d0: 6e2c 2061 7070 6c69 6361 626c 6520 6966  n, applicable if
-000024e0: 2074 756e 696e 6720 7468 6520 6175 676d   tuning the augm
-000024f0: 656e 7461 7469 6f6e 0a20 2020 2020 2020  entation.       
-00002500: 2020 2020 2070 6172 616d 6574 6572 732e       parameters.
-00002510: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
-00002520: 652e 0a20 2020 2020 2020 206c 696d 6974  e..        limit
-00002530: 5f73 6561 7263 6820 2862 6f6f 6c29 3a20  _search (bool): 
-00002540: 5768 6574 6865 7220 746f 2065 7870 616e  Whether to expan
-00002550: 6420 7468 6520 6879 7065 7270 6172 616d  d the hyperparam
-00002560: 6574 6572 2073 6561 7263 6820 7370 6163  eter search spac
-00002570: 652e 2049 6620 636c 663d 2763 6e6e 272c  e. If clf='cnn',
-00002580: 2074 6869 7320 7769 6c6c 200a 2020 2020   this will .    
-00002590: 2020 2020 2020 2020 696e 636c 7564 6520          include 
-000025a0: 7468 6520 7475 6e69 6e67 206f 6620 7468  the tuning of th
-000025b0: 6520 696e 6469 7669 6475 616c 206c 6179  e individual lay
-000025c0: 6572 2070 6172 616d 6574 6572 7320 7375  er parameters su
-000025d0: 6368 2061 7320 7468 6520 6e75 6d62 6572  ch as the number
-000025e0: 206f 6620 6669 6c74 6572 2c20 7369 7a65   of filter, size
-000025f0: 2026 2073 7472 6964 652e 0a20 2020 2020   & stride..     
-00002600: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
-00002610: 746f 2054 7275 6520 6475 6520 746f 206d  to True due to m
-00002620: 656d 6f72 7920 616c 6c6f 6361 7469 6f6e  emory allocation
-00002630: 2069 7373 7565 7320 7768 656e 2068 616e   issues when han
-00002640: 646c 696e 6720 6c6f 7473 206f 6620 7475  dling lots of tu
-00002650: 6e61 626c 6520 7061 7261 6d65 7465 7273  nable parameters
-00002660: 2e0a 2020 2020 2020 2020 6261 7463 685f  ..        batch_
-00002670: 7369 7a65 5f6d 696e 2028 696e 7429 3a20  size_min (int): 
-00002680: 5468 6520 6d69 6e69 6d75 6d20 6261 7463  The minimum batc
-00002690: 6820 7369 7a65 2074 6f20 7573 6520 6475  h size to use du
-000026a0: 7269 6e67 2074 7261 696e 696e 672e 2053  ring training. S
-000026b0: 686f 756c 6420 6265 206d 756c 7469 706c  hould be multipl
-000026c0: 6573 206f 6620 3136 2066 6f72 206f 7074  es of 16 for opt
-000026d0: 696d 616c 2068 6172 6477 6172 6520 7573  imal hardware us
-000026e0: 653f 3f20 4465 6661 756c 7473 2074 6f20  e?? Defaults to 
-000026f0: 3136 2e0a 2020 2020 2020 2020 6261 7463  16..        batc
-00002700: 685f 7369 7a65 5f6d 6178 2028 696e 7429  h_size_max (int)
-00002710: 3a20 5468 6520 4d61 7869 6d75 6d20 6261  : The Maximum ba
-00002720: 7463 6820 7369 7a65 2074 6f20 7573 6520  tch size to use 
-00002730: 6475 7269 6e67 2074 7261 696e 696e 672e  during training.
-00002740: 2053 686f 756c 6420 6265 206d 756c 7469   Should be multi
-00002750: 706c 6573 206f 6620 3136 2066 6f72 206f  ples of 16 for o
-00002760: 7074 696d 616c 2068 6172 6477 6172 6520  ptimal hardware 
-00002770: 7573 653f 3f20 4465 6661 756c 7473 2074  use?? Defaults t
-00002780: 6f20 3634 2e0a 2020 2020 2020 2020 7472  o 64..        tr
-00002790: 6169 6e5f 6163 635f 7468 7265 7368 6f6c  ain_acc_threshol
-000027a0: 6420 2866 6c6f 6174 2c20 6f70 7469 6f6e  d (float, option
-000027b0: 616c 293a 2041 2076 616c 7565 2062 6574  al): A value bet
-000027c0: 7765 656e 2030 2061 6e64 2031 2074 6861  ween 0 and 1 tha
-000027d0: 7420 6465 7369 676e 6174 6573 2074 6865  t designates the
-000027e0: 2074 7261 696e 696e 6720 6269 6e61 7279   training binary
-000027f0: 5f61 6363 7572 6163 7920 7468 7265 7368  _accuracy thresh
-00002800: 6f6c 6420 7468 6174 2073 686f 756c 640a  old that should.
-00002810: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
-00002820: 6265 2065 7863 6565 6465 642e 2041 7320  be exceeded. As 
-00002830: 736f 6f6e 2061 7320 7468 6520 7472 6169  soon as the trai
-00002840: 6e69 6e67 2065 7863 6565 6473 2074 6869  ning exceeds thi
-00002850: 7320 6c69 6d69 742c 2074 6865 2074 7269  s limit, the tri
-00002860: 616c 2069 7320 7374 6f70 7065 6420 6561  al is stopped ea
-00002870: 726c 792e 2044 6566 6175 6c74 7320 746f  rly. Defaults to
-00002880: 204e 6f6e 652e 0a20 2020 2020 2020 206d   None..        m
-00002890: 6f6e 6974 6f72 3120 2873 7472 2c20 6f70  onitor1 (str, op
-000028a0: 7469 6f6e 616c 293a 2054 6865 2066 6972  tional): The fir
-000028b0: 7374 206d 6574 7269 6320 746f 206d 6f6e  st metric to mon
-000028c0: 6974 6f72 2c20 6361 6e20 7461 6b65 2074  itor, can take t
-000028d0: 6865 2073 616d 6520 7661 6c75 6573 2061  he same values a
-000028e0: 7320 7468 6520 6d65 7472 6963 2061 7267  s the metric arg
-000028f0: 756d 656e 742e 2044 6566 6175 6c74 7320  ument. Defaults 
-00002900: 746f 204e 6f6e 652e 0a20 2020 2020 2020  to None..       
-00002910: 206d 6f6e 6974 6f72 3220 2873 7472 2c20   monitor2 (str, 
-00002920: 6f70 7469 6f6e 616c 293a 2054 6865 2073  optional): The s
-00002930: 6563 6f6e 6420 6d65 7472 6963 2074 6f20  econd metric to 
-00002940: 6d6f 6e69 746f 722c 2063 616e 2074 616b  monitor, can tak
-00002950: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
-00002960: 7320 6173 2074 6865 206d 6574 7269 6320  s as the metric 
-00002970: 6172 6775 6d65 6e74 2e20 4465 6661 756c  argument. Defaul
-00002980: 7473 2074 6f20 4e6f 6e65 2e0a 2020 2020  ts to None..    
-00002990: 2020 2020 6d6f 6e69 746f 7231 5f74 6872      monitor1_thr
-000029a0: 6573 6820 2866 6c6f 6174 2c20 6f70 7469  esh (float, opti
-000029b0: 6f6e 616c 293a 2054 6865 2074 6872 6573  onal): The thres
-000029c0: 686f 6c64 2076 616c 7565 206f 6620 7468  hold value of th
-000029d0: 6520 6669 7273 7420 6d6f 6e69 746f 7220  e first monitor 
-000029e0: 6d65 7472 6963 2e20 4966 2074 6865 206d  metric. If the m
-000029f0: 6574 7269 6320 6973 206c 6f73 732d 7265  etric is loss-re
-00002a00: 6c61 7465 640a 2020 2020 2020 2020 2020  lated.          
-00002a10: 2020 7468 6520 7472 6169 6e69 6e67 2077    the training w
-00002a20: 696c 6c20 7374 6f70 2065 6172 6c79 2069  ill stop early i
-00002a30: 6620 7468 6520 7661 6c75 6520 6661 6c6c  f the value fall
-00002a40: 7320 6265 6c6f 7720 7468 6973 2074 6872  s below this thr
-00002a50: 6573 686f 6c64 2e20 5369 6d69 6c61 726c  eshold. Similarl
-00002a60: 792c 2069 6620 7468 6520 6d65 7472 6963  y, if the metric
-00002a70: 2069 7320 6163 6375 7261 6379 2d72 656c   is accuracy-rel
-00002a80: 6174 6564 2c0a 2020 2020 2020 2020 2020  ated,.          
-00002a90: 2020 7468 656e 2074 6865 2074 7261 696e    then the train
-00002aa0: 696e 6720 7769 6c6c 2073 746f 7020 6561  ing will stop ea
-00002ab0: 726c 7920 6966 2074 6865 2076 616c 7565  rly if the value
-00002ac0: 2066 616c 6c73 2061 626f 7665 2074 6869   falls above thi
-00002ad0: 7320 7468 7265 7368 6f6c 642e 2044 6566  s threshold. Def
-00002ae0: 6175 6c74 7320 746f 204e 6f6e 652e 0a20  aults to None.. 
-00002af0: 2020 2020 2020 206d 6f6e 6974 6f72 325f         monitor2_
-00002b00: 7468 7265 7368 2028 666c 6f61 742c 206f  thresh (float, o
-00002b10: 7074 696f 6e61 6c29 3a20 5468 6520 7468  ptional): The th
-00002b20: 7265 7368 6f6c 6420 7661 6c75 6520 6f66  reshold value of
-00002b30: 2074 6865 2073 6563 6f6e 6420 6d6f 6e69   the second moni
-00002b40: 746f 7220 6d65 7472 6963 2e20 4966 2074  tor metric. If t
-00002b50: 6865 206d 6574 7269 6320 6973 206c 6f73  he metric is los
-00002b60: 732d 7265 6c61 7465 640a 2020 2020 2020  s-related.      
-00002b70: 2020 2020 2020 7468 6520 7472 6169 6e69        the traini
-00002b80: 6e67 2077 696c 6c20 7374 6f70 2065 6172  ng will stop ear
-00002b90: 6c79 2069 6620 7468 6520 7661 6c75 6520  ly if the value 
-00002ba0: 6661 6c6c 7320 6265 6c6f 7720 7468 6973  falls below this
-00002bb0: 2074 6872 6573 686f 6c64 2e20 5369 6d69   threshold. Simi
-00002bc0: 6c61 726c 792c 2069 6620 7468 6520 6d65  larly, if the me
-00002bd0: 7472 6963 2069 7320 6163 6375 7261 6379  tric is accuracy
-00002be0: 2d72 656c 6174 6564 2c0a 2020 2020 2020  -related,.      
-00002bf0: 2020 2020 2020 7468 656e 2074 6865 2074        then the t
-00002c00: 7261 696e 696e 6720 7769 6c6c 2073 746f  raining will sto
-00002c10: 7020 6561 726c 7920 6966 2074 6865 2076  p early if the v
-00002c20: 616c 7565 2066 616c 6c73 2061 626f 7665  alue falls above
-00002c30: 2074 6869 7320 7468 7265 7368 6f6c 642e   this threshold.
-00002c40: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00002c50: 652e 0a20 2020 2020 2020 200a 2020 2020  e..        .    
-00002c60: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-00002c70: 2054 6865 2070 6572 666f 726d 616e 6365   The performance
-00002c80: 206d 6574 7269 632e 0a20 2020 2022 2222   metric..    """
-00002c90: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00002ca0: 5f5f 2873 656c 662c 2070 6f73 6974 6976  __(self, positiv
-00002cb0: 655f 636c 6173 732c 206e 6567 6174 6976  e_class, negativ
-00002cc0: 655f 636c 6173 732c 2069 6d67 5f6e 756d  e_class, img_num
-00002cd0: 5f63 6861 6e6e 656c 733d 312c 206e 6f72  _channels=1, nor
-00002ce0: 6d61 6c69 7a65 3d54 7275 652c 206d 696e  malize=True, min
-00002cf0: 5f70 6978 656c 3d30 2c20 6d61 785f 7069  _pixel=0, max_pi
-00002d00: 7865 6c3d 3130 302c 200a 2020 2020 2020  xel=100, .      
-00002d10: 2020 7661 6c5f 706f 7369 7469 7665 3d4e    val_positive=N
-00002d20: 6f6e 652c 2076 616c 5f6e 6567 6174 6976  one, val_negativ
-00002d30: 653d 4e6f 6e65 2c20 7465 7374 5f70 6f73  e=None, test_pos
-00002d40: 6974 6976 653d 4e6f 6e65 2c20 7465 7374  itive=None, test
-00002d50: 5f6e 6567 6174 6976 653d 4e6f 6e65 2c20  _negative=None, 
-00002d60: 7472 6169 6e5f 6570 6f63 6873 3d32 352c  train_epochs=25,
-00002d70: 2070 6174 6965 6e63 653d 3230 2c20 0a20   patience=20, . 
-00002d80: 2020 2020 2020 206f 7074 5f6d 6f64 656c         opt_model
-00002d90: 3d54 7275 652c 206f 7074 5f61 7567 3d46  =True, opt_aug=F
-00002da0: 616c 7365 2c20 6261 7463 685f 6d69 6e3d  alse, batch_min=
-00002db0: 322c 2062 6174 6368 5f6d 6178 3d32 352c  2, batch_max=25,
-00002dc0: 2069 6d61 6765 5f73 697a 655f 6d69 6e3d   image_size_min=
-00002dd0: 3530 2c20 696d 6167 655f 7369 7a65 5f6d  50, image_size_m
-00002de0: 6178 3d31 3030 2c20 0a20 2020 2020 2020  ax=100, .       
-00002df0: 2062 616c 616e 6365 3d54 7275 652c 206f   balance=True, o
-00002e00: 7074 5f6d 6178 5f6d 696e 5f70 6978 3d4e  pt_max_min_pix=N
-00002e10: 6f6e 652c 206f 7074 5f6d 6178 5f6d 6178  one, opt_max_max
-00002e20: 5f70 6978 3d4e 6f6e 652c 206d 6574 7269  _pix=None, metri
-00002e30: 633d 276c 6f73 7327 2c20 6176 6572 6167  c='loss', averag
-00002e40: 653d 5472 7565 2c20 7368 6966 743d 3130  e=True, shift=10
-00002e50: 2c0a 2020 2020 2020 2020 6d61 736b 5f73  ,.        mask_s
-00002e60: 697a 653d 4e6f 6e65 2c20 6e75 6d5f 6d61  ize=None, num_ma
-00002e70: 736b 733d 4e6f 6e65 2c20 6f70 745f 6376  sks=None, opt_cv
-00002e80: 3d4e 6f6e 652c 2076 6572 626f 7365 3d30  =None, verbose=0
-00002e90: 2c20 7472 6169 6e5f 6163 635f 7468 7265  , train_acc_thre
-00002ea0: 7368 6f6c 643d 4e6f 6e65 2c20 736d 6f74  shold=None, smot
-00002eb0: 655f 7361 6d70 6c69 6e67 3d30 2c0a 2020  e_sampling=0,.  
-00002ec0: 2020 2020 2020 6c69 6d69 745f 7365 6172        limit_sear
-00002ed0: 6368 3d54 7275 652c 2062 6174 6368 5f73  ch=True, batch_s
-00002ee0: 697a 655f 6d69 6e3d 3136 2c20 6261 7463  ize_min=16, batc
-00002ef0: 685f 7369 7a65 5f6d 6178 3d36 342c 206d  h_size_max=64, m
-00002f00: 6f6e 6974 6f72 313d 4e6f 6e65 2c20 6d6f  onitor1=None, mo
-00002f10: 6e69 746f 7232 3d4e 6f6e 652c 206d 6f6e  nitor2=None, mon
-00002f20: 6974 6f72 315f 7468 7265 7368 3d4e 6f6e  itor1_thresh=Non
-00002f30: 652c 206d 6f6e 6974 6f72 325f 7468 7265  e, monitor2_thre
-00002f40: 7368 3d4e 6f6e 6529 3a0a 0a20 2020 2020  sh=None):..     
-00002f50: 2020 2073 656c 662e 706f 7369 7469 7665     self.positive
-00002f60: 5f63 6c61 7373 203d 2070 6f73 6974 6976  _class = positiv
-00002f70: 655f 636c 6173 730a 2020 2020 2020 2020  e_class.        
-00002f80: 7365 6c66 2e6e 6567 6174 6976 655f 636c  self.negative_cl
-00002f90: 6173 7320 3d20 6e65 6761 7469 7665 5f63  ass = negative_c
-00002fa0: 6c61 7373 0a20 2020 2020 2020 2073 656c  lass.        sel
-00002fb0: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
-00002fc0: 6c73 203d 2069 6d67 5f6e 756d 5f63 6861  ls = img_num_cha
-00002fd0: 6e6e 656c 730a 2020 2020 2020 2020 7365  nnels.        se
-00002fe0: 6c66 2e6e 6f72 6d61 6c69 7a65 203d 206e  lf.normalize = n
-00002ff0: 6f72 6d61 6c69 7a65 200a 2020 2020 2020  ormalize .      
-00003000: 2020 7365 6c66 2e6d 696e 5f70 6978 656c    self.min_pixel
-00003010: 203d 206d 696e 5f70 6978 656c 0a20 2020   = min_pixel.   
-00003020: 2020 2020 2073 656c 662e 6d61 785f 7069       self.max_pi
-00003030: 7865 6c20 3d20 6d61 785f 7069 7865 6c0a  xel = max_pixel.
-00003040: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
-00003050: 5f70 6f73 6974 6976 6520 3d20 7661 6c5f  _positive = val_
-00003060: 706f 7369 7469 7665 0a20 2020 2020 2020  positive.       
-00003070: 2073 656c 662e 7661 6c5f 6e65 6761 7469   self.val_negati
-00003080: 7665 203d 2076 616c 5f6e 6567 6174 6976  ve = val_negativ
-00003090: 650a 2020 2020 2020 2020 7365 6c66 2e74  e.        self.t
-000030a0: 6573 745f 706f 7369 7469 7665 203d 2074  est_positive = t
-000030b0: 6573 745f 706f 7369 7469 7665 0a20 2020  est_positive.   
-000030c0: 2020 2020 2073 656c 662e 7465 7374 5f6e       self.test_n
-000030d0: 6567 6174 6976 6520 3d20 7465 7374 5f6e  egative = test_n
-000030e0: 6567 6174 6976 650a 2020 2020 2020 2020  egative.        
-000030f0: 7365 6c66 2e62 6174 6368 5f73 697a 655f  self.batch_size_
-00003100: 6d69 6e20 3d20 6261 7463 685f 7369 7a65  min = batch_size
-00003110: 5f6d 696e 0a20 2020 2020 2020 2073 656c  _min.        sel
-00003120: 662e 6261 7463 685f 7369 7a65 5f6d 6178  f.batch_size_max
-00003130: 203d 2062 6174 6368 5f73 697a 655f 6d61   = batch_size_ma
-00003140: 780a 0a20 2020 2020 2020 2073 656c 662e  x..        self.
-00003150: 7472 6169 6e5f 6570 6f63 6873 203d 2074  train_epochs = t
-00003160: 7261 696e 5f65 706f 6368 730a 2020 2020  rain_epochs.    
-00003170: 2020 2020 7365 6c66 2e70 6174 6965 6e63      self.patienc
-00003180: 6520 3d20 7061 7469 656e 6365 200a 2020  e = patience .  
-00003190: 2020 2020 2020 7365 6c66 2e6f 7074 5f6d        self.opt_m
-000031a0: 6f64 656c 203d 206f 7074 5f6d 6f64 656c  odel = opt_model
-000031b0: 2020 0a20 2020 2020 2020 2073 656c 662e    .        self.
-000031c0: 6f70 745f 6175 6720 3d20 6f70 745f 6175  opt_aug = opt_au
-000031d0: 670a 2020 2020 2020 2020 7365 6c66 2e62  g.        self.b
-000031e0: 6174 6368 5f6d 696e 203d 2062 6174 6368  atch_min = batch
-000031f0: 5f6d 696e 200a 2020 2020 2020 2020 7365  _min .        se
-00003200: 6c66 2e62 6174 6368 5f6d 6178 203d 2062  lf.batch_max = b
-00003210: 6174 6368 5f6d 6178 200a 2020 2020 2020  atch_max .      
-00003220: 2020 7365 6c66 2e69 6d61 6765 5f73 697a    self.image_siz
-00003230: 655f 6d69 6e20 3d20 696d 6167 655f 7369  e_min = image_si
-00003240: 7a65 5f6d 696e 0a20 2020 2020 2020 2073  ze_min.        s
-00003250: 656c 662e 696d 6167 655f 7369 7a65 5f6d  elf.image_size_m
-00003260: 6178 203d 2069 6d61 6765 5f73 697a 655f  ax = image_size_
-00003270: 6d61 780a 2020 2020 2020 2020 7365 6c66  max.        self
-00003280: 2e62 616c 616e 6365 203d 2062 616c 616e  .balance = balan
-00003290: 6365 0a20 2020 2020 2020 2073 656c 662e  ce.        self.
-000032a0: 6f70 745f 6d61 785f 6d69 6e5f 7069 7820  opt_max_min_pix 
-000032b0: 3d20 6f70 745f 6d61 785f 6d69 6e5f 7069  = opt_max_min_pi
-000032c0: 780a 2020 2020 2020 2020 7365 6c66 2e6f  x.        self.o
-000032d0: 7074 5f6d 6178 5f6d 6178 5f70 6978 203d  pt_max_max_pix =
-000032e0: 206f 7074 5f6d 6178 5f6d 6178 5f70 6978   opt_max_max_pix
-000032f0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-00003300: 7472 6963 203d 206d 6574 7269 6320 0a20  tric = metric . 
-00003310: 2020 2020 2020 2073 656c 662e 6176 6572         self.aver
-00003320: 6167 6520 3d20 6176 6572 6167 650a 2020  age = average.  
-00003330: 2020 2020 2020 7365 6c66 2e73 6869 6674        self.shift
-00003340: 203d 2073 6869 6674 200a 2020 2020 2020   = shift .      
-00003350: 2020 7365 6c66 2e6f 7074 5f63 7620 3d20    self.opt_cv = 
-00003360: 6f70 745f 6376 0a20 2020 2020 2020 2073  opt_cv.        s
-00003370: 656c 662e 7665 7262 6f73 6520 3d20 7665  elf.verbose = ve
-00003380: 7262 6f73 650a 2020 2020 2020 2020 7365  rbose.        se
-00003390: 6c66 2e6d 6173 6b5f 7369 7a65 203d 206d  lf.mask_size = m
-000033a0: 6173 6b5f 7369 7a65 0a20 2020 2020 2020  ask_size.       
-000033b0: 2073 656c 662e 6e75 6d5f 6d61 736b 7320   self.num_masks 
-000033c0: 3d20 6e75 6d5f 6d61 736b 730a 2020 2020  = num_masks.    
-000033d0: 2020 2020 7365 6c66 2e74 7261 696e 5f61      self.train_a
-000033e0: 6363 5f74 6872 6573 686f 6c64 203d 2074  cc_threshold = t
-000033f0: 7261 696e 5f61 6363 5f74 6872 6573 686f  rain_acc_thresho
-00003400: 6c64 0a20 2020 2020 2020 2073 656c 662e  ld.        self.
-00003410: 6c69 6d69 745f 7365 6172 6368 203d 206c  limit_search = l
-00003420: 696d 6974 5f73 6561 7263 680a 0a20 2020  imit_search..   
-00003430: 2020 2020 2073 656c 662e 6d6f 6e69 746f       self.monito
-00003440: 7231 203d 206d 6f6e 6974 6f72 310a 2020  r1 = monitor1.  
-00003450: 2020 2020 2020 7365 6c66 2e6d 6f6e 6974        self.monit
-00003460: 6f72 3220 3d20 6d6f 6e69 746f 7232 0a20  or2 = monitor2. 
-00003470: 2020 2020 2020 2073 656c 662e 6d6f 6e69         self.moni
-00003480: 746f 7231 5f74 6872 6573 6820 3d20 6d6f  tor1_thresh = mo
-00003490: 6e69 746f 7231 5f74 6872 6573 680a 2020  nitor1_thresh.  
-000034a0: 2020 2020 2020 7365 6c66 2e6d 6f6e 6974        self.monit
-000034b0: 6f72 325f 7468 7265 7368 203d 206d 6f6e  or2_thresh = mon
-000034c0: 6974 6f72 325f 7468 7265 7368 0a20 2020  itor2_thresh.   
-000034d0: 2020 2020 2073 656c 662e 736d 6f74 655f       self.smote_
-000034e0: 7361 6d70 6c69 6e67 203d 2073 6d6f 7465  sampling = smote
-000034f0: 5f73 616d 706c 696e 670a 0a20 2020 2020  _sampling..     
-00003500: 2020 2069 6620 2761 6c6c 2720 6e6f 7420     if 'all' not 
-00003510: 696e 2073 656c 662e 6d65 7472 6963 2061  in self.metric a
-00003520: 6e64 2027 6c6f 7373 2720 6e6f 7420 696e  nd 'loss' not in
-00003530: 2073 656c 662e 6d65 7472 6963 2061 6e64   self.metric and
-00003540: 2027 6631 5f73 636f 7265 2720 6e6f 7420   'f1_score' not 
-00003550: 696e 2073 656c 662e 6d65 7472 6963 2061  in self.metric a
-00003560: 6e64 2027 6269 6e61 7279 5f61 6363 7572  nd 'binary_accur
-00003570: 6163 7927 206e 6f74 2069 6e20 7365 6c66  acy' not in self
-00003580: 2e6d 6574 7269 633a 0a20 2020 2020 2020  .metric:.       
-00003590: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000035a0: 4572 726f 7228 2249 6e76 616c 6964 206d  Error("Invalid m
-000035b0: 6574 7269 6320 696e 7075 742c 206f 7074  etric input, opt
-000035c0: 696f 6e73 2061 7265 3a20 276c 6f73 7327  ions are: 'loss'
-000035d0: 2c20 2762 696e 6172 795f 6163 6375 7261  , 'binary_accura
-000035e0: 6379 272c 2027 6631 5f73 636f 7265 272c  cy', 'f1_score',
-000035f0: 206f 7220 2761 6c6c 272c 2061 6e64 2074   or 'all', and t
-00003600: 6865 2076 616c 6964 6174 696f 6e20 6571  he validation eq
-00003610: 7569 7661 6c65 6e74 7320 2861 6464 2076  uivalents (add v
-00003620: 616c 5f20 6174 2074 6865 2062 6567 696e  al_ at the begin
-00003630: 6e69 6e67 292e 2229 0a20 2020 2020 2020  ning).").       
-00003640: 200a 2020 2020 2020 2020 6966 2073 656c   .        if sel
-00003650: 662e 6d65 7472 6963 203d 3d20 2776 616c  f.metric == 'val
-00003660: 5f6c 6f73 7327 206f 7220 7365 6c66 2e6d  _loss' or self.m
-00003670: 6574 7269 6320 3d3d 2027 7661 6c5f 6269  etric == 'val_bi
-00003680: 6e61 7279 5f61 6363 7572 6163 7927 3a0a  nary_accuracy':.
-00003690: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000036a0: 656c 662e 7661 6c5f 706f 7369 7469 7665  elf.val_positive
-000036b0: 2069 7320 4e6f 6e65 2061 6e64 2073 656c   is None and sel
-000036c0: 662e 7661 6c5f 6e65 6761 7469 7665 2069  f.val_negative i
-000036d0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000036e0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000036f0: 6c75 6545 7272 6f72 2827 4e6f 2076 616c  lueError('No val
-00003700: 6964 6174 696f 6e20 6461 7461 2069 6e70  idation data inp
-00003710: 7574 2c20 6368 616e 6765 2074 6865 206d  ut, change the m
-00003720: 6574 7269 6320 746f 2065 6974 6865 7220  etric to either 
-00003730: 226c 6f73 7322 206f 7220 2262 696e 6172  "loss" or "binar
-00003740: 795f 6163 6375 7261 6379 222e 2729 0a0a  y_accuracy".')..
-00003750: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00003760: 6f70 745f 6d61 785f 6d69 6e5f 7069 7820  opt_max_min_pix 
-00003770: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00003780: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00003790: 2e6f 7074 5f6d 6178 5f6d 6178 5f70 6978  .opt_max_max_pix
-000037a0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000037b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000037c0: 5661 6c75 6545 7272 6f72 2827 546f 206f  ValueError('To o
-000037d0: 7074 696d 697a 6520 6d69 6e2f 6d61 7820  ptimize min/max 
-000037e0: 6e6f 726d 616c 697a 6174 696f 6e20 7069  normalization pi
-000037f0: 7865 6c20 7661 6c75 652c 2062 6f74 6820  xel value, both 
-00003800: 6f70 745f 6d69 6e5f 7069 7820 616e 6420  opt_min_pix and 
-00003810: 6f70 745f 6d61 785f 7069 7820 6d75 7374  opt_max_pix must
-00003820: 2062 6520 696e 7075 7427 290a 0a20 2020   be input')..   
-00003830: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
-00003840: 5f6d 6178 5f6d 6178 5f70 6978 2069 7320  _max_max_pix is 
-00003850: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00003860: 2020 2020 2020 6966 2073 656c 662e 6f70        if self.op
-00003870: 745f 6d61 785f 6d69 6e5f 7069 7820 6973  t_max_min_pix is
-00003880: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00003890: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000038a0: 7565 4572 726f 7228 2754 6f20 6f70 7469  ueError('To opti
-000038b0: 6d69 7a65 206d 696e 2f6d 6178 206e 6f72  mize min/max nor
-000038c0: 6d61 6c69 7a61 7469 6f6e 2070 6978 656c  malization pixel
-000038d0: 2076 616c 7565 2c20 626f 7468 206f 7074   value, both opt
-000038e0: 5f6d 696e 5f70 6978 2061 6e64 206f 7074  _min_pix and opt
-000038f0: 5f6d 6178 5f70 6978 206d 7573 7420 6265  _max_pix must be
-00003900: 2069 6e70 7574 2729 0a0a 2020 2020 6465   input')..    de
-00003910: 6620 5f5f 6361 6c6c 5f5f 2873 656c 662c  f __call__(self,
-00003920: 2074 7269 616c 293a 0a0a 2020 2020 2020   trial):..      
-00003930: 2020 6966 2073 656c 662e 6f70 745f 6175    if self.opt_au
-00003940: 673a 0a20 2020 2020 2020 2020 2020 2069  g:.            i
-00003950: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
-00003960: 6861 6e6e 656c 7320 3d3d 2031 3a0a 2020  hannels == 1:.  
-00003970: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00003980: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
-00003990: 2c20 6368 616e 6e65 6c33 203d 2063 6f70  , channel3 = cop
-000039a0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-000039b0: 706f 7369 7469 7665 5f63 6c61 7373 292c  positive_class),
-000039c0: 204e 6f6e 652c 204e 6f6e 6520 0a20 2020   None, None .   
-000039d0: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-000039e0: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
-000039f0: 656c 7320 3d3d 2032 3a0a 2020 2020 2020  els == 2:.      
-00003a00: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
-00003a10: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
-00003a20: 616e 6e65 6c33 203d 2063 6f70 792e 6465  annel3 = copy.de
-00003a30: 6570 636f 7079 2873 656c 662e 706f 7369  epcopy(self.posi
-00003a40: 7469 7665 5f63 6c61 7373 5b3a 2c3a 2c3a  tive_class[:,:,:
-00003a50: 2c30 5d29 2c20 636f 7079 2e64 6565 7063  ,0]), copy.deepc
-00003a60: 6f70 7928 7365 6c66 2e70 6f73 6974 6976  opy(self.positiv
-00003a70: 655f 636c 6173 735b 3a2c 3a2c 3a2c 315d  e_class[:,:,:,1]
-00003a80: 292c 204e 6f6e 6520 0a20 2020 2020 2020  ), None .       
-00003a90: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
-00003aa0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
-00003ab0: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
-00003ac0: 2020 2020 2020 6368 616e 6e65 6c31 2c20        channel1, 
-00003ad0: 6368 616e 6e65 6c32 2c20 6368 616e 6e65  channel2, channe
-00003ae0: 6c33 203d 2063 6f70 792e 6465 6570 636f  l3 = copy.deepco
-00003af0: 7079 2873 656c 662e 706f 7369 7469 7665  py(self.positive
-00003b00: 5f63 6c61 7373 5b3a 2c3a 2c3a 2c30 5d29  _class[:,:,:,0])
-00003b10: 2c20 636f 7079 2e64 6565 7063 6f70 7928  , copy.deepcopy(
-00003b20: 7365 6c66 2e70 6f73 6974 6976 655f 636c  self.positive_cl
-00003b30: 6173 735b 3a2c 3a2c 3a2c 315d 292c 2063  ass[:,:,:,1]), c
-00003b40: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-00003b50: 662e 706f 7369 7469 7665 5f63 6c61 7373  f.positive_class
-00003b60: 5b3a 2c3a 2c3a 2c32 5d29 0a20 2020 2020  [:,:,:,2]).     
-00003b70: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00003b80: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00003b90: 7365 2056 616c 7565 4572 726f 7228 274f  se ValueError('O
-00003ba0: 6e6c 7920 7468 7265 6520 6669 6c74 6572  nly three filter
-00003bb0: 7320 6172 6520 7375 7070 6f72 7465 6421  s are supported!
-00003bc0: 2729 0a0a 2020 2020 2020 2020 6966 2027  ')..        if '
-00003bd0: 6c6f 7373 2720 696e 2073 656c 662e 6d65  loss' in self.me
-00003be0: 7472 6963 3a20 2354 6869 7320 7365 7473  tric: #This sets
-00003bf0: 2074 6865 206d 6f64 656c 2070 6174 6965   the model patie
-00003c00: 6e63 6520 6475 7269 6e67 2069 6e64 6976  nce during indiv
-00003c10: 6964 7561 6c20 7472 6169 6e69 6e67 2072  idual training r
-00003c20: 756e 730a 2020 2020 2020 2020 2020 2020  uns.            
-00003c30: 6d6f 6465 203d 2027 6d69 6e27 0a20 2020  mode = 'min'.   
-00003c40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00003c50: 2020 2020 2020 206d 6f64 6520 3d20 276d         mode = 'm
-00003c60: 6178 270a 0a20 2020 2020 2020 2069 6620  ax'..        if 
-00003c70: 7365 6c66 2e6f 7074 5f61 7567 3a0a 2020  self.opt_aug:.  
-00003c80: 2020 2020 2020 2020 2020 6e75 6d5f 6175            num_au
-00003c90: 6720 3d20 7472 6961 6c2e 7375 6767 6573  g = trial.sugges
-00003ca0: 745f 696e 7428 276e 756d 5f61 7567 272c  t_int('num_aug',
-00003cb0: 2073 656c 662e 6261 7463 685f 6d69 6e2c   self.batch_min,
-00003cc0: 2073 656c 662e 6261 7463 685f 6d61 782c   self.batch_max,
-00003cd0: 2073 7465 703d 3129 0a20 2020 2020 2020   step=1).       
-00003ce0: 2020 2020 2069 6d61 6765 5f73 697a 6520       image_size 
-00003cf0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-00003d00: 696e 7428 2769 6d61 6765 5f73 697a 6527  int('image_size'
-00003d10: 2c20 7365 6c66 2e69 6d61 6765 5f73 697a  , self.image_siz
-00003d20: 655f 6d69 6e2c 2073 656c 662e 696d 6167  e_min, self.imag
-00003d30: 655f 7369 7a65 5f6d 6178 2c20 7374 6570  e_size_max, step
-00003d40: 3d31 290a 2020 2020 2020 2020 2020 2020  =1).            
-00003d50: 2372 6f74 6174 696f 6e20 3d20 7472 6961  #rotation = tria
-00003d60: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
-00003d70: 7269 6361 6c28 2772 6f74 6174 696f 6e27  rical('rotation'
-00003d80: 2c20 5b54 7275 652c 2046 616c 7365 5d29  , [True, False])
-00003d90: 0a20 2020 2020 2020 2020 2020 2072 6f74  .            rot
-00003da0: 6174 696f 6e20 3d20 4661 6c73 650a 2020  ation = False.  
-00003db0: 2020 2020 2020 2020 2020 686f 7269 7a6f            horizo
-00003dc0: 6e74 616c 203d 2076 6572 7469 6361 6c20  ntal = vertical 
-00003dd0: 3d20 5472 7565 200a 0a20 2020 2020 2020  = True ..       
-00003de0: 2020 2020 2061 7567 6d65 6e74 6564 5f69       augmented_i
-00003df0: 6d61 6765 7320 3d20 6175 676d 656e 7461  mages = augmenta
-00003e00: 7469 6f6e 2863 6861 6e6e 656c 313d 6368  tion(channel1=ch
-00003e10: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
-00003e20: 3d63 6861 6e6e 656c 322c 2063 6861 6e6e  =channel2, chann
-00003e30: 656c 333d 6368 616e 6e65 6c33 2c20 6261  el3=channel3, ba
-00003e40: 7463 683d 6e75 6d5f 6175 672c 200a 2020  tch=num_aug, .  
-00003e50: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-00003e60: 6474 685f 7368 6966 743d 7365 6c66 2e73  dth_shift=self.s
-00003e70: 6869 6674 2c20 6865 6967 6874 5f73 6869  hift, height_shi
-00003e80: 6674 3d73 656c 662e 7368 6966 742c 2068  ft=self.shift, h
-00003e90: 6f72 697a 6f6e 7461 6c3d 686f 7269 7a6f  orizontal=horizo
-00003ea0: 6e74 616c 2c20 7665 7274 6963 616c 3d76  ntal, vertical=v
-00003eb0: 6572 7469 6361 6c2c 2072 6f74 6174 696f  ertical, rotatio
-00003ec0: 6e3d 726f 7461 7469 6f6e 2c20 0a20 2020  n=rotation, .   
-00003ed0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-00003ee0: 6765 5f73 697a 653d 696d 6167 655f 7369  ge_size=image_si
-00003ef0: 7a65 2c20 6d61 736b 5f73 697a 653d 7365  ze, mask_size=se
-00003f00: 6c66 2e6d 6173 6b5f 7369 7a65 2c20 6e75  lf.mask_size, nu
-00003f10: 6d5f 6d61 736b 733d 7365 6c66 2e6e 756d  m_masks=self.num
-00003f20: 5f6d 6173 6b73 290a 0a20 2020 2020 2020  _masks)..       
-00003f30: 2020 2020 2023 5468 6520 6175 676d 656e       #The augmen
-00003f40: 7461 7469 6f6e 2072 6f75 7469 6e65 2072  tation routine r
-00003f50: 6574 7572 6e73 2061 6e20 6f75 7470 7574  eturns an output
-00003f60: 2066 6f72 2065 6163 6820 6669 6c74 6572   for each filter
-00003f70: 2c20 652e 672e 2033 206f 7574 7075 7473  , e.g. 3 outputs
-00003f80: 2066 6f72 2052 4742 0a20 2020 2020 2020   for RGB.       
-00003f90: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
-00003fa0: 5f6e 756d 5f63 6861 6e6e 656c 7320 3e20  _num_channels > 
-00003fb0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00003fc0: 2020 2063 6c61 7373 5f31 3d5b 5d0a 2020     class_1=[].  
-00003fd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003fe0: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
-00003ff0: 616e 6e65 6c73 203d 3d20 323a 0a20 2020  annels == 2:.   
-00004000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004010: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00004020: 6c65 6e28 6175 676d 656e 7465 645f 696d  len(augmented_im
-00004030: 6167 6573 5b30 5d29 293a 0a20 2020 2020  ages[0])):.     
-00004040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004050: 2020 2063 6c61 7373 5f31 2e61 7070 656e     class_1.appen
-00004060: 6428 6461 7461 5f70 726f 6365 7373 696e  d(data_processin
-00004070: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
-00004080: 7328 6175 676d 656e 7465 645f 696d 6167  s(augmented_imag
-00004090: 6573 5b30 5d5b 695d 2c20 6175 676d 656e  es[0][i], augmen
-000040a0: 7465 645f 696d 6167 6573 5b31 5d5b 695d  ted_images[1][i]
-000040b0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-000040c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000040d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000040e0: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-000040f0: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
-00004100: 5b30 5d29 293a 0a20 2020 2020 2020 2020  [0])):.         
-00004110: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00004120: 6c61 7373 5f31 2e61 7070 656e 6428 6461  lass_1.append(da
-00004130: 7461 5f70 726f 6365 7373 696e 672e 636f  ta_processing.co
-00004140: 6e63 6174 5f63 6861 6e6e 656c 7328 6175  ncat_channels(au
-00004150: 676d 656e 7465 645f 696d 6167 6573 5b30  gmented_images[0
-00004160: 5d5b 695d 2c20 6175 676d 656e 7465 645f  ][i], augmented_
-00004170: 696d 6167 6573 5b31 5d5b 695d 2c20 6175  images[1][i], au
-00004180: 676d 656e 7465 645f 696d 6167 6573 5b32  gmented_images[2
-00004190: 5d5b 695d 2929 0a20 2020 2020 2020 2020  ][i])).         
-000041a0: 2020 2020 2020 2063 6c61 7373 5f31 203d         class_1 =
-000041b0: 206e 702e 6172 7261 7928 636c 6173 735f   np.array(class_
-000041c0: 3129 0a20 2020 2020 2020 2020 2020 2065  1).            e
-000041d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000041e0: 2020 2020 2063 6c61 7373 5f31 203d 2061       class_1 = a
-000041f0: 7567 6d65 6e74 6564 5f69 6d61 6765 730a  ugmented_images.
-00004200: 0a20 2020 2020 2020 2020 2020 2023 5065  .            #Pe
-00004210: 7266 6f72 6d20 7361 6d65 2061 7567 6d65  rform same augme
-00004220: 6e74 6174 696f 6e20 7465 6368 6e69 7175  ntation techniqu
-00004230: 6573 206f 6e20 6e65 6761 7469 7665 2063  es on negative c
-00004240: 6c61 7373 2064 6174 6120 666f 7220 6261  lass data for ba
-00004250: 6c61 6e63 6520 6275 7420 6f6e 6c79 2075  lance but only u
-00004260: 7365 2062 6174 6368 3d31 0a20 2020 2020  se batch=1.     
-00004270: 2020 2020 2020 2023 5468 6973 2069 7320         #This is 
-00004280: 646f 6e65 2073 6f20 7468 6174 2074 6865  done so that the
-00004290: 2074 7261 696e 696e 6720 6461 7461 2061   training data a
-000042a0: 6c73 6f20 696e 636c 7564 6573 2074 6865  lso includes the
-000042b0: 2072 616e 646f 6d20 6375 746f 7574 2c20   random cutout, 
-000042c0: 6966 2063 6f6e 6669 6775 7265 642e 0a20  if configured.. 
-000042d0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000042e0: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
-000042f0: 656c 7320 3d3d 2031 3a0a 2020 2020 2020  els == 1:.      
-00004300: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
-00004310: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
-00004320: 616e 6e65 6c33 203d 2063 6f70 792e 6465  annel3 = copy.de
-00004330: 6570 636f 7079 2873 656c 662e 6e65 6761  epcopy(self.nega
-00004340: 7469 7665 5f63 6c61 7373 292c 204e 6f6e  tive_class), Non
-00004350: 652c 204e 6f6e 6520 0a20 2020 2020 2020  e, None .       
-00004360: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
-00004370: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
-00004380: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
-00004390: 2020 2020 2020 6368 616e 6e65 6c31 2c20        channel1, 
-000043a0: 6368 616e 6e65 6c32 2c20 6368 616e 6e65  channel2, channe
-000043b0: 6c33 203d 2063 6f70 792e 6465 6570 636f  l3 = copy.deepco
-000043c0: 7079 2873 656c 662e 6e65 6761 7469 7665  py(self.negative
-000043d0: 5f63 6c61 7373 5b3a 2c3a 2c3a 2c30 5d29  _class[:,:,:,0])
-000043e0: 2c20 636f 7079 2e64 6565 7063 6f70 7928  , copy.deepcopy(
-000043f0: 7365 6c66 2e6e 6567 6174 6976 655f 636c  self.negative_cl
-00004400: 6173 735b 3a2c 3a2c 3a2c 315d 292c 204e  ass[:,:,:,1]), N
-00004410: 6f6e 6520 0a20 2020 2020 2020 2020 2020  one .           
-00004420: 2065 6c69 6620 7365 6c66 2e69 6d67 5f6e   elif self.img_n
-00004430: 756d 5f63 6861 6e6e 656c 7320 3d3d 2033  um_channels == 3
-00004440: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004450: 2020 6368 616e 6e65 6c31 2c20 6368 616e    channel1, chan
-00004460: 6e65 6c32 2c20 6368 616e 6e65 6c33 203d  nel2, channel3 =
-00004470: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
-00004480: 656c 662e 6e65 6761 7469 7665 5f63 6c61  elf.negative_cla
-00004490: 7373 5b3a 2c3a 2c3a 2c30 5d29 2c20 636f  ss[:,:,:,0]), co
-000044a0: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
-000044b0: 2e6e 6567 6174 6976 655f 636c 6173 735b  .negative_class[
-000044c0: 3a2c 3a2c 3a2c 315d 292c 2063 6f70 792e  :,:,:,1]), copy.
-000044d0: 6465 6570 636f 7079 2873 656c 662e 6e65  deepcopy(self.ne
-000044e0: 6761 7469 7665 5f63 6c61 7373 5b3a 2c3a  gative_class[:,:
-000044f0: 2c3a 2c32 5d29 0a20 2020 2020 2020 2020  ,:,2]).         
-00004500: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00004510: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
-00004520: 5f6e 6567 6174 6976 6520 3d20 6175 676d  _negative = augm
-00004530: 656e 7461 7469 6f6e 2863 6861 6e6e 656c  entation(channel
-00004540: 313d 6368 616e 6e65 6c31 2c20 6368 616e  1=channel1, chan
-00004550: 6e65 6c32 3d63 6861 6e6e 656c 322c 2063  nel2=channel2, c
-00004560: 6861 6e6e 656c 333d 6368 616e 6e65 6c33  hannel3=channel3
-00004570: 2c20 6261 7463 683d 312c 200a 2020 2020  , batch=1, .    
-00004580: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-00004590: 685f 7368 6966 743d 7365 6c66 2e73 6869  h_shift=self.shi
-000045a0: 6674 2c20 6865 6967 6874 5f73 6869 6674  ft, height_shift
-000045b0: 3d73 656c 662e 7368 6966 742c 2068 6f72  =self.shift, hor
-000045c0: 697a 6f6e 7461 6c3d 686f 7269 7a6f 6e74  izontal=horizont
-000045d0: 616c 2c20 7665 7274 6963 616c 3d76 6572  al, vertical=ver
-000045e0: 7469 6361 6c2c 2072 6f74 6174 696f 6e3d  tical, rotation=
-000045f0: 726f 7461 7469 6f6e 2c20 0a20 2020 2020  rotation, .     
-00004600: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-00004610: 5f73 697a 653d 696d 6167 655f 7369 7a65  _size=image_size
-00004620: 2c20 6d61 736b 5f73 697a 653d 7365 6c66  , mask_size=self
-00004630: 2e6d 6173 6b5f 7369 7a65 2c20 6e75 6d5f  .mask_size, num_
-00004640: 6d61 736b 733d 7365 6c66 2e6e 756d 5f6d  masks=self.num_m
-00004650: 6173 6b73 290a 0a20 2020 2020 2020 2020  asks)..         
-00004660: 2020 2023 5468 6520 6175 676d 656e 7461     #The augmenta
-00004670: 7469 6f6e 2072 6f75 7469 6e65 2072 6574  tion routine ret
-00004680: 7572 6e73 2061 6e20 6f75 7470 7574 2066  urns an output f
-00004690: 6f72 2065 6163 6820 6669 6c74 6572 2c20  or each filter, 
-000046a0: 652e 672e 2033 206f 7574 7075 7473 2066  e.g. 3 outputs f
-000046b0: 6f72 2052 4742 0a20 2020 2020 2020 2020  or RGB.         
-000046c0: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
-000046d0: 756d 5f63 6861 6e6e 656c 7320 3e20 313a  um_channels > 1:
-000046e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000046f0: 2063 6c61 7373 5f32 3d5b 5d0a 2020 2020   class_2=[].    
-00004700: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00004710: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-00004720: 6e65 6c73 203d 3d20 323a 0a20 2020 2020  nels == 2:.     
-00004730: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00004740: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
-00004750: 6e28 6175 676d 656e 7465 645f 696d 6167  n(augmented_imag
-00004760: 6573 5f6e 6567 6174 6976 655b 305d 2929  es_negative[0]))
-00004770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004780: 2020 2020 2020 2020 2020 636c 6173 735f            class_
-00004790: 322e 6170 7065 6e64 2864 6174 615f 7072  2.append(data_pr
-000047a0: 6f63 6573 7369 6e67 2e63 6f6e 6361 745f  ocessing.concat_
-000047b0: 6368 616e 6e65 6c73 2861 7567 6d65 6e74  channels(augment
-000047c0: 6564 5f69 6d61 6765 735f 6e65 6761 7469  ed_images_negati
-000047d0: 7665 5b30 5d5b 695d 2c20 6175 676d 656e  ve[0][i], augmen
-000047e0: 7465 645f 696d 6167 6573 5f6e 6567 6174  ted_images_negat
-000047f0: 6976 655b 315d 5b69 5d29 290a 2020 2020  ive[1][i])).    
-00004800: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00004810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004820: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00004830: 616e 6765 286c 656e 2861 7567 6d65 6e74  ange(len(augment
-00004840: 6564 5f69 6d61 6765 735f 6e65 6761 7469  ed_images_negati
-00004850: 7665 5b30 5d29 293a 0a20 2020 2020 2020  ve[0])):.       
-00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004870: 2063 6c61 7373 5f32 2e61 7070 656e 6428   class_2.append(
-00004880: 6461 7461 5f70 726f 6365 7373 696e 672e  data_processing.
-00004890: 636f 6e63 6174 5f63 6861 6e6e 656c 7328  concat_channels(
-000048a0: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
-000048b0: 5f6e 6567 6174 6976 655b 305d 5b69 5d2c  _negative[0][i],
-000048c0: 2061 7567 6d65 6e74 6564 5f69 6d61 6765   augmented_image
-000048d0: 735f 6e65 6761 7469 7665 5b31 5d5b 695d  s_negative[1][i]
-000048e0: 2c20 6175 676d 656e 7465 645f 696d 6167  , augmented_imag
-000048f0: 6573 5f6e 6567 6174 6976 655b 325d 5b69  es_negative[2][i
-00004900: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-00004910: 2020 2020 636c 6173 735f 3220 3d20 6e70      class_2 = np
-00004920: 2e61 7272 6179 2863 6c61 7373 5f32 290a  .array(class_2).
-00004930: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00004940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004950: 2020 636c 6173 735f 3220 3d20 6175 676d    class_2 = augm
-00004960: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
-00004970: 6174 6976 650a 0a20 2020 2020 2020 2020  ative..         
-00004980: 2020 2023 4261 6c61 6e63 6520 7468 6520     #Balance the 
-00004990: 636c 6173 7320 7369 7a65 7320 6966 206e  class sizes if n
-000049a0: 6563 6573 7361 7279 0a20 2020 2020 2020  ecessary.       
-000049b0: 2020 2020 2069 6620 7365 6c66 2e62 616c       if self.bal
-000049c0: 616e 6365 3a0a 2020 2020 2020 2020 2020  ance:.          
-000049d0: 2020 2020 2020 636c 6173 735f 3220 3d20        class_2 = 
-000049e0: 636c 6173 735f 325b 3a6c 656e 2863 6c61  class_2[:len(cla
-000049f0: 7373 5f31 295d 0a20 200a 2020 2020 2020  ss_1)].  .      
-00004a00: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-00004a10: 675f 6e75 6d5f 6368 616e 6e65 6c73 203d  g_num_channels =
-00004a20: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00004a30: 2020 2020 2063 6c61 7373 5f32 203d 2072       class_2 = r
-00004a40: 6573 697a 6528 636c 6173 735f 322c 2073  esize(class_2, s
-00004a50: 697a 653d 696d 6167 655f 7369 7a65 290a  ize=image_size).
-00004a60: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00004a70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004a80: 2020 6368 616e 6e65 6c31 203d 2072 6573    channel1 = res
-00004a90: 697a 6528 636c 6173 735f 325b 3a2c 3a2c  ize(class_2[:,:,
-00004aa0: 3a2c 305d 2c20 7369 7a65 3d69 6d61 6765  :,0], size=image
-00004ab0: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
-00004ac0: 2020 2020 2020 2063 6861 6e6e 656c 3220         channel2 
-00004ad0: 3d20 7265 7369 7a65 2863 6c61 7373 5f32  = resize(class_2
-00004ae0: 5b3a 2c3a 2c3a 2c31 5d2c 2073 697a 653d  [:,:,:,1], size=
-00004af0: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
-00004b00: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00004b10: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-00004b20: 6e65 6c73 203d 3d20 323a 0a20 2020 2020  nels == 2:.     
-00004b30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00004b40: 6c61 7373 5f32 203d 2064 6174 615f 7072  lass_2 = data_pr
-00004b50: 6f63 6573 7369 6e67 2e63 6f6e 6361 745f  ocessing.concat_
-00004b60: 6368 616e 6e65 6c73 2863 6861 6e6e 656c  channels(channel
-00004b70: 312c 2063 6861 6e6e 656c 3229 0a20 2020  1, channel2).   
-00004b80: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00004b90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00004ba0: 2020 2020 2020 2063 6861 6e6e 656c 3320         channel3 
-00004bb0: 3d20 7265 7369 7a65 2863 6c61 7373 5f32  = resize(class_2
-00004bc0: 5b3a 2c3a 2c3a 2c32 5d2c 2073 697a 653d  [:,:,:,2], size=
-00004bd0: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
-00004be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bf0: 636c 6173 735f 3220 3d20 6461 7461 5f70  class_2 = data_p
-00004c00: 726f 6365 7373 696e 672e 636f 6e63 6174  rocessing.concat
-00004c10: 5f63 6861 6e6e 656c 7328 6368 616e 6e65  _channels(channe
-00004c20: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
-00004c30: 616e 6e65 6c33 290a 0a20 2020 2020 2020  annel3)..       
-00004c40: 2020 2020 2023 4e65 6564 2074 6f20 616c       #Need to al
-00004c50: 736f 2063 726f 7020 7468 6520 7661 6c69  so crop the vali
-00004c60: 6461 7469 6f6e 2069 6d61 6765 730a 2020  dation images.  
-00004c70: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00004c80: 662e 7661 6c5f 706f 7369 7469 7665 2069  f.val_positive i
-00004c90: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00004ca0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00004cb0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-00004cc0: 6e65 6c73 203d 3d20 313a 0a20 2020 2020  nels == 1:.     
-00004cd0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00004ce0: 616c 5f63 6c61 7373 5f31 203d 2072 6573  al_class_1 = res
-00004cf0: 697a 6528 7365 6c66 2e76 616c 5f70 6f73  ize(self.val_pos
-00004d00: 6974 6976 652c 2073 697a 653d 696d 6167  itive, size=imag
-00004d10: 655f 7369 7a65 290a 2020 2020 2020 2020  e_size).        
-00004d20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d40: 2020 7661 6c5f 6368 616e 6e65 6c31 203d    val_channel1 =
-00004d50: 2072 6573 697a 6528 7365 6c66 2e76 616c   resize(self.val
-00004d60: 5f70 6f73 6974 6976 655b 3a2c 3a2c 3a2c  _positive[:,:,:,
-00004d70: 305d 2c20 7369 7a65 3d69 6d61 6765 5f73  0], size=image_s
-00004d80: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-00004d90: 2020 2020 2020 2020 2076 616c 5f63 6861           val_cha
-00004da0: 6e6e 656c 3220 3d20 7265 7369 7a65 2873  nnel2 = resize(s
-00004db0: 656c 662e 7661 6c5f 706f 7369 7469 7665  elf.val_positive
-00004dc0: 5b3a 2c3a 2c3a 2c31 5d2c 2073 697a 653d  [:,:,:,1], size=
-00004dd0: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
-00004de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004df0: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
-00004e00: 6368 616e 6e65 6c73 203d 3d20 323a 0a20  channels == 2:. 
-00004e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e20: 2020 2020 2020 2076 616c 5f63 6c61 7373         val_class
-00004e30: 5f31 203d 2064 6174 615f 7072 6f63 6573  _1 = data_proces
-00004e40: 7369 6e67 2e63 6f6e 6361 745f 6368 616e  sing.concat_chan
-00004e50: 6e65 6c73 2876 616c 5f63 6861 6e6e 656c  nels(val_channel
-00004e60: 312c 2076 616c 5f63 6861 6e6e 656c 3229  1, val_channel2)
-00004e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004e80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00004e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ea0: 2020 2076 616c 5f63 6861 6e6e 656c 3320     val_channel3 
-00004eb0: 3d20 7265 7369 7a65 2873 656c 662e 7661  = resize(self.va
-00004ec0: 6c5f 706f 7369 7469 7665 5b3a 2c3a 2c3a  l_positive[:,:,:
-00004ed0: 2c32 5d2c 2073 697a 653d 696d 6167 655f  ,2], size=image_
-00004ee0: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
-00004ef0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00004f00: 6c5f 636c 6173 735f 3120 3d20 6461 7461  l_class_1 = data
-00004f10: 5f70 726f 6365 7373 696e 672e 636f 6e63  _processing.conc
-00004f20: 6174 5f63 6861 6e6e 656c 7328 7661 6c5f  at_channels(val_
-00004f30: 6368 616e 6e65 6c31 2c20 7661 6c5f 6368  channel1, val_ch
-00004f40: 616e 6e65 6c32 2c20 7661 6c5f 6368 616e  annel2, val_chan
-00004f50: 6e65 6c33 290a 2020 2020 2020 2020 2020  nel3).          
-00004f60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004f70: 2020 2020 2020 2020 7661 6c5f 636c 6173          val_clas
-00004f80: 735f 3120 3d20 4e6f 6e65 200a 0a20 2020  s_1 = None ..   
-00004f90: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00004fa0: 2e76 616c 5f6e 6567 6174 6976 6520 6973  .val_negative is
-00004fb0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00004fc0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00004fd0: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
-00004fe0: 656c 7320 3d3d 2031 3a0a 2020 2020 2020  els == 1:.      
-00004ff0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00005000: 6c5f 636c 6173 735f 3220 3d20 7265 7369  l_class_2 = resi
-00005010: 7a65 2873 656c 662e 7661 6c5f 6e65 6761  ze(self.val_nega
-00005020: 7469 7665 2c20 7369 7a65 3d69 6d61 6765  tive, size=image
-00005030: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
-00005040: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00005050: 2e69 6d67 5f6e 756d 5f63 6861 6e6e 656c  .img_num_channel
-00005060: 7320 3e20 313a 0a20 2020 2020 2020 2020  s > 1:.         
-00005070: 2020 2020 2020 2020 2020 2076 616c 5f63             val_c
-00005080: 6861 6e6e 656c 3120 3d20 7265 7369 7a65  hannel1 = resize
-00005090: 2873 656c 662e 7661 6c5f 6e65 6761 7469  (self.val_negati
-000050a0: 7665 5b3a 2c3a 2c3a 2c30 5d2c 2073 697a  ve[:,:,:,0], siz
-000050b0: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
-000050c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050d0: 2020 7661 6c5f 6368 616e 6e65 6c32 203d    val_channel2 =
-000050e0: 2072 6573 697a 6528 7365 6c66 2e76 616c   resize(self.val
-000050f0: 5f6e 6567 6174 6976 655b 3a2c 3a2c 3a2c  _negative[:,:,:,
-00005100: 315d 2c20 7369 7a65 3d69 6d61 6765 5f73  1], size=image_s
-00005110: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-00005120: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00005130: 2e69 6d67 5f6e 756d 5f63 6861 6e6e 656c  .img_num_channel
-00005140: 7320 3d3d 2032 3a0a 2020 2020 2020 2020  s == 2:.        
-00005150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005160: 7661 6c5f 636c 6173 735f 3220 3d20 6461  val_class_2 = da
-00005170: 7461 5f70 726f 6365 7373 696e 672e 636f  ta_processing.co
-00005180: 6e63 6174 5f63 6861 6e6e 656c 7328 7661  ncat_channels(va
-00005190: 6c5f 6368 616e 6e65 6c31 2c20 7661 6c5f  l_channel1, val_
-000051a0: 6368 616e 6e65 6c32 290a 2020 2020 2020  channel2).      
-000051b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000051c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000051d0: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
-000051e0: 6368 616e 6e65 6c33 203d 2072 6573 697a  channel3 = resiz
-000051f0: 6528 7365 6c66 2e76 616c 5f6e 6567 6174  e(self.val_negat
-00005200: 6976 655b 3a2c 3a2c 3a2c 325d 2c20 7369  ive[:,:,:,2], si
-00005210: 7a65 3d69 6d61 6765 5f73 697a 6529 0a20  ze=image_size). 
-00005220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005230: 2020 2020 2020 2076 616c 5f63 6c61 7373         val_class
-00005240: 5f32 203d 2064 6174 615f 7072 6f63 6573  _2 = data_proces
-00005250: 7369 6e67 2e63 6f6e 6361 745f 6368 616e  sing.concat_chan
-00005260: 6e65 6c73 2876 616c 5f63 6861 6e6e 656c  nels(val_channel
-00005270: 312c 2076 616c 5f63 6861 6e6e 656c 322c  1, val_channel2,
-00005280: 2076 616c 5f63 6861 6e6e 656c 3329 0a20   val_channel3). 
-00005290: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000052a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000052b0: 2076 616c 5f63 6c61 7373 5f32 203d 204e   val_class_2 = N
-000052c0: 6f6e 6520 0a0a 2020 2020 2020 2020 656c  one ..        el
-000052d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000052e0: 636c 6173 735f 312c 2063 6c61 7373 5f32  class_1, class_2
-000052f0: 203d 2073 656c 662e 706f 7369 7469 7665   = self.positive
-00005300: 5f63 6c61 7373 2c20 7365 6c66 2e6e 6567  _class, self.neg
-00005310: 6174 6976 655f 636c 6173 730a 2020 2020  ative_class.    
-00005320: 2020 2020 2020 2020 7661 6c5f 636c 6173          val_clas
-00005330: 735f 312c 2076 616c 5f63 6c61 7373 5f32  s_1, val_class_2
-00005340: 203d 2073 656c 662e 7661 6c5f 706f 7369   = self.val_posi
-00005350: 7469 7665 2c20 7365 6c66 2e76 616c 5f6e  tive, self.val_n
-00005360: 6567 6174 6976 650a 0a20 2020 2020 2020  egative..       
-00005370: 2023 2323 204f 7074 696d 697a 6520 7468   ### Optimize th
-00005380: 6520 6d61 7820 7069 7865 6c20 746f 2075  e max pixel to u
-00005390: 7365 2066 6f72 2074 6865 206d 696e 2d6d  se for the min-m
-000053a0: 6178 206e 6f72 6d61 6c69 7a61 7469 6f6e  ax normalization
-000053b0: 202d 2d20 7065 7220 6261 6e64 2023 2323   -- per band ###
-000053c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000053d0: 2e6f 7074 5f6d 6178 5f6d 696e 5f70 6978  .opt_max_min_pix
-000053e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000053f0: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
-00005400: 6f72 6d61 6c69 7a65 203d 2054 7275 6520  ormalize = True 
-00005410: 234a 7573 7420 696e 2063 6173 6520 6974  #Just in case it
-00005420: 2773 2073 6574 2074 6f20 4661 6c73 6520  's set to False 
-00005430: 6279 2074 6865 2075 7365 7220 0a20 2020  by the user .   
-00005440: 2020 2020 2020 2020 206d 696e 5f70 6978           min_pix
-00005450: 2c20 6d61 785f 7069 7820 3d20 302e 302c  , max_pix = 0.0,
-00005460: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00005470: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
-00005480: 6368 616e 6e65 6c73 203e 3d20 313a 0a20  channels >= 1:. 
-00005490: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000054a0: 6178 5f70 6978 5f31 203d 2074 7269 616c  ax_pix_1 = trial
-000054b0: 2e73 7567 6765 7374 5f69 6e74 2827 6d61  .suggest_int('ma
-000054c0: 785f 7069 7865 6c5f 3127 2c20 7365 6c66  x_pixel_1', self
-000054d0: 2e6f 7074 5f6d 6178 5f6d 696e 5f70 6978  .opt_max_min_pix
-000054e0: 2c20 7365 6c66 2e6f 7074 5f6d 6178 5f6d  , self.opt_max_m
-000054f0: 6178 5f70 6978 2c20 7374 6570 3d31 290a  ax_pix, step=1).
+00000070: 6f72 7420 6f73 2c20 7379 732c 2063 6f70  ort os, sys, cop
+00000080: 790a 696d 706f 7274 2067 632c 2073 656c  y.import gc, sel
+00000090: 6563 746f 7273 2c20 7465 726d 696f 730a  ectors, termios.
+000000a0: 6f73 2e65 6e76 6972 6f6e 5b27 5059 5448  os.environ['PYTH
+000000b0: 4f4e 4841 5348 5345 4544 275d 2c20 6f73  ONHASHSEED'], os
+000000c0: 2e65 6e76 6972 6f6e 5b22 5446 5f44 4554  .environ["TF_DET
+000000d0: 4552 4d49 4e49 5354 4943 5f4f 5053 225d  ERMINISTIC_OPS"]
+000000e0: 203d 2027 3027 2c20 2731 270a 696d 706f   = '0', '1'.impo
+000000f0: 7274 2074 656e 736f 7266 6c6f 7720 6173  rt tensorflow as
+00000100: 2074 660a 0a69 6d70 6f72 7420 6e75 6d70   tf..import nump
+00000110: 7920 6173 206e 700a 696d 706f 7274 2072  y as np.import r
+00000120: 616e 646f 6d20 6173 2070 7974 686f 6e5f  andom as python_
+00000130: 7261 6e64 6f6d 0a6e 702e 7261 6e64 6f6d  random.np.random
+00000140: 2e73 6565 6428 3139 3039 292c 2070 7974  .seed(1909), pyt
+00000150: 686f 6e5f 7261 6e64 6f6d 2e73 6565 6428  hon_random.seed(
+00000160: 3139 3039 292c 2074 662e 7261 6e64 6f6d  1909), tf.random
+00000170: 2e73 6574 5f73 6565 6428 3139 3039 2920  .set_seed(1909) 
+00000180: 2323 6874 7470 733a 2f2f 6b65 7261 732e  ##https://keras.
+00000190: 696f 2f67 6574 7469 6e67 5f73 7461 7274  io/getting_start
+000001a0: 6564 2f66 6171 2f23 686f 772d 6361 6e2d  ed/faq/#how-can-
+000001b0: 692d 6f62 7461 696e 2d72 6570 726f 6475  i-obtain-reprodu
+000001c0: 6369 626c 652d 7265 7375 6c74 732d 7573  cible-results-us
+000001d0: 696e 672d 6b65 7261 732d 6475 7269 6e67  ing-keras-during
+000001e0: 2d64 6576 656c 6f70 6d65 6e74 2323 0a66  -development##.f
+000001f0: 726f 6d20 7061 6e64 6173 2069 6d70 6f72  rom pandas impor
+00000200: 7420 4461 7461 4672 616d 650a 6672 6f6d  t DataFrame.from
+00000210: 2077 6172 6e69 6e67 7320 696d 706f 7274   warnings import
+00000220: 2066 696c 7465 7277 6172 6e69 6e67 730a   filterwarnings.
+00000230: 6669 6c74 6572 7761 726e 696e 6773 2822  filterwarnings("
+00000240: 6967 6e6f 7265 222c 2063 6174 6567 6f72  ignore", categor
+00000250: 793d 4675 7475 7265 5761 726e 696e 6729  y=FutureWarning)
+00000260: 0a66 726f 6d20 636f 6c6c 6563 7469 6f6e  .from collection
+00000270: 7320 696d 706f 7274 2043 6f75 6e74 6572  s import Counter
+00000280: 200a 6672 6f6d 2070 6174 686c 6962 2069   .from pathlib i
+00000290: 6d70 6f72 7420 5061 7468 0a69 6d70 6f72  mport Path.impor
+000002a0: 7420 6a6f 626c 6962 2020 200a 0a69 6d70  t joblib   ..imp
+000002b0: 6f72 7420 736b 6c65 6172 6e2e 6e65 6967  ort sklearn.neig
+000002c0: 6862 6f72 732e 5f62 6173 650a 7379 732e  hbors._base.sys.
+000002d0: 6d6f 6475 6c65 735b 2773 6b6c 6561 726e  modules['sklearn
+000002e0: 2e6e 6569 6768 626f 7273 2e62 6173 6527  .neighbors.base'
+000002f0: 5d20 3d20 736b 6c65 6172 6e2e 6e65 6967  ] = sklearn.neig
+00000300: 6862 6f72 732e 5f62 6173 650a 6672 6f6d  hbors._base.from
+00000310: 2073 6b6c 6561 726e 2e69 6d70 7574 6520   sklearn.impute 
+00000320: 696d 706f 7274 204b 4e4e 496d 7075 7465  import KNNImpute
+00000330: 720a 6672 6f6d 2073 6b6c 6561 726e 2e65  r.from sklearn.e
+00000340: 6e73 656d 626c 6520 696d 706f 7274 2052  nsemble import R
+00000350: 616e 646f 6d46 6f72 6573 7443 6c61 7373  andomForestClass
+00000360: 6966 6965 720a 6672 6f6d 2073 6b6c 6561  ifier.from sklea
+00000370: 726e 2e6e 6575 7261 6c5f 6e65 7477 6f72  rn.neural_networ
+00000380: 6b20 696d 706f 7274 204d 4c50 436c 6173  k import MLPClas
+00000390: 7369 6669 6572 0a66 726f 6d20 736b 6c65  sifier.from skle
+000003a0: 6172 6e2e 6d65 7472 6963 7320 696d 706f  arn.metrics impo
+000003b0: 7274 2061 6363 7572 6163 795f 7363 6f72  rt accuracy_scor
+000003c0: 650a 6672 6f6d 2073 6b6c 6561 726e 2e6d  e.from sklearn.m
+000003d0: 6f64 656c 5f73 656c 6563 7469 6f6e 2069  odel_selection i
+000003e0: 6d70 6f72 7420 7472 6169 6e5f 7465 7374  mport train_test
+000003f0: 5f73 706c 6974 2c20 6372 6f73 735f 7661  _split, cross_va
+00000400: 6c69 6461 7465 2c20 6372 6f73 735f 7661  lidate, cross_va
+00000410: 6c5f 7363 6f72 650a 0a66 726f 6d20 736b  l_score..from sk
+00000420: 6f70 7420 696d 706f 7274 2042 6179 6573  opt import Bayes
+00000430: 5365 6172 6368 4356 2c20 706c 6f74 732c  SearchCV, plots,
+00000440: 2067 705f 6d69 6e69 6d69 7a65 0a66 726f   gp_minimize.fro
+00000450: 6d20 736b 6f70 742e 706c 6f74 7320 696d  m skopt.plots im
+00000460: 706f 7274 2070 6c6f 745f 636f 6e76 6572  port plot_conver
+00000470: 6765 6e63 652c 2070 6c6f 745f 6f62 6a65  gence, plot_obje
+00000480: 6374 6976 650a 6672 6f6d 2073 6b6f 7074  ctive.from skopt
+00000490: 2e73 7061 6365 2069 6d70 6f72 7420 5265  .space import Re
+000004a0: 616c 2c20 496e 7465 6765 722c 2043 6174  al, Integer, Cat
+000004b0: 6567 6f72 6963 616c 200a 6672 6f6d 2074  egorical .from t
+000004c0: 656e 736f 7266 6c6f 772e 6b65 7261 732e  ensorflow.keras.
+000004d0: 6261 636b 656e 6420 696d 706f 7274 2063  backend import c
+000004e0: 6c65 6172 5f73 6573 7369 6f6e 200a 6672  lear_session .fr
+000004f0: 6f6d 2074 656e 736f 7266 6c6f 772e 6b65  om tensorflow.ke
+00000500: 7261 732e 6361 6c6c 6261 636b 7320 696d  ras.callbacks im
+00000510: 706f 7274 2045 6172 6c79 5374 6f70 7069  port EarlyStoppi
+00000520: 6e67 2c20 4361 6c6c 6261 636b 0a66 726f  ng, Callback.fro
+00000530: 6d20 7465 6e73 6f72 666c 6f77 2e6b 6572  m tensorflow.ker
+00000540: 6173 2e6d 6f64 656c 7320 696d 706f 7274  as.models import
+00000550: 2073 6176 655f 6d6f 6465 6c0a 0a69 6d70   save_model..imp
+00000560: 6f72 7420 6f70 7475 6e61 0a66 726f 6d20  ort optuna.from 
+00000570: 426f 7275 7461 5368 6170 2069 6d70 6f72  BorutaShap impor
+00000580: 7420 426f 7275 7461 5368 6170 0a66 726f  t BorutaShap.fro
+00000590: 6d20 626f 7275 7461 2069 6d70 6f72 7420  m boruta import 
+000005a0: 426f 7275 7461 5079 0a66 726f 6d20 7867  BorutaPy.from xg
+000005b0: 626f 6f73 7420 696d 706f 7274 2058 4742  boost import XGB
+000005c0: 436c 6173 7369 6669 6572 2c20 444d 6174  Classifier, DMat
+000005d0: 7269 782c 2074 7261 696e 0a66 726f 6d20  rix, train.from 
+000005e0: 6f70 7475 6e61 2e69 6e74 6567 7261 7469  optuna.integrati
+000005f0: 6f6e 2069 6d70 6f72 7420 5446 4b65 7261  on import TFKera
+00000600: 7350 7275 6e69 6e67 4361 6c6c 6261 636b  sPruningCallback
+00000610: 0a6f 7074 756e 612e 6c6f 6767 696e 672e  .optuna.logging.
+00000620: 7365 745f 7665 7262 6f73 6974 7928 6f70  set_verbosity(op
+00000630: 7475 6e61 2e6c 6f67 6769 6e67 2e57 4152  tuna.logging.WAR
+00000640: 4e49 4e47 290a 6672 6f6d 2070 7942 4941  NING).from pyBIA
+00000650: 2e64 6174 615f 6175 676d 656e 7461 7469  .data_augmentati
+00000660: 6f6e 2069 6d70 6f72 7420 6175 676d 656e  on import augmen
+00000670: 7461 7469 6f6e 2c20 7265 7369 7a65 0a66  tation, resize.f
+00000680: 726f 6d20 7079 4249 4120 696d 706f 7274  rom pyBIA import
+00000690: 2064 6174 615f 7072 6f63 6573 7369 6e67   data_processing
+000006a0: 2c20 636e 6e5f 6d6f 6465 6c0a 0a0a 636c  , cnn_model...cl
+000006b0: 6173 7320 6f62 6a65 6374 6976 655f 636e  ass objective_cn
+000006c0: 6e28 6f62 6a65 6374 293a 0a20 2020 2022  n(object):.    "
+000006d0: 2222 0a20 2020 204f 7074 696d 697a 6174  "".    Optimizat
+000006e0: 696f 6e20 6f62 6a65 6374 6976 6520 6675  ion objective fu
+000006f0: 6e63 7469 6f6e 2066 6f72 2070 7942 4941  nction for pyBIA
+00000700: 2773 2063 6f6e 766f 6c75 7469 6f6e 616c  's convolutional
+00000710: 206e 6575 7261 6c20 6e65 7477 6f72 6b73   neural networks
+00000720: 2e0a 0a20 2020 2054 6869 7320 6973 2070  ...    This is p
+00000730: 6173 7365 6420 7468 726f 7567 6820 7468  assed through th
+00000740: 6520 6879 7065 725f 6f70 7428 2920 6675  e hyper_opt() fu
+00000750: 6e63 7469 6f6e 2077 6865 6e20 6f70 7469  nction when opti
+00000760: 6d69 7a69 6e67 2077 6974 680a 2020 2020  mizing with.    
+00000770: 4f70 7475 6e61 2e20 5468 6520 4f70 7475  Optuna. The Optu
+00000780: 6e61 2073 6f66 7477 6172 6520 666f 7220  na software for 
+00000790: 6879 7065 7270 6172 616d 6574 6572 206f  hyperparameter o
+000007a0: 7074 696d 697a 6174 696f 6e20 7761 7320  ptimization was 
+000007b0: 7075 626c 6973 6865 6420 696e 200a 2020  published in .  
+000007c0: 2020 3230 3139 2062 7920 416b 6962 6120    2019 by Akiba 
+000007d0: 6574 2061 6c2e 2050 6170 6572 3a20 6874  et al. Paper: ht
+000007e0: 7470 733a 2f2f 6172 7869 762e 6f72 672f  tps://arxiv.org/
+000007f0: 6162 732f 3139 3037 2e31 3039 3032 0a0a  abs/1907.10902..
+00000800: 2020 2020 556e 6c69 6b65 2074 6865 206f      Unlike the o
+00000810: 626a 6563 7469 7665 2066 756e 6374 696f  bjective functio
+00000820: 6e73 2066 6f72 2074 6865 2065 6e73 656d  ns for the ensem
+00000830: 626c 6520 616c 676f 7269 7468 6d73 2c20  ble algorithms, 
+00000840: 7468 6973 2074 616b 6573 2061 7320 696e  this takes as in
+00000850: 7075 740a 2020 2020 7468 6520 7477 6f20  put.    the two 
+00000860: 636c 6173 7365 7320 6469 7265 6374 6c79  classes directly
+00000870: 2c20 706f 7369 7469 7665 5f63 6c61 7373  , positive_class
+00000880: 2026 206e 6567 6174 6976 655f 636c 6173   & negative_clas
+00000890: 732c 2069 6e73 7465 6164 206f 6620 7468  s, instead of th
+000008a0: 6520 7472 6164 6974 696f 6e61 6c20 0a20  e traditional . 
+000008b0: 2020 2064 6174 6120 2864 6174 615f 7829     data (data_x)
+000008c0: 2061 6e64 2061 6363 6f6d 7061 6e79 696e   and accompanyin
+000008d0: 6720 6c61 6265 6c20 6172 7261 7920 2864  g label array (d
+000008e0: 6174 615f 7929 2e20 5468 6973 2069 7320  ata_y). This is 
+000008f0: 6265 6361 7573 6520 7468 6520 636f 6e66  because the conf
+00000900: 6967 7572 6564 2043 4e4e 206d 6f64 656c  igured CNN model
+00000910: 7320 0a20 2020 2074 616b 6520 6173 2069  s .    take as i
+00000920: 6e70 7574 2074 6865 2074 776f 2063 6c61  nput the two cla
+00000930: 7373 6573 2073 6570 6172 6174 656c 792c  sses separately,
+00000940: 2061 6674 6572 2077 6869 6368 2069 7420   after which it 
+00000950: 6175 746f 6d61 7469 6361 6c6c 7920 6173  automatically as
+00000960: 7369 676e 7320 7468 6520 3120 616e 6420  signs the 1 and 
+00000970: 3020 6c61 6265 6c73 2c20 7265 7370 6563  0 labels, respec
+00000980: 7469 7665 6c79 2e0a 0a20 2020 2042 7920  tively...    By 
+00000990: 6465 6661 756c 742c 206f 7074 5f6d 6f64  default, opt_mod
+000009a0: 656c 3d54 7275 6520 616e 6420 6f70 745f  el=True and opt_
+000009b0: 6175 673d 4661 6c73 652e 2049 6620 6f70  aug=False. If op
+000009c0: 745f 6175 673d 5472 7565 2c20 7468 6520  t_aug=True, the 
+000009d0: 696d 6167 6520 7369 7a65 2061 6e64 0a20  image size and. 
+000009e0: 2020 206e 756d 6265 7220 6f66 2061 7567     number of aug
+000009f0: 6d65 6e74 6174 696f 6e73 2074 6f20 7065  mentations to pe
+00000a00: 7266 6f72 6d20 6f6e 2065 6163 6820 696d  rform on each im
+00000a10: 6167 6520 7769 6c6c 2062 6520 696e 636c  age will be incl
+00000a20: 7564 6564 2061 7320 6f70 7469 6d69 7a61  uded as optimiza
+00000a30: 626c 6520 7661 7269 6162 6c65 732e 0a20  ble variables.. 
+00000a40: 2020 2049 6620 7468 6520 6f70 745f 6d61     If the opt_ma
+00000a50: 785f 6d69 6e5f 7069 7820 616e 6420 6f70  x_min_pix and op
+00000a60: 745f 6d61 785f 6d61 785f 7069 7820 6172  t_max_max_pix ar
+00000a70: 6520 7365 742c 2074 6865 206f 7074 696d  e set, the optim
+00000a80: 616c 206d 6178 696d 756d 2070 6978 656c  al maximum pixel
+00000a90: 2076 616c 7565 2074 6f20 7573 650a 2020   value to use.  
+00000aa0: 2020 7768 656e 206d 696e 2d6d 6178 206e    when min-max n
+00000ab0: 6f72 6d61 6c69 7a69 6e67 2065 6163 6820  ormalizing each 
+00000ac0: 6261 6e64 2077 696c 6c20 616c 736f 2062  band will also b
+00000ad0: 6520 6f70 7469 6d69 7a61 626c 6520 7661  e optimizable va
+00000ae0: 7269 6162 6c65 7320 7468 6174 2077 696c  riables that wil
+00000af0: 6c20 6265 2074 756e 6564 2061 6e64 2072  l be tuned and r
+00000b00: 6574 7572 6e65 642e 0a20 2020 2049 6620  eturned..    If 
+00000b10: 6f70 745f 6d6f 6465 6c3d 5472 7565 2c20  opt_model=True, 
+00000b20: 6164 6469 7469 6f6e 616c 2061 7263 6869  additional archi
+00000b30: 7465 6374 7572 6520 7061 7261 6d65 7465  tecture paramete
+00000b40: 7273 2077 696c 6c20 616c 736f 2062 6520  rs will also be 
+00000b50: 7475 6e65 642e 2049 6e20 626f 7468 2069  tuned. In both i
+00000b60: 6e73 7461 6e63 6573 2074 6865 2074 7261  nstances the tra
+00000b70: 696e 696e 6720 7061 7261 6d65 7465 7273  ining parameters
+00000b80: 200a 2020 2020 7769 6c6c 2062 6520 6f70   .    will be op
+00000b90: 7469 6d69 7a65 642c 2077 6869 6368 2069  timized, which i
+00000ba0: 6e63 6c75 6465 2074 6865 206f 7074 696d  nclude the optim
+00000bb0: 697a 6572 2c20 6c65 6172 6e69 6e67 2072  izer, learning r
+00000bc0: 6174 652c 2064 6563 6179 2c20 616e 6420  ate, decay, and 
+00000bd0: 6d6f 6d65 6e74 756d 2c20 6966 2061 7070  momentum, if app
+00000be0: 6c69 6361 626c 652e 0a0a 2020 2020 4e6f  licable...    No
+00000bf0: 7465 3a0a 2020 2020 2020 2020 4966 206f  te:.        If o
+00000c00: 7074 5f61 7567 2069 7320 656e 6162 6c65  pt_aug is enable
+00000c10: 642c 2074 6865 6e20 7468 6520 706f 7369  d, then the posi
+00000c20: 7469 7665 5f63 6c61 7373 2073 616d 706c  tive_class sampl
+00000c30: 6520 7769 6c6c 2062 6520 7468 6520 6461  e will be the da
+00000c40: 7461 2074 6861 7420 7769 6c6c 2061 7567  ta that will aug
+00000c50: 6d65 6e74 6564 2e0a 2020 2020 2020 2020  mented..        
+00000c60: 4974 2069 7320 6265 7374 2074 6f20 6b65  It is best to ke
+00000c70: 6570 2062 6f74 6820 636c 6173 7320 7369  ep both class si
+00000c80: 7a65 7320 7468 6520 7361 6d65 2061 6674  zes the same aft
+00000c90: 6572 2061 7567 6d65 6e74 6174 696f 6e2c  er augmentation,
+00000ca0: 2074 6865 7265 666f 7265 2062 616c 616e   therefore balan
+00000cb0: 6365 3d54 7275 650a 2020 2020 2020 2020  ce=True.        
+00000cc0: 6279 2064 6566 6175 6c74 2c20 7768 6963  by default, whic
+00000cd0: 6820 7769 6c6c 2074 7275 6e63 6174 6520  h will truncate 
+00000ce0: 7468 6520 6e65 6761 7469 7665 5f63 6c61  the negative_cla
+00000cf0: 7373 2073 616d 706c 6520 746f 206d 6174  ss sample to mat
+00000d00: 6368 2074 6865 2061 7567 6d65 6e74 6564  ch the augmented
+00000d10: 2070 6f73 6974 6976 655f 636c 6173 7320   positive_class 
+00000d20: 7369 7a65 2e0a 2020 2020 2020 2020 5468  size..        Th
+00000d30: 6520 6f74 6865 7220 636c 6173 7320 7769  e other class wi
+00000d40: 6c6c 2061 6c73 6f20 756e 6465 7267 6f20  ll also undergo 
+00000d50: 7468 6520 7361 6d65 2064 6174 6120 6175  the same data au
+00000d60: 676d 656e 7461 7469 6f6e 2074 6563 686e  gmentation techn
+00000d70: 6971 7565 2062 7574 206f 6e6c 7920 6f6e  ique but only on
+00000d80: 6520 696d 6167 6520 7769 6c6c 2062 6520  e image will be 
+00000d90: 7265 7475 726e 6564 0a20 2020 2020 2020  returned.       
+00000da0: 2070 6572 2073 616d 706c 652c 2074 6869   per sample, thi
+00000db0: 7320 6973 2074 6f20 656e 7375 7265 2062  s is to ensure b
+00000dc0: 6f74 6820 636c 6173 7365 7320 636f 6e74  oth classes cont
+00000dd0: 6169 6e20 7468 6520 7361 6d65 206c 6576  ain the same lev
+00000de0: 656c 206f 6620 7661 7269 6174 696f 6e2c  el of variation,
+00000df0: 2065 7370 6563 6961 6c6c 7920 696d 706f   especially impo
+00000e00: 7274 616e 740a 2020 2020 2020 2020 7768  rtant.        wh
+00000e10: 656e 2061 7070 6c79 696e 6720 7468 6520  en applying the 
+00000e20: 6d61 736b 2d63 7574 6f75 7420 7465 6368  mask-cutout tech
+00000e30: 6e69 7175 6520 746f 2074 6865 2061 7567  nique to the aug
+00000e40: 6d65 6e74 6174 696f 6e20 7072 6f63 6564  mentation proced
+00000e50: 7572 652e 0a0a 2020 2020 2020 2020 5369  ure...        Si
+00000e60: 6e63 6520 7468 6520 6d61 7869 6d75 6d20  nce the maximum 
+00000e70: 6e75 6d62 6572 206f 6620 6175 676d 656e  number of augmen
+00000e80: 7461 7469 6f6e 7320 616c 6c6f 7765 6420  tations allowed 
+00000e90: 6973 2062 6174 6368 5f6d 6178 2070 6572  is batch_max per
+00000ea0: 2065 6163 6820 7361 6d70 6c65 2c20 696e   each sample, in
+00000eb0: 2070 7261 6374 6963 6520 6e65 6761 7469   practice negati
+00000ec0: 7665 5f63 6c61 7373 200a 2020 2020 2020  ve_class .      
+00000ed0: 2020 7368 6f75 6c64 2063 6f6e 7461 696e    should contain
+00000ee0: 2062 6174 6368 5f6d 6178 2074 696d 6573   batch_max times
+00000ef0: 2074 6865 2073 697a 6520 6f66 2070 6f73   the size of pos
+00000f00: 6974 6976 655f 636c 6173 732e 2044 7572  itive_class. Dur
+00000f10: 696e 6720 7468 6520 6f70 7469 6d69 7a61  ing the optimiza
+00000f20: 7469 6f6e 2070 726f 6365 6475 7265 2c20  tion procedure, 
+00000f30: 6966 2061 6e20 0a20 2020 2020 2020 2061  if an .        a
+00000f40: 7567 6d65 6e74 6174 696f 6e20 6261 7463  ugmentation batc
+00000f50: 6820 7369 7a65 206f 6620 3130 3020 6973  h size of 100 is
+00000f60: 2061 7373 6573 6564 2061 6e64 2070 6f73   assesed and pos
+00000f70: 6974 6976 6520 636c 6173 7320 636f 6e74  itive class cont
+00000f80: 6169 6e73 206e 2073 616d 706c 6573 2c20  ains n samples, 
+00000f90: 7468 656e 2031 3030 2a6e 2061 7567 6d65  then 100*n augme
+00000fa0: 6e74 6564 2069 6d61 6765 7320 7769 6c6c  nted images will
+00000fb0: 2062 6520 6372 6561 7465 642c 200a 2020   be created, .  
+00000fc0: 2020 2020 2020 616e 6420 7468 6572 6566        and theref
+00000fd0: 6f72 6520 6475 7269 6e67 2074 6861 7420  ore during that 
+00000fe0: 7061 7274 6963 756c 6172 2074 7269 616c  particular trial
+00000ff0: 2074 6865 2066 6972 7374 2031 3030 2a6e   the first 100*n
+00001000: 2073 616d 706c 6573 2066 726f 6d20 6e65   samples from ne
+00001010: 6761 7469 7665 5f63 6c61 7373 2077 696c  gative_class wil
+00001020: 6c20 6265 2075 7365 642c 2069 6620 6176  l be used, if av
+00001030: 6169 6c61 626c 652e 200a 2020 2020 2020  ailable. .      
+00001040: 2020 546f 2075 7365 2074 6865 2065 6e74    To use the ent
+00001050: 6972 6520 6e65 6761 7469 7665 5f63 6c61  ire negative_cla
+00001060: 7373 2073 616d 706c 6520 7265 6761 7264  ss sample regard
+00001070: 6c65 7373 206f 6620 7468 6520 6e75 6d62  less of the numb
+00001080: 6572 2061 7567 6d65 6e74 6174 696f 6e73  er augmentations
+00001090: 2070 6572 666f 726d 6564 2c20 7365 7420   performed, set 
+000010a0: 6261 6c61 6e63 653d 4661 6c73 652e 0a20  balance=False.. 
+000010b0: 2020 200a 2020 2020 2020 2020 5468 6520     .        The 
+000010c0: 6d69 6e5f 7069 7865 6c20 616e 6420 6d61  min_pixel and ma
+000010d0: 785f 7069 7865 6c20 7661 6c75 6520 7769  x_pixel value wi
+000010e0: 6c6c 2062 6520 7573 6564 2074 6f20 6d69  ll be used to mi
+000010f0: 6e2d 6d61 7820 6e6f 726d 616c 697a 6520  n-max normalize 
+00001100: 7468 6520 696d 6167 6573 2c20 6966 206e  the images, if n
+00001110: 6f72 6d61 6c69 7a65 3d54 7275 652e 2054  ormalize=True. T
+00001120: 6865 206f 7074 5f6d 6178 5f6d 696e 5f70  he opt_max_min_p
+00001130: 6978 0a20 2020 2020 2020 2061 6e64 206f  ix.        and o
+00001140: 7074 5f6d 6178 5f6d 6178 5f70 6978 2c20  pt_max_max_pix, 
+00001150: 7768 656e 2073 6574 2c20 7769 6c6c 2062  when set, will b
+00001160: 6520 7573 6564 2069 6e73 7465 6164 2064  e used instead d
+00001170: 7572 696e 6720 7468 6520 6f70 7469 6d69  uring the optimi
+00001180: 7a61 7469 6f6e 2070 726f 6365 6475 7265  zation procedure
+00001190: 2c20 736f 2061 7320 746f 2064 6574 6572  , so as to deter
+000011a0: 6d69 6e65 0a20 2020 2020 2020 2077 6861  mine.        wha
+000011b0: 7420 6f70 7469 6d61 6c20 6d61 7869 6d75  t optimal maximu
+000011c0: 6d20 7661 6c75 6520 746f 2075 7365 2077  m value to use w
+000011d0: 6865 6e20 6e6f 726d 616c 697a 696e 6720  hen normalizing 
+000011e0: 7468 6520 696d 6167 6573 2e20 5468 6973  the images. This
+000011f0: 2069 7320 696d 706f 7274 616e 7420 7768   is important wh
+00001200: 656e 2064 6561 6c69 6e67 2077 6974 6820  en dealing with 
+00001210: 6465 6570 2d73 7572 7665 7920 6461 7461  deep-survey data
+00001220: 2e20 0a20 2020 2020 2020 2049 6620 6f70  . .        If op
+00001230: 7469 6d69 7a69 6e67 2074 6865 206e 6f72  timizing the nor
+00001240: 6d61 6c69 7a61 7469 6f6e 2073 6368 656d  malization schem
+00001250: 652c 2074 6865 2064 6566 6175 6c74 206d  e, the default m
+00001260: 696e 5f70 6978 656c 2077 696c 6c20 6265  in_pixel will be
+00001270: 2073 6574 2074 6f20 7a65 726f 2c20 6173   set to zero, as
+00001280: 2073 7563 6820 6f6e 6c79 2074 6865 206f   such only the o
+00001290: 7074 696d 616c 206d 6178 5f70 6978 656c  ptimal max_pixel
+000012a0: 200a 2020 2020 2020 2020 666f 7220 6576   .        for ev
+000012b0: 6572 7920 6261 6e64 2077 696c 6c20 6265  ery band will be
+000012c0: 206f 7574 7075 742e 0a0a 2020 2020 4172   output...    Ar
+000012d0: 6773 3a0a 2020 2020 2020 2020 706f 7369  gs:.        posi
+000012e0: 7469 7665 5f63 6c61 7373 2028 6e64 6172  tive_class (ndar
+000012f0: 7261 7929 3a20 5468 6520 7361 6d70 6c65  ray): The sample
+00001300: 7320 666f 7220 7468 6520 6669 7273 7420  s for the first 
+00001310: 636c 6173 7320 7368 6f75 6c64 2062 6520  class should be 
+00001320: 7061 7373 6564 2c20 7768 6963 6820 7769  passed, which wi
+00001330: 6c6c 2061 7574 6f6d 6174 6963 616c 6c79  ll automatically
+00001340: 200a 2020 2020 2020 2020 2020 2020 6265   .            be
+00001350: 2061 7373 6967 6e65 6420 7468 6520 706f   assigned the po
+00001360: 7369 7469 7665 206c 6162 656c 2027 3127  sitive label '1'
+00001370: 2e0a 2020 2020 2020 2020 6e65 6761 7469  ..        negati
+00001380: 7665 5f63 6c61 7373 2028 6e64 6172 7261  ve_class (ndarra
+00001390: 7929 3a20 5468 6520 7361 6d70 6c65 7320  y): The samples 
+000013a0: 666f 7220 7468 6520 7365 636f 6e64 2063  for the second c
+000013b0: 6c61 7373 2073 686f 756c 6420 6265 2070  lass should be p
+000013c0: 6173 7365 642c 2077 6869 6368 2077 696c  assed, which wil
+000013d0: 6c20 6175 746f 6d61 7469 6361 6c6c 7920  l automatically 
+000013e0: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
+000013f0: 6173 7369 676e 6564 2074 6865 206e 6567  assigned the neg
+00001400: 6174 6976 6520 6c61 6265 6c20 2730 272e  ative label '0'.
+00001410: 0a20 2020 2020 2020 2069 6d67 5f6e 756d  .        img_num
+00001420: 5f63 6861 6e6e 656c 7320 2869 6e74 293a  _channels (int):
+00001430: 2054 6865 206e 756d 6265 7220 6f66 2066   The number of f
+00001440: 696c 7465 7273 2e20 4465 6661 756c 7473  ilters. Defaults
+00001450: 2074 6f20 312e 0a20 2020 2020 2020 206e   to 1..        n
+00001460: 6f72 6d61 6c69 7a65 2028 626f 6f6c 2c20  ormalize (bool, 
+00001470: 6f70 7469 6f6e 616c 293a 2049 6620 5472  optional): If Tr
+00001480: 7565 2074 6865 2064 6174 6120 7769 6c6c  ue the data will
+00001490: 2062 6520 6d69 6e2d 6d61 7820 6e6f 726d   be min-max norm
+000014a0: 616c 697a 6564 2075 7369 6e67 2074 6865  alized using the
+000014b0: 200a 2020 2020 2020 2020 2020 2020 696e   .            in
+000014c0: 7075 7420 6d69 6e20 616e 6420 6d61 7820  put min and max 
+000014d0: 7069 7865 6c73 2e20 4465 6661 756c 7473  pixels. Defaults
+000014e0: 2074 6f20 5472 7565 2e0a 2020 2020 2020   to True..      
+000014f0: 2020 6d69 6e5f 7069 7865 6c20 2869 6e74    min_pixel (int
+00001500: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
+00001510: 206d 696e 696d 756d 2070 6978 656c 2063   minimum pixel c
+00001520: 6f75 6e74 2c20 7069 7865 6c73 2077 6974  ount, pixels wit
+00001530: 6820 636f 756e 7473 200a 2020 2020 2020  h counts .      
+00001540: 2020 2020 2020 6265 6c6f 7720 7468 6973        below this
+00001550: 2074 6872 6573 686f 6c64 2077 696c 6c20   threshold will 
+00001560: 6265 2073 6574 2074 6f20 7468 6973 206c  be set to this l
+00001570: 696d 6974 2e20 4465 6661 756c 7473 2074  imit. Defaults t
+00001580: 6f20 302e 0a20 2020 2020 2020 206d 6178  o 0..        max
+00001590: 5f70 6978 656c 2028 696e 742c 206c 6973  _pixel (int, lis
+000015a0: 742c 206f 7074 696f 6e61 6c29 3a20 5468  t, optional): Th
+000015b0: 6520 6d61 7869 6d75 6d20 7069 7865 6c20  e maximum pixel 
+000015c0: 636f 756e 742c 2070 6978 656c 7320 7769  count, pixels wi
+000015d0: 7468 2063 6f75 6e74 7320 0a20 2020 2020  th counts .     
+000015e0: 2020 2020 2020 2061 626f 7665 2074 6869         above thi
+000015f0: 7320 7468 7265 7368 6f6c 6420 7769 6c6c  s threshold will
+00001600: 2062 6520 7365 7420 746f 2074 6869 7320   be set to this 
+00001610: 6c69 6d69 742e 2044 6566 6175 6c74 7320  limit. Defaults 
+00001620: 746f 2031 3030 2e20 4966 2069 6d67 5f6e  to 100. If img_n
+00001630: 756d 5f63 6861 6e6e 656c 730a 2020 2020  um_channels.    
+00001640: 2020 2020 2020 2020 6973 206e 6f74 2031          is not 1
+00001650: 2c20 7468 6520 6d61 785f 7069 7865 6c20  , the max_pixel 
+00001660: 7368 6f75 6c64 2062 6520 6120 6c69 7374  should be a list
+00001670: 2063 6f6e 7461 696e 696e 6720 7477 6f20   containing two 
+00001680: 7661 6c75 6573 2c20 6f6e 6520 666f 7220  values, one for 
+00001690: 6561 6368 2062 616e 642e 0a20 2020 2020  each band..     
+000016a0: 2020 2076 616c 5f70 6f73 6974 6976 6520     val_positive 
+000016b0: 286e 6461 7272 6179 2c20 6f70 7469 6f6e  (ndarray, option
+000016c0: 616c 293a 2050 6f73 6974 6976 6520 636c  al): Positive cl
+000016d0: 6173 7320 6461 7461 2074 6f20 6265 2075  ass data to be u
+000016e0: 7365 6420 666f 7220 7661 6c69 6461 7469  sed for validati
+000016f0: 6f6e 2e20 4465 6661 756c 7473 2074 6f20  on. Defaults to 
+00001700: 4e6f 6e65 2e0a 2020 2020 2020 2020 7661  None..        va
+00001710: 6c5f 6e65 6761 7469 7665 2028 6e64 6172  l_negative (ndar
+00001720: 7261 792c 206f 7074 696f 6e61 6c29 3a20  ray, optional): 
+00001730: 4e65 6761 7469 7665 2063 6c61 7373 2064  Negative class d
+00001740: 6174 6120 746f 2062 6520 7573 6564 2066  ata to be used f
+00001750: 6f72 2076 616c 6964 6174 696f 6e2e 2044  or validation. D
+00001760: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
+00001770: 0a20 2020 2020 2020 2074 6573 745f 706f  .        test_po
+00001780: 7369 7469 7665 2028 6e64 6172 7261 792c  sitive (ndarray,
+00001790: 206f 7074 696f 6e61 6c29 3a20 506f 7369   optional): Posi
+000017a0: 7469 7665 2063 6c61 7373 2064 6174 6120  tive class data 
+000017b0: 746f 2062 6520 7573 6564 2066 6f72 2070  to be used for p
+000017c0: 6f73 742d 7472 6961 6c20 7465 7374 696e  ost-trial testin
+000017d0: 672e 2044 6566 6175 6c74 7320 746f 204e  g. Defaults to N
+000017e0: 6f6e 652e 0a20 2020 2020 2020 2074 6573  one..        tes
+000017f0: 745f 6e65 6761 7469 7665 2028 6e64 6172  t_negative (ndar
+00001800: 7261 792c 206f 7074 696f 6e61 6c29 3a20  ray, optional): 
+00001810: 4e65 6761 7469 7665 2063 6c61 7373 2064  Negative class d
+00001820: 6174 6120 746f 2062 6520 7573 6564 2066  ata to be used f
+00001830: 6f72 2070 6f73 742d 7472 6961 6c20 7465  or post-trial te
+00001840: 7374 696e 672e 2044 6566 6175 6c74 7320  sting. Defaults 
+00001850: 746f 204e 6f6e 652e 0a20 2020 2020 2020  to None..       
+00001860: 2074 6573 745f 6163 635f 7468 7265 7368   test_acc_thresh
+00001870: 6f6c 6420 2866 6c6f 6174 2c20 6f70 7469  old (float, opti
+00001880: 6f6e 616c 293a 2049 6620 696e 7075 742c  onal): If input,
+00001890: 206d 6f64 656c 7320 7468 6174 2079 6965   models that yie
+000018a0: 6c64 2074 6573 7420 6163 6375 7261 6369  ld test accuraci
+000018b0: 6573 206c 6f77 6572 2074 6861 6e20 7468  es lower than th
+000018c0: 6520 7468 7265 7368 6f6c 6420 7769 6c6c  e threshold will
+000018d0: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
+000018e0: 7265 6a65 6374 6564 2062 7920 7468 6520  rejected by the 
+000018f0: 6f70 7469 6d69 7a65 722e 2054 6865 2061  optimizer. The a
+00001900: 6363 7572 6163 7920 6f66 2062 6f74 6820  ccuracy of both 
+00001910: 7468 6520 7465 7374 5f70 6f73 6974 6976  the test_positiv
+00001920: 6520 616e 6420 7465 7374 5f6e 6567 6174  e and test_negat
+00001930: 6976 6520 6973 2061 7365 7373 6564 2c20  ive is asessed, 
+00001940: 6966 2069 6e70 7574 2e0a 2020 2020 2020  if input..      
+00001950: 2020 2020 2020 5468 6973 2069 7320 7573        This is us
+00001960: 6564 2074 6f20 7265 6a65 6374 206d 6f64  ed to reject mod
+00001970: 656c 7320 7468 6174 2068 6176 6520 6f76  els that have ov
+00001980: 6572 206f 7220 756e 6465 7220 6669 7420  er or under fit 
+00001990: 7468 6520 7472 6169 6e69 6e67 2064 6174  the training dat
+000019a0: 612e 2044 6566 6175 6c74 7320 746f 204e  a. Defaults to N
+000019b0: 6f6e 652e 0a20 2020 2020 2020 2070 6f73  one..        pos
+000019c0: 745f 6d65 7472 6963 2028 626f 6f6c 293a  t_metric (bool):
+000019d0: 2049 6620 5472 7565 2c20 7468 6520 7465   If True, the te
+000019e0: 7374 5f70 6f73 6974 6976 6520 616e 642f  st_positive and/
+000019f0: 6f72 2074 6573 745f 6e65 6761 7469 7665  or test_negative
+00001a00: 2069 6e70 7574 7320 7769 6c6c 2062 6520   inputs will be 
+00001a10: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
+00001a20: 6669 6e61 6c20 6f70 7469 6d69 7a61 7469  final optimizati
+00001a30: 6f6e 2073 636f 7265 2e0a 2020 2020 2020  on score..      
+00001a40: 2020 2020 2020 5468 6973 2077 696c 6c20        This will 
+00001a50: 6265 2074 6865 2061 7665 7261 6765 6420  be the averaged 
+00001a60: 6f75 7420 6d65 7472 6963 2e20 4465 6661  out metric. Defa
+00001a70: 756c 7473 2074 6f20 5472 7565 2e20 4361  ults to True. Ca
+00001a80: 6e20 6265 2073 6574 2074 6f20 4661 6c73  n be set to Fals
+00001a90: 6520 746f 206f 6e6c 7920 6170 706c 7920  e to only apply 
+00001aa0: 7468 6520 7465 7374 5f61 6363 5f74 6872  the test_acc_thr
+00001ab0: 6573 686f 6c64 2e0a 2020 2020 2020 2020  eshold..        
+00001ac0: 7472 6169 6e5f 6570 6f63 6873 2028 696e  train_epochs (in
+00001ad0: 7429 3a20 4e75 6d62 6572 206f 6620 6570  t): Number of ep
+00001ae0: 6f63 6873 2074 6f20 7468 6520 7472 6169  ochs to the trai
+00001af0: 6e20 7468 6520 434e 4e20 746f 2064 7572  n the CNN to dur
+00001b00: 696e 6720 7468 6520 6f70 7469 6d69 7a61  ing the optimiza
+00001b10: 7469 6f6e 2074 7269 616c 732e 2044 6566  tion trials. Def
+00001b20: 6175 6c74 7320 746f 2032 352e 0a20 2020  aults to 25..   
+00001b30: 2020 2020 206d 6574 7269 6320 2873 7472       metric (str
+00001b40: 293a 2041 7373 6573 6d65 6e74 206d 6574  ): Assesment met
+00001b50: 7269 6320 746f 2075 7365 2077 6865 6e20  ric to use when 
+00001b60: 626f 7468 2070 7275 6e69 6e67 2061 6e64  both pruning and
+00001b70: 2073 636f 7269 6e67 2074 6865 2068 7970   scoring the hyp
+00001b80: 6572 7061 7261 6d65 7465 7220 6f70 7469  erparameter opti
+00001b90: 6d69 7a61 7469 6f6e 2074 7269 616c 2e0a  mization trial..
+00001ba0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+00001bb0: 756c 7473 2074 6f20 276c 6f73 7327 2e20  ults to 'loss'. 
+00001bc0: 4f70 7469 6f6e 7320 696e 636c 7564 653a  Options include:
+00001bd0: 2027 6c6f 7373 2720 2762 696e 6172 795f   'loss' 'binary_
+00001be0: 6163 6375 7261 6379 272c 2027 6631 5f73  accuracy', 'f1_s
+00001bf0: 636f 7265 2720 2761 6c6c 2720 6f72 2074  core' 'all' or t
+00001c00: 6865 2076 616c 6964 6174 696f 6e20 6571  he validation eq
+00001c10: 7569 7661 6c65 6e74 7320 2865 2e67 2e20  uivalents (e.g. 
+00001c20: 2776 616c 5f6c 6f73 7327 292e 0a20 2020  'val_loss')..   
+00001c30: 2020 2020 206d 6574 7269 6332 2028 7374       metric2 (st
+00001c40: 722c 206f 7074 696f 6e61 6c29 3a20 4164  r, optional): Ad
+00001c50: 6469 7469 6f6e 616c 206d 6574 7269 6320  ditional metric 
+00001c60: 746f 2062 6520 7573 6564 2073 6f6c 656c  to be used solel
+00001c70: 7920 666f 7220 6561 726c 792d 7374 6f70  y for early-stop
+00001c80: 7069 6e67 2070 7572 706f 7365 732e 2049  ping purposes. I
+00001c90: 6620 696e 7075 742c 2074 6865 2074 7269  f input, the tri
+00001ca0: 616c 2077 696c 6c20 7374 6f70 2069 6620  al will stop if 
+00001cb0: 6569 7468 6572 0a20 2020 2020 2020 2020  either.         
+00001cc0: 2020 206d 6574 7269 6320 6f72 206d 6574     metric or met
+00001cd0: 7269 6332 2073 746f 7020 696d 7072 6f76  ric2 stop improv
+00001ce0: 696e 6720 6166 7465 7220 7468 6520 7361  ing after the sa
+00001cf0: 6d65 2070 6174 6965 6e63 6520 6e75 6d62  me patience numb
+00001d00: 6572 206f 6620 6570 6f63 6873 2c20 6275  er of epochs, bu
+00001d10: 7420 6f6e 6c79 2074 6865 2076 616c 7565  t only the value
+00001d20: 206f 6620 6d65 7472 6963 2069 7320 7573   of metric is us
+00001d30: 6564 2074 6f20 6173 7365 7373 0a20 2020  ed to assess.   
+00001d40: 2020 2020 2020 2020 2074 6865 2070 6572           the per
+00001d50: 666f 726d 616e 6365 206f 6620 7468 6520  formance of the 
+00001d60: 6d6f 6465 6c20 6166 7465 7220 6561 6368  model after each
+00001d70: 2074 7269 616c 2e20 4465 6661 756c 7473   trial. Defaults
+00001d80: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+00001d90: 2020 7061 7469 656e 6365 2028 696e 7429    patience (int)
+00001da0: 3a20 4e75 6d62 6572 206f 6620 6570 6f63  : Number of epoc
+00001db0: 6873 2077 6974 686f 7574 2069 6d70 726f  hs without impro
+00001dc0: 7665 6d65 6e74 2062 6566 6f72 6520 7468  vement before th
+00001dd0: 6520 6f70 7469 6d69 7a61 7469 6f6e 2074  e optimization t
+00001de0: 7269 616c 2069 7320 7465 726d 696e 6174  rial is terminat
+00001df0: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
+00001e00: 302c 2077 6869 6368 0a20 2020 2020 2020  0, which.       
+00001e10: 2020 2020 2064 6973 6162 6c65 7320 7468       disables th
+00001e20: 6973 2066 6561 7475 7265 2e0a 2020 2020  is feature..    
+00001e30: 2020 2020 6176 6572 6167 6520 2862 6f6f      average (boo
+00001e40: 6c29 3a20 4966 2046 616c 7365 2c20 7468  l): If False, th
+00001e50: 6520 6465 7369 676e 6174 6564 206d 6574  e designated met
+00001e60: 7269 6320 7769 6c6c 2062 6520 6361 6c63  ric will be calc
+00001e70: 756c 6174 6564 2061 6363 6f72 6469 6e67  ulated according
+00001e80: 2074 6f20 6974 7320 7661 6c75 6520 6174   to its value at
+00001e90: 2074 6865 2065 6e64 206f 6620 7468 6520   the end of the 
+00001ea0: 7472 6169 6e5f 6570 6f63 6873 2e20 0a20  train_epochs. . 
+00001eb0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00001ec0: 7565 2c20 7468 6520 6d65 7472 6963 2077  ue, the metric w
+00001ed0: 696c 6c20 6265 2061 7665 7261 6765 6420  ill be averaged 
+00001ee0: 6f75 7420 6163 726f 7373 2061 6c6c 2074  out across all t
+00001ef0: 7261 696e 5f65 706f 6368 732e 2044 6566  rain_epochs. Def
+00001f00: 6175 6c74 7320 746f 2054 7275 652e 0a20  aults to True.. 
+00001f10: 2020 2020 2020 206f 7074 5f6d 6f64 656c         opt_model
+00001f20: 2028 626f 6f6c 293a 2049 6620 5472 7565   (bool): If True
+00001f30: 2c20 7468 6520 6172 6368 6974 6563 7475  , the architectu
+00001f40: 7265 2070 6172 616d 6574 6572 7320 7769  re parameters wi
+00001f50: 6c6c 2062 6520 6f70 7469 6d69 7a65 642e  ll be optimized.
+00001f60: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
+00001f70: 652e 0a20 2020 2020 2020 206f 7074 5f61  e..        opt_a
+00001f80: 7567 2028 626f 6f6c 293a 2049 6620 5472  ug (bool): If Tr
+00001f90: 7565 2c20 7468 6520 6175 676d 656e 7461  ue, the augmenta
+00001fa0: 7469 6f6e 2070 726f 6365 6475 7265 2077  tion procedure w
+00001fb0: 696c 6c20 6265 206f 7074 696d 697a 6564  ill be optimized
+00001fc0: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
+00001fd0: 6c73 652e 0a20 2020 2020 2020 2062 6174  lse..        bat
+00001fe0: 6368 5f6d 696e 2028 696e 7429 3a20 5468  ch_min (int): Th
+00001ff0: 6520 6d69 6e69 6d75 6d20 6e75 6d62 6572  e minimum number
+00002000: 206f 6620 6175 676d 656e 7461 7469 6f6e   of augmentation
+00002010: 7320 746f 2070 6572 666f 726d 2070 6572  s to perform per
+00002020: 2069 6d61 6765 206f 6e20 7468 6520 706f   image on the po
+00002030: 7369 7469 7665 2063 6c61 7373 2c20 6f6e  sitive class, on
+00002040: 6c79 2061 7070 6c69 6361 626c 6520 0a20  ly applicable . 
+00002050: 2020 2020 2020 2020 2020 2069 6620 6f70             if op
+00002060: 745f 6175 673d 5472 7565 2e20 4465 6661  t_aug=True. Defa
+00002070: 756c 7473 2074 6f20 322e 0a20 2020 2020  ults to 2..     
+00002080: 2020 2062 6174 6368 5f6d 6178 2028 696e     batch_max (in
+00002090: 7429 3a20 5468 6520 6d61 7869 6d75 6d20  t): The maximum 
+000020a0: 6e75 6d62 6572 206f 6620 6175 676d 656e  number of augmen
+000020b0: 7461 7469 6f6e 7320 746f 2070 6572 666f  tations to perfo
+000020c0: 726d 2070 6572 2069 6d61 6765 206f 6e20  rm per image on 
+000020d0: 7468 6520 706f 7369 7469 7665 2063 6c61  the positive cla
+000020e0: 7373 2c20 6f6e 6c79 2061 7070 6c69 6361  ss, only applica
+000020f0: 626c 6520 0a20 2020 2020 2020 2020 2020  ble .           
+00002100: 2069 6620 6f70 745f 6175 673d 5472 7565   if opt_aug=True
+00002110: 2e20 4465 6661 756c 7473 2074 6f20 3235  . Defaults to 25
+00002120: 2e0a 2020 2020 2020 2020 6261 7463 685f  ..        batch_
+00002130: 6f74 6865 7220 2869 6e74 293a 2054 6865  other (int): The
+00002140: 206e 756d 6265 7220 6f66 2061 7567 6d65   number of augme
+00002150: 6e74 6174 696f 6e73 2074 6f20 7065 7266  ntations to perf
+00002160: 6f72 6d20 746f 2074 6865 206f 7468 6572  orm to the other
+00002170: 2063 6c61 7373 2c20 7072 6573 756d 6564   class, presumed
+00002180: 2074 6f20 6265 2074 6865 206d 616a 6f72   to be the major
+00002190: 6974 7920 636c 6173 732e 0a20 2020 2020  ity class..     
+000021a0: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+000021b0: 746f 2031 2e20 5468 6973 2069 7320 646f  to 1. This is do
+000021c0: 6e65 2074 6f20 656e 7375 7265 2061 7567  ne to ensure aug
+000021d0: 6d65 6e74 6174 696f 6e20 7465 6368 6e69  mentation techni
+000021e0: 7175 6573 2061 7265 2061 7070 6c69 6564  ques are applied
+000021f0: 2063 6f6e 7369 7374 656e 746c 7920 6163   consistently ac
+00002200: 726f 7373 2062 6f74 6820 636c 6173 7365  ross both classe
+00002210: 732e 0a20 2020 2020 2020 2069 6d61 6765  s..        image
+00002220: 5f73 697a 655f 6d69 6e20 2869 6e74 293a  _size_min (int):
+00002230: 2054 6865 206d 696e 696d 756d 2069 6d61   The minimum ima
+00002240: 6765 2073 697a 6520 746f 2061 7373 6573  ge size to asses
+00002250: 732c 206f 6e6c 7920 6170 706c 6963 6162  s, only applicab
+00002260: 6c65 2069 6620 6f70 745f 6175 673d 5472  le if opt_aug=Tr
+00002270: 7565 2e20 4465 6661 756c 7473 2074 6f20  ue. Defaults to 
+00002280: 3530 2e0a 2020 2020 2020 2020 696d 6167  50..        imag
+00002290: 655f 7369 7a65 5f6d 6178 2028 696e 7429  e_size_max (int)
+000022a0: 3a20 5468 6520 6d61 7869 6d75 6d20 696d  : The maximum im
+000022b0: 6167 6520 7369 7a65 2074 6f20 6173 7365  age size to asse
+000022c0: 7373 2c20 6f6e 6c79 2061 7070 6c69 6361  ss, only applica
+000022d0: 626c 6520 6966 206f 7074 5f61 7567 3d54  ble if opt_aug=T
+000022e0: 7275 652e 2044 6566 6175 6c74 7320 746f  rue. Defaults to
+000022f0: 2031 3030 2e0a 2020 2020 2020 2020 6f70   100..        op
+00002300: 745f 6d61 785f 6d69 6e5f 7069 7820 2869  t_max_min_pix (i
+00002310: 6e74 2c20 6f70 7469 6f6e 616c 293a 2054  nt, optional): T
+00002320: 6865 206d 696e 696d 756d 206d 6178 2070  he minimum max p
+00002330: 6978 656c 2076 616c 7565 2074 6f20 7573  ixel value to us
+00002340: 6520 7768 656e 2074 756e 696e 6720 7468  e when tuning th
+00002350: 6520 6e6f 726d 616c 697a 6174 696f 6e20  e normalization 
+00002360: 7072 6f63 6564 7572 652c 200a 2020 2020  procedure, .    
+00002370: 2020 2020 2020 2020 6f6e 6c79 2061 7070          only app
+00002380: 6c69 6361 626c 6520 6966 206f 7074 5f61  licable if opt_a
+00002390: 7567 3d54 7275 652e 2044 6566 6175 6c74  ug=True. Default
+000023a0: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
+000023b0: 2020 206f 7074 5f6d 6178 5f6d 6178 5f70     opt_max_max_p
+000023c0: 6978 2028 696e 742c 206f 7074 696f 6e61  ix (int, optiona
+000023d0: 6c29 3a20 5468 6520 6d61 7869 6d75 6d20  l): The maximum 
+000023e0: 6d61 7820 7069 7865 6c20 7661 6c75 6520  max pixel value 
+000023f0: 746f 2075 7365 2077 6865 6e20 7475 6e69  to use when tuni
+00002400: 6e67 2074 6865 206e 6f72 6d61 6c69 7a61  ng the normaliza
+00002410: 7469 6f6e 2070 726f 6365 6475 7265 2c20  tion procedure, 
+00002420: 0a20 2020 2020 2020 2020 2020 206f 6e6c  .            onl
+00002430: 7920 6170 706c 6963 6162 6c65 2069 6620  y applicable if 
+00002440: 6f70 745f 6175 673d 5472 7565 2e20 4465  opt_aug=True. De
+00002450: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
+00002460: 2020 2020 2020 2020 7368 6966 7420 2869          shift (i
+00002470: 6e74 293a 2054 6865 206d 6178 2061 6c6c  nt): The max all
+00002480: 6f77 6564 2076 6572 7469 6361 6c2f 686f  owed vertical/ho
+00002490: 7269 7a6f 6e74 616c 2073 6869 6674 7320  rizontal shifts 
+000024a0: 746f 2075 7365 2064 7572 696e 6720 7468  to use during th
+000024b0: 6520 6461 7461 2061 7567 6d65 6e74 6174  e data augmentat
+000024c0: 696f 6e20 726f 7574 696e 652c 206f 6e6c  ion routine, onl
+000024d0: 7920 6170 706c 6963 6162 6c65 0a20 2020  y applicable.   
+000024e0: 2020 2020 2020 2020 2069 6620 6f70 745f           if opt_
+000024f0: 6175 673d 5472 7565 2e20 4465 6661 756c  aug=True. Defaul
+00002500: 7473 2074 6f20 3130 2070 6978 656c 732e  ts to 10 pixels.
+00002510: 0a20 2020 2020 2020 206d 6173 6b5f 7369  .        mask_si
+00002520: 7a65 2028 696e 742c 206f 7074 696f 6e61  ze (int, optiona
+00002530: 6c29 3a20 4966 2065 6e61 626c 6564 2c20  l): If enabled, 
+00002540: 7468 6973 2077 696c 6c20 7365 7420 7468  this will set th
+00002550: 6520 7069 7865 6c20 6c65 6e67 7468 206f  e pixel length o
+00002560: 6620 6120 7371 7561 7265 2063 7574 6f75  f a square cutou
+00002570: 742c 2074 6f20 6265 2072 616e 646f 6d6c  t, to be randoml
+00002580: 7920 706c 6163 6564 0a20 2020 2020 2020  y placed.       
+00002590: 2020 2020 2073 6f6d 6577 6865 7265 2069       somewhere i
+000025a0: 6e20 7468 6520 6175 676d 656e 7465 6420  n the augmented 
+000025b0: 696d 6167 652e 2054 6869 7320 6375 746f  image. This cuto
+000025c0: 7574 2077 696c 6c20 7265 706c 6163 6520  ut will replace 
+000025d0: 7468 6520 696d 6167 6520 7661 6c75 6573  the image values
+000025e0: 2077 6974 6820 302c 2074 6865 7265 666f   with 0, therefo
+000025f0: 7265 2073 6572 7669 6e67 2061 7320 6120  re serving as a 
+00002600: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
+00002610: 756c 6172 697a 6572 2e20 4f6e 6c79 2061  ularizer. Only a
+00002620: 7070 6c69 6361 626c 6520 6966 206f 7074  pplicable if opt
+00002630: 5f61 7567 3d54 7275 652e 2054 6869 7320  _aug=True. This 
+00002640: 7661 6c75 6520 6361 6e20 6569 7468 6572  value can either
+00002650: 2062 6520 616e 2069 6e74 6567 6572 2074   be an integer t
+00002660: 6f20 6861 7264 2d73 6574 2074 6865 206d  o hard-set the m
+00002670: 6173 6b20 7369 7a65 2065 7665 7279 7469  ask size everyti
+00002680: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00002690: 6f72 2063 616e 2062 6520 6120 7475 706c  or can be a tupl
+000026a0: 6520 7265 7072 6573 656e 7469 6e67 2074  e representing t
+000026b0: 6865 206c 6f77 6572 2061 6e64 2075 7070  he lower and upp
+000026c0: 6572 2062 6f75 6e64 732c 2072 6573 7065  er bounds, respe
+000026d0: 6374 6976 656c 792c 2069 6e20 7768 6963  ctively, in whic
+000026e0: 6820 6361 7365 2074 6865 206d 6173 6b20  h case the mask 
+000026f0: 7369 7a65 2077 696c 6c20 6265 206f 7074  size will be opt
+00002700: 696d 697a 6564 2e20 0a20 2020 2020 2020  imized. .       
+00002710: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
+00002720: 204e 6f6e 652e 0a20 2020 2020 2020 206e   None..        n
+00002730: 756d 5f6d 6173 6b73 2028 696e 742c 206f  um_masks (int, o
+00002740: 7074 696f 6e61 6c29 3a20 5468 6520 6e75  ptional): The nu
+00002750: 6d62 6572 206f 6620 6d61 736b 7320 746f  mber of masks to
+00002760: 2063 7265 6174 652c 2074 6f20 6265 2075   create, to be u
+00002770: 7365 6420 616c 6f6e 6773 6964 6520 7468  sed alongside th
+00002780: 6520 6d61 736b 5f73 697a 6520 7061 7261  e mask_size para
+00002790: 6d65 7465 722e 204e 6f74 6520 7468 6174  meter. Note that
+000027a0: 2069 6620 0a20 2020 2020 2020 2020 2020   if .           
+000027b0: 2074 6869 7320 6973 2073 6574 2074 6f20   this is set to 
+000027c0: 6120 7661 6c75 6520 6772 6561 7465 7220  a value greater 
+000027d0: 7468 616e 206f 6e65 2c20 6f76 6572 6c61  than one, overla
+000027e0: 7020 6d61 7920 6f63 6375 722e 2054 6869  p may occur. Thi
+000027f0: 7320 7661 6c75 6520 6361 6e20 6569 7468  s value can eith
+00002800: 6572 2062 6520 616e 2069 6e74 6567 6572  er be an integer
+00002810: 2074 6f20 6861 7264 2d73 6574 2074 6865   to hard-set the
+00002820: 206e 756d 6265 720a 2020 2020 2020 2020   number.        
+00002830: 2020 2020 6f66 206d 6173 6b73 2065 7665      of masks eve
+00002840: 7279 7469 6d65 2c20 6f72 2069 7420 6361  rytime, or it ca
+00002850: 6e20 6265 2061 2074 7570 6c65 2072 6570  n be a tuple rep
+00002860: 7265 7365 6e74 696e 6720 7468 6520 6c6f  resenting the lo
+00002870: 7765 7220 616e 6420 7570 7065 7220 626f  wer and upper bo
+00002880: 756e 6473 2c20 7265 7370 6563 7469 7665  unds, respective
+00002890: 6c79 2c20 696e 2077 6869 6368 2063 6173  ly, in which cas
+000028a0: 6520 7468 6520 6e75 6d62 6572 0a20 2020  e the number.   
+000028b0: 2020 2020 2020 2020 206f 6620 6d61 736b           of mask
+000028c0: 7320 7769 6c6c 2062 6520 6f70 7469 6d69  s will be optimi
+000028d0: 7a65 642e 2044 6566 6175 6c74 7320 746f  zed. Defaults to
+000028e0: 204e 6f6e 652e 0a20 2020 2020 2020 2076   None..        v
+000028f0: 6572 626f 7365 2028 696e 7429 3a20 436f  erbose (int): Co
+00002900: 6e74 726f 6c73 2074 6865 2061 6d6f 756e  ntrols the amoun
+00002910: 7420 6f66 206f 7574 7075 7420 7072 696e  t of output prin
+00002920: 7465 6420 6475 7269 6e67 2074 6865 2074  ted during the t
+00002930: 7261 696e 696e 6720 7072 6f63 6573 732e  raining process.
+00002940: 2041 2076 616c 7565 206f 6620 3020 6973   A value of 0 is
+00002950: 2066 6f72 2073 696c 656e 7420 6d6f 6465   for silent mode
+00002960: 2c20 0a20 2020 2020 2020 2020 2020 2061  , .            a
+00002970: 2076 616c 7565 206f 6620 3120 6973 2075   value of 1 is u
+00002980: 7365 6420 666f 7220 7072 6f67 7265 7373  sed for progress
+00002990: 2062 6172 206d 6f64 652c 2061 6e64 2032   bar mode, and 2
+000029a0: 2066 6f72 206f 6e65 206c 696e 6520 7065   for one line pe
+000029b0: 7220 6570 6f63 6820 6d6f 6465 2e20 4465  r epoch mode. De
+000029c0: 6661 756c 7473 2074 6f20 312e 0a20 2020  faults to 1..   
+000029d0: 2020 2020 206f 7074 5f63 7620 2869 6e74       opt_cv (int
+000029e0: 293a 2043 726f 7373 2d76 616c 6964 6174  ): Cross-validat
+000029f0: 696f 6e73 2074 6f20 7065 7266 6f72 6d20  ions to perform 
+00002a00: 7768 656e 2061 7373 6573 7369 6e67 2074  when assessing t
+00002a10: 6865 2070 6572 666f 726d 616e 6365 2061  he performance a
+00002a20: 7420 6561 6368 0a20 2020 2020 2020 2020  t each.         
+00002a30: 2020 2068 7970 6572 7061 7261 6d65 7465     hyperparamete
+00002a40: 7220 6f70 7469 6d69 7a61 7469 6f6e 2074  r optimization t
+00002a50: 7269 616c 2e20 466f 7220 6578 616d 706c  rial. For exampl
+00002a60: 652c 2069 6620 6376 3d33 2c20 7468 656e  e, if cv=3, then
+00002a70: 2065 6163 6820 6f70 7469 6d69 7a61 7469   each optimizati
+00002a80: 6f6e 2074 7269 616c 0a20 2020 2020 2020  on trial.       
+00002a90: 2020 2020 2077 696c 6c20 6265 2061 7373       will be ass
+00002aa0: 6573 7365 6420 6163 636f 7264 696e 6720  essed according 
+00002ab0: 746f 2074 6865 2033 2d66 6f6c 6420 6372  to the 3-fold cr
+00002ac0: 6f73 7320 7661 6c69 6461 7469 6f6e 2061  oss validation a
+00002ad0: 6363 7572 6163 792e 2044 6566 6175 6c74  ccuracy. Default
+00002ae0: 7320 746f 2031 302e 0a20 2020 2020 2020  s to 10..       
+00002af0: 2020 2020 204e 4f54 453a 2054 6865 2068       NOTE: The h
+00002b00: 6967 6865 7220 7468 6973 206e 756d 6265  igher this numbe
+00002b10: 722c 2074 6865 206c 6f6e 6765 7220 7468  r, the longer th
+00002b20: 6520 6f70 7469 6d69 7a61 7469 6f6e 2077  e optimization w
+00002b30: 696c 6c20 7461 6b65 2e0a 2020 2020 2020  ill take..      
+00002b40: 2020 6261 6c61 6e63 6520 2862 6f6f 6c2c    balance (bool,
+00002b50: 206f 7074 696f 6e61 6c29 3a20 5468 6973   optional): This
+00002b60: 2077 696c 6c20 6465 7465 726d 696e 6520   will determine 
+00002b70: 7768 6574 6865 7220 7468 6520 7477 6f20  whether the two 
+00002b80: 636c 6173 7365 730a 2020 2020 2020 2020  classes.        
+00002b90: 2020 2020 6172 6520 6b65 7074 2074 6865      are kept the
+00002ba0: 2073 616d 6520 7369 7a65 2064 7572 696e   same size durin
+00002bb0: 6720 6f70 7469 6d69 7a61 7469 6f6e 2c20  g optimization, 
+00002bc0: 6170 706c 6963 6162 6c65 2069 6620 7475  applicable if tu
+00002bd0: 6e69 6e67 2074 6865 2061 7567 6d65 6e74  ning the augment
+00002be0: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00002bf0: 2020 7061 7261 6d65 7465 7273 2e20 4465    parameters. De
+00002c00: 6661 756c 7473 2074 6f20 5472 7565 2e0a  faults to True..
+00002c10: 2020 2020 2020 2020 636c 6620 2873 7472          clf (str
+00002c20: 293a 2043 616e 2062 6520 2761 6c65 786e  ): Can be 'alexn
+00002c30: 6574 2720 6f72 2027 6375 7374 6f6d 5f63  et' or 'custom_c
+00002c40: 6e6e 2720 666f 7220 7468 6520 6375 7374  nn' for the cust
+00002c50: 6f6d 6c79 2063 6f6e 6669 6775 7265 642c  omly configured,
+00002c60: 2073 6861 6c6c 6f77 6572 206d 6f64 656c   shallower model
+00002c70: 2e20 4361 6e20 616c 736f 2062 6520 0a20  . Can also be . 
+00002c80: 2020 2020 2020 2020 2020 2027 7667 6731             'vgg1
+00002c90: 3627 206f 7220 2772 6573 6e65 7431 3827  6' or 'resnet18'
+00002ca0: 2e0a 2020 2020 2020 2020 6c69 6d69 745f  ..        limit_
+00002cb0: 7365 6172 6368 2028 626f 6f6c 293a 2057  search (bool): W
+00002cc0: 6865 7468 6572 2074 6f20 6578 7061 6e64  hether to expand
+00002cd0: 2074 6865 2068 7970 6572 7061 7261 6d65   the hyperparame
+00002ce0: 7465 7220 7365 6172 6368 2073 7061 6365  ter search space
+00002cf0: 2c20 6f6e 6c79 2069 6620 6170 706c 6963  , only if applic
+00002d00: 6162 6c65 2069 6620 636c 663d 2761 6c65  able if clf='ale
+00002d10: 786e 6574 272c 2066 6f72 2065 7861 6d70  xnet', for examp
+00002d20: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00002d30: 7468 6973 2077 696c 6c20 696e 636c 7564  this will includ
+00002d40: 6520 7468 6520 7475 6e69 6e67 206f 6620  e the tuning of 
+00002d50: 7468 6520 696e 6469 7669 6475 616c 206c  the individual l
+00002d60: 6179 6572 2070 6172 616d 6574 6572 7320  ayer parameters 
+00002d70: 7375 6368 2061 7320 7468 6520 6e75 6d62  such as the numb
+00002d80: 6572 206f 6620 6669 6c74 6572 2c20 7369  er of filter, si
+00002d90: 7a65 2026 2073 7472 6964 652e 0a20 2020  ze & stride..   
+00002da0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+00002db0: 7320 746f 2054 7275 6520 6475 6520 746f  s to True due to
+00002dc0: 206d 656d 6f72 7920 616c 6c6f 6361 7469   memory allocati
+00002dd0: 6f6e 2069 7373 7565 7320 7768 656e 2068  on issues when h
+00002de0: 616e 646c 696e 6720 6c6f 7473 206f 6620  andling lots of 
+00002df0: 7475 6e61 626c 6520 7061 7261 6d65 7465  tunable paramete
+00002e00: 7273 2e0a 2020 2020 2020 2020 6261 7463  rs..        batc
+00002e10: 685f 7369 7a65 5f6d 696e 2028 696e 7429  h_size_min (int)
+00002e20: 3a20 5468 6520 6d69 6e69 6d75 6d20 6261  : The minimum ba
+00002e30: 7463 6820 7369 7a65 2074 6f20 7573 6520  tch size to use 
+00002e40: 6475 7269 6e67 2074 7261 696e 696e 672e  during training.
+00002e50: 2053 686f 756c 6420 6265 206d 756c 7469   Should be multi
+00002e60: 706c 6573 206f 6620 3136 2066 6f72 206f  ples of 16 for o
+00002e70: 7074 696d 616c 2068 6172 6477 6172 6520  ptimal hardware 
+00002e80: 7573 653f 3f20 4465 6661 756c 7473 2074  use?? Defaults t
+00002e90: 6f20 3136 2e0a 2020 2020 2020 2020 6261  o 16..        ba
+00002ea0: 7463 685f 7369 7a65 5f6d 6178 2028 696e  tch_size_max (in
+00002eb0: 7429 3a20 5468 6520 4d61 7869 6d75 6d20  t): The Maximum 
+00002ec0: 6261 7463 6820 7369 7a65 2074 6f20 7573  batch size to us
+00002ed0: 6520 6475 7269 6e67 2074 7261 696e 696e  e during trainin
+00002ee0: 672e 2053 686f 756c 6420 6265 206d 756c  g. Should be mul
+00002ef0: 7469 706c 6573 206f 6620 3136 2066 6f72  tiples of 16 for
+00002f00: 206f 7074 696d 616c 2068 6172 6477 6172   optimal hardwar
+00002f10: 6520 7573 653f 3f20 4465 6661 756c 7473  e use?? Defaults
+00002f20: 2074 6f20 3634 2e0a 2020 2020 2020 2020   to 64..        
+00002f30: 6d6f 6e69 746f 7231 2028 7374 722c 206f  monitor1 (str, o
+00002f40: 7074 696f 6e61 6c29 3a20 5468 6520 6669  ptional): The fi
+00002f50: 7273 7420 6d65 7472 6963 2074 6f20 6d6f  rst metric to mo
+00002f60: 6e69 746f 722c 2063 616e 2074 616b 6520  nitor, can take 
+00002f70: 7468 6520 7361 6d65 2076 616c 7565 7320  the same values 
+00002f80: 6173 2074 6865 206d 6574 7269 6320 6172  as the metric ar
+00002f90: 6775 6d65 6e74 2e20 4465 6661 756c 7473  gument. Defaults
+00002fa0: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+00002fb0: 2020 6d6f 6e69 746f 7232 2028 7374 722c    monitor2 (str,
+00002fc0: 206f 7074 696f 6e61 6c29 3a20 5468 6520   optional): The 
+00002fd0: 7365 636f 6e64 206d 6574 7269 6320 746f  second metric to
+00002fe0: 206d 6f6e 6974 6f72 2c20 6361 6e20 7461   monitor, can ta
+00002ff0: 6b65 2074 6865 2073 616d 6520 7661 6c75  ke the same valu
+00003000: 6573 2061 7320 7468 6520 6d65 7472 6963  es as the metric
+00003010: 2061 7267 756d 656e 742e 2044 6566 6175   argument. Defau
+00003020: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
+00003030: 2020 2020 206d 6f6e 6974 6f72 315f 7468       monitor1_th
+00003040: 7265 7368 2028 666c 6f61 742c 206f 7074  resh (float, opt
+00003050: 696f 6e61 6c29 3a20 5468 6520 7468 7265  ional): The thre
+00003060: 7368 6f6c 6420 7661 6c75 6520 6f66 2074  shold value of t
+00003070: 6865 2066 6972 7374 206d 6f6e 6974 6f72  he first monitor
+00003080: 206d 6574 7269 632e 2049 6620 7468 6520   metric. If the 
+00003090: 6d65 7472 6963 2069 7320 6c6f 7373 2d72  metric is loss-r
+000030a0: 656c 6174 6564 0a20 2020 2020 2020 2020  elated.         
+000030b0: 2020 2074 6865 2074 7261 696e 696e 6720     the training 
+000030c0: 7769 6c6c 2073 746f 7020 6561 726c 7920  will stop early 
+000030d0: 6966 2074 6865 2076 616c 7565 2066 616c  if the value fal
+000030e0: 6c73 2062 656c 6f77 2074 6869 7320 7468  ls below this th
+000030f0: 7265 7368 6f6c 642e 2053 696d 696c 6172  reshold. Similar
+00003100: 6c79 2c20 6966 2074 6865 206d 6574 7269  ly, if the metri
+00003110: 6320 6973 2061 6363 7572 6163 792d 7265  c is accuracy-re
+00003120: 6c61 7465 642c 0a20 2020 2020 2020 2020  lated,.         
+00003130: 2020 2074 6865 6e20 7468 6520 7472 6169     then the trai
+00003140: 6e69 6e67 2077 696c 6c20 7374 6f70 2065  ning will stop e
+00003150: 6172 6c79 2069 6620 7468 6520 7661 6c75  arly if the valu
+00003160: 6520 6661 6c6c 7320 6162 6f76 6520 7468  e falls above th
+00003170: 6973 2074 6872 6573 686f 6c64 2e20 4465  is threshold. De
+00003180: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
+00003190: 2020 2020 2020 2020 6d6f 6e69 746f 7232          monitor2
+000031a0: 5f74 6872 6573 6820 2866 6c6f 6174 2c20  _thresh (float, 
+000031b0: 6f70 7469 6f6e 616c 293a 2054 6865 2074  optional): The t
+000031c0: 6872 6573 686f 6c64 2076 616c 7565 206f  hreshold value o
+000031d0: 6620 7468 6520 7365 636f 6e64 206d 6f6e  f the second mon
+000031e0: 6974 6f72 206d 6574 7269 632e 2049 6620  itor metric. If 
+000031f0: 7468 6520 6d65 7472 6963 2069 7320 6c6f  the metric is lo
+00003200: 7373 2d72 656c 6174 6564 0a20 2020 2020  ss-related.     
+00003210: 2020 2020 2020 2074 6865 2074 7261 696e         the train
+00003220: 696e 6720 7769 6c6c 2073 746f 7020 6561  ing will stop ea
+00003230: 726c 7920 6966 2074 6865 2076 616c 7565  rly if the value
+00003240: 2066 616c 6c73 2062 656c 6f77 2074 6869   falls below thi
+00003250: 7320 7468 7265 7368 6f6c 642e 2053 696d  s threshold. Sim
+00003260: 696c 6172 6c79 2c20 6966 2074 6865 206d  ilarly, if the m
+00003270: 6574 7269 6320 6973 2061 6363 7572 6163  etric is accurac
+00003280: 792d 7265 6c61 7465 642c 0a20 2020 2020  y-related,.     
+00003290: 2020 2020 2020 2074 6865 6e20 7468 6520         then the 
+000032a0: 7472 6169 6e69 6e67 2077 696c 6c20 7374  training will st
+000032b0: 6f70 2065 6172 6c79 2069 6620 7468 6520  op early if the 
+000032c0: 7661 6c75 6520 6661 6c6c 7320 6162 6f76  value falls abov
+000032d0: 6520 7468 6973 2074 6872 6573 686f 6c64  e this threshold
+000032e0: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
+000032f0: 6e65 2e0a 2020 2020 2020 2020 736d 6f74  ne..        smot
+00003300: 655f 7361 6d70 6c69 6e67 2028 666c 6f61  e_sampling (floa
+00003310: 7429 3a20 5468 6520 736d 6f74 655f 7361  t): The smote_sa
+00003320: 6d70 6c69 6e67 2070 6172 616d 6574 6572  mpling parameter
+00003330: 2069 7320 7573 6564 2069 6e20 7468 6520   is used in the 
+00003340: 534d 4f54 4520 616c 676f 7269 7468 6d20  SMOTE algorithm 
+00003350: 746f 2073 7065 6369 6679 2074 6865 2064  to specify the d
+00003360: 6573 6972 6564 200a 2020 2020 2020 2020  esired .        
+00003370: 2020 2020 7261 7469 6f20 6f66 2074 6865      ratio of the
+00003380: 206d 696e 6f72 6974 7920 636c 6173 7320   minority class 
+00003390: 746f 2074 6865 206d 616a 6f72 6974 7920  to the majority 
+000033a0: 636c 6173 732e 2044 6566 6175 6c74 7320  class. Defaults 
+000033b0: 746f 2030 2077 6869 6368 2064 6973 6162  to 0 which disab
+000033c0: 6c65 7320 7468 6520 7072 6f63 6564 7572  les the procedur
+000033d0: 652e 2046 6f72 206d 6f72 650a 2020 2020  e. For more.    
+000033e0: 2020 2020 2020 2020 696e 666f 726d 6174          informat
+000033f0: 696f 6e20 7265 6665 7220 746f 2074 6865  ion refer to the
+00003400: 2065 6e73 656d 626c 655f 6d6f 6465 6c20   ensemble_model 
+00003410: 6d6f 6475 6c65 2e0a 2020 2020 2020 2020  module..        
+00003420: 626c 656e 645f 6d61 7820 2866 6c6f 6174  blend_max (float
+00003430: 293a 2049 6620 7573 6564 2074 6869 7320  ): If used this 
+00003440: 7769 6c6c 2061 7070 6c79 2062 6c65 6e64  will apply blend
+00003450: 696e 6720 6175 676d 656e 7461 7469 6f6e  ing augmentation
+00003460: 200a 2020 2020 2020 2020 6e75 6d5f 696d   .        num_im
+00003470: 6167 6573 5f74 6f5f 626c 656e 6420 2869  ages_to_blend (i
+00003480: 6e74 293a 0a20 2020 2020 2020 207a 6f6f  nt):.        zoo
+00003490: 6d5f 7261 6e67 6520 2874 7570 6c65 293a  m_range (tuple):
+000034a0: 0a20 2020 2020 2020 2062 6174 6368 5f6f  .        batch_o
+000034b0: 7468 6572 2028 696e 7429 3a20 4361 6e20  ther (int): Can 
+000034c0: 6265 2073 6574 2074 6f20 7a65 726f 2e0a  be set to zero..
+000034d0: 2020 2020 2020 2020 626c 656e 6469 6e67          blending
+000034e0: 5f66 756e 6320 2873 7472 293a 0a20 2020  _func (str):.   
+000034f0: 2020 2020 2073 6b65 775f 616e 676c 6520       skew_angle 
+00003500: 2866 6c6f 6174 293a 0a20 2020 2020 2020  (float):.       
+00003510: 2073 6176 655f 6d6f 6465 6c73 2028 626f   save_models (bo
+00003520: 6f6c 293a 2057 6865 7468 6572 2074 6f20  ol): Whether to 
+00003530: 7361 7665 2074 6f20 6d6f 6465 6c73 2061  save to models a
+00003540: 6674 6572 2065 6163 6820 4f70 7475 6e61  fter each Optuna
+00003550: 2074 7269 616c 2e20 4e6f 7465 2074 6861   trial. Note tha
+00003560: 7420 7468 6973 2073 6176 6573 2061 6c6c  t this saves all
+00003570: 206d 6f64 656c 732c 206e 6f74 0a20 2020   models, not.   
+00003580: 2020 2020 2020 2020 206a 7573 7420 7468           just th
+00003590: 6520 6265 7374 206f 6e65 2e20 4465 6661  e best one. Defa
+000035a0: 756c 7473 2074 6f20 4661 6c73 652e 0a20  ults to False.. 
+000035b0: 2020 2020 2020 2073 6176 655f 7374 7564         save_stud
+000035c0: 6965 7320 2862 6f6f 6c29 3a20 5768 6568  ies (bool): Wheh
+000035d0: 7465 7220 746f 2073 6176 6520 7468 6520  ter to save the 
+000035e0: 7374 7564 7920 6f62 6a65 6374 2063 7265  study object cre
+000035f0: 6174 6564 2062 7920 4f70 7475 6e61 2e20  ated by Optuna. 
+00003600: 4966 2073 6574 2074 6f20 5472 7565 2c20  If set to True, 
+00003610: 7468 6973 2073 7475 6479 206f 626a 6563  this study objec
+00003620: 7420 7769 6c6c 2062 650a 2020 2020 2020  t will be.      
+00003630: 2020 2020 2020 7361 7665 6420 616e 6420        saved and 
+00003640: 6f76 6572 7772 6974 7465 6e20 6166 7465  overwritten afte
+00003650: 7220 6561 6368 2074 7269 616c 2e20 4465  r each trial. De
+00003660: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
+00003670: 0a20 2020 2020 2020 2070 6174 6820 2873  .        path (s
+00003680: 7472 293a 2041 6273 6f6c 7574 6520 7061  tr): Absolute pa
+00003690: 7468 2077 6865 7265 2074 6865 206d 6f64  th where the mod
+000036a0: 656c 7320 616e 6420 7374 7564 7920 6f62  els and study ob
+000036b0: 6a65 6374 2077 696c 6c20 6265 2073 6176  ject will be sav
+000036c0: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
+000036d0: 4e6f 6e65 2c20 7768 6963 6820 7361 7665  None, which save
+000036e0: 7320 7468 6520 6d6f 6465 6c73 2061 6e64  s the models and
+000036f0: 2073 7475 6479 0a20 2020 2020 2020 2020   study.         
+00003700: 2020 2069 6e20 7468 6520 686f 6d65 2064     in the home d
+00003710: 6972 6563 746f 7279 2e0a 0a20 2020 2052  irectory...    R
+00003720: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00003730: 5468 6520 7065 7266 6f72 6d61 6e63 6520  The performance 
+00003740: 6d65 7472 6963 2e0a 2020 2020 2222 220a  metric..    """.
+00003750: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00003760: 5f28 7365 6c66 2c20 706f 7369 7469 7665  _(self, positive
+00003770: 5f63 6c61 7373 2c20 6e65 6761 7469 7665  _class, negative
+00003780: 5f63 6c61 7373 2c20 7661 6c5f 706f 7369  _class, val_posi
+00003790: 7469 7665 3d4e 6f6e 652c 2076 616c 5f6e  tive=None, val_n
+000037a0: 6567 6174 6976 653d 4e6f 6e65 2c20 696d  egative=None, im
+000037b0: 675f 6e75 6d5f 6368 616e 6e65 6c73 3d31  g_num_channels=1
+000037c0: 2c20 636c 663d 2761 6c65 786e 6574 272c  , clf='alexnet',
+000037d0: 200a 2020 2020 2020 2020 6e6f 726d 616c   .        normal
+000037e0: 697a 653d 5472 7565 2c20 6d69 6e5f 7069  ize=True, min_pi
+000037f0: 7865 6c3d 302c 206d 6178 5f70 6978 656c  xel=0, max_pixel
+00003800: 3d31 3030 302c 2070 6174 6965 6e63 653d  =1000, patience=
+00003810: 352c 206d 6574 7269 633d 276c 6f73 7327  5, metric='loss'
+00003820: 2c20 6d65 7472 6963 323d 4e6f 6e65 2c20  , metric2=None, 
+00003830: 6176 6572 6167 653d 5472 7565 2c20 0a20  average=True, . 
+00003840: 2020 2020 2020 2074 6573 745f 706f 7369         test_posi
+00003850: 7469 7665 3d4e 6f6e 652c 2074 6573 745f  tive=None, test_
+00003860: 6e65 6761 7469 7665 3d4e 6f6e 652c 2070  negative=None, p
+00003870: 6f73 745f 6d65 7472 6963 3d54 7275 652c  ost_metric=True,
+00003880: 2074 6573 745f 6163 635f 7468 7265 7368   test_acc_thresh
+00003890: 6f6c 643d 4e6f 6e65 2c20 6261 7463 685f  old=None, batch_
+000038a0: 7369 7a65 5f6d 696e 3d31 362c 2062 6174  size_min=16, bat
+000038b0: 6368 5f73 697a 655f 6d61 783d 3634 2c20  ch_size_max=64, 
+000038c0: 0a20 2020 2020 2020 206f 7074 5f6d 6f64  .        opt_mod
+000038d0: 656c 3d54 7275 652c 2074 7261 696e 5f65  el=True, train_e
+000038e0: 706f 6368 733d 3235 2c20 6f70 745f 6376  pochs=25, opt_cv
+000038f0: 3d4e 6f6e 652c 206f 7074 5f61 7567 3d46  =None, opt_aug=F
+00003900: 616c 7365 2c20 6261 7463 685f 6d69 6e3d  alse, batch_min=
+00003910: 322c 2062 6174 6368 5f6d 6178 3d32 352c  2, batch_max=25,
+00003920: 2062 6174 6368 5f6f 7468 6572 3d31 2c20   batch_other=1, 
+00003930: 0a20 2020 2020 2020 2062 616c 616e 6365  .        balance
+00003940: 3d54 7275 652c 2069 6d61 6765 5f73 697a  =True, image_siz
+00003950: 655f 6d69 6e3d 3530 2c20 696d 6167 655f  e_min=50, image_
+00003960: 7369 7a65 5f6d 6178 3d31 3030 2c20 7368  size_max=100, sh
+00003970: 6966 743d 3130 2c20 6f70 745f 6d61 785f  ift=10, opt_max_
+00003980: 6d69 6e5f 7069 783d 4e6f 6e65 2c20 6f70  min_pix=None, op
+00003990: 745f 6d61 785f 6d61 785f 7069 783d 4e6f  t_max_max_pix=No
+000039a0: 6e65 2c20 0a20 2020 2020 2020 206d 6173  ne, .        mas
+000039b0: 6b5f 7369 7a65 3d4e 6f6e 652c 206e 756d  k_size=None, num
+000039c0: 5f6d 6173 6b73 3d4e 6f6e 652c 2073 6d6f  _masks=None, smo
+000039d0: 7465 5f73 616d 706c 696e 673d 302c 2062  te_sampling=0, b
+000039e0: 6c65 6e64 5f6d 6178 3d30 2c20 6e75 6d5f  lend_max=0, num_
+000039f0: 696d 6167 6573 5f74 6f5f 626c 656e 643d  images_to_blend=
+00003a00: 322c 2062 6c65 6e64 696e 675f 6675 6e63  2, blending_func
+00003a10: 3d27 6d65 616e 272c 2062 6c65 6e64 5f6f  ='mean', blend_o
+00003a20: 7468 6572 3d31 2c20 0a20 2020 2020 2020  ther=1, .       
+00003a30: 2073 6b65 775f 616e 676c 653d 302c 207a   skew_angle=0, z
+00003a40: 6f6f 6d5f 7261 6e67 653d 2830 2e39 2c31  oom_range=(0.9,1
+00003a50: 2e31 292c 206c 696d 6974 5f73 6561 7263  .1), limit_searc
+00003a60: 683d 5472 7565 2c20 6d6f 6e69 746f 7231  h=True, monitor1
+00003a70: 3d4e 6f6e 652c 206d 6f6e 6974 6f72 323d  =None, monitor2=
+00003a80: 4e6f 6e65 2c20 6d6f 6e69 746f 7231 5f74  None, monitor1_t
+00003a90: 6872 6573 683d 4e6f 6e65 2c20 6d6f 6e69  hresh=None, moni
+00003aa0: 746f 7232 5f74 6872 6573 683d 4e6f 6e65  tor2_thresh=None
+00003ab0: 2c20 7665 7262 6f73 653d 302c 0a20 2020  , verbose=0,.   
+00003ac0: 2020 2020 2073 6176 655f 6d6f 6465 6c73       save_models
+00003ad0: 3d46 616c 7365 2c20 7361 7665 5f73 7475  =False, save_stu
+00003ae0: 6469 6573 3d46 616c 7365 2c20 7061 7468  dies=False, path
+00003af0: 3d4e 6f6e 6529 3a0a 0a20 2020 2020 2020  =None):..       
+00003b00: 2073 656c 662e 706f 7369 7469 7665 5f63   self.positive_c
+00003b10: 6c61 7373 203d 2070 6f73 6974 6976 655f  lass = positive_
+00003b20: 636c 6173 730a 2020 2020 2020 2020 7365  class.        se
+00003b30: 6c66 2e6e 6567 6174 6976 655f 636c 6173  lf.negative_clas
+00003b40: 7320 3d20 6e65 6761 7469 7665 5f63 6c61  s = negative_cla
+00003b50: 7373 0a20 2020 2020 2020 2073 656c 662e  ss.        self.
+00003b60: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+00003b70: 203d 2069 6d67 5f6e 756d 5f63 6861 6e6e   = img_num_chann
+00003b80: 656c 730a 2020 2020 2020 2020 7365 6c66  els.        self
+00003b90: 2e6e 6f72 6d61 6c69 7a65 203d 206e 6f72  .normalize = nor
+00003ba0: 6d61 6c69 7a65 200a 2020 2020 2020 2020  malize .        
+00003bb0: 7365 6c66 2e6d 696e 5f70 6978 656c 203d  self.min_pixel =
+00003bc0: 206d 696e 5f70 6978 656c 0a20 2020 2020   min_pixel.     
+00003bd0: 2020 2073 656c 662e 6d61 785f 7069 7865     self.max_pixe
+00003be0: 6c20 3d20 6d61 785f 7069 7865 6c0a 2020  l = max_pixel.  
+00003bf0: 2020 2020 2020 7365 6c66 2e76 616c 5f70        self.val_p
+00003c00: 6f73 6974 6976 6520 3d20 7661 6c5f 706f  ositive = val_po
+00003c10: 7369 7469 7665 0a20 2020 2020 2020 2073  sitive.        s
+00003c20: 656c 662e 7661 6c5f 6e65 6761 7469 7665  elf.val_negative
+00003c30: 203d 2076 616c 5f6e 6567 6174 6976 650a   = val_negative.
+00003c40: 2020 2020 2020 2020 7365 6c66 2e74 6573          self.tes
+00003c50: 745f 706f 7369 7469 7665 203d 2074 6573  t_positive = tes
+00003c60: 745f 706f 7369 7469 7665 0a20 2020 2020  t_positive.     
+00003c70: 2020 2073 656c 662e 7465 7374 5f6e 6567     self.test_neg
+00003c80: 6174 6976 6520 3d20 7465 7374 5f6e 6567  ative = test_neg
+00003c90: 6174 6976 650a 2020 2020 2020 2020 7365  ative.        se
+00003ca0: 6c66 2e70 6f73 745f 6d65 7472 6963 203d  lf.post_metric =
+00003cb0: 2070 6f73 745f 6d65 7472 6963 0a20 2020   post_metric.   
+00003cc0: 2020 2020 2073 656c 662e 7465 7374 5f61       self.test_a
+00003cd0: 6363 5f74 6872 6573 686f 6c64 203d 2074  cc_threshold = t
+00003ce0: 6573 745f 6163 635f 7468 7265 7368 6f6c  est_acc_threshol
+00003cf0: 640a 0a20 2020 2020 2020 2073 656c 662e  d..        self.
+00003d00: 6261 7463 685f 7369 7a65 5f6d 696e 203d  batch_size_min =
+00003d10: 2062 6174 6368 5f73 697a 655f 6d69 6e0a   batch_size_min.
+00003d20: 2020 2020 2020 2020 7365 6c66 2e62 6174          self.bat
+00003d30: 6368 5f73 697a 655f 6d61 7820 3d20 6261  ch_size_max = ba
+00003d40: 7463 685f 7369 7a65 5f6d 6178 0a20 2020  tch_size_max.   
+00003d50: 2020 2020 2073 656c 662e 7472 6169 6e5f       self.train_
+00003d60: 6570 6f63 6873 203d 2074 7261 696e 5f65  epochs = train_e
+00003d70: 706f 6368 730a 2020 2020 2020 2020 7365  pochs.        se
+00003d80: 6c66 2e70 6174 6965 6e63 6520 3d20 7061  lf.patience = pa
+00003d90: 7469 656e 6365 200a 2020 2020 2020 2020  tience .        
+00003da0: 7365 6c66 2e6f 7074 5f6d 6f64 656c 203d  self.opt_model =
+00003db0: 206f 7074 5f6d 6f64 656c 2020 0a20 2020   opt_model  .   
+00003dc0: 2020 2020 2073 656c 662e 6f70 745f 6175       self.opt_au
+00003dd0: 6720 3d20 6f70 745f 6175 670a 2020 2020  g = opt_aug.    
+00003de0: 2020 2020 7365 6c66 2e62 6174 6368 5f6d      self.batch_m
+00003df0: 696e 203d 2062 6174 6368 5f6d 696e 200a  in = batch_min .
+00003e00: 2020 2020 2020 2020 7365 6c66 2e62 6174          self.bat
+00003e10: 6368 5f6d 6178 203d 2062 6174 6368 5f6d  ch_max = batch_m
+00003e20: 6178 200a 2020 2020 2020 2020 7365 6c66  ax .        self
+00003e30: 2e62 6174 6368 5f6f 7468 6572 203d 2062  .batch_other = b
+00003e40: 6174 6368 5f6f 7468 6572 0a20 2020 2020  atch_other.     
+00003e50: 2020 2073 656c 662e 696d 6167 655f 7369     self.image_si
+00003e60: 7a65 5f6d 696e 203d 2069 6d61 6765 5f73  ze_min = image_s
+00003e70: 697a 655f 6d69 6e0a 2020 2020 2020 2020  ize_min.        
+00003e80: 7365 6c66 2e69 6d61 6765 5f73 697a 655f  self.image_size_
+00003e90: 6d61 7820 3d20 696d 6167 655f 7369 7a65  max = image_size
+00003ea0: 5f6d 6178 0a20 2020 2020 2020 2073 656c  _max.        sel
+00003eb0: 662e 6261 6c61 6e63 6520 3d20 6261 6c61  f.balance = bala
+00003ec0: 6e63 650a 2020 2020 2020 2020 7365 6c66  nce.        self
+00003ed0: 2e6f 7074 5f6d 6178 5f6d 696e 5f70 6978  .opt_max_min_pix
+00003ee0: 203d 206f 7074 5f6d 6178 5f6d 696e 5f70   = opt_max_min_p
+00003ef0: 6978 0a20 2020 2020 2020 2073 656c 662e  ix.        self.
+00003f00: 6f70 745f 6d61 785f 6d61 785f 7069 7820  opt_max_max_pix 
+00003f10: 3d20 6f70 745f 6d61 785f 6d61 785f 7069  = opt_max_max_pi
+00003f20: 780a 2020 2020 2020 2020 7365 6c66 2e6d  x.        self.m
+00003f30: 6574 7269 6320 3d20 6d65 7472 6963 200a  etric = metric .
+00003f40: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00003f50: 7269 6332 203d 206d 6574 7269 6332 0a20  ric2 = metric2. 
+00003f60: 2020 2020 2020 2073 656c 662e 6176 6572         self.aver
+00003f70: 6167 6520 3d20 6176 6572 6167 650a 2020  age = average.  
+00003f80: 2020 2020 2020 7365 6c66 2e73 6869 6674        self.shift
+00003f90: 203d 2073 6869 6674 200a 2020 2020 2020   = shift .      
+00003fa0: 2020 7365 6c66 2e6f 7074 5f63 7620 3d20    self.opt_cv = 
+00003fb0: 6f70 745f 6376 0a20 2020 2020 2020 2073  opt_cv.        s
+00003fc0: 656c 662e 7665 7262 6f73 6520 3d20 7665  elf.verbose = ve
+00003fd0: 7262 6f73 650a 2020 2020 2020 2020 7365  rbose.        se
+00003fe0: 6c66 2e6d 6173 6b5f 7369 7a65 203d 206d  lf.mask_size = m
+00003ff0: 6173 6b5f 7369 7a65 0a20 2020 2020 2020  ask_size.       
+00004000: 2073 656c 662e 6e75 6d5f 6d61 736b 7320   self.num_masks 
+00004010: 3d20 6e75 6d5f 6d61 736b 730a 2020 2020  = num_masks.    
+00004020: 2020 2020 7365 6c66 2e6c 696d 6974 5f73      self.limit_s
+00004030: 6561 7263 6820 3d20 6c69 6d69 745f 7365  earch = limit_se
+00004040: 6172 6368 0a20 2020 2020 2020 2073 656c  arch.        sel
+00004050: 662e 636c 6620 3d20 636c 660a 0a20 2020  f.clf = clf..   
+00004060: 2020 2020 2073 656c 662e 6d6f 6e69 746f       self.monito
+00004070: 7231 203d 206d 6f6e 6974 6f72 310a 2020  r1 = monitor1.  
+00004080: 2020 2020 2020 7365 6c66 2e6d 6f6e 6974        self.monit
+00004090: 6f72 3220 3d20 6d6f 6e69 746f 7232 0a20  or2 = monitor2. 
+000040a0: 2020 2020 2020 2073 656c 662e 6d6f 6e69         self.moni
+000040b0: 746f 7231 5f74 6872 6573 6820 3d20 6d6f  tor1_thresh = mo
+000040c0: 6e69 746f 7231 5f74 6872 6573 680a 2020  nitor1_thresh.  
+000040d0: 2020 2020 2020 7365 6c66 2e6d 6f6e 6974        self.monit
+000040e0: 6f72 325f 7468 7265 7368 203d 206d 6f6e  or2_thresh = mon
+000040f0: 6974 6f72 325f 7468 7265 7368 0a20 2020  itor2_thresh.   
+00004100: 2020 2020 2073 656c 662e 736d 6f74 655f       self.smote_
+00004110: 7361 6d70 6c69 6e67 203d 2073 6d6f 7465  sampling = smote
+00004120: 5f73 616d 706c 696e 670a 2020 2020 2020  _sampling.      
+00004130: 2020 7365 6c66 2e62 6c65 6e64 5f6d 6178    self.blend_max
+00004140: 203d 2062 6c65 6e64 5f6d 6178 0a20 2020   = blend_max.   
+00004150: 2020 2020 2073 656c 662e 6e75 6d5f 696d       self.num_im
+00004160: 6167 6573 5f74 6f5f 626c 656e 6420 3d20  ages_to_blend = 
+00004170: 6e75 6d5f 696d 6167 6573 5f74 6f5f 626c  num_images_to_bl
+00004180: 656e 640a 2020 2020 2020 2020 7365 6c66  end.        self
+00004190: 2e62 6c65 6e64 696e 675f 6675 6e63 203d  .blending_func =
+000041a0: 2062 6c65 6e64 696e 675f 6675 6e63 0a20   blending_func. 
+000041b0: 2020 2020 2020 2073 656c 662e 626c 656e         self.blen
+000041c0: 645f 6f74 6865 7220 3d20 626c 656e 645f  d_other = blend_
+000041d0: 6f74 6865 720a 2020 2020 2020 2020 7365  other.        se
+000041e0: 6c66 2e7a 6f6f 6d5f 7261 6e67 6520 3d20  lf.zoom_range = 
+000041f0: 7a6f 6f6d 5f72 616e 6765 0a20 2020 2020  zoom_range.     
+00004200: 2020 2073 656c 662e 736b 6577 5f61 6e67     self.skew_ang
+00004210: 6c65 203d 2073 6b65 775f 616e 676c 650a  le = skew_angle.
+00004220: 0a20 2020 2020 2020 2073 656c 662e 7361  .        self.sa
+00004230: 7665 5f6d 6f64 656c 7320 3d20 7361 7665  ve_models = save
+00004240: 5f6d 6f64 656c 730a 2020 2020 2020 2020  _models.        
+00004250: 7365 6c66 2e73 6176 655f 7374 7564 6965  self.save_studie
+00004260: 7320 3d20 7361 7665 5f73 7475 6469 6573  s = save_studies
+00004270: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00004280: 7468 203d 2070 6174 6820 0a20 2020 2020  th = path .     
+00004290: 2020 2073 656c 662e 7061 7468 203d 2073     self.path = s
+000042a0: 7472 2850 6174 682e 686f 6d65 2829 2920  tr(Path.home()) 
+000042b0: 6966 2073 656c 662e 7061 7468 2069 7320  if self.path is 
+000042c0: 4e6f 6e65 2065 6c73 6520 7365 6c66 2e70  None else self.p
+000042d0: 6174 680a 2020 2020 2020 2020 7365 6c66  ath.        self
+000042e0: 2e70 6174 6820 2b3d 2027 2f27 2069 6620  .path += '/' if 
+000042f0: 7365 6c66 2e70 6174 685b 2d31 5d20 213d  self.path[-1] !=
+00004300: 2027 2f27 2065 6c73 6520 2727 0a0a 2020   '/' else ''..  
+00004310: 2020 2020 2020 6966 2027 616c 6c27 206e        if 'all' n
+00004320: 6f74 2069 6e20 7365 6c66 2e6d 6574 7269  ot in self.metri
+00004330: 6320 616e 6420 276c 6f73 7327 206e 6f74  c and 'loss' not
+00004340: 2069 6e20 7365 6c66 2e6d 6574 7269 6320   in self.metric 
+00004350: 616e 6420 2766 315f 7363 6f72 6527 206e  and 'f1_score' n
+00004360: 6f74 2069 6e20 7365 6c66 2e6d 6574 7269  ot in self.metri
+00004370: 6320 616e 6420 2762 696e 6172 795f 6163  c and 'binary_ac
+00004380: 6375 7261 6379 2720 6e6f 7420 696e 2073  curacy' not in s
+00004390: 656c 662e 6d65 7472 6963 3a0a 2020 2020  elf.metric:.    
+000043a0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000043b0: 6c75 6545 7272 6f72 2822 496e 7661 6c69  lueError("Invali
+000043c0: 6420 6d65 7472 6963 2069 6e70 7574 2c20  d metric input, 
+000043d0: 6f70 7469 6f6e 7320 6172 653a 2027 6c6f  options are: 'lo
+000043e0: 7373 272c 2027 6269 6e61 7279 5f61 6363  ss', 'binary_acc
+000043f0: 7572 6163 7927 2c20 2766 315f 7363 6f72  uracy', 'f1_scor
+00004400: 6527 2c20 6f72 2027 616c 6c27 2c20 616e  e', or 'all', an
+00004410: 6420 7468 6520 7661 6c69 6461 7469 6f6e  d the validation
+00004420: 2065 7175 6976 616c 656e 7473 2028 6164   equivalents (ad
+00004430: 6420 7661 6c5f 2061 7420 7468 6520 6265  d val_ at the be
+00004440: 6769 6e6e 696e 6729 2e22 290a 2020 2020  ginning).").    
+00004450: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+00004460: 7365 6c66 2e6d 6574 7269 6320 3d3d 2027  self.metric == '
+00004470: 7661 6c5f 6c6f 7373 2720 6f72 2073 656c  val_loss' or sel
+00004480: 662e 6d65 7472 6963 203d 3d20 2776 616c  f.metric == 'val
+00004490: 5f62 696e 6172 795f 6163 6375 7261 6379  _binary_accuracy
+000044a0: 273a 0a20 2020 2020 2020 2020 2020 2069  ':.            i
+000044b0: 6620 7365 6c66 2e76 616c 5f70 6f73 6974  f self.val_posit
+000044c0: 6976 6520 6973 204e 6f6e 6520 616e 6420  ive is None and 
+000044d0: 7365 6c66 2e76 616c 5f6e 6567 6174 6976  self.val_negativ
+000044e0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+000044f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00004500: 2056 616c 7565 4572 726f 7228 274e 6f20   ValueError('No 
+00004510: 7661 6c69 6461 7469 6f6e 2064 6174 6120  validation data 
+00004520: 696e 7075 742c 2063 6861 6e67 6520 7468  input, change th
+00004530: 6520 6d65 7472 6963 2074 6f20 6569 7468  e metric to eith
+00004540: 6572 2022 6c6f 7373 222c 2022 6269 6e61  er "loss", "bina
+00004550: 7279 5f61 6363 7572 6163 7922 2c20 2266  ry_accuracy", "f
+00004560: 315f 7363 6f72 6522 2c20 6f72 2022 616c  1_score", or "al
+00004570: 6c22 2e27 290a 0a20 2020 2020 2020 2069  l".')..        i
+00004580: 6620 7365 6c66 2e6f 7074 5f6d 6178 5f6d  f self.opt_max_m
+00004590: 696e 5f70 6978 2069 7320 6e6f 7420 4e6f  in_pix is not No
+000045a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000045b0: 6966 2073 656c 662e 6f70 745f 6d61 785f  if self.opt_max_
+000045c0: 6d61 785f 7069 7820 6973 204e 6f6e 653a  max_pix is None:
+000045d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000045e0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000045f0: 7228 2754 6f20 6f70 7469 6d69 7a65 206d  r('To optimize m
+00004600: 696e 2f6d 6178 206e 6f72 6d61 6c69 7a61  in/max normaliza
+00004610: 7469 6f6e 2070 6978 656c 2076 616c 7565  tion pixel value
+00004620: 2c20 626f 7468 206f 7074 5f6d 696e 5f70  , both opt_min_p
+00004630: 6978 2061 6e64 206f 7074 5f6d 6178 5f70  ix and opt_max_p
+00004640: 6978 206d 7573 7420 6265 2069 6e70 7574  ix must be input
+00004650: 2729 0a0a 2020 2020 2020 2020 6966 2073  ')..        if s
+00004660: 656c 662e 6f70 745f 6d61 785f 6d61 785f  elf.opt_max_max_
+00004670: 7069 7820 6973 206e 6f74 204e 6f6e 653a  pix is not None:
+00004680: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004690: 7365 6c66 2e6f 7074 5f6d 6178 5f6d 696e  self.opt_max_min
+000046a0: 5f70 6978 2069 7320 4e6f 6e65 3a0a 2020  _pix is None:.  
+000046b0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000046c0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+000046d0: 546f 206f 7074 696d 697a 6520 6d69 6e2f  To optimize min/
+000046e0: 6d61 7820 6e6f 726d 616c 697a 6174 696f  max normalizatio
+000046f0: 6e20 7069 7865 6c20 7661 6c75 652c 2062  n pixel value, b
+00004700: 6f74 6820 6f70 745f 6d69 6e5f 7069 7820  oth opt_min_pix 
+00004710: 616e 6420 6f70 745f 6d61 785f 7069 7820  and opt_max_pix 
+00004720: 6d75 7374 2062 6520 696e 7075 7427 290a  must be input').
+00004730: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00004740: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+00004750: 6d61 736b 5f73 697a 652c 2069 6e74 2920  mask_size, int) 
+00004760: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
+00004770: 6365 2873 656c 662e 6d61 736b 5f73 697a  ce(self.mask_siz
+00004780: 652c 2074 7570 6c65 293a 0a20 2020 2020  e, tuple):.     
+00004790: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+000047a0: 7565 4572 726f 7228 2754 6865 206d 6173  ueError('The mas
+000047b0: 6b5f 7369 7a65 2070 6172 616d 6574 6572  k_size parameter
+000047c0: 206d 7573 7420 6569 7468 6572 2062 6520   must either be 
+000047d0: 616e 2069 6e74 6567 6572 206f 7220 6120  an integer or a 
+000047e0: 7475 706c 6521 2729 0a0a 2020 2020 2020  tuple!')..      
+000047f0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00004800: 6e63 6528 7365 6c66 2e6e 756d 5f6d 6173  nce(self.num_mas
+00004810: 6b73 2c20 696e 7429 2061 6e64 206e 6f74  ks, int) and not
+00004820: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00004830: 2e6e 756d 5f6d 6173 6b73 2c20 7475 706c  .num_masks, tupl
+00004840: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00004850: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00004860: 2827 5468 6520 6e75 6d5f 6d61 736b 7320  ('The num_masks 
+00004870: 7061 7261 6d65 7465 7220 6d75 7374 2065  parameter must e
+00004880: 6974 6865 7220 6265 2061 6e20 696e 7465  ither be an inte
+00004890: 6765 7220 6f72 2061 2074 7570 6c65 2127  ger or a tuple!'
+000048a0: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+000048b0: 6c66 2e62 616c 616e 6365 2061 6e64 2073  lf.balance and s
+000048c0: 656c 662e 736d 6f74 655f 7361 6d70 6c69  elf.smote_sampli
+000048d0: 6e67 203e 2030 3a0a 2020 2020 2020 2020  ng > 0:.        
+000048e0: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
+000048f0: 4e47 3a20 6261 6c61 6e63 653d 5472 7565  NG: balance=True
+00004900: 2062 7574 2053 4d4f 5445 2073 616d 706c   but SMOTE sampl
+00004910: 696e 6720 7769 6c6c 206e 6f74 2062 6520  ing will not be 
+00004920: 6170 706c 6965 6420 6966 2074 6865 2063  applied if the c
+00004930: 6c61 7373 6573 2061 7265 2062 616c 616e  lasses are balan
+00004940: 6365 642e 2729 0a0a 2020 2020 2020 2020  ced.')..        
+00004950: 6966 2073 656c 662e 7465 7374 5f61 6363  if self.test_acc
+00004960: 5f74 6872 6573 686f 6c64 2069 7320 6e6f  _threshold is no
+00004970: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00004980: 2020 2020 6966 2073 656c 662e 7465 7374      if self.test
+00004990: 5f61 6363 5f74 6872 6573 686f 6c64 203c  _acc_threshold <
+000049a0: 3d20 3020 6f72 2073 656c 662e 7465 7374  = 0 or self.test
+000049b0: 5f61 6363 5f74 6872 6573 686f 6c64 203e  _acc_threshold >
+000049c0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+000049d0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000049e0: 7272 6f72 2827 5468 6520 7465 7374 5f61  rror('The test_a
+000049f0: 6363 5f74 6872 6573 686f 6c64 2070 6172  cc_threshold par
+00004a00: 616d 6574 6572 206d 7573 7420 6265 2067  ameter must be g
+00004a10: 7265 6174 6572 2074 6861 6e20 3020 616e  reater than 0 an
+00004a20: 6420 6c65 7373 2074 6861 6e20 6f72 2065  d less than or e
+00004a30: 7175 616c 2074 6f20 3121 2729 0a20 2020  qual to 1!').   
+00004a40: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00004a50: 2e74 6573 745f 706f 7369 7469 7665 2069  .test_positive i
+00004a60: 7320 4e6f 6e65 2061 6e64 2073 656c 662e  s None and self.
+00004a70: 7465 7374 5f6e 6567 6174 6976 6520 6973  test_negative is
+00004a80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00004a90: 2020 2020 2020 2070 7269 6e74 2827 5741         print('WA
+00004aa0: 524e 494e 473a 2054 6865 2074 6573 745f  RNING: The test_
+00004ab0: 6163 635f 7468 7265 7368 6f6c 6420 6861  acc_threshold ha
+00004ac0: 7320 6265 656e 2063 6f6e 6669 6775 7265  s been configure
+00004ad0: 6420 6275 7420 6e6f 2074 6573 7420 6461  d but no test da
+00004ae0: 7461 2068 6173 2062 6565 6e20 696e 7075  ta has been inpu
+00004af0: 7421 2053 6574 7469 6e67 2074 6573 745f  t! Setting test_
+00004b00: 6163 635f 7468 7265 7368 6f6c 643d 4e6f  acc_threshold=No
+00004b10: 6e65 2e2e 2e27 290a 2020 2020 2020 2020  ne...').        
+00004b20: 2020 2020 2020 2020 7365 6c66 2e74 6573          self.tes
+00004b30: 745f 6163 635f 7468 7265 7368 6f6c 6420  t_acc_threshold 
+00004b40: 3d20 4e6f 6e65 200a 0a20 2020 2064 6566  = None ..    def
+00004b50: 205f 5f63 616c 6c5f 5f28 7365 6c66 2c20   __call__(self, 
+00004b60: 7472 6961 6c29 3a0a 0a20 2020 2020 2020  trial):..       
+00004b70: 2069 6620 7365 6c66 2e6f 7074 5f61 7567   if self.opt_aug
+00004b80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00004b90: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+00004ba0: 616e 6e65 6c73 203d 3d20 313a 0a20 2020  annels == 1:.   
+00004bb0: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+00004bc0: 6e6e 656c 312c 2063 6861 6e6e 656c 322c  nnel1, channel2,
+00004bd0: 2063 6861 6e6e 656c 3320 3d20 636f 7079   channel3 = copy
+00004be0: 2e64 6565 7063 6f70 7928 7365 6c66 2e70  .deepcopy(self.p
+00004bf0: 6f73 6974 6976 655f 636c 6173 7329 2c20  ositive_class), 
+00004c00: 4e6f 6e65 2c20 4e6f 6e65 200a 2020 2020  None, None .    
+00004c10: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00004c20: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+00004c30: 6c73 203d 3d20 323a 0a20 2020 2020 2020  ls == 2:.       
+00004c40: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
+00004c50: 312c 2063 6861 6e6e 656c 322c 2063 6861  1, channel2, cha
+00004c60: 6e6e 656c 3320 3d20 636f 7079 2e64 6565  nnel3 = copy.dee
+00004c70: 7063 6f70 7928 7365 6c66 2e70 6f73 6974  pcopy(self.posit
+00004c80: 6976 655f 636c 6173 735b 3a2c 3a2c 3a2c  ive_class[:,:,:,
+00004c90: 305d 292c 2063 6f70 792e 6465 6570 636f  0]), copy.deepco
+00004ca0: 7079 2873 656c 662e 706f 7369 7469 7665  py(self.positive
+00004cb0: 5f63 6c61 7373 5b3a 2c3a 2c3a 2c31 5d29  _class[:,:,:,1])
+00004cc0: 2c20 4e6f 6e65 200a 2020 2020 2020 2020  , None .        
+00004cd0: 2020 2020 656c 6966 2073 656c 662e 696d      elif self.im
+00004ce0: 675f 6e75 6d5f 6368 616e 6e65 6c73 203d  g_num_channels =
+00004cf0: 3d20 333a 0a20 2020 2020 2020 2020 2020  = 3:.           
+00004d00: 2020 2020 2063 6861 6e6e 656c 312c 2063       channel1, c
+00004d10: 6861 6e6e 656c 322c 2063 6861 6e6e 656c  hannel2, channel
+00004d20: 3320 3d20 636f 7079 2e64 6565 7063 6f70  3 = copy.deepcop
+00004d30: 7928 7365 6c66 2e70 6f73 6974 6976 655f  y(self.positive_
+00004d40: 636c 6173 735b 3a2c 3a2c 3a2c 305d 292c  class[:,:,:,0]),
+00004d50: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
+00004d60: 656c 662e 706f 7369 7469 7665 5f63 6c61  elf.positive_cla
+00004d70: 7373 5b3a 2c3a 2c3a 2c31 5d29 2c20 636f  ss[:,:,:,1]), co
+00004d80: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
+00004d90: 2e70 6f73 6974 6976 655f 636c 6173 735b  .positive_class[
+00004da0: 3a2c 3a2c 3a2c 325d 290a 2020 2020 2020  :,:,:,2]).      
+00004db0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00004dc0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00004dd0: 6520 5661 6c75 6545 7272 6f72 2827 4f6e  e ValueError('On
+00004de0: 6c79 2074 6872 6565 2066 696c 7465 7273  ly three filters
+00004df0: 2061 7265 2073 7570 706f 7274 6564 2127   are supported!'
+00004e00: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00004e10: 6c66 2e6f 7074 5f61 7567 3a0a 2020 2020  lf.opt_aug:.    
+00004e20: 2020 2020 2020 2020 726f 7461 7469 6f6e          rotation
+00004e30: 203d 2068 6f72 697a 6f6e 7461 6c20 3d20   = horizontal = 
+00004e40: 7665 7274 6963 616c 203d 2054 7275 6520  vertical = True 
+00004e50: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+00004e60: 5f61 7567 203d 2074 7269 616c 2e73 7567  _aug = trial.sug
+00004e70: 6765 7374 5f69 6e74 2827 6e75 6d5f 6175  gest_int('num_au
+00004e80: 6727 2c20 7365 6c66 2e62 6174 6368 5f6d  g', self.batch_m
+00004e90: 696e 2c20 7365 6c66 2e62 6174 6368 5f6d  in, self.batch_m
+00004ea0: 6178 2c20 7374 6570 3d31 290a 2020 2020  ax, step=1).    
+00004eb0: 2020 2020 2020 2020 626c 656e 645f 6d75          blend_mu
+00004ec0: 6c74 6970 6c69 6572 203d 2074 7269 616c  ltiplier = trial
+00004ed0: 2e73 7567 6765 7374 5f66 6c6f 6174 2827  .suggest_float('
+00004ee0: 626c 656e 645f 6d75 6c74 6970 6c69 6572  blend_multiplier
+00004ef0: 272c 2031 2e30 2c20 7365 6c66 2e62 6c65  ', 1.0, self.ble
+00004f00: 6e64 5f6d 6178 2c20 7374 6570 3d30 2e30  nd_max, step=0.0
+00004f10: 3529 2069 6620 7365 6c66 2e62 6c65 6e64  5) if self.blend
+00004f20: 5f6d 6178 203e 3d20 312e 3120 656c 7365  _max >= 1.1 else
+00004f30: 2030 0a20 2020 2020 2020 2020 2020 2073   0.            s
+00004f40: 6b65 775f 616e 676c 6520 3d20 7472 6961  kew_angle = tria
+00004f50: 6c2e 7375 6767 6573 745f 696e 7428 2773  l.suggest_int('s
+00004f60: 6b65 775f 616e 676c 6527 2c20 302c 2073  kew_angle', 0, s
+00004f70: 656c 662e 736b 6577 5f61 6e67 6c65 2c20  elf.skew_angle, 
+00004f80: 7374 6570 3d31 2920 6966 2073 656c 662e  step=1) if self.
+00004f90: 736b 6577 5f61 6e67 6c65 203e 2030 2065  skew_angle > 0 e
+00004fa0: 6c73 6520 300a 2020 2020 2020 2020 2020  lse 0.          
+00004fb0: 2020 696d 6167 655f 7369 7a65 203d 2074    image_size = t
+00004fc0: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+00004fd0: 2827 696d 6167 655f 7369 7a65 272c 2073  ('image_size', s
+00004fe0: 656c 662e 696d 6167 655f 7369 7a65 5f6d  elf.image_size_m
+00004ff0: 696e 2c20 7365 6c66 2e69 6d61 6765 5f73  in, self.image_s
+00005000: 697a 655f 6d61 782c 2073 7465 703d 3129  ize_max, step=1)
+00005010: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+00005020: 6b5f 7369 7a65 203d 2074 7269 616c 2e73  k_size = trial.s
+00005030: 7567 6765 7374 5f69 6e74 2827 6d61 736b  uggest_int('mask
+00005040: 5f73 697a 6527 2c20 7365 6c66 2e6d 6173  _size', self.mas
+00005050: 6b5f 7369 7a65 5b30 5d2c 2073 656c 662e  k_size[0], self.
+00005060: 6d61 736b 5f73 697a 655b 315d 2c20 7374  mask_size[1], st
+00005070: 6570 3d31 2920 6966 2069 7369 6e73 7461  ep=1) if isinsta
+00005080: 6e63 6528 7365 6c66 2e6d 6173 6b5f 7369  nce(self.mask_si
+00005090: 7a65 2c20 7475 706c 6529 2065 6c73 6520  ze, tuple) else 
+000050a0: 7365 6c66 2e6d 6173 6b5f 7369 7a65 0a20  self.mask_size. 
+000050b0: 2020 2020 2020 2020 2020 206e 756d 5f6d             num_m
+000050c0: 6173 6b73 203d 2074 7269 616c 2e73 7567  asks = trial.sug
+000050d0: 6765 7374 5f69 6e74 2827 6e75 6d5f 6d61  gest_int('num_ma
+000050e0: 736b 7327 2c20 7365 6c66 2e6e 756d 5f6d  sks', self.num_m
+000050f0: 6173 6b73 5b30 5d2c 2073 656c 662e 6e75  asks[0], self.nu
+00005100: 6d5f 6d61 736b 735b 315d 2c20 7374 6570  m_masks[1], step
+00005110: 3d31 2920 6966 2069 7369 6e73 7461 6e63  =1) if isinstanc
+00005120: 6528 7365 6c66 2e6e 756d 5f6d 6173 6b73  e(self.num_masks
+00005130: 2c20 7475 706c 6529 2065 6c73 6520 7365  , tuple) else se
+00005140: 6c66 2e6e 756d 5f6d 6173 6b73 0a0a 2020  lf.num_masks..  
+00005150: 2020 2020 2020 2020 2020 6175 676d 656e            augmen
+00005160: 7465 645f 696d 6167 6573 203d 2061 7567  ted_images = aug
+00005170: 6d65 6e74 6174 696f 6e28 6368 616e 6e65  mentation(channe
+00005180: 6c31 3d63 6861 6e6e 656c 312c 2063 6861  l1=channel1, cha
+00005190: 6e6e 656c 323d 6368 616e 6e65 6c32 2c20  nnel2=channel2, 
+000051a0: 6368 616e 6e65 6c33 3d63 6861 6e6e 656c  channel3=channel
+000051b0: 332c 2062 6174 6368 3d6e 756d 5f61 7567  3, batch=num_aug
+000051c0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+000051d0: 2020 2077 6964 7468 5f73 6869 6674 3d73     width_shift=s
+000051e0: 656c 662e 7368 6966 742c 2068 6569 6768  elf.shift, heigh
+000051f0: 745f 7368 6966 743d 7365 6c66 2e73 6869  t_shift=self.shi
+00005200: 6674 2c20 686f 7269 7a6f 6e74 616c 3d68  ft, horizontal=h
+00005210: 6f72 697a 6f6e 7461 6c2c 2076 6572 7469  orizontal, verti
+00005220: 6361 6c3d 7665 7274 6963 616c 2c20 726f  cal=vertical, ro
+00005230: 7461 7469 6f6e 3d72 6f74 6174 696f 6e2c  tation=rotation,
+00005240: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00005250: 2020 696d 6167 655f 7369 7a65 3d69 6d61    image_size=ima
+00005260: 6765 5f73 697a 652c 206d 6173 6b5f 7369  ge_size, mask_si
+00005270: 7a65 3d6d 6173 6b5f 7369 7a65 2c20 6e75  ze=mask_size, nu
+00005280: 6d5f 6d61 736b 733d 6e75 6d5f 6d61 736b  m_masks=num_mask
+00005290: 732c 2062 6c65 6e64 5f6d 756c 7469 706c  s, blend_multipl
+000052a0: 6965 723d 626c 656e 645f 6d75 6c74 6970  ier=blend_multip
+000052b0: 6c69 6572 2c20 0a20 2020 2020 2020 2020  lier, .         
+000052c0: 2020 2020 2020 2062 6c65 6e64 696e 675f         blending_
+000052d0: 6675 6e63 3d73 656c 662e 626c 656e 6469  func=self.blendi
+000052e0: 6e67 5f66 756e 632c 206e 756d 5f69 6d61  ng_func, num_ima
+000052f0: 6765 735f 746f 5f62 6c65 6e64 3d73 656c  ges_to_blend=sel
+00005300: 662e 6e75 6d5f 696d 6167 6573 5f74 6f5f  f.num_images_to_
+00005310: 626c 656e 642c 207a 6f6f 6d5f 7261 6e67  blend, zoom_rang
+00005320: 653d 7365 6c66 2e7a 6f6f 6d5f 7261 6e67  e=self.zoom_rang
+00005330: 652c 2073 6b65 775f 616e 676c 653d 736b  e, skew_angle=sk
+00005340: 6577 5f61 6e67 6c65 290a 0a20 2020 2020  ew_angle)..     
+00005350: 2020 2020 2020 2023 436f 6e63 6174 2063         #Concat c
+00005360: 6861 6e6e 656c 7320 7369 6e63 6520 6175  hannels since au
+00005370: 676d 656e 7461 7469 6f6e 2066 756e 6374  gmentation funct
+00005380: 696f 6e20 7265 7475 726e 7320 616e 206f  ion returns an o
+00005390: 7574 7075 7420 666f 7220 6561 6368 2066  utput for each f
+000053a0: 696c 7465 722c 2065 2e67 2e20 3320 6f75  ilter, e.g. 3 ou
+000053b0: 7470 7574 7320 666f 7220 5247 420a 2020  tputs for RGB.  
+000053c0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000053d0: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+000053e0: 6c73 203e 2031 3a0a 2020 2020 2020 2020  ls > 1:.        
+000053f0: 2020 2020 2020 2020 636c 6173 735f 313d          class_1=
+00005400: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+00005410: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
+00005420: 756d 5f63 6861 6e6e 656c 7320 3d3d 2032  um_channels == 2
+00005430: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005440: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00005450: 616e 6765 286c 656e 2861 7567 6d65 6e74  ange(len(augment
+00005460: 6564 5f69 6d61 6765 735b 305d 2929 3a0a  ed_images[0])):.
+00005470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005480: 2020 2020 2020 2020 636c 6173 735f 312e          class_1.
+00005490: 6170 7065 6e64 2864 6174 615f 7072 6f63  append(data_proc
+000054a0: 6573 7369 6e67 2e63 6f6e 6361 745f 6368  essing.concat_ch
+000054b0: 616e 6e65 6c73 2861 7567 6d65 6e74 6564  annels(augmented
+000054c0: 5f69 6d61 6765 735b 305d 5b69 5d2c 2061  _images[0][i], a
+000054d0: 7567 6d65 6e74 6564 5f69 6d61 6765 735b  ugmented_images[
+000054e0: 315d 5b69 5d29 290a 2020 2020 2020 2020  1][i])).        
+000054f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 00005500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005510: 6d61 785f 7069 782e 6170 7065 6e64 286d  max_pix.append(m
-00005520: 6178 5f70 6978 5f31 290a 2020 2020 2020  ax_pix_1).      
-00005530: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-00005540: 675f 6e75 6d5f 6368 616e 6e65 6c73 203e  g_num_channels >
-00005550: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-00005560: 2020 2020 206d 6178 5f70 6978 5f32 203d       max_pix_2 =
-00005570: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
-00005580: 6e74 2827 6d61 785f 7069 7865 6c5f 3227  nt('max_pixel_2'
-00005590: 2c20 7365 6c66 2e6f 7074 5f6d 6178 5f6d  , self.opt_max_m
-000055a0: 696e 5f70 6978 2c20 7365 6c66 2e6f 7074  in_pix, self.opt
-000055b0: 5f6d 6178 5f6d 6178 5f70 6978 2c20 7374  _max_max_pix, st
-000055c0: 6570 3d31 290a 2020 2020 2020 2020 2020  ep=1).          
-000055d0: 2020 2020 2020 6d61 785f 7069 782e 6170        max_pix.ap
-000055e0: 7065 6e64 286d 6178 5f70 6978 5f32 290a  pend(max_pix_2).
-000055f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00005600: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-00005610: 6e65 6c73 203d 3d20 333a 0a20 2020 2020  nels == 3:.     
-00005620: 2020 2020 2020 2020 2020 206d 6178 5f70             max_p
-00005630: 6978 5f33 203d 2074 7269 616c 2e73 7567  ix_3 = trial.sug
-00005640: 6765 7374 5f69 6e74 2827 6d61 785f 7069  gest_int('max_pi
-00005650: 7865 6c5f 3327 2c20 7365 6c66 2e6f 7074  xel_3', self.opt
-00005660: 5f6d 6178 5f6d 696e 5f70 6978 2c20 7365  _max_min_pix, se
-00005670: 6c66 2e6f 7074 5f6d 6178 5f6d 6178 5f70  lf.opt_max_max_p
-00005680: 6978 2c20 7374 6570 3d31 290a 2020 2020  ix, step=1).    
-00005690: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-000056a0: 7069 782e 6170 7065 6e64 286d 6178 5f70  pix.append(max_p
-000056b0: 6978 5f33 290a 2020 2020 2020 2020 2020  ix_3).          
-000056c0: 2020 656c 6966 2073 656c 662e 696d 675f    elif self.img_
-000056d0: 6e75 6d5f 6368 616e 6e65 6c73 203e 2033  num_channels > 3
-000056e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000056f0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00005700: 6f72 2827 4f6e 6c79 2075 7020 746f 2074  or('Only up to t
-00005710: 6872 6565 2063 6861 6e6e 656c 7320 6172  hree channels ar
-00005720: 6520 6375 7272 656e 746c 7920 7375 7070  e currently supp
-00005730: 6f72 7465 6421 2729 0a20 2020 2020 2020  orted!').       
-00005740: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00005750: 2020 206d 696e 5f70 6978 2c20 6d61 785f     min_pix, max_
-00005760: 7069 7820 3d20 7365 6c66 2e6d 696e 5f70  pix = self.min_p
-00005770: 6978 656c 2c20 7365 6c66 2e6d 6178 5f70  ixel, self.max_p
-00005780: 6978 656c 0a0a 2020 2020 2020 2020 2323  ixel..        ##
-00005790: 2320 4561 726c 7920 5374 6f70 7069 6e67  # Early Stopping
-000057a0: 2061 6e64 2050 7275 6e69 6e67 2043 616c   and Pruning Cal
-000057b0: 6c62 6163 6b73 2023 2323 0a20 2020 2020  lbacks ###.     
-000057c0: 2020 2069 6620 7365 6c66 2e70 6174 6965     if self.patie
-000057d0: 6e63 6520 213d 2030 3a0a 2020 2020 2020  nce != 0:.      
-000057e0: 2020 2020 2020 6966 2073 656c 662e 6d65        if self.me
-000057f0: 7472 6963 203d 3d20 2761 6c6c 2720 6f72  tric == 'all' or
-00005800: 2073 656c 662e 6d65 7472 6963 203d 3d20   self.metric == 
-00005810: 2776 616c 5f61 6c6c 273a 0a20 2020 2020  'val_all':.     
-00005820: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00005830: 2827 4361 6e6e 6f74 2075 7365 2063 616c  ('Cannot use cal
-00005840: 6c62 6163 6b73 2069 6620 6176 6572 6167  lbacks if averag
-00005850: 696e 6720 6f75 7420 616c 6c20 7065 7266  ing out all perf
-00005860: 6f72 6d61 6e63 6520 6d65 7472 6963 7320  ormance metrics 
-00005870: 666f 7220 6576 616c 7561 7469 6f6e 2c20  for evaluation, 
-00005880: 7365 7474 696e 6720 7061 7469 656e 6365  setting patience
-00005890: 3d30 2e27 290a 2020 2020 2020 2020 2020  =0.').          
-000058a0: 2020 2020 2020 6361 6c6c 6261 636b 7320        callbacks 
-000058b0: 3d20 5b5d 2354 464b 6572 6173 5072 756e  = []#TFKerasPrun
-000058c0: 696e 6743 616c 6c62 6163 6b28 7472 6961  ingCallback(tria
-000058d0: 6c2c 206d 6f6e 6974 6f72 3d73 656c 662e  l, monitor=self.
-000058e0: 6d65 7472 6963 292c 5d0a 2020 2020 2020  metric),].      
-000058f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00005900: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00005910: 656c 662e 7472 6169 6e5f 6163 635f 7468  elf.train_acc_th
-00005920: 7265 7368 6f6c 6420 6973 204e 6f6e 653a  reshold is None:
-00005930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005940: 2020 2020 2063 616c 6c62 6163 6b73 203d       callbacks =
-00005950: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-00005960: 2020 2020 2020 2020 2020 2045 6172 6c79             Early
-00005970: 5374 6f70 7069 6e67 286d 6f6e 6974 6f72  Stopping(monitor
-00005980: 3d73 656c 662e 6d65 7472 6963 2c20 6d6f  =self.metric, mo
-00005990: 6465 3d6d 6f64 652c 2070 6174 6965 6e63  de=mode, patienc
-000059a0: 653d 7365 6c66 2e70 6174 6965 6e63 6529  e=self.patience)
-000059b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000059c0: 2020 2020 2020 2020 2020 2354 464b 6572            #TFKer
-000059d0: 6173 5072 756e 696e 6743 616c 6c62 6163  asPruningCallbac
-000059e0: 6b28 7472 6961 6c2c 206d 6f6e 6974 6f72  k(trial, monitor
-000059f0: 3d73 656c 662e 6d65 7472 6963 292c 0a20  =self.metric),. 
-00005a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a10: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00005a20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00005a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a40: 2020 2063 616c 6c62 6163 6b73 203d 205b     callbacks = [
-00005a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a60: 2020 2020 2020 2020 2045 6172 6c79 5374           EarlySt
-00005a70: 6f70 7069 6e67 286d 6f6e 6974 6f72 3d27  opping(monitor='
-00005a80: 6269 6e61 7279 5f61 6363 7572 6163 7927  binary_accuracy'
-00005a90: 2c20 6d6f 6465 3d27 6d61 7827 2c20 7061  , mode='max', pa
-00005aa0: 7469 656e 6365 3d30 2c20 6261 7365 6c69  tience=0, baseli
-00005ab0: 6e65 3d73 656c 662e 7472 6169 6e5f 6163  ne=self.train_ac
-00005ac0: 635f 7468 7265 7368 6f6c 6429 2c0a 2020  c_threshold),.  
-00005ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ae0: 2020 2020 2020 4561 726c 7953 746f 7070        EarlyStopp
-00005af0: 696e 6728 6d6f 6e69 746f 723d 7365 6c66  ing(monitor=self
-00005b00: 2e6d 6574 7269 632c 206d 6f64 653d 6d6f  .metric, mode=mo
-00005b10: 6465 2c20 7061 7469 656e 6365 3d73 656c  de, patience=sel
-00005b20: 662e 7061 7469 656e 6365 292c 200a 2020  f.patience), .  
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 2020 2020 2020 2354 464b 6572 6173 5072        #TFKerasPr
-00005b50: 756e 696e 6743 616c 6c62 6163 6b28 7472  uningCallback(tr
-00005b60: 6961 6c2c 206d 6f6e 6974 6f72 3d73 656c  ial, monitor=sel
-00005b70: 662e 6d65 7472 6963 292c 0a20 2020 2020  f.metric),.     
-00005b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b90: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
-00005ba0: 2069 6620 7365 6c66 2e6d 6f6e 6974 6f72   if self.monitor
-00005bb0: 3120 6973 206e 6f74 204e 6f6e 653a 0a20  1 is not None:. 
-00005bc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00005bd0: 616c 6c62 6163 6b73 2e61 7070 656e 6428  allbacks.append(
-00005be0: 4d6f 6e69 746f 725f 5472 6163 6b65 7228  Monitor_Tracker(
-00005bf0: 6d6f 6e69 746f 7231 3d73 656c 662e 6d6f  monitor1=self.mo
-00005c00: 6e69 746f 7231 2c20 6d6f 6e69 746f 7232  nitor1, monitor2
-00005c10: 3d73 656c 662e 6d6f 6e69 746f 7232 2c20  =self.monitor2, 
-00005c20: 6d6f 6e69 746f 7231 5f74 6872 6573 683d  monitor1_thresh=
-00005c30: 7365 6c66 2e6d 6f6e 6974 6f72 315f 7468  self.monitor1_th
-00005c40: 7265 7368 2c20 6d6f 6e69 746f 7232 5f74  resh, monitor2_t
-00005c50: 6872 6573 683d 7365 6c66 2e6d 6f6e 6974  hresh=self.monit
-00005c60: 6f72 325f 7468 7265 7368 2929 0a20 2020  or2_thresh)).   
-00005c70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00005c80: 2020 2020 2020 2063 616c 6c62 6163 6b73         callbacks
-00005c90: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-00005ca0: 2023 2323 2023 2323 2023 2323 2023 2323   ### ### ### ###
-00005cb0: 2023 2323 2023 2323 2023 2323 2023 2323   ### ### ### ###
-00005cc0: 2023 2323 200a 2020 2020 2020 2020 2323   ### .        ##
-00005cd0: 204f 7074 696d 697a 6520 434e 4e20 2d2d   Optimize CNN --
-00005ce0: 2041 6c65 784e 6574 206f 6e6c 7921 2023   AlexNet only! #
-00005cf0: 230a 2020 2020 2020 2020 2323 2320 2323  #.        ### ##
-00005d00: 2320 2323 2320 2323 2320 2323 2320 2323  # ### ### ### ##
-00005d10: 2320 2323 2320 2323 2320 2323 2320 0a0a  # ### ### ### ..
-00005d20: 2020 2020 2020 2020 2323 2320 4261 7463          ### Batc
-00005d30: 6820 5369 7a65 2c20 4c65 6172 6e69 6e67  h Size, Learning
-00005d40: 2052 6174 6520 2620 4f70 7469 6d69 7a65   Rate & Optimize
-00005d50: 7220 2323 230a 2020 2020 2020 2020 6261  r ###.        ba
-00005d60: 7463 685f 7369 7a65 203d 2074 7269 616c  tch_size = trial
-00005d70: 2e73 7567 6765 7374 5f69 6e74 2827 6261  .suggest_int('ba
-00005d80: 7463 685f 7369 7a65 272c 2073 656c 662e  tch_size', self.
-00005d90: 6261 7463 685f 7369 7a65 5f6d 696e 2c20  batch_size_min, 
-00005da0: 7365 6c66 2e62 6174 6368 5f73 697a 655f  self.batch_size_
-00005db0: 6d61 782c 2073 7465 703d 3129 0a20 2020  max, step=1).   
-00005dc0: 2020 2020 206c 7220 3d20 7472 6961 6c2e       lr = trial.
-00005dd0: 7375 6767 6573 745f 666c 6f61 7428 276c  suggest_float('l
-00005de0: 7227 2c20 3165 2d36 2c20 3165 2d33 2c20  r', 1e-6, 1e-3, 
-00005df0: 7374 6570 3d31 652d 3429 200a 2020 2020  step=1e-4) .    
-00005e00: 2020 2020 6f70 7469 6d69 7a65 7220 3d20      optimizer = 
-00005e10: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
-00005e20: 7465 676f 7269 6361 6c28 276f 7074 696d  tegorical('optim
-00005e30: 697a 6572 272c 205b 2761 6461 6d27 2c20  izer', ['adam', 
-00005e40: 2773 6764 272c 2027 726d 7370 726f 7027  'sgd', 'rmsprop'
-00005e50: 2c20 2761 6461 6772 6164 275d 2920 0a0a  , 'adagrad']) ..
-00005e60: 2020 2020 2020 2020 2341 6461 6d20 616e          #Adam an
-00005e70: 6420 4164 6167 7261 6420 646f 6e27 7420  d Adagrad don't 
-00005e80: 6e65 6564 2064 6563 6179 206e 6f72 206d  need decay nor m
-00005e90: 6f6d 656e 7475 6d0a 2020 2020 2020 2020  omentum.        
-00005ea0: 6966 206f 7074 696d 697a 6572 2021 3d20  if optimizer != 
-00005eb0: 2761 6461 6d27 2061 6e64 206f 7074 696d  'adam' and optim
-00005ec0: 697a 6572 2021 3d20 2761 6461 6772 6164  izer != 'adagrad
-00005ed0: 273a 0a20 2020 2020 2020 2020 2020 2064  ':.            d
-00005ee0: 6563 6179 203d 2074 7269 616c 2e73 7567  ecay = trial.sug
-00005ef0: 6765 7374 5f66 6c6f 6174 2827 6465 6361  gest_float('deca
-00005f00: 7927 2c20 302e 302c 2030 2e31 2c20 7374  y', 0.0, 0.1, st
-00005f10: 6570 3d31 652d 3329 0a20 2020 2020 2020  ep=1e-3).       
-00005f20: 2020 2020 2069 6620 6f70 7469 6d69 7a65       if optimize
-00005f30: 7220 3d3d 2027 7367 6427 3a20 234f 6e6c  r == 'sgd': #Onl
-00005f40: 7920 5347 4420 7265 7175 6972 6573 206d  y SGD requires m
-00005f50: 6f6d 656e 7475 6d20 616e 6420 6e65 7374  omentum and nest
-00005f60: 6572 6f76 2c20 726d 7370 726f 7020 6f6e  erov, rmsprop on
-00005f70: 6c79 206e 6565 6473 206c 7220 2620 6465  ly needs lr & de
-00005f80: 6361 790a 2020 2020 2020 2020 2020 2020  cay.            
-00005f90: 2020 2020 6d6f 6d65 6e74 756d 203d 2074      momentum = t
-00005fa0: 7269 616c 2e73 7567 6765 7374 5f66 6c6f  rial.suggest_flo
-00005fb0: 6174 2827 6d6f 6d65 6e74 756d 272c 2030  at('momentum', 0
-00005fc0: 2e30 2c20 312e 302c 2073 7465 703d 302e  .0, 1.0, step=0.
-00005fd0: 3031 290a 2020 2020 2020 2020 2020 2020  01).            
-00005fe0: 2020 2020 6e65 7374 6572 6f76 203d 2074      nesterov = t
-00005ff0: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
-00006000: 6567 6f72 6963 616c 2827 6e65 7374 6572  egorical('nester
-00006010: 6f76 272c 205b 5472 7565 2c20 4661 6c73  ov', [True, Fals
-00006020: 655d 290a 2020 2020 2020 2020 2020 2020  e]).            
-00006030: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00006040: 2020 2020 2020 6d6f 6d65 6e74 756d 2c20        momentum, 
-00006050: 6e65 7374 6572 6f76 203d 2030 2e30 2c20  nesterov = 0.0, 
-00006060: 4661 6c73 650a 2020 2020 2020 2020 656c  False.        el
-00006070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00006080: 6465 6361 792c 206d 6f6d 656e 7475 6d2c  decay, momentum,
-00006090: 206e 6573 7465 726f 7620 3d20 302e 302c   nesterov = 0.0,
-000060a0: 2030 2e30 2c20 4661 6c73 650a 0a20 2020   0.0, False..   
-000060b0: 2020 2020 2063 6c65 6172 5f73 6573 7369       clear_sessi
-000060c0: 6f6e 2829 0a20 2020 2020 2020 2069 6620  on().        if 
-000060d0: 7365 6c66 2e6f 7074 5f6d 6f64 656c 3a0a  self.opt_model:.
-000060e0: 2020 2020 2020 2020 2020 2020 2222 2241              """A
-000060f0: 6c65 784e 6574 2048 7970 6572 7061 7261  lexNet Hyperpara
-00006100: 6d65 7465 7220 5365 6172 6368 2053 7061  meter Search Spa
-00006110: 6365 2222 220a 0a20 2020 2020 2020 2020  ce"""..         
-00006120: 2020 2023 2323 2052 6567 756c 6172 697a     ### Regulariz
-00006130: 6174 696f 6e20 5465 6368 6e69 7175 6520  ation Technique 
-00006140: 2842 4e20 6973 206e 6577 6572 2920 2323  (BN is newer) ##
-00006150: 230a 2020 2020 2020 2020 2020 2020 6d6f  #.            mo
-00006160: 6465 6c5f 7265 6720 3d20 7472 6961 6c2e  del_reg = trial.
-00006170: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
-00006180: 6361 6c28 276d 6f64 656c 5f72 6567 272c  cal('model_reg',
-00006190: 205b 276c 6f63 616c 5f72 6573 706f 6e73   ['local_respons
-000061a0: 6527 2c20 2762 6174 6368 5f6e 6f72 6d27  e', 'batch_norm'
-000061b0: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
-000061c0: 2323 2320 4163 7469 7661 7469 6f6e 2061  ### Activation a
-000061d0: 6e64 204c 6f73 7320 4675 6e63 7469 6f6e  nd Loss Function
-000061e0: 7320 2323 2320 0a20 2020 2020 2020 2020  s ### .         
-000061f0: 2020 2061 6374 6976 6174 696f 6e5f 636f     activation_co
-00006200: 6e76 203d 2074 7269 616c 2e73 7567 6765  nv = trial.sugge
-00006210: 7374 5f63 6174 6567 6f72 6963 616c 2827  st_categorical('
-00006220: 6163 7469 7661 7469 6f6e 5f63 6f6e 7627  activation_conv'
-00006230: 2c20 5b27 7265 6c75 272c 2020 2773 6967  , ['relu',  'sig
-00006240: 6d6f 6964 272c 2027 7461 6e68 272c 2027  moid', 'tanh', '
-00006250: 656c 7527 2c20 2773 656c 7527 5d29 2020  elu', 'selu'])  
-00006260: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00006270: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
-00006280: 6e5f 6465 6e73 6520 3d20 7472 6961 6c2e  n_dense = trial.
-00006290: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
-000062a0: 6361 6c28 2761 6374 6976 6174 696f 6e5f  cal('activation_
-000062b0: 6465 6e73 6527 2c20 5b27 7265 6c75 272c  dense', ['relu',
-000062c0: 2027 7369 676d 6f69 6427 2c20 2774 616e   'sigmoid', 'tan
-000062d0: 6827 2c20 2765 6c75 272c 2027 7365 6c75  h', 'elu', 'selu
-000062e0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-000062f0: 6c6f 7373 203d 2074 7269 616c 2e73 7567  loss = trial.sug
-00006300: 6765 7374 5f63 6174 6567 6f72 6963 616c  gest_categorical
-00006310: 2827 6c6f 7373 272c 205b 2762 696e 6172  ('loss', ['binar
-00006320: 795f 6372 6f73 7365 6e74 726f 7079 272c  y_crossentropy',
-00006330: 2027 6869 6e67 6527 2c20 2773 7175 6172   'hinge', 'squar
-00006340: 6564 5f68 696e 6765 272c 2027 6b6c 6427  ed_hinge', 'kld'
-00006350: 2c20 276c 6f67 636f 7368 275d 2923 2c20  , 'logcosh'])#, 
-00006360: 2766 6f63 616c 5f6c 6f73 7327 2c20 2764  'focal_loss', 'd
-00006370: 6963 655f 6c6f 7373 272c 2027 6a61 6363  ice_loss', 'jacc
-00006380: 6172 645f 6c6f 7373 275d 290a 0a20 2020  ard_loss'])..   
-00006390: 2020 2020 2020 2020 2023 2323 204b 6572           ### Ker
-000063a0: 6e65 6c20 496e 6974 6961 6c69 7a65 7273  nel Initializers
-000063b0: 2023 2323 0a20 2020 2020 2020 2020 2020   ###.           
-000063c0: 2063 6f6e 765f 696e 6974 203d 2074 7269   conv_init = tri
-000063d0: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
-000063e0: 6f72 6963 616c 2827 636f 6e76 5f69 6e69  orical('conv_ini
-000063f0: 7427 2c20 5b27 756e 6966 6f72 6d5f 7363  t', ['uniform_sc
-00006400: 616c 696e 6727 2c20 2754 7275 6e63 6174  aling', 'Truncat
-00006410: 6564 4e6f 726d 616c 272c 2027 6865 5f6e  edNormal', 'he_n
-00006420: 6f72 6d61 6c27 2c20 276c 6563 756e 5f75  ormal', 'lecun_u
-00006430: 6e69 666f 726d 272c 2027 676c 6f72 6f74  niform', 'glorot
-00006440: 5f75 6e69 666f 726d 275d 2920 0a20 2020  _uniform']) .   
-00006450: 2020 2020 2020 2020 2064 656e 7365 5f69           dense_i
-00006460: 6e69 7420 3d20 7472 6961 6c2e 7375 6767  nit = trial.sugg
-00006470: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
-00006480: 2764 656e 7365 5f69 6e69 7427 2c20 5b27  'dense_init', ['
-00006490: 756e 6966 6f72 6d5f 7363 616c 696e 6727  uniform_scaling'
-000064a0: 2c20 2754 7275 6e63 6174 6564 4e6f 726d  , 'TruncatedNorm
-000064b0: 616c 272c 2768 655f 6e6f 726d 616c 272c  al','he_normal',
-000064c0: 2027 6c65 6375 6e5f 756e 6966 6f72 6d27   'lecun_uniform'
-000064d0: 2c20 2767 6c6f 726f 745f 756e 6966 6f72  , 'glorot_unifor
-000064e0: 6d27 5d29 200a 0a20 2020 2020 2020 2020  m']) ..         
-000064f0: 2020 2023 2323 2054 7261 696e 2074 6865     ### Train the
-00006500: 204d 6f64 656c 2023 2323 0a20 2020 2020   Model ###.     
-00006510: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
-00006520: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00006530: 6c66 2e76 6572 626f 7365 203d 3d20 313a  lf.verbose == 1:
-00006540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006550: 2069 6620 7365 6c66 2e6f 7074 5f63 7620   if self.opt_cv 
-00006560: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-00006590: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000065a0: 6e74 2827 2a2a 2a2a 2a2a 2a2a 2a2a 2a20  nt('*********** 
-000065b0: 2043 5620 2d20 3120 2a2a 2a2a 2a2a 2a2a   CV - 1 ********
-000065c0: 2a2a 2a27 290a 2020 2020 2020 2020 2020  ***').          
-000065d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000065e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000065f0: 2020 6966 2073 656c 662e 6f70 745f 6175    if self.opt_au
-00006600: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-00006610: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
-00006620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006630: 2020 2070 7269 6e74 2827 3d3d 3d3d 3d3d     print('======
-00006640: 3d20 496d 6167 6520 5061 7261 6d65 7465  = Image Paramete
-00006650: 7273 203d 3d3d 3d3d 3d27 290a 2020 2020  rs ======').    
-00006660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006670: 7072 696e 7428 290a 2020 2020 2020 2020  print().        
-00006680: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00006690: 7428 274e 756d 2041 7567 6d65 6e74 6174  t('Num Augmentat
-000066a0: 696f 6e73 203a 272c 206e 756d 5f61 7567  ions :', num_aug
-000066b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000066c0: 2020 2020 2020 7072 696e 7428 2749 6d61        print('Ima
-000066d0: 6765 2053 697a 6520 3a20 272c 2069 6d61  ge Size : ', ima
-000066e0: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
-000066f0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00006700: 6e74 2827 4d61 7820 5069 7865 6c28 7329  nt('Max Pixel(s)
-00006710: 203a 272c 206d 6178 5f70 6978 290a 0a20   :', max_pix).. 
-00006720: 2020 2020 2020 2020 2020 2023 2323 2050             ### P
-00006730: 6f6f 6c69 6e67 2054 7970 6520 2323 230a  ooling Type ###.
-00006740: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00006750: 656c 662e 6c69 6d69 745f 7365 6172 6368  elf.limit_search
-00006760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006770: 2020 706f 6f6c 696e 675f 3120 3d20 7472    pooling_1 = tr
-00006780: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
-00006790: 676f 7269 6361 6c28 2770 6f6f 6c69 6e67  gorical('pooling
-000067a0: 5f31 272c 205b 276d 696e 272c 2027 6d61  _1', ['min', 'ma
-000067b0: 7827 2c20 2761 7665 7261 6765 275d 290a  x', 'average']).
-000067c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000067d0: 706f 6f6c 696e 675f 3220 3d20 7472 6961  pooling_2 = tria
-000067e0: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
-000067f0: 7269 6361 6c28 2770 6f6f 6c69 6e67 5f32  rical('pooling_2
-00006800: 272c 205b 276d 696e 272c 2027 6d61 7827  ', ['min', 'max'
-00006810: 2c20 2761 7665 7261 6765 275d 290a 2020  , 'average']).  
-00006820: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00006830: 6f6c 696e 675f 3320 3d20 7472 6961 6c2e  oling_3 = trial.
-00006840: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
-00006850: 6361 6c28 2770 6f6f 6c69 6e67 5f33 272c  cal('pooling_3',
-00006860: 205b 276d 696e 272c 2027 6d61 7827 2c20   ['min', 'max', 
-00006870: 2761 7665 7261 6765 275d 290a 0a20 2020  'average'])..   
-00006880: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00006890: 656c 2c20 6869 7374 6f72 7920 3d20 636e  el, history = cn
-000068a0: 6e5f 6d6f 6465 6c2e 416c 6578 4e65 7428  n_model.AlexNet(
-000068b0: 636c 6173 735f 312c 2063 6c61 7373 5f32  class_1, class_2
-000068c0: 2c20 696d 675f 6e75 6d5f 6368 616e 6e65  , img_num_channe
-000068d0: 6c73 3d73 656c 662e 696d 675f 6e75 6d5f  ls=self.img_num_
-000068e0: 6368 616e 6e65 6c73 2c20 0a20 2020 2020  channels, .     
-000068f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00006900: 6f72 6d61 6c69 7a65 3d73 656c 662e 6e6f  ormalize=self.no
-00006910: 726d 616c 697a 652c 206d 696e 5f70 6978  rmalize, min_pix
-00006920: 656c 3d6d 696e 5f70 6978 2c20 6d61 785f  el=min_pix, max_
-00006930: 7069 7865 6c3d 6d61 785f 7069 782c 2076  pixel=max_pix, v
-00006940: 616c 5f70 6f73 6974 6976 653d 7661 6c5f  al_positive=val_
-00006950: 636c 6173 735f 312c 2076 616c 5f6e 6567  class_1, val_neg
-00006960: 6174 6976 653d 7661 6c5f 636c 6173 735f  ative=val_class_
-00006970: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
-00006980: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
-00006990: 656c 662e 7472 6169 6e5f 6570 6f63 6873  elf.train_epochs
-000069a0: 2c20 6261 7463 685f 7369 7a65 3d62 6174  , batch_size=bat
-000069b0: 6368 5f73 697a 652c 206c 723d 6c72 2c20  ch_size, lr=lr, 
-000069c0: 6d6f 6d65 6e74 756d 3d6d 6f6d 656e 7475  momentum=momentu
-000069d0: 6d2c 2064 6563 6179 3d64 6563 6179 2c20  m, decay=decay, 
-000069e0: 6e65 7374 6572 6f76 3d6e 6573 7465 726f  nesterov=nestero
-000069f0: 762c 200a 2020 2020 2020 2020 2020 2020  v, .            
-00006a00: 2020 2020 2020 2020 6c6f 7373 3d6c 6f73          loss=los
-00006a10: 732c 2061 6374 6976 6174 696f 6e5f 636f  s, activation_co
-00006a20: 6e76 3d61 6374 6976 6174 696f 6e5f 636f  nv=activation_co
-00006a30: 6e76 2c20 6163 7469 7661 7469 6f6e 5f64  nv, activation_d
-00006a40: 656e 7365 3d61 6374 6976 6174 696f 6e5f  ense=activation_
-00006a50: 6465 6e73 652c 206d 6f64 656c 5f72 6567  dense, model_reg
-00006a60: 3d6d 6f64 656c 5f72 6567 2c20 0a20 2020  =model_reg, .   
-00006a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a80: 2063 6f6e 765f 696e 6974 3d63 6f6e 765f   conv_init=conv_
-00006a90: 696e 6974 2c20 6465 6e73 655f 696e 6974  init, dense_init
-00006aa0: 3d64 656e 7365 5f69 6e69 742c 206f 7074  =dense_init, opt
-00006ab0: 696d 697a 6572 3d6f 7074 696d 697a 6572  imizer=optimizer
-00006ac0: 2c20 6561 726c 795f 7374 6f70 5f63 616c  , early_stop_cal
-00006ad0: 6c62 6163 6b3d 6361 6c6c 6261 636b 732c  lback=callbacks,
-00006ae0: 2063 6865 636b 706f 696e 743d 4661 6c73   checkpoint=Fals
-00006af0: 652c 2076 6572 626f 7365 3d73 656c 662e  e, verbose=self.
-00006b00: 7665 7262 6f73 652c 200a 2020 2020 2020  verbose, .      
-00006b10: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00006b20: 6f6c 696e 675f 313d 706f 6f6c 696e 675f  oling_1=pooling_
-00006b30: 312c 2070 6f6f 6c69 6e67 5f32 3d70 6f6f  1, pooling_2=poo
-00006b40: 6c69 6e67 5f32 2c20 706f 6f6c 696e 675f  ling_2, pooling_
-00006b50: 333d 706f 6f6c 696e 675f 332c 2073 6d6f  3=pooling_3, smo
-00006b60: 7465 5f73 616d 706c 696e 673d 7365 6c66  te_sampling=self
-00006b70: 2e73 6d6f 7465 5f73 616d 706c 696e 6729  .smote_sampling)
-00006b80: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00006b90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00006ba0: 2020 2023 2323 2046 696c 7465 7220 616e     ### Filter an
-00006bb0: 6420 4c61 7965 7220 4368 6172 6163 7465  d Layer Characte
-00006bc0: 7273 7469 6373 2023 2323 0a20 2020 2020  rstics ###.     
-00006bd0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-00006be0: 725f 3120 3d20 7472 6961 6c2e 7375 6767  r_1 = trial.sugg
-00006bf0: 6573 745f 696e 7428 2766 696c 7465 725f  est_int('filter_
-00006c00: 3127 2c20 3132 2c20 3234 302c 2073 7465  1', 12, 240, ste
-00006c10: 703d 3132 290a 2020 2020 2020 2020 2020  p=12).          
-00006c20: 2020 2020 2020 6669 6c74 6572 5f73 697a        filter_siz
-00006c30: 655f 3120 3d20 7472 6961 6c2e 7375 6767  e_1 = trial.sugg
-00006c40: 6573 745f 696e 7428 2766 696c 7465 725f  est_int('filter_
-00006c50: 7369 7a65 5f31 272c 2031 2c20 3131 2c20  size_1', 1, 11, 
-00006c60: 7374 6570 3d32 290a 2020 2020 2020 2020  step=2).        
-00006c70: 2020 2020 2020 2020 7374 7269 6465 735f          strides_
-00006c80: 3120 3d20 7472 6961 6c2e 7375 6767 6573  1 = trial.sugges
-00006c90: 745f 696e 7428 2773 7472 6964 6573 5f31  t_int('strides_1
-00006ca0: 272c 2031 2c20 332c 2073 7465 703d 3129  ', 1, 3, step=1)
-00006cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006cc0: 2070 6f6f 6c69 6e67 5f31 203d 2074 7269   pooling_1 = tri
-00006cd0: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
-00006ce0: 6f72 6963 616c 2827 706f 6f6c 696e 675f  orical('pooling_
-00006cf0: 3127 2c20 5b27 6d61 7827 2c20 2761 7665  1', ['max', 'ave
-00006d00: 7261 6765 275d 290a 2020 2020 2020 2020  rage']).        
-00006d10: 2020 2020 2020 2020 706f 6f6c 5f73 697a          pool_siz
-00006d20: 655f 3120 3d20 7472 6961 6c2e 7375 6767  e_1 = trial.sugg
-00006d30: 6573 745f 696e 7428 2770 6f6f 6c5f 7369  est_int('pool_si
-00006d40: 7a65 5f31 272c 2031 2c20 372c 2073 7465  ze_1', 1, 7, ste
-00006d50: 703d 3129 0a20 2020 2020 2020 2020 2020  p=1).           
-00006d60: 2020 2020 2070 6f6f 6c5f 7374 7269 6465       pool_stride
-00006d70: 5f31 203d 2074 7269 616c 2e73 7567 6765  _1 = trial.sugge
-00006d80: 7374 5f69 6e74 2827 706f 6f6c 5f73 7472  st_int('pool_str
-00006d90: 6964 655f 3127 2c20 312c 2033 2c20 7374  ide_1', 1, 3, st
-00006da0: 6570 3d31 290a 0a20 2020 2020 2020 2020  ep=1)..         
-00006db0: 2020 2020 2020 2066 696c 7465 725f 3220         filter_2 
-00006dc0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-00006dd0: 696e 7428 2766 696c 7465 725f 3227 2c20  int('filter_2', 
-00006de0: 3132 2c20 3234 302c 2073 7465 703d 3132  12, 240, step=12
-00006df0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006e00: 2020 6669 6c74 6572 5f73 697a 655f 3220    filter_size_2 
-00006e10: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-00006e20: 696e 7428 2766 696c 7465 725f 7369 7a65  int('filter_size
-00006e30: 5f32 272c 2031 2c20 372c 2073 7465 703d  _2', 1, 7, step=
-00006e40: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-00006e50: 2020 2073 7472 6964 6573 5f32 203d 2074     strides_2 = t
-00006e60: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
-00006e70: 2827 7374 7269 6465 735f 3227 2c20 312c  ('strides_2', 1,
-00006e80: 2033 2c20 7374 6570 3d31 290a 2020 2020   3, step=1).    
-00006e90: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
-00006ea0: 696e 675f 3220 3d20 7472 6961 6c2e 7375  ing_2 = trial.su
-00006eb0: 6767 6573 745f 6361 7465 676f 7269 6361  ggest_categorica
-00006ec0: 6c28 2770 6f6f 6c69 6e67 5f32 272c 205b  l('pooling_2', [
-00006ed0: 276d 6178 272c 2027 6176 6572 6167 6527  'max', 'average'
-00006ee0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00006ef0: 2020 2070 6f6f 6c5f 7369 7a65 5f32 203d     pool_size_2 =
-00006f00: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
-00006f10: 6e74 2827 706f 6f6c 5f73 697a 655f 3227  nt('pool_size_2'
-00006f20: 2c20 312c 2037 2c20 7374 6570 3d31 290a  , 1, 7, step=1).
-00006f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f40: 706f 6f6c 5f73 7472 6964 655f 3220 3d20  pool_stride_2 = 
-00006f50: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-00006f60: 7428 2770 6f6f 6c5f 7374 7269 6465 5f32  t('pool_stride_2
-00006f70: 272c 2031 2c20 332c 2073 7465 703d 3129  ', 1, 3, step=1)
-00006f80: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006f90: 2020 6669 6c74 6572 5f33 203d 2074 7269    filter_3 = tri
-00006fa0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-00006fb0: 6669 6c74 6572 5f33 272c 2031 322c 2032  filter_3', 12, 2
-00006fc0: 3430 2c20 7374 6570 3d31 3229 0a20 2020  40, step=12).   
-00006fd0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00006fe0: 7465 725f 7369 7a65 5f33 203d 2074 7269  ter_size_3 = tri
-00006ff0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-00007000: 6669 6c74 6572 5f73 697a 655f 3327 2c20  filter_size_3', 
-00007010: 312c 2037 2c20 7374 6570 3d32 290a 2020  1, 7, step=2).  
-00007020: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00007030: 7269 6465 735f 3320 3d20 7472 6961 6c2e  rides_3 = trial.
-00007040: 7375 6767 6573 745f 696e 7428 2773 7472  suggest_int('str
-00007050: 6964 6573 5f33 272c 2031 2c20 332c 2073  ides_3', 1, 3, s
-00007060: 7465 703d 3129 0a20 2020 2020 2020 2020  tep=1).         
-00007070: 2020 2020 2020 2070 6f6f 6c69 6e67 5f33         pooling_3
-00007080: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-00007090: 5f63 6174 6567 6f72 6963 616c 2827 706f  _categorical('po
-000070a0: 6f6c 696e 675f 3327 2c20 5b27 6d61 7827  oling_3', ['max'
-000070b0: 2c20 2761 7665 7261 6765 275d 290a 2020  , 'average']).  
-000070c0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-000070d0: 6f6c 5f73 697a 655f 3320 3d20 7472 6961  ol_size_3 = tria
-000070e0: 6c2e 7375 6767 6573 745f 696e 7428 2770  l.suggest_int('p
-000070f0: 6f6f 6c5f 7369 7a65 5f33 272c 2031 2c20  ool_size_3', 1, 
-00007100: 372c 2073 7465 703d 3129 0a20 2020 2020  7, step=1).     
-00007110: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
-00007120: 7374 7269 6465 5f33 203d 2074 7269 616c  stride_3 = trial
-00007130: 2e73 7567 6765 7374 5f69 6e74 2827 706f  .suggest_int('po
-00007140: 6f6c 5f73 7472 6964 655f 3327 2c20 312c  ol_stride_3', 1,
-00007150: 2033 2c20 7374 6570 3d31 290a 0a20 2020   3, step=1)..   
-00007160: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00007170: 7465 725f 3420 3d20 7472 6961 6c2e 7375  ter_4 = trial.su
-00007180: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
-00007190: 725f 3427 2c20 3132 2c20 3234 302c 2073  r_4', 12, 240, s
-000071a0: 7465 703d 3132 290a 2020 2020 2020 2020  tep=12).        
-000071b0: 2020 2020 2020 2020 6669 6c74 6572 5f73          filter_s
-000071c0: 697a 655f 3420 3d20 7472 6961 6c2e 7375  ize_4 = trial.su
-000071d0: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
-000071e0: 725f 7369 7a65 5f34 272c 2031 2c20 372c  r_size_4', 1, 7,
-000071f0: 2073 7465 703d 3229 0a20 2020 2020 2020   step=2).       
-00007200: 2020 2020 2020 2020 2073 7472 6964 6573           strides
-00007210: 5f34 203d 2074 7269 616c 2e73 7567 6765  _4 = trial.sugge
-00007220: 7374 5f69 6e74 2827 7374 7269 6465 735f  st_int('strides_
-00007230: 3427 2c20 312c 2033 2c20 7374 6570 3d31  4', 1, 3, step=1
-00007240: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00007250: 2020 2066 696c 7465 725f 3520 3d20 7472     filter_5 = tr
-00007260: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
-00007270: 2766 696c 7465 725f 3527 2c20 3132 2c20  'filter_5', 12, 
-00007280: 3234 302c 2073 7465 703d 3132 290a 2020  240, step=12).  
-00007290: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000072a0: 6c74 6572 5f73 697a 655f 3520 3d20 7472  lter_size_5 = tr
-000072b0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
-000072c0: 2766 696c 7465 725f 7369 7a65 5f35 272c  'filter_size_5',
-000072d0: 2031 2c20 372c 2073 7465 703d 3229 0a20   1, 7, step=2). 
-000072e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000072f0: 7472 6964 6573 5f35 203d 2074 7269 616c  trides_5 = trial
-00007300: 2e73 7567 6765 7374 5f69 6e74 2827 7374  .suggest_int('st
-00007310: 7269 6465 735f 3527 2c20 312c 2033 2c20  rides_5', 1, 3, 
-00007320: 7374 6570 3d31 2920 0a0a 2020 2020 2020  step=1) ..      
-00007330: 2020 2020 2020 2020 2020 2323 2320 4465            ### De
-00007340: 6e73 6520 4c61 7965 7273 2023 2323 0a20  nse Layers ###. 
-00007350: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00007360: 656e 7365 5f6e 6575 726f 6e73 5f31 203d  ense_neurons_1 =
-00007370: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
-00007380: 6e74 2827 6465 6e73 655f 6e65 7572 6f6e  nt('dense_neuron
-00007390: 735f 3127 2c20 3132 382c 2036 3430 302c  s_1', 128, 6400,
-000073a0: 2073 7465 703d 3132 3829 0a20 2020 2020   step=128).     
-000073b0: 2020 2020 2020 2020 2020 2064 656e 7365             dense
-000073c0: 5f6e 6575 726f 6e73 5f32 203d 2074 7269  _neurons_2 = tri
-000073d0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-000073e0: 6465 6e73 655f 6e65 7572 6f6e 735f 3227  dense_neurons_2'
-000073f0: 2c20 3132 382c 2036 3430 302c 2073 7465  , 128, 6400, ste
-00007400: 703d 3132 3829 0a20 2020 2020 2020 2020  p=128).         
-00007410: 2020 2020 2020 2064 726f 706f 7574 5f31         dropout_1
-00007420: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-00007430: 5f66 6c6f 6174 2827 6472 6f70 6f75 745f  _float('dropout_
-00007440: 3127 2c20 302e 302c 2030 2e35 2c20 7374  1', 0.0, 0.5, st
-00007450: 6570 3d30 2e30 3129 0a20 2020 2020 2020  ep=0.01).       
-00007460: 2020 2020 2020 2020 2064 726f 706f 7574           dropout
-00007470: 5f32 203d 2074 7269 616c 2e73 7567 6765  _2 = trial.sugge
-00007480: 7374 5f66 6c6f 6174 2827 6472 6f70 6f75  st_float('dropou
-00007490: 745f 3227 2c20 302e 302c 2030 2e35 2c20  t_2', 0.0, 0.5, 
-000074a0: 7374 6570 3d30 2e30 3129 200a 0a20 2020  step=0.01) ..   
-000074b0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-000074c0: 656c 2c20 6869 7374 6f72 7920 3d20 636e  el, history = cn
-000074d0: 6e5f 6d6f 6465 6c2e 416c 6578 4e65 7428  n_model.AlexNet(
-000074e0: 636c 6173 735f 312c 2063 6c61 7373 5f32  class_1, class_2
-000074f0: 2c20 696d 675f 6e75 6d5f 6368 616e 6e65  , img_num_channe
-00007500: 6c73 3d73 656c 662e 696d 675f 6e75 6d5f  ls=self.img_num_
-00007510: 6368 616e 6e65 6c73 2c20 0a20 2020 2020  channels, .     
-00007520: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00007530: 6f72 6d61 6c69 7a65 3d73 656c 662e 6e6f  ormalize=self.no
-00007540: 726d 616c 697a 652c 206d 696e 5f70 6978  rmalize, min_pix
-00007550: 656c 3d6d 696e 5f70 6978 2c20 6d61 785f  el=min_pix, max_
-00007560: 7069 7865 6c3d 6d61 785f 7069 782c 2076  pixel=max_pix, v
-00007570: 616c 5f70 6f73 6974 6976 653d 7661 6c5f  al_positive=val_
-00007580: 636c 6173 735f 312c 2076 616c 5f6e 6567  class_1, val_neg
-00007590: 6174 6976 653d 7661 6c5f 636c 6173 735f  ative=val_class_
-000075a0: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
-000075b0: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
-000075c0: 656c 662e 7472 6169 6e5f 6570 6f63 6873  elf.train_epochs
-000075d0: 2c20 6261 7463 685f 7369 7a65 3d62 6174  , batch_size=bat
-000075e0: 6368 5f73 697a 652c 206c 723d 6c72 2c20  ch_size, lr=lr, 
-000075f0: 6d6f 6d65 6e74 756d 3d6d 6f6d 656e 7475  momentum=momentu
-00007600: 6d2c 2064 6563 6179 3d64 6563 6179 2c20  m, decay=decay, 
-00007610: 6e65 7374 6572 6f76 3d6e 6573 7465 726f  nesterov=nestero
-00007620: 762c 200a 2020 2020 2020 2020 2020 2020  v, .            
-00007630: 2020 2020 2020 2020 6c6f 7373 3d6c 6f73          loss=los
-00007640: 732c 2061 6374 6976 6174 696f 6e5f 636f  s, activation_co
-00007650: 6e76 3d61 6374 6976 6174 696f 6e5f 636f  nv=activation_co
-00007660: 6e76 2c20 6163 7469 7661 7469 6f6e 5f64  nv, activation_d
-00007670: 656e 7365 3d61 6374 6976 6174 696f 6e5f  ense=activation_
-00007680: 6465 6e73 652c 206d 6f64 656c 5f72 6567  dense, model_reg
-00007690: 3d6d 6f64 656c 5f72 6567 2c20 0a20 2020  =model_reg, .   
-000076a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076b0: 2063 6f6e 765f 696e 6974 3d63 6f6e 765f   conv_init=conv_
-000076c0: 696e 6974 2c20 6465 6e73 655f 696e 6974  init, dense_init
-000076d0: 3d64 656e 7365 5f69 6e69 742c 206f 7074  =dense_init, opt
-000076e0: 696d 697a 6572 3d6f 7074 696d 697a 6572  imizer=optimizer
-000076f0: 2c20 706f 6f6c 696e 675f 313d 706f 6f6c  , pooling_1=pool
-00007700: 696e 675f 312c 2070 6f6f 6c69 6e67 5f32  ing_1, pooling_2
-00007710: 3d70 6f6f 6c69 6e67 5f32 2c20 706f 6f6c  =pooling_2, pool
-00007720: 696e 675f 333d 706f 6f6c 696e 675f 332c  ing_3=pooling_3,
-00007730: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00007740: 2020 2020 2020 706f 6f6c 5f73 7472 6964        pool_strid
-00007750: 655f 313d 706f 6f6c 5f73 7472 6964 655f  e_1=pool_stride_
-00007760: 312c 2070 6f6f 6c5f 7369 7a65 5f32 3d70  1, pool_size_2=p
-00007770: 6f6f 6c5f 7369 7a65 5f32 2c20 706f 6f6c  ool_size_2, pool
-00007780: 5f73 7472 6964 655f 323d 706f 6f6c 5f73  _stride_2=pool_s
-00007790: 7472 6964 655f 322c 200a 2020 2020 2020  tride_2, .      
-000077a0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-000077b0: 6f6c 5f73 697a 655f 333d 706f 6f6c 5f73  ol_size_3=pool_s
-000077c0: 697a 655f 332c 2070 6f6f 6c5f 7374 7269  ize_3, pool_stri
-000077d0: 6465 5f33 3d70 6f6f 6c5f 7374 7269 6465  de_3=pool_stride
-000077e0: 5f33 2c20 6669 6c74 6572 5f31 3d66 696c  _3, filter_1=fil
-000077f0: 7465 725f 312c 2066 696c 7465 725f 7369  ter_1, filter_si
-00007800: 7a65 5f31 3d66 696c 7465 725f 7369 7a65  ze_1=filter_size
-00007810: 5f31 2c20 0a20 2020 2020 2020 2020 2020  _1, .           
-00007820: 2020 2020 2020 2020 2073 7472 6964 6573           strides
-00007830: 5f31 3d73 7472 6964 6573 5f31 2c20 6669  _1=strides_1, fi
-00007840: 6c74 6572 5f32 3d66 696c 7465 725f 322c  lter_2=filter_2,
-00007850: 2066 696c 7465 725f 7369 7a65 5f32 3d66   filter_size_2=f
-00007860: 696c 7465 725f 7369 7a65 5f32 2c20 7374  ilter_size_2, st
-00007870: 7269 6465 735f 323d 7374 7269 6465 735f  rides_2=strides_
-00007880: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
-00007890: 2020 2020 2020 2020 6669 6c74 6572 5f33          filter_3
-000078a0: 3d66 696c 7465 725f 332c 2066 696c 7465  =filter_3, filte
-000078b0: 725f 7369 7a65 5f33 3d66 696c 7465 725f  r_size_3=filter_
-000078c0: 7369 7a65 5f33 2c20 7374 7269 6465 735f  size_3, strides_
-000078d0: 333d 7374 7269 6465 735f 332c 2066 696c  3=strides_3, fil
-000078e0: 7465 725f 343d 6669 6c74 6572 5f34 2c20  ter_4=filter_4, 
-000078f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007900: 2020 2020 2066 696c 7465 725f 7369 7a65       filter_size
-00007910: 5f34 3d66 696c 7465 725f 7369 7a65 5f34  _4=filter_size_4
-00007920: 2c20 7374 7269 6465 735f 343d 7374 7269  , strides_4=stri
-00007930: 6465 735f 342c 2066 696c 7465 725f 353d  des_4, filter_5=
-00007940: 6669 6c74 6572 5f35 2c20 6669 6c74 6572  filter_5, filter
-00007950: 5f73 697a 655f 353d 6669 6c74 6572 5f73  _size_5=filter_s
-00007960: 697a 655f 352c 200a 2020 2020 2020 2020  ize_5, .        
-00007970: 2020 2020 2020 2020 2020 2020 7374 7269              stri
-00007980: 6465 735f 353d 7374 7269 6465 735f 352c  des_5=strides_5,
-00007990: 2064 656e 7365 5f6e 6575 726f 6e73 5f31   dense_neurons_1
-000079a0: 3d64 656e 7365 5f6e 6575 726f 6e73 5f31  =dense_neurons_1
-000079b0: 2c20 6465 6e73 655f 6e65 7572 6f6e 735f  , dense_neurons_
-000079c0: 323d 6465 6e73 655f 6e65 7572 6f6e 735f  2=dense_neurons_
-000079d0: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
-000079e0: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
-000079f0: 313d 6472 6f70 6f75 745f 312c 2064 726f  1=dropout_1, dro
-00007a00: 706f 7574 5f32 3d64 726f 706f 7574 5f32  pout_2=dropout_2
-00007a10: 2c20 736d 6f74 655f 7361 6d70 6c69 6e67  , smote_sampling
-00007a20: 3d73 656c 662e 736d 6f74 655f 7361 6d70  =self.smote_samp
-00007a30: 6c69 6e67 2c0a 2020 2020 2020 2020 2020  ling,.          
-00007a40: 2020 2020 2020 2020 2020 6561 726c 795f            early_
-00007a50: 7374 6f70 5f63 616c 6c62 6163 6b3d 6361  stop_callback=ca
-00007a60: 6c6c 6261 636b 732c 2063 6865 636b 706f  llbacks, checkpo
-00007a70: 696e 743d 4661 6c73 652c 2076 6572 626f  int=False, verbo
-00007a80: 7365 3d73 656c 662e 7665 7262 6f73 6529  se=self.verbose)
-00007a90: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00007aa0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00007ab0: 6c66 2e6f 7074 5f63 7620 6973 206e 6f74  lf.opt_cv is not
-00007ac0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007ad0: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
-00007ae0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00007af0: 7269 6e74 2827 2a2a 2a2a 2a2a 2a2a 2a2a  rint('**********
-00007b00: 2a20 2043 5620 2d20 3120 2a2a 2a2a 2a2a  *  CV - 1 ******
-00007b10: 2a2a 2a2a 2a27 290a 2020 2020 2020 2020  *****').        
-00007b20: 2020 2020 2020 2020 7072 696e 7428 290a          print().
-00007b30: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00007b40: 656c 662e 6f70 745f 6175 673a 0a20 2020  elf.opt_aug:.   
-00007b50: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00007b60: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-00007b70: 2020 2020 2070 7269 6e74 2827 3d3d 3d3d       print('====
-00007b80: 3d3d 3d20 496d 6167 6520 5061 7261 6d65  === Image Parame
-00007b90: 7465 7273 203d 3d3d 3d3d 3d27 290a 2020  ters ======').  
-00007ba0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00007bb0: 696e 7428 290a 2020 2020 2020 2020 2020  int().          
-00007bc0: 2020 2020 2020 7072 696e 7428 274e 756d        print('Num
-00007bd0: 2041 7567 6d65 6e74 6174 696f 6e73 203a   Augmentations :
-00007be0: 2027 2c20 6e75 6d5f 6175 6729 0a20 2020   ', num_aug).   
-00007bf0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00007c00: 6e74 2827 496d 6167 6520 5369 7a65 203a  nt('Image Size :
-00007c10: 2027 2c20 696d 6167 655f 7369 7a65 290a   ', image_size).
-00007c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c30: 7072 696e 7428 274d 6178 2050 6978 656c  print('Max Pixel
-00007c40: 2873 2920 3a20 272c 206d 6178 5f70 6978  (s) : ', max_pix
-00007c50: 290a 0a20 2020 2020 2020 2020 2020 206d  )..            m
-00007c60: 6f64 656c 2c20 6869 7374 6f72 7920 3d20  odel, history = 
-00007c70: 636e 6e5f 6d6f 6465 6c2e 416c 6578 4e65  cnn_model.AlexNe
-00007c80: 7428 636c 6173 735f 312c 2063 6c61 7373  t(class_1, class
-00007c90: 5f32 2c20 696d 675f 6e75 6d5f 6368 616e  _2, img_num_chan
-00007ca0: 6e65 6c73 3d73 656c 662e 696d 675f 6e75  nels=self.img_nu
-00007cb0: 6d5f 6368 616e 6e65 6c73 2c20 6e6f 726d  m_channels, norm
-00007cc0: 616c 697a 653d 7365 6c66 2e6e 6f72 6d61  alize=self.norma
-00007cd0: 6c69 7a65 2c20 0a20 2020 2020 2020 2020  lize, .         
-00007ce0: 2020 2020 2020 206d 696e 5f70 6978 656c         min_pixel
-00007cf0: 3d6d 696e 5f70 6978 2c20 6d61 785f 7069  =min_pix, max_pi
-00007d00: 7865 6c3d 6d61 785f 7069 782c 2076 616c  xel=max_pix, val
-00007d10: 5f70 6f73 6974 6976 653d 7661 6c5f 636c  _positive=val_cl
-00007d20: 6173 735f 312c 2076 616c 5f6e 6567 6174  ass_1, val_negat
-00007d30: 6976 653d 7661 6c5f 636c 6173 735f 322c  ive=val_class_2,
-00007d40: 2065 706f 6368 733d 7365 6c66 2e74 7261   epochs=self.tra
-00007d50: 696e 5f65 706f 6368 732c 200a 2020 2020  in_epochs, .    
-00007d60: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-00007d70: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
-00007d80: 652c 206c 723d 6c72 2c20 6d6f 6d65 6e74  e, lr=lr, moment
-00007d90: 756d 3d6d 6f6d 656e 7475 6d2c 2064 6563  um=momentum, dec
-00007da0: 6179 3d64 6563 6179 2c20 6e65 7374 6572  ay=decay, nester
-00007db0: 6f76 3d6e 6573 7465 726f 762c 2065 6172  ov=nesterov, ear
-00007dc0: 6c79 5f73 746f 705f 6361 6c6c 6261 636b  ly_stop_callback
-00007dd0: 3d63 616c 6c62 6163 6b73 2c20 0a20 2020  =callbacks, .   
-00007de0: 2020 2020 2020 2020 2020 2020 2063 6865               che
-00007df0: 636b 706f 696e 743d 4661 6c73 652c 2076  ckpoint=False, v
-00007e00: 6572 626f 7365 3d73 656c 662e 7665 7262  erbose=self.verb
-00007e10: 6f73 652c 206f 7074 696d 697a 6572 3d6f  ose, optimizer=o
-00007e20: 7074 696d 697a 6572 2c20 736d 6f74 655f  ptimizer, smote_
-00007e30: 7361 6d70 6c69 6e67 3d73 656c 662e 736d  sampling=self.sm
-00007e40: 6f74 655f 7361 6d70 6c69 6e67 290a 0a20  ote_sampling).. 
-00007e50: 2020 2020 2020 2023 4966 2074 6865 2070         #If the p
-00007e60: 6174 6965 6e63 6520 6973 2072 6561 6368  atience is reach
-00007e70: 6564 2c20 7265 7475 726e 206e 616e 230a  ed, return nan#.
-00007e80: 2020 2020 2020 2020 6966 206c 656e 2868          if len(h
-00007e90: 6973 746f 7279 2e68 6973 746f 7279 5b27  istory.history['
-00007ea0: 6c6f 7373 275d 2920 213d 2073 656c 662e  loss']) != self.
-00007eb0: 7472 6169 6e5f 6570 6f63 6873 3a0a 2020  train_epochs:.  
-00007ec0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00007ed0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00007ee0: 696e 7428 2754 6865 2074 7269 616c 2077  int('The trial w
-00007ef0: 6173 2070 7275 6e65 6420 6f72 2074 6865  as pruned or the
-00007f00: 2074 7261 696e 696e 6720 7061 7469 656e   training patien
-00007f10: 6365 2077 6173 2072 6561 6368 6564 2e2e  ce was reached..
-00007f20: 2e27 2923 2c20 7265 7475 726e 696e 6720  .')#, returning 
-00007f30: 302e 3030 3120 7469 6d65 7320 7468 6520  0.001 times the 
-00007f40: 6e75 6d62 6572 206f 6620 636f 6d70 6c65  number of comple
-00007f50: 7465 6420 6570 6f63 6873 2e2e 2e27 290a  ted epochs...').
-00007f60: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00007f70: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00007f80: 7265 7475 726e 2028 6c65 6e28 6869 7374  return (len(hist
-00007f90: 6f72 792e 6869 7374 6f72 795b 276c 6f73  ory.history['los
-00007fa0: 7327 5d29 202a 2030 2e30 3031 2920 2d20  s']) * 0.001) - 
-00007fb0: 3939 392e 300a 0a20 2020 2020 2020 2023  999.0..        #
-00007fc0: 4966 2074 6865 2074 7261 696e 696e 6720  If the training 
-00007fd0: 6661 696c 7320 7265 7475 726e 204e 614e  fails return NaN
-00007fe0: 2072 6967 6874 2061 7761 7923 0a20 2020   right away#.   
-00007ff0: 2020 2020 2069 6620 6e70 2e69 7366 696e       if np.isfin
-00008000: 6974 6528 6869 7374 6f72 792e 6869 7374  ite(history.hist
-00008010: 6f72 795b 276c 6f73 7327 5d5b 2d31 5d29  ory['loss'][-1])
-00008020: 3a0a 2020 2020 2020 2020 2020 2020 2349  :.            #I
-00008030: 6620 7468 6520 7472 6169 6e20 6163 6320  f the train acc 
-00008040: 7468 7265 7368 6f6c 6420 6973 2073 6574  threshold is set
-00008050: 230a 2020 2020 2020 2020 2020 2020 6966  #.            if
-00008060: 2073 656c 662e 7472 6169 6e5f 6163 635f   self.train_acc_
-00008070: 7468 7265 7368 6f6c 6420 6973 206e 6f74  threshold is not
-00008080: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00008090: 2020 2020 2020 2069 6620 6869 7374 6f72         if histor
-000080a0: 792e 6869 7374 6f72 795b 2762 696e 6172  y.history['binar
-000080b0: 795f 6163 6375 7261 6379 275d 5b2d 315d  y_accuracy'][-1]
-000080c0: 203e 2073 656c 662e 7472 6169 6e5f 6163   > self.train_ac
-000080d0: 635f 7468 7265 7368 6f6c 643a 0a20 2020  c_threshold:.   
-000080e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080f0: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-00008100: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00008110: 6e74 2827 5468 6520 7472 6961 6c20 7761  nt('The trial wa
-00008120: 7320 7072 756e 6564 206f 7220 7468 6520  s pruned or the 
-00008130: 7472 6169 6e69 6e67 2070 6174 6965 6e63  training patienc
-00008140: 6520 7761 7320 7265 6163 6865 642e 2e2e  e was reached...
-00008150: 2729 232c 2072 6574 7572 6e69 6e67 2030  ')#, returning 0
-00008160: 2e30 3031 2074 696d 6573 2074 6865 206e  .001 times the n
-00008170: 756d 6265 7220 6f66 2063 6f6d 706c 6574  umber of complet
-00008180: 6564 2065 706f 6368 732e 2e2e 2729 0a20  ed epochs...'). 
-00008190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081a0: 2020 2070 7269 6e74 2829 0a20 2020 2020     print().     
-000081b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000081c0: 6574 7572 6e20 286c 656e 2868 6973 746f  eturn (len(histo
-000081d0: 7279 2e68 6973 746f 7279 5b27 6c6f 7373  ry.history['loss
-000081e0: 275d 2920 2a20 302e 3030 3129 202d 2039  ']) * 0.001) - 9
-000081f0: 3939 2e30 0a0a 2020 2020 2020 2020 2020  99.0..          
-00008200: 2020 6d6f 6465 6c73 2c20 6869 7374 6f72    models, histor
-00008210: 6965 7320 3d20 5b5d 2c20 5b5d 0a20 2020  ies = [], [].   
-00008220: 2020 2020 2020 2020 206d 6f64 656c 732e           models.
-00008230: 6170 7065 6e64 286d 6f64 656c 292c 2068  append(model), h
-00008240: 6973 746f 7269 6573 2e61 7070 656e 6428  istories.append(
-00008250: 6869 7374 6f72 7929 0a0a 2020 2020 2020  history)..      
-00008260: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00008270: 2020 2020 7072 696e 7428 2754 7261 696e      print('Train
-00008280: 696e 6720 6661 696c 6564 2064 7565 2074  ing failed due t
-00008290: 6f20 6e75 6d65 7269 6361 6c20 696e 7374  o numerical inst
-000082a0: 6162 696c 6974 792c 2072 6574 7572 6e69  ability, returni
-000082b0: 6e67 206e 616e 2e2e 2e27 290a 2020 2020  ng nan...').    
-000082c0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-000082d0: 702e 6e61 6e20 0a0a 2020 2020 2020 2020  p.nan ..        
-000082e0: 2323 2323 2320 4372 6f73 732d 5661 6c69  ##### Cross-Vali
-000082f0: 6461 7469 6f6e 2052 6f75 7469 6e65 202d  dation Routine -
-00008300: 2076 6572 7920 7370 6563 6966 6963 2069   very specific i
-00008310: 6d70 6c65 6d65 6e74 6174 696f 6e20 2323  mplementation ##
-00008320: 2323 230a 2020 2020 2020 2020 6966 2073  ###.        if s
-00008330: 656c 662e 6f70 745f 6376 2069 7320 6e6f  elf.opt_cv is no
-00008340: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00008350: 2020 2020 6966 2073 656c 662e 7661 6c5f      if self.val_
-00008360: 706f 7369 7469 7665 2069 7320 4e6f 6e65  positive is None
-00008370: 2061 6e64 2073 656c 662e 7661 6c5f 6e65   and self.val_ne
-00008380: 6761 7469 7665 2069 7320 6e6f 7420 4e6f  gative is not No
-00008390: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000083a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000083b0: 7272 6f72 2827 434e 4e20 6372 6f73 732d  rror('CNN cross-
-000083c0: 7661 6c69 6461 7469 6f6e 2069 7320 6375  validation is cu
-000083d0: 7272 656e 746c 7920 7375 7070 6f72 7465  rrently supporte
-000083e0: 6420 6f6e 6c79 2069 6620 7661 6c69 6461  d only if valida
-000083f0: 7469 6f6e 2064 6174 6120 6973 2069 6e70  tion data is inp
-00008400: 7574 2e27 290a 2020 2020 2020 2020 2020  ut.').          
-00008410: 2020 6966 2073 656c 662e 7661 6c5f 706f    if self.val_po
-00008420: 7369 7469 7665 2069 7320 6e6f 7420 4e6f  sitive is not No
-00008430: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00008440: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-00008450: 706f 7369 7469 7665 5f63 6c61 7373 2920  positive_class) 
-00008460: 2f20 6c65 6e28 7365 6c66 2e76 616c 5f70  / len(self.val_p
-00008470: 6f73 6974 6976 6529 203c 2073 656c 662e  ositive) < self.
-00008480: 6f70 745f 6376 2d31 3a0a 2020 2020 2020  opt_cv-1:.      
-00008490: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000084a0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-000084b0: 4361 6e6e 6f74 2070 6172 7469 7469 6f6e  Cannot partition
-000084c0: 2074 6865 2074 7261 696e 696e 672f 7661   the training/va
-000084d0: 6c69 6461 7469 6f6e 2064 6174 612c 2072  lidation data, r
-000084e0: 6566 6572 2074 6f20 7468 6520 4150 4920  efer to the API 
-000084f0: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
-00008500: 7220 696e 7374 7275 6374 696f 6e73 206f  r instructions o
-00008510: 6e20 686f 7720 746f 2075 7365 2074 6865  n how to use the
-00008520: 206f 7074 5f63 7620 7061 7261 6d65 7465   opt_cv paramete
-00008530: 722e 2729 0a20 2020 2020 2020 2020 2020  r.').           
-00008540: 2069 6620 7365 6c66 2e76 616c 5f6e 6567   if self.val_neg
-00008550: 6174 6976 6520 6973 206e 6f74 204e 6f6e  ative is not Non
-00008560: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00008570: 2020 2069 6620 6c65 6e28 7365 6c66 2e6e     if len(self.n
-00008580: 6567 6174 6976 655f 636c 6173 7329 202f  egative_class) /
-00008590: 206c 656e 2873 656c 662e 7661 6c5f 6e65   len(self.val_ne
-000085a0: 6761 7469 7665 2920 3c20 7365 6c66 2e6f  gative) < self.o
-000085b0: 7074 5f63 762d 313a 0a20 2020 2020 2020  pt_cv-1:.       
-000085c0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000085d0: 7365 2056 616c 7565 4572 726f 7228 2743  se ValueError('C
-000085e0: 616e 6e6f 7420 7061 7274 6974 696f 6e20  annot partition 
-000085f0: 7468 6520 7472 6169 6e69 6e67 2f76 616c  the training/val
-00008600: 6964 6174 696f 6e20 6461 7461 2c20 7265  idation data, re
-00008610: 6665 7220 746f 2074 6865 2041 5049 2064  fer to the API d
-00008620: 6f63 756d 656e 7461 7469 6f6e 2066 6f72  ocumentation for
-00008630: 2069 6e73 7472 7563 7469 6f6e 7320 6f6e   instructions on
-00008640: 2068 6f77 2074 6f20 7573 6520 7468 6520   how to use the 
-00008650: 6f70 745f 6376 2070 6172 616d 6574 6572  opt_cv parameter
-00008660: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-00008670: 0a20 2020 2020 2020 2020 2020 2023 5468  .            #Th
-00008680: 6520 6669 7273 7420 6d6f 6465 6c20 616c  e first model al
-00008690: 7265 6164 7920 7261 6e20 7468 6572 6566  ready ran theref
-000086a0: 6f72 6520 7375 7462 7261 6374 2031 2020  ore sutbract 1  
-000086b0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-000086c0: 2066 6f72 206b 2069 6e20 7261 6e67 6528   for k in range(
-000086d0: 7365 6c66 2e6f 7074 5f63 762d 3129 3a20  self.opt_cv-1): 
-000086e0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-000086f0: 2020 2020 2020 2020 2020 234d 616b 6520            #Make 
-00008700: 6465 6570 2063 6f70 6965 7320 746f 2061  deep copies to a
-00008710: 766f 6964 206f 7665 7277 7269 7469 6e67  void overwriting
-00008720: 2061 7272 6179 730a 2020 2020 2020 2020   arrays.        
-00008730: 2020 2020 2020 2020 636c 6173 735f 312c          class_1,
-00008740: 2063 6c61 7373 5f32 203d 2063 6f70 792e   class_2 = copy.
-00008750: 6465 6570 636f 7079 2873 656c 662e 706f  deepcopy(self.po
-00008760: 7369 7469 7665 5f63 6c61 7373 292c 2063  sitive_class), c
-00008770: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-00008780: 662e 6e65 6761 7469 7665 5f63 6c61 7373  f.negative_class
-00008790: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000087a0: 2020 7661 6c5f 636c 6173 735f 312c 2076    val_class_1, v
-000087b0: 616c 5f63 6c61 7373 5f32 203d 2063 6f70  al_class_2 = cop
-000087c0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-000087d0: 7661 6c5f 706f 7369 7469 7665 292c 2063  val_positive), c
-000087e0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-000087f0: 662e 7661 6c5f 6e65 6761 7469 7665 290a  f.val_negative).
-00008800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008810: 2023 536f 7274 2074 6865 206e 6577 2064   #Sort the new d
-00008820: 6174 6120 7361 6d70 6c65 732c 206e 6f20  ata samples, no 
-00008830: 7261 6e64 6f6d 2073 6875 6666 6c69 6e67  random shuffling
-00008840: 2c20 6a75 7374 2061 206c 696e 6561 7220  , just a linear 
-00008850: 7365 7175 656e 6365 0a20 2020 2020 2020  sequence.       
-00008860: 2020 2020 2020 2020 2069 6620 7661 6c5f           if val_
-00008870: 636c 6173 735f 3120 6973 206e 6f74 204e  class_1 is not N
-00008880: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00008890: 2020 2020 2020 2020 2076 616c 5f68 6f6c           val_hol
-000088a0: 645f 3120 3d20 636f 7079 2e64 6565 7063  d_1 = copy.deepc
-000088b0: 6f70 7928 636c 6173 735f 315b 6b2a 6c65  opy(class_1[k*le
-000088c0: 6e28 7661 6c5f 636c 6173 735f 3129 3a6c  n(val_class_1):l
-000088d0: 656e 2876 616c 5f63 6c61 7373 5f31 292a  en(val_class_1)*
-000088e0: 286b 2b31 295d 2920 2354 6865 206e 6577  (k+1)]) #The new
-000088f0: 2076 616c 6964 6174 696f 6e20 6461 7461   validation data
-00008900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008910: 2020 2020 2063 6c61 7373 5f31 5b6b 2a6c       class_1[k*l
-00008920: 656e 2876 616c 5f63 6c61 7373 5f31 293a  en(val_class_1):
-00008930: 6c65 6e28 7661 6c5f 636c 6173 735f 3129  len(val_class_1)
-00008940: 2a28 6b2b 3129 5d20 3d20 636f 7079 2e64  *(k+1)] = copy.d
-00008950: 6565 7063 6f70 7928 7661 6c5f 636c 6173  eepcopy(val_clas
-00008960: 735f 3129 0a20 2020 2020 2020 2020 2020  s_1).           
-00008970: 2020 2020 2020 2020 2076 616c 5f63 6c61           val_cla
-00008980: 7373 5f31 203d 2076 616c 5f68 6f6c 645f  ss_1 = val_hold_
-00008990: 3120 2354 6865 206e 6577 2076 616c 6964  1 #The new valid
-000089a0: 6174 696f 6e20 6461 7461 0a20 2020 2020  ation data.     
-000089b0: 2020 2020 2020 2020 2020 2069 6620 7661             if va
-000089c0: 6c5f 636c 6173 735f 3220 6973 206e 6f74  l_class_2 is not
-000089d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000089e0: 2020 2020 2020 2020 2020 2076 616c 5f68             val_h
-000089f0: 6f6c 645f 3220 3d20 636f 7079 2e64 6565  old_2 = copy.dee
-00008a00: 7063 6f70 7928 636c 6173 735f 325b 6b2a  pcopy(class_2[k*
-00008a10: 6c65 6e28 7661 6c5f 636c 6173 735f 3229  len(val_class_2)
-00008a20: 3a6c 656e 2876 616c 5f63 6c61 7373 5f32  :len(val_class_2
-00008a30: 292a 286b 2b31 295d 2920 2354 6865 206e  )*(k+1)]) #The n
-00008a40: 6577 2076 616c 6964 6174 696f 6e20 6461  ew validation da
-00008a50: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
-00008a60: 2020 2020 2020 2063 6c61 7373 5f32 5b6b         class_2[k
-00008a70: 2a6c 656e 2876 616c 5f63 6c61 7373 5f32  *len(val_class_2
-00008a80: 293a 6c65 6e28 7661 6c5f 636c 6173 735f  ):len(val_class_
-00008a90: 3229 2a28 6b2b 3129 5d20 3d20 636f 7079  2)*(k+1)] = copy
-00008aa0: 2e64 6565 7063 6f70 7928 7661 6c5f 636c  .deepcopy(val_cl
-00008ab0: 6173 735f 3229 0a20 2020 2020 2020 2020  ass_2).         
-00008ac0: 2020 2020 2020 2020 2020 2076 616c 5f63             val_c
-00008ad0: 6c61 7373 5f32 203d 2076 616c 5f68 6f6c  lass_2 = val_hol
-00008ae0: 645f 3220 2354 6865 206e 6577 2076 616c  d_2 #The new val
-00008af0: 6964 6174 696f 6e20 6461 7461 0a0a 2020  idation data..  
-00008b00: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00008b10: 2073 656c 662e 6f70 745f 6175 673a 0a20   self.opt_aug:. 
-00008b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b30: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
-00008b40: 756d 5f63 6861 6e6e 656c 7320 3d3d 2031  um_channels == 1
-00008b50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008b60: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
-00008b70: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
-00008b80: 616e 6e65 6c33 203d 2063 6f70 792e 6465  annel3 = copy.de
-00008b90: 6570 636f 7079 2863 6c61 7373 5f31 292c  epcopy(class_1),
-00008ba0: 204e 6f6e 652c 204e 6f6e 6520 0a20 2020   None, None .   
-00008bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008bc0: 2065 6c69 6620 7365 6c66 2e69 6d67 5f6e   elif self.img_n
-00008bd0: 756d 5f63 6861 6e6e 656c 7320 3d3d 2032  um_channels == 2
-00008be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008bf0: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
-00008c00: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
-00008c10: 616e 6e65 6c33 203d 2063 6f70 792e 6465  annel3 = copy.de
-00008c20: 6570 636f 7079 2863 6c61 7373 5f31 5b3a  epcopy(class_1[:
-00008c30: 2c3a 2c3a 2c30 5d29 2c20 636f 7079 2e64  ,:,:,0]), copy.d
-00008c40: 6565 7063 6f70 7928 636c 6173 735f 315b  eepcopy(class_1[
-00008c50: 3a2c 3a2c 3a2c 315d 292c 204e 6f6e 6520  :,:,:,1]), None 
-00008c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00008c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c90: 2020 2063 6861 6e6e 656c 312c 2063 6861     channel1, cha
-00008ca0: 6e6e 656c 322c 2063 6861 6e6e 656c 3320  nnel2, channel3 
-00008cb0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-00008cc0: 636c 6173 735f 315b 3a2c 3a2c 3a2c 305d  class_1[:,:,:,0]
-00008cd0: 292c 2063 6f70 792e 6465 6570 636f 7079  ), copy.deepcopy
-00008ce0: 2863 6c61 7373 5f31 5b3a 2c3a 2c3a 2c31  (class_1[:,:,:,1
-00008cf0: 5d29 2c20 636f 7079 2e64 6565 7063 6f70  ]), copy.deepcop
-00008d00: 7928 636c 6173 735f 315b 3a2c 3a2c 3a2c  y(class_1[:,:,:,
-00008d10: 325d 290a 2020 2020 2020 2020 2020 2020  2]).            
-00008d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008d30: 2020 2020 2061 7567 6d65 6e74 6564 5f69       augmented_i
-00008d40: 6d61 6765 7320 3d20 6175 676d 656e 7461  mages = augmenta
-00008d50: 7469 6f6e 2863 6861 6e6e 656c 313d 6368  tion(channel1=ch
-00008d60: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
-00008d70: 3d63 6861 6e6e 656c 322c 2063 6861 6e6e  =channel2, chann
-00008d80: 656c 333d 6368 616e 6e65 6c33 2c20 6261  el3=channel3, ba
-00008d90: 7463 683d 6e75 6d5f 6175 672c 200a 2020  tch=num_aug, .  
-00008da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008db0: 2020 2020 2020 7769 6474 685f 7368 6966        width_shif
-00008dc0: 743d 7365 6c66 2e73 6869 6674 2c20 6865  t=self.shift, he
-00008dd0: 6967 6874 5f73 6869 6674 3d73 656c 662e  ight_shift=self.
-00008de0: 7368 6966 742c 2068 6f72 697a 6f6e 7461  shift, horizonta
-00008df0: 6c3d 686f 7269 7a6f 6e74 616c 2c20 7665  l=horizontal, ve
-00008e00: 7274 6963 616c 3d76 6572 7469 6361 6c2c  rtical=vertical,
-00008e10: 2072 6f74 6174 696f 6e3d 726f 7461 7469   rotation=rotati
-00008e20: 6f6e 2c20 0a20 2020 2020 2020 2020 2020  on, .           
-00008e30: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-00008e40: 6765 5f73 697a 653d 696d 6167 655f 7369  ge_size=image_si
-00008e50: 7a65 2c20 6d61 736b 5f73 697a 653d 7365  ze, mask_size=se
-00008e60: 6c66 2e6d 6173 6b5f 7369 7a65 2c20 6e75  lf.mask_size, nu
-00008e70: 6d5f 6d61 736b 733d 7365 6c66 2e6e 756d  m_masks=self.num
-00008e80: 5f6d 6173 6b73 290a 0a20 2020 2020 2020  _masks)..       
-00008e90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00008ea0: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-00008eb0: 6e6e 656c 7320 3e20 313a 0a20 2020 2020  nnels > 1:.     
-00008ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ed0: 2020 2063 6c61 7373 5f31 3d5b 5d0a 2020     class_1=[].  
-00008ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ef0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-00008f00: 675f 6e75 6d5f 6368 616e 6e65 6c73 203d  g_num_channels =
-00008f10: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f30: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00008f40: 6c65 6e28 6175 676d 656e 7465 645f 696d  len(augmented_im
-00008f50: 6167 6573 5b30 5d29 293a 0a20 2020 2020  ages[0])):.     
-00008f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f70: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-00008f80: 5f31 2e61 7070 656e 6428 6461 7461 5f70  _1.append(data_p
-00008f90: 726f 6365 7373 696e 672e 636f 6e63 6174  rocessing.concat
-00008fa0: 5f63 6861 6e6e 656c 7328 6175 676d 656e  _channels(augmen
-00008fb0: 7465 645f 696d 6167 6573 5b30 5d5b 695d  ted_images[0][i]
-00008fc0: 2c20 6175 676d 656e 7465 645f 696d 6167  , augmented_imag
-00008fd0: 6573 5b31 5d5b 695d 2929 0a20 2020 2020  es[1][i])).     
-00008fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ff0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00009000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009010: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00009020: 6e67 6528 6c65 6e28 6175 676d 656e 7465  nge(len(augmente
-00009030: 645f 696d 6167 6573 5b30 5d29 293a 0a20  d_images[0])):. 
-00009040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009050: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00009060: 6c61 7373 5f31 2e61 7070 656e 6428 6461  lass_1.append(da
-00009070: 7461 5f70 726f 6365 7373 696e 672e 636f  ta_processing.co
-00009080: 6e63 6174 5f63 6861 6e6e 656c 7328 6175  ncat_channels(au
-00009090: 676d 656e 7465 645f 696d 6167 6573 5b30  gmented_images[0
-000090a0: 5d5b 695d 2c20 6175 676d 656e 7465 645f  ][i], augmented_
-000090b0: 696d 6167 6573 5b31 5d5b 695d 2c20 6175  images[1][i], au
-000090c0: 676d 656e 7465 645f 696d 6167 6573 5b32  gmented_images[2
-000090d0: 5d5b 695d 2929 0a20 2020 2020 2020 2020  ][i])).         
-000090e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000090f0: 6c61 7373 5f31 203d 206e 702e 6172 7261  lass_1 = np.arra
-00009100: 7928 636c 6173 735f 3129 0a20 2020 2020  y(class_1).     
-00009110: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00009120: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00009130: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
-00009140: 7373 5f31 203d 2061 7567 6d65 6e74 6564  ss_1 = augmented
-00009150: 5f69 6d61 6765 730a 0a20 2020 2020 2020  _images..       
-00009160: 2020 2020 2020 2020 2020 2020 2023 5065               #Pe
-00009170: 7266 6f72 6d20 7361 6d65 2061 7567 6d65  rform same augme
-00009180: 6e74 6174 696f 6e20 7465 6368 6e69 7175  ntation techniqu
-00009190: 6573 206f 6e20 6e65 6761 7469 7665 2063  es on negative c
-000091a0: 6c61 7373 2064 6174 612c 2062 6174 6368  lass data, batch
-000091b0: 3d31 0a20 2020 2020 2020 2020 2020 2020  =1.             
-000091c0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-000091d0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
-000091e0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-000091f0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00009200: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
-00009210: 2c20 6368 616e 6e65 6c33 203d 2063 6f70  , channel3 = cop
-00009220: 792e 6465 6570 636f 7079 2863 6c61 7373  y.deepcopy(class
-00009230: 5f32 292c 204e 6f6e 652c 204e 6f6e 6520  _2), None, None 
-00009240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009250: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
-00009260: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
-00009270: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
-00009280: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00009290: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
-000092a0: 2c20 6368 616e 6e65 6c33 203d 2063 6f70  , channel3 = cop
-000092b0: 792e 6465 6570 636f 7079 2863 6c61 7373  y.deepcopy(class
-000092c0: 5f32 5b3a 2c3a 2c3a 2c30 5d29 2c20 636f  _2[:,:,:,0]), co
-000092d0: 7079 2e64 6565 7063 6f70 7928 636c 6173  py.deepcopy(clas
-000092e0: 735f 325b 3a2c 3a2c 3a2c 315d 292c 204e  s_2[:,:,:,1]), N
-000092f0: 6f6e 6520 0a20 2020 2020 2020 2020 2020  one .           
-00009300: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-00009310: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
-00009320: 656c 7320 3d3d 2033 3a0a 2020 2020 2020  els == 3:.      
-00009330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009340: 2020 6368 616e 6e65 6c31 2c20 6368 616e    channel1, chan
-00009350: 6e65 6c32 2c20 6368 616e 6e65 6c33 203d  nel2, channel3 =
-00009360: 2063 6f70 792e 6465 6570 636f 7079 2863   copy.deepcopy(c
-00009370: 6c61 7373 5f32 5b3a 2c3a 2c3a 2c30 5d29  lass_2[:,:,:,0])
-00009380: 2c20 636f 7079 2e64 6565 7063 6f70 7928  , copy.deepcopy(
-00009390: 636c 6173 735f 325b 3a2c 3a2c 3a2c 315d  class_2[:,:,:,1]
-000093a0: 292c 2063 6f70 792e 6465 6570 636f 7079  ), copy.deepcopy
-000093b0: 2863 6c61 7373 5f32 5b3a 2c3a 2c3a 2c32  (class_2[:,:,:,2
-000093c0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-000093d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000093e0: 2020 2020 2020 2020 2020 2020 6175 676d              augm
-000093f0: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
-00009400: 6174 6976 6520 3d20 6175 676d 656e 7461  ative = augmenta
-00009410: 7469 6f6e 2863 6861 6e6e 656c 313d 6368  tion(channel1=ch
-00009420: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
-00009430: 3d63 6861 6e6e 656c 322c 2063 6861 6e6e  =channel2, chann
-00009440: 656c 333d 6368 616e 6e65 6c33 2c20 6261  el3=channel3, ba
-00009450: 7463 683d 312c 200a 2020 2020 2020 2020  tch=1, .        
-00009460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009470: 7769 6474 685f 7368 6966 743d 7365 6c66  width_shift=self
-00009480: 2e73 6869 6674 2c20 6865 6967 6874 5f73  .shift, height_s
-00009490: 6869 6674 3d73 656c 662e 7368 6966 742c  hift=self.shift,
-000094a0: 2068 6f72 697a 6f6e 7461 6c3d 686f 7269   horizontal=hori
-000094b0: 7a6f 6e74 616c 2c20 7665 7274 6963 616c  zontal, vertical
-000094c0: 3d76 6572 7469 6361 6c2c 2072 6f74 6174  =vertical, rotat
-000094d0: 696f 6e3d 726f 7461 7469 6f6e 2c20 0a20  ion=rotation, . 
-000094e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094f0: 2020 2020 2020 2069 6d61 6765 5f73 697a         image_siz
-00009500: 653d 696d 6167 655f 7369 7a65 2c20 6d61  e=image_size, ma
-00009510: 736b 5f73 697a 653d 7365 6c66 2e6d 6173  sk_size=self.mas
-00009520: 6b5f 7369 7a65 2c20 6e75 6d5f 6d61 736b  k_size, num_mask
-00009530: 733d 7365 6c66 2e6e 756d 5f6d 6173 6b73  s=self.num_masks
-00009540: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00009550: 2020 2020 2020 2023 5468 6520 6175 676d         #The augm
-00009560: 656e 7461 7469 6f6e 2072 6f75 7469 6e65  entation routine
-00009570: 2072 6574 7572 6e73 2061 6e20 6f75 7470   returns an outp
-00009580: 7574 2066 6f72 2065 6163 6820 6669 6c74  ut for each filt
-00009590: 6572 2c20 652e 672e 2033 206f 7574 7075  er, e.g. 3 outpu
-000095a0: 7473 2066 6f72 2052 4742 0a20 2020 2020  ts for RGB.     
-000095b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000095c0: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
-000095d0: 6861 6e6e 656c 7320 3e20 313a 0a20 2020  hannels > 1:.   
-000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095f0: 2020 2020 2063 6c61 7373 5f32 3d5b 5d0a       class_2=[].
-00009600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009610: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00009620: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
-00009630: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
-00009640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009650: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00009660: 6528 6c65 6e28 6175 676d 656e 7465 645f  e(len(augmented_
-00009670: 696d 6167 6573 5f6e 6567 6174 6976 655b  images_negative[
-00009680: 305d 2929 3a0a 2020 2020 2020 2020 2020  0])):.          
-00009690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096a0: 2020 2020 2020 636c 6173 735f 322e 6170        class_2.ap
-000096b0: 7065 6e64 2864 6174 615f 7072 6f63 6573  pend(data_proces
-000096c0: 7369 6e67 2e63 6f6e 6361 745f 6368 616e  sing.concat_chan
-000096d0: 6e65 6c73 2861 7567 6d65 6e74 6564 5f69  nels(augmented_i
-000096e0: 6d61 6765 735f 6e65 6761 7469 7665 5b30  mages_negative[0
-000096f0: 5d5b 695d 2c20 6175 676d 656e 7465 645f  ][i], augmented_
-00009700: 696d 6167 6573 5f6e 6567 6174 6976 655b  images_negative[
-00009710: 315d 5b69 5d29 290a 2020 2020 2020 2020  1][i])).        
-00009720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009730: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00009740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009750: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00009760: 286c 656e 2861 7567 6d65 6e74 6564 5f69  (len(augmented_i
-00009770: 6d61 6765 735f 6e65 6761 7469 7665 5b30  mages_negative[0
-00009780: 5d29 293a 0a20 2020 2020 2020 2020 2020  ])):.           
-00009790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097a0: 2020 2020 2063 6c61 7373 5f32 2e61 7070       class_2.app
-000097b0: 656e 6428 6461 7461 5f70 726f 6365 7373  end(data_process
-000097c0: 696e 672e 636f 6e63 6174 5f63 6861 6e6e  ing.concat_chann
-000097d0: 656c 7328 6175 676d 656e 7465 645f 696d  els(augmented_im
-000097e0: 6167 6573 5f6e 6567 6174 6976 655b 305d  ages_negative[0]
-000097f0: 5b69 5d2c 2061 7567 6d65 6e74 6564 5f69  [i], augmented_i
-00009800: 6d61 6765 735f 6e65 6761 7469 7665 5b31  mages_negative[1
-00009810: 5d5b 695d 2c20 6175 676d 656e 7465 645f  ][i], augmented_
-00009820: 696d 6167 6573 5f6e 6567 6174 6976 655b  images_negative[
-00009830: 325d 5b69 5d29 290a 2020 2020 2020 2020  2][i])).        
-00009840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009850: 636c 6173 735f 3220 3d20 6e70 2e61 7272  class_2 = np.arr
-00009860: 6179 2863 6c61 7373 5f32 290a 2020 2020  ay(class_2).    
-00009870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009880: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00009890: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-000098a0: 6173 735f 3220 3d20 6175 676d 656e 7465  ass_2 = augmente
-000098b0: 645f 696d 6167 6573 5f6e 6567 6174 6976  d_images_negativ
-000098c0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-000098d0: 2020 2020 2020 2023 4261 6c61 6e63 6520         #Balance 
-000098e0: 7468 6520 636c 6173 7320 7369 7a65 730a  the class sizes.
-000098f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009900: 2020 2020 6966 2073 656c 662e 6261 6c61      if self.bala
-00009910: 6e63 653a 0a20 2020 2020 2020 2020 2020  nce:.           
-00009920: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
-00009930: 7373 5f32 203d 2063 6c61 7373 5f32 5b3a  ss_2 = class_2[:
-00009940: 6c65 6e28 636c 6173 735f 3129 5d20 2020  len(class_1)]   
-00009950: 2020 0a0a 2020 2020 2020 2020 2020 2020    ..            
-00009960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00009970: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
-00009980: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00009990: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000099a0: 6c61 7373 5f32 203d 2072 6573 697a 6528  lass_2 = resize(
-000099b0: 636c 6173 735f 322c 2073 697a 653d 696d  class_2, size=im
-000099c0: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
-000099d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000099e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000099f0: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-00009a00: 6e65 6c31 203d 2072 6573 697a 6528 636c  nel1 = resize(cl
-00009a10: 6173 735f 325b 3a2c 3a2c 3a2c 305d 2c20  ass_2[:,:,:,0], 
-00009a20: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
-00009a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009a40: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
-00009a50: 3220 3d20 7265 7369 7a65 2863 6c61 7373  2 = resize(class
-00009a60: 5f32 5b3a 2c3a 2c3a 2c31 5d2c 2073 697a  _2[:,:,:,1], siz
-00009a70: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
-00009a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a90: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-00009aa0: 675f 6e75 6d5f 6368 616e 6e65 6c73 203d  g_num_channels =
-00009ab0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-00009ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ad0: 2063 6c61 7373 5f32 203d 2064 6174 615f   class_2 = data_
-00009ae0: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
-00009af0: 745f 6368 616e 6e65 6c73 2863 6861 6e6e  t_channels(chann
-00009b00: 656c 312c 2063 6861 6e6e 656c 3229 0a20  el1, channel2). 
-00009b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b40: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
-00009b50: 3320 3d20 7265 7369 7a65 2863 6c61 7373  3 = resize(class
-00009b60: 5f32 5b3a 2c3a 2c3a 2c32 5d2c 2073 697a  _2[:,:,:,2], siz
-00009b70: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
-00009b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b90: 2020 2020 2020 2020 2020 636c 6173 735f            class_
-00009ba0: 3220 3d20 6461 7461 5f70 726f 6365 7373  2 = data_process
-00009bb0: 696e 672e 636f 6e63 6174 5f63 6861 6e6e  ing.concat_chann
-00009bc0: 656c 7328 6368 616e 6e65 6c31 2c20 6368  els(channel1, ch
-00009bd0: 616e 6e65 6c32 2c20 6368 616e 6e65 6c33  annel2, channel3
-00009be0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00009bf0: 2020 2020 2020 2069 6620 7661 6c5f 636c         if val_cl
-00009c00: 6173 735f 3120 6973 206e 6f74 204e 6f6e  ass_1 is not Non
-00009c10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00009c20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00009c30: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
-00009c40: 656c 7320 3d3d 2031 3a0a 2020 2020 2020  els == 1:.      
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 2020 2020 2020 7661 6c5f 636c 6173 735f        val_class_
-00009c70: 3120 3d20 7265 7369 7a65 2876 616c 5f63  1 = resize(val_c
-00009c80: 6c61 7373 5f31 2c20 7369 7a65 3d69 6d61  lass_1, size=ima
-00009c90: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
-00009ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cb0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cd0: 2020 2076 616c 5f63 6861 6e6e 656c 3120     val_channel1 
-00009ce0: 3d20 7265 7369 7a65 2876 616c 5f63 6c61  = resize(val_cla
-00009cf0: 7373 5f31 5b3a 2c3a 2c3a 2c30 5d2c 2073  ss_1[:,:,:,0], s
-00009d00: 697a 653d 696d 6167 655f 7369 7a65 290a  ize=image_size).
-00009d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d20: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
-00009d30: 6368 616e 6e65 6c32 203d 2072 6573 697a  channel2 = resiz
-00009d40: 6528 7661 6c5f 636c 6173 735f 315b 3a2c  e(val_class_1[:,
-00009d50: 3a2c 3a2c 315d 2c20 7369 7a65 3d69 6d61  :,:,1], size=ima
-00009d60: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
+00005510: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00005520: 286c 656e 2861 7567 6d65 6e74 6564 5f69  (len(augmented_i
+00005530: 6d61 6765 735b 305d 2929 3a0a 2020 2020  mages[0])):.    
+00005540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005550: 2020 2020 636c 6173 735f 312e 6170 7065      class_1.appe
+00005560: 6e64 2864 6174 615f 7072 6f63 6573 7369  nd(data_processi
+00005570: 6e67 2e63 6f6e 6361 745f 6368 616e 6e65  ng.concat_channe
+00005580: 6c73 2861 7567 6d65 6e74 6564 5f69 6d61  ls(augmented_ima
+00005590: 6765 735b 305d 5b69 5d2c 2061 7567 6d65  ges[0][i], augme
+000055a0: 6e74 6564 5f69 6d61 6765 735b 315d 5b69  nted_images[1][i
+000055b0: 5d2c 2061 7567 6d65 6e74 6564 5f69 6d61  ], augmented_ima
+000055c0: 6765 735b 325d 5b69 5d29 290a 2020 2020  ges[2][i])).    
+000055d0: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+000055e0: 735f 3120 3d20 6e70 2e61 7272 6179 2863  s_1 = np.array(c
+000055f0: 6c61 7373 5f31 290a 2020 2020 2020 2020  lass_1).        
+00005600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00005610: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+00005620: 3120 3d20 6175 676d 656e 7465 645f 696d  1 = augmented_im
+00005630: 6167 6573 0a0a 2020 2020 2020 2020 2020  ages..          
+00005640: 2020 2350 6572 666f 726d 2073 616d 6520    #Perform same 
+00005650: 6175 676d 656e 7461 7469 6f6e 2074 6563  augmentation tec
+00005660: 686e 6971 7565 7320 6f6e 206e 6567 6174  hniques on negat
+00005670: 6976 6520 636c 6173 7320 6461 7461 2066  ive class data f
+00005680: 6f72 2062 616c 616e 6365 2062 7574 2075  or balance but u
+00005690: 7365 2062 6174 6368 3d62 6174 6368 5f6f  se batch=batch_o
+000056a0: 7468 6572 2c20 6e75 6d5f 696d 6167 6573  ther, num_images
+000056b0: 5f74 6f5f 626c 656e 643d 7365 6c66 2e6e  _to_blend=self.n
+000056c0: 756d 5f69 6d61 6765 735f 746f 5f62 6c65  um_images_to_ble
+000056d0: 6e64 200a 2020 2020 2020 2020 2020 2020  nd .            
+000056e0: 2354 6869 7320 6973 2064 6f6e 6520 736f  #This is done so
+000056f0: 2074 6861 7420 7468 6520 7472 6169 6e69   that the traini
+00005700: 6e67 2064 6174 6120 616c 736f 2069 6e63  ng data also inc
+00005710: 6c75 6465 7320 7468 6520 7361 6d65 2061  ludes the same a
+00005720: 7567 6d65 6e74 6174 696f 6e20 7465 6368  ugmentation tech
+00005730: 6e69 7175 6573 2c20 6966 2063 6f6e 6669  niques, if confi
+00005740: 6775 7265 642e 0a20 2020 2020 2020 2020  gured..         
+00005750: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
+00005760: 756d 5f63 6861 6e6e 656c 7320 3d3d 2031  um_channels == 1
+00005770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005780: 2020 6368 616e 6e65 6c31 2c20 6368 616e    channel1, chan
+00005790: 6e65 6c32 2c20 6368 616e 6e65 6c33 203d  nel2, channel3 =
+000057a0: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
+000057b0: 656c 662e 6e65 6761 7469 7665 5f63 6c61  elf.negative_cla
+000057c0: 7373 292c 204e 6f6e 652c 204e 6f6e 6520  ss), None, None 
+000057d0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000057e0: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
+000057f0: 6861 6e6e 656c 7320 3d3d 2032 3a0a 2020  hannels == 2:.  
+00005800: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00005810: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
+00005820: 2c20 6368 616e 6e65 6c33 203d 2063 6f70  , channel3 = cop
+00005830: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+00005840: 6e65 6761 7469 7665 5f63 6c61 7373 5b3a  negative_class[:
+00005850: 2c3a 2c3a 2c30 5d29 2c20 636f 7079 2e64  ,:,:,0]), copy.d
+00005860: 6565 7063 6f70 7928 7365 6c66 2e6e 6567  eepcopy(self.neg
+00005870: 6174 6976 655f 636c 6173 735b 3a2c 3a2c  ative_class[:,:,
+00005880: 3a2c 315d 292c 204e 6f6e 6520 0a20 2020  :,1]), None .   
+00005890: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
+000058a0: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+000058b0: 656c 7320 3d3d 2033 3a0a 2020 2020 2020  els == 3:.      
+000058c0: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
+000058d0: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
+000058e0: 616e 6e65 6c33 203d 2063 6f70 792e 6465  annel3 = copy.de
+000058f0: 6570 636f 7079 2873 656c 662e 6e65 6761  epcopy(self.nega
+00005900: 7469 7665 5f63 6c61 7373 5b3a 2c3a 2c3a  tive_class[:,:,:
+00005910: 2c30 5d29 2c20 636f 7079 2e64 6565 7063  ,0]), copy.deepc
+00005920: 6f70 7928 7365 6c66 2e6e 6567 6174 6976  opy(self.negativ
+00005930: 655f 636c 6173 735b 3a2c 3a2c 3a2c 315d  e_class[:,:,:,1]
+00005940: 292c 2063 6f70 792e 6465 6570 636f 7079  ), copy.deepcopy
+00005950: 2873 656c 662e 6e65 6761 7469 7665 5f63  (self.negative_c
+00005960: 6c61 7373 5b3a 2c3a 2c3a 2c32 5d29 0a20  lass[:,:,:,2]). 
+00005970: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00005980: 2020 2020 2020 2020 6175 676d 656e 7465          augmente
+00005990: 645f 696d 6167 6573 5f6e 6567 6174 6976  d_images_negativ
+000059a0: 6520 3d20 6175 676d 656e 7461 7469 6f6e  e = augmentation
+000059b0: 2863 6861 6e6e 656c 313d 6368 616e 6e65  (channel1=channe
+000059c0: 6c31 2c20 6368 616e 6e65 6c32 3d63 6861  l1, channel2=cha
+000059d0: 6e6e 656c 322c 2063 6861 6e6e 656c 333d  nnel2, channel3=
+000059e0: 6368 616e 6e65 6c33 2c20 6261 7463 683d  channel3, batch=
+000059f0: 7365 6c66 2e62 6174 6368 5f6f 7468 6572  self.batch_other
+00005a00: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00005a10: 2020 2077 6964 7468 5f73 6869 6674 3d73     width_shift=s
+00005a20: 656c 662e 7368 6966 742c 2068 6569 6768  elf.shift, heigh
+00005a30: 745f 7368 6966 743d 7365 6c66 2e73 6869  t_shift=self.shi
+00005a40: 6674 2c20 686f 7269 7a6f 6e74 616c 3d68  ft, horizontal=h
+00005a50: 6f72 697a 6f6e 7461 6c2c 2076 6572 7469  orizontal, verti
+00005a60: 6361 6c3d 7665 7274 6963 616c 2c20 726f  cal=vertical, ro
+00005a70: 7461 7469 6f6e 3d72 6f74 6174 696f 6e2c  tation=rotation,
+00005a80: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00005a90: 2020 696d 6167 655f 7369 7a65 3d69 6d61    image_size=ima
+00005aa0: 6765 5f73 697a 652c 206d 6173 6b5f 7369  ge_size, mask_si
+00005ab0: 7a65 3d6d 6173 6b5f 7369 7a65 2c20 6e75  ze=mask_size, nu
+00005ac0: 6d5f 6d61 736b 733d 6e75 6d5f 6d61 736b  m_masks=num_mask
+00005ad0: 732c 2062 6c65 6e64 5f6d 756c 7469 706c  s, blend_multipl
+00005ae0: 6965 723d 7365 6c66 2e62 6c65 6e64 5f6f  ier=self.blend_o
+00005af0: 7468 6572 2c20 0a20 2020 2020 2020 2020  ther, .         
+00005b00: 2020 2020 2020 2062 6c65 6e64 696e 675f         blending_
+00005b10: 6675 6e63 3d73 656c 662e 626c 656e 6469  func=self.blendi
+00005b20: 6e67 5f66 756e 632c 206e 756d 5f69 6d61  ng_func, num_ima
+00005b30: 6765 735f 746f 5f62 6c65 6e64 3d73 656c  ges_to_blend=sel
+00005b40: 662e 6e75 6d5f 696d 6167 6573 5f74 6f5f  f.num_images_to_
+00005b50: 626c 656e 642c 207a 6f6f 6d5f 7261 6e67  blend, zoom_rang
+00005b60: 653d 7365 6c66 2e7a 6f6f 6d5f 7261 6e67  e=self.zoom_rang
+00005b70: 652c 2073 6b65 775f 616e 676c 653d 736b  e, skew_angle=sk
+00005b80: 6577 5f61 6e67 6c65 290a 0a20 2020 2020  ew_angle)..     
+00005b90: 2020 2020 2020 2023 5468 6520 6175 676d         #The augm
+00005ba0: 656e 7461 7469 6f6e 2072 6f75 7469 6e65  entation routine
+00005bb0: 2072 6574 7572 6e73 2061 6e20 6f75 7470   returns an outp
+00005bc0: 7574 2066 6f72 2065 6163 6820 6669 6c74  ut for each filt
+00005bd0: 6572 2c20 652e 672e 2033 206f 7574 7075  er, e.g. 3 outpu
+00005be0: 7473 2066 6f72 2052 4742 0a20 2020 2020  ts for RGB.     
+00005bf0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00005c00: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
+00005c10: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+00005c20: 2020 2020 2063 6c61 7373 5f32 3d5b 5d0a       class_2=[].
+00005c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c40: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+00005c50: 6368 616e 6e65 6c73 203d 3d20 323a 0a20  channels == 2:. 
+00005c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c70: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00005c80: 6528 6c65 6e28 6175 676d 656e 7465 645f  e(len(augmented_
+00005c90: 696d 6167 6573 5f6e 6567 6174 6976 655b  images_negative[
+00005ca0: 305d 2929 3a0a 2020 2020 2020 2020 2020  0])):.          
+00005cb0: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00005cc0: 6173 735f 322e 6170 7065 6e64 2864 6174  ass_2.append(dat
+00005cd0: 615f 7072 6f63 6573 7369 6e67 2e63 6f6e  a_processing.con
+00005ce0: 6361 745f 6368 616e 6e65 6c73 2861 7567  cat_channels(aug
+00005cf0: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
+00005d00: 6761 7469 7665 5b30 5d5b 695d 2c20 6175  gative[0][i], au
+00005d10: 676d 656e 7465 645f 696d 6167 6573 5f6e  gmented_images_n
+00005d20: 6567 6174 6976 655b 315d 5b69 5d29 290a  egative[1][i])).
+00005d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005d50: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+00005d60: 696e 2072 616e 6765 286c 656e 2861 7567  in range(len(aug
+00005d70: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
+00005d80: 6761 7469 7665 5b30 5d29 293a 0a20 2020  gative[0])):.   
+00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005da0: 2020 2020 2063 6c61 7373 5f32 2e61 7070       class_2.app
+00005db0: 656e 6428 6461 7461 5f70 726f 6365 7373  end(data_process
+00005dc0: 696e 672e 636f 6e63 6174 5f63 6861 6e6e  ing.concat_chann
+00005dd0: 656c 7328 6175 676d 656e 7465 645f 696d  els(augmented_im
+00005de0: 6167 6573 5f6e 6567 6174 6976 655b 305d  ages_negative[0]
+00005df0: 5b69 5d2c 2061 7567 6d65 6e74 6564 5f69  [i], augmented_i
+00005e00: 6d61 6765 735f 6e65 6761 7469 7665 5b31  mages_negative[1
+00005e10: 5d5b 695d 2c20 6175 676d 656e 7465 645f  ][i], augmented_
+00005e20: 696d 6167 6573 5f6e 6567 6174 6976 655b  images_negative[
+00005e30: 325d 5b69 5d29 290a 2020 2020 2020 2020  2][i])).        
+00005e40: 2020 2020 2020 2020 636c 6173 735f 3220          class_2 
+00005e50: 3d20 6e70 2e61 7272 6179 2863 6c61 7373  = np.array(class
+00005e60: 5f32 290a 2020 2020 2020 2020 2020 2020  _2).            
+00005e70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005e80: 2020 2020 2020 636c 6173 735f 3220 3d20        class_2 = 
+00005e90: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
+00005ea0: 5f6e 6567 6174 6976 650a 0a20 2020 2020  _negative..     
+00005eb0: 2020 2020 2020 2023 4261 6c61 6e63 6520         #Balance 
+00005ec0: 7468 6520 636c 6173 7320 7369 7a65 7320  the class sizes 
+00005ed0: 6966 206e 6563 6573 7361 7279 0a20 2020  if necessary.   
+00005ee0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00005ef0: 2e62 616c 616e 6365 3a0a 2020 2020 2020  .balance:.      
+00005f00: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00005f10: 662e 6261 7463 685f 6f74 6865 7220 3e20  f.batch_other > 
+00005f20: 313a 2023 4d75 7374 2073 6875 6666 6c65  1: #Must shuffle
+00005f30: 2061 7320 7468 6520 6175 676d 656e 7461   as the augmenta
+00005f40: 7469 6f6e 7320 7765 7265 2073 7461 636b  tions were stack
+00005f50: 6564 2073 6571 7565 6e74 6961 6c6c 7921  ed sequentially!
+00005f60: 2121 0a20 2020 2020 2020 2020 2020 2020  !!.             
+00005f70: 2020 2020 2020 2069 7820 3d20 6e70 2e72         ix = np.r
+00005f80: 616e 646f 6d2e 7065 726d 7574 6174 696f  andom.permutatio
+00005f90: 6e28 6c65 6e28 636c 6173 735f 3229 290a  n(len(class_2)).
+00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fb0: 2020 2020 636c 6173 735f 3220 3d20 636c      class_2 = cl
+00005fc0: 6173 735f 325b 6978 5d0a 2020 2020 2020  ass_2[ix].      
+00005fd0: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+00005fe0: 3220 3d20 636c 6173 735f 325b 3a6c 656e  2 = class_2[:len
+00005ff0: 2863 6c61 7373 5f31 295d 0a20 2020 2020  (class_1)].     
+00006000: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00006010: 2020 2020 2352 6573 697a 6520 6966 206e      #Resize if n
+00006020: 6563 6573 7361 7279 2061 6e64 2063 6f6e  ecessary and con
+00006030: 6361 7420 7468 6520 6368 616e 6e65 6c73  cat the channels
+00006040: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00006050: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
+00006060: 6e6e 656c 7320 3d3d 2031 3a0a 2020 2020  nnels == 1:.    
+00006070: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+00006080: 735f 3220 3d20 7265 7369 7a65 2863 6c61  s_2 = resize(cla
+00006090: 7373 5f32 2c20 7369 7a65 3d69 6d61 6765  ss_2, size=image
+000060a0: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
+000060b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000060c0: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
+000060d0: 3120 3d20 7265 7369 7a65 2863 6c61 7373  1 = resize(class
+000060e0: 5f32 5b3a 2c3a 2c3a 2c30 5d2c 2073 697a  _2[:,:,:,0], siz
+000060f0: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
+00006100: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00006110: 616e 6e65 6c32 203d 2072 6573 697a 6528  annel2 = resize(
+00006120: 636c 6173 735f 325b 3a2c 3a2c 3a2c 315d  class_2[:,:,:,1]
+00006130: 2c20 7369 7a65 3d69 6d61 6765 5f73 697a  , size=image_siz
+00006140: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00006150: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
+00006160: 756d 5f63 6861 6e6e 656c 7320 3d3d 2032  um_channels == 2
+00006170: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006180: 2020 2020 2020 636c 6173 735f 3220 3d20        class_2 = 
+00006190: 6461 7461 5f70 726f 6365 7373 696e 672e  data_processing.
+000061a0: 636f 6e63 6174 5f63 6861 6e6e 656c 7328  concat_channels(
+000061b0: 6368 616e 6e65 6c31 2c20 6368 616e 6e65  channel1, channe
+000061c0: 6c32 290a 2020 2020 2020 2020 2020 2020  l2).            
+000061d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000061e0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+000061f0: 616e 6e65 6c33 203d 2072 6573 697a 6528  annel3 = resize(
+00006200: 636c 6173 735f 325b 3a2c 3a2c 3a2c 325d  class_2[:,:,:,2]
+00006210: 2c20 7369 7a65 3d69 6d61 6765 5f73 697a  , size=image_siz
+00006220: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00006230: 2020 2020 2020 2063 6c61 7373 5f32 203d         class_2 =
+00006240: 2064 6174 615f 7072 6f63 6573 7369 6e67   data_processing
+00006250: 2e63 6f6e 6361 745f 6368 616e 6e65 6c73  .concat_channels
+00006260: 2863 6861 6e6e 656c 312c 2063 6861 6e6e  (channel1, chann
+00006270: 656c 322c 2063 6861 6e6e 656c 3329 0a0a  el2, channel3)..
+00006280: 2020 2020 2020 2020 2020 2020 234e 6565              #Nee
+00006290: 6420 746f 2061 6c73 6f20 6372 6f70 2074  d to also crop t
+000062a0: 6865 2076 616c 6964 6174 696f 6e20 696d  he validation im
+000062b0: 6167 6573 0a20 2020 2020 2020 2020 2020  ages.           
+000062c0: 2069 6620 7365 6c66 2e76 616c 5f70 6f73   if self.val_pos
+000062d0: 6974 6976 6520 6973 206e 6f74 204e 6f6e  itive is not Non
+000062e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000062f0: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
+00006300: 756d 5f63 6861 6e6e 656c 7320 3d3d 2031  um_channels == 1
+00006310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006320: 2020 2020 2020 7661 6c5f 636c 6173 735f        val_class_
+00006330: 3120 3d20 7265 7369 7a65 2873 656c 662e  1 = resize(self.
+00006340: 7661 6c5f 706f 7369 7469 7665 2c20 7369  val_positive, si
+00006350: 7a65 3d69 6d61 6765 5f73 697a 6529 0a20  ze=image_size). 
+00006360: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00006370: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00006380: 2020 2020 2020 2020 2076 616c 5f63 6861           val_cha
+00006390: 6e6e 656c 3120 3d20 7265 7369 7a65 2873  nnel1 = resize(s
+000063a0: 656c 662e 7661 6c5f 706f 7369 7469 7665  elf.val_positive
+000063b0: 5b3a 2c3a 2c3a 2c30 5d2c 2073 697a 653d  [:,:,:,0], size=
+000063c0: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 7661 6c5f 6368 616e 6e65 6c32 203d 2072  val_channel2 = r
+000063f0: 6573 697a 6528 7365 6c66 2e76 616c 5f70  esize(self.val_p
+00006400: 6f73 6974 6976 655b 3a2c 3a2c 3a2c 315d  ositive[:,:,:,1]
+00006410: 2c20 7369 7a65 3d69 6d61 6765 5f73 697a  , size=image_siz
+00006420: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00006430: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00006440: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
+00006450: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00006460: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00006470: 6c5f 636c 6173 735f 3120 3d20 6461 7461  l_class_1 = data
+00006480: 5f70 726f 6365 7373 696e 672e 636f 6e63  _processing.conc
+00006490: 6174 5f63 6861 6e6e 656c 7328 7661 6c5f  at_channels(val_
+000064a0: 6368 616e 6e65 6c31 2c20 7661 6c5f 6368  channel1, val_ch
+000064b0: 616e 6e65 6c32 290a 2020 2020 2020 2020  annel2).        
+000064c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000064d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000064e0: 2020 2020 2020 2020 2020 7661 6c5f 6368            val_ch
+000064f0: 616e 6e65 6c33 203d 2072 6573 697a 6528  annel3 = resize(
+00006500: 7365 6c66 2e76 616c 5f70 6f73 6974 6976  self.val_positiv
+00006510: 655b 3a2c 3a2c 3a2c 325d 2c20 7369 7a65  e[:,:,:,2], size
+00006520: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
+00006530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006540: 2020 2020 2076 616c 5f63 6c61 7373 5f31       val_class_1
+00006550: 203d 2064 6174 615f 7072 6f63 6573 7369   = data_processi
+00006560: 6e67 2e63 6f6e 6361 745f 6368 616e 6e65  ng.concat_channe
+00006570: 6c73 2876 616c 5f63 6861 6e6e 656c 312c  ls(val_channel1,
+00006580: 2076 616c 5f63 6861 6e6e 656c 322c 2076   val_channel2, v
+00006590: 616c 5f63 6861 6e6e 656c 3329 0a20 2020  al_channel3).   
+000065a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000065b0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000065c0: 616c 5f63 6c61 7373 5f31 203d 204e 6f6e  al_class_1 = Non
+000065d0: 6520 0a0a 2020 2020 2020 2020 2020 2020  e ..            
+000065e0: 6966 2073 656c 662e 7661 6c5f 6e65 6761  if self.val_nega
+000065f0: 7469 7665 2069 7320 6e6f 7420 4e6f 6e65  tive is not None
+00006600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006610: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
+00006620: 6d5f 6368 616e 6e65 6c73 203d 3d20 313a  m_channels == 1:
+00006630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006640: 2020 2020 2076 616c 5f63 6c61 7373 5f32       val_class_2
+00006650: 203d 2072 6573 697a 6528 7365 6c66 2e76   = resize(self.v
+00006660: 616c 5f6e 6567 6174 6976 652c 2073 697a  al_negative, siz
+00006670: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
+00006680: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00006690: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+000066a0: 6368 616e 6e65 6c73 203e 2031 3a0a 2020  channels > 1:.  
+000066b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066c0: 2020 7661 6c5f 6368 616e 6e65 6c31 203d    val_channel1 =
+000066d0: 2072 6573 697a 6528 7365 6c66 2e76 616c   resize(self.val
+000066e0: 5f6e 6567 6174 6976 655b 3a2c 3a2c 3a2c  _negative[:,:,:,
+000066f0: 305d 2c20 7369 7a65 3d69 6d61 6765 5f73  0], size=image_s
+00006700: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+00006710: 2020 2020 2020 2020 2076 616c 5f63 6861           val_cha
+00006720: 6e6e 656c 3220 3d20 7265 7369 7a65 2873  nnel2 = resize(s
+00006730: 656c 662e 7661 6c5f 6e65 6761 7469 7665  elf.val_negative
+00006740: 5b3a 2c3a 2c3a 2c31 5d2c 2073 697a 653d  [:,:,:,1], size=
+00006750: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
+00006760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006770: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+00006780: 6368 616e 6e65 6c73 203d 3d20 323a 0a20  channels == 2:. 
+00006790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000067a0: 2020 2020 2020 2076 616c 5f63 6c61 7373         val_class
+000067b0: 5f32 203d 2064 6174 615f 7072 6f63 6573  _2 = data_proces
+000067c0: 7369 6e67 2e63 6f6e 6361 745f 6368 616e  sing.concat_chan
+000067d0: 6e65 6c73 2876 616c 5f63 6861 6e6e 656c  nels(val_channel
+000067e0: 312c 2076 616c 5f63 6861 6e6e 656c 3229  1, val_channel2)
+000067f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006800: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00006810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006820: 2020 2076 616c 5f63 6861 6e6e 656c 3320     val_channel3 
+00006830: 3d20 7265 7369 7a65 2873 656c 662e 7661  = resize(self.va
+00006840: 6c5f 6e65 6761 7469 7665 5b3a 2c3a 2c3a  l_negative[:,:,:
+00006850: 2c32 5d2c 2073 697a 653d 696d 6167 655f  ,2], size=image_
+00006860: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+00006870: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00006880: 6c5f 636c 6173 735f 3220 3d20 6461 7461  l_class_2 = data
+00006890: 5f70 726f 6365 7373 696e 672e 636f 6e63  _processing.conc
+000068a0: 6174 5f63 6861 6e6e 656c 7328 7661 6c5f  at_channels(val_
+000068b0: 6368 616e 6e65 6c31 2c20 7661 6c5f 6368  channel1, val_ch
+000068c0: 616e 6e65 6c32 2c20 7661 6c5f 6368 616e  annel2, val_chan
+000068d0: 6e65 6c33 290a 2020 2020 2020 2020 2020  nel3).          
+000068e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000068f0: 2020 2020 2020 2020 7661 6c5f 636c 6173          val_clas
+00006900: 735f 3220 3d20 4e6f 6e65 200a 2020 2020  s_2 = None .    
+00006910: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006920: 2020 2020 2020 636c 6173 735f 312c 2063        class_1, c
+00006930: 6c61 7373 5f32 203d 2073 656c 662e 706f  lass_2 = self.po
+00006940: 7369 7469 7665 5f63 6c61 7373 2c20 7365  sitive_class, se
+00006950: 6c66 2e6e 6567 6174 6976 655f 636c 6173  lf.negative_clas
+00006960: 730a 2020 2020 2020 2020 2020 2020 7661  s.            va
+00006970: 6c5f 636c 6173 735f 312c 2076 616c 5f63  l_class_1, val_c
+00006980: 6c61 7373 5f32 203d 2073 656c 662e 7661  lass_2 = self.va
+00006990: 6c5f 706f 7369 7469 7665 2c20 7365 6c66  l_positive, self
+000069a0: 2e76 616c 5f6e 6567 6174 6976 650a 0a20  .val_negative.. 
+000069b0: 2020 2020 2020 2023 2323 204f 7074 696d         ### Optim
+000069c0: 697a 6520 7468 6520 6d61 7820 7069 7865  ize the max pixe
+000069d0: 6c20 746f 2075 7365 2066 6f72 2074 6865  l to use for the
+000069e0: 206d 696e 2d6d 6178 206e 6f72 6d61 6c69   min-max normali
+000069f0: 7a61 7469 6f6e 202d 2d20 4f4e 4520 5049  zation -- ONE PI
+00006a00: 5820 5045 5220 4241 4e44 2023 2323 0a20  X PER BAND ###. 
+00006a10: 2020 2020 2020 2069 6620 7365 6c66 2e6f         if self.o
+00006a20: 7074 5f6d 6178 5f6d 696e 5f70 6978 2069  pt_max_min_pix i
+00006a30: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00006a40: 2020 2020 2020 2020 7365 6c66 2e6e 6f72          self.nor
+00006a50: 6d61 6c69 7a65 203d 2054 7275 6520 234a  malize = True #J
+00006a60: 7573 7420 696e 2063 6173 6520 6974 2773  ust in case it's
+00006a70: 2073 6574 2074 6f20 4661 6c73 6520 6279   set to False by
+00006a80: 2074 6865 2075 7365 7220 0a20 2020 2020   the user .     
+00006a90: 2020 2020 2020 206d 696e 5f70 6978 2c20         min_pix, 
+00006aa0: 6d61 785f 7069 7820 3d20 302e 302c 205b  max_pix = 0.0, [
+00006ab0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00006ac0: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+00006ad0: 616e 6e65 6c73 203e 3d20 313a 0a20 2020  annels >= 1:.   
+00006ae0: 2020 2020 2020 2020 2020 2020 206d 6178               max
+00006af0: 5f70 6978 5f31 203d 2074 7269 616c 2e73  _pix_1 = trial.s
+00006b00: 7567 6765 7374 5f69 6e74 2827 6d61 785f  uggest_int('max_
+00006b10: 7069 7865 6c5f 3127 2c20 7365 6c66 2e6f  pixel_1', self.o
+00006b20: 7074 5f6d 6178 5f6d 696e 5f70 6978 2c20  pt_max_min_pix, 
+00006b30: 7365 6c66 2e6f 7074 5f6d 6178 5f6d 6178  self.opt_max_max
+00006b40: 5f70 6978 2c20 7374 6570 3d31 293b 206d  _pix, step=1); m
+00006b50: 6178 5f70 6978 2e61 7070 656e 6428 6d61  ax_pix.append(ma
+00006b60: 785f 7069 785f 3129 0a20 2020 2020 2020  x_pix_1).       
+00006b70: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
+00006b80: 5f6e 756d 5f63 6861 6e6e 656c 7320 3e3d  _num_channels >=
+00006b90: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00006ba0: 2020 2020 6d61 785f 7069 785f 3220 3d20      max_pix_2 = 
+00006bb0: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00006bc0: 7428 276d 6178 5f70 6978 656c 5f32 272c  t('max_pixel_2',
+00006bd0: 2073 656c 662e 6f70 745f 6d61 785f 6d69   self.opt_max_mi
+00006be0: 6e5f 7069 782c 2073 656c 662e 6f70 745f  n_pix, self.opt_
+00006bf0: 6d61 785f 6d61 785f 7069 782c 2073 7465  max_max_pix, ste
+00006c00: 703d 3129 3b20 6d61 785f 7069 782e 6170  p=1); max_pix.ap
+00006c10: 7065 6e64 286d 6178 5f70 6978 5f32 290a  pend(max_pix_2).
+00006c20: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00006c30: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
+00006c40: 6e65 6c73 203d 3d20 333a 0a20 2020 2020  nels == 3:.     
+00006c50: 2020 2020 2020 2020 2020 206d 6178 5f70             max_p
+00006c60: 6978 5f33 203d 2074 7269 616c 2e73 7567  ix_3 = trial.sug
+00006c70: 6765 7374 5f69 6e74 2827 6d61 785f 7069  gest_int('max_pi
+00006c80: 7865 6c5f 3327 2c20 7365 6c66 2e6f 7074  xel_3', self.opt
+00006c90: 5f6d 6178 5f6d 696e 5f70 6978 2c20 7365  _max_min_pix, se
+00006ca0: 6c66 2e6f 7074 5f6d 6178 5f6d 6178 5f70  lf.opt_max_max_p
+00006cb0: 6978 2c20 7374 6570 3d31 293b 206d 6178  ix, step=1); max
+00006cc0: 5f70 6978 2e61 7070 656e 6428 6d61 785f  _pix.append(max_
+00006cd0: 7069 785f 3329 0a20 2020 2020 2020 2020  pix_3).         
+00006ce0: 2020 2065 6c69 6620 7365 6c66 2e69 6d67     elif self.img
+00006cf0: 5f6e 756d 5f63 6861 6e6e 656c 7320 3e20  _num_channels > 
+00006d00: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
+00006d10: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00006d20: 726f 7228 274f 6e6c 7920 7570 2074 6f20  ror('Only up to 
+00006d30: 7468 7265 6520 6368 616e 6e65 6c73 2061  three channels a
+00006d40: 7265 2063 7572 7265 6e74 6c79 2073 7570  re currently sup
+00006d50: 706f 7274 6564 2127 290a 2020 2020 2020  ported!').      
+00006d60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00006d70: 2020 2020 6d69 6e5f 7069 782c 206d 6178      min_pix, max
+00006d80: 5f70 6978 203d 2073 656c 662e 6d69 6e5f  _pix = self.min_
+00006d90: 7069 7865 6c2c 2073 656c 662e 6d61 785f  pixel, self.max_
+00006da0: 7069 7865 6c0a 0a20 2020 2020 2020 2023  pixel..        #
+00006db0: 2323 2045 6172 6c79 2053 746f 7070 696e  ## Early Stoppin
+00006dc0: 6720 616e 6420 5072 756e 696e 6720 4361  g and Pruning Ca
+00006dd0: 6c6c 6261 636b 7320 2323 230a 2020 2020  llbacks ###.    
+00006de0: 2020 2020 6966 2073 656c 662e 7061 7469      if self.pati
+00006df0: 656e 6365 2021 3d20 303a 0a20 2020 2020  ence != 0:.     
+00006e00: 2020 2020 2020 206d 6f64 6520 3d20 276d         mode = 'm
+00006e10: 696e 2720 6966 2027 6c6f 7373 2720 696e  in' if 'loss' in
+00006e20: 2073 656c 662e 6d65 7472 6963 2065 6c73   self.metric els
+00006e30: 6520 276d 6178 2720 234e 6565 6420 746f  e 'max' #Need to
+00006e40: 206d 696e 696d 697a 6520 7468 6520 6d65   minimize the me
+00006e50: 7472 6963 2069 6620 6576 616c 7561 7469  tric if evaluati
+00006e60: 6e67 2074 6865 206c 6f73 7321 0a20 2020  ng the loss!.   
+00006e70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00006e80: 2e6d 6574 7269 6320 3d3d 2027 7661 6c5f  .metric == 'val_
+00006e90: 616c 6c27 3a0a 2020 2020 2020 2020 2020  all':.          
+00006ea0: 2020 2020 2020 7072 696e 7428 293b 2070        print(); p
+00006eb0: 7269 6e74 2822 2743 616e 6e6f 7420 7573  rint("'Cannot us
+00006ec0: 6520 6561 726c 7920 7374 6f70 7069 6e67  e early stopping
+00006ed0: 2063 616c 6c62 6163 6b73 2069 6620 6176   callbacks if av
+00006ee0: 6572 6167 696e 6720 6f75 7420 616c 6c20  eraging out all 
+00006ef0: 7065 7266 6f72 6d61 6e63 6520 6d65 7472  performance metr
+00006f00: 6963 7320 666f 7220 6576 616c 7561 7469  ics for evaluati
+00006f10: 6f6e 2120 4175 746f 6d61 7469 6361 6c6c  on! Automaticall
+00006f20: 7920 7365 7474 696e 6720 7468 6520 6d65  y setting the me
+00006f30: 7472 6963 2074 6f20 2776 616c 5f6c 6f73  tric to 'val_los
+00006f40: 7327 2e20 546f 2064 6973 6162 6c65 2c20  s'. To disable, 
+00006f50: 7365 7420 7061 7469 656e 6365 3d30 2e22  set patience=0."
+00006f60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00006f70: 2020 6361 6c6c 6261 636b 7320 3d20 5b45    callbacks = [E
+00006f80: 6172 6c79 5374 6f70 7069 6e67 286d 6f6e  arlyStopping(mon
+00006f90: 6974 6f72 3d27 7661 6c5f 6c6f 7373 272c  itor='val_loss',
+00006fa0: 206d 6f64 653d 276d 696e 272c 2070 6174   mode='min', pat
+00006fb0: 6965 6e63 653d 7365 6c66 2e70 6174 6965  ience=self.patie
+00006fc0: 6e63 6529 2c5d 0a20 2020 2020 2020 2020  nce),].         
+00006fd0: 2020 2065 6c69 6620 7365 6c66 2e6d 6574     elif self.met
+00006fe0: 7269 6320 3d3d 2027 616c 6c27 3a0a 2020  ric == 'all':.  
+00006ff0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00007000: 696e 7428 293b 2070 7269 6e74 2822 2743  int(); print("'C
+00007010: 616e 6e6f 7420 7573 6520 6561 726c 7920  annot use early 
+00007020: 7374 6f70 7069 6e67 2063 616c 6c62 6163  stopping callbac
+00007030: 6b73 2069 6620 6176 6572 6167 696e 6720  ks if averaging 
+00007040: 6f75 7420 616c 6c20 7065 7266 6f72 6d61  out all performa
+00007050: 6e63 6520 6d65 7472 6963 7320 666f 7220  nce metrics for 
+00007060: 6576 616c 7561 7469 6f6e 2120 4175 746f  evaluation! Auto
+00007070: 6d61 7469 6361 6c6c 7920 7365 7474 696e  matically settin
+00007080: 6720 7468 6520 6d65 7472 6963 2074 6f20  g the metric to 
+00007090: 276c 6f73 7327 2e20 546f 2064 6973 6162  'loss'. To disab
+000070a0: 6c65 2c20 7365 7420 7061 7469 656e 6365  le, set patience
+000070b0: 3d30 2e22 290a 2020 2020 2020 2020 2020  =0.").          
+000070c0: 2020 2020 2020 6361 6c6c 6261 636b 7320        callbacks 
+000070d0: 3d20 5b45 6172 6c79 5374 6f70 7069 6e67  = [EarlyStopping
+000070e0: 286d 6f6e 6974 6f72 3d27 6c6f 7373 272c  (monitor='loss',
+000070f0: 206d 6f64 653d 276d 696e 272c 2070 6174   mode='min', pat
+00007100: 6965 6e63 653d 7365 6c66 2e70 6174 6965  ience=self.patie
+00007110: 6e63 6529 2c5d 0a20 2020 2020 2020 2020  nce),].         
+00007120: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00007130: 2020 2020 2020 2020 2063 616c 6c62 6163           callbac
+00007140: 6b73 203d 205b 4561 726c 7953 746f 7070  ks = [EarlyStopp
+00007150: 696e 6728 6d6f 6e69 746f 723d 7365 6c66  ing(monitor=self
+00007160: 2e6d 6574 7269 632c 206d 6f64 653d 6d6f  .metric, mode=mo
+00007170: 6465 2c20 7061 7469 656e 6365 3d73 656c  de, patience=sel
+00007180: 662e 7061 7469 656e 6365 292c 5d20 2354  f.patience),] #T
+00007190: 464b 6572 6173 5072 756e 696e 6743 616c  FKerasPruningCal
+000071a0: 6c62 6163 6b28 7472 6961 6c2c 206d 6f6e  lback(trial, mon
+000071b0: 6974 6f72 3d73 656c 662e 6d65 7472 6963  itor=self.metric
+000071c0: 292c 0a20 2020 2020 2020 2020 2020 200a  ),.            .
+000071d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000071e0: 656c 662e 6d6f 6e69 746f 7231 2069 7320  elf.monitor1 is 
+000071f0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00007200: 2020 2020 2020 2020 2020 6966 2063 616c            if cal
+00007210: 6c62 6163 6b73 2069 7320 6e6f 7420 4e6f  lbacks is not No
+00007220: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007230: 2020 2020 2020 2020 6361 6c6c 6261 636b          callback
+00007240: 732e 6170 7065 6e64 284d 6f6e 6974 6f72  s.append(Monitor
+00007250: 5f54 7261 636b 6572 286d 6f6e 6974 6f72  _Tracker(monitor
+00007260: 313d 7365 6c66 2e6d 6f6e 6974 6f72 312c  1=self.monitor1,
+00007270: 206d 6f6e 6974 6f72 323d 7365 6c66 2e6d   monitor2=self.m
+00007280: 6f6e 6974 6f72 322c 206d 6f6e 6974 6f72  onitor2, monitor
+00007290: 315f 7468 7265 7368 3d73 656c 662e 6d6f  1_thresh=self.mo
+000072a0: 6e69 746f 7231 5f74 6872 6573 682c 206d  nitor1_thresh, m
+000072b0: 6f6e 6974 6f72 325f 7468 7265 7368 3d73  onitor2_thresh=s
+000072c0: 656c 662e 6d6f 6e69 746f 7232 5f74 6872  elf.monitor2_thr
+000072d0: 6573 6829 290a 2020 2020 2020 2020 2020  esh)).          
+000072e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000072f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007300: 6361 6c6c 6261 636b 7320 3d20 5b4d 6f6e  callbacks = [Mon
+00007310: 6974 6f72 5f54 7261 636b 6572 286d 6f6e  itor_Tracker(mon
+00007320: 6974 6f72 313d 7365 6c66 2e6d 6f6e 6974  itor1=self.monit
+00007330: 6f72 312c 206d 6f6e 6974 6f72 323d 7365  or1, monitor2=se
+00007340: 6c66 2e6d 6f6e 6974 6f72 322c 206d 6f6e  lf.monitor2, mon
+00007350: 6974 6f72 315f 7468 7265 7368 3d73 656c  itor1_thresh=sel
+00007360: 662e 6d6f 6e69 746f 7231 5f74 6872 6573  f.monitor1_thres
+00007370: 682c 206d 6f6e 6974 6f72 325f 7468 7265  h, monitor2_thre
+00007380: 7368 3d73 656c 662e 6d6f 6e69 746f 7232  sh=self.monitor2
+00007390: 5f74 6872 6573 6829 2c5d 0a20 2020 2020  _thresh),].     
+000073a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000073b0: 2020 2020 2069 6620 7365 6c66 2e6d 6f6e       if self.mon
+000073c0: 6974 6f72 3120 6973 206e 6f74 204e 6f6e  itor1 is not Non
+000073d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000073e0: 2020 2063 616c 6c62 6163 6b73 203d 205b     callbacks = [
+000073f0: 4d6f 6e69 746f 725f 5472 6163 6b65 7228  Monitor_Tracker(
+00007400: 6d6f 6e69 746f 7231 3d73 656c 662e 6d6f  monitor1=self.mo
+00007410: 6e69 746f 7231 2c20 6d6f 6e69 746f 7232  nitor1, monitor2
+00007420: 3d73 656c 662e 6d6f 6e69 746f 7232 2c20  =self.monitor2, 
+00007430: 6d6f 6e69 746f 7231 5f74 6872 6573 683d  monitor1_thresh=
+00007440: 7365 6c66 2e6d 6f6e 6974 6f72 315f 7468  self.monitor1_th
+00007450: 7265 7368 2c20 6d6f 6e69 746f 7232 5f74  resh, monitor2_t
+00007460: 6872 6573 683d 7365 6c66 2e6d 6f6e 6974  hresh=self.monit
+00007470: 6f72 325f 7468 7265 7368 292c 5d0a 2020  or2_thresh),].  
+00007480: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00007490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000074a0: 6361 6c6c 6261 636b 7320 3d20 4e6f 6e65  callbacks = None
+000074b0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000074c0: 662e 6d65 7472 6963 3220 6973 206e 6f74  f.metric2 is not
+000074d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000074e0: 2020 206d 6f64 6532 203d 2027 6d69 6e27     mode2 = 'min'
+000074f0: 2069 6620 276c 6f73 7327 2069 6e20 7365   if 'loss' in se
+00007500: 6c66 2e6d 6574 7269 6332 2065 6c73 6520  lf.metric2 else 
+00007510: 276d 6178 270a 2020 2020 2020 2020 2020  'max'.          
+00007520: 2020 6361 6c6c 6261 636b 732e 6170 7065    callbacks.appe
+00007530: 6e64 2845 6172 6c79 5374 6f70 7069 6e67  nd(EarlyStopping
+00007540: 286d 6f6e 6974 6f72 3d73 656c 662e 6d65  (monitor=self.me
+00007550: 7472 6963 322c 206d 6f64 653d 6d6f 6465  tric2, mode=mode
+00007560: 322c 2070 6174 6965 6e63 653d 7365 6c66  2, patience=self
+00007570: 2e70 6174 6965 6e63 6529 290a 2020 2020  .patience)).    
+00007580: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+00007590: 6574 7469 6e67 2061 6464 6974 696f 6e61  etting additiona
+000075a0: 6c20 6561 726c 7920 7374 6f70 7069 6e67  l early stopping
+000075b0: 2063 7269 7465 7269 613a 207b 7d27 2e66   criteria: {}'.f
+000075c0: 6f72 6d61 7428 7365 6c66 2e6d 6574 7269  ormat(self.metri
+000075d0: 6332 2929 0a20 2020 2020 2020 2020 2020  c2)).           
+000075e0: 200a 2020 2020 2020 2020 2323 2320 2323   .        ### ##
+000075f0: 2320 2323 2320 2323 2320 2323 2320 2323  # ### ### ### ##
+00007600: 2320 2323 2320 2323 2320 2323 2320 0a20  # ### ### ### . 
+00007610: 2020 2020 2020 2020 2020 2020 2323 204f              ## O
+00007620: 7074 696d 697a 6520 434e 4e20 4d6f 6465  ptimize CNN Mode
+00007630: 6c20 2323 0a20 2020 2020 2020 2023 2323  l ##.        ###
+00007640: 2023 2323 2023 2323 2023 2323 2023 2323   ### ### ### ###
+00007650: 2023 2323 2023 2323 2023 2323 2023 2323   ### ### ### ###
+00007660: 200a 0a20 2020 2020 2020 2023 2323 2042   ..        ### B
+00007670: 6174 6368 2053 697a 6520 2323 230a 2020  atch Size ###.  
+00007680: 2020 2020 2020 2349 6e20 6361 7365 2075        #In case u
+00007690: 7365 7220 7761 6e74 7320 746f 2066 6978  ser wants to fix
+000076a0: 2074 6865 2062 6174 6368 5f73 697a 652e   the batch_size.
+000076b0: 2e2e 2061 6c74 686f 7567 6820 4f70 7475  .. although Optu
+000076c0: 6e61 2063 616e 206f 7074 696d 697a 6520  na can optimize 
+000076d0: 6120 7061 7261 6d20 7261 6e67 696e 6720  a param ranging 
+000076e0: 6672 6f6d 206f 6e65 2076 616c 7565 2074  from one value t
+000076f0: 6f20 7468 6520 7361 6d65 2076 616c 7565  o the same value
+00007700: 2c20 7468 6520 696d 706f 7274 616e 6365  , the importance
+00007710: 7320 7769 6c6c 206e 6f74 2062 6520 6162  s will not be ab
+00007720: 6c65 2074 6f20 6265 2063 6f6d 7075 7465  le to be compute
+00007730: 6420 6166 7465 7277 6172 6473 2120 5468  d afterwards! Th
+00007740: 6973 2063 6f6e 6469 7469 6f6e 2069 7320  is condition is 
+00007750: 746f 2061 766f 6964 2074 6869 7320 6275  to avoid this bu
+00007760: 6721 200a 2020 2020 2020 2020 6966 2073  g! .        if s
+00007770: 656c 662e 6261 7463 685f 7369 7a65 5f6d  elf.batch_size_m
+00007780: 696e 203d 3d20 7365 6c66 2e62 6174 6368  in == self.batch
+00007790: 5f73 697a 655f 6d61 783a 0a20 2020 2020  _size_max:.     
+000077a0: 2020 2020 2020 2062 6174 6368 5f73 697a         batch_siz
+000077b0: 6520 3d20 7365 6c66 2e62 6174 6368 5f73  e = self.batch_s
+000077c0: 697a 655f 6d61 7820 0a20 2020 2020 2020  ize_max .       
+000077d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000077e0: 2020 2062 6174 6368 5f73 697a 6520 3d20     batch_size = 
+000077f0: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00007800: 7428 2762 6174 6368 5f73 697a 6527 2c20  t('batch_size', 
+00007810: 7365 6c66 2e62 6174 6368 5f73 697a 655f  self.batch_size_
+00007820: 6d69 6e2c 2073 656c 662e 6261 7463 685f  min, self.batch_
+00007830: 7369 7a65 5f6d 6178 2c20 7374 6570 3d31  size_max, step=1
+00007840: 290a 0a20 2020 2020 2020 2023 2323 204c  )..        ### L
+00007850: 6561 726e 696e 6720 5261 7465 2026 204f  earning Rate & O
+00007860: 7074 696d 697a 6572 2023 2323 0a20 2020  ptimizer ###.   
+00007870: 2020 2020 206c 7220 3d20 7472 6961 6c2e       lr = trial.
+00007880: 7375 6767 6573 745f 666c 6f61 7428 276c  suggest_float('l
+00007890: 7227 2c20 3165 2d36 2c20 3165 2d33 2c20  r', 1e-6, 1e-3, 
+000078a0: 7374 6570 3d35 652d 3629 200a 2020 2020  step=5e-6) .    
+000078b0: 2020 2020 6465 6361 793d 3020 2364 6563      decay=0 #dec
+000078c0: 6179 203d 2074 7269 616c 2e73 7567 6765  ay = trial.sugge
+000078d0: 7374 5f66 6c6f 6174 2827 6465 6361 7927  st_float('decay'
+000078e0: 2c20 302e 302c 2030 2e31 2c20 7374 6570  , 0.0, 0.1, step
+000078f0: 3d31 652d 3329 0a20 2020 2020 2020 206f  =1e-3).        o
+00007900: 7074 696d 697a 6572 203d 2074 7269 616c  ptimizer = trial
+00007910: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00007920: 6963 616c 2827 6f70 7469 6d69 7a65 7227  ical('optimizer'
+00007930: 2c20 5b27 7367 6427 2c20 2761 6461 6d27  , ['sgd', 'adam'
+00007940: 2c20 2761 6461 6d61 7827 2c20 276e 6164  , 'adamax', 'nad
+00007950: 616d 272c 2027 6164 6164 656c 7461 272c  am', 'adadelta',
+00007960: 2027 726d 7370 726f 7027 5d29 0a0a 2020   'rmsprop'])..  
+00007970: 2020 2020 2020 2341 6c6c 2075 7365 2069        #All use i
+00007980: 6e76 6572 7365 2074 696d 6520 6465 6361  nverse time deca
+00007990: 792c 2061 2066 6577 2075 7365 2072 686f  y, a few use rho
+000079a0: 2061 7320 7765 6c6c 2c20 616e 6420 4164   as well, and Ad
+000079b0: 616d 2d62 6173 6564 206f 7074 696d 697a  am-based optimiz
+000079c0: 6572 7320 7573 6520 6265 7461 5f31 2061  ers use beta_1 a
+000079d0: 6e64 2062 6574 615f 3220 0a20 2020 2020  nd beta_2 .     
+000079e0: 2020 2069 6620 6f70 7469 6d69 7a65 7220     if optimizer 
+000079f0: 3d3d 2027 7367 6427 3a0a 2020 2020 2020  == 'sgd':.      
+00007a00: 2020 2020 2020 6d6f 6d65 6e74 756d 203d        momentum =
+00007a10: 2074 7269 616c 2e73 7567 6765 7374 5f66   trial.suggest_f
+00007a20: 6c6f 6174 2827 6d6f 6d65 6e74 756d 272c  loat('momentum',
+00007a30: 2030 2e30 2c20 312e 302c 2073 7465 703d   0.0, 1.0, step=
+00007a40: 3165 2d33 290a 2020 2020 2020 2020 2020  1e-3).          
+00007a50: 2020 6e65 7374 6572 6f76 203d 2074 7269    nesterov = tri
+00007a60: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
+00007a70: 6f72 6963 616c 2827 6e65 7374 6572 6f76  orical('nesterov
+00007a80: 272c 205b 5472 7565 2c20 4661 6c73 655d  ', [True, False]
+00007a90: 290a 2020 2020 2020 2020 2020 2020 6265  ).            be
+00007aa0: 7461 5f31 203d 2062 6574 615f 3220 3d20  ta_1 = beta_2 = 
+00007ab0: 303b 2061 6d73 6772 6164 203d 2046 616c  0; amsgrad = Fal
+00007ac0: 7365 0a20 2020 2020 2020 2065 6c69 6620  se.        elif 
+00007ad0: 6f70 7469 6d69 7a65 7220 3d3d 2027 6164  optimizer == 'ad
+00007ae0: 616d 2720 6f72 206f 7074 696d 697a 6572  am' or optimizer
+00007af0: 203d 3d20 2761 6461 6d61 7827 206f 7220   == 'adamax' or 
+00007b00: 6f70 7469 6d69 7a65 7220 3d3d 2027 6e61  optimizer == 'na
+00007b10: 6461 6d27 3a0a 2020 2020 2020 2020 2020  dam':.          
+00007b20: 2020 6265 7461 5f31 203d 2074 7269 616c    beta_1 = trial
+00007b30: 2e73 7567 6765 7374 5f66 6c6f 6174 2827  .suggest_float('
+00007b40: 6265 7461 5f31 272c 2030 2e30 2c20 312e  beta_1', 0.0, 1.
+00007b50: 302c 2073 7465 703d 3165 2d33 290a 2020  0, step=1e-3).  
+00007b60: 2020 2020 2020 2020 2020 6265 7461 5f32            beta_2
+00007b70: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00007b80: 5f66 6c6f 6174 2827 6265 7461 5f32 272c  _float('beta_2',
+00007b90: 2030 2e30 2c20 312e 302c 2073 7465 703d   0.0, 1.0, step=
+00007ba0: 3165 2d33 290a 2020 2020 2020 2020 2020  1e-3).          
+00007bb0: 2020 616d 7367 7261 6420 3d20 7472 6961    amsgrad = tria
+00007bc0: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
+00007bd0: 7269 6361 6c28 2761 6d73 6772 6164 272c  rical('amsgrad',
+00007be0: 205b 5472 7565 2c20 4661 6c73 655d 2920   [True, False]) 
+00007bf0: 6966 206f 7074 696d 697a 6572 203d 3d20  if optimizer == 
+00007c00: 2761 6461 6d27 2065 6c73 6520 4661 6c73  'adam' else Fals
+00007c10: 650a 2020 2020 2020 2020 2020 2020 6d6f  e.            mo
+00007c20: 6d65 6e74 756d 2c20 6e65 7374 6572 6f76  mentum, nesterov
+00007c30: 203d 2030 2e30 2c20 4661 6c73 650a 2020   = 0.0, False.  
+00007c40: 2020 2020 2020 656c 6966 206f 7074 696d        elif optim
+00007c50: 697a 6572 203d 3d20 2761 6461 6465 6c74  izer == 'adadelt
+00007c60: 6127 206f 7220 6f70 7469 6d69 7a65 7220  a' or optimizer 
+00007c70: 3d3d 2027 726d 7370 726f 7027 3a0a 2020  == 'rmsprop':.  
+00007c80: 2020 2020 2020 2020 2020 7268 6f20 3d20            rho = 
+00007c90: 7472 6961 6c2e 7375 6767 6573 745f 666c  trial.suggest_fl
+00007ca0: 6f61 7428 2772 686f 272c 2030 2c20 312c  oat('rho', 0, 1,
+00007cb0: 2073 7465 703d 3165 2d33 290a 2020 2020   step=1e-3).    
+00007cc0: 2020 2020 2020 2020 6d6f 6d65 6e74 756d          momentum
+00007cd0: 203d 2062 6574 615f 3120 3d20 6265 7461   = beta_1 = beta
+00007ce0: 5f32 203d 2030 3b20 6e65 7374 6572 6f76  _2 = 0; nesterov
+00007cf0: 203d 2061 6d73 6772 6164 203d 2046 616c   = amsgrad = Fal
+00007d00: 7365 0a0a 2020 2020 2020 2020 636c 6561  se..        clea
+00007d10: 725f 7365 7373 696f 6e28 290a 2020 2020  r_session().    
+00007d20: 2020 2020 6966 2073 656c 662e 6f70 745f      if self.opt_
+00007d30: 6d6f 6465 6c3a 0a20 2020 2020 2020 2020  model:.         
+00007d40: 2020 2022 2222 434e 4e20 4879 7065 7270     """CNN Hyperp
+00007d50: 6172 616d 6574 6572 2053 6561 7263 6820  arameter Search 
+00007d60: 5370 6163 6522 2222 0a0a 2020 2020 2020  Space"""..      
+00007d70: 2020 2020 2020 2323 2320 4163 7469 7661        ### Activa
+00007d80: 7469 6f6e 2061 6e64 204c 6f73 7320 4675  tion and Loss Fu
+00007d90: 6e63 7469 6f6e 7320 2323 2320 0a20 2020  nctions ### .   
+00007da0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+00007db0: 696f 6e5f 636f 6e76 203d 2074 7269 616c  ion_conv = trial
+00007dc0: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00007dd0: 6963 616c 2827 6163 7469 7661 7469 6f6e  ical('activation
+00007de0: 5f63 6f6e 7627 2c20 5b27 7265 6c75 272c  _conv', ['relu',
+00007df0: 2027 7369 676d 6f69 6427 2c20 2774 616e   'sigmoid', 'tan
+00007e00: 6827 2c20 2765 6c75 272c 2027 7365 6c75  h', 'elu', 'selu
+00007e10: 275d 2920 2020 2020 2020 2020 2020 200a  '])            .
+00007e20: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+00007e30: 7661 7469 6f6e 5f64 656e 7365 203d 2074  vation_dense = t
+00007e40: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
+00007e50: 6567 6f72 6963 616c 2827 6163 7469 7661  egorical('activa
+00007e60: 7469 6f6e 5f64 656e 7365 272c 205b 2772  tion_dense', ['r
+00007e70: 656c 7527 2c20 2773 6967 6d6f 6964 272c  elu', 'sigmoid',
+00007e80: 2027 7461 6e68 272c 2027 656c 7527 2c20   'tanh', 'elu', 
+00007e90: 2773 656c 7527 5d29 0a20 2020 2020 2020  'selu']).       
+00007ea0: 2020 2020 206c 6f73 7320 3d20 7472 6961       loss = tria
+00007eb0: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
+00007ec0: 7269 6361 6c28 276c 6f73 7327 2c20 5b27  rical('loss', ['
+00007ed0: 6269 6e61 7279 5f63 726f 7373 656e 7472  binary_crossentr
+00007ee0: 6f70 7927 2c20 2768 696e 6765 272c 2027  opy', 'hinge', '
+00007ef0: 7371 7561 7265 645f 6869 6e67 6527 2c20  squared_hinge', 
+00007f00: 276b 6c64 272c 2027 6c6f 6763 6f73 6827  'kld', 'logcosh'
+00007f10: 5d29 232c 2027 666f 6361 6c5f 6c6f 7373  ])#, 'focal_loss
+00007f20: 272c 2027 6469 6365 5f6c 6f73 7327 2c20  ', 'dice_loss', 
+00007f30: 276a 6163 6361 7264 5f6c 6f73 7327 5d29  'jaccard_loss'])
+00007f40: 0a0a 2020 2020 2020 2020 2020 2020 2323  ..            ##
+00007f50: 2320 4b65 726e 656c 2049 6e69 7469 616c  # Kernel Initial
+00007f60: 697a 6572 7320 2323 230a 2020 2020 2020  izers ###.      
+00007f70: 2020 2020 2020 636f 6e76 5f69 6e69 7420        conv_init 
+00007f80: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00007f90: 6361 7465 676f 7269 6361 6c28 2763 6f6e  categorical('con
+00007fa0: 765f 696e 6974 272c 205b 2775 6e69 666f  v_init', ['unifo
+00007fb0: 726d 5f73 6361 6c69 6e67 272c 2027 5472  rm_scaling', 'Tr
+00007fc0: 756e 6361 7465 644e 6f72 6d61 6c27 2c20  uncatedNormal', 
+00007fd0: 2768 655f 6e6f 726d 616c 272c 2027 6c65  'he_normal', 'le
+00007fe0: 6375 6e5f 756e 6966 6f72 6d27 2c20 2767  cun_uniform', 'g
+00007ff0: 6c6f 726f 745f 756e 6966 6f72 6d27 5d29  lorot_uniform'])
+00008000: 200a 2020 2020 2020 2020 2020 2020 6465   .            de
+00008010: 6e73 655f 696e 6974 203d 2074 7269 616c  nse_init = trial
+00008020: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00008030: 6963 616c 2827 6465 6e73 655f 696e 6974  ical('dense_init
+00008040: 272c 205b 2775 6e69 666f 726d 5f73 6361  ', ['uniform_sca
+00008050: 6c69 6e67 272c 2027 5472 756e 6361 7465  ling', 'Truncate
+00008060: 644e 6f72 6d61 6c27 2c27 6865 5f6e 6f72  dNormal','he_nor
+00008070: 6d61 6c27 2c20 276c 6563 756e 5f75 6e69  mal', 'lecun_uni
+00008080: 666f 726d 272c 2027 676c 6f72 6f74 5f75  form', 'glorot_u
+00008090: 6e69 666f 726d 275d 2920 0a0a 2020 2020  niform']) ..    
+000080a0: 2020 2020 2020 2020 7072 696e 7428 290a          print().
+000080b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000080c0: 656c 662e 7665 7262 6f73 6520 3d3d 2031  elf.verbose == 1
+000080d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000080e0: 2020 6966 2073 656c 662e 6f70 745f 6376    if self.opt_cv
+000080f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00008100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008110: 2020 7072 696e 7428 293b 2070 7269 6e74    print(); print
+00008120: 2827 2a2a 2a2a 2a2a 2a2a 2a2a 2a20 2043  ('***********  C
+00008130: 5620 2d20 3120 2a2a 2a2a 2a2a 2a2a 2a2a  V - 1 **********
+00008140: 2a27 293b 2070 7269 6e74 2829 0a20 2020  *'); print().   
+00008150: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00008160: 7365 6c66 2e6f 7074 5f61 7567 3a0a 2020  self.opt_aug:.  
+00008170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008180: 2020 7072 696e 7428 293b 2070 7269 6e74    print(); print
+00008190: 2827 3d3d 3d3d 3d3d 3d20 496d 6167 6520  ('======= Image 
+000081a0: 5061 7261 6d65 7465 7273 203d 3d3d 3d3d  Parameters =====
+000081b0: 3d27 293b 2070 7269 6e74 2829 3b20 7072  ='); print(); pr
+000081c0: 696e 7428 274e 756d 2041 7567 6d65 6e74  int('Num Augment
+000081d0: 6174 696f 6e73 203a 272c 206e 756d 5f61  ations :', num_a
+000081e0: 7567 293b 2070 7269 6e74 2827 496d 6167  ug); print('Imag
+000081f0: 6520 5369 7a65 203a 2027 2c20 696d 6167  e Size : ', imag
+00008200: 655f 7369 7a65 293b 2070 7269 6e74 2827  e_size); print('
+00008210: 4d61 7820 5069 7865 6c28 7329 203a 272c  Max Pixel(s) :',
+00008220: 206d 6178 5f70 6978 293b 2070 7269 6e74   max_pix); print
+00008230: 2827 4e75 6d20 4d61 736b 7320 3a27 2c20  ('Num Masks :', 
+00008240: 6e75 6d5f 6d61 736b 7329 3b20 7072 696e  num_masks); prin
+00008250: 7428 274d 6173 6b20 5369 7a65 203a 272c  t('Mask Size :',
+00008260: 206d 6173 6b5f 7369 7a65 293b 2070 7269   mask_size); pri
+00008270: 6e74 2827 426c 656e 6420 4d75 6c74 6970  nt('Blend Multip
+00008280: 6c69 6572 203a 272c 2062 6c65 6e64 5f6d  lier :', blend_m
+00008290: 756c 7469 706c 6965 7229 3b20 7072 696e  ultiplier); prin
+000082a0: 7428 2753 6b65 7720 416e 676c 6520 3a27  t('Skew Angle :'
+000082b0: 2c20 736b 6577 5f61 6e67 6c65 290a 0a20  , skew_angle).. 
+000082c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000082d0: 6c66 2e63 6c66 203d 3d20 2761 6c65 786e  lf.clf == 'alexn
+000082e0: 6574 273a 0a0a 2020 2020 2020 2020 2020  et':..          
+000082f0: 2020 2020 2020 2323 2320 5265 6775 6c61        ### Regula
+00008300: 7269 7a61 7469 6f6e 2054 6563 686e 6971  rization Techniq
+00008310: 7565 2028 424e 2069 7320 6e65 7765 722c  ue (BN is newer,
+00008320: 2041 6c65 784e 6574 2075 7365 6420 7477   AlexNet used tw
+00008330: 6f20 4c6f 6361 6c20 5265 7370 6f6e 7365  o Local Response
+00008340: 204e 6f72 6d61 6c69 7a61 7469 6f6e 206c   Normalization l
+00008350: 6179 6572 7320 6166 7465 7220 7468 6520  ayers after the 
+00008360: 6669 7273 7420 7477 6f20 636f 6e76 7329  first two convs)
+00008370: 2023 2323 0a20 2020 2020 2020 2020 2020   ###.           
+00008380: 2020 2020 206d 6f64 656c 5f72 6567 203d       model_reg =
+00008390: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
+000083a0: 6174 6567 6f72 6963 616c 2827 6d6f 6465  ategorical('mode
+000083b0: 6c5f 7265 6727 2c20 5b4e 6f6e 652c 2027  l_reg', [None, '
+000083c0: 6c6f 6361 6c5f 7265 7370 6f6e 7365 272c  local_response',
+000083d0: 2027 6261 7463 685f 6e6f 726d 275d 290a   'batch_norm']).
+000083e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000083f0: 2023 2323 2050 6f6f 6c69 6e67 2054 7970   ### Pooling Typ
+00008400: 6520 2323 230a 2020 2020 2020 2020 2020  e ###.          
+00008410: 2020 2020 2020 706f 6f6c 696e 675f 3120        pooling_1 
+00008420: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00008430: 6361 7465 676f 7269 6361 6c28 2770 6f6f  categorical('poo
+00008440: 6c69 6e67 5f31 272c 205b 276d 696e 272c  ling_1', ['min',
+00008450: 2027 6d61 7827 2c20 2761 7665 7261 6765   'max', 'average
+00008460: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00008470: 2020 2020 706f 6f6c 696e 675f 3220 3d20      pooling_2 = 
+00008480: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
+00008490: 7465 676f 7269 6361 6c28 2770 6f6f 6c69  tegorical('pooli
+000084a0: 6e67 5f32 272c 205b 276d 696e 272c 2027  ng_2', ['min', '
+000084b0: 6d61 7827 2c20 2761 7665 7261 6765 275d  max', 'average']
+000084c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000084d0: 2020 706f 6f6c 696e 675f 3320 3d20 7472    pooling_3 = tr
+000084e0: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
+000084f0: 676f 7269 6361 6c28 2770 6f6f 6c69 6e67  gorical('pooling
+00008500: 5f33 272c 205b 276d 696e 272c 2027 6d61  _3', ['min', 'ma
+00008510: 7827 2c20 2761 7665 7261 6765 275d 290a  x', 'average']).
+00008520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008530: 2069 6620 7365 6c66 2e6c 696d 6974 5f73   if self.limit_s
+00008540: 6561 7263 683a 0a20 2020 2020 2020 2020  earch:.         
+00008550: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00008560: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00008570: 6c2c 2068 6973 746f 7279 203d 2063 6e6e  l, history = cnn
+00008580: 5f6d 6f64 656c 2e41 6c65 784e 6574 2863  _model.AlexNet(c
+00008590: 6c61 7373 5f31 2c20 636c 6173 735f 322c  lass_1, class_2,
+000085a0: 2069 6d67 5f6e 756d 5f63 6861 6e6e 656c   img_num_channel
+000085b0: 733d 7365 6c66 2e69 6d67 5f6e 756d 5f63  s=self.img_num_c
+000085c0: 6861 6e6e 656c 732c 200a 2020 2020 2020  hannels, .      
+000085d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085e0: 2020 6e6f 726d 616c 697a 653d 7365 6c66    normalize=self
+000085f0: 2e6e 6f72 6d61 6c69 7a65 2c20 6d69 6e5f  .normalize, min_
+00008600: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
+00008610: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
+00008620: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
+00008630: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
+00008640: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
+00008650: 7373 5f32 2c20 0a20 2020 2020 2020 2020  ss_2, .         
+00008660: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00008670: 706f 6368 733d 7365 6c66 2e74 7261 696e  pochs=self.train
+00008680: 5f65 706f 6368 732c 2062 6174 6368 5f73  _epochs, batch_s
+00008690: 697a 653d 6261 7463 685f 7369 7a65 2c20  ize=batch_size, 
+000086a0: 6f70 7469 6d69 7a65 723d 6f70 7469 6d69  optimizer=optimi
+000086b0: 7a65 722c 206c 723d 6c72 2c20 6465 6361  zer, lr=lr, deca
+000086c0: 793d 6465 6361 792c 206d 6f6d 656e 7475  y=decay, momentu
+000086d0: 6d3d 6d6f 6d65 6e74 756d 2c20 6e65 7374  m=momentum, nest
+000086e0: 6572 6f76 3d6e 6573 7465 726f 762c 200a  erov=nesterov, .
+000086f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008700: 2020 2020 2020 2020 6265 7461 5f31 3d62          beta_1=b
+00008710: 6574 615f 312c 2062 6574 615f 323d 6265  eta_1, beta_2=be
+00008720: 7461 5f32 2c20 616d 7367 7261 643d 616d  ta_2, amsgrad=am
+00008730: 7367 7261 642c 206c 6f73 733d 6c6f 7373  sgrad, loss=loss
+00008740: 2c20 6163 7469 7661 7469 6f6e 5f63 6f6e  , activation_con
+00008750: 763d 6163 7469 7661 7469 6f6e 5f63 6f6e  v=activation_con
+00008760: 762c 2061 6374 6976 6174 696f 6e5f 6465  v, activation_de
+00008770: 6e73 653d 6163 7469 7661 7469 6f6e 5f64  nse=activation_d
+00008780: 656e 7365 2c20 0a20 2020 2020 2020 2020  ense, .         
+00008790: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000087a0: 6f6e 765f 696e 6974 3d63 6f6e 765f 696e  onv_init=conv_in
+000087b0: 6974 2c20 6465 6e73 655f 696e 6974 3d64  it, dense_init=d
+000087c0: 656e 7365 5f69 6e69 742c 206d 6f64 656c  ense_init, model
+000087d0: 5f72 6567 3d6d 6f64 656c 5f72 6567 2c20  _reg=model_reg, 
+000087e0: 706f 6f6c 696e 675f 313d 706f 6f6c 696e  pooling_1=poolin
+000087f0: 675f 312c 2070 6f6f 6c69 6e67 5f32 3d70  g_1, pooling_2=p
+00008800: 6f6f 6c69 6e67 5f32 2c20 706f 6f6c 696e  ooling_2, poolin
+00008810: 675f 333d 706f 6f6c 696e 675f 332c 200a  g_3=pooling_3, .
+00008820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008830: 2020 2020 2020 2020 736d 6f74 655f 7361          smote_sa
+00008840: 6d70 6c69 6e67 3d73 656c 662e 736d 6f74  mpling=self.smot
+00008850: 655f 7361 6d70 6c69 6e67 2c20 6561 726c  e_sampling, earl
+00008860: 795f 7374 6f70 5f63 616c 6c62 6163 6b3d  y_stop_callback=
+00008870: 6361 6c6c 6261 636b 732c 2063 6865 636b  callbacks, check
+00008880: 706f 696e 743d 4661 6c73 652c 2076 6572  point=False, ver
+00008890: 626f 7365 3d73 656c 662e 7665 7262 6f73  bose=self.verbos
+000088a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000088b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000088c0: 2020 2020 2020 2020 2020 2020 2023 2323               ###
+000088d0: 2046 696c 7465 7220 616e 6420 4c61 7965   Filter and Laye
+000088e0: 7220 4368 6172 6163 7465 7273 7469 6373  r Characterstics
+000088f0: 2023 2323 0a20 2020 2020 2020 2020 2020   ###.           
+00008900: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00008910: 3120 3d20 7472 6961 6c2e 7375 6767 6573  1 = trial.sugges
+00008920: 745f 696e 7428 2766 696c 7465 725f 3127  t_int('filter_1'
+00008930: 2c20 3132 2c20 3531 362c 2073 7465 703d  , 12, 516, step=
+00008940: 3132 290a 2020 2020 2020 2020 2020 2020  12).            
+00008950: 2020 2020 2020 2020 6669 6c74 6572 5f73          filter_s
+00008960: 697a 655f 3120 3d20 7472 6961 6c2e 7375  ize_1 = trial.su
+00008970: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
+00008980: 725f 7369 7a65 5f31 272c 2031 2c20 3131  r_size_1', 1, 11
+00008990: 2c20 7374 6570 3d32 290a 2020 2020 2020  , step=2).      
+000089a0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000089b0: 7269 6465 735f 3120 3d20 7472 6961 6c2e  rides_1 = trial.
+000089c0: 7375 6767 6573 745f 696e 7428 2773 7472  suggest_int('str
+000089d0: 6964 6573 5f31 272c 2031 2c20 332c 2073  ides_1', 1, 3, s
+000089e0: 7465 703d 3129 0a20 2020 2020 2020 2020  tep=1).         
+000089f0: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
+00008a00: 7369 7a65 5f31 203d 2074 7269 616c 2e73  size_1 = trial.s
+00008a10: 7567 6765 7374 5f69 6e74 2827 706f 6f6c  uggest_int('pool
+00008a20: 5f73 697a 655f 3127 2c20 312c 2037 2c20  _size_1', 1, 7, 
+00008a30: 7374 6570 3d31 290a 2020 2020 2020 2020  step=1).        
+00008a40: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00008a50: 5f73 7472 6964 655f 3120 3d20 7472 6961  _stride_1 = tria
+00008a60: 6c2e 7375 6767 6573 745f 696e 7428 2770  l.suggest_int('p
+00008a70: 6f6f 6c5f 7374 7269 6465 5f31 272c 2031  ool_stride_1', 1
+00008a80: 2c20 332c 2073 7465 703d 3129 0a0a 2020  , 3, step=1)..  
+00008a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008aa0: 2020 6669 6c74 6572 5f32 203d 2074 7269    filter_2 = tri
+00008ab0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00008ac0: 6669 6c74 6572 5f32 272c 2031 322c 2035  filter_2', 12, 5
+00008ad0: 3136 2c20 7374 6570 3d31 3229 0a20 2020  16, step=12).   
+00008ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008af0: 2066 696c 7465 725f 7369 7a65 5f32 203d   filter_size_2 =
+00008b00: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00008b10: 6e74 2827 6669 6c74 6572 5f73 697a 655f  nt('filter_size_
+00008b20: 3227 2c20 312c 2037 2c20 7374 6570 3d32  2', 1, 7, step=2
+00008b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00008b40: 2020 2020 2020 7374 7269 6465 735f 3220        strides_2 
+00008b50: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00008b60: 696e 7428 2773 7472 6964 6573 5f32 272c  int('strides_2',
+00008b70: 2031 2c20 332c 2073 7465 703d 3129 0a20   1, 3, step=1). 
+00008b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b90: 2020 2070 6f6f 6c5f 7369 7a65 5f32 203d     pool_size_2 =
+00008ba0: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00008bb0: 6e74 2827 706f 6f6c 5f73 697a 655f 3227  nt('pool_size_2'
+00008bc0: 2c20 312c 2037 2c20 7374 6570 3d31 290a  , 1, 7, step=1).
+00008bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008be0: 2020 2020 706f 6f6c 5f73 7472 6964 655f      pool_stride_
+00008bf0: 3220 3d20 7472 6961 6c2e 7375 6767 6573  2 = trial.sugges
+00008c00: 745f 696e 7428 2770 6f6f 6c5f 7374 7269  t_int('pool_stri
+00008c10: 6465 5f32 272c 2031 2c20 332c 2073 7465  de_2', 1, 3, ste
+00008c20: 703d 3129 0a0a 2020 2020 2020 2020 2020  p=1)..          
+00008c30: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00008c40: 5f33 203d 2074 7269 616c 2e73 7567 6765  _3 = trial.sugge
+00008c50: 7374 5f69 6e74 2827 6669 6c74 6572 5f33  st_int('filter_3
+00008c60: 272c 2031 322c 2035 3136 2c20 7374 6570  ', 12, 516, step
+00008c70: 3d31 3229 0a20 2020 2020 2020 2020 2020  =12).           
+00008c80: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00008c90: 7369 7a65 5f33 203d 2074 7269 616c 2e73  size_3 = trial.s
+00008ca0: 7567 6765 7374 5f69 6e74 2827 6669 6c74  uggest_int('filt
+00008cb0: 6572 5f73 697a 655f 3327 2c20 312c 2037  er_size_3', 1, 7
+00008cc0: 2c20 7374 6570 3d32 290a 2020 2020 2020  , step=2).      
+00008cd0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00008ce0: 7269 6465 735f 3320 3d20 7472 6961 6c2e  rides_3 = trial.
+00008cf0: 7375 6767 6573 745f 696e 7428 2773 7472  suggest_int('str
+00008d00: 6964 6573 5f33 272c 2031 2c20 332c 2073  ides_3', 1, 3, s
+00008d10: 7465 703d 3129 0a20 2020 2020 2020 2020  tep=1).         
+00008d20: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
+00008d30: 7369 7a65 5f33 203d 2074 7269 616c 2e73  size_3 = trial.s
+00008d40: 7567 6765 7374 5f69 6e74 2827 706f 6f6c  uggest_int('pool
+00008d50: 5f73 697a 655f 3327 2c20 312c 2037 2c20  _size_3', 1, 7, 
+00008d60: 7374 6570 3d31 290a 2020 2020 2020 2020  step=1).        
+00008d70: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00008d80: 5f73 7472 6964 655f 3320 3d20 7472 6961  _stride_3 = tria
+00008d90: 6c2e 7375 6767 6573 745f 696e 7428 2770  l.suggest_int('p
+00008da0: 6f6f 6c5f 7374 7269 6465 5f33 272c 2031  ool_stride_3', 1
+00008db0: 2c20 332c 2073 7465 703d 3129 0a0a 2020  , 3, step=1)..  
+00008dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008dd0: 2020 6669 6c74 6572 5f34 203d 2074 7269    filter_4 = tri
+00008de0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00008df0: 6669 6c74 6572 5f34 272c 2031 322c 2035  filter_4', 12, 5
+00008e00: 3136 2c20 7374 6570 3d31 3229 0a20 2020  16, step=12).   
+00008e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e20: 2066 696c 7465 725f 7369 7a65 5f34 203d   filter_size_4 =
+00008e30: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00008e40: 6e74 2827 6669 6c74 6572 5f73 697a 655f  nt('filter_size_
+00008e50: 3427 2c20 312c 2037 2c20 7374 6570 3d32  4', 1, 7, step=2
+00008e60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00008e70: 2020 2020 2020 7374 7269 6465 735f 3420        strides_4 
+00008e80: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00008e90: 696e 7428 2773 7472 6964 6573 5f34 272c  int('strides_4',
+00008ea0: 2031 2c20 332c 2073 7465 703d 3129 0a0a   1, 3, step=1)..
+00008eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ec0: 2020 2020 6669 6c74 6572 5f35 203d 2074      filter_5 = t
+00008ed0: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+00008ee0: 2827 6669 6c74 6572 5f35 272c 2031 322c  ('filter_5', 12,
+00008ef0: 2035 3136 2c20 7374 6570 3d31 3229 0a20   516, step=12). 
+00008f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f10: 2020 2066 696c 7465 725f 7369 7a65 5f35     filter_size_5
+00008f20: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00008f30: 5f69 6e74 2827 6669 6c74 6572 5f73 697a  _int('filter_siz
+00008f40: 655f 3527 2c20 312c 2037 2c20 7374 6570  e_5', 1, 7, step
+00008f50: 3d32 290a 2020 2020 2020 2020 2020 2020  =2).            
+00008f60: 2020 2020 2020 2020 7374 7269 6465 735f          strides_
+00008f70: 3520 3d20 7472 6961 6c2e 7375 6767 6573  5 = trial.sugges
+00008f80: 745f 696e 7428 2773 7472 6964 6573 5f35  t_int('strides_5
+00008f90: 272c 2031 2c20 332c 2073 7465 703d 3129  ', 1, 3, step=1)
+00008fa0: 200a 0a20 2020 2020 2020 2020 2020 2020   ..             
+00008fb0: 2020 2020 2020 2023 2323 2044 656e 7365         ### Dense
+00008fc0: 204c 6179 6572 7320 2323 230a 2020 2020   Layers ###.    
+00008fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fe0: 6465 6e73 655f 6e65 7572 6f6e 735f 3120  dense_neurons_1 
+00008ff0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00009000: 696e 7428 2764 656e 7365 5f6e 6575 726f  int('dense_neuro
+00009010: 6e73 5f31 272c 2031 3238 2c20 3634 3030  ns_1', 128, 6400
+00009020: 2c20 7374 6570 3d31 3238 290a 2020 2020  , step=128).    
+00009030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009040: 6465 6e73 655f 6e65 7572 6f6e 735f 3220  dense_neurons_2 
+00009050: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00009060: 696e 7428 2764 656e 7365 5f6e 6575 726f  int('dense_neuro
+00009070: 6e73 5f32 272c 2031 3238 2c20 3634 3030  ns_2', 128, 6400
+00009080: 2c20 7374 6570 3d31 3238 290a 2020 2020  , step=128).    
+00009090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090a0: 6472 6f70 6f75 745f 3120 3d20 7472 6961  dropout_1 = tria
+000090b0: 6c2e 7375 6767 6573 745f 666c 6f61 7428  l.suggest_float(
+000090c0: 2764 726f 706f 7574 5f31 272c 2030 2e30  'dropout_1', 0.0
+000090d0: 2c20 302e 352c 2073 7465 703d 302e 3031  , 0.5, step=0.01
+000090e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000090f0: 2020 2020 2020 6472 6f70 6f75 745f 3220        dropout_2 
+00009100: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00009110: 666c 6f61 7428 2764 726f 706f 7574 5f32  float('dropout_2
+00009120: 272c 2030 2e30 2c20 302e 352c 2073 7465  ', 0.0, 0.5, ste
+00009130: 703d 302e 3031 2920 0a0a 2020 2020 2020  p=0.01) ..      
+00009140: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+00009150: 6465 6c2c 2068 6973 746f 7279 203d 2063  del, history = c
+00009160: 6e6e 5f6d 6f64 656c 2e41 6c65 784e 6574  nn_model.AlexNet
+00009170: 2863 6c61 7373 5f31 2c20 636c 6173 735f  (class_1, class_
+00009180: 322c 2069 6d67 5f6e 756d 5f63 6861 6e6e  2, img_num_chann
+00009190: 656c 733d 7365 6c66 2e69 6d67 5f6e 756d  els=self.img_num
+000091a0: 5f63 6861 6e6e 656c 732c 200a 2020 2020  _channels, .    
+000091b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091c0: 2020 2020 6e6f 726d 616c 697a 653d 7365      normalize=se
+000091d0: 6c66 2e6e 6f72 6d61 6c69 7a65 2c20 6d69  lf.normalize, mi
+000091e0: 6e5f 7069 7865 6c3d 6d69 6e5f 7069 782c  n_pixel=min_pix,
+000091f0: 206d 6178 5f70 6978 656c 3d6d 6178 5f70   max_pixel=max_p
+00009200: 6978 2c20 7661 6c5f 706f 7369 7469 7665  ix, val_positive
+00009210: 3d76 616c 5f63 6c61 7373 5f31 2c20 7661  =val_class_1, va
+00009220: 6c5f 6e65 6761 7469 7665 3d76 616c 5f63  l_negative=val_c
+00009230: 6c61 7373 5f32 2c20 0a20 2020 2020 2020  lass_2, .       
+00009240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009250: 2065 706f 6368 733d 7365 6c66 2e74 7261   epochs=self.tra
+00009260: 696e 5f65 706f 6368 732c 2062 6174 6368  in_epochs, batch
+00009270: 5f73 697a 653d 6261 7463 685f 7369 7a65  _size=batch_size
+00009280: 2c20 6f70 7469 6d69 7a65 723d 6f70 7469  , optimizer=opti
+00009290: 6d69 7a65 722c 206c 723d 6c72 2c20 6465  mizer, lr=lr, de
+000092a0: 6361 793d 6465 6361 792c 206d 6f6d 656e  cay=decay, momen
+000092b0: 7475 6d3d 6d6f 6d65 6e74 756d 2c20 6e65  tum=momentum, ne
+000092c0: 7374 6572 6f76 3d6e 6573 7465 726f 762c  sterov=nesterov,
+000092d0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+000092e0: 2020 2020 2020 2020 2020 6265 7461 5f31            beta_1
+000092f0: 3d62 6574 615f 312c 2062 6574 615f 323d  =beta_1, beta_2=
+00009300: 6265 7461 5f32 2c20 616d 7367 7261 643d  beta_2, amsgrad=
+00009310: 616d 7367 7261 642c 206c 6f73 733d 6c6f  amsgrad, loss=lo
+00009320: 7373 2c20 6163 7469 7661 7469 6f6e 5f63  ss, activation_c
+00009330: 6f6e 763d 6163 7469 7661 7469 6f6e 5f63  onv=activation_c
+00009340: 6f6e 762c 2061 6374 6976 6174 696f 6e5f  onv, activation_
+00009350: 6465 6e73 653d 6163 7469 7661 7469 6f6e  dense=activation
+00009360: 5f64 656e 7365 2c20 0a20 2020 2020 2020  _dense, .       
+00009370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009380: 2063 6f6e 765f 696e 6974 3d63 6f6e 765f   conv_init=conv_
+00009390: 696e 6974 2c20 6465 6e73 655f 696e 6974  init, dense_init
+000093a0: 3d64 656e 7365 5f69 6e69 742c 206d 6f64  =dense_init, mod
+000093b0: 656c 5f72 6567 3d6d 6f64 656c 5f72 6567  el_reg=model_reg
+000093c0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+000093d0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+000093e0: 725f 313d 6669 6c74 6572 5f31 2c20 6669  r_1=filter_1, fi
+000093f0: 6c74 6572 5f73 697a 655f 313d 6669 6c74  lter_size_1=filt
+00009400: 6572 5f73 697a 655f 312c 2073 7472 6964  er_size_1, strid
+00009410: 6573 5f31 3d73 7472 6964 6573 5f31 2c20  es_1=strides_1, 
+00009420: 706f 6f6c 696e 675f 313d 706f 6f6c 696e  pooling_1=poolin
+00009430: 675f 312c 2070 6f6f 6c5f 7369 7a65 5f31  g_1, pool_size_1
+00009440: 3d70 6f6f 6c5f 7369 7a65 5f31 2c20 706f  =pool_size_1, po
+00009450: 6f6c 5f73 7472 6964 655f 313d 706f 6f6c  ol_stride_1=pool
+00009460: 5f73 7472 6964 655f 312c 0a20 2020 2020  _stride_1,.     
+00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009480: 2020 2066 696c 7465 725f 323d 6669 6c74     filter_2=filt
+00009490: 6572 5f32 2c20 6669 6c74 6572 5f73 697a  er_2, filter_siz
+000094a0: 655f 323d 6669 6c74 6572 5f73 697a 655f  e_2=filter_size_
+000094b0: 322c 2073 7472 6964 6573 5f32 3d73 7472  2, strides_2=str
+000094c0: 6964 6573 5f32 2c20 706f 6f6c 696e 675f  ides_2, pooling_
+000094d0: 323d 706f 6f6c 696e 675f 322c 2070 6f6f  2=pooling_2, poo
+000094e0: 6c5f 7369 7a65 5f32 3d70 6f6f 6c5f 7369  l_size_2=pool_si
+000094f0: 7a65 5f32 2c20 706f 6f6c 5f73 7472 6964  ze_2, pool_strid
+00009500: 655f 323d 706f 6f6c 5f73 7472 6964 655f  e_2=pool_stride_
+00009510: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+00009520: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00009530: 725f 333d 6669 6c74 6572 5f33 2c20 6669  r_3=filter_3, fi
+00009540: 6c74 6572 5f73 697a 655f 333d 6669 6c74  lter_size_3=filt
+00009550: 6572 5f73 697a 655f 332c 2073 7472 6964  er_size_3, strid
+00009560: 6573 5f33 3d73 7472 6964 6573 5f33 2c20  es_3=strides_3, 
+00009570: 706f 6f6c 696e 675f 333d 706f 6f6c 696e  pooling_3=poolin
+00009580: 675f 332c 2070 6f6f 6c5f 7369 7a65 5f33  g_3, pool_size_3
+00009590: 3d70 6f6f 6c5f 7369 7a65 5f33 2c20 706f  =pool_size_3, po
+000095a0: 6f6c 5f73 7472 6964 655f 333d 706f 6f6c  ol_stride_3=pool
+000095b0: 5f73 7472 6964 655f 332c 0a20 2020 2020  _stride_3,.     
+000095c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095d0: 2020 2066 696c 7465 725f 343d 6669 6c74     filter_4=filt
+000095e0: 6572 5f34 2c20 6669 6c74 6572 5f73 697a  er_4, filter_siz
+000095f0: 655f 343d 6669 6c74 6572 5f73 697a 655f  e_4=filter_size_
+00009600: 342c 2073 7472 6964 6573 5f34 3d73 7472  4, strides_4=str
+00009610: 6964 6573 5f34 2c20 0a20 2020 2020 2020  ides_4, .       
+00009620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009630: 2066 696c 7465 725f 353d 6669 6c74 6572   filter_5=filter
+00009640: 5f35 2c20 6669 6c74 6572 5f73 697a 655f  _5, filter_size_
+00009650: 353d 6669 6c74 6572 5f73 697a 655f 352c  5=filter_size_5,
+00009660: 2073 7472 6964 6573 5f35 3d73 7472 6964   strides_5=strid
+00009670: 6573 5f35 2c0a 2020 2020 2020 2020 2020  es_5,.          
+00009680: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00009690: 6e73 655f 6e65 7572 6f6e 735f 313d 6465  nse_neurons_1=de
+000096a0: 6e73 655f 6e65 7572 6f6e 735f 312c 2064  nse_neurons_1, d
+000096b0: 656e 7365 5f6e 6575 726f 6e73 5f32 3d64  ense_neurons_2=d
+000096c0: 656e 7365 5f6e 6575 726f 6e73 5f32 2c20  ense_neurons_2, 
+000096d0: 6472 6f70 6f75 745f 313d 6472 6f70 6f75  dropout_1=dropou
+000096e0: 745f 312c 2064 726f 706f 7574 5f32 3d64  t_1, dropout_2=d
+000096f0: 726f 706f 7574 5f32 2c20 0a20 2020 2020  ropout_2, .     
+00009700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009710: 2020 2073 6d6f 7465 5f73 616d 706c 696e     smote_samplin
+00009720: 673d 7365 6c66 2e73 6d6f 7465 5f73 616d  g=self.smote_sam
+00009730: 706c 696e 672c 2065 6172 6c79 5f73 746f  pling, early_sto
+00009740: 705f 6361 6c6c 6261 636b 3d63 616c 6c62  p_callback=callb
+00009750: 6163 6b73 2c20 6368 6563 6b70 6f69 6e74  acks, checkpoint
+00009760: 3d46 616c 7365 2c20 7665 7262 6f73 653d  =False, verbose=
+00009770: 7365 6c66 2e76 6572 626f 7365 290a 0a20  self.verbose).. 
+00009780: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00009790: 7365 6c66 2e63 6c66 203d 3d20 2772 6573  self.clf == 'res
+000097a0: 6e65 7431 3827 3a0a 0a20 2020 2020 2020  net18':..       
+000097b0: 2020 2020 2020 2020 2023 2323 2052 6567           ### Reg
+000097c0: 756c 6172 697a 6174 696f 6e20 5465 6368  ularization Tech
+000097d0: 6e69 7175 6520 284e 6f74 6520 7468 6174  nique (Note that
+000097e0: 2069 6620 7573 696e 6720 4c52 4e2c 2074   if using LRN, t
+000097f0: 6865 6e20 7468 6520 626c 6f63 6b73 2077  hen the blocks w
+00009800: 6f6e 2774 2068 6176 6520 414e 5920 7265  on't have ANY re
+00009810: 6775 6c61 7269 7a61 7469 6f6e 2073 696e  gularization sin
+00009820: 6365 2074 6865 206f 6e6c 7920 6f70 7469  ce the only opti
+00009830: 6f6e 2069 7320 2762 6174 6368 5f6e 6f72  on is 'batch_nor
+00009840: 6d27 2066 6f72 2074 6865 2062 6c6f 636b  m' for the block
+00009850: 7329 2023 2323 0a20 2020 2020 2020 2020  s) ###.         
+00009860: 2020 2020 2020 206d 6f64 656c 5f72 6567         model_reg
+00009870: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00009880: 5f63 6174 6567 6f72 6963 616c 2827 6d6f  _categorical('mo
+00009890: 6465 6c5f 7265 6727 2c20 5b4e 6f6e 652c  del_reg', [None,
+000098a0: 2027 6c6f 6361 6c5f 7265 7370 6f6e 7365   'local_response
+000098b0: 272c 2027 6261 7463 685f 6e6f 726d 275d  ', 'batch_norm']
+000098c0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000098d0: 2020 2023 4f6e 6c79 206f 6e65 2070 6f6f     #Only one poo
+000098e0: 6c69 6e67 206c 6179 6572 2069 7320 7573  ling layer is us
+000098f0: 6564 2061 7420 7468 6520 7665 7279 2062  ed at the very b
+00009900: 6567 696e 6e69 6e67 206f 6620 7468 6520  eginning of the 
+00009910: 6d6f 6465 6c0a 2020 2020 2020 2020 2020  model.          
+00009920: 2020 2020 2020 706f 6f6c 696e 6720 3d20        pooling = 
+00009930: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
+00009940: 7465 676f 7269 6361 6c28 2770 6f6f 6c69  tegorical('pooli
+00009950: 6e67 272c 205b 276d 696e 272c 2027 6d61  ng', ['min', 'ma
+00009960: 7827 2c20 2761 7665 7261 6765 275d 290a  x', 'average']).
+00009970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009980: 2069 6620 7365 6c66 2e6c 696d 6974 5f73   if self.limit_s
+00009990: 6561 7263 683a 2020 200a 0a20 2020 2020  earch:   ..     
+000099a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000099b0: 6f64 656c 2c20 6869 7374 6f72 7920 3d20  odel, history = 
+000099c0: 636e 6e5f 6d6f 6465 6c2e 5265 736e 6574  cnn_model.Resnet
+000099d0: 3138 2863 6c61 7373 5f31 2c20 636c 6173  18(class_1, clas
+000099e0: 735f 322c 2069 6d67 5f6e 756d 5f63 6861  s_2, img_num_cha
+000099f0: 6e6e 656c 733d 7365 6c66 2e69 6d67 5f6e  nnels=self.img_n
+00009a00: 756d 5f63 6861 6e6e 656c 732c 200a 2020  um_channels, .  
+00009a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a20: 2020 2020 2020 6e6f 726d 616c 697a 653d        normalize=
+00009a30: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 2c20  self.normalize, 
+00009a40: 6d69 6e5f 7069 7865 6c3d 6d69 6e5f 7069  min_pixel=min_pi
+00009a50: 782c 206d 6178 5f70 6978 656c 3d6d 6178  x, max_pixel=max
+00009a60: 5f70 6978 2c20 7661 6c5f 706f 7369 7469  _pix, val_positi
+00009a70: 7665 3d76 616c 5f63 6c61 7373 5f31 2c20  ve=val_class_1, 
+00009a80: 7661 6c5f 6e65 6761 7469 7665 3d76 616c  val_negative=val
+00009a90: 5f63 6c61 7373 5f32 2c20 0a20 2020 2020  _class_2, .     
+00009aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ab0: 2020 2065 706f 6368 733d 7365 6c66 2e74     epochs=self.t
+00009ac0: 7261 696e 5f65 706f 6368 732c 2062 6174  rain_epochs, bat
+00009ad0: 6368 5f73 697a 653d 6261 7463 685f 7369  ch_size=batch_si
+00009ae0: 7a65 2c20 6f70 7469 6d69 7a65 723d 6f70  ze, optimizer=op
+00009af0: 7469 6d69 7a65 722c 206c 723d 6c72 2c20  timizer, lr=lr, 
+00009b00: 6465 6361 793d 6465 6361 792c 206d 6f6d  decay=decay, mom
+00009b10: 656e 7475 6d3d 6d6f 6d65 6e74 756d 2c20  entum=momentum, 
+00009b20: 6e65 7374 6572 6f76 3d6e 6573 7465 726f  nesterov=nestero
+00009b30: 762c 200a 2020 2020 2020 2020 2020 2020  v, .            
+00009b40: 2020 2020 2020 2020 2020 2020 6265 7461              beta
+00009b50: 5f31 3d62 6574 615f 312c 2062 6574 615f  _1=beta_1, beta_
+00009b60: 323d 6265 7461 5f32 2c20 616d 7367 7261  2=beta_2, amsgra
+00009b70: 643d 616d 7367 7261 642c 206c 6f73 733d  d=amsgrad, loss=
+00009b80: 6c6f 7373 2c20 6163 7469 7661 7469 6f6e  loss, activation
+00009b90: 5f63 6f6e 763d 6163 7469 7661 7469 6f6e  _conv=activation
+00009ba0: 5f63 6f6e 762c 2061 6374 6976 6174 696f  _conv, activatio
+00009bb0: 6e5f 6465 6e73 653d 6163 7469 7661 7469  n_dense=activati
+00009bc0: 6f6e 5f64 656e 7365 2c20 0a20 2020 2020  on_dense, .     
+00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009be0: 2020 2063 6f6e 765f 696e 6974 3d63 6f6e     conv_init=con
+00009bf0: 765f 696e 6974 2c20 6465 6e73 655f 696e  v_init, dense_in
+00009c00: 6974 3d64 656e 7365 5f69 6e69 742c 206d  it=dense_init, m
+00009c10: 6f64 656c 5f72 6567 3d6d 6f64 656c 5f72  odel_reg=model_r
+00009c20: 6567 2c20 706f 6f6c 696e 673d 706f 6f6c  eg, pooling=pool
+00009c30: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
+00009c40: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
+00009c50: 7465 5f73 616d 706c 696e 673d 7365 6c66  te_sampling=self
+00009c60: 2e73 6d6f 7465 5f73 616d 706c 696e 672c  .smote_sampling,
+00009c70: 2065 6172 6c79 5f73 746f 705f 6361 6c6c   early_stop_call
+00009c80: 6261 636b 3d63 616c 6c62 6163 6b73 2c20  back=callbacks, 
+00009c90: 6368 6563 6b70 6f69 6e74 3d46 616c 7365  checkpoint=False
+00009ca0: 2c20 7665 7262 6f73 653d 7365 6c66 2e76  , verbose=self.v
+00009cb0: 6572 626f 7365 290a 2020 2020 2020 2020  erbose).        
+00009cc0: 2020 2020 2020 2020 656c 7365 3a0a 0a20          else:.. 
+00009cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ce0: 2020 2066 696c 7465 7273 203d 2074 7269     filters = tri
+00009cf0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00009d00: 6669 6c74 6572 7327 2c20 3132 2c20 3531  filters', 12, 51
+00009d10: 362c 2073 7465 703d 3132 290a 2020 2020  6, step=12).    
+00009d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d30: 6669 6c74 6572 5f73 697a 6520 3d20 7472  filter_size = tr
+00009d40: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00009d50: 2766 696c 7465 725f 7369 7a65 272c 2031  'filter_size', 1
+00009d60: 2c20 372c 2073 7465 703d 3229 0a20 2020  , 7, step=2).   
 00009d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d80: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
-00009d90: 5f6e 756d 5f63 6861 6e6e 656c 7320 3d3d  _num_channels ==
-00009da0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00009db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dc0: 2020 2020 7661 6c5f 636c 6173 735f 3120      val_class_1 
-00009dd0: 3d20 6461 7461 5f70 726f 6365 7373 696e  = data_processin
-00009de0: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
-00009df0: 7328 7661 6c5f 6368 616e 6e65 6c31 2c20  s(val_channel1, 
-00009e00: 7661 6c5f 6368 616e 6e65 6c32 290a 2020  val_channel2).  
-00009e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00009e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e50: 7661 6c5f 6368 616e 6e65 6c33 203d 2072  val_channel3 = r
-00009e60: 6573 697a 6528 7661 6c5f 636c 6173 735f  esize(val_class_
-00009e70: 315b 3a2c 3a2c 3a2c 325d 2c20 7369 7a65  1[:,:,:,2], size
-00009e80: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ea0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00009eb0: 5f63 6c61 7373 5f31 203d 2064 6174 615f  _class_1 = data_
-00009ec0: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
-00009ed0: 745f 6368 616e 6e65 6c73 2876 616c 5f63  t_channels(val_c
-00009ee0: 6861 6e6e 656c 312c 2076 616c 5f63 6861  hannel1, val_cha
-00009ef0: 6e6e 656c 322c 2076 616c 5f63 6861 6e6e  nnel2, val_chann
-00009f00: 656c 3329 0a0a 2020 2020 2020 2020 2020  el3)..          
-00009f10: 2020 2020 2020 2020 2020 6966 2076 616c            if val
-00009f20: 5f63 6c61 7373 5f32 2069 7320 6e6f 7420  _class_2 is not 
-00009f30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00009f40: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009f50: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
-00009f60: 616e 6e65 6c73 203d 3d20 313a 0a20 2020  annels == 1:.   
+00009d80: 2073 7472 6964 6573 203d 2074 7269 616c   strides = trial
+00009d90: 2e73 7567 6765 7374 5f69 6e74 2827 7374  .suggest_int('st
+00009da0: 7269 6465 7327 2c20 312c 2033 2c20 7374  rides', 1, 3, st
+00009db0: 6570 3d31 290a 2020 2020 2020 2020 2020  ep=1).          
+00009dc0: 2020 2020 2020 2020 2020 706f 6f6c 5f73            pool_s
+00009dd0: 697a 6520 3d20 7472 6961 6c2e 7375 6767  ize = trial.sugg
+00009de0: 6573 745f 696e 7428 2770 6f6f 6c5f 7369  est_int('pool_si
+00009df0: 7a65 272c 2031 2c20 372c 2073 7465 703d  ze', 1, 7, step=
+00009e00: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+00009e10: 2020 2020 2020 2070 6f6f 6c5f 7374 7269         pool_stri
+00009e20: 6465 203d 2074 7269 616c 2e73 7567 6765  de = trial.sugge
+00009e30: 7374 5f69 6e74 2827 706f 6f6c 5f73 7472  st_int('pool_str
+00009e40: 6964 6527 2c20 312c 2033 2c20 7374 6570  ide', 1, 3, step
+00009e50: 3d31 290a 0a20 2020 2020 2020 2020 2020  =1)..           
+00009e60: 2020 2020 2020 2020 2062 6c6f 636b 5f66           block_f
+00009e70: 696c 7465 7273 5f31 203d 2074 7269 616c  ilters_1 = trial
+00009e80: 2e73 7567 6765 7374 5f69 6e74 2827 626c  .suggest_int('bl
+00009e90: 6f63 6b5f 6669 6c74 6572 735f 3127 2c20  ock_filters_1', 
+00009ea0: 3132 2c20 3531 362c 2073 7465 703d 3132  12, 516, step=12
+00009eb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009ec0: 2020 2020 2020 626c 6f63 6b5f 6669 6c74        block_filt
+00009ed0: 6572 735f 3220 3d20 7472 6961 6c2e 7375  ers_2 = trial.su
+00009ee0: 6767 6573 745f 696e 7428 2762 6c6f 636b  ggest_int('block
+00009ef0: 5f66 696c 7465 7273 5f32 272c 2031 322c  _filters_2', 12,
+00009f00: 2035 3136 2c20 7374 6570 3d31 3229 200a   516, step=12) .
+00009f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f20: 2020 2020 626c 6f63 6b5f 6669 6c74 6572      block_filter
+00009f30: 735f 3320 3d20 7472 6961 6c2e 7375 6767  s_3 = trial.sugg
+00009f40: 6573 745f 696e 7428 2762 6c6f 636b 5f66  est_int('block_f
+00009f50: 696c 7465 7273 5f33 272c 2031 322c 2035  ilters_3', 12, 5
+00009f60: 3136 2c20 7374 6570 3d31 3229 0a20 2020  16, step=12).   
 00009f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f80: 2020 2020 2020 2020 2076 616c 5f63 6c61           val_cla
-00009f90: 7373 5f32 203d 2072 6573 697a 6528 7661  ss_2 = resize(va
-00009fa0: 6c5f 636c 6173 735f 322c 2073 697a 653d  l_class_2, size=
-00009fb0: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
-00009fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fd0: 2020 2020 656c 6966 2073 656c 662e 696d      elif self.im
-00009fe0: 675f 6e75 6d5f 6368 616e 6e65 6c73 203e  g_num_channels >
-00009ff0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0000a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a010: 7661 6c5f 6368 616e 6e65 6c31 203d 2072  val_channel1 = r
-0000a020: 6573 697a 6528 7661 6c5f 636c 6173 735f  esize(val_class_
-0000a030: 325b 3a2c 3a2c 3a2c 305d 2c20 7369 7a65  2[:,:,:,0], size
-0000a040: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
-0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a060: 2020 2020 2020 2020 2076 616c 5f63 6861           val_cha
-0000a070: 6e6e 656c 3220 3d20 7265 7369 7a65 2876  nnel2 = resize(v
-0000a080: 616c 5f63 6c61 7373 5f32 5b3a 2c3a 2c3a  al_class_2[:,:,:
-0000a090: 2c31 5d2c 2073 697a 653d 696d 6167 655f  ,1], size=image_
-0000a0a0: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
-0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0c0: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
-0000a0d0: 6d5f 6368 616e 6e65 6c73 203d 3d20 323a  m_channels == 2:
-0000a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a100: 2076 616c 5f63 6c61 7373 5f32 203d 2064   val_class_2 = d
-0000a110: 6174 615f 7072 6f63 6573 7369 6e67 2e63  ata_processing.c
-0000a120: 6f6e 6361 745f 6368 616e 6e65 6c73 2876  oncat_channels(v
-0000a130: 616c 5f63 6861 6e6e 656c 312c 2076 616c  al_channel1, val
-0000a140: 5f63 6861 6e6e 656c 3229 0a20 2020 2020  _channel2).     
-0000a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a160: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a180: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0000a190: 5f63 6861 6e6e 656c 3320 3d20 7265 7369  _channel3 = resi
-0000a1a0: 7a65 2876 616c 5f63 6c61 7373 5f32 5b3a  ze(val_class_2[:
-0000a1b0: 2c3a 2c3a 2c32 5d2c 2073 697a 653d 696d  ,:,:,2], size=im
-0000a1c0: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
-0000a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1e0: 2020 2020 2020 2020 2020 7661 6c5f 636c            val_cl
-0000a1f0: 6173 735f 3220 3d20 6461 7461 5f70 726f  ass_2 = data_pro
-0000a200: 6365 7373 696e 672e 636f 6e63 6174 5f63  cessing.concat_c
-0000a210: 6861 6e6e 656c 7328 7661 6c5f 6368 616e  hannels(val_chan
-0000a220: 6e65 6c31 2c20 7661 6c5f 6368 616e 6e65  nel1, val_channe
-0000a230: 6c32 2c20 7661 6c5f 6368 616e 6e65 6c33  l2, val_channel3
-0000a240: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000a250: 2020 2069 6620 7365 6c66 2e76 6572 626f     if self.verbo
-0000a260: 7365 203d 3d20 313a 0a20 2020 2020 2020  se == 1:.       
-0000a270: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000a280: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-0000a290: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0000a2a0: 2a2a 2a2a 2a2a 2a2a 2a2a 2a20 2043 5620  ***********  CV 
-0000a2b0: 2d20 7b7d 202a 2a2a 2a2a 2a2a 2a2a 2a2a  - {} ***********
-0000a2c0: 272e 666f 726d 6174 286b 2b32 2929 0a20  '.format(k+2)). 
-0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2e0: 2020 2070 7269 6e74 2829 0a0a 2020 2020     print()..    
-0000a2f0: 2020 2020 2020 2020 2020 2020 636c 6561              clea
-0000a300: 725f 7365 7373 696f 6e28 290a 2020 2020  r_session().    
-0000a310: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000a320: 656c 662e 6f70 745f 6d6f 6465 6c20 6973  elf.opt_model is
-0000a330: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-0000a340: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0000a350: 6c2c 2068 6973 746f 7279 203d 2063 6e6e  l, history = cnn
-0000a360: 5f6d 6f64 656c 2e41 6c65 784e 6574 2863  _model.AlexNet(c
-0000a370: 6c61 7373 5f31 2c20 636c 6173 735f 322c  lass_1, class_2,
-0000a380: 2069 6d67 5f6e 756d 5f63 6861 6e6e 656c   img_num_channel
-0000a390: 733d 7365 6c66 2e69 6d67 5f6e 756d 5f63  s=self.img_num_c
-0000a3a0: 6861 6e6e 656c 732c 206e 6f72 6d61 6c69  hannels, normali
-0000a3b0: 7a65 3d73 656c 662e 6e6f 726d 616c 697a  ze=self.normaliz
-0000a3c0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-0000a3d0: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-0000a3e0: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
-0000a3f0: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
-0000a400: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
-0000a410: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
-0000a420: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
-0000a430: 7373 5f32 2c20 6570 6f63 6873 3d73 656c  ss_2, epochs=sel
-0000a440: 662e 7472 6169 6e5f 6570 6f63 6873 2c20  f.train_epochs, 
-0000a450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a460: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
-0000a470: 697a 653d 6261 7463 685f 7369 7a65 2c20  ize=batch_size, 
-0000a480: 6c72 3d6c 722c 206d 6f6d 656e 7475 6d3d  lr=lr, momentum=
-0000a490: 6d6f 6d65 6e74 756d 2c20 6465 6361 793d  momentum, decay=
-0000a4a0: 6465 6361 792c 206e 6573 7465 726f 763d  decay, nesterov=
-0000a4b0: 6e65 7374 6572 6f76 2c20 6561 726c 795f  nesterov, early_
-0000a4c0: 7374 6f70 5f63 616c 6c62 6163 6b3d 6361  stop_callback=ca
-0000a4d0: 6c6c 6261 636b 732c 200a 2020 2020 2020  llbacks, .      
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 636f 6e76 5f69 6e69 743d 636f 6e76    conv_init=conv
-0000a500: 5f69 6e69 742c 2064 656e 7365 5f69 6e69  _init, dense_ini
-0000a510: 743d 6465 6e73 655f 696e 6974 2c20 6368  t=dense_init, ch
-0000a520: 6563 6b70 6f69 6e74 3d46 616c 7365 2c20  eckpoint=False, 
-0000a530: 7665 7262 6f73 653d 7365 6c66 2e76 6572  verbose=self.ver
-0000a540: 626f 7365 2c20 6f70 7469 6d69 7a65 723d  bose, optimizer=
-0000a550: 6f70 7469 6d69 7a65 722c 2073 6d6f 7465  optimizer, smote
-0000a560: 5f73 616d 706c 696e 673d 7365 6c66 2e73  _sampling=self.s
-0000a570: 6d6f 7465 5f73 616d 706c 696e 6729 0a20  mote_sampling). 
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000a590: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000a5a0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000a5b0: 2e6c 696d 6974 5f73 6561 7263 683a 0a20  .limit_search:. 
-0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5d0: 2020 2020 2020 206d 6f64 656c 2c20 6869         model, hi
-0000a5e0: 7374 6f72 7920 3d20 636e 6e5f 6d6f 6465  story = cnn_mode
-0000a5f0: 6c2e 416c 6578 4e65 7428 636c 6173 735f  l.AlexNet(class_
-0000a600: 312c 2063 6c61 7373 5f32 2c20 696d 675f  1, class_2, img_
-0000a610: 6e75 6d5f 6368 616e 6e65 6c73 3d73 656c  num_channels=sel
-0000a620: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
-0000a630: 6c73 2c20 0a20 2020 2020 2020 2020 2020  ls, .           
-0000a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a650: 206e 6f72 6d61 6c69 7a65 3d73 656c 662e   normalize=self.
-0000a660: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
-0000a670: 6978 656c 3d6d 696e 5f70 6978 2c20 6d61  ixel=min_pix, ma
-0000a680: 785f 7069 7865 6c3d 6d61 785f 7069 782c  x_pixel=max_pix,
-0000a690: 2076 616c 5f70 6f73 6974 6976 653d 7661   val_positive=va
-0000a6a0: 6c5f 636c 6173 735f 312c 2076 616c 5f6e  l_class_1, val_n
-0000a6b0: 6567 6174 6976 653d 7661 6c5f 636c 6173  egative=val_clas
-0000a6c0: 735f 322c 200a 2020 2020 2020 2020 2020  s_2, .          
-0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6e0: 2020 6570 6f63 6873 3d73 656c 662e 7472    epochs=self.tr
-0000a6f0: 6169 6e5f 6570 6f63 6873 2c20 6261 7463  ain_epochs, batc
-0000a700: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
-0000a710: 652c 206c 723d 6c72 2c20 6d6f 6d65 6e74  e, lr=lr, moment
-0000a720: 756d 3d6d 6f6d 656e 7475 6d2c 2064 6563  um=momentum, dec
-0000a730: 6179 3d64 6563 6179 2c20 6e65 7374 6572  ay=decay, nester
-0000a740: 6f76 3d6e 6573 7465 726f 762c 200a 2020  ov=nesterov, .  
-0000a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a760: 2020 2020 2020 2020 2020 6c6f 7373 3d6c            loss=l
-0000a770: 6f73 732c 2061 6374 6976 6174 696f 6e5f  oss, activation_
-0000a780: 636f 6e76 3d61 6374 6976 6174 696f 6e5f  conv=activation_
-0000a790: 636f 6e76 2c20 6163 7469 7661 7469 6f6e  conv, activation
-0000a7a0: 5f64 656e 7365 3d61 6374 6976 6174 696f  _dense=activatio
-0000a7b0: 6e5f 6465 6e73 652c 206d 6f64 656c 5f72  n_dense, model_r
-0000a7c0: 6567 3d6d 6f64 656c 5f72 6567 2c20 0a20  eg=model_reg, . 
-0000a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7e0: 2020 2020 2020 2020 2020 2063 6f6e 765f             conv_
-0000a7f0: 696e 6974 3d63 6f6e 765f 696e 6974 2c20  init=conv_init, 
-0000a800: 6465 6e73 655f 696e 6974 3d64 656e 7365  dense_init=dense
-0000a810: 5f69 6e69 742c 206f 7074 696d 697a 6572  _init, optimizer
-0000a820: 3d6f 7074 696d 697a 6572 2c20 6561 726c  =optimizer, earl
-0000a830: 795f 7374 6f70 5f63 616c 6c62 6163 6b3d  y_stop_callback=
-0000a840: 6361 6c6c 6261 636b 732c 2063 6865 636b  callbacks, check
-0000a850: 706f 696e 743d 4661 6c73 652c 2076 6572  point=False, ver
-0000a860: 626f 7365 3d73 656c 662e 7665 7262 6f73  bose=self.verbos
-0000a870: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-0000a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a890: 706f 6f6c 696e 675f 313d 706f 6f6c 696e  pooling_1=poolin
-0000a8a0: 675f 312c 2070 6f6f 6c69 6e67 5f32 3d70  g_1, pooling_2=p
-0000a8b0: 6f6f 6c69 6e67 5f32 2c20 706f 6f6c 696e  ooling_2, poolin
-0000a8c0: 675f 333d 706f 6f6c 696e 675f 332c 2073  g_3=pooling_3, s
-0000a8d0: 6d6f 7465 5f73 616d 706c 696e 673d 7365  mote_sampling=se
-0000a8e0: 6c66 2e73 6d6f 7465 5f73 616d 706c 696e  lf.smote_samplin
-0000a8f0: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
-0000a900: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a920: 2020 2020 206d 6f64 656c 2c20 6869 7374       model, hist
-0000a930: 6f72 7920 3d20 636e 6e5f 6d6f 6465 6c2e  ory = cnn_model.
-0000a940: 416c 6578 4e65 7428 636c 6173 735f 312c  AlexNet(class_1,
-0000a950: 2063 6c61 7373 5f32 2c20 696d 675f 6e75   class_2, img_nu
-0000a960: 6d5f 6368 616e 6e65 6c73 3d73 656c 662e  m_channels=self.
-0000a970: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
-0000a980: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-0000a990: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000a9a0: 6f72 6d61 6c69 7a65 3d73 656c 662e 6e6f  ormalize=self.no
-0000a9b0: 726d 616c 697a 652c 206d 696e 5f70 6978  rmalize, min_pix
-0000a9c0: 656c 3d6d 696e 5f70 6978 2c20 6d61 785f  el=min_pix, max_
-0000a9d0: 7069 7865 6c3d 6d61 785f 7069 782c 2076  pixel=max_pix, v
-0000a9e0: 616c 5f70 6f73 6974 6976 653d 7661 6c5f  al_positive=val_
-0000a9f0: 636c 6173 735f 312c 2076 616c 5f6e 6567  class_1, val_neg
-0000aa00: 6174 6976 653d 7661 6c5f 636c 6173 735f  ative=val_class_
-0000aa10: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
-0000aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa30: 6570 6f63 6873 3d73 656c 662e 7472 6169  epochs=self.trai
-0000aa40: 6e5f 6570 6f63 6873 2c20 6261 7463 685f  n_epochs, batch_
-0000aa50: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
-0000aa60: 206c 723d 6c72 2c20 6d6f 6d65 6e74 756d   lr=lr, momentum
-0000aa70: 3d6d 6f6d 656e 7475 6d2c 2064 6563 6179  =momentum, decay
-0000aa80: 3d64 6563 6179 2c20 6e65 7374 6572 6f76  =decay, nesterov
-0000aa90: 3d6e 6573 7465 726f 762c 200a 2020 2020  =nesterov, .    
-0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aab0: 2020 2020 2020 2020 6c6f 7373 3d6c 6f73          loss=los
-0000aac0: 732c 2061 6374 6976 6174 696f 6e5f 636f  s, activation_co
-0000aad0: 6e76 3d61 6374 6976 6174 696f 6e5f 636f  nv=activation_co
-0000aae0: 6e76 2c20 6163 7469 7661 7469 6f6e 5f64  nv, activation_d
-0000aaf0: 656e 7365 3d61 6374 6976 6174 696f 6e5f  ense=activation_
-0000ab00: 6465 6e73 652c 206d 6f64 656c 5f72 6567  dense, model_reg
-0000ab10: 3d6d 6f64 656c 5f72 6567 2c20 0a20 2020  =model_reg, .   
-0000ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab30: 2020 2020 2020 2020 2063 6f6e 765f 696e           conv_in
-0000ab40: 6974 3d63 6f6e 765f 696e 6974 2c20 6465  it=conv_init, de
-0000ab50: 6e73 655f 696e 6974 3d64 656e 7365 5f69  nse_init=dense_i
-0000ab60: 6e69 742c 206f 7074 696d 697a 6572 3d6f  nit, optimizer=o
-0000ab70: 7074 696d 697a 6572 2c20 706f 6f6c 696e  ptimizer, poolin
-0000ab80: 675f 313d 706f 6f6c 696e 675f 312c 2070  g_1=pooling_1, p
-0000ab90: 6f6f 6c69 6e67 5f32 3d70 6f6f 6c69 6e67  ooling_2=pooling
-0000aba0: 5f32 2c20 706f 6f6c 696e 675f 333d 706f  _2, pooling_3=po
-0000abb0: 6f6c 696e 675f 332c 200a 2020 2020 2020  oling_3, .      
-0000abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abd0: 2020 2020 2020 706f 6f6c 5f73 7472 6964        pool_strid
-0000abe0: 655f 313d 706f 6f6c 5f73 7472 6964 655f  e_1=pool_stride_
-0000abf0: 312c 2070 6f6f 6c5f 7369 7a65 5f32 3d70  1, pool_size_2=p
-0000ac00: 6f6f 6c5f 7369 7a65 5f32 2c20 706f 6f6c  ool_size_2, pool
-0000ac10: 5f73 7472 6964 655f 323d 706f 6f6c 5f73  _stride_2=pool_s
-0000ac20: 7472 6964 655f 322c 200a 2020 2020 2020  tride_2, .      
-0000ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac40: 2020 2020 2020 706f 6f6c 5f73 697a 655f        pool_size_
-0000ac50: 333d 706f 6f6c 5f73 697a 655f 332c 2070  3=pool_size_3, p
-0000ac60: 6f6f 6c5f 7374 7269 6465 5f33 3d70 6f6f  ool_stride_3=poo
-0000ac70: 6c5f 7374 7269 6465 5f33 2c20 6669 6c74  l_stride_3, filt
-0000ac80: 6572 5f31 3d66 696c 7465 725f 312c 2066  er_1=filter_1, f
-0000ac90: 696c 7465 725f 7369 7a65 5f31 3d66 696c  ilter_size_1=fil
-0000aca0: 7465 725f 7369 7a65 5f31 2c20 0a20 2020  ter_size_1, .   
-0000acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acc0: 2020 2020 2020 2020 2073 7472 6964 6573           strides
-0000acd0: 5f31 3d73 7472 6964 6573 5f31 2c20 6669  _1=strides_1, fi
-0000ace0: 6c74 6572 5f32 3d66 696c 7465 725f 322c  lter_2=filter_2,
-0000acf0: 2066 696c 7465 725f 7369 7a65 5f32 3d66   filter_size_2=f
-0000ad00: 696c 7465 725f 7369 7a65 5f32 2c20 7374  ilter_size_2, st
-0000ad10: 7269 6465 735f 323d 7374 7269 6465 735f  rides_2=strides_
-0000ad20: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
-0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad40: 6669 6c74 6572 5f33 3d66 696c 7465 725f  filter_3=filter_
-0000ad50: 332c 2066 696c 7465 725f 7369 7a65 5f33  3, filter_size_3
-0000ad60: 3d66 696c 7465 725f 7369 7a65 5f33 2c20  =filter_size_3, 
-0000ad70: 7374 7269 6465 735f 333d 7374 7269 6465  strides_3=stride
-0000ad80: 735f 332c 2066 696c 7465 725f 343d 6669  s_3, filter_4=fi
-0000ad90: 6c74 6572 5f34 2c20 0a20 2020 2020 2020  lter_4, .       
-0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adb0: 2020 2020 2066 696c 7465 725f 7369 7a65       filter_size
-0000adc0: 5f34 3d66 696c 7465 725f 7369 7a65 5f34  _4=filter_size_4
-0000add0: 2c20 7374 7269 6465 735f 343d 7374 7269  , strides_4=stri
-0000ade0: 6465 735f 342c 2066 696c 7465 725f 353d  des_4, filter_5=
-0000adf0: 6669 6c74 6572 5f35 2c20 6669 6c74 6572  filter_5, filter
-0000ae00: 5f73 697a 655f 353d 6669 6c74 6572 5f73  _size_5=filter_s
-0000ae10: 697a 655f 352c 200a 2020 2020 2020 2020  ize_5, .        
-0000ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae30: 2020 2020 7374 7269 6465 735f 353d 7374      strides_5=st
-0000ae40: 7269 6465 735f 352c 2064 656e 7365 5f6e  rides_5, dense_n
-0000ae50: 6575 726f 6e73 5f31 3d64 656e 7365 5f6e  eurons_1=dense_n
-0000ae60: 6575 726f 6e73 5f31 2c20 6465 6e73 655f  eurons_1, dense_
-0000ae70: 6e65 7572 6f6e 735f 323d 6465 6e73 655f  neurons_2=dense_
-0000ae80: 6e65 7572 6f6e 735f 322c 200a 2020 2020  neurons_2, .    
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
-0000aeb0: 313d 6472 6f70 6f75 745f 312c 2064 726f  1=dropout_1, dro
-0000aec0: 706f 7574 5f32 3d64 726f 706f 7574 5f32  pout_2=dropout_2
-0000aed0: 2c20 736d 6f74 655f 7361 6d70 6c69 6e67  , smote_sampling
-0000aee0: 3d73 656c 662e 736d 6f74 655f 7361 6d70  =self.smote_samp
-0000aef0: 6c69 6e67 2c20 6561 726c 795f 7374 6f70  ling, early_stop
-0000af00: 5f63 616c 6c62 6163 6b3d 6361 6c6c 6261  _callback=callba
-0000af10: 636b 732c 2063 6865 636b 706f 696e 743d  cks, checkpoint=
-0000af20: 4661 6c73 652c 2076 6572 626f 7365 3d73  False, verbose=s
-0000af30: 656c 662e 7665 7262 6f73 6529 0a0a 2020  elf.verbose)..  
-0000af40: 2020 2020 2020 2020 2020 2020 2020 2349                #I
-0000af50: 6620 7468 6520 7472 6961 6c20 6973 2070  f the trial is p
-0000af60: 7275 6e65 6420 6f72 2074 6865 2070 6174  runed or the pat
-0000af70: 6965 6e63 6520 6973 2072 6561 6368 6564  ience is reached
-0000af80: 2c20 7265 7475 726e 206e 616e 230a 2020  , return nan#.  
-0000af90: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000afa0: 206c 656e 2868 6973 746f 7279 2e68 6973   len(history.his
-0000afb0: 746f 7279 5b27 6c6f 7373 275d 2920 213d  tory['loss']) !=
-0000afc0: 2073 656c 662e 7472 6169 6e5f 6570 6f63   self.train_epoc
-0000afd0: 6873 3a0a 2020 2020 2020 2020 2020 2020  hs:.            
-0000afe0: 2020 2020 2020 2020 7072 696e 7428 290a          print().
-0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b000: 2020 2020 7072 696e 7428 2754 6865 2074      print('The t
-0000b010: 7269 616c 2077 6173 2070 7275 6e65 6420  rial was pruned 
-0000b020: 6f72 2074 6865 2074 7261 696e 696e 6720  or the training 
-0000b030: 7061 7469 656e 6365 2077 6173 2072 6561  patience was rea
-0000b040: 6368 6564 2e2e 2e27 2923 2c20 7265 7475  ched...')#, retu
-0000b050: 726e 696e 6720 302e 3030 3120 7469 6d65  rning 0.001 time
-0000b060: 7320 7468 6520 6e75 6d62 6572 206f 6620  s the number of 
-0000b070: 636f 6d70 6c65 7465 6420 6570 6f63 6873  completed epochs
-0000b080: 2e2e 2e27 290a 2020 2020 2020 2020 2020  ...').          
-0000b090: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000b0a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b0b0: 2020 2020 2020 7265 7475 726e 2028 6c65        return (le
-0000b0c0: 6e28 6869 7374 6f72 792e 6869 7374 6f72  n(history.histor
-0000b0d0: 795b 276c 6f73 7327 5d29 202a 2030 2e30  y['loss']) * 0.0
-0000b0e0: 3031 2920 2d20 3939 392e 300a 0a20 2020  01) - 999.0..   
-0000b0f0: 2020 2020 2020 2020 2020 2020 2023 4966               #If
-0000b100: 2074 6865 2074 7261 696e 696e 6720 6661   the training fa
-0000b110: 696c 7320 7265 7475 726e 204e 614e 2072  ils return NaN r
-0000b120: 6967 6874 2061 7761 7923 0a20 2020 2020  ight away#.     
-0000b130: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
-0000b140: 2e69 7366 696e 6974 6528 6869 7374 6f72  .isfinite(histor
-0000b150: 792e 6869 7374 6f72 795b 276c 6f73 7327  y.history['loss'
-0000b160: 5d5b 2d31 5d29 3a0a 2020 2020 2020 2020  ][-1]):.        
-0000b170: 2020 2020 2020 2020 2020 2020 2349 6620              #If 
-0000b180: 7468 6520 7472 6169 6e20 6163 6320 7468  the train acc th
-0000b190: 7265 7368 6f6c 6420 6973 2073 6574 230a  reshold is set#.
-0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1b0: 2020 2020 6966 2073 656c 662e 7472 6169      if self.trai
-0000b1c0: 6e5f 6163 635f 7468 7265 7368 6f6c 6420  n_acc_threshold 
-0000b1d0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1f0: 2020 2020 2069 6620 6869 7374 6f72 792e       if history.
-0000b200: 6869 7374 6f72 795b 2762 696e 6172 795f  history['binary_
-0000b210: 6163 6375 7261 6379 275d 5b2d 315d 203e  accuracy'][-1] >
-0000b220: 2073 656c 662e 7472 6169 6e5f 6163 635f   self.train_acc_
-0000b230: 7468 7265 7368 6f6c 643a 0a20 2020 2020  threshold:.     
-0000b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b250: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
-0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b270: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000b280: 2827 5468 6520 7472 6961 6c20 7761 7320  ('The trial was 
-0000b290: 7072 756e 6564 206f 7220 7468 6520 7472  pruned or the tr
-0000b2a0: 6169 6e69 6e67 2070 6174 6965 6e63 6520  aining patience 
-0000b2b0: 7761 7320 7265 6163 6865 642e 2e2e 2729  was reached...')
-0000b2c0: 232c 2072 6574 7572 6e69 6e67 2030 2e30  #, returning 0.0
-0000b2d0: 3031 2074 696d 6573 2074 6865 206e 756d  01 times the num
-0000b2e0: 6265 7220 6f66 2063 6f6d 706c 6574 6564  ber of completed
-0000b2f0: 2065 706f 6368 732e 2e2e 2729 0a20 2020   epochs...').   
-0000b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b310: 2020 2020 2020 2020 2070 7269 6e74 2829           print()
-0000b320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b330: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000b340: 7572 6e20 286c 656e 2868 6973 746f 7279  urn (len(history
-0000b350: 2e68 6973 746f 7279 5b27 6c6f 7373 275d  .history['loss']
-0000b360: 2920 2a20 302e 3030 3129 202d 2039 3939  ) * 0.001) - 999
-0000b370: 2e30 0a20 2020 2020 2020 2020 2020 2020  .0.             
-0000b380: 2020 2020 2020 206d 6f64 656c 732e 6170         models.ap
-0000b390: 7065 6e64 286d 6f64 656c 292c 2068 6973  pend(model), his
-0000b3a0: 746f 7269 6573 2e61 7070 656e 6428 6869  tories.append(hi
-0000b3b0: 7374 6f72 7929 0a20 2020 2020 2020 2020  story).         
-0000b3c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3e0: 2070 7269 6e74 2827 5472 6169 6e69 6e67   print('Training
-0000b3f0: 2066 6169 6c65 6420 6475 6520 746f 206e   failed due to n
-0000b400: 756d 6572 6963 616c 2069 6e73 7461 6269  umerical instabi
-0000b410: 6c69 7479 2c20 7265 7475 726e 696e 6720  lity, returning 
-0000b420: 6e61 6e2e 2e2e 2729 0a20 2020 2020 2020  nan...').       
-0000b430: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000b440: 7572 6e20 6e70 2e6e 616e 200a 0a20 2020  urn np.nan ..   
-0000b450: 2020 2020 2023 2323 2323 2320 4164 6469       ###### Addi
-0000b460: 7469 6f6e 616c 2074 6573 7420 6461 7461  tional test data
-0000b470: 206d 6574 7269 6320 2323 2323 2323 0a20   metric ######. 
-0000b480: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-0000b490: 6573 745f 706f 7369 7469 7665 2069 7320  est_positive is 
-0000b4a0: 6e6f 7420 4e6f 6e65 206f 7220 7365 6c66  not None or self
-0000b4b0: 2e74 6573 745f 6e65 6761 7469 7665 2069  .test_negative i
-0000b4c0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000b4d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000b4e0: 7465 7374 5f70 6f73 6974 6976 6520 6973  test_positive is
-0000b4f0: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
-0000b500: 6c66 2e74 6573 745f 6e65 6761 7469 7665  lf.test_negative
-0000b510: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000b520: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0000b530: 7369 7469 7665 5f74 6573 745f 6372 6f70  sitive_test_crop
-0000b540: 2c20 6e65 6761 7469 7665 5f74 6573 745f  , negative_test_
-0000b550: 6372 6f70 203d 2072 6573 697a 6528 7365  crop = resize(se
-0000b560: 6c66 2e74 6573 745f 706f 7369 7469 7665  lf.test_positive
-0000b570: 2c20 7369 7a65 3d69 6d61 6765 5f73 697a  , size=image_siz
-0000b580: 6529 2c20 7265 7369 7a65 2873 656c 662e  e), resize(self.
-0000b590: 7465 7374 5f6e 6567 6174 6976 652c 2073  test_negative, s
-0000b5a0: 697a 653d 696d 6167 655f 7369 7a65 290a  ize=image_size).
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5c0: 585f 7465 7374 2c20 595f 7465 7374 203d  X_test, Y_test =
-0000b5d0: 2063 7265 6174 655f 7472 6169 6e69 6e67   create_training
-0000b5e0: 5f73 6574 2870 6f73 6974 6976 655f 7465  _set(positive_te
-0000b5f0: 7374 5f63 726f 702c 206e 6567 6174 6976  st_crop, negativ
-0000b600: 655f 7465 7374 5f63 726f 702c 206e 6f72  e_test_crop, nor
-0000b610: 6d61 6c69 7a65 3d73 656c 662e 6e6f 726d  malize=self.norm
-0000b620: 616c 697a 652c 206d 696e 5f70 6978 656c  alize, min_pixel
-0000b630: 3d6d 696e 5f70 6978 2c20 6d61 785f 7069  =min_pix, max_pi
-0000b640: 7865 6c3d 6d61 785f 7069 782c 2069 6d67  xel=max_pix, img
-0000b650: 5f6e 756d 5f63 6861 6e6e 656c 733d 7365  _num_channels=se
-0000b660: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
-0000b670: 656c 7329 0a20 2020 2020 2020 2020 2020  els).           
-0000b680: 2065 6c69 6620 7365 6c66 2e74 6573 745f   elif self.test_
-0000b690: 706f 7369 7469 7665 2069 7320 6e6f 7420  positive is not 
-0000b6a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000b6b0: 2020 2020 2020 706f 7369 7469 7665 5f74        positive_t
-0000b6c0: 6573 745f 6372 6f70 203d 2072 6573 697a  est_crop = resiz
-0000b6d0: 6528 7365 6c66 2e74 6573 745f 706f 7369  e(self.test_posi
-0000b6e0: 7469 7665 2c20 7369 7a65 3d69 6d61 6765  tive, size=image
-0000b6f0: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
-0000b700: 2020 2020 2020 2070 6f73 6974 6976 655f         positive_
-0000b710: 636c 6173 735f 6461 7461 2c20 706f 7369  class_data, posi
-0000b720: 7469 7665 5f63 6c61 7373 5f6c 6162 656c  tive_class_label
-0000b730: 203d 2064 6174 615f 7072 6f63 6573 7369   = data_processi
-0000b740: 6e67 2e70 726f 6365 7373 5f63 6c61 7373  ng.process_class
-0000b750: 2870 6f73 6974 6976 655f 7465 7374 5f63  (positive_test_c
-0000b760: 726f 702c 206c 6162 656c 3d31 2c20 6e6f  rop, label=1, no
-0000b770: 726d 616c 697a 653d 7365 6c66 2e6e 6f72  rmalize=self.nor
-0000b780: 6d61 6c69 7a65 2c20 6d69 6e5f 7069 7865  malize, min_pixe
-0000b790: 6c3d 6d69 6e5f 7069 782c 206d 6178 5f70  l=min_pix, max_p
-0000b7a0: 6978 656c 3d6d 6178 5f70 6978 2c20 696d  ixel=max_pix, im
-0000b7b0: 675f 6e75 6d5f 6368 616e 6e65 6c73 3d73  g_num_channels=s
-0000b7c0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-0000b7d0: 6e65 6c73 290a 2020 2020 2020 2020 2020  nels).          
-0000b7e0: 2020 2020 2020 6966 2073 656c 662e 7465        if self.te
-0000b7f0: 7374 5f6e 6567 6174 6976 6520 6973 206e  st_negative is n
-0000b800: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000b810: 2020 2020 2020 2020 2020 2020 206e 6567               neg
-0000b820: 6174 6976 655f 7465 7374 5f63 726f 7020  ative_test_crop 
-0000b830: 3d20 7265 7369 7a65 2873 656c 662e 7465  = resize(self.te
-0000b840: 7374 5f6e 6567 6174 6976 652c 2073 697a  st_negative, siz
-0000b850: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
-0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b870: 2020 6e65 6761 7469 7665 5f63 6c61 7373    negative_class
-0000b880: 5f64 6174 612c 206e 6567 6174 6976 655f  _data, negative_
-0000b890: 636c 6173 735f 6c61 6265 6c20 3d20 6461  class_label = da
-0000b8a0: 7461 5f70 726f 6365 7373 696e 672e 7072  ta_processing.pr
-0000b8b0: 6f63 6573 735f 636c 6173 7328 6e65 6761  ocess_class(nega
-0000b8c0: 7469 7665 5f74 6573 745f 6372 6f70 2c20  tive_test_crop, 
-0000b8d0: 6c61 6265 6c3d 302c 206e 6f72 6d61 6c69  label=0, normali
-0000b8e0: 7a65 3d73 656c 662e 6e6f 726d 616c 697a  ze=self.normaliz
-0000b8f0: 652c 206d 696e 5f70 6978 656c 3d6d 696e  e, min_pixel=min
-0000b900: 5f70 6978 2c20 6d61 785f 7069 7865 6c3d  _pix, max_pixel=
-0000b910: 6d61 785f 7069 782c 2069 6d67 5f6e 756d  max_pix, img_num
-0000b920: 5f63 6861 6e6e 656c 733d 7365 6c66 2e69  _channels=self.i
-0000b930: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7329  mg_num_channels)
-0000b940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b950: 2020 2020 2058 5f74 6573 742c 2059 5f74       X_test, Y_t
-0000b960: 6573 7420 3d20 6e70 2e72 5f5b 706f 7369  est = np.r_[posi
-0000b970: 7469 7665 5f63 6c61 7373 5f64 6174 612c  tive_class_data,
-0000b980: 206e 6567 6174 6976 655f 636c 6173 735f   negative_class_
-0000b990: 6461 7461 5d2c 206e 702e 725f 5b70 6f73  data], np.r_[pos
-0000b9a0: 6974 6976 655f 636c 6173 735f 6c61 6265  itive_class_labe
-0000b9b0: 6c2c 206e 6567 6174 6976 655f 636c 6173  l, negative_clas
-0000b9c0: 735f 6c61 6265 6c5d 0a20 2020 2020 2020  s_label].       
-0000b9d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9f0: 2020 2058 5f74 6573 742c 2059 5f74 6573     X_test, Y_tes
-0000ba00: 7420 3d20 706f 7369 7469 7665 5f63 6c61  t = positive_cla
-0000ba10: 7373 5f64 6174 612c 2070 6f73 6974 6976  ss_data, positiv
-0000ba20: 655f 636c 6173 735f 6c61 6265 6c0a 2020  e_class_label.  
-0000ba30: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba50: 6966 2073 656c 662e 7465 7374 5f6e 6567  if self.test_neg
-0000ba60: 6174 6976 6520 6973 206e 6f74 204e 6f6e  ative is not Non
-0000ba70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ba80: 2020 2020 2020 2058 5f74 6573 742c 2059         X_test, Y
-0000ba90: 5f74 6573 7420 3d20 6461 7461 5f70 726f  _test = data_pro
-0000baa0: 6365 7373 696e 672e 7072 6f63 6573 735f  cessing.process_
-0000bab0: 636c 6173 7328 6e65 6761 7469 7665 5f74  class(negative_t
-0000bac0: 6573 745f 6372 6f70 2c20 6c61 6265 6c3d  est_crop, label=
-0000bad0: 302c 206e 6f72 6d61 6c69 7a65 3d73 656c  0, normalize=sel
-0000bae0: 662e 6e6f 726d 616c 697a 652c 206d 696e  f.normalize, min
-0000baf0: 5f70 6978 656c 3d6d 696e 5f70 6978 2c20  _pixel=min_pix, 
-0000bb00: 6d61 785f 7069 7865 6c3d 6d61 785f 7069  max_pixel=max_pi
-0000bb10: 782c 2069 6d67 5f6e 756d 5f63 6861 6e6e  x, img_num_chann
-0000bb20: 656c 733d 7365 6c66 2e69 6d67 5f6e 756d  els=self.img_num
-0000bb30: 5f63 6861 6e6e 656c 7329 0a20 2020 2020  _channels).     
-0000bb40: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000bb50: 2020 2020 2023 2323 4c6f 6f70 2074 6872       ###Loop thr
-0000bb60: 6f75 6768 2061 6c6c 2074 6865 206d 6f64  ough all the mod
-0000bb70: 656c 7323 2323 0a20 2020 2020 2020 2020  els###.         
-0000bb80: 2020 2074 6573 7420 3d20 5b5d 0a20 2020     test = [].   
-0000bb90: 2020 2020 2020 2020 2066 6f72 205f 6d6f           for _mo
-0000bba0: 6465 6c5f 2069 6e20 6d6f 6465 6c73 3a0a  del_ in models:.
-0000bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbc0: 7465 7374 5f6c 6f73 732c 2074 6573 745f  test_loss, test_
-0000bbd0: 6163 632c 2074 6573 745f 6631 5f73 636f  acc, test_f1_sco
-0000bbe0: 7265 203d 205f 6d6f 6465 6c5f 2e65 7661  re = _model_.eva
-0000bbf0: 6c75 6174 6528 585f 7465 7374 2c20 595f  luate(X_test, Y_
-0000bc00: 7465 7374 2c20 6261 7463 685f 7369 7a65  test, batch_size
-0000bc10: 3d6c 656e 2858 5f74 6573 7429 290a 2020  =len(X_test)).  
-0000bc20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000bc30: 2027 6c6f 7373 2720 696e 2073 656c 662e   'loss' in self.
-0000bc40: 6d65 7472 6963 3a0a 2020 2020 2020 2020  metric:.        
-0000bc50: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0000bc60: 5f6d 6574 7269 6320 3d20 3120 2d20 7465  _metric = 1 - te
-0000bc70: 7374 5f6c 6f73 730a 2020 2020 2020 2020  st_loss.        
-0000bc80: 2020 2020 2020 2020 656c 6966 2027 6163          elif 'ac
-0000bc90: 6327 2069 6e20 7365 6c66 2e6d 6574 7269  c' in self.metri
-0000bca0: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
-0000bcb0: 2020 2020 2020 2074 6573 745f 6d65 7472         test_metr
-0000bcc0: 6963 203d 2074 6573 745f 6163 6320 0a20  ic = test_acc . 
-0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000bce0: 6c69 6620 2766 3127 2069 6e20 7365 6c66  lif 'f1' in self
-0000bcf0: 2e6d 6574 7269 633a 0a20 2020 2020 2020  .metric:.       
-0000bd00: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-0000bd10: 745f 6d65 7472 6963 203d 2074 6573 745f  t_metric = test_
-0000bd20: 6631 5f73 636f 7265 0a20 2020 2020 2020  f1_score.       
-0000bd30: 2020 2020 2020 2020 2065 6c69 6620 2761           elif 'a
-0000bd40: 6c6c 2720 696e 2073 656c 662e 6d65 7472  ll' in self.metr
-0000bd50: 6963 3a0a 2020 2020 2020 2020 2020 2020  ic:.            
-0000bd60: 2020 2020 2020 2020 7465 7374 5f6d 6574          test_met
-0000bd70: 7269 6320 3d20 6e70 2e6d 6561 6e28 5b31  ric = np.mean([1
-0000bd80: 202d 2074 6573 745f 6c6f 7373 2c20 7465   - test_loss, te
-0000bd90: 7374 5f61 6363 2c20 7465 7374 5f66 315f  st_acc, test_f1_
-0000bda0: 7363 6f72 655d 290a 2020 2020 2020 2020  score]).        
-0000bdb0: 2020 2020 2020 2020 7465 7374 2e61 7070          test.app
-0000bdc0: 656e 6428 7465 7374 5f6d 6574 7269 6329  end(test_metric)
-0000bdd0: 0a0a 2020 2020 2020 2020 2020 2020 7465  ..            te
-0000bde0: 7374 5f6d 6574 7269 6320 3d20 6e70 2e6d  st_metric = np.m
-0000bdf0: 6561 6e28 7465 7374 290a 2020 2020 2020  ean(test).      
-0000be00: 2020 2020 2020 6966 2073 656c 662e 7665        if self.ve
-0000be10: 7262 6f73 6520 3d3d 2031 3a0a 2020 2020  rbose == 1:.    
-0000be20: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000be30: 7428 2750 6f73 742d 5472 6961 6c20 4d65  t('Post-Trial Me
-0000be40: 7472 6963 3a20 272b 7374 7228 7465 7374  tric: '+str(test
-0000be50: 5f6d 6574 7269 6329 290a 2020 2020 2020  _metric)).      
-0000be60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000be70: 2020 2020 7465 7374 5f6d 6574 7269 6320      test_metric 
-0000be80: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
-0000be90: 2323 2320 4361 6c63 756c 6174 6520 7468  ### Calculate th
-0000bea0: 6520 6669 6e61 6c20 6f70 7469 6d69 7a61  e final optimiza
-0000beb0: 7469 6f6e 206d 6574 7269 6320 2323 230a  tion metric ###.
-0000bec0: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
-0000bed0: 3d20 5b27 6c6f 7373 272c 2027 6269 6e61  = ['loss', 'bina
-0000bee0: 7279 5f61 6363 7572 6163 7927 2c20 2766  ry_accuracy', 'f
-0000bef0: 315f 7363 6f72 6527 5d0a 2020 2020 2020  1_score'].      
-0000bf00: 2020 6966 2073 656c 662e 6d65 7472 6963    if self.metric
-0000bf10: 203d 3d20 2761 6c6c 273a 2023 4176 6572   == 'all': #Aver
-0000bf20: 6167 6520 616c 6c20 7468 6520 7472 6169  age all the trai
-0000bf30: 6e69 6e67 206d 6574 7269 6373 0a20 2020  ning metrics.   
-0000bf40: 2020 2020 2020 2020 2074 7261 696e 696e           trainin
-0000bf50: 675f 6d65 7472 6963 735f 6d65 616e 2c20  g_metrics_mean, 
-0000bf60: 7472 6169 6e69 6e67 5f6c 6f73 735f 6d65  training_loss_me
-0000bf70: 616e 203d 205b 5d2c 205b 5d0a 2020 2020  an = [], [].    
-0000bf80: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000bf90: 6176 6572 6167 653a 0a20 2020 2020 2020  average:.       
-0000bfa0: 2020 2020 2020 2020 2066 6f72 205f 6869           for _hi
-0000bfb0: 7374 6f72 795f 2069 6e20 6869 7374 6f72  story_ in histor
-0000bfc0: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
-0000bfd0: 2020 2020 2020 2020 2074 7261 696e 696e           trainin
-0000bfe0: 675f 6d65 7472 6963 735f 6d65 616e 2e61  g_metrics_mean.a
-0000bff0: 7070 656e 6428 6e70 2e6d 6561 6e28 5b6e  ppend(np.mean([n
-0000c000: 702e 6d65 616e 285f 6869 7374 6f72 795f  p.mean(_history_
-0000c010: 2e68 6973 746f 7279 5b6d 6574 7269 635d  .history[metric]
-0000c020: 2920 666f 7220 6d65 7472 6963 2069 6e20  ) for metric in 
-0000c030: 6d65 7472 6963 7320 6966 2027 6c6f 7373  metrics if 'loss
-0000c040: 2720 6e6f 7420 696e 206d 6574 7269 635d  ' not in metric]
-0000c050: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0000c060: 2020 2020 2020 2074 7261 696e 696e 675f         training_
-0000c070: 6c6f 7373 5f6d 6561 6e2e 6170 7065 6e64  loss_mean.append
-0000c080: 2831 202d 206e 702e 6d65 616e 285f 6869  (1 - np.mean(_hi
-0000c090: 7374 6f72 795f 2e68 6973 746f 7279 5b27  story_.history['
-0000c0a0: 6c6f 7373 275d 2929 0a20 2020 2020 2020  loss'])).       
-0000c0b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c0c0: 2020 2020 2020 2020 2020 2066 6f72 205f             for _
-0000c0d0: 6869 7374 6f72 795f 2069 6e20 6869 7374  history_ in hist
-0000c0e0: 6f72 6965 733a 0a20 2020 2020 2020 2020  ories:.         
-0000c0f0: 2020 2020 2020 2020 2020 2074 7261 696e             train
-0000c100: 696e 675f 6d65 7472 6963 735f 6d65 616e  ing_metrics_mean
-0000c110: 2e61 7070 656e 6428 6e70 2e6d 6561 6e28  .append(np.mean(
-0000c120: 5b5f 6869 7374 6f72 795f 2e68 6973 746f  [_history_.histo
-0000c130: 7279 5b6d 6574 7269 635d 5b2d 315d 2066  ry[metric][-1] f
-0000c140: 6f72 206d 6574 7269 6320 696e 206d 6574  or metric in met
-0000c150: 7269 6373 2069 6620 276c 6f73 7327 206e  rics if 'loss' n
-0000c160: 6f74 2069 6e20 6d65 7472 6963 5d29 290a  ot in metric])).
-0000c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c180: 2020 2020 7472 6169 6e69 6e67 5f6c 6f73      training_los
-0000c190: 735f 6d65 616e 2e61 7070 656e 6428 3120  s_mean.append(1 
-0000c1a0: 2d20 5f68 6973 746f 7279 5f2e 6869 7374  - _history_.hist
-0000c1b0: 6f72 795b 276c 6f73 7327 5d5b 2d31 5d29  ory['loss'][-1])
-0000c1c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c1d0: 7465 7374 5f6d 6574 7269 6320 6973 204e  test_metric is N
-0000c1e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000c1f0: 2020 2020 2066 696e 616c 5f73 636f 7265       final_score
-0000c200: 203d 206e 702e 6d65 616e 285b 7472 6169   = np.mean([trai
-0000c210: 6e69 6e67 5f6d 6574 7269 6373 5f6d 6561  ning_metrics_mea
-0000c220: 6e2c 2074 7261 696e 696e 675f 6c6f 7373  n, training_loss
-0000c230: 5f6d 6561 6e5d 290a 2020 2020 2020 2020  _mean]).        
-0000c240: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000c250: 2020 2020 2020 2020 2020 6669 6e61 6c5f            final_
-0000c260: 7363 6f72 6520 3d20 6e70 2e6d 6561 6e28  score = np.mean(
-0000c270: 5b74 7261 696e 696e 675f 6d65 7472 6963  [training_metric
-0000c280: 735f 6d65 616e 2c20 7472 6169 6e69 6e67  s_mean, training
-0000c290: 5f6c 6f73 735f 6d65 616e 2c20 7465 7374  _loss_mean, test
-0000c2a0: 5f6d 6574 7269 635d 290a 2020 2020 2020  _metric]).      
-0000c2b0: 2020 656c 6966 2073 656c 662e 6d65 7472    elif self.metr
-0000c2c0: 6963 203d 3d20 2776 616c 5f61 6c6c 273a  ic == 'val_all':
-0000c2d0: 2023 4176 6572 6167 6520 616c 6c20 7468   #Average all th
-0000c2e0: 6520 7661 6c69 6461 7469 6f6e 206d 6574  e validation met
-0000c2f0: 7269 6373 0a20 2020 2020 2020 2020 2020  rics.           
-0000c300: 2076 616c 5f6d 6574 7269 6373 5f6d 6561   val_metrics_mea
-0000c310: 6e2c 2076 616c 5f6c 6f73 735f 6d65 616e  n, val_loss_mean
-0000c320: 203d 205b 5d2c 205b 5d20 0a20 2020 2020   = [], [] .     
-0000c330: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-0000c340: 7665 7261 6765 3a0a 2020 2020 2020 2020  verage:.        
-0000c350: 2020 2020 2020 2020 666f 7220 5f68 6973          for _his
-0000c360: 746f 7279 5f20 696e 2068 6973 746f 7269  tory_ in histori
-0000c370: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000c380: 2020 2020 2020 2020 7661 6c5f 6d65 7472          val_metr
-0000c390: 6963 735f 6d65 616e 2e61 7070 656e 6428  ics_mean.append(
-0000c3a0: 6e70 2e6d 6561 6e28 5b6e 702e 6d65 616e  np.mean([np.mean
-0000c3b0: 285f 6869 7374 6f72 795f 2e68 6973 746f  (_history_.histo
-0000c3c0: 7279 5b27 7661 6c5f 272b 6d65 7472 6963  ry['val_'+metric
-0000c3d0: 5d29 2066 6f72 206d 6574 7269 6320 696e  ]) for metric in
-0000c3e0: 206d 6574 7269 6373 2069 6620 276c 6f73   metrics if 'los
-0000c3f0: 7327 206e 6f74 2069 6e20 6d65 7472 6963  s' not in metric
-0000c400: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0000c410: 2020 2020 2020 2020 7661 6c5f 6c6f 7373          val_loss
-0000c420: 5f6d 6561 6e2e 6170 7065 6e64 2831 202d  _mean.append(1 -
-0000c430: 206e 702e 6d65 616e 285f 6869 7374 6f72   np.mean(_histor
-0000c440: 795f 2e68 6973 746f 7279 5b27 7661 6c5f  y_.history['val_
-0000c450: 6c6f 7373 275d 2929 0a20 2020 2020 2020  loss'])).       
-0000c460: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c470: 2020 2020 2020 2020 2020 2066 6f72 205f             for _
-0000c480: 6869 7374 6f72 795f 2069 6e20 6869 7374  history_ in hist
-0000c490: 6f72 6965 733a 0a20 2020 2020 2020 2020  ories:.         
-0000c4a0: 2020 2020 2020 2020 2020 2076 616c 5f6d             val_m
-0000c4b0: 6574 7269 6373 5f6d 6561 6e2e 6170 7065  etrics_mean.appe
-0000c4c0: 6e64 286e 702e 6d65 616e 285b 5f68 6973  nd(np.mean([_his
-0000c4d0: 746f 7279 5f2e 6869 7374 6f72 795b 2776  tory_.history['v
-0000c4e0: 616c 5f27 2b6d 6574 7269 635d 5b2d 315d  al_'+metric][-1]
-0000c4f0: 2066 6f72 206d 6574 7269 6320 696e 206d   for metric in m
-0000c500: 6574 7269 6373 2069 6620 276c 6f73 7327  etrics if 'loss'
-0000c510: 206e 6f74 2069 6e20 6d65 7472 6963 5d29   not in metric])
-0000c520: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c530: 2020 2020 2020 7661 6c5f 6c6f 7373 5f6d        val_loss_m
-0000c540: 6561 6e2e 6170 7065 6e64 2831 202d 205f  ean.append(1 - _
-0000c550: 6869 7374 6f72 795f 2e68 6973 746f 7279  history_.history
-0000c560: 5b27 7661 6c5f 6c6f 7373 275d 5b2d 315d  ['val_loss'][-1]
-0000c570: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000c580: 2074 6573 745f 6d65 7472 6963 2069 7320   test_metric is 
-0000c590: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000c5a0: 2020 2020 2020 6669 6e61 6c5f 7363 6f72        final_scor
-0000c5b0: 6520 3d20 6e70 2e6d 6561 6e28 5b76 616c  e = np.mean([val
-0000c5c0: 5f6d 6574 7269 6373 5f6d 6561 6e2c 2076  _metrics_mean, v
-0000c5d0: 616c 5f6c 6f73 735f 6d65 616e 5d29 0a20  al_loss_mean]). 
-0000c5e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000c5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c600: 2066 696e 616c 5f73 636f 7265 203d 206e   final_score = n
-0000c610: 702e 6d65 616e 285b 7661 6c5f 6d65 7472  p.mean([val_metr
-0000c620: 6963 735f 6d65 616e 2c20 7661 6c5f 6c6f  ics_mean, val_lo
-0000c630: 7373 5f6d 6561 6e2c 2074 6573 745f 6d65  ss_mean, test_me
-0000c640: 7472 6963 5d29 0a20 2020 2020 2020 2065  tric]).        e
-0000c650: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000c660: 2073 636f 7265 7320 3d20 5b5d 0a20 2020   scores = [].   
-0000c670: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000c680: 2e61 7665 7261 6765 3a0a 2020 2020 2020  .average:.      
-0000c690: 2020 2020 2020 2020 2020 666f 7220 5f68            for _h
-0000c6a0: 6973 746f 7279 5f20 696e 2068 6973 746f  istory_ in histo
-0000c6b0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-0000c6c0: 2020 2020 2020 2020 2020 7363 6f72 6573            scores
-0000c6d0: 2e61 7070 656e 6428 6e70 2e6d 6561 6e28  .append(np.mean(
-0000c6e0: 5f68 6973 746f 7279 5f2e 6869 7374 6f72  _history_.histor
-0000c6f0: 795b 7365 6c66 2e6d 6574 7269 635d 2929  y[self.metric]))
-0000c700: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000c710: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000c720: 2020 2066 6f72 205f 6869 7374 6f72 795f     for _history_
-0000c730: 2069 6e20 6869 7374 6f72 6965 733a 0a20   in histories:. 
-0000c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c750: 2020 2073 636f 7265 732e 6170 7065 6e64     scores.append
-0000c760: 285f 6869 7374 6f72 795f 2e68 6973 746f  (_history_.histo
-0000c770: 7279 5b73 656c 662e 6d65 7472 6963 5d5b  ry[self.metric][
-0000c780: 2d31 5d29 0a0a 2020 2020 2020 2020 2020  -1])..          
-0000c790: 2020 6669 6e61 6c5f 7363 6f72 6520 3d20    final_score = 
-0000c7a0: 6e70 2e6d 6561 6e28 7363 6f72 6573 290a  np.mean(scores).
-0000c7b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c7c0: 276c 6f73 7327 2069 6e20 7365 6c66 2e6d  'loss' in self.m
-0000c7d0: 6574 7269 633a 200a 2020 2020 2020 2020  etric: .        
-0000c7e0: 2020 2020 2020 2020 6669 6e61 6c5f 7363          final_sc
-0000c7f0: 6f72 6520 3d20 3120 2d20 6669 6e61 6c5f  ore = 1 - final_
-0000c800: 7363 6f72 650a 2020 2020 2020 2020 2020  score.          
-0000c810: 2020 6966 2074 6573 745f 6d65 7472 6963    if test_metric
-0000c820: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000c830: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000c840: 6e61 6c5f 7363 6f72 6520 3d20 2866 696e  nal_score = (fin
-0000c850: 616c 5f73 636f 7265 202b 2074 6573 745f  al_score + test_
-0000c860: 6d65 7472 6963 2920 2f20 322e 300a 2020  metric) / 2.0.  
-0000c870: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
-0000c880: 6574 7572 6e20 6669 6e61 6c5f 7363 6f72  eturn final_scor
-0000c890: 650a 0a63 6c61 7373 206f 626a 6563 7469  e..class objecti
-0000c8a0: 7665 5f78 6762 286f 626a 6563 7429 3a0a  ve_xgb(object):.
-0000c8b0: 2020 2020 2222 220a 2020 2020 4f70 7469      """.    Opti
-0000c8c0: 6d69 7a61 7469 6f6e 206f 626a 6563 7469  mization objecti
-0000c8d0: 7665 2066 756e 6374 696f 6e20 666f 7220  ve function for 
-0000c8e0: 7468 6520 7472 6565 2d62 6173 6564 2058  the tree-based X
-0000c8f0: 4742 6f6f 7374 2063 6c61 7373 6966 6965  GBoost classifie
-0000c900: 722e 200a 2020 2020 5468 6520 4f70 7475  r. .    The Optu
-0000c910: 6e61 2073 6f66 7477 6172 6520 666f 7220  na software for 
-0000c920: 6879 7065 7270 6172 616d 6574 6572 206f  hyperparameter o
-0000c930: 7074 696d 697a 6174 696f 6e20 7761 7320  ptimization was 
-0000c940: 7075 626c 6973 6865 6420 696e 200a 2020  published in .  
-0000c950: 2020 3230 3139 2062 7920 416b 6962 6120    2019 by Akiba 
-0000c960: 6574 2061 6c2e 2050 6170 6572 3a20 6874  et al. Paper: ht
-0000c970: 7470 733a 2f2f 6172 7869 762e 6f72 672f  tps://arxiv.org/
-0000c980: 6162 732f 3139 3037 2e31 3039 3032 0a0a  abs/1907.10902..
-0000c990: 2020 2020 7465 7374 5f73 697a 6520 6973      test_size is
-0000c9a0: 2061 6e20 6f70 7469 6f6e 616c 2070 6172   an optional par
-0000c9b0: 616d 6574 6572 2074 6f20 7370 6565 6420  ameter to speed 
-0000c9c0: 7570 2074 6865 2058 4742 206f 7074 696d  up the XGB optim
-0000c9d0: 697a 6174 696f 6e20 7472 6169 6e69 6e67  ization training
-0000c9e0: 2e0a 2020 2020 4966 2069 6e70 7574 2c20  ..    If input, 
-0000c9f0: 6120 7261 6e64 6f6d 2076 616c 6964 6174  a random validat
-0000ca00: 696f 6e20 6461 7461 2077 696c 6c20 6265  ion data will be
-0000ca10: 2067 656e 6572 6174 6564 2061 6363 6f72   generated accor
-0000ca20: 6469 6e67 2074 6f20 7468 6973 2074 6573  ding to this tes
-0000ca30: 7420 7369 7a65 2c0a 2020 2020 7768 6963  t size,.    whic
-0000ca40: 6820 7769 6c6c 2072 6570 6c61 6365 2074  h will replace t
-0000ca50: 6865 2063 726f 7373 2d76 616c 6964 6174  he cross-validat
-0000ca60: 696f 6e20 6d65 7468 6f64 2075 7365 6420  ion method used 
-0000ca70: 6279 2064 6566 6175 6c74 2064 7572 696e  by default durin
-0000ca80: 672e 200a 2020 2020 4e65 6564 206d 6f72  g. .    Need mor
-0000ca90: 6520 7465 7374 696e 6720 746f 206d 616b  e testing to mak
-0000caa0: 6520 7468 6973 206d 6f72 6520 726f 6275  e this more robu
-0000cab0: 7374 2c20 7265 636f 6d6d 656e 6465 6420  st, recommended 
-0000cac0: 6f70 7469 6f6e 2069 7320 7465 7374 5f73  option is test_s
-0000cad0: 697a 653d 4e6f 6e65 2e20 0a20 2020 2054  ize=None. .    T
-0000cae0: 6865 206f 7074 5f63 7620 7061 7261 6d65  he opt_cv parame
-0000caf0: 7465 7220 7368 6f75 6c64 2062 6520 7573  ter should be us
-0000cb00: 6564 2069 6e73 7465 6164 2074 6f20 7365  ed instead to se
-0000cb10: 7420 7468 6520 6e75 6d62 6572 206f 6620  t the number of 
-0000cb20: 666f 6c64 7320 746f 2075 7365 200a 2020  folds to use .  
-0000cb30: 2020 7768 656e 2061 7373 6573 7369 6e67    when assessing
-0000cb40: 206f 7074 696d 697a 6174 696f 6e20 7472   optimization tr
-0000cb50: 6961 6c20 7065 7266 6f72 6d61 6e63 652e  ial performance.
-0000cb60: 200a 0a20 2020 2041 7267 733a 0a20 2020   ..    Args:.   
-0000cb70: 2020 2020 2064 6174 615f 7820 286e 6461       data_x (nda
-0000cb80: 7272 6179 293a 2032 4420 6172 7261 7920  rray): 2D array 
-0000cb90: 6f66 2073 697a 6520 286e 2078 206d 292c  of size (n x m),
-0000cba0: 2077 6865 7265 206e 2069 7320 7468 650a   where n is the.
-0000cbb0: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
-0000cbc0: 6572 206f 6620 7361 6d70 6c65 732c 2061  er of samples, a
-0000cbd0: 6e64 206d 2074 6865 206e 756d 6265 7220  nd m the number 
-0000cbe0: 6f66 2066 6561 7475 7265 732e 0a20 2020  of features..   
-0000cbf0: 2020 2020 2064 6174 615f 7920 286e 6461       data_y (nda
-0000cc00: 7272 6179 2c20 7374 7229 3a20 3144 2061  rray, str): 1D a
-0000cc10: 7272 6179 2063 6f6e 7461 696e 696e 6720  rray containing 
-0000cc20: 7468 6520 636f 7272 6573 706f 6e69 6e67  the corresponing
-0000cc30: 206c 6162 656c 732e 200a 2020 2020 2020   labels. .      
-0000cc40: 2020 6c69 6d69 745f 7365 6172 6368 2028    limit_search (
-0000cc50: 626f 6f6c 293a 2049 6620 5472 7565 2c20  bool): If True, 
-0000cc60: 7468 6520 7365 6172 6368 2073 7061 6365  the search space
-0000cc70: 2066 6f72 2074 6865 2070 6172 616d 6574   for the paramet
-0000cc80: 6572 7320 7769 6c6c 2062 6520 6578 7061  ers will be expa
-0000cc90: 6e64 6564 2c0a 2020 2020 2020 2020 2020  nded,.          
-0000cca0: 2020 6173 2074 6865 7265 2061 7265 2073    as there are s
-0000ccb0: 6f6d 6520 6879 7065 7270 6172 616d 6574  ome hyperparamet
-0000ccc0: 6572 7320 7468 6174 2063 616e 2072 616e  ers that can ran
-0000ccd0: 6765 2066 726f 6d20 3020 746f 2069 6e66  ge from 0 to inf
-0000cce0: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
-0000ccf0: 6c73 652e 0a20 2020 2020 2020 206f 7074  lse..        opt
-0000cd00: 5f63 7620 2869 6e74 293a 2043 726f 7373  _cv (int): Cross
-0000cd10: 2d76 616c 6964 6174 696f 6e73 2074 6f20  -validations to 
-0000cd20: 7065 7266 6f72 6d20 7768 656e 2061 7373  perform when ass
-0000cd30: 6573 696e 6720 7468 6520 7065 7266 6f72  esing the perfor
-0000cd40: 6d61 6e63 6520 6174 2065 6163 680a 2020  mance at each.  
-0000cd50: 2020 2020 2020 2020 2020 6879 7065 7270            hyperp
-0000cd60: 6172 616d 6574 6572 206f 7074 696d 697a  arameter optimiz
-0000cd70: 6174 696f 6e20 7472 6961 6c2e 2046 6f72  ation trial. For
-0000cd80: 2065 7861 6d70 6c65 2c20 6966 2063 763d   example, if cv=
-0000cd90: 332c 2074 6865 6e20 6561 6368 206f 7074  3, then each opt
-0000cda0: 696d 697a 6174 696f 6e20 7472 6961 6c0a  imization trial.
-0000cdb0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-0000cdc0: 2062 6520 6173 7365 7373 6564 2061 6363   be assessed acc
-0000cdd0: 6f72 6469 6e67 2074 6f20 7468 6520 332d  ording to the 3-
-0000cde0: 666f 6c64 2063 726f 7373 2076 616c 6964  fold cross valid
-0000cdf0: 6174 696f 6e20 6163 6375 7261 6379 2e20  ation accuracy. 
-0000ce00: 0a20 2020 2020 2020 2074 6573 745f 7369  .        test_si
-0000ce10: 7a65 2028 666c 6f61 742c 206f 7074 696f  ze (float, optio
-0000ce20: 6e61 6c29 3a20 5468 6520 7369 7a65 206f  nal): The size o
-0000ce30: 6620 7468 6520 7661 6c69 6461 7469 6f6e  f the validation
-0000ce40: 2064 6174 612c 2077 696c 6c20 6265 2063   data, will be c
-0000ce50: 686f 7365 6e0a 2020 2020 2020 2020 2020  hosen.          
-0000ce60: 2020 7261 6e64 6f6d 6c79 2065 6163 6820    randomly each 
-0000ce70: 7472 6961 6c2e 204d 7573 7420 6265 2062  trial. Must be b
-0000ce80: 6574 7765 656e 2030 2061 6e64 2031 2e20  etween 0 and 1. 
-0000ce90: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-0000cea0: 2c20 696e 2077 6869 6368 0a20 2020 2020  , in which.     
-0000ceb0: 2020 2020 2020 2063 6173 6520 7468 6520         case the 
-0000cec0: 6f70 745f 6376 2070 6172 616d 6574 6572  opt_cv parameter
-0000ced0: 2077 696c 6c20 6265 2075 7365 6420 696e   will be used in
-0000cee0: 7374 6561 642e 0a0a 2020 2020 5265 7475  stead...    Retu
-0000cef0: 726e 733a 0a20 2020 2020 2020 2054 6865  rns:.        The
-0000cf00: 2070 6572 666f 726d 616e 6365 206d 6574   performance met
-0000cf10: 7269 632e 0a20 2020 2022 2222 0a0a 2020  ric..    """..  
-0000cf20: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0000cf30: 656c 662c 2064 6174 615f 782c 2064 6174  elf, data_x, dat
-0000cf40: 615f 792c 206c 696d 6974 5f73 6561 7263  a_y, limit_searc
-0000cf50: 683d 4661 6c73 652c 206f 7074 5f63 763d  h=False, opt_cv=
-0000cf60: 332c 2074 6573 745f 7369 7a65 3d4e 6f6e  3, test_size=Non
-0000cf70: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
-0000cf80: 2e64 6174 615f 7820 3d20 6461 7461 5f78  .data_x = data_x
-0000cf90: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
-0000cfa0: 7461 5f79 203d 2064 6174 615f 790a 2020  ta_y = data_y.  
-0000cfb0: 2020 2020 2020 7365 6c66 2e6c 696d 6974        self.limit
-0000cfc0: 5f73 6561 7263 6820 3d20 6c69 6d69 745f  _search = limit_
-0000cfd0: 7365 6172 6368 0a20 2020 2020 2020 2073  search.        s
-0000cfe0: 656c 662e 6f70 745f 6376 203d 206f 7074  elf.opt_cv = opt
-0000cff0: 5f63 7620 0a20 2020 2020 2020 2073 656c  _cv .        sel
-0000d000: 662e 7465 7374 5f73 697a 6520 3d20 7465  f.test_size = te
-0000d010: 7374 5f73 697a 6520 0a0a 2020 2020 6465  st_size ..    de
-0000d020: 6620 5f5f 6361 6c6c 5f5f 2873 656c 662c  f __call__(self,
-0000d030: 2074 7269 616c 293a 0a0a 2020 2020 2020   trial):..      
-0000d040: 2020 7061 7261 6d73 203d 207b 226f 626a    params = {"obj
-0000d050: 6563 7469 7665 223a 2022 6269 6e61 7279  ective": "binary
-0000d060: 3a6c 6f67 6973 7469 6322 2c20 2265 7661  :logistic", "eva
-0000d070: 6c5f 6d65 7472 6963 223a 2022 6175 6322  l_metric": "auc"
-0000d080: 7d0a 2020 2020 0a20 2020 2020 2020 2069  }.    .        i
-0000d090: 6620 7365 6c66 2e74 6573 745f 7369 7a65  f self.test_size
-0000d0a0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000d0b0: 2020 2020 2020 2020 2020 7472 6169 6e5f            train_
-0000d0c0: 782c 2076 616c 6964 5f78 2c20 7472 6169  x, valid_x, trai
-0000d0d0: 6e5f 792c 2076 616c 6964 5f79 203d 2074  n_y, valid_y = t
-0000d0e0: 7261 696e 5f74 6573 745f 7370 6c69 7428  rain_test_split(
-0000d0f0: 7365 6c66 2e64 6174 615f 782c 2073 656c  self.data_x, sel
-0000d100: 662e 6461 7461 5f79 2c20 7465 7374 5f73  f.data_y, test_s
-0000d110: 697a 653d 7365 6c66 2e74 6573 745f 7369  ize=self.test_si
-0000d120: 7a65 2c20 7261 6e64 6f6d 5f73 7461 7465  ze, random_state
-0000d130: 3d6e 702e 7261 6e64 6f6d 2e72 616e 6469  =np.random.randi
-0000d140: 6e74 2831 2c20 3165 3929 290a 2020 2020  nt(1, 1e9)).    
-0000d150: 2020 2020 2020 2020 6474 7261 696e 2c20          dtrain, 
-0000d160: 6476 616c 6964 203d 2044 4d61 7472 6978  dvalid = DMatrix
-0000d170: 2874 7261 696e 5f78 2c20 6c61 6265 6c3d  (train_x, label=
-0000d180: 7472 6169 6e5f 7929 2c20 444d 6174 7269  train_y), DMatri
-0000d190: 7828 7661 6c69 645f 782c 206c 6162 656c  x(valid_x, label
-0000d1a0: 3d76 616c 6964 5f79 290a 2020 2020 2020  =valid_y).      
-0000d1b0: 2020 2020 2020 2370 7269 6e74 2827 496e        #print('In
-0000d1c0: 6974 6961 6c69 7a69 6e67 2058 4742 6f6f  itializing XGBoo
-0000d1d0: 7374 2050 7275 6e65 722e 2e2e 2729 0a20  st Pruner...'). 
-0000d1e0: 2020 2020 2020 2020 2020 2070 7275 6e69             pruni
-0000d1f0: 6e67 5f63 616c 6c62 6163 6b20 3d20 6f70  ng_callback = op
-0000d200: 7475 6e61 2e69 6e74 6567 7261 7469 6f6e  tuna.integration
-0000d210: 2e58 4742 6f6f 7374 5072 756e 696e 6743  .XGBoostPruningC
-0000d220: 616c 6c62 6163 6b28 7472 6961 6c2c 2022  allback(trial, "
-0000d230: 7661 6c69 6461 7469 6f6e 2d61 7563 2229  validation-auc")
-0000d240: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000d250: 662e 6c69 6d69 745f 7365 6172 6368 3a0a  f.limit_search:.
-0000d260: 2020 2020 2020 2020 2020 2020 7061 7261              para
-0000d270: 6d73 5b27 6e5f 6573 7469 6d61 746f 7273  ms['n_estimators
-0000d280: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
-0000d290: 7374 5f69 6e74 2827 6e5f 6573 7469 6d61  st_int('n_estima
-0000d2a0: 746f 7273 272c 2031 3030 2c20 3235 3029  tors', 100, 250)
-0000d2b0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0000d2c0: 616d 735b 2762 6f6f 7374 6572 275d 203d  ams['booster'] =
-0000d2d0: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
-0000d2e0: 6174 6567 6f72 6963 616c 2827 626f 6f73  ategorical('boos
-0000d2f0: 7465 7227 2c20 5b27 6762 7472 6565 272c  ter', ['gbtree',
-0000d300: 2027 6461 7274 275d 290a 2020 2020 2020   'dart']).      
-0000d310: 2020 2020 2020 7061 7261 6d73 5b27 7265        params['re
-0000d320: 675f 6c61 6d62 6461 275d 203d 2074 7269  g_lambda'] = tri
-0000d330: 616c 2e73 7567 6765 7374 5f6c 6f67 756e  al.suggest_logun
-0000d340: 6966 6f72 6d28 2772 6567 5f6c 616d 6264  iform('reg_lambd
-0000d350: 6127 2c20 3165 2d38 2c20 3129 0a20 2020  a', 1e-8, 1).   
-0000d360: 2020 2020 2020 2020 2070 6172 616d 735b           params[
-0000d370: 2772 6567 5f61 6c70 6861 275d 203d 2074  'reg_alpha'] = t
-0000d380: 7269 616c 2e73 7567 6765 7374 5f6c 6f67  rial.suggest_log
-0000d390: 756e 6966 6f72 6d28 2772 6567 5f61 6c70  uniform('reg_alp
-0000d3a0: 6861 272c 2031 652d 382c 2031 290a 2020  ha', 1e-8, 1).  
-0000d3b0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000d3c0: 5b27 6d61 785f 6465 7074 6827 5d20 3d20  ['max_depth'] = 
-0000d3d0: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-0000d3e0: 7428 276d 6178 5f64 6570 7468 272c 2032  t('max_depth', 2
-0000d3f0: 2c20 3235 290a 2020 2020 2020 2020 2020  , 25).          
-0000d400: 2020 7061 7261 6d73 5b27 6574 6127 5d20    params['eta'] 
-0000d410: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-0000d420: 6c6f 6775 6e69 666f 726d 2827 6574 6127  loguniform('eta'
-0000d430: 2c20 3165 2d38 2c20 3129 0a20 2020 2020  , 1e-8, 1).     
-0000d440: 2020 2020 2020 2070 6172 616d 735b 2767         params['g
-0000d450: 616d 6d61 275d 203d 2074 7269 616c 2e73  amma'] = trial.s
-0000d460: 7567 6765 7374 5f6c 6f67 756e 6966 6f72  uggest_logunifor
-0000d470: 6d28 2767 616d 6d61 272c 2031 652d 382c  m('gamma', 1e-8,
-0000d480: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-0000d490: 7061 7261 6d73 5b27 6772 6f77 5f70 6f6c  params['grow_pol
-0000d4a0: 6963 7927 5d20 3d20 7472 6961 6c2e 7375  icy'] = trial.su
-0000d4b0: 6767 6573 745f 6361 7465 676f 7269 6361  ggest_categorica
-0000d4c0: 6c28 2767 726f 775f 706f 6c69 6379 272c  l('grow_policy',
-0000d4d0: 205b 2764 6570 7468 7769 7365 272c 2027   ['depthwise', '
-0000d4e0: 6c6f 7373 6775 6964 6527 5d29 0a0a 2020  lossguide'])..  
-0000d4f0: 2020 2020 2020 2020 2020 6966 2070 6172            if par
-0000d500: 616d 735b 2762 6f6f 7374 6572 275d 203d  ams['booster'] =
-0000d510: 3d20 2264 6172 7422 3a0a 2020 2020 2020  = "dart":.      
-0000d520: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000d530: 5b27 7361 6d70 6c65 5f74 7970 6527 5d20  ['sample_type'] 
-0000d540: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-0000d550: 6361 7465 676f 7269 6361 6c28 2773 616d  categorical('sam
-0000d560: 706c 655f 7479 7065 272c 205b 2775 6e69  ple_type', ['uni
-0000d570: 666f 726d 272c 2027 7765 6967 6874 6564  form', 'weighted
-0000d580: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0000d590: 2020 2020 7061 7261 6d73 5b27 6e6f 726d      params['norm
-0000d5a0: 616c 697a 655f 7479 7065 275d 203d 2074  alize_type'] = t
-0000d5b0: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
-0000d5c0: 6567 6f72 6963 616c 2827 6e6f 726d 616c  egorical('normal
-0000d5d0: 697a 655f 7479 7065 272c 205b 2774 7265  ize_type', ['tre
-0000d5e0: 6527 2c20 2766 6f72 6573 7427 5d29 0a20  e', 'forest']). 
-0000d5f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d600: 6172 616d 735b 2772 6174 655f 6472 6f70  arams['rate_drop
-0000d610: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
-0000d620: 7374 5f6c 6f67 756e 6966 6f72 6d28 2772  st_loguniform('r
-0000d630: 6174 655f 6472 6f70 272c 2031 652d 382c  ate_drop', 1e-8,
-0000d640: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-0000d650: 2020 2020 7061 7261 6d73 5b27 736b 6970      params['skip
-0000d660: 5f64 726f 7027 5d20 3d20 7472 6961 6c2e  _drop'] = trial.
-0000d670: 7375 6767 6573 745f 6c6f 6775 6e69 666f  suggest_logunifo
-0000d680: 726d 2827 736b 6970 5f64 726f 7027 2c20  rm('skip_drop', 
-0000d690: 3165 2d38 2c20 3129 0a20 2020 2020 2020  1e-8, 1).       
-0000d6a0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000d6b0: 2e74 6573 745f 7369 7a65 2069 7320 4e6f  .test_size is No
-0000d6c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000d6d0: 2020 2020 2020 2020 636c 6620 3d20 5847          clf = XG
-0000d6e0: 4243 6c61 7373 6966 6965 7228 626f 6f73  BClassifier(boos
-0000d6f0: 7465 723d 7061 7261 6d73 5b27 626f 6f73  ter=params['boos
-0000d700: 7465 7227 5d2c 206e 5f65 7374 696d 6174  ter'], n_estimat
-0000d710: 6f72 733d 7061 7261 6d73 5b27 6e5f 6573  ors=params['n_es
-0000d720: 7469 6d61 746f 7273 275d 2c20 7265 675f  timators'], reg_
-0000d730: 6c61 6d62 6461 3d70 6172 616d 735b 2772  lambda=params['r
-0000d740: 6567 5f6c 616d 6264 6127 5d2c 200a 2020  eg_lambda'], .  
-0000d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d760: 2020 2020 2020 7265 675f 616c 7068 613d        reg_alpha=
-0000d770: 7061 7261 6d73 5b27 7265 675f 616c 7068  params['reg_alph
-0000d780: 6127 5d2c 206d 6178 5f64 6570 7468 3d70  a'], max_depth=p
-0000d790: 6172 616d 735b 276d 6178 5f64 6570 7468  arams['max_depth
-0000d7a0: 275d 2c20 6574 613d 7061 7261 6d73 5b27  '], eta=params['
-0000d7b0: 6574 6127 5d2c 2067 616d 6d61 3d70 6172  eta'], gamma=par
-0000d7c0: 616d 735b 2767 616d 6d61 275d 2c20 0a20  ams['gamma'], . 
-0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7e0: 2020 2020 2020 2067 726f 775f 706f 6c69         grow_poli
-0000d7f0: 6379 3d70 6172 616d 735b 2767 726f 775f  cy=params['grow_
-0000d800: 706f 6c69 6379 275d 2c20 7361 6d70 6c65  policy'], sample
-0000d810: 5f74 7970 653d 7061 7261 6d73 5b27 7361  _type=params['sa
-0000d820: 6d70 6c65 5f74 7970 6527 5d2c 206e 6f72  mple_type'], nor
-0000d830: 6d61 6c69 7a65 5f74 7970 653d 7061 7261  malize_type=para
-0000d840: 6d73 5b27 6e6f 726d 616c 697a 655f 7479  ms['normalize_ty
-0000d850: 7065 275d 2c0a 2020 2020 2020 2020 2020  pe'],.          
-0000d860: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000d870: 7465 5f64 726f 703d 7061 7261 6d73 5b27  te_drop=params['
-0000d880: 7261 7465 5f64 726f 7027 5d2c 2073 6b69  rate_drop'], ski
-0000d890: 705f 6472 6f70 3d70 6172 616d 735b 2773  p_drop=params['s
-0000d8a0: 6b69 705f 6472 6f70 275d 2c20 7261 6e64  kip_drop'], rand
-0000d8b0: 6f6d 5f73 7461 7465 3d31 3930 3929 232c  om_state=1909)#,
-0000d8c0: 2074 7265 655f 6d65 7468 6f64 3d27 6869   tree_method='hi
-0000d8d0: 7374 2729 0a20 2020 2020 2020 2020 2020  st').           
-0000d8e0: 200a 2020 2020 2020 2020 2020 2020 656c   .            el
-0000d8f0: 6966 2070 6172 616d 735b 2762 6f6f 7374  if params['boost
-0000d900: 6572 275d 203d 3d20 2767 6274 7265 6527  er'] == 'gbtree'
-0000d910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d920: 2020 7061 7261 6d73 5b27 7375 6273 616d    params['subsam
-0000d930: 706c 6527 5d20 3d20 7472 6961 6c2e 7375  ple'] = trial.su
-0000d940: 6767 6573 745f 6c6f 6775 6e69 666f 726d  ggest_loguniform
-0000d950: 2827 7375 6273 616d 706c 6527 2c20 3165  ('subsample', 1e
-0000d960: 2d36 2c20 312e 3029 0a20 2020 2020 2020  -6, 1.0).       
-0000d970: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000d980: 2e74 6573 745f 7369 7a65 2069 7320 4e6f  .test_size is No
-0000d990: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000d9a0: 2020 2020 2020 2020 636c 6620 3d20 5847          clf = XG
-0000d9b0: 4243 6c61 7373 6966 6965 7228 626f 6f73  BClassifier(boos
-0000d9c0: 7465 723d 7061 7261 6d73 5b27 626f 6f73  ter=params['boos
-0000d9d0: 7465 7227 5d2c 206e 5f65 7374 696d 6174  ter'], n_estimat
-0000d9e0: 6f72 733d 7061 7261 6d73 5b27 6e5f 6573  ors=params['n_es
-0000d9f0: 7469 6d61 746f 7273 275d 2c20 7265 675f  timators'], reg_
-0000da00: 6c61 6d62 6461 3d70 6172 616d 735b 2772  lambda=params['r
-0000da10: 6567 5f6c 616d 6264 6127 5d2c 200a 2020  eg_lambda'], .  
-0000da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da30: 2020 2020 2020 7265 675f 616c 7068 613d        reg_alpha=
-0000da40: 7061 7261 6d73 5b27 7265 675f 616c 7068  params['reg_alph
-0000da50: 6127 5d2c 206d 6178 5f64 6570 7468 3d70  a'], max_depth=p
-0000da60: 6172 616d 735b 276d 6178 5f64 6570 7468  arams['max_depth
-0000da70: 275d 2c20 6574 613d 7061 7261 6d73 5b27  '], eta=params['
-0000da80: 6574 6127 5d2c 2067 616d 6d61 3d70 6172  eta'], gamma=par
-0000da90: 616d 735b 2767 616d 6d61 275d 2c20 0a20  ams['gamma'], . 
-0000daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dab0: 2020 2020 2020 2067 726f 775f 706f 6c69         grow_poli
-0000dac0: 6379 3d70 6172 616d 735b 2767 726f 775f  cy=params['grow_
-0000dad0: 706f 6c69 6379 275d 2c20 7375 6273 616d  policy'], subsam
-0000dae0: 706c 653d 7061 7261 6d73 5b27 7375 6273  ple=params['subs
-0000daf0: 616d 706c 6527 5d2c 2072 616e 646f 6d5f  ample'], random_
-0000db00: 7374 6174 653d 3139 3039 2923 2c20 7472  state=1909)#, tr
-0000db10: 6565 5f6d 6574 686f 643d 2768 6973 7427  ee_method='hist'
-0000db20: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0000db30: 6620 7365 6c66 2e74 6573 745f 7369 7a65  f self.test_size
-0000db40: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000db50: 2020 2020 2020 2020 2020 2020 2020 6273                bs
-0000db60: 7420 3d20 7472 6169 6e28 7061 7261 6d73  t = train(params
-0000db70: 2c20 6474 7261 696e 2c20 6576 616c 733d  , dtrain, evals=
-0000db80: 5b28 6476 616c 6964 2c20 2276 616c 6964  [(dvalid, "valid
-0000db90: 6174 696f 6e22 295d 2c20 6361 6c6c 6261  ation")], callba
-0000dba0: 636b 733d 5b70 7275 6e69 6e67 5f63 616c  cks=[pruning_cal
-0000dbb0: 6c62 6163 6b5d 290a 2020 2020 2020 2020  lback]).        
-0000dbc0: 2020 2020 2020 2020 7072 6564 7320 3d20          preds = 
-0000dbd0: 6273 742e 7072 6564 6963 7428 6476 616c  bst.predict(dval
-0000dbe0: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
-0000dbf0: 2020 2020 7072 6564 5f6c 6162 656c 7320      pred_labels 
-0000dc00: 3d20 6e70 2e72 696e 7428 7072 6564 7329  = np.rint(preds)
-0000dc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc20: 2061 6363 7572 6163 7920 3d20 6163 6375   accuracy = accu
-0000dc30: 7261 6379 5f73 636f 7265 2876 616c 6964  racy_score(valid
-0000dc40: 5f79 2c20 7072 6564 5f6c 6162 656c 7329  _y, pred_labels)
-0000dc50: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000dc60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000dc70: 2020 2023 4652 4f4d 2053 4b4c 4541 524e     #FROM SKLEARN
-0000dc80: 2044 4f43 554d 454e 5441 5449 4f4e 3a20   DOCUMENTATION: 
-0000dc90: 466f 7220 696e 742f 4e6f 6e65 2069 6e70  For int/None inp
-0000dca0: 7574 732c 2069 6620 7468 6520 6573 7469  uts, if the esti
-0000dcb0: 6d61 746f 7220 6973 2061 2063 6c61 7373  mator is a class
-0000dcc0: 6966 6965 7220 616e 6420 7920 6973 2065  ifier and y is e
-0000dcd0: 6974 6865 7220 6269 6e61 7279 206f 7220  ither binary or 
-0000dce0: 6d75 6c74 6963 6c61 7373 2c20 5374 7261  multiclass, Stra
-0000dcf0: 7469 6669 6564 4b46 6f6c 6420 6973 2075  tifiedKFold is u
-0000dd00: 7365 642e 2049 6e20 616c 6c20 6f74 6865  sed. In all othe
-0000dd10: 7220 6361 7365 732c 2046 6f6c 6420 6973  r cases, Fold is
-0000dd20: 2075 7365 642e 0a20 2020 2020 2020 2020   used..         
-0000dd30: 2020 2020 2020 2063 7620 3d20 6372 6f73         cv = cros
-0000dd40: 735f 7661 6c69 6461 7465 2863 6c66 2c20  s_validate(clf, 
-0000dd50: 7365 6c66 2e64 6174 615f 782c 2073 656c  self.data_x, sel
-0000dd60: 662e 6461 7461 5f79 2c20 6376 3d73 656c  f.data_y, cv=sel
-0000dd70: 662e 6f70 745f 6376 2920 0a20 2020 2020  f.opt_cv) .     
-0000dd80: 2020 2020 2020 2020 2020 2061 6363 7572             accur
-0000dd90: 6163 7920 3d20 6e70 2e6d 6561 6e28 6376  acy = np.mean(cv
-0000dda0: 5b27 7465 7374 5f73 636f 7265 275d 290a  ['test_score']).
-0000ddb0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000ddc0: 7572 6e20 6163 6375 7261 6379 0a0a 2020  urn accuracy..  
-0000ddd0: 2020 2020 2020 7061 7261 6d73 5b27 626f        params['bo
-0000dde0: 6f73 7465 7227 5d20 3d20 7472 6961 6c2e  oster'] = trial.
-0000ddf0: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
-0000de00: 6361 6c28 2762 6f6f 7374 6572 272c 205b  cal('booster', [
-0000de10: 2767 6274 7265 6527 2c20 2764 6172 7427  'gbtree', 'dart'
-0000de20: 5d29 0a20 2020 2020 2020 2070 6172 616d  ]).        param
-0000de30: 735b 276e 5f65 7374 696d 6174 6f72 7327  s['n_estimators'
-0000de40: 5d20 3d20 7472 6961 6c2e 7375 6767 6573  ] = trial.sugges
-0000de50: 745f 696e 7428 276e 5f65 7374 696d 6174  t_int('n_estimat
-0000de60: 6f72 7327 2c20 3130 302c 2035 3030 290a  ors', 100, 500).
-0000de70: 2020 2020 2020 2020 7061 7261 6d73 5b27          params['
-0000de80: 7265 675f 6c61 6d62 6461 275d 203d 2074  reg_lambda'] = t
-0000de90: 7269 616c 2e73 7567 6765 7374 5f66 6c6f  rial.suggest_flo
-0000dea0: 6174 2827 7265 675f 6c61 6d62 6461 272c  at('reg_lambda',
-0000deb0: 2030 2c20 3130 3029 0a20 2020 2020 2020   0, 100).       
-0000dec0: 2070 6172 616d 735b 2772 6567 5f61 6c70   params['reg_alp
-0000ded0: 6861 275d 203d 2074 7269 616c 2e73 7567  ha'] = trial.sug
-0000dee0: 6765 7374 5f69 6e74 2827 7265 675f 616c  gest_int('reg_al
-0000def0: 7068 6127 2c20 302c 2031 3030 290a 2020  pha', 0, 100).  
-0000df00: 2020 2020 2020 7061 7261 6d73 5b27 6d61        params['ma
-0000df10: 785f 6465 7074 6827 5d20 3d20 7472 6961  x_depth'] = tria
-0000df20: 6c2e 7375 6767 6573 745f 696e 7428 276d  l.suggest_int('m
-0000df30: 6178 5f64 6570 7468 272c 2032 2c20 3235  ax_depth', 2, 25
-0000df40: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
-0000df50: 5b27 6574 6127 5d20 3d20 7472 6961 6c2e  ['eta'] = trial.
-0000df60: 7375 6767 6573 745f 666c 6f61 7428 2765  suggest_float('e
-0000df70: 7461 272c 2031 652d 382c 2031 290a 2020  ta', 1e-8, 1).  
-0000df80: 2020 2020 2020 7061 7261 6d73 5b27 6761        params['ga
-0000df90: 6d6d 6127 5d20 3d20 7472 6961 6c2e 7375  mma'] = trial.su
-0000dfa0: 6767 6573 745f 696e 7428 2767 616d 6d61  ggest_int('gamma
-0000dfb0: 272c 2031 2c20 3130 3029 0a20 2020 2020  ', 1, 100).     
-0000dfc0: 2020 2070 6172 616d 735b 2767 726f 775f     params['grow_
-0000dfd0: 706f 6c69 6379 275d 203d 2074 7269 616c  policy'] = trial
-0000dfe0: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
-0000dff0: 6963 616c 2827 6772 6f77 5f70 6f6c 6963  ical('grow_polic
-0000e000: 7927 2c20 5b27 6465 7074 6877 6973 6527  y', ['depthwise'
-0000e010: 2c20 276c 6f73 7367 7569 6465 275d 290a  , 'lossguide']).
-0000e020: 2020 2020 2020 2020 7061 7261 6d73 5b27          params['
-0000e030: 6d69 6e5f 6368 696c 645f 7765 6967 6874  min_child_weight
-0000e040: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
-0000e050: 7374 5f69 6e74 2827 6d69 6e5f 6368 696c  st_int('min_chil
-0000e060: 645f 7765 6967 6874 272c 2031 2c20 3130  d_weight', 1, 10
-0000e070: 3029 0a20 2020 2020 2020 2070 6172 616d  0).        param
-0000e080: 735b 276d 6178 5f64 656c 7461 5f73 7465  s['max_delta_ste
-0000e090: 7027 5d20 3d20 7472 6961 6c2e 7375 6767  p'] = trial.sugg
-0000e0a0: 6573 745f 696e 7428 276d 6178 5f64 656c  est_int('max_del
-0000e0b0: 7461 5f73 7465 7027 2c20 312c 2031 3030  ta_step', 1, 100
-0000e0c0: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
-0000e0d0: 5b27 7375 6273 616d 706c 6527 5d20 3d20  ['subsample'] = 
-0000e0e0: 7472 6961 6c2e 7375 6767 6573 745f 666c  trial.suggest_fl
-0000e0f0: 6f61 7428 2773 7562 7361 6d70 6c65 272c  oat('subsample',
-0000e100: 2030 2e35 2c20 312e 3029 0a20 2020 2020   0.5, 1.0).     
-0000e110: 2020 2070 6172 616d 735b 2763 6f6c 7361     params['colsa
-0000e120: 6d70 6c65 5f62 7974 7265 6527 5d20 3d20  mple_bytree'] = 
-0000e130: 7472 6961 6c2e 7375 6767 6573 745f 666c  trial.suggest_fl
-0000e140: 6f61 7428 2763 6f6c 7361 6d70 6c65 5f62  oat('colsample_b
-0000e150: 7974 7265 6527 2c20 302e 352c 2031 290a  ytree', 0.5, 1).
-0000e160: 0a20 2020 2020 2020 2069 6620 7061 7261  .        if para
-0000e170: 6d73 5b27 626f 6f73 7465 7227 5d20 3d3d  ms['booster'] ==
-0000e180: 2022 6461 7274 223a 0a20 2020 2020 2020   "dart":.       
-0000e190: 2020 2020 2070 6172 616d 735b 2773 616d       params['sam
-0000e1a0: 706c 655f 7479 7065 275d 203d 2074 7269  ple_type'] = tri
-0000e1b0: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
-0000e1c0: 6f72 6963 616c 2827 7361 6d70 6c65 5f74  orical('sample_t
-0000e1d0: 7970 6527 2c20 5b27 756e 6966 6f72 6d27  ype', ['uniform'
-0000e1e0: 2c20 2777 6569 6768 7465 6427 5d29 0a20  , 'weighted']). 
-0000e1f0: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000e200: 735b 276e 6f72 6d61 6c69 7a65 5f74 7970  s['normalize_typ
-0000e210: 6527 5d20 3d20 7472 6961 6c2e 7375 6767  e'] = trial.sugg
-0000e220: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
-0000e230: 276e 6f72 6d61 6c69 7a65 5f74 7970 6527  'normalize_type'
-0000e240: 2c20 5b27 7472 6565 272c 2027 666f 7265  , ['tree', 'fore
-0000e250: 7374 275d 290a 2020 2020 2020 2020 2020  st']).          
-0000e260: 2020 7061 7261 6d73 5b27 7261 7465 5f64    params['rate_d
-0000e270: 726f 7027 5d20 3d20 7472 6961 6c2e 7375  rop'] = trial.su
-0000e280: 6767 6573 745f 666c 6f61 7428 2772 6174  ggest_float('rat
-0000e290: 655f 6472 6f70 272c 2031 652d 382c 2031  e_drop', 1e-8, 1
-0000e2a0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-0000e2b0: 7261 6d73 5b27 736b 6970 5f64 726f 7027  rams['skip_drop'
-0000e2c0: 5d20 3d20 7472 6961 6c2e 7375 6767 6573  ] = trial.sugges
-0000e2d0: 745f 666c 6f61 7428 2773 6b69 705f 6472  t_float('skip_dr
-0000e2e0: 6f70 272c 2031 652d 382c 2031 290a 2020  op', 1e-8, 1).  
-0000e2f0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000e300: 662e 7465 7374 5f73 697a 6520 6973 204e  f.test_size is N
-0000e310: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000e320: 2020 2020 2063 6c66 203d 2058 4742 436c       clf = XGBCl
-0000e330: 6173 7369 6669 6572 2862 6f6f 7374 6572  assifier(booster
-0000e340: 3d70 6172 616d 735b 2762 6f6f 7374 6572  =params['booster
-0000e350: 275d 2c20 6e5f 6573 7469 6d61 746f 7273  '], n_estimators
-0000e360: 3d70 6172 616d 735b 276e 5f65 7374 696d  =params['n_estim
-0000e370: 6174 6f72 7327 5d2c 2063 6f6c 7361 6d70  ators'], colsamp
-0000e380: 6c65 5f62 7974 7265 653d 7061 7261 6d73  le_bytree=params
-0000e390: 5b27 636f 6c73 616d 706c 655f 6279 7472  ['colsample_bytr
-0000e3a0: 6565 275d 2c20 0a20 2020 2020 2020 2020  ee'], .         
-0000e3b0: 2020 2020 2020 2020 2020 2072 6567 5f6c             reg_l
-0000e3c0: 616d 6264 613d 7061 7261 6d73 5b27 7265  ambda=params['re
-0000e3d0: 675f 6c61 6d62 6461 275d 2c20 7265 675f  g_lambda'], reg_
-0000e3e0: 616c 7068 613d 7061 7261 6d73 5b27 7265  alpha=params['re
-0000e3f0: 675f 616c 7068 6127 5d2c 206d 6178 5f64  g_alpha'], max_d
-0000e400: 6570 7468 3d70 6172 616d 735b 276d 6178  epth=params['max
-0000e410: 5f64 6570 7468 275d 2c20 6574 613d 7061  _depth'], eta=pa
-0000e420: 7261 6d73 5b27 6574 6127 5d2c 200a 2020  rams['eta'], .  
-0000e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e440: 2020 6761 6d6d 613d 7061 7261 6d73 5b27    gamma=params['
-0000e450: 6761 6d6d 6127 5d2c 2067 726f 775f 706f  gamma'], grow_po
-0000e460: 6c69 6379 3d70 6172 616d 735b 2767 726f  licy=params['gro
-0000e470: 775f 706f 6c69 6379 275d 2c20 6d69 6e5f  w_policy'], min_
-0000e480: 6368 696c 645f 7765 6967 6874 3d70 6172  child_weight=par
-0000e490: 616d 735b 276d 696e 5f63 6869 6c64 5f77  ams['min_child_w
-0000e4a0: 6569 6768 7427 5d2c 200a 2020 2020 2020  eight'], .      
-0000e4b0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000e4c0: 785f 6465 6c74 615f 7374 6570 3d70 6172  x_delta_step=par
-0000e4d0: 616d 735b 276d 6178 5f64 656c 7461 5f73  ams['max_delta_s
-0000e4e0: 7465 7027 5d2c 2073 7562 7361 6d70 6c65  tep'], subsample
-0000e4f0: 3d70 6172 616d 735b 2773 7562 7361 6d70  =params['subsamp
-0000e500: 6c65 275d 2c20 7361 6d70 6c65 5f74 7970  le'], sample_typ
-0000e510: 653d 7061 7261 6d73 5b27 7361 6d70 6c65  e=params['sample
-0000e520: 5f74 7970 6527 5d2c 200a 2020 2020 2020  _type'], .      
-0000e530: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-0000e540: 726d 616c 697a 655f 7479 7065 3d70 6172  rmalize_type=par
-0000e550: 616d 735b 276e 6f72 6d61 6c69 7a65 5f74  ams['normalize_t
-0000e560: 7970 6527 5d2c 2072 6174 655f 6472 6f70  ype'], rate_drop
-0000e570: 3d70 6172 616d 735b 2772 6174 655f 6472  =params['rate_dr
-0000e580: 6f70 275d 2c20 736b 6970 5f64 726f 703d  op'], skip_drop=
-0000e590: 7061 7261 6d73 5b27 736b 6970 5f64 726f  params['skip_dro
-0000e5a0: 7027 5d2c 2072 616e 646f 6d5f 7374 6174  p'], random_stat
-0000e5b0: 653d 3139 3039 2923 2c20 7472 6565 5f6d  e=1909)#, tree_m
-0000e5c0: 6574 686f 643d 2768 6973 7427 290a 2020  ethod='hist').  
-0000e5d0: 2020 2020 2020 656c 6966 2070 6172 616d        elif param
-0000e5e0: 735b 2762 6f6f 7374 6572 275d 203d 3d20  s['booster'] == 
-0000e5f0: 2767 6274 7265 6527 3a0a 2020 2020 2020  'gbtree':.      
-0000e600: 2020 2020 2020 6966 2073 656c 662e 7465        if self.te
-0000e610: 7374 5f73 697a 6520 6973 204e 6f6e 653a  st_size is None:
-0000e620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e630: 2063 6c66 203d 2058 4742 436c 6173 7369   clf = XGBClassi
-0000e640: 6669 6572 2862 6f6f 7374 6572 3d70 6172  fier(booster=par
-0000e650: 616d 735b 2762 6f6f 7374 6572 275d 2c20  ams['booster'], 
-0000e660: 6e5f 6573 7469 6d61 746f 7273 3d70 6172  n_estimators=par
-0000e670: 616d 735b 276e 5f65 7374 696d 6174 6f72  ams['n_estimator
-0000e680: 7327 5d2c 2063 6f6c 7361 6d70 6c65 5f62  s'], colsample_b
-0000e690: 7974 7265 653d 7061 7261 6d73 5b27 636f  ytree=params['co
-0000e6a0: 6c73 616d 706c 655f 6279 7472 6565 275d  lsample_bytree']
-0000e6b0: 2c20 2072 6567 5f6c 616d 6264 613d 7061  ,  reg_lambda=pa
-0000e6c0: 7261 6d73 5b27 7265 675f 6c61 6d62 6461  rams['reg_lambda
-0000e6d0: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
-0000e6e0: 2020 2020 2020 2020 2072 6567 5f61 6c70           reg_alp
-0000e6f0: 6861 3d70 6172 616d 735b 2772 6567 5f61  ha=params['reg_a
-0000e700: 6c70 6861 275d 2c20 6d61 785f 6465 7074  lpha'], max_dept
-0000e710: 683d 7061 7261 6d73 5b27 6d61 785f 6465  h=params['max_de
-0000e720: 7074 6827 5d2c 2065 7461 3d70 6172 616d  pth'], eta=param
-0000e730: 735b 2765 7461 275d 2c20 6761 6d6d 613d  s['eta'], gamma=
-0000e740: 7061 7261 6d73 5b27 6761 6d6d 6127 5d2c  params['gamma'],
-0000e750: 2067 726f 775f 706f 6c69 6379 3d70 6172   grow_policy=par
-0000e760: 616d 735b 2767 726f 775f 706f 6c69 6379  ams['grow_policy
-0000e770: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
-0000e780: 2020 2020 2020 2020 206d 696e 5f63 6869           min_chi
-0000e790: 6c64 5f77 6569 6768 743d 7061 7261 6d73  ld_weight=params
-0000e7a0: 5b27 6d69 6e5f 6368 696c 645f 7765 6967  ['min_child_weig
-0000e7b0: 6874 275d 2c20 6d61 785f 6465 6c74 615f  ht'], max_delta_
-0000e7c0: 7374 6570 3d70 6172 616d 735b 276d 6178  step=params['max
-0000e7d0: 5f64 656c 7461 5f73 7465 7027 5d2c 2073  _delta_step'], s
-0000e7e0: 7562 7361 6d70 6c65 3d70 6172 616d 735b  ubsample=params[
-0000e7f0: 2773 7562 7361 6d70 6c65 275d 2c20 7261  'subsample'], ra
-0000e800: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
-0000e810: 232c 2074 7265 655f 6d65 7468 6f64 3d27  #, tree_method='
-0000e820: 6869 7374 2729 0a20 2020 2020 2020 2020  hist').         
-0000e830: 2020 200a 2020 2020 2020 2020 6966 2073     .        if s
-0000e840: 656c 662e 7465 7374 5f73 697a 6520 6973  elf.test_size is
-0000e850: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000e860: 2020 2020 2020 2062 7374 203d 2074 7261         bst = tra
-0000e870: 696e 2870 6172 616d 732c 2064 7472 6169  in(params, dtrai
-0000e880: 6e2c 2065 7661 6c73 3d5b 2864 7661 6c69  n, evals=[(dvali
-0000e890: 642c 2022 7661 6c69 6461 7469 6f6e 2229  d, "validation")
-0000e8a0: 5d2c 2063 616c 6c62 6163 6b73 3d5b 7072  ], callbacks=[pr
-0000e8b0: 756e 696e 675f 6361 6c6c 6261 636b 5d29  uning_callback])
-0000e8c0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-0000e8d0: 6473 203d 2062 7374 2e70 7265 6469 6374  ds = bst.predict
-0000e8e0: 2864 7661 6c69 6429 0a20 2020 2020 2020  (dvalid).       
-0000e8f0: 2020 2020 2070 7265 645f 6c61 6265 6c73       pred_labels
-0000e900: 203d 206e 702e 7269 6e74 2870 7265 6473   = np.rint(preds
-0000e910: 290a 2020 2020 2020 2020 2020 2020 6163  ).            ac
-0000e920: 6375 7261 6379 203d 2061 6363 7572 6163  curacy = accurac
-0000e930: 795f 7363 6f72 6528 7661 6c69 645f 792c  y_score(valid_y,
-0000e940: 2070 7265 645f 6c61 6265 6c73 290a 2020   pred_labels).  
-0000e950: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000e960: 2020 2020 2020 2020 6376 203d 2063 726f          cv = cro
-0000e970: 7373 5f76 616c 6964 6174 6528 636c 662c  ss_validate(clf,
-0000e980: 2073 656c 662e 6461 7461 5f78 2c20 7365   self.data_x, se
-0000e990: 6c66 2e64 6174 615f 792c 2063 763d 7365  lf.data_y, cv=se
-0000e9a0: 6c66 2e6f 7074 5f63 7629 0a20 2020 2020  lf.opt_cv).     
-0000e9b0: 2020 2020 2020 2061 6363 7572 6163 7920         accuracy 
-0000e9c0: 3d20 6e70 2e6d 6561 6e28 6376 5b27 7465  = np.mean(cv['te
-0000e9d0: 7374 5f73 636f 7265 275d 290a 2020 2020  st_score']).    
-0000e9e0: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
-0000e9f0: 7572 6e20 6163 6375 7261 6379 0a0a 636c  urn accuracy..cl
-0000ea00: 6173 7320 6f62 6a65 6374 6976 655f 6e6e  ass objective_nn
-0000ea10: 286f 626a 6563 7429 3a0a 2020 2020 2222  (object):.    ""
-0000ea20: 220a 2020 2020 4f70 7469 6d69 7a61 7469  ".    Optimizati
-0000ea30: 6f6e 206f 626a 6563 7469 7665 2066 756e  on objective fun
-0000ea40: 6374 696f 6e20 666f 7220 7468 6520 7363  ction for the sc
-0000ea50: 696b 6974 2d6c 6561 726e 2069 6d70 6c65  ikit-learn imple
-0000ea60: 6d65 6e74 6174 696e 206f 6620 7468 650a  mentatin of the.
-0000ea70: 2020 2020 4d4c 5020 636c 6173 7369 6669      MLP classifi
-0000ea80: 6572 2e20 5468 6520 4f70 7475 6e61 2073  er. The Optuna s
-0000ea90: 6f66 7477 6172 6520 666f 7220 6879 7065  oftware for hype
-0000eaa0: 7270 6172 616d 6574 6572 206f 7074 696d  rparameter optim
-0000eab0: 697a 6174 696f 6e0a 2020 2020 7761 7320  ization.    was 
-0000eac0: 7075 626c 6973 6865 6420 696e 2032 3031  published in 201
-0000ead0: 3920 6279 2041 6b69 6261 2065 7420 616c  9 by Akiba et al
-0000eae0: 2e20 5061 7065 723a 2068 7474 7073 3a2f  . Paper: https:/
-0000eaf0: 2f61 7278 6976 2e6f 7267 2f61 6273 2f31  /arxiv.org/abs/1
-0000eb00: 3930 372e 3130 3930 322e 0a0a 2020 2020  907.10902...    
-0000eb10: 5468 6520 746f 7461 6c20 6e75 6d62 6572  The total number
-0000eb20: 206f 6620 6869 6464 656e 206c 6179 6572   of hidden layer
-0000eb30: 7320 746f 2074 6573 7420 6973 206c 696d  s to test is lim
-0000eb40: 6974 6564 2074 6f20 3130 2c20 7769 7468  ited to 10, with
-0000eb50: 2031 3030 2d35 3030 3020 706f 7373 6962   100-5000 possib
-0000eb60: 6c65 200a 2020 2020 6e75 6d62 6572 206f  le .    number o
-0000eb70: 6620 6e65 7572 6f6e 7320 696e 2065 6163  f neurons in eac
-0000eb80: 682e 0a0a 2020 2020 4172 6773 3a0a 2020  h...    Args:.  
-0000eb90: 2020 2020 2020 6461 7461 5f78 2028 6e64        data_x (nd
-0000eba0: 6172 7261 7929 3a20 3244 2061 7272 6179  array): 2D array
-0000ebb0: 206f 6620 7369 7a65 2028 6e20 7820 6d29   of size (n x m)
-0000ebc0: 2c20 7768 6572 6520 6e20 6973 2074 6865  , where n is the
-0000ebd0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-0000ebe0: 6265 7220 6f66 2073 616d 706c 6573 2c20  ber of samples, 
-0000ebf0: 616e 6420 6d20 7468 6520 6e75 6d62 6572  and m the number
-0000ec00: 206f 6620 6665 6174 7572 6573 2e0a 2020   of features..  
-0000ec10: 2020 2020 2020 6461 7461 5f79 2028 6e64        data_y (nd
-0000ec20: 6172 7261 792c 2073 7472 293a 2031 4420  array, str): 1D 
-0000ec30: 6172 7261 7920 636f 6e74 6169 6e69 6e67  array containing
-0000ec40: 2074 6865 2063 6f72 7265 7370 6f6e 696e   the corresponin
-0000ec50: 6720 6c61 6265 6c73 2e20 0a20 2020 2020  g labels. .     
-0000ec60: 2020 206f 7074 5f63 7620 2869 6e74 293a     opt_cv (int):
-0000ec70: 2043 726f 7373 2d76 616c 6964 6174 696f   Cross-validatio
-0000ec80: 6e73 2074 6f20 7065 7266 6f72 6d20 7768  ns to perform wh
-0000ec90: 656e 2061 7373 6573 696e 6720 7468 6520  en assesing the 
-0000eca0: 7065 7266 6f72 6d61 6e63 6520 6174 2065  performance at e
-0000ecb0: 6163 680a 2020 2020 2020 2020 2020 2020  ach.            
-0000ecc0: 6879 7065 7270 6172 616d 6574 6572 206f  hyperparameter o
-0000ecd0: 7074 696d 697a 6174 696f 6e20 7472 6961  ptimization tria
-0000ece0: 6c2e 2046 6f72 2065 7861 6d70 6c65 2c20  l. For example, 
-0000ecf0: 6966 2063 763d 332c 2074 6865 6e20 6561  if cv=3, then ea
-0000ed00: 6368 206f 7074 696d 697a 6174 696f 6e20  ch optimization 
-0000ed10: 7472 6961 6c0a 2020 2020 2020 2020 2020  trial.          
-0000ed20: 2020 7769 6c6c 2062 6520 6173 7365 7373    will be assess
-0000ed30: 6564 2061 6363 6f72 6469 6e67 2074 6f20  ed according to 
-0000ed40: 7468 6520 332d 666f 6c64 2063 726f 7373  the 3-fold cross
-0000ed50: 2076 616c 6964 6174 696f 6e20 6163 6375   validation accu
-0000ed60: 7261 6379 2e20 0a0a 2020 2020 5265 7475  racy. ..    Retu
-0000ed70: 726e 733a 0a20 2020 2020 2020 2054 6865  rns:.        The
-0000ed80: 2070 6572 666f 726d 616e 6365 206d 6574   performance met
-0000ed90: 7269 632c 2064 6574 6572 6d69 6e65 6420  ric, determined 
-0000eda0: 7573 696e 6720 7468 6520 6372 6f73 732d  using the cross-
-0000edb0: 666f 6c64 2076 616c 6964 6174 696f 6e20  fold validation 
-0000edc0: 6d65 7468 6f64 2e0a 2020 2020 2222 220a  method..    """.
-0000edd0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0000ede0: 5f28 7365 6c66 2c20 6461 7461 5f78 2c20  _(self, data_x, 
-0000edf0: 6461 7461 5f79 2c20 6f70 745f 6376 293a  data_y, opt_cv):
-0000ee00: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
-0000ee10: 7461 5f78 203d 2064 6174 615f 780a 2020  ta_x = data_x.  
-0000ee20: 2020 2020 2020 7365 6c66 2e64 6174 615f        self.data_
-0000ee30: 7920 3d20 6461 7461 5f79 0a20 2020 2020  y = data_y.     
-0000ee40: 2020 2073 656c 662e 6f70 745f 6376 203d     self.opt_cv =
-0000ee50: 206f 7074 5f63 760a 0a20 2020 2064 6566   opt_cv..    def
-0000ee60: 205f 5f63 616c 6c5f 5f28 7365 6c66 2c20   __call__(self, 
-0000ee70: 7472 6961 6c29 3a0a 2020 2020 2020 2020  trial):.        
-0000ee80: 6c65 6172 6e69 6e67 5f72 6174 655f 696e  learning_rate_in
-0000ee90: 6974 203d 2074 7269 616c 2e73 7567 6765  it = trial.sugge
-0000eea0: 7374 5f66 6c6f 6174 2827 6c65 6172 6e69  st_float('learni
-0000eeb0: 6e67 5f72 6174 655f 696e 6974 272c 2031  ng_rate_init', 1
-0000eec0: 652d 352c 2030 2e31 2c20 7374 6570 3d31  e-5, 0.1, step=1
-0000eed0: 652d 3529 0a20 2020 2020 2020 2073 6f6c  e-5).        sol
-0000eee0: 7665 7220 3d20 7472 6961 6c2e 7375 6767  ver = trial.sugg
-0000eef0: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
-0000ef00: 2273 6f6c 7665 7222 2c20 5b22 7367 6422  "solver", ["sgd"
-0000ef10: 2c20 2261 6461 6d22 5d29 2023 226c 6266  , "adam"]) #"lbf
-0000ef20: 6773 220a 2020 2020 2020 2020 6163 7469  gs".        acti
-0000ef30: 7661 7469 6f6e 203d 2074 7269 616c 2e73  vation = trial.s
-0000ef40: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
-0000ef50: 616c 2822 6163 7469 7661 7469 6f6e 222c  al("activation",
-0000ef60: 205b 226c 6f67 6973 7469 6322 2c20 2274   ["logistic", "t
-0000ef70: 616e 6822 2c20 2272 656c 7522 5d29 0a20  anh", "relu"]). 
-0000ef80: 2020 2020 2020 206c 6561 726e 696e 675f         learning_
-0000ef90: 7261 7465 203d 2074 7269 616c 2e73 7567  rate = trial.sug
-0000efa0: 6765 7374 5f63 6174 6567 6f72 6963 616c  gest_categorical
-0000efb0: 2822 6c65 6172 6e69 6e67 5f72 6174 6522  ("learning_rate"
-0000efc0: 2c20 5b22 636f 6e73 7461 6e74 222c 2022  , ["constant", "
-0000efd0: 696e 7673 6361 6c69 6e67 222c 2022 6164  invscaling", "ad
-0000efe0: 6170 7469 7665 225d 290a 2020 2020 2020  aptive"]).      
-0000eff0: 2020 616c 7068 6120 3d20 7472 6961 6c2e    alpha = trial.
-0000f000: 7375 6767 6573 745f 666c 6f61 7428 2261  suggest_float("a
-0000f010: 6c70 6861 222c 2031 652d 372c 2031 2c20  lpha", 1e-7, 1, 
-0000f020: 7374 6570 3d31 652d 3629 0a20 2020 2020  step=1e-6).     
-0000f030: 2020 2062 6174 6368 5f73 697a 6520 3d20     batch_size = 
-0000f040: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-0000f050: 7428 2762 6174 6368 5f73 697a 6527 2c20  t('batch_size', 
-0000f060: 312c 2031 3030 3029 0a20 2020 2020 2020  1, 1000).       
-0000f070: 206e 5f6c 6179 6572 7320 3d20 7472 6961   n_layers = tria
-0000f080: 6c2e 7375 6767 6573 745f 696e 7428 2768  l.suggest_int('h
-0000f090: 6964 6465 6e5f 6c61 7965 725f 7369 7a65  idden_layer_size
-0000f0a0: 7327 2c20 312c 2031 3029 0a0a 2020 2020  s', 1, 10)..    
-0000f0b0: 2020 2020 6c61 7965 7273 203d 205b 5d0a      layers = [].
-0000f0c0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0000f0d0: 2072 616e 6765 286e 5f6c 6179 6572 7329   range(n_layers)
-0000f0e0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-0000f0f0: 7965 7273 2e61 7070 656e 6428 7472 6961  yers.append(tria
-0000f100: 6c2e 7375 6767 6573 745f 696e 7428 6627  l.suggest_int(f'
-0000f110: 6e5f 756e 6974 735f 7b69 7d27 2c20 3130  n_units_{i}', 10
-0000f120: 302c 2035 3030 3029 290a 0a20 2020 2020  0, 5000))..     
-0000f130: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000f140: 2020 2020 636c 6620 3d20 4d4c 5043 6c61      clf = MLPCla
-0000f150: 7373 6966 6965 7228 6869 6464 656e 5f6c  ssifier(hidden_l
-0000f160: 6179 6572 5f73 697a 6573 3d74 7570 6c65  ayer_sizes=tuple
-0000f170: 286c 6179 6572 7329 2c6c 6561 726e 696e  (layers),learnin
-0000f180: 675f 7261 7465 5f69 6e69 743d 6c65 6172  g_rate_init=lear
-0000f190: 6e69 6e67 5f72 6174 655f 696e 6974 2c20  ning_rate_init, 
-0000f1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f1b0: 2073 6f6c 7665 723d 736f 6c76 6572 2c20   solver=solver, 
-0000f1c0: 6163 7469 7661 7469 6f6e 3d61 6374 6976  activation=activ
-0000f1d0: 6174 696f 6e2c 2061 6c70 6861 3d61 6c70  ation, alpha=alp
-0000f1e0: 6861 2c20 6261 7463 685f 7369 7a65 3d62  ha, batch_size=b
-0000f1f0: 6174 6368 5f73 697a 652c 206d 6178 5f69  atch_size, max_i
-0000f200: 7465 723d 3235 3030 2c20 7261 6e64 6f6d  ter=2500, random
-0000f210: 5f73 7461 7465 3d31 3930 3929 0a20 2020  _state=1909).   
-0000f220: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-0000f230: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0000f240: 496e 7661 6c69 6420 6879 7065 7270 6172  Invalid hyperpar
-0000f250: 616d 6574 6572 2063 6f6d 6269 6e61 7469  ameter combinati
-0000f260: 6f6e 2c20 736b 6970 7069 6e67 2074 7269  on, skipping tri
-0000f270: 616c 2229 0a20 2020 2020 2020 2020 2020  al").           
-0000f280: 2072 6574 7572 6e20 302e 300a 0a20 2020   return 0.0..   
-0000f290: 2020 2020 2063 7620 3d20 6372 6f73 735f       cv = cross_
-0000f2a0: 7661 6c69 6461 7465 2863 6c66 2c20 7365  validate(clf, se
-0000f2b0: 6c66 2e64 6174 615f 782c 2073 656c 662e  lf.data_x, self.
-0000f2c0: 6461 7461 5f79 2c20 6376 3d73 656c 662e  data_y, cv=self.
-0000f2d0: 6f70 745f 6376 290a 2020 2020 2020 2020  opt_cv).        
-0000f2e0: 6669 6e61 6c5f 7363 6f72 6520 3d20 6e70  final_score = np
-0000f2f0: 2e6d 6561 6e28 6376 5b27 7465 7374 5f73  .mean(cv['test_s
-0000f300: 636f 7265 275d 290a 0a20 2020 2020 2020  core'])..       
-0000f310: 2072 6574 7572 6e20 6669 6e61 6c5f 7363   return final_sc
-0000f320: 6f72 650a 0a63 6c61 7373 206f 626a 6563  ore..class objec
-0000f330: 7469 7665 5f72 6628 6f62 6a65 6374 293a  tive_rf(object):
-0000f340: 0a20 2020 2022 2222 0a20 2020 204f 7074  .    """.    Opt
-0000f350: 696d 697a 6174 696f 6e20 6f62 6a65 6374  imization object
-0000f360: 6976 6520 6675 6e63 7469 6f6e 2066 6f72  ive function for
-0000f370: 2074 6865 2073 6369 6b69 742d 6c65 6172   the scikit-lear
-0000f380: 6e20 696d 706c 656d 656e 7461 7469 6e20  n implementatin 
-0000f390: 6f66 2074 6865 0a20 2020 2052 616e 646f  of the.    Rando
-0000f3a0: 6d20 466f 7265 7374 2063 6c61 7373 6966  m Forest classif
-0000f3b0: 6965 722e 2054 6865 204f 7074 756e 6120  ier. The Optuna 
-0000f3c0: 736f 6674 7761 7265 2066 6f72 2068 7970  software for hyp
-0000f3d0: 6572 7061 7261 6d65 7465 7220 6f70 7469  erparameter opti
-0000f3e0: 6d69 7a61 7469 6f6e 0a20 2020 2077 6173  mization.    was
-0000f3f0: 2070 7562 6c69 7368 6564 2069 6e20 3230   published in 20
-0000f400: 3139 2062 7920 416b 6962 6120 6574 2061  19 by Akiba et a
-0000f410: 6c2e 2050 6170 6572 3a20 6874 7470 733a  l. Paper: https:
-0000f420: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
-0000f430: 3139 3037 2e31 3039 3032 0a0a 2020 2020  1907.10902..    
-0000f440: 4172 6773 3a0a 2020 2020 2020 2020 6461  Args:.        da
-0000f450: 7461 5f78 2028 6e64 6172 7261 7929 3a20  ta_x (ndarray): 
-0000f460: 3244 2061 7272 6179 206f 6620 7369 7a65  2D array of size
-0000f470: 2028 6e20 7820 6d29 2c20 7768 6572 6520   (n x m), where 
-0000f480: 6e20 6973 2074 6865 0a20 2020 2020 2020  n is the.       
-0000f490: 2020 2020 206e 756d 6265 7220 6f66 2073       number of s
-0000f4a0: 616d 706c 6573 2c20 616e 6420 6d20 7468  amples, and m th
-0000f4b0: 6520 6e75 6d62 6572 206f 6620 6665 6174  e number of feat
-0000f4c0: 7572 6573 2e0a 2020 2020 2020 2020 6461  ures..        da
-0000f4d0: 7461 5f79 2028 6e64 6172 7261 792c 2073  ta_y (ndarray, s
-0000f4e0: 7472 293a 2031 4420 6172 7261 7920 636f  tr): 1D array co
-0000f4f0: 6e74 6169 6e69 6e67 2074 6865 2063 6f72  ntaining the cor
-0000f500: 7265 7370 6f6e 696e 6720 6c61 6265 6c73  responing labels
-0000f510: 2e20 0a20 2020 2020 2020 206f 7074 5f63  . .        opt_c
-0000f520: 7620 2869 6e74 293a 2043 726f 7373 2d76  v (int): Cross-v
-0000f530: 616c 6964 6174 696f 6e73 2074 6f20 7065  alidations to pe
-0000f540: 7266 6f72 6d20 7768 656e 2061 7373 6573  rform when asses
-0000f550: 696e 6720 7468 6520 7065 7266 6f72 6d61  ing the performa
-0000f560: 6e63 6520 6174 2065 6163 680a 2020 2020  nce at each.    
-0000f570: 2020 2020 2020 2020 6879 7065 7270 6172          hyperpar
-0000f580: 616d 6574 6572 206f 7074 696d 697a 6174  ameter optimizat
-0000f590: 696f 6e20 7472 6961 6c2e 2046 6f72 2065  ion trial. For e
-0000f5a0: 7861 6d70 6c65 2c20 6966 2063 763d 332c  xample, if cv=3,
-0000f5b0: 2074 6865 6e20 6561 6368 206f 7074 696d   then each optim
-0000f5c0: 697a 6174 696f 6e20 7472 6961 6c0a 2020  ization trial.  
-0000f5d0: 2020 2020 2020 2020 2020 7769 6c6c 2062            will b
-0000f5e0: 6520 6173 7365 7373 6564 2061 6363 6f72  e assessed accor
-0000f5f0: 6469 6e67 2074 6f20 7468 6520 332d 666f  ding to the 3-fo
-0000f600: 6c64 2063 726f 7373 2076 616c 6964 6174  ld cross validat
-0000f610: 696f 6e20 6163 6375 7261 6379 2e20 0a0a  ion accuracy. ..
-0000f620: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-0000f630: 2020 2020 2054 6865 2070 6572 666f 726d       The perform
-0000f640: 616e 6365 206d 6574 7269 632c 2064 6574  ance metric, det
-0000f650: 6572 6d69 6e65 6420 7573 696e 6720 7468  ermined using th
-0000f660: 6520 6372 6f73 732d 666f 6c64 2076 616c  e cross-fold val
-0000f670: 6964 6174 696f 6e20 6d65 7468 6f64 2e0a  idation method..
-0000f680: 2020 2020 2222 220a 2020 2020 0a20 2020      """.    .   
-0000f690: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0000f6a0: 6c66 2c20 6461 7461 5f78 2c20 6461 7461  lf, data_x, data
-0000f6b0: 5f79 2c20 6f70 745f 6376 293a 0a0a 2020  _y, opt_cv):..  
-0000f6c0: 2020 2020 2020 7365 6c66 2e64 6174 615f        self.data_
-0000f6d0: 7820 3d20 6461 7461 5f78 0a20 2020 2020  x = data_x.     
-0000f6e0: 2020 2073 656c 662e 6461 7461 5f79 203d     self.data_y =
-0000f6f0: 2064 6174 615f 790a 2020 2020 2020 2020   data_y.        
-0000f700: 7365 6c66 2e6f 7074 5f63 7620 3d20 6f70  self.opt_cv = op
-0000f710: 745f 6376 0a0a 2020 2020 6465 6620 5f5f  t_cv..    def __
-0000f720: 6361 6c6c 5f5f 2873 656c 662c 2074 7269  call__(self, tri
-0000f730: 616c 293a 0a0a 2020 2020 2020 2020 6e5f  al):..        n_
-0000f740: 6573 7469 6d61 746f 7273 203d 2074 7269  estimators = tri
-0000f750: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-0000f760: 6e5f 6573 7469 6d61 746f 7273 272c 2031  n_estimators', 1
-0000f770: 3030 2c20 3330 3030 290a 2020 2020 2020  00, 3000).      
-0000f780: 2020 6372 6974 6572 696f 6e20 3d20 7472    criterion = tr
-0000f790: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
-0000f7a0: 676f 7269 6361 6c28 2763 7269 7465 7269  gorical('criteri
-0000f7b0: 6f6e 272c 205b 2767 696e 6927 2c20 2765  on', ['gini', 'e
-0000f7c0: 6e74 726f 7079 275d 290a 2020 2020 2020  ntropy']).      
-0000f7d0: 2020 6d61 785f 6465 7074 6820 3d20 7472    max_depth = tr
-0000f7e0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
-0000f7f0: 276d 6178 5f64 6570 7468 272c 2032 2c20  'max_depth', 2, 
-0000f800: 3235 290a 2020 2020 2020 2020 6d69 6e5f  25).        min_
-0000f810: 7361 6d70 6c65 735f 7370 6c69 7420 3d20  samples_split = 
-0000f820: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-0000f830: 7428 276d 696e 5f73 616d 706c 6573 5f73  t('min_samples_s
-0000f840: 706c 6974 272c 2032 2c20 3235 290a 2020  plit', 2, 25).  
-0000f850: 2020 2020 2020 6d69 6e5f 7361 6d70 6c65        min_sample
-0000f860: 735f 6c65 6166 203d 2074 7269 616c 2e73  s_leaf = trial.s
-0000f870: 7567 6765 7374 5f69 6e74 2827 6d69 6e5f  uggest_int('min_
-0000f880: 7361 6d70 6c65 735f 6c65 6166 272c 2031  samples_leaf', 1
-0000f890: 2c20 3135 290a 2020 2020 2020 2020 6d61  , 15).        ma
-0000f8a0: 785f 6665 6174 7572 6573 203d 2074 7269  x_features = tri
-0000f8b0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-0000f8c0: 6d61 785f 6665 6174 7572 6573 272c 2031  max_features', 1
-0000f8d0: 2c20 7365 6c66 2e64 6174 615f 782e 7368  , self.data_x.sh
-0000f8e0: 6170 655b 315d 290a 2020 2020 2020 2020  ape[1]).        
-0000f8f0: 626f 6f74 7374 7261 7020 3d20 7472 6961  bootstrap = tria
-0000f900: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
-0000f910: 7269 6361 6c28 2762 6f6f 7473 7472 6170  rical('bootstrap
-0000f920: 272c 205b 5472 7565 2c20 4661 6c73 655d  ', [True, False]
-0000f930: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-0000f940: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000f950: 2020 2020 636c 6620 3d20 5261 6e64 6f6d      clf = Random
-0000f960: 466f 7265 7374 436c 6173 7369 6669 6572  ForestClassifier
-0000f970: 286e 5f65 7374 696d 6174 6f72 733d 6e5f  (n_estimators=n_
-0000f980: 6573 7469 6d61 746f 7273 2c20 6372 6974  estimators, crit
-0000f990: 6572 696f 6e3d 6372 6974 6572 696f 6e2c  erion=criterion,
-0000f9a0: 206d 6178 5f64 6570 7468 3d6d 6178 5f64   max_depth=max_d
-0000f9b0: 6570 7468 2c0a 2020 2020 2020 2020 2020  epth,.          
-0000f9c0: 2020 2020 2020 6d69 6e5f 7361 6d70 6c65        min_sample
-0000f9d0: 735f 7370 6c69 743d 6d69 6e5f 7361 6d70  s_split=min_samp
-0000f9e0: 6c65 735f 7370 6c69 742c 206d 696e 5f73  les_split, min_s
-0000f9f0: 616d 706c 6573 5f6c 6561 663d 6d69 6e5f  amples_leaf=min_
-0000fa00: 7361 6d70 6c65 735f 6c65 6166 2c0a 2020  samples_leaf,.  
-0000fa10: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000fa20: 785f 6665 6174 7572 6573 3d6d 6178 5f66  x_features=max_f
-0000fa30: 6561 7475 7265 732c 2062 6f6f 7473 7472  eatures, bootstr
-0000fa40: 6170 3d62 6f6f 7473 7472 6170 2c20 7261  ap=bootstrap, ra
-0000fa50: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
-0000fa60: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-0000fa70: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000fa80: 6e74 2822 496e 7661 6c69 6420 6879 7065  nt("Invalid hype
-0000fa90: 7270 6172 616d 6574 6572 2063 6f6d 6269  rparameter combi
-0000faa0: 6e61 7469 6f6e 2c20 736b 6970 7069 6e67  nation, skipping
-0000fab0: 2074 7269 616c 2229 0a20 2020 2020 2020   trial").       
-0000fac0: 2020 2020 2072 6574 7572 6e20 302e 300a       return 0.0.
-0000fad0: 0a20 2020 2020 2020 2063 7620 3d20 6372  .        cv = cr
-0000fae0: 6f73 735f 7661 6c69 6461 7465 2863 6c66  oss_validate(clf
-0000faf0: 2c20 7365 6c66 2e64 6174 615f 782c 2073  , self.data_x, s
-0000fb00: 656c 662e 6461 7461 5f79 2c20 6376 3d73  elf.data_y, cv=s
-0000fb10: 656c 662e 6f70 745f 6376 290a 2020 2020  elf.opt_cv).    
-0000fb20: 2020 2020 6669 6e61 6c5f 7363 6f72 6520      final_score 
-0000fb30: 3d20 6e70 2e6d 6561 6e28 6376 5b27 7465  = np.mean(cv['te
-0000fb40: 7374 5f73 636f 7265 275d 290a 0a20 2020  st_score'])..   
-0000fb50: 2020 2020 2072 6574 7572 6e20 6669 6e61       return fina
-0000fb60: 6c5f 7363 6f72 650a 0a0a 636c 6173 7320  l_score...class 
-0000fb70: 4d6f 6e69 746f 725f 5472 6163 6b65 7228  Monitor_Tracker(
-0000fb80: 4361 6c6c 6261 636b 293a 0a20 2020 2022  Callback):.    "
-0000fb90: 2222 0a20 2020 2043 7573 746f 6d20 6361  "".    Custom ca
-0000fba0: 6c6c 6261 636b 2074 6861 7420 616c 6c6f  llback that allo
-0000fbb0: 7773 2066 6f72 2074 776f 2064 6966 6665  ws for two diffe
-0000fbc0: 7265 6e74 206d 6f6e 6974 6f72 732e 0a20  rent monitors.. 
-0000fbd0: 2020 2054 6869 7320 636c 6173 7320 6973     This class is
-0000fbe0: 2075 7365 6420 6279 2074 6865 2060 6f62   used by the `ob
-0000fbf0: 6a65 6374 6976 655f 636e 6e60 2072 6f75  jective_cnn` rou
-0000fc00: 7469 6e65 2061 7320 6974 2069 6e68 6572  tine as it inher
-0000fc10: 6974 7320 7468 6520 606d 6f6e 6974 6f72  its the `monitor
-0000fc20: 3160 200a 2020 2020 616e 6420 606d 6f6e  1` .    and `mon
-0000fc30: 6974 6f72 3260 2061 7474 7269 6275 7465  itor2` attribute
-0000fc40: 732c 2061 7320 7765 6c6c 2061 7320 7468  s, as well as th
-0000fc50: 6569 7220 636f 7272 6573 706f 6e64 696e  eir correspondin
-0000fc60: 6720 7468 7265 7368 6f6c 6473 2e20 5468  g thresholds. Th
-0000fc70: 6973 2065 6172 6c79 2073 746f 7070 696e  is early stoppin
-0000fc80: 670a 2020 2020 6375 7374 6f6d 2063 616c  g.    custom cal
-0000fc90: 6c62 6163 6b20 7769 6c6c 2074 6572 6d69  lback will termi
-0000fca0: 6e61 7465 2074 6865 2074 7261 696e 696e  nate the trainin
-0000fcb0: 6720 6561 726c 7920 6966 2065 6974 6865  g early if eithe
-0000fcc0: 7220 6d6f 6e69 746f 7273 2063 726f 7373  r monitors cross
-0000fcd0: 2074 6865 6972 2072 6573 7065 6374 6976   their respectiv
-0000fce0: 650a 2020 2020 7468 7265 7368 6f6c 642c  e.    threshold,
-0000fcf0: 2074 6865 7265 666f 7265 2074 6865 2070   therefore the p
-0000fd00: 6174 6965 6e63 6520 696e 7075 7420 6973  atience input is
-0000fd10: 206e 6f74 2075 7365 642e 2057 6865 7468   not used. Wheth
-0000fd20: 6572 2074 6865 2074 6872 6573 686f 6c64  er the threshold
-0000fd30: 2073 686f 756c 6420 6265 2061 2063 6569   should be a cei
-0000fd40: 6c69 6e67 0a20 2020 206f 7220 666c 6f6f  ling.    or floo
-0000fd50: 7220 7661 6c75 6520 7769 6c6c 2062 6520  r value will be 
-0000fd60: 6465 7465 726d 696e 6564 2061 6363 6f72  determined accor
-0000fd70: 6469 6e67 2074 6f20 7468 6520 6d65 7472  ding to the metr
-0000fd80: 6963 2c20 6279 2063 6865 636b 696e 6720  ic, by checking 
-0000fd90: 7768 6574 6865 7220 7468 6520 6d6f 6e69  whether the moni
-0000fda0: 746f 7220 6e61 6d65 0a20 2020 2063 6f6e  tor name.    con
-0000fdb0: 7461 696e 7320 7468 6520 776f 7264 2027  tains the word '
-0000fdc0: 6c6f 7373 272e 0a0a 2020 2020 4172 6773  loss'...    Args
-0000fdd0: 3a0a 2020 2020 2020 2020 6d6f 6e69 746f  :.        monito
-0000fde0: 7231 2028 7374 7229 3a20 4e61 6d65 206f  r1 (str): Name o
-0000fdf0: 6620 7468 6520 6d65 7472 6963 2074 6f20  f the metric to 
-0000fe00: 6d6f 6e69 746f 722e 2049 6620 604e 6f6e  monitor. If `Non
-0000fe10: 6560 2c20 7468 6973 206d 6f6e 6974 6f72  e`, this monitor
-0000fe20: 2077 696c 6c20 6e6f 7420 6265 2075 7365   will not be use
-0000fe30: 642e 0a20 2020 2020 2020 206d 6f6e 6974  d..        monit
-0000fe40: 6f72 3220 2873 7472 293a 204e 616d 6520  or2 (str): Name 
-0000fe50: 6f66 2074 6865 206d 6574 7269 6320 746f  of the metric to
-0000fe60: 206d 6f6e 6974 6f72 2e20 4966 2060 4e6f   monitor. If `No
-0000fe70: 6e65 602c 2074 6869 7320 6d6f 6e69 746f  ne`, this monito
-0000fe80: 7220 7769 6c6c 206e 6f74 2062 6520 7573  r will not be us
-0000fe90: 6564 2e0a 2020 2020 2020 2020 6d6f 6e69  ed..        moni
-0000fea0: 746f 7231 5f74 6872 6573 6820 2866 6c6f  tor1_thresh (flo
-0000feb0: 6174 293a 2054 6872 6573 686f 6c64 2076  at): Threshold v
-0000fec0: 616c 7565 2066 6f72 2060 6d6f 6e69 746f  alue for `monito
-0000fed0: 7231 602e 0a20 2020 2020 2020 206d 6f6e  r1`..        mon
-0000fee0: 6974 6f72 325f 7468 7265 7368 2028 666c  itor2_thresh (fl
-0000fef0: 6f61 7429 3a20 5468 7265 7368 6f6c 6420  oat): Threshold 
-0000ff00: 7661 6c75 6520 666f 7220 606d 6f6e 6974  value for `monit
-0000ff10: 6f72 3260 2e0a 0a20 2020 2041 7474 7269  or2`...    Attri
-0000ff20: 6275 7465 733a 0a20 2020 2020 2020 2073  butes:.        s
-0000ff30: 746f 7070 6564 5f65 706f 6368 2028 696e  topped_epoch (in
-0000ff40: 7429 3a20 5468 6520 6570 6f63 6820 6174  t): The epoch at
-0000ff50: 2077 6869 6368 2074 6865 2074 7261 696e   which the train
-0000ff60: 696e 6720 7761 7320 7374 6f70 7065 642e  ing was stopped.
-0000ff70: 0a20 2020 2020 2020 2062 6573 745f 6d65  .        best_me
-0000ff80: 7472 6963 2028 666c 6f61 7429 3a20 5468  tric (float): Th
-0000ff90: 6520 6265 7374 206d 6574 7269 6320 7661  e best metric va
-0000ffa0: 6c75 6520 6163 6869 6576 6564 2064 7572  lue achieved dur
-0000ffb0: 696e 6720 7468 6520 7472 6169 6e69 6e67  ing the training
-0000ffc0: 2e0a 2020 2020 2020 2020 6265 7374 5f77  ..        best_w
-0000ffd0: 6569 6768 7473 2028 6e64 6172 7261 7929  eights (ndarray)
-0000ffe0: 3a20 5468 6520 7765 6967 6874 7320 6f66  : The weights of
-0000fff0: 2074 6865 206d 6f64 656c 2061 7420 7468   the model at th
-00010000: 6520 6570 6f63 6820 7769 7468 2074 6865  e epoch with the
-00010010: 2062 6573 7420 6d65 7472 6963 2076 616c   best metric val
-00010020: 7565 2e0a 0a20 2020 2052 6574 7572 6e73  ue...    Returns
-00010030: 3a0a 2020 2020 2020 2020 4e6f 6e65 0a20  :.        None. 
-00010040: 2020 2022 2222 0a20 2020 200a 2020 2020     """.    .    
-00010050: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00010060: 662c 206d 6f6e 6974 6f72 313d 4e6f 6e65  f, monitor1=None
-00010070: 2c20 6d6f 6e69 746f 7232 3d4e 6f6e 652c  , monitor2=None,
-00010080: 206d 6f6e 6974 6f72 315f 7468 7265 7368   monitor1_thresh
-00010090: 3d4e 6f6e 652c 206d 6f6e 6974 6f72 325f  =None, monitor2_
-000100a0: 7468 7265 7368 3d4e 6f6e 6529 3a0a 2020  thresh=None):.  
-000100b0: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-000100c0: 696e 6974 5f5f 2829 2023 2349 6e69 7469  init__() ##Initi
-000100d0: 616c 697a 6573 2074 6865 2069 6e68 6572  alizes the inher
-000100e0: 6974 6564 2061 7474 7269 6275 7465 7320  ited attributes 
-000100f0: 616e 6420 6d65 7468 6f64 7320 6672 6f6d  and methods from
-00010100: 2074 6865 2070 6172 656e 7420 636c 6173   the parent clas
-00010110: 7320 6173 2069 7420 7769 6c6c 2069 6e68  s as it will inh
-00010120: 6572 6974 2066 726f 6d20 4361 6c6c 6261  erit from Callba
-00010130: 636b 0a20 2020 2020 2020 2073 656c 662e  ck.        self.
-00010140: 6d6f 6e69 746f 7231 203d 206d 6f6e 6974  monitor1 = monit
-00010150: 6f72 310a 2020 2020 2020 2020 7365 6c66  or1.        self
-00010160: 2e6d 6f6e 6974 6f72 3220 3d20 6d6f 6e69  .monitor2 = moni
-00010170: 746f 7232 0a20 2020 2020 2020 2073 656c  tor2.        sel
-00010180: 662e 6d6f 6e69 746f 7231 5f74 6872 6573  f.monitor1_thres
-00010190: 6820 3d20 6d6f 6e69 746f 7231 5f74 6872  h = monitor1_thr
-000101a0: 6573 680a 2020 2020 2020 2020 7365 6c66  esh.        self
-000101b0: 2e6d 6f6e 6974 6f72 325f 7468 7265 7368  .monitor2_thresh
-000101c0: 203d 206d 6f6e 6974 6f72 325f 7468 7265   = monitor2_thre
-000101d0: 7368 0a20 2020 2020 2020 2073 656c 662e  sh.        self.
-000101e0: 7374 6f70 7065 645f 6570 6f63 6820 3d20  stopped_epoch = 
-000101f0: 300a 2020 2020 2020 2020 7365 6c66 2e62  0.        self.b
-00010200: 6573 745f 6d65 7472 6963 203d 2066 6c6f  est_metric = flo
-00010210: 6174 2827 696e 6627 2920 0a20 2020 2020  at('inf') .     
-00010220: 2020 2073 656c 662e 6265 7374 5f77 6569     self.best_wei
-00010230: 6768 7473 203d 204e 6f6e 6520 2357 696c  ghts = None #Wil
-00010240: 6c20 7573 6520 7468 6973 2074 6f20 7374  l use this to st
-00010250: 6f72 6520 7468 6520 7765 6967 6874 7320  ore the weights 
-00010260: 7769 7468 2074 6865 2062 6573 7420 6d65  with the best me
-00010270: 7472 6963 2076 616c 7565 0a0a 2020 2020  tric value..    
-00010280: 6465 6620 6f6e 5f65 706f 6368 5f65 6e64  def on_epoch_end
-00010290: 2873 656c 662c 2065 706f 6368 2c20 6c6f  (self, epoch, lo
-000102a0: 6773 3d7b 7d29 3a0a 2020 2020 2020 2020  gs={}):.        
-000102b0: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
-000102c0: 206d 6574 686f 6420 7769 6c6c 2062 6520   method will be 
-000102d0: 6361 6c6c 6564 2061 7420 7468 6520 656e  called at the en
-000102e0: 6420 6f66 2065 6163 6820 6570 6f63 6820  d of each epoch 
-000102f0: 6475 7269 6e67 2074 7261 696e 696e 672e  during training.
-00010300: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00010310: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
-00010320: 6820 2869 6e74 293a 2043 7572 7265 6e74  h (int): Current
-00010330: 2065 706f 6368 206e 756d 6265 722e 0a20   epoch number.. 
-00010340: 2020 2020 2020 2020 2020 206c 6f67 7320             logs 
-00010350: 2864 6963 7429 3a20 4469 6374 696f 6e61  (dict): Dictiona
-00010360: 7279 2063 6f6e 7461 696e 696e 6720 7468  ry containing th
-00010370: 6520 6d65 7472 6963 7320 666f 7220 7468  e metrics for th
-00010380: 6520 6375 7272 656e 7420 6570 6f63 682e  e current epoch.
-00010390: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000103a0: 733a 0a20 2020 2020 2020 2020 2020 204e  s:.            N
-000103b0: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
-000103c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000103d0: 2e6d 6f6e 6974 6f72 3120 6973 206e 6f74  .monitor1 is not
-000103e0: 204e 6f6e 6520 616e 6420 7365 6c66 2e6d   None and self.m
-000103f0: 6f6e 6974 6f72 3220 6973 206e 6f74 204e  onitor2 is not N
-00010400: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00010410: 2063 7572 7265 6e74 5f31 203d 206c 6f67   current_1 = log
-00010420: 732e 6765 7428 7365 6c66 2e6d 6f6e 6974  s.get(self.monit
-00010430: 6f72 3129 0a20 2020 2020 2020 2020 2020  or1).           
-00010440: 2063 7572 7265 6e74 5f32 203d 206c 6f67   current_2 = log
-00010450: 732e 6765 7428 7365 6c66 2e6d 6f6e 6974  s.get(self.monit
-00010460: 6f72 3229 0a20 2020 2020 2020 2020 2020  or2).           
-00010470: 2069 6620 276c 6f73 7327 206e 6f74 2069   if 'loss' not i
-00010480: 6e20 7365 6c66 2e6d 6f6e 6974 6f72 3120  n self.monitor1 
-00010490: 616e 6420 276c 6f73 7327 2069 6e20 7365  and 'loss' in se
-000104a0: 6c66 2e6d 6f6e 6974 6f72 323a 0a20 2020  lf.monitor2:.   
-000104b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000104c0: 6e70 2e67 7265 6174 6572 2863 7572 7265  np.greater(curre
-000104d0: 6e74 5f31 2c20 7365 6c66 2e6d 6f6e 6974  nt_1, self.monit
-000104e0: 6f72 315f 7468 7265 7368 2920 6f72 206e  or1_thresh) or n
-000104f0: 702e 6c65 7373 5f65 7175 616c 2863 7572  p.less_equal(cur
-00010500: 7265 6e74 5f32 2c20 7365 6c66 2e6d 6f6e  rent_2, self.mon
-00010510: 6974 6f72 325f 7468 7265 7368 293a 0a20  itor2_thresh):. 
-00010520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010530: 2020 2073 656c 662e 7374 6f70 7065 645f     self.stopped_
-00010540: 6570 6f63 6820 3d20 6570 6f63 680a 2020  epoch = epoch.  
-00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010560: 2020 7365 6c66 2e6d 6f64 656c 2e73 746f    self.model.sto
-00010570: 705f 7472 6169 6e69 6e67 203d 2054 7275  p_training = Tru
-00010580: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00010590: 2020 6375 7272 656e 745f 6d65 7472 6963    current_metric
-000105a0: 203d 2063 7572 7265 6e74 5f31 0a20 2020   = current_1.   
-000105b0: 2020 2020 2020 2020 2065 6c69 6620 276c           elif 'l
-000105c0: 6f73 7327 206e 6f74 2069 6e20 7365 6c66  oss' not in self
-000105d0: 2e6d 6f6e 6974 6f72 3120 616e 6420 276c  .monitor1 and 'l
-000105e0: 6f73 7327 206e 6f74 2069 6e20 7365 6c66  oss' not in self
-000105f0: 2e6d 6f6e 6974 6f72 323a 0a20 2020 2020  .monitor2:.     
-00010600: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
-00010610: 2e67 7265 6174 6572 2863 7572 7265 6e74  .greater(current
-00010620: 5f31 2c20 7365 6c66 2e6d 6f6e 6974 6f72  _1, self.monitor
-00010630: 315f 7468 7265 7368 2920 6f72 206e 702e  1_thresh) or np.
-00010640: 6772 6561 7465 7228 6375 7272 656e 745f  greater(current_
-00010650: 322c 2073 656c 662e 6d6f 6e69 746f 7232  2, self.monitor2
-00010660: 5f74 6872 6573 6829 3a0a 2020 2020 2020  _thresh):.      
-00010670: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010680: 6c66 2e73 746f 7070 6564 5f65 706f 6368  lf.stopped_epoch
-00010690: 203d 2065 706f 6368 0a20 2020 2020 2020   = epoch.       
-000106a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000106b0: 662e 6d6f 6465 6c2e 7374 6f70 5f74 7261  f.model.stop_tra
-000106c0: 696e 696e 6720 3d20 5472 7565 0a20 2020  ining = True.   
-000106d0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-000106e0: 7265 6e74 5f6d 6574 7269 6320 3d20 6375  rent_metric = cu
-000106f0: 7272 656e 745f 310a 2020 2020 2020 2020  rrent_1.        
-00010700: 2020 2020 656c 6966 2027 6c6f 7373 2720      elif 'loss' 
-00010710: 696e 2073 656c 662e 6d6f 6e69 746f 7231  in self.monitor1
-00010720: 2061 6e64 2027 6c6f 7373 2720 696e 2073   and 'loss' in s
-00010730: 656c 662e 6d6f 6e69 746f 7232 3a0a 2020  elf.monitor2:.  
-00010740: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010750: 206e 702e 6c65 7373 5f65 7175 616c 2863   np.less_equal(c
-00010760: 7572 7265 6e74 5f31 2c20 7365 6c66 2e6d  urrent_1, self.m
-00010770: 6f6e 6974 6f72 315f 7468 7265 7368 2920  onitor1_thresh) 
-00010780: 6f72 206e 702e 6c65 7373 5f65 7175 616c  or np.less_equal
-00010790: 2863 7572 7265 6e74 5f32 2c20 7365 6c66  (current_2, self
-000107a0: 2e6d 6f6e 6974 6f72 325f 7468 7265 7368  .monitor2_thresh
-000107b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000107c0: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
-000107d0: 7065 645f 6570 6f63 6820 3d20 6570 6f63  ped_epoch = epoc
-000107e0: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
-000107f0: 2020 2020 2020 7365 6c66 2e6d 6f64 656c        self.model
-00010800: 2e73 746f 705f 7472 6169 6e69 6e67 203d  .stop_training =
-00010810: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00010820: 2020 2020 2020 6375 7272 656e 745f 6d65        current_me
-00010830: 7472 6963 203d 2063 7572 7265 6e74 5f31  tric = current_1
-00010840: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00010850: 6620 276c 6f73 7327 2069 6e20 7365 6c66  f 'loss' in self
-00010860: 2e6d 6f6e 6974 6f72 3120 616e 6420 276c  .monitor1 and 'l
-00010870: 6f73 7327 206e 6f74 2069 6e20 7365 6c66  oss' not in self
-00010880: 2e6d 6f6e 6974 6f72 323a 0a20 2020 2020  .monitor2:.     
-00010890: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
-000108a0: 2e6c 6573 735f 6571 7561 6c28 6375 7272  .less_equal(curr
-000108b0: 656e 745f 312c 2073 656c 662e 6d6f 6e69  ent_1, self.moni
-000108c0: 746f 7231 5f74 6872 6573 6829 206f 7220  tor1_thresh) or 
-000108d0: 6e70 2e67 7265 6174 6572 2863 7572 7265  np.greater(curre
-000108e0: 6e74 5f32 2c20 7365 6c66 2e6d 6f6e 6974  nt_2, self.monit
-000108f0: 6f72 325f 7468 7265 7368 293a 0a20 2020  or2_thresh):.   
-00010900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010910: 2073 656c 662e 7374 6f70 7065 645f 6570   self.stopped_ep
-00010920: 6f63 6820 3d20 6570 6f63 680a 2020 2020  och = epoch.    
-00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010940: 7365 6c66 2e6d 6f64 656c 2e73 746f 705f  self.model.stop_
-00010950: 7472 6169 6e69 6e67 203d 2054 7275 650a  training = True.
-00010960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010970: 6375 7272 656e 745f 6d65 7472 6963 203d  current_metric =
-00010980: 2063 7572 7265 6e74 5f31 0a20 2020 2020   current_1.     
-00010990: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000109a0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000109b0: 7365 2056 616c 7565 4572 726f 7228 2749  se ValueError('I
-000109c0: 6e76 616c 6964 206d 6f6e 6974 6f72 2069  nvalid monitor i
-000109d0: 6e70 7574 2e27 290a 2020 2020 2020 2020  nput.').        
-000109e0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-000109f0: 2069 6620 6375 7272 656e 745f 6d65 7472   if current_metr
-00010a00: 6963 203c 2073 656c 662e 6265 7374 5f6d  ic < self.best_m
-00010a10: 6574 7269 633a 0a20 2020 2020 2020 2020  etric:.         
-00010a20: 2020 2020 2020 2073 656c 662e 6265 7374         self.best
-00010a30: 5f6d 6574 7269 6320 3d20 6375 7272 656e  _metric = curren
-00010a40: 745f 6d65 7472 6963 0a20 2020 2020 2020  t_metric.       
-00010a50: 2020 2020 2020 2020 2073 656c 662e 6265           self.be
-00010a60: 7374 5f77 6569 6768 7473 203d 2073 656c  st_weights = sel
-00010a70: 662e 6d6f 6465 6c2e 6765 745f 7765 6967  f.model.get_weig
-00010a80: 6874 7328 290a 2020 2020 2020 2020 2020  hts().          
-00010a90: 2020 2020 2020 0a20 2020 2020 2020 2065        .        e
-00010aa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00010ab0: 2063 7572 7265 6e74 5f6d 6574 7269 6320   current_metric 
-00010ac0: 3d20 6c6f 6773 2e67 6574 2873 656c 662e  = logs.get(self.
-00010ad0: 6d6f 6e69 746f 7231 290a 2020 2020 2020  monitor1).      
-00010ae0: 2020 2020 2020 6966 2027 6c6f 7373 2720        if 'loss' 
-00010af0: 6e6f 7420 696e 2073 656c 662e 6d6f 6e69  not in self.moni
-00010b00: 746f 7231 3a0a 2020 2020 2020 2020 2020  tor1:.          
-00010b10: 2020 2020 2020 6966 206e 702e 6772 6561        if np.grea
-00010b20: 7465 7228 6375 7272 656e 745f 6d65 7472  ter(current_metr
-00010b30: 6963 2c20 7365 6c66 2e6d 6f6e 6974 6f72  ic, self.monitor
-00010b40: 315f 7468 7265 7368 293a 0a20 2020 2020  1_thresh):.     
-00010b50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00010b60: 656c 662e 7374 6f70 7065 645f 6570 6f63  elf.stopped_epoc
-00010b70: 6820 3d20 6570 6f63 680a 2020 2020 2020  h = epoch.      
-00010b80: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010b90: 6c66 2e6d 6f64 656c 2e73 746f 705f 7472  lf.model.stop_tr
-00010ba0: 6169 6e69 6e67 203d 2054 7275 650a 2020  aining = True.  
-00010bb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010bc0: 2063 7572 7265 6e74 5f6d 6574 7269 6320   current_metric 
-00010bd0: 3c20 7365 6c66 2e62 6573 745f 6d65 7472  < self.best_metr
-00010be0: 6963 3a0a 2020 2020 2020 2020 2020 2020  ic:.            
-00010bf0: 2020 2020 2020 2020 7365 6c66 2e62 6573          self.bes
-00010c00: 745f 6d65 7472 6963 203d 2063 7572 7265  t_metric = curre
-00010c10: 6e74 5f6d 6574 7269 630a 2020 2020 2020  nt_metric.      
-00010c20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010c30: 6c66 2e62 6573 745f 7765 6967 6874 7320  lf.best_weights 
-00010c40: 3d20 7365 6c66 2e6d 6f64 656c 2e67 6574  = self.model.get
-00010c50: 5f77 6569 6768 7473 2829 0a20 2020 2020  _weights().     
-00010c60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00010c70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010c80: 6e70 2e6c 6573 735f 6571 7561 6c28 6375  np.less_equal(cu
-00010c90: 7272 656e 745f 6d65 7472 6963 2c20 7365  rrent_metric, se
-00010ca0: 6c66 2e6d 6f6e 6974 6f72 315f 7468 7265  lf.monitor1_thre
-00010cb0: 7368 293a 0a20 2020 2020 2020 2020 2020  sh):.           
-00010cc0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00010cd0: 6f70 7065 645f 6570 6f63 6820 3d20 6570  opped_epoch = ep
-00010ce0: 6f63 680a 2020 2020 2020 2020 2020 2020  och.            
-00010cf0: 2020 2020 2020 2020 7365 6c66 2e6d 6f64          self.mod
-00010d00: 656c 2e73 746f 705f 7472 6169 6e69 6e67  el.stop_training
-00010d10: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00010d20: 2020 2020 2020 2020 6966 2063 7572 7265          if curre
-00010d30: 6e74 5f6d 6574 7269 6320 3c20 7365 6c66  nt_metric < self
-00010d40: 2e62 6573 745f 6d65 7472 6963 3a0a 2020  .best_metric:.  
-00010d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d60: 2020 7365 6c66 2e62 6573 745f 6d65 7472    self.best_metr
-00010d70: 6963 203d 2063 7572 7265 6e74 5f6d 6574  ic = current_met
-00010d80: 7269 630a 2020 2020 2020 2020 2020 2020  ric.            
-00010d90: 2020 2020 2020 2020 7365 6c66 2e62 6573          self.bes
-00010da0: 745f 7765 6967 6874 7320 3d20 7365 6c66  t_weights = self
-00010db0: 2e6d 6f64 656c 2e67 6574 5f77 6569 6768  .model.get_weigh
-00010dc0: 7473 2829 0a0a 0a64 6566 2068 7970 6572  ts()...def hyper
-00010dd0: 5f6f 7074 2864 6174 615f 782c 2064 6174  _opt(data_x, dat
-00010de0: 615f 792c 2063 6c66 3d27 7266 272c 206e  a_y, clf='rf', n
-00010df0: 5f69 7465 723d 3235 2c20 7265 7475 726e  _iter=25, return
-00010e00: 5f73 7475 6479 3d54 7275 652c 2062 616c  _study=True, bal
-00010e10: 616e 6365 3d54 7275 652c 2069 6d67 5f6e  ance=True, img_n
-00010e20: 756d 5f63 6861 6e6e 656c 733d 312c 200a  um_channels=1, .
-00010e30: 2020 2020 6e6f 726d 616c 697a 653d 5472      normalize=Tr
-00010e40: 7565 2c20 6d69 6e5f 7069 7865 6c3d 302c  ue, min_pixel=0,
-00010e50: 206d 6178 5f70 6978 656c 3d31 3030 2c20   max_pixel=100, 
-00010e60: 7661 6c5f 583d 4e6f 6e65 2c20 7661 6c5f  val_X=None, val_
-00010e70: 593d 4e6f 6e65 2c20 7472 6169 6e5f 6570  Y=None, train_ep
-00010e80: 6f63 6873 3d32 352c 2070 6174 6965 6e63  ochs=25, patienc
-00010e90: 653d 302c 206d 6574 7269 633d 276c 6f73  e=0, metric='los
-00010ea0: 7327 2c20 0a20 2020 206c 696d 6974 5f73  s', .    limit_s
-00010eb0: 6561 7263 683d 5472 7565 2c20 6f70 745f  earch=True, opt_
-00010ec0: 6d6f 6465 6c3d 5472 7565 2c20 6f70 745f  model=True, opt_
-00010ed0: 6175 673d 4661 6c73 652c 2062 6174 6368  aug=False, batch
-00010ee0: 5f6d 696e 3d32 2c20 6261 7463 685f 6d61  _min=2, batch_ma
-00010ef0: 783d 3235 2c20 696d 6167 655f 7369 7a65  x=25, image_size
-00010f00: 5f6d 696e 3d35 302c 2069 6d61 6765 5f73  _min=50, image_s
-00010f10: 697a 655f 6d61 783d 3130 302c 0a20 2020  ize_max=100,.   
-00010f20: 206f 7074 5f6d 6178 5f6d 696e 5f70 6978   opt_max_min_pix
-00010f30: 3d4e 6f6e 652c 206f 7074 5f6d 6178 5f6d  =None, opt_max_m
-00010f40: 6178 5f70 6978 3d4e 6f6e 652c 206f 7074  ax_pix=None, opt
-00010f50: 5f63 763d 3130 2c20 7465 7374 5f73 697a  _cv=10, test_siz
-00010f60: 653d 4e6f 6e65 2c20 6176 6572 6167 653d  e=None, average=
-00010f70: 5472 7565 2c20 7465 7374 5f70 6f73 6974  True, test_posit
-00010f80: 6976 653d 4e6f 6e65 2c20 7465 7374 5f6e  ive=None, test_n
-00010f90: 6567 6174 6976 653d 4e6f 6e65 2c20 7368  egative=None, sh
-00010fa0: 6966 743d 3130 2c20 0a20 2020 206d 6173  ift=10, .    mas
-00010fb0: 6b5f 7369 7a65 3d4e 6f6e 652c 206e 756d  k_size=None, num
-00010fc0: 5f6d 6173 6b73 3d4e 6f6e 652c 2076 6572  _masks=None, ver
-00010fd0: 626f 7365 3d31 2c20 7472 6169 6e5f 6163  bose=1, train_ac
-00010fe0: 635f 7468 7265 7368 6f6c 643d 4e6f 6e65  c_threshold=None
-00010ff0: 2c20 6d6f 6e69 746f 7231 3d4e 6f6e 652c  , monitor1=None,
-00011000: 206d 6f6e 6974 6f72 323d 4e6f 6e65 2c20   monitor2=None, 
-00011010: 6d6f 6e69 746f 7231 5f74 6872 6573 683d  monitor1_thresh=
-00011020: 4e6f 6e65 2c20 6d6f 6e69 746f 7232 5f74  None, monitor2_t
-00011030: 6872 6573 683d 4e6f 6e65 2c0a 2020 2020  hresh=None,.    
-00011040: 736d 6f74 655f 7361 6d70 6c69 6e67 3d30  smote_sampling=0
-00011050: 293a 0a20 2020 2022 2222 0a20 2020 204f  ):.    """.    O
-00011060: 7074 696d 697a 6573 2068 7970 6572 7061  ptimizes hyperpa
-00011070: 7261 6d65 7465 7273 2075 7369 6e67 2061  rameters using a
-00011080: 206b 2d66 6f6c 6420 6372 6f73 7320 7661   k-fold cross va
-00011090: 6c69 6461 7469 6f6e 2073 706c 6974 7469  lidation splitti
-000110a0: 6e67 2073 7472 6174 6567 792e 0a0a 2020  ng strategy...  
-000110b0: 2020 2a2a 494d 504f 5254 414e 542a 2a20    **IMPORTANT** 
-000110c0: 496e 2074 6865 2063 6173 6520 6f66 2043  In the case of C
-000110d0: 4e4e 206f 7074 696d 697a 6174 696f 6e2c  NN optimization,
-000110e0: 2064 6174 615f 7820 616e 6420 6461 7461   data_x and data
-000110f0: 5f79 2061 7265 206e 6f74 2074 6865 2073  _y are not the s
-00011100: 7461 6e64 6172 640a 2020 2020 6461 7461  tandard.    data
-00011110: 2070 6c75 7320 6c61 6265 6c73 202d 2d20   plus labels -- 
-00011120: 6966 206f 7074 696d 697a 696e 6720 6120  if optimizing a 
-00011130: 434e 4e20 7468 6520 7361 6d70 6c65 7320  CNN the samples 
-00011140: 666f 7220 7468 6520 6669 7273 7420 636c  for the first cl
-00011150: 6173 7320 7368 6f75 6c64 2062 6520 7061  ass should be pa
-00011160: 7373 6564 0a20 2020 2074 6872 6f75 6768  ssed.    through
-00011170: 2074 6865 2064 6174 615f 7820 7061 7261   the data_x para
-00011180: 6d65 7465 722c 2061 6e64 2074 6865 2073  meter, and the s
-00011190: 616d 706c 6573 2066 6f72 2074 6865 2073  amples for the s
-000111a0: 6563 6f6e 6420 636c 6173 7320 7368 6f75  econd class shou
-000111b0: 6c64 2062 6520 6769 7665 6e20 6173 2064  ld be given as d
-000111c0: 6174 615f 792e 0a20 2020 2054 6865 7365  ata_y..    These
-000111d0: 2074 776f 2063 6c61 7373 6573 2077 696c   two classes wil
-000111e0: 6c20 6175 746f 6d61 7469 6361 6c6c 7920  l automatically 
-000111f0: 6265 2061 7373 6967 6e65 6420 7468 6520  be assigned the 
-00011200: 706f 7369 7469 7665 2061 6e64 206e 6567  positive and neg
-00011210: 6174 6976 6520 6c61 6265 6c73 2031 2061  ative labels 1 a
-00011220: 6e64 2030 2c20 7265 7370 6563 7469 7665  nd 0, respective
-00011230: 6c79 2e0a 2020 2020 4c69 6b65 7769 7365  ly..    Likewise
-00011240: 2c20 6966 206f 7074 696d 697a 696e 6720  , if optimizing 
-00011250: 6120 434e 4e20 6d6f 6465 6c2c 2076 616c  a CNN model, val
-00011260: 5f58 2063 6f72 7265 7370 6f6e 6473 2074  _X corresponds t
-00011270: 6f20 7468 6520 696d 6167 6573 206f 6620  o the images of 
-00011280: 7468 6520 6669 7273 7420 636c 6173 732c  the first class,
-00011290: 2061 6e64 2076 616c 5f59 2074 6865 2069   and val_Y the i
-000112a0: 6d61 6765 7320 6f66 2074 6865 2073 6563  mages of the sec
-000112b0: 6f6e 6420 636c 6173 732e 200a 2020 2020  ond class. .    
-000112c0: 0a20 2020 2049 6620 7361 7665 5f73 7475  .    If save_stu
-000112d0: 6479 3d54 7275 652c 2074 6865 204f 7074  dy=True, the Opt
-000112e0: 756e 6120 7374 7564 7920 6f62 6a65 6374  una study object
-000112f0: 2077 696c 6c20 6265 2074 6865 2074 6869   will be the thi
-00011300: 7264 206f 7574 7075 742e 2054 6869 730a  rd output. This.
-00011310: 2020 2020 6f62 6a65 6374 2063 616e 2062      object can b
-00011320: 6520 7573 6564 2066 6f72 2076 6172 696f  e used for vario
-00011330: 7573 2061 6e61 6c79 7369 732c 2069 6e63  us analysis, inc
-00011340: 6c75 6469 6e67 206f 7074 696d 697a 6174  luding optimizat
-00011350: 696f 6e20 7669 7375 616c 697a 6174 696f  ion visualizatio
-00011360: 6e73 2e0a 2020 2020 5365 653a 2068 7474  ns..    See: htt
-00011370: 7073 3a2f 2f6f 7074 756e 612e 7265 6164  ps://optuna.read
-00011380: 7468 6564 6f63 732e 696f 2f65 6e2f 7374  thedocs.io/en/st
-00011390: 6162 6c65 2f72 6566 6572 656e 6365 2f67  able/reference/g
-000113a0: 656e 6572 6174 6564 2f6f 7074 756e 612e  enerated/optuna.
-000113b0: 7374 7564 792e 5374 7564 792e 6874 6d6c  study.Study.html
-000113c0: 0a0a 2020 2020 4578 616d 706c 653a 0a20  ..    Example:. 
-000113d0: 2020 2020 2020 2054 6865 2066 756e 6374         The funct
-000113e0: 696f 6e20 7769 6c6c 2063 7265 6174 6520  ion will create 
-000113f0: 7468 6520 636c 6173 7369 6669 6361 7469  the classificati
-00011400: 6f6e 2065 6e67 696e 6520 616e 6420 6f70  on engine and op
-00011410: 7469 6d69 7a65 2074 6865 2068 7970 6572  timize the hyper
-00011420: 7061 7261 6d65 7465 7273 0a20 2020 2020  parameters.     
-00011430: 2020 2075 7369 6e67 2061 6e20 6974 6572     using an iter
-00011440: 6174 6976 6520 6170 7072 6f61 6368 3a0a  ative approach:.
-00011450: 0a20 2020 2020 2020 203e 3e3e 206d 6f64  .        >>> mod
-00011460: 656c 2c20 7061 7261 6d73 203d 2068 7970  el, params = hyp
-00011470: 6572 5f6f 7074 2864 6174 615f 782c 2064  er_opt(data_x, d
-00011480: 6174 615f 792c 2063 6c66 3d27 7266 2729  ata_y, clf='rf')
-00011490: 200a 2020 2020 2020 2020 0a20 2020 2020   .        .     
-000114a0: 2020 2054 6865 2066 6972 7374 206f 7574     The first out
-000114b0: 7075 7420 6973 206f 7572 206f 7074 696d  put is our optim
-000114c0: 616c 2063 6c61 7373 6966 6965 722c 2061  al classifier, a
-000114d0: 6e64 2077 696c 6c20 6265 2075 7365 6420  nd will be used 
-000114e0: 746f 206d 616b 6520 7072 6564 6963 7469  to make predicti
-000114f0: 6f6e 733a 0a20 2020 2020 2020 200a 2020  ons:.        .  
-00011500: 2020 2020 2020 3e3e 3e20 7072 6564 6963        >>> predic
-00011510: 7469 6f6e 203d 206d 6f64 656c 2e70 7265  tion = model.pre
-00011520: 6469 6374 286e 6577 5f64 6174 6129 0a20  dict(new_data). 
-00011530: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00011540: 5468 6520 7365 636f 6e64 206f 7574 7075  The second outpu
-00011550: 7420 6f66 2074 6865 206f 7074 696d 697a  t of the optimiz
-00011560: 6520 6675 6e63 7469 6f6e 2069 7320 7468  e function is th
-00011570: 6520 6469 6374 696f 6e61 7279 2063 6f6e  e dictionary con
-00011580: 7461 696e 696e 670a 2020 2020 2020 2020  taining.        
-00011590: 7468 6520 6879 7065 7270 6172 616d 6574  the hyperparamet
-000115a0: 6572 2063 6f6d 6269 6e61 7469 6f6e 2074  er combination t
-000115b0: 6861 7420 7969 656c 6465 6420 7468 6520  hat yielded the 
-000115c0: 6869 6768 6573 7420 6d65 616e 2061 6363  highest mean acc
-000115d0: 7572 6163 792e 0a0a 2020 2020 2020 2020  uracy...        
-000115e0: 4966 2073 6176 655f 7374 7564 7920 3d20  If save_study = 
-000115f0: 5472 7565 2c20 7468 6520 4f70 7475 6e61  True, the Optuna
-00011600: 2073 7475 6479 206f 626a 6563 7420 7769   study object wi
-00011610: 6c6c 2061 6c73 6f20 6265 2072 6574 7572  ll also be retur
-00011620: 6e65 6420 6173 2074 6865 2074 6869 7264  ned as the third
-00011630: 206f 7574 7075 742e 0a20 2020 2020 2020   output..       
-00011640: 2054 6869 7320 6361 6e20 6265 2075 7365   This can be use
-00011650: 6420 746f 2070 6c6f 7420 7468 6520 6f70  d to plot the op
-00011660: 7469 6d69 7a61 7469 6f6e 2072 6573 756c  timization resul
-00011670: 7473 2c20 7365 653a 2068 7474 7073 3a2f  ts, see: https:/
-00011680: 2f6f 7074 756e 612e 7265 6164 7468 6564  /optuna.readthed
-00011690: 6f63 732e 696f 2f65 6e2f 6c61 7465 7374  ocs.io/en/latest
-000116a0: 2f74 7574 6f72 6961 6c2f 3130 5f6b 6579  /tutorial/10_key
-000116b0: 5f66 6561 7475 7265 732f 3030 355f 7669  _features/005_vi
-000116c0: 7375 616c 697a 6174 696f 6e2e 6874 6d6c  sualization.html
-000116d0: 2373 7068 782d 676c 722d 7475 746f 7269  #sphx-glr-tutori
-000116e0: 616c 2d31 302d 6b65 792d 6665 6174 7572  al-10-key-featur
-000116f0: 6573 2d30 3035 2d76 6973 7561 6c69 7a61  es-005-visualiza
-00011700: 7469 6f6e 2d70 790a 0a20 2020 2020 2020  tion-py..       
-00011710: 203e 3e3e 2066 726f 6d20 6f70 7475 6e61   >>> from optuna
-00011720: 2e76 6973 7561 6c69 7a61 7469 6f6e 2e6d  .visualization.m
-00011730: 6174 706c 6f74 6c69 6220 696d 706f 7274  atplotlib import
-00011740: 2070 6c6f 745f 636f 6e74 6f75 720a 2020   plot_contour.  
-00011750: 2020 2020 2020 3e3e 3e20 0a20 2020 2020        >>> .     
-00011760: 2020 203e 3e3e 206d 6f64 656c 2c20 7061     >>> model, pa
-00011770: 7261 6d73 2c20 7374 7564 7920 3d20 6879  rams, study = hy
-00011780: 7065 725f 6f70 7428 6461 7461 5f78 2c20  per_opt(data_x, 
-00011790: 6461 7461 5f79 2c20 636c 663d 2772 6627  data_y, clf='rf'
-000117a0: 2c20 7361 7665 5f73 7475 6479 3d54 7275  , save_study=Tru
-000117b0: 6529 200a 2020 2020 2020 2020 3e3e 3e20  e) .        >>> 
-000117c0: 706c 6f74 5f63 6f6e 746f 7572 2873 7475  plot_contour(stu
-000117d0: 6479 290a 0a20 2020 2020 2020 2049 6620  dy)..        If 
-000117e0: 636c 663d 2763 6e6e 272c 2074 6865 206d  clf='cnn', the m
-000117f0: 6f64 656c 2069 7320 6e6f 7420 7265 7475  odel is not retu
-00011800: 726e 6564 2e0a 2020 2020 2020 2020 0a20  rned..        . 
-00011810: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00011820: 2064 6174 615f 7820 286e 6461 7272 6179   data_x (ndarray
-00011830: 293a 2032 4420 6172 7261 7920 6f66 2073  ): 2D array of s
-00011840: 697a 6520 286e 2078 206d 292c 2077 6865  ize (n x m), whe
-00011850: 7265 206e 2069 7320 7468 650a 2020 2020  re n is the.    
-00011860: 2020 2020 2020 2020 6e75 6d62 6572 206f          number o
-00011870: 6620 7361 6d70 6c65 732c 2061 6e64 206d  f samples, and m
-00011880: 2074 6865 206e 756d 6265 7220 6f66 2066   the number of f
-00011890: 6561 7475 7265 732e 2049 6620 636c 663d  eatures. If clf=
-000118a0: 2763 6e6e 272c 200a 2020 2020 2020 2020  'cnn', .        
-000118b0: 2020 2020 7468 6520 7361 6d70 6c65 7320      the samples 
-000118c0: 666f 7220 7468 6520 6669 7273 7420 636c  for the first cl
-000118d0: 6173 7320 7368 6f75 6c64 2062 6520 7061  ass should be pa
-000118e0: 7373 6564 2c20 7768 6963 6820 7769 6c6c  ssed, which will
-000118f0: 2061 7574 6f6d 6174 6963 616c 6c79 200a   automatically .
-00011900: 2020 2020 2020 2020 2020 2020 6265 2061              be a
-00011910: 7373 6967 6e65 6420 7468 6520 706f 7369  ssigned the posi
-00011920: 7469 7665 206c 6162 656c 2027 3127 2e0a  tive label '1'..
-00011930: 2020 2020 2020 2020 6461 7461 5f79 2028          data_y (
-00011940: 6e64 6172 7261 792c 2073 7472 293a 2031  ndarray, str): 1
-00011950: 4420 6172 7261 7920 636f 6e74 6169 6e69  D array containi
-00011960: 6e67 2074 6865 2063 6f72 7265 7370 6f6e  ng the correspon
-00011970: 696e 6720 6c61 6265 6c73 2e20 4966 2063  ing labels. If c
-00011980: 6c66 3d27 636e 6e27 2c0a 2020 2020 2020  lf='cnn',.      
-00011990: 2020 2020 2020 7468 6520 7361 6d70 6c65        the sample
-000119a0: 7320 666f 7220 7468 6520 7365 636f 6e64  s for the second
-000119b0: 2063 6c61 7373 2073 686f 756c 6420 6265   class should be
-000119c0: 2070 6173 7365 642c 2077 6869 6368 2077   passed, which w
-000119d0: 696c 6c20 6175 746f 6d61 7469 6361 6c6c  ill automaticall
-000119e0: 790a 2020 2020 2020 2020 2020 2020 6265  y.            be
-000119f0: 2061 7373 6967 6e65 6420 7468 6520 6e65   assigned the ne
-00011a00: 6761 7469 7665 206c 6162 656c 2027 3027  gative label '0'
-00011a10: 2e0a 2020 2020 2020 2020 636c 6620 2873  ..        clf (s
-00011a20: 7472 293a 2054 6865 206d 6163 6869 6e65  tr): The machine
-00011a30: 206c 6561 726e 696e 6720 636c 6173 7369   learning classi
-00011a40: 6669 6572 2074 6f20 6f70 7469 6d69 7a65  fier to optimize
-00011a50: 2e20 4361 6e20 6569 7468 6572 2062 650a  . Can either be.
-00011a60: 2020 2020 2020 2020 2020 2020 2772 6627              'rf'
-00011a70: 2066 6f72 2052 616e 646f 6d20 466f 7265   for Random Fore
-00011a80: 7374 2c20 276e 6e27 2066 6f72 204e 6575  st, 'nn' for Neu
-00011a90: 7261 6c20 4e65 7477 6f72 6b2c 2027 7867  ral Network, 'xg
-00011aa0: 6227 2066 6f72 2065 5874 7265 6d65 2047  b' for eXtreme G
-00011ab0: 7261 6469 656e 7420 426f 6f73 7469 6e67  radient Boosting
-00011ac0: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
-00011ad0: 2027 636e 6e27 2066 6f72 2043 6f6e 766f   'cnn' for Convo
-00011ae0: 6c75 7469 6f6e 616c 204e 6575 7261 6c20  lutional Neural 
-00011af0: 4e65 7477 6f72 6b2e 2044 6566 6175 6c74  Network. Default
-00011b00: 7320 746f 2027 7266 272e 0a20 2020 2020  s to 'rf'..     
-00011b10: 2020 206e 5f69 7465 7220 2869 6e74 2c20     n_iter (int, 
-00011b20: 6f70 7469 6f6e 616c 293a 2054 6865 206d  optional): The m
-00011b30: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
-00011b40: 2069 7465 7261 7469 6f6e 7320 746f 2070   iterations to p
-00011b50: 6572 666f 726d 2064 7572 696e 6720 0a20  erform during . 
-00011b60: 2020 2020 2020 2020 2020 2074 6865 2068             the h
-00011b70: 7970 6572 7061 7261 6d65 7465 7220 7365  yperparameter se
-00011b80: 6172 6368 2e20 4465 6661 756c 7473 2074  arch. Defaults t
-00011b90: 6f20 3235 2e0a 2020 2020 2020 2020 6f70  o 25..        op
-00011ba0: 745f 6376 2028 696e 7429 3a20 4372 6f73  t_cv (int): Cros
-00011bb0: 732d 7661 6c69 6461 7469 6f6e 7320 746f  s-validations to
-00011bc0: 2070 6572 666f 726d 2077 6865 6e20 6173   perform when as
-00011bd0: 7365 7369 6e67 2074 6865 2070 6572 666f  sesing the perfo
-00011be0: 726d 616e 6365 2061 7420 6561 6368 0a20  rmance at each. 
-00011bf0: 2020 2020 2020 2020 2020 2068 7970 6572             hyper
-00011c00: 7061 7261 6d65 7465 7220 6f70 7469 6d69  parameter optimi
-00011c10: 7a61 7469 6f6e 2074 7269 616c 2e20 466f  zation trial. Fo
-00011c20: 7220 6578 616d 706c 652c 2069 6620 6376  r example, if cv
-00011c30: 3d33 2c20 7468 656e 2065 6163 6820 6f70  =3, then each op
-00011c40: 7469 6d69 7a61 7469 6f6e 2074 7269 616c  timization trial
-00011c50: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-00011c60: 6c20 6265 2061 7373 6573 7365 6420 6163  l be assessed ac
-00011c70: 636f 7264 696e 6720 746f 2074 6865 2033  cording to the 3
-00011c80: 2d66 6f6c 6420 6372 6f73 7320 7661 6c69  -fold cross vali
-00011c90: 6461 7469 6f6e 2061 6363 7572 6163 792e  dation accuracy.
-00011ca0: 2044 6566 6175 6c74 7320 746f 2031 302e   Defaults to 10.
-00011cb0: 0a20 2020 2020 2020 2020 2020 204e 4f54  .            NOT
-00011cc0: 453a 2054 6865 2068 6967 6865 7220 7468  E: The higher th
-00011cd0: 6973 206e 756d 6265 722c 2074 6865 206c  is number, the l
-00011ce0: 6f6e 6765 7220 7468 6520 6f70 7469 6d69  onger the optimi
-00011cf0: 7a61 7469 6f6e 2077 696c 6c20 7461 6b65  zation will take
-00011d00: 2e0a 2020 2020 2020 2020 7465 7374 5f73  ..        test_s
-00011d10: 697a 6520 2866 6c6f 6174 2c20 6f70 7469  ize (float, opti
-00011d20: 6f6e 616c 293a 2043 616e 2075 7365 2074  onal): Can use t
-00011d30: 6869 7320 696e 206c 6965 7520 6f66 206f  his in lieu of o
-00011d40: 7074 5f63 762c 206f 6e6c 7920 6966 2063  pt_cv, only if c
-00011d50: 6c66 3d27 7867 6227 210a 2020 2020 2020  lf='xgb'!.      
-00011d60: 2020 2020 2020 4d75 7374 2062 6520 6265        Must be be
-00011d70: 7477 6565 6e20 3020 616e 6420 3120 6173  tween 0 and 1 as
-00011d80: 2074 6869 7320 7365 7473 2074 6865 2073   this sets the s
-00011d90: 697a 6520 6f66 2074 6865 2076 616c 6964  ize of the valid
-00011da0: 6174 696f 6e20 6461 7461 2c20 7768 6963  ation data, whic
-00011db0: 6820 7769 6c6c 2062 6520 6368 6f73 656e  h will be chosen
-00011dc0: 2072 616e 646f 6d6c 7920 6561 6368 2074   randomly each t
-00011dd0: 7269 616c 2e20 0a20 2020 2020 2020 2020  rial. .         
-00011de0: 2020 2044 6566 6175 6c74 7320 746f 204e     Defaults to N
-00011df0: 6f6e 652c 2069 6e20 7768 6963 6820 6361  one, in which ca
-00011e00: 7365 2074 6865 206f 7074 5f63 7620 7061  se the opt_cv pa
-00011e10: 7261 6d65 7465 7220 7769 6c6c 2062 6520  rameter will be 
-00011e20: 7573 6564 2e20 5468 6973 2069 7320 7573  used. This is us
-00011e30: 6564 200a 2020 2020 2020 2020 2020 2020  ed .            
-00011e40: 746f 2065 6e61 626c 6520 616e 2065 6172  to enable an ear
-00011e50: 6c79 2073 746f 7070 696e 6720 6361 6c6c  ly stopping call
-00011e60: 6261 636b 2077 6869 6368 2069 7320 6e6f  back which is no
-00011e70: 7420 706f 7373 6962 6c65 2077 6974 6820  t possible with 
-00011e80: 7468 6520 6372 6f73 732d 7661 6c69 6461  the cross-valida
-00011e90: 7469 6f6e 206d 6574 686f 642e 0a20 2020  tion method..   
-00011ea0: 2020 2020 206c 696d 6974 5f73 6561 7263       limit_searc
-00011eb0: 6820 2862 6f6f 6c29 3a20 4966 2054 7275  h (bool): If Tru
-00011ec0: 6520 7468 6520 6f70 7469 6d69 7a61 7469  e the optimizati
-00011ed0: 6f6e 2073 6561 7263 6820 7370 6163 6573  on search spaces
-00011ee0: 2077 696c 6c20 6265 206c 696d 6974 6564   will be limited
-00011ef0: 2c20 666f 7220 636f 6d70 7574 6174 696f  , for computatio
-00011f00: 6e61 6c20 616e 6420 7469 6d65 2070 7572  nal and time pur
-00011f10: 706f 7365 732e 200a 2020 2020 2020 2020  poses. .        
-00011f20: 2020 2020 5468 6973 2069 7320 6573 7065      This is espe
-00011f30: 6369 616c 6c79 2069 6d70 6f72 7461 6e74  cially important
-00011f40: 2069 6620 636c 663d 2763 6e6e 2720 6173   if clf='cnn' as
-00011f50: 206d 656d 6f72 7920 6572 726f 7273 2063   memory errors c
-00011f60: 616e 2062 6520 656e 636f 756e 7465 7265  an be encountere
-00011f70: 642e 2044 6566 6175 6c74 7320 746f 2054  d. Defaults to T
-00011f80: 7275 652e 0a20 2020 2020 2020 2062 616c  rue..        bal
-00011f90: 616e 6365 2028 626f 6f6c 2c20 6f70 7469  ance (bool, opti
-00011fa0: 6f6e 616c 293a 2049 6620 5472 7565 2c20  onal): If True, 
-00011fb0: 6120 7765 6967 6874 7320 6172 7261 7920  a weights array 
-00011fc0: 7769 6c6c 2062 6520 6361 6c63 756c 6174  will be calculat
-00011fd0: 6564 2061 6e64 2075 7365 640a 2020 2020  ed and used.    
-00011fe0: 2020 2020 2020 2020 7768 656e 2066 6974          when fit
-00011ff0: 7469 6e67 2074 6865 2063 6c61 7373 6966  ting the classif
-00012000: 6965 722e 2054 6869 7320 6361 6e20 696d  ier. This can im
-00012010: 7072 6f76 6520 636c 6173 7369 6669 6361  prove classifica
-00012020: 7469 6f6e 2077 6865 6e20 636c 6173 7365  tion when classe
-00012030: 730a 2020 2020 2020 2020 2020 2020 6172  s.            ar
-00012040: 6520 696d 6261 6c61 6e63 6564 2e20 5468  e imbalanced. Th
-00012050: 6973 2069 7320 6f6e 6c79 2061 7070 6c69  is is only appli
-00012060: 6564 2069 6620 7468 6520 636c 6173 7369  ed if the classi
-00012070: 6669 6361 7469 6f6e 2069 7320 6120 6269  fication is a bi
-00012080: 6e61 7279 2074 6173 6b2e 200a 2020 2020  nary task. .    
-00012090: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-000120a0: 2074 6f20 5472 7565 2e20 4966 2063 6c66   to True. If clf
-000120b0: 3d27 636e 6e27 2c20 7468 6973 2077 696c  ='cnn', this wil
-000120c0: 6c20 6465 7465 726d 696e 6520 7768 6574  l determine whet
-000120d0: 6865 7220 7468 6520 7477 6f20 636c 6173  her the two clas
-000120e0: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
-000120f0: 6172 6520 6b65 7074 2074 6865 2073 616d  are kept the sam
-00012100: 6520 7369 7a65 2064 7572 696e 6720 6f70  e size during op
-00012110: 7469 6d69 7a61 7469 6f6e 2c20 6170 706c  timization, appl
-00012120: 6963 6162 6c65 2069 6620 7475 6e69 6e67  icable if tuning
-00012130: 2074 6865 2061 7567 6d65 6e74 6174 696f   the augmentatio
-00012140: 6e0a 2020 2020 2020 2020 2020 2020 7061  n.            pa
-00012150: 7261 6d65 7465 7273 2e20 4465 6661 756c  rameters. Defaul
-00012160: 7473 2074 6f20 5472 7565 2e0a 2020 2020  ts to True..    
-00012170: 2020 2020 7265 7475 726e 5f73 7475 6479      return_study
-00012180: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
-00012190: 293a 2049 6620 5472 7565 2074 6865 204f  ): If True the O
-000121a0: 7074 756e 6120 7374 7564 7920 6f62 6a65  ptuna study obje
-000121b0: 6374 2077 696c 6c20 6265 2072 6574 7572  ct will be retur
-000121c0: 6e65 642e 2054 6869 730a 2020 2020 2020  ned. This.      
-000121d0: 2020 2020 2020 6361 6e20 6265 2075 7365        can be use
-000121e0: 6420 746f 2072 6576 6965 7720 7468 6520  d to review the 
-000121f0: 6d65 7468 6f64 2061 7474 7269 6275 7465  method attribute
-00012200: 732c 2073 7563 6820 6173 206f 7074 696d  s, such as optim
-00012210: 697a 6174 696f 6e20 706c 6f74 732e 2044  ization plots. D
-00012220: 6566 6175 6c74 7320 746f 2054 7275 652e  efaults to True.
-00012230: 0a0a 2020 2020 5468 6520 666f 6c6c 6c6f  ..    The folllo
-00012240: 7769 6e67 2061 7267 756d 656e 7473 2061  wing arguments a
-00012250: 7265 206f 6e6c 7920 7573 6564 2077 6865  re only used whe
-00012260: 6e20 6f70 7469 6d69 7a69 6e67 2074 6865  n optimizing the
-00012270: 2043 4e4e 206e 6574 776f 726b 3a0a 0a20   CNN network:.. 
-00012280: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00012290: 2069 6d67 5f6e 756d 5f63 6861 6e6e 656c   img_num_channel
-000122a0: 7320 2869 6e74 293a 2054 6865 206e 756d  s (int): The num
-000122b0: 6265 7220 6f66 2066 696c 7465 7273 2e20  ber of filters. 
-000122c0: 4465 6661 756c 7473 2074 6f20 312e 0a20  Defaults to 1.. 
-000122d0: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
-000122e0: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
-000122f0: 293a 2049 6620 5472 7565 2074 6865 2064  ): If True the d
-00012300: 6174 6120 7769 6c6c 2062 6520 6d69 6e2d  ata will be min-
-00012310: 6d61 7820 6e6f 726d 616c 697a 6564 2075  max normalized u
-00012320: 7369 6e67 2074 6865 200a 2020 2020 2020  sing the .      
-00012330: 2020 2020 2020 696e 7075 7420 6d69 6e20        input min 
-00012340: 616e 6420 6d61 7820 7069 7865 6c73 2e20  and max pixels. 
-00012350: 4465 6661 756c 7473 2074 6f20 5472 7565  Defaults to True
-00012360: 2e0a 2020 2020 2020 2020 6d69 6e5f 7069  ..        min_pi
-00012370: 7865 6c20 2869 6e74 2c20 6f70 7469 6f6e  xel (int, option
-00012380: 616c 293a 2054 6865 206d 696e 696d 756d  al): The minimum
-00012390: 2070 6978 656c 2063 6f75 6e74 2c20 7069   pixel count, pi
-000123a0: 7865 6c73 2077 6974 6820 636f 756e 7473  xels with counts
-000123b0: 200a 2020 2020 2020 2020 2020 2020 6265   .            be
-000123c0: 6c6f 7720 7468 6973 2074 6872 6573 686f  low this thresho
-000123d0: 6c64 2077 696c 6c20 6265 2073 6574 2074  ld will be set t
-000123e0: 6f20 7468 6973 206c 696d 6974 2e20 4465  o this limit. De
-000123f0: 6661 756c 7473 2074 6f20 302e 0a20 2020  faults to 0..   
-00012400: 2020 2020 206d 6178 5f70 6978 656c 2028       max_pixel (
-00012410: 696e 742c 206c 6973 742c 206f 7074 696f  int, list, optio
-00012420: 6e61 6c29 3a20 5468 6520 6d61 7869 6d75  nal): The maximu
-00012430: 6d20 7069 7865 6c20 636f 756e 742c 2070  m pixel count, p
-00012440: 6978 656c 7320 7769 7468 2063 6f75 6e74  ixels with count
-00012450: 7320 0a20 2020 2020 2020 2020 2020 2061  s .            a
-00012460: 626f 7665 2074 6869 7320 7468 7265 7368  bove this thresh
-00012470: 6f6c 6420 7769 6c6c 2062 6520 7365 7420  old will be set 
-00012480: 746f 2074 6869 7320 6c69 6d69 742e 2044  to this limit. D
-00012490: 6566 6175 6c74 7320 746f 2031 3030 2e20  efaults to 100. 
-000124a0: 4966 2069 6d67 5f6e 756d 5f63 6861 6e6e  If img_num_chann
-000124b0: 656c 730a 2020 2020 2020 2020 2020 2020  els.            
-000124c0: 6973 206e 6f74 2031 2c20 7468 6520 6d61  is not 1, the ma
-000124d0: 785f 7069 7865 6c20 7368 6f75 6c64 2062  x_pixel should b
-000124e0: 6520 6120 6c69 7374 2063 6f6e 7461 696e  e a list contain
-000124f0: 696e 6720 7477 6f20 7661 6c75 6573 2c20  ing two values, 
-00012500: 6f6e 6520 666f 7220 6561 6368 2062 616e  one for each ban
-00012510: 642e 0a20 2020 2020 2020 2076 616c 5f70  d..        val_p
-00012520: 6f73 6974 6976 6520 286e 6461 7272 6179  ositive (ndarray
-00012530: 2c20 6f70 7469 6f6e 616c 293a 2050 6f73  , optional): Pos
-00012540: 6974 6976 6520 636c 6173 7320 6461 7461  itive class data
-00012550: 2074 6f20 6265 2075 7365 6420 666f 7220   to be used for 
-00012560: 7661 6c69 6461 7469 6f6e 2e20 4465 6661  validation. Defa
-00012570: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
-00012580: 2020 2020 2020 7661 6c5f 6e65 6761 7469        val_negati
-00012590: 7665 2028 6e64 6172 7261 792c 206f 7074  ve (ndarray, opt
-000125a0: 696f 6e61 6c29 3a20 4e65 6761 7469 7665  ional): Negative
-000125b0: 2063 6c61 7373 2064 6174 6120 746f 2062   class data to b
-000125c0: 6520 7573 6564 2066 6f72 2076 616c 6964  e used for valid
-000125d0: 6174 696f 6e2e 2044 6566 6175 6c74 7320  ation. Defaults 
-000125e0: 746f 204e 6f6e 652e 0a20 2020 2020 2020  to None..       
-000125f0: 2074 6573 745f 706f 7369 7469 7665 2028   test_positive (
-00012600: 6e64 6172 7261 792c 206f 7074 696f 6e61  ndarray, optiona
-00012610: 6c29 3a20 506f 7369 7469 7665 2063 6c61  l): Positive cla
-00012620: 7373 2064 6174 6120 746f 2062 6520 7573  ss data to be us
-00012630: 6564 2066 6f72 2070 6f73 742d 7472 6961  ed for post-tria
-00012640: 6c20 7465 7374 696e 672e 2044 6566 6175  l testing. Defau
-00012650: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
-00012660: 2020 2020 2074 6573 745f 6e65 6761 7469       test_negati
-00012670: 7665 2028 6e64 6172 7261 792c 206f 7074  ve (ndarray, opt
-00012680: 696f 6e61 6c29 3a20 4e65 6761 7469 7665  ional): Negative
-00012690: 2063 6c61 7373 2064 6174 6120 746f 2062   class data to b
-000126a0: 6520 7573 6564 2066 6f72 2070 6f73 742d  e used for post-
-000126b0: 7472 6961 6c20 7465 7374 696e 672e 2044  trial testing. D
-000126c0: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-000126d0: 0a20 2020 2020 2020 2074 7261 696e 5f65  .        train_e
-000126e0: 706f 6368 7320 2869 6e74 293a 204e 756d  pochs (int): Num
-000126f0: 6265 7220 6f66 2065 706f 6368 7320 746f  ber of epochs to
-00012700: 2074 6865 2074 7261 696e 2074 6865 2043   the train the C
-00012710: 4e4e 2074 6f20 6475 7269 6e67 2074 6865  NN to during the
-00012720: 206f 7074 696d 697a 6174 696f 6e20 7472   optimization tr
-00012730: 6961 6c73 2e20 4465 6661 756c 7473 2074  ials. Defaults t
-00012740: 6f20 3235 2e0a 2020 2020 2020 2020 6d65  o 25..        me
-00012750: 7472 6963 2028 7374 7229 3a20 4173 7365  tric (str): Asse
-00012760: 736d 656e 7420 6d65 7472 6963 2074 6f20  sment metric to 
-00012770: 7573 6520 7768 656e 2062 6f74 6820 7072  use when both pr
-00012780: 756e 696e 6720 616e 6420 7363 6f72 696e  uning and scorin
-00012790: 6720 7468 6520 6879 7065 7270 6172 616d  g the hyperparam
-000127a0: 6574 6572 206f 7074 696d 697a 6174 696f  eter optimizatio
-000127b0: 6e20 7472 6961 6c2e 0a20 2020 2020 2020  n trial..       
-000127c0: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
-000127d0: 2027 6c6f 7373 272e 204f 7074 696f 6e73   'loss'. Options
-000127e0: 2069 6e63 6c75 6465 3a20 276c 6f73 7327   include: 'loss'
-000127f0: 2027 6269 6e61 7279 5f61 6363 7572 6163   'binary_accurac
-00012800: 7927 2c20 2766 315f 7363 6f72 6527 2027  y', 'f1_score' '
-00012810: 616c 6c27 206f 7220 7468 6520 7661 6c69  all' or the vali
-00012820: 6461 7469 6f6e 2065 7175 6976 616c 656e  dation equivalen
-00012830: 7473 2028 652e 672e 2027 7661 6c5f 6c6f  ts (e.g. 'val_lo
-00012840: 7373 2729 2e0a 2020 2020 2020 2020 7061  ss')..        pa
-00012850: 7469 656e 6365 2028 696e 7429 3a20 4e75  tience (int): Nu
-00012860: 6d62 6572 206f 6620 6570 6f63 6873 2077  mber of epochs w
-00012870: 6974 686f 7574 2069 6d70 726f 7665 6d65  ithout improveme
-00012880: 6e74 2062 6566 6f72 6520 7468 6520 6f70  nt before the op
-00012890: 7469 6d69 7a61 7469 6f6e 2074 7269 616c  timization trial
-000128a0: 2069 7320 7465 726d 696e 6174 6564 2e20   is terminated. 
-000128b0: 4465 6661 756c 7473 2074 6f20 302c 2077  Defaults to 0, w
-000128c0: 6869 6368 0a20 2020 2020 2020 2020 2020  hich.           
-000128d0: 2064 6973 6162 6c65 7320 7468 6973 2066   disables this f
-000128e0: 6561 7475 7265 2e0a 2020 2020 2020 2020  eature..        
-000128f0: 6176 6572 6167 6520 2862 6f6f 6c29 3a20  average (bool): 
-00012900: 4966 2046 616c 7365 2c20 7468 6520 6465  If False, the de
-00012910: 7369 676e 6174 6564 206d 6574 7269 6320  signated metric 
-00012920: 7769 6c6c 2062 6520 6361 6c63 756c 6174  will be calculat
-00012930: 6564 2061 6363 6f72 6469 6e67 2074 6f20  ed according to 
-00012940: 6974 7320 7661 6c75 6520 6174 2074 6865  its value at the
-00012950: 2065 6e64 206f 6620 7468 6520 7472 6169   end of the trai
-00012960: 6e5f 6570 6f63 6873 2e20 0a20 2020 2020  n_epochs. .     
-00012970: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00012980: 7468 6520 6d65 7472 6963 2077 696c 6c20  the metric will 
-00012990: 6265 2061 7665 7261 6765 6420 6f75 7420  be averaged out 
-000129a0: 6163 726f 7373 2061 6c6c 2074 7261 696e  across all train
-000129b0: 5f65 706f 6368 732e 2044 6566 6175 6c74  _epochs. Default
-000129c0: 7320 746f 2054 7275 652e 0a20 2020 2020  s to True..     
-000129d0: 2020 206f 7074 5f6d 6f64 656c 2028 626f     opt_model (bo
-000129e0: 6f6c 293a 2049 6620 5472 7565 2c20 7468  ol): If True, th
-000129f0: 6520 6172 6368 6974 6563 7475 7265 2070  e architecture p
-00012a00: 6172 616d 6574 6572 7320 7769 6c6c 2062  arameters will b
-00012a10: 6520 6f70 7469 6d69 7a65 642e 2044 6566  e optimized. Def
-00012a20: 6175 6c74 7320 746f 2054 7275 652e 0a20  aults to True.. 
-00012a30: 2020 2020 2020 206f 7074 5f61 7567 2028         opt_aug (
-00012a40: 626f 6f6c 293a 2049 6620 5472 7565 2c20  bool): If True, 
-00012a50: 7468 6520 6175 676d 656e 7461 7469 6f6e  the augmentation
-00012a60: 2070 726f 6365 6475 7265 2077 696c 6c20   procedure will 
-00012a70: 6265 206f 7074 696d 697a 6564 2e20 4465  be optimized. De
-00012a80: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
-00012a90: 0a20 2020 2020 2020 2062 6174 6368 5f6d  .        batch_m
-00012aa0: 696e 2028 696e 7429 3a20 5468 6520 6d69  in (int): The mi
-00012ab0: 6e69 6d75 6d20 6e75 6d62 6572 206f 6620  nimum number of 
-00012ac0: 6175 676d 656e 7461 7469 6f6e 7320 746f  augmentations to
-00012ad0: 2070 6572 666f 726d 2070 6572 2069 6d61   perform per ima
-00012ae0: 6765 206f 6e20 7468 6520 706f 7369 7469  ge on the positi
-00012af0: 7665 2063 6c61 7373 2c20 6f6e 6c79 2061  ve class, only a
-00012b00: 7070 6c69 6361 626c 6520 0a20 2020 2020  pplicable .     
-00012b10: 2020 2069 6620 6f70 745f 6175 673d 5472     if opt_aug=Tr
-00012b20: 7565 2e20 4465 6661 756c 7473 2074 6f20  ue. Defaults to 
-00012b30: 322e 0a20 2020 2020 2020 2062 6174 6368  2..        batch
-00012b40: 5f6d 6178 2028 696e 7429 3a20 5468 6520  _max (int): The 
-00012b50: 6d61 7869 6d75 6d20 6e75 6d62 6572 206f  maximum number o
-00012b60: 6620 6175 676d 656e 7461 7469 6f6e 7320  f augmentations 
-00012b70: 746f 2070 6572 666f 726d 2070 6572 2069  to perform per i
-00012b80: 6d61 6765 206f 6e20 7468 6520 706f 7369  mage on the posi
-00012b90: 7469 7665 2063 6c61 7373 2c20 6f6e 6c79  tive class, only
-00012ba0: 2061 7070 6c69 6361 626c 6520 0a20 2020   applicable .   
-00012bb0: 2020 2020 2069 6620 6f70 745f 6175 673d       if opt_aug=
-00012bc0: 5472 7565 2e20 4465 6661 756c 7473 2074  True. Defaults t
-00012bd0: 6f20 3235 2e0a 2020 2020 2020 2020 696d  o 25..        im
-00012be0: 6167 655f 7369 7a65 5f6d 696e 2028 696e  age_size_min (in
-00012bf0: 7429 3a20 5468 6520 6d69 6e69 6d75 6d20  t): The minimum 
-00012c00: 696d 6167 6520 7369 7a65 2074 6f20 6173  image size to as
-00012c10: 7365 7373 2c20 6f6e 6c79 2061 7070 6c69  sess, only appli
-00012c20: 6361 626c 6520 6966 206f 7074 5f61 7567  cable if opt_aug
-00012c30: 3d54 7275 652e 2044 6566 6175 6c74 7320  =True. Defaults 
-00012c40: 746f 2035 302e 0a20 2020 2020 2020 2069  to 50..        i
-00012c50: 6d61 6765 5f73 697a 655f 6d61 7820 2869  mage_size_max (i
-00012c60: 6e74 293a 2054 6865 206d 6178 696d 756d  nt): The maximum
-00012c70: 2069 6d61 6765 2073 697a 6520 746f 2061   image size to a
-00012c80: 7373 6573 732c 206f 6e6c 7920 6170 706c  ssess, only appl
-00012c90: 6963 6162 6c65 2069 6620 6f70 745f 6175  icable if opt_au
-00012ca0: 673d 5472 7565 2e20 4465 6661 756c 7473  g=True. Defaults
-00012cb0: 2074 6f20 3130 302e 0a20 2020 2020 2020   to 100..       
-00012cc0: 206f 7074 5f6d 6178 5f6d 696e 5f70 6978   opt_max_min_pix
-00012cd0: 2028 696e 742c 206f 7074 696f 6e61 6c29   (int, optional)
-00012ce0: 3a20 5468 6520 6d69 6e69 6d75 6d20 6d61  : The minimum ma
-00012cf0: 7820 7069 7865 6c20 7661 6c75 6520 746f  x pixel value to
-00012d00: 2075 7365 2077 6865 6e20 7475 6e69 6e67   use when tuning
-00012d10: 2074 6865 206e 6f72 6d61 6c69 7a61 7469   the normalizati
-00012d20: 6f6e 2070 726f 6365 6475 7265 2c20 0a20  on procedure, . 
-00012d30: 2020 2020 2020 2020 2020 206f 6e6c 7920             only 
-00012d40: 6170 706c 6963 6162 6c65 2069 6620 6f70  applicable if op
-00012d50: 745f 6175 673d 5472 7565 2e20 4465 6661  t_aug=True. Defa
-00012d60: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
-00012d70: 2020 2020 2020 6f70 745f 6d61 785f 6d61        opt_max_ma
-00012d80: 785f 7069 7820 2869 6e74 2c20 6f70 7469  x_pix (int, opti
-00012d90: 6f6e 616c 293a 2054 6865 206d 6178 696d  onal): The maxim
-00012da0: 756d 206d 6178 2070 6978 656c 2076 616c  um max pixel val
-00012db0: 7565 2074 6f20 7573 6520 7768 656e 2074  ue to use when t
-00012dc0: 756e 696e 6720 7468 6520 6e6f 726d 616c  uning the normal
-00012dd0: 697a 6174 696f 6e20 7072 6f63 6564 7572  ization procedur
-00012de0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00012df0: 6f6e 6c79 2061 7070 6c69 6361 626c 6520  only applicable 
-00012e00: 6966 206f 7074 5f61 7567 3d54 7275 652e  if opt_aug=True.
-00012e10: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00012e20: 652e 0a20 2020 2020 2020 2073 6869 6674  e..        shift
-00012e30: 2028 696e 7429 3a20 5468 6520 6d61 7820   (int): The max 
-00012e40: 616c 6c6f 7765 6420 7665 7274 6963 616c  allowed vertical
-00012e50: 2f68 6f72 697a 6f6e 7461 6c20 7368 6966  /horizontal shif
-00012e60: 7473 2074 6f20 7573 6520 6475 7269 6e67  ts to use during
-00012e70: 2074 6865 2064 6174 6120 6175 676d 656e   the data augmen
-00012e80: 7461 7469 6f6e 2072 6f75 7469 6e65 2c20  tation routine, 
-00012e90: 6f6e 6c79 2061 7070 6c69 6361 626c 650a  only applicable.
-00012ea0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00012eb0: 7074 5f61 7567 3d54 7275 652e 2044 6566  pt_aug=True. Def
-00012ec0: 6175 6c74 7320 746f 2031 3020 7069 7865  aults to 10 pixe
-00012ed0: 6c73 2e0a 2020 2020 2020 2020 6d61 736b  ls..        mask
-00012ee0: 5f73 697a 6520 2869 6e74 2c20 6f70 7469  _size (int, opti
-00012ef0: 6f6e 616c 293a 2049 6620 656e 6162 6c65  onal): If enable
-00012f00: 642c 2074 6869 7320 7769 6c6c 2073 6574  d, this will set
-00012f10: 2074 6865 2070 6978 656c 206c 656e 6774   the pixel lengt
-00012f20: 6820 6f66 2061 2073 7175 6172 6520 6375  h of a square cu
-00012f30: 746f 7574 2c20 746f 2062 6520 7261 6e64  tout, to be rand
-00012f40: 6f6d 6c79 2070 6c61 6365 640a 2020 2020  omly placed.    
-00012f50: 2020 2020 2020 2020 736f 6d65 7768 6572          somewher
-00012f60: 6520 696e 2074 6865 2061 7567 6d65 6e74  e in the augment
-00012f70: 6564 2069 6d61 6765 2e20 5468 6973 2063  ed image. This c
-00012f80: 7574 6f75 7420 7769 6c6c 2072 6570 6c61  utout will repla
-00012f90: 6365 2074 6865 2069 6d61 6765 2076 616c  ce the image val
-00012fa0: 7565 7320 7769 7468 2030 2c20 7468 6572  ues with 0, ther
-00012fb0: 6566 6f72 6520 7365 7276 696e 6720 6173  efore serving as
-00012fc0: 2061 200a 2020 2020 2020 2020 2020 2020   a .            
-00012fd0: 7265 6775 6c61 7269 7a65 722e 204f 6e6c  regularizer. Onl
-00012fe0: 7920 6170 706c 6963 6162 6c65 2069 6620  y applicable if 
-00012ff0: 6f70 745f 6175 673d 5472 7565 2e20 4465  opt_aug=True. De
-00013000: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
-00013010: 2020 2020 2020 2020 6e75 6d5f 6d61 736b          num_mask
-00013020: 7320 2869 6e74 2c20 6f70 7469 6f6e 616c  s (int, optional
-00013030: 293a 2054 6865 206e 756d 6265 7220 6f66  ): The number of
-00013040: 206d 6173 6b73 2074 6f20 6372 6561 7465   masks to create
-00013050: 2c20 746f 2062 6520 7573 6564 2061 6c6f  , to be used alo
-00013060: 6e67 7369 6465 2074 6865 206d 6173 6b5f  ngside the mask_
-00013070: 7369 7a65 2070 6172 616d 6574 6572 2e20  size parameter. 
-00013080: 4966 200a 2020 2020 2020 2020 2020 2020  If .            
-00013090: 7468 6973 2069 7320 7365 7420 746f 2061  this is set to a
-000130a0: 2076 616c 7565 2067 7265 6174 6572 2074   value greater t
-000130b0: 6861 6e20 6f6e 652c 206f 7665 726c 6170  han one, overlap
-000130c0: 206d 6179 206f 6363 7572 2e20 0a20 2020   may occur. .   
-000130d0: 2020 2020 2076 6572 626f 7365 2028 696e       verbose (in
-000130e0: 7429 3a20 436f 6e74 726f 6c73 2074 6865  t): Controls the
-000130f0: 2061 6d6f 756e 7420 6f66 206f 7574 7075   amount of outpu
-00013100: 7420 7072 696e 7465 6420 6475 7269 6e67  t printed during
-00013110: 2074 6865 2074 7261 696e 696e 6720 7072   the training pr
-00013120: 6f63 6573 732e 2041 2076 616c 7565 206f  ocess. A value o
-00013130: 6620 3020 6973 2066 6f72 2073 696c 656e  f 0 is for silen
-00013140: 7420 6d6f 6465 2c20 0a20 2020 2020 2020  t mode, .       
-00013150: 2020 2020 2061 2076 616c 7565 206f 6620       a value of 
-00013160: 3120 6973 2075 7365 6420 666f 7220 7072  1 is used for pr
-00013170: 6f67 7265 7373 2062 6172 206d 6f64 652c  ogress bar mode,
-00013180: 2061 6e64 2032 2066 6f72 206f 6e65 206c   and 2 for one l
-00013190: 696e 6520 7065 7220 6570 6f63 6820 6d6f  ine per epoch mo
-000131a0: 6465 2e20 4465 6661 756c 7473 2074 6f20  de. Defaults to 
-000131b0: 312e 0a20 2020 2020 2020 2073 6d6f 7465  1..        smote
-000131c0: 5f73 616d 706c 696e 6720 2866 6c6f 6174  _sampling (float
-000131d0: 293a 2054 6865 2073 6d6f 7465 5f73 616d  ): The smote_sam
-000131e0: 706c 696e 6720 7061 7261 6d65 7465 7220  pling parameter 
-000131f0: 6973 2075 7365 6420 696e 2074 6865 2053  is used in the S
-00013200: 4d4f 5445 2061 6c67 6f72 6974 686d 2074  MOTE algorithm t
-00013210: 6f20 7370 6563 6966 7920 7468 6520 6465  o specify the de
-00013220: 7369 7265 6420 0a20 2020 2020 2020 2020  sired .         
-00013230: 2020 2072 6174 696f 206f 6620 7468 6520     ratio of the 
-00013240: 6d69 6e6f 7269 7479 2063 6c61 7373 2074  minority class t
-00013250: 6f20 7468 6520 6d61 6a6f 7269 7479 2063  o the majority c
-00013260: 6c61 7373 2e20 4465 6661 756c 7473 2074  lass. Defaults t
-00013270: 6f20 3020 7768 6963 6820 6469 7361 626c  o 0 which disabl
-00013280: 6573 2074 6865 2070 726f 6365 6475 7265  es the procedure
-00013290: 2e0a 2020 2020 2020 2020 0a20 2020 2054  ..        .    T
-000132a0: 6865 2066 6f6c 6c6c 6f77 696e 6720 6172  he folllowing ar
-000132b0: 6775 6d65 6e74 7320 6361 6e20 6265 2075  guments can be u
-000132c0: 7365 6420 746f 2073 6574 2065 6172 6c79  sed to set early
-000132d0: 2d73 746f 7070 696e 6720 6361 6c6c 6261  -stopping callba
-000132e0: 636b 732e 2054 6865 7365 2063 616e 2062  cks. These can b
-000132f0: 6520 7573 6564 2074 6f20 7465 726d 696e  e used to termin
-00013300: 6174 6520 7472 6961 6c73 2074 6861 7420  ate trials that 
-00013310: 6578 6365 6564 0a20 2020 2070 7265 2d64  exceed.    pre-d
-00013320: 6574 6572 6d69 6e65 6420 7468 7265 7368  etermined thresh
-00013330: 6f6c 6473 2c20 7768 6963 6820 6d61 7920  olds, which may 
-00013340: 6265 2069 6e64 6963 6174 6976 6520 6f66  be indicative of
-00013350: 2061 6e20 6f76 6572 6669 7420 6d6f 6465   an overfit mode
-00013360: 6c2e 0a0a 2020 2020 4172 6773 3a0a 2020  l...    Args:.  
-00013370: 2020 2020 2020 7472 6169 6e5f 6163 635f        train_acc_
-00013380: 7468 7265 7368 6f6c 6420 2866 6c6f 6174  threshold (float
-00013390: 2c20 6f70 7469 6f6e 616c 293a 2041 2076  , optional): A v
-000133a0: 616c 7565 2062 6574 7765 656e 2030 2061  alue between 0 a
-000133b0: 6e64 2031 2074 6861 7420 6465 7369 676e  nd 1 that design
-000133c0: 6174 6573 2074 6865 2074 7261 696e 696e  ates the trainin
-000133d0: 6720 6269 6e61 7279 5f61 6363 7572 6163  g binary_accurac
-000133e0: 7920 7468 7265 7368 6f6c 6420 7468 6174  y threshold that
-000133f0: 2073 686f 756c 640a 2020 2020 2020 2020   should.        
-00013400: 2020 2020 6e6f 7420 6265 2065 7863 6565      not be excee
-00013410: 6465 642e 2041 7320 736f 6f6e 2061 7320  ded. As soon as 
-00013420: 7468 6520 7472 6169 6e69 6e67 2065 7863  the training exc
-00013430: 6565 6473 2074 6869 7320 6c69 6d69 742c  eeds this limit,
-00013440: 2074 6865 2074 7269 616c 2069 7320 7374   the trial is st
-00013450: 6f70 7065 6420 6561 726c 792e 2044 6566  opped early. Def
-00013460: 6175 6c74 7320 746f 204e 6f6e 652e 0a20  aults to None.. 
-00013470: 2020 2020 2020 206d 6f6e 6974 6f72 3120         monitor1 
-00013480: 2873 7472 2c20 6f70 7469 6f6e 616c 293a  (str, optional):
-00013490: 2054 6865 2066 6972 7374 206d 6574 7269   The first metri
-000134a0: 6320 746f 206d 6f6e 6974 6f72 2c20 6361  c to monitor, ca
-000134b0: 6e20 7461 6b65 2074 6865 2073 616d 6520  n take the same 
-000134c0: 7661 6c75 6573 2061 7320 7468 6520 6d65  values as the me
-000134d0: 7472 6963 2061 7267 756d 656e 742e 2044  tric argument. D
-000134e0: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-000134f0: 0a20 2020 2020 2020 206d 6f6e 6974 6f72  .        monitor
-00013500: 3220 2873 7472 2c20 6f70 7469 6f6e 616c  2 (str, optional
-00013510: 293a 2054 6865 2073 6563 6f6e 6420 6d65  ): The second me
-00013520: 7472 6963 2074 6f20 6d6f 6e69 746f 722c  tric to monitor,
-00013530: 2063 616e 2074 616b 6520 7468 6520 7361   can take the sa
-00013540: 6d65 2076 616c 7565 7320 6173 2074 6865  me values as the
-00013550: 206d 6574 7269 6320 6172 6775 6d65 6e74   metric argument
-00013560: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
-00013570: 6e65 2e0a 2020 2020 2020 2020 6d6f 6e69  ne..        moni
-00013580: 746f 7231 5f74 6872 6573 6820 2866 6c6f  tor1_thresh (flo
-00013590: 6174 2c20 6f70 7469 6f6e 616c 293a 2054  at, optional): T
-000135a0: 6865 2074 6872 6573 686f 6c64 2076 616c  he threshold val
-000135b0: 7565 206f 6620 7468 6520 6669 7273 7420  ue of the first 
-000135c0: 6d6f 6e69 746f 7220 6d65 7472 6963 2e20  monitor metric. 
-000135d0: 4966 2074 6865 206d 6574 7269 6320 6973  If the metric is
-000135e0: 206c 6f73 732d 7265 6c61 7465 640a 2020   loss-related.  
-000135f0: 2020 2020 2020 2020 2020 7468 6520 7472            the tr
-00013600: 6169 6e69 6e67 2077 696c 6c20 7374 6f70  aining will stop
-00013610: 2065 6172 6c79 2069 6620 7468 6520 7661   early if the va
-00013620: 6c75 6520 6661 6c6c 7320 6265 6c6f 7720  lue falls below 
-00013630: 7468 6973 2074 6872 6573 686f 6c64 2e20  this threshold. 
-00013640: 5369 6d69 6c61 726c 792c 2069 6620 7468  Similarly, if th
-00013650: 6520 6d65 7472 6963 2069 7320 6163 6375  e metric is accu
-00013660: 7261 6379 2d72 656c 6174 6564 2c0a 2020  racy-related,.  
-00013670: 2020 2020 2020 2020 2020 7468 656e 2074            then t
-00013680: 6865 2074 7261 696e 696e 6720 7769 6c6c  he training will
-00013690: 2073 746f 7020 6561 726c 7920 6966 2074   stop early if t
-000136a0: 6865 2076 616c 7565 2066 616c 6c73 2061  he value falls a
-000136b0: 626f 7665 2074 6869 7320 7468 7265 7368  bove this thresh
-000136c0: 6f6c 642e 2044 6566 6175 6c74 7320 746f  old. Defaults to
-000136d0: 204e 6f6e 652e 0a20 2020 2020 2020 206d   None..        m
-000136e0: 6f6e 6974 6f72 325f 7468 7265 7368 2028  onitor2_thresh (
-000136f0: 666c 6f61 742c 206f 7074 696f 6e61 6c29  float, optional)
-00013700: 3a20 5468 6520 7468 7265 7368 6f6c 6420  : The threshold 
-00013710: 7661 6c75 6520 6f66 2074 6865 2073 6563  value of the sec
-00013720: 6f6e 6420 6d6f 6e69 746f 7220 6d65 7472  ond monitor metr
-00013730: 6963 2e20 4966 2074 6865 206d 6574 7269  ic. If the metri
-00013740: 6320 6973 206c 6f73 732d 7265 6c61 7465  c is loss-relate
-00013750: 640a 2020 2020 2020 2020 2020 2020 7468  d.            th
-00013760: 6520 7472 6169 6e69 6e67 2077 696c 6c20  e training will 
-00013770: 7374 6f70 2065 6172 6c79 2069 6620 7468  stop early if th
-00013780: 6520 7661 6c75 6520 6661 6c6c 7320 6265  e value falls be
-00013790: 6c6f 7720 7468 6973 2074 6872 6573 686f  low this thresho
-000137a0: 6c64 2e20 5369 6d69 6c61 726c 792c 2069  ld. Similarly, i
-000137b0: 6620 7468 6520 6d65 7472 6963 2069 7320  f the metric is 
-000137c0: 6163 6375 7261 6379 2d72 656c 6174 6564  accuracy-related
-000137d0: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
-000137e0: 656e 2074 6865 2074 7261 696e 696e 6720  en the training 
-000137f0: 7769 6c6c 2073 746f 7020 6561 726c 7920  will stop early 
-00013800: 6966 2074 6865 2076 616c 7565 2066 616c  if the value fal
-00013810: 6c73 2061 626f 7665 2074 6869 7320 7468  ls above this th
-00013820: 7265 7368 6f6c 642e 2044 6566 6175 6c74  reshold. Default
-00013830: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-00013840: 2020 200a 2020 2020 5265 7475 726e 733a     .    Returns:
-00013850: 0a20 2020 2020 2020 2054 6865 2066 6972  .        The fir
-00013860: 7374 206f 7574 7075 7420 6973 2074 6865  st output is the
-00013870: 2063 6c61 7373 6966 6965 7220 7769 7468   classifier with
-00013880: 2074 6865 206f 7074 696d 616c 2068 7970   the optimal hyp
-00013890: 6572 7061 7261 6d65 7465 7273 2e0a 2020  erparameters..  
-000138a0: 2020 2020 2020 5365 636f 6e64 206f 7574        Second out
-000138b0: 7075 7420 6973 2061 2064 6963 7469 6f6e  put is a diction
-000138c0: 6172 7920 636f 6e74 6169 6e69 6e67 2074  ary containing t
-000138d0: 6865 206f 7074 696d 616c 2068 7970 6572  he optimal hyper
-000138e0: 7061 7261 6d65 7465 7273 2e0a 2020 2020  parameters..    
-000138f0: 2020 2020 4966 2073 6176 655f 7374 7564      If save_stud
-00013900: 793d 5472 7565 2c20 7468 6520 4f70 7475  y=True, the Optu
-00013910: 6e61 2073 7475 6479 206f 626a 6563 7420  na study object 
-00013920: 7769 6c6c 2062 6520 7468 6520 7468 6972  will be the thir
-00013930: 6420 6f75 7470 7574 2e0a 2020 2020 2222  d output..    ""
-00013940: 220a 0a20 2020 2069 6620 636c 6620 3d3d  "..    if clf ==
-00013950: 2027 7266 273a 0a20 2020 2020 2020 206d   'rf':.        m
-00013960: 6f64 656c 5f30 203d 2052 616e 646f 6d46  odel_0 = RandomF
-00013970: 6f72 6573 7443 6c61 7373 6966 6965 7228  orestClassifier(
-00013980: 7261 6e64 6f6d 5f73 7461 7465 3d31 3930  random_state=190
-00013990: 3929 0a20 2020 2065 6c69 6620 636c 6620  9).    elif clf 
-000139a0: 3d3d 2027 6e6e 273a 0a20 2020 2020 2020  == 'nn':.       
-000139b0: 206d 6f64 656c 5f30 203d 204d 4c50 436c   model_0 = MLPCl
-000139c0: 6173 7369 6669 6572 2872 616e 646f 6d5f  assifier(random_
-000139d0: 7374 6174 653d 3139 3039 290a 2020 2020  state=1909).    
-000139e0: 656c 6966 2063 6c66 203d 3d20 2778 6762  elif clf == 'xgb
-000139f0: 273a 0a20 2020 2020 2020 206d 6f64 656c  ':.        model
-00013a00: 5f30 203d 2058 4742 436c 6173 7369 6669  _0 = XGBClassifi
-00013a10: 6572 2872 616e 646f 6d5f 7374 6174 653d  er(random_state=
-00013a20: 3139 3039 290a 2020 2020 2020 2020 6966  1909).        if
-00013a30: 2061 6c6c 2869 7369 6e73 7461 6e63 6528   all(isinstance(
-00013a40: 7661 6c2c 2028 696e 742c 2073 7472 2929  val, (int, str))
-00013a50: 2066 6f72 2076 616c 2069 6e20 6461 7461   for val in data
-00013a60: 5f79 293a 0a20 2020 2020 2020 2020 2020  _y):.           
-00013a70: 2070 7269 6e74 2827 5847 426f 6f73 7420   print('XGBoost 
-00013a80: 636c 6173 7369 6669 6572 2072 6571 7569  classifier requi
-00013a90: 7265 7320 6e75 6d65 7269 6361 6c20 636c  res numerical cl
-00013aa0: 6173 7320 6c61 6265 6c73 2120 436f 6e76  ass labels! Conv
-00013ab0: 6572 7469 6e67 2063 6c61 7373 206c 6162  erting class lab
-00013ac0: 656c 7320 6173 2066 6f6c 6c6f 7773 3a27  els as follows:'
-00013ad0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00013ae0: 696e 7428 275f 5f5f 5f5f 5f5f 5f5f 5f5f  int('___________
-00013af0: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________
-00013b00: 5f5f 5f5f 5f5f 5f5f 5f27 290a 2020 2020  _________').    
-00013b10: 2020 2020 2020 2020 7920 3d20 6e70 2e7a          y = np.z
-00013b20: 6572 6f73 286c 656e 2864 6174 615f 7929  eros(len(data_y)
-00013b30: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00013b40: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-00013b50: 286e 702e 756e 6971 7565 2864 6174 615f  (np.unique(data_
-00013b60: 7929 2929 3a0a 2020 2020 2020 2020 2020  y))):.          
-00013b70: 2020 2020 2020 7072 696e 7428 7374 7228        print(str(
-00013b80: 6e70 2e75 6e69 7175 6528 6461 7461 5f79  np.unique(data_y
-00013b90: 295b 695d 292e 6c6a 7573 7428 3130 292b  )[i]).ljust(10)+
-00013ba0: 2720 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '  -------------
-00013bb0: 3e20 2020 2020 272b 7374 7228 6929 290a  >     '+str(i)).
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bd0: 696e 6465 7820 3d20 6e70 2e77 6865 7265  index = np.where
-00013be0: 2864 6174 615f 7920 3d3d 206e 702e 756e  (data_y == np.un
-00013bf0: 6971 7565 2864 6174 615f 7929 5b69 5d29  ique(data_y)[i])
-00013c00: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00013c10: 2020 2020 795b 696e 6465 785d 203d 2069      y[index] = i
-00013c20: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00013c30: 615f 7920 3d20 7920 0a20 2020 2020 2020  a_y = y .       
-00013c40: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
-00013c50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013c60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013c70: 2729 0a20 2020 2065 6c69 6620 636c 6620  ').    elif clf 
-00013c80: 3d3d 2027 636e 6e27 3a0a 2020 2020 2020  == 'cnn':.      
-00013c90: 2020 7061 7373 200a 2020 2020 656c 7365    pass .    else
-00013ca0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00013cb0: 5661 6c75 6545 7272 6f72 2827 636c 6620  ValueError('clf 
-00013cc0: 6172 6775 6d65 6e74 206d 7573 7420 6569  argument must ei
-00013cd0: 7468 6572 2062 6520 2272 6622 2c20 2278  ther be "rf", "x
-00013ce0: 6762 222c 2022 6e6e 222c 206f 7220 2263  gb", "nn", or "c
-00013cf0: 6e6e 222e 2729 0a0a 2020 2020 6966 2063  nn".')..    if c
-00013d00: 6c66 2021 3d20 2763 6e6e 273a 0a20 2020  lf != 'cnn':.   
-00013d10: 2020 2020 2063 7620 3d20 6372 6f73 735f       cv = cross_
-00013d20: 7661 6c69 6461 7465 286d 6f64 656c 5f30  validate(model_0
-00013d30: 2c20 6461 7461 5f78 2c20 6461 7461 5f79  , data_x, data_y
-00013d40: 2c20 6376 3d6f 7074 5f63 7629 0a20 2020  , cv=opt_cv).   
-00013d50: 2020 2020 2069 6e69 7469 616c 5f73 636f       initial_sco
-00013d60: 7265 203d 206e 702e 6d65 616e 2863 765b  re = np.mean(cv[
-00013d70: 2774 6573 745f 7363 6f72 6527 5d29 0a0a  'test_score'])..
-00013d80: 2020 2020 7361 6d70 6c65 7220 3d20 6f70      sampler = op
-00013d90: 7475 6e61 2e73 616d 706c 6572 732e 5450  tuna.samplers.TP
-00013da0: 4553 616d 706c 6572 2873 6565 643d 3139  ESampler(seed=19
-00013db0: 3039 290a 2020 2020 7374 7564 7920 3d20  09).    study = 
-00013dc0: 6f70 7475 6e61 2e63 7265 6174 655f 7374  optuna.create_st
-00013dd0: 7564 7928 6469 7265 6374 696f 6e3d 276d  udy(direction='m
-00013de0: 6178 696d 697a 6527 2c20 7361 6d70 6c65  aximize', sample
-00013df0: 723d 7361 6d70 6c65 722c 2070 7275 6e65  r=sampler, prune
-00013e00: 723d 6f70 7475 6e61 2e70 7275 6e65 7273  r=optuna.pruners
-00013e10: 2e4d 6564 6961 6e50 7275 6e65 7228 6e5f  .MedianPruner(n_
-00013e20: 7374 6172 7475 705f 7472 6961 6c73 3d35  startup_trials=5
-00013e30: 2c20 6e5f 7761 726d 7570 5f73 7465 7073  , n_warmup_steps
-00013e40: 3d33 302c 2069 6e74 6572 7661 6c5f 7374  =30, interval_st
-00013e50: 6570 733d 3130 2929 0a20 2020 2070 7269  eps=10)).    pri
-00013e60: 6e74 2827 5374 6172 7469 6e67 2068 7970  nt('Starting hyp
-00013e70: 6572 7061 7261 6d65 7465 7220 6f70 7469  erparameter opti
-00013e80: 6d69 7a61 7469 6f6e 2c20 7468 6973 2077  mization, this w
-00013e90: 696c 6c20 7461 6b65 2061 2077 6869 6c65  ill take a while
-00013ea0: 2e2e 2e27 290a 2020 2020 2349 6620 6269  ...').    #If bi
-00013eb0: 6e61 7279 2063 6c61 7373 6966 6963 6174  nary classificat
-00013ec0: 696f 6e20 7461 736b 2c20 6361 6e20 6465  ion task, can de
-00013ed0: 616c 2077 6974 6820 696d 6261 6c61 6e63  al with imbalanc
-00013ee0: 6520 636c 6173 7365 7320 7769 7468 2077  e classes with w
-00013ef0: 6569 6768 7473 2068 7970 6572 7061 7261  eights hyperpara
-00013f00: 6d65 7465 720a 2020 2020 6966 206c 656e  meter.    if len
-00013f10: 286e 702e 756e 6971 7565 2864 6174 615f  (np.unique(data_
-00013f20: 7929 2920 3d3d 2032 2061 6e64 2063 6c66  y)) == 2 and clf
-00013f30: 2021 3d20 2763 6e6e 273a 0a20 2020 2020   != 'cnn':.     
-00013f40: 2020 2063 6f75 6e74 6572 203d 2043 6f75     counter = Cou
-00013f50: 6e74 6572 2864 6174 615f 7929 0a20 2020  nter(data_y).   
-00013f60: 2020 2020 2069 6620 636f 756e 7465 725b       if counter[
-00013f70: 6e70 2e75 6e69 7175 6528 6461 7461 5f79  np.unique(data_y
-00013f80: 295b 305d 5d20 213d 2063 6f75 6e74 6572  )[0]] != counter
-00013f90: 5b6e 702e 756e 6971 7565 2864 6174 615f  [np.unique(data_
-00013fa0: 7929 5b31 5d5d 3a0a 2020 2020 2020 2020  y)[1]]:.        
-00013fb0: 2020 2020 6966 2062 616c 616e 6365 3a0a      if balance:.
-00013fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fd0: 7072 696e 7428 2755 6e62 616c 616e 6365  print('Unbalance
-00013fe0: 6420 6461 7461 7365 7420 6465 7465 6374  d dataset detect
-00013ff0: 6564 2c20 7769 6c6c 2074 7261 696e 2063  ed, will train c
-00014000: 6c61 7373 6966 6965 7220 7769 7468 2077  lassifier with w
-00014010: 6569 6768 7473 2120 546f 2064 6973 6162  eights! To disab
-00014020: 6c65 2c20 7365 7420 6261 6c61 6e63 653d  le, set balance=
-00014030: 4661 6c73 6527 290a 2020 2020 2020 2020  False').        
-00014040: 2020 2020 2020 2020 6966 2063 6c66 203d          if clf =
-00014050: 3d20 2778 6762 273a 0a20 2020 2020 2020  = 'xgb':.       
-00014060: 2020 2020 2020 2020 2020 2020 2074 6f74               tot
-00014070: 616c 5f6e 6567 6174 6976 6520 3d20 6c65  al_negative = le
-00014080: 6e28 6e70 2e77 6865 7265 2864 6174 615f  n(np.where(data_
-00014090: 7920 3d3d 2063 6f75 6e74 6572 2e6d 6f73  y == counter.mos
-000140a0: 745f 636f 6d6d 6f6e 2831 295b 305d 5b30  t_common(1)[0][0
-000140b0: 5d29 5b30 5d29 0a20 2020 2020 2020 2020  ])[0]).         
-000140c0: 2020 2020 2020 2020 2020 2074 6f74 616c             total
-000140d0: 5f70 6f73 6974 6976 6520 3d20 6c65 6e28  _positive = len(
-000140e0: 6461 7461 5f79 2920 2d20 746f 7461 6c5f  data_y) - total_
-000140f0: 6e65 6761 7469 7665 0a20 2020 2020 2020  negative.       
-00014100: 2020 2020 2020 2020 2020 2020 2073 616d               sam
-00014110: 706c 655f 7765 6967 6874 203d 2074 6f74  ple_weight = tot
-00014120: 616c 5f6e 6567 6174 6976 6520 2f20 746f  al_negative / to
-00014130: 7461 6c5f 706f 7369 7469 7665 0a20 2020  tal_positive.   
-00014140: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00014150: 6620 636c 6620 3d3d 2027 7266 273a 0a20  f clf == 'rf':. 
-00014160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014170: 2020 2073 616d 706c 655f 7765 6967 6874     sample_weight
-00014180: 203d 2027 6261 6c61 6e63 6564 270a 2020   = 'balanced'.  
-00014190: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000141a0: 6966 2063 6c66 203d 3d20 276e 6e27 3a0a  if clf == 'nn':.
-000141b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141c0: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
-000141d0: 4e47 3a20 4d4c 5043 6c61 7373 6966 6965  NG: MLPClassifie
-000141e0: 7228 2920 646f 6573 206e 6f74 2073 7570  r() does not sup
-000141f0: 706f 7274 2073 616d 706c 6520 7765 6967  port sample weig
-00014200: 6874 732e 2729 0a20 2020 2020 2020 2020  hts.').         
-00014210: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00014220: 2020 2020 2020 2020 2073 616d 706c 655f           sample_
-00014230: 7765 6967 6874 203d 204e 6f6e 650a 2020  weight = None.  
-00014240: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00014250: 2020 2020 2020 2020 7361 6d70 6c65 5f77          sample_w
-00014260: 6569 6768 7420 3d20 4e6f 6e65 0a20 2020  eight = None.   
-00014270: 2065 6c73 653a 0a20 2020 2020 2020 2073   else:.        s
-00014280: 616d 706c 655f 7765 6967 6874 203d 204e  ample_weight = N
-00014290: 6f6e 650a 0a20 2020 2069 6620 636c 6620  one..    if clf 
-000142a0: 3d3d 2027 7266 273a 0a20 2020 2020 2020  == 'rf':.       
-000142b0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-000142c0: 2020 6f62 6a65 6374 6976 6520 3d20 6f62    objective = ob
-000142d0: 6a65 6374 6976 655f 7266 2864 6174 615f  jective_rf(data_
-000142e0: 782c 2064 6174 615f 792c 206f 7074 5f63  x, data_y, opt_c
-000142f0: 763d 6f70 745f 6376 290a 2020 2020 2020  v=opt_cv).      
-00014300: 2020 2020 2020 7374 7564 792e 6f70 7469        study.opti
-00014310: 6d69 7a65 286f 626a 6563 7469 7665 2c20  mize(objective, 
-00014320: 6e5f 7472 6961 6c73 3d6e 5f69 7465 722c  n_trials=n_iter,
-00014330: 2073 686f 775f 7072 6f67 7265 7373 5f62   show_progress_b
-00014340: 6172 3d54 7275 6529 232c 2067 635f 6166  ar=True)#, gc_af
-00014350: 7465 725f 7472 6961 6c3d 5472 7565 290a  ter_trial=True).
-00014360: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00014370: 6d73 203d 2073 7475 6479 2e62 6573 745f  ms = study.best_
-00014380: 7472 6961 6c2e 7061 7261 6d73 0a20 2020  trial.params.   
-00014390: 2020 2020 2020 2020 206d 6f64 656c 203d           model =
-000143a0: 2052 616e 646f 6d46 6f72 6573 7443 6c61   RandomForestCla
-000143b0: 7373 6966 6965 7228 6e5f 6573 7469 6d61  ssifier(n_estima
-000143c0: 746f 7273 3d70 6172 616d 735b 276e 5f65  tors=params['n_e
-000143d0: 7374 696d 6174 6f72 7327 5d2c 2063 7269  stimators'], cri
-000143e0: 7465 7269 6f6e 3d70 6172 616d 735b 2763  terion=params['c
-000143f0: 7269 7465 7269 6f6e 275d 2c20 0a20 2020  riterion'], .   
-00014400: 2020 2020 2020 2020 2020 2020 206d 6178               max
-00014410: 5f64 6570 7468 3d70 6172 616d 735b 276d  _depth=params['m
-00014420: 6178 5f64 6570 7468 275d 2c20 6d69 6e5f  ax_depth'], min_
-00014430: 7361 6d70 6c65 735f 7370 6c69 743d 7061  samples_split=pa
-00014440: 7261 6d73 5b27 6d69 6e5f 7361 6d70 6c65  rams['min_sample
-00014450: 735f 7370 6c69 7427 5d2c 200a 2020 2020  s_split'], .    
-00014460: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-00014470: 7361 6d70 6c65 735f 6c65 6166 3d70 6172  samples_leaf=par
-00014480: 616d 735b 276d 696e 5f73 616d 706c 6573  ams['min_samples
-00014490: 5f6c 6561 6627 5d2c 206d 6178 5f66 6561  _leaf'], max_fea
-000144a0: 7475 7265 733d 7061 7261 6d73 5b27 6d61  tures=params['ma
-000144b0: 785f 6665 6174 7572 6573 275d 2c20 0a20  x_features'], . 
-000144c0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000144d0: 6f6f 7473 7472 6170 3d70 6172 616d 735b  ootstrap=params[
-000144e0: 2762 6f6f 7473 7472 6170 275d 2c20 636c  'bootstrap'], cl
-000144f0: 6173 735f 7765 6967 6874 3d73 616d 706c  ass_weight=sampl
-00014500: 655f 7765 6967 6874 2c20 7261 6e64 6f6d  e_weight, random
-00014510: 5f73 7461 7465 3d31 3930 3929 0a20 2020  _state=1909).   
-00014520: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00014530: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00014540: 4661 696c 6564 2074 6f20 6f70 7469 6d69  Failed to optimi
-00014550: 7a65 2077 6974 6820 4f70 7475 6e61 2c20  ze with Optuna, 
-00014560: 7377 6974 6368 696e 6720 6f76 6572 2074  switching over t
-00014570: 6f20 4261 7965 7353 6561 7263 6843 562e  o BayesSearchCV.
-00014580: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
-00014590: 2070 6172 616d 7320 3d20 7b0a 2020 2020   params = {.    
-000145a0: 2020 2020 2020 2020 2020 2020 2763 7269              'cri
-000145b0: 7465 7269 6f6e 273a 205b 2267 696e 6922  terion': ["gini"
-000145c0: 2c20 2265 6e74 726f 7079 225d 2c0a 2020  , "entropy"],.  
-000145d0: 2020 2020 2020 2020 2020 2020 2020 276e                'n
-000145e0: 5f65 7374 696d 6174 6f72 7327 3a20 5b69  _estimators': [i
-000145f0: 6e74 2878 2920 666f 7220 7820 696e 206e  nt(x) for x in n
-00014600: 702e 6c69 6e73 7061 6365 2835 302c 3130  p.linspace(50,10
-00014610: 3030 2c20 6e75 6d3d 3230 295d 2c20 0a20  00, num=20)], . 
-00014620: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00014630: 6d61 785f 6665 6174 7572 6573 273a 205b  max_features': [
-00014640: 6461 7461 5f78 2e73 6861 7065 5b31 5d2c  data_x.shape[1],
-00014650: 2022 7371 7274 222c 2022 6c6f 6732 225d   "sqrt", "log2"]
-00014660: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014670: 2020 276d 6178 5f64 6570 7468 273a 205b    'max_depth': [
-00014680: 696e 7428 7829 2066 6f72 2078 2069 6e20  int(x) for x in 
-00014690: 6e70 2e6c 696e 7370 6163 6528 352c 3530  np.linspace(5,50
-000146a0: 2c6e 756d 3d35 295d 2c0a 2020 2020 2020  ,num=5)],.      
-000146b0: 2020 2020 2020 2020 2020 276d 696e 5f73            'min_s
-000146c0: 616d 706c 6573 5f73 706c 6974 273a 205b  amples_split': [
-000146d0: 332c 342c 362c 372c 382c 392c 3130 5d2c  3,4,6,7,8,9,10],
-000146e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000146f0: 2027 6d69 6e5f 7361 6d70 6c65 735f 6c65   'min_samples_le
-00014700: 6166 273a 205b 312c 332c 352c 372c 392c  af': [1,3,5,7,9,
-00014710: 3130 5d2c 0a20 2020 2020 2020 2020 2020  10],.           
-00014720: 2020 2020 2027 6d61 785f 6c65 6166 5f6e       'max_leaf_n
-00014730: 6f64 6573 273a 205b 696e 7428 7829 2066  odes': [int(x) f
-00014740: 6f72 2078 2069 6e20 6e70 2e6c 696e 7370  or x in np.linsp
-00014750: 6163 6528 322c 3230 3029 5d2c 0a20 2020  ace(2,200)],.   
-00014760: 2020 2020 2020 2020 2020 2020 2027 626f               'bo
-00014770: 6f74 7374 7261 7027 3a20 5b54 7275 652c  otstrap': [True,
-00014780: 4661 6c73 655d 2020 200a 2020 2020 2020  False]   .      
-00014790: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000147a0: 2020 2020 6773 203d 2042 6179 6573 5365      gs = BayesSe
-000147b0: 6172 6368 4356 286e 5f69 7465 723d 6e5f  archCV(n_iter=n_
-000147c0: 6974 6572 2c20 6573 7469 6d61 746f 723d  iter, estimator=
-000147d0: 6d6f 6465 6c5f 302c 2073 6561 7263 685f  model_0, search_
-000147e0: 7370 6163 6573 3d70 6172 616d 732c 200a  spaces=params, .
-000147f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014800: 6f70 7469 6d69 7a65 725f 6b77 6172 6773  optimizer_kwargs
-00014810: 3d7b 2762 6173 655f 6573 7469 6d61 746f  ={'base_estimato
-00014820: 7227 3a20 2752 4627 7d2c 2063 763d 6f70  r': 'RF'}, cv=op
-00014830: 745f 6376 290a 2020 2020 2020 2020 2020  t_cv).          
-00014840: 2020 6773 2e66 6974 2864 6174 615f 782c    gs.fit(data_x,
-00014850: 2064 6174 615f 7929 0a20 2020 2020 2020   data_y).       
-00014860: 2020 2020 2062 6573 745f 6573 742c 2062       best_est, b
-00014870: 6573 745f 7363 6f72 6520 3d20 6773 2e62  est_score = gs.b
-00014880: 6573 745f 6573 7469 6d61 746f 725f 2c20  est_estimator_, 
-00014890: 6e70 2e72 6f75 6e64 2867 732e 6265 7374  np.round(gs.best
-000148a0: 5f73 636f 7265 5f2c 2034 290a 2020 2020  _score_, 4).    
-000148b0: 2020 2020 2020 2020 7072 696e 7428 2748          print('H
-000148c0: 6967 6865 7374 206d 6561 6e20 6163 6375  ighest mean accu
-000148d0: 7261 6379 3a20 7b7d 272e 666f 726d 6174  racy: {}'.format
-000148e0: 2862 6573 745f 7363 6f72 6529 290a 2020  (best_score)).  
-000148f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00014900: 2067 732e 6265 7374 5f65 7374 696d 6174   gs.best_estimat
-00014910: 6f72 5f2c 2067 732e 6265 7374 5f70 6172  or_, gs.best_par
-00014920: 616d 735f 0a0a 2020 2020 656c 6966 2063  ams_..    elif c
-00014930: 6c66 203d 3d20 276e 6e27 3a0a 2020 2020  lf == 'nn':.    
-00014940: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00014950: 2020 2020 206f 626a 6563 7469 7665 203d       objective =
-00014960: 206f 626a 6563 7469 7665 5f6e 6e28 6461   objective_nn(da
-00014970: 7461 5f78 2c20 6461 7461 5f79 2c20 6f70  ta_x, data_y, op
-00014980: 745f 6376 3d6f 7074 5f63 7629 0a20 2020  t_cv=opt_cv).   
-00014990: 2020 2020 2020 2020 2073 7475 6479 2e6f           study.o
-000149a0: 7074 696d 697a 6528 6f62 6a65 6374 6976  ptimize(objectiv
-000149b0: 652c 206e 5f74 7269 616c 733d 6e5f 6974  e, n_trials=n_it
-000149c0: 6572 2c20 7368 6f77 5f70 726f 6772 6573  er, show_progres
-000149d0: 735f 6261 723d 5472 7565 2923 2c20 6763  s_bar=True)#, gc
-000149e0: 5f61 6674 6572 5f74 7269 616c 3d54 7275  _after_trial=Tru
-000149f0: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-00014a00: 6172 616d 7320 3d20 7374 7564 792e 6265  arams = study.be
-00014a10: 7374 5f74 7269 616c 2e70 6172 616d 730a  st_trial.params.
-00014a20: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00014a30: 7273 203d 205b 7061 7261 6d20 666f 7220  rs = [param for 
-00014a40: 7061 7261 6d20 696e 2070 6172 616d 7320  param in params 
-00014a50: 6966 2027 6e5f 756e 6974 735f 2720 696e  if 'n_units_' in
-00014a60: 2070 6172 616d 5d0a 2020 2020 2020 2020   param].        
-00014a70: 2020 2020 6c61 7965 7273 203d 2074 7570      layers = tup
-00014a80: 6c65 2870 6172 616d 735b 6c61 7965 725d  le(params[layer]
-00014a90: 2066 6f72 206c 6179 6572 2069 6e20 6c61   for layer in la
-00014aa0: 7965 7273 290a 2020 2020 2020 2020 2020  yers).          
-00014ab0: 2020 6d6f 6465 6c20 3d20 4d4c 5043 6c61    model = MLPCla
-00014ac0: 7373 6966 6965 7228 6869 6464 656e 5f6c  ssifier(hidden_l
-00014ad0: 6179 6572 5f73 697a 6573 3d74 7570 6c65  ayer_sizes=tuple
-00014ae0: 286c 6179 6572 7329 2c20 6c65 6172 6e69  (layers), learni
-00014af0: 6e67 5f72 6174 655f 696e 6974 3d70 6172  ng_rate_init=par
-00014b00: 616d 735b 276c 6561 726e 696e 675f 7261  ams['learning_ra
-00014b10: 7465 5f69 6e69 7427 5d2c 200a 2020 2020  te_init'], .    
-00014b20: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-00014b30: 7661 7469 6f6e 3d70 6172 616d 735b 2761  vation=params['a
-00014b40: 6374 6976 6174 696f 6e27 5d2c 206c 6561  ctivation'], lea
-00014b50: 726e 696e 675f 7261 7465 3d70 6172 616d  rning_rate=param
-00014b60: 735b 276c 6561 726e 696e 675f 7261 7465  s['learning_rate
-00014b70: 275d 2c20 616c 7068 613d 7061 7261 6d73  '], alpha=params
-00014b80: 5b27 616c 7068 6127 5d2c 200a 2020 2020  ['alpha'], .    
-00014b90: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-00014ba0: 685f 7369 7a65 3d70 6172 616d 735b 2762  h_size=params['b
-00014bb0: 6174 6368 5f73 697a 6527 5d2c 2073 6f6c  atch_size'], sol
-00014bc0: 7665 723d 7061 7261 6d73 5b27 736f 6c76  ver=params['solv
-00014bd0: 6572 275d 2c20 6d61 785f 6974 6572 3d32  er'], max_iter=2
-00014be0: 3530 302c 2072 616e 646f 6d5f 7374 6174  500, random_stat
-00014bf0: 653d 3139 3039 290a 2020 2020 2020 2020  e=1909).        
-00014c00: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00014c10: 2020 2020 7072 696e 7428 2746 6169 6c65      print('Faile
-00014c20: 6420 746f 206f 7074 696d 697a 6520 7769  d to optimize wi
-00014c30: 7468 204f 7074 756e 612c 2073 7769 7463  th Optuna, switc
-00014c40: 6869 6e67 206f 7665 7220 746f 2042 6179  hing over to Bay
-00014c50: 6573 5365 6172 6368 4356 2e2e 2e27 290a  esSearchCV...').
-00014c60: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00014c70: 6d73 203d 207b 0a20 2020 2020 2020 2020  ms = {.         
-00014c80: 2020 2020 2020 2027 6869 6464 656e 5f6c         'hidden_l
-00014c90: 6179 6572 5f73 697a 6573 273a 205b 2831  ayer_sizes': [(1
-00014ca0: 3030 2c29 2c28 3530 2c31 3030 2c35 3029  00,),(50,100,50)
-00014cb0: 2c28 3735 2c35 302c 3230 292c 2831 3530  ,(75,50,20),(150
-00014cc0: 2c31 3030 2c35 3029 2c28 3132 302c 3830  ,100,50),(120,80
-00014cd0: 2c34 3029 2c28 3130 302c 3530 2c33 3029  ,40),(100,50,30)
-00014ce0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00014cf0: 2020 2027 6c65 6172 6e69 6e67 5f72 6174     'learning_rat
-00014d00: 6527 3a20 5b27 636f 6e73 7461 6e74 272c  e': ['constant',
-00014d10: 2027 696e 7673 6361 6c69 6e67 272c 2027   'invscaling', '
-00014d20: 6164 6170 7469 7665 275d 2c0a 2020 2020  adaptive'],.    
-00014d30: 2020 2020 2020 2020 2020 2020 2761 6c70              'alp
-00014d40: 6861 273a 205b 302e 3030 3030 312c 2030  ha': [0.00001, 0
-00014d50: 2e35 5d2c 200a 2020 2020 2020 2020 2020  .5], .          
-00014d60: 2020 2020 2020 2761 6374 6976 6174 696f        'activatio
-00014d70: 6e27 3a20 5b27 7461 6e68 272c 2027 6c6f  n': ['tanh', 'lo
-00014d80: 6769 7374 6963 272c 2027 7265 6c75 275d  gistic', 'relu']
-00014d90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014da0: 2020 2773 6f6c 7665 7227 3a20 5b27 7367    'solver': ['sg
-00014db0: 6427 2c20 2761 6461 6d27 5d2c 0a20 2020  d', 'adam'],.   
-00014dc0: 2020 2020 2020 2020 2020 2020 2027 6d61               'ma
-00014dd0: 785f 6974 6572 273a 205b 3130 302c 2031  x_iter': [100, 1
-00014de0: 3530 2c20 3230 305d 200a 2020 2020 2020  50, 200] .      
-00014df0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00014e00: 2020 2020 6773 203d 2042 6179 6573 5365      gs = BayesSe
-00014e10: 6172 6368 4356 286e 5f69 7465 723d 6e5f  archCV(n_iter=n_
-00014e20: 6974 6572 2c20 6573 7469 6d61 746f 723d  iter, estimator=
-00014e30: 6d6f 6465 6c5f 302c 2073 6561 7263 685f  model_0, search_
-00014e40: 7370 6163 6573 3d70 6172 616d 732c 2063  spaces=params, c
-00014e50: 763d 6f70 745f 6376 290a 2020 2020 2020  v=opt_cv).      
-00014e60: 2020 2020 2020 6773 2e66 6974 2864 6174        gs.fit(dat
-00014e70: 615f 782c 2064 6174 615f 7929 0a20 2020  a_x, data_y).   
-00014e80: 2020 2020 2020 2020 2062 6573 745f 6573           best_es
-00014e90: 742c 2062 6573 745f 7363 6f72 6520 3d20  t, best_score = 
-00014ea0: 6773 2e62 6573 745f 6573 7469 6d61 746f  gs.best_estimato
-00014eb0: 725f 2c20 6e70 2e72 6f75 6e64 2867 732e  r_, np.round(gs.
-00014ec0: 6265 7374 5f73 636f 7265 5f2c 2034 290a  best_score_, 4).
-00014ed0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00014ee0: 7428 2748 6967 6865 7374 206d 6561 6e20  t('Highest mean 
-00014ef0: 6163 6375 7261 6379 3a20 7b7d 272e 666f  accuracy: {}'.fo
-00014f00: 726d 6174 2862 6573 745f 7363 6f72 6529  rmat(best_score)
-00014f10: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00014f20: 7475 726e 2067 732e 6265 7374 5f65 7374  turn gs.best_est
-00014f30: 696d 6174 6f72 5f2c 2067 732e 6265 7374  imator_, gs.best
-00014f40: 5f70 6172 616d 735f 0a20 2020 2020 2020  _params_.       
-00014f50: 2020 200a 2020 2020 656c 6966 2063 6c66     .    elif clf
-00014f60: 203d 3d20 2778 6762 273a 0a20 2020 2020   == 'xgb':.     
-00014f70: 2020 206f 626a 6563 7469 7665 203d 206f     objective = o
-00014f80: 626a 6563 7469 7665 5f78 6762 2864 6174  bjective_xgb(dat
-00014f90: 615f 782c 2064 6174 615f 792c 206c 696d  a_x, data_y, lim
-00014fa0: 6974 5f73 6561 7263 683d 6c69 6d69 745f  it_search=limit_
-00014fb0: 7365 6172 6368 2c20 6f70 745f 6376 3d6f  search, opt_cv=o
-00014fc0: 7074 5f63 762c 2074 6573 745f 7369 7a65  pt_cv, test_size
-00014fd0: 3d74 6573 745f 7369 7a65 290a 2020 2020  =test_size).    
-00014fe0: 2020 2020 6966 206c 696d 6974 5f73 6561      if limit_sea
-00014ff0: 7263 683a 0a20 2020 2020 2020 2020 2020  rch:.           
-00015000: 2070 7269 6e74 2827 4e4f 5445 3a20 546f   print('NOTE: To
-00015010: 2065 7870 616e 6420 6879 7065 7270 6172   expand hyperpar
-00015020: 616d 6574 6572 2073 6561 7263 6820 7370  ameter search sp
-00015030: 6163 652c 2073 6574 206c 696d 6974 5f73  ace, set limit_s
-00015040: 6561 7263 683d 4661 6c73 652c 2061 6c74  earch=False, alt
-00015050: 686f 7567 6820 7468 6973 2077 696c 6c20  hough this will 
-00015060: 696e 6372 6561 7365 2074 6865 206f 7074  increase the opt
-00015070: 696d 697a 6174 696f 6e20 7469 6d65 2073  imization time s
-00015080: 6967 6e69 6669 6361 6e74 6c79 2e27 290a  ignificantly.').
-00015090: 2020 2020 2020 2020 7374 7564 792e 6f70          study.op
-000150a0: 7469 6d69 7a65 286f 626a 6563 7469 7665  timize(objective
-000150b0: 2c20 6e5f 7472 6961 6c73 3d6e 5f69 7465  , n_trials=n_ite
-000150c0: 722c 2073 686f 775f 7072 6f67 7265 7373  r, show_progress
-000150d0: 5f62 6172 3d54 7275 6529 232c 2067 635f  _bar=True)#, gc_
-000150e0: 6166 7465 725f 7472 6961 6c3d 5472 7565  after_trial=True
-000150f0: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
-00015100: 203d 2073 7475 6479 2e62 6573 745f 7472   = study.best_tr
-00015110: 6961 6c2e 7061 7261 6d73 0a20 2020 2020  ial.params.     
-00015120: 2020 2069 6620 6c69 6d69 745f 7365 6172     if limit_sear
-00015130: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-00015140: 6966 2070 6172 616d 735b 2762 6f6f 7374  if params['boost
-00015150: 6572 275d 203d 3d20 2764 6172 7427 3a0a  er'] == 'dart':.
-00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015170: 6d6f 6465 6c20 3d20 5847 4243 6c61 7373  model = XGBClass
-00015180: 6966 6965 7228 626f 6f73 7465 723d 7061  ifier(booster=pa
-00015190: 7261 6d73 5b27 626f 6f73 7465 7227 5d2c  rams['booster'],
-000151a0: 2020 6e5f 6573 7469 6d61 746f 7273 3d70    n_estimators=p
-000151b0: 6172 616d 735b 276e 5f65 7374 696d 6174  arams['n_estimat
-000151c0: 6f72 7327 5d2c 2072 6567 5f6c 616d 6264  ors'], reg_lambd
-000151d0: 613d 7061 7261 6d73 5b27 7265 675f 6c61  a=params['reg_la
-000151e0: 6d62 6461 275d 2c20 0a20 2020 2020 2020  mbda'], .       
-000151f0: 2020 2020 2020 2020 2020 2020 2072 6567               reg
-00015200: 5f61 6c70 6861 3d70 6172 616d 735b 2772  _alpha=params['r
-00015210: 6567 5f61 6c70 6861 275d 2c20 6d61 785f  eg_alpha'], max_
-00015220: 6465 7074 683d 7061 7261 6d73 5b27 6d61  depth=params['ma
-00015230: 785f 6465 7074 6827 5d2c 2065 7461 3d70  x_depth'], eta=p
-00015240: 6172 616d 735b 2765 7461 275d 2c20 6761  arams['eta'], ga
-00015250: 6d6d 613d 7061 7261 6d73 5b27 6761 6d6d  mma=params['gamm
-00015260: 6127 5d2c 200a 2020 2020 2020 2020 2020  a'], .          
-00015270: 2020 2020 2020 2020 2020 6772 6f77 5f70            grow_p
-00015280: 6f6c 6963 793d 7061 7261 6d73 5b27 6772  olicy=params['gr
-00015290: 6f77 5f70 6f6c 6963 7927 5d2c 2073 616d  ow_policy'], sam
-000152a0: 706c 655f 7479 7065 3d70 6172 616d 735b  ple_type=params[
-000152b0: 2773 616d 706c 655f 7479 7065 275d 2c20  'sample_type'], 
-000152c0: 6e6f 726d 616c 697a 655f 7479 7065 3d70  normalize_type=p
-000152d0: 6172 616d 735b 276e 6f72 6d61 6c69 7a65  arams['normalize
-000152e0: 5f74 7970 6527 5d2c 0a20 2020 2020 2020  _type'],.       
-000152f0: 2020 2020 2020 2020 2020 2020 2072 6174               rat
-00015300: 655f 6472 6f70 3d70 6172 616d 735b 2772  e_drop=params['r
-00015310: 6174 655f 6472 6f70 275d 2c20 736b 6970  ate_drop'], skip
-00015320: 5f64 726f 703d 7061 7261 6d73 5b27 736b  _drop=params['sk
-00015330: 6970 5f64 726f 7027 5d2c 2073 6361 6c65  ip_drop'], scale
-00015340: 5f70 6f73 5f77 6569 6768 743d 7361 6d70  _pos_weight=samp
-00015350: 6c65 5f77 6569 6768 742c 2072 616e 646f  le_weight, rando
-00015360: 6d5f 7374 6174 653d 3139 3039 290a 2020  m_state=1909).  
-00015370: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
-00015380: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
-00015390: 203d 3d20 2767 6274 7265 6527 3a0a 2020   == 'gbtree':.  
-000153a0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000153b0: 6465 6c20 3d20 5847 4243 6c61 7373 6966  del = XGBClassif
-000153c0: 6965 7228 626f 6f73 7465 723d 7061 7261  ier(booster=para
-000153d0: 6d73 5b27 626f 6f73 7465 7227 5d2c 2020  ms['booster'],  
-000153e0: 6e5f 6573 7469 6d61 746f 7273 3d70 6172  n_estimators=par
-000153f0: 616d 735b 276e 5f65 7374 696d 6174 6f72  ams['n_estimator
-00015400: 7327 5d2c 2072 6567 5f6c 616d 6264 613d  s'], reg_lambda=
-00015410: 7061 7261 6d73 5b27 7265 675f 6c61 6d62  params['reg_lamb
-00015420: 6461 275d 2c20 0a20 2020 2020 2020 2020  da'], .         
-00015430: 2020 2020 2020 2020 2020 2072 6567 5f61             reg_a
-00015440: 6c70 6861 3d70 6172 616d 735b 2772 6567  lpha=params['reg
-00015450: 5f61 6c70 6861 275d 2c20 6d61 785f 6465  _alpha'], max_de
-00015460: 7074 683d 7061 7261 6d73 5b27 6d61 785f  pth=params['max_
-00015470: 6465 7074 6827 5d2c 2065 7461 3d70 6172  depth'], eta=par
-00015480: 616d 735b 2765 7461 275d 2c20 6761 6d6d  ams['eta'], gamm
-00015490: 613d 7061 7261 6d73 5b27 6761 6d6d 6127  a=params['gamma'
-000154a0: 5d2c 200a 2020 2020 2020 2020 2020 2020  ], .            
-000154b0: 2020 2020 2020 2020 6772 6f77 5f70 6f6c          grow_pol
-000154c0: 6963 793d 7061 7261 6d73 5b27 6772 6f77  icy=params['grow
-000154d0: 5f70 6f6c 6963 7927 5d2c 2073 7562 7361  _policy'], subsa
-000154e0: 6d70 6c65 3d70 6172 616d 735b 2773 7562  mple=params['sub
-000154f0: 7361 6d70 6c65 275d 2c20 7363 616c 655f  sample'], scale_
-00015500: 706f 735f 7765 6967 6874 3d73 616d 706c  pos_weight=sampl
-00015510: 655f 7765 6967 6874 2c20 7261 6e64 6f6d  e_weight, random
-00015520: 5f73 7461 7465 3d31 3930 3929 0a20 2020  _state=1909).   
-00015530: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00015540: 2020 2020 2020 2069 6620 7061 7261 6d73         if params
-00015550: 5b27 626f 6f73 7465 7227 5d20 3d3d 2027  ['booster'] == '
-00015560: 6461 7274 273a 0a20 2020 2020 2020 2020  dart':.         
-00015570: 2020 2020 2020 206d 6f64 656c 203d 2058         model = X
-00015580: 4742 436c 6173 7369 6669 6572 2862 6f6f  GBClassifier(boo
-00015590: 7374 6572 3d70 6172 616d 735b 2762 6f6f  ster=params['boo
-000155a0: 7374 6572 275d 2c20 6e5f 6573 7469 6d61  ster'], n_estima
-000155b0: 746f 7273 3d70 6172 616d 735b 276e 5f65  tors=params['n_e
-000155c0: 7374 696d 6174 6f72 7327 5d2c 2063 6f6c  stimators'], col
-000155d0: 7361 6d70 6c65 5f62 7974 7265 653d 7061  sample_bytree=pa
-000155e0: 7261 6d73 5b27 636f 6c73 616d 706c 655f  rams['colsample_
-000155f0: 6279 7472 6565 275d 2c20 0a20 2020 2020  bytree'], .     
-00015600: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00015610: 6567 5f6c 616d 6264 613d 7061 7261 6d73  eg_lambda=params
-00015620: 5b27 7265 675f 6c61 6d62 6461 275d 2c20  ['reg_lambda'], 
-00015630: 7265 675f 616c 7068 613d 7061 7261 6d73  reg_alpha=params
-00015640: 5b27 7265 675f 616c 7068 6127 5d2c 206d  ['reg_alpha'], m
-00015650: 6178 5f64 6570 7468 3d70 6172 616d 735b  ax_depth=params[
-00015660: 276d 6178 5f64 6570 7468 275d 2c20 6574  'max_depth'], et
-00015670: 613d 7061 7261 6d73 5b27 6574 6127 5d2c  a=params['eta'],
-00015680: 2067 616d 6d61 3d70 6172 616d 735b 2767   gamma=params['g
-00015690: 616d 6d61 275d 2c20 0a20 2020 2020 2020  amma'], .       
-000156a0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
-000156b0: 775f 706f 6c69 6379 3d70 6172 616d 735b  w_policy=params[
-000156c0: 2767 726f 775f 706f 6c69 6379 275d 2c20  'grow_policy'], 
-000156d0: 7361 6d70 6c65 5f74 7970 653d 7061 7261  sample_type=para
-000156e0: 6d73 5b27 7361 6d70 6c65 5f74 7970 6527  ms['sample_type'
-000156f0: 5d2c 206e 6f72 6d61 6c69 7a65 5f74 7970  ], normalize_typ
-00015700: 653d 7061 7261 6d73 5b27 6e6f 726d 616c  e=params['normal
-00015710: 697a 655f 7479 7065 275d 2c72 6174 655f  ize_type'],rate_
-00015720: 6472 6f70 3d70 6172 616d 735b 2772 6174  drop=params['rat
-00015730: 655f 6472 6f70 275d 2c20 0a20 2020 2020  e_drop'], .     
-00015740: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00015750: 6b69 705f 6472 6f70 3d70 6172 616d 735b  kip_drop=params[
-00015760: 2773 6b69 705f 6472 6f70 275d 2c20 6d69  'skip_drop'], mi
-00015770: 6e5f 6368 696c 645f 7765 6967 6874 3d70  n_child_weight=p
-00015780: 6172 616d 735b 276d 696e 5f63 6869 6c64  arams['min_child
-00015790: 5f77 6569 6768 7427 5d2c 206d 6178 5f64  _weight'], max_d
-000157a0: 656c 7461 5f73 7465 703d 7061 7261 6d73  elta_step=params
-000157b0: 5b27 6d61 785f 6465 6c74 615f 7374 6570  ['max_delta_step
-000157c0: 275d 2c20 7375 6273 616d 706c 653d 7061  '], subsample=pa
-000157d0: 7261 6d73 5b27 7375 6273 616d 706c 6527  rams['subsample'
-000157e0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000157f0: 2020 2020 2020 2073 6361 6c65 5f70 6f73         scale_pos
-00015800: 5f77 6569 6768 743d 7361 6d70 6c65 5f77  _weight=sample_w
-00015810: 6569 6768 742c 2072 616e 646f 6d5f 7374  eight, random_st
-00015820: 6174 653d 3139 3039 290a 2020 2020 2020  ate=1909).      
-00015830: 2020 2020 2020 656c 6966 2070 6172 616d        elif param
-00015840: 735b 2762 6f6f 7374 6572 275d 203d 3d20  s['booster'] == 
-00015850: 2767 6274 7265 6527 3a0a 2020 2020 2020  'gbtree':.      
-00015860: 2020 2020 2020 2020 2020 6d6f 6465 6c20            model 
-00015870: 3d20 5847 4243 6c61 7373 6966 6965 7228  = XGBClassifier(
-00015880: 626f 6f73 7465 723d 7061 7261 6d73 5b27  booster=params['
-00015890: 626f 6f73 7465 7227 5d2c 206e 5f65 7374  booster'], n_est
-000158a0: 696d 6174 6f72 733d 7061 7261 6d73 5b27  imators=params['
-000158b0: 6e5f 6573 7469 6d61 746f 7273 275d 2c20  n_estimators'], 
-000158c0: 636f 6c73 616d 706c 655f 6279 7472 6565  colsample_bytree
-000158d0: 3d70 6172 616d 735b 2763 6f6c 7361 6d70  =params['colsamp
-000158e0: 6c65 5f62 7974 7265 6527 5d2c 200a 2020  le_bytree'], .  
-000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015900: 2020 7265 675f 6c61 6d62 6461 3d70 6172    reg_lambda=par
-00015910: 616d 735b 2772 6567 5f6c 616d 6264 6127  ams['reg_lambda'
-00015920: 5d2c 2072 6567 5f61 6c70 6861 3d70 6172  ], reg_alpha=par
-00015930: 616d 735b 2772 6567 5f61 6c70 6861 275d  ams['reg_alpha']
-00015940: 2c20 6d61 785f 6465 7074 683d 7061 7261  , max_depth=para
-00015950: 6d73 5b27 6d61 785f 6465 7074 6827 5d2c  ms['max_depth'],
-00015960: 2065 7461 3d70 6172 616d 735b 2765 7461   eta=params['eta
-00015970: 275d 2c20 6761 6d6d 613d 7061 7261 6d73  '], gamma=params
-00015980: 5b27 6761 6d6d 6127 5d2c 200a 2020 2020  ['gamma'], .    
-00015990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159a0: 6772 6f77 5f70 6f6c 6963 793d 7061 7261  grow_policy=para
-000159b0: 6d73 5b27 6772 6f77 5f70 6f6c 6963 7927  ms['grow_policy'
-000159c0: 5d2c 2073 7562 7361 6d70 6c65 3d70 6172  ], subsample=par
-000159d0: 616d 735b 2773 7562 7361 6d70 6c65 275d  ams['subsample']
-000159e0: 2c20 6d69 6e5f 6368 696c 645f 7765 6967  , min_child_weig
-000159f0: 6874 3d70 6172 616d 735b 276d 696e 5f63  ht=params['min_c
-00015a00: 6869 6c64 5f77 6569 6768 7427 5d2c 206d  hild_weight'], m
-00015a10: 6178 5f64 656c 7461 5f73 7465 703d 7061  ax_delta_step=pa
-00015a20: 7261 6d73 5b27 6d61 785f 6465 6c74 615f  rams['max_delta_
-00015a30: 7374 6570 275d 2c0a 2020 2020 2020 2020  step'],.        
-00015a40: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-00015a50: 655f 706f 735f 7765 6967 6874 3d73 616d  e_pos_weight=sam
-00015a60: 706c 655f 7765 6967 6874 2c20 7261 6e64  ple_weight, rand
-00015a70: 6f6d 5f73 7461 7465 3d31 3930 3929 0a20  om_state=1909). 
-00015a80: 2020 2020 2020 0a20 2020 2065 6c73 653a        .    else:
-00015a90: 0a20 2020 2020 2020 206f 626a 6563 7469  .        objecti
-00015aa0: 7665 203d 206f 626a 6563 7469 7665 5f63  ve = objective_c
-00015ab0: 6e6e 2864 6174 615f 782c 2064 6174 615f  nn(data_x, data_
-00015ac0: 792c 2069 6d67 5f6e 756d 5f63 6861 6e6e  y, img_num_chann
-00015ad0: 656c 733d 696d 675f 6e75 6d5f 6368 616e  els=img_num_chan
-00015ae0: 6e65 6c73 2c20 6e6f 726d 616c 697a 653d  nels, normalize=
-00015af0: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
-00015b00: 6978 656c 3d6d 696e 5f70 6978 656c 2c20  ixel=min_pixel, 
-00015b10: 6d61 785f 7069 7865 6c3d 6d61 785f 7069  max_pixel=max_pi
-00015b20: 7865 6c2c 200a 2020 2020 2020 2020 2020  xel, .          
-00015b30: 2020 7661 6c5f 706f 7369 7469 7665 3d76    val_positive=v
-00015b40: 616c 5f58 2c20 7661 6c5f 6e65 6761 7469  al_X, val_negati
-00015b50: 7665 3d76 616c 5f59 2c20 7472 6169 6e5f  ve=val_Y, train_
-00015b60: 6570 6f63 6873 3d74 7261 696e 5f65 706f  epochs=train_epo
-00015b70: 6368 732c 2070 6174 6965 6e63 653d 7061  chs, patience=pa
-00015b80: 7469 656e 6365 2c20 6d65 7472 6963 3d6d  tience, metric=m
-00015b90: 6574 7269 632c 2061 7665 7261 6765 3d61  etric, average=a
-00015ba0: 7665 7261 6765 2c20 7465 7374 5f70 6f73  verage, test_pos
-00015bb0: 6974 6976 653d 7465 7374 5f70 6f73 6974  itive=test_posit
-00015bc0: 6976 652c 2074 6573 745f 6e65 6761 7469  ive, test_negati
-00015bd0: 7665 3d74 6573 745f 6e65 6761 7469 7665  ve=test_negative
-00015be0: 2c0a 2020 2020 2020 2020 2020 2020 6f70  ,.            op
-00015bf0: 745f 6d6f 6465 6c3d 6f70 745f 6d6f 6465  t_model=opt_mode
-00015c00: 6c2c 206f 7074 5f61 7567 3d6f 7074 5f61  l, opt_aug=opt_a
-00015c10: 7567 2c20 6261 7463 685f 6d69 6e3d 6261  ug, batch_min=ba
-00015c20: 7463 685f 6d69 6e2c 2062 6174 6368 5f6d  tch_min, batch_m
-00015c30: 6178 3d62 6174 6368 5f6d 6178 2c20 696d  ax=batch_max, im
-00015c40: 6167 655f 7369 7a65 5f6d 696e 3d69 6d61  age_size_min=ima
-00015c50: 6765 5f73 697a 655f 6d69 6e2c 2069 6d61  ge_size_min, ima
-00015c60: 6765 5f73 697a 655f 6d61 783d 696d 6167  ge_size_max=imag
-00015c70: 655f 7369 7a65 5f6d 6178 2c20 6261 6c61  e_size_max, bala
-00015c80: 6e63 653d 6261 6c61 6e63 652c 200a 2020  nce=balance, .  
-00015c90: 2020 2020 2020 2020 2020 6f70 745f 6d61            opt_ma
-00015ca0: 785f 6d69 6e5f 7069 783d 6f70 745f 6d61  x_min_pix=opt_ma
-00015cb0: 785f 6d69 6e5f 7069 782c 206f 7074 5f6d  x_min_pix, opt_m
-00015cc0: 6178 5f6d 6178 5f70 6978 3d6f 7074 5f6d  ax_max_pix=opt_m
-00015cd0: 6178 5f6d 6178 5f70 6978 2c20 7368 6966  ax_max_pix, shif
-00015ce0: 743d 7368 6966 742c 206f 7074 5f63 763d  t=shift, opt_cv=
-00015cf0: 6f70 745f 6376 2c20 6d61 736b 5f73 697a  opt_cv, mask_siz
-00015d00: 653d 6d61 736b 5f73 697a 652c 206e 756d  e=mask_size, num
-00015d10: 5f6d 6173 6b73 3d6e 756d 5f6d 6173 6b73  _masks=num_masks
-00015d20: 2c20 7472 6169 6e5f 6163 635f 7468 7265  , train_acc_thre
-00015d30: 7368 6f6c 643d 7472 6169 6e5f 6163 635f  shold=train_acc_
-00015d40: 7468 7265 7368 6f6c 642c 0a20 2020 2020  threshold,.     
-00015d50: 2020 2020 2020 2076 6572 626f 7365 3d76         verbose=v
-00015d60: 6572 626f 7365 2c20 6c69 6d69 745f 7365  erbose, limit_se
-00015d70: 6172 6368 3d6c 696d 6974 5f73 6561 7263  arch=limit_searc
-00015d80: 682c 206d 6f6e 6974 6f72 313d 6d6f 6e69  h, monitor1=moni
-00015d90: 746f 7231 2c20 6d6f 6e69 746f 7232 3d6d  tor1, monitor2=m
-00015da0: 6f6e 6974 6f72 322c 206d 6f6e 6974 6f72  onitor2, monitor
-00015db0: 315f 7468 7265 7368 3d6d 6f6e 6974 6f72  1_thresh=monitor
-00015dc0: 315f 7468 7265 7368 2c20 6d6f 6e69 746f  1_thresh, monito
-00015dd0: 7232 5f74 6872 6573 683d 6d6f 6e69 746f  r2_thresh=monito
-00015de0: 7232 5f74 6872 6573 682c 2073 6d6f 7465  r2_thresh, smote
-00015df0: 5f73 616d 706c 696e 673d 736d 6f74 655f  _sampling=smote_
-00015e00: 7361 6d70 6c69 6e67 290a 2020 2020 2020  sampling).      
-00015e10: 2020 7374 7564 792e 6f70 7469 6d69 7a65    study.optimize
-00015e20: 286f 626a 6563 7469 7665 2c20 6e5f 7472  (objective, n_tr
-00015e30: 6961 6c73 3d6e 5f69 7465 722c 2073 686f  ials=n_iter, sho
-00015e40: 775f 7072 6f67 7265 7373 5f62 6172 3d54  w_progress_bar=T
-00015e50: 7275 652c 2067 635f 6166 7465 725f 7472  rue, gc_after_tr
-00015e60: 6961 6c3d 5472 7565 2923 2c20 6e5f 6a6f  ial=True)#, n_jo
-00015e70: 6273 3d31 290a 2020 2020 2020 2020 7061  bs=1).        pa
-00015e80: 7261 6d73 203d 2073 7475 6479 2e62 6573  rams = study.bes
-00015e90: 745f 7472 6961 6c2e 7061 7261 6d73 0a0a  t_trial.params..
-00015ea0: 2020 2020 6669 6e61 6c5f 7363 6f72 6520      final_score 
-00015eb0: 3d20 7374 7564 792e 6265 7374 5f76 616c  = study.best_val
-00015ec0: 7565 0a0a 2020 2020 6966 2063 6c66 2021  ue..    if clf !
-00015ed0: 3d20 2763 6e6e 273a 0a20 2020 2020 2020  = 'cnn':.       
-00015ee0: 2069 6620 696e 6974 6961 6c5f 7363 6f72   if initial_scor
-00015ef0: 6520 3e20 6669 6e61 6c5f 7363 6f72 653a  e > final_score:
-00015f00: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00015f10: 6e74 2827 4879 7065 7270 6172 616d 6574  nt('Hyperparamet
-00015f20: 6572 206f 7074 696d 697a 6174 696f 6e20  er optimization 
-00015f30: 636f 6d70 6c65 7465 2120 4f70 7469 6d61  complete! Optima
-00015f40: 6c20 7065 7266 6f72 6d61 6e63 6520 6f66  l performance of
-00015f50: 207b 7d20 6973 204c 4f57 4552 2074 6861   {} is LOWER tha
-00015f60: 6e20 7468 6520 6261 7365 2070 6572 666f  n the base perfo
-00015f70: 726d 616e 6365 206f 6620 7b7d 2c20 7472  rmance of {}, tr
-00015f80: 7920 696e 6372 6561 7369 6e67 2074 6865  y increasing the
-00015f90: 2076 616c 7565 206f 6620 6e5f 6974 6572   value of n_iter
-00015fa0: 2061 6e64 2072 756e 2061 6761 696e 2e27   and run again.'
-00015fb0: 2e66 6f72 6d61 7428 6e70 2e72 6f75 6e64  .format(np.round
-00015fc0: 2866 696e 616c 5f73 636f 7265 2c20 3629  (final_score, 6)
-00015fd0: 2c20 6e70 2e72 6f75 6e64 2869 6e69 7469  , np.round(initi
-00015fe0: 616c 5f73 636f 7265 2c20 3629 2929 0a20  al_score, 6))). 
-00015ff0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00016000: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00016010: 4879 7065 7270 6172 616d 6574 6572 206f  Hyperparameter o
-00016020: 7074 696d 697a 6174 696f 6e20 636f 6d70  ptimization comp
-00016030: 6c65 7465 2120 4f70 7469 6d61 6c20 7065  lete! Optimal pe
-00016040: 7266 6f72 6d61 6e63 6520 6f66 207b 7d20  rformance of {} 
-00016050: 6973 2048 4947 4845 5220 7468 616e 2074  is HIGHER than t
-00016060: 6865 2062 6173 6520 7065 7266 6f72 6d61  he base performa
-00016070: 6e63 6520 6f66 207b 7d2e 272e 666f 726d  nce of {}.'.form
-00016080: 6174 286e 702e 726f 756e 6428 6669 6e61  at(np.round(fina
-00016090: 6c5f 7363 6f72 652c 2036 292c 206e 702e  l_score, 6), np.
-000160a0: 726f 756e 6428 696e 6974 6961 6c5f 7363  round(initial_sc
-000160b0: 6f72 652c 2036 2929 290a 2020 2020 2020  ore, 6))).      
-000160c0: 2020 6966 2072 6574 7572 6e5f 7374 7564    if return_stud
-000160d0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-000160e0: 6574 7572 6e20 6d6f 6465 6c2c 2070 6172  eturn model, par
-000160f0: 616d 732c 2073 7475 6479 0a20 2020 2020  ams, study.     
-00016100: 2020 2072 6574 7572 6e20 6d6f 6465 6c2c     return model,
-00016110: 2070 6172 616d 730a 2020 2020 656c 7365   params.    else
-00016120: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00016130: 2748 7970 6572 7061 7261 6d65 7465 7220  'Hyperparameter 
-00016140: 6f70 7469 6d69 7a61 7469 6f6e 2063 6f6d  optimization com
-00016150: 706c 6574 6521 204f 7074 696d 616c 2070  plete! Optimal p
-00016160: 6572 666f 726d 616e 6365 3a20 7b7d 272e  erformance: {}'.
-00016170: 666f 726d 6174 286e 702e 726f 756e 6428  format(np.round(
-00016180: 6669 6e61 6c5f 7363 6f72 652c 2036 2929  final_score, 6))
-00016190: 290a 2020 2020 2020 2020 6966 2072 6574  ).        if ret
-000161a0: 7572 6e5f 7374 7564 793a 0a20 2020 2020  urn_study:.     
-000161b0: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
-000161c0: 7261 6d73 2c20 7374 7564 790a 2020 2020  rams, study.    
-000161d0: 2020 2020 7265 7475 726e 2070 6172 616d      return param
-000161e0: 730a 0a64 6566 2062 6f72 7574 6173 6861  s..def borutasha
-000161f0: 705f 6f70 7428 6461 7461 5f78 2c20 6461  p_opt(data_x, da
-00016200: 7461 5f79 2c20 626f 7275 7461 5f74 7269  ta_y, boruta_tri
-00016210: 616c 733d 3530 2c20 6d6f 6465 6c3d 2772  als=50, model='r
-00016220: 6627 2c20 696d 706f 7274 616e 6365 5f74  f', importance_t
-00016230: 7970 653d 2767 6169 6e27 293a 0a20 2020  ype='gain'):.   
-00016240: 2022 2222 0a20 2020 2041 7070 6c69 6573   """.    Applies
-00016250: 2061 2063 6f6d 6269 6e61 7469 6f6e 206f   a combination o
-00016260: 6620 7468 6520 426f 7275 7461 2061 6c67  f the Boruta alg
-00016270: 6f72 6974 686d 2061 6e64 0a20 2020 2053  orithm and.    S
-00016280: 6861 706c 6579 2076 616c 7565 732c 2061  hapley values, a
-00016290: 206d 6574 686f 6420 6465 7665 6c6f 7065   method develope
-000162a0: 6420 6279 2045 6f67 6861 6e20 4b65 616e  d by Eoghan Kean
-000162b0: 7920 2832 3032 3029 2e0a 0a20 2020 2053  y (2020)...    S
-000162c0: 6565 3a20 6874 7470 733a 2f2f 646f 692e  ee: https://doi.
-000162d0: 6f72 672f 3130 2e35 3238 312f 7a65 6e6f  org/10.5281/zeno
-000162e0: 646f 2e34 3234 3736 3138 0a0a 2020 2020  do.4247618..    
-000162f0: 4172 6773 3a0a 2020 2020 2020 2020 6461  Args:.        da
-00016300: 7461 5f78 2028 6e64 6172 7261 7929 3a20  ta_x (ndarray): 
-00016310: 3244 2061 7272 6179 206f 6620 7369 7a65  2D array of size
-00016320: 2028 6e20 7820 6d29 2c20 7768 6572 6520   (n x m), where 
-00016330: 6e20 6973 2074 6865 0a20 2020 2020 2020  n is the.       
-00016340: 2020 2020 206e 756d 6265 7220 6f66 2073       number of s
-00016350: 616d 706c 6573 2c20 616e 6420 6d20 7468  amples, and m th
-00016360: 6520 6e75 6d62 6572 206f 6620 6665 6174  e number of feat
-00016370: 7572 6573 2e0a 2020 2020 2020 2020 6461  ures..        da
-00016380: 7461 5f79 2028 6e64 6172 7261 792c 2073  ta_y (ndarray, s
-00016390: 7472 293a 2031 4420 6172 7261 7920 636f  tr): 1D array co
-000163a0: 6e74 6169 6e69 6e67 2074 6865 2063 6f72  ntaining the cor
-000163b0: 7265 7370 6f6e 696e 6720 6c61 6265 6c73  responing labels
-000163c0: 2e0a 2020 2020 2020 2020 626f 7275 7461  ..        boruta
-000163d0: 5f74 7269 616c 7320 2869 6e74 293a 2054  _trials (int): T
-000163e0: 6865 206e 756d 6265 7220 6f66 2074 7269  he number of tri
-000163f0: 616c 7320 746f 2072 756e 2e20 4120 6c61  als to run. A la
-00016400: 7267 6572 206e 756d 6265 7220 6973 0a20  rger number is. 
-00016410: 2020 2020 2020 2020 2020 2062 6574 7465             bette
-00016420: 7220 6173 2074 6865 2064 6973 7472 6962  r as the distrib
-00016430: 7574 696f 6e20 7769 6c6c 2062 6520 6d6f  ution will be mo
-00016440: 7265 2072 6f62 7573 7420 746f 2072 616e  re robust to ran
-00016450: 646f 6d20 666c 7563 7475 6174 696f 6e73  dom fluctuations
-00016460: 2e20 0a20 2020 2020 2020 2020 2020 2044  . .            D
-00016470: 6566 6175 6c74 7320 746f 2035 302e 0a20  efaults to 50.. 
-00016480: 2020 2020 2020 206d 6f64 656c 2028 7374         model (st
-00016490: 7229 3a20 5468 6520 656e 7365 6d62 6c65  r): The ensemble
-000164a0: 206d 6574 686f 6420 746f 2075 7365 2077   method to use w
-000164b0: 6865 6e20 6669 7474 696e 6720 616e 6420  hen fitting and 
-000164c0: 6361 6c63 756c 6174 696e 670a 2020 2020  calculating.    
-000164d0: 2020 2020 2020 2020 7468 6520 6665 6174          the feat
-000164e0: 7572 6520 696d 706f 7274 616e 6365 206d  ure importance m
-000164f0: 6574 7269 632e 204f 6e6c 7920 7477 6f20  etric. Only two 
-00016500: 6f70 7469 6f6e 7320 6172 6520 6375 7272  options are curr
-00016510: 656e 746c 790a 2020 2020 2020 2020 2020  ently.          
-00016520: 2020 7375 7070 6f72 7465 642c 2027 7266    supported, 'rf
-00016530: 2720 666f 7220 5261 6e64 6f6d 2046 6f72  ' for Random For
-00016540: 6573 7420 616e 6420 2778 6762 2720 666f  est and 'xgb' fo
-00016550: 7220 4578 7472 656d 6520 4772 6164 6965  r Extreme Gradie
-00016560: 6e74 2042 6f6f 7374 696e 672e 0a20 2020  nt Boosting..   
-00016570: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00016580: 7320 746f 2027 7266 272e 0a20 2020 2020  s to 'rf'..     
-00016590: 2020 2069 6d70 6f72 7461 6e63 655f 7479     importance_ty
-000165a0: 7065 2028 7374 7229 3a20 5468 6520 6665  pe (str): The fe
-000165b0: 6174 7572 6520 696d 706f 7274 616e 6365  ature importance
-000165c0: 2074 7970 6520 746f 2075 7365 2c20 6f6e   type to use, on
-000165d0: 6c79 2061 7070 6c69 6361 626c 650a 2020  ly applicable.  
-000165e0: 2020 2020 2020 2020 2020 7768 656e 2075            when u
-000165f0: 7369 6e67 2063 6c66 3d27 7867 6227 2e20  sing clf='xgb'. 
-00016600: 5468 6520 6f70 7469 6f6e 7320 696e 636c  The options incl
-00016610: 7564 6520 e280 9c67 6169 6ee2 809d 2c20  ude ...gain..., 
-00016620: e280 9c77 6569 6768 74e2 809d 2c20 e280  ...weight..., ..
-00016630: 9c63 6f76 6572 e280 9d2c 0a20 2020 2020  .cover...,.     
-00016640: 2020 2020 2020 20e2 809c 746f 7461 6c5f         ...total_
-00016650: 6761 696e e280 9d20 6f72 20e2 809c 746f  gain... or ...to
-00016660: 7461 6c5f 636f 7665 72e2 809d 2e20 4465  tal_cover.... De
-00016670: 6661 756c 7473 2074 6f20 2767 6169 6e27  faults to 'gain'
-00016680: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
-00016690: 2020 2020 2020 2020 4669 7273 7420 6f75          First ou
-000166a0: 7470 7574 2069 7320 6120 3144 2061 7272  tput is a 1D arr
-000166b0: 6179 2063 6f6e 7461 696e 696e 6720 7468  ay containing th
-000166c0: 6520 696e 6469 6365 7320 6f66 2074 6865  e indices of the
-000166d0: 2073 656c 6563 7465 6420 6665 6174 7572   selected featur
-000166e0: 6573 2e20 0a20 2020 2020 2020 2054 6865  es. .        The
-000166f0: 7365 2069 6e64 6963 6573 2063 616e 2074  se indices can t
-00016700: 6865 6e20 6265 2075 7365 6420 746f 2073  hen be used to s
-00016710: 656c 6563 7420 7468 6520 636f 6c75 6d6e  elect the column
-00016720: 7320 696e 2074 6865 2064 6174 615f 7820  s in the data_x 
-00016730: 6172 7261 792e 0a20 2020 2020 2020 2053  array..        S
-00016740: 6563 6f6e 6420 6f75 7470 7574 2069 7320  econd output is 
-00016750: 7468 6520 6665 6174 7572 6520 7365 6c65  the feature sele
-00016760: 6374 696f 6e20 6f62 6a65 6374 2c20 7768  ction object, wh
-00016770: 6963 6820 636f 6e74 6169 6e73 2066 6561  ich contains fea
-00016780: 7475 7265 2073 656c 6563 7469 6f6e 0a20  ture selection. 
-00016790: 2020 2020 2020 2068 6973 746f 7279 2069         history i
-000167a0: 6e66 6f72 6d61 7469 6f6e 2061 6e64 2076  nformation and v
-000167b0: 6973 7561 6c69 7a61 7469 6f6e 206f 7074  isualization opt
-000167c0: 696f 6e73 2e0a 2020 2020 2222 220a 2020  ions..    """.  
-000167d0: 2020 0a20 2020 2069 6620 626f 7275 7461    .    if boruta
-000167e0: 5f74 7269 616c 7320 3d3d 2030 3a20 2354  _trials == 0: #T
-000167f0: 6869 7320 6973 2074 6865 2066 6c61 6720  his is the flag 
-00016800: 7468 6174 2074 6865 2065 6e73 656d 626c  that the ensembl
-00016810: 655f 6d6f 6465 6c2e 436c 6173 7369 6669  e_model.Classifi
-00016820: 6572 2063 6c61 7373 2075 7365 7320 746f  er class uses to
-00016830: 2064 6973 6162 6c65 2066 6561 7475 7265   disable feature
-00016840: 2073 656c 6563 7469 6f6e 0a20 2020 2020   selection.     
-00016850: 2020 2072 6574 7572 6e20 6e70 2e61 7261     return np.ara
-00016860: 6e67 6528 6461 7461 5f78 2e73 6861 7065  nge(data_x.shape
-00016870: 5b31 5d29 2c20 4e6f 6e65 0a0a 2020 2020  [1]), None..    
-00016880: 6966 2062 6f72 7574 615f 7472 6961 6c73  if boruta_trials
-00016890: 203c 2032 303a 0a20 2020 2020 2020 2070   < 20:.        p
-000168a0: 7269 6e74 2827 5741 524e 494e 473a 2052  rint('WARNING: R
-000168b0: 6573 756c 7473 2061 7265 2075 6e73 7461  esults are unsta
-000168c0: 626c 6520 6966 2062 6f72 7574 615f 7472  ble if boruta_tr
-000168d0: 6961 6c73 2069 7320 746f 6f20 6c6f 7721  ials is too low!
-000168e0: 2729 0a20 2020 2069 6620 6e70 2e61 6e79  ').    if np.any
-000168f0: 286e 702e 6973 6e61 6e28 6461 7461 5f78  (np.isnan(data_x
-00016900: 2929 3a0a 2020 2020 2020 2020 2370 7269  )):.        #pri
-00016910: 6e74 2827 4e61 4e20 7661 6c75 6573 2064  nt('NaN values d
-00016920: 6574 6563 7465 642c 2061 7070 6c79 696e  etected, applyin
-00016930: 6720 5374 7261 776d 616e 2069 6d70 7574  g Strawman imput
-00016940: 6174 696f 6e2e 2e2e 2729 0a20 2020 2020  ation...').     
-00016950: 2020 2064 6174 615f 7820 3d20 5374 7261     data_x = Stra
-00016960: 776d 616e 5f69 6d70 7574 6174 696f 6e28  wman_imputation(
-00016970: 6461 7461 5f78 290a 0a20 2020 2069 6620  data_x)..    if 
-00016980: 6d6f 6465 6c20 3d3d 2027 7266 273a 0a20  model == 'rf':. 
-00016990: 2020 2020 2020 2063 6c61 7373 6966 6965         classifie
-000169a0: 7220 3d20 5261 6e64 6f6d 466f 7265 7374  r = RandomForest
-000169b0: 436c 6173 7369 6669 6572 2872 616e 646f  Classifier(rando
-000169c0: 6d5f 7374 6174 653d 3139 3039 290a 2020  m_state=1909).  
-000169d0: 2020 656c 6966 206d 6f64 656c 203d 3d20    elif model == 
-000169e0: 2778 6762 273a 0a20 2020 2020 2020 2063  'xgb':.        c
-000169f0: 6c61 7373 6966 6965 7220 3d20 5847 4243  lassifier = XGBC
-00016a00: 6c61 7373 6966 6965 7228 7472 6565 5f6d  lassifier(tree_m
-00016a10: 6574 686f 643d 2765 7861 6374 272c 206d  ethod='exact', m
-00016a20: 6178 5f64 6570 7468 3d32 302c 2069 6d70  ax_depth=20, imp
-00016a30: 6f72 7461 6e63 655f 7479 7065 3d69 6d70  ortance_type=imp
-00016a40: 6f72 7461 6e63 655f 7479 7065 2c20 7261  ortance_type, ra
-00016a50: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
-00016a60: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00016a70: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00016a80: 726f 7228 274d 6f64 656c 2061 7267 756d  ror('Model argum
-00016a90: 656e 7420 6d75 7374 2065 6974 6865 7220  ent must either 
-00016aa0: 6265 2022 7266 2220 6f72 2022 7867 6222  be "rf" or "xgb"
-00016ab0: 2e27 290a 2020 2020 0a20 2020 2074 7279  .').    .    try
-00016ac0: 3a0a 2020 2020 2020 2020 2342 6f72 7574  :.        #Borut
-00016ad0: 6153 6861 7020 7072 6f67 7261 6d20 7265  aShap program re
-00016ae0: 7175 6972 6573 2069 6e70 7574 2074 6f20  quires input to 
-00016af0: 6861 7665 2074 6865 2063 6f6c 756d 6e73  have the columns
-00016b00: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
-00016b10: 2020 2023 436f 6e76 6572 7469 6e67 2074     #Converting t
-00016b20: 6f20 5061 6e64 6173 2064 6174 6166 7261  o Pandas datafra
-00016b30: 6d65 0a20 2020 2020 2020 2063 6f6c 7320  me.        cols 
-00016b40: 3d20 5b73 7472 2869 2920 666f 7220 6920  = [str(i) for i 
-00016b50: 696e 206e 702e 6172 616e 6765 2864 6174  in np.arange(dat
-00016b60: 615f 782e 7368 6170 655b 315d 295d 0a20  a_x.shape[1])]. 
-00016b70: 2020 2020 2020 2058 203d 2044 6174 6146         X = DataF
-00016b80: 7261 6d65 2864 6174 615f 782c 2063 6f6c  rame(data_x, col
-00016b90: 756d 6e73 3d63 6f6c 7329 0a20 2020 2020  umns=cols).     
-00016ba0: 2020 2079 203d 206e 702e 7a65 726f 7328     y = np.zeros(
-00016bb0: 6c65 6e28 6461 7461 5f79 2929 0a0a 2020  len(data_y))..  
-00016bc0: 2020 2020 2020 2342 656c 6f77 2069 7320        #Below is 
-00016bd0: 746f 2063 6f6e 7665 7274 2063 6174 6567  to convert categ
-00016be0: 6f72 6963 616c 206c 6162 656c 7320 746f  orical labels to
-00016bf0: 206e 756d 6572 6963 616c 2c20 6173 2070   numerical, as p
-00016c00: 6572 2042 6f72 7574 6153 6861 7020 7265  er BorutaShap re
-00016c10: 7175 6972 656d 656e 7473 0a20 2020 2020  quirements.     
-00016c20: 2020 2066 6f72 2069 2c20 6c61 6265 6c20     for i, label 
-00016c30: 696e 2065 6e75 6d65 7261 7465 286e 702e  in enumerate(np.
-00016c40: 756e 6971 7565 2864 6174 615f 7929 293a  unique(data_y)):
-00016c50: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-00016c60: 6b20 3d20 6e70 2e77 6865 7265 2864 6174  k = np.where(dat
-00016c70: 615f 7920 3d3d 206c 6162 656c 295b 305d  a_y == label)[0]
-00016c80: 0a20 2020 2020 2020 2020 2020 2079 5b6d  .            y[m
-00016c90: 6173 6b5d 203d 2069 0a0a 2020 2020 2020  ask] = i..      
-00016ca0: 2020 6665 6174 5f73 656c 6563 746f 7220    feat_selector 
-00016cb0: 3d20 426f 7275 7461 5368 6170 286d 6f64  = BorutaShap(mod
-00016cc0: 656c 3d63 6c61 7373 6966 6965 722c 2069  el=classifier, i
-00016cd0: 6d70 6f72 7461 6e63 655f 6d65 6173 7572  mportance_measur
-00016ce0: 653d 2773 6861 7027 2c20 636c 6173 7369  e='shap', classi
-00016cf0: 6669 6361 7469 6f6e 3d54 7275 6529 0a20  fication=True). 
-00016d00: 2020 2020 2020 2070 7269 6e74 2827 5275         print('Ru
-00016d10: 6e6e 696e 6720 6665 6174 7572 6520 7365  nning feature se
-00016d20: 6c65 6374 696f 6e2e 2e2e 2729 0a20 2020  lection...').   
-00016d30: 2020 2020 2066 6561 745f 7365 6c65 6374       feat_select
-00016d40: 6f72 2e66 6974 2858 3d58 2c20 793d 792c  or.fit(X=X, y=y,
-00016d50: 206e 5f74 7269 616c 733d 626f 7275 7461   n_trials=boruta
-00016d60: 5f74 7269 616c 732c 2076 6572 626f 7365  _trials, verbose
-00016d70: 3d46 616c 7365 2c20 7261 6e64 6f6d 5f73  =False, random_s
-00016d80: 7461 7465 3d31 3930 3929 0a0a 2020 2020  tate=1909)..    
-00016d90: 2020 2020 696e 6465 7820 3d20 6e70 2e61      index = np.a
-00016da0: 7272 6179 285b 696e 7428 6665 6174 2920  rray([int(feat) 
-00016db0: 666f 7220 6665 6174 2069 6e20 6665 6174  for feat in feat
-00016dc0: 5f73 656c 6563 746f 722e 6163 6365 7074  _selector.accept
-00016dd0: 6564 5d29 0a20 2020 2020 2020 2069 6e64  ed]).        ind
-00016de0: 6578 2e73 6f72 7428 290a 2020 2020 2020  ex.sort().      
-00016df0: 2020 7072 696e 7428 2746 6561 7475 7265    print('Feature
-00016e00: 2073 656c 6563 7469 6f6e 2063 6f6d 706c   selection compl
-00016e10: 6574 652c 207b 7d20 7365 6c65 6374 6564  ete, {} selected
-00016e20: 206f 7574 206f 6620 7b7d 2127 2e66 6f72   out of {}!'.for
-00016e30: 6d61 7428 6c65 6e28 696e 6465 7829 2c20  mat(len(index), 
-00016e40: 6461 7461 5f78 2e73 6861 7065 5b31 5d29  data_x.shape[1])
-00016e50: 290a 2020 2020 6578 6365 7074 3a0a 2020  ).    except:.  
-00016e60: 2020 2020 2020 7072 696e 7428 2742 6f72        print('Bor
-00016e70: 7574 6120 7769 7468 2053 6861 706c 6579  uta with Shapley
-00016e80: 2076 616c 7565 7320 6661 696c 6564 2c20   values failed, 
-00016e90: 7377 6974 6368 696e 6720 746f 206f 7269  switching to ori
-00016ea0: 6769 6e61 6c20 426f 7275 7461 2e2e 2e27  ginal Boruta...'
-00016eb0: 290a 2020 2020 2020 2020 696e 6465 7820  ).        index 
-00016ec0: 3d20 626f 7275 7461 5f6f 7074 2864 6174  = boruta_opt(dat
-00016ed0: 615f 782c 2064 6174 615f 7929 0a0a 2020  a_x, data_y)..  
-00016ee0: 2020 7265 7475 726e 2069 6e64 6578 2c20    return index, 
-00016ef0: 6665 6174 5f73 656c 6563 746f 720a 0a64  feat_selector..d
-00016f00: 6566 2062 6f72 7574 615f 6f70 7428 6461  ef boruta_opt(da
-00016f10: 7461 5f78 2c20 6461 7461 5f79 293a 0a20  ta_x, data_y):. 
-00016f20: 2020 2022 2222 0a20 2020 2041 7070 6c69     """.    Appli
-00016f30: 6573 2074 6865 2042 6f72 7574 6120 616c  es the Boruta al
-00016f40: 676f 7269 7468 6d20 284b 7572 7361 2026  gorithm (Kursa &
-00016f50: 2052 7564 6e69 636b 6920 3230 3131 2920   Rudnicki 2011) 
-00016f60: 746f 2069 6465 6e74 6966 7920 6665 6174  to identify feat
-00016f70: 7572 6573 0a20 2020 2074 6861 7420 7065  ures.    that pe
-00016f80: 7266 6f72 6d20 776f 7273 6520 7468 616e  rform worse than
-00016f90: 2072 616e 646f 6d2e 0a0a 2020 2020 5365   random...    Se
-00016fa0: 653a 2068 7474 7073 3a2f 2f61 7278 6976  e: https://arxiv
-00016fb0: 2e6f 7267 2f70 6466 2f31 3130 362e 3531  .org/pdf/1106.51
-00016fc0: 3132 2e70 6466 0a0a 2020 2020 4172 6773  12.pdf..    Args
-00016fd0: 3a0a 2020 2020 2020 2020 6461 7461 5f78  :.        data_x
-00016fe0: 2028 6e64 6172 7261 7929 3a20 3244 2061   (ndarray): 2D a
-00016ff0: 7272 6179 206f 6620 7369 7a65 2028 6e20  rray of size (n 
-00017000: 7820 6d29 2c20 7768 6572 6520 6e20 6973  x m), where n is
-00017010: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00017020: 206e 756d 6265 7220 6f66 2073 616d 706c   number of sampl
-00017030: 6573 2c20 616e 6420 6d20 7468 6520 6e75  es, and m the nu
-00017040: 6d62 6572 206f 6620 6665 6174 7572 6573  mber of features
-00017050: 2e0a 2020 2020 2020 2020 6461 7461 5f79  ..        data_y
-00017060: 2028 6e64 6172 7261 792c 2073 7472 293a   (ndarray, str):
-00017070: 2031 4420 6172 7261 7920 636f 6e74 6169   1D array contai
-00017080: 6e69 6e67 2074 6865 2063 6f72 7265 7370  ning the corresp
-00017090: 6f6e 696e 6720 6c61 6265 6c73 2e0a 2020  oning labels..  
-000170a0: 2020 2020 2020 2020 2020 0a20 2020 2052            .    R
-000170b0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-000170c0: 3144 2061 7272 6179 2063 6f6e 7461 696e  1D array contain
-000170d0: 696e 6720 7468 6520 696e 6469 6365 7320  ing the indices 
-000170e0: 6f66 2074 6865 2073 656c 6563 7465 6420  of the selected 
-000170f0: 6665 6174 7572 6573 2e20 5468 6973 2063  features. This c
-00017100: 616e 2074 6865 6e0a 2020 2020 2020 2020  an then.        
-00017110: 6265 2075 7365 6420 746f 2069 6e64 6578  be used to index
-00017120: 2074 6865 2063 6f6c 756d 6e73 2069 6e20   the columns in 
-00017130: 7468 6520 6461 7461 5f78 2061 7272 6179  the data_x array
-00017140: 2e0a 2020 2020 2222 220a 0a20 2020 2063  ..    """..    c
-00017150: 6c61 7373 6966 6965 7220 3d20 5261 6e64  lassifier = Rand
-00017160: 6f6d 466f 7265 7374 436c 6173 7369 6669  omForestClassifi
-00017170: 6572 2872 616e 646f 6d5f 7374 6174 653d  er(random_state=
-00017180: 3139 3039 290a 0a20 2020 2066 6561 745f  1909)..    feat_
-00017190: 7365 6c65 6374 6f72 203d 2042 6f72 7574  selector = Borut
-000171a0: 6150 7928 636c 6173 7369 6669 6572 2c20  aPy(classifier, 
-000171b0: 6e5f 6573 7469 6d61 746f 7273 3d27 6175  n_estimators='au
-000171c0: 746f 272c 2072 616e 646f 6d5f 7374 6174  to', random_stat
-000171d0: 653d 3139 3039 290a 2020 2020 7072 696e  e=1909).    prin
-000171e0: 7428 2752 756e 6e69 6e67 2066 6561 7475  t('Running featu
-000171f0: 7265 2073 656c 6563 7469 6f6e 2e2e 2e27  re selection...'
-00017200: 290a 2020 2020 6665 6174 5f73 656c 6563  ).    feat_selec
-00017210: 746f 722e 6669 7428 6461 7461 5f78 2c20  tor.fit(data_x, 
-00017220: 6461 7461 5f79 290a 0a20 2020 2066 6561  data_y)..    fea
-00017230: 7473 203d 206e 702e 6172 7261 7928 5b73  ts = np.array([s
-00017240: 7472 2866 6561 7429 2066 6f72 2066 6561  tr(feat) for fea
-00017250: 7420 696e 2066 6561 745f 7365 6c65 6374  t in feat_select
-00017260: 6f72 2e73 7570 706f 7274 5f5d 290a 2020  or.support_]).  
-00017270: 2020 696e 6465 7820 3d20 6e70 2e77 6865    index = np.whe
-00017280: 7265 2866 6561 7473 203d 3d20 2754 7275  re(feats == 'Tru
-00017290: 6527 295b 305d 0a20 2020 2070 7269 6e74  e')[0].    print
-000172a0: 2827 4665 6174 7572 6520 7365 6c65 6374  ('Feature select
-000172b0: 696f 6e20 636f 6d70 6c65 7465 2c20 7b7d  ion complete, {}
-000172c0: 2073 656c 6563 7465 6420 6f75 7420 6f66   selected out of
-000172d0: 207b 7d21 272e 666f 726d 6174 286c 656e   {}!'.format(len
-000172e0: 2869 6e64 6578 292c 6c65 6e28 6665 6174  (index),len(feat
-000172f0: 5f73 656c 6563 746f 722e 7375 7070 6f72  _selector.suppor
-00017300: 7429 2929 0a20 2020 2072 6574 7572 6e20  t))).    return 
-00017310: 696e 6465 780a 0a64 6566 2053 7472 6177  index..def Straw
-00017320: 6d61 6e5f 696d 7075 7461 7469 6f6e 2864  man_imputation(d
-00017330: 6174 6129 3a0a 2020 2020 2222 220a 2020  ata):.    """.  
-00017340: 2020 5065 7266 6f72 6d20 5374 7261 776d    Perform Strawm
-00017350: 616e 2069 6d70 7574 6174 696f 6e2c 2061  an imputation, a
-00017360: 2074 696d 652d 6566 6669 6369 656e 7420   time-efficient 
-00017370: 616c 676f 7269 7468 6d0a 2020 2020 696e  algorithm.    in
-00017380: 2077 6869 6368 206d 6973 7369 6e67 2064   which missing d
-00017390: 6174 6120 7661 6c75 6573 2061 7265 2072  ata values are r
-000173a0: 6570 6c61 6365 6420 7769 7468 2074 6865  eplaced with the
-000173b0: 206d 6564 6961 6e0a 2020 2020 7661 6c75   median.    valu
-000173c0: 6520 6f66 2074 6865 2065 6e74 6972 652c  e of the entire,
-000173d0: 206e 6f6e 2d4e 614e 2073 616d 706c 652e   non-NaN sample.
-000173e0: 2049 6620 7468 6520 6461 7461 2069 7320   If the data is 
-000173f0: 6120 686f 742d 656e 636f 6465 640a 2020  a hot-encoded.  
-00017400: 2020 626f 6f6c 6561 6e20 2861 7320 7468    boolean (as th
-00017410: 6520 5246 2064 6f65 7320 6e6f 7420 616c  e RF does not al
-00017420: 6c6f 7720 5472 7565 206f 7220 4661 6c73  low True or Fals
-00017430: 6529 2c20 7468 656e 2074 6865 200a 2020  e), then the .  
-00017440: 2020 696e 7374 616e 6365 2074 6861 7420    instance that 
-00017450: 6973 2075 7365 6420 7468 6520 6d6f 7374  is used the most
-00017460: 2077 696c 6c20 6265 2063 6f6d 7075 7465   will be compute
-00017470: 6420 6173 2074 6865 206d 6564 6961 6e2e  d as the median.
-00017480: 200a 0a20 2020 2054 6869 7320 6973 2074   ..    This is t
-00017490: 6865 2062 6173 656c 696e 6520 616c 676f  he baseline algo
-000174a0: 7269 7468 6d20 7573 6564 2062 7920 2854  rithm used by (T
-000174b0: 616e 6720 2620 4973 6877 6172 616e 2032  ang & Ishwaran 2
-000174c0: 3031 3729 2e0a 2020 2020 5365 653a 2068  017)..    See: h
-000174d0: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
-000174e0: 2f70 6466 2f31 3730 312e 3035 3330 352e  /pdf/1701.05305.
-000174f0: 7064 660a 0a20 2020 204e 6f74 653a 0a20  pdf..    Note:. 
-00017500: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
-00017510: 7469 6f6e 2061 7373 756d 6573 2065 6163  tion assumes eac
-00017520: 6820 726f 7720 636f 7272 6573 706f 6e64  h row correspond
-00017530: 7320 746f 206f 6e65 2073 616d 706c 652c  s to one sample,
-00017540: 2061 6e64 200a 2020 2020 2020 2020 7468   and .        th
-00017550: 6174 206d 6973 7369 6e67 2076 616c 7565  at missing value
-00017560: 7320 6172 6520 6d61 736b 6564 2061 7320  s are masked as 
-00017570: 6569 7468 6572 204e 614e 206f 7220 696e  either NaN or in
-00017580: 662e 200a 0a20 2020 2041 7267 733a 0a20  f. ..    Args:. 
-00017590: 2020 2020 2020 2064 6174 6120 286e 6461         data (nda
-000175a0: 7272 6179 293a 2031 4420 6172 7261 7920  rray): 1D array 
-000175b0: 6966 2073 696e 676c 6520 7061 7261 6d65  if single parame
-000175c0: 7465 7220 6973 2069 6e70 7574 2e20 4966  ter is input. If
-000175d0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-000175e0: 6120 6973 2032 2d64 696d 656e 7369 6f6e  a is 2-dimension
-000175f0: 616c 2c20 7468 6520 6d65 6469 616e 7320  al, the medians 
-00017600: 7769 6c6c 2062 6520 6361 6c63 756c 6174  will be calculat
-00017610: 6564 0a20 2020 2020 2020 2020 2020 2075  ed.            u
-00017620: 7369 6e67 2074 6865 206e 6f6e 2d6d 6973  sing the non-mis
-00017630: 7369 6e67 2076 616c 7565 7320 696e 2065  sing values in e
-00017640: 6163 6820 636f 7272 6573 706f 6e64 696e  ach correspondin
-00017650: 6720 636f 6c75 6d6e 2e0a 0a20 2020 2052  g column...    R
-00017660: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00017670: 5468 6520 6461 7461 2061 7272 6179 2077  The data array w
-00017680: 6974 6820 7468 6520 6d69 7373 696e 6720  ith the missing 
-00017690: 7661 6c75 6573 2066 696c 6c65 6420 696e  values filled in
-000176a0: 2e20 0a20 2020 2022 2222 0a0a 2020 2020  . .    """..    
-000176b0: 6966 206e 702e 616c 6c28 6e70 2e69 7366  if np.all(np.isf
-000176c0: 696e 6974 6528 6461 7461 2929 3a0a 2020  inite(data)):.  
-000176d0: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
-000176e0: 6d69 7373 696e 6720 7661 6c75 6573 2069  missing values i
-000176f0: 6e20 6461 7461 2c20 7265 7475 726e 696e  n data, returnin
-00017700: 6720 6f72 6967 696e 616c 2061 7272 6179  g original array
-00017710: 2e27 290a 2020 2020 2020 2020 7265 7475  .').        retu
-00017720: 726e 2064 6174 6120 0a0a 2020 2020 6966  rn data ..    if
-00017730: 206c 656e 2864 6174 612e 7368 6170 6529   len(data.shape)
-00017740: 203d 3d20 313a 0a20 2020 2020 2020 206d   == 1:.        m
-00017750: 6173 6b20 3d20 6e70 2e77 6865 7265 286e  ask = np.where(n
-00017760: 702e 6973 6669 6e69 7465 2864 6174 6129  p.isfinite(data)
-00017770: 295b 305d 0a20 2020 2020 2020 206d 6564  )[0].        med
-00017780: 6961 6e20 3d20 6e70 2e6d 6564 6961 6e28  ian = np.median(
-00017790: 6461 7461 5b6d 6173 6b5d 290a 2020 2020  data[mask]).    
-000177a0: 2020 2020 6461 7461 5b6e 702e 6973 6e61      data[np.isna
-000177b0: 6e28 6461 7461 295d 203d 206d 6564 6961  n(data)] = media
-000177c0: 6e20 0a0a 2020 2020 2020 2020 7265 7475  n ..        retu
-000177d0: 726e 2064 6174 610a 0a20 2020 204e 792c  rn data..    Ny,
-000177e0: 204e 7820 3d20 6461 7461 2e73 6861 7065   Nx = data.shape
-000177f0: 0a20 2020 2069 6d70 7574 6564 5f64 6174  .    imputed_dat
-00017800: 6120 3d20 6e70 2e7a 6572 6f73 2828 4e79  a = np.zeros((Ny
-00017810: 2c4e 7829 290a 0a20 2020 2066 6f72 2069  ,Nx))..    for i
-00017820: 2069 6e20 7261 6e67 6528 4e78 293a 0a20   in range(Nx):. 
-00017830: 2020 2020 2020 206d 6173 6b20 3d20 6e70         mask = np
-00017840: 2e77 6865 7265 286e 702e 6973 6669 6e69  .where(np.isfini
-00017850: 7465 2864 6174 615b 3a2c 695d 2929 5b30  te(data[:,i]))[0
-00017860: 5d0a 2020 2020 2020 2020 6d65 6469 616e  ].        median
-00017870: 203d 206e 702e 6d65 6469 616e 2864 6174   = np.median(dat
-00017880: 615b 3a2c 695d 5b6d 6173 6b5d 290a 0a20  a[:,i][mask]).. 
-00017890: 2020 2020 2020 2066 6f72 206a 2069 6e20         for j in 
-000178a0: 7261 6e67 6528 4e79 293a 0a20 2020 2020  range(Ny):.     
-000178b0: 2020 2020 2020 2069 6620 6e70 2e69 736e         if np.isn
-000178c0: 616e 2864 6174 615b 6a2c 695d 2920 3d3d  an(data[j,i]) ==
-000178d0: 2054 7275 6520 6f72 206e 702e 6973 696e   True or np.isin
-000178e0: 6628 6461 7461 5b6a 2c69 5d29 203d 3d20  f(data[j,i]) == 
-000178f0: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
-00017900: 2020 2020 2020 696d 7075 7465 645f 6461        imputed_da
-00017910: 7461 5b6a 2c69 5d20 3d20 6d65 6469 616e  ta[j,i] = median
-00017920: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00017930: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00017940: 2020 2069 6d70 7574 6564 5f64 6174 615b     imputed_data[
-00017950: 6a2c 695d 203d 2064 6174 615b 6a2c 695d  j,i] = data[j,i]
-00017960: 0a0a 2020 2020 7265 7475 726e 2069 6d70  ..    return imp
-00017970: 7574 6564 5f64 6174 6120 0a0a 6465 6620  uted_data ..def 
-00017980: 4b4e 4e5f 696d 7075 7461 7469 6f6e 2864  KNN_imputation(d
-00017990: 6174 612c 2069 6d70 7574 6572 3d4e 6f6e  ata, imputer=Non
-000179a0: 652c 206b 3d33 293a 0a20 2020 2022 2222  e, k=3):.    """
-000179b0: 0a20 2020 2050 6572 666f 726d 7320 6b2d  .    Performs k-
-000179c0: 4e65 6172 6573 7420 4e65 6967 6862 6f72  Nearest Neighbor
-000179d0: 2069 6d70 7574 6174 696f 6e20 616e 6420   imputation and 
-000179e0: 7472 616e 7366 6f72 6d61 7469 6f6e 2e0a  transformation..
-000179f0: 2020 2020 4279 2064 6566 6175 6c74 2074      By default t
-00017a00: 6865 2069 6d70 7574 6572 2077 696c 6c20  he imputer will 
-00017a10: 6265 2063 7265 6174 6564 2061 6e64 2072  be created and r
-00017a20: 6574 7572 6e65 642c 2075 6e6c 6573 730a  eturned, unless.
-00017a30: 2020 2020 7468 6520 696d 7075 7465 7220      the imputer 
-00017a40: 6172 6775 6d65 6e74 2069 7320 7365 742c  argument is set,
-00017a50: 2069 6e20 7768 6963 6820 6361 7365 206f   in which case o
-00017a60: 6e6c 7920 7468 6520 7472 616e 7366 6f72  nly the transfor
-00017a70: 6d65 640a 2020 2020 6461 7461 2069 7320  med.    data is 
-00017a80: 6f75 7470 7574 2e20 0a0a 2020 2020 4173  output. ..    As
-00017a90: 2074 6869 7320 6275 6e64 6c65 7320 6e65   this bundles ne
-00017aa0: 6967 6862 6f72 7320 6163 636f 7264 696e  ighbors accordin
-00017ab0: 6720 746f 2074 6865 6972 2065 7563 6c65  g to their eucle
-00017ac0: 6469 616e 2064 6973 7461 6e63 652c 0a20  dian distance,. 
-00017ad0: 2020 2069 7420 6973 2073 656e 7369 7469     it is sensiti
-00017ae0: 7665 2074 6f20 6f75 746c 6965 7273 2e20  ve to outliers. 
-00017af0: 4361 6e20 616c 736f 2079 6965 6c64 2077  Can also yield w
-00017b00: 6561 6b20 7072 6564 6963 7469 6f6e 7320  eak predictions 
-00017b10: 6966 2074 6865 0a20 2020 2074 7261 696e  if the.    train
-00017b20: 696e 6720 6665 6174 7572 6573 2061 7265  ing features are
-00017b30: 2068 6561 7669 6c69 7920 636f 7272 656c   heaviliy correl
-00017b40: 6174 6564 2e0a 2020 2020 0a20 2020 2041  ated..    .    A
-00017b50: 7267 733a 0a20 2020 2020 2020 2069 6d70  rgs:.        imp
-00017b60: 7574 6572 2028 6f70 7469 6f6e 616c 293a  uter (optional):
-00017b70: 2041 204b 4e4e 496d 7075 7465 7220 636c   A KNNImputer cl
-00017b80: 6173 7320 696e 7374 616e 6365 2c20 636f  ass instance, co
-00017b90: 6e66 6967 7572 6564 2075 7369 6e67 2073  nfigured using s
-00017ba0: 6b6c 6561 726e 2e69 6d70 7574 652e 4b4e  klearn.impute.KN
-00017bb0: 4e49 6d70 7574 6572 2e0a 2020 2020 2020  NImputer..      
-00017bc0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-00017bd0: 6f20 4e6f 6e65 2c20 696e 2077 6869 6368  o None, in which
-00017be0: 2063 6173 6520 7468 6520 7472 616e 7366   case the transf
-00017bf0: 6f72 6d61 7469 6f6e 2069 7320 6372 6561  ormation is crea
-00017c00: 7465 6420 7573 696e 670a 2020 2020 2020  ted using.      
-00017c10: 2020 2020 2020 7468 6520 6461 7461 2069        the data i
-00017c20: 7473 656c 662e 200a 2020 2020 2020 2020  tself. .        
-00017c30: 6461 7461 2028 6e64 6172 7261 7929 3a20  data (ndarray): 
-00017c40: 3144 2061 7272 6179 2069 6620 7369 6e67  1D array if sing
-00017c50: 6c65 2070 6172 616d 6574 6572 2069 7320  le parameter is 
-00017c60: 696e 7075 742e 2049 660a 2020 2020 2020  input. If.      
-00017c70: 2020 2020 2020 6461 7461 2069 7320 322d        data is 2-
-00017c80: 6469 6d65 6e73 696f 6e61 6c2c 2074 6865  dimensional, the
-00017c90: 206d 6564 6961 6e73 2077 696c 6c20 6265   medians will be
-00017ca0: 2063 616c 6375 6c61 7465 640a 2020 2020   calculated.    
-00017cb0: 2020 2020 2020 2020 7573 696e 6720 7468          using th
-00017cc0: 6520 6e6f 6e2d 6d69 7373 696e 6720 7661  e non-missing va
-00017cd0: 6c75 6573 2069 6e20 6561 6368 2063 6f72  lues in each cor
-00017ce0: 7265 7370 6f6e 6469 6e67 2063 6f6c 756d  responding colum
-00017cf0: 6e2e 0a20 2020 2020 2020 206b 2028 696e  n..        k (in
-00017d00: 742c 206f 7074 696f 6e61 6c29 3a20 4966  t, optional): If
-00017d10: 2069 6d70 7574 6572 2069 7320 4e6f 6e65   imputer is None
-00017d20: 2c20 7468 6973 2069 7320 7468 6520 6e75  , this is the nu
-00017d30: 6d62 6572 0a20 2020 2020 2020 2020 2020  mber.           
-00017d40: 206f 6620 6e65 6172 6573 7420 6e65 6967   of nearest neig
-00017d50: 6862 6f72 7320 746f 2063 6f6e 7369 6465  hbors to conside
-00017d60: 7220 7768 656e 2063 6f6d 7075 7469 6e67  r when computing
-00017d70: 2074 6865 2069 6d70 7574 6174 696f 6e2e   the imputation.
-00017d80: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
-00017d90: 6175 6c74 7320 746f 2033 2e20 4966 2069  aults to 3. If i
-00017da0: 6d70 7574 6572 2061 7267 756d 656e 7420  mputer argument 
-00017db0: 6973 2073 6574 2c20 7468 6973 2076 6172  is set, this var
-00017dc0: 6961 626c 6520 6973 2069 676e 6f72 6564  iable is ignored
-00017dd0: 2e0a 0a20 2020 204e 6f74 653a 0a20 2020  ...    Note:.   
-00017de0: 2020 2020 2054 616e 6720 2620 4973 6877       Tang & Ishw
-00017df0: 6172 616e 2032 3031 3720 7265 706f 7274  aran 2017 report
-00017e00: 6564 2074 6861 7420 6966 2074 6865 7265  ed that if there
-00017e10: 2069 7320 6c6f 7720 746f 206d 6564 6975   is low to mediu
-00017e20: 6d0a 2020 2020 2020 2020 636f 7272 656c  m.        correl
-00017e30: 6174 696f 6e20 696e 2074 6865 2064 6174  ation in the dat
-00017e40: 6173 6574 2c20 5246 2069 6d70 7574 6174  aset, RF imputat
-00017e50: 696f 6e20 616c 676f 7269 7468 6d73 2070  ion algorithms p
-00017e60: 6572 666f 726d 200a 2020 2020 2020 2020  erform .        
-00017e70: 6265 7474 6572 2074 6861 6e20 4b4e 4e20  better than KNN 
-00017e80: 696d 7075 7461 7469 6f6e 0a0a 2020 2020  imputation..    
-00017e90: 4578 616d 706c 653a 0a20 2020 2020 2020  Example:.       
-00017ea0: 2049 6620 7765 2068 6176 6520 6f75 7220   If we have our 
-00017eb0: 7472 6169 6e69 6e67 2064 6174 6120 696e  training data in
-00017ec0: 2061 6e20 6172 7261 7920 6361 6c6c 6564   an array called
-00017ed0: 2074 7261 696e 696e 675f 7365 742c 2077   training_set, w
-00017ee0: 6520 0a20 2020 2020 2020 2063 616e 2063  e .        can c
-00017ef0: 7265 6174 6520 7468 6520 696d 7075 7465  reate the impute
-00017f00: 7220 736f 2074 6861 7420 7765 2063 616e  r so that we can
-00017f10: 2063 616c 6c20 6974 2074 6f20 7472 616e   call it to tran
-00017f20: 7366 6f72 6d20 6e65 7720 6461 7461 0a20  sform new data. 
-00017f30: 2020 2020 2020 2077 6865 6e20 6d61 6b69         when maki
-00017f40: 6e67 206f 6e2d 7468 652d 6669 656c 6420  ng on-the-field 
-00017f50: 7072 6564 6963 7469 6f6e 732e 0a0a 2020  predictions...  
-00017f60: 2020 2020 2020 3e3e 3e20 696d 7075 7465        >>> impute
-00017f70: 645f 6461 7461 2c20 6b6e 6e5f 696d 7075  d_data, knn_impu
-00017f80: 7465 7220 3d20 4b4e 4e5f 696d 7075 7461  ter = KNN_imputa
-00017f90: 7469 6f6e 2864 6174 613d 7472 6169 6e69  tion(data=traini
-00017fa0: 6e67 5f73 6574 2c20 696d 7075 7465 723d  ng_set, imputer=
-00017fb0: 4e6f 6e65 290a 2020 2020 2020 2020 0a20  None).        . 
-00017fc0: 2020 2020 2020 204e 6f77 2077 6520 6361         Now we ca
-00017fd0: 6e20 7573 6520 7468 6520 696d 7075 7465  n use the impute
-00017fe0: 6420 6461 7461 2074 6f20 6372 6561 7465  d data to create
-00017ff0: 206f 7572 206d 6163 6869 6e65 206c 6561   our machine lea
-00018000: 726e 696e 6720 6d6f 6465 6c2e 0a20 2020  rning model..   
-00018010: 2020 2020 2041 6674 6572 7761 7264 732c       Afterwards,
-00018020: 2077 6865 6e20 6e65 7720 6461 7461 2069   when new data i
-00018030: 7320 696e 7075 7420 666f 7220 7072 6564  s input for pred
-00018040: 6963 7469 6f6e 2c20 7765 2077 696c 6c20  iction, we will 
-00018050: 696e 7365 7274 206f 7572 200a 2020 2020  insert our .    
-00018060: 2020 2020 696d 7075 7465 7220 696e 746f      imputer into
-00018070: 2074 6865 2070 6970 656c 696e 656e 2062   the pipelinen b
-00018080: 7920 6361 6c6c 696e 6720 7468 6973 2066  y calling this f
-00018090: 756e 6374 696f 6e20 6167 6169 6e2c 2062  unction again, b
-000180a0: 7574 2074 6869 7320 7469 6d65 0a20 2020  ut this time.   
-000180b0: 2020 2020 2077 6974 6820 7468 6520 696d       with the im
-000180c0: 7075 7465 7220 6172 6775 6d65 6e74 2073  puter argument s
-000180d0: 6574 3a0a 0a20 2020 2020 2020 203e 3e3e  et:..        >>>
-000180e0: 206e 6577 5f64 6174 6120 3d20 6b6e 6e5f   new_data = knn_
-000180f0: 696d 7075 7461 7469 6f6e 286e 6577 5f64  imputation(new_d
-00018100: 6174 612c 2069 6d70 7574 6572 3d6b 6e6e  ata, imputer=knn
-00018110: 5f69 6d70 7574 6572 290a 0a20 2020 2052  _imputer)..    R
-00018120: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00018130: 5468 6520 6669 7273 7420 6f75 7470 7574  The first output
-00018140: 2069 7320 7468 6520 6461 7461 2061 7272   is the data arr
-00018150: 6179 2077 6974 6820 7769 7468 2074 6865  ay with with the
-00018160: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
-00018170: 6669 6c6c 6564 2069 6e2e 200a 2020 2020  filled in. .    
-00018180: 2020 2020 5468 6520 7365 636f 6e64 206f      The second o
-00018190: 7574 7075 7420 6973 2074 6865 204b 4e4e  utput is the KNN
-000181a0: 2049 6d70 7574 6572 2074 6861 7420 7368   Imputer that sh
-000181b0: 6f75 6c64 2062 6520 7573 6564 2074 6f20  ould be used to 
-000181c0: 7472 616e 7366 6f72 6d0a 2020 2020 2020  transform.      
-000181d0: 2020 6e65 7720 6461 7461 2c20 7072 696f    new data, prio
-000181e0: 7220 746f 2070 7265 6469 6374 696f 6e73  r to predictions
-000181f0: 2e20 0a20 2020 2022 2222 0a0a 2020 2020  . .    """..    
-00018200: 6966 2069 6d70 7574 6572 2069 7320 4e6f  if imputer is No
-00018210: 6e65 3a0a 2020 2020 2020 2020 696d 7075  ne:.        impu
-00018220: 7465 7220 3d20 4b4e 4e49 6d70 7574 6572  ter = KNNImputer
-00018230: 286e 5f6e 6569 6768 626f 7273 3d6b 290a  (n_neighbors=k).
-00018240: 2020 2020 2020 2020 696d 7075 7465 722e          imputer.
-00018250: 6669 7428 6461 7461 290a 2020 2020 2020  fit(data).      
-00018260: 2020 696d 7075 7465 645f 6461 7461 203d    imputed_data =
-00018270: 2069 6d70 7574 6572 2e74 7261 6e73 666f   imputer.transfo
-00018280: 726d 2864 6174 6129 0a20 2020 2020 2020  rm(data).       
-00018290: 2072 6574 7572 6e20 696d 7075 7465 645f   return imputed_
-000182a0: 6461 7461 2c20 696d 7075 7465 720a 0a20  data, imputer.. 
-000182b0: 2020 2072 6574 7572 6e20 696d 7075 7465     return impute
-000182c0: 722e 7472 616e 7366 6f72 6d28 6461 7461  r.transform(data
-000182d0: 2920 0a0a 0a                             ) ...
+00009f80: 2062 6c6f 636b 5f66 696c 7465 7273 5f34   block_filters_4
+00009f90: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00009fa0: 5f69 6e74 2827 626c 6f63 6b5f 6669 6c74  _int('block_filt
+00009fb0: 6572 735f 3427 2c20 3132 2c20 3531 362c  ers_4', 12, 516,
+00009fc0: 2073 7465 703d 3132 290a 2020 2020 2020   step=12).      
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 626c                bl
+00009fe0: 6f63 6b5f 6669 6c74 6572 735f 7369 7a65  ock_filters_size
+00009ff0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000a000: 5f69 6e74 2827 626c 6f63 6b5f 6669 6c74  _int('block_filt
+0000a010: 6572 735f 7369 7a65 272c 2031 2c20 372c  ers_size', 1, 7,
+0000a020: 2073 7465 703d 3229 0a0a 2020 2020 2020   step=2)..      
+0000a030: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0000a040: 6465 6c2c 2068 6973 746f 7279 203d 2063  del, history = c
+0000a050: 6e6e 5f6d 6f64 656c 2e52 6573 6e65 7431  nn_model.Resnet1
+0000a060: 3828 636c 6173 735f 312c 2063 6c61 7373  8(class_1, class
+0000a070: 5f32 2c20 696d 675f 6e75 6d5f 6368 616e  _2, img_num_chan
+0000a080: 6e65 6c73 3d73 656c 662e 696d 675f 6e75  nels=self.img_nu
+0000a090: 6d5f 6368 616e 6e65 6c73 2c20 0a20 2020  m_channels, .   
+0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0b0: 2020 2020 206e 6f72 6d61 6c69 7a65 3d73       normalize=s
+0000a0c0: 656c 662e 6e6f 726d 616c 697a 652c 206d  elf.normalize, m
+0000a0d0: 696e 5f70 6978 656c 3d6d 696e 5f70 6978  in_pixel=min_pix
+0000a0e0: 2c20 6d61 785f 7069 7865 6c3d 6d61 785f  , max_pixel=max_
+0000a0f0: 7069 782c 2076 616c 5f70 6f73 6974 6976  pix, val_positiv
+0000a100: 653d 7661 6c5f 636c 6173 735f 312c 2076  e=val_class_1, v
+0000a110: 616c 5f6e 6567 6174 6976 653d 7661 6c5f  al_negative=val_
+0000a120: 636c 6173 735f 322c 200a 2020 2020 2020  class_2, .      
+0000a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a140: 2020 6570 6f63 6873 3d73 656c 662e 7472    epochs=self.tr
+0000a150: 6169 6e5f 6570 6f63 6873 2c20 6261 7463  ain_epochs, batc
+0000a160: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
+0000a170: 652c 206f 7074 696d 697a 6572 3d6f 7074  e, optimizer=opt
+0000a180: 696d 697a 6572 2c20 6c72 3d6c 722c 2064  imizer, lr=lr, d
+0000a190: 6563 6179 3d64 6563 6179 2c20 6d6f 6d65  ecay=decay, mome
+0000a1a0: 6e74 756d 3d6d 6f6d 656e 7475 6d2c 206e  ntum=momentum, n
+0000a1b0: 6573 7465 726f 763d 6e65 7374 6572 6f76  esterov=nesterov
+0000a1c0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000a1d0: 2020 2020 2020 2020 2020 2062 6574 615f             beta_
+0000a1e0: 313d 6265 7461 5f31 2c20 6265 7461 5f32  1=beta_1, beta_2
+0000a1f0: 3d62 6574 615f 322c 2061 6d73 6772 6164  =beta_2, amsgrad
+0000a200: 3d61 6d73 6772 6164 2c20 6c6f 7373 3d6c  =amsgrad, loss=l
+0000a210: 6f73 732c 2061 6374 6976 6174 696f 6e5f  oss, activation_
+0000a220: 636f 6e76 3d61 6374 6976 6174 696f 6e5f  conv=activation_
+0000a230: 636f 6e76 2c20 6163 7469 7661 7469 6f6e  conv, activation
+0000a240: 5f64 656e 7365 3d61 6374 6976 6174 696f  _dense=activatio
+0000a250: 6e5f 6465 6e73 652c 200a 2020 2020 2020  n_dense, .      
+0000a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a270: 2020 636f 6e76 5f69 6e69 743d 636f 6e76    conv_init=conv
+0000a280: 5f69 6e69 742c 2064 656e 7365 5f69 6e69  _init, dense_ini
+0000a290: 743d 6465 6e73 655f 696e 6974 2c20 6d6f  t=dense_init, mo
+0000a2a0: 6465 6c5f 7265 673d 6d6f 6465 6c5f 7265  del_reg=model_re
+0000a2b0: 672c 2066 696c 7465 7273 3d66 696c 7465  g, filters=filte
+0000a2c0: 7273 2c20 6669 6c74 6572 5f73 697a 653d  rs, filter_size=
+0000a2d0: 6669 6c74 6572 5f73 697a 652c 2073 7472  filter_size, str
+0000a2e0: 6964 6573 3d73 7472 6964 6573 2c20 200a  ides=strides,  .
+0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a300: 2020 2020 2020 2020 706f 6f6c 696e 673d          pooling=
+0000a310: 706f 6f6c 696e 672c 2070 6f6f 6c5f 7369  pooling, pool_si
+0000a320: 7a65 3d70 6f6f 6c5f 7369 7a65 2c20 706f  ze=pool_size, po
+0000a330: 6f6c 5f73 7472 6964 653d 706f 6f6c 5f73  ol_stride=pool_s
+0000a340: 7472 6964 652c 2062 6c6f 636b 5f66 696c  tride, block_fil
+0000a350: 7465 7273 5f31 3d62 6c6f 636b 5f66 696c  ters_1=block_fil
+0000a360: 7465 7273 5f31 2c20 626c 6f63 6b5f 6669  ters_1, block_fi
+0000a370: 6c74 6572 735f 323d 626c 6f63 6b5f 6669  lters_2=block_fi
+0000a380: 6c74 6572 735f 322c 200a 2020 2020 2020  lters_2, .      
+0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3a0: 2020 626c 6f63 6b5f 6669 6c74 6572 735f    block_filters_
+0000a3b0: 333d 626c 6f63 6b5f 6669 6c74 6572 735f  3=block_filters_
+0000a3c0: 332c 2062 6c6f 636b 5f66 696c 7465 7273  3, block_filters
+0000a3d0: 5f34 3d62 6c6f 636b 5f66 696c 7465 7273  _4=block_filters
+0000a3e0: 5f34 2c20 626c 6f63 6b5f 6669 6c74 6572  _4, block_filter
+0000a3f0: 735f 7369 7a65 3d62 6c6f 636b 5f66 696c  s_size=block_fil
+0000a400: 7465 7273 5f73 697a 652c 200a 2020 2020  ters_size, .    
+0000a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a420: 2020 2020 736d 6f74 655f 7361 6d70 6c69      smote_sampli
+0000a430: 6e67 3d73 656c 662e 736d 6f74 655f 7361  ng=self.smote_sa
+0000a440: 6d70 6c69 6e67 2c20 6561 726c 795f 7374  mpling, early_st
+0000a450: 6f70 5f63 616c 6c62 6163 6b3d 6361 6c6c  op_callback=call
+0000a460: 6261 636b 732c 2063 6865 636b 706f 696e  backs, checkpoin
+0000a470: 743d 4661 6c73 652c 2076 6572 626f 7365  t=False, verbose
+0000a480: 3d73 656c 662e 7665 7262 6f73 6529 0a0a  =self.verbose)..
+0000a490: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000a4a0: 2073 656c 662e 636c 6620 3d3d 2027 6375   self.clf == 'cu
+0000a4b0: 7374 6f6d 5f63 6e6e 273a 0a20 2020 2020  stom_cnn':.     
+0000a4c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000a4d0: 6c66 2e6c 696d 6974 5f73 6561 7263 683a  lf.limit_search:
+0000a4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a4f0: 2020 2020 2070 7269 6e74 2827 5468 6572       print('Ther
+0000a500: 6520 6973 206e 6f20 6c69 6d69 745f 7365  e is no limit_se
+0000a510: 6172 6368 206f 7074 696f 6e20 6966 2063  arch option if c
+0000a520: 6c66 3d22 6375 7374 6f6d 5f63 6e6e 222c  lf="custom_cnn",
+0000a530: 206f 7074 696d 697a 696e 6720 616c 6c20   optimizing all 
+0000a540: 6c61 7965 7273 2e2e 2e27 290a 0a20 2020  layers...')..   
+0000a550: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000a560: 656c 5f72 6567 203d 2074 7269 616c 2e73  el_reg = trial.s
+0000a570: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
+0000a580: 616c 2827 6d6f 6465 6c5f 7265 6727 2c20  al('model_reg', 
+0000a590: 5b4e 6f6e 652c 2027 6c6f 6361 6c5f 7265  [None, 'local_re
+0000a5a0: 7370 6f6e 7365 272c 2027 6261 7463 685f  sponse', 'batch_
+0000a5b0: 6e6f 726d 275d 290a 2020 2020 2020 2020  norm']).        
+0000a5c0: 2020 2020 2020 2020 2343 7573 746f 6d20          #Custom 
+0000a5d0: 434e 4e20 6675 6e63 7469 6f6e 2c20 7468  CNN function, th
+0000a5e0: 6520 6669 7273 7420 434f 4e56 206c 6179  e first CONV lay
+0000a5f0: 6572 2069 7320 7265 7175 6972 6564 2e20  er is required. 
+0000a600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a610: 2066 696c 7465 725f 3120 3d20 7472 6961   filter_1 = tria
+0000a620: 6c2e 7375 6767 6573 745f 696e 7428 2766  l.suggest_int('f
+0000a630: 696c 7465 725f 3127 2c20 3132 2c20 3531  ilter_1', 12, 51
+0000a640: 362c 2073 7465 703d 3132 290a 2020 2020  6, step=12).    
+0000a650: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+0000a660: 6572 5f73 697a 655f 3120 3d20 7472 6961  er_size_1 = tria
+0000a670: 6c2e 7375 6767 6573 745f 696e 7428 2766  l.suggest_int('f
+0000a680: 696c 7465 725f 7369 7a65 5f31 272c 2031  ilter_size_1', 1
+0000a690: 2c20 3131 2c20 7374 6570 3d32 290a 2020  , 11, step=2).  
+0000a6a0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000a6b0: 6f6c 696e 675f 3120 3d20 7472 6961 6c2e  oling_1 = trial.
+0000a6c0: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
+0000a6d0: 6361 6c28 2770 6f6f 6c69 6e67 5f31 272c  cal('pooling_1',
+0000a6e0: 205b 276d 696e 272c 2027 6d61 7827 2c20   ['min', 'max', 
+0000a6f0: 2761 7665 7261 6765 275d 290a 2020 2020  'average']).    
+0000a700: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+0000a710: 5f73 697a 655f 3120 3d20 7472 6961 6c2e  _size_1 = trial.
+0000a720: 7375 6767 6573 745f 696e 7428 2770 6f6f  suggest_int('poo
+0000a730: 6c5f 7369 7a65 5f31 272c 2031 2c20 372c  l_size_1', 1, 7,
+0000a740: 2073 7465 703d 3129 0a20 2020 2020 2020   step=1).       
+0000a750: 2020 2020 2020 2020 2073 7472 6964 6573           strides
+0000a760: 5f31 203d 2070 6f6f 6c5f 7374 7269 6465  _1 = pool_stride
+0000a770: 5f31 203d 2073 7472 6964 6573 5f32 203d  _1 = strides_2 =
+0000a780: 2070 6f6f 6c5f 7374 7269 6465 5f32 203d   pool_stride_2 =
+0000a790: 2073 7472 6964 6573 5f33 203d 2070 6f6f   strides_3 = poo
+0000a7a0: 6c5f 7374 7269 6465 5f33 203d 2031 0a0a  l_stride_3 = 1..
+0000a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7c0: 6e75 6d5f 636f 6e76 5f6c 6179 6572 7320  num_conv_layers 
+0000a7d0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000a7e0: 696e 7428 276e 756d 5f63 6f6e 765f 6c61  int('num_conv_la
+0000a7f0: 7965 7273 272c 2031 2c20 332c 2073 7465  yers', 1, 3, ste
+0000a800: 703d 3129 0a0a 2020 2020 2020 2020 2020  p=1)..          
+0000a810: 2020 2020 2020 6966 206e 756d 5f63 6f6e        if num_con
+0000a820: 765f 6c61 7965 7273 203d 3d20 313a 0a20  v_layers == 1:. 
+0000a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a840: 2020 2066 696c 7465 725f 3220 3d20 6669     filter_2 = fi
+0000a850: 6c74 6572 5f73 697a 655f 3220 3d20 706f  lter_size_2 = po
+0000a860: 6f6c 5f73 697a 655f 3220 3d20 6669 6c74  ol_size_2 = filt
+0000a870: 6572 5f33 203d 2066 696c 7465 725f 7369  er_3 = filter_si
+0000a880: 7a65 5f33 203d 2073 7472 6964 6573 5f33  ze_3 = strides_3
+0000a890: 203d 2070 6f6f 6c5f 7369 7a65 5f33 203d   = pool_size_3 =
+0000a8a0: 2030 3b20 706f 6f6c 696e 675f 3220 3d20   0; pooling_2 = 
+0000a8b0: 706f 6f6c 696e 675f 3320 3d20 4e6f 6e65  pooling_3 = None
+0000a8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a8d0: 2069 6620 6e75 6d5f 636f 6e76 5f6c 6179   if num_conv_lay
+0000a8e0: 6572 7320 3e3d 2032 3a0a 2020 2020 2020  ers >= 2:.      
+0000a8f0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000a900: 6c74 6572 5f32 203d 2074 7269 616c 2e73  lter_2 = trial.s
+0000a910: 7567 6765 7374 5f69 6e74 2827 6669 6c74  uggest_int('filt
+0000a920: 6572 5f32 272c 2031 322c 2035 3136 2c20  er_2', 12, 516, 
+0000a930: 7374 6570 3d31 3229 0a20 2020 2020 2020  step=12).       
+0000a940: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a950: 7465 725f 7369 7a65 5f32 203d 2074 7269  ter_size_2 = tri
+0000a960: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+0000a970: 6669 6c74 6572 5f73 697a 655f 3227 2c20  filter_size_2', 
+0000a980: 312c 2037 2c20 7374 6570 3d32 290a 2020  1, 7, step=2).  
+0000a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9a0: 2020 706f 6f6c 696e 675f 3220 3d20 7472    pooling_2 = tr
+0000a9b0: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
+0000a9c0: 676f 7269 6361 6c28 2770 6f6f 6c69 6e67  gorical('pooling
+0000a9d0: 5f32 272c 205b 276d 696e 272c 2027 6d61  _2', ['min', 'ma
+0000a9e0: 7827 2c20 2761 7665 7261 6765 275d 290a  x', 'average']).
+0000a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa00: 2020 2020 706f 6f6c 5f73 697a 655f 3220      pool_size_2 
+0000aa10: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000aa20: 696e 7428 2770 6f6f 6c5f 7369 7a65 5f32  int('pool_size_2
+0000aa30: 272c 2031 2c20 372c 2073 7465 703d 3129  ', 1, 7, step=1)
+0000aa40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aa50: 2020 2020 2066 696c 7465 725f 3320 3d20       filter_3 = 
+0000aa60: 6669 6c74 6572 5f73 697a 655f 3320 3d20  filter_size_3 = 
+0000aa70: 706f 6f6c 5f73 697a 655f 3320 3d20 303b  pool_size_3 = 0;
+0000aa80: 2070 6f6f 6c69 6e67 5f33 203d 204e 6f6e   pooling_3 = Non
+0000aa90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000aaa0: 2020 6966 206e 756d 5f63 6f6e 765f 6c61    if num_conv_la
+0000aab0: 7965 7273 203d 3d20 333a 0a20 2020 2020  yers == 3:.     
+0000aac0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000aad0: 696c 7465 725f 3320 3d20 7472 6961 6c2e  ilter_3 = trial.
+0000aae0: 7375 6767 6573 745f 696e 7428 2766 696c  suggest_int('fil
+0000aaf0: 7465 725f 3327 2c20 3132 2c20 3531 362c  ter_3', 12, 516,
+0000ab00: 2073 7465 703d 3132 290a 2020 2020 2020   step=12).      
+0000ab10: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000ab20: 6c74 6572 5f73 697a 655f 3320 3d20 7472  lter_size_3 = tr
+0000ab30: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+0000ab40: 2766 696c 7465 725f 7369 7a65 5f33 272c  'filter_size_3',
+0000ab50: 2031 2c20 372c 2073 7465 703d 3229 0a20   1, 7, step=2). 
+0000ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab70: 2020 2070 6f6f 6c69 6e67 5f33 203d 2074     pooling_3 = t
+0000ab80: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
+0000ab90: 6567 6f72 6963 616c 2827 706f 6f6c 696e  egorical('poolin
+0000aba0: 675f 3327 2c20 5b27 6d69 6e27 2c20 276d  g_3', ['min', 'm
+0000abb0: 6178 272c 2027 6176 6572 6167 6527 5d29  ax', 'average'])
+0000abc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000abd0: 2020 2020 2070 6f6f 6c5f 7369 7a65 5f33       pool_size_3
+0000abe0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000abf0: 5f69 6e74 2827 706f 6f6c 5f73 697a 655f  _int('pool_size_
+0000ac00: 3327 2c20 312c 2037 2c20 7374 6570 3d31  3', 1, 7, step=1
+0000ac10: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000ac20: 2020 2023 2323 2044 656e 7365 204c 6179     ### Dense Lay
+0000ac30: 6572 7320 2323 230a 0a20 2020 2020 2020  ers ###..       
+0000ac40: 2020 2020 2020 2020 2064 656e 7365 5f6e           dense_n
+0000ac50: 6575 726f 6e73 5f31 203d 2074 7269 616c  eurons_1 = trial
+0000ac60: 2e73 7567 6765 7374 5f69 6e74 2827 6465  .suggest_int('de
+0000ac70: 6e73 655f 6e65 7572 6f6e 735f 3127 2c20  nse_neurons_1', 
+0000ac80: 3132 382c 2036 3430 302c 2073 7465 703d  128, 6400, step=
+0000ac90: 3132 3829 0a20 2020 2020 2020 2020 2020  128).           
+0000aca0: 2020 2020 2064 726f 706f 7574 5f31 203d       dropout_1 =
+0000acb0: 2074 7269 616c 2e73 7567 6765 7374 5f66   trial.suggest_f
+0000acc0: 6c6f 6174 2827 6472 6f70 6f75 745f 3127  loat('dropout_1'
+0000acd0: 2c20 302e 302c 2030 2e35 2c20 7374 6570  , 0.0, 0.5, step
+0000ace0: 3d30 2e30 3129 0a20 2020 2020 2020 2020  =0.01).         
+0000acf0: 2020 2020 2020 206e 756d 5f64 656e 7365         num_dense
+0000ad00: 5f6c 6179 6572 7320 3d20 7472 6961 6c2e  _layers = trial.
+0000ad10: 7375 6767 6573 745f 696e 7428 276e 756d  suggest_int('num
+0000ad20: 5f64 656e 7365 5f6c 6179 6572 7327 2c20  _dense_layers', 
+0000ad30: 312c 2033 2c20 7374 6570 3d31 290a 0a20  1, 3, step=1).. 
+0000ad40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ad50: 6620 6e75 6d5f 6465 6e73 655f 6c61 7965  f num_dense_laye
+0000ad60: 7273 203d 3d20 313a 0a20 2020 2020 2020  rs == 1:.       
+0000ad70: 2020 2020 2020 2020 2020 2020 2064 656e               den
+0000ad80: 7365 5f6e 6575 726f 6e73 5f32 203d 2064  se_neurons_2 = d
+0000ad90: 726f 706f 7574 5f32 203d 2064 656e 7365  ropout_2 = dense
+0000ada0: 5f6e 6575 726f 6e73 5f33 203d 2064 726f  _neurons_3 = dro
+0000adb0: 706f 7574 5f33 203d 2030 0a20 2020 2020  pout_3 = 0.     
+0000adc0: 2020 2020 2020 2020 2020 2069 6620 6e75             if nu
+0000add0: 6d5f 6465 6e73 655f 6c61 7965 7273 203e  m_dense_layers >
+0000ade0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+0000adf0: 2020 2020 2020 2020 2064 656e 7365 5f6e           dense_n
+0000ae00: 6575 726f 6e73 5f32 203d 2074 7269 616c  eurons_2 = trial
+0000ae10: 2e73 7567 6765 7374 5f69 6e74 2827 6465  .suggest_int('de
+0000ae20: 6e73 655f 6e65 7572 6f6e 735f 3227 2c20  nse_neurons_2', 
+0000ae30: 3132 382c 2036 3430 302c 2073 7465 703d  128, 6400, step=
+0000ae40: 3132 3829 0a20 2020 2020 2020 2020 2020  128).           
+0000ae50: 2020 2020 2020 2020 2064 726f 706f 7574           dropout
+0000ae60: 5f32 203d 2074 7269 616c 2e73 7567 6765  _2 = trial.sugge
+0000ae70: 7374 5f66 6c6f 6174 2827 6472 6f70 6f75  st_float('dropou
+0000ae80: 745f 3227 2c20 302e 302c 2030 2e35 2c20  t_2', 0.0, 0.5, 
+0000ae90: 7374 6570 3d30 2e30 3129 0a20 2020 2020  step=0.01).     
+0000aea0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000aeb0: 656e 7365 5f6e 6575 726f 6e73 5f33 203d  ense_neurons_3 =
+0000aec0: 2064 726f 706f 7574 5f33 203d 2030 0a20   dropout_3 = 0. 
+0000aed0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000aee0: 6620 6e75 6d5f 6465 6e73 655f 6c61 7965  f num_dense_laye
+0000aef0: 7273 203d 3d20 333a 0a20 2020 2020 2020  rs == 3:.       
+0000af00: 2020 2020 2020 2020 2020 2020 2064 656e               den
+0000af10: 7365 5f6e 6575 726f 6e73 5f33 203d 2074  se_neurons_3 = t
+0000af20: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+0000af30: 2827 6465 6e73 655f 6e65 7572 6f6e 735f  ('dense_neurons_
+0000af40: 3327 2c20 3132 382c 2036 3430 302c 2073  3', 128, 6400, s
+0000af50: 7465 703d 3132 3829 0a20 2020 2020 2020  tep=128).       
+0000af60: 2020 2020 2020 2020 2020 2020 2064 726f               dro
+0000af70: 706f 7574 5f33 203d 2074 7269 616c 2e73  pout_3 = trial.s
+0000af80: 7567 6765 7374 5f66 6c6f 6174 2827 6472  uggest_float('dr
+0000af90: 6f70 6f75 745f 3327 2c20 302e 302c 2030  opout_3', 0.0, 0
+0000afa0: 2e35 2c20 7374 6570 3d30 2e30 3129 0a0a  .5, step=0.01)..
+0000afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afc0: 6d6f 6465 6c2c 2068 6973 746f 7279 203d  model, history =
+0000afd0: 2063 6e6e 5f6d 6f64 656c 2e63 7573 746f   cnn_model.custo
+0000afe0: 6d5f 6d6f 6465 6c28 636c 6173 735f 312c  m_model(class_1,
+0000aff0: 2063 6c61 7373 5f32 2c20 696d 675f 6e75   class_2, img_nu
+0000b000: 6d5f 6368 616e 6e65 6c73 3d73 656c 662e  m_channels=self.
+0000b010: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0000b020: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000b030: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+0000b040: 3d73 656c 662e 6e6f 726d 616c 697a 652c  =self.normalize,
+0000b050: 206d 696e 5f70 6978 656c 3d6d 696e 5f70   min_pixel=min_p
+0000b060: 6978 2c20 6d61 785f 7069 7865 6c3d 6d61  ix, max_pixel=ma
+0000b070: 785f 7069 782c 2076 616c 5f70 6f73 6974  x_pix, val_posit
+0000b080: 6976 653d 7661 6c5f 636c 6173 735f 312c  ive=val_class_1,
+0000b090: 2076 616c 5f6e 6567 6174 6976 653d 7661   val_negative=va
+0000b0a0: 6c5f 636c 6173 735f 322c 200a 2020 2020  l_class_2, .    
+0000b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0c0: 6570 6f63 6873 3d73 656c 662e 7472 6169  epochs=self.trai
+0000b0d0: 6e5f 6570 6f63 6873 2c20 6261 7463 685f  n_epochs, batch_
+0000b0e0: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
+0000b0f0: 206f 7074 696d 697a 6572 3d6f 7074 696d   optimizer=optim
+0000b100: 697a 6572 2c20 6c72 3d6c 722c 2064 6563  izer, lr=lr, dec
+0000b110: 6179 3d64 6563 6179 2c20 6d6f 6d65 6e74  ay=decay, moment
+0000b120: 756d 3d6d 6f6d 656e 7475 6d2c 206e 6573  um=momentum, nes
+0000b130: 7465 726f 763d 6e65 7374 6572 6f76 2c20  terov=nesterov, 
+0000b140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b150: 2020 2020 2062 6574 615f 313d 6265 7461       beta_1=beta
+0000b160: 5f31 2c20 6265 7461 5f32 3d62 6574 615f  _1, beta_2=beta_
+0000b170: 322c 2061 6d73 6772 6164 3d61 6d73 6772  2, amsgrad=amsgr
+0000b180: 6164 2c20 6c6f 7373 3d6c 6f73 732c 2061  ad, loss=loss, a
+0000b190: 6374 6976 6174 696f 6e5f 636f 6e76 3d61  ctivation_conv=a
+0000b1a0: 6374 6976 6174 696f 6e5f 636f 6e76 2c20  ctivation_conv, 
+0000b1b0: 6163 7469 7661 7469 6f6e 5f64 656e 7365  activation_dense
+0000b1c0: 3d61 6374 6976 6174 696f 6e5f 6465 6e73  =activation_dens
+0000b1d0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+0000b1e0: 2020 2020 2020 2020 636f 6e76 5f69 6e69          conv_ini
+0000b1f0: 743d 636f 6e76 5f69 6e69 742c 2064 656e  t=conv_init, den
+0000b200: 7365 5f69 6e69 743d 6465 6e73 655f 696e  se_init=dense_in
+0000b210: 6974 2c20 6d6f 6465 6c5f 7265 673d 6d6f  it, model_reg=mo
+0000b220: 6465 6c5f 7265 672c 200a 2020 2020 2020  del_reg, .      
+0000b230: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000b240: 6c74 6572 5f31 3d66 696c 7465 725f 312c  lter_1=filter_1,
+0000b250: 2066 696c 7465 725f 7369 7a65 5f31 3d66   filter_size_1=f
+0000b260: 696c 7465 725f 7369 7a65 5f31 2c20 7374  ilter_size_1, st
+0000b270: 7269 6465 735f 313d 7374 7269 6465 735f  rides_1=strides_
+0000b280: 312c 2070 6f6f 6c69 6e67 5f31 3d70 6f6f  1, pooling_1=poo
+0000b290: 6c69 6e67 5f31 2c20 706f 6f6c 5f73 697a  ling_1, pool_siz
+0000b2a0: 655f 313d 706f 6f6c 5f73 697a 655f 312c  e_1=pool_size_1,
+0000b2b0: 2070 6f6f 6c5f 7374 7269 6465 5f31 3d70   pool_stride_1=p
+0000b2c0: 6f6f 6c5f 7374 7269 6465 5f31 2c20 0a20  ool_stride_1, . 
+0000b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2e0: 2020 2066 696c 7465 725f 323d 6669 6c74     filter_2=filt
+0000b2f0: 6572 5f32 2c20 6669 6c74 6572 5f73 697a  er_2, filter_siz
+0000b300: 655f 323d 6669 6c74 6572 5f73 697a 655f  e_2=filter_size_
+0000b310: 322c 2073 7472 6964 6573 5f32 3d73 7472  2, strides_2=str
+0000b320: 6964 6573 5f32 2c20 706f 6f6c 696e 675f  ides_2, pooling_
+0000b330: 323d 706f 6f6c 696e 675f 322c 2070 6f6f  2=pooling_2, poo
+0000b340: 6c5f 7369 7a65 5f32 3d70 6f6f 6c5f 7369  l_size_2=pool_si
+0000b350: 7a65 5f32 2c20 706f 6f6c 5f73 7472 6964  ze_2, pool_strid
+0000b360: 655f 323d 706f 6f6c 5f73 7472 6964 655f  e_2=pool_stride_
+0000b370: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
+0000b380: 2020 2020 2020 2020 6669 6c74 6572 5f33          filter_3
+0000b390: 3d66 696c 7465 725f 332c 2066 696c 7465  =filter_3, filte
+0000b3a0: 725f 7369 7a65 5f33 3d66 696c 7465 725f  r_size_3=filter_
+0000b3b0: 7369 7a65 5f33 2c20 7374 7269 6465 735f  size_3, strides_
+0000b3c0: 333d 7374 7269 6465 735f 332c 2070 6f6f  3=strides_3, poo
+0000b3d0: 6c69 6e67 5f33 3d70 6f6f 6c69 6e67 5f33  ling_3=pooling_3
+0000b3e0: 2c20 706f 6f6c 5f73 697a 655f 333d 706f  , pool_size_3=po
+0000b3f0: 6f6c 5f73 697a 655f 332c 2070 6f6f 6c5f  ol_size_3, pool_
+0000b400: 7374 7269 6465 5f33 3d70 6f6f 6c5f 7374  stride_3=pool_st
+0000b410: 7269 6465 5f33 2c20 0a20 2020 2020 2020  ride_3, .       
+0000b420: 2020 2020 2020 2020 2020 2020 2064 656e               den
+0000b430: 7365 5f6e 6575 726f 6e73 5f31 3d64 656e  se_neurons_1=den
+0000b440: 7365 5f6e 6575 726f 6e73 5f31 2c20 6465  se_neurons_1, de
+0000b450: 6e73 655f 6e65 7572 6f6e 735f 323d 6465  nse_neurons_2=de
+0000b460: 6e73 655f 6e65 7572 6f6e 735f 322c 2064  nse_neurons_2, d
+0000b470: 656e 7365 5f6e 6575 726f 6e73 5f33 3d64  ense_neurons_3=d
+0000b480: 656e 7365 5f6e 6575 726f 6e73 5f33 2c20  ense_neurons_3, 
+0000b490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b4a0: 2020 2020 2064 726f 706f 7574 5f31 3d64       dropout_1=d
+0000b4b0: 726f 706f 7574 5f31 2c20 6472 6f70 6f75  ropout_1, dropou
+0000b4c0: 745f 323d 6472 6f70 6f75 745f 322c 2064  t_2=dropout_2, d
+0000b4d0: 726f 706f 7574 5f33 3d64 726f 706f 7574  ropout_3=dropout
+0000b4e0: 5f33 2c20 736d 6f74 655f 7361 6d70 6c69  _3, smote_sampli
+0000b4f0: 6e67 3d73 656c 662e 736d 6f74 655f 7361  ng=self.smote_sa
+0000b500: 6d70 6c69 6e67 2c20 200a 2020 2020 2020  mpling,  .      
+0000b510: 2020 2020 2020 2020 2020 2020 2020 6561                ea
+0000b520: 726c 795f 7374 6f70 5f63 616c 6c62 6163  rly_stop_callbac
+0000b530: 6b3d 6361 6c6c 6261 636b 732c 2063 6865  k=callbacks, che
+0000b540: 636b 706f 696e 743d 4661 6c73 652c 2076  ckpoint=False, v
+0000b550: 6572 626f 7365 3d73 656c 662e 7665 7262  erbose=self.verb
+0000b560: 6f73 6529 0a0a 2020 2020 2020 2020 2020  ose)..          
+0000b570: 2020 656c 6966 2073 656c 662e 636c 6620    elif self.clf 
+0000b580: 3d3d 2027 7667 6731 3627 3a0a 2020 2020  == 'vgg16':.    
+0000b590: 2020 2020 2020 2020 2020 2020 2323 2320              ### 
+0000b5a0: 5265 6775 6c61 7269 7a61 7469 6f6e 2054  Regularization T
+0000b5b0: 6563 686e 6971 7565 2028 424e 2069 7320  echnique (BN is 
+0000b5c0: 6e65 7765 722c 2056 4747 3136 2075 7365  newer, VGG16 use
+0000b5d0: 6420 4e6f 6e65 2920 2323 230a 2020 2020  d None) ###.    
+0000b5e0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000b5f0: 6c5f 7265 6720 3d20 7472 6961 6c2e 7375  l_reg = trial.su
+0000b600: 6767 6573 745f 6361 7465 676f 7269 6361  ggest_categorica
+0000b610: 6c28 276d 6f64 656c 5f72 6567 272c 205b  l('model_reg', [
+0000b620: 4e6f 6e65 2c20 2762 6174 6368 5f6e 6f72  None, 'batch_nor
+0000b630: 6d27 2c20 276c 6f63 616c 5f72 6573 706f  m', 'local_respo
+0000b640: 6e73 6527 5d29 0a0a 2020 2020 2020 2020  nse'])..        
+0000b650: 2020 2020 2020 2020 2323 2320 4f6e 6c79          ### Only
+0000b660: 2074 6865 2070 6f6f 6c69 6e67 2074 7970   the pooling typ
+0000b670: 6573 2061 7265 206f 7074 696d 697a 6564  es are optimized
+0000b680: 2069 6620 6c69 6d69 745f 7365 6172 6368   if limit_search
+0000b690: 3d54 7275 6520 2323 230a 2020 2020 2020  =True ###.      
+0000b6a0: 2020 2020 2020 2020 2020 706f 6f6c 696e            poolin
+0000b6b0: 675f 3120 3d20 7472 6961 6c2e 7375 6767  g_1 = trial.sugg
+0000b6c0: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
+0000b6d0: 2770 6f6f 6c69 6e67 5f31 272c 205b 276d  'pooling_1', ['m
+0000b6e0: 696e 272c 2027 6d61 7827 2c20 2761 7665  in', 'max', 'ave
+0000b6f0: 7261 6765 275d 290a 2020 2020 2020 2020  rage']).        
+0000b700: 2020 2020 2020 2020 706f 6f6c 696e 675f          pooling_
+0000b710: 3220 3d20 7472 6961 6c2e 7375 6767 6573  2 = trial.sugges
+0000b720: 745f 6361 7465 676f 7269 6361 6c28 2770  t_categorical('p
+0000b730: 6f6f 6c69 6e67 5f32 272c 205b 276d 696e  ooling_2', ['min
+0000b740: 272c 2027 6d61 7827 2c20 2761 7665 7261  ', 'max', 'avera
+0000b750: 6765 275d 290a 2020 2020 2020 2020 2020  ge']).          
+0000b760: 2020 2020 2020 706f 6f6c 696e 675f 3320        pooling_3 
+0000b770: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000b780: 6361 7465 676f 7269 6361 6c28 2770 6f6f  categorical('poo
+0000b790: 6c69 6e67 5f33 272c 205b 276d 696e 272c  ling_3', ['min',
+0000b7a0: 2027 6d61 7827 2c20 2761 7665 7261 6765   'max', 'average
+0000b7b0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+0000b7c0: 2020 2020 706f 6f6c 696e 675f 3420 3d20      pooling_4 = 
+0000b7d0: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
+0000b7e0: 7465 676f 7269 6361 6c28 2770 6f6f 6c69  tegorical('pooli
+0000b7f0: 6e67 5f34 272c 205b 276d 696e 272c 2027  ng_4', ['min', '
+0000b800: 6d61 7827 2c20 2761 7665 7261 6765 275d  max', 'average']
+0000b810: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b820: 2020 706f 6f6c 696e 675f 3520 3d20 7472    pooling_5 = tr
+0000b830: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
+0000b840: 676f 7269 6361 6c28 2770 6f6f 6c69 6e67  gorical('pooling
+0000b850: 5f35 272c 205b 276d 696e 272c 2027 6d61  _5', ['min', 'ma
+0000b860: 7827 2c20 2761 7665 7261 6765 275d 290a  x', 'average']).
+0000b870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b880: 2069 6620 7365 6c66 2e6c 696d 6974 5f73   if self.limit_s
+0000b890: 6561 7263 683a 0a20 2020 2020 2020 2020  earch:.         
+0000b8a0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0000b8b0: 2c20 6869 7374 6f72 7920 3d20 636e 6e5f  , history = cnn_
+0000b8c0: 6d6f 6465 6c2e 5647 4731 3628 636c 6173  model.VGG16(clas
+0000b8d0: 735f 312c 2063 6c61 7373 5f32 2c20 696d  s_1, class_2, im
+0000b8e0: 675f 6e75 6d5f 6368 616e 6e65 6c73 3d73  g_num_channels=s
+0000b8f0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
+0000b900: 6e65 6c73 2c20 0a20 2020 2020 2020 2020  nels, .         
+0000b910: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000b920: 6f72 6d61 6c69 7a65 3d73 656c 662e 6e6f  ormalize=self.no
+0000b930: 726d 616c 697a 652c 206d 696e 5f70 6978  rmalize, min_pix
+0000b940: 656c 3d6d 696e 5f70 6978 2c20 6d61 785f  el=min_pix, max_
+0000b950: 7069 7865 6c3d 6d61 785f 7069 782c 2076  pixel=max_pix, v
+0000b960: 616c 5f70 6f73 6974 6976 653d 7661 6c5f  al_positive=val_
+0000b970: 636c 6173 735f 312c 2076 616c 5f6e 6567  class_1, val_neg
+0000b980: 6174 6976 653d 7661 6c5f 636c 6173 735f  ative=val_class_
+0000b990: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
+0000b9a0: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
+0000b9b0: 6873 3d73 656c 662e 7472 6169 6e5f 6570  hs=self.train_ep
+0000b9c0: 6f63 6873 2c20 6261 7463 685f 7369 7a65  ochs, batch_size
+0000b9d0: 3d62 6174 6368 5f73 697a 652c 206f 7074  =batch_size, opt
+0000b9e0: 696d 697a 6572 3d6f 7074 696d 697a 6572  imizer=optimizer
+0000b9f0: 2c20 6c72 3d6c 722c 2064 6563 6179 3d64  , lr=lr, decay=d
+0000ba00: 6563 6179 2c20 6d6f 6d65 6e74 756d 3d6d  ecay, momentum=m
+0000ba10: 6f6d 656e 7475 6d2c 206e 6573 7465 726f  omentum, nestero
+0000ba20: 763d 6e65 7374 6572 6f76 2c20 0a20 2020  v=nesterov, .   
+0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba40: 2020 2020 2062 6574 615f 313d 6265 7461       beta_1=beta
+0000ba50: 5f31 2c20 6265 7461 5f32 3d62 6574 615f  _1, beta_2=beta_
+0000ba60: 322c 2061 6d73 6772 6164 3d61 6d73 6772  2, amsgrad=amsgr
+0000ba70: 6164 2c20 6c6f 7373 3d6c 6f73 732c 2061  ad, loss=loss, a
+0000ba80: 6374 6976 6174 696f 6e5f 636f 6e76 3d61  ctivation_conv=a
+0000ba90: 6374 6976 6174 696f 6e5f 636f 6e76 2c20  ctivation_conv, 
+0000baa0: 6163 7469 7661 7469 6f6e 5f64 656e 7365  activation_dense
+0000bab0: 3d61 6374 6976 6174 696f 6e5f 6465 6e73  =activation_dens
+0000bac0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+0000bad0: 2020 2020 2020 2020 2020 2020 636f 6e76              conv
+0000bae0: 5f69 6e69 743d 636f 6e76 5f69 6e69 742c  _init=conv_init,
+0000baf0: 2064 656e 7365 5f69 6e69 743d 6465 6e73   dense_init=dens
+0000bb00: 655f 696e 6974 2c20 6d6f 6465 6c5f 7265  e_init, model_re
+0000bb10: 673d 6d6f 6465 6c5f 7265 672c 0a20 2020  g=model_reg,.   
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb30: 2020 2020 2070 6f6f 6c69 6e67 5f31 3d70       pooling_1=p
+0000bb40: 6f6f 6c69 6e67 5f31 2c20 706f 6f6c 696e  ooling_1, poolin
+0000bb50: 675f 323d 706f 6f6c 696e 675f 322c 2070  g_2=pooling_2, p
+0000bb60: 6f6f 6c69 6e67 5f33 3d70 6f6f 6c69 6e67  ooling_3=pooling
+0000bb70: 5f33 2c20 706f 6f6c 696e 675f 343d 706f  _3, pooling_4=po
+0000bb80: 6f6c 696e 675f 342c 2070 6f6f 6c69 6e67  oling_4, pooling
+0000bb90: 5f35 3d70 6f6f 6c69 6e67 5f35 2c0a 2020  _5=pooling_5,.  
+0000bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbb0: 2020 2020 2020 736d 6f74 655f 7361 6d70        smote_samp
+0000bbc0: 6c69 6e67 3d73 656c 662e 736d 6f74 655f  ling=self.smote_
+0000bbd0: 7361 6d70 6c69 6e67 2c20 6561 726c 795f  sampling, early_
+0000bbe0: 7374 6f70 5f63 616c 6c62 6163 6b3d 6361  stop_callback=ca
+0000bbf0: 6c6c 6261 636b 732c 2063 6865 636b 706f  llbacks, checkpo
+0000bc00: 696e 743d 4661 6c73 652c 2076 6572 626f  int=False, verbo
+0000bc10: 7365 3d73 656c 662e 7665 7262 6f73 6529  se=self.verbose)
+0000bc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bc30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000bc40: 2020 2020 2020 2020 2020 2023 2323 2046             ### F
+0000bc50: 696c 7465 7220 616e 6420 4c61 7965 7220  ilter and Layer 
+0000bc60: 4368 6172 6163 7465 7273 7469 6373 2023  Characterstics #
+0000bc70: 2323 0a20 2020 2020 2020 2020 2020 2020  ##.             
+0000bc80: 2020 2020 2020 2066 696c 7465 725f 3120         filter_1 
+0000bc90: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000bca0: 696e 7428 2766 696c 7465 725f 3127 2c20  int('filter_1', 
+0000bcb0: 3132 2c20 3531 362c 2073 7465 703d 3132  12, 516, step=12
+0000bcc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000bcd0: 2020 2020 2020 6669 6c74 6572 5f73 697a        filter_siz
+0000bce0: 655f 3120 3d20 7472 6961 6c2e 7375 6767  e_1 = trial.sugg
+0000bcf0: 6573 745f 696e 7428 2766 696c 7465 725f  est_int('filter_
+0000bd00: 7369 7a65 5f31 272c 2031 2c20 3131 2c20  size_1', 1, 11, 
+0000bd10: 7374 6570 3d32 290a 2020 2020 2020 2020  step=2).        
+0000bd20: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+0000bd30: 6465 735f 3120 3d20 7472 6961 6c2e 7375  des_1 = trial.su
+0000bd40: 6767 6573 745f 696e 7428 2773 7472 6964  ggest_int('strid
+0000bd50: 6573 5f31 272c 2031 2c20 332c 2073 7465  es_1', 1, 3, ste
+0000bd60: 703d 3129 0a20 2020 2020 2020 2020 2020  p=1).           
+0000bd70: 2020 2020 2020 2020 2070 6f6f 6c5f 7369           pool_si
+0000bd80: 7a65 5f31 203d 2074 7269 616c 2e73 7567  ze_1 = trial.sug
+0000bd90: 6765 7374 5f69 6e74 2827 706f 6f6c 5f73  gest_int('pool_s
+0000bda0: 697a 655f 3127 2c20 312c 2037 2c20 7374  ize_1', 1, 7, st
+0000bdb0: 6570 3d31 290a 2020 2020 2020 2020 2020  ep=1).          
+0000bdc0: 2020 2020 2020 2020 2020 706f 6f6c 5f73            pool_s
+0000bdd0: 7472 6964 655f 3120 3d20 7472 6961 6c2e  tride_1 = trial.
+0000bde0: 7375 6767 6573 745f 696e 7428 2770 6f6f  suggest_int('poo
+0000bdf0: 6c5f 7374 7269 6465 5f31 272c 2031 2c20  l_stride_1', 1, 
+0000be00: 332c 2073 7465 703d 3129 0a0a 2020 2020  3, step=1)..    
+0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be20: 6669 6c74 6572 5f32 203d 2074 7269 616c  filter_2 = trial
+0000be30: 2e73 7567 6765 7374 5f69 6e74 2827 6669  .suggest_int('fi
+0000be40: 6c74 6572 5f32 272c 2031 322c 2035 3136  lter_2', 12, 516
+0000be50: 2c20 7374 6570 3d31 3229 0a20 2020 2020  , step=12).     
+0000be60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000be70: 696c 7465 725f 7369 7a65 5f32 203d 2074  ilter_size_2 = t
+0000be80: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+0000be90: 2827 6669 6c74 6572 5f73 697a 655f 3227  ('filter_size_2'
+0000bea0: 2c20 312c 2037 2c20 7374 6570 3d32 290a  , 1, 7, step=2).
+0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bec0: 2020 2020 7374 7269 6465 735f 3220 3d20      strides_2 = 
+0000bed0: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+0000bee0: 7428 2773 7472 6964 6573 5f32 272c 2031  t('strides_2', 1
+0000bef0: 2c20 332c 2073 7465 703d 3129 0a20 2020  , 3, step=1).   
+0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf10: 2070 6f6f 6c5f 7369 7a65 5f32 203d 2074   pool_size_2 = t
+0000bf20: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+0000bf30: 2827 706f 6f6c 5f73 697a 655f 3227 2c20  ('pool_size_2', 
+0000bf40: 312c 2037 2c20 7374 6570 3d31 290a 2020  1, 7, step=1).  
+0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf60: 2020 706f 6f6c 5f73 7472 6964 655f 3220    pool_stride_2 
+0000bf70: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000bf80: 696e 7428 2770 6f6f 6c5f 7374 7269 6465  int('pool_stride
+0000bf90: 5f32 272c 2031 2c20 332c 2073 7465 703d  _2', 1, 3, step=
+0000bfa0: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
+0000bfb0: 2020 2020 2020 2020 6669 6c74 6572 5f33          filter_3
+0000bfc0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000bfd0: 5f69 6e74 2827 6669 6c74 6572 5f33 272c  _int('filter_3',
+0000bfe0: 2031 322c 2035 3136 2c20 7374 6570 3d31   12, 516, step=1
+0000bff0: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+0000c000: 2020 2020 2020 2066 696c 7465 725f 7369         filter_si
+0000c010: 7a65 5f33 203d 2074 7269 616c 2e73 7567  ze_3 = trial.sug
+0000c020: 6765 7374 5f69 6e74 2827 6669 6c74 6572  gest_int('filter
+0000c030: 5f73 697a 655f 3327 2c20 312c 2037 2c20  _size_3', 1, 7, 
+0000c040: 7374 6570 3d32 290a 2020 2020 2020 2020  step=2).        
+0000c050: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+0000c060: 6465 735f 3320 3d20 7472 6961 6c2e 7375  des_3 = trial.su
+0000c070: 6767 6573 745f 696e 7428 2773 7472 6964  ggest_int('strid
+0000c080: 6573 5f33 272c 2031 2c20 332c 2073 7465  es_3', 1, 3, ste
+0000c090: 703d 3129 0a20 2020 2020 2020 2020 2020  p=1).           
+0000c0a0: 2020 2020 2020 2020 2070 6f6f 6c5f 7369           pool_si
+0000c0b0: 7a65 5f33 203d 2074 7269 616c 2e73 7567  ze_3 = trial.sug
+0000c0c0: 6765 7374 5f69 6e74 2827 706f 6f6c 5f73  gest_int('pool_s
+0000c0d0: 697a 655f 3327 2c20 312c 2037 2c20 7374  ize_3', 1, 7, st
+0000c0e0: 6570 3d31 290a 2020 2020 2020 2020 2020  ep=1).          
+0000c0f0: 2020 2020 2020 2020 2020 706f 6f6c 5f73            pool_s
+0000c100: 7472 6964 655f 3320 3d20 7472 6961 6c2e  tride_3 = trial.
+0000c110: 7375 6767 6573 745f 696e 7428 2770 6f6f  suggest_int('poo
+0000c120: 6c5f 7374 7269 6465 5f33 272c 2031 2c20  l_stride_3', 1, 
+0000c130: 332c 2073 7465 703d 3129 0a0a 2020 2020  3, step=1)..    
+0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c150: 6669 6c74 6572 5f34 203d 2074 7269 616c  filter_4 = trial
+0000c160: 2e73 7567 6765 7374 5f69 6e74 2827 6669  .suggest_int('fi
+0000c170: 6c74 6572 5f34 272c 2031 322c 2035 3136  lter_4', 12, 516
+0000c180: 2c20 7374 6570 3d31 3229 0a20 2020 2020  , step=12).     
+0000c190: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000c1a0: 696c 7465 725f 7369 7a65 5f34 203d 2074  ilter_size_4 = t
+0000c1b0: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+0000c1c0: 2827 6669 6c74 6572 5f73 697a 655f 3427  ('filter_size_4'
+0000c1d0: 2c20 312c 2037 2c20 7374 6570 3d32 290a  , 1, 7, step=2).
+0000c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1f0: 2020 2020 7374 7269 6465 735f 3420 3d20      strides_4 = 
+0000c200: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+0000c210: 7428 2773 7472 6964 6573 5f34 272c 2031  t('strides_4', 1
+0000c220: 2c20 332c 2073 7465 703d 3129 0a20 2020  , 3, step=1).   
+0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c240: 2070 6f6f 6c5f 7369 7a65 5f34 203d 2074   pool_size_4 = t
+0000c250: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+0000c260: 2827 706f 6f6c 5f73 697a 655f 3427 2c20  ('pool_size_4', 
+0000c270: 312c 2037 2c20 7374 6570 3d31 290a 2020  1, 7, step=1).  
+0000c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c290: 2020 706f 6f6c 5f73 7472 6964 655f 3420    pool_stride_4 
+0000c2a0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000c2b0: 696e 7428 2770 6f6f 6c5f 7374 7269 6465  int('pool_stride
+0000c2c0: 5f34 272c 2031 2c20 332c 2073 7465 703d  _4', 1, 3, step=
+0000c2d0: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
+0000c2e0: 2020 2020 2020 2020 6669 6c74 6572 5f35          filter_5
+0000c2f0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000c300: 5f69 6e74 2827 6669 6c74 6572 5f35 272c  _int('filter_5',
+0000c310: 2031 322c 2035 3136 2c20 7374 6570 3d31   12, 516, step=1
+0000c320: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+0000c330: 2020 2020 2020 2066 696c 7465 725f 7369         filter_si
+0000c340: 7a65 5f35 203d 2074 7269 616c 2e73 7567  ze_5 = trial.sug
+0000c350: 6765 7374 5f69 6e74 2827 6669 6c74 6572  gest_int('filter
+0000c360: 5f73 697a 655f 3527 2c20 312c 2037 2c20  _size_5', 1, 7, 
+0000c370: 7374 6570 3d32 290a 2020 2020 2020 2020  step=2).        
+0000c380: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+0000c390: 6465 735f 3520 3d20 7472 6961 6c2e 7375  des_5 = trial.su
+0000c3a0: 6767 6573 745f 696e 7428 2773 7472 6964  ggest_int('strid
+0000c3b0: 6573 5f35 272c 2031 2c20 332c 2073 7465  es_5', 1, 3, ste
+0000c3c0: 703d 3129 200a 2020 2020 2020 2020 2020  p=1) .          
+0000c3d0: 2020 2020 2020 2020 2020 706f 6f6c 5f73            pool_s
+0000c3e0: 697a 655f 3520 3d20 7472 6961 6c2e 7375  ize_5 = trial.su
+0000c3f0: 6767 6573 745f 696e 7428 2770 6f6f 6c5f  ggest_int('pool_
+0000c400: 7369 7a65 5f35 272c 2031 2c20 372c 2073  size_5', 1, 7, s
+0000c410: 7465 703d 3129 0a20 2020 2020 2020 2020  tep=1).         
+0000c420: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
+0000c430: 7374 7269 6465 5f35 203d 2074 7269 616c  stride_5 = trial
+0000c440: 2e73 7567 6765 7374 5f69 6e74 2827 706f  .suggest_int('po
+0000c450: 6f6c 5f73 7472 6964 655f 3527 2c20 312c  ol_stride_5', 1,
+0000c460: 2033 2c20 7374 6570 3d31 290a 0a20 2020   3, step=1)..   
+0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c480: 2023 2323 2044 656e 7365 204c 6179 6572   ### Dense Layer
+0000c490: 7320 2323 230a 2020 2020 2020 2020 2020  s ###.          
+0000c4a0: 2020 2020 2020 2020 2020 6465 6e73 655f            dense_
+0000c4b0: 6e65 7572 6f6e 735f 3120 3d20 7472 6961  neurons_1 = tria
+0000c4c0: 6c2e 7375 6767 6573 745f 696e 7428 2764  l.suggest_int('d
+0000c4d0: 656e 7365 5f6e 6575 726f 6e73 5f31 272c  ense_neurons_1',
+0000c4e0: 2031 3238 2c20 3634 3030 2c20 7374 6570   128, 6400, step
+0000c4f0: 3d31 3238 290a 2020 2020 2020 2020 2020  =128).          
+0000c500: 2020 2020 2020 2020 2020 6465 6e73 655f            dense_
+0000c510: 6e65 7572 6f6e 735f 3220 3d20 7472 6961  neurons_2 = tria
+0000c520: 6c2e 7375 6767 6573 745f 696e 7428 2764  l.suggest_int('d
+0000c530: 656e 7365 5f6e 6575 726f 6e73 5f32 272c  ense_neurons_2',
+0000c540: 2031 3238 2c20 3634 3030 2c20 7374 6570   128, 6400, step
+0000c550: 3d31 3238 290a 2020 2020 2020 2020 2020  =128).          
+0000c560: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
+0000c570: 745f 3120 3d20 7472 6961 6c2e 7375 6767  t_1 = trial.sugg
+0000c580: 6573 745f 666c 6f61 7428 2764 726f 706f  est_float('dropo
+0000c590: 7574 5f31 272c 2030 2e30 2c20 302e 352c  ut_1', 0.0, 0.5,
+0000c5a0: 2073 7465 703d 302e 3031 290a 2020 2020   step=0.01).    
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5c0: 6472 6f70 6f75 745f 3220 3d20 7472 6961  dropout_2 = tria
+0000c5d0: 6c2e 7375 6767 6573 745f 666c 6f61 7428  l.suggest_float(
+0000c5e0: 2764 726f 706f 7574 5f32 272c 2030 2e30  'dropout_2', 0.0
+0000c5f0: 2c20 302e 352c 2073 7465 703d 302e 3031  , 0.5, step=0.01
+0000c600: 2920 0a0a 2020 2020 2020 2020 2020 2020  ) ..            
+0000c610: 2020 2020 2020 2020 6d6f 6465 6c2c 2068          model, h
+0000c620: 6973 746f 7279 203d 2063 6e6e 5f6d 6f64  istory = cnn_mod
+0000c630: 656c 2e56 4747 3136 2863 6c61 7373 5f31  el.VGG16(class_1
+0000c640: 2c20 636c 6173 735f 322c 2069 6d67 5f6e  , class_2, img_n
+0000c650: 756d 5f63 6861 6e6e 656c 733d 7365 6c66  um_channels=self
+0000c660: 2e69 6d67 5f6e 756d 5f63 6861 6e6e 656c  .img_num_channel
+0000c670: 732c 200a 2020 2020 2020 2020 2020 2020  s, .            
+0000c680: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+0000c690: 616c 697a 653d 7365 6c66 2e6e 6f72 6d61  alize=self.norma
+0000c6a0: 6c69 7a65 2c20 6d69 6e5f 7069 7865 6c3d  lize, min_pixel=
+0000c6b0: 6d69 6e5f 7069 782c 206d 6178 5f70 6978  min_pix, max_pix
+0000c6c0: 656c 3d6d 6178 5f70 6978 2c20 7661 6c5f  el=max_pix, val_
+0000c6d0: 706f 7369 7469 7665 3d76 616c 5f63 6c61  positive=val_cla
+0000c6e0: 7373 5f31 2c20 7661 6c5f 6e65 6761 7469  ss_1, val_negati
+0000c6f0: 7665 3d76 616c 5f63 6c61 7373 5f32 2c20  ve=val_class_2, 
+0000c700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c710: 2020 2020 2020 2020 2065 706f 6368 733d           epochs=
+0000c720: 7365 6c66 2e74 7261 696e 5f65 706f 6368  self.train_epoch
+0000c730: 732c 2062 6174 6368 5f73 697a 653d 6261  s, batch_size=ba
+0000c740: 7463 685f 7369 7a65 2c20 6f70 7469 6d69  tch_size, optimi
+0000c750: 7a65 723d 6f70 7469 6d69 7a65 722c 206c  zer=optimizer, l
+0000c760: 723d 6c72 2c20 6465 6361 793d 6465 6361  r=lr, decay=deca
+0000c770: 792c 206d 6f6d 656e 7475 6d3d 6d6f 6d65  y, momentum=mome
+0000c780: 6e74 756d 2c20 6e65 7374 6572 6f76 3d6e  ntum, nesterov=n
+0000c790: 6573 7465 726f 762c 200a 2020 2020 2020  esterov, .      
+0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7b0: 2020 6265 7461 5f31 3d62 6574 615f 312c    beta_1=beta_1,
+0000c7c0: 2062 6574 615f 323d 6265 7461 5f32 2c20   beta_2=beta_2, 
+0000c7d0: 616d 7367 7261 643d 616d 7367 7261 642c  amsgrad=amsgrad,
+0000c7e0: 206c 6f73 733d 6c6f 7373 2c20 6163 7469   loss=loss, acti
+0000c7f0: 7661 7469 6f6e 5f63 6f6e 763d 6163 7469  vation_conv=acti
+0000c800: 7661 7469 6f6e 5f63 6f6e 762c 2061 6374  vation_conv, act
+0000c810: 6976 6174 696f 6e5f 6465 6e73 653d 6163  ivation_dense=ac
+0000c820: 7469 7661 7469 6f6e 5f64 656e 7365 2c20  tivation_dense, 
+0000c830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c840: 2020 2020 2020 2020 2063 6f6e 765f 696e           conv_in
+0000c850: 6974 3d63 6f6e 765f 696e 6974 2c20 6465  it=conv_init, de
+0000c860: 6e73 655f 696e 6974 3d64 656e 7365 5f69  nse_init=dense_i
+0000c870: 6e69 742c 206d 6f64 656c 5f72 6567 3d6d  nit, model_reg=m
+0000c880: 6f64 656c 5f72 6567 2c20 2020 2020 2020  odel_reg,       
+0000c890: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0000c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8b0: 2020 2020 2020 2020 6669 6c74 6572 5f31          filter_1
+0000c8c0: 3d66 696c 7465 725f 312c 2066 696c 7465  =filter_1, filte
+0000c8d0: 725f 7369 7a65 5f31 3d66 696c 7465 725f  r_size_1=filter_
+0000c8e0: 7369 7a65 5f31 2c20 7374 7269 6465 735f  size_1, strides_
+0000c8f0: 313d 7374 7269 6465 735f 312c 2070 6f6f  1=strides_1, poo
+0000c900: 6c69 6e67 5f31 3d70 6f6f 6c69 6e67 5f31  ling_1=pooling_1
+0000c910: 2c20 706f 6f6c 5f73 697a 655f 313d 706f  , pool_size_1=po
+0000c920: 6f6c 5f73 697a 655f 312c 2070 6f6f 6c5f  ol_size_1, pool_
+0000c930: 7374 7269 6465 5f31 3d70 6f6f 6c5f 7374  stride_1=pool_st
+0000c940: 7269 6465 5f31 2c0a 2020 2020 2020 2020  ride_1,.        
+0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c960: 6669 6c74 6572 5f32 3d66 696c 7465 725f  filter_2=filter_
+0000c970: 322c 2066 696c 7465 725f 7369 7a65 5f32  2, filter_size_2
+0000c980: 3d66 696c 7465 725f 7369 7a65 5f32 2c20  =filter_size_2, 
+0000c990: 7374 7269 6465 735f 323d 7374 7269 6465  strides_2=stride
+0000c9a0: 735f 322c 2070 6f6f 6c69 6e67 5f32 3d70  s_2, pooling_2=p
+0000c9b0: 6f6f 6c69 6e67 5f32 2c20 706f 6f6c 5f73  ooling_2, pool_s
+0000c9c0: 697a 655f 323d 706f 6f6c 5f73 697a 655f  ize_2=pool_size_
+0000c9d0: 322c 2070 6f6f 6c5f 7374 7269 6465 5f32  2, pool_stride_2
+0000c9e0: 3d70 6f6f 6c5f 7374 7269 6465 5f32 2c0a  =pool_stride_2,.
+0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca00: 2020 2020 2020 2020 6669 6c74 6572 5f33          filter_3
+0000ca10: 3d66 696c 7465 725f 332c 2066 696c 7465  =filter_3, filte
+0000ca20: 725f 7369 7a65 5f33 3d66 696c 7465 725f  r_size_3=filter_
+0000ca30: 7369 7a65 5f33 2c20 7374 7269 6465 735f  size_3, strides_
+0000ca40: 333d 7374 7269 6465 735f 332c 2070 6f6f  3=strides_3, poo
+0000ca50: 6c69 6e67 5f33 3d70 6f6f 6c69 6e67 5f33  ling_3=pooling_3
+0000ca60: 2c20 706f 6f6c 5f73 697a 655f 333d 706f  , pool_size_3=po
+0000ca70: 6f6c 5f73 697a 655f 332c 2070 6f6f 6c5f  ol_size_3, pool_
+0000ca80: 7374 7269 6465 5f33 3d70 6f6f 6c5f 7374  stride_3=pool_st
+0000ca90: 7269 6465 5f33 2c0a 2020 2020 2020 2020  ride_3,.        
+0000caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cab0: 6669 6c74 6572 5f34 3d66 696c 7465 725f  filter_4=filter_
+0000cac0: 342c 2066 696c 7465 725f 7369 7a65 5f34  4, filter_size_4
+0000cad0: 3d66 696c 7465 725f 7369 7a65 5f34 2c20  =filter_size_4, 
+0000cae0: 7374 7269 6465 735f 343d 7374 7269 6465  strides_4=stride
+0000caf0: 735f 342c 2070 6f6f 6c69 6e67 5f34 3d70  s_4, pooling_4=p
+0000cb00: 6f6f 6c69 6e67 5f34 2c20 706f 6f6c 5f73  ooling_4, pool_s
+0000cb10: 697a 655f 343d 706f 6f6c 5f73 697a 655f  ize_4=pool_size_
+0000cb20: 342c 2070 6f6f 6c5f 7374 7269 6465 5f34  4, pool_stride_4
+0000cb30: 3d70 6f6f 6c5f 7374 7269 6465 5f34 2c0a  =pool_stride_4,.
+0000cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb50: 2020 2020 2020 2020 6669 6c74 6572 5f35          filter_5
+0000cb60: 3d66 696c 7465 725f 352c 2066 696c 7465  =filter_5, filte
+0000cb70: 725f 7369 7a65 5f35 3d66 696c 7465 725f  r_size_5=filter_
+0000cb80: 7369 7a65 5f35 2c20 7374 7269 6465 735f  size_5, strides_
+0000cb90: 353d 7374 7269 6465 735f 352c 2070 6f6f  5=strides_5, poo
+0000cba0: 6c69 6e67 5f35 3d70 6f6f 6c69 6e67 5f35  ling_5=pooling_5
+0000cbb0: 2c20 706f 6f6c 5f73 697a 655f 353d 706f  , pool_size_5=po
+0000cbc0: 6f6c 5f73 697a 655f 352c 2070 6f6f 6c5f  ol_size_5, pool_
+0000cbd0: 7374 7269 6465 5f35 3d70 6f6f 6c5f 7374  stride_5=pool_st
+0000cbe0: 7269 6465 5f35 2c0a 2020 2020 2020 2020  ride_5,.        
+0000cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc00: 6465 6e73 655f 6e65 7572 6f6e 735f 313d  dense_neurons_1=
+0000cc10: 6465 6e73 655f 6e65 7572 6f6e 735f 312c  dense_neurons_1,
+0000cc20: 2064 656e 7365 5f6e 6575 726f 6e73 5f32   dense_neurons_2
+0000cc30: 3d64 656e 7365 5f6e 6575 726f 6e73 5f32  =dense_neurons_2
+0000cc40: 2c20 6472 6f70 6f75 745f 313d 6472 6f70  , dropout_1=drop
+0000cc50: 6f75 745f 312c 2064 726f 706f 7574 5f32  out_1, dropout_2
+0000cc60: 3d64 726f 706f 7574 5f32 2c20 0a20 2020  =dropout_2, .   
+0000cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc80: 2020 2020 2073 6d6f 7465 5f73 616d 706c       smote_sampl
+0000cc90: 696e 673d 7365 6c66 2e73 6d6f 7465 5f73  ing=self.smote_s
+0000cca0: 616d 706c 696e 672c 2065 6172 6c79 5f73  ampling, early_s
+0000ccb0: 746f 705f 6361 6c6c 6261 636b 3d63 616c  top_callback=cal
+0000ccc0: 6c62 6163 6b73 2c20 6368 6563 6b70 6f69  lbacks, checkpoi
+0000ccd0: 6e74 3d46 616c 7365 2c20 7665 7262 6f73  nt=False, verbos
+0000cce0: 653d 7365 6c66 2e76 6572 626f 7365 290a  e=self.verbose).
+0000ccf0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000cd00: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000cd10: 6c66 2e6f 7074 5f63 7620 6973 206e 6f74  lf.opt_cv is not
+0000cd20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000cd30: 2020 2020 2020 2070 7269 6e74 2829 3b20         print(); 
+0000cd40: 7072 696e 7428 272a 2a2a 2a2a 2a2a 2a2a  print('*********
+0000cd50: 2a2a 2020 4356 202d 2031 202a 2a2a 2a2a  **  CV - 1 *****
+0000cd60: 2a2a 2a2a 2a2a 2729 3b20 7072 696e 7428  ******'); print(
+0000cd70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000cd80: 2073 656c 662e 6f70 745f 6175 673a 0a20   self.opt_aug:. 
+0000cd90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000cda0: 7269 6e74 2829 3b20 7072 696e 7428 273d  rint(); print('=
+0000cdb0: 3d3d 3d3d 3d3d 2049 6d61 6765 2050 6172  ====== Image Par
+0000cdc0: 616d 6574 6572 7320 3d3d 3d3d 3d3d 2729  ameters ======')
+0000cdd0: 3b20 7072 696e 7428 293b 2070 7269 6e74  ; print(); print
+0000cde0: 2827 4e75 6d20 4175 676d 656e 7461 7469  ('Num Augmentati
+0000cdf0: 6f6e 7320 3a27 2c20 6e75 6d5f 6175 6729  ons :', num_aug)
+0000ce00: 3b20 7072 696e 7428 2749 6d61 6765 2053  ; print('Image S
+0000ce10: 697a 6520 3a20 272c 2069 6d61 6765 5f73  ize : ', image_s
+0000ce20: 697a 6529 3b20 7072 696e 7428 274d 6178  ize); print('Max
+0000ce30: 2050 6978 656c 2873 2920 3a27 2c20 6d61   Pixel(s) :', ma
+0000ce40: 785f 7069 7829 3b20 7072 696e 7428 274e  x_pix); print('N
+0000ce50: 756d 204d 6173 6b73 203a 272c 206e 756d  um Masks :', num
+0000ce60: 5f6d 6173 6b73 293b 2070 7269 6e74 2827  _masks); print('
+0000ce70: 4d61 736b 2053 697a 6520 3a27 2c20 6d61  Mask Size :', ma
+0000ce80: 736b 5f73 697a 6529 3b20 7072 696e 7428  sk_size); print(
+0000ce90: 2742 6c65 6e64 204d 756c 7469 706c 6965  'Blend Multiplie
+0000cea0: 7220 3a27 2c20 626c 656e 645f 6d75 6c74  r :', blend_mult
+0000ceb0: 6970 6c69 6572 293b 2070 7269 6e74 2827  iplier); print('
+0000cec0: 536b 6577 2041 6e67 6c65 203a 272c 2073  Skew Angle :', s
+0000ced0: 6b65 775f 616e 676c 6529 0a20 2020 2020  kew_angle).     
+0000cee0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000cef0: 7365 6c66 2e63 6c66 203d 3d20 2761 6c65  self.clf == 'ale
+0000cf00: 786e 6574 273a 0a20 2020 2020 2020 2020  xnet':.         
+0000cf10: 2020 2020 2020 206d 6f64 656c 2c20 6869         model, hi
+0000cf20: 7374 6f72 7920 3d20 636e 6e5f 6d6f 6465  story = cnn_mode
+0000cf30: 6c2e 416c 6578 4e65 7428 636c 6173 735f  l.AlexNet(class_
+0000cf40: 312c 2063 6c61 7373 5f32 2c20 696d 675f  1, class_2, img_
+0000cf50: 6e75 6d5f 6368 616e 6e65 6c73 3d73 656c  num_channels=sel
+0000cf60: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+0000cf70: 6c73 2c20 0a20 2020 2020 2020 2020 2020  ls, .           
+0000cf80: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
+0000cf90: 7a65 3d73 656c 662e 6e6f 726d 616c 697a  ze=self.normaliz
+0000cfa0: 652c 206d 696e 5f70 6978 656c 3d6d 696e  e, min_pixel=min
+0000cfb0: 5f70 6978 2c20 6d61 785f 7069 7865 6c3d  _pix, max_pixel=
+0000cfc0: 6d61 785f 7069 782c 2076 616c 5f70 6f73  max_pix, val_pos
+0000cfd0: 6974 6976 653d 7661 6c5f 636c 6173 735f  itive=val_class_
+0000cfe0: 312c 2076 616c 5f6e 6567 6174 6976 653d  1, val_negative=
+0000cff0: 7661 6c5f 636c 6173 735f 322c 200a 2020  val_class_2, .  
+0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d010: 2020 6570 6f63 6873 3d73 656c 662e 7472    epochs=self.tr
+0000d020: 6169 6e5f 6570 6f63 6873 2c20 6261 7463  ain_epochs, batc
+0000d030: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
+0000d040: 652c 206f 7074 696d 697a 6572 3d6f 7074  e, optimizer=opt
+0000d050: 696d 697a 6572 2c20 6c72 3d6c 722c 2064  imizer, lr=lr, d
+0000d060: 6563 6179 3d64 6563 6179 2c20 6d6f 6d65  ecay=decay, mome
+0000d070: 6e74 756d 3d6d 6f6d 656e 7475 6d2c 206e  ntum=momentum, n
+0000d080: 6573 7465 726f 763d 6e65 7374 6572 6f76  esterov=nesterov
+0000d090: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000d0a0: 2020 2020 2020 2062 6574 615f 313d 6265         beta_1=be
+0000d0b0: 7461 5f31 2c20 6265 7461 5f32 3d62 6574  ta_1, beta_2=bet
+0000d0c0: 615f 322c 2061 6d73 6772 6164 3d61 6d73  a_2, amsgrad=ams
+0000d0d0: 6772 6164 2c20 736d 6f74 655f 7361 6d70  grad, smote_samp
+0000d0e0: 6c69 6e67 3d73 656c 662e 736d 6f74 655f  ling=self.smote_
+0000d0f0: 7361 6d70 6c69 6e67 2c20 6561 726c 795f  sampling, early_
+0000d100: 7374 6f70 5f63 616c 6c62 6163 6b3d 6361  stop_callback=ca
+0000d110: 6c6c 6261 636b 732c 2063 6865 636b 706f  llbacks, checkpo
+0000d120: 696e 743d 4661 6c73 652c 2076 6572 626f  int=False, verbo
+0000d130: 7365 3d73 656c 662e 7665 7262 6f73 6529  se=self.verbose)
+0000d140: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000d150: 6620 7365 6c66 2e63 6c66 203d 3d20 2763  f self.clf == 'c
+0000d160: 7573 746f 6d5f 636e 6e27 3a0a 2020 2020  ustom_cnn':.    
+0000d170: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000d180: 6c2c 2068 6973 746f 7279 203d 2063 6e6e  l, history = cnn
+0000d190: 5f6d 6f64 656c 2e63 7573 746f 6d5f 6d6f  _model.custom_mo
+0000d1a0: 6465 6c28 636c 6173 735f 312c 2063 6c61  del(class_1, cla
+0000d1b0: 7373 5f32 2c20 696d 675f 6e75 6d5f 6368  ss_2, img_num_ch
+0000d1c0: 616e 6e65 6c73 3d73 656c 662e 696d 675f  annels=self.img_
+0000d1d0: 6e75 6d5f 6368 616e 6e65 6c73 2c20 0a20  num_channels, . 
+0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1f0: 2020 206e 6f72 6d61 6c69 7a65 3d73 656c     normalize=sel
+0000d200: 662e 6e6f 726d 616c 697a 652c 206d 696e  f.normalize, min
+0000d210: 5f70 6978 656c 3d6d 696e 5f70 6978 2c20  _pixel=min_pix, 
+0000d220: 6d61 785f 7069 7865 6c3d 6d61 785f 7069  max_pixel=max_pi
+0000d230: 782c 2076 616c 5f70 6f73 6974 6976 653d  x, val_positive=
+0000d240: 7661 6c5f 636c 6173 735f 312c 2076 616c  val_class_1, val
+0000d250: 5f6e 6567 6174 6976 653d 7661 6c5f 636c  _negative=val_cl
+0000d260: 6173 735f 322c 200a 2020 2020 2020 2020  ass_2, .        
+0000d270: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
+0000d280: 6873 3d73 656c 662e 7472 6169 6e5f 6570  hs=self.train_ep
+0000d290: 6f63 6873 2c20 6261 7463 685f 7369 7a65  ochs, batch_size
+0000d2a0: 3d62 6174 6368 5f73 697a 652c 206f 7074  =batch_size, opt
+0000d2b0: 696d 697a 6572 3d6f 7074 696d 697a 6572  imizer=optimizer
+0000d2c0: 2c20 6c72 3d6c 722c 2064 6563 6179 3d64  , lr=lr, decay=d
+0000d2d0: 6563 6179 2c20 6d6f 6d65 6e74 756d 3d6d  ecay, momentum=m
+0000d2e0: 6f6d 656e 7475 6d2c 206e 6573 7465 726f  omentum, nestero
+0000d2f0: 763d 6e65 7374 6572 6f76 2c20 0a20 2020  v=nesterov, .   
+0000d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d310: 2062 6574 615f 313d 6265 7461 5f31 2c20   beta_1=beta_1, 
+0000d320: 6265 7461 5f32 3d62 6574 615f 322c 2061  beta_2=beta_2, a
+0000d330: 6d73 6772 6164 3d61 6d73 6772 6164 2c20  msgrad=amsgrad, 
+0000d340: 736d 6f74 655f 7361 6d70 6c69 6e67 3d73  smote_sampling=s
+0000d350: 656c 662e 736d 6f74 655f 7361 6d70 6c69  elf.smote_sampli
+0000d360: 6e67 2c20 6561 726c 795f 7374 6f70 5f63  ng, early_stop_c
+0000d370: 616c 6c62 6163 6b3d 6361 6c6c 6261 636b  allback=callback
+0000d380: 732c 2063 6865 636b 706f 696e 743d 4661  s, checkpoint=Fa
+0000d390: 6c73 652c 2076 6572 626f 7365 3d73 656c  lse, verbose=sel
+0000d3a0: 662e 7665 7262 6f73 6529 0a20 2020 2020  f.verbose).     
+0000d3b0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000d3c0: 2e63 6c66 203d 3d20 2776 6767 3136 273a  .clf == 'vgg16':
+0000d3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3e0: 206d 6f64 656c 2c20 6869 7374 6f72 7920   model, history 
+0000d3f0: 3d20 636e 6e5f 6d6f 6465 6c2e 5647 4731  = cnn_model.VGG1
+0000d400: 3628 636c 6173 735f 312c 2063 6c61 7373  6(class_1, class
+0000d410: 5f32 2c20 696d 675f 6e75 6d5f 6368 616e  _2, img_num_chan
+0000d420: 6e65 6c73 3d73 656c 662e 696d 675f 6e75  nels=self.img_nu
+0000d430: 6d5f 6368 616e 6e65 6c73 2c20 0a20 2020  m_channels, .   
+0000d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d450: 206e 6f72 6d61 6c69 7a65 3d73 656c 662e   normalize=self.
+0000d460: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
+0000d470: 6978 656c 3d6d 696e 5f70 6978 2c20 6d61  ixel=min_pix, ma
+0000d480: 785f 7069 7865 6c3d 6d61 785f 7069 782c  x_pixel=max_pix,
+0000d490: 2076 616c 5f70 6f73 6974 6976 653d 7661   val_positive=va
+0000d4a0: 6c5f 636c 6173 735f 312c 2076 616c 5f6e  l_class_1, val_n
+0000d4b0: 6567 6174 6976 653d 7661 6c5f 636c 6173  egative=val_clas
+0000d4c0: 735f 322c 200a 2020 2020 2020 2020 2020  s_2, .          
+0000d4d0: 2020 2020 2020 2020 2020 6570 6f63 6873            epochs
+0000d4e0: 3d73 656c 662e 7472 6169 6e5f 6570 6f63  =self.train_epoc
+0000d4f0: 6873 2c20 6261 7463 685f 7369 7a65 3d62  hs, batch_size=b
+0000d500: 6174 6368 5f73 697a 652c 206f 7074 696d  atch_size, optim
+0000d510: 697a 6572 3d6f 7074 696d 697a 6572 2c20  izer=optimizer, 
+0000d520: 6c72 3d6c 722c 2064 6563 6179 3d64 6563  lr=lr, decay=dec
+0000d530: 6179 2c20 6d6f 6d65 6e74 756d 3d6d 6f6d  ay, momentum=mom
+0000d540: 656e 7475 6d2c 206e 6573 7465 726f 763d  entum, nesterov=
+0000d550: 6e65 7374 6572 6f76 2c20 0a20 2020 2020  nesterov, .     
+0000d560: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000d570: 6574 615f 313d 6265 7461 5f31 2c20 6265  eta_1=beta_1, be
+0000d580: 7461 5f32 3d62 6574 615f 322c 2061 6d73  ta_2=beta_2, ams
+0000d590: 6772 6164 3d61 6d73 6772 6164 2c20 736d  grad=amsgrad, sm
+0000d5a0: 6f74 655f 7361 6d70 6c69 6e67 3d73 656c  ote_sampling=sel
+0000d5b0: 662e 736d 6f74 655f 7361 6d70 6c69 6e67  f.smote_sampling
+0000d5c0: 2c20 6561 726c 795f 7374 6f70 5f63 616c  , early_stop_cal
+0000d5d0: 6c62 6163 6b3d 6361 6c6c 6261 636b 732c  lback=callbacks,
+0000d5e0: 2063 6865 636b 706f 696e 743d 4661 6c73   checkpoint=Fals
+0000d5f0: 652c 2076 6572 626f 7365 3d73 656c 662e  e, verbose=self.
+0000d600: 7665 7262 6f73 6529 0a20 2020 2020 2020  verbose).       
+0000d610: 2020 2020 2065 6c69 6620 7365 6c66 2e63       elif self.c
+0000d620: 6c66 203d 3d20 2772 6573 6e65 7431 3827  lf == 'resnet18'
+0000d630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d640: 2020 6d6f 6465 6c2c 2068 6973 746f 7279    model, history
+0000d650: 203d 2063 6e6e 5f6d 6f64 656c 2e52 6573   = cnn_model.Res
+0000d660: 6e65 7431 3828 636c 6173 735f 312c 2063  net18(class_1, c
+0000d670: 6c61 7373 5f32 2c20 696d 675f 6e75 6d5f  lass_2, img_num_
+0000d680: 6368 616e 6e65 6c73 3d73 656c 662e 696d  channels=self.im
+0000d690: 675f 6e75 6d5f 6368 616e 6e65 6c73 2c20  g_num_channels, 
+0000d6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d6b0: 2020 2020 206e 6f72 6d61 6c69 7a65 3d73       normalize=s
+0000d6c0: 656c 662e 6e6f 726d 616c 697a 652c 206d  elf.normalize, m
+0000d6d0: 696e 5f70 6978 656c 3d6d 696e 5f70 6978  in_pixel=min_pix
+0000d6e0: 2c20 6d61 785f 7069 7865 6c3d 6d61 785f  , max_pixel=max_
+0000d6f0: 7069 782c 2076 616c 5f70 6f73 6974 6976  pix, val_positiv
+0000d700: 653d 7661 6c5f 636c 6173 735f 312c 2076  e=val_class_1, v
+0000d710: 616c 5f6e 6567 6174 6976 653d 7661 6c5f  al_negative=val_
+0000d720: 636c 6173 735f 322c 200a 2020 2020 2020  class_2, .      
+0000d730: 2020 2020 2020 2020 2020 2020 2020 6570                ep
+0000d740: 6f63 6873 3d73 656c 662e 7472 6169 6e5f  ochs=self.train_
+0000d750: 6570 6f63 6873 2c20 6261 7463 685f 7369  epochs, batch_si
+0000d760: 7a65 3d62 6174 6368 5f73 697a 652c 206f  ze=batch_size, o
+0000d770: 7074 696d 697a 6572 3d6f 7074 696d 697a  ptimizer=optimiz
+0000d780: 6572 2c20 6c72 3d6c 722c 2064 6563 6179  er, lr=lr, decay
+0000d790: 3d64 6563 6179 2c20 6d6f 6d65 6e74 756d  =decay, momentum
+0000d7a0: 3d6d 6f6d 656e 7475 6d2c 206e 6573 7465  =momentum, neste
+0000d7b0: 726f 763d 6e65 7374 6572 6f76 2c20 0a20  rov=nesterov, . 
+0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7d0: 2020 2062 6574 615f 313d 6265 7461 5f31     beta_1=beta_1
+0000d7e0: 2c20 6265 7461 5f32 3d62 6574 615f 322c  , beta_2=beta_2,
+0000d7f0: 2061 6d73 6772 6164 3d61 6d73 6772 6164   amsgrad=amsgrad
+0000d800: 2c20 736d 6f74 655f 7361 6d70 6c69 6e67  , smote_sampling
+0000d810: 3d73 656c 662e 736d 6f74 655f 7361 6d70  =self.smote_samp
+0000d820: 6c69 6e67 2c20 6561 726c 795f 7374 6f70  ling, early_stop
+0000d830: 5f63 616c 6c62 6163 6b3d 6361 6c6c 6261  _callback=callba
+0000d840: 636b 732c 2063 6865 636b 706f 696e 743d  cks, checkpoint=
+0000d850: 4661 6c73 652c 2076 6572 626f 7365 3d73  False, verbose=s
+0000d860: 656c 662e 7665 7262 6f73 6529 0a0a 2020  elf.verbose)..  
+0000d870: 2020 2020 2020 2349 6620 7468 6520 7061        #If the pa
+0000d880: 7469 656e 6365 2069 7320 7265 6163 6865  tience is reache
+0000d890: 6420 2d2d 2072 6574 7572 6e20 7368 6f75  d -- return shou
+0000d8a0: 6c64 2062 6520 6120 7661 6c75 6520 7468  ld be a value th
+0000d8b0: 6174 2063 6f6e 7461 696e 7320 696e 666f  at contains info
+0000d8c0: 726d 6174 696f 6e20 7265 6761 7264 696e  rmation regardin
+0000d8d0: 6720 7468 6520 6e75 6d20 6f66 2063 6f6d  g the num of com
+0000d8e0: 706c 6574 6564 2065 706f 6368 732c 206f  pleted epochs, o
+0000d8f0: 7468 6572 7769 7365 2069 6620 7265 7475  therwise if retu
+0000d900: 726e 2030 2065 7665 7279 2074 696d 6520  rn 0 every time 
+0000d910: 7468 656e 2074 6865 206f 7074 696d 697a  then the optimiz
+0000d920: 6572 2077 696c 6c20 6765 7420 7374 7563  er will get stuc
+0000d930: 6b23 0a20 2020 2020 2020 2069 6620 6c65  k#.        if le
+0000d940: 6e28 6869 7374 6f72 792e 6869 7374 6f72  n(history.histor
+0000d950: 795b 276c 6f73 7327 5d29 2021 3d20 7365  y['loss']) != se
+0000d960: 6c66 2e74 7261 696e 5f65 706f 6368 733a  lf.train_epochs:
+0000d970: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000d980: 6e74 2829 3b20 7072 696e 7428 2754 7261  nt(); print('Tra
+0000d990: 696e 696e 6720 7061 7469 656e 6365 2077  ining patience w
+0000d9a0: 6173 2072 6561 6368 6564 2e2e 2e27 293b  as reached...');
+0000d9b0: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
+0000d9c0: 2020 2020 2072 6574 7572 6e20 286c 656e       return (len
+0000d9d0: 2868 6973 746f 7279 2e68 6973 746f 7279  (history.history
+0000d9e0: 5b27 6c6f 7373 275d 2920 2a20 302e 3030  ['loss']) * 0.00
+0000d9f0: 3129 202d 2039 3939 2e30 0a0a 2020 2020  1) - 999.0..    
+0000da00: 2020 2020 2349 6620 7468 6520 6f75 7470      #If the outp
+0000da10: 7574 2069 7320 6e61 6e0a 2020 2020 2020  ut is nan.      
+0000da20: 2020 6966 206e 702e 6973 6669 6e69 7465    if np.isfinite
+0000da30: 2868 6973 746f 7279 2e68 6973 746f 7279  (history.history
+0000da40: 5b27 6c6f 7373 275d 5b2d 315d 293a 0a20  ['loss'][-1]):. 
+0000da50: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0000da60: 732c 2068 6973 746f 7269 6573 203d 205b  s, histories = [
+0000da70: 5d2c 205b 5d20 2357 696c 6c20 6265 2075  ], [] #Will be u
+0000da80: 7365 6420 746f 2061 7070 656e 6420 6164  sed to append ad
+0000da90: 6469 7469 6f6e 616c 206d 6f64 656c 732c  ditional models,
+0000daa0: 2069 7420 6f70 745f 6376 2069 7320 656e   it opt_cv is en
+0000dab0: 6162 6c65 640a 2020 2020 2020 2020 2020  abled.          
+0000dac0: 2020 6d6f 6465 6c73 2e61 7070 656e 6428    models.append(
+0000dad0: 6d6f 6465 6c29 2c20 6869 7374 6f72 6965  model), historie
+0000dae0: 732e 6170 7065 6e64 2868 6973 746f 7279  s.append(history
+0000daf0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000db00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000db10: 7428 293b 2070 7269 6e74 2827 5472 6169  t(); print('Trai
+0000db20: 6e69 6e67 2066 6169 6c65 6420 6475 6520  ning failed due 
+0000db30: 746f 206e 756d 6572 6963 616c 2069 6e73  to numerical ins
+0000db40: 7461 6269 6c69 7479 2c20 7265 7475 726e  tability, return
+0000db50: 696e 6720 6e61 6e2e 2e2e 2729 0a20 2020  ing nan...').   
+0000db60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000db70: 6e70 2e6e 616e 200a 0a20 2020 2020 2020  np.nan ..       
+0000db80: 2023 2323 2323 2043 726f 7373 2d56 616c   ##### Cross-Val
+0000db90: 6964 6174 696f 6e20 526f 7574 696e 6520  idation Routine 
+0000dba0: 2d20 696d 706c 656d 656e 7461 7469 6f6e  - implementation
+0000dbb0: 2069 6e20 7768 6963 6820 7468 6520 7661   in which the va
+0000dbc0: 6c69 6461 7469 6f6e 2064 6174 6120 6973  lidation data is
+0000dbd0: 2069 6e73 6572 7465 6420 696e 746f 2074   inserted into t
+0000dbe0: 6865 2074 7261 696e 696e 6720 6461 7461  he training data
+0000dbf0: 2077 6974 6820 7468 6520 7265 706c 6163   with the replac
+0000dc00: 656d 656e 7420 7365 7276 696e 6720 6173  ement serving as
+0000dc10: 2074 6865 206e 6577 2076 616c 6964 6174   the new validat
+0000dc20: 696f 6e23 2323 2323 0a20 2020 2020 2020  ion#####.       
+0000dc30: 2069 6620 7365 6c66 2e6f 7074 5f63 7620   if self.opt_cv 
+0000dc40: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000dc50: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000dc60: 2e76 616c 5f70 6f73 6974 6976 6520 6973  .val_positive is
+0000dc70: 204e 6f6e 6520 616e 6420 7365 6c66 2e76   None and self.v
+0000dc80: 616c 5f6e 6567 6174 6976 6520 6973 204e  al_negative is N
+0000dc90: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000dca0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000dcb0: 4572 726f 7228 2743 4e4e 2063 726f 7373  Error('CNN cross
+0000dcc0: 2d76 616c 6964 6174 696f 6e20 6973 206f  -validation is o
+0000dcd0: 6e6c 7920 7375 7070 6f72 7465 6420 6966  nly supported if
+0000dce0: 2076 616c 6964 6174 696f 6e20 6461 7461   validation data
+0000dcf0: 2069 7320 696e 7075 742e 2729 0a20 2020   is input.').   
+0000dd00: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000dd10: 2e76 616c 5f70 6f73 6974 6976 6520 6973  .val_positive is
+0000dd20: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000dd30: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0000dd40: 6e28 7365 6c66 2e70 6f73 6974 6976 655f  n(self.positive_
+0000dd50: 636c 6173 7329 202f 206c 656e 2873 656c  class) / len(sel
+0000dd60: 662e 7661 6c5f 706f 7369 7469 7665 2920  f.val_positive) 
+0000dd70: 3c20 7365 6c66 2e6f 7074 5f63 762d 313a  < self.opt_cv-1:
+0000dd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd90: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000dda0: 4572 726f 7228 2743 616e 6e6f 7420 6576  Error('Cannot ev
+0000ddb0: 656e 6c79 2070 6172 7469 7469 6f6e 2074  enly partition t
+0000ddc0: 6865 2070 6f73 6974 6976 6520 7472 6169  he positive trai
+0000ddd0: 6e69 6e67 2f76 616c 6964 6174 696f 6e20  ning/validation 
+0000dde0: 6461 7461 2c20 7265 6665 7220 746f 2074  data, refer to t
+0000ddf0: 6865 2070 7942 4941 2041 5049 2064 6f63  he pyBIA API doc
+0000de00: 756d 656e 7461 7469 6f6e 2066 6f72 2069  umentation for i
+0000de10: 6e73 7472 7563 7469 6f6e 7320 6f6e 2068  nstructions on h
+0000de20: 6f77 2074 6f20 7573 6520 7468 6520 6f70  ow to use the op
+0000de30: 745f 6376 2070 6172 616d 6574 6572 2e27  t_cv parameter.'
+0000de40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000de50: 2073 656c 662e 7661 6c5f 6e65 6761 7469   self.val_negati
+0000de60: 7665 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ve is not None:.
+0000de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de80: 6966 206c 656e 2873 656c 662e 6e65 6761  if len(self.nega
+0000de90: 7469 7665 5f63 6c61 7373 2920 2f20 6c65  tive_class) / le
+0000dea0: 6e28 7365 6c66 2e76 616c 5f6e 6567 6174  n(self.val_negat
+0000deb0: 6976 6529 203c 2073 656c 662e 6f70 745f  ive) < self.opt_
+0000dec0: 6376 2d31 3a0a 2020 2020 2020 2020 2020  cv-1:.          
+0000ded0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000dee0: 5661 6c75 6545 7272 6f72 2827 4361 6e6e  ValueError('Cann
+0000def0: 6f74 2065 7665 6e6c 7920 7061 7274 6974  ot evenly partit
+0000df00: 696f 6e20 7468 6520 6e65 6761 7469 7665  ion the negative
+0000df10: 2074 7261 696e 696e 672f 7661 6c69 6461   training/valida
+0000df20: 7469 6f6e 2064 6174 612c 2072 6566 6572  tion data, refer
+0000df30: 2074 6f20 7468 6520 7079 4249 4120 4150   to the pyBIA AP
+0000df40: 4920 646f 6375 6d65 6e74 6174 696f 6e20  I documentation 
+0000df50: 666f 7220 696e 7374 7275 6374 696f 6e73  for instructions
+0000df60: 206f 6e20 686f 7720 746f 2075 7365 2074   on how to use t
+0000df70: 6865 206f 7074 5f63 7620 7061 7261 6d65  he opt_cv parame
+0000df80: 7465 722e 2729 0a20 2020 2020 2020 2020  ter.').         
+0000df90: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0000dfa0: 2354 6865 2066 6972 7374 206d 6f64 656c  #The first model
+0000dfb0: 2028 7468 6572 6566 6f72 6520 7468 6520   (therefore the 
+0000dfc0: 6669 7273 7420 2266 6f6c 6422 2920 616c  first "fold") al
+0000dfd0: 7265 6164 7920 7261 6e2c 2074 6865 7265  ready ran, there
+0000dfe0: 666f 7265 2073 7574 6272 6163 7420 3120  fore sutbract 1 
+0000dff0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0000e000: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
+0000e010: 2873 656c 662e 6f70 745f 6376 2d31 293a  (self.opt_cv-1):
+0000e020: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0000e030: 2020 2020 2020 2020 2020 2023 4d61 6b65             #Make
+0000e040: 2064 6565 7020 636f 7069 6573 2074 6f20   deep copies to 
+0000e050: 6176 6f69 6420 6f76 6572 7772 6974 696e  avoid overwritin
+0000e060: 6720 6172 7261 7973 0a20 2020 2020 2020  g arrays.       
+0000e070: 2020 2020 2020 2020 2063 6c61 7373 5f31           class_1
+0000e080: 2c20 636c 6173 735f 3220 3d20 636f 7079  , class_2 = copy
+0000e090: 2e64 6565 7063 6f70 7928 7365 6c66 2e70  .deepcopy(self.p
+0000e0a0: 6f73 6974 6976 655f 636c 6173 7329 2c20  ositive_class), 
+0000e0b0: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+0000e0c0: 6c66 2e6e 6567 6174 6976 655f 636c 6173  lf.negative_clas
+0000e0d0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000e0e0: 2020 2076 616c 5f63 6c61 7373 5f31 2c20     val_class_1, 
+0000e0f0: 7661 6c5f 636c 6173 735f 3220 3d20 636f  val_class_2 = co
+0000e100: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
+0000e110: 2e76 616c 5f70 6f73 6974 6976 6529 2c20  .val_positive), 
+0000e120: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+0000e130: 6c66 2e76 616c 5f6e 6567 6174 6976 6529  lf.val_negative)
+0000e140: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e150: 2020 2353 6f72 7420 7468 6520 6e65 7720    #Sort the new 
+0000e160: 6461 7461 2073 616d 706c 6573 2c20 6e6f  data samples, no
+0000e170: 2072 616e 646f 6d20 7368 7566 666c 696e   random shufflin
+0000e180: 672c 206a 7573 7420 6120 6c69 6e65 6172  g, just a linear
+0000e190: 2073 6571 7565 6e63 650a 2020 2020 2020   sequence.      
+0000e1a0: 2020 2020 2020 2020 2020 6966 2076 616c            if val
+0000e1b0: 5f63 6c61 7373 5f31 2069 7320 6e6f 7420  _class_1 is not 
+0000e1c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000e1d0: 2020 2020 2020 2020 2020 7661 6c5f 686f            val_ho
+0000e1e0: 6c64 5f31 203d 2063 6f70 792e 6465 6570  ld_1 = copy.deep
+0000e1f0: 636f 7079 2863 6c61 7373 5f31 5b6b 2a6c  copy(class_1[k*l
+0000e200: 656e 2876 616c 5f63 6c61 7373 5f31 293a  en(val_class_1):
+0000e210: 6c65 6e28 7661 6c5f 636c 6173 735f 3129  len(val_class_1)
+0000e220: 2a28 6b2b 3129 5d29 2023 5468 6520 6e65  *(k+1)]) #The ne
+0000e230: 7720 706f 7369 7469 7665 2076 616c 6964  w positive valid
+0000e240: 6174 696f 6e20 6461 7461 0a20 2020 2020  ation data.     
+0000e250: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000e260: 6c61 7373 5f31 5b6b 2a6c 656e 2876 616c  lass_1[k*len(val
+0000e270: 5f63 6c61 7373 5f31 293a 6c65 6e28 7661  _class_1):len(va
+0000e280: 6c5f 636c 6173 735f 3129 2a28 6b2b 3129  l_class_1)*(k+1)
+0000e290: 5d20 3d20 636f 7079 2e64 6565 7063 6f70  ] = copy.deepcop
+0000e2a0: 7928 7661 6c5f 636c 6173 735f 3129 2023  y(val_class_1) #
+0000e2b0: 5468 6520 6e65 7720 636c 6173 735f 312c  The new class_1,
+0000e2c0: 2063 6f70 7969 6e67 2074 6f20 6176 6f69   copying to avoi
+0000e2d0: 6420 6c69 6e6b 6167 6520 6265 7477 6565  d linkage betwee
+0000e2e0: 6e20 6172 7261 7973 0a20 2020 2020 2020  n arrays.       
+0000e2f0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0000e300: 5f63 6c61 7373 5f31 203d 2076 616c 5f68  _class_1 = val_h
+0000e310: 6f6c 645f 3120 0a20 2020 2020 2020 2020  old_1 .         
+0000e320: 2020 2020 2020 2069 6620 7661 6c5f 636c         if val_cl
+0000e330: 6173 735f 3220 6973 206e 6f74 204e 6f6e  ass_2 is not Non
+0000e340: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000e350: 2020 2020 2020 2076 616c 5f68 6f6c 645f         val_hold_
+0000e360: 3220 3d20 636f 7079 2e64 6565 7063 6f70  2 = copy.deepcop
+0000e370: 7928 636c 6173 735f 325b 6b2a 6c65 6e28  y(class_2[k*len(
+0000e380: 7661 6c5f 636c 6173 735f 3229 3a6c 656e  val_class_2):len
+0000e390: 2876 616c 5f63 6c61 7373 5f32 292a 286b  (val_class_2)*(k
+0000e3a0: 2b31 295d 2920 2354 6865 206e 6577 2076  +1)]) #The new v
+0000e3b0: 616c 6964 6174 696f 6e20 6461 7461 0a20  alidation data. 
+0000e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3d0: 2020 2063 6c61 7373 5f32 5b6b 2a6c 656e     class_2[k*len
+0000e3e0: 2876 616c 5f63 6c61 7373 5f32 293a 6c65  (val_class_2):le
+0000e3f0: 6e28 7661 6c5f 636c 6173 735f 3229 2a28  n(val_class_2)*(
+0000e400: 6b2b 3129 5d20 3d20 636f 7079 2e64 6565  k+1)] = copy.dee
+0000e410: 7063 6f70 7928 7661 6c5f 636c 6173 735f  pcopy(val_class_
+0000e420: 3229 2023 5468 6520 6e65 7720 636c 6173  2) #The new clas
+0000e430: 735f 322c 2063 6f70 7969 6e67 2074 6f20  s_2, copying to 
+0000e440: 6176 6f69 6420 6c69 6e6b 6167 6520 6265  avoid linkage be
+0000e450: 7477 6565 6e20 6172 7261 7973 0a20 2020  tween arrays.   
+0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e470: 2076 616c 5f63 6c61 7373 5f32 203d 2076   val_class_2 = v
+0000e480: 616c 5f68 6f6c 645f 3220 0a0a 2020 2020  al_hold_2 ..    
+0000e490: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000e4a0: 656c 662e 6f70 745f 6175 673a 0a20 2020  elf.opt_aug:.   
+0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4c0: 2069 6620 7365 6c66 2e69 6d67 5f6e 756d   if self.img_num
+0000e4d0: 5f63 6861 6e6e 656c 7320 3d3d 2031 3a0a  _channels == 1:.
+0000e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4f0: 2020 2020 2020 2020 6368 616e 6e65 6c31          channel1
+0000e500: 2c20 6368 616e 6e65 6c32 2c20 6368 616e  , channel2, chan
+0000e510: 6e65 6c33 203d 2063 6f70 792e 6465 6570  nel3 = copy.deep
+0000e520: 636f 7079 2863 6c61 7373 5f31 292c 204e  copy(class_1), N
+0000e530: 6f6e 652c 204e 6f6e 6520 0a20 2020 2020  one, None .     
+0000e540: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000e550: 6c69 6620 7365 6c66 2e69 6d67 5f6e 756d  lif self.img_num
+0000e560: 5f63 6861 6e6e 656c 7320 3d3d 2032 3a0a  _channels == 2:.
+0000e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e580: 2020 2020 2020 2020 6368 616e 6e65 6c31          channel1
+0000e590: 2c20 6368 616e 6e65 6c32 2c20 6368 616e  , channel2, chan
+0000e5a0: 6e65 6c33 203d 2063 6f70 792e 6465 6570  nel3 = copy.deep
+0000e5b0: 636f 7079 2863 6c61 7373 5f31 5b3a 2c3a  copy(class_1[:,:
+0000e5c0: 2c3a 2c30 5d29 2c20 636f 7079 2e64 6565  ,:,0]), copy.dee
+0000e5d0: 7063 6f70 7928 636c 6173 735f 315b 3a2c  pcopy(class_1[:,
+0000e5e0: 3a2c 3a2c 315d 292c 204e 6f6e 6520 0a20  :,:,1]), None . 
+0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e600: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e620: 2063 6861 6e6e 656c 312c 2063 6861 6e6e   channel1, chann
+0000e630: 656c 322c 2063 6861 6e6e 656c 3320 3d20  el2, channel3 = 
+0000e640: 636f 7079 2e64 6565 7063 6f70 7928 636c  copy.deepcopy(cl
+0000e650: 6173 735f 315b 3a2c 3a2c 3a2c 305d 292c  ass_1[:,:,:,0]),
+0000e660: 2063 6f70 792e 6465 6570 636f 7079 2863   copy.deepcopy(c
+0000e670: 6c61 7373 5f31 5b3a 2c3a 2c3a 2c31 5d29  lass_1[:,:,:,1])
+0000e680: 2c20 636f 7079 2e64 6565 7063 6f70 7928  , copy.deepcopy(
+0000e690: 636c 6173 735f 315b 3a2c 3a2c 3a2c 325d  class_1[:,:,:,2]
+0000e6a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000e6b0: 2020 2020 2020 2061 7567 6d65 6e74 6564         augmented
+0000e6c0: 5f69 6d61 6765 7320 3d20 6175 676d 656e  _images = augmen
+0000e6d0: 7461 7469 6f6e 2863 6861 6e6e 656c 313d  tation(channel1=
+0000e6e0: 6368 616e 6e65 6c31 2c20 6368 616e 6e65  channel1, channe
+0000e6f0: 6c32 3d63 6861 6e6e 656c 322c 2063 6861  l2=channel2, cha
+0000e700: 6e6e 656c 333d 6368 616e 6e65 6c33 2c20  nnel3=channel3, 
+0000e710: 6261 7463 683d 6e75 6d5f 6175 672c 200a  batch=num_aug, .
+0000e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e730: 2020 2020 2020 2020 7769 6474 685f 7368          width_sh
+0000e740: 6966 743d 7365 6c66 2e73 6869 6674 2c20  ift=self.shift, 
+0000e750: 6865 6967 6874 5f73 6869 6674 3d73 656c  height_shift=sel
+0000e760: 662e 7368 6966 742c 2068 6f72 697a 6f6e  f.shift, horizon
+0000e770: 7461 6c3d 686f 7269 7a6f 6e74 616c 2c20  tal=horizontal, 
+0000e780: 7665 7274 6963 616c 3d76 6572 7469 6361  vertical=vertica
+0000e790: 6c2c 2072 6f74 6174 696f 6e3d 726f 7461  l, rotation=rota
+0000e7a0: 7469 6f6e 2c20 0a20 2020 2020 2020 2020  tion, .         
+0000e7b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000e7c0: 6d61 6765 5f73 697a 653d 696d 6167 655f  mage_size=image_
+0000e7d0: 7369 7a65 2c20 6d61 736b 5f73 697a 653d  size, mask_size=
+0000e7e0: 6d61 736b 5f73 697a 652c 206e 756d 5f6d  mask_size, num_m
+0000e7f0: 6173 6b73 3d6e 756d 5f6d 6173 6b73 2c20  asks=num_masks, 
+0000e800: 626c 656e 645f 6d75 6c74 6970 6c69 6572  blend_multiplier
+0000e810: 3d62 6c65 6e64 5f6d 756c 7469 706c 6965  =blend_multiplie
+0000e820: 722c 200a 2020 2020 2020 2020 2020 2020  r, .            
+0000e830: 2020 2020 2020 2020 2020 2020 626c 656e              blen
+0000e840: 6469 6e67 5f66 756e 633d 7365 6c66 2e62  ding_func=self.b
+0000e850: 6c65 6e64 696e 675f 6675 6e63 2c20 6e75  lending_func, nu
+0000e860: 6d5f 696d 6167 6573 5f74 6f5f 626c 656e  m_images_to_blen
+0000e870: 643d 7365 6c66 2e6e 756d 5f69 6d61 6765  d=self.num_image
+0000e880: 735f 746f 5f62 6c65 6e64 2c20 7a6f 6f6d  s_to_blend, zoom
+0000e890: 5f72 616e 6765 3d73 656c 662e 7a6f 6f6d  _range=self.zoom
+0000e8a0: 5f72 616e 6765 2c20 736b 6577 5f61 6e67  _range, skew_ang
+0000e8b0: 6c65 3d73 6b65 775f 616e 676c 6529 0a0a  le=skew_angle)..
+0000e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8d0: 2020 2020 6966 2073 656c 662e 696d 675f      if self.img_
+0000e8e0: 6e75 6d5f 6368 616e 6e65 6c73 203e 2031  num_channels > 1
+0000e8f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e900: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+0000e910: 313d 5b5d 0a20 2020 2020 2020 2020 2020  1=[].           
+0000e920: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000e930: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
+0000e940: 6e6e 656c 7320 3d3d 2032 3a0a 2020 2020  nnels == 2:.    
+0000e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e960: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0000e970: 2072 616e 6765 286c 656e 2861 7567 6d65   range(len(augme
+0000e980: 6e74 6564 5f69 6d61 6765 735b 305d 2929  nted_images[0]))
+0000e990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9b0: 2020 636c 6173 735f 312e 6170 7065 6e64    class_1.append
+0000e9c0: 2864 6174 615f 7072 6f63 6573 7369 6e67  (data_processing
+0000e9d0: 2e63 6f6e 6361 745f 6368 616e 6e65 6c73  .concat_channels
+0000e9e0: 2861 7567 6d65 6e74 6564 5f69 6d61 6765  (augmented_image
+0000e9f0: 735b 305d 5b69 5d2c 2061 7567 6d65 6e74  s[0][i], augment
+0000ea00: 6564 5f69 6d61 6765 735b 315d 5b69 5d29  ed_images[1][i])
+0000ea10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ea20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000ea50: 6920 696e 2072 616e 6765 286c 656e 2861  i in range(len(a
+0000ea60: 7567 6d65 6e74 6564 5f69 6d61 6765 735b  ugmented_images[
+0000ea70: 305d 2929 3a0a 2020 2020 2020 2020 2020  0])):.          
+0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea90: 2020 2020 2020 636c 6173 735f 312e 6170        class_1.ap
+0000eaa0: 7065 6e64 2864 6174 615f 7072 6f63 6573  pend(data_proces
+0000eab0: 7369 6e67 2e63 6f6e 6361 745f 6368 616e  sing.concat_chan
+0000eac0: 6e65 6c73 2861 7567 6d65 6e74 6564 5f69  nels(augmented_i
+0000ead0: 6d61 6765 735b 305d 5b69 5d2c 2061 7567  mages[0][i], aug
+0000eae0: 6d65 6e74 6564 5f69 6d61 6765 735b 315d  mented_images[1]
+0000eaf0: 5b69 5d2c 2061 7567 6d65 6e74 6564 5f69  [i], augmented_i
+0000eb00: 6d61 6765 735b 325d 5b69 5d29 290a 2020  mages[2][i])).  
+0000eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb20: 2020 2020 2020 636c 6173 735f 3120 3d20        class_1 = 
+0000eb30: 6e70 2e61 7272 6179 2863 6c61 7373 5f31  np.array(class_1
+0000eb40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000eb50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb70: 2020 2020 636c 6173 735f 3120 3d20 6175      class_1 = au
+0000eb80: 676d 656e 7465 645f 696d 6167 6573 0a0a  gmented_images..
+0000eb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eba0: 2020 2020 2350 6572 666f 726d 2073 616d      #Perform sam
+0000ebb0: 6520 6175 676d 656e 7461 7469 6f6e 2074  e augmentation t
+0000ebc0: 6563 686e 6971 7565 7320 6f6e 206e 6567  echniques on neg
+0000ebd0: 6174 6976 6520 636c 6173 7320 6461 7461  ative class data
+0000ebe0: 2c20 6261 7463 685f 6f74 6865 723d 3120  , batch_other=1 
+0000ebf0: 6279 2064 6566 6175 6c74 0a20 2020 2020  by default.     
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ec10: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
+0000ec20: 6861 6e6e 656c 7320 3d3d 2031 3a0a 2020  hannels == 1:.  
+0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec40: 2020 2020 2020 6368 616e 6e65 6c31 2c20        channel1, 
+0000ec50: 6368 616e 6e65 6c32 2c20 6368 616e 6e65  channel2, channe
+0000ec60: 6c33 203d 2063 6f70 792e 6465 6570 636f  l3 = copy.deepco
+0000ec70: 7079 2863 6c61 7373 5f32 292c 204e 6f6e  py(class_2), Non
+0000ec80: 652c 204e 6f6e 6520 0a20 2020 2020 2020  e, None .       
+0000ec90: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0000eca0: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
+0000ecb0: 6861 6e6e 656c 7320 3d3d 2032 3a0a 2020  hannels == 2:.  
+0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecd0: 2020 2020 2020 6368 616e 6e65 6c31 2c20        channel1, 
+0000ece0: 6368 616e 6e65 6c32 2c20 6368 616e 6e65  channel2, channe
+0000ecf0: 6c33 203d 2063 6f70 792e 6465 6570 636f  l3 = copy.deepco
+0000ed00: 7079 2863 6c61 7373 5f32 5b3a 2c3a 2c3a  py(class_2[:,:,:
+0000ed10: 2c30 5d29 2c20 636f 7079 2e64 6565 7063  ,0]), copy.deepc
+0000ed20: 6f70 7928 636c 6173 735f 325b 3a2c 3a2c  opy(class_2[:,:,
+0000ed30: 3a2c 315d 292c 204e 6f6e 6520 0a20 2020  :,1]), None .   
+0000ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed50: 2065 6c69 6620 7365 6c66 2e69 6d67 5f6e   elif self.img_n
+0000ed60: 756d 5f63 6861 6e6e 656c 7320 3d3d 2033  um_channels == 3
+0000ed70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ed80: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
+0000ed90: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
+0000eda0: 616e 6e65 6c33 203d 2063 6f70 792e 6465  annel3 = copy.de
+0000edb0: 6570 636f 7079 2863 6c61 7373 5f32 5b3a  epcopy(class_2[:
+0000edc0: 2c3a 2c3a 2c30 5d29 2c20 636f 7079 2e64  ,:,:,0]), copy.d
+0000edd0: 6565 7063 6f70 7928 636c 6173 735f 325b  eepcopy(class_2[
+0000ede0: 3a2c 3a2c 3a2c 315d 292c 2063 6f70 792e  :,:,:,1]), copy.
+0000edf0: 6465 6570 636f 7079 2863 6c61 7373 5f32  deepcopy(class_2
+0000ee00: 5b3a 2c3a 2c3a 2c32 5d29 0a20 2020 2020  [:,:,:,2]).     
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+0000ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee30: 2020 2020 6175 676d 656e 7465 645f 696d      augmented_im
+0000ee40: 6167 6573 5f6e 6567 6174 6976 6520 3d20  ages_negative = 
+0000ee50: 6175 676d 656e 7461 7469 6f6e 2863 6861  augmentation(cha
+0000ee60: 6e6e 656c 313d 6368 616e 6e65 6c31 2c20  nnel1=channel1, 
+0000ee70: 6368 616e 6e65 6c32 3d63 6861 6e6e 656c  channel2=channel
+0000ee80: 322c 2063 6861 6e6e 656c 333d 6368 616e  2, channel3=chan
+0000ee90: 6e65 6c33 2c20 6261 7463 683d 7365 6c66  nel3, batch=self
+0000eea0: 2e62 6174 6368 5f6f 7468 6572 2c20 0a20  .batch_other, . 
+0000eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eec0: 2020 2020 2020 2077 6964 7468 5f73 6869         width_shi
+0000eed0: 6674 3d73 656c 662e 7368 6966 742c 2068  ft=self.shift, h
+0000eee0: 6569 6768 745f 7368 6966 743d 7365 6c66  eight_shift=self
+0000eef0: 2e73 6869 6674 2c20 686f 7269 7a6f 6e74  .shift, horizont
+0000ef00: 616c 3d68 6f72 697a 6f6e 7461 6c2c 2076  al=horizontal, v
+0000ef10: 6572 7469 6361 6c3d 7665 7274 6963 616c  ertical=vertical
+0000ef20: 2c20 726f 7461 7469 6f6e 3d72 6f74 6174  , rotation=rotat
+0000ef30: 696f 6e2c 200a 2020 2020 2020 2020 2020  ion, .          
+0000ef40: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0000ef50: 6167 655f 7369 7a65 3d69 6d61 6765 5f73  age_size=image_s
+0000ef60: 697a 652c 206d 6173 6b5f 7369 7a65 3d6d  ize, mask_size=m
+0000ef70: 6173 6b5f 7369 7a65 2c20 6e75 6d5f 6d61  ask_size, num_ma
+0000ef80: 736b 733d 6e75 6d5f 6d61 736b 732c 2062  sks=num_masks, b
+0000ef90: 6c65 6e64 5f6d 756c 7469 706c 6965 723d  lend_multiplier=
+0000efa0: 7365 6c66 2e62 6c65 6e64 5f6f 7468 6572  self.blend_other
+0000efb0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000efc0: 2020 2020 2020 2020 2020 2062 6c65 6e64             blend
+0000efd0: 696e 675f 6675 6e63 3d73 656c 662e 626c  ing_func=self.bl
+0000efe0: 656e 6469 6e67 5f66 756e 632c 206e 756d  ending_func, num
+0000eff0: 5f69 6d61 6765 735f 746f 5f62 6c65 6e64  _images_to_blend
+0000f000: 3d73 656c 662e 6e75 6d5f 696d 6167 6573  =self.num_images
+0000f010: 5f74 6f5f 626c 656e 642c 207a 6f6f 6d5f  _to_blend, zoom_
+0000f020: 7261 6e67 653d 7365 6c66 2e7a 6f6f 6d5f  range=self.zoom_
+0000f030: 7261 6e67 652c 2073 6b65 775f 616e 676c  range, skew_angl
+0000f040: 653d 736b 6577 5f61 6e67 6c65 290a 0a20  e=skew_angle).. 
+0000f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f060: 2020 2023 5468 6520 6175 676d 656e 7461     #The augmenta
+0000f070: 7469 6f6e 2072 6f75 7469 6e65 2072 6574  tion routine ret
+0000f080: 7572 6e73 2061 6e20 6f75 7470 7574 2066  urns an output f
+0000f090: 6f72 2065 6163 6820 6669 6c74 6572 2c20  or each filter, 
+0000f0a0: 652e 672e 2033 206f 7574 7075 7473 2066  e.g. 3 outputs f
+0000f0b0: 6f72 2052 4742 0a20 2020 2020 2020 2020  or RGB.         
+0000f0c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000f0d0: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+0000f0e0: 656c 7320 3e20 313a 0a20 2020 2020 2020  els > 1:.       
+0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f100: 2063 6c61 7373 5f32 3d5b 5d0a 2020 2020   class_2=[].    
+0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f120: 2020 2020 6966 2073 656c 662e 696d 675f      if self.img_
+0000f130: 6e75 6d5f 6368 616e 6e65 6c73 203d 3d20  num_channels == 
+0000f140: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+0000f150: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000f160: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+0000f170: 6e28 6175 676d 656e 7465 645f 696d 6167  n(augmented_imag
+0000f180: 6573 5f6e 6567 6174 6976 655b 305d 2929  es_negative[0]))
+0000f190: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1b0: 2020 636c 6173 735f 322e 6170 7065 6e64    class_2.append
+0000f1c0: 2864 6174 615f 7072 6f63 6573 7369 6e67  (data_processing
+0000f1d0: 2e63 6f6e 6361 745f 6368 616e 6e65 6c73  .concat_channels
+0000f1e0: 2861 7567 6d65 6e74 6564 5f69 6d61 6765  (augmented_image
+0000f1f0: 735f 6e65 6761 7469 7665 5b30 5d5b 695d  s_negative[0][i]
+0000f200: 2c20 6175 676d 656e 7465 645f 696d 6167  , augmented_imag
+0000f210: 6573 5f6e 6567 6174 6976 655b 315d 5b69  es_negative[1][i
+0000f220: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+0000f230: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000f240: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f250: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000f260: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0000f270: 2861 7567 6d65 6e74 6564 5f69 6d61 6765  (augmented_image
+0000f280: 735f 6e65 6761 7469 7665 5b30 5d29 293a  s_negative[0])):
+0000f290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2b0: 2063 6c61 7373 5f32 2e61 7070 656e 6428   class_2.append(
+0000f2c0: 6461 7461 5f70 726f 6365 7373 696e 672e  data_processing.
+0000f2d0: 636f 6e63 6174 5f63 6861 6e6e 656c 7328  concat_channels(
+0000f2e0: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
+0000f2f0: 5f6e 6567 6174 6976 655b 305d 5b69 5d2c  _negative[0][i],
+0000f300: 2061 7567 6d65 6e74 6564 5f69 6d61 6765   augmented_image
+0000f310: 735f 6e65 6761 7469 7665 5b31 5d5b 695d  s_negative[1][i]
+0000f320: 2c20 6175 676d 656e 7465 645f 696d 6167  , augmented_imag
+0000f330: 6573 5f6e 6567 6174 6976 655b 325d 5b69  es_negative[2][i
+0000f340: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+0000f350: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+0000f360: 735f 3220 3d20 6e70 2e61 7272 6179 2863  s_2 = np.array(c
+0000f370: 6c61 7373 5f32 290a 2020 2020 2020 2020  lass_2).        
+0000f380: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000f390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f3a0: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+0000f3b0: 3220 3d20 6175 676d 656e 7465 645f 696d  2 = augmented_im
+0000f3c0: 6167 6573 5f6e 6567 6174 6976 650a 0a20  ages_negative.. 
+0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2020 2023 4261 6c61 6e63 6520 7468 6520     #Balance the 
+0000f3f0: 636c 6173 7320 7369 7a65 7320 6966 206e  class sizes if n
+0000f400: 6563 6573 7361 7279 0a20 2020 2020 2020  ecessary.       
+0000f410: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000f420: 7365 6c66 2e62 616c 616e 6365 3a0a 2020  self.balance:.  
+0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f440: 2020 2020 2020 6966 2073 656c 662e 6261        if self.ba
+0000f450: 7463 685f 6f74 6865 7220 3e20 313a 2023  tch_other > 1: #
+0000f460: 4d75 7374 2073 6875 6666 6c65 2121 210a  Must shuffle!!!.
+0000f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f480: 2020 2020 2020 2020 2020 2020 6978 203d              ix =
+0000f490: 206e 702e 7261 6e64 6f6d 2e70 6572 6d75   np.random.permu
+0000f4a0: 7461 7469 6f6e 286c 656e 2863 6c61 7373  tation(len(class
+0000f4b0: 5f32 2929 0a20 2020 2020 2020 2020 2020  _2)).           
+0000f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4d0: 2063 6c61 7373 5f32 203d 2063 6c61 7373   class_2 = class
+0000f4e0: 5f32 5b69 785d 0a20 2020 2020 2020 2020  _2[ix].         
+0000f4f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f500: 6c61 7373 5f32 203d 2063 6c61 7373 5f32  lass_2 = class_2
+0000f510: 5b3a 6c65 6e28 636c 6173 735f 3129 5d20  [:len(class_1)] 
+0000f520: 2020 0a0a 2020 2020 2020 2020 2020 2020    ..            
+0000f530: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000f540: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0000f550: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+0000f560: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f570: 6c61 7373 5f32 203d 2072 6573 697a 6528  lass_2 = resize(
+0000f580: 636c 6173 735f 322c 2073 697a 653d 696d  class_2, size=im
+0000f590: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
+0000f5a0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000f5b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000f5c0: 2020 2020 2020 2020 2020 2020 6368 616e              chan
+0000f5d0: 6e65 6c31 203d 2072 6573 697a 6528 636c  nel1 = resize(cl
+0000f5e0: 6173 735f 325b 3a2c 3a2c 3a2c 305d 2c20  ass_2[:,:,:,0], 
+0000f5f0: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
+0000f600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f610: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
+0000f620: 3220 3d20 7265 7369 7a65 2863 6c61 7373  2 = resize(class
+0000f630: 5f32 5b3a 2c3a 2c3a 2c31 5d2c 2073 697a  _2[:,:,:,1], siz
+0000f640: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
+0000f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f660: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
+0000f670: 675f 6e75 6d5f 6368 616e 6e65 6c73 203d  g_num_channels =
+0000f680: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+0000f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6a0: 2063 6c61 7373 5f32 203d 2064 6174 615f   class_2 = data_
+0000f6b0: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
+0000f6c0: 745f 6368 616e 6e65 6c73 2863 6861 6e6e  t_channels(chann
+0000f6d0: 656c 312c 2063 6861 6e6e 656c 3229 0a20  el1, channel2). 
+0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f710: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
+0000f720: 3320 3d20 7265 7369 7a65 2863 6c61 7373  3 = resize(class
+0000f730: 5f32 5b3a 2c3a 2c3a 2c32 5d2c 2073 697a  _2[:,:,:,2], siz
+0000f740: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
+0000f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f760: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+0000f770: 3220 3d20 6461 7461 5f70 726f 6365 7373  2 = data_process
+0000f780: 696e 672e 636f 6e63 6174 5f63 6861 6e6e  ing.concat_chann
+0000f790: 656c 7328 6368 616e 6e65 6c31 2c20 6368  els(channel1, ch
+0000f7a0: 616e 6e65 6c32 2c20 6368 616e 6e65 6c33  annel2, channel3
+0000f7b0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000f7c0: 2020 2020 2020 2069 6620 7661 6c5f 636c         if val_cl
+0000f7d0: 6173 735f 3120 6973 206e 6f74 204e 6f6e  ass_1 is not Non
+0000f7e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000f7f0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000f800: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+0000f810: 656c 7320 3d3d 2031 3a0a 2020 2020 2020  els == 1:.      
+0000f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f830: 2020 2020 2020 7661 6c5f 636c 6173 735f        val_class_
+0000f840: 3120 3d20 7265 7369 7a65 2876 616c 5f63  1 = resize(val_c
+0000f850: 6c61 7373 5f31 2c20 7369 7a65 3d69 6d61  lass_1, size=ima
+0000f860: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
+0000f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f880: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8a0: 2020 2076 616c 5f63 6861 6e6e 656c 3120     val_channel1 
+0000f8b0: 3d20 7265 7369 7a65 2876 616c 5f63 6c61  = resize(val_cla
+0000f8c0: 7373 5f31 5b3a 2c3a 2c3a 2c30 5d2c 2073  ss_1[:,:,:,0], s
+0000f8d0: 697a 653d 696d 6167 655f 7369 7a65 290a  ize=image_size).
+0000f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8f0: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
+0000f900: 6368 616e 6e65 6c32 203d 2072 6573 697a  channel2 = resiz
+0000f910: 6528 7661 6c5f 636c 6173 735f 315b 3a2c  e(val_class_1[:,
+0000f920: 3a2c 3a2c 315d 2c20 7369 7a65 3d69 6d61  :,:,1], size=ima
+0000f930: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
+0000f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f950: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
+0000f960: 5f6e 756d 5f63 6861 6e6e 656c 7320 3d3d  _num_channels ==
+0000f970: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0000f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f990: 2020 2020 7661 6c5f 636c 6173 735f 3120      val_class_1 
+0000f9a0: 3d20 6461 7461 5f70 726f 6365 7373 696e  = data_processin
+0000f9b0: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
+0000f9c0: 7328 7661 6c5f 6368 616e 6e65 6c31 2c20  s(val_channel1, 
+0000f9d0: 7661 6c5f 6368 616e 6e65 6c32 290a 2020  val_channel2).  
+0000f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa20: 7661 6c5f 6368 616e 6e65 6c33 203d 2072  val_channel3 = r
+0000fa30: 6573 697a 6528 7661 6c5f 636c 6173 735f  esize(val_class_
+0000fa40: 315b 3a2c 3a2c 3a2c 325d 2c20 7369 7a65  1[:,:,:,2], size
+0000fa50: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
+0000fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa70: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0000fa80: 5f63 6c61 7373 5f31 203d 2064 6174 615f  _class_1 = data_
+0000fa90: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
+0000faa0: 745f 6368 616e 6e65 6c73 2876 616c 5f63  t_channels(val_c
+0000fab0: 6861 6e6e 656c 312c 2076 616c 5f63 6861  hannel1, val_cha
+0000fac0: 6e6e 656c 322c 2076 616c 5f63 6861 6e6e  nnel2, val_chann
+0000fad0: 656c 3329 0a0a 2020 2020 2020 2020 2020  el3)..          
+0000fae0: 2020 2020 2020 2020 2020 6966 2076 616c            if val
+0000faf0: 5f63 6c61 7373 5f32 2069 7320 6e6f 7420  _class_2 is not 
+0000fb00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000fb10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000fb20: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+0000fb30: 616e 6e65 6c73 203d 3d20 313a 0a20 2020  annels == 1:.   
+0000fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb50: 2020 2020 2020 2020 2076 616c 5f63 6c61           val_cla
+0000fb60: 7373 5f32 203d 2072 6573 697a 6528 7661  ss_2 = resize(va
+0000fb70: 6c5f 636c 6173 735f 322c 2073 697a 653d  l_class_2, size=
+0000fb80: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
+0000fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fba0: 2020 2020 656c 6966 2073 656c 662e 696d      elif self.im
+0000fbb0: 675f 6e75 6d5f 6368 616e 6e65 6c73 203e  g_num_channels >
+0000fbc0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbe0: 7661 6c5f 6368 616e 6e65 6c31 203d 2072  val_channel1 = r
+0000fbf0: 6573 697a 6528 7661 6c5f 636c 6173 735f  esize(val_class_
+0000fc00: 325b 3a2c 3a2c 3a2c 305d 2c20 7369 7a65  2[:,:,:,0], size
+0000fc10: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
+0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc30: 2020 2020 2020 2020 2076 616c 5f63 6861           val_cha
+0000fc40: 6e6e 656c 3220 3d20 7265 7369 7a65 2876  nnel2 = resize(v
+0000fc50: 616c 5f63 6c61 7373 5f32 5b3a 2c3a 2c3a  al_class_2[:,:,:
+0000fc60: 2c31 5d2c 2073 697a 653d 696d 6167 655f  ,1], size=image_
+0000fc70: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+0000fc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc90: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
+0000fca0: 6d5f 6368 616e 6e65 6c73 203d 3d20 323a  m_channels == 2:
+0000fcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fcd0: 2076 616c 5f63 6c61 7373 5f32 203d 2064   val_class_2 = d
+0000fce0: 6174 615f 7072 6f63 6573 7369 6e67 2e63  ata_processing.c
+0000fcf0: 6f6e 6361 745f 6368 616e 6e65 6c73 2876  oncat_channels(v
+0000fd00: 616c 5f63 6861 6e6e 656c 312c 2076 616c  al_channel1, val
+0000fd10: 5f63 6861 6e6e 656c 3229 0a20 2020 2020  _channel2).     
+0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd50: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0000fd60: 5f63 6861 6e6e 656c 3320 3d20 7265 7369  _channel3 = resi
+0000fd70: 7a65 2876 616c 5f63 6c61 7373 5f32 5b3a  ze(val_class_2[:
+0000fd80: 2c3a 2c3a 2c32 5d2c 2073 697a 653d 696d  ,:,:,2], size=im
+0000fd90: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
+0000fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdb0: 2020 2020 2020 2020 2020 7661 6c5f 636c            val_cl
+0000fdc0: 6173 735f 3220 3d20 6461 7461 5f70 726f  ass_2 = data_pro
+0000fdd0: 6365 7373 696e 672e 636f 6e63 6174 5f63  cessing.concat_c
+0000fde0: 6861 6e6e 656c 7328 7661 6c5f 6368 616e  hannels(val_chan
+0000fdf0: 6e65 6c31 2c20 7661 6c5f 6368 616e 6e65  nel1, val_channe
+0000fe00: 6c32 2c20 7661 6c5f 6368 616e 6e65 6c33  l2, val_channel3
+0000fe10: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000fe20: 2020 2069 6620 7365 6c66 2e76 6572 626f     if self.verbo
+0000fe30: 7365 203d 3d20 313a 0a20 2020 2020 2020  se == 1:.       
+0000fe40: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000fe50: 6e74 2829 3b20 7072 696e 7428 272a 2a2a  nt(); print('***
+0000fe60: 2a2a 2a2a 2a2a 2a2a 2020 4356 202d 207b  ********  CV - {
+0000fe70: 7d20 2a2a 2a2a 2a2a 2a2a 2a2a 2a27 2e66  } ***********'.f
+0000fe80: 6f72 6d61 7428 6b2b 3229 293b 2070 7269  ormat(k+2)); pri
+0000fe90: 6e74 2829 0a0a 2020 2020 2020 2020 2020  nt()..          
+0000fea0: 2020 2020 2020 636c 6561 725f 7365 7373        clear_sess
+0000feb0: 696f 6e28 290a 2020 2020 2020 2020 2020  ion().          
+0000fec0: 2020 2020 2020 6966 2073 656c 662e 6f70        if self.op
+0000fed0: 745f 6d6f 6465 6c20 6973 2046 616c 7365  t_model is False
+0000fee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000fef0: 2020 2020 2020 6966 2073 656c 662e 636c        if self.cl
+0000ff00: 6620 3d3d 2027 616c 6578 6e65 7427 3a0a  f == 'alexnet':.
+0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff20: 2020 2020 2020 2020 6d6f 6465 6c2c 2068          model, h
+0000ff30: 6973 746f 7279 203d 2063 6e6e 5f6d 6f64  istory = cnn_mod
+0000ff40: 656c 2e41 6c65 784e 6574 2863 6c61 7373  el.AlexNet(class
+0000ff50: 5f31 2c20 636c 6173 735f 322c 2069 6d67  _1, class_2, img
+0000ff60: 5f6e 756d 5f63 6861 6e6e 656c 733d 7365  _num_channels=se
+0000ff70: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+0000ff80: 656c 732c 200a 2020 2020 2020 2020 2020  els, .          
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffa0: 2020 6e6f 726d 616c 697a 653d 7365 6c66    normalize=self
+0000ffb0: 2e6e 6f72 6d61 6c69 7a65 2c20 6d69 6e5f  .normalize, min_
+0000ffc0: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
+0000ffd0: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
+0000ffe0: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
+0000fff0: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
+00010000: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
+00010010: 7373 5f32 2c20 0a20 2020 2020 2020 2020  ss_2, .         
+00010020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010030: 2020 2065 706f 6368 733d 7365 6c66 2e74     epochs=self.t
+00010040: 7261 696e 5f65 706f 6368 732c 2062 6174  rain_epochs, bat
+00010050: 6368 5f73 697a 653d 6261 7463 685f 7369  ch_size=batch_si
+00010060: 7a65 2c20 6f70 7469 6d69 7a65 723d 6f70  ze, optimizer=op
+00010070: 7469 6d69 7a65 722c 206c 723d 6c72 2c20  timizer, lr=lr, 
+00010080: 6465 6361 793d 6465 6361 792c 206d 6f6d  decay=decay, mom
+00010090: 656e 7475 6d3d 6d6f 6d65 6e74 756d 2c20  entum=momentum, 
+000100a0: 6e65 7374 6572 6f76 3d6e 6573 7465 726f  nesterov=nestero
+000100b0: 762c 200a 2020 2020 2020 2020 2020 2020  v, .            
+000100c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100d0: 6265 7461 5f31 3d62 6574 615f 312c 2062  beta_1=beta_1, b
+000100e0: 6574 615f 323d 6265 7461 5f32 2c20 616d  eta_2=beta_2, am
+000100f0: 7367 7261 643d 616d 7367 7261 642c 2073  sgrad=amsgrad, s
+00010100: 6d6f 7465 5f73 616d 706c 696e 673d 7365  mote_sampling=se
+00010110: 6c66 2e73 6d6f 7465 5f73 616d 706c 696e  lf.smote_samplin
+00010120: 672c 2065 6172 6c79 5f73 746f 705f 6361  g, early_stop_ca
+00010130: 6c6c 6261 636b 3d63 616c 6c62 6163 6b73  llback=callbacks
+00010140: 2c20 6368 6563 6b70 6f69 6e74 3d46 616c  , checkpoint=Fal
+00010150: 7365 2c20 7665 7262 6f73 653d 7365 6c66  se, verbose=self
+00010160: 2e76 6572 626f 7365 290a 2020 2020 2020  .verbose).      
+00010170: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00010180: 6966 2073 656c 662e 636c 6620 3d3d 2027  if self.clf == '
+00010190: 6375 7374 6f6d 5f63 6e6e 273a 0a20 2020  custom_cnn':.   
+000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101b0: 2020 2020 206d 6f64 656c 2c20 6869 7374       model, hist
+000101c0: 6f72 7920 3d20 636e 6e5f 6d6f 6465 6c2e  ory = cnn_model.
+000101d0: 6375 7374 6f6d 5f6d 6f64 656c 2863 6c61  custom_model(cla
+000101e0: 7373 5f31 2c20 636c 6173 735f 322c 2069  ss_1, class_2, i
+000101f0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 733d  mg_num_channels=
+00010200: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
+00010210: 6e6e 656c 732c 200a 2020 2020 2020 2020  nnels, .        
+00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010230: 2020 2020 6e6f 726d 616c 697a 653d 7365      normalize=se
+00010240: 6c66 2e6e 6f72 6d61 6c69 7a65 2c20 6d69  lf.normalize, mi
+00010250: 6e5f 7069 7865 6c3d 6d69 6e5f 7069 782c  n_pixel=min_pix,
+00010260: 206d 6178 5f70 6978 656c 3d6d 6178 5f70   max_pixel=max_p
+00010270: 6978 2c20 7661 6c5f 706f 7369 7469 7665  ix, val_positive
+00010280: 3d76 616c 5f63 6c61 7373 5f31 2c20 7661  =val_class_1, va
+00010290: 6c5f 6e65 6761 7469 7665 3d76 616c 5f63  l_negative=val_c
+000102a0: 6c61 7373 5f32 2c20 0a20 2020 2020 2020  lass_2, .       
+000102b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102c0: 2020 2020 2065 706f 6368 733d 7365 6c66       epochs=self
+000102d0: 2e74 7261 696e 5f65 706f 6368 732c 2062  .train_epochs, b
+000102e0: 6174 6368 5f73 697a 653d 6261 7463 685f  atch_size=batch_
+000102f0: 7369 7a65 2c20 6f70 7469 6d69 7a65 723d  size, optimizer=
+00010300: 6f70 7469 6d69 7a65 722c 206c 723d 6c72  optimizer, lr=lr
+00010310: 2c20 6465 6361 793d 6465 6361 792c 206d  , decay=decay, m
+00010320: 6f6d 656e 7475 6d3d 6d6f 6d65 6e74 756d  omentum=momentum
+00010330: 2c20 6e65 7374 6572 6f76 3d6e 6573 7465  , nesterov=neste
+00010340: 726f 762c 200a 2020 2020 2020 2020 2020  rov, .          
+00010350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010360: 2020 6265 7461 5f31 3d62 6574 615f 312c    beta_1=beta_1,
+00010370: 2062 6574 615f 323d 6265 7461 5f32 2c20   beta_2=beta_2, 
+00010380: 616d 7367 7261 643d 616d 7367 7261 642c  amsgrad=amsgrad,
+00010390: 2073 6d6f 7465 5f73 616d 706c 696e 673d   smote_sampling=
+000103a0: 7365 6c66 2e73 6d6f 7465 5f73 616d 706c  self.smote_sampl
+000103b0: 696e 672c 2065 6172 6c79 5f73 746f 705f  ing, early_stop_
+000103c0: 6361 6c6c 6261 636b 3d63 616c 6c62 6163  callback=callbac
+000103d0: 6b73 2c20 6368 6563 6b70 6f69 6e74 3d46  ks, checkpoint=F
+000103e0: 616c 7365 2c20 7665 7262 6f73 653d 7365  alse, verbose=se
+000103f0: 6c66 2e76 6572 626f 7365 290a 2020 2020  lf.verbose).    
+00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010410: 656c 6966 2073 656c 662e 636c 6620 3d3d  elif self.clf ==
+00010420: 2027 7667 6731 3627 3a0a 2020 2020 2020   'vgg16':.      
+00010430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010440: 2020 6d6f 6465 6c2c 2068 6973 746f 7279    model, history
+00010450: 203d 2063 6e6e 5f6d 6f64 656c 2e56 4747   = cnn_model.VGG
+00010460: 3136 2863 6c61 7373 5f31 2c20 636c 6173  16(class_1, clas
+00010470: 735f 322c 2069 6d67 5f6e 756d 5f63 6861  s_2, img_num_cha
+00010480: 6e6e 656c 733d 7365 6c66 2e69 6d67 5f6e  nnels=self.img_n
+00010490: 756d 5f63 6861 6e6e 656c 732c 200a 2020  um_channels, .  
+000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104b0: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
+000104c0: 697a 653d 7365 6c66 2e6e 6f72 6d61 6c69  ize=self.normali
+000104d0: 7a65 2c20 6d69 6e5f 7069 7865 6c3d 6d69  ze, min_pixel=mi
+000104e0: 6e5f 7069 782c 206d 6178 5f70 6978 656c  n_pix, max_pixel
+000104f0: 3d6d 6178 5f70 6978 2c20 7661 6c5f 706f  =max_pix, val_po
+00010500: 7369 7469 7665 3d76 616c 5f63 6c61 7373  sitive=val_class
+00010510: 5f31 2c20 7661 6c5f 6e65 6761 7469 7665  _1, val_negative
+00010520: 3d76 616c 5f63 6c61 7373 5f32 2c20 0a20  =val_class_2, . 
+00010530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010540: 2020 2020 2020 2020 2020 2065 706f 6368             epoch
+00010550: 733d 7365 6c66 2e74 7261 696e 5f65 706f  s=self.train_epo
+00010560: 6368 732c 2062 6174 6368 5f73 697a 653d  chs, batch_size=
+00010570: 6261 7463 685f 7369 7a65 2c20 6f70 7469  batch_size, opti
+00010580: 6d69 7a65 723d 6f70 7469 6d69 7a65 722c  mizer=optimizer,
+00010590: 206c 723d 6c72 2c20 6465 6361 793d 6465   lr=lr, decay=de
+000105a0: 6361 792c 206d 6f6d 656e 7475 6d3d 6d6f  cay, momentum=mo
+000105b0: 6d65 6e74 756d 2c20 6e65 7374 6572 6f76  mentum, nesterov
+000105c0: 3d6e 6573 7465 726f 762c 200a 2020 2020  =nesterov, .    
+000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105e0: 2020 2020 2020 2020 6265 7461 5f31 3d62          beta_1=b
+000105f0: 6574 615f 312c 2062 6574 615f 323d 6265  eta_1, beta_2=be
+00010600: 7461 5f32 2c20 616d 7367 7261 643d 616d  ta_2, amsgrad=am
+00010610: 7367 7261 642c 2073 6d6f 7465 5f73 616d  sgrad, smote_sam
+00010620: 706c 696e 673d 7365 6c66 2e73 6d6f 7465  pling=self.smote
+00010630: 5f73 616d 706c 696e 672c 2065 6172 6c79  _sampling, early
+00010640: 5f73 746f 705f 6361 6c6c 6261 636b 3d63  _stop_callback=c
+00010650: 616c 6c62 6163 6b73 2c20 6368 6563 6b70  allbacks, checkp
+00010660: 6f69 6e74 3d46 616c 7365 2c20 7665 7262  oint=False, verb
+00010670: 6f73 653d 7365 6c66 2e76 6572 626f 7365  ose=self.verbose
+00010680: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010690: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+000106a0: 636c 6620 3d3d 2027 7265 736e 6574 3138  clf == 'resnet18
+000106b0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+000106c0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+000106d0: 2c20 6869 7374 6f72 7920 3d20 636e 6e5f  , history = cnn_
+000106e0: 6d6f 6465 6c2e 5265 736e 6574 3138 2863  model.Resnet18(c
+000106f0: 6c61 7373 5f31 2c20 636c 6173 735f 322c  lass_1, class_2,
+00010700: 2069 6d67 5f6e 756d 5f63 6861 6e6e 656c   img_num_channel
+00010710: 733d 7365 6c66 2e69 6d67 5f6e 756d 5f63  s=self.img_num_c
+00010720: 6861 6e6e 656c 732c 200a 2020 2020 2020  hannels, .      
+00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010740: 2020 2020 2020 6e6f 726d 616c 697a 653d        normalize=
+00010750: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 2c20  self.normalize, 
+00010760: 6d69 6e5f 7069 7865 6c3d 6d69 6e5f 7069  min_pixel=min_pi
+00010770: 782c 206d 6178 5f70 6978 656c 3d6d 6178  x, max_pixel=max
+00010780: 5f70 6978 2c20 7661 6c5f 706f 7369 7469  _pix, val_positi
+00010790: 7665 3d76 616c 5f63 6c61 7373 5f31 2c20  ve=val_class_1, 
+000107a0: 7661 6c5f 6e65 6761 7469 7665 3d76 616c  val_negative=val
+000107b0: 5f63 6c61 7373 5f32 2c20 0a20 2020 2020  _class_2, .     
+000107c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107d0: 2020 2020 2020 2065 706f 6368 733d 7365         epochs=se
+000107e0: 6c66 2e74 7261 696e 5f65 706f 6368 732c  lf.train_epochs,
+000107f0: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
+00010800: 685f 7369 7a65 2c20 6f70 7469 6d69 7a65  h_size, optimize
+00010810: 723d 6f70 7469 6d69 7a65 722c 206c 723d  r=optimizer, lr=
+00010820: 6c72 2c20 6465 6361 793d 6465 6361 792c  lr, decay=decay,
+00010830: 206d 6f6d 656e 7475 6d3d 6d6f 6d65 6e74   momentum=moment
+00010840: 756d 2c20 6e65 7374 6572 6f76 3d6e 6573  um, nesterov=nes
+00010850: 7465 726f 762c 200a 2020 2020 2020 2020  terov, .        
+00010860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010870: 2020 2020 6265 7461 5f31 3d62 6574 615f      beta_1=beta_
+00010880: 312c 2062 6574 615f 323d 6265 7461 5f32  1, beta_2=beta_2
+00010890: 2c20 616d 7367 7261 643d 616d 7367 7261  , amsgrad=amsgra
+000108a0: 642c 2073 6d6f 7465 5f73 616d 706c 696e  d, smote_samplin
+000108b0: 673d 7365 6c66 2e73 6d6f 7465 5f73 616d  g=self.smote_sam
+000108c0: 706c 696e 672c 2065 6172 6c79 5f73 746f  pling, early_sto
+000108d0: 705f 6361 6c6c 6261 636b 3d63 616c 6c62  p_callback=callb
+000108e0: 6163 6b73 2c20 6368 6563 6b70 6f69 6e74  acks, checkpoint
+000108f0: 3d46 616c 7365 2c20 7665 7262 6f73 653d  =False, verbose=
+00010900: 7365 6c66 2e76 6572 626f 7365 290a 2020  self.verbose).  
+00010910: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00010920: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00010930: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00010940: 636c 6620 3d3d 2027 616c 6578 6e65 7427  clf == 'alexnet'
+00010950: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010960: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00010970: 662e 6c69 6d69 745f 7365 6172 6368 3a0a  f.limit_search:.
+00010980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010990: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+000109a0: 6c2c 2068 6973 746f 7279 203d 2063 6e6e  l, history = cnn
+000109b0: 5f6d 6f64 656c 2e41 6c65 784e 6574 2863  _model.AlexNet(c
+000109c0: 6c61 7373 5f31 2c20 636c 6173 735f 322c  lass_1, class_2,
+000109d0: 2069 6d67 5f6e 756d 5f63 6861 6e6e 656c   img_num_channel
+000109e0: 733d 7365 6c66 2e69 6d67 5f6e 756d 5f63  s=self.img_num_c
+000109f0: 6861 6e6e 656c 732c 200a 2020 2020 2020  hannels, .      
+00010a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a10: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
+00010a20: 697a 653d 7365 6c66 2e6e 6f72 6d61 6c69  ize=self.normali
+00010a30: 7a65 2c20 6d69 6e5f 7069 7865 6c3d 6d69  ze, min_pixel=mi
+00010a40: 6e5f 7069 782c 206d 6178 5f70 6978 656c  n_pix, max_pixel
+00010a50: 3d6d 6178 5f70 6978 2c20 7661 6c5f 706f  =max_pix, val_po
+00010a60: 7369 7469 7665 3d76 616c 5f63 6c61 7373  sitive=val_class
+00010a70: 5f31 2c20 7661 6c5f 6e65 6761 7469 7665  _1, val_negative
+00010a80: 3d76 616c 5f63 6c61 7373 5f32 2c20 0a20  =val_class_2, . 
+00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010aa0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010ab0: 706f 6368 733d 7365 6c66 2e74 7261 696e  pochs=self.train
+00010ac0: 5f65 706f 6368 732c 2062 6174 6368 5f73  _epochs, batch_s
+00010ad0: 697a 653d 6261 7463 685f 7369 7a65 2c20  ize=batch_size, 
+00010ae0: 6f70 7469 6d69 7a65 723d 6f70 7469 6d69  optimizer=optimi
+00010af0: 7a65 722c 206c 723d 6c72 2c20 6465 6361  zer, lr=lr, deca
+00010b00: 793d 6465 6361 792c 206d 6f6d 656e 7475  y=decay, momentu
+00010b10: 6d3d 6d6f 6d65 6e74 756d 2c20 6e65 7374  m=momentum, nest
+00010b20: 6572 6f76 3d6e 6573 7465 726f 762c 200a  erov=nesterov, .
+00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b50: 6265 7461 5f31 3d62 6574 615f 312c 2062  beta_1=beta_1, b
+00010b60: 6574 615f 323d 6265 7461 5f32 2c20 616d  eta_2=beta_2, am
+00010b70: 7367 7261 643d 616d 7367 7261 642c 206c  sgrad=amsgrad, l
+00010b80: 6f73 733d 6c6f 7373 2c20 6163 7469 7661  oss=loss, activa
+00010b90: 7469 6f6e 5f63 6f6e 763d 6163 7469 7661  tion_conv=activa
+00010ba0: 7469 6f6e 5f63 6f6e 762c 2061 6374 6976  tion_conv, activ
+00010bb0: 6174 696f 6e5f 6465 6e73 653d 6163 7469  ation_dense=acti
+00010bc0: 7661 7469 6f6e 5f64 656e 7365 2c20 0a20  vation_dense, . 
+00010bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010be0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00010bf0: 6f6e 765f 696e 6974 3d63 6f6e 765f 696e  onv_init=conv_in
+00010c00: 6974 2c20 6465 6e73 655f 696e 6974 3d64  it, dense_init=d
+00010c10: 656e 7365 5f69 6e69 742c 206d 6f64 656c  ense_init, model
+00010c20: 5f72 6567 3d6d 6f64 656c 5f72 6567 2c20  _reg=model_reg, 
+00010c30: 706f 6f6c 696e 675f 313d 706f 6f6c 696e  pooling_1=poolin
+00010c40: 675f 312c 2070 6f6f 6c69 6e67 5f32 3d70  g_1, pooling_2=p
+00010c50: 6f6f 6c69 6e67 5f32 2c20 706f 6f6c 696e  ooling_2, poolin
+00010c60: 675f 333d 706f 6f6c 696e 675f 332c 200a  g_3=pooling_3, .
+00010c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c90: 736d 6f74 655f 7361 6d70 6c69 6e67 3d73  smote_sampling=s
+00010ca0: 656c 662e 736d 6f74 655f 7361 6d70 6c69  elf.smote_sampli
+00010cb0: 6e67 2c20 6561 726c 795f 7374 6f70 5f63  ng, early_stop_c
+00010cc0: 616c 6c62 6163 6b3d 6361 6c6c 6261 636b  allback=callback
+00010cd0: 732c 2063 6865 636b 706f 696e 743d 4661  s, checkpoint=Fa
+00010ce0: 6c73 652c 2076 6572 626f 7365 3d73 656c  lse, verbose=sel
+00010cf0: 662e 7665 7262 6f73 6529 0a20 2020 2020  f.verbose).     
+00010d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00010d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d30: 2020 2020 206d 6f64 656c 2c20 6869 7374       model, hist
+00010d40: 6f72 7920 3d20 636e 6e5f 6d6f 6465 6c2e  ory = cnn_model.
+00010d50: 416c 6578 4e65 7428 636c 6173 735f 312c  AlexNet(class_1,
+00010d60: 2063 6c61 7373 5f32 2c20 696d 675f 6e75   class_2, img_nu
+00010d70: 6d5f 6368 616e 6e65 6c73 3d73 656c 662e  m_channels=self.
+00010d80: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+00010d90: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00010da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010db0: 2020 206e 6f72 6d61 6c69 7a65 3d73 656c     normalize=sel
+00010dc0: 662e 6e6f 726d 616c 697a 652c 206d 696e  f.normalize, min
+00010dd0: 5f70 6978 656c 3d6d 696e 5f70 6978 2c20  _pixel=min_pix, 
+00010de0: 6d61 785f 7069 7865 6c3d 6d61 785f 7069  max_pixel=max_pi
+00010df0: 782c 2076 616c 5f70 6f73 6974 6976 653d  x, val_positive=
+00010e00: 7661 6c5f 636c 6173 735f 312c 2076 616c  val_class_1, val
+00010e10: 5f6e 6567 6174 6976 653d 7661 6c5f 636c  _negative=val_cl
+00010e20: 6173 735f 322c 200a 2020 2020 2020 2020  ass_2, .        
+00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e40: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
+00010e50: 656c 662e 7472 6169 6e5f 6570 6f63 6873  elf.train_epochs
+00010e60: 2c20 6261 7463 685f 7369 7a65 3d62 6174  , batch_size=bat
+00010e70: 6368 5f73 697a 652c 206f 7074 696d 697a  ch_size, optimiz
+00010e80: 6572 3d6f 7074 696d 697a 6572 2c20 6c72  er=optimizer, lr
+00010e90: 3d6c 722c 2064 6563 6179 3d64 6563 6179  =lr, decay=decay
+00010ea0: 2c20 6d6f 6d65 6e74 756d 3d6d 6f6d 656e  , momentum=momen
+00010eb0: 7475 6d2c 206e 6573 7465 726f 763d 6e65  tum, nesterov=ne
+00010ec0: 7374 6572 6f76 2c20 0a20 2020 2020 2020  sterov, .       
+00010ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ee0: 2020 2020 2020 2020 2062 6574 615f 313d           beta_1=
+00010ef0: 6265 7461 5f31 2c20 6265 7461 5f32 3d62  beta_1, beta_2=b
+00010f00: 6574 615f 322c 2061 6d73 6772 6164 3d61  eta_2, amsgrad=a
+00010f10: 6d73 6772 6164 2c20 6c6f 7373 3d6c 6f73  msgrad, loss=los
+00010f20: 732c 2061 6374 6976 6174 696f 6e5f 636f  s, activation_co
+00010f30: 6e76 3d61 6374 6976 6174 696f 6e5f 636f  nv=activation_co
+00010f40: 6e76 2c20 6163 7469 7661 7469 6f6e 5f64  nv, activation_d
+00010f50: 656e 7365 3d61 6374 6976 6174 696f 6e5f  ense=activation_
+00010f60: 6465 6e73 652c 200a 2020 2020 2020 2020  dense, .        
+00010f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f80: 2020 2020 2020 2020 636f 6e76 5f69 6e69          conv_ini
+00010f90: 743d 636f 6e76 5f69 6e69 742c 2064 656e  t=conv_init, den
+00010fa0: 7365 5f69 6e69 743d 6465 6e73 655f 696e  se_init=dense_in
+00010fb0: 6974 2c20 6d6f 6465 6c5f 7265 673d 6d6f  it, model_reg=mo
+00010fc0: 6465 6c5f 7265 672c 200a 2020 2020 2020  del_reg, .      
+00010fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fe0: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00010ff0: 5f31 3d66 696c 7465 725f 312c 2066 696c  _1=filter_1, fil
+00011000: 7465 725f 7369 7a65 5f31 3d66 696c 7465  ter_size_1=filte
+00011010: 725f 7369 7a65 5f31 2c20 7374 7269 6465  r_size_1, stride
+00011020: 735f 313d 7374 7269 6465 735f 312c 2070  s_1=strides_1, p
+00011030: 6f6f 6c69 6e67 5f31 3d70 6f6f 6c69 6e67  ooling_1=pooling
+00011040: 5f31 2c20 706f 6f6c 5f73 697a 655f 313d  _1, pool_size_1=
+00011050: 706f 6f6c 5f73 697a 655f 312c 2070 6f6f  pool_size_1, poo
+00011060: 6c5f 7374 7269 6465 5f31 3d70 6f6f 6c5f  l_stride_1=pool_
+00011070: 7374 7269 6465 5f31 2c0a 2020 2020 2020  stride_1,.      
+00011080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011090: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+000110a0: 5f32 3d66 696c 7465 725f 322c 2066 696c  _2=filter_2, fil
+000110b0: 7465 725f 7369 7a65 5f32 3d66 696c 7465  ter_size_2=filte
+000110c0: 725f 7369 7a65 5f32 2c20 7374 7269 6465  r_size_2, stride
+000110d0: 735f 323d 7374 7269 6465 735f 322c 2070  s_2=strides_2, p
+000110e0: 6f6f 6c69 6e67 5f32 3d70 6f6f 6c69 6e67  ooling_2=pooling
+000110f0: 5f32 2c20 706f 6f6c 5f73 697a 655f 323d  _2, pool_size_2=
+00011100: 706f 6f6c 5f73 697a 655f 322c 2070 6f6f  pool_size_2, poo
+00011110: 6c5f 7374 7269 6465 5f32 3d70 6f6f 6c5f  l_stride_2=pool_
+00011120: 7374 7269 6465 5f32 2c0a 2020 2020 2020  stride_2,.      
+00011130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011140: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00011150: 5f33 3d66 696c 7465 725f 332c 2066 696c  _3=filter_3, fil
+00011160: 7465 725f 7369 7a65 5f33 3d66 696c 7465  ter_size_3=filte
+00011170: 725f 7369 7a65 5f33 2c20 7374 7269 6465  r_size_3, stride
+00011180: 735f 333d 7374 7269 6465 735f 332c 2070  s_3=strides_3, p
+00011190: 6f6f 6c69 6e67 5f33 3d70 6f6f 6c69 6e67  ooling_3=pooling
+000111a0: 5f33 2c20 706f 6f6c 5f73 697a 655f 333d  _3, pool_size_3=
+000111b0: 706f 6f6c 5f73 697a 655f 332c 2070 6f6f  pool_size_3, poo
+000111c0: 6c5f 7374 7269 6465 5f33 3d70 6f6f 6c5f  l_stride_3=pool_
+000111d0: 7374 7269 6465 5f33 2c0a 2020 2020 2020  stride_3,.      
+000111e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111f0: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00011200: 5f34 3d66 696c 7465 725f 342c 2066 696c  _4=filter_4, fil
+00011210: 7465 725f 7369 7a65 5f34 3d66 696c 7465  ter_size_4=filte
+00011220: 725f 7369 7a65 5f34 2c20 7374 7269 6465  r_size_4, stride
+00011230: 735f 343d 7374 7269 6465 735f 342c 200a  s_4=strides_4, .
+00011240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011260: 6669 6c74 6572 5f35 3d66 696c 7465 725f  filter_5=filter_
+00011270: 352c 2066 696c 7465 725f 7369 7a65 5f35  5, filter_size_5
+00011280: 3d66 696c 7465 725f 7369 7a65 5f35 2c20  =filter_size_5, 
+00011290: 7374 7269 6465 735f 353d 7374 7269 6465  strides_5=stride
+000112a0: 735f 352c 0a20 2020 2020 2020 2020 2020  s_5,.           
+000112b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112c0: 2020 2020 2064 656e 7365 5f6e 6575 726f       dense_neuro
+000112d0: 6e73 5f31 3d64 656e 7365 5f6e 6575 726f  ns_1=dense_neuro
+000112e0: 6e73 5f31 2c20 6465 6e73 655f 6e65 7572  ns_1, dense_neur
+000112f0: 6f6e 735f 323d 6465 6e73 655f 6e65 7572  ons_2=dense_neur
+00011300: 6f6e 735f 322c 2064 726f 706f 7574 5f31  ons_2, dropout_1
+00011310: 3d64 726f 706f 7574 5f31 2c20 6472 6f70  =dropout_1, drop
+00011320: 6f75 745f 323d 6472 6f70 6f75 745f 322c  out_2=dropout_2,
+00011330: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011350: 2020 736d 6f74 655f 7361 6d70 6c69 6e67    smote_sampling
+00011360: 3d73 656c 662e 736d 6f74 655f 7361 6d70  =self.smote_samp
+00011370: 6c69 6e67 2c20 6561 726c 795f 7374 6f70  ling, early_stop
+00011380: 5f63 616c 6c62 6163 6b3d 6361 6c6c 6261  _callback=callba
+00011390: 636b 732c 2063 6865 636b 706f 696e 743d  cks, checkpoint=
+000113a0: 4661 6c73 652c 2076 6572 626f 7365 3d73  False, verbose=s
+000113b0: 656c 662e 7665 7262 6f73 6529 0a20 2020  elf.verbose).   
+000113c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113d0: 2065 6c69 6620 7365 6c66 2e63 6c66 203d   elif self.clf =
+000113e0: 3d20 2763 7573 746f 6d5f 636e 6e27 3a0a  = 'custom_cnn':.
+000113f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011400: 2020 2020 2020 2020 6d6f 6465 6c2c 2068          model, h
+00011410: 6973 746f 7279 203d 2063 6e6e 5f6d 6f64  istory = cnn_mod
+00011420: 656c 2e63 7573 746f 6d5f 6d6f 6465 6c28  el.custom_model(
+00011430: 636c 6173 735f 312c 2063 6c61 7373 5f32  class_1, class_2
+00011440: 2c20 696d 675f 6e75 6d5f 6368 616e 6e65  , img_num_channe
+00011450: 6c73 3d73 656c 662e 696d 675f 6e75 6d5f  ls=self.img_num_
+00011460: 6368 616e 6e65 6c73 2c20 0a20 2020 2020  channels, .     
+00011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011480: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+00011490: 3d73 656c 662e 6e6f 726d 616c 697a 652c  =self.normalize,
+000114a0: 206d 696e 5f70 6978 656c 3d6d 696e 5f70   min_pixel=min_p
+000114b0: 6978 2c20 6d61 785f 7069 7865 6c3d 6d61  ix, max_pixel=ma
+000114c0: 785f 7069 782c 2076 616c 5f70 6f73 6974  x_pix, val_posit
+000114d0: 6976 653d 7661 6c5f 636c 6173 735f 312c  ive=val_class_1,
+000114e0: 2076 616c 5f6e 6567 6174 6976 653d 7661   val_negative=va
+000114f0: 6c5f 636c 6173 735f 322c 200a 2020 2020  l_class_2, .    
+00011500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011510: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
+00011520: 656c 662e 7472 6169 6e5f 6570 6f63 6873  elf.train_epochs
+00011530: 2c20 6261 7463 685f 7369 7a65 3d62 6174  , batch_size=bat
+00011540: 6368 5f73 697a 652c 206f 7074 696d 697a  ch_size, optimiz
+00011550: 6572 3d6f 7074 696d 697a 6572 2c20 6c72  er=optimizer, lr
+00011560: 3d6c 722c 2064 6563 6179 3d64 6563 6179  =lr, decay=decay
+00011570: 2c20 6d6f 6d65 6e74 756d 3d6d 6f6d 656e  , momentum=momen
+00011580: 7475 6d2c 206e 6573 7465 726f 763d 6e65  tum, nesterov=ne
+00011590: 7374 6572 6f76 2c20 0a20 2020 2020 2020  sterov, .       
+000115a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115b0: 2020 2020 2062 6574 615f 313d 6265 7461       beta_1=beta
+000115c0: 5f31 2c20 6265 7461 5f32 3d62 6574 615f  _1, beta_2=beta_
+000115d0: 322c 2061 6d73 6772 6164 3d61 6d73 6772  2, amsgrad=amsgr
+000115e0: 6164 2c20 6c6f 7373 3d6c 6f73 732c 2061  ad, loss=loss, a
+000115f0: 6374 6976 6174 696f 6e5f 636f 6e76 3d61  ctivation_conv=a
+00011600: 6374 6976 6174 696f 6e5f 636f 6e76 2c20  ctivation_conv, 
+00011610: 6163 7469 7661 7469 6f6e 5f64 656e 7365  activation_dense
+00011620: 3d61 6374 6976 6174 696f 6e5f 6465 6e73  =activation_dens
+00011630: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00011640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011650: 636f 6e76 5f69 6e69 743d 636f 6e76 5f69  conv_init=conv_i
+00011660: 6e69 742c 2064 656e 7365 5f69 6e69 743d  nit, dense_init=
+00011670: 6465 6e73 655f 696e 6974 2c20 6d6f 6465  dense_init, mode
+00011680: 6c5f 7265 673d 6d6f 6465 6c5f 7265 672c  l_reg=model_reg,
+00011690: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+000116a0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000116b0: 6c74 6572 5f31 3d66 696c 7465 725f 312c  lter_1=filter_1,
+000116c0: 2066 696c 7465 725f 7369 7a65 5f31 3d66   filter_size_1=f
+000116d0: 696c 7465 725f 7369 7a65 5f31 2c20 7374  ilter_size_1, st
+000116e0: 7269 6465 735f 313d 7374 7269 6465 735f  rides_1=strides_
+000116f0: 312c 2070 6f6f 6c69 6e67 5f31 3d70 6f6f  1, pooling_1=poo
+00011700: 6c69 6e67 5f31 2c20 706f 6f6c 5f73 697a  ling_1, pool_siz
+00011710: 655f 313d 706f 6f6c 5f73 697a 655f 312c  e_1=pool_size_1,
+00011720: 2070 6f6f 6c5f 7374 7269 6465 5f31 3d70   pool_stride_1=p
+00011730: 6f6f 6c5f 7374 7269 6465 5f31 2c20 0a20  ool_stride_1, . 
+00011740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011750: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00011760: 725f 323d 6669 6c74 6572 5f32 2c20 6669  r_2=filter_2, fi
+00011770: 6c74 6572 5f73 697a 655f 323d 6669 6c74  lter_size_2=filt
+00011780: 6572 5f73 697a 655f 322c 2073 7472 6964  er_size_2, strid
+00011790: 6573 5f32 3d73 7472 6964 6573 5f32 2c20  es_2=strides_2, 
+000117a0: 706f 6f6c 696e 675f 323d 706f 6f6c 696e  pooling_2=poolin
+000117b0: 675f 322c 2070 6f6f 6c5f 7369 7a65 5f32  g_2, pool_size_2
+000117c0: 3d70 6f6f 6c5f 7369 7a65 5f32 2c20 706f  =pool_size_2, po
+000117d0: 6f6c 5f73 7472 6964 655f 323d 706f 6f6c  ol_stride_2=pool
+000117e0: 5f73 7472 6964 655f 322c 200a 2020 2020  _stride_2, .    
+000117f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011800: 2020 2020 2020 2020 6669 6c74 6572 5f33          filter_3
+00011810: 3d66 696c 7465 725f 332c 2066 696c 7465  =filter_3, filte
+00011820: 725f 7369 7a65 5f33 3d66 696c 7465 725f  r_size_3=filter_
+00011830: 7369 7a65 5f33 2c20 7374 7269 6465 735f  size_3, strides_
+00011840: 333d 7374 7269 6465 735f 332c 2070 6f6f  3=strides_3, poo
+00011850: 6c69 6e67 5f33 3d70 6f6f 6c69 6e67 5f33  ling_3=pooling_3
+00011860: 2c20 706f 6f6c 5f73 697a 655f 333d 706f  , pool_size_3=po
+00011870: 6f6c 5f73 697a 655f 332c 2070 6f6f 6c5f  ol_size_3, pool_
+00011880: 7374 7269 6465 5f33 3d70 6f6f 6c5f 7374  stride_3=pool_st
+00011890: 7269 6465 5f33 2c20 0a20 2020 2020 2020  ride_3, .       
+000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118b0: 2020 2020 2064 656e 7365 5f6e 6575 726f       dense_neuro
+000118c0: 6e73 5f31 3d64 656e 7365 5f6e 6575 726f  ns_1=dense_neuro
+000118d0: 6e73 5f31 2c20 6465 6e73 655f 6e65 7572  ns_1, dense_neur
+000118e0: 6f6e 735f 323d 6465 6e73 655f 6e65 7572  ons_2=dense_neur
+000118f0: 6f6e 735f 322c 2064 656e 7365 5f6e 6575  ons_2, dense_neu
+00011900: 726f 6e73 5f33 3d64 656e 7365 5f6e 6575  rons_3=dense_neu
+00011910: 726f 6e73 5f33 2c20 0a20 2020 2020 2020  rons_3, .       
+00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011930: 2020 2020 2064 726f 706f 7574 5f31 3d64       dropout_1=d
+00011940: 726f 706f 7574 5f31 2c20 6472 6f70 6f75  ropout_1, dropou
+00011950: 745f 323d 6472 6f70 6f75 745f 322c 2064  t_2=dropout_2, d
+00011960: 726f 706f 7574 5f33 3d64 726f 706f 7574  ropout_3=dropout
+00011970: 5f33 2c20 736d 6f74 655f 7361 6d70 6c69  _3, smote_sampli
+00011980: 6e67 3d73 656c 662e 736d 6f74 655f 7361  ng=self.smote_sa
+00011990: 6d70 6c69 6e67 2c20 0a20 2020 2020 2020  mpling, .       
+000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119b0: 2020 2020 2065 6172 6c79 5f73 746f 705f       early_stop_
+000119c0: 6361 6c6c 6261 636b 3d63 616c 6c62 6163  callback=callbac
+000119d0: 6b73 2c20 6368 6563 6b70 6f69 6e74 3d46  ks, checkpoint=F
+000119e0: 616c 7365 2c20 7665 7262 6f73 653d 7365  alse, verbose=se
+000119f0: 6c66 2e76 6572 626f 7365 2920 200a 2020  lf.verbose)  .  
+00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a10: 2020 656c 6966 2073 656c 662e 636c 6620    elif self.clf 
+00011a20: 3d3d 2027 7667 6731 3627 3a0a 2020 2020  == 'vgg16':.    
+00011a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a40: 2020 2020 6966 2073 656c 662e 6c69 6d69      if self.limi
+00011a50: 745f 7365 6172 6368 3a0a 2020 2020 2020  t_search:.      
+00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a70: 2020 2020 2020 6d6f 6465 6c2c 2068 6973        model, his
+00011a80: 746f 7279 203d 2063 6e6e 5f6d 6f64 656c  tory = cnn_model
+00011a90: 2e56 4747 3136 2863 6c61 7373 5f31 2c20  .VGG16(class_1, 
+00011aa0: 636c 6173 735f 322c 2069 6d67 5f6e 756d  class_2, img_num
+00011ab0: 5f63 6861 6e6e 656c 733d 7365 6c66 2e69  _channels=self.i
+00011ac0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 732c  mg_num_channels,
+00011ad0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011af0: 2020 6e6f 726d 616c 697a 653d 7365 6c66    normalize=self
+00011b00: 2e6e 6f72 6d61 6c69 7a65 2c20 6d69 6e5f  .normalize, min_
+00011b10: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
+00011b20: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
+00011b30: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
+00011b40: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
+00011b50: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
+00011b60: 7373 5f32 2c20 0a20 2020 2020 2020 2020  ss_2, .         
+00011b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b80: 2020 2020 2020 2065 706f 6368 733d 7365         epochs=se
+00011b90: 6c66 2e74 7261 696e 5f65 706f 6368 732c  lf.train_epochs,
+00011ba0: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
+00011bb0: 685f 7369 7a65 2c20 6f70 7469 6d69 7a65  h_size, optimize
+00011bc0: 723d 6f70 7469 6d69 7a65 722c 206c 723d  r=optimizer, lr=
+00011bd0: 6c72 2c20 6465 6361 793d 6465 6361 792c  lr, decay=decay,
+00011be0: 206d 6f6d 656e 7475 6d3d 6d6f 6d65 6e74   momentum=moment
+00011bf0: 756d 2c20 6e65 7374 6572 6f76 3d6e 6573  um, nesterov=nes
+00011c00: 7465 726f 762c 200a 2020 2020 2020 2020  terov, .        
+00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c20: 2020 2020 2020 2020 6265 7461 5f31 3d62          beta_1=b
+00011c30: 6574 615f 312c 2062 6574 615f 323d 6265  eta_1, beta_2=be
+00011c40: 7461 5f32 2c20 616d 7367 7261 643d 616d  ta_2, amsgrad=am
+00011c50: 7367 7261 642c 206c 6f73 733d 6c6f 7373  sgrad, loss=loss
+00011c60: 2c20 6163 7469 7661 7469 6f6e 5f63 6f6e  , activation_con
+00011c70: 763d 6163 7469 7661 7469 6f6e 5f63 6f6e  v=activation_con
+00011c80: 762c 2061 6374 6976 6174 696f 6e5f 6465  v, activation_de
+00011c90: 6e73 653d 6163 7469 7661 7469 6f6e 5f64  nse=activation_d
+00011ca0: 656e 7365 2c20 0a20 2020 2020 2020 2020  ense, .         
+00011cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cc0: 2020 2020 2020 2063 6f6e 765f 696e 6974         conv_init
+00011cd0: 3d63 6f6e 765f 696e 6974 2c20 6465 6e73  =conv_init, dens
+00011ce0: 655f 696e 6974 3d64 656e 7365 5f69 6e69  e_init=dense_ini
+00011cf0: 742c 206d 6f64 656c 5f72 6567 3d6d 6f64  t, model_reg=mod
+00011d00: 656c 5f72 6567 2c0a 2020 2020 2020 2020  el_reg,.        
+00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d20: 2020 2020 2020 2020 706f 6f6c 696e 675f          pooling_
+00011d30: 313d 706f 6f6c 696e 675f 312c 2070 6f6f  1=pooling_1, poo
+00011d40: 6c69 6e67 5f32 3d70 6f6f 6c69 6e67 5f32  ling_2=pooling_2
+00011d50: 2c20 706f 6f6c 696e 675f 333d 706f 6f6c  , pooling_3=pool
+00011d60: 696e 675f 332c 2070 6f6f 6c69 6e67 5f34  ing_3, pooling_4
+00011d70: 3d70 6f6f 6c69 6e67 5f34 2c20 706f 6f6c  =pooling_4, pool
+00011d80: 696e 675f 353d 706f 6f6c 696e 675f 352c  ing_5=pooling_5,
+00011d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011db0: 2073 6d6f 7465 5f73 616d 706c 696e 673d   smote_sampling=
+00011dc0: 7365 6c66 2e73 6d6f 7465 5f73 616d 706c  self.smote_sampl
+00011dd0: 696e 672c 2065 6172 6c79 5f73 746f 705f  ing, early_stop_
+00011de0: 6361 6c6c 6261 636b 3d63 616c 6c62 6163  callback=callbac
+00011df0: 6b73 2c20 6368 6563 6b70 6f69 6e74 3d46  ks, checkpoint=F
+00011e00: 616c 7365 2c20 7665 7262 6f73 653d 7365  alse, verbose=se
+00011e10: 6c66 2e76 6572 626f 7365 290a 2020 2020  lf.verbose).    
+00011e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00011e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e50: 2020 2020 2020 6d6f 6465 6c2c 2068 6973        model, his
+00011e60: 746f 7279 203d 2063 6e6e 5f6d 6f64 656c  tory = cnn_model
+00011e70: 2e56 4747 3136 2863 6c61 7373 5f31 2c20  .VGG16(class_1, 
+00011e80: 636c 6173 735f 322c 2069 6d67 5f6e 756d  class_2, img_num
+00011e90: 5f63 6861 6e6e 656c 733d 7365 6c66 2e69  _channels=self.i
+00011ea0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 732c  mg_num_channels,
+00011eb0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ed0: 2020 6e6f 726d 616c 697a 653d 7365 6c66    normalize=self
+00011ee0: 2e6e 6f72 6d61 6c69 7a65 2c20 6d69 6e5f  .normalize, min_
+00011ef0: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
+00011f00: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
+00011f10: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
+00011f20: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
+00011f30: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
+00011f40: 7373 5f32 2c20 0a20 2020 2020 2020 2020  ss_2, .         
+00011f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f60: 2020 2020 2020 2065 706f 6368 733d 7365         epochs=se
+00011f70: 6c66 2e74 7261 696e 5f65 706f 6368 732c  lf.train_epochs,
+00011f80: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
+00011f90: 685f 7369 7a65 2c20 6f70 7469 6d69 7a65  h_size, optimize
+00011fa0: 723d 6f70 7469 6d69 7a65 722c 206c 723d  r=optimizer, lr=
+00011fb0: 6c72 2c20 6465 6361 793d 6465 6361 792c  lr, decay=decay,
+00011fc0: 206d 6f6d 656e 7475 6d3d 6d6f 6d65 6e74   momentum=moment
+00011fd0: 756d 2c20 6e65 7374 6572 6f76 3d6e 6573  um, nesterov=nes
+00011fe0: 7465 726f 762c 200a 2020 2020 2020 2020  terov, .        
+00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012000: 2020 2020 2020 2020 6265 7461 5f31 3d62          beta_1=b
+00012010: 6574 615f 312c 2062 6574 615f 323d 6265  eta_1, beta_2=be
+00012020: 7461 5f32 2c20 616d 7367 7261 643d 616d  ta_2, amsgrad=am
+00012030: 7367 7261 642c 206c 6f73 733d 6c6f 7373  sgrad, loss=loss
+00012040: 2c20 6163 7469 7661 7469 6f6e 5f63 6f6e  , activation_con
+00012050: 763d 6163 7469 7661 7469 6f6e 5f63 6f6e  v=activation_con
+00012060: 762c 2061 6374 6976 6174 696f 6e5f 6465  v, activation_de
+00012070: 6e73 653d 6163 7469 7661 7469 6f6e 5f64  nse=activation_d
+00012080: 656e 7365 2c20 0a20 2020 2020 2020 2020  ense, .         
+00012090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120a0: 2020 2020 2020 2063 6f6e 765f 696e 6974         conv_init
+000120b0: 3d63 6f6e 765f 696e 6974 2c20 6465 6e73  =conv_init, dens
+000120c0: 655f 696e 6974 3d64 656e 7365 5f69 6e69  e_init=dense_ini
+000120d0: 742c 206d 6f64 656c 5f72 6567 3d6d 6f64  t, model_reg=mod
+000120e0: 656c 5f72 6567 2c20 2020 2020 2020 2020  el_reg,         
+000120f0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00012100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012110: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00012120: 6c74 6572 5f31 3d66 696c 7465 725f 312c  lter_1=filter_1,
+00012130: 2066 696c 7465 725f 7369 7a65 5f31 3d66   filter_size_1=f
+00012140: 696c 7465 725f 7369 7a65 5f31 2c20 7374  ilter_size_1, st
+00012150: 7269 6465 735f 313d 7374 7269 6465 735f  rides_1=strides_
+00012160: 312c 2070 6f6f 6c69 6e67 5f31 3d70 6f6f  1, pooling_1=poo
+00012170: 6c69 6e67 5f31 2c20 706f 6f6c 5f73 697a  ling_1, pool_siz
+00012180: 655f 313d 706f 6f6c 5f73 697a 655f 312c  e_1=pool_size_1,
+00012190: 2070 6f6f 6c5f 7374 7269 6465 5f31 3d70   pool_stride_1=p
+000121a0: 6f6f 6c5f 7374 7269 6465 5f31 2c0a 2020  ool_stride_1,.  
+000121b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121c0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000121d0: 6c74 6572 5f32 3d66 696c 7465 725f 322c  lter_2=filter_2,
+000121e0: 2066 696c 7465 725f 7369 7a65 5f32 3d66   filter_size_2=f
+000121f0: 696c 7465 725f 7369 7a65 5f32 2c20 7374  ilter_size_2, st
+00012200: 7269 6465 735f 323d 7374 7269 6465 735f  rides_2=strides_
+00012210: 322c 2070 6f6f 6c69 6e67 5f32 3d70 6f6f  2, pooling_2=poo
+00012220: 6c69 6e67 5f32 2c20 706f 6f6c 5f73 697a  ling_2, pool_siz
+00012230: 655f 323d 706f 6f6c 5f73 697a 655f 322c  e_2=pool_size_2,
+00012240: 2070 6f6f 6c5f 7374 7269 6465 5f32 3d70   pool_stride_2=p
+00012250: 6f6f 6c5f 7374 7269 6465 5f32 2c0a 2020  ool_stride_2,.  
+00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012270: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00012280: 6c74 6572 5f33 3d66 696c 7465 725f 332c  lter_3=filter_3,
+00012290: 2066 696c 7465 725f 7369 7a65 5f33 3d66   filter_size_3=f
+000122a0: 696c 7465 725f 7369 7a65 5f33 2c20 7374  ilter_size_3, st
+000122b0: 7269 6465 735f 333d 7374 7269 6465 735f  rides_3=strides_
+000122c0: 332c 2070 6f6f 6c69 6e67 5f33 3d70 6f6f  3, pooling_3=poo
+000122d0: 6c69 6e67 5f33 2c20 706f 6f6c 5f73 697a  ling_3, pool_siz
+000122e0: 655f 333d 706f 6f6c 5f73 697a 655f 332c  e_3=pool_size_3,
+000122f0: 2070 6f6f 6c5f 7374 7269 6465 5f33 3d70   pool_stride_3=p
+00012300: 6f6f 6c5f 7374 7269 6465 5f33 2c0a 2020  ool_stride_3,.  
+00012310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012320: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00012330: 6c74 6572 5f34 3d66 696c 7465 725f 342c  lter_4=filter_4,
+00012340: 2066 696c 7465 725f 7369 7a65 5f34 3d66   filter_size_4=f
+00012350: 696c 7465 725f 7369 7a65 5f34 2c20 7374  ilter_size_4, st
+00012360: 7269 6465 735f 343d 7374 7269 6465 735f  rides_4=strides_
+00012370: 342c 2070 6f6f 6c69 6e67 5f34 3d70 6f6f  4, pooling_4=poo
+00012380: 6c69 6e67 5f34 2c20 706f 6f6c 5f73 697a  ling_4, pool_siz
+00012390: 655f 343d 706f 6f6c 5f73 697a 655f 342c  e_4=pool_size_4,
+000123a0: 2070 6f6f 6c5f 7374 7269 6465 5f34 3d70   pool_stride_4=p
+000123b0: 6f6f 6c5f 7374 7269 6465 5f34 2c0a 2020  ool_stride_4,.  
+000123c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123d0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000123e0: 6c74 6572 5f35 3d66 696c 7465 725f 352c  lter_5=filter_5,
+000123f0: 2066 696c 7465 725f 7369 7a65 5f35 3d66   filter_size_5=f
+00012400: 696c 7465 725f 7369 7a65 5f35 2c20 7374  ilter_size_5, st
+00012410: 7269 6465 735f 353d 7374 7269 6465 735f  rides_5=strides_
+00012420: 352c 2070 6f6f 6c69 6e67 5f35 3d70 6f6f  5, pooling_5=poo
+00012430: 6c69 6e67 5f35 2c20 706f 6f6c 5f73 697a  ling_5, pool_siz
+00012440: 655f 353d 706f 6f6c 5f73 697a 655f 352c  e_5=pool_size_5,
+00012450: 2070 6f6f 6c5f 7374 7269 6465 5f35 3d70   pool_stride_5=p
+00012460: 6f6f 6c5f 7374 7269 6465 5f35 2c0a 2020  ool_stride_5,.  
+00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012480: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00012490: 6e73 655f 6e65 7572 6f6e 735f 313d 6465  nse_neurons_1=de
+000124a0: 6e73 655f 6e65 7572 6f6e 735f 312c 2064  nse_neurons_1, d
+000124b0: 656e 7365 5f6e 6575 726f 6e73 5f32 3d64  ense_neurons_2=d
+000124c0: 656e 7365 5f6e 6575 726f 6e73 5f32 2c20  ense_neurons_2, 
+000124d0: 6472 6f70 6f75 745f 313d 6472 6f70 6f75  dropout_1=dropou
+000124e0: 745f 312c 2064 726f 706f 7574 5f32 3d64  t_1, dropout_2=d
+000124f0: 726f 706f 7574 5f32 2c20 0a20 2020 2020  ropout_2, .     
+00012500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012510: 2020 2020 2020 2020 2020 2073 6d6f 7465             smote
+00012520: 5f73 616d 706c 696e 673d 7365 6c66 2e73  _sampling=self.s
+00012530: 6d6f 7465 5f73 616d 706c 696e 672c 2065  mote_sampling, e
+00012540: 6172 6c79 5f73 746f 705f 6361 6c6c 6261  arly_stop_callba
+00012550: 636b 3d63 616c 6c62 6163 6b73 2c20 6368  ck=callbacks, ch
+00012560: 6563 6b70 6f69 6e74 3d46 616c 7365 2c20  eckpoint=False, 
+00012570: 7665 7262 6f73 653d 7365 6c66 2e76 6572  verbose=self.ver
+00012580: 626f 7365 290a 2020 2020 2020 2020 2020  bose).          
+00012590: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+000125a0: 656c 662e 636c 6620 3d3d 2027 7265 736e  elf.clf == 'resn
+000125b0: 6574 3138 273a 0a20 2020 2020 2020 2020  et18':.         
+000125c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000125d0: 6620 7365 6c66 2e6c 696d 6974 5f73 6561  f self.limit_sea
+000125e0: 7263 683a 0a20 2020 2020 2020 2020 2020  rch:.           
+000125f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012600: 206d 6f64 656c 2c20 6869 7374 6f72 7920   model, history 
+00012610: 3d20 636e 6e5f 6d6f 6465 6c2e 5265 736e  = cnn_model.Resn
+00012620: 6574 3138 2863 6c61 7373 5f31 2c20 636c  et18(class_1, cl
+00012630: 6173 735f 322c 2069 6d67 5f6e 756d 5f63  ass_2, img_num_c
+00012640: 6861 6e6e 656c 733d 7365 6c66 2e69 6d67  hannels=self.img
+00012650: 5f6e 756d 5f63 6861 6e6e 656c 732c 200a  _num_channels, .
+00012660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012680: 6e6f 726d 616c 697a 653d 7365 6c66 2e6e  normalize=self.n
+00012690: 6f72 6d61 6c69 7a65 2c20 6d69 6e5f 7069  ormalize, min_pi
+000126a0: 7865 6c3d 6d69 6e5f 7069 782c 206d 6178  xel=min_pix, max
+000126b0: 5f70 6978 656c 3d6d 6178 5f70 6978 2c20  _pixel=max_pix, 
+000126c0: 7661 6c5f 706f 7369 7469 7665 3d76 616c  val_positive=val
+000126d0: 5f63 6c61 7373 5f31 2c20 7661 6c5f 6e65  _class_1, val_ne
+000126e0: 6761 7469 7665 3d76 616c 5f63 6c61 7373  gative=val_class
+000126f0: 5f32 2c20 0a20 2020 2020 2020 2020 2020  _2, .           
+00012700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012710: 2020 2020 2065 706f 6368 733d 7365 6c66       epochs=self
+00012720: 2e74 7261 696e 5f65 706f 6368 732c 2062  .train_epochs, b
+00012730: 6174 6368 5f73 697a 653d 6261 7463 685f  atch_size=batch_
+00012740: 7369 7a65 2c20 6f70 7469 6d69 7a65 723d  size, optimizer=
+00012750: 6f70 7469 6d69 7a65 722c 206c 723d 6c72  optimizer, lr=lr
+00012760: 2c20 6465 6361 793d 6465 6361 792c 206d  , decay=decay, m
+00012770: 6f6d 656e 7475 6d3d 6d6f 6d65 6e74 756d  omentum=momentum
+00012780: 2c20 6e65 7374 6572 6f76 3d6e 6573 7465  , nesterov=neste
+00012790: 726f 762c 200a 2020 2020 2020 2020 2020  rov, .          
+000127a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127b0: 2020 2020 2020 6265 7461 5f31 3d62 6574        beta_1=bet
+000127c0: 615f 312c 2062 6574 615f 323d 6265 7461  a_1, beta_2=beta
+000127d0: 5f32 2c20 616d 7367 7261 643d 616d 7367  _2, amsgrad=amsg
+000127e0: 7261 642c 206c 6f73 733d 6c6f 7373 2c20  rad, loss=loss, 
+000127f0: 6163 7469 7661 7469 6f6e 5f63 6f6e 763d  activation_conv=
+00012800: 6163 7469 7661 7469 6f6e 5f63 6f6e 762c  activation_conv,
+00012810: 2061 6374 6976 6174 696f 6e5f 6465 6e73   activation_dens
+00012820: 653d 6163 7469 7661 7469 6f6e 5f64 656e  e=activation_den
+00012830: 7365 2c20 0a20 2020 2020 2020 2020 2020  se, .           
+00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012850: 2020 2020 2063 6f6e 765f 696e 6974 3d63       conv_init=c
+00012860: 6f6e 765f 696e 6974 2c20 6465 6e73 655f  onv_init, dense_
+00012870: 696e 6974 3d64 656e 7365 5f69 6e69 742c  init=dense_init,
+00012880: 206d 6f64 656c 5f72 6567 3d6d 6f64 656c   model_reg=model
+00012890: 5f72 6567 2c20 706f 6f6c 696e 673d 706f  _reg, pooling=po
+000128a0: 6f6c 696e 672c 0a20 2020 2020 2020 2020  oling,.         
+000128b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128c0: 2020 2020 2020 2073 6d6f 7465 5f73 616d         smote_sam
+000128d0: 706c 696e 673d 7365 6c66 2e73 6d6f 7465  pling=self.smote
+000128e0: 5f73 616d 706c 696e 672c 2065 6172 6c79  _sampling, early
+000128f0: 5f73 746f 705f 6361 6c6c 6261 636b 3d63  _stop_callback=c
+00012900: 616c 6c62 6163 6b73 2c20 6368 6563 6b70  allbacks, checkp
+00012910: 6f69 6e74 3d46 616c 7365 2c20 7665 7262  oint=False, verb
+00012920: 6f73 653d 7365 6c66 2e76 6572 626f 7365  ose=self.verbose
+00012930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012940: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00012950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012960: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00012970: 6c2c 2068 6973 746f 7279 203d 2063 6e6e  l, history = cnn
+00012980: 5f6d 6f64 656c 2e52 6573 6e65 7431 3828  _model.Resnet18(
+00012990: 636c 6173 735f 312c 2063 6c61 7373 5f32  class_1, class_2
+000129a0: 2c20 696d 675f 6e75 6d5f 6368 616e 6e65  , img_num_channe
+000129b0: 6c73 3d73 656c 662e 696d 675f 6e75 6d5f  ls=self.img_num_
+000129c0: 6368 616e 6e65 6c73 2c20 0a20 2020 2020  channels, .     
+000129d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129e0: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
+000129f0: 6c69 7a65 3d73 656c 662e 6e6f 726d 616c  lize=self.normal
+00012a00: 697a 652c 206d 696e 5f70 6978 656c 3d6d  ize, min_pixel=m
+00012a10: 696e 5f70 6978 2c20 6d61 785f 7069 7865  in_pix, max_pixe
+00012a20: 6c3d 6d61 785f 7069 782c 2076 616c 5f70  l=max_pix, val_p
+00012a30: 6f73 6974 6976 653d 7661 6c5f 636c 6173  ositive=val_clas
+00012a40: 735f 312c 2076 616c 5f6e 6567 6174 6976  s_1, val_negativ
+00012a50: 653d 7661 6c5f 636c 6173 735f 322c 200a  e=val_class_2, .
+00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a80: 6570 6f63 6873 3d73 656c 662e 7472 6169  epochs=self.trai
+00012a90: 6e5f 6570 6f63 6873 2c20 6261 7463 685f  n_epochs, batch_
+00012aa0: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
+00012ab0: 206f 7074 696d 697a 6572 3d6f 7074 696d   optimizer=optim
+00012ac0: 697a 6572 2c20 6c72 3d6c 722c 2064 6563  izer, lr=lr, dec
+00012ad0: 6179 3d64 6563 6179 2c20 6d6f 6d65 6e74  ay=decay, moment
+00012ae0: 756d 3d6d 6f6d 656e 7475 6d2c 206e 6573  um=momentum, nes
+00012af0: 7465 726f 763d 6e65 7374 6572 6f76 2c20  terov=nesterov, 
+00012b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b20: 2062 6574 615f 313d 6265 7461 5f31 2c20   beta_1=beta_1, 
+00012b30: 6265 7461 5f32 3d62 6574 615f 322c 2061  beta_2=beta_2, a
+00012b40: 6d73 6772 6164 3d61 6d73 6772 6164 2c20  msgrad=amsgrad, 
+00012b50: 6c6f 7373 3d6c 6f73 732c 2061 6374 6976  loss=loss, activ
+00012b60: 6174 696f 6e5f 636f 6e76 3d61 6374 6976  ation_conv=activ
+00012b70: 6174 696f 6e5f 636f 6e76 2c20 6163 7469  ation_conv, acti
+00012b80: 7661 7469 6f6e 5f64 656e 7365 3d61 6374  vation_dense=act
+00012b90: 6976 6174 696f 6e5f 6465 6e73 652c 200a  ivation_dense, .
+00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bc0: 636f 6e76 5f69 6e69 743d 636f 6e76 5f69  conv_init=conv_i
+00012bd0: 6e69 742c 2064 656e 7365 5f69 6e69 743d  nit, dense_init=
+00012be0: 6465 6e73 655f 696e 6974 2c20 6d6f 6465  dense_init, mode
+00012bf0: 6c5f 7265 673d 6d6f 6465 6c5f 7265 672c  l_reg=model_reg,
+00012c00: 2066 696c 7465 7273 3d66 696c 7465 7273   filters=filters
+00012c10: 2c20 6669 6c74 6572 5f73 697a 653d 6669  , filter_size=fi
+00012c20: 6c74 6572 5f73 697a 652c 2073 7472 6964  lter_size, strid
+00012c30: 6573 3d73 7472 6964 6573 2c20 200a 2020  es=strides,  .  
+00012c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c50: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00012c60: 6f6c 696e 673d 706f 6f6c 696e 672c 2070  oling=pooling, p
+00012c70: 6f6f 6c5f 7369 7a65 3d70 6f6f 6c5f 7369  ool_size=pool_si
+00012c80: 7a65 2c20 706f 6f6c 5f73 7472 6964 653d  ze, pool_stride=
+00012c90: 706f 6f6c 5f73 7472 6964 652c 2062 6c6f  pool_stride, blo
+00012ca0: 636b 5f66 696c 7465 7273 5f31 3d62 6c6f  ck_filters_1=blo
+00012cb0: 636b 5f66 696c 7465 7273 5f31 2c20 626c  ck_filters_1, bl
+00012cc0: 6f63 6b5f 6669 6c74 6572 735f 323d 626c  ock_filters_2=bl
+00012cd0: 6f63 6b5f 6669 6c74 6572 735f 322c 200a  ock_filters_2, .
+00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d00: 626c 6f63 6b5f 6669 6c74 6572 735f 333d  block_filters_3=
+00012d10: 626c 6f63 6b5f 6669 6c74 6572 735f 332c  block_filters_3,
+00012d20: 2062 6c6f 636b 5f66 696c 7465 7273 5f34   block_filters_4
+00012d30: 3d62 6c6f 636b 5f66 696c 7465 7273 5f34  =block_filters_4
+00012d40: 2c20 626c 6f63 6b5f 6669 6c74 6572 735f  , block_filters_
+00012d50: 7369 7a65 3d62 6c6f 636b 5f66 696c 7465  size=block_filte
+00012d60: 7273 5f73 697a 652c 200a 2020 2020 2020  rs_size, .      
+00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d80: 2020 2020 2020 2020 2020 736d 6f74 655f            smote_
+00012d90: 7361 6d70 6c69 6e67 3d73 656c 662e 736d  sampling=self.sm
+00012da0: 6f74 655f 7361 6d70 6c69 6e67 2c20 6561  ote_sampling, ea
+00012db0: 726c 795f 7374 6f70 5f63 616c 6c62 6163  rly_stop_callbac
+00012dc0: 6b3d 6361 6c6c 6261 636b 732c 2063 6865  k=callbacks, che
+00012dd0: 636b 706f 696e 743d 4661 6c73 652c 2076  ckpoint=False, v
+00012de0: 6572 626f 7365 3d73 656c 662e 7665 7262  erbose=self.verb
+00012df0: 6f73 6529 0a0a 2020 2020 2020 2020 2020  ose)..          
+00012e00: 2020 2020 2020 2349 6620 7468 6520 7061        #If the pa
+00012e10: 7469 656e 6365 2069 7320 7265 6163 6865  tience is reache
+00012e20: 6420 2d2d 2072 6574 7572 6e20 7368 6f75  d -- return shou
+00012e30: 6c64 2062 6520 6120 7661 6c75 6520 7468  ld be a value th
+00012e40: 6174 2063 6f6e 7461 696e 7320 696e 666f  at contains info
+00012e50: 726d 6174 696f 6e20 7265 6761 7264 696e  rmation regardin
+00012e60: 6720 7468 6520 6e75 6d20 6f66 2063 6f6d  g the num of com
+00012e70: 706c 6574 6564 2065 706f 6368 732c 206f  pleted epochs, o
+00012e80: 7468 6572 7769 7365 2069 6620 7265 7475  therwise if retu
+00012e90: 726e 2030 2065 7665 7279 2074 696d 6520  rn 0 every time 
+00012ea0: 7468 656e 2074 6865 206f 7074 696d 697a  then the optimiz
+00012eb0: 6572 206d 6179 2067 6574 2073 7475 636b  er may get stuck
+00012ec0: 230a 2020 2020 2020 2020 2020 2020 2020  #.              
+00012ed0: 2020 6966 206c 656e 2868 6973 746f 7279    if len(history
+00012ee0: 2e68 6973 746f 7279 5b27 6c6f 7373 275d  .history['loss']
+00012ef0: 2920 213d 2073 656c 662e 7472 6169 6e5f  ) != self.train_
+00012f00: 6570 6f63 6873 3a0a 2020 2020 2020 2020  epochs:.        
+00012f10: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00012f20: 7428 293b 2070 7269 6e74 2827 5468 6520  t(); print('The 
+00012f30: 7472 6169 6e69 6e67 2070 6174 6965 6e63  training patienc
+00012f40: 6520 7761 7320 7265 6163 6865 642e 2e2e  e was reached...
+00012f50: 2729 3b20 7072 696e 7428 290a 2020 2020  '); print().    
+00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f70: 7265 7475 726e 2028 6c65 6e28 6869 7374  return (len(hist
+00012f80: 6f72 792e 6869 7374 6f72 795b 276c 6f73  ory.history['los
+00012f90: 7327 5d29 202a 2030 2e30 3031 2920 2d20  s']) * 0.001) - 
+00012fa0: 3939 392e 300a 0a20 2020 2020 2020 2020  999.0..         
+00012fb0: 2020 2020 2020 2023 4966 2074 6865 2074         #If the t
+00012fc0: 7261 696e 696e 6720 6661 696c 7320 7265  raining fails re
+00012fd0: 7475 726e 204e 614e 2072 6967 6874 2061  turn NaN right a
+00012fe0: 7761 7923 0a20 2020 2020 2020 2020 2020  way#.           
+00012ff0: 2020 2020 2069 6620 6e70 2e69 7366 696e       if np.isfin
+00013000: 6974 6528 6869 7374 6f72 792e 6869 7374  ite(history.hist
+00013010: 6f72 795b 276c 6f73 7327 5d5b 2d31 5d29  ory['loss'][-1])
+00013020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013030: 2020 2020 2020 6d6f 6465 6c73 2e61 7070        models.app
+00013040: 656e 6428 6d6f 6465 6c29 2c20 6869 7374  end(model), hist
+00013050: 6f72 6965 732e 6170 7065 6e64 2868 6973  ories.append(his
+00013060: 746f 7279 290a 2020 2020 2020 2020 2020  tory).          
+00013070: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00013080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013090: 7072 696e 7428 293b 2070 7269 6e74 2827  print(); print('
+000130a0: 5472 6169 6e69 6e67 2066 6169 6c65 6420  Training failed 
+000130b0: 6475 6520 746f 206e 756d 6572 6963 616c  due to numerical
+000130c0: 2069 6e73 7461 6269 6c69 7479 2c20 7265   instability, re
+000130d0: 7475 726e 696e 6720 6e61 6e2e 2e2e 2729  turning nan...')
+000130e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000130f0: 2020 2020 2072 6574 7572 6e20 6e70 2e6e       return np.n
+00013100: 616e 200a 0a20 2020 2020 2020 2023 2323  an ..        ###
+00013110: 2323 2320 4164 6469 7469 6f6e 616c 2074  ### Additional t
+00013120: 6573 7420 6461 7461 206d 6574 7269 632c  est data metric,
+00013130: 206f 7074 696f 6e61 6c20 696e 7075 7420   optional input 
+00013140: 2323 2323 2323 0a20 2020 2020 2020 2069  ######.        i
+00013150: 6620 7365 6c66 2e74 6573 745f 706f 7369  f self.test_posi
+00013160: 7469 7665 2069 7320 6e6f 7420 4e6f 6e65  tive is not None
+00013170: 206f 7220 7365 6c66 2e74 6573 745f 6e65   or self.test_ne
+00013180: 6761 7469 7665 2069 7320 6e6f 7420 4e6f  gative is not No
+00013190: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000131a0: 6966 2073 656c 662e 7465 7374 5f70 6f73  if self.test_pos
+000131b0: 6974 6976 6520 6973 206e 6f74 204e 6f6e  itive is not Non
+000131c0: 6520 616e 6420 7365 6c66 2e74 6573 745f  e and self.test_
+000131d0: 6e65 6761 7469 7665 2069 7320 6e6f 7420  negative is not 
+000131e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000131f0: 2020 2020 2020 706f 7369 7469 7665 5f74        positive_t
+00013200: 6573 745f 6372 6f70 2c20 6e65 6761 7469  est_crop, negati
+00013210: 7665 5f74 6573 745f 6372 6f70 203d 2072  ve_test_crop = r
+00013220: 6573 697a 6528 7365 6c66 2e74 6573 745f  esize(self.test_
+00013230: 706f 7369 7469 7665 2c20 7369 7a65 3d69  positive, size=i
+00013240: 6d61 6765 5f73 697a 6529 2c20 7265 7369  mage_size), resi
+00013250: 7a65 2873 656c 662e 7465 7374 5f6e 6567  ze(self.test_neg
+00013260: 6174 6976 652c 2073 697a 653d 696d 6167  ative, size=imag
+00013270: 655f 7369 7a65 290a 2020 2020 2020 2020  e_size).        
+00013280: 2020 2020 2020 2020 585f 7465 7374 2c20          X_test, 
+00013290: 595f 7465 7374 203d 2064 6174 615f 7072  Y_test = data_pr
+000132a0: 6f63 6573 7369 6e67 2e63 7265 6174 655f  ocessing.create_
+000132b0: 7472 6169 6e69 6e67 5f73 6574 2870 6f73  training_set(pos
+000132c0: 6974 6976 655f 7465 7374 5f63 726f 702c  itive_test_crop,
+000132d0: 206e 6567 6174 6976 655f 7465 7374 5f63   negative_test_c
+000132e0: 726f 702c 206e 6f72 6d61 6c69 7a65 3d73  rop, normalize=s
+000132f0: 656c 662e 6e6f 726d 616c 697a 652c 206d  elf.normalize, m
+00013300: 696e 5f70 6978 656c 3d6d 696e 5f70 6978  in_pixel=min_pix
+00013310: 2c20 6d61 785f 7069 7865 6c3d 6d61 785f  , max_pixel=max_
+00013320: 7069 782c 2069 6d67 5f6e 756d 5f63 6861  pix, img_num_cha
+00013330: 6e6e 656c 733d 7365 6c66 2e69 6d67 5f6e  nnels=self.img_n
+00013340: 756d 5f63 6861 6e6e 656c 7329 0a20 2020  um_channels).   
+00013350: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
+00013360: 6c66 2e74 6573 745f 706f 7369 7469 7665  lf.test_positive
+00013370: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00013380: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00013390: 7369 7469 7665 5f74 6573 745f 6372 6f70  sitive_test_crop
+000133a0: 203d 2072 6573 697a 6528 7365 6c66 2e74   = resize(self.t
+000133b0: 6573 745f 706f 7369 7469 7665 2c20 7369  est_positive, si
+000133c0: 7a65 3d69 6d61 6765 5f73 697a 6529 0a20  ze=image_size). 
+000133d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000133e0: 6f73 6974 6976 655f 636c 6173 735f 6461  ositive_class_da
+000133f0: 7461 2c20 706f 7369 7469 7665 5f63 6c61  ta, positive_cla
+00013400: 7373 5f6c 6162 656c 203d 2064 6174 615f  ss_label = data_
+00013410: 7072 6f63 6573 7369 6e67 2e70 726f 6365  processing.proce
+00013420: 7373 5f63 6c61 7373 2870 6f73 6974 6976  ss_class(positiv
+00013430: 655f 7465 7374 5f63 726f 702c 206c 6162  e_test_crop, lab
+00013440: 656c 3d31 2c20 6e6f 726d 616c 697a 653d  el=1, normalize=
+00013450: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 2c20  self.normalize, 
+00013460: 6d69 6e5f 7069 7865 6c3d 6d69 6e5f 7069  min_pixel=min_pi
+00013470: 782c 206d 6178 5f70 6978 656c 3d6d 6178  x, max_pixel=max
+00013480: 5f70 6978 2c20 696d 675f 6e75 6d5f 6368  _pix, img_num_ch
+00013490: 616e 6e65 6c73 3d73 656c 662e 696d 675f  annels=self.img_
+000134a0: 6e75 6d5f 6368 616e 6e65 6c73 290a 2020  num_channels).  
+000134b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000134c0: 2073 656c 662e 7465 7374 5f6e 6567 6174   self.test_negat
+000134d0: 6976 6520 6973 206e 6f74 204e 6f6e 653a  ive is not None:
+000134e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000134f0: 2020 2020 206e 6567 6174 6976 655f 7465       negative_te
+00013500: 7374 5f63 726f 7020 3d20 7265 7369 7a65  st_crop = resize
+00013510: 2873 656c 662e 7465 7374 5f6e 6567 6174  (self.test_negat
+00013520: 6976 652c 2073 697a 653d 696d 6167 655f  ive, size=image_
+00013530: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+00013540: 2020 2020 2020 2020 2020 6e65 6761 7469            negati
+00013550: 7665 5f63 6c61 7373 5f64 6174 612c 206e  ve_class_data, n
+00013560: 6567 6174 6976 655f 636c 6173 735f 6c61  egative_class_la
+00013570: 6265 6c20 3d20 6461 7461 5f70 726f 6365  bel = data_proce
+00013580: 7373 696e 672e 7072 6f63 6573 735f 636c  ssing.process_cl
+00013590: 6173 7328 6e65 6761 7469 7665 5f74 6573  ass(negative_tes
+000135a0: 745f 6372 6f70 2c20 6c61 6265 6c3d 302c  t_crop, label=0,
+000135b0: 206e 6f72 6d61 6c69 7a65 3d73 656c 662e   normalize=self.
+000135c0: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
+000135d0: 6978 656c 3d6d 696e 5f70 6978 2c20 6d61  ixel=min_pix, ma
+000135e0: 785f 7069 7865 6c3d 6d61 785f 7069 782c  x_pixel=max_pix,
+000135f0: 2069 6d67 5f6e 756d 5f63 6861 6e6e 656c   img_num_channel
+00013600: 733d 7365 6c66 2e69 6d67 5f6e 756d 5f63  s=self.img_num_c
+00013610: 6861 6e6e 656c 7329 0a20 2020 2020 2020  hannels).       
+00013620: 2020 2020 2020 2020 2020 2020 2058 5f74               X_t
+00013630: 6573 742c 2059 5f74 6573 7420 3d20 6e70  est, Y_test = np
+00013640: 2e72 5f5b 706f 7369 7469 7665 5f63 6c61  .r_[positive_cla
+00013650: 7373 5f64 6174 612c 206e 6567 6174 6976  ss_data, negativ
+00013660: 655f 636c 6173 735f 6461 7461 5d2c 206e  e_class_data], n
+00013670: 702e 725f 5b70 6f73 6974 6976 655f 636c  p.r_[positive_cl
+00013680: 6173 735f 6c61 6265 6c2c 206e 6567 6174  ass_label, negat
+00013690: 6976 655f 636c 6173 735f 6c61 6265 6c5d  ive_class_label]
+000136a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000136b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000136c0: 2020 2020 2020 2020 2020 2058 5f74 6573             X_tes
+000136d0: 742c 2059 5f74 6573 7420 3d20 706f 7369  t, Y_test = posi
+000136e0: 7469 7665 5f63 6c61 7373 5f64 6174 612c  tive_class_data,
+000136f0: 2070 6f73 6974 6976 655f 636c 6173 735f   positive_class_
+00013700: 6c61 6265 6c0a 2020 2020 2020 2020 2020  label.          
+00013710: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013720: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013730: 7465 7374 5f6e 6567 6174 6976 6520 6973  test_negative is
+00013740: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00013750: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00013760: 6567 6174 6976 655f 7465 7374 5f63 726f  egative_test_cro
+00013770: 7020 3d20 7265 7369 7a65 2873 656c 662e  p = resize(self.
+00013780: 7465 7374 5f6e 6567 6174 6976 652c 2073  test_negative, s
+00013790: 697a 653d 696d 6167 655f 7369 7a65 290a  ize=image_size).
+000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137b0: 2020 2020 585f 7465 7374 2c20 595f 7465      X_test, Y_te
+000137c0: 7374 203d 2064 6174 615f 7072 6f63 6573  st = data_proces
+000137d0: 7369 6e67 2e70 726f 6365 7373 5f63 6c61  sing.process_cla
+000137e0: 7373 286e 6567 6174 6976 655f 7465 7374  ss(negative_test
+000137f0: 5f63 726f 702c 206c 6162 656c 3d30 2c20  _crop, label=0, 
+00013800: 6e6f 726d 616c 697a 653d 7365 6c66 2e6e  normalize=self.n
+00013810: 6f72 6d61 6c69 7a65 2c20 6d69 6e5f 7069  ormalize, min_pi
+00013820: 7865 6c3d 6d69 6e5f 7069 782c 206d 6178  xel=min_pix, max
+00013830: 5f70 6978 656c 3d6d 6178 5f70 6978 2c20  _pixel=max_pix, 
+00013840: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+00013850: 3d73 656c 662e 696d 675f 6e75 6d5f 6368  =self.img_num_ch
+00013860: 616e 6e65 6c73 290a 2020 2020 2020 2020  annels).        
+00013870: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00013880: 2020 2323 234c 6f6f 7020 7468 726f 7567    ###Loop throug
+00013890: 6820 616c 6c20 7468 6520 6d6f 6465 6c73  h all the models
+000138a0: 2074 6f20 6361 6c63 756c 6174 6520 7468   to calculate th
+000138b0: 6520 7065 7266 6f72 6d61 6e63 6520 6f66  e performance of
+000138c0: 2065 6163 6823 2323 0a20 2020 2020 2020   each###.       
+000138d0: 2020 2020 2074 6573 7420 3d20 5b5d 0a20       test = []. 
+000138e0: 2020 2020 2020 2020 2020 2066 6f72 205f             for _
+000138f0: 6d6f 6465 6c5f 2069 6e20 6d6f 6465 6c73  model_ in models
+00013900: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+00013910: 2020 2074 6573 745f 6c6f 7373 2c20 7465     test_loss, te
+00013920: 7374 5f61 6363 2c20 7465 7374 5f66 315f  st_acc, test_f1_
+00013930: 7363 6f72 6520 3d20 5f6d 6f64 656c 5f2e  score = _model_.
+00013940: 6576 616c 7561 7465 2858 5f74 6573 742c  evaluate(X_test,
+00013950: 2059 5f74 6573 742c 2062 6174 6368 5f73   Y_test, batch_s
+00013960: 697a 653d 6c65 6e28 585f 7465 7374 2929  ize=len(X_test))
+00013970: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013980: 2020 6966 2073 656c 662e 7465 7374 5f61    if self.test_a
+00013990: 6363 5f74 6872 6573 686f 6c64 2069 7320  cc_threshold is 
+000139a0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000139b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000139c0: 2074 6573 745f 6163 6320 3c20 7365 6c66   test_acc < self
+000139d0: 2e74 6573 745f 6163 635f 7468 7265 7368  .test_acc_thresh
+000139e0: 6f6c 643a 0a20 2020 2020 2020 2020 2020  old:.           
+000139f0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00013a00: 6e74 2829 3b20 7072 696e 7428 2754 6865  nt(); print('The
+00013a10: 2074 6573 7420 6461 7461 2061 6363 7572   test data accur
+00013a20: 6163 7920 6661 6c6c 7320 6265 6c6f 7720  acy falls below 
+00013a30: 7468 6520 7465 7374 5f61 6363 5f74 6872  the test_acc_thr
+00013a40: 6573 686f 6c64 2e2e 2e27 293b 2070 7269  eshold...'); pri
+00013a50: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
+00013a60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00013a70: 7572 6e20 286c 656e 2868 6973 746f 7279  urn (len(history
+00013a80: 2e68 6973 746f 7279 5b27 6c6f 7373 275d  .history['loss']
+00013a90: 2920 2a20 302e 3030 3129 202d 2039 3939  ) * 0.001) - 999
+00013aa0: 2e30 202b 2074 6573 745f 6163 6320 0a0a  .0 + test_acc ..
+00013ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ac0: 6966 2027 6c6f 7373 2720 696e 2073 656c  if 'loss' in sel
+00013ad0: 662e 6d65 7472 6963 3a0a 2020 2020 2020  f.metric:.      
+00013ae0: 2020 2020 2020 2020 2020 2020 2020 7465                te
+00013af0: 7374 5f6d 6574 7269 6320 3d20 3120 2d20  st_metric = 1 - 
+00013b00: 7465 7374 5f6c 6f73 730a 2020 2020 2020  test_loss.      
+00013b10: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
+00013b20: 6163 6327 2069 6e20 7365 6c66 2e6d 6574  acc' in self.met
+00013b30: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
+00013b40: 2020 2020 2020 2020 2074 6573 745f 6d65           test_me
+00013b50: 7472 6963 203d 2074 6573 745f 6163 6320  tric = test_acc 
+00013b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013b70: 2065 6c69 6620 2766 3127 2069 6e20 7365   elif 'f1' in se
+00013b80: 6c66 2e6d 6574 7269 633a 0a20 2020 2020  lf.metric:.     
+00013b90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00013ba0: 6573 745f 6d65 7472 6963 203d 2074 6573  est_metric = tes
+00013bb0: 745f 6631 5f73 636f 7265 0a20 2020 2020  t_f1_score.     
+00013bc0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00013bd0: 2761 6c6c 2720 696e 2073 656c 662e 6d65  'all' in self.me
+00013be0: 7472 6963 3a0a 2020 2020 2020 2020 2020  tric:.          
+00013bf0: 2020 2020 2020 2020 2020 7465 7374 5f6d            test_m
+00013c00: 6574 7269 6320 3d20 6e70 2e6d 6561 6e28  etric = np.mean(
+00013c10: 5b31 202d 2074 6573 745f 6c6f 7373 2c20  [1 - test_loss, 
+00013c20: 7465 7374 5f61 6363 2c20 7465 7374 5f66  test_acc, test_f
+00013c30: 315f 7363 6f72 655d 290a 2020 2020 2020  1_score]).      
+00013c40: 2020 2020 2020 2020 2020 7465 7374 2e61            test.a
+00013c50: 7070 656e 6428 7465 7374 5f6d 6574 7269  ppend(test_metri
+00013c60: 6329 0a0a 2020 2020 2020 2020 2020 2020  c)..            
+00013c70: 7465 7374 5f6d 6574 7269 6320 3d20 6e70  test_metric = np
+00013c80: 2e6d 6561 6e28 7465 7374 290a 2020 2020  .mean(test).    
+00013c90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013ca0: 7665 7262 6f73 6520 3d3d 2031 2061 6e64  verbose == 1 and
+00013cb0: 2073 656c 662e 706f 7374 5f6d 6574 7269   self.post_metri
+00013cc0: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
+00013cd0: 2020 2070 7269 6e74 2829 3b20 7072 696e     print(); prin
+00013ce0: 7428 2750 6f73 742d 5472 6961 6c20 4d65  t('Post-Trial Me
+00013cf0: 7472 6963 3a20 272b 7374 7228 7465 7374  tric: '+str(test
+00013d00: 5f6d 6574 7269 6329 290a 2020 2020 2020  _metric)).      
+00013d10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013d20: 2020 2020 7465 7374 5f6d 6574 7269 6320      test_metric 
+00013d30: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+00013d40: 2354 6865 2074 6573 745f 6d65 7472 6963  #The test_metric
+00013d50: 2069 7320 6361 6c63 756c 6174 6564 2065   is calculated e
+00013d60: 7665 6e20 6966 2070 6f73 745f 6d65 7472  ven if post_metr
+00013d70: 6963 3d46 616c 7365 2c20 666f 7220 7369  ic=False, for si
+00013d80: 6d70 6c69 6369 7479 2e2e 2e20 5475 726e  mplicity... Turn
+00013d90: 696e 6720 6f66 6620 6865 7265 2e2e 2e0a  ing off here....
+00013da0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013db0: 706f 7374 5f6d 6574 7269 6320 6973 2046  post_metric is F
+00013dc0: 616c 7365 3a0a 2020 2020 2020 2020 2020  alse:.          
+00013dd0: 2020 7465 7374 5f6d 6574 7269 6320 3d20    test_metric = 
+00013de0: 4e6f 6e65 200a 0a20 2020 2020 2020 2023  None ..        #
+00013df0: 2323 2043 616c 6375 6c61 7465 2074 6865  ## Calculate the
+00013e00: 2066 696e 616c 206f 7074 696d 697a 6174   final optimizat
+00013e10: 696f 6e20 6d65 7472 6963 2023 2323 0a20  ion metric ###. 
+00013e20: 2020 2020 2020 206d 6574 7269 6373 203d         metrics =
+00013e30: 205b 276c 6f73 7327 2c20 2762 696e 6172   ['loss', 'binar
+00013e40: 795f 6163 6375 7261 6379 272c 2027 6631  y_accuracy', 'f1
+00013e50: 5f73 636f 7265 275d 0a20 2020 2020 2020  _score'].       
+00013e60: 2069 6620 7365 6c66 2e6d 6574 7269 6320   if self.metric 
+00013e70: 3d3d 2027 616c 6c27 3a20 2341 7665 7261  == 'all': #Avera
+00013e80: 6765 2061 6c6c 2074 6865 2074 7261 696e  ge all the train
+00013e90: 696e 6720 6d65 7472 6963 730a 2020 2020  ing metrics.    
+00013ea0: 2020 2020 2020 2020 7472 6169 6e69 6e67          training
+00013eb0: 5f6d 6574 7269 6373 5f6d 6561 6e2c 2074  _metrics_mean, t
+00013ec0: 7261 696e 696e 675f 6c6f 7373 5f6d 6561  raining_loss_mea
+00013ed0: 6e20 3d20 5b5d 2c20 5b5d 0a20 2020 2020  n = [], [].     
+00013ee0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
+00013ef0: 7665 7261 6765 3a0a 2020 2020 2020 2020  verage:.        
+00013f00: 2020 2020 2020 2020 666f 7220 5f68 6973          for _his
+00013f10: 746f 7279 5f20 696e 2068 6973 746f 7269  tory_ in histori
+00013f20: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00013f30: 2020 2020 2020 2020 7472 6169 6e69 6e67          training
+00013f40: 5f6d 6574 7269 6373 5f6d 6561 6e2e 6170  _metrics_mean.ap
+00013f50: 7065 6e64 286e 702e 6d65 616e 285b 6e70  pend(np.mean([np
+00013f60: 2e6d 6561 6e28 5f68 6973 746f 7279 5f2e  .mean(_history_.
+00013f70: 6869 7374 6f72 795b 6d65 7472 6963 5d29  history[metric])
+00013f80: 2066 6f72 206d 6574 7269 6320 696e 206d   for metric in m
+00013f90: 6574 7269 6373 2069 6620 276c 6f73 7327  etrics if 'loss'
+00013fa0: 206e 6f74 2069 6e20 6d65 7472 6963 5d29   not in metric])
+00013fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013fc0: 2020 2020 2020 7472 6169 6e69 6e67 5f6c        training_l
+00013fd0: 6f73 735f 6d65 616e 2e61 7070 656e 6428  oss_mean.append(
+00013fe0: 3120 2d20 6e70 2e6d 6561 6e28 5f68 6973  1 - np.mean(_his
+00013ff0: 746f 7279 5f2e 6869 7374 6f72 795b 276c  tory_.history['l
+00014000: 6f73 7327 5d29 290a 2020 2020 2020 2020  oss'])).        
+00014010: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00014020: 2020 2020 2020 2020 2020 666f 7220 5f68            for _h
+00014030: 6973 746f 7279 5f20 696e 2068 6973 746f  istory_ in histo
+00014040: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+00014050: 2020 2020 2020 2020 2020 7472 6169 6e69            traini
+00014060: 6e67 5f6d 6574 7269 6373 5f6d 6561 6e2e  ng_metrics_mean.
+00014070: 6170 7065 6e64 286e 702e 6d65 616e 285b  append(np.mean([
+00014080: 5f68 6973 746f 7279 5f2e 6869 7374 6f72  _history_.histor
+00014090: 795b 6d65 7472 6963 5d5b 2d31 5d20 666f  y[metric][-1] fo
+000140a0: 7220 6d65 7472 6963 2069 6e20 6d65 7472  r metric in metr
+000140b0: 6963 7320 6966 2027 6c6f 7373 2720 6e6f  ics if 'loss' no
+000140c0: 7420 696e 206d 6574 7269 635d 2929 0a20  t in metric])). 
+000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140e0: 2020 2074 7261 696e 696e 675f 6c6f 7373     training_loss
+000140f0: 5f6d 6561 6e2e 6170 7065 6e64 2831 202d  _mean.append(1 -
+00014100: 205f 6869 7374 6f72 795f 2e68 6973 746f   _history_.histo
+00014110: 7279 5b27 6c6f 7373 275d 5b2d 315d 290a  ry['loss'][-1]).
+00014120: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00014130: 6573 745f 6d65 7472 6963 2069 7320 4e6f  est_metric is No
+00014140: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00014150: 2020 2020 6669 6e61 6c5f 7363 6f72 6520      final_score 
+00014160: 3d20 6e70 2e6d 6561 6e28 5b74 7261 696e  = np.mean([train
+00014170: 696e 675f 6d65 7472 6963 735f 6d65 616e  ing_metrics_mean
+00014180: 2c20 7472 6169 6e69 6e67 5f6c 6f73 735f  , training_loss_
+00014190: 6d65 616e 5d29 0a20 2020 2020 2020 2020  mean]).         
+000141a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000141b0: 2020 2020 2020 2020 2066 696e 616c 5f73           final_s
+000141c0: 636f 7265 203d 206e 702e 6d65 616e 285b  core = np.mean([
+000141d0: 7472 6169 6e69 6e67 5f6d 6574 7269 6373  training_metrics
+000141e0: 5f6d 6561 6e2c 2074 7261 696e 696e 675f  _mean, training_
+000141f0: 6c6f 7373 5f6d 6561 6e2c 2074 6573 745f  loss_mean, test_
+00014200: 6d65 7472 6963 5d29 0a20 2020 2020 2020  metric]).       
+00014210: 2065 6c69 6620 7365 6c66 2e6d 6574 7269   elif self.metri
+00014220: 6320 3d3d 2027 7661 6c5f 616c 6c27 3a20  c == 'val_all': 
+00014230: 2341 7665 7261 6765 2061 6c6c 2074 6865  #Average all the
+00014240: 2076 616c 6964 6174 696f 6e20 6d65 7472   validation metr
+00014250: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+00014260: 7661 6c5f 6d65 7472 6963 735f 6d65 616e  val_metrics_mean
+00014270: 2c20 7661 6c5f 6c6f 7373 5f6d 6561 6e20  , val_loss_mean 
+00014280: 3d20 5b5d 2c20 5b5d 200a 2020 2020 2020  = [], [] .      
+00014290: 2020 2020 2020 6966 2073 656c 662e 6176        if self.av
+000142a0: 6572 6167 653a 0a20 2020 2020 2020 2020  erage:.         
+000142b0: 2020 2020 2020 2066 6f72 205f 6869 7374         for _hist
+000142c0: 6f72 795f 2069 6e20 6869 7374 6f72 6965  ory_ in historie
+000142d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000142e0: 2020 2020 2020 2076 616c 5f6d 6574 7269         val_metri
+000142f0: 6373 5f6d 6561 6e2e 6170 7065 6e64 286e  cs_mean.append(n
+00014300: 702e 6d65 616e 285b 6e70 2e6d 6561 6e28  p.mean([np.mean(
+00014310: 5f68 6973 746f 7279 5f2e 6869 7374 6f72  _history_.histor
+00014320: 795b 2776 616c 5f27 2b6d 6574 7269 635d  y['val_'+metric]
+00014330: 2920 666f 7220 6d65 7472 6963 2069 6e20  ) for metric in 
+00014340: 6d65 7472 6963 7320 6966 2027 6c6f 7373  metrics if 'loss
+00014350: 2720 6e6f 7420 696e 206d 6574 7269 635d  ' not in metric]
+00014360: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00014370: 2020 2020 2020 2076 616c 5f6c 6f73 735f         val_loss_
+00014380: 6d65 616e 2e61 7070 656e 6428 3120 2d20  mean.append(1 - 
+00014390: 6e70 2e6d 6561 6e28 5f68 6973 746f 7279  np.mean(_history
+000143a0: 5f2e 6869 7374 6f72 795b 2776 616c 5f6c  _.history['val_l
+000143b0: 6f73 7327 5d29 290a 2020 2020 2020 2020  oss'])).        
+000143c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000143d0: 2020 2020 2020 2020 2020 666f 7220 5f68            for _h
+000143e0: 6973 746f 7279 5f20 696e 2068 6973 746f  istory_ in histo
+000143f0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+00014400: 2020 2020 2020 2020 2020 7661 6c5f 6d65            val_me
+00014410: 7472 6963 735f 6d65 616e 2e61 7070 656e  trics_mean.appen
+00014420: 6428 6e70 2e6d 6561 6e28 5b5f 6869 7374  d(np.mean([_hist
+00014430: 6f72 795f 2e68 6973 746f 7279 5b27 7661  ory_.history['va
+00014440: 6c5f 272b 6d65 7472 6963 5d5b 2d31 5d20  l_'+metric][-1] 
+00014450: 666f 7220 6d65 7472 6963 2069 6e20 6d65  for metric in me
+00014460: 7472 6963 7320 6966 2027 6c6f 7373 2720  trics if 'loss' 
+00014470: 6e6f 7420 696e 206d 6574 7269 635d 2929  not in metric]))
+00014480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014490: 2020 2020 2076 616c 5f6c 6f73 735f 6d65       val_loss_me
+000144a0: 616e 2e61 7070 656e 6428 3120 2d20 5f68  an.append(1 - _h
+000144b0: 6973 746f 7279 5f2e 6869 7374 6f72 795b  istory_.history[
+000144c0: 2776 616c 5f6c 6f73 7327 5d5b 2d31 5d29  'val_loss'][-1])
+000144d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000144e0: 7465 7374 5f6d 6574 7269 6320 6973 204e  test_metric is N
+000144f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00014500: 2020 2020 2066 696e 616c 5f73 636f 7265       final_score
+00014510: 203d 206e 702e 6d65 616e 285b 7661 6c5f   = np.mean([val_
+00014520: 6d65 7472 6963 735f 6d65 616e 2c20 7661  metrics_mean, va
+00014530: 6c5f 6c6f 7373 5f6d 6561 6e5d 290a 2020  l_loss_mean]).  
+00014540: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014560: 6669 6e61 6c5f 7363 6f72 6520 3d20 6e70  final_score = np
+00014570: 2e6d 6561 6e28 5b76 616c 5f6d 6574 7269  .mean([val_metri
+00014580: 6373 5f6d 6561 6e2c 2076 616c 5f6c 6f73  cs_mean, val_los
+00014590: 735f 6d65 616e 2c20 7465 7374 5f6d 6574  s_mean, test_met
+000145a0: 7269 635d 290a 2020 2020 2020 2020 656c  ric]).        el
+000145b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000145c0: 7363 6f72 6573 203d 205b 5d0a 2020 2020  scores = [].    
+000145d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000145e0: 6176 6572 6167 653a 0a20 2020 2020 2020  average:.       
+000145f0: 2020 2020 2020 2020 2066 6f72 205f 6869           for _hi
+00014600: 7374 6f72 795f 2069 6e20 6869 7374 6f72  story_ in histor
+00014610: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
+00014620: 2020 2020 2020 2020 2073 636f 7265 732e           scores.
+00014630: 6170 7065 6e64 286e 702e 6d65 616e 285f  append(np.mean(_
+00014640: 6869 7374 6f72 795f 2e68 6973 746f 7279  history_.history
+00014650: 5b73 656c 662e 6d65 7472 6963 5d29 290a  [self.metric])).
+00014660: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00014670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014680: 2020 666f 7220 5f68 6973 746f 7279 5f20    for _history_ 
+00014690: 696e 2068 6973 746f 7269 6573 3a0a 2020  in histories:.  
+000146a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146b0: 2020 7363 6f72 6573 2e61 7070 656e 6428    scores.append(
+000146c0: 5f68 6973 746f 7279 5f2e 6869 7374 6f72  _history_.histor
+000146d0: 795b 7365 6c66 2e6d 6574 7269 635d 5b2d  y[self.metric][-
+000146e0: 315d 290a 0a20 2020 2020 2020 2020 2020  1])..           
+000146f0: 2066 696e 616c 5f73 636f 7265 203d 206e   final_score = n
+00014700: 702e 6d65 616e 2873 636f 7265 7329 0a0a  p.mean(scores)..
+00014710: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00014720: 6c6f 7373 2720 696e 2073 656c 662e 6d65  loss' in self.me
+00014730: 7472 6963 3a20 0a20 2020 2020 2020 2020  tric: .         
+00014740: 2020 2020 2020 2066 696e 616c 5f73 636f         final_sco
+00014750: 7265 203d 2031 202d 2066 696e 616c 5f73  re = 1 - final_s
+00014760: 636f 7265 0a20 2020 2020 2020 2020 2020  core.           
+00014770: 2069 6620 7465 7374 5f6d 6574 7269 6320   if test_metric 
+00014780: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00014790: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+000147a0: 616c 5f73 636f 7265 203d 2028 6669 6e61  al_score = (fina
+000147b0: 6c5f 7363 6f72 6520 2b20 7465 7374 5f6d  l_score + test_m
+000147c0: 6574 7269 6329 202f 2032 2e30 0a0a 2020  etric) / 2.0..  
+000147d0: 2020 2020 2020 2352 454d 494e 4445 5220        #REMINDER 
+000147e0: 544f 204d 4f56 4520 494e 434c 5544 4520  TO MOVE INCLUDE 
+000147f0: 5448 4553 4520 4245 464f 5245 2045 5645  THESE BEFORE EVE
+00014800: 5259 2052 4554 5552 4e21 2049 4620 5452  RY RETURN! IF TR
+00014810: 4941 4c20 5354 4f50 5320 4541 524c 5920  IAL STOPS EARLY 
+00014820: 4954 2044 4f45 534e 2754 2052 4541 4348  IT DOESN'T REACH
+00014830: 2054 4845 2045 4e44 0a20 2020 2020 2020   THE END.       
+00014840: 2069 6620 7365 6c66 2e73 6176 655f 6d6f   if self.save_mo
+00014850: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
+00014860: 2020 7361 7665 5f6d 6f64 656c 286d 6f64    save_model(mod
+00014870: 656c 2c20 7061 7468 2b27 6d6f 6465 6c5f  el, path+'model_
+00014880: 7472 6961 6c5f 272b 7374 7228 7472 6961  trial_'+str(tria
+00014890: 6c2e 6e75 6d62 6572 2929 0a20 2020 2020  l.number)).     
+000148a0: 2020 2069 6620 7365 6c66 2e73 6176 655f     if self.save_
+000148b0: 7374 7564 6965 733a 0a20 2020 2020 2020  studies:.       
+000148c0: 2020 2020 206a 6f62 6c69 622e 6475 6d70       joblib.dump
+000148d0: 2874 7269 616c 2e73 7475 6479 2c20 7061  (trial.study, pa
+000148e0: 7468 2b27 7374 7564 7927 290a 0a20 2020  th+'study')..   
+000148f0: 2020 2020 2072 6574 7572 6e20 6669 6e61       return fina
+00014900: 6c5f 7363 6f72 650a 2020 2020 2020 2020  l_score.        
+00014910: 0a0a 636c 6173 7320 6f62 6a65 6374 6976  ..class objectiv
+00014920: 655f 7867 6228 6f62 6a65 6374 293a 0a20  e_xgb(object):. 
+00014930: 2020 2022 2222 0a20 2020 204f 7074 696d     """.    Optim
+00014940: 697a 6174 696f 6e20 6f62 6a65 6374 6976  ization objectiv
+00014950: 6520 6675 6e63 7469 6f6e 2066 6f72 2074  e function for t
+00014960: 6865 2074 7265 652d 6261 7365 6420 5847  he tree-based XG
+00014970: 426f 6f73 7420 636c 6173 7369 6669 6572  Boost classifier
+00014980: 2e20 0a20 2020 2054 6865 204f 7074 756e  . .    The Optun
+00014990: 6120 736f 6674 7761 7265 2066 6f72 2068  a software for h
+000149a0: 7970 6572 7061 7261 6d65 7465 7220 6f70  yperparameter op
+000149b0: 7469 6d69 7a61 7469 6f6e 2077 6173 2070  timization was p
+000149c0: 7562 6c69 7368 6564 2069 6e20 0a20 2020  ublished in .   
+000149d0: 2032 3031 3920 6279 2041 6b69 6261 2065   2019 by Akiba e
+000149e0: 7420 616c 2e20 5061 7065 723a 2068 7474  t al. Paper: htt
+000149f0: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
+00014a00: 6273 2f31 3930 372e 3130 3930 320a 2020  bs/1907.10902.  
+00014a10: 2020 0a20 2020 204e 6f74 653a 0a20 2020    .    Note:.   
+00014a20: 2020 2020 2049 6620 6f70 745f 6376 2069       If opt_cv i
+00014a30: 7320 6265 7477 6565 6e20 3020 616e 6420  s between 0 and 
+00014a40: 312c 2061 2070 7275 6e69 6e67 2070 726f  1, a pruning pro
+00014a50: 6365 6475 7265 2077 696c 6c20 6265 2069  cedure will be i
+00014a60: 6e69 7469 6c69 617a 6564 2028 6120 7072  nitiliazed (a pr
+00014a70: 6f63 6564 7572 6520 696e 636f 6d70 6174  ocedure incompat
+00014a80: 6962 6c65 2077 6974 6820 6372 6f73 732d  ible with cross-
+00014a90: 7661 6c69 6461 7469 6f6e 292c 0a20 2020  validation),.   
+00014aa0: 2020 2020 2073 6f20 6173 2074 6f20 7370       so as to sp
+00014ab0: 6565 6420 7570 2074 6865 2058 4742 206f  eed up the XGB o
+00014ac0: 7074 696d 697a 6174 696f 6e2e 2049 6620  ptimization. If 
+00014ad0: 6f70 745f 6376 2069 7320 6265 7477 6565  opt_cv is betwee
+00014ae0: 6e20 3020 616e 6420 312c 2061 2072 616e  n 0 and 1, a ran
+00014af0: 646f 6d20 7661 6c69 6461 7469 6f6e 2064  dom validation d
+00014b00: 6174 6120 7769 6c6c 2062 6520 6765 6e65  ata will be gene
+00014b10: 7261 7465 6420 6163 636f 7264 696e 6720  rated according 
+00014b20: 746f 2074 6869 7320 7261 7469 6f2c 0a20  to this ratio,. 
+00014b30: 2020 2020 2020 2077 6869 6368 2077 696c         which wil
+00014b40: 6c20 7265 706c 6163 6520 7468 6520 6372  l replace the cr
+00014b50: 6f73 732d 7661 6c69 6461 7469 6f6e 206d  oss-validation m
+00014b60: 6574 686f 6420 7573 6564 2062 7920 6465  ethod used by de
+00014b70: 6661 756c 742e 2049 7420 7769 6c6c 2070  fault. It will p
+00014b80: 7275 6e65 2061 6363 6f72 6469 6e67 0a20  rune according. 
+00014b90: 2020 2020 2020 2074 6f20 7468 6520 6631         to the f1
+00014ba0: 2d73 636f 7265 206f 6620 7468 6520 7661  -score of the va
+00014bb0: 6c69 6461 7469 6f6e 2064 6174 612c 2077  lidation data, w
+00014bc0: 6869 6368 2077 6f75 6c64 2062 6520 3130  hich would be 10
+00014bd0: 2520 6f66 2074 6865 2074 7261 696e 696e  % of the trainin
+00014be0: 6720 6461 7461 2069 6620 6f70 745f 6376  g data if opt_cv
+00014bf0: 3d30 2e31 2c20 666f 7220 6578 616d 706c  =0.1, for exampl
+00014c00: 652e 200a 2020 2020 2020 2020 4e65 6564  e. .        Need
+00014c10: 206d 6f72 6520 7465 7374 696e 6720 746f   more testing to
+00014c20: 206d 616b 6520 7468 6973 206d 6f72 6520   make this more 
+00014c30: 726f 6275 7374 2e0a 2020 2020 2020 2020  robust..        
+00014c40: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+00014c50: 2020 2064 6174 615f 7820 286e 6461 7272     data_x (ndarr
+00014c60: 6179 293a 2032 4420 6172 7261 7920 6f66  ay): 2D array of
+00014c70: 2073 697a 6520 286e 2078 206d 292c 2077   size (n x m), w
+00014c80: 6865 7265 206e 2069 7320 7468 650a 2020  here n is the.  
+00014c90: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+00014ca0: 206f 6620 7361 6d70 6c65 732c 2061 6e64   of samples, and
+00014cb0: 206d 2074 6865 206e 756d 6265 7220 6f66   m the number of
+00014cc0: 2066 6561 7475 7265 732e 0a20 2020 2020   features..     
+00014cd0: 2020 2064 6174 615f 7920 286e 6461 7272     data_y (ndarr
+00014ce0: 6179 2c20 7374 7229 3a20 3144 2061 7272  ay, str): 1D arr
+00014cf0: 6179 2063 6f6e 7461 696e 696e 6720 7468  ay containing th
+00014d00: 6520 636f 7272 6573 706f 6e69 6e67 206c  e corresponing l
+00014d10: 6162 656c 732e 200a 2020 2020 2020 2020  abels. .        
+00014d20: 6c69 6d69 745f 7365 6172 6368 2028 626f  limit_search (bo
+00014d30: 6f6c 293a 2049 6620 5472 7565 2c20 7468  ol): If True, th
+00014d40: 6520 7365 6172 6368 2073 7061 6365 2066  e search space f
+00014d50: 6f72 2074 6865 2070 6172 616d 6574 6572  or the parameter
+00014d60: 7320 7769 6c6c 2062 6520 6578 7061 6e64  s will be expand
+00014d70: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00014d80: 6173 2074 6865 7265 2061 7265 2073 6f6d  as there are som
+00014d90: 6520 6879 7065 7270 6172 616d 6574 6572  e hyperparameter
+00014da0: 7320 7468 6174 2063 616e 2072 616e 6765  s that can range
+00014db0: 2066 726f 6d20 3020 746f 2069 6e66 2e20   from 0 to inf. 
+00014dc0: 4465 6661 756c 7473 2074 6f20 4661 6c73  Defaults to Fals
+00014dd0: 652e 0a20 2020 2020 2020 206f 7074 5f63  e..        opt_c
+00014de0: 7620 2869 6e74 293a 2043 726f 7373 2d76  v (int): Cross-v
+00014df0: 616c 6964 6174 696f 6e73 2074 6f20 7065  alidations to pe
+00014e00: 7266 6f72 6d20 7768 656e 2061 7373 6573  rform when asses
+00014e10: 696e 6720 7468 6520 7065 7266 6f72 6d61  ing the performa
+00014e20: 6e63 6520 6174 2065 6163 680a 2020 2020  nce at each.    
+00014e30: 2020 2020 2020 2020 6879 7065 7270 6172          hyperpar
+00014e40: 616d 6574 6572 206f 7074 696d 697a 6174  ameter optimizat
+00014e50: 696f 6e20 7472 6961 6c2e 2046 6f72 2065  ion trial. For e
+00014e60: 7861 6d70 6c65 2c20 6966 2063 763d 332c  xample, if cv=3,
+00014e70: 2074 6865 6e20 6561 6368 206f 7074 696d   then each optim
+00014e80: 697a 6174 696f 6e20 7472 6961 6c0a 2020  ization trial.  
+00014e90: 2020 2020 2020 2020 2020 7769 6c6c 2062            will b
+00014ea0: 6520 6173 7365 7373 6564 2061 6363 6f72  e assessed accor
+00014eb0: 6469 6e67 2074 6f20 7468 6520 332d 666f  ding to the 3-fo
+00014ec0: 6c64 2063 726f 7373 2076 616c 6964 6174  ld cross validat
+00014ed0: 696f 6e20 6163 6375 7261 6379 2e20 4966  ion accuracy. If
+00014ee0: 2074 6869 7320 6973 0a20 2020 2020 2020   this is.       
+00014ef0: 2020 2020 2062 6574 7765 656e 2030 2061       between 0 a
+00014f00: 6e64 2031 2c20 7468 6973 2076 616c 7565  nd 1, this value
+00014f10: 2077 6f75 6c64 2062 6520 7573 6564 2061   would be used a
+00014f20: 7320 7468 6520 7261 7469 6f20 6f66 2074  s the ratio of t
+00014f30: 6865 2076 616c 6964 6174 696f 6e20 746f  he validation to
+00014f40: 2074 7261 696e 696e 6720 6461 7461 2e0a   training data..
+00014f50: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+00014f60: 756c 7473 2074 6f20 4e6f 6e65 2c20 696e  ults to None, in
+00014f70: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
+00014f80: 6372 6f73 732d 7661 6c69 6461 7469 6f6e  cross-validation
+00014f90: 2070 726f 6365 6475 7265 2077 696c 6c20   procedure will 
+00014fa0: 6265 2065 6d70 6c6f 7965 642e 0a20 2020  be employed..   
+00014fb0: 2020 2020 2065 7661 6c5f 6d65 7472 6963       eval_metric
+00014fc0: 2028 7374 7229 3a20 5468 6520 6576 616c   (str): The eval
+00014fd0: 7561 7469 6f6e 206d 6574 7269 6320 7768  uation metric wh
+00014fe0: 656e 2065 7661 6c75 6174 696e 6720 7468  en evaluating th
+00014ff0: 6520 7661 6c69 6461 7469 6f6e 2064 6174  e validation dat
+00015000: 612c 2075 7365 6420 7768 656e 0a20 2020  a, used when.   
+00015010: 2020 2020 2020 2020 206f 7074 5f63 7620           opt_cv 
+00015020: 6973 206c 6573 7320 7468 616e 2031 2e20  is less than 1. 
+00015030: 4465 6661 756c 7473 2074 6f20 2266 3122  Defaults to "f1"
+00015040: 2e20 466f 7220 616c 6c20 6f70 7469 6f6e  . For all option
+00015050: 7320 7365 6520 6576 616c 5f6d 6574 7269  s see eval_metri
+00015060: 6320 6672 6f6d 3a20 6874 7470 733a 2f2f  c from: https://
+00015070: 7867 626f 6f73 742e 7265 6164 7468 6564  xgboost.readthed
+00015080: 6f63 732e 696f 2f65 6e2f 6c61 7465 7374  ocs.io/en/latest
+00015090: 2f70 6172 616d 6574 6572 2e68 746d 6c23  /parameter.html#
+000150a0: 6d65 7472 6963 730a 0a20 2020 2052 6574  metrics..    Ret
+000150b0: 7572 6e73 3a0a 2020 2020 2020 2020 5468  urns:.        Th
+000150c0: 6520 6372 6f73 732d 7661 6c69 6461 7469  e cross-validati
+000150d0: 6f6e 2061 6363 7572 6163 7920 2869 6620  on accuracy (if 
+000150e0: 6f70 745f 6376 2069 7320 6772 6561 7465  opt_cv is greate
+000150f0: 7220 7468 616e 2031 2c20 3120 776f 756c  r than 1, 1 woul
+00015100: 6420 6265 2073 696e 676c 6520 696e 7374  d be single inst
+00015110: 616e 6365 2061 6363 7572 6163 7929 0a20  ance accuracy). 
+00015120: 2020 2020 2020 206f 722c 2069 6620 6f70         or, if op
+00015130: 745f 6376 2069 7320 6265 7477 6565 6e20  t_cv is between 
+00015140: 3020 616e 6420 312c 2074 6865 2076 616c  0 and 1, the val
+00015150: 6964 6174 696f 6e20 6163 6375 7261 6379  idation accuracy
+00015160: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
+00015170: 6520 636f 7272 6573 706f 6e64 696e 6720  e corresponding 
+00015180: 7465 7374 2073 697a 652e 0a20 2020 2022  test size..    "
+00015190: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+000151a0: 6974 5f5f 2873 656c 662c 2064 6174 615f  it__(self, data_
+000151b0: 782c 2064 6174 615f 792c 206c 696d 6974  x, data_y, limit
+000151c0: 5f73 6561 7263 683d 4661 6c73 652c 206f  _search=False, o
+000151d0: 7074 5f63 763d 332c 2065 7661 6c5f 6d65  pt_cv=3, eval_me
+000151e0: 7472 6963 3d22 6631 2229 3a0a 2020 2020  tric="f1"):.    
+000151f0: 2020 2020 7365 6c66 2e64 6174 615f 7820      self.data_x 
+00015200: 3d20 6461 7461 5f78 0a20 2020 2020 2020  = data_x.       
+00015210: 2073 656c 662e 6461 7461 5f79 203d 2064   self.data_y = d
+00015220: 6174 615f 790a 2020 2020 2020 2020 7365  ata_y.        se
+00015230: 6c66 2e6c 696d 6974 5f73 6561 7263 6820  lf.limit_search 
+00015240: 3d20 6c69 6d69 745f 7365 6172 6368 0a20  = limit_search. 
+00015250: 2020 2020 2020 2073 656c 662e 6f70 745f         self.opt_
+00015260: 6376 203d 206f 7074 5f63 7620 0a20 2020  cv = opt_cv .   
+00015270: 2020 2020 2073 656c 662e 6576 616c 5f6d       self.eval_m
+00015280: 6574 7269 6320 3d20 6576 616c 5f6d 6574  etric = eval_met
+00015290: 7269 6320 0a0a 2020 2020 6465 6620 5f5f  ric ..    def __
+000152a0: 6361 6c6c 5f5f 2873 656c 662c 2074 7269  call__(self, tri
+000152b0: 616c 293a 0a0a 2020 2020 2020 2020 7061  al):..        pa
+000152c0: 7261 6d73 203d 207b 226f 626a 6563 7469  rams = {"objecti
+000152d0: 7665 223a 2022 6269 6e61 7279 3a6c 6f67  ve": "binary:log
+000152e0: 6973 7469 6322 2c20 2265 7661 6c5f 6d65  istic", "eval_me
+000152f0: 7472 6963 223a 2073 656c 662e 6576 616c  tric": self.eval
+00015300: 5f6d 6574 7269 637d 200a 2020 2020 0a20  _metric} .    . 
+00015310: 2020 2020 2020 2069 6620 7365 6c66 2e6f         if self.o
+00015320: 7074 5f63 7620 3c20 313a 0a20 2020 2020  pt_cv < 1:.     
+00015330: 2020 2020 2020 2074 7261 696e 5f78 2c20         train_x, 
+00015340: 7661 6c69 645f 782c 2074 7261 696e 5f79  valid_x, train_y
+00015350: 2c20 7661 6c69 645f 7920 3d20 7472 6169  , valid_y = trai
+00015360: 6e5f 7465 7374 5f73 706c 6974 2873 656c  n_test_split(sel
+00015370: 662e 6461 7461 5f78 2c20 7365 6c66 2e64  f.data_x, self.d
+00015380: 6174 615f 792c 2074 6573 745f 7369 7a65  ata_y, test_size
+00015390: 3d73 656c 662e 6f70 745f 6376 2c20 7261  =self.opt_cv, ra
+000153a0: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
+000153b0: 236e 702e 7261 6e64 6f6d 2e72 616e 6469  #np.random.randi
+000153c0: 6e74 2831 2c20 3165 3929 290a 2020 2020  nt(1, 1e9)).    
+000153d0: 2020 2020 2020 2020 6474 7261 696e 2c20          dtrain, 
+000153e0: 6476 616c 6964 203d 2044 4d61 7472 6978  dvalid = DMatrix
+000153f0: 2874 7261 696e 5f78 2c20 6c61 6265 6c3d  (train_x, label=
+00015400: 7472 6169 6e5f 7929 2c20 444d 6174 7269  train_y), DMatri
+00015410: 7828 7661 6c69 645f 782c 206c 6162 656c  x(valid_x, label
+00015420: 3d76 616c 6964 5f79 290a 2020 2020 2020  =valid_y).      
+00015430: 2020 2020 2020 2370 7269 6e74 2827 496e        #print('In
+00015440: 6974 6961 6c69 7a69 6e67 2058 4742 6f6f  itializing XGBoo
+00015450: 7374 2050 7275 6e65 722e 2e2e 2729 0a20  st Pruner...'). 
+00015460: 2020 2020 2020 2020 2020 2070 7275 6e69             pruni
+00015470: 6e67 5f63 616c 6c62 6163 6b20 3d20 6f70  ng_callback = op
+00015480: 7475 6e61 2e69 6e74 6567 7261 7469 6f6e  tuna.integration
+00015490: 2e58 4742 6f6f 7374 5072 756e 696e 6743  .XGBoostPruningC
+000154a0: 616c 6c62 6163 6b28 7472 6961 6c2c 2022  allback(trial, "
+000154b0: 7661 6c69 6461 7469 6f6e 2d22 202b 2073  validation-" + s
+000154c0: 656c 662e 6576 616c 5f6d 6574 7269 6329  elf.eval_metric)
+000154d0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000154e0: 662e 6c69 6d69 745f 7365 6172 6368 3a0a  f.limit_search:.
+000154f0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00015500: 6d73 5b27 6e5f 6573 7469 6d61 746f 7273  ms['n_estimators
+00015510: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
+00015520: 7374 5f69 6e74 2827 6e5f 6573 7469 6d61  st_int('n_estima
+00015530: 746f 7273 272c 2031 3030 2c20 3235 3029  tors', 100, 250)
+00015540: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00015550: 616d 735b 2762 6f6f 7374 6572 275d 203d  ams['booster'] =
+00015560: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
+00015570: 6174 6567 6f72 6963 616c 2827 626f 6f73  ategorical('boos
+00015580: 7465 7227 2c20 5b27 6762 7472 6565 272c  ter', ['gbtree',
+00015590: 2027 6461 7274 275d 290a 2020 2020 2020   'dart']).      
+000155a0: 2020 2020 2020 7061 7261 6d73 5b27 7265        params['re
+000155b0: 675f 6c61 6d62 6461 275d 203d 2074 7269  g_lambda'] = tri
+000155c0: 616c 2e73 7567 6765 7374 5f6c 6f67 756e  al.suggest_logun
+000155d0: 6966 6f72 6d28 2772 6567 5f6c 616d 6264  iform('reg_lambd
+000155e0: 6127 2c20 3165 2d38 2c20 3129 0a20 2020  a', 1e-8, 1).   
+000155f0: 2020 2020 2020 2020 2070 6172 616d 735b           params[
+00015600: 2772 6567 5f61 6c70 6861 275d 203d 2074  'reg_alpha'] = t
+00015610: 7269 616c 2e73 7567 6765 7374 5f6c 6f67  rial.suggest_log
+00015620: 756e 6966 6f72 6d28 2772 6567 5f61 6c70  uniform('reg_alp
+00015630: 6861 272c 2031 652d 382c 2031 290a 2020  ha', 1e-8, 1).  
+00015640: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00015650: 5b27 6d61 785f 6465 7074 6827 5d20 3d20  ['max_depth'] = 
+00015660: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00015670: 7428 276d 6178 5f64 6570 7468 272c 2032  t('max_depth', 2
+00015680: 2c20 3235 290a 2020 2020 2020 2020 2020  , 25).          
+00015690: 2020 7061 7261 6d73 5b27 6574 6127 5d20    params['eta'] 
+000156a0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+000156b0: 6c6f 6775 6e69 666f 726d 2827 6574 6127  loguniform('eta'
+000156c0: 2c20 3165 2d38 2c20 3129 0a20 2020 2020  , 1e-8, 1).     
+000156d0: 2020 2020 2020 2070 6172 616d 735b 2767         params['g
+000156e0: 616d 6d61 275d 203d 2074 7269 616c 2e73  amma'] = trial.s
+000156f0: 7567 6765 7374 5f6c 6f67 756e 6966 6f72  uggest_logunifor
+00015700: 6d28 2767 616d 6d61 272c 2031 652d 382c  m('gamma', 1e-8,
+00015710: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
+00015720: 7061 7261 6d73 5b27 6772 6f77 5f70 6f6c  params['grow_pol
+00015730: 6963 7927 5d20 3d20 7472 6961 6c2e 7375  icy'] = trial.su
+00015740: 6767 6573 745f 6361 7465 676f 7269 6361  ggest_categorica
+00015750: 6c28 2767 726f 775f 706f 6c69 6379 272c  l('grow_policy',
+00015760: 205b 2764 6570 7468 7769 7365 272c 2027   ['depthwise', '
+00015770: 6c6f 7373 6775 6964 6527 5d29 0a0a 2020  lossguide'])..  
+00015780: 2020 2020 2020 2020 2020 6966 2070 6172            if par
+00015790: 616d 735b 2762 6f6f 7374 6572 275d 203d  ams['booster'] =
+000157a0: 3d20 2264 6172 7422 3a0a 2020 2020 2020  = "dart":.      
+000157b0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+000157c0: 5b27 7361 6d70 6c65 5f74 7970 6527 5d20  ['sample_type'] 
+000157d0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+000157e0: 6361 7465 676f 7269 6361 6c28 2773 616d  categorical('sam
+000157f0: 706c 655f 7479 7065 272c 205b 2775 6e69  ple_type', ['uni
+00015800: 666f 726d 272c 2027 7765 6967 6874 6564  form', 'weighted
+00015810: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00015820: 2020 2020 7061 7261 6d73 5b27 6e6f 726d      params['norm
+00015830: 616c 697a 655f 7479 7065 275d 203d 2074  alize_type'] = t
+00015840: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
+00015850: 6567 6f72 6963 616c 2827 6e6f 726d 616c  egorical('normal
+00015860: 697a 655f 7479 7065 272c 205b 2774 7265  ize_type', ['tre
+00015870: 6527 2c20 2766 6f72 6573 7427 5d29 0a20  e', 'forest']). 
+00015880: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00015890: 6172 616d 735b 2772 6174 655f 6472 6f70  arams['rate_drop
+000158a0: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
+000158b0: 7374 5f6c 6f67 756e 6966 6f72 6d28 2772  st_loguniform('r
+000158c0: 6174 655f 6472 6f70 272c 2031 652d 382c  ate_drop', 1e-8,
+000158d0: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
+000158e0: 2020 2020 7061 7261 6d73 5b27 736b 6970      params['skip
+000158f0: 5f64 726f 7027 5d20 3d20 7472 6961 6c2e  _drop'] = trial.
+00015900: 7375 6767 6573 745f 6c6f 6775 6e69 666f  suggest_logunifo
+00015910: 726d 2827 736b 6970 5f64 726f 7027 2c20  rm('skip_drop', 
+00015920: 3165 2d38 2c20 3129 0a20 2020 2020 2020  1e-8, 1).       
+00015930: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00015940: 2e6f 7074 5f63 7620 3e3d 2031 3a0a 2020  .opt_cv >= 1:.  
+00015950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015960: 2020 636c 6620 3d20 5847 4243 6c61 7373    clf = XGBClass
+00015970: 6966 6965 7228 626f 6f73 7465 723d 7061  ifier(booster=pa
+00015980: 7261 6d73 5b27 626f 6f73 7465 7227 5d2c  rams['booster'],
+00015990: 206e 5f65 7374 696d 6174 6f72 733d 7061   n_estimators=pa
+000159a0: 7261 6d73 5b27 6e5f 6573 7469 6d61 746f  rams['n_estimato
+000159b0: 7273 275d 2c20 7265 675f 6c61 6d62 6461  rs'], reg_lambda
+000159c0: 3d70 6172 616d 735b 2772 6567 5f6c 616d  =params['reg_lam
+000159d0: 6264 6127 5d2c 200a 2020 2020 2020 2020  bda'], .        
+000159e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159f0: 7265 675f 616c 7068 613d 7061 7261 6d73  reg_alpha=params
+00015a00: 5b27 7265 675f 616c 7068 6127 5d2c 206d  ['reg_alpha'], m
+00015a10: 6178 5f64 6570 7468 3d70 6172 616d 735b  ax_depth=params[
+00015a20: 276d 6178 5f64 6570 7468 275d 2c20 6574  'max_depth'], et
+00015a30: 613d 7061 7261 6d73 5b27 6574 6127 5d2c  a=params['eta'],
+00015a40: 2067 616d 6d61 3d70 6172 616d 735b 2767   gamma=params['g
+00015a50: 616d 6d61 275d 2c20 0a20 2020 2020 2020  amma'], .       
+00015a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a70: 2067 726f 775f 706f 6c69 6379 3d70 6172   grow_policy=par
+00015a80: 616d 735b 2767 726f 775f 706f 6c69 6379  ams['grow_policy
+00015a90: 275d 2c20 7361 6d70 6c65 5f74 7970 653d  '], sample_type=
+00015aa0: 7061 7261 6d73 5b27 7361 6d70 6c65 5f74  params['sample_t
+00015ab0: 7970 6527 5d2c 206e 6f72 6d61 6c69 7a65  ype'], normalize
+00015ac0: 5f74 7970 653d 7061 7261 6d73 5b27 6e6f  _type=params['no
+00015ad0: 726d 616c 697a 655f 7479 7065 275d 2c0a  rmalize_type'],.
+00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015af0: 2020 2020 2020 2020 7261 7465 5f64 726f          rate_dro
+00015b00: 703d 7061 7261 6d73 5b27 7261 7465 5f64  p=params['rate_d
+00015b10: 726f 7027 5d2c 2073 6b69 705f 6472 6f70  rop'], skip_drop
+00015b20: 3d70 6172 616d 735b 2773 6b69 705f 6472  =params['skip_dr
+00015b30: 6f70 275d 2c20 7261 6e64 6f6d 5f73 7461  op'], random_sta
+00015b40: 7465 3d31 3930 3929 232c 2074 7265 655f  te=1909)#, tree_
+00015b50: 6d65 7468 6f64 3d27 6869 7374 2729 0a20  method='hist'). 
+00015b60: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00015b70: 2020 2020 2020 2020 656c 6966 2070 6172          elif par
+00015b80: 616d 735b 2762 6f6f 7374 6572 275d 203d  ams['booster'] =
+00015b90: 3d20 2767 6274 7265 6527 3a0a 2020 2020  = 'gbtree':.    
+00015ba0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00015bb0: 6d73 5b27 7375 6273 616d 706c 6527 5d20  ms['subsample'] 
+00015bc0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00015bd0: 6c6f 6775 6e69 666f 726d 2827 7375 6273  loguniform('subs
+00015be0: 616d 706c 6527 2c20 3165 2d36 2c20 312e  ample', 1e-6, 1.
+00015bf0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+00015c00: 2020 2069 6620 7365 6c66 2e6f 7074 5f63     if self.opt_c
+00015c10: 7620 3e3d 2031 3a0a 2020 2020 2020 2020  v >= 1:.        
+00015c20: 2020 2020 2020 2020 2020 2020 636c 6620              clf 
+00015c30: 3d20 5847 4243 6c61 7373 6966 6965 7228  = XGBClassifier(
+00015c40: 626f 6f73 7465 723d 7061 7261 6d73 5b27  booster=params['
+00015c50: 626f 6f73 7465 7227 5d2c 206e 5f65 7374  booster'], n_est
+00015c60: 696d 6174 6f72 733d 7061 7261 6d73 5b27  imators=params['
+00015c70: 6e5f 6573 7469 6d61 746f 7273 275d 2c20  n_estimators'], 
+00015c80: 7265 675f 6c61 6d62 6461 3d70 6172 616d  reg_lambda=param
+00015c90: 735b 2772 6567 5f6c 616d 6264 6127 5d2c  s['reg_lambda'],
+00015ca0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00015cb0: 2020 2020 2020 2020 2020 7265 675f 616c            reg_al
+00015cc0: 7068 613d 7061 7261 6d73 5b27 7265 675f  pha=params['reg_
+00015cd0: 616c 7068 6127 5d2c 206d 6178 5f64 6570  alpha'], max_dep
+00015ce0: 7468 3d70 6172 616d 735b 276d 6178 5f64  th=params['max_d
+00015cf0: 6570 7468 275d 2c20 6574 613d 7061 7261  epth'], eta=para
+00015d00: 6d73 5b27 6574 6127 5d2c 2067 616d 6d61  ms['eta'], gamma
+00015d10: 3d70 6172 616d 735b 2767 616d 6d61 275d  =params['gamma']
+00015d20: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00015d30: 2020 2020 2020 2020 2020 2067 726f 775f             grow_
+00015d40: 706f 6c69 6379 3d70 6172 616d 735b 2767  policy=params['g
+00015d50: 726f 775f 706f 6c69 6379 275d 2c20 7375  row_policy'], su
+00015d60: 6273 616d 706c 653d 7061 7261 6d73 5b27  bsample=params['
+00015d70: 7375 6273 616d 706c 6527 5d2c 2072 616e  subsample'], ran
+00015d80: 646f 6d5f 7374 6174 653d 3139 3039 2923  dom_state=1909)#
+00015d90: 2c20 7472 6565 5f6d 6574 686f 643d 2768  , tree_method='h
+00015da0: 6973 7427 290a 0a20 2020 2020 2020 2020  ist')..         
+00015db0: 2020 2069 6620 7365 6c66 2e6f 7074 5f63     if self.opt_c
+00015dc0: 7620 3c20 313a 0a20 2020 2020 2020 2020  v < 1:.         
+00015dd0: 2020 2020 2020 2062 7374 203d 2074 7261         bst = tra
+00015de0: 696e 2870 6172 616d 732c 2064 7472 6169  in(params, dtrai
+00015df0: 6e2c 2065 7661 6c73 3d5b 2864 7661 6c69  n, evals=[(dvali
+00015e00: 642c 2022 7661 6c69 6461 7469 6f6e 2229  d, "validation")
+00015e10: 5d2c 2063 616c 6c62 6163 6b73 3d5b 7072  ], callbacks=[pr
+00015e20: 756e 696e 675f 6361 6c6c 6261 636b 5d29  uning_callback])
+00015e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015e40: 2070 7265 6473 203d 2062 7374 2e70 7265   preds = bst.pre
+00015e50: 6469 6374 2864 7661 6c69 6429 0a20 2020  dict(dvalid).   
+00015e60: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00015e70: 645f 6c61 6265 6c73 203d 206e 702e 7269  d_labels = np.ri
+00015e80: 6e74 2870 7265 6473 290a 2020 2020 2020  nt(preds).      
+00015e90: 2020 2020 2020 2020 2020 6163 6375 7261            accura
+00015ea0: 6379 203d 2061 6363 7572 6163 795f 7363  cy = accuracy_sc
+00015eb0: 6f72 6528 7661 6c69 645f 792c 2070 7265  ore(valid_y, pre
+00015ec0: 645f 6c61 6265 6c73 290a 2020 2020 2020  d_labels).      
+00015ed0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00015ee0: 2020 2020 2020 2020 2020 2020 2346 524f              #FRO
+00015ef0: 4d20 534b 4c45 4152 4e20 444f 4355 4d45  M SKLEARN DOCUME
+00015f00: 4e54 4154 494f 4e3a 2046 6f72 2069 6e74  NTATION: For int
+00015f10: 2f4e 6f6e 6520 696e 7075 7473 2c20 6966  /None inputs, if
+00015f20: 2074 6865 2065 7374 696d 6174 6f72 2069   the estimator i
+00015f30: 7320 6120 636c 6173 7369 6669 6572 2061  s a classifier a
+00015f40: 6e64 2079 2069 7320 6569 7468 6572 2062  nd y is either b
+00015f50: 696e 6172 7920 6f72 206d 756c 7469 636c  inary or multicl
+00015f60: 6173 732c 2053 7472 6174 6966 6965 644b  ass, StratifiedK
+00015f70: 466f 6c64 2069 7320 7573 6564 2e20 496e  Fold is used. In
+00015f80: 2061 6c6c 206f 7468 6572 2063 6173 6573   all other cases
+00015f90: 2c20 466f 6c64 2069 7320 7573 6564 2e0a  , Fold is used..
+00015fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015fb0: 6376 203d 2063 726f 7373 5f76 616c 6964  cv = cross_valid
+00015fc0: 6174 6528 636c 662c 2073 656c 662e 6461  ate(clf, self.da
+00015fd0: 7461 5f78 2c20 7365 6c66 2e64 6174 615f  ta_x, self.data_
+00015fe0: 792c 2063 763d 7365 6c66 2e6f 7074 5f63  y, cv=self.opt_c
+00015ff0: 7629 200a 2020 2020 2020 2020 2020 2020  v) .            
+00016000: 2020 2020 6163 6375 7261 6379 203d 206e      accuracy = n
+00016010: 702e 6d65 616e 2863 765b 2774 6573 745f  p.mean(cv['test_
+00016020: 7363 6f72 6527 5d29 0a0a 2020 2020 2020  score'])..      
+00016030: 2020 2020 2020 7265 7475 726e 2061 6363        return acc
+00016040: 7572 6163 790a 0a20 2020 2020 2020 2070  uracy..        p
+00016050: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
+00016060: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00016070: 5f63 6174 6567 6f72 6963 616c 2827 626f  _categorical('bo
+00016080: 6f73 7465 7227 2c20 5b27 6762 7472 6565  oster', ['gbtree
+00016090: 272c 2027 6461 7274 275d 290a 2020 2020  ', 'dart']).    
+000160a0: 2020 2020 7061 7261 6d73 5b27 6e5f 6573      params['n_es
+000160b0: 7469 6d61 746f 7273 275d 203d 2074 7269  timators'] = tri
+000160c0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+000160d0: 6e5f 6573 7469 6d61 746f 7273 272c 2031  n_estimators', 1
+000160e0: 3030 2c20 3530 3029 0a20 2020 2020 2020  00, 500).       
+000160f0: 2070 6172 616d 735b 2772 6567 5f6c 616d   params['reg_lam
+00016100: 6264 6127 5d20 3d20 7472 6961 6c2e 7375  bda'] = trial.su
+00016110: 6767 6573 745f 666c 6f61 7428 2772 6567  ggest_float('reg
+00016120: 5f6c 616d 6264 6127 2c20 302c 2031 3030  _lambda', 0, 100
+00016130: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
+00016140: 5b27 7265 675f 616c 7068 6127 5d20 3d20  ['reg_alpha'] = 
+00016150: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00016160: 7428 2772 6567 5f61 6c70 6861 272c 2030  t('reg_alpha', 0
+00016170: 2c20 3130 3029 0a20 2020 2020 2020 2070  , 100).        p
+00016180: 6172 616d 735b 276d 6178 5f64 6570 7468  arams['max_depth
+00016190: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
+000161a0: 7374 5f69 6e74 2827 6d61 785f 6465 7074  st_int('max_dept
+000161b0: 6827 2c20 322c 2032 3529 0a20 2020 2020  h', 2, 25).     
+000161c0: 2020 2070 6172 616d 735b 2765 7461 275d     params['eta']
+000161d0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+000161e0: 5f66 6c6f 6174 2827 6574 6127 2c20 3165  _float('eta', 1e
+000161f0: 2d38 2c20 3129 0a20 2020 2020 2020 2070  -8, 1).        p
+00016200: 6172 616d 735b 2767 616d 6d61 275d 203d  arams['gamma'] =
+00016210: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00016220: 6e74 2827 6761 6d6d 6127 2c20 312c 2031  nt('gamma', 1, 1
+00016230: 3030 290a 2020 2020 2020 2020 7061 7261  00).        para
+00016240: 6d73 5b27 6772 6f77 5f70 6f6c 6963 7927  ms['grow_policy'
+00016250: 5d20 3d20 7472 6961 6c2e 7375 6767 6573  ] = trial.sugges
+00016260: 745f 6361 7465 676f 7269 6361 6c28 2767  t_categorical('g
+00016270: 726f 775f 706f 6c69 6379 272c 205b 2764  row_policy', ['d
+00016280: 6570 7468 7769 7365 272c 2027 6c6f 7373  epthwise', 'loss
+00016290: 6775 6964 6527 5d29 0a20 2020 2020 2020  guide']).       
+000162a0: 2070 6172 616d 735b 276d 696e 5f63 6869   params['min_chi
+000162b0: 6c64 5f77 6569 6768 7427 5d20 3d20 7472  ld_weight'] = tr
+000162c0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+000162d0: 276d 696e 5f63 6869 6c64 5f77 6569 6768  'min_child_weigh
+000162e0: 7427 2c20 312c 2031 3030 290a 2020 2020  t', 1, 100).    
+000162f0: 2020 2020 7061 7261 6d73 5b27 6d61 785f      params['max_
+00016300: 6465 6c74 615f 7374 6570 275d 203d 2074  delta_step'] = t
+00016310: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+00016320: 2827 6d61 785f 6465 6c74 615f 7374 6570  ('max_delta_step
+00016330: 272c 2031 2c20 3130 3029 0a20 2020 2020  ', 1, 100).     
+00016340: 2020 2070 6172 616d 735b 2773 7562 7361     params['subsa
+00016350: 6d70 6c65 275d 203d 2074 7269 616c 2e73  mple'] = trial.s
+00016360: 7567 6765 7374 5f66 6c6f 6174 2827 7375  uggest_float('su
+00016370: 6273 616d 706c 6527 2c20 302e 352c 2031  bsample', 0.5, 1
+00016380: 2e30 290a 2020 2020 2020 2020 7061 7261  .0).        para
+00016390: 6d73 5b27 636f 6c73 616d 706c 655f 6279  ms['colsample_by
+000163a0: 7472 6565 275d 203d 2074 7269 616c 2e73  tree'] = trial.s
+000163b0: 7567 6765 7374 5f66 6c6f 6174 2827 636f  uggest_float('co
+000163c0: 6c73 616d 706c 655f 6279 7472 6565 272c  lsample_bytree',
+000163d0: 2030 2e35 2c20 3129 0a0a 2020 2020 2020   0.5, 1)..      
+000163e0: 2020 6966 2070 6172 616d 735b 2762 6f6f    if params['boo
+000163f0: 7374 6572 275d 203d 3d20 2264 6172 7422  ster'] == "dart"
+00016400: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00016410: 7261 6d73 5b27 7361 6d70 6c65 5f74 7970  rams['sample_typ
+00016420: 6527 5d20 3d20 7472 6961 6c2e 7375 6767  e'] = trial.sugg
+00016430: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
+00016440: 2773 616d 706c 655f 7479 7065 272c 205b  'sample_type', [
+00016450: 2775 6e69 666f 726d 272c 2027 7765 6967  'uniform', 'weig
+00016460: 6874 6564 275d 290a 2020 2020 2020 2020  hted']).        
+00016470: 2020 2020 7061 7261 6d73 5b27 6e6f 726d      params['norm
+00016480: 616c 697a 655f 7479 7065 275d 203d 2074  alize_type'] = t
+00016490: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
+000164a0: 6567 6f72 6963 616c 2827 6e6f 726d 616c  egorical('normal
+000164b0: 697a 655f 7479 7065 272c 205b 2774 7265  ize_type', ['tre
+000164c0: 6527 2c20 2766 6f72 6573 7427 5d29 0a20  e', 'forest']). 
+000164d0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+000164e0: 735b 2772 6174 655f 6472 6f70 275d 203d  s['rate_drop'] =
+000164f0: 2074 7269 616c 2e73 7567 6765 7374 5f66   trial.suggest_f
+00016500: 6c6f 6174 2827 7261 7465 5f64 726f 7027  loat('rate_drop'
+00016510: 2c20 3165 2d38 2c20 3129 0a20 2020 2020  , 1e-8, 1).     
+00016520: 2020 2020 2020 2070 6172 616d 735b 2773         params['s
+00016530: 6b69 705f 6472 6f70 275d 203d 2074 7269  kip_drop'] = tri
+00016540: 616c 2e73 7567 6765 7374 5f66 6c6f 6174  al.suggest_float
+00016550: 2827 736b 6970 5f64 726f 7027 2c20 3165  ('skip_drop', 1e
+00016560: 2d38 2c20 3129 0a20 2020 2020 2020 2020  -8, 1).         
+00016570: 2020 2069 6620 7365 6c66 2e6f 7074 5f63     if self.opt_c
+00016580: 7620 3e3d 2031 3a0a 2020 2020 2020 2020  v >= 1:.        
+00016590: 2020 2020 2020 2020 636c 6620 3d20 5847          clf = XG
+000165a0: 4243 6c61 7373 6966 6965 7228 626f 6f73  BClassifier(boos
+000165b0: 7465 723d 7061 7261 6d73 5b27 626f 6f73  ter=params['boos
+000165c0: 7465 7227 5d2c 206e 5f65 7374 696d 6174  ter'], n_estimat
+000165d0: 6f72 733d 7061 7261 6d73 5b27 6e5f 6573  ors=params['n_es
+000165e0: 7469 6d61 746f 7273 275d 2c20 636f 6c73  timators'], cols
+000165f0: 616d 706c 655f 6279 7472 6565 3d70 6172  ample_bytree=par
+00016600: 616d 735b 2763 6f6c 7361 6d70 6c65 5f62  ams['colsample_b
+00016610: 7974 7265 6527 5d2c 200a 2020 2020 2020  ytree'], .      
+00016620: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016630: 675f 6c61 6d62 6461 3d70 6172 616d 735b  g_lambda=params[
+00016640: 2772 6567 5f6c 616d 6264 6127 5d2c 2072  'reg_lambda'], r
+00016650: 6567 5f61 6c70 6861 3d70 6172 616d 735b  eg_alpha=params[
+00016660: 2772 6567 5f61 6c70 6861 275d 2c20 6d61  'reg_alpha'], ma
+00016670: 785f 6465 7074 683d 7061 7261 6d73 5b27  x_depth=params['
+00016680: 6d61 785f 6465 7074 6827 5d2c 2065 7461  max_depth'], eta
+00016690: 3d70 6172 616d 735b 2765 7461 275d 2c20  =params['eta'], 
+000166a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000166b0: 2020 2020 2067 616d 6d61 3d70 6172 616d       gamma=param
+000166c0: 735b 2767 616d 6d61 275d 2c20 6772 6f77  s['gamma'], grow
+000166d0: 5f70 6f6c 6963 793d 7061 7261 6d73 5b27  _policy=params['
+000166e0: 6772 6f77 5f70 6f6c 6963 7927 5d2c 206d  grow_policy'], m
+000166f0: 696e 5f63 6869 6c64 5f77 6569 6768 743d  in_child_weight=
+00016700: 7061 7261 6d73 5b27 6d69 6e5f 6368 696c  params['min_chil
+00016710: 645f 7765 6967 6874 275d 2c20 0a20 2020  d_weight'], .   
+00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016730: 206d 6178 5f64 656c 7461 5f73 7465 703d   max_delta_step=
+00016740: 7061 7261 6d73 5b27 6d61 785f 6465 6c74  params['max_delt
+00016750: 615f 7374 6570 275d 2c20 7375 6273 616d  a_step'], subsam
+00016760: 706c 653d 7061 7261 6d73 5b27 7375 6273  ple=params['subs
+00016770: 616d 706c 6527 5d2c 2073 616d 706c 655f  ample'], sample_
+00016780: 7479 7065 3d70 6172 616d 735b 2773 616d  type=params['sam
+00016790: 706c 655f 7479 7065 275d 2c20 0a20 2020  ple_type'], .   
+000167a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167b0: 206e 6f72 6d61 6c69 7a65 5f74 7970 653d   normalize_type=
+000167c0: 7061 7261 6d73 5b27 6e6f 726d 616c 697a  params['normaliz
+000167d0: 655f 7479 7065 275d 2c20 7261 7465 5f64  e_type'], rate_d
+000167e0: 726f 703d 7061 7261 6d73 5b27 7261 7465  rop=params['rate
+000167f0: 5f64 726f 7027 5d2c 2073 6b69 705f 6472  _drop'], skip_dr
+00016800: 6f70 3d70 6172 616d 735b 2773 6b69 705f  op=params['skip_
+00016810: 6472 6f70 275d 2c20 7261 6e64 6f6d 5f73  drop'], random_s
+00016820: 7461 7465 3d31 3930 3929 232c 2074 7265  tate=1909)#, tre
+00016830: 655f 6d65 7468 6f64 3d27 6869 7374 2729  e_method='hist')
+00016840: 0a20 2020 2020 2020 2065 6c69 6620 7061  .        elif pa
+00016850: 7261 6d73 5b27 626f 6f73 7465 7227 5d20  rams['booster'] 
+00016860: 3d3d 2027 6762 7472 6565 273a 0a20 2020  == 'gbtree':.   
+00016870: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00016880: 2e6f 7074 5f63 7620 3e3d 2031 3a0a 2020  .opt_cv >= 1:.  
+00016890: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+000168a0: 6620 3d20 5847 4243 6c61 7373 6966 6965  f = XGBClassifie
+000168b0: 7228 626f 6f73 7465 723d 7061 7261 6d73  r(booster=params
+000168c0: 5b27 626f 6f73 7465 7227 5d2c 206e 5f65  ['booster'], n_e
+000168d0: 7374 696d 6174 6f72 733d 7061 7261 6d73  stimators=params
+000168e0: 5b27 6e5f 6573 7469 6d61 746f 7273 275d  ['n_estimators']
+000168f0: 2c20 636f 6c73 616d 706c 655f 6279 7472  , colsample_bytr
+00016900: 6565 3d70 6172 616d 735b 2763 6f6c 7361  ee=params['colsa
+00016910: 6d70 6c65 5f62 7974 7265 6527 5d2c 2020  mple_bytree'],  
+00016920: 7265 675f 6c61 6d62 6461 3d70 6172 616d  reg_lambda=param
+00016930: 735b 2772 6567 5f6c 616d 6264 6127 5d2c  s['reg_lambda'],
+00016940: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00016950: 2020 2020 2020 7265 675f 616c 7068 613d        reg_alpha=
+00016960: 7061 7261 6d73 5b27 7265 675f 616c 7068  params['reg_alph
+00016970: 6127 5d2c 206d 6178 5f64 6570 7468 3d70  a'], max_depth=p
+00016980: 6172 616d 735b 276d 6178 5f64 6570 7468  arams['max_depth
+00016990: 275d 2c20 6574 613d 7061 7261 6d73 5b27  '], eta=params['
+000169a0: 6574 6127 5d2c 2067 616d 6d61 3d70 6172  eta'], gamma=par
+000169b0: 616d 735b 2767 616d 6d61 275d 2c20 6772  ams['gamma'], gr
+000169c0: 6f77 5f70 6f6c 6963 793d 7061 7261 6d73  ow_policy=params
+000169d0: 5b27 6772 6f77 5f70 6f6c 6963 7927 5d2c  ['grow_policy'],
+000169e0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+000169f0: 2020 2020 2020 6d69 6e5f 6368 696c 645f        min_child_
+00016a00: 7765 6967 6874 3d70 6172 616d 735b 276d  weight=params['m
+00016a10: 696e 5f63 6869 6c64 5f77 6569 6768 7427  in_child_weight'
+00016a20: 5d2c 206d 6178 5f64 656c 7461 5f73 7465  ], max_delta_ste
+00016a30: 703d 7061 7261 6d73 5b27 6d61 785f 6465  p=params['max_de
+00016a40: 6c74 615f 7374 6570 275d 2c20 7375 6273  lta_step'], subs
+00016a50: 616d 706c 653d 7061 7261 6d73 5b27 7375  ample=params['su
+00016a60: 6273 616d 706c 6527 5d2c 2072 616e 646f  bsample'], rando
+00016a70: 6d5f 7374 6174 653d 3139 3039 2923 2c20  m_state=1909)#, 
+00016a80: 7472 6565 5f6d 6574 686f 643d 2768 6973  tree_method='his
+00016a90: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00016aa0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00016ab0: 2e6f 7074 5f63 7620 3c20 313a 0a20 2020  .opt_cv < 1:.   
+00016ac0: 2020 2020 2020 2020 2062 7374 203d 2074           bst = t
+00016ad0: 7261 696e 2870 6172 616d 732c 2064 7472  rain(params, dtr
+00016ae0: 6169 6e2c 2065 7661 6c73 3d5b 2864 7661  ain, evals=[(dva
+00016af0: 6c69 642c 2022 7661 6c69 6461 7469 6f6e  lid, "validation
+00016b00: 2229 5d2c 2063 616c 6c62 6163 6b73 3d5b  ")], callbacks=[
+00016b10: 7072 756e 696e 675f 6361 6c6c 6261 636b  pruning_callback
+00016b20: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
+00016b30: 7265 6473 203d 2062 7374 2e70 7265 6469  reds = bst.predi
+00016b40: 6374 2864 7661 6c69 6429 0a20 2020 2020  ct(dvalid).     
+00016b50: 2020 2020 2020 2070 7265 645f 6c61 6265         pred_labe
+00016b60: 6c73 203d 206e 702e 7269 6e74 2870 7265  ls = np.rint(pre
+00016b70: 6473 290a 2020 2020 2020 2020 2020 2020  ds).            
+00016b80: 6163 6375 7261 6379 203d 2061 6363 7572  accuracy = accur
+00016b90: 6163 795f 7363 6f72 6528 7661 6c69 645f  acy_score(valid_
+00016ba0: 792c 2070 7265 645f 6c61 6265 6c73 290a  y, pred_labels).
+00016bb0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00016bc0: 2020 2020 2020 2020 2020 6376 203d 2063            cv = c
+00016bd0: 726f 7373 5f76 616c 6964 6174 6528 636c  ross_validate(cl
+00016be0: 662c 2073 656c 662e 6461 7461 5f78 2c20  f, self.data_x, 
+00016bf0: 7365 6c66 2e64 6174 615f 792c 2063 763d  self.data_y, cv=
+00016c00: 7365 6c66 2e6f 7074 5f63 7629 0a20 2020  self.opt_cv).   
+00016c10: 2020 2020 2020 2020 2061 6363 7572 6163           accurac
+00016c20: 7920 3d20 6e70 2e6d 6561 6e28 6376 5b27  y = np.mean(cv['
+00016c30: 7465 7374 5f73 636f 7265 275d 290a 2020  test_score']).  
+00016c40: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
+00016c50: 6574 7572 6e20 6163 6375 7261 6379 0a0a  eturn accuracy..
+00016c60: 636c 6173 7320 6f62 6a65 6374 6976 655f  class objective_
+00016c70: 6e6e 286f 626a 6563 7429 3a0a 2020 2020  nn(object):.    
+00016c80: 2222 220a 2020 2020 4f70 7469 6d69 7a61  """.    Optimiza
+00016c90: 7469 6f6e 206f 626a 6563 7469 7665 2066  tion objective f
+00016ca0: 756e 6374 696f 6e20 666f 7220 7468 6520  unction for the 
+00016cb0: 7363 696b 6974 2d6c 6561 726e 2069 6d70  scikit-learn imp
+00016cc0: 6c65 6d65 6e74 6174 696e 206f 6620 7468  lementatin of th
+00016cd0: 650a 2020 2020 4d4c 5020 636c 6173 7369  e.    MLP classi
+00016ce0: 6669 6572 2e20 5468 6520 4f70 7475 6e61  fier. The Optuna
+00016cf0: 2073 6f66 7477 6172 6520 666f 7220 6879   software for hy
+00016d00: 7065 7270 6172 616d 6574 6572 206f 7074  perparameter opt
+00016d10: 696d 697a 6174 696f 6e0a 2020 2020 7761  imization.    wa
+00016d20: 7320 7075 626c 6973 6865 6420 696e 2032  s published in 2
+00016d30: 3031 3920 6279 2041 6b69 6261 2065 7420  019 by Akiba et 
+00016d40: 616c 2e20 5061 7065 723a 2068 7474 7073  al. Paper: https
+00016d50: 3a2f 2f61 7278 6976 2e6f 7267 2f61 6273  ://arxiv.org/abs
+00016d60: 2f31 3930 372e 3130 3930 322e 0a0a 2020  /1907.10902...  
+00016d70: 2020 5468 6520 746f 7461 6c20 6e75 6d62    The total numb
+00016d80: 6572 206f 6620 6869 6464 656e 206c 6179  er of hidden lay
+00016d90: 6572 7320 746f 2074 6573 7420 6973 206c  ers to test is l
+00016da0: 696d 6974 6564 2074 6f20 3130 2c20 7769  imited to 10, wi
+00016db0: 7468 2031 3030 2d35 3030 3020 706f 7373  th 100-5000 poss
+00016dc0: 6962 6c65 200a 2020 2020 6e75 6d62 6572  ible .    number
+00016dd0: 206f 6620 6e65 7572 6f6e 7320 696e 2065   of neurons in e
+00016de0: 6163 682e 0a0a 2020 2020 4172 6773 3a0a  ach...    Args:.
+00016df0: 2020 2020 2020 2020 6461 7461 5f78 2028          data_x (
+00016e00: 6e64 6172 7261 7929 3a20 3244 2061 7272  ndarray): 2D arr
+00016e10: 6179 206f 6620 7369 7a65 2028 6e20 7820  ay of size (n x 
+00016e20: 6d29 2c20 7768 6572 6520 6e20 6973 2074  m), where n is t
+00016e30: 6865 0a20 2020 2020 2020 2020 2020 206e  he.            n
+00016e40: 756d 6265 7220 6f66 2073 616d 706c 6573  umber of samples
+00016e50: 2c20 616e 6420 6d20 7468 6520 6e75 6d62  , and m the numb
+00016e60: 6572 206f 6620 6665 6174 7572 6573 2e0a  er of features..
+00016e70: 2020 2020 2020 2020 6461 7461 5f79 2028          data_y (
+00016e80: 6e64 6172 7261 792c 2073 7472 293a 2031  ndarray, str): 1
+00016e90: 4420 6172 7261 7920 636f 6e74 6169 6e69  D array containi
+00016ea0: 6e67 2074 6865 2063 6f72 7265 7370 6f6e  ng the correspon
+00016eb0: 696e 6720 6c61 6265 6c73 2e20 0a20 2020  ing labels. .   
+00016ec0: 2020 2020 206f 7074 5f63 7620 2869 6e74       opt_cv (int
+00016ed0: 293a 2043 726f 7373 2d76 616c 6964 6174  ): Cross-validat
+00016ee0: 696f 6e73 2074 6f20 7065 7266 6f72 6d20  ions to perform 
+00016ef0: 7768 656e 2061 7373 6573 696e 6720 7468  when assesing th
+00016f00: 6520 7065 7266 6f72 6d61 6e63 6520 6174  e performance at
+00016f10: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
+00016f20: 2020 6879 7065 7270 6172 616d 6574 6572    hyperparameter
+00016f30: 206f 7074 696d 697a 6174 696f 6e20 7472   optimization tr
+00016f40: 6961 6c2e 2046 6f72 2065 7861 6d70 6c65  ial. For example
+00016f50: 2c20 6966 2063 763d 332c 2074 6865 6e20  , if cv=3, then 
+00016f60: 6561 6368 206f 7074 696d 697a 6174 696f  each optimizatio
+00016f70: 6e20 7472 6961 6c0a 2020 2020 2020 2020  n trial.        
+00016f80: 2020 2020 7769 6c6c 2062 6520 6173 7365      will be asse
+00016f90: 7373 6564 2061 6363 6f72 6469 6e67 2074  ssed according t
+00016fa0: 6f20 7468 6520 332d 666f 6c64 2063 726f  o the 3-fold cro
+00016fb0: 7373 2076 616c 6964 6174 696f 6e20 6163  ss validation ac
+00016fc0: 6375 7261 6379 2e20 0a0a 2020 2020 5265  curacy. ..    Re
+00016fd0: 7475 726e 733a 0a20 2020 2020 2020 2054  turns:.        T
+00016fe0: 6865 2070 6572 666f 726d 616e 6365 206d  he performance m
+00016ff0: 6574 7269 632c 2064 6574 6572 6d69 6e65  etric, determine
+00017000: 6420 7573 696e 6720 7468 6520 6372 6f73  d using the cros
+00017010: 732d 666f 6c64 2076 616c 6964 6174 696f  s-fold validatio
+00017020: 6e20 6d65 7468 6f64 2e0a 2020 2020 2222  n method..    ""
+00017030: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00017040: 745f 5f28 7365 6c66 2c20 6461 7461 5f78  t__(self, data_x
+00017050: 2c20 6461 7461 5f79 2c20 6f70 745f 6376  , data_y, opt_cv
+00017060: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00017070: 6461 7461 5f78 203d 2064 6174 615f 780a  data_x = data_x.
+00017080: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00017090: 615f 7920 3d20 6461 7461 5f79 0a20 2020  a_y = data_y.   
+000170a0: 2020 2020 2073 656c 662e 6f70 745f 6376       self.opt_cv
+000170b0: 203d 206f 7074 5f63 760a 0a20 2020 2064   = opt_cv..    d
+000170c0: 6566 205f 5f63 616c 6c5f 5f28 7365 6c66  ef __call__(self
+000170d0: 2c20 7472 6961 6c29 3a0a 2020 2020 2020  , trial):.      
+000170e0: 2020 6c65 6172 6e69 6e67 5f72 6174 655f    learning_rate_
+000170f0: 696e 6974 203d 2074 7269 616c 2e73 7567  init = trial.sug
+00017100: 6765 7374 5f66 6c6f 6174 2827 6c65 6172  gest_float('lear
+00017110: 6e69 6e67 5f72 6174 655f 696e 6974 272c  ning_rate_init',
+00017120: 2031 652d 352c 2030 2e31 2c20 7374 6570   1e-5, 0.1, step
+00017130: 3d31 652d 3529 0a20 2020 2020 2020 2073  =1e-5).        s
+00017140: 6f6c 7665 7220 3d20 7472 6961 6c2e 7375  olver = trial.su
+00017150: 6767 6573 745f 6361 7465 676f 7269 6361  ggest_categorica
+00017160: 6c28 2273 6f6c 7665 7222 2c20 5b22 7367  l("solver", ["sg
+00017170: 6422 2c20 2261 6461 6d22 5d29 2023 226c  d", "adam"]) #"l
+00017180: 6266 6773 220a 2020 2020 2020 2020 6163  bfgs".        ac
+00017190: 7469 7661 7469 6f6e 203d 2074 7269 616c  tivation = trial
+000171a0: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+000171b0: 6963 616c 2822 6163 7469 7661 7469 6f6e  ical("activation
+000171c0: 222c 205b 226c 6f67 6973 7469 6322 2c20  ", ["logistic", 
+000171d0: 2274 616e 6822 2c20 2272 656c 7522 5d29  "tanh", "relu"])
+000171e0: 0a20 2020 2020 2020 206c 6561 726e 696e  .        learnin
+000171f0: 675f 7261 7465 203d 2074 7269 616c 2e73  g_rate = trial.s
+00017200: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
+00017210: 616c 2822 6c65 6172 6e69 6e67 5f72 6174  al("learning_rat
+00017220: 6522 2c20 5b22 636f 6e73 7461 6e74 222c  e", ["constant",
+00017230: 2022 696e 7673 6361 6c69 6e67 222c 2022   "invscaling", "
+00017240: 6164 6170 7469 7665 225d 290a 2020 2020  adaptive"]).    
+00017250: 2020 2020 616c 7068 6120 3d20 7472 6961      alpha = tria
+00017260: 6c2e 7375 6767 6573 745f 666c 6f61 7428  l.suggest_float(
+00017270: 2261 6c70 6861 222c 2031 652d 372c 2031  "alpha", 1e-7, 1
+00017280: 2c20 7374 6570 3d31 652d 3629 0a20 2020  , step=1e-6).   
+00017290: 2020 2020 2062 6174 6368 5f73 697a 6520       batch_size 
+000172a0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+000172b0: 696e 7428 2762 6174 6368 5f73 697a 6527  int('batch_size'
+000172c0: 2c20 312c 2031 3030 3029 0a20 2020 2020  , 1, 1000).     
+000172d0: 2020 206e 5f6c 6179 6572 7320 3d20 7472     n_layers = tr
+000172e0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+000172f0: 2768 6964 6465 6e5f 6c61 7965 725f 7369  'hidden_layer_si
+00017300: 7a65 7327 2c20 312c 2031 3029 0a0a 2020  zes', 1, 10)..  
+00017310: 2020 2020 2020 6c61 7965 7273 203d 205b        layers = [
+00017320: 5d0a 2020 2020 2020 2020 666f 7220 6920  ].        for i 
+00017330: 696e 2072 616e 6765 286e 5f6c 6179 6572  in range(n_layer
+00017340: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00017350: 6c61 7965 7273 2e61 7070 656e 6428 7472  layers.append(tr
+00017360: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00017370: 6627 6e5f 756e 6974 735f 7b69 7d27 2c20  f'n_units_{i}', 
+00017380: 3130 302c 2035 3030 3029 290a 0a20 2020  100, 5000))..   
+00017390: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000173a0: 2020 2020 2020 636c 6620 3d20 4d4c 5043        clf = MLPC
+000173b0: 6c61 7373 6966 6965 7228 6869 6464 656e  lassifier(hidden
+000173c0: 5f6c 6179 6572 5f73 697a 6573 3d74 7570  _layer_sizes=tup
+000173d0: 6c65 286c 6179 6572 7329 2c6c 6561 726e  le(layers),learn
+000173e0: 696e 675f 7261 7465 5f69 6e69 743d 6c65  ing_rate_init=le
+000173f0: 6172 6e69 6e67 5f72 6174 655f 696e 6974  arning_rate_init
+00017400: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00017410: 2020 2073 6f6c 7665 723d 736f 6c76 6572     solver=solver
+00017420: 2c20 6163 7469 7661 7469 6f6e 3d61 6374  , activation=act
+00017430: 6976 6174 696f 6e2c 2061 6c70 6861 3d61  ivation, alpha=a
+00017440: 6c70 6861 2c20 6261 7463 685f 7369 7a65  lpha, batch_size
+00017450: 3d62 6174 6368 5f73 697a 652c 206d 6178  =batch_size, max
+00017460: 5f69 7465 723d 3235 3030 2c20 7261 6e64  _iter=2500, rand
+00017470: 6f6d 5f73 7461 7465 3d31 3930 3929 0a20  om_state=1909). 
+00017480: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+00017490: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000174a0: 2822 496e 7661 6c69 6420 6879 7065 7270  ("Invalid hyperp
+000174b0: 6172 616d 6574 6572 2063 6f6d 6269 6e61  arameter combina
+000174c0: 7469 6f6e 2c20 736b 6970 7069 6e67 2074  tion, skipping t
+000174d0: 7269 616c 2229 0a20 2020 2020 2020 2020  rial").         
+000174e0: 2020 2072 6574 7572 6e20 302e 300a 0a20     return 0.0.. 
+000174f0: 2020 2020 2020 2063 7620 3d20 6372 6f73         cv = cros
+00017500: 735f 7661 6c69 6461 7465 2863 6c66 2c20  s_validate(clf, 
+00017510: 7365 6c66 2e64 6174 615f 782c 2073 656c  self.data_x, sel
+00017520: 662e 6461 7461 5f79 2c20 6376 3d73 656c  f.data_y, cv=sel
+00017530: 662e 6f70 745f 6376 290a 2020 2020 2020  f.opt_cv).      
+00017540: 2020 6669 6e61 6c5f 7363 6f72 6520 3d20    final_score = 
+00017550: 6e70 2e6d 6561 6e28 6376 5b27 7465 7374  np.mean(cv['test
+00017560: 5f73 636f 7265 275d 290a 0a20 2020 2020  _score'])..     
+00017570: 2020 2072 6574 7572 6e20 6669 6e61 6c5f     return final_
+00017580: 7363 6f72 650a 0a63 6c61 7373 206f 626a  score..class obj
+00017590: 6563 7469 7665 5f72 6628 6f62 6a65 6374  ective_rf(object
+000175a0: 293a 0a20 2020 2022 2222 0a20 2020 204f  ):.    """.    O
+000175b0: 7074 696d 697a 6174 696f 6e20 6f62 6a65  ptimization obje
+000175c0: 6374 6976 6520 6675 6e63 7469 6f6e 2066  ctive function f
+000175d0: 6f72 2074 6865 2073 6369 6b69 742d 6c65  or the scikit-le
+000175e0: 6172 6e20 696d 706c 656d 656e 7461 7469  arn implementati
+000175f0: 6e20 6f66 2074 6865 0a20 2020 2052 616e  n of the.    Ran
+00017600: 646f 6d20 466f 7265 7374 2063 6c61 7373  dom Forest class
+00017610: 6966 6965 722e 2054 6865 204f 7074 756e  ifier. The Optun
+00017620: 6120 736f 6674 7761 7265 2066 6f72 2068  a software for h
+00017630: 7970 6572 7061 7261 6d65 7465 7220 6f70  yperparameter op
+00017640: 7469 6d69 7a61 7469 6f6e 0a20 2020 2077  timization.    w
+00017650: 6173 2070 7562 6c69 7368 6564 2069 6e20  as published in 
+00017660: 3230 3139 2062 7920 416b 6962 6120 6574  2019 by Akiba et
+00017670: 2061 6c2e 2050 6170 6572 3a20 6874 7470   al. Paper: http
+00017680: 733a 2f2f 6172 7869 762e 6f72 672f 6162  s://arxiv.org/ab
+00017690: 732f 3139 3037 2e31 3039 3032 0a0a 2020  s/1907.10902..  
+000176a0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+000176b0: 6461 7461 5f78 2028 6e64 6172 7261 7929  data_x (ndarray)
+000176c0: 3a20 3244 2061 7272 6179 206f 6620 7369  : 2D array of si
+000176d0: 7a65 2028 6e20 7820 6d29 2c20 7768 6572  ze (n x m), wher
+000176e0: 6520 6e20 6973 2074 6865 0a20 2020 2020  e n is the.     
+000176f0: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
+00017700: 2073 616d 706c 6573 2c20 616e 6420 6d20   samples, and m 
+00017710: 7468 6520 6e75 6d62 6572 206f 6620 6665  the number of fe
+00017720: 6174 7572 6573 2e0a 2020 2020 2020 2020  atures..        
+00017730: 6461 7461 5f79 2028 6e64 6172 7261 792c  data_y (ndarray,
+00017740: 2073 7472 293a 2031 4420 6172 7261 7920   str): 1D array 
+00017750: 636f 6e74 6169 6e69 6e67 2074 6865 2063  containing the c
+00017760: 6f72 7265 7370 6f6e 696e 6720 6c61 6265  orresponing labe
+00017770: 6c73 2e20 0a20 2020 2020 2020 206f 7074  ls. .        opt
+00017780: 5f63 7620 2869 6e74 293a 2043 726f 7373  _cv (int): Cross
+00017790: 2d76 616c 6964 6174 696f 6e73 2074 6f20  -validations to 
+000177a0: 7065 7266 6f72 6d20 7768 656e 2061 7373  perform when ass
+000177b0: 6573 696e 6720 7468 6520 7065 7266 6f72  esing the perfor
+000177c0: 6d61 6e63 6520 6174 2065 6163 680a 2020  mance at each.  
+000177d0: 2020 2020 2020 2020 2020 6879 7065 7270            hyperp
+000177e0: 6172 616d 6574 6572 206f 7074 696d 697a  arameter optimiz
+000177f0: 6174 696f 6e20 7472 6961 6c2e 2046 6f72  ation trial. For
+00017800: 2065 7861 6d70 6c65 2c20 6966 2063 763d   example, if cv=
+00017810: 332c 2074 6865 6e20 6561 6368 206f 7074  3, then each opt
+00017820: 696d 697a 6174 696f 6e20 7472 6961 6c0a  imization trial.
+00017830: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00017840: 2062 6520 6173 7365 7373 6564 2061 6363   be assessed acc
+00017850: 6f72 6469 6e67 2074 6f20 7468 6520 332d  ording to the 3-
+00017860: 666f 6c64 2063 726f 7373 2076 616c 6964  fold cross valid
+00017870: 6174 696f 6e20 6163 6375 7261 6379 2e20  ation accuracy. 
+00017880: 0a0a 2020 2020 5265 7475 726e 733a 0a20  ..    Returns:. 
+00017890: 2020 2020 2020 2054 6865 2070 6572 666f         The perfo
+000178a0: 726d 616e 6365 206d 6574 7269 632c 2064  rmance metric, d
+000178b0: 6574 6572 6d69 6e65 6420 7573 696e 6720  etermined using 
+000178c0: 7468 6520 6372 6f73 732d 666f 6c64 2076  the cross-fold v
+000178d0: 616c 6964 6174 696f 6e20 6d65 7468 6f64  alidation method
+000178e0: 2e0a 2020 2020 2222 220a 2020 2020 0a20  ..    """.    . 
+000178f0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00017900: 7365 6c66 2c20 6461 7461 5f78 2c20 6461  self, data_x, da
+00017910: 7461 5f79 2c20 6f70 745f 6376 293a 0a0a  ta_y, opt_cv):..
+00017920: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00017930: 615f 7820 3d20 6461 7461 5f78 0a20 2020  a_x = data_x.   
+00017940: 2020 2020 2073 656c 662e 6461 7461 5f79       self.data_y
+00017950: 203d 2064 6174 615f 790a 2020 2020 2020   = data_y.      
+00017960: 2020 7365 6c66 2e6f 7074 5f63 7620 3d20    self.opt_cv = 
+00017970: 6f70 745f 6376 0a0a 2020 2020 6465 6620  opt_cv..    def 
+00017980: 5f5f 6361 6c6c 5f5f 2873 656c 662c 2074  __call__(self, t
+00017990: 7269 616c 293a 0a0a 2020 2020 2020 2020  rial):..        
+000179a0: 6e5f 6573 7469 6d61 746f 7273 203d 2074  n_estimators = t
+000179b0: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+000179c0: 2827 6e5f 6573 7469 6d61 746f 7273 272c  ('n_estimators',
+000179d0: 2031 3030 2c20 3330 3030 290a 2020 2020   100, 3000).    
+000179e0: 2020 2020 6372 6974 6572 696f 6e20 3d20      criterion = 
+000179f0: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
+00017a00: 7465 676f 7269 6361 6c28 2763 7269 7465  tegorical('crite
+00017a10: 7269 6f6e 272c 205b 2767 696e 6927 2c20  rion', ['gini', 
+00017a20: 2765 6e74 726f 7079 275d 290a 2020 2020  'entropy']).    
+00017a30: 2020 2020 6d61 785f 6465 7074 6820 3d20      max_depth = 
+00017a40: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00017a50: 7428 276d 6178 5f64 6570 7468 272c 2032  t('max_depth', 2
+00017a60: 2c20 3235 290a 2020 2020 2020 2020 6d69  , 25).        mi
+00017a70: 6e5f 7361 6d70 6c65 735f 7370 6c69 7420  n_samples_split 
+00017a80: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00017a90: 696e 7428 276d 696e 5f73 616d 706c 6573  int('min_samples
+00017aa0: 5f73 706c 6974 272c 2032 2c20 3235 290a  _split', 2, 25).
+00017ab0: 2020 2020 2020 2020 6d69 6e5f 7361 6d70          min_samp
+00017ac0: 6c65 735f 6c65 6166 203d 2074 7269 616c  les_leaf = trial
+00017ad0: 2e73 7567 6765 7374 5f69 6e74 2827 6d69  .suggest_int('mi
+00017ae0: 6e5f 7361 6d70 6c65 735f 6c65 6166 272c  n_samples_leaf',
+00017af0: 2031 2c20 3135 290a 2020 2020 2020 2020   1, 15).        
+00017b00: 6d61 785f 6665 6174 7572 6573 203d 2074  max_features = t
+00017b10: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+00017b20: 2827 6d61 785f 6665 6174 7572 6573 272c  ('max_features',
+00017b30: 2031 2c20 7365 6c66 2e64 6174 615f 782e   1, self.data_x.
+00017b40: 7368 6170 655b 315d 290a 2020 2020 2020  shape[1]).      
+00017b50: 2020 626f 6f74 7374 7261 7020 3d20 7472    bootstrap = tr
+00017b60: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
+00017b70: 676f 7269 6361 6c28 2762 6f6f 7473 7472  gorical('bootstr
+00017b80: 6170 272c 205b 5472 7565 2c20 4661 6c73  ap', [True, Fals
+00017b90: 655d 290a 2020 2020 2020 2020 0a20 2020  e]).        .   
+00017ba0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00017bb0: 2020 2020 2020 636c 6620 3d20 5261 6e64        clf = Rand
+00017bc0: 6f6d 466f 7265 7374 436c 6173 7369 6669  omForestClassifi
+00017bd0: 6572 286e 5f65 7374 696d 6174 6f72 733d  er(n_estimators=
+00017be0: 6e5f 6573 7469 6d61 746f 7273 2c20 6372  n_estimators, cr
+00017bf0: 6974 6572 696f 6e3d 6372 6974 6572 696f  iterion=criterio
+00017c00: 6e2c 206d 6178 5f64 6570 7468 3d6d 6178  n, max_depth=max
+00017c10: 5f64 6570 7468 2c0a 2020 2020 2020 2020  _depth,.        
+00017c20: 2020 2020 2020 2020 6d69 6e5f 7361 6d70          min_samp
+00017c30: 6c65 735f 7370 6c69 743d 6d69 6e5f 7361  les_split=min_sa
+00017c40: 6d70 6c65 735f 7370 6c69 742c 206d 696e  mples_split, min
+00017c50: 5f73 616d 706c 6573 5f6c 6561 663d 6d69  _samples_leaf=mi
+00017c60: 6e5f 7361 6d70 6c65 735f 6c65 6166 2c0a  n_samples_leaf,.
+00017c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c80: 6d61 785f 6665 6174 7572 6573 3d6d 6178  max_features=max
+00017c90: 5f66 6561 7475 7265 732c 2062 6f6f 7473  _features, boots
+00017ca0: 7472 6170 3d62 6f6f 7473 7472 6170 2c20  trap=bootstrap, 
+00017cb0: 7261 6e64 6f6d 5f73 7461 7465 3d31 3930  random_state=190
+00017cc0: 3929 0a20 2020 2020 2020 2065 7863 6570  9).        excep
+00017cd0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+00017ce0: 7269 6e74 2822 496e 7661 6c69 6420 6879  rint("Invalid hy
+00017cf0: 7065 7270 6172 616d 6574 6572 2063 6f6d  perparameter com
+00017d00: 6269 6e61 7469 6f6e 2c20 736b 6970 7069  bination, skippi
+00017d10: 6e67 2074 7269 616c 2229 0a20 2020 2020  ng trial").     
+00017d20: 2020 2020 2020 2072 6574 7572 6e20 302e         return 0.
+00017d30: 300a 0a20 2020 2020 2020 2063 7620 3d20  0..        cv = 
+00017d40: 6372 6f73 735f 7661 6c69 6461 7465 2863  cross_validate(c
+00017d50: 6c66 2c20 7365 6c66 2e64 6174 615f 782c  lf, self.data_x,
+00017d60: 2073 656c 662e 6461 7461 5f79 2c20 6376   self.data_y, cv
+00017d70: 3d73 656c 662e 6f70 745f 6376 290a 2020  =self.opt_cv).  
+00017d80: 2020 2020 2020 6669 6e61 6c5f 7363 6f72        final_scor
+00017d90: 6520 3d20 6e70 2e6d 6561 6e28 6376 5b27  e = np.mean(cv['
+00017da0: 7465 7374 5f73 636f 7265 275d 290a 0a20  test_score']).. 
+00017db0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+00017dc0: 6e61 6c5f 7363 6f72 650a 0a63 6c61 7373  nal_score..class
+00017dd0: 204d 6f6e 6974 6f72 5f54 7261 636b 6572   Monitor_Tracker
+00017de0: 2843 616c 6c62 6163 6b29 3a0a 2020 2020  (Callback):.    
+00017df0: 2222 220a 2020 2020 4375 7374 6f6d 2063  """.    Custom c
+00017e00: 616c 6c62 6163 6b20 7468 6174 2061 6c6c  allback that all
+00017e10: 6f77 7320 666f 7220 7477 6f20 6469 6666  ows for two diff
+00017e20: 6572 656e 7420 6d6f 6e69 746f 7273 2e0a  erent monitors..
+00017e30: 2020 2020 5468 6973 2063 6c61 7373 2069      This class i
+00017e40: 7320 7573 6564 2062 7920 7468 6520 606f  s used by the `o
+00017e50: 626a 6563 7469 7665 5f63 6e6e 6020 726f  bjective_cnn` ro
+00017e60: 7574 696e 6520 6173 2069 7420 696e 6865  utine as it inhe
+00017e70: 7269 7473 2074 6865 2060 6d6f 6e69 746f  rits the `monito
+00017e80: 7231 6020 0a20 2020 2061 6e64 2060 6d6f  r1` .    and `mo
+00017e90: 6e69 746f 7232 6020 6174 7472 6962 7574  nitor2` attribut
+00017ea0: 6573 2c20 6173 2077 656c 6c20 6173 2074  es, as well as t
+00017eb0: 6865 6972 2063 6f72 7265 7370 6f6e 6469  heir correspondi
+00017ec0: 6e67 2074 6872 6573 686f 6c64 732e 2054  ng thresholds. T
+00017ed0: 6869 7320 6561 726c 7920 7374 6f70 7069  his early stoppi
+00017ee0: 6e67 0a20 2020 2063 7573 746f 6d20 6361  ng.    custom ca
+00017ef0: 6c6c 6261 636b 2077 696c 6c20 7465 726d  llback will term
+00017f00: 696e 6174 6520 7468 6520 7472 6169 6e69  inate the traini
+00017f10: 6e67 2065 6172 6c79 2069 6620 6569 7468  ng early if eith
+00017f20: 6572 206d 6f6e 6974 6f72 7320 6372 6f73  er monitors cros
+00017f30: 7320 7468 6569 7220 7265 7370 6563 7469  s their respecti
+00017f40: 7665 0a20 2020 2074 6872 6573 686f 6c64  ve.    threshold
+00017f50: 2c20 7468 6572 6566 6f72 6520 7468 6520  , therefore the 
+00017f60: 7061 7469 656e 6365 2069 6e70 7574 2069  patience input i
+00017f70: 7320 6e6f 7420 7573 6564 2e20 5768 6574  s not used. Whet
+00017f80: 6865 7220 7468 6520 7468 7265 7368 6f6c  her the threshol
+00017f90: 6420 7368 6f75 6c64 2062 6520 6120 6365  d should be a ce
+00017fa0: 696c 696e 670a 2020 2020 6f72 2066 6c6f  iling.    or flo
+00017fb0: 6f72 2076 616c 7565 2077 696c 6c20 6265  or value will be
+00017fc0: 2064 6574 6572 6d69 6e65 6420 6163 636f   determined acco
+00017fd0: 7264 696e 6720 746f 2074 6865 206d 6574  rding to the met
+00017fe0: 7269 632c 2062 7920 6368 6563 6b69 6e67  ric, by checking
+00017ff0: 2077 6865 7468 6572 2074 6865 206d 6f6e   whether the mon
+00018000: 6974 6f72 206e 616d 650a 2020 2020 636f  itor name.    co
+00018010: 6e74 6169 6e73 2074 6865 2077 6f72 6420  ntains the word 
+00018020: 276c 6f73 7327 2e0a 0a20 2020 2041 7267  'loss'...    Arg
+00018030: 733a 0a20 2020 2020 2020 206d 6f6e 6974  s:.        monit
+00018040: 6f72 3120 2873 7472 293a 204e 616d 6520  or1 (str): Name 
+00018050: 6f66 2074 6865 206d 6574 7269 6320 746f  of the metric to
+00018060: 206d 6f6e 6974 6f72 2e20 4966 2060 4e6f   monitor. If `No
+00018070: 6e65 602c 2074 6869 7320 6d6f 6e69 746f  ne`, this monito
+00018080: 7220 7769 6c6c 206e 6f74 2062 6520 7573  r will not be us
+00018090: 6564 2e0a 2020 2020 2020 2020 6d6f 6e69  ed..        moni
+000180a0: 746f 7232 2028 7374 7229 3a20 4e61 6d65  tor2 (str): Name
+000180b0: 206f 6620 7468 6520 6d65 7472 6963 2074   of the metric t
+000180c0: 6f20 6d6f 6e69 746f 722e 2049 6620 604e  o monitor. If `N
+000180d0: 6f6e 6560 2c20 7468 6973 206d 6f6e 6974  one`, this monit
+000180e0: 6f72 2077 696c 6c20 6e6f 7420 6265 2075  or will not be u
+000180f0: 7365 642e 0a20 2020 2020 2020 206d 6f6e  sed..        mon
+00018100: 6974 6f72 315f 7468 7265 7368 2028 666c  itor1_thresh (fl
+00018110: 6f61 7429 3a20 5468 7265 7368 6f6c 6420  oat): Threshold 
+00018120: 7661 6c75 6520 666f 7220 606d 6f6e 6974  value for `monit
+00018130: 6f72 3160 2e0a 2020 2020 2020 2020 6d6f  or1`..        mo
+00018140: 6e69 746f 7232 5f74 6872 6573 6820 2866  nitor2_thresh (f
+00018150: 6c6f 6174 293a 2054 6872 6573 686f 6c64  loat): Threshold
+00018160: 2076 616c 7565 2066 6f72 2060 6d6f 6e69   value for `moni
+00018170: 746f 7232 602e 0a0a 2020 2020 4174 7472  tor2`...    Attr
+00018180: 6962 7574 6573 3a0a 2020 2020 2020 2020  ibutes:.        
+00018190: 7374 6f70 7065 645f 6570 6f63 6820 2869  stopped_epoch (i
+000181a0: 6e74 293a 2054 6865 2065 706f 6368 2061  nt): The epoch a
+000181b0: 7420 7768 6963 6820 7468 6520 7472 6169  t which the trai
+000181c0: 6e69 6e67 2077 6173 2073 746f 7070 6564  ning was stopped
+000181d0: 2e0a 2020 2020 2020 2020 6265 7374 5f6d  ..        best_m
+000181e0: 6574 7269 6320 2866 6c6f 6174 293a 2054  etric (float): T
+000181f0: 6865 2062 6573 7420 6d65 7472 6963 2076  he best metric v
+00018200: 616c 7565 2061 6368 6965 7665 6420 6475  alue achieved du
+00018210: 7269 6e67 2074 6865 2074 7261 696e 696e  ring the trainin
+00018220: 672e 0a20 2020 2020 2020 2062 6573 745f  g..        best_
+00018230: 7765 6967 6874 7320 286e 6461 7272 6179  weights (ndarray
+00018240: 293a 2054 6865 2077 6569 6768 7473 206f  ): The weights o
+00018250: 6620 7468 6520 6d6f 6465 6c20 6174 2074  f the model at t
+00018260: 6865 2065 706f 6368 2077 6974 6820 7468  he epoch with th
+00018270: 6520 6265 7374 206d 6574 7269 6320 7661  e best metric va
+00018280: 6c75 652e 0a0a 2020 2020 5265 7475 726e  lue...    Return
+00018290: 733a 0a20 2020 2020 2020 204e 6f6e 650a  s:.        None.
+000182a0: 2020 2020 2222 220a 2020 2020 0a20 2020      """.    .   
+000182b0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+000182c0: 6c66 2c20 6d6f 6e69 746f 7231 3d4e 6f6e  lf, monitor1=Non
+000182d0: 652c 206d 6f6e 6974 6f72 323d 4e6f 6e65  e, monitor2=None
+000182e0: 2c20 6d6f 6e69 746f 7231 5f74 6872 6573  , monitor1_thres
+000182f0: 683d 4e6f 6e65 2c20 6d6f 6e69 746f 7232  h=None, monitor2
+00018300: 5f74 6872 6573 683d 4e6f 6e65 293a 0a20  _thresh=None):. 
+00018310: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+00018320: 5f69 6e69 745f 5f28 2920 2323 496e 6974  _init__() ##Init
+00018330: 6961 6c69 7a65 7320 7468 6520 696e 6865  ializes the inhe
+00018340: 7269 7465 6420 6174 7472 6962 7574 6573  rited attributes
+00018350: 2061 6e64 206d 6574 686f 6473 2066 726f   and methods fro
+00018360: 6d20 7468 6520 7061 7265 6e74 2063 6c61  m the parent cla
+00018370: 7373 2061 7320 6974 2077 696c 6c20 696e  ss as it will in
+00018380: 6865 7269 7420 6672 6f6d 2043 616c 6c62  herit from Callb
+00018390: 6163 6b0a 2020 2020 2020 2020 7365 6c66  ack.        self
+000183a0: 2e6d 6f6e 6974 6f72 3120 3d20 6d6f 6e69  .monitor1 = moni
+000183b0: 746f 7231 0a20 2020 2020 2020 2073 656c  tor1.        sel
+000183c0: 662e 6d6f 6e69 746f 7232 203d 206d 6f6e  f.monitor2 = mon
+000183d0: 6974 6f72 320a 2020 2020 2020 2020 7365  itor2.        se
+000183e0: 6c66 2e6d 6f6e 6974 6f72 315f 7468 7265  lf.monitor1_thre
+000183f0: 7368 203d 206d 6f6e 6974 6f72 315f 7468  sh = monitor1_th
+00018400: 7265 7368 0a20 2020 2020 2020 2073 656c  resh.        sel
+00018410: 662e 6d6f 6e69 746f 7232 5f74 6872 6573  f.monitor2_thres
+00018420: 6820 3d20 6d6f 6e69 746f 7232 5f74 6872  h = monitor2_thr
+00018430: 6573 680a 2020 2020 2020 2020 7365 6c66  esh.        self
+00018440: 2e73 746f 7070 6564 5f65 706f 6368 203d  .stopped_epoch =
+00018450: 2030 0a20 2020 2020 2020 2073 656c 662e   0.        self.
+00018460: 6265 7374 5f6d 6574 7269 6320 3d20 666c  best_metric = fl
+00018470: 6f61 7428 2769 6e66 2729 200a 2020 2020  oat('inf') .    
+00018480: 2020 2020 7365 6c66 2e62 6573 745f 7765      self.best_we
+00018490: 6967 6874 7320 3d20 4e6f 6e65 2023 5769  ights = None #Wi
+000184a0: 6c6c 2075 7365 2074 6869 7320 746f 2073  ll use this to s
+000184b0: 746f 7265 2074 6865 2077 6569 6768 7473  tore the weights
+000184c0: 2077 6974 6820 7468 6520 6265 7374 206d   with the best m
+000184d0: 6574 7269 6320 7661 6c75 6520 6275 7420  etric value but 
+000184e0: 6e6f 7420 6375 7272 656e 746c 7920 6361  not currently ca
+000184f0: 6c6c 6564 2069 6e20 7468 6520 726f 7574  lled in the rout
+00018500: 696e 650a 0a20 2020 2064 6566 206f 6e5f  ine..    def on_
+00018510: 6570 6f63 685f 656e 6428 7365 6c66 2c20  epoch_end(self, 
+00018520: 6570 6f63 682c 206c 6f67 733d 7b7d 293a  epoch, logs={}):
+00018530: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018540: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
+00018550: 2077 696c 6c20 6265 2063 616c 6c65 6420   will be called 
+00018560: 6174 2074 6865 2065 6e64 206f 6620 6561  at the end of ea
+00018570: 6368 2065 706f 6368 2064 7572 696e 6720  ch epoch during 
+00018580: 7472 6169 6e69 6e67 2e0a 0a20 2020 2020  training...     
+00018590: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+000185a0: 2020 2020 2065 706f 6368 2028 696e 7429       epoch (int)
+000185b0: 3a20 4375 7272 656e 7420 6570 6f63 6820  : Current epoch 
+000185c0: 6e75 6d62 6572 2e0a 2020 2020 2020 2020  number..        
+000185d0: 2020 2020 6c6f 6773 2028 6469 6374 293a      logs (dict):
+000185e0: 2044 6963 7469 6f6e 6172 7920 636f 6e74   Dictionary cont
+000185f0: 6169 6e69 6e67 2074 6865 206d 6574 7269  aining the metri
+00018600: 6373 2066 6f72 2074 6865 2063 7572 7265  cs for the curre
+00018610: 6e74 2065 706f 6368 2e0a 0a20 2020 2020  nt epoch...     
+00018620: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+00018630: 2020 2020 2020 2020 4e6f 6e65 0a20 2020          None.   
+00018640: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00018650: 2020 6966 2073 656c 662e 6d6f 6e69 746f    if self.monito
+00018660: 7231 2069 7320 6e6f 7420 4e6f 6e65 2061  r1 is not None a
+00018670: 6e64 2073 656c 662e 6d6f 6e69 746f 7232  nd self.monitor2
+00018680: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00018690: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+000186a0: 745f 3120 3d20 6c6f 6773 2e67 6574 2873  t_1 = logs.get(s
+000186b0: 656c 662e 6d6f 6e69 746f 7231 290a 2020  elf.monitor1).  
+000186c0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+000186d0: 745f 3220 3d20 6c6f 6773 2e67 6574 2873  t_2 = logs.get(s
+000186e0: 656c 662e 6d6f 6e69 746f 7232 290a 2020  elf.monitor2).  
+000186f0: 2020 2020 2020 2020 2020 6966 2027 6c6f            if 'lo
+00018700: 7373 2720 6e6f 7420 696e 2073 656c 662e  ss' not in self.
+00018710: 6d6f 6e69 746f 7231 2061 6e64 2027 6c6f  monitor1 and 'lo
+00018720: 7373 2720 696e 2073 656c 662e 6d6f 6e69  ss' in self.moni
+00018730: 746f 7232 3a0a 2020 2020 2020 2020 2020  tor2:.          
+00018740: 2020 2020 2020 6966 206e 702e 6772 6561        if np.grea
+00018750: 7465 7228 6375 7272 656e 745f 312c 2073  ter(current_1, s
+00018760: 656c 662e 6d6f 6e69 746f 7231 5f74 6872  elf.monitor1_thr
+00018770: 6573 6829 206f 7220 6e70 2e6c 6573 735f  esh) or np.less_
+00018780: 6571 7561 6c28 6375 7272 656e 745f 322c  equal(current_2,
+00018790: 2073 656c 662e 6d6f 6e69 746f 7232 5f74   self.monitor2_t
+000187a0: 6872 6573 6829 3a0a 2020 2020 2020 2020  hresh):.        
+000187b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000187c0: 2e73 746f 7070 6564 5f65 706f 6368 203d  .stopped_epoch =
+000187d0: 2065 706f 6368 0a20 2020 2020 2020 2020   epoch.         
+000187e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000187f0: 6d6f 6465 6c2e 7374 6f70 5f74 7261 696e  model.stop_train
+00018800: 696e 6720 3d20 5472 7565 0a20 2020 2020  ing = True.     
+00018810: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00018820: 6e74 5f6d 6574 7269 6320 3d20 6375 7272  nt_metric = curr
+00018830: 656e 745f 310a 2020 2020 2020 2020 2020  ent_1.          
+00018840: 2020 656c 6966 2027 6c6f 7373 2720 6e6f    elif 'loss' no
+00018850: 7420 696e 2073 656c 662e 6d6f 6e69 746f  t in self.monito
+00018860: 7231 2061 6e64 2027 6c6f 7373 2720 6e6f  r1 and 'loss' no
+00018870: 7420 696e 2073 656c 662e 6d6f 6e69 746f  t in self.monito
+00018880: 7232 3a0a 2020 2020 2020 2020 2020 2020  r2:.            
+00018890: 2020 2020 6966 206e 702e 6772 6561 7465      if np.greate
+000188a0: 7228 6375 7272 656e 745f 312c 2073 656c  r(current_1, sel
+000188b0: 662e 6d6f 6e69 746f 7231 5f74 6872 6573  f.monitor1_thres
+000188c0: 6829 206f 7220 6e70 2e67 7265 6174 6572  h) or np.greater
+000188d0: 2863 7572 7265 6e74 5f32 2c20 7365 6c66  (current_2, self
+000188e0: 2e6d 6f6e 6974 6f72 325f 7468 7265 7368  .monitor2_thresh
+000188f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00018900: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
+00018910: 7065 645f 6570 6f63 6820 3d20 6570 6f63  ped_epoch = epoc
+00018920: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00018930: 2020 2020 2020 7365 6c66 2e6d 6f64 656c        self.model
+00018940: 2e73 746f 705f 7472 6169 6e69 6e67 203d  .stop_training =
+00018950: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00018960: 2020 2020 2020 6375 7272 656e 745f 6d65        current_me
+00018970: 7472 6963 203d 2063 7572 7265 6e74 5f31  tric = current_1
+00018980: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00018990: 6620 276c 6f73 7327 2069 6e20 7365 6c66  f 'loss' in self
+000189a0: 2e6d 6f6e 6974 6f72 3120 616e 6420 276c  .monitor1 and 'l
+000189b0: 6f73 7327 2069 6e20 7365 6c66 2e6d 6f6e  oss' in self.mon
+000189c0: 6974 6f72 323a 0a20 2020 2020 2020 2020  itor2:.         
+000189d0: 2020 2020 2020 2069 6620 6e70 2e6c 6573         if np.les
+000189e0: 735f 6571 7561 6c28 6375 7272 656e 745f  s_equal(current_
+000189f0: 312c 2073 656c 662e 6d6f 6e69 746f 7231  1, self.monitor1
+00018a00: 5f74 6872 6573 6829 206f 7220 6e70 2e6c  _thresh) or np.l
+00018a10: 6573 735f 6571 7561 6c28 6375 7272 656e  ess_equal(curren
+00018a20: 745f 322c 2073 656c 662e 6d6f 6e69 746f  t_2, self.monito
+00018a30: 7232 5f74 6872 6573 6829 3a0a 2020 2020  r2_thresh):.    
+00018a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a50: 7365 6c66 2e73 746f 7070 6564 5f65 706f  self.stopped_epo
+00018a60: 6368 203d 2065 706f 6368 0a20 2020 2020  ch = epoch.     
+00018a70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018a80: 656c 662e 6d6f 6465 6c2e 7374 6f70 5f74  elf.model.stop_t
+00018a90: 7261 696e 696e 6720 3d20 5472 7565 0a20  raining = True. 
+00018aa0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00018ab0: 7572 7265 6e74 5f6d 6574 7269 6320 3d20  urrent_metric = 
+00018ac0: 6375 7272 656e 745f 310a 2020 2020 2020  current_1.      
+00018ad0: 2020 2020 2020 656c 6966 2027 6c6f 7373        elif 'loss
+00018ae0: 2720 696e 2073 656c 662e 6d6f 6e69 746f  ' in self.monito
+00018af0: 7231 2061 6e64 2027 6c6f 7373 2720 6e6f  r1 and 'loss' no
+00018b00: 7420 696e 2073 656c 662e 6d6f 6e69 746f  t in self.monito
+00018b10: 7232 3a0a 2020 2020 2020 2020 2020 2020  r2:.            
+00018b20: 2020 2020 6966 206e 702e 6c65 7373 5f65      if np.less_e
+00018b30: 7175 616c 2863 7572 7265 6e74 5f31 2c20  qual(current_1, 
+00018b40: 7365 6c66 2e6d 6f6e 6974 6f72 315f 7468  self.monitor1_th
+00018b50: 7265 7368 2920 6f72 206e 702e 6772 6561  resh) or np.grea
+00018b60: 7465 7228 6375 7272 656e 745f 322c 2073  ter(current_2, s
+00018b70: 656c 662e 6d6f 6e69 746f 7232 5f74 6872  elf.monitor2_thr
+00018b80: 6573 6829 3a0a 2020 2020 2020 2020 2020  esh):.          
+00018b90: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00018ba0: 746f 7070 6564 5f65 706f 6368 203d 2065  topped_epoch = e
+00018bb0: 706f 6368 0a20 2020 2020 2020 2020 2020  poch.           
+00018bc0: 2020 2020 2020 2020 2073 656c 662e 6d6f           self.mo
+00018bd0: 6465 6c2e 7374 6f70 5f74 7261 696e 696e  del.stop_trainin
+00018be0: 6720 3d20 5472 7565 0a20 2020 2020 2020  g = True.       
+00018bf0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00018c00: 5f6d 6574 7269 6320 3d20 6375 7272 656e  _metric = curren
+00018c10: 745f 310a 2020 2020 2020 2020 2020 2020  t_1.            
+00018c20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018c30: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00018c40: 6545 7272 6f72 2827 496e 7661 6c69 6420  eError('Invalid 
+00018c50: 6d6f 6e69 746f 7220 696e 7075 742e 2729  monitor input.')
+00018c60: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00018c70: 2020 2020 2020 2020 2020 6966 2063 7572            if cur
+00018c80: 7265 6e74 5f6d 6574 7269 6320 3c20 7365  rent_metric < se
+00018c90: 6c66 2e62 6573 745f 6d65 7472 6963 3a0a  lf.best_metric:.
+00018ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cb0: 7365 6c66 2e62 6573 745f 6d65 7472 6963  self.best_metric
+00018cc0: 203d 2063 7572 7265 6e74 5f6d 6574 7269   = current_metri
+00018cd0: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+00018ce0: 2020 7365 6c66 2e62 6573 745f 7765 6967    self.best_weig
+00018cf0: 6874 7320 3d20 7365 6c66 2e6d 6f64 656c  hts = self.model
+00018d00: 2e67 6574 5f77 6569 6768 7473 2829 0a20  .get_weights(). 
+00018d10: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00018d20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018d30: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00018d40: 745f 6d65 7472 6963 203d 206c 6f67 732e  t_metric = logs.
+00018d50: 6765 7428 7365 6c66 2e6d 6f6e 6974 6f72  get(self.monitor
+00018d60: 3129 0a20 2020 2020 2020 2020 2020 2069  1).            i
+00018d70: 6620 276c 6f73 7327 206e 6f74 2069 6e20  f 'loss' not in 
+00018d80: 7365 6c66 2e6d 6f6e 6974 6f72 313a 0a20  self.monitor1:. 
+00018d90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018da0: 6620 6e70 2e67 7265 6174 6572 2863 7572  f np.greater(cur
+00018db0: 7265 6e74 5f6d 6574 7269 632c 2073 656c  rent_metric, sel
+00018dc0: 662e 6d6f 6e69 746f 7231 5f74 6872 6573  f.monitor1_thres
+00018dd0: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00018de0: 2020 2020 2020 2020 7365 6c66 2e73 746f          self.sto
+00018df0: 7070 6564 5f65 706f 6368 203d 2065 706f  pped_epoch = epo
+00018e00: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
+00018e10: 2020 2020 2020 2073 656c 662e 6d6f 6465         self.mode
+00018e20: 6c2e 7374 6f70 5f74 7261 696e 696e 6720  l.stop_training 
+00018e30: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00018e40: 2020 2020 2020 2069 6620 6375 7272 656e         if curren
+00018e50: 745f 6d65 7472 6963 203c 2073 656c 662e  t_metric < self.
+00018e60: 6265 7374 5f6d 6574 7269 633a 0a20 2020  best_metric:.   
+00018e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e80: 2073 656c 662e 6265 7374 5f6d 6574 7269   self.best_metri
+00018e90: 6320 3d20 6375 7272 656e 745f 6d65 7472  c = current_metr
+00018ea0: 6963 0a20 2020 2020 2020 2020 2020 2020  ic.             
+00018eb0: 2020 2020 2020 2073 656c 662e 6265 7374         self.best
+00018ec0: 5f77 6569 6768 7473 203d 2073 656c 662e  _weights = self.
+00018ed0: 6d6f 6465 6c2e 6765 745f 7765 6967 6874  model.get_weight
+00018ee0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00018ef0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018f00: 2020 2020 2020 6966 206e 702e 6c65 7373        if np.less
+00018f10: 5f65 7175 616c 2863 7572 7265 6e74 5f6d  _equal(current_m
+00018f20: 6574 7269 632c 2073 656c 662e 6d6f 6e69  etric, self.moni
+00018f30: 746f 7231 5f74 6872 6573 6829 3a0a 2020  tor1_thresh):.  
+00018f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f50: 2020 7365 6c66 2e73 746f 7070 6564 5f65    self.stopped_e
+00018f60: 706f 6368 203d 2065 706f 6368 0a20 2020  poch = epoch.   
+00018f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f80: 2073 656c 662e 6d6f 6465 6c2e 7374 6f70   self.model.stop
+00018f90: 5f74 7261 696e 696e 6720 3d20 5472 7565  _training = True
+00018fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018fb0: 2069 6620 6375 7272 656e 745f 6d65 7472   if current_metr
+00018fc0: 6963 203c 2073 656c 662e 6265 7374 5f6d  ic < self.best_m
+00018fd0: 6574 7269 633a 0a20 2020 2020 2020 2020  etric:.         
+00018fe0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018ff0: 6265 7374 5f6d 6574 7269 6320 3d20 6375  best_metric = cu
+00019000: 7272 656e 745f 6d65 7472 6963 0a20 2020  rrent_metric.   
+00019010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019020: 2073 656c 662e 6265 7374 5f77 6569 6768   self.best_weigh
+00019030: 7473 203d 2073 656c 662e 6d6f 6465 6c2e  ts = self.model.
+00019040: 6765 745f 7765 6967 6874 7328 290a 0a0a  get_weights()...
+00019050: 6465 6620 6879 7065 725f 6f70 7428 6461  def hyper_opt(da
+00019060: 7461 5f78 3d4e 6f6e 652c 2064 6174 615f  ta_x=None, data_
+00019070: 793d 4e6f 6e65 2c20 7661 6c5f 583d 4e6f  y=None, val_X=No
+00019080: 6e65 2c20 7661 6c5f 593d 4e6f 6e65 2c20  ne, val_Y=None, 
+00019090: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+000190a0: 3d31 2c20 636c 663d 2761 6c65 786e 6574  =1, clf='alexnet
+000190b0: 272c 200a 2020 2020 6e6f 726d 616c 697a  ', .    normaliz
+000190c0: 653d 5472 7565 2c20 6d69 6e5f 7069 7865  e=True, min_pixe
+000190d0: 6c3d 302c 206d 6178 5f70 6978 656c 3d31  l=0, max_pixel=1
+000190e0: 3030 302c 206e 5f69 7465 723d 3235 2c20  000, n_iter=25, 
+000190f0: 7061 7469 656e 6365 3d35 2c20 6d65 7472  patience=5, metr
+00019100: 6963 3d27 6c6f 7373 272c 206d 6574 7269  ic='loss', metri
+00019110: 6332 3d4e 6f6e 652c 2061 7665 7261 6765  c2=None, average
+00019120: 3d54 7275 652c 200a 2020 2020 7465 7374  =True, .    test
+00019130: 5f70 6f73 6974 6976 653d 4e6f 6e65 2c20  _positive=None, 
+00019140: 7465 7374 5f6e 6567 6174 6976 653d 4e6f  test_negative=No
+00019150: 6e65 2c20 7465 7374 5f61 6363 5f74 6872  ne, test_acc_thr
+00019160: 6573 686f 6c64 3d4e 6f6e 652c 2070 6f73  eshold=None, pos
+00019170: 745f 6d65 7472 6963 3d54 7275 652c 206f  t_metric=True, o
+00019180: 7074 5f6d 6f64 656c 3d54 7275 652c 2062  pt_model=True, b
+00019190: 6174 6368 5f73 697a 655f 6d69 6e3d 3136  atch_size_min=16
+000191a0: 2c20 6261 7463 685f 7369 7a65 5f6d 6178  , batch_size_max
+000191b0: 3d36 342c 2074 7261 696e 5f65 706f 6368  =64, train_epoch
+000191c0: 733d 3235 2c20 6f70 745f 6376 3d4e 6f6e  s=25, opt_cv=Non
+000191d0: 652c 0a20 2020 206f 7074 5f61 7567 3d46  e,.    opt_aug=F
+000191e0: 616c 7365 2c20 6261 7463 685f 6d69 6e3d  alse, batch_min=
+000191f0: 322c 2062 6174 6368 5f6d 6178 3d32 352c  2, batch_max=25,
+00019200: 2062 6174 6368 5f6f 7468 6572 3d31 2c20   batch_other=1, 
+00019210: 6261 6c61 6e63 653d 5472 7565 2c20 696d  balance=True, im
+00019220: 6167 655f 7369 7a65 5f6d 696e 3d35 302c  age_size_min=50,
+00019230: 2069 6d61 6765 5f73 697a 655f 6d61 783d   image_size_max=
+00019240: 3130 302c 2073 6869 6674 3d31 302c 206f  100, shift=10, o
+00019250: 7074 5f6d 6178 5f6d 696e 5f70 6978 3d4e  pt_max_min_pix=N
+00019260: 6f6e 652c 206f 7074 5f6d 6178 5f6d 6178  one, opt_max_max
+00019270: 5f70 6978 3d4e 6f6e 652c 200a 2020 2020  _pix=None, .    
+00019280: 6d61 736b 5f73 697a 653d 4e6f 6e65 2c20  mask_size=None, 
+00019290: 6e75 6d5f 6d61 736b 733d 4e6f 6e65 2c20  num_masks=None, 
+000192a0: 736d 6f74 655f 7361 6d70 6c69 6e67 3d30  smote_sampling=0
+000192b0: 2c20 626c 656e 645f 6d61 783d 302c 206e  , blend_max=0, n
+000192c0: 756d 5f69 6d61 6765 735f 746f 5f62 6c65  um_images_to_ble
+000192d0: 6e64 3d32 2c20 626c 656e 6469 6e67 5f66  nd=2, blending_f
+000192e0: 756e 633d 276d 6561 6e27 2c20 626c 656e  unc='mean', blen
+000192f0: 645f 6f74 6865 723d 312c 207a 6f6f 6d5f  d_other=1, zoom_
+00019300: 7261 6e67 653d 2830 2e39 2c31 2e31 292c  range=(0.9,1.1),
+00019310: 2073 6b65 775f 616e 676c 653d 302c 0a20   skew_angle=0,. 
+00019320: 2020 206c 696d 6974 5f73 6561 7263 683d     limit_search=
+00019330: 5472 7565 2c20 6d6f 6e69 746f 7231 3d4e  True, monitor1=N
+00019340: 6f6e 652c 206d 6f6e 6974 6f72 323d 4e6f  one, monitor2=No
+00019350: 6e65 2c20 6d6f 6e69 746f 7231 5f74 6872  ne, monitor1_thr
+00019360: 6573 683d 4e6f 6e65 2c20 6d6f 6e69 746f  esh=None, monito
+00019370: 7232 5f74 6872 6573 683d 4e6f 6e65 2c20  r2_thresh=None, 
+00019380: 7665 7262 6f73 653d 302c 2072 6574 7572  verbose=0, retur
+00019390: 6e5f 7374 7564 793d 5472 7565 2c20 7361  n_study=True, sa
+000193a0: 7665 5f6d 6f64 656c 733d 4661 6c73 652c  ve_models=False,
+000193b0: 2073 6176 655f 7374 7564 6965 733d 4661   save_studies=Fa
+000193c0: 6c73 652c 2070 6174 683d 4e6f 6e65 293a  lse, path=None):
+000193d0: 200a 2020 2020 2222 220a 2020 2020 4f70   .    """.    Op
+000193e0: 7469 6d69 7a65 7320 6879 7065 7270 6172  timizes hyperpar
+000193f0: 616d 6574 6572 7320 7573 696e 6720 6120  ameters using a 
+00019400: 6b2d 666f 6c64 2063 726f 7373 2076 616c  k-fold cross val
+00019410: 6964 6174 696f 6e20 7370 6c69 7474 696e  idation splittin
+00019420: 6720 7374 7261 7465 6779 2e0a 0a20 2020  g strategy...   
+00019430: 202a 2a49 4d50 4f52 5441 4e54 2a2a 2049   **IMPORTANT** I
+00019440: 6e20 7468 6520 6361 7365 206f 6620 434e  n the case of CN
+00019450: 4e20 6f70 7469 6d69 7a61 7469 6f6e 2c20  N optimization, 
+00019460: 6461 7461 5f78 2061 6e64 2064 6174 615f  data_x and data_
+00019470: 7920 6172 6520 6e6f 7420 7468 6520 7374  y are not the st
+00019480: 616e 6461 7264 0a20 2020 2064 6174 6120  andard.    data 
+00019490: 706c 7573 206c 6162 656c 7320 2d2d 2070  plus labels -- p
+000194a0: 7942 4941 2061 7373 756d 6573 2062 696e  yBIA assumes bin
+000194b0: 6172 7920 636c 6173 7369 6669 6361 7469  ary classificati
+000194c0: 6f6e 2061 6c77 6179 7320 7468 6572 6566  on always theref
+000194d0: 6f72 6520 6966 206f 7074 696d 697a 696e  ore if optimizin
+000194e0: 6720 6120 0a20 2020 2043 4e4e 2074 6865  g a .    CNN the
+000194f0: 2073 616d 706c 6573 2066 6f72 2074 6865   samples for the
+00019500: 2066 6972 7374 2063 6c61 7373 2073 686f   first class sho
+00019510: 756c 6420 6265 2070 6173 7365 6420 7468  uld be passed th
+00019520: 726f 7567 6820 7468 6520 6461 7461 5f78  rough the data_x
+00019530: 2070 6172 616d 6574 6572 2c20 616e 6420   parameter, and 
+00019540: 7468 6520 0a20 2020 2073 616d 706c 6573  the .    samples
+00019550: 2066 6f72 2074 6865 2073 6563 6f6e 6420   for the second 
+00019560: 636c 6173 7320 7368 6f75 6c64 2062 6520  class should be 
+00019570: 6769 7665 6e20 6173 2064 6174 615f 792e  given as data_y.
+00019580: 2054 6865 7365 2074 776f 2063 6c61 7373   These two class
+00019590: 6573 2077 696c 6c20 6175 746f 6d61 7469  es will automati
+000195a0: 6361 6c6c 7920 0a20 2020 2062 6520 6173  cally .    be as
+000195b0: 7369 676e 6564 2074 6865 2070 6f73 6974  signed the posit
+000195c0: 6976 6520 616e 6420 6e65 6761 7469 7665  ive and negative
+000195d0: 206c 6162 656c 7320 3120 616e 6420 302c   labels 1 and 0,
+000195e0: 2072 6573 7065 6374 6976 656c 792e 204c   respectively. L
+000195f0: 696b 6577 6973 652c 2069 6620 6f70 7469  ikewise, if opti
+00019600: 6d69 7a69 6e67 2061 200a 2020 2020 434e  mizing a .    CN
+00019610: 4e20 6d6f 6465 6c2c 2076 616c 5f58 2063  N model, val_X c
+00019620: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
+00019630: 6520 696d 6167 6573 206f 6620 7468 6520  e images of the 
+00019640: 6669 7273 7420 636c 6173 732c 2061 6e64  first class, and
+00019650: 2076 616c 5f59 2074 6865 2069 6d61 6765   val_Y the image
+00019660: 7320 6f66 2074 6865 2073 6563 6f6e 6420  s of the second 
+00019670: 636c 6173 732e 200a 2020 2020 0a20 2020  class. .    .   
+00019680: 2049 6620 7361 7665 5f73 7475 6479 3d54   If save_study=T
+00019690: 7275 652c 2074 6865 204f 7074 756e 6120  rue, the Optuna 
+000196a0: 7374 7564 7920 6f62 6a65 6374 2077 696c  study object wil
+000196b0: 6c20 6265 2074 6865 2074 6869 7264 206f  l be the third o
+000196c0: 7574 7075 742e 2054 6869 730a 2020 2020  utput. This.    
+000196d0: 6f62 6a65 6374 2063 616e 2062 6520 7573  object can be us
+000196e0: 6564 2066 6f72 2076 6172 696f 7573 2061  ed for various a
+000196f0: 6e61 6c79 7369 732c 2069 6e63 6c75 6469  nalysis, includi
+00019700: 6e67 206f 7074 696d 697a 6174 696f 6e20  ng optimization 
+00019710: 7669 7375 616c 697a 6174 696f 6e73 2e0a  visualizations..
+00019720: 2020 2020 5365 653a 2068 7474 7073 3a2f      See: https:/
+00019730: 2f6f 7074 756e 612e 7265 6164 7468 6564  /optuna.readthed
+00019740: 6f63 732e 696f 2f65 6e2f 7374 6162 6c65  ocs.io/en/stable
+00019750: 2f72 6566 6572 656e 6365 2f67 656e 6572  /reference/gener
+00019760: 6174 6564 2f6f 7074 756e 612e 7374 7564  ated/optuna.stud
+00019770: 792e 5374 7564 792e 6874 6d6c 0a0a 2020  y.Study.html..  
+00019780: 2020 4578 616d 706c 653a 0a20 2020 2020    Example:.     
+00019790: 2020 2054 6865 2066 756e 6374 696f 6e20     The function 
+000197a0: 7769 6c6c 2063 7265 6174 6520 7468 6520  will create the 
+000197b0: 636c 6173 7369 6669 6361 7469 6f6e 2065  classification e
+000197c0: 6e67 696e 6520 616e 6420 6f70 7469 6d69  ngine and optimi
+000197d0: 7a65 2074 6865 2068 7970 6572 7061 7261  ze the hyperpara
+000197e0: 6d65 7465 7273 0a20 2020 2020 2020 2075  meters.        u
+000197f0: 7369 6e67 2061 6e20 6974 6572 6174 6976  sing an iterativ
+00019800: 6520 6170 7072 6f61 6368 3a0a 0a20 2020  e approach:..   
+00019810: 2020 2020 203e 3e3e 206d 6f64 656c 2c20       >>> model, 
+00019820: 7061 7261 6d73 203d 2068 7970 6572 5f6f  params = hyper_o
+00019830: 7074 2864 6174 615f 782c 2064 6174 615f  pt(data_x, data_
+00019840: 792c 2063 6c66 3d27 7266 2729 200a 2020  y, clf='rf') .  
+00019850: 2020 2020 2020 0a20 2020 2020 2020 2054        .        T
+00019860: 6865 2066 6972 7374 206f 7574 7075 7420  he first output 
+00019870: 6973 206f 7572 206f 7074 696d 616c 2063  is our optimal c
+00019880: 6c61 7373 6966 6965 722c 2061 6e64 2077  lassifier, and w
+00019890: 696c 6c20 6265 2075 7365 6420 746f 206d  ill be used to m
+000198a0: 616b 6520 7072 6564 6963 7469 6f6e 733a  ake predictions:
+000198b0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+000198c0: 2020 3e3e 3e20 7072 6564 6963 7469 6f6e    >>> prediction
+000198d0: 203d 206d 6f64 656c 2e70 7265 6469 6374   = model.predict
+000198e0: 286e 6577 5f64 6174 6129 0a20 2020 2020  (new_data).     
+000198f0: 2020 200a 2020 2020 2020 2020 5468 6520     .        The 
+00019900: 7365 636f 6e64 206f 7574 7075 7420 6f66  second output of
+00019910: 2074 6865 206f 7074 696d 697a 6520 6675   the optimize fu
+00019920: 6e63 7469 6f6e 2069 7320 7468 6520 6469  nction is the di
+00019930: 6374 696f 6e61 7279 2063 6f6e 7461 696e  ctionary contain
+00019940: 696e 670a 2020 2020 2020 2020 7468 6520  ing.        the 
+00019950: 6879 7065 7270 6172 616d 6574 6572 2063  hyperparameter c
+00019960: 6f6d 6269 6e61 7469 6f6e 2074 6861 7420  ombination that 
+00019970: 7969 656c 6465 6420 7468 6520 6869 6768  yielded the high
+00019980: 6573 7420 6d65 616e 2061 6363 7572 6163  est mean accurac
+00019990: 792e 0a0a 2020 2020 2020 2020 4966 2073  y...        If s
+000199a0: 6176 655f 7374 7564 7920 3d20 5472 7565  ave_study = True
+000199b0: 2c20 7468 6520 4f70 7475 6e61 2073 7475  , the Optuna stu
+000199c0: 6479 206f 626a 6563 7420 7769 6c6c 2061  dy object will a
+000199d0: 6c73 6f20 6265 2072 6574 7572 6e65 6420  lso be returned 
+000199e0: 6173 2074 6865 2074 6869 7264 206f 7574  as the third out
+000199f0: 7075 742e 0a20 2020 2020 2020 2054 6869  put..        Thi
+00019a00: 7320 6361 6e20 6265 2075 7365 6420 746f  s can be used to
+00019a10: 2070 6c6f 7420 7468 6520 6f70 7469 6d69   plot the optimi
+00019a20: 7a61 7469 6f6e 2072 6573 756c 7473 2c20  zation results, 
+00019a30: 7365 653a 2068 7474 7073 3a2f 2f6f 7074  see: https://opt
+00019a40: 756e 612e 7265 6164 7468 6564 6f63 732e  una.readthedocs.
+00019a50: 696f 2f65 6e2f 6c61 7465 7374 2f74 7574  io/en/latest/tut
+00019a60: 6f72 6961 6c2f 3130 5f6b 6579 5f66 6561  orial/10_key_fea
+00019a70: 7475 7265 732f 3030 355f 7669 7375 616c  tures/005_visual
+00019a80: 697a 6174 696f 6e2e 6874 6d6c 2373 7068  ization.html#sph
+00019a90: 782d 676c 722d 7475 746f 7269 616c 2d31  x-glr-tutorial-1
+00019aa0: 302d 6b65 792d 6665 6174 7572 6573 2d30  0-key-features-0
+00019ab0: 3035 2d76 6973 7561 6c69 7a61 7469 6f6e  05-visualization
+00019ac0: 2d70 790a 0a20 2020 2020 2020 203e 3e3e  -py..        >>>
+00019ad0: 2066 726f 6d20 6f70 7475 6e61 2e76 6973   from optuna.vis
+00019ae0: 7561 6c69 7a61 7469 6f6e 2e6d 6174 706c  ualization.matpl
+00019af0: 6f74 6c69 6220 696d 706f 7274 2070 6c6f  otlib import plo
+00019b00: 745f 636f 6e74 6f75 720a 2020 2020 2020  t_contour.      
+00019b10: 2020 3e3e 3e20 0a20 2020 2020 2020 203e    >>> .        >
+00019b20: 3e3e 206d 6f64 656c 2c20 7061 7261 6d73  >> model, params
+00019b30: 2c20 7374 7564 7920 3d20 6879 7065 725f  , study = hyper_
+00019b40: 6f70 7428 6461 7461 5f78 2c20 6461 7461  opt(data_x, data
+00019b50: 5f79 2c20 636c 663d 2772 6627 2c20 7361  _y, clf='rf', sa
+00019b60: 7665 5f73 7475 6479 3d54 7275 6529 200a  ve_study=True) .
+00019b70: 2020 2020 2020 2020 3e3e 3e20 706c 6f74          >>> plot
+00019b80: 5f63 6f6e 746f 7572 2873 7475 6479 290a  _contour(study).
+00019b90: 0a20 2020 2020 2020 2049 6620 636c 663d  .        If clf=
+00019ba0: 2761 6c65 786e 6574 2720 6f72 2061 6e79  'alexnet' or any
+00019bb0: 206f 6620 7468 6520 434e 4e20 6f70 7469   of the CNN opti
+00019bc0: 6f6e 732c 2074 6865 206d 6f64 656c 2069  ons, the model i
+00019bd0: 7320 6e6f 7420 7265 7475 726e 6564 2e0a  s not returned..
+00019be0: 2020 2020 2020 2020 0a20 2020 2041 7267          .    Arg
+00019bf0: 733a 0a20 2020 2020 2020 2064 6174 615f  s:.        data_
+00019c00: 7820 286e 6461 7272 6179 293a 2032 4420  x (ndarray): 2D 
+00019c10: 6172 7261 7920 6f66 2073 697a 6520 286e  array of size (n
+00019c20: 2078 206d 292c 2077 6865 7265 206e 2069   x m), where n i
+00019c30: 7320 7468 650a 2020 2020 2020 2020 2020  s the.          
+00019c40: 2020 6e75 6d62 6572 206f 6620 7361 6d70    number of samp
+00019c50: 6c65 732c 2061 6e64 206d 2074 6865 206e  les, and m the n
+00019c60: 756d 6265 7220 6f66 2066 6561 7475 7265  umber of feature
+00019c70: 732e 2049 6620 636c 663d 2761 6c65 786e  s. If clf='alexn
+00019c80: 6574 2720 6f72 2061 6e79 206f 6620 7468  et' or any of th
+00019c90: 6520 434e 4e20 6f70 7469 6f6e 732c 200a  e CNN options, .
+00019ca0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00019cb0: 7361 6d70 6c65 7320 666f 7220 7468 6520  samples for the 
+00019cc0: 6669 7273 7420 636c 6173 7320 7368 6f75  first class shou
+00019cd0: 6c64 2062 6520 7061 7373 6564 2c20 7768  ld be passed, wh
+00019ce0: 6963 6820 7769 6c6c 2061 7574 6f6d 6174  ich will automat
+00019cf0: 6963 616c 6c79 200a 2020 2020 2020 2020  ically .        
+00019d00: 2020 2020 6265 2061 7373 6967 6e65 6420      be assigned 
+00019d10: 7468 6520 706f 7369 7469 7665 206c 6162  the positive lab
+00019d20: 656c 2027 3127 2e0a 2020 2020 2020 2020  el '1'..        
+00019d30: 6461 7461 5f79 2028 6e64 6172 7261 792c  data_y (ndarray,
+00019d40: 2073 7472 293a 2031 4420 6172 7261 7920   str): 1D array 
+00019d50: 636f 6e74 6169 6e69 6e67 2074 6865 2063  containing the c
+00019d60: 6f72 7265 7370 6f6e 696e 6720 6c61 6265  orresponing labe
+00019d70: 6c73 2e20 4966 2063 6c66 3d27 616c 6578  ls. If clf='alex
+00019d80: 6e65 7427 206f 7220 616e 7920 6f66 2074  net' or any of t
+00019d90: 6865 2043 4e4e 206f 7074 696f 6e73 2c20  he CNN options, 
+00019da0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00019db0: 2073 616d 706c 6573 2066 6f72 2074 6865   samples for the
+00019dc0: 2073 6563 6f6e 6420 636c 6173 7320 7368   second class sh
+00019dd0: 6f75 6c64 2062 6520 7061 7373 6564 2c20  ould be passed, 
+00019de0: 7768 6963 6820 7769 6c6c 2061 7574 6f6d  which will autom
+00019df0: 6174 6963 616c 6c79 0a20 2020 2020 2020  atically.       
+00019e00: 2020 2020 2062 6520 6173 7369 676e 6564       be assigned
+00019e10: 2074 6865 206e 6567 6174 6976 6520 6c61   the negative la
+00019e20: 6265 6c20 2730 272e 0a20 2020 2020 2020  bel '0'..       
+00019e30: 2063 6c66 2028 7374 7229 3a20 5468 6520   clf (str): The 
+00019e40: 6d61 6368 696e 6520 6c65 6172 6e69 6e67  machine learning
+00019e50: 2063 6c61 7373 6966 6965 7220 746f 206f   classifier to o
+00019e60: 7074 696d 697a 652e 2043 616e 2065 6974  ptimize. Can eit
+00019e70: 6865 7220 6265 0a20 2020 2020 2020 2020  her be.         
+00019e80: 2020 2027 7266 2720 666f 7220 5261 6e64     'rf' for Rand
+00019e90: 6f6d 2046 6f72 6573 742c 2027 6e6e 2720  om Forest, 'nn' 
+00019ea0: 666f 7220 4e65 7572 616c 204e 6574 776f  for Neural Netwo
+00019eb0: 726b 2c20 2778 6762 2720 666f 7220 6558  rk, 'xgb' for eX
+00019ec0: 7472 656d 6520 4772 6164 6965 6e74 2042  treme Gradient B
+00019ed0: 6f6f 7374 696e 672c 0a20 2020 2020 2020  oosting,.       
+00019ee0: 2020 2020 206f 7220 2761 6c65 786e 6574       or 'alexnet
+00019ef0: 2720 6f72 2061 6e79 206f 6620 7468 6520  ' or any of the 
+00019f00: 434e 4e20 6f70 7469 6f6e 732c 2066 6f72  CNN options, for
+00019f10: 2043 6f6e 766f 6c75 7469 6f6e 616c 204e   Convolutional N
+00019f20: 6575 7261 6c20 4e65 7477 6f72 6b2e 2044  eural Network. D
+00019f30: 6566 6175 6c74 7320 746f 2027 7266 272e  efaults to 'rf'.
+00019f40: 0a20 2020 2020 2020 206e 5f69 7465 7220  .        n_iter 
+00019f50: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
+00019f60: 2054 6865 206d 6178 696d 756d 206e 756d   The maximum num
+00019f70: 6265 7220 6f66 2069 7465 7261 7469 6f6e  ber of iteration
+00019f80: 7320 746f 2070 6572 666f 726d 2064 7572  s to perform dur
+00019f90: 696e 6720 0a20 2020 2020 2020 2020 2020  ing .           
+00019fa0: 2074 6865 2068 7970 6572 7061 7261 6d65   the hyperparame
+00019fb0: 7465 7220 7365 6172 6368 2e20 4465 6661  ter search. Defa
+00019fc0: 756c 7473 2074 6f20 3235 2e0a 2020 2020  ults to 25..    
+00019fd0: 2020 2020 6f70 745f 6376 2028 696e 7429      opt_cv (int)
+00019fe0: 3a20 4372 6f73 732d 7661 6c69 6461 7469  : Cross-validati
+00019ff0: 6f6e 7320 746f 2070 6572 666f 726d 2077  ons to perform w
+0001a000: 6865 6e20 6173 7365 7369 6e67 2074 6865  hen assesing the
+0001a010: 2070 6572 666f 726d 616e 6365 2061 7420   performance at 
+0001a020: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
+0001a030: 2068 7970 6572 7061 7261 6d65 7465 7220   hyperparameter 
+0001a040: 6f70 7469 6d69 7a61 7469 6f6e 2074 7269  optimization tri
+0001a050: 616c 2e20 466f 7220 6578 616d 706c 652c  al. For example,
+0001a060: 2069 6620 6376 3d33 2c20 7468 656e 2065   if cv=3, then e
+0001a070: 6163 6820 6f70 7469 6d69 7a61 7469 6f6e  ach optimization
+0001a080: 2074 7269 616c 0a20 2020 2020 2020 2020   trial.         
+0001a090: 2020 2077 696c 6c20 6265 2061 7373 6573     will be asses
+0001a0a0: 7365 6420 6163 636f 7264 696e 6720 746f  sed according to
+0001a0b0: 2074 6865 2033 2d66 6f6c 6420 6372 6f73   the 3-fold cros
+0001a0c0: 7320 7661 6c69 6461 7469 6f6e 2061 6363  s validation acc
+0001a0d0: 7572 6163 792e 200a 2020 2020 2020 2020  uracy. .        
+0001a0e0: 2020 2020 4966 2063 6c66 3d27 7867 6227      If clf='xgb'
+0001a0f0: 2061 6e64 2074 6869 7320 7661 6c75 6520   and this value 
+0001a100: 6973 2073 6574 2062 6574 7765 656e 2030  is set between 0
+0001a110: 2061 6e64 2031 2c20 7468 6973 2073 6574   and 1, this set
+0001a120: 7320 7468 6520 7369 7a65 206f 6620 7468  s the size of th
+0001a130: 6520 7661 6c69 6461 7469 6f6e 2064 6174  e validation dat
+0001a140: 612c 200a 2020 2020 2020 2020 2020 2020  a, .            
+0001a150: 7768 6963 6820 7769 6c6c 2062 6520 6368  which will be ch
+0001a160: 6f73 656e 2072 616e 646f 6d6c 7920 6561  osen randomly ea
+0001a170: 6368 2074 7269 616c 2e20 5468 6973 2069  ch trial. This i
+0001a180: 7320 7573 6564 2074 6f20 656e 6162 6c65  s used to enable
+0001a190: 2061 6e20 6561 726c 7920 7374 6f70 7069   an early stoppi
+0001a1a0: 6e67 2063 616c 6c62 6163 6b20 7768 6963  ng callback whic
+0001a1b0: 6820 0a20 2020 2020 2020 2020 2020 2069  h .            i
+0001a1c0: 7320 6e6f 7420 706f 7373 6962 6c65 2077  s not possible w
+0001a1d0: 6974 6820 7468 6520 6372 6f73 732d 7661  ith the cross-va
+0001a1e0: 6c69 6461 7469 6f6e 206d 6574 686f 642e  lidation method.
+0001a1f0: 2044 6566 6175 6c74 7320 746f 2031 302e   Defaults to 10.
+0001a200: 200a 2020 2020 2020 2020 6c69 6d69 745f   .        limit_
+0001a210: 7365 6172 6368 2028 626f 6f6c 293a 2049  search (bool): I
+0001a220: 6620 5472 7565 2074 6865 206f 7074 696d  f True the optim
+0001a230: 697a 6174 696f 6e20 7365 6172 6368 2073  ization search s
+0001a240: 7061 6365 7320 7769 6c6c 2062 6520 6c69  paces will be li
+0001a250: 6d69 7465 642c 2066 6f72 2063 6f6d 7075  mited, for compu
+0001a260: 7461 7469 6f6e 616c 2061 6e64 2074 696d  tational and tim
+0001a270: 6520 7075 7270 6f73 6573 2e20 0a20 2020  e purposes. .   
+0001a280: 2020 2020 2020 2020 2054 6869 7320 6973           This is
+0001a290: 2065 7370 6563 6961 6c6c 7920 696d 706f   especially impo
+0001a2a0: 7274 616e 7420 6966 2074 756e 696e 6720  rtant if tuning 
+0001a2b0: 6120 434e 4e20 6d6f 6465 6c2c 2061 7320  a CNN model, as 
+0001a2c0: 6d65 6d6f 7279 2065 7272 6f72 7320 6361  memory errors ca
+0001a2d0: 6e20 6265 2065 6e63 6f75 6e74 6572 6564  n be encountered
+0001a2e0: 2e20 4465 6661 756c 7473 2074 6f20 5472  . Defaults to Tr
+0001a2f0: 7565 2e0a 2020 2020 2020 2020 6261 6c61  ue..        bala
+0001a300: 6e63 6520 2862 6f6f 6c2c 206f 7074 696f  nce (bool, optio
+0001a310: 6e61 6c29 3a20 4966 2054 7275 652c 2061  nal): If True, a
+0001a320: 2077 6569 6768 7473 2061 7272 6179 2077   weights array w
+0001a330: 696c 6c20 6265 2063 616c 6375 6c61 7465  ill be calculate
+0001a340: 6420 616e 6420 7573 6564 0a20 2020 2020  d and used.     
+0001a350: 2020 2020 2020 2077 6865 6e20 6669 7474         when fitt
+0001a360: 696e 6720 7468 6520 636c 6173 7369 6669  ing the classifi
+0001a370: 6572 2e20 5468 6973 2063 616e 2069 6d70  er. This can imp
+0001a380: 726f 7665 2063 6c61 7373 6966 6963 6174  rove classificat
+0001a390: 696f 6e20 7768 656e 2063 6c61 7373 6573  ion when classes
+0001a3a0: 0a20 2020 2020 2020 2020 2020 2061 7265  .            are
+0001a3b0: 2069 6d62 616c 616e 6365 642e 2054 6869   imbalanced. Thi
+0001a3c0: 7320 6973 206f 6e6c 7920 6170 706c 6965  s is only applie
+0001a3d0: 6420 6966 2074 6865 2063 6c61 7373 6966  d if the classif
+0001a3e0: 6963 6174 696f 6e20 6973 2061 2062 696e  ication is a bin
+0001a3f0: 6172 7920 7461 736b 2e20 0a20 2020 2020  ary task. .     
+0001a400: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+0001a410: 746f 2054 7275 652e 2049 6620 636c 663d  to True. If clf=
+0001a420: 2761 6c65 786e 6574 2720 6f72 2061 6e79  'alexnet' or any
+0001a430: 206f 6620 7468 6520 434e 4e20 6f70 7469   of the CNN opti
+0001a440: 6f6e 732c 2074 6869 7320 7769 6c6c 2064  ons, this will d
+0001a450: 6574 6572 6d69 6e65 2077 6865 7468 6572  etermine whether
+0001a460: 2074 6865 2074 776f 2063 6c61 7373 6573   the two classes
+0001a470: 0a20 2020 2020 2020 2020 2020 2061 7265  .            are
+0001a480: 206b 6570 7420 7468 6520 7361 6d65 2073   kept the same s
+0001a490: 697a 6520 6475 7269 6e67 206f 7074 696d  ize during optim
+0001a4a0: 697a 6174 696f 6e2c 2061 7070 6c69 6361  ization, applica
+0001a4b0: 626c 6520 6966 2074 756e 696e 6720 7468  ble if tuning th
+0001a4c0: 6520 6175 676d 656e 7461 7469 6f6e 0a20  e augmentation. 
+0001a4d0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0001a4e0: 6574 6572 732e 2044 6566 6175 6c74 7320  eters. Defaults 
+0001a4f0: 746f 2054 7275 652e 0a20 2020 2020 2020  to True..       
+0001a500: 2072 6574 7572 6e5f 7374 7564 7920 2862   return_study (b
+0001a510: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
+0001a520: 4966 2054 7275 6520 7468 6520 4f70 7475  If True the Optu
+0001a530: 6e61 2073 7475 6479 206f 626a 6563 7420  na study object 
+0001a540: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+0001a550: 2e20 5468 6973 0a20 2020 2020 2020 2020  . This.         
+0001a560: 2020 2063 616e 2062 6520 7573 6564 2074     can be used t
+0001a570: 6f20 7265 7669 6577 2074 6865 206d 6574  o review the met
+0001a580: 686f 6420 6174 7472 6962 7574 6573 2c20  hod attributes, 
+0001a590: 7375 6368 2061 7320 6f70 7469 6d69 7a61  such as optimiza
+0001a5a0: 7469 6f6e 2070 6c6f 7473 2e20 4465 6661  tion plots. Defa
+0001a5b0: 756c 7473 2074 6f20 5472 7565 2e0a 0a20  ults to True... 
+0001a5c0: 2020 2054 6865 2066 6f6c 6c6c 6f77 696e     The folllowin
+0001a5d0: 6720 6172 6775 6d65 6e74 7320 6172 6520  g arguments are 
+0001a5e0: 6f6e 6c79 2075 7365 6420 7768 656e 206f  only used when o
+0001a5f0: 7074 696d 697a 696e 6720 7468 6520 434e  ptimizing the CN
+0001a600: 4e20 6e65 7477 6f72 6b3a 0a0a 2020 2020  N network:..    
+0001a610: 4172 6773 3a0a 2020 2020 2020 2020 696d  Args:.        im
+0001a620: 675f 6e75 6d5f 6368 616e 6e65 6c73 2028  g_num_channels (
+0001a630: 696e 7429 3a20 5468 6520 6e75 6d62 6572  int): The number
+0001a640: 206f 6620 6669 6c74 6572 732e 2044 6566   of filters. Def
+0001a650: 6175 6c74 7320 746f 2031 2e0a 2020 2020  aults to 1..    
+0001a660: 2020 2020 6e6f 726d 616c 697a 6520 2862      normalize (b
+0001a670: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
+0001a680: 4966 2054 7275 6520 7468 6520 6461 7461  If True the data
+0001a690: 2077 696c 6c20 6265 206d 696e 2d6d 6178   will be min-max
+0001a6a0: 206e 6f72 6d61 6c69 7a65 6420 7573 696e   normalized usin
+0001a6b0: 6720 7468 6520 0a20 2020 2020 2020 2020  g the .         
+0001a6c0: 2020 2069 6e70 7574 206d 696e 2061 6e64     input min and
+0001a6d0: 206d 6178 2070 6978 656c 732e 2044 6566   max pixels. Def
+0001a6e0: 6175 6c74 7320 746f 2054 7275 652e 0a20  aults to True.. 
+0001a6f0: 2020 2020 2020 206d 696e 5f70 6978 656c         min_pixel
+0001a700: 2028 696e 742c 206f 7074 696f 6e61 6c29   (int, optional)
+0001a710: 3a20 5468 6520 6d69 6e69 6d75 6d20 7069  : The minimum pi
+0001a720: 7865 6c20 636f 756e 742c 2070 6978 656c  xel count, pixel
+0001a730: 7320 7769 7468 2063 6f75 6e74 7320 0a20  s with counts . 
+0001a740: 2020 2020 2020 2020 2020 2062 656c 6f77             below
+0001a750: 2074 6869 7320 7468 7265 7368 6f6c 6420   this threshold 
+0001a760: 7769 6c6c 2062 6520 7365 7420 746f 2074  will be set to t
+0001a770: 6869 7320 6c69 6d69 742e 2044 6566 6175  his limit. Defau
+0001a780: 6c74 7320 746f 2030 2e0a 2020 2020 2020  lts to 0..      
+0001a790: 2020 6d61 785f 7069 7865 6c20 2869 6e74    max_pixel (int
+0001a7a0: 2c20 6c69 7374 2c20 6f70 7469 6f6e 616c  , list, optional
+0001a7b0: 293a 2054 6865 206d 6178 696d 756d 2070  ): The maximum p
+0001a7c0: 6978 656c 2063 6f75 6e74 2c20 7069 7865  ixel count, pixe
+0001a7d0: 6c73 2077 6974 6820 636f 756e 7473 200a  ls with counts .
+0001a7e0: 2020 2020 2020 2020 2020 2020 6162 6f76              abov
+0001a7f0: 6520 7468 6973 2074 6872 6573 686f 6c64  e this threshold
+0001a800: 2077 696c 6c20 6265 2073 6574 2074 6f20   will be set to 
+0001a810: 7468 6973 206c 696d 6974 2e20 4465 6661  this limit. Defa
+0001a820: 756c 7473 2074 6f20 3130 302e 2049 6620  ults to 100. If 
+0001a830: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0001a840: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
+0001a850: 6e6f 7420 312c 2074 6865 206d 6178 5f70  not 1, the max_p
+0001a860: 6978 656c 2073 686f 756c 6420 6265 2061  ixel should be a
+0001a870: 206c 6973 7420 636f 6e74 6169 6e69 6e67   list containing
+0001a880: 2074 776f 2076 616c 7565 732c 206f 6e65   two values, one
+0001a890: 2066 6f72 2065 6163 6820 6261 6e64 2e0a   for each band..
+0001a8a0: 2020 2020 2020 2020 7661 6c5f 706f 7369          val_posi
+0001a8b0: 7469 7665 2028 6e64 6172 7261 792c 206f  tive (ndarray, o
+0001a8c0: 7074 696f 6e61 6c29 3a20 506f 7369 7469  ptional): Positi
+0001a8d0: 7665 2063 6c61 7373 2064 6174 6120 746f  ve class data to
+0001a8e0: 2062 6520 7573 6564 2066 6f72 2076 616c   be used for val
+0001a8f0: 6964 6174 696f 6e2e 2044 6566 6175 6c74  idation. Default
+0001a900: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
+0001a910: 2020 2076 616c 5f6e 6567 6174 6976 6520     val_negative 
+0001a920: 286e 6461 7272 6179 2c20 6f70 7469 6f6e  (ndarray, option
+0001a930: 616c 293a 204e 6567 6174 6976 6520 636c  al): Negative cl
+0001a940: 6173 7320 6461 7461 2074 6f20 6265 2075  ass data to be u
+0001a950: 7365 6420 666f 7220 7661 6c69 6461 7469  sed for validati
+0001a960: 6f6e 2e20 4465 6661 756c 7473 2074 6f20  on. Defaults to 
+0001a970: 4e6f 6e65 2e0a 2020 2020 2020 2020 7465  None..        te
+0001a980: 7374 5f70 6f73 6974 6976 6520 286e 6461  st_positive (nda
+0001a990: 7272 6179 2c20 6f70 7469 6f6e 616c 293a  rray, optional):
+0001a9a0: 2050 6f73 6974 6976 6520 636c 6173 7320   Positive class 
+0001a9b0: 6461 7461 2074 6f20 6265 2075 7365 6420  data to be used 
+0001a9c0: 666f 7220 706f 7374 2d74 7269 616c 2074  for post-trial t
+0001a9d0: 6573 7469 6e67 2e20 4465 6661 756c 7473  esting. Defaults
+0001a9e0: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+0001a9f0: 2020 7465 7374 5f6e 6567 6174 6976 6520    test_negative 
+0001aa00: 286e 6461 7272 6179 2c20 6f70 7469 6f6e  (ndarray, option
+0001aa10: 616c 293a 204e 6567 6174 6976 6520 636c  al): Negative cl
+0001aa20: 6173 7320 6461 7461 2074 6f20 6265 2075  ass data to be u
+0001aa30: 7365 6420 666f 7220 706f 7374 2d74 7269  sed for post-tri
+0001aa40: 616c 2074 6573 7469 6e67 2e20 4465 6661  al testing. Defa
+0001aa50: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
+0001aa60: 2020 2020 2020 7465 7374 5f61 6363 5f74        test_acc_t
+0001aa70: 6872 6573 686f 6c64 2028 666c 6f61 742c  hreshold (float,
+0001aa80: 206f 7074 696f 6e61 6c29 3a20 4966 2069   optional): If i
+0001aa90: 6e70 7574 2c20 6d6f 6465 6c73 2074 6861  nput, models tha
+0001aaa0: 7420 7969 656c 6420 7465 7374 2061 6363  t yield test acc
+0001aab0: 7572 6163 6965 7320 6c6f 7765 7220 7468  uracies lower th
+0001aac0: 616e 2074 6865 2074 6872 6573 686f 6c64  an the threshold
+0001aad0: 2077 696c 6c0a 2020 2020 2020 2020 2020   will.          
+0001aae0: 2020 6265 2072 656a 6563 7465 6420 6279    be rejected by
+0001aaf0: 2074 6865 206f 7074 696d 697a 6572 2e20   the optimizer. 
+0001ab00: 5468 6520 6163 6375 7261 6379 206f 6620  The accuracy of 
+0001ab10: 626f 7468 2074 6865 2074 6573 745f 706f  both the test_po
+0001ab20: 7369 7469 7665 2061 6e64 2074 6573 745f  sitive and test_
+0001ab30: 6e65 6761 7469 7665 2069 7320 6173 6573  negative is ases
+0001ab40: 7365 642c 2069 6620 696e 7075 742e 0a20  sed, if input.. 
+0001ab50: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+0001ab60: 6973 2075 7365 6420 746f 2072 656a 6563  is used to rejec
+0001ab70: 7420 6d6f 6465 6c73 2074 6861 7420 6861  t models that ha
+0001ab80: 7665 206f 7665 7220 6f72 2075 6e64 6572  ve over or under
+0001ab90: 2066 6974 2074 6865 2074 7261 696e 696e   fit the trainin
+0001aba0: 6720 6461 7461 2e20 4465 6661 756c 7473  g data. Defaults
+0001abb0: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+0001abc0: 2020 706f 7374 5f6d 6574 7269 6320 2862    post_metric (b
+0001abd0: 6f6f 6c29 3a20 4966 2054 7275 652c 2074  ool): If True, t
+0001abe0: 6865 2074 6573 745f 706f 7369 7469 7665  he test_positive
+0001abf0: 2061 6e64 2f6f 7220 7465 7374 5f6e 6567   and/or test_neg
+0001ac00: 6174 6976 6520 696e 7075 7473 2077 696c  ative inputs wil
+0001ac10: 6c20 6265 2069 6e63 6c75 6465 6420 696e  l be included in
+0001ac20: 2074 6865 2066 696e 616c 206f 7074 696d   the final optim
+0001ac30: 697a 6174 696f 6e20 7363 6f72 652e 0a20  ization score.. 
+0001ac40: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+0001ac50: 7769 6c6c 2062 6520 7468 6520 6176 6572  will be the aver
+0001ac60: 6167 6564 206f 7574 206d 6574 7269 632e  aged out metric.
+0001ac70: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
+0001ac80: 652e 2043 616e 2062 6520 7365 7420 746f  e. Can be set to
+0001ac90: 2046 616c 7365 2074 6f20 6f6e 6c79 2061   False to only a
+0001aca0: 7070 6c79 2074 6865 2074 6573 745f 6163  pply the test_ac
+0001acb0: 635f 7468 7265 7368 6f6c 642e 0a20 2020  c_threshold..   
+0001acc0: 2020 2020 2074 7261 696e 5f65 706f 6368       train_epoch
+0001acd0: 7320 2869 6e74 293a 204e 756d 6265 7220  s (int): Number 
+0001ace0: 6f66 2065 706f 6368 7320 746f 2074 6865  of epochs to the
+0001acf0: 2074 7261 696e 2074 6865 2043 4e4e 2074   train the CNN t
+0001ad00: 6f20 6475 7269 6e67 2074 6865 206f 7074  o during the opt
+0001ad10: 696d 697a 6174 696f 6e20 7472 6961 6c73  imization trials
+0001ad20: 2e20 4465 6661 756c 7473 2074 6f20 3235  . Defaults to 25
+0001ad30: 2e0a 2020 2020 2020 2020 6d65 7472 6963  ..        metric
+0001ad40: 2028 7374 7229 3a20 4173 7365 736d 656e   (str): Assesmen
+0001ad50: 7420 6d65 7472 6963 2074 6f20 7573 6520  t metric to use 
+0001ad60: 7768 656e 2062 6f74 6820 7072 756e 696e  when both prunin
+0001ad70: 6720 616e 6420 7363 6f72 696e 6720 7468  g and scoring th
+0001ad80: 6520 6879 7065 7270 6172 616d 6574 6572  e hyperparameter
+0001ad90: 206f 7074 696d 697a 6174 696f 6e20 7472   optimization tr
+0001ada0: 6961 6c2e 0a20 2020 2020 2020 2020 2020  ial..           
+0001adb0: 2044 6566 6175 6c74 7320 746f 2027 6c6f   Defaults to 'lo
+0001adc0: 7373 272e 204f 7074 696f 6e73 2069 6e63  ss'. Options inc
+0001add0: 6c75 6465 3a20 276c 6f73 7327 2027 6269  lude: 'loss' 'bi
+0001ade0: 6e61 7279 5f61 6363 7572 6163 7927 2c20  nary_accuracy', 
+0001adf0: 2766 315f 7363 6f72 6527 2027 616c 6c27  'f1_score' 'all'
+0001ae00: 206f 7220 7468 6520 7661 6c69 6461 7469   or the validati
+0001ae10: 6f6e 2065 7175 6976 616c 656e 7473 2028  on equivalents (
+0001ae20: 652e 672e 2027 7661 6c5f 6c6f 7373 2729  e.g. 'val_loss')
+0001ae30: 2e0a 2020 2020 2020 2020 7061 7469 656e  ..        patien
+0001ae40: 6365 2028 696e 7429 3a20 4e75 6d62 6572  ce (int): Number
+0001ae50: 206f 6620 6570 6f63 6873 2077 6974 686f   of epochs witho
+0001ae60: 7574 2069 6d70 726f 7665 6d65 6e74 2062  ut improvement b
+0001ae70: 6566 6f72 6520 7468 6520 6f70 7469 6d69  efore the optimi
+0001ae80: 7a61 7469 6f6e 2074 7269 616c 2069 7320  zation trial is 
+0001ae90: 7465 726d 696e 6174 6564 2e20 4465 6661  terminated. Defa
+0001aea0: 756c 7473 2074 6f20 302c 2077 6869 6368  ults to 0, which
+0001aeb0: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
+0001aec0: 6162 6c65 7320 7468 6973 2066 6561 7475  ables this featu
+0001aed0: 7265 2e0a 2020 2020 2020 2020 6176 6572  re..        aver
+0001aee0: 6167 6520 2862 6f6f 6c29 3a20 4966 2046  age (bool): If F
+0001aef0: 616c 7365 2c20 7468 6520 6465 7369 676e  alse, the design
+0001af00: 6174 6564 206d 6574 7269 6320 7769 6c6c  ated metric will
+0001af10: 2062 6520 6361 6c63 756c 6174 6564 2061   be calculated a
+0001af20: 6363 6f72 6469 6e67 2074 6f20 6974 7320  ccording to its 
+0001af30: 7661 6c75 6520 6174 2074 6865 2065 6e64  value at the end
+0001af40: 206f 6620 7468 6520 7472 6169 6e5f 6570   of the train_ep
+0001af50: 6f63 6873 2e20 0a20 2020 2020 2020 2020  ochs. .         
+0001af60: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
+0001af70: 6d65 7472 6963 2077 696c 6c20 6265 2061  metric will be a
+0001af80: 7665 7261 6765 6420 6f75 7420 6163 726f  veraged out acro
+0001af90: 7373 2061 6c6c 2074 7261 696e 5f65 706f  ss all train_epo
+0001afa0: 6368 732e 2044 6566 6175 6c74 7320 746f  chs. Defaults to
+0001afb0: 2054 7275 652e 0a20 2020 2020 2020 206f   True..        o
+0001afc0: 7074 5f6d 6f64 656c 2028 626f 6f6c 293a  pt_model (bool):
+0001afd0: 2049 6620 5472 7565 2c20 7468 6520 6172   If True, the ar
+0001afe0: 6368 6974 6563 7475 7265 2070 6172 616d  chitecture param
+0001aff0: 6574 6572 7320 7769 6c6c 2062 6520 6f70  eters will be op
+0001b000: 7469 6d69 7a65 642e 2044 6566 6175 6c74  timized. Default
+0001b010: 7320 746f 2054 7275 652e 0a20 2020 2020  s to True..     
+0001b020: 2020 206f 7074 5f61 7567 2028 626f 6f6c     opt_aug (bool
+0001b030: 293a 2049 6620 5472 7565 2c20 7468 6520  ): If True, the 
+0001b040: 6175 676d 656e 7461 7469 6f6e 2070 726f  augmentation pro
+0001b050: 6365 6475 7265 2077 696c 6c20 6265 206f  cedure will be o
+0001b060: 7074 696d 697a 6564 2e20 4465 6661 756c  ptimized. Defaul
+0001b070: 7473 2074 6f20 4661 6c73 652e 0a20 2020  ts to False..   
+0001b080: 2020 2020 2062 6174 6368 5f6d 696e 2028       batch_min (
+0001b090: 696e 7429 3a20 5468 6520 6d69 6e69 6d75  int): The minimu
+0001b0a0: 6d20 6e75 6d62 6572 206f 6620 6175 676d  m number of augm
+0001b0b0: 656e 7461 7469 6f6e 7320 746f 2070 6572  entations to per
+0001b0c0: 666f 726d 2070 6572 2069 6d61 6765 206f  form per image o
+0001b0d0: 6e20 7468 6520 706f 7369 7469 7665 2063  n the positive c
+0001b0e0: 6c61 7373 2c20 6f6e 6c79 2061 7070 6c69  lass, only appli
+0001b0f0: 6361 626c 6520 0a20 2020 2020 2020 2020  cable .         
+0001b100: 2020 2069 6620 6f70 745f 6175 673d 5472     if opt_aug=Tr
+0001b110: 7565 2e20 4465 6661 756c 7473 2074 6f20  ue. Defaults to 
+0001b120: 322e 0a20 2020 2020 2020 2062 6174 6368  2..        batch
+0001b130: 5f6d 6178 2028 696e 7429 3a20 5468 6520  _max (int): The 
+0001b140: 6d61 7869 6d75 6d20 6e75 6d62 6572 206f  maximum number o
+0001b150: 6620 6175 676d 656e 7461 7469 6f6e 7320  f augmentations 
+0001b160: 746f 2070 6572 666f 726d 2070 6572 2069  to perform per i
+0001b170: 6d61 6765 206f 6e20 7468 6520 706f 7369  mage on the posi
+0001b180: 7469 7665 2063 6c61 7373 2c20 6f6e 6c79  tive class, only
+0001b190: 2061 7070 6c69 6361 626c 6520 0a20 2020   applicable .   
+0001b1a0: 2020 2020 2020 2020 2069 6620 6f70 745f           if opt_
+0001b1b0: 6175 673d 5472 7565 2e20 4465 6661 756c  aug=True. Defaul
+0001b1c0: 7473 2074 6f20 3235 2e0a 2020 2020 2020  ts to 25..      
+0001b1d0: 2020 6261 7463 685f 6f74 6865 7220 2869    batch_other (i
+0001b1e0: 6e74 293a 2054 6865 206e 756d 6265 7220  nt): The number 
+0001b1f0: 6f66 2061 7567 6d65 6e74 6174 696f 6e73  of augmentations
+0001b200: 2074 6f20 7065 7266 6f72 6d20 746f 2074   to perform to t
+0001b210: 6865 206f 7468 6572 2063 6c61 7373 2c20  he other class, 
+0001b220: 7072 6573 756d 6564 2074 6f20 6265 2074  presumed to be t
+0001b230: 6865 206d 616a 6f72 6974 7920 636c 6173  he majority clas
+0001b240: 732e 0a20 2020 2020 2020 2020 2020 2044  s..            D
+0001b250: 6566 6175 6c74 7320 746f 2031 2e20 5468  efaults to 1. Th
+0001b260: 6973 2069 7320 646f 6e65 2074 6f20 656e  is is done to en
+0001b270: 7375 7265 2061 7567 6d65 6e74 6174 696f  sure augmentatio
+0001b280: 6e20 7465 6368 6e69 7175 6573 2061 7265  n techniques are
+0001b290: 2061 7070 6c69 6564 2063 6f6e 7369 7374   applied consist
+0001b2a0: 656e 746c 7920 6163 726f 7373 2062 6f74  ently across bot
+0001b2b0: 6820 636c 6173 7365 732e 2020 2020 2020  h classes.      
+0001b2c0: 2020 0a20 2020 2020 2020 2069 6d61 6765    .        image
+0001b2d0: 5f73 697a 655f 6d69 6e20 2869 6e74 293a  _size_min (int):
+0001b2e0: 2054 6865 206d 696e 696d 756d 2069 6d61   The minimum ima
+0001b2f0: 6765 2073 697a 6520 746f 2061 7373 6573  ge size to asses
+0001b300: 732c 206f 6e6c 7920 6170 706c 6963 6162  s, only applicab
+0001b310: 6c65 2069 6620 6f70 745f 6175 673d 5472  le if opt_aug=Tr
+0001b320: 7565 2e20 4465 6661 756c 7473 2074 6f20  ue. Defaults to 
+0001b330: 3530 2e0a 2020 2020 2020 2020 696d 6167  50..        imag
+0001b340: 655f 7369 7a65 5f6d 6178 2028 696e 7429  e_size_max (int)
+0001b350: 3a20 5468 6520 6d61 7869 6d75 6d20 696d  : The maximum im
+0001b360: 6167 6520 7369 7a65 2074 6f20 6173 7365  age size to asse
+0001b370: 7373 2c20 6f6e 6c79 2061 7070 6c69 6361  ss, only applica
+0001b380: 626c 6520 6966 206f 7074 5f61 7567 3d54  ble if opt_aug=T
+0001b390: 7275 652e 2044 6566 6175 6c74 7320 746f  rue. Defaults to
+0001b3a0: 2031 3030 2e0a 2020 2020 2020 2020 6f70   100..        op
+0001b3b0: 745f 6d61 785f 6d69 6e5f 7069 7820 2869  t_max_min_pix (i
+0001b3c0: 6e74 2c20 6f70 7469 6f6e 616c 293a 2054  nt, optional): T
+0001b3d0: 6865 206d 696e 696d 756d 206d 6178 2070  he minimum max p
+0001b3e0: 6978 656c 2076 616c 7565 2074 6f20 7573  ixel value to us
+0001b3f0: 6520 7768 656e 2074 756e 696e 6720 7468  e when tuning th
+0001b400: 6520 6e6f 726d 616c 697a 6174 696f 6e20  e normalization 
+0001b410: 7072 6f63 6564 7572 652c 200a 2020 2020  procedure, .    
+0001b420: 2020 2020 2020 2020 6f6e 6c79 2061 7070          only app
+0001b430: 6c69 6361 626c 6520 6966 206f 7074 5f61  licable if opt_a
+0001b440: 7567 3d54 7275 652e 2044 6566 6175 6c74  ug=True. Default
+0001b450: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
+0001b460: 2020 206f 7074 5f6d 6178 5f6d 6178 5f70     opt_max_max_p
+0001b470: 6978 2028 696e 742c 206f 7074 696f 6e61  ix (int, optiona
+0001b480: 6c29 3a20 5468 6520 6d61 7869 6d75 6d20  l): The maximum 
+0001b490: 6d61 7820 7069 7865 6c20 7661 6c75 6520  max pixel value 
+0001b4a0: 746f 2075 7365 2077 6865 6e20 7475 6e69  to use when tuni
+0001b4b0: 6e67 2074 6865 206e 6f72 6d61 6c69 7a61  ng the normaliza
+0001b4c0: 7469 6f6e 2070 726f 6365 6475 7265 2c20  tion procedure, 
+0001b4d0: 0a20 2020 2020 2020 2020 2020 206f 6e6c  .            onl
+0001b4e0: 7920 6170 706c 6963 6162 6c65 2069 6620  y applicable if 
+0001b4f0: 6f70 745f 6175 673d 5472 7565 2e20 4465  opt_aug=True. De
+0001b500: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
+0001b510: 2020 2020 2020 2020 7368 6966 7420 2869          shift (i
+0001b520: 6e74 293a 2054 6865 206d 6178 2061 6c6c  nt): The max all
+0001b530: 6f77 6564 2076 6572 7469 6361 6c2f 686f  owed vertical/ho
+0001b540: 7269 7a6f 6e74 616c 2073 6869 6674 7320  rizontal shifts 
+0001b550: 746f 2075 7365 2064 7572 696e 6720 7468  to use during th
+0001b560: 6520 6461 7461 2061 7567 6d65 6e74 6174  e data augmentat
+0001b570: 696f 6e20 726f 7574 696e 652c 206f 6e6c  ion routine, onl
+0001b580: 7920 6170 706c 6963 6162 6c65 0a20 2020  y applicable.   
+0001b590: 2020 2020 2020 2020 2069 6620 6f70 745f           if opt_
+0001b5a0: 6175 673d 5472 7565 2e20 4465 6661 756c  aug=True. Defaul
+0001b5b0: 7473 2074 6f20 3130 2070 6978 656c 732e  ts to 10 pixels.
+0001b5c0: 0a20 2020 2020 2020 206d 6173 6b5f 7369  .        mask_si
+0001b5d0: 7a65 2028 696e 742c 206f 7074 696f 6e61  ze (int, optiona
+0001b5e0: 6c29 3a20 4966 2065 6e61 626c 6564 2c20  l): If enabled, 
+0001b5f0: 7468 6973 2077 696c 6c20 7365 7420 7468  this will set th
+0001b600: 6520 7069 7865 6c20 6c65 6e67 7468 206f  e pixel length o
+0001b610: 6620 6120 7371 7561 7265 2063 7574 6f75  f a square cutou
+0001b620: 742c 2074 6f20 6265 2072 616e 646f 6d6c  t, to be randoml
+0001b630: 7920 706c 6163 6564 0a20 2020 2020 2020  y placed.       
+0001b640: 2020 2020 2073 6f6d 6577 6865 7265 2069       somewhere i
+0001b650: 6e20 7468 6520 6175 676d 656e 7465 6420  n the augmented 
+0001b660: 696d 6167 652e 2054 6869 7320 6375 746f  image. This cuto
+0001b670: 7574 2077 696c 6c20 7265 706c 6163 6520  ut will replace 
+0001b680: 7468 6520 696d 6167 6520 7661 6c75 6573  the image values
+0001b690: 2077 6974 6820 302c 2074 6865 7265 666f   with 0, therefo
+0001b6a0: 7265 2073 6572 7669 6e67 2061 7320 6120  re serving as a 
+0001b6b0: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
+0001b6c0: 756c 6172 697a 6572 2e20 4f6e 6c79 2061  ularizer. Only a
+0001b6d0: 7070 6c69 6361 626c 6520 6966 206f 7074  pplicable if opt
+0001b6e0: 5f61 7567 3d54 7275 652e 2054 6869 7320  _aug=True. This 
+0001b6f0: 7661 6c75 6520 6361 6e20 6569 7468 6572  value can either
+0001b700: 2062 6520 616e 2069 6e74 6567 6572 2074   be an integer t
+0001b710: 6f20 6861 7264 2d73 6574 2074 6865 206d  o hard-set the m
+0001b720: 6173 6b20 7369 7a65 2065 7665 7279 7469  ask size everyti
+0001b730: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+0001b740: 6f72 2063 616e 2062 6520 6120 7475 706c  or can be a tupl
+0001b750: 6520 7265 7072 6573 656e 7469 6e67 2074  e representing t
+0001b760: 6865 206c 6f77 6572 2061 6e64 2075 7070  he lower and upp
+0001b770: 6572 2062 6f75 6e64 732c 2072 6573 7065  er bounds, respe
+0001b780: 6374 6976 656c 792c 2069 6e20 7768 6963  ctively, in whic
+0001b790: 6820 6361 7365 2074 6865 206d 6173 6b20  h case the mask 
+0001b7a0: 7369 7a65 2077 696c 6c20 6265 206f 7074  size will be opt
+0001b7b0: 696d 697a 6564 2e20 0a20 2020 2020 2020  imized. .       
+0001b7c0: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
+0001b7d0: 204e 6f6e 652e 0a20 2020 2020 2020 206e   None..        n
+0001b7e0: 756d 5f6d 6173 6b73 2028 696e 742c 206f  um_masks (int, o
+0001b7f0: 7074 696f 6e61 6c29 3a20 5468 6520 6e75  ptional): The nu
+0001b800: 6d62 6572 206f 6620 6d61 736b 7320 746f  mber of masks to
+0001b810: 2063 7265 6174 652c 2074 6f20 6265 2075   create, to be u
+0001b820: 7365 6420 616c 6f6e 6773 6964 6520 7468  sed alongside th
+0001b830: 6520 6d61 736b 5f73 697a 6520 7061 7261  e mask_size para
+0001b840: 6d65 7465 722e 204e 6f74 6520 7468 6174  meter. Note that
+0001b850: 2069 6620 0a20 2020 2020 2020 2020 2020   if .           
+0001b860: 2074 6869 7320 6973 2073 6574 2074 6f20   this is set to 
+0001b870: 6120 7661 6c75 6520 6772 6561 7465 7220  a value greater 
+0001b880: 7468 616e 206f 6e65 2c20 6f76 6572 6c61  than one, overla
+0001b890: 7020 6d61 7920 6f63 6375 722e 2054 6869  p may occur. Thi
+0001b8a0: 7320 7661 6c75 6520 6361 6e20 6569 7468  s value can eith
+0001b8b0: 6572 2062 6520 616e 2069 6e74 6567 6572  er be an integer
+0001b8c0: 2074 6f20 6861 7264 2d73 6574 2074 6865   to hard-set the
+0001b8d0: 206e 756d 6265 720a 2020 2020 2020 2020   number.        
+0001b8e0: 2020 2020 6f66 206d 6173 6b73 2065 7665      of masks eve
+0001b8f0: 7279 7469 6d65 2c20 6f72 2069 7420 6361  rytime, or it ca
+0001b900: 6e20 6265 2061 2074 7570 6c65 2072 6570  n be a tuple rep
+0001b910: 7265 7365 6e74 696e 6720 7468 6520 6c6f  resenting the lo
+0001b920: 7765 7220 616e 6420 7570 7065 7220 626f  wer and upper bo
+0001b930: 756e 6473 2c20 7265 7370 6563 7469 7665  unds, respective
+0001b940: 6c79 2c20 696e 2077 6869 6368 2063 6173  ly, in which cas
+0001b950: 6520 7468 6520 6e75 6d62 6572 0a20 2020  e the number.   
+0001b960: 2020 2020 2020 2020 206f 6620 6d61 736b           of mask
+0001b970: 7320 7769 6c6c 2062 6520 6f70 7469 6d69  s will be optimi
+0001b980: 7a65 642e 2044 6566 6175 6c74 7320 746f  zed. Defaults to
+0001b990: 204e 6f6e 652e 0a20 2020 2020 2020 2076   None..        v
+0001b9a0: 6572 626f 7365 2028 696e 7429 3a20 436f  erbose (int): Co
+0001b9b0: 6e74 726f 6c73 2074 6865 2061 6d6f 756e  ntrols the amoun
+0001b9c0: 7420 6f66 206f 7574 7075 7420 7072 696e  t of output prin
+0001b9d0: 7465 6420 6475 7269 6e67 2074 6865 2074  ted during the t
+0001b9e0: 7261 696e 696e 6720 7072 6f63 6573 732e  raining process.
+0001b9f0: 2041 2076 616c 7565 206f 6620 3020 6973   A value of 0 is
+0001ba00: 2066 6f72 2073 696c 656e 7420 6d6f 6465   for silent mode
+0001ba10: 2c20 0a20 2020 2020 2020 2020 2020 2061  , .            a
+0001ba20: 2076 616c 7565 206f 6620 3120 6973 2075   value of 1 is u
+0001ba30: 7365 6420 666f 7220 7072 6f67 7265 7373  sed for progress
+0001ba40: 2062 6172 206d 6f64 652c 2061 6e64 2032   bar mode, and 2
+0001ba50: 2066 6f72 206f 6e65 206c 696e 6520 7065   for one line pe
+0001ba60: 7220 6570 6f63 6820 6d6f 6465 2e20 4465  r epoch mode. De
+0001ba70: 6661 756c 7473 2074 6f20 312e 0a20 2020  faults to 1..   
+0001ba80: 2020 2020 2073 6d6f 7465 5f73 616d 706c       smote_sampl
+0001ba90: 696e 6720 2866 6c6f 6174 293a 2054 6865  ing (float): The
+0001baa0: 2073 6d6f 7465 5f73 616d 706c 696e 6720   smote_sampling 
+0001bab0: 7061 7261 6d65 7465 7220 6973 2075 7365  parameter is use
+0001bac0: 6420 696e 2074 6865 2053 4d4f 5445 2061  d in the SMOTE a
+0001bad0: 6c67 6f72 6974 686d 2074 6f20 7370 6563  lgorithm to spec
+0001bae0: 6966 7920 7468 6520 6465 7369 7265 6420  ify the desired 
+0001baf0: 0a20 2020 2020 2020 2020 2020 2072 6174  .            rat
+0001bb00: 696f 206f 6620 7468 6520 6d69 6e6f 7269  io of the minori
+0001bb10: 7479 2063 6c61 7373 2074 6f20 7468 6520  ty class to the 
+0001bb20: 6d61 6a6f 7269 7479 2063 6c61 7373 2e20  majority class. 
+0001bb30: 4465 6661 756c 7473 2074 6f20 3020 7768  Defaults to 0 wh
+0001bb40: 6963 6820 6469 7361 626c 6573 2074 6865  ich disables the
+0001bb50: 2070 726f 6365 6475 7265 2e0a 2020 2020   procedure..    
+0001bb60: 2020 2020 7361 7665 5f6d 6f64 656c 7320      save_models 
+0001bb70: 2862 6f6f 6c29 3a20 5768 6574 6865 7220  (bool): Whether 
+0001bb80: 746f 2073 6176 6520 746f 206d 6f64 656c  to save to model
+0001bb90: 7320 6166 7465 7220 6561 6368 204f 7074  s after each Opt
+0001bba0: 756e 6120 7472 6961 6c2e 204e 6f74 6520  una trial. Note 
+0001bbb0: 7468 6174 2074 6869 7320 7361 7665 7320  that this saves 
+0001bbc0: 616c 6c20 6d6f 6465 6c73 2c20 6e6f 740a  all models, not.
+0001bbd0: 2020 2020 2020 2020 2020 2020 6a75 7374              just
+0001bbe0: 2074 6865 2062 6573 7420 6f6e 652e 2044   the best one. D
+0001bbf0: 6566 6175 6c74 7320 746f 2046 616c 7365  efaults to False
+0001bc00: 2e0a 2020 2020 2020 2020 7361 7665 5f73  ..        save_s
+0001bc10: 7475 6469 6573 2028 626f 6f6c 293a 2057  tudies (bool): W
+0001bc20: 6865 6874 6572 2074 6f20 7361 7665 2074  hehter to save t
+0001bc30: 6865 2073 7475 6479 206f 626a 6563 7420  he study object 
+0001bc40: 6372 6561 7465 6420 6279 204f 7074 756e  created by Optun
+0001bc50: 612e 2049 6620 7365 7420 746f 2054 7275  a. If set to Tru
+0001bc60: 652c 2074 6869 7320 7374 7564 7920 6f62  e, this study ob
+0001bc70: 6a65 6374 2077 696c 6c20 6265 0a20 2020  ject will be.   
+0001bc80: 2020 2020 2020 2020 2073 6176 6564 2061           saved a
+0001bc90: 6e64 206f 7665 7277 7269 7474 6564 2061  nd overwritted a
+0001bca0: 6674 6572 2065 6163 6820 7472 6961 6c2e  fter each trial.
+0001bcb0: 2044 6566 6175 6c74 7320 746f 2046 616c   Defaults to Fal
+0001bcc0: 7365 2e0a 2020 2020 2020 2020 7061 7468  se..        path
+0001bcd0: 2028 7374 7229 3a20 4162 736f 6c75 7465   (str): Absolute
+0001bce0: 2070 6174 6820 7768 6572 6520 7468 6520   path where the 
+0001bcf0: 6d6f 6465 6c73 2061 6e64 2073 7475 6479  models and study
+0001bd00: 206f 626a 6563 7420 7769 6c6c 2062 6520   object will be 
+0001bd10: 7361 7665 642e 2044 6566 6175 6c74 7320  saved. Defaults 
+0001bd20: 746f 204e 6f6e 652c 2077 6869 6368 2073  to None, which s
+0001bd30: 6176 6573 2074 6865 206d 6f64 656c 7320  aves the models 
+0001bd40: 616e 6420 7374 7564 790a 2020 2020 2020  and study.      
+0001bd50: 2020 2020 2020 696e 2074 6865 2068 6f6d        in the hom
+0001bd60: 6520 6469 7265 6374 6f72 792e 0a0a 2020  e directory...  
+0001bd70: 2020 5468 6520 666f 6c6c 6c6f 7769 6e67    The folllowing
+0001bd80: 2061 7267 756d 656e 7473 2063 616e 2062   arguments can b
+0001bd90: 6520 7573 6564 2074 6f20 7365 7420 6561  e used to set ea
+0001bda0: 726c 792d 7374 6f70 7069 6e67 2063 616c  rly-stopping cal
+0001bdb0: 6c62 6163 6b73 2e20 5468 6573 6520 6361  lbacks. These ca
+0001bdc0: 6e20 6265 2075 7365 6420 746f 2074 6572  n be used to ter
+0001bdd0: 6d69 6e61 7465 2074 7269 616c 7320 7468  minate trials th
+0001bde0: 6174 2065 7863 6565 640a 2020 2020 7072  at exceed.    pr
+0001bdf0: 652d 6465 7465 726d 696e 6564 2074 6872  e-determined thr
+0001be00: 6573 686f 6c64 732c 2077 6869 6368 206d  esholds, which m
+0001be10: 6179 2062 6520 696e 6469 6361 7469 7665  ay be indicative
+0001be20: 206f 6620 616e 206f 7665 7266 6974 206d   of an overfit m
+0001be30: 6f64 656c 2e0a 0a20 2020 2041 7267 733a  odel...    Args:
+0001be40: 0a20 2020 2020 2020 206d 6f6e 6974 6f72  .        monitor
+0001be50: 3120 2873 7472 2c20 6f70 7469 6f6e 616c  1 (str, optional
+0001be60: 293a 2054 6865 2066 6972 7374 206d 6574  ): The first met
+0001be70: 7269 6320 746f 206d 6f6e 6974 6f72 2c20  ric to monitor, 
+0001be80: 6361 6e20 7461 6b65 2074 6865 2073 616d  can take the sam
+0001be90: 6520 7661 6c75 6573 2061 7320 7468 6520  e values as the 
+0001bea0: 6d65 7472 6963 2061 7267 756d 656e 742e  metric argument.
+0001beb0: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
+0001bec0: 652e 0a20 2020 2020 2020 206d 6f6e 6974  e..        monit
+0001bed0: 6f72 3220 2873 7472 2c20 6f70 7469 6f6e  or2 (str, option
+0001bee0: 616c 293a 2054 6865 2073 6563 6f6e 6420  al): The second 
+0001bef0: 6d65 7472 6963 2074 6f20 6d6f 6e69 746f  metric to monito
+0001bf00: 722c 2063 616e 2074 616b 6520 7468 6520  r, can take the 
+0001bf10: 7361 6d65 2076 616c 7565 7320 6173 2074  same values as t
+0001bf20: 6865 206d 6574 7269 6320 6172 6775 6d65  he metric argume
+0001bf30: 6e74 2e20 4465 6661 756c 7473 2074 6f20  nt. Defaults to 
+0001bf40: 4e6f 6e65 2e0a 2020 2020 2020 2020 6d6f  None..        mo
+0001bf50: 6e69 746f 7231 5f74 6872 6573 6820 2866  nitor1_thresh (f
+0001bf60: 6c6f 6174 2c20 6f70 7469 6f6e 616c 293a  loat, optional):
+0001bf70: 2054 6865 2074 6872 6573 686f 6c64 2076   The threshold v
+0001bf80: 616c 7565 206f 6620 7468 6520 6669 7273  alue of the firs
+0001bf90: 7420 6d6f 6e69 746f 7220 6d65 7472 6963  t monitor metric
+0001bfa0: 2e20 4966 2074 6865 206d 6574 7269 6320  . If the metric 
+0001bfb0: 6973 206c 6f73 732d 7265 6c61 7465 640a  is loss-related.
+0001bfc0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+0001bfd0: 7472 6169 6e69 6e67 2077 696c 6c20 7374  training will st
+0001bfe0: 6f70 2065 6172 6c79 2069 6620 7468 6520  op early if the 
+0001bff0: 7661 6c75 6520 6661 6c6c 7320 6265 6c6f  value falls belo
+0001c000: 7720 7468 6973 2074 6872 6573 686f 6c64  w this threshold
+0001c010: 2e20 5369 6d69 6c61 726c 792c 2069 6620  . Similarly, if 
+0001c020: 7468 6520 6d65 7472 6963 2069 7320 6163  the metric is ac
+0001c030: 6375 7261 6379 2d72 656c 6174 6564 2c0a  curacy-related,.
+0001c040: 2020 2020 2020 2020 2020 2020 7468 656e              then
+0001c050: 2074 6865 2074 7261 696e 696e 6720 7769   the training wi
+0001c060: 6c6c 2073 746f 7020 6561 726c 7920 6966  ll stop early if
+0001c070: 2074 6865 2076 616c 7565 2066 616c 6c73   the value falls
+0001c080: 2061 626f 7665 2074 6869 7320 7468 7265   above this thre
+0001c090: 7368 6f6c 642e 2044 6566 6175 6c74 7320  shold. Defaults 
+0001c0a0: 746f 204e 6f6e 652e 0a20 2020 2020 2020  to None..       
+0001c0b0: 206d 6f6e 6974 6f72 325f 7468 7265 7368   monitor2_thresh
+0001c0c0: 2028 666c 6f61 742c 206f 7074 696f 6e61   (float, optiona
+0001c0d0: 6c29 3a20 5468 6520 7468 7265 7368 6f6c  l): The threshol
+0001c0e0: 6420 7661 6c75 6520 6f66 2074 6865 2073  d value of the s
+0001c0f0: 6563 6f6e 6420 6d6f 6e69 746f 7220 6d65  econd monitor me
+0001c100: 7472 6963 2e20 4966 2074 6865 206d 6574  tric. If the met
+0001c110: 7269 6320 6973 206c 6f73 732d 7265 6c61  ric is loss-rela
+0001c120: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
+0001c130: 7468 6520 7472 6169 6e69 6e67 2077 696c  the training wil
+0001c140: 6c20 7374 6f70 2065 6172 6c79 2069 6620  l stop early if 
+0001c150: 7468 6520 7661 6c75 6520 6661 6c6c 7320  the value falls 
+0001c160: 6265 6c6f 7720 7468 6973 2074 6872 6573  below this thres
+0001c170: 686f 6c64 2e20 5369 6d69 6c61 726c 792c  hold. Similarly,
+0001c180: 2069 6620 7468 6520 6d65 7472 6963 2069   if the metric i
+0001c190: 7320 6163 6375 7261 6379 2d72 656c 6174  s accuracy-relat
+0001c1a0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+0001c1b0: 7468 656e 2074 6865 2074 7261 696e 696e  then the trainin
+0001c1c0: 6720 7769 6c6c 2073 746f 7020 6561 726c  g will stop earl
+0001c1d0: 7920 6966 2074 6865 2076 616c 7565 2066  y if the value f
+0001c1e0: 616c 6c73 2061 626f 7665 2074 6869 7320  alls above this 
+0001c1f0: 7468 7265 7368 6f6c 642e 2044 6566 6175  threshold. Defau
+0001c200: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
+0001c210: 2020 2020 200a 2020 2020 5265 7475 726e       .    Return
+0001c220: 733a 0a20 2020 2020 2020 2054 6865 2066  s:.        The f
+0001c230: 6972 7374 206f 7574 7075 7420 6973 2074  irst output is t
+0001c240: 6865 2063 6c61 7373 6966 6965 7220 7769  he classifier wi
+0001c250: 7468 2074 6865 206f 7074 696d 616c 2068  th the optimal h
+0001c260: 7970 6572 7061 7261 6d65 7465 7273 2e0a  yperparameters..
+0001c270: 2020 2020 2020 2020 5365 636f 6e64 206f          Second o
+0001c280: 7574 7075 7420 6973 2061 2064 6963 7469  utput is a dicti
+0001c290: 6f6e 6172 7920 636f 6e74 6169 6e69 6e67  onary containing
+0001c2a0: 2074 6865 206f 7074 696d 616c 2068 7970   the optimal hyp
+0001c2b0: 6572 7061 7261 6d65 7465 7273 2e0a 2020  erparameters..  
+0001c2c0: 2020 2020 2020 4966 2073 6176 655f 7374        If save_st
+0001c2d0: 7564 793d 5472 7565 2c20 7468 6520 4f70  udy=True, the Op
+0001c2e0: 7475 6e61 2073 7475 6479 206f 626a 6563  tuna study objec
+0001c2f0: 7420 7769 6c6c 2062 6520 7468 6520 7468  t will be the th
+0001c300: 6972 6420 6f75 7470 7574 2e0a 2020 2020  ird output..    
+0001c310: 2222 220a 0a20 2020 2069 6620 636c 6620  """..    if clf 
+0001c320: 3d3d 2027 7266 273a 0a20 2020 2020 2020  == 'rf':.       
+0001c330: 206d 6f64 656c 5f30 203d 2052 616e 646f   model_0 = Rando
+0001c340: 6d46 6f72 6573 7443 6c61 7373 6966 6965  mForestClassifie
+0001c350: 7228 7261 6e64 6f6d 5f73 7461 7465 3d31  r(random_state=1
+0001c360: 3930 3929 0a20 2020 2065 6c69 6620 636c  909).    elif cl
+0001c370: 6620 3d3d 2027 6e6e 273a 0a20 2020 2020  f == 'nn':.     
+0001c380: 2020 206d 6f64 656c 5f30 203d 204d 4c50     model_0 = MLP
+0001c390: 436c 6173 7369 6669 6572 2872 616e 646f  Classifier(rando
+0001c3a0: 6d5f 7374 6174 653d 3139 3039 290a 2020  m_state=1909).  
+0001c3b0: 2020 656c 6966 2063 6c66 203d 3d20 2778    elif clf == 'x
+0001c3c0: 6762 273a 0a20 2020 2020 2020 206d 6f64  gb':.        mod
+0001c3d0: 656c 5f30 203d 2058 4742 436c 6173 7369  el_0 = XGBClassi
+0001c3e0: 6669 6572 2872 616e 646f 6d5f 7374 6174  fier(random_stat
+0001c3f0: 653d 3139 3039 290a 2020 2020 2020 2020  e=1909).        
+0001c400: 6966 2061 6c6c 2869 7369 6e73 7461 6e63  if all(isinstanc
+0001c410: 6528 7661 6c2c 2028 696e 742c 2073 7472  e(val, (int, str
+0001c420: 2929 2066 6f72 2076 616c 2069 6e20 6461  )) for val in da
+0001c430: 7461 5f79 293a 0a20 2020 2020 2020 2020  ta_y):.         
+0001c440: 2020 2070 7269 6e74 2827 5847 426f 6f73     print('XGBoos
+0001c450: 7420 636c 6173 7369 6669 6572 2072 6571  t classifier req
+0001c460: 7569 7265 7320 6e75 6d65 7269 6361 6c20  uires numerical 
+0001c470: 636c 6173 7320 6c61 6265 6c73 2120 436f  class labels! Co
+0001c480: 6e76 6572 7469 6e67 2063 6c61 7373 206c  nverting class l
+0001c490: 6162 656c 7320 6173 2066 6f6c 6c6f 7773  abels as follows
+0001c4a0: 3a27 290a 2020 2020 2020 2020 2020 2020  :').            
+0001c4b0: 7072 696e 7428 275f 5f5f 5f5f 5f5f 5f5f  print('_________
+0001c4c0: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________
+0001c4d0: 5f5f 5f5f 5f5f 5f5f 5f5f 5f27 290a 2020  ___________').  
+0001c4e0: 2020 2020 2020 2020 2020 7920 3d20 6e70            y = np
+0001c4f0: 2e7a 6572 6f73 286c 656e 2864 6174 615f  .zeros(len(data_
+0001c500: 7929 290a 2020 2020 2020 2020 2020 2020  y)).            
+0001c510: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+0001c520: 656e 286e 702e 756e 6971 7565 2864 6174  en(np.unique(dat
+0001c530: 615f 7929 2929 3a0a 2020 2020 2020 2020  a_y))):.        
+0001c540: 2020 2020 2020 2020 7072 696e 7428 7374          print(st
+0001c550: 7228 6e70 2e75 6e69 7175 6528 6461 7461  r(np.unique(data
+0001c560: 5f79 295b 695d 292e 6c6a 7573 7428 3130  _y)[i]).ljust(10
+0001c570: 292b 2720 202d 2d2d 2d2d 2d2d 2d2d 2d2d  )+'  -----------
+0001c580: 2d2d 3e20 2020 2020 272b 7374 7228 6929  -->     '+str(i)
+0001c590: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c5a0: 2020 696e 6465 7820 3d20 6e70 2e77 6865    index = np.whe
+0001c5b0: 7265 2864 6174 615f 7920 3d3d 206e 702e  re(data_y == np.
+0001c5c0: 756e 6971 7565 2864 6174 615f 7929 5b69  unique(data_y)[i
+0001c5d0: 5d29 5b30 5d0a 2020 2020 2020 2020 2020  ])[0].          
+0001c5e0: 2020 2020 2020 795b 696e 6465 785d 203d        y[index] =
+0001c5f0: 2069 0a20 2020 2020 2020 2020 2020 2064   i.            d
+0001c600: 6174 615f 7920 3d20 7920 0a20 2020 2020  ata_y = y .     
+0001c610: 2020 2020 2020 2070 7269 6e74 2827 2d2d         print('--
+0001c620: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c640: 2d2d 2729 0a20 2020 2065 6c69 6620 636c  --').    elif cl
+0001c650: 6620 3d3d 2027 616c 6578 6e65 7427 206f  f == 'alexnet' o
+0001c660: 7220 636c 6620 3d3d 2027 7667 6731 3627  r clf == 'vgg16'
+0001c670: 206f 7220 636c 6620 3d3d 2027 7265 736e   or clf == 'resn
+0001c680: 6574 3138 2720 6f72 2063 6c66 203d 3d20  et18' or clf == 
+0001c690: 2763 7573 746f 6d5f 636e 6e27 3a0a 2020  'custom_cnn':.  
+0001c6a0: 2020 2020 2020 7061 7373 0a20 2020 2065        pass.    e
+0001c6b0: 6c73 653a 0a20 2020 2020 2020 2072 6169  lse:.        rai
+0001c6c0: 7365 2056 616c 7565 4572 726f 7228 2763  se ValueError('c
+0001c6d0: 6c66 2061 7267 756d 656e 7420 6d75 7374  lf argument must
+0001c6e0: 2065 6974 6865 7220 6265 2022 7266 222c   either be "rf",
+0001c6f0: 2022 7867 6222 2c20 226e 6e22 2c20 6f72   "xgb", "nn", or
+0001c700: 2022 616c 6578 6e65 7422 2c20 2276 6767   "alexnet", "vgg
+0001c710: 3136 222c 2022 7265 736e 6574 3138 222c  16", "resnet18",
+0001c720: 2022 6375 7374 6f6d 5f63 6e6e 222e 2729   "custom_cnn".')
+0001c730: 0a0a 2020 2020 6966 206e 5f69 7465 7220  ..    if n_iter 
+0001c740: 3d3d 2030 3a0a 2020 2020 2020 2020 6966  == 0:.        if
+0001c750: 2063 6c66 203d 3d20 2772 6627 206f 7220   clf == 'rf' or 
+0001c760: 636c 6620 3d3d 2027 7867 6227 206f 7220  clf == 'xgb' or 
+0001c770: 636c 6620 3d3d 2027 6e6e 273a 0a20 2020  clf == 'nn':.   
+0001c780: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0001c790: 4e6f 206f 7074 696d 697a 6174 696f 6e20  No optimization 
+0001c7a0: 7472 6961 6c73 2063 6f6e 6669 6775 7265  trials configure
+0001c7b0: 6420 286e 5f69 7465 723d 3029 2c20 7265  d (n_iter=0), re
+0001c7c0: 7475 726e 696e 6720 6261 7365 207b 7d20  turning base {} 
+0001c7d0: 6d6f 6465 6c2e 2e2e 272e 666f 726d 6174  model...'.format
+0001c7e0: 2863 6c66 2929 0a20 2020 2020 2020 2020  (clf)).         
+0001c7f0: 2020 2072 6574 7572 6e20 6d6f 6465 6c5f     return model_
+0001c800: 3020 0a20 2020 2020 2020 2065 6c73 653a  0 .        else:
+0001c810: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001c820: 7365 2056 616c 7565 4572 726f 7228 274e  se ValueError('N
+0001c830: 6f20 6f70 7469 6d69 7a61 7469 6f6e 2074  o optimization t
+0001c840: 7269 616c 7320 636f 6e66 6967 7572 6564  rials configured
+0001c850: 2c20 7365 7420 6e5f 6974 6572 203e 2030  , set n_iter > 0
+0001c860: 2127 290a 0a20 2020 2069 6620 636c 6620  !')..    if clf 
+0001c870: 3d3d 2027 7266 2720 6f72 2063 6c66 203d  == 'rf' or clf =
+0001c880: 3d20 2778 6762 2720 6f72 2063 6c66 203d  = 'xgb' or clf =
+0001c890: 3d20 276e 6e27 3a0a 2020 2020 2020 2020  = 'nn':.        
+0001c8a0: 6376 203d 2063 726f 7373 5f76 616c 6964  cv = cross_valid
+0001c8b0: 6174 6528 6d6f 6465 6c5f 302c 2064 6174  ate(model_0, dat
+0001c8c0: 615f 782c 2064 6174 615f 792c 2063 763d  a_x, data_y, cv=
+0001c8d0: 6f70 745f 6376 290a 2020 2020 2020 2020  opt_cv).        
+0001c8e0: 696e 6974 6961 6c5f 7363 6f72 6520 3d20  initial_score = 
+0001c8f0: 6e70 2e6d 6561 6e28 6376 5b27 7465 7374  np.mean(cv['test
+0001c900: 5f73 636f 7265 275d 290a 0a20 2020 2073  _score'])..    s
+0001c910: 616d 706c 6572 203d 206f 7074 756e 612e  ampler = optuna.
+0001c920: 7361 6d70 6c65 7273 2e54 5045 5361 6d70  samplers.TPESamp
+0001c930: 6c65 7228 7365 6564 3d31 3930 3929 0a20  ler(seed=1909). 
+0001c940: 2020 2073 7475 6479 203d 206f 7074 756e     study = optun
+0001c950: 612e 6372 6561 7465 5f73 7475 6479 2864  a.create_study(d
+0001c960: 6972 6563 7469 6f6e 3d27 6d61 7869 6d69  irection='maximi
+0001c970: 7a65 272c 2073 616d 706c 6572 3d73 616d  ze', sampler=sam
+0001c980: 706c 6572 2923 2c20 7072 756e 6572 3d6f  pler)#, pruner=o
+0001c990: 7074 756e 612e 7072 756e 6572 732e 4d65  ptuna.pruners.Me
+0001c9a0: 6469 616e 5072 756e 6572 286e 5f73 7461  dianPruner(n_sta
+0001c9b0: 7274 7570 5f74 7269 616c 733d 352c 206e  rtup_trials=5, n
+0001c9c0: 5f77 6172 6d75 705f 7374 6570 733d 3330  _warmup_steps=30
+0001c9d0: 2c20 696e 7465 7276 616c 5f73 7465 7073  , interval_steps
+0001c9e0: 3d31 3029 290a 2020 2020 7072 696e 7428  =10)).    print(
+0001c9f0: 2753 7461 7274 696e 6720 6879 7065 7270  'Starting hyperp
+0001ca00: 6172 616d 6574 6572 206f 7074 696d 697a  arameter optimiz
+0001ca10: 6174 696f 6e2c 2074 6869 7320 7769 6c6c  ation, this will
+0001ca20: 2074 616b 6520 6120 7768 696c 652e 2e2e   take a while...
+0001ca30: 2729 0a0a 2020 2020 2349 6620 6269 6e61  ')..    #If bina
+0001ca40: 7279 2063 6c61 7373 6966 6963 6174 696f  ry classificatio
+0001ca50: 6e20 7461 736b 2c20 6361 6e20 6465 616c  n task, can deal
+0001ca60: 2077 6974 6820 696d 6261 6c61 6e63 6520   with imbalance 
+0001ca70: 636c 6173 7365 7320 7769 7468 2077 6569  classes with wei
+0001ca80: 6768 7473 2068 7970 6572 7061 7261 6d65  ghts hyperparame
+0001ca90: 7465 720a 2020 2020 6966 206c 656e 286e  ter.    if len(n
+0001caa0: 702e 756e 6971 7565 2864 6174 615f 7929  p.unique(data_y)
+0001cab0: 2920 3d3d 2032 3a0a 2020 2020 2020 2020  ) == 2:.        
+0001cac0: 6966 2063 6c66 203d 3d20 2772 6627 206f  if clf == 'rf' o
+0001cad0: 7220 636c 6620 3d3d 2027 7867 6227 206f  r clf == 'xgb' o
+0001cae0: 7220 636c 6620 3d3d 2027 6e6e 273a 0a20  r clf == 'nn':. 
+0001caf0: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+0001cb00: 6572 203d 2043 6f75 6e74 6572 2864 6174  er = Counter(dat
+0001cb10: 615f 7929 0a20 2020 2020 2020 2020 2020  a_y).           
+0001cb20: 2069 6620 636f 756e 7465 725b 6e70 2e75   if counter[np.u
+0001cb30: 6e69 7175 6528 6461 7461 5f79 295b 305d  nique(data_y)[0]
+0001cb40: 5d20 213d 2063 6f75 6e74 6572 5b6e 702e  ] != counter[np.
+0001cb50: 756e 6971 7565 2864 6174 615f 7929 5b31  unique(data_y)[1
+0001cb60: 5d5d 3a0a 2020 2020 2020 2020 2020 2020  ]]:.            
+0001cb70: 2020 2020 6966 2062 616c 616e 6365 3a0a      if balance:.
+0001cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb90: 2020 2020 7072 696e 7428 2755 6e62 616c      print('Unbal
+0001cba0: 616e 6365 6420 6461 7461 7365 7420 6465  anced dataset de
+0001cbb0: 7465 6374 6564 2c20 7769 6c6c 2074 7261  tected, will tra
+0001cbc0: 696e 2063 6c61 7373 6966 6965 7220 7769  in classifier wi
+0001cbd0: 7468 2077 6569 6768 7473 2120 546f 2064  th weights! To d
+0001cbe0: 6973 6162 6c65 2c20 7365 7420 6261 6c61  isable, set bala
+0001cbf0: 6e63 653d 4661 6c73 6527 290a 2020 2020  nce=False').    
+0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc10: 6966 2063 6c66 203d 3d20 2778 6762 273a  if clf == 'xgb':
+0001cc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cc30: 2020 2020 2020 2020 2074 6f74 616c 5f6e           total_n
+0001cc40: 6567 6174 6976 6520 3d20 6c65 6e28 6e70  egative = len(np
+0001cc50: 2e77 6865 7265 2864 6174 615f 7920 3d3d  .where(data_y ==
+0001cc60: 2063 6f75 6e74 6572 2e6d 6f73 745f 636f   counter.most_co
+0001cc70: 6d6d 6f6e 2831 295b 305d 5b30 5d29 5b30  mmon(1)[0][0])[0
+0001cc80: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001cc90: 2020 2020 2020 2020 2020 2074 6f74 616c             total
+0001cca0: 5f70 6f73 6974 6976 6520 3d20 6c65 6e28  _positive = len(
+0001ccb0: 6461 7461 5f79 2920 2d20 746f 7461 6c5f  data_y) - total_
+0001ccc0: 6e65 6761 7469 7665 0a20 2020 2020 2020  negative.       
+0001ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cce0: 2073 616d 706c 655f 7765 6967 6874 203d   sample_weight =
+0001ccf0: 2074 6f74 616c 5f6e 6567 6174 6976 6520   total_negative 
+0001cd00: 2f20 746f 7461 6c5f 706f 7369 7469 7665  / total_positive
+0001cd10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd20: 2020 2020 2065 6c69 6620 636c 6620 3d3d       elif clf ==
+0001cd30: 2027 7266 273a 0a20 2020 2020 2020 2020   'rf':.         
+0001cd40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001cd50: 616d 706c 655f 7765 6967 6874 203d 2027  ample_weight = '
+0001cd60: 6261 6c61 6e63 6564 270a 2020 2020 2020  balanced'.      
+0001cd70: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001cd80: 6966 2063 6c66 203d 3d20 276e 6e27 3a0a  if clf == 'nn':.
+0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cda0: 2020 2020 2020 2020 7072 696e 7428 2757          print('W
+0001cdb0: 4152 4e49 4e47 3a20 4d4c 5043 6c61 7373  ARNING: MLPClass
+0001cdc0: 6966 6965 7228 2920 646f 6573 206e 6f74  ifier() does not
+0001cdd0: 2073 7570 706f 7274 2073 616d 706c 6520   support sample 
+0001cde0: 7765 6967 6874 732e 2729 0a20 2020 2020  weights.').     
+0001cdf0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001ce00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ce10: 2020 2020 2073 616d 706c 655f 7765 6967       sample_weig
+0001ce20: 6874 203d 204e 6f6e 650a 2020 2020 2020  ht = None.      
+0001ce30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001ce40: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+0001ce50: 6c65 5f77 6569 6768 7420 3d20 4e6f 6e65  le_weight = None
+0001ce60: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001ce70: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001ce80: 2827 556e 6261 6c61 6e63 6564 2064 6174  ('Unbalanced dat
+0001ce90: 6173 6574 2064 6574 6563 7465 6420 6275  aset detected bu
+0001cea0: 7420 7468 6520 6f70 7469 6d69 7a61 7469  t the optimizati
+0001ceb0: 6f6e 2072 6f75 7469 6e65 2064 6f65 7320  on routine does 
+0001cec0: 6e6f 7420 6375 7272 656e 746c 7920 7375  not currently su
+0001ced0: 7070 6f72 7420 7765 6967 6874 732e 2054  pport weights. T
+0001cee0: 6f20 7573 6520 7468 6520 7765 6967 6874  o use the weight
+0001cef0: 6564 5f62 696e 6172 795f 6372 6f73 7365  ed_binary_crosse
+0001cf00: 6e74 726f 7079 206c 6f73 7320 6675 6e63  ntropy loss func
+0001cf10: 7469 6f6e 2c20 6c6f 6164 2074 6865 2064  tion, load the d
+0001cf20: 6573 6972 6564 206d 6f64 656c 2064 6972  esired model dir
+0001cf30: 6563 746c 7920 616e 6420 7365 7420 6c6f  ectly and set lo
+0001cf40: 7373 3d22 7765 6967 6874 6564 5f62 696e  ss="weighted_bin
+0001cf50: 6172 795f 6372 6f73 7365 6e74 726f 7079  ary_crossentropy
+0001cf60: 2220 2872 6566 6572 2074 6f20 7468 6520  " (refer to the 
+0001cf70: 7079 4249 412e 636e 6e5f 6d6f 6465 6c20  pyBIA.cnn_model 
+0001cf80: 4150 4920 646f 6375 6d65 6e74 6174 696f  API documentatio
+0001cf90: 6e29 2e27 290a 2020 2020 656c 7365 3a0a  n).').    else:.
+0001cfa0: 2020 2020 2020 2020 7361 6d70 6c65 5f77          sample_w
+0001cfb0: 6569 6768 7420 3d20 4e6f 6e65 0a0a 2020  eight = None..  
+0001cfc0: 2020 6966 2063 6c66 203d 3d20 2772 6627    if clf == 'rf'
+0001cfd0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+0001cfe0: 2020 2020 2020 2020 2020 206f 626a 6563             objec
+0001cff0: 7469 7665 203d 206f 626a 6563 7469 7665  tive = objective
+0001d000: 5f72 6628 6461 7461 5f78 2c20 6461 7461  _rf(data_x, data
+0001d010: 5f79 2c20 6f70 745f 6376 3d6f 7074 5f63  _y, opt_cv=opt_c
+0001d020: 7629 0a20 2020 2020 2020 2020 2020 2073  v).            s
+0001d030: 7475 6479 2e6f 7074 696d 697a 6528 6f62  tudy.optimize(ob
+0001d040: 6a65 6374 6976 652c 206e 5f74 7269 616c  jective, n_trial
+0001d050: 733d 6e5f 6974 6572 2c20 7368 6f77 5f70  s=n_iter, show_p
+0001d060: 726f 6772 6573 735f 6261 723d 5472 7565  rogress_bar=True
+0001d070: 2923 2c20 6763 5f61 6674 6572 5f74 7269  )#, gc_after_tri
+0001d080: 616c 3d54 7275 6529 0a20 2020 2020 2020  al=True).       
+0001d090: 2020 2020 2070 6172 616d 7320 3d20 7374       params = st
+0001d0a0: 7564 792e 6265 7374 5f74 7269 616c 2e70  udy.best_trial.p
+0001d0b0: 6172 616d 730a 2020 2020 2020 2020 2020  arams.          
+0001d0c0: 2020 6d6f 6465 6c20 3d20 5261 6e64 6f6d    model = Random
+0001d0d0: 466f 7265 7374 436c 6173 7369 6669 6572  ForestClassifier
+0001d0e0: 286e 5f65 7374 696d 6174 6f72 733d 7061  (n_estimators=pa
+0001d0f0: 7261 6d73 5b27 6e5f 6573 7469 6d61 746f  rams['n_estimato
+0001d100: 7273 275d 2c20 6372 6974 6572 696f 6e3d  rs'], criterion=
+0001d110: 7061 7261 6d73 5b27 6372 6974 6572 696f  params['criterio
+0001d120: 6e27 5d2c 200a 2020 2020 2020 2020 2020  n'], .          
+0001d130: 2020 2020 2020 6d61 785f 6465 7074 683d        max_depth=
+0001d140: 7061 7261 6d73 5b27 6d61 785f 6465 7074  params['max_dept
+0001d150: 6827 5d2c 206d 696e 5f73 616d 706c 6573  h'], min_samples
+0001d160: 5f73 706c 6974 3d70 6172 616d 735b 276d  _split=params['m
+0001d170: 696e 5f73 616d 706c 6573 5f73 706c 6974  in_samples_split
+0001d180: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
+0001d190: 2020 2020 206d 696e 5f73 616d 706c 6573       min_samples
+0001d1a0: 5f6c 6561 663d 7061 7261 6d73 5b27 6d69  _leaf=params['mi
+0001d1b0: 6e5f 7361 6d70 6c65 735f 6c65 6166 275d  n_samples_leaf']
+0001d1c0: 2c20 6d61 785f 6665 6174 7572 6573 3d70  , max_features=p
+0001d1d0: 6172 616d 735b 276d 6178 5f66 6561 7475  arams['max_featu
+0001d1e0: 7265 7327 5d2c 200a 2020 2020 2020 2020  res'], .        
+0001d1f0: 2020 2020 2020 2020 626f 6f74 7374 7261          bootstra
+0001d200: 703d 7061 7261 6d73 5b27 626f 6f74 7374  p=params['bootst
+0001d210: 7261 7027 5d2c 2063 6c61 7373 5f77 6569  rap'], class_wei
+0001d220: 6768 743d 7361 6d70 6c65 5f77 6569 6768  ght=sample_weigh
+0001d230: 742c 2072 616e 646f 6d5f 7374 6174 653d  t, random_state=
+0001d240: 3139 3039 290a 2020 2020 2020 2020 6578  1909).        ex
+0001d250: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+0001d260: 2020 7072 696e 7428 2746 6169 6c65 6420    print('Failed 
+0001d270: 746f 206f 7074 696d 697a 6520 7769 7468  to optimize with
+0001d280: 204f 7074 756e 612c 2073 7769 7463 6869   Optuna, switchi
+0001d290: 6e67 206f 7665 7220 746f 2042 6179 6573  ng over to Bayes
+0001d2a0: 5365 6172 6368 4356 2e2e 2e27 290a 2020  SearchCV...').  
+0001d2b0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+0001d2c0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0001d2d0: 2020 2020 2027 6372 6974 6572 696f 6e27       'criterion'
+0001d2e0: 3a20 5b22 6769 6e69 222c 2022 656e 7472  : ["gini", "entr
+0001d2f0: 6f70 7922 5d2c 0a20 2020 2020 2020 2020  opy"],.         
+0001d300: 2020 2020 2020 2027 6e5f 6573 7469 6d61         'n_estima
+0001d310: 746f 7273 273a 205b 696e 7428 7829 2066  tors': [int(x) f
+0001d320: 6f72 2078 2069 6e20 6e70 2e6c 696e 7370  or x in np.linsp
+0001d330: 6163 6528 3530 2c31 3030 302c 206e 756d  ace(50,1000, num
+0001d340: 3d32 3029 5d2c 200a 2020 2020 2020 2020  =20)], .        
+0001d350: 2020 2020 2020 2020 276d 6178 5f66 6561          'max_fea
+0001d360: 7475 7265 7327 3a20 5b64 6174 615f 782e  tures': [data_x.
+0001d370: 7368 6170 655b 315d 2c20 2273 7172 7422  shape[1], "sqrt"
+0001d380: 2c20 226c 6f67 3222 5d2c 0a20 2020 2020  , "log2"],.     
+0001d390: 2020 2020 2020 2020 2020 2027 6d61 785f             'max_
+0001d3a0: 6465 7074 6827 3a20 5b69 6e74 2878 2920  depth': [int(x) 
+0001d3b0: 666f 7220 7820 696e 206e 702e 6c69 6e73  for x in np.lins
+0001d3c0: 7061 6365 2835 2c35 302c 6e75 6d3d 3529  pace(5,50,num=5)
+0001d3d0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001d3e0: 2020 2027 6d69 6e5f 7361 6d70 6c65 735f     'min_samples_
+0001d3f0: 7370 6c69 7427 3a20 5b33 2c34 2c36 2c37  split': [3,4,6,7
+0001d400: 2c38 2c39 2c31 305d 2c0a 2020 2020 2020  ,8,9,10],.      
+0001d410: 2020 2020 2020 2020 2020 276d 696e 5f73            'min_s
+0001d420: 616d 706c 6573 5f6c 6561 6627 3a20 5b31  amples_leaf': [1
+0001d430: 2c33 2c35 2c37 2c39 2c31 305d 2c0a 2020  ,3,5,7,9,10],.  
+0001d440: 2020 2020 2020 2020 2020 2020 2020 276d                'm
+0001d450: 6178 5f6c 6561 665f 6e6f 6465 7327 3a20  ax_leaf_nodes': 
+0001d460: 5b69 6e74 2878 2920 666f 7220 7820 696e  [int(x) for x in
+0001d470: 206e 702e 6c69 6e73 7061 6365 2832 2c32   np.linspace(2,2
+0001d480: 3030 295d 2c0a 2020 2020 2020 2020 2020  00)],.          
+0001d490: 2020 2020 2020 2762 6f6f 7473 7472 6170        'bootstrap
+0001d4a0: 273a 205b 5472 7565 2c46 616c 7365 5d20  ': [True,False] 
+0001d4b0: 2020 0a20 2020 2020 2020 2020 2020 207d    .            }
+0001d4c0: 0a20 2020 2020 2020 2020 2020 2067 7320  .            gs 
+0001d4d0: 3d20 4261 7965 7353 6561 7263 6843 5628  = BayesSearchCV(
+0001d4e0: 6e5f 6974 6572 3d6e 5f69 7465 722c 2065  n_iter=n_iter, e
+0001d4f0: 7374 696d 6174 6f72 3d6d 6f64 656c 5f30  stimator=model_0
+0001d500: 2c20 7365 6172 6368 5f73 7061 6365 733d  , search_spaces=
+0001d510: 7061 7261 6d73 2c20 0a20 2020 2020 2020  params, .       
+0001d520: 2020 2020 2020 2020 206f 7074 696d 697a           optimiz
+0001d530: 6572 5f6b 7761 7267 733d 7b27 6261 7365  er_kwargs={'base
+0001d540: 5f65 7374 696d 6174 6f72 273a 2027 5246  _estimator': 'RF
+0001d550: 277d 2c20 6376 3d6f 7074 5f63 7629 0a20  '}, cv=opt_cv). 
+0001d560: 2020 2020 2020 2020 2020 2067 732e 6669             gs.fi
+0001d570: 7428 6461 7461 5f78 2c20 6461 7461 5f79  t(data_x, data_y
+0001d580: 290a 2020 2020 2020 2020 2020 2020 6265  ).            be
+0001d590: 7374 5f65 7374 2c20 6265 7374 5f73 636f  st_est, best_sco
+0001d5a0: 7265 203d 2067 732e 6265 7374 5f65 7374  re = gs.best_est
+0001d5b0: 696d 6174 6f72 5f2c 206e 702e 726f 756e  imator_, np.roun
+0001d5c0: 6428 6773 2e62 6573 745f 7363 6f72 655f  d(gs.best_score_
+0001d5d0: 2c20 3429 0a20 2020 2020 2020 2020 2020  , 4).           
+0001d5e0: 2070 7269 6e74 2827 4869 6768 6573 7420   print('Highest 
+0001d5f0: 6d65 616e 2061 6363 7572 6163 793a 207b  mean accuracy: {
+0001d600: 7d27 2e66 6f72 6d61 7428 6265 7374 5f73  }'.format(best_s
+0001d610: 636f 7265 2929 0a20 2020 2020 2020 2020  core)).         
+0001d620: 2020 2072 6574 7572 6e20 6773 2e62 6573     return gs.bes
+0001d630: 745f 6573 7469 6d61 746f 725f 2c20 6773  t_estimator_, gs
+0001d640: 2e62 6573 745f 7061 7261 6d73 5f0a 0a20  .best_params_.. 
+0001d650: 2020 2065 6c69 6620 636c 6620 3d3d 2027     elif clf == '
+0001d660: 6e6e 273a 0a20 2020 2020 2020 2074 7279  nn':.        try
+0001d670: 3a0a 2020 2020 2020 2020 2020 2020 6f62  :.            ob
+0001d680: 6a65 6374 6976 6520 3d20 6f62 6a65 6374  jective = object
+0001d690: 6976 655f 6e6e 2864 6174 615f 782c 2064  ive_nn(data_x, d
+0001d6a0: 6174 615f 792c 206f 7074 5f63 763d 6f70  ata_y, opt_cv=op
+0001d6b0: 745f 6376 290a 2020 2020 2020 2020 2020  t_cv).          
+0001d6c0: 2020 7374 7564 792e 6f70 7469 6d69 7a65    study.optimize
+0001d6d0: 286f 626a 6563 7469 7665 2c20 6e5f 7472  (objective, n_tr
+0001d6e0: 6961 6c73 3d6e 5f69 7465 722c 2073 686f  ials=n_iter, sho
+0001d6f0: 775f 7072 6f67 7265 7373 5f62 6172 3d54  w_progress_bar=T
+0001d700: 7275 6529 232c 2067 635f 6166 7465 725f  rue)#, gc_after_
+0001d710: 7472 6961 6c3d 5472 7565 290a 2020 2020  trial=True).    
+0001d720: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+0001d730: 2073 7475 6479 2e62 6573 745f 7472 6961   study.best_tria
+0001d740: 6c2e 7061 7261 6d73 0a20 2020 2020 2020  l.params.       
+0001d750: 2020 2020 206c 6179 6572 7320 3d20 5b70       layers = [p
+0001d760: 6172 616d 2066 6f72 2070 6172 616d 2069  aram for param i
+0001d770: 6e20 7061 7261 6d73 2069 6620 276e 5f75  n params if 'n_u
+0001d780: 6e69 7473 5f27 2069 6e20 7061 7261 6d5d  nits_' in param]
+0001d790: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+0001d7a0: 6572 7320 3d20 7475 706c 6528 7061 7261  ers = tuple(para
+0001d7b0: 6d73 5b6c 6179 6572 5d20 666f 7220 6c61  ms[layer] for la
+0001d7c0: 7965 7220 696e 206c 6179 6572 7329 0a20  yer in layers). 
+0001d7d0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001d7e0: 203d 204d 4c50 436c 6173 7369 6669 6572   = MLPClassifier
+0001d7f0: 2868 6964 6465 6e5f 6c61 7965 725f 7369  (hidden_layer_si
+0001d800: 7a65 733d 7475 706c 6528 6c61 7965 7273  zes=tuple(layers
+0001d810: 292c 206c 6561 726e 696e 675f 7261 7465  ), learning_rate
+0001d820: 5f69 6e69 743d 7061 7261 6d73 5b27 6c65  _init=params['le
+0001d830: 6172 6e69 6e67 5f72 6174 655f 696e 6974  arning_rate_init
+0001d840: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
+0001d850: 2020 2020 2061 6374 6976 6174 696f 6e3d       activation=
+0001d860: 7061 7261 6d73 5b27 6163 7469 7661 7469  params['activati
+0001d870: 6f6e 275d 2c20 6c65 6172 6e69 6e67 5f72  on'], learning_r
+0001d880: 6174 653d 7061 7261 6d73 5b27 6c65 6172  ate=params['lear
+0001d890: 6e69 6e67 5f72 6174 6527 5d2c 2061 6c70  ning_rate'], alp
+0001d8a0: 6861 3d70 6172 616d 735b 2761 6c70 6861  ha=params['alpha
+0001d8b0: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
+0001d8c0: 2020 2020 2062 6174 6368 5f73 697a 653d       batch_size=
+0001d8d0: 7061 7261 6d73 5b27 6261 7463 685f 7369  params['batch_si
+0001d8e0: 7a65 275d 2c20 736f 6c76 6572 3d70 6172  ze'], solver=par
+0001d8f0: 616d 735b 2773 6f6c 7665 7227 5d2c 206d  ams['solver'], m
+0001d900: 6178 5f69 7465 723d 3235 3030 2c20 7261  ax_iter=2500, ra
+0001d910: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
+0001d920: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+0001d930: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001d940: 6e74 2827 4661 696c 6564 2074 6f20 6f70  nt('Failed to op
+0001d950: 7469 6d69 7a65 2077 6974 6820 4f70 7475  timize with Optu
+0001d960: 6e61 2c20 7377 6974 6368 696e 6720 6f76  na, switching ov
+0001d970: 6572 2074 6f20 4261 7965 7353 6561 7263  er to BayesSearc
+0001d980: 6843 562e 2e2e 2729 0a20 2020 2020 2020  hCV...').       
+0001d990: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
+0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9b0: 2768 6964 6465 6e5f 6c61 7965 725f 7369  'hidden_layer_si
+0001d9c0: 7a65 7327 3a20 5b28 3130 302c 292c 2835  zes': [(100,),(5
+0001d9d0: 302c 3130 302c 3530 292c 2837 352c 3530  0,100,50),(75,50
+0001d9e0: 2c32 3029 2c28 3135 302c 3130 302c 3530  ,20),(150,100,50
+0001d9f0: 292c 2831 3230 2c38 302c 3430 292c 2831  ),(120,80,40),(1
+0001da00: 3030 2c35 302c 3330 295d 2c0a 2020 2020  00,50,30)],.    
+0001da10: 2020 2020 2020 2020 2020 2020 276c 6561              'lea
+0001da20: 726e 696e 675f 7261 7465 273a 205b 2763  rning_rate': ['c
+0001da30: 6f6e 7374 616e 7427 2c20 2769 6e76 7363  onstant', 'invsc
+0001da40: 616c 696e 6727 2c20 2761 6461 7074 6976  aling', 'adaptiv
+0001da50: 6527 5d2c 0a20 2020 2020 2020 2020 2020  e'],.           
+0001da60: 2020 2020 2027 616c 7068 6127 3a20 5b30       'alpha': [0
+0001da70: 2e30 3030 3031 2c20 302e 355d 2c20 0a20  .00001, 0.5], . 
+0001da80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001da90: 6163 7469 7661 7469 6f6e 273a 205b 2774  activation': ['t
+0001daa0: 616e 6827 2c20 276c 6f67 6973 7469 6327  anh', 'logistic'
+0001dab0: 2c20 2772 656c 7527 5d2c 0a20 2020 2020  , 'relu'],.     
+0001dac0: 2020 2020 2020 2020 2020 2027 736f 6c76             'solv
+0001dad0: 6572 273a 205b 2773 6764 272c 2027 6164  er': ['sgd', 'ad
+0001dae0: 616d 275d 2c0a 2020 2020 2020 2020 2020  am'],.          
+0001daf0: 2020 2020 2020 276d 6178 5f69 7465 7227        'max_iter'
+0001db00: 3a20 5b31 3030 2c20 3135 302c 2032 3030  : [100, 150, 200
+0001db10: 5d20 0a20 2020 2020 2020 2020 2020 207d  ] .            }
+0001db20: 0a20 2020 2020 2020 2020 2020 2067 7320  .            gs 
+0001db30: 3d20 4261 7965 7353 6561 7263 6843 5628  = BayesSearchCV(
+0001db40: 6e5f 6974 6572 3d6e 5f69 7465 722c 2065  n_iter=n_iter, e
+0001db50: 7374 696d 6174 6f72 3d6d 6f64 656c 5f30  stimator=model_0
+0001db60: 2c20 7365 6172 6368 5f73 7061 6365 733d  , search_spaces=
+0001db70: 7061 7261 6d73 2c20 6376 3d6f 7074 5f63  params, cv=opt_c
+0001db80: 7629 0a20 2020 2020 2020 2020 2020 2067  v).            g
+0001db90: 732e 6669 7428 6461 7461 5f78 2c20 6461  s.fit(data_x, da
+0001dba0: 7461 5f79 290a 2020 2020 2020 2020 2020  ta_y).          
+0001dbb0: 2020 6265 7374 5f65 7374 2c20 6265 7374    best_est, best
+0001dbc0: 5f73 636f 7265 203d 2067 732e 6265 7374  _score = gs.best
+0001dbd0: 5f65 7374 696d 6174 6f72 5f2c 206e 702e  _estimator_, np.
+0001dbe0: 726f 756e 6428 6773 2e62 6573 745f 7363  round(gs.best_sc
+0001dbf0: 6f72 655f 2c20 3429 0a20 2020 2020 2020  ore_, 4).       
+0001dc00: 2020 2020 2070 7269 6e74 2827 4869 6768       print('High
+0001dc10: 6573 7420 6d65 616e 2061 6363 7572 6163  est mean accurac
+0001dc20: 793a 207b 7d27 2e66 6f72 6d61 7428 6265  y: {}'.format(be
+0001dc30: 7374 5f73 636f 7265 2929 0a20 2020 2020  st_score)).     
+0001dc40: 2020 2020 2020 2072 6574 7572 6e20 6773         return gs
+0001dc50: 2e62 6573 745f 6573 7469 6d61 746f 725f  .best_estimator_
+0001dc60: 2c20 6773 2e62 6573 745f 7061 7261 6d73  , gs.best_params
+0001dc70: 5f0a 2020 2020 2020 2020 2020 0a20 2020  _.          .   
+0001dc80: 2065 6c69 6620 636c 6620 3d3d 2027 7867   elif clf == 'xg
+0001dc90: 6227 3a0a 2020 2020 2020 2020 6f62 6a65  b':.        obje
+0001dca0: 6374 6976 6520 3d20 6f62 6a65 6374 6976  ctive = objectiv
+0001dcb0: 655f 7867 6228 6461 7461 5f78 2c20 6461  e_xgb(data_x, da
+0001dcc0: 7461 5f79 2c20 6c69 6d69 745f 7365 6172  ta_y, limit_sear
+0001dcd0: 6368 3d6c 696d 6974 5f73 6561 7263 682c  ch=limit_search,
+0001dce0: 206f 7074 5f63 763d 6f70 745f 6376 290a   opt_cv=opt_cv).
+0001dcf0: 2020 2020 2020 2020 6966 206c 696d 6974          if limit
+0001dd00: 5f73 6561 7263 683a 0a20 2020 2020 2020  _search:.       
+0001dd10: 2020 2020 2070 7269 6e74 2827 4e4f 5445       print('NOTE
+0001dd20: 3a20 546f 2065 7870 616e 6420 6879 7065  : To expand hype
+0001dd30: 7270 6172 616d 6574 6572 2073 6561 7263  rparameter searc
+0001dd40: 6820 7370 6163 652c 2073 6574 206c 696d  h space, set lim
+0001dd50: 6974 5f73 6561 7263 683d 4661 6c73 652c  it_search=False,
+0001dd60: 2061 6c74 686f 7567 6820 7468 6973 2077   although this w
+0001dd70: 696c 6c20 696e 6372 6561 7365 2074 6865  ill increase the
+0001dd80: 206f 7074 696d 697a 6174 696f 6e20 7469   optimization ti
+0001dd90: 6d65 2073 6967 6e69 6669 6361 6e74 6c79  me significantly
+0001dda0: 2e27 290a 2020 2020 2020 2020 7374 7564  .').        stud
+0001ddb0: 792e 6f70 7469 6d69 7a65 286f 626a 6563  y.optimize(objec
+0001ddc0: 7469 7665 2c20 6e5f 7472 6961 6c73 3d6e  tive, n_trials=n
+0001ddd0: 5f69 7465 722c 2073 686f 775f 7072 6f67  _iter, show_prog
+0001dde0: 7265 7373 5f62 6172 3d54 7275 6529 232c  ress_bar=True)#,
+0001ddf0: 2067 635f 6166 7465 725f 7472 6961 6c3d   gc_after_trial=
+0001de00: 5472 7565 290a 2020 2020 2020 2020 7061  True).        pa
+0001de10: 7261 6d73 203d 2073 7475 6479 2e62 6573  rams = study.bes
+0001de20: 745f 7472 6961 6c2e 7061 7261 6d73 0a20  t_trial.params. 
+0001de30: 2020 2020 2020 2069 6620 6c69 6d69 745f         if limit_
+0001de40: 7365 6172 6368 3a0a 2020 2020 2020 2020  search:.        
+0001de50: 2020 2020 6966 2070 6172 616d 735b 2762      if params['b
+0001de60: 6f6f 7374 6572 275d 203d 3d20 2764 6172  ooster'] == 'dar
+0001de70: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+0001de80: 2020 2020 6d6f 6465 6c20 3d20 5847 4243      model = XGBC
+0001de90: 6c61 7373 6966 6965 7228 626f 6f73 7465  lassifier(booste
+0001dea0: 723d 7061 7261 6d73 5b27 626f 6f73 7465  r=params['booste
+0001deb0: 7227 5d2c 2020 6e5f 6573 7469 6d61 746f  r'],  n_estimato
+0001dec0: 7273 3d70 6172 616d 735b 276e 5f65 7374  rs=params['n_est
+0001ded0: 696d 6174 6f72 7327 5d2c 2072 6567 5f6c  imators'], reg_l
+0001dee0: 616d 6264 613d 7061 7261 6d73 5b27 7265  ambda=params['re
+0001def0: 675f 6c61 6d62 6461 275d 2c20 0a20 2020  g_lambda'], .   
+0001df00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df10: 2072 6567 5f61 6c70 6861 3d70 6172 616d   reg_alpha=param
+0001df20: 735b 2772 6567 5f61 6c70 6861 275d 2c20  s['reg_alpha'], 
+0001df30: 6d61 785f 6465 7074 683d 7061 7261 6d73  max_depth=params
+0001df40: 5b27 6d61 785f 6465 7074 6827 5d2c 2065  ['max_depth'], e
+0001df50: 7461 3d70 6172 616d 735b 2765 7461 275d  ta=params['eta']
+0001df60: 2c20 6761 6d6d 613d 7061 7261 6d73 5b27  , gamma=params['
+0001df70: 6761 6d6d 6127 5d2c 200a 2020 2020 2020  gamma'], .      
+0001df80: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+0001df90: 6f77 5f70 6f6c 6963 793d 7061 7261 6d73  ow_policy=params
+0001dfa0: 5b27 6772 6f77 5f70 6f6c 6963 7927 5d2c  ['grow_policy'],
+0001dfb0: 2073 616d 706c 655f 7479 7065 3d70 6172   sample_type=par
+0001dfc0: 616d 735b 2773 616d 706c 655f 7479 7065  ams['sample_type
+0001dfd0: 275d 2c20 6e6f 726d 616c 697a 655f 7479  '], normalize_ty
+0001dfe0: 7065 3d70 6172 616d 735b 276e 6f72 6d61  pe=params['norma
+0001dff0: 6c69 7a65 5f74 7970 6527 5d2c 0a20 2020  lize_type'],.   
+0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e010: 2072 6174 655f 6472 6f70 3d70 6172 616d   rate_drop=param
+0001e020: 735b 2772 6174 655f 6472 6f70 275d 2c20  s['rate_drop'], 
+0001e030: 736b 6970 5f64 726f 703d 7061 7261 6d73  skip_drop=params
+0001e040: 5b27 736b 6970 5f64 726f 7027 5d2c 2073  ['skip_drop'], s
+0001e050: 6361 6c65 5f70 6f73 5f77 6569 6768 743d  cale_pos_weight=
+0001e060: 7361 6d70 6c65 5f77 6569 6768 742c 2072  sample_weight, r
+0001e070: 616e 646f 6d5f 7374 6174 653d 3139 3039  andom_state=1909
+0001e080: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0001e090: 6966 2070 6172 616d 735b 2762 6f6f 7374  if params['boost
+0001e0a0: 6572 275d 203d 3d20 2767 6274 7265 6527  er'] == 'gbtree'
+0001e0b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e0c0: 2020 6d6f 6465 6c20 3d20 5847 4243 6c61    model = XGBCla
+0001e0d0: 7373 6966 6965 7228 626f 6f73 7465 723d  ssifier(booster=
+0001e0e0: 7061 7261 6d73 5b27 626f 6f73 7465 7227  params['booster'
+0001e0f0: 5d2c 2020 6e5f 6573 7469 6d61 746f 7273  ],  n_estimators
+0001e100: 3d70 6172 616d 735b 276e 5f65 7374 696d  =params['n_estim
+0001e110: 6174 6f72 7327 5d2c 2072 6567 5f6c 616d  ators'], reg_lam
+0001e120: 6264 613d 7061 7261 6d73 5b27 7265 675f  bda=params['reg_
+0001e130: 6c61 6d62 6461 275d 2c20 0a20 2020 2020  lambda'], .     
+0001e140: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001e150: 6567 5f61 6c70 6861 3d70 6172 616d 735b  eg_alpha=params[
+0001e160: 2772 6567 5f61 6c70 6861 275d 2c20 6d61  'reg_alpha'], ma
+0001e170: 785f 6465 7074 683d 7061 7261 6d73 5b27  x_depth=params['
+0001e180: 6d61 785f 6465 7074 6827 5d2c 2065 7461  max_depth'], eta
+0001e190: 3d70 6172 616d 735b 2765 7461 275d 2c20  =params['eta'], 
+0001e1a0: 6761 6d6d 613d 7061 7261 6d73 5b27 6761  gamma=params['ga
+0001e1b0: 6d6d 6127 5d2c 200a 2020 2020 2020 2020  mma'], .        
+0001e1c0: 2020 2020 2020 2020 2020 2020 6772 6f77              grow
+0001e1d0: 5f70 6f6c 6963 793d 7061 7261 6d73 5b27  _policy=params['
+0001e1e0: 6772 6f77 5f70 6f6c 6963 7927 5d2c 2073  grow_policy'], s
+0001e1f0: 7562 7361 6d70 6c65 3d70 6172 616d 735b  ubsample=params[
+0001e200: 2773 7562 7361 6d70 6c65 275d 2c20 7363  'subsample'], sc
+0001e210: 616c 655f 706f 735f 7765 6967 6874 3d73  ale_pos_weight=s
+0001e220: 616d 706c 655f 7765 6967 6874 2c20 7261  ample_weight, ra
+0001e230: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
+0001e240: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001e250: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+0001e260: 7261 6d73 5b27 626f 6f73 7465 7227 5d20  rams['booster'] 
+0001e270: 3d3d 2027 6461 7274 273a 0a20 2020 2020  == 'dart':.     
+0001e280: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001e290: 203d 2058 4742 436c 6173 7369 6669 6572   = XGBClassifier
+0001e2a0: 2862 6f6f 7374 6572 3d70 6172 616d 735b  (booster=params[
+0001e2b0: 2762 6f6f 7374 6572 275d 2c20 6e5f 6573  'booster'], n_es
+0001e2c0: 7469 6d61 746f 7273 3d70 6172 616d 735b  timators=params[
+0001e2d0: 276e 5f65 7374 696d 6174 6f72 7327 5d2c  'n_estimators'],
+0001e2e0: 2063 6f6c 7361 6d70 6c65 5f62 7974 7265   colsample_bytre
+0001e2f0: 653d 7061 7261 6d73 5b27 636f 6c73 616d  e=params['colsam
+0001e300: 706c 655f 6279 7472 6565 275d 2c20 0a20  ple_bytree'], . 
+0001e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e320: 2020 2072 6567 5f6c 616d 6264 613d 7061     reg_lambda=pa
+0001e330: 7261 6d73 5b27 7265 675f 6c61 6d62 6461  rams['reg_lambda
+0001e340: 275d 2c20 7265 675f 616c 7068 613d 7061  '], reg_alpha=pa
+0001e350: 7261 6d73 5b27 7265 675f 616c 7068 6127  rams['reg_alpha'
+0001e360: 5d2c 206d 6178 5f64 6570 7468 3d70 6172  ], max_depth=par
+0001e370: 616d 735b 276d 6178 5f64 6570 7468 275d  ams['max_depth']
+0001e380: 2c20 6574 613d 7061 7261 6d73 5b27 6574  , eta=params['et
+0001e390: 6127 5d2c 2067 616d 6d61 3d70 6172 616d  a'], gamma=param
+0001e3a0: 735b 2767 616d 6d61 275d 2c20 0a20 2020  s['gamma'], .   
+0001e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3c0: 2067 726f 775f 706f 6c69 6379 3d70 6172   grow_policy=par
+0001e3d0: 616d 735b 2767 726f 775f 706f 6c69 6379  ams['grow_policy
+0001e3e0: 275d 2c20 7361 6d70 6c65 5f74 7970 653d  '], sample_type=
+0001e3f0: 7061 7261 6d73 5b27 7361 6d70 6c65 5f74  params['sample_t
+0001e400: 7970 6527 5d2c 206e 6f72 6d61 6c69 7a65  ype'], normalize
+0001e410: 5f74 7970 653d 7061 7261 6d73 5b27 6e6f  _type=params['no
+0001e420: 726d 616c 697a 655f 7479 7065 275d 2c72  rmalize_type'],r
+0001e430: 6174 655f 6472 6f70 3d70 6172 616d 735b  ate_drop=params[
+0001e440: 2772 6174 655f 6472 6f70 275d 2c20 0a20  'rate_drop'], . 
+0001e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e460: 2020 2073 6b69 705f 6472 6f70 3d70 6172     skip_drop=par
+0001e470: 616d 735b 2773 6b69 705f 6472 6f70 275d  ams['skip_drop']
+0001e480: 2c20 6d69 6e5f 6368 696c 645f 7765 6967  , min_child_weig
+0001e490: 6874 3d70 6172 616d 735b 276d 696e 5f63  ht=params['min_c
+0001e4a0: 6869 6c64 5f77 6569 6768 7427 5d2c 206d  hild_weight'], m
+0001e4b0: 6178 5f64 656c 7461 5f73 7465 703d 7061  ax_delta_step=pa
+0001e4c0: 7261 6d73 5b27 6d61 785f 6465 6c74 615f  rams['max_delta_
+0001e4d0: 7374 6570 275d 2c20 7375 6273 616d 706c  step'], subsampl
+0001e4e0: 653d 7061 7261 6d73 5b27 7375 6273 616d  e=params['subsam
+0001e4f0: 706c 6527 5d2c 0a20 2020 2020 2020 2020  ple'],.         
+0001e500: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
+0001e510: 5f70 6f73 5f77 6569 6768 743d 7361 6d70  _pos_weight=samp
+0001e520: 6c65 5f77 6569 6768 742c 2072 616e 646f  le_weight, rando
+0001e530: 6d5f 7374 6174 653d 3139 3039 290a 2020  m_state=1909).  
+0001e540: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
+0001e550: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
+0001e560: 203d 3d20 2767 6274 7265 6527 3a0a 2020   == 'gbtree':.  
+0001e570: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0001e580: 6465 6c20 3d20 5847 4243 6c61 7373 6966  del = XGBClassif
+0001e590: 6965 7228 626f 6f73 7465 723d 7061 7261  ier(booster=para
+0001e5a0: 6d73 5b27 626f 6f73 7465 7227 5d2c 206e  ms['booster'], n
+0001e5b0: 5f65 7374 696d 6174 6f72 733d 7061 7261  _estimators=para
+0001e5c0: 6d73 5b27 6e5f 6573 7469 6d61 746f 7273  ms['n_estimators
+0001e5d0: 275d 2c20 636f 6c73 616d 706c 655f 6279  '], colsample_by
+0001e5e0: 7472 6565 3d70 6172 616d 735b 2763 6f6c  tree=params['col
+0001e5f0: 7361 6d70 6c65 5f62 7974 7265 6527 5d2c  sample_bytree'],
+0001e600: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0001e610: 2020 2020 2020 7265 675f 6c61 6d62 6461        reg_lambda
+0001e620: 3d70 6172 616d 735b 2772 6567 5f6c 616d  =params['reg_lam
+0001e630: 6264 6127 5d2c 2072 6567 5f61 6c70 6861  bda'], reg_alpha
+0001e640: 3d70 6172 616d 735b 2772 6567 5f61 6c70  =params['reg_alp
+0001e650: 6861 275d 2c20 6d61 785f 6465 7074 683d  ha'], max_depth=
+0001e660: 7061 7261 6d73 5b27 6d61 785f 6465 7074  params['max_dept
+0001e670: 6827 5d2c 2065 7461 3d70 6172 616d 735b  h'], eta=params[
+0001e680: 2765 7461 275d 2c20 6761 6d6d 613d 7061  'eta'], gamma=pa
+0001e690: 7261 6d73 5b27 6761 6d6d 6127 5d2c 200a  rams['gamma'], .
+0001e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6b0: 2020 2020 6772 6f77 5f70 6f6c 6963 793d      grow_policy=
+0001e6c0: 7061 7261 6d73 5b27 6772 6f77 5f70 6f6c  params['grow_pol
+0001e6d0: 6963 7927 5d2c 2073 7562 7361 6d70 6c65  icy'], subsample
+0001e6e0: 3d70 6172 616d 735b 2773 7562 7361 6d70  =params['subsamp
+0001e6f0: 6c65 275d 2c20 6d69 6e5f 6368 696c 645f  le'], min_child_
+0001e700: 7765 6967 6874 3d70 6172 616d 735b 276d  weight=params['m
+0001e710: 696e 5f63 6869 6c64 5f77 6569 6768 7427  in_child_weight'
+0001e720: 5d2c 206d 6178 5f64 656c 7461 5f73 7465  ], max_delta_ste
+0001e730: 703d 7061 7261 6d73 5b27 6d61 785f 6465  p=params['max_de
+0001e740: 6c74 615f 7374 6570 275d 2c0a 2020 2020  lta_step'],.    
+0001e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e760: 7363 616c 655f 706f 735f 7765 6967 6874  scale_pos_weight
+0001e770: 3d73 616d 706c 655f 7765 6967 6874 2c20  =sample_weight, 
+0001e780: 7261 6e64 6f6d 5f73 7461 7465 3d31 3930  random_state=190
+0001e790: 3929 0a20 2020 2020 2020 0a20 2020 2065  9).       .    e
+0001e7a0: 6c73 653a 0a20 2020 2020 2020 206f 626a  lse:.        obj
+0001e7b0: 6563 7469 7665 203d 206f 626a 6563 7469  ective = objecti
+0001e7c0: 7665 5f63 6e6e 2864 6174 615f 782c 2064  ve_cnn(data_x, d
+0001e7d0: 6174 615f 792c 2076 616c 5f70 6f73 6974  ata_y, val_posit
+0001e7e0: 6976 653d 7661 6c5f 582c 2076 616c 5f6e  ive=val_X, val_n
+0001e7f0: 6567 6174 6976 653d 7661 6c5f 592c 2069  egative=val_Y, i
+0001e800: 6d67 5f6e 756d 5f63 6861 6e6e 656c 733d  mg_num_channels=
+0001e810: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0001e820: 2c20 636c 663d 636c 662c 200a 2020 2020  , clf=clf, .    
+0001e830: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
+0001e840: 653d 6e6f 726d 616c 697a 652c 206d 696e  e=normalize, min
+0001e850: 5f70 6978 656c 3d6d 696e 5f70 6978 656c  _pixel=min_pixel
+0001e860: 2c20 6d61 785f 7069 7865 6c3d 6d61 785f  , max_pixel=max_
+0001e870: 7069 7865 6c2c 2070 6174 6965 6e63 653d  pixel, patience=
+0001e880: 7061 7469 656e 6365 2c20 6d65 7472 6963  patience, metric
+0001e890: 3d6d 6574 7269 632c 206d 6574 7269 6332  =metric, metric2
+0001e8a0: 3d6d 6574 7269 6332 2c20 6176 6572 6167  =metric2, averag
+0001e8b0: 653d 6176 6572 6167 652c 2020 0a20 2020  e=average,  .   
+0001e8c0: 2020 2020 2020 2020 2074 6573 745f 706f           test_po
+0001e8d0: 7369 7469 7665 3d74 6573 745f 706f 7369  sitive=test_posi
+0001e8e0: 7469 7665 2c20 7465 7374 5f6e 6567 6174  tive, test_negat
+0001e8f0: 6976 653d 7465 7374 5f6e 6567 6174 6976  ive=test_negativ
+0001e900: 652c 2074 6573 745f 6163 635f 7468 7265  e, test_acc_thre
+0001e910: 7368 6f6c 643d 7465 7374 5f61 6363 5f74  shold=test_acc_t
+0001e920: 6872 6573 686f 6c64 2c20 706f 7374 5f6d  hreshold, post_m
+0001e930: 6574 7269 633d 706f 7374 5f6d 6574 7269  etric=post_metri
+0001e940: 632c 206f 7074 5f6d 6f64 656c 3d6f 7074  c, opt_model=opt
+0001e950: 5f6d 6f64 656c 2c20 6261 7463 685f 7369  _model, batch_si
+0001e960: 7a65 5f6d 696e 3d62 6174 6368 5f73 697a  ze_min=batch_siz
+0001e970: 655f 6d69 6e2c 2062 6174 6368 5f73 697a  e_min, batch_siz
+0001e980: 655f 6d61 783d 6261 7463 685f 7369 7a65  e_max=batch_size
+0001e990: 5f6d 6178 2c20 0a20 2020 2020 2020 2020  _max, .         
+0001e9a0: 2020 2074 7261 696e 5f65 706f 6368 733d     train_epochs=
+0001e9b0: 7472 6169 6e5f 6570 6f63 6873 2c20 6f70  train_epochs, op
+0001e9c0: 745f 6376 3d6f 7074 5f63 762c 206f 7074  t_cv=opt_cv, opt
+0001e9d0: 5f61 7567 3d6f 7074 5f61 7567 2c20 6261  _aug=opt_aug, ba
+0001e9e0: 7463 685f 6d69 6e3d 6261 7463 685f 6d69  tch_min=batch_mi
+0001e9f0: 6e2c 2062 6174 6368 5f6d 6178 3d62 6174  n, batch_max=bat
+0001ea00: 6368 5f6d 6178 2c20 6261 7463 685f 6f74  ch_max, batch_ot
+0001ea10: 6865 723d 6261 7463 685f 6f74 6865 722c  her=batch_other,
+0001ea20: 2062 616c 616e 6365 3d62 616c 616e 6365   balance=balance
+0001ea30: 2c20 696d 6167 655f 7369 7a65 5f6d 696e  , image_size_min
+0001ea40: 3d69 6d61 6765 5f73 697a 655f 6d69 6e2c  =image_size_min,
+0001ea50: 2069 6d61 6765 5f73 697a 655f 6d61 783d   image_size_max=
+0001ea60: 696d 6167 655f 7369 7a65 5f6d 6178 2c20  image_size_max, 
+0001ea70: 0a20 2020 2020 2020 2020 2020 2073 6869  .            shi
+0001ea80: 6674 3d73 6869 6674 2c20 6f70 745f 6d61  ft=shift, opt_ma
+0001ea90: 785f 6d69 6e5f 7069 783d 6f70 745f 6d61  x_min_pix=opt_ma
+0001eaa0: 785f 6d69 6e5f 7069 782c 206f 7074 5f6d  x_min_pix, opt_m
+0001eab0: 6178 5f6d 6178 5f70 6978 3d6f 7074 5f6d  ax_max_pix=opt_m
+0001eac0: 6178 5f6d 6178 5f70 6978 2c20 6d61 736b  ax_max_pix, mask
+0001ead0: 5f73 697a 653d 6d61 736b 5f73 697a 652c  _size=mask_size,
+0001eae0: 206e 756d 5f6d 6173 6b73 3d6e 756d 5f6d   num_masks=num_m
+0001eaf0: 6173 6b73 2c20 736d 6f74 655f 7361 6d70  asks, smote_samp
+0001eb00: 6c69 6e67 3d73 6d6f 7465 5f73 616d 706c  ling=smote_sampl
+0001eb10: 696e 672c 200a 2020 2020 2020 2020 2020  ing, .          
+0001eb20: 2020 626c 656e 645f 6d61 783d 626c 656e    blend_max=blen
+0001eb30: 645f 6d61 782c 206e 756d 5f69 6d61 6765  d_max, num_image
+0001eb40: 735f 746f 5f62 6c65 6e64 3d6e 756d 5f69  s_to_blend=num_i
+0001eb50: 6d61 6765 735f 746f 5f62 6c65 6e64 2c20  mages_to_blend, 
+0001eb60: 626c 656e 6469 6e67 5f66 756e 633d 626c  blending_func=bl
+0001eb70: 656e 6469 6e67 5f66 756e 632c 2062 6c65  ending_func, ble
+0001eb80: 6e64 5f6f 7468 6572 3d62 6c65 6e64 5f6f  nd_other=blend_o
+0001eb90: 7468 6572 2c20 7a6f 6f6d 5f72 616e 6765  ther, zoom_range
+0001eba0: 3d7a 6f6f 6d5f 7261 6e67 652c 2073 6b65  =zoom_range, ske
+0001ebb0: 775f 616e 676c 653d 736b 6577 5f61 6e67  w_angle=skew_ang
+0001ebc0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+0001ebd0: 6c69 6d69 745f 7365 6172 6368 3d6c 696d  limit_search=lim
+0001ebe0: 6974 5f73 6561 7263 682c 206d 6f6e 6974  it_search, monit
+0001ebf0: 6f72 313d 6d6f 6e69 746f 7231 2c20 6d6f  or1=monitor1, mo
+0001ec00: 6e69 746f 7232 3d6d 6f6e 6974 6f72 322c  nitor2=monitor2,
+0001ec10: 206d 6f6e 6974 6f72 315f 7468 7265 7368   monitor1_thresh
+0001ec20: 3d6d 6f6e 6974 6f72 315f 7468 7265 7368  =monitor1_thresh
+0001ec30: 2c20 6d6f 6e69 746f 7232 5f74 6872 6573  , monitor2_thres
+0001ec40: 683d 6d6f 6e69 746f 7232 5f74 6872 6573  h=monitor2_thres
+0001ec50: 682c 2076 6572 626f 7365 3d76 6572 626f  h, verbose=verbo
+0001ec60: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0001ec70: 7361 7665 5f6d 6f64 656c 733d 7361 7665  save_models=save
+0001ec80: 5f6d 6f64 656c 732c 2073 6176 655f 7374  _models, save_st
+0001ec90: 7564 6965 733d 7361 7665 5f73 7475 6469  udies=save_studi
+0001eca0: 6573 2c20 7061 7468 3d70 6174 6829 2020  es, path=path)  
+0001ecb0: 2020 2020 0a20 2020 2020 2020 2023 7374      .        #st
+0001ecc0: 7564 795f 7374 6f70 5f63 6220 3d20 5374  udy_stop_cb = St
+0001ecd0: 6f70 5768 656e 5472 6961 6c4b 6565 7042  opWhenTrialKeepB
+0001ece0: 6569 6e67 5072 756e 6564 4361 6c6c 6261  eingPrunedCallba
+0001ecf0: 636b 2870 7275 6e65 5f74 6872 6573 686f  ck(prune_thresho
+0001ed00: 6c64 290a 2020 2020 2020 2020 7374 7564  ld).        stud
+0001ed10: 792e 6f70 7469 6d69 7a65 286f 626a 6563  y.optimize(objec
+0001ed20: 7469 7665 2c20 6e5f 7472 6961 6c73 3d6e  tive, n_trials=n
+0001ed30: 5f69 7465 722c 2073 686f 775f 7072 6f67  _iter, show_prog
+0001ed40: 7265 7373 5f62 6172 3d54 7275 652c 2067  ress_bar=True, g
+0001ed50: 635f 6166 7465 725f 7472 6961 6c3d 5472  c_after_trial=Tr
+0001ed60: 7565 2923 2063 616c 6c62 6163 6b73 3d5b  ue)# callbacks=[
+0001ed70: 7374 7564 795f 7374 6f70 5f63 625d 292c  study_stop_cb]),
+0001ed80: 206e 5f6a 6f62 733d 3129 0a20 2020 2020   n_jobs=1).     
+0001ed90: 2020 2070 6172 616d 7320 3d20 7374 7564     params = stud
+0001eda0: 792e 6265 7374 5f74 7269 616c 2e70 6172  y.best_trial.par
+0001edb0: 616d 730a 0a20 2020 2066 696e 616c 5f73  ams..    final_s
+0001edc0: 636f 7265 203d 2073 7475 6479 2e62 6573  core = study.bes
+0001edd0: 745f 7661 6c75 650a 0a20 2020 2069 6620  t_value..    if 
+0001ede0: 636c 6620 3d3d 2027 7266 2720 6f72 2063  clf == 'rf' or c
+0001edf0: 6c66 203d 3d20 2778 6762 2720 6f72 2063  lf == 'xgb' or c
+0001ee00: 6c66 203d 3d20 276e 6e27 3a0a 2020 2020  lf == 'nn':.    
+0001ee10: 2020 2020 6966 2069 6e69 7469 616c 5f73      if initial_s
+0001ee20: 636f 7265 203e 2066 696e 616c 5f73 636f  core > final_sco
+0001ee30: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
+0001ee40: 7072 696e 7428 2748 7970 6572 7061 7261  print('Hyperpara
+0001ee50: 6d65 7465 7220 6f70 7469 6d69 7a61 7469  meter optimizati
+0001ee60: 6f6e 2063 6f6d 706c 6574 6521 204f 7074  on complete! Opt
+0001ee70: 696d 616c 2070 6572 666f 726d 616e 6365  imal performance
+0001ee80: 206f 6620 7b7d 2069 7320 4c4f 5745 5220   of {} is LOWER 
+0001ee90: 7468 616e 2074 6865 2062 6173 6520 7065  than the base pe
+0001eea0: 7266 6f72 6d61 6e63 6520 6f66 207b 7d2c  rformance of {},
+0001eeb0: 2074 7279 2069 6e63 7265 6173 696e 6720   try increasing 
+0001eec0: 7468 6520 7661 6c75 6520 6f66 206e 5f69  the value of n_i
+0001eed0: 7465 7220 616e 6420 7275 6e20 6167 6169  ter and run agai
+0001eee0: 6e2e 272e 666f 726d 6174 286e 702e 726f  n.'.format(np.ro
+0001eef0: 756e 6428 6669 6e61 6c5f 7363 6f72 652c  und(final_score,
+0001ef00: 2038 292c 206e 702e 726f 756e 6428 696e   8), np.round(in
+0001ef10: 6974 6961 6c5f 7363 6f72 652c 2038 2929  itial_score, 8))
+0001ef20: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0001ef30: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001ef40: 7428 2748 7970 6572 7061 7261 6d65 7465  t('Hyperparamete
+0001ef50: 7220 6f70 7469 6d69 7a61 7469 6f6e 2063  r optimization c
+0001ef60: 6f6d 706c 6574 6521 204f 7074 696d 616c  omplete! Optimal
+0001ef70: 2070 6572 666f 726d 616e 6365 206f 6620   performance of 
+0001ef80: 7b7d 2069 7320 4849 4748 4552 2074 6861  {} is HIGHER tha
+0001ef90: 6e20 7468 6520 6261 7365 2070 6572 666f  n the base perfo
+0001efa0: 726d 616e 6365 206f 6620 7b7d 2e27 2e66  rmance of {}.'.f
+0001efb0: 6f72 6d61 7428 6e70 2e72 6f75 6e64 2866  ormat(np.round(f
+0001efc0: 696e 616c 5f73 636f 7265 2c20 3829 2c20  inal_score, 8), 
+0001efd0: 6e70 2e72 6f75 6e64 2869 6e69 7469 616c  np.round(initial
+0001efe0: 5f73 636f 7265 2c20 3829 2929 0a20 2020  _score, 8))).   
+0001eff0: 2020 2020 2069 6620 7265 7475 726e 5f73       if return_s
+0001f000: 7475 6479 3a0a 2020 2020 2020 2020 2020  tudy:.          
+0001f010: 2020 7265 7475 726e 206d 6f64 656c 2c20    return model, 
+0001f020: 7061 7261 6d73 2c20 7374 7564 790a 2020  params, study.  
+0001f030: 2020 2020 2020 7265 7475 726e 206d 6f64        return mod
+0001f040: 656c 2c20 7061 7261 6d73 0a20 2020 2065  el, params.    e
+0001f050: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
+0001f060: 6e74 2827 4879 7065 7270 6172 616d 6574  nt('Hyperparamet
+0001f070: 6572 206f 7074 696d 697a 6174 696f 6e20  er optimization 
+0001f080: 636f 6d70 6c65 7465 2120 4f70 7469 6d61  complete! Optima
+0001f090: 6c20 7065 7266 6f72 6d61 6e63 653a 207b  l performance: {
+0001f0a0: 7d27 2e66 6f72 6d61 7428 6e70 2e72 6f75  }'.format(np.rou
+0001f0b0: 6e64 2866 696e 616c 5f73 636f 7265 2c20  nd(final_score, 
+0001f0c0: 3829 2929 0a20 2020 2020 2020 2069 6620  8))).        if 
+0001f0d0: 7265 7475 726e 5f73 7475 6479 3a0a 2020  return_study:.  
+0001f0e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f0f0: 2070 6172 616d 732c 2073 7475 6479 0a20   params, study. 
+0001f100: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+0001f110: 7261 6d73 0a0a 6465 6620 626f 7275 7461  rams..def boruta
+0001f120: 7368 6170 5f6f 7074 2864 6174 615f 782c  shap_opt(data_x,
+0001f130: 2064 6174 615f 792c 2062 6f72 7574 615f   data_y, boruta_
+0001f140: 7472 6961 6c73 3d35 302c 206d 6f64 656c  trials=50, model
+0001f150: 3d27 7266 272c 2069 6d70 6f72 7461 6e63  ='rf', importanc
+0001f160: 655f 7479 7065 3d27 6761 696e 2729 3a0a  e_type='gain'):.
+0001f170: 2020 2020 2222 220a 2020 2020 4170 706c      """.    Appl
+0001f180: 6965 7320 6120 636f 6d62 696e 6174 696f  ies a combinatio
+0001f190: 6e20 6f66 2074 6865 2042 6f72 7574 6120  n of the Boruta 
+0001f1a0: 616c 676f 7269 7468 6d20 616e 640a 2020  algorithm and.  
+0001f1b0: 2020 5368 6170 6c65 7920 7661 6c75 6573    Shapley values
+0001f1c0: 2c20 6120 6d65 7468 6f64 2064 6576 656c  , a method devel
+0001f1d0: 6f70 6564 2062 7920 456f 6768 616e 204b  oped by Eoghan K
+0001f1e0: 6561 6e79 2028 3230 3230 292e 0a0a 2020  eany (2020)...  
+0001f1f0: 2020 5365 653a 2068 7474 7073 3a2f 2f64    See: https://d
+0001f200: 6f69 2e6f 7267 2f31 302e 3532 3831 2f7a  oi.org/10.5281/z
+0001f210: 656e 6f64 6f2e 3432 3437 3631 380a 0a20  enodo.4247618.. 
+0001f220: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0001f230: 2064 6174 615f 7820 286e 6461 7272 6179   data_x (ndarray
+0001f240: 293a 2032 4420 6172 7261 7920 6f66 2073  ): 2D array of s
+0001f250: 697a 6520 286e 2078 206d 292c 2077 6865  ize (n x m), whe
+0001f260: 7265 206e 2069 7320 7468 650a 2020 2020  re n is the.    
+0001f270: 2020 2020 2020 2020 6e75 6d62 6572 206f          number o
+0001f280: 6620 7361 6d70 6c65 732c 2061 6e64 206d  f samples, and m
+0001f290: 2074 6865 206e 756d 6265 7220 6f66 2066   the number of f
+0001f2a0: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
+0001f2b0: 2064 6174 615f 7920 286e 6461 7272 6179   data_y (ndarray
+0001f2c0: 2c20 7374 7229 3a20 3144 2061 7272 6179  , str): 1D array
+0001f2d0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+0001f2e0: 636f 7272 6573 706f 6e69 6e67 206c 6162  corresponing lab
+0001f2f0: 656c 732e 0a20 2020 2020 2020 2062 6f72  els..        bor
+0001f300: 7574 615f 7472 6961 6c73 2028 696e 7429  uta_trials (int)
+0001f310: 3a20 5468 6520 6e75 6d62 6572 206f 6620  : The number of 
+0001f320: 7472 6961 6c73 2074 6f20 7275 6e2e 2041  trials to run. A
+0001f330: 206c 6172 6765 7220 6e75 6d62 6572 2069   larger number i
+0001f340: 730a 2020 2020 2020 2020 2020 2020 6265  s.            be
+0001f350: 7474 6572 2061 7320 7468 6520 6469 7374  tter as the dist
+0001f360: 7269 6275 7469 6f6e 2077 696c 6c20 6265  ribution will be
+0001f370: 206d 6f72 6520 726f 6275 7374 2074 6f20   more robust to 
+0001f380: 7261 6e64 6f6d 2066 6c75 6374 7561 7469  random fluctuati
+0001f390: 6f6e 732e 200a 2020 2020 2020 2020 2020  ons. .          
+0001f3a0: 2020 4465 6661 756c 7473 2074 6f20 3530    Defaults to 50
+0001f3b0: 2e0a 2020 2020 2020 2020 6d6f 6465 6c20  ..        model 
+0001f3c0: 2873 7472 293a 2054 6865 2065 6e73 656d  (str): The ensem
+0001f3d0: 626c 6520 6d65 7468 6f64 2074 6f20 7573  ble method to us
+0001f3e0: 6520 7768 656e 2066 6974 7469 6e67 2061  e when fitting a
+0001f3f0: 6e64 2063 616c 6375 6c61 7469 6e67 0a20  nd calculating. 
+0001f400: 2020 2020 2020 2020 2020 2074 6865 2066             the f
+0001f410: 6561 7475 7265 2069 6d70 6f72 7461 6e63  eature importanc
+0001f420: 6520 6d65 7472 6963 2e20 4f6e 6c79 2074  e metric. Only t
+0001f430: 776f 206f 7074 696f 6e73 2061 7265 2063  wo options are c
+0001f440: 7572 7265 6e74 6c79 0a20 2020 2020 2020  urrently.       
+0001f450: 2020 2020 2073 7570 706f 7274 6564 2c20       supported, 
+0001f460: 2772 6627 2066 6f72 2052 616e 646f 6d20  'rf' for Random 
+0001f470: 466f 7265 7374 2061 6e64 2027 7867 6227  Forest and 'xgb'
+0001f480: 2066 6f72 2045 7874 7265 6d65 2047 7261   for Extreme Gra
+0001f490: 6469 656e 7420 426f 6f73 7469 6e67 2e0a  dient Boosting..
+0001f4a0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+0001f4b0: 756c 7473 2074 6f20 2772 6627 2e0a 2020  ults to 'rf'..  
+0001f4c0: 2020 2020 2020 696d 706f 7274 616e 6365        importance
+0001f4d0: 5f74 7970 6520 2873 7472 293a 2054 6865  _type (str): The
+0001f4e0: 2066 6561 7475 7265 2069 6d70 6f72 7461   feature importa
+0001f4f0: 6e63 6520 7479 7065 2074 6f20 7573 652c  nce type to use,
+0001f500: 206f 6e6c 7920 6170 706c 6963 6162 6c65   only applicable
+0001f510: 0a20 2020 2020 2020 2020 2020 2077 6865  .            whe
+0001f520: 6e20 7573 696e 6720 636c 663d 2778 6762  n using clf='xgb
+0001f530: 272e 2054 6865 206f 7074 696f 6e73 2069  '. The options i
+0001f540: 6e63 6c75 6465 20e2 809c 6761 696e e280  nclude ...gain..
+0001f550: 9d2c 20e2 809c 7765 6967 6874 e280 9d2c  ., ...weight...,
+0001f560: 20e2 809c 636f 7665 72e2 809d 2c0a 2020   ...cover...,.  
+0001f570: 2020 2020 2020 2020 2020 e280 9c74 6f74            ...tot
+0001f580: 616c 5f67 6169 6ee2 809d 206f 7220 e280  al_gain... or ..
+0001f590: 9c74 6f74 616c 5f63 6f76 6572 e280 9d2e  .total_cover....
+0001f5a0: 2044 6566 6175 6c74 7320 746f 2027 6761   Defaults to 'ga
+0001f5b0: 696e 272e 0a0a 2020 2020 5265 7475 726e  in'...    Return
+0001f5c0: 733a 0a20 2020 2020 2020 2046 6972 7374  s:.        First
+0001f5d0: 206f 7574 7075 7420 6973 2061 2031 4420   output is a 1D 
+0001f5e0: 6172 7261 7920 636f 6e74 6169 6e69 6e67  array containing
+0001f5f0: 2074 6865 2069 6e64 6963 6573 206f 6620   the indices of 
+0001f600: 7468 6520 7365 6c65 6374 6564 2066 6561  the selected fea
+0001f610: 7475 7265 732e 200a 2020 2020 2020 2020  tures. .        
+0001f620: 5468 6573 6520 696e 6469 6365 7320 6361  These indices ca
+0001f630: 6e20 7468 656e 2062 6520 7573 6564 2074  n then be used t
+0001f640: 6f20 7365 6c65 6374 2074 6865 2063 6f6c  o select the col
+0001f650: 756d 6e73 2069 6e20 7468 6520 6461 7461  umns in the data
+0001f660: 5f78 2061 7272 6179 2e0a 2020 2020 2020  _x array..      
+0001f670: 2020 5365 636f 6e64 206f 7574 7075 7420    Second output 
+0001f680: 6973 2074 6865 2066 6561 7475 7265 2073  is the feature s
+0001f690: 656c 6563 7469 6f6e 206f 626a 6563 742c  election object,
+0001f6a0: 2077 6869 6368 2063 6f6e 7461 696e 7320   which contains 
+0001f6b0: 6665 6174 7572 6520 7365 6c65 6374 696f  feature selectio
+0001f6c0: 6e0a 2020 2020 2020 2020 6869 7374 6f72  n.        histor
+0001f6d0: 7920 696e 666f 726d 6174 696f 6e20 616e  y information an
+0001f6e0: 6420 7669 7375 616c 697a 6174 696f 6e20  d visualization 
+0001f6f0: 6f70 7469 6f6e 732e 0a20 2020 2022 2222  options..    """
+0001f700: 0a20 2020 200a 2020 2020 6966 2062 6f72  .    .    if bor
+0001f710: 7574 615f 7472 6961 6c73 203d 3d20 303a  uta_trials == 0:
+0001f720: 2023 5468 6973 2069 7320 7468 6520 666c   #This is the fl
+0001f730: 6167 2074 6861 7420 7468 6520 656e 7365  ag that the ense
+0001f740: 6d62 6c65 5f6d 6f64 656c 2e43 6c61 7373  mble_model.Class
+0001f750: 6966 6965 7220 636c 6173 7320 7573 6573  ifier class uses
+0001f760: 2074 6f20 6469 7361 626c 6520 6665 6174   to disable feat
+0001f770: 7572 6520 7365 6c65 6374 696f 6e0a 2020  ure selection.  
+0001f780: 2020 2020 2020 7265 7475 726e 206e 702e        return np.
+0001f790: 6172 616e 6765 2864 6174 615f 782e 7368  arange(data_x.sh
+0001f7a0: 6170 655b 315d 292c 204e 6f6e 650a 0a20  ape[1]), None.. 
+0001f7b0: 2020 2069 6620 626f 7275 7461 5f74 7269     if boruta_tri
+0001f7c0: 616c 7320 3c20 3230 3a0a 2020 2020 2020  als < 20:.      
+0001f7d0: 2020 7072 696e 7428 2757 4152 4e49 4e47    print('WARNING
+0001f7e0: 3a20 5265 7375 6c74 7320 6172 6520 756e  : Results are un
+0001f7f0: 7374 6162 6c65 2069 6620 626f 7275 7461  stable if boruta
+0001f800: 5f74 7269 616c 7320 6973 2074 6f6f 206c  _trials is too l
+0001f810: 6f77 2127 290a 2020 2020 6966 206e 702e  ow!').    if np.
+0001f820: 616e 7928 6e70 2e69 736e 616e 2864 6174  any(np.isnan(dat
+0001f830: 615f 7829 293a 0a20 2020 2020 2020 2023  a_x)):.        #
+0001f840: 7072 696e 7428 274e 614e 2076 616c 7565  print('NaN value
+0001f850: 7320 6465 7465 6374 6564 2c20 6170 706c  s detected, appl
+0001f860: 7969 6e67 2053 7472 6177 6d61 6e20 696d  ying Strawman im
+0001f870: 7075 7461 7469 6f6e 2e2e 2e27 290a 2020  putation...').  
+0001f880: 2020 2020 2020 6461 7461 5f78 203d 2053        data_x = S
+0001f890: 7472 6177 6d61 6e5f 696d 7075 7461 7469  trawman_imputati
+0001f8a0: 6f6e 2864 6174 615f 7829 0a0a 2020 2020  on(data_x)..    
+0001f8b0: 6966 206d 6f64 656c 203d 3d20 2772 6627  if model == 'rf'
+0001f8c0: 3a0a 2020 2020 2020 2020 636c 6173 7369  :.        classi
+0001f8d0: 6669 6572 203d 2052 616e 646f 6d46 6f72  fier = RandomFor
+0001f8e0: 6573 7443 6c61 7373 6966 6965 7228 7261  estClassifier(ra
+0001f8f0: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
+0001f900: 0a20 2020 2065 6c69 6620 6d6f 6465 6c20  .    elif model 
+0001f910: 3d3d 2027 7867 6227 3a0a 2020 2020 2020  == 'xgb':.      
+0001f920: 2020 636c 6173 7369 6669 6572 203d 2058    classifier = X
+0001f930: 4742 436c 6173 7369 6669 6572 2874 7265  GBClassifier(tre
+0001f940: 655f 6d65 7468 6f64 3d27 6578 6163 7427  e_method='exact'
+0001f950: 2c20 6d61 785f 6465 7074 683d 3230 2c20  , max_depth=20, 
+0001f960: 696d 706f 7274 616e 6365 5f74 7970 653d  importance_type=
+0001f970: 696d 706f 7274 616e 6365 5f74 7970 652c  importance_type,
+0001f980: 2072 616e 646f 6d5f 7374 6174 653d 3139   random_state=19
+0001f990: 3039 290a 2020 2020 656c 7365 3a0a 2020  09).    else:.  
+0001f9a0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0001f9b0: 6545 7272 6f72 2827 4d6f 6465 6c20 6172  eError('Model ar
+0001f9c0: 6775 6d65 6e74 206d 7573 7420 6569 7468  gument must eith
+0001f9d0: 6572 2062 6520 2272 6622 206f 7220 2278  er be "rf" or "x
+0001f9e0: 6762 222e 2729 0a20 2020 200a 2020 2020  gb".').    .    
+0001f9f0: 7472 793a 0a20 2020 2020 2020 2023 426f  try:.        #Bo
+0001fa00: 7275 7461 5368 6170 2070 726f 6772 616d  rutaShap program
+0001fa10: 2072 6571 7569 7265 7320 696e 7075 7420   requires input 
+0001fa20: 746f 2068 6176 6520 7468 6520 636f 6c75  to have the colu
+0001fa30: 6d6e 7320 6174 7472 6962 7574 650a 2020  mns attribute.  
+0001fa40: 2020 2020 2020 2343 6f6e 7665 7274 696e        #Convertin
+0001fa50: 6720 746f 2050 616e 6461 7320 6461 7461  g to Pandas data
+0001fa60: 6672 616d 650a 2020 2020 2020 2020 636f  frame.        co
+0001fa70: 6c73 203d 205b 7374 7228 6929 2066 6f72  ls = [str(i) for
+0001fa80: 2069 2069 6e20 6e70 2e61 7261 6e67 6528   i in np.arange(
+0001fa90: 6461 7461 5f78 2e73 6861 7065 5b31 5d29  data_x.shape[1])
+0001faa0: 5d0a 2020 2020 2020 2020 5820 3d20 4461  ].        X = Da
+0001fab0: 7461 4672 616d 6528 6461 7461 5f78 2c20  taFrame(data_x, 
+0001fac0: 636f 6c75 6d6e 733d 636f 6c73 290a 2020  columns=cols).  
+0001fad0: 2020 2020 2020 7920 3d20 6e70 2e7a 6572        y = np.zer
+0001fae0: 6f73 286c 656e 2864 6174 615f 7929 290a  os(len(data_y)).
+0001faf0: 0a20 2020 2020 2020 2023 4265 6c6f 7720  .        #Below 
+0001fb00: 6973 2074 6f20 636f 6e76 6572 7420 6361  is to convert ca
+0001fb10: 7465 676f 7269 6361 6c20 6c61 6265 6c73  tegorical labels
+0001fb20: 2074 6f20 6e75 6d65 7269 6361 6c2c 2061   to numerical, a
+0001fb30: 7320 7065 7220 426f 7275 7461 5368 6170  s per BorutaShap
+0001fb40: 2072 6571 7569 7265 6d65 6e74 730a 2020   requirements.  
+0001fb50: 2020 2020 2020 666f 7220 692c 206c 6162        for i, lab
+0001fb60: 656c 2069 6e20 656e 756d 6572 6174 6528  el in enumerate(
+0001fb70: 6e70 2e75 6e69 7175 6528 6461 7461 5f79  np.unique(data_y
+0001fb80: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0001fb90: 6d61 736b 203d 206e 702e 7768 6572 6528  mask = np.where(
+0001fba0: 6461 7461 5f79 203d 3d20 6c61 6265 6c29  data_y == label)
+0001fbb0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0001fbc0: 795b 6d61 736b 5d20 3d20 690a 0a20 2020  y[mask] = i..   
+0001fbd0: 2020 2020 2066 6561 745f 7365 6c65 6374       feat_select
+0001fbe0: 6f72 203d 2042 6f72 7574 6153 6861 7028  or = BorutaShap(
+0001fbf0: 6d6f 6465 6c3d 636c 6173 7369 6669 6572  model=classifier
+0001fc00: 2c20 696d 706f 7274 616e 6365 5f6d 6561  , importance_mea
+0001fc10: 7375 7265 3d27 7368 6170 272c 2063 6c61  sure='shap', cla
+0001fc20: 7373 6966 6963 6174 696f 6e3d 5472 7565  ssification=True
+0001fc30: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+0001fc40: 2752 756e 6e69 6e67 2066 6561 7475 7265  'Running feature
+0001fc50: 2073 656c 6563 7469 6f6e 2e2e 2e27 290a   selection...').
+0001fc60: 2020 2020 2020 2020 6665 6174 5f73 656c          feat_sel
+0001fc70: 6563 746f 722e 6669 7428 583d 582c 2079  ector.fit(X=X, y
+0001fc80: 3d79 2c20 6e5f 7472 6961 6c73 3d62 6f72  =y, n_trials=bor
+0001fc90: 7574 615f 7472 6961 6c73 2c20 7665 7262  uta_trials, verb
+0001fca0: 6f73 653d 4661 6c73 652c 2072 616e 646f  ose=False, rando
+0001fcb0: 6d5f 7374 6174 653d 3139 3039 290a 0a20  m_state=1909).. 
+0001fcc0: 2020 2020 2020 2069 6e64 6578 203d 206e         index = n
+0001fcd0: 702e 6172 7261 7928 5b69 6e74 2866 6561  p.array([int(fea
+0001fce0: 7429 2066 6f72 2066 6561 7420 696e 2066  t) for feat in f
+0001fcf0: 6561 745f 7365 6c65 6374 6f72 2e61 6363  eat_selector.acc
+0001fd00: 6570 7465 645d 290a 2020 2020 2020 2020  epted]).        
+0001fd10: 696e 6465 782e 736f 7274 2829 0a20 2020  index.sort().   
+0001fd20: 2020 2020 2070 7269 6e74 2827 4665 6174       print('Feat
+0001fd30: 7572 6520 7365 6c65 6374 696f 6e20 636f  ure selection co
+0001fd40: 6d70 6c65 7465 2c20 7b7d 2073 656c 6563  mplete, {} selec
+0001fd50: 7465 6420 6f75 7420 6f66 207b 7d21 272e  ted out of {}!'.
+0001fd60: 666f 726d 6174 286c 656e 2869 6e64 6578  format(len(index
+0001fd70: 292c 2064 6174 615f 782e 7368 6170 655b  ), data_x.shape[
+0001fd80: 315d 2929 0a20 2020 2065 7863 6570 743a  1])).    except:
+0001fd90: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+0001fda0: 426f 7275 7461 2077 6974 6820 5368 6170  Boruta with Shap
+0001fdb0: 6c65 7920 7661 6c75 6573 2066 6169 6c65  ley values faile
+0001fdc0: 642c 2073 7769 7463 6869 6e67 2074 6f20  d, switching to 
+0001fdd0: 6f72 6967 696e 616c 2042 6f72 7574 612e  original Boruta.
+0001fde0: 2e2e 2729 0a20 2020 2020 2020 2069 6e64  ..').        ind
+0001fdf0: 6578 203d 2062 6f72 7574 615f 6f70 7428  ex = boruta_opt(
+0001fe00: 6461 7461 5f78 2c20 6461 7461 5f79 290a  data_x, data_y).
+0001fe10: 0a20 2020 2072 6574 7572 6e20 696e 6465  .    return inde
+0001fe20: 782c 2066 6561 745f 7365 6c65 6374 6f72  x, feat_selector
+0001fe30: 0a0a 6465 6620 626f 7275 7461 5f6f 7074  ..def boruta_opt
+0001fe40: 2864 6174 615f 782c 2064 6174 615f 7929  (data_x, data_y)
+0001fe50: 3a0a 2020 2020 2222 220a 2020 2020 4170  :.    """.    Ap
+0001fe60: 706c 6965 7320 7468 6520 426f 7275 7461  plies the Boruta
+0001fe70: 2061 6c67 6f72 6974 686d 2028 4b75 7273   algorithm (Kurs
+0001fe80: 6120 2620 5275 646e 6963 6b69 2032 3031  a & Rudnicki 201
+0001fe90: 3129 2074 6f20 6964 656e 7469 6679 2066  1) to identify f
+0001fea0: 6561 7475 7265 730a 2020 2020 7468 6174  eatures.    that
+0001feb0: 2070 6572 666f 726d 2077 6f72 7365 2074   perform worse t
+0001fec0: 6861 6e20 7261 6e64 6f6d 2e0a 0a20 2020  han random...   
+0001fed0: 2053 6565 3a20 6874 7470 733a 2f2f 6172   See: https://ar
+0001fee0: 7869 762e 6f72 672f 7064 662f 3131 3036  xiv.org/pdf/1106
+0001fef0: 2e35 3131 322e 7064 660a 0a20 2020 2041  .5112.pdf..    A
+0001ff00: 7267 733a 0a20 2020 2020 2020 2064 6174  rgs:.        dat
+0001ff10: 615f 7820 286e 6461 7272 6179 293a 2032  a_x (ndarray): 2
+0001ff20: 4420 6172 7261 7920 6f66 2073 697a 6520  D array of size 
+0001ff30: 286e 2078 206d 292c 2077 6865 7265 206e  (n x m), where n
+0001ff40: 2069 7320 7468 650a 2020 2020 2020 2020   is the.        
+0001ff50: 2020 2020 6e75 6d62 6572 206f 6620 7361      number of sa
+0001ff60: 6d70 6c65 732c 2061 6e64 206d 2074 6865  mples, and m the
+0001ff70: 206e 756d 6265 7220 6f66 2066 6561 7475   number of featu
+0001ff80: 7265 732e 0a20 2020 2020 2020 2064 6174  res..        dat
+0001ff90: 615f 7920 286e 6461 7272 6179 2c20 7374  a_y (ndarray, st
+0001ffa0: 7229 3a20 3144 2061 7272 6179 2063 6f6e  r): 1D array con
+0001ffb0: 7461 696e 696e 6720 7468 6520 636f 7272  taining the corr
+0001ffc0: 6573 706f 6e69 6e67 206c 6162 656c 732e  esponing labels.
+0001ffd0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0001ffe0: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+0001fff0: 2020 2031 4420 6172 7261 7920 636f 6e74     1D array cont
+00020000: 6169 6e69 6e67 2074 6865 2069 6e64 6963  aining the indic
+00020010: 6573 206f 6620 7468 6520 7365 6c65 6374  es of the select
+00020020: 6564 2066 6561 7475 7265 732e 2054 6869  ed features. Thi
+00020030: 7320 6361 6e20 7468 656e 0a20 2020 2020  s can then.     
+00020040: 2020 2062 6520 7573 6564 2074 6f20 696e     be used to in
+00020050: 6465 7820 7468 6520 636f 6c75 6d6e 7320  dex the columns 
+00020060: 696e 2074 6865 2064 6174 615f 7820 6172  in the data_x ar
+00020070: 7261 792e 0a20 2020 2022 2222 0a0a 2020  ray..    """..  
+00020080: 2020 636c 6173 7369 6669 6572 203d 2052    classifier = R
+00020090: 616e 646f 6d46 6f72 6573 7443 6c61 7373  andomForestClass
+000200a0: 6966 6965 7228 7261 6e64 6f6d 5f73 7461  ifier(random_sta
+000200b0: 7465 3d31 3930 3929 0a0a 2020 2020 6665  te=1909)..    fe
+000200c0: 6174 5f73 656c 6563 746f 7220 3d20 426f  at_selector = Bo
+000200d0: 7275 7461 5079 2863 6c61 7373 6966 6965  rutaPy(classifie
+000200e0: 722c 206e 5f65 7374 696d 6174 6f72 733d  r, n_estimators=
+000200f0: 2761 7574 6f27 2c20 7261 6e64 6f6d 5f73  'auto', random_s
+00020100: 7461 7465 3d31 3930 3929 0a20 2020 2070  tate=1909).    p
+00020110: 7269 6e74 2827 5275 6e6e 696e 6720 6665  rint('Running fe
+00020120: 6174 7572 6520 7365 6c65 6374 696f 6e2e  ature selection.
+00020130: 2e2e 2729 0a20 2020 2066 6561 745f 7365  ..').    feat_se
+00020140: 6c65 6374 6f72 2e66 6974 2864 6174 615f  lector.fit(data_
+00020150: 782c 2064 6174 615f 7929 0a0a 2020 2020  x, data_y)..    
+00020160: 6665 6174 7320 3d20 6e70 2e61 7272 6179  feats = np.array
+00020170: 285b 7374 7228 6665 6174 2920 666f 7220  ([str(feat) for 
+00020180: 6665 6174 2069 6e20 6665 6174 5f73 656c  feat in feat_sel
+00020190: 6563 746f 722e 7375 7070 6f72 745f 5d29  ector.support_])
+000201a0: 0a20 2020 2069 6e64 6578 203d 206e 702e  .    index = np.
+000201b0: 7768 6572 6528 6665 6174 7320 3d3d 2027  where(feats == '
+000201c0: 5472 7565 2729 5b30 5d0a 2020 2020 7072  True')[0].    pr
+000201d0: 696e 7428 2746 6561 7475 7265 2073 656c  int('Feature sel
+000201e0: 6563 7469 6f6e 2063 6f6d 706c 6574 652c  ection complete,
+000201f0: 207b 7d20 7365 6c65 6374 6564 206f 7574   {} selected out
+00020200: 206f 6620 7b7d 2127 2e66 6f72 6d61 7428   of {}!'.format(
+00020210: 6c65 6e28 696e 6465 7829 2c6c 656e 2866  len(index),len(f
+00020220: 6561 745f 7365 6c65 6374 6f72 2e73 7570  eat_selector.sup
+00020230: 706f 7274 2929 290a 2020 2020 7265 7475  port))).    retu
+00020240: 726e 2069 6e64 6578 0a0a 6465 6620 5374  rn index..def St
+00020250: 7261 776d 616e 5f69 6d70 7574 6174 696f  rawman_imputatio
+00020260: 6e28 6461 7461 293a 0a20 2020 2022 2222  n(data):.    """
+00020270: 0a20 2020 2050 6572 666f 726d 2053 7472  .    Perform Str
+00020280: 6177 6d61 6e20 696d 7075 7461 7469 6f6e  awman imputation
+00020290: 2c20 6120 7469 6d65 2d65 6666 6963 6965  , a time-efficie
+000202a0: 6e74 2061 6c67 6f72 6974 686d 0a20 2020  nt algorithm.   
+000202b0: 2069 6e20 7768 6963 6820 6d69 7373 696e   in which missin
+000202c0: 6720 6461 7461 2076 616c 7565 7320 6172  g data values ar
+000202d0: 6520 7265 706c 6163 6564 2077 6974 6820  e replaced with 
+000202e0: 7468 6520 6d65 6469 616e 0a20 2020 2076  the median.    v
+000202f0: 616c 7565 206f 6620 7468 6520 656e 7469  alue of the enti
+00020300: 7265 2c20 6e6f 6e2d 4e61 4e20 7361 6d70  re, non-NaN samp
+00020310: 6c65 2e20 4966 2074 6865 2064 6174 6120  le. If the data 
+00020320: 6973 2061 2068 6f74 2d65 6e63 6f64 6564  is a hot-encoded
+00020330: 0a20 2020 2062 6f6f 6c65 616e 2028 6173  .    boolean (as
+00020340: 2074 6865 2052 4620 646f 6573 206e 6f74   the RF does not
+00020350: 2061 6c6c 6f77 2054 7275 6520 6f72 2046   allow True or F
+00020360: 616c 7365 292c 2074 6865 6e20 7468 6520  alse), then the 
+00020370: 0a20 2020 2069 6e73 7461 6e63 6520 7468  .    instance th
+00020380: 6174 2069 7320 7573 6564 2074 6865 206d  at is used the m
+00020390: 6f73 7420 7769 6c6c 2062 6520 636f 6d70  ost will be comp
+000203a0: 7574 6564 2061 7320 7468 6520 6d65 6469  uted as the medi
+000203b0: 616e 2e20 0a0a 2020 2020 5468 6973 2069  an. ..    This i
+000203c0: 7320 7468 6520 6261 7365 6c69 6e65 2061  s the baseline a
+000203d0: 6c67 6f72 6974 686d 2075 7365 6420 6279  lgorithm used by
+000203e0: 2028 5461 6e67 2026 2049 7368 7761 7261   (Tang & Ishwara
+000203f0: 6e20 3230 3137 292e 0a20 2020 2053 6565  n 2017)..    See
+00020400: 3a20 6874 7470 733a 2f2f 6172 7869 762e  : https://arxiv.
+00020410: 6f72 672f 7064 662f 3137 3031 2e30 3533  org/pdf/1701.053
+00020420: 3035 2e70 6466 0a0a 2020 2020 4e6f 7465  05.pdf..    Note
+00020430: 3a0a 2020 2020 2020 2020 5468 6973 2066  :.        This f
+00020440: 756e 6374 696f 6e20 6173 7375 6d65 7320  unction assumes 
+00020450: 6561 6368 2072 6f77 2063 6f72 7265 7370  each row corresp
+00020460: 6f6e 6473 2074 6f20 6f6e 6520 7361 6d70  onds to one samp
+00020470: 6c65 2c20 616e 6420 0a20 2020 2020 2020  le, and .       
+00020480: 2074 6861 7420 6d69 7373 696e 6720 7661   that missing va
+00020490: 6c75 6573 2061 7265 206d 6173 6b65 6420  lues are masked 
+000204a0: 6173 2065 6974 6865 7220 4e61 4e20 6f72  as either NaN or
+000204b0: 2069 6e66 2e20 0a0a 2020 2020 4172 6773   inf. ..    Args
+000204c0: 3a0a 2020 2020 2020 2020 6461 7461 2028  :.        data (
+000204d0: 6e64 6172 7261 7929 3a20 3144 2061 7272  ndarray): 1D arr
+000204e0: 6179 2069 6620 7369 6e67 6c65 2070 6172  ay if single par
+000204f0: 616d 6574 6572 2069 7320 696e 7075 742e  ameter is input.
+00020500: 2049 660a 2020 2020 2020 2020 2020 2020   If.            
+00020510: 6461 7461 2069 7320 322d 6469 6d65 6e73  data is 2-dimens
+00020520: 696f 6e61 6c2c 2074 6865 206d 6564 6961  ional, the media
+00020530: 6e73 2077 696c 6c20 6265 2063 616c 6375  ns will be calcu
+00020540: 6c61 7465 640a 2020 2020 2020 2020 2020  lated.          
+00020550: 2020 7573 696e 6720 7468 6520 6e6f 6e2d    using the non-
+00020560: 6d69 7373 696e 6720 7661 6c75 6573 2069  missing values i
+00020570: 6e20 6561 6368 2063 6f72 7265 7370 6f6e  n each correspon
+00020580: 6469 6e67 2063 6f6c 756d 6e2e 0a0a 2020  ding column...  
+00020590: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+000205a0: 2020 2054 6865 2064 6174 6120 6172 7261     The data arra
+000205b0: 7920 7769 7468 2074 6865 206d 6973 7369  y with the missi
+000205c0: 6e67 2076 616c 7565 7320 6669 6c6c 6564  ng values filled
+000205d0: 2069 6e2e 200a 2020 2020 2222 220a 0a20   in. .    """.. 
+000205e0: 2020 2069 6620 6e70 2e61 6c6c 286e 702e     if np.all(np.
+000205f0: 6973 6669 6e69 7465 2864 6174 6129 293a  isfinite(data)):
+00020600: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+00020610: 4e6f 206d 6973 7369 6e67 2076 616c 7565  No missing value
+00020620: 7320 696e 2064 6174 612c 2072 6574 7572  s in data, retur
+00020630: 6e69 6e67 206f 7269 6769 6e61 6c20 6172  ning original ar
+00020640: 7261 792e 2729 0a20 2020 2020 2020 2072  ray.').        r
+00020650: 6574 7572 6e20 6461 7461 200a 0a20 2020  eturn data ..   
+00020660: 2069 6620 6c65 6e28 6461 7461 2e73 6861   if len(data.sha
+00020670: 7065 2920 3d3d 2031 3a0a 2020 2020 2020  pe) == 1:.      
+00020680: 2020 6d61 736b 203d 206e 702e 7768 6572    mask = np.wher
+00020690: 6528 6e70 2e69 7366 696e 6974 6528 6461  e(np.isfinite(da
+000206a0: 7461 2929 5b30 5d0a 2020 2020 2020 2020  ta))[0].        
+000206b0: 6d65 6469 616e 203d 206e 702e 6d65 6469  median = np.medi
+000206c0: 616e 2864 6174 615b 6d61 736b 5d29 0a20  an(data[mask]). 
+000206d0: 2020 2020 2020 2064 6174 615b 6e70 2e69         data[np.i
+000206e0: 736e 616e 2864 6174 6129 5d20 3d20 6d65  snan(data)] = me
+000206f0: 6469 616e 200a 0a20 2020 2020 2020 2072  dian ..        r
+00020700: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
+00020710: 4e79 2c20 4e78 203d 2064 6174 612e 7368  Ny, Nx = data.sh
+00020720: 6170 650a 2020 2020 696d 7075 7465 645f  ape.    imputed_
+00020730: 6461 7461 203d 206e 702e 7a65 726f 7328  data = np.zeros(
+00020740: 284e 792c 4e78 2929 0a0a 2020 2020 666f  (Ny,Nx))..    fo
+00020750: 7220 6920 696e 2072 616e 6765 284e 7829  r i in range(Nx)
+00020760: 3a0a 2020 2020 2020 2020 6d61 736b 203d  :.        mask =
+00020770: 206e 702e 7768 6572 6528 6e70 2e69 7366   np.where(np.isf
+00020780: 696e 6974 6528 6461 7461 5b3a 2c69 5d29  inite(data[:,i])
+00020790: 295b 305d 0a20 2020 2020 2020 206d 6564  )[0].        med
+000207a0: 6961 6e20 3d20 6e70 2e6d 6564 6961 6e28  ian = np.median(
+000207b0: 6461 7461 5b3a 2c69 5d5b 6d61 736b 5d29  data[:,i][mask])
+000207c0: 0a0a 2020 2020 2020 2020 666f 7220 6a20  ..        for j 
+000207d0: 696e 2072 616e 6765 284e 7929 3a0a 2020  in range(Ny):.  
+000207e0: 2020 2020 2020 2020 2020 6966 206e 702e            if np.
+000207f0: 6973 6e61 6e28 6461 7461 5b6a 2c69 5d29  isnan(data[j,i])
+00020800: 203d 3d20 5472 7565 206f 7220 6e70 2e69   == True or np.i
+00020810: 7369 6e66 2864 6174 615b 6a2c 695d 2920  sinf(data[j,i]) 
+00020820: 3d3d 2054 7275 653a 0a20 2020 2020 2020  == True:.       
+00020830: 2020 2020 2020 2020 2069 6d70 7574 6564           imputed
+00020840: 5f64 6174 615b 6a2c 695d 203d 206d 6564  _data[j,i] = med
+00020850: 6961 6e0a 2020 2020 2020 2020 2020 2020  ian.            
+00020860: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00020870: 2020 2020 2020 696d 7075 7465 645f 6461        imputed_da
+00020880: 7461 5b6a 2c69 5d20 3d20 6461 7461 5b6a  ta[j,i] = data[j
+00020890: 2c69 5d0a 0a20 2020 2072 6574 7572 6e20  ,i]..    return 
+000208a0: 696d 7075 7465 645f 6461 7461 200a 0a64  imputed_data ..d
+000208b0: 6566 204b 4e4e 5f69 6d70 7574 6174 696f  ef KNN_imputatio
+000208c0: 6e28 6461 7461 2c20 696d 7075 7465 723d  n(data, imputer=
+000208d0: 4e6f 6e65 2c20 6b3d 3329 3a0a 2020 2020  None, k=3):.    
+000208e0: 2222 220a 2020 2020 5065 7266 6f72 6d73  """.    Performs
+000208f0: 206b 2d4e 6561 7265 7374 204e 6569 6768   k-Nearest Neigh
+00020900: 626f 7220 696d 7075 7461 7469 6f6e 2061  bor imputation a
+00020910: 6e64 2074 7261 6e73 666f 726d 6174 696f  nd transformatio
+00020920: 6e2e 0a20 2020 2042 7920 6465 6661 756c  n..    By defaul
+00020930: 7420 7468 6520 696d 7075 7465 7220 7769  t the imputer wi
+00020940: 6c6c 2062 6520 6372 6561 7465 6420 616e  ll be created an
+00020950: 6420 7265 7475 726e 6564 2c20 756e 6c65  d returned, unle
+00020960: 7373 0a20 2020 2074 6865 2069 6d70 7574  ss.    the imput
+00020970: 6572 2061 7267 756d 656e 7420 6973 2073  er argument is s
+00020980: 6574 2c20 696e 2077 6869 6368 2063 6173  et, in which cas
+00020990: 6520 6f6e 6c79 2074 6865 2074 7261 6e73  e only the trans
+000209a0: 666f 726d 6564 0a20 2020 2064 6174 6120  formed.    data 
+000209b0: 6973 206f 7574 7075 742e 200a 0a20 2020  is output. ..   
+000209c0: 2041 7320 7468 6973 2062 756e 646c 6573   As this bundles
+000209d0: 206e 6569 6768 626f 7273 2061 6363 6f72   neighbors accor
+000209e0: 6469 6e67 2074 6f20 7468 6569 7220 6575  ding to their eu
+000209f0: 636c 6564 6961 6e20 6469 7374 616e 6365  cledian distance
+00020a00: 2c0a 2020 2020 6974 2069 7320 7365 6e73  ,.    it is sens
+00020a10: 6974 6976 6520 746f 206f 7574 6c69 6572  itive to outlier
+00020a20: 732e 2043 616e 2061 6c73 6f20 7969 656c  s. Can also yiel
+00020a30: 6420 7765 616b 2070 7265 6469 6374 696f  d weak predictio
+00020a40: 6e73 2069 6620 7468 650a 2020 2020 7472  ns if the.    tr
+00020a50: 6169 6e69 6e67 2066 6561 7475 7265 7320  aining features 
+00020a60: 6172 6520 6865 6176 696c 6979 2063 6f72  are heaviliy cor
+00020a70: 7265 6c61 7465 642e 0a20 2020 200a 2020  related..    .  
+00020a80: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00020a90: 696d 7075 7465 7220 286f 7074 696f 6e61  imputer (optiona
+00020aa0: 6c29 3a20 4120 4b4e 4e49 6d70 7574 6572  l): A KNNImputer
+00020ab0: 2063 6c61 7373 2069 6e73 7461 6e63 652c   class instance,
+00020ac0: 2063 6f6e 6669 6775 7265 6420 7573 696e   configured usin
+00020ad0: 6720 736b 6c65 6172 6e2e 696d 7075 7465  g sklearn.impute
+00020ae0: 2e4b 4e4e 496d 7075 7465 722e 0a20 2020  .KNNImputer..   
+00020af0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+00020b00: 7320 746f 204e 6f6e 652c 2069 6e20 7768  s to None, in wh
+00020b10: 6963 6820 6361 7365 2074 6865 2074 7261  ich case the tra
+00020b20: 6e73 666f 726d 6174 696f 6e20 6973 2063  nsformation is c
+00020b30: 7265 6174 6564 2075 7369 6e67 0a20 2020  reated using.   
+00020b40: 2020 2020 2020 2020 2074 6865 2064 6174           the dat
+00020b50: 6120 6974 7365 6c66 2e20 0a20 2020 2020  a itself. .     
+00020b60: 2020 2064 6174 6120 286e 6461 7272 6179     data (ndarray
+00020b70: 293a 2031 4420 6172 7261 7920 6966 2073  ): 1D array if s
+00020b80: 696e 676c 6520 7061 7261 6d65 7465 7220  ingle parameter 
+00020b90: 6973 2069 6e70 7574 2e20 4966 0a20 2020  is input. If.   
+00020ba0: 2020 2020 2020 2020 2064 6174 6120 6973           data is
+00020bb0: 2032 2d64 696d 656e 7369 6f6e 616c 2c20   2-dimensional, 
+00020bc0: 7468 6520 6d65 6469 616e 7320 7769 6c6c  the medians will
+00020bd0: 2062 6520 6361 6c63 756c 6174 6564 0a20   be calculated. 
+00020be0: 2020 2020 2020 2020 2020 2075 7369 6e67             using
+00020bf0: 2074 6865 206e 6f6e 2d6d 6973 7369 6e67   the non-missing
+00020c00: 2076 616c 7565 7320 696e 2065 6163 6820   values in each 
+00020c10: 636f 7272 6573 706f 6e64 696e 6720 636f  corresponding co
+00020c20: 6c75 6d6e 2e0a 2020 2020 2020 2020 6b20  lumn..        k 
+00020c30: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
+00020c40: 2049 6620 696d 7075 7465 7220 6973 204e   If imputer is N
+00020c50: 6f6e 652c 2074 6869 7320 6973 2074 6865  one, this is the
+00020c60: 206e 756d 6265 720a 2020 2020 2020 2020   number.        
+00020c70: 2020 2020 6f66 206e 6561 7265 7374 206e      of nearest n
+00020c80: 6569 6768 626f 7273 2074 6f20 636f 6e73  eighbors to cons
+00020c90: 6964 6572 2077 6865 6e20 636f 6d70 7574  ider when comput
+00020ca0: 696e 6720 7468 6520 696d 7075 7461 7469  ing the imputati
+00020cb0: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
+00020cc0: 4465 6661 756c 7473 2074 6f20 332e 2049  Defaults to 3. I
+00020cd0: 6620 696d 7075 7465 7220 6172 6775 6d65  f imputer argume
+00020ce0: 6e74 2069 7320 7365 742c 2074 6869 7320  nt is set, this 
+00020cf0: 7661 7269 6162 6c65 2069 7320 6967 6e6f  variable is igno
+00020d00: 7265 642e 0a0a 2020 2020 4e6f 7465 3a0a  red...    Note:.
+00020d10: 2020 2020 2020 2020 5461 6e67 2026 2049          Tang & I
+00020d20: 7368 7761 7261 6e20 3230 3137 2072 6570  shwaran 2017 rep
+00020d30: 6f72 7465 6420 7468 6174 2069 6620 7468  orted that if th
+00020d40: 6572 6520 6973 206c 6f77 2074 6f20 6d65  ere is low to me
+00020d50: 6469 756d 0a20 2020 2020 2020 2063 6f72  dium.        cor
+00020d60: 7265 6c61 7469 6f6e 2069 6e20 7468 6520  relation in the 
+00020d70: 6461 7461 7365 742c 2052 4620 696d 7075  dataset, RF impu
+00020d80: 7461 7469 6f6e 2061 6c67 6f72 6974 686d  tation algorithm
+00020d90: 7320 7065 7266 6f72 6d20 0a20 2020 2020  s perform .     
+00020da0: 2020 2062 6574 7465 7220 7468 616e 204b     better than K
+00020db0: 4e4e 2069 6d70 7574 6174 696f 6e0a 0a20  NN imputation.. 
+00020dc0: 2020 2045 7861 6d70 6c65 3a0a 2020 2020     Example:.    
+00020dd0: 2020 2020 4966 2077 6520 6861 7665 206f      If we have o
+00020de0: 7572 2074 7261 696e 696e 6720 6461 7461  ur training data
+00020df0: 2069 6e20 616e 2061 7272 6179 2063 616c   in an array cal
+00020e00: 6c65 6420 7472 6169 6e69 6e67 5f73 6574  led training_set
+00020e10: 2c20 7765 200a 2020 2020 2020 2020 6361  , we .        ca
+00020e20: 6e20 6372 6561 7465 2074 6865 2069 6d70  n create the imp
+00020e30: 7574 6572 2073 6f20 7468 6174 2077 6520  uter so that we 
+00020e40: 6361 6e20 6361 6c6c 2069 7420 746f 2074  can call it to t
+00020e50: 7261 6e73 666f 726d 206e 6577 2064 6174  ransform new dat
+00020e60: 610a 2020 2020 2020 2020 7768 656e 206d  a.        when m
+00020e70: 616b 696e 6720 6f6e 2d74 6865 2d66 6965  aking on-the-fie
+00020e80: 6c64 2070 7265 6469 6374 696f 6e73 2e0a  ld predictions..
+00020e90: 0a20 2020 2020 2020 203e 3e3e 2069 6d70  .        >>> imp
+00020ea0: 7574 6564 5f64 6174 612c 206b 6e6e 5f69  uted_data, knn_i
+00020eb0: 6d70 7574 6572 203d 204b 4e4e 5f69 6d70  mputer = KNN_imp
+00020ec0: 7574 6174 696f 6e28 6461 7461 3d74 7261  utation(data=tra
+00020ed0: 696e 696e 675f 7365 742c 2069 6d70 7574  ining_set, imput
+00020ee0: 6572 3d4e 6f6e 6529 0a20 2020 2020 2020  er=None).       
+00020ef0: 200a 2020 2020 2020 2020 4e6f 7720 7765   .        Now we
+00020f00: 2063 616e 2075 7365 2074 6865 2069 6d70   can use the imp
+00020f10: 7574 6564 2064 6174 6120 746f 2063 7265  uted data to cre
+00020f20: 6174 6520 6f75 7220 6d61 6368 696e 6520  ate our machine 
+00020f30: 6c65 6172 6e69 6e67 206d 6f64 656c 2e0a  learning model..
+00020f40: 2020 2020 2020 2020 4166 7465 7277 6172          Afterwar
+00020f50: 6473 2c20 7768 656e 206e 6577 2064 6174  ds, when new dat
+00020f60: 6120 6973 2069 6e70 7574 2066 6f72 2070  a is input for p
+00020f70: 7265 6469 6374 696f 6e2c 2077 6520 7769  rediction, we wi
+00020f80: 6c6c 2069 6e73 6572 7420 6f75 7220 0a20  ll insert our . 
+00020f90: 2020 2020 2020 2069 6d70 7574 6572 2069         imputer i
+00020fa0: 6e74 6f20 7468 6520 7069 7065 6c69 6e65  nto the pipeline
+00020fb0: 6e20 6279 2063 616c 6c69 6e67 2074 6869  n by calling thi
+00020fc0: 7320 6675 6e63 7469 6f6e 2061 6761 696e  s function again
+00020fd0: 2c20 6275 7420 7468 6973 2074 696d 650a  , but this time.
+00020fe0: 2020 2020 2020 2020 7769 7468 2074 6865          with the
+00020ff0: 2069 6d70 7574 6572 2061 7267 756d 656e   imputer argumen
+00021000: 7420 7365 743a 0a0a 2020 2020 2020 2020  t set:..        
+00021010: 3e3e 3e20 6e65 775f 6461 7461 203d 206b  >>> new_data = k
+00021020: 6e6e 5f69 6d70 7574 6174 696f 6e28 6e65  nn_imputation(ne
+00021030: 775f 6461 7461 2c20 696d 7075 7465 723d  w_data, imputer=
+00021040: 6b6e 6e5f 696d 7075 7465 7229 0a0a 2020  knn_imputer)..  
+00021050: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00021060: 2020 2054 6865 2066 6972 7374 206f 7574     The first out
+00021070: 7075 7420 6973 2074 6865 2064 6174 6120  put is the data 
+00021080: 6172 7261 7920 7769 7468 2077 6974 6820  array with with 
+00021090: 7468 6520 6d69 7373 696e 6720 7661 6c75  the missing valu
+000210a0: 6573 2066 696c 6c65 6420 696e 2e20 0a20  es filled in. . 
+000210b0: 2020 2020 2020 2054 6865 2073 6563 6f6e         The secon
+000210c0: 6420 6f75 7470 7574 2069 7320 7468 6520  d output is the 
+000210d0: 4b4e 4e20 496d 7075 7465 7220 7468 6174  KNN Imputer that
+000210e0: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
+000210f0: 746f 2074 7261 6e73 666f 726d 0a20 2020  to transform.   
+00021100: 2020 2020 206e 6577 2064 6174 612c 2070       new data, p
+00021110: 7269 6f72 2074 6f20 7072 6564 6963 7469  rior to predicti
+00021120: 6f6e 732e 200a 2020 2020 2222 220a 0a20  ons. .    """.. 
+00021130: 2020 2069 6620 696d 7075 7465 7220 6973     if imputer is
+00021140: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+00021150: 6d70 7574 6572 203d 204b 4e4e 496d 7075  mputer = KNNImpu
+00021160: 7465 7228 6e5f 6e65 6967 6862 6f72 733d  ter(n_neighbors=
+00021170: 6b29 0a20 2020 2020 2020 2069 6d70 7574  k).        imput
+00021180: 6572 2e66 6974 2864 6174 6129 0a20 2020  er.fit(data).   
+00021190: 2020 2020 2069 6d70 7574 6564 5f64 6174       imputed_dat
+000211a0: 6120 3d20 696d 7075 7465 722e 7472 616e  a = imputer.tran
+000211b0: 7366 6f72 6d28 6461 7461 290a 2020 2020  sform(data).    
+000211c0: 2020 2020 7265 7475 726e 2069 6d70 7574      return imput
+000211d0: 6564 5f64 6174 612c 2069 6d70 7574 6572  ed_data, imputer
+000211e0: 0a0a 2020 2020 7265 7475 726e 2069 6d70  ..    return imp
+000211f0: 7574 6572 2e74 7261 6e73 666f 726d 2864  uter.transform(d
+00021200: 6174 6129 200a 0a63 6c61 7373 2053 746f  ata) ..class Sto
+00021210: 7057 6865 6e54 7269 616c 4b65 6570 4265  pWhenTrialKeepBe
+00021220: 696e 6750 7275 6e65 6443 616c 6c62 6163  ingPrunedCallbac
+00021230: 6b3a 0a20 2020 2022 2222 0a20 2020 2043  k:.    """.    C
+00021240: 6c61 7373 2074 6f20 6372 6561 7465 2061  lass to create a
+00021250: 2063 7573 746f 6d20 6361 6c6c 6261 636b   custom callback
+00021260: 2074 6861 7420 7769 6c6c 2073 746f 700a   that will stop.
+00021270: 2020 2020 7468 6520 4f70 7475 6e61 206f      the Optuna o
+00021280: 7074 696d 697a 6174 696f 6e20 726f 7574  ptimization rout
+00021290: 696e 6520 6966 2061 2067 6976 656e 206e  ine if a given n
+000212a0: 756d 6265 7220 6f66 0a20 2020 2074 7269  umber of.    tri
+000212b0: 616c 7320 6172 6520 7072 756e 6564 2069  als are pruned i
+000212c0: 6e20 6120 726f 772e 2054 6869 7320 7661  n a row. This va
+000212d0: 6c75 6520 6973 2063 6f6e 7472 6f6c 6c65  lue is controlle
+000212e0: 640a 2020 2020 6279 2074 6865 2074 6872  d.    by the thr
+000212f0: 6573 686f 6c64 2070 6172 616d 6574 6572  eshold parameter
+00021300: 2e0a 2020 2020 2222 220a 2020 2020 6465  ..    """.    de
+00021310: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00021320: 2074 6872 6573 686f 6c64 3a20 696e 7429   threshold: int)
+00021330: 3a0a 2020 2020 2020 2020 7365 6c66 2e74  :.        self.t
+00021340: 6872 6573 686f 6c64 203d 2074 6872 6573  hreshold = thres
+00021350: 686f 6c64 0a20 2020 2020 2020 2073 656c  hold.        sel
+00021360: 662e 5f63 6f6e 7365 7175 7469 7665 5f70  f._consequtive_p
+00021370: 7275 6e65 645f 636f 756e 7420 3d20 300a  runed_count = 0.
+00021380: 0a20 2020 2064 6566 205f 5f63 616c 6c5f  .    def __call_
+00021390: 5f28 7365 6c66 2c20 7374 7564 793a 206f  _(self, study: o
+000213a0: 7074 756e 612e 7374 7564 792e 5374 7564  ptuna.study.Stud
+000213b0: 792c 2074 7269 616c 3a20 6f70 7475 6e61  y, trial: optuna
+000213c0: 2e74 7269 616c 2e46 726f 7a65 6e54 7269  .trial.FrozenTri
+000213d0: 616c 2920 2d3e 204e 6f6e 653a 0a20 2020  al) -> None:.   
+000213e0: 2020 2020 2069 6620 7472 6961 6c2e 7374       if trial.st
+000213f0: 6174 6520 3d3d 206f 7074 756e 612e 7472  ate == optuna.tr
+00021400: 6961 6c2e 5472 6961 6c53 7461 7465 2e50  ial.TrialState.P
+00021410: 5255 4e45 443a 0a20 2020 2020 2020 2020  RUNED:.         
+00021420: 2020 2073 656c 662e 5f63 6f6e 7365 7175     self._consequ
+00021430: 7469 7665 5f70 7275 6e65 645f 636f 756e  tive_pruned_coun
+00021440: 7420 2b3d 2031 0a20 2020 2020 2020 2065  t += 1.        e
+00021450: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00021460: 2073 656c 662e 5f63 6f6e 7365 7175 7469   self._consequti
+00021470: 7665 5f70 7275 6e65 645f 636f 756e 7420  ve_pruned_count 
+00021480: 3d20 300a 0a20 2020 2020 2020 2069 6620  = 0..        if 
+00021490: 7365 6c66 2e5f 636f 6e73 6571 7574 6976  self._consequtiv
+000214a0: 655f 7072 756e 6564 5f63 6f75 6e74 203e  e_pruned_count >
+000214b0: 3d20 7365 6c66 2e74 6872 6573 686f 6c64  = self.threshold
+000214c0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
+000214d0: 7564 792e 7374 6f70 2829 0a0a 636c 6173  udy.stop()..clas
+000214e0: 7320 496e 7075 7454 696d 656f 7574 3a0a  s InputTimeout:.
+000214f0: 2020 2020 2222 220a 2020 2020 4120 636c      """.    A cl
+00021500: 6173 7320 666f 7220 7265 6164 696e 6720  ass for reading 
+00021510: 7573 6572 2069 6e70 7574 2077 6974 6820  user input with 
+00021520: 6120 7469 6d65 6f75 7420 6f6e 204c 696e  a timeout on Lin
+00021530: 7578 2c20 7573 6564 2069 6e20 7468 6520  ux, used in the 
+00021540: 434e 4e20 6f70 7469 6d69 7a61 7469 6f6e  CNN optimization
+00021550: 2072 6f75 7469 6e65 2e20 0a20 2020 204e   routine. .    N
+00021560: 6f74 2063 7572 7265 6e74 6c79 2075 7365  ot currently use
+00021570: 6420 6279 2074 6865 2070 726f 6772 616d  d by the program
+00021580: 210a 0a20 2020 2045 7861 6d70 6c65 3a0a  !..    Example:.
+00021590: 2020 2020 2020 2020 696e 7075 745f 7469          input_ti
+000215a0: 6d65 6f75 7420 3d20 496e 7075 7454 696d  meout = InputTim
+000215b0: 656f 7574 2822 456e 7465 7220 796f 7572  eout("Enter your
+000215c0: 2069 6e70 7574 3a20 222c 2035 290a 2020   input: ", 5).  
+000215d0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000215e0: 2020 2020 2020 2075 7365 725f 696e 7075         user_inpu
+000215f0: 7420 3d20 696e 7075 745f 7469 6d65 6f75  t = input_timeou
+00021600: 742e 696e 7075 7469 6d65 6f75 7428 290a  t.inputimeout().
+00021610: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00021620: 7428 2255 7365 7220 696e 7075 743a 222c  t("User input:",
+00021630: 2075 7365 725f 696e 7075 7429 0a20 2020   user_input).   
+00021640: 2020 2020 2065 7863 6570 7420 496e 7075       except Inpu
+00021650: 7454 696d 656f 7574 2e54 696d 656f 7574  tTimeout.Timeout
+00021660: 4f63 6375 7272 6564 3a0a 2020 2020 2020  Occurred:.      
+00021670: 2020 2020 2020 7072 696e 7428 2254 696d        print("Tim
+00021680: 656f 7574 206f 6363 7572 7265 642e 204e  eout occurred. N
+00021690: 6f20 696e 7075 7420 7265 6365 6976 6564  o input received
+000216a0: 2e22 290a 0a20 2020 2041 7474 7269 6275  .")..    Attribu
+000216b0: 7465 733a 0a20 2020 2020 2020 2070 726f  tes:.        pro
+000216c0: 6d70 7420 2873 7472 293a 2054 6865 2070  mpt (str): The p
+000216d0: 726f 6d70 7420 6d65 7373 6167 6520 746f  rompt message to
+000216e0: 2064 6973 706c 6179 2074 6f20 7468 6520   display to the 
+000216f0: 7573 6572 2e0a 2020 2020 2020 2020 7469  user..        ti
+00021700: 6d65 6f75 7420 2866 6c6f 6174 293a 2054  meout (float): T
+00021710: 6865 206e 756d 6265 7220 6f66 2073 6563  he number of sec
+00021720: 6f6e 6473 2074 6f20 7761 6974 2066 6f72  onds to wait for
+00021730: 2069 6e70 7574 2062 6566 6f72 6520 7469   input before ti
+00021740: 6d69 6e67 206f 7574 2e0a 2020 2020 0a20  ming out..    . 
+00021750: 2020 204d 6574 686f 6473 3a0a 2020 2020     Methods:.    
+00021760: 2020 2020 696e 7075 7469 6d65 6f75 7428      inputimeout(
+00021770: 293a 2052 6561 6473 2075 7365 7220 696e  ): Reads user in
+00021780: 7075 7420 6672 6f6d 2074 6865 2063 6f6d  put from the com
+00021790: 6d61 6e64 206c 696e 6520 7769 7468 2061  mand line with a
+000217a0: 2074 696d 656f 7574 2e20 4966 206e 6f20   timeout. If no 
+000217b0: 696e 7075 7420 6973 0a20 2020 2020 2020  input is.       
+000217c0: 2020 2020 2072 6563 6569 7665 6420 7769       received wi
+000217d0: 7468 696e 2074 6865 2073 7065 6369 6669  thin the specifi
+000217e0: 6564 2074 696d 656f 7574 2c20 6120 5469  ed timeout, a Ti
+000217f0: 6d65 6f75 744f 6363 7572 7265 6420 6578  meoutOccurred ex
+00021800: 6365 7074 696f 6e20 6973 2072 6169 7365  ception is raise
+00021810: 642e 0a20 2020 2022 2222 0a0a 2020 2020  d..    """..    
+00021820: 636c 6173 7320 5469 6d65 6f75 744f 6363  class TimeoutOcc
+00021830: 7572 7265 6428 4578 6365 7074 696f 6e29  urred(Exception)
+00021840: 3a0a 2020 2020 2020 2020 7061 7373 0a20  :.        pass. 
+00021850: 2020 200a 2020 2020 6465 6620 5f5f 696e     .    def __in
+00021860: 6974 5f5f 2873 656c 662c 2070 726f 6d70  it__(self, promp
+00021870: 743d 2727 2c20 7469 6d65 6f75 743d 3330  t='', timeout=30
+00021880: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00021890: 7072 6f6d 7074 203d 2070 726f 6d70 740a  prompt = prompt.
+000218a0: 2020 2020 2020 2020 7365 6c66 2e74 696d          self.tim
+000218b0: 656f 7574 203d 2074 696d 656f 7574 0a20  eout = timeout. 
+000218c0: 2020 2020 2020 2073 656c 662e 6563 686f         self.echo
+000218d0: 203d 2073 656c 662e 5f65 6368 6f5f 706f   = self._echo_po
+000218e0: 7369 780a 2020 2020 2020 2020 7365 6c66  six.        self
+000218f0: 2e69 6e70 7574 696d 656f 7574 203d 2073  .inputimeout = s
+00021900: 656c 662e 5f69 6e70 7574 696d 656f 7574  elf._inputimeout
+00021910: 5f70 6f73 6978 0a20 2020 200a 2020 2020  _posix.    .    
+00021920: 6465 6620 5f65 6368 6f5f 706f 7369 7828  def _echo_posix(
+00021930: 7365 6c66 2c20 7374 7269 6e67 293a 0a20  self, string):. 
+00021940: 2020 2020 2020 2073 7973 2e73 7464 6f75         sys.stdou
+00021950: 742e 7772 6974 6528 7374 7269 6e67 290a  t.write(string).
+00021960: 2020 2020 2020 2020 7379 732e 7374 646f          sys.stdo
+00021970: 7574 2e66 6c75 7368 2829 0a20 2020 2020  ut.flush().     
+00021980: 2020 200a 2020 2020 6465 6620 5f69 6e70     .    def _inp
+00021990: 7574 696d 656f 7574 5f70 6f73 6978 2873  utimeout_posix(s
+000219a0: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
+000219b0: 6c66 2e65 6368 6f28 7365 6c66 2e70 726f  lf.echo(self.pro
+000219c0: 6d70 7429 0a20 2020 2020 2020 2073 656c  mpt).        sel
+000219d0: 203d 2073 656c 6563 746f 7273 2e44 6566   = selectors.Def
+000219e0: 6175 6c74 5365 6c65 6374 6f72 2829 0a20  aultSelector(). 
+000219f0: 2020 2020 2020 2073 656c 2e72 6567 6973         sel.regis
+00021a00: 7465 7228 7379 732e 7374 6469 6e2c 2073  ter(sys.stdin, s
+00021a10: 656c 6563 746f 7273 2e45 5645 4e54 5f52  electors.EVENT_R
+00021a20: 4541 4429 0a20 2020 2020 2020 2065 7665  EAD).        eve
+00021a30: 6e74 7320 3d20 7365 6c2e 7365 6c65 6374  nts = sel.select
+00021a40: 2873 656c 662e 7469 6d65 6f75 7429 0a0a  (self.timeout)..
+00021a50: 2020 2020 2020 2020 6966 2065 7665 6e74          if event
+00021a60: 733a 0a20 2020 2020 2020 2020 2020 206b  s:.            k
+00021a70: 6579 2c20 5f20 3d20 6576 656e 7473 5b30  ey, _ = events[0
+00021a80: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
+00021a90: 7475 726e 206b 6579 2e66 696c 656f 626a  turn key.fileobj
+00021aa0: 2e72 6561 646c 696e 6528 292e 7273 7472  .readline().rstr
+00021ab0: 6970 2827 5c6e 2729 0a20 2020 2020 2020  ip('\n').       
+00021ac0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00021ad0: 2020 2073 656c 662e 6563 686f 2827 5c6e     self.echo('\n
+00021ae0: 2729 0a20 2020 2020 2020 2020 2020 2074  ').            t
+00021af0: 6572 6d69 6f73 2e74 6366 6c75 7368 2873  ermios.tcflush(s
+00021b00: 7973 2e73 7464 696e 2c20 7465 726d 696f  ys.stdin, termio
+00021b10: 732e 5443 4946 4c55 5348 290a 2020 2020  s.TCIFLUSH).    
+00021b20: 2020 2020 2020 2020 7261 6973 6520 7365          raise se
+00021b30: 6c66 2e54 696d 656f 7574 4f63 6375 7272  lf.TimeoutOccurr
+00021b40: 6564 0a0a 0a                             ed...
```

### Comparing `pyBIA-1.3.2/pyBIA.egg-info/PKG-INFO` & `pyBIA-1.3.3/pyBIA.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pyBIA
-Version: 1.3.2
+Version: 1.3.3
 Summary: Convolutional Neural Network for Ly-alpha Blob Detection
 Home-page: https://github.com/Professor-G/pyBIA
 Author: Daniel Godines
 Author-email: danielgodinez123@gmail.com
 License: GPL-3.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `pyBIA-1.3.2/setup.py` & `pyBIA-1.3.3/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 
 @author: danielgodinez
 """
 from setuptools import setup, find_packages, Extension
 
 setup(
     name="pyBIA",
-    version="1.3.2",
+    version="1.3.3",
     author="Daniel Godines",
     author_email="danielgodinez123@gmail.com",
     description="Convolutional Neural Network for Ly-alpha Blob Detection",
     license='GPL-3.0',
     url = "https://github.com/Professor-G/pyBIA",
     classifiers=[
 		'Development Status :: 5 - Production/Stable',
```

