# Comparing `tmp/scikit-rt-0.4.8.tar.gz` & `tmp/scikit-rt-0.4.9.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "scikit-rt-0.4.8.tar", last modified: Tue May 23 18:00:02 2023, max compression
+gzip compressed data, was "scikit-rt-0.4.9.tar", last modified: Wed May 31 09:23:05 2023, max compression
```

## Comparing `scikit-rt-0.4.8.tar` & `scikit-rt-0.4.9.tar`

### file list

```diff
@@ -1,71 +1,71 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.087981 scikit-rt-0.4.8/
--rw-r--r--   0 runner    (1001) docker     (123)    35129 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-05-23 18:00:02.087981 scikit-rt-0.4.8/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     1505 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      818 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/pypi.md
--rw-r--r--   0 runner    (1001) docker     (123)      108 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)     2839 2023-05-23 18:00:02.091981 scikit-rt-0.4.8/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)       37 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.071981 scikit-rt-0.4.8/src/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.075981 scikit-rt-0.4.8/src/scikit_rt.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-05-23 18:00:01.000000 scikit-rt-0.4.8/src/scikit_rt.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     1819 2023-05-23 18:00:02.000000 scikit-rt-0.4.8/src/scikit_rt.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-23 18:00:01.000000 scikit-rt-0.4.8/src/scikit_rt.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1936 2023-05-23 18:00:01.000000 scikit-rt-0.4.8/src/scikit_rt.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        5 2023-05-23 18:00:01.000000 scikit-rt-0.4.8/src/scikit_rt.egg-info/top_level.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.079981 scikit-rt-0.4.8/src/skrt/
--rw-r--r--   0 runner    (1001) docker     (123)      620 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    12816 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/application.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.079981 scikit-rt-0.4.8/src/skrt/better_viewer/
--rw-r--r--   0 runner    (1001) docker     (123)   132455 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/better_viewer/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3958 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/better_viewer/options.py
--rw-r--r--   0 runner    (1001) docker     (123)    75197 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/core.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.071981 scikit-rt-0.4.8/src/skrt/data/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.083981 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1732 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1801 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_Affine.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1649 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1798 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_Rigid.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1804 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_Translation.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.083981 scikit-rt-0.4.8/src/skrt/data/niftyreg_parameter_files/
--rw-r--r--   0 runner    (1001) docker     (123)      141 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/niftyreg_parameter_files/Affine.txt
--rw-r--r--   0 runner    (1001) docker     (123)      124 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/niftyreg_parameter_files/BE_BSpline05.txt
--rw-r--r--   0 runner    (1001) docker     (123)      113 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/niftyreg_parameter_files/NMI_BSpline05.txt
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/niftyreg_parameter_files/NMI_BSpline15.txt
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/niftyreg_parameter_files/NMI_BSpline30.txt
--rw-r--r--   0 runner    (1001) docker     (123)      205 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/data/niftyreg_parameter_files/Rigid.txt
--rw-r--r--   0 runner    (1001) docker     (123)    26897 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/dicom_writer.py
--rw-r--r--   0 runner    (1001) docker     (123)    39911 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/dose.py
--rw-r--r--   0 runner    (1001) docker     (123)   255921 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/image.py
--rw-r--r--   0 runner    (1001) docker     (123)     1738 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/multi.py
--rw-r--r--   0 runner    (1001) docker     (123)   118731 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/patient.py
--rw-r--r--   0 runner    (1001) docker     (123)   134908 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/registration.py
--rw-r--r--   0 runner    (1001) docker     (123)    60958 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/segmentation.py
--rw-r--r--   0 runner    (1001) docker     (123)    24714 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/simulation.py
--rw-r--r--   0 runner    (1001) docker     (123)   352303 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/structures.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.083981 scikit-rt-0.4.8/src/skrt/viewer/
--rw-r--r--   0 runner    (1001) docker     (123)       43 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/viewer/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   154795 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/viewer/core.py
--rw-r--r--   0 runner    (1001) docker     (123)   113136 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/src/skrt/viewer/viewer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-23 18:00:02.087981 scikit-rt-0.4.8/tests/
--rw-r--r--   0 runner    (1001) docker     (123)      820 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_01_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)    10063 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_application.py
--rw-r--r--   0 runner    (1001) docker     (123)    15414 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_core.py
--rw-r--r--   0 runner    (1001) docker     (123)     7248 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_dose.py
--rw-r--r--   0 runner    (1001) docker     (123)    61981 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     1369 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_multi.py
--rw-r--r--   0 runner    (1001) docker     (123)     9592 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_patient.py
--rw-r--r--   0 runner    (1001) docker     (123)     1554 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_qv_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     8791 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_qv_quickviewer.py
--rw-r--r--   0 runner    (1001) docker     (123)     6165 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_qv_struct_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)     3876 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_qv_struct_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)     1156 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_qv_structs.py
--rw-r--r--   0 runner    (1001) docker     (123)    34152 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_registration.py
--rw-r--r--   0 runner    (1001) docker     (123)    21138 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_roi_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)     5429 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_segmentation.py
--rw-r--r--   0 runner    (1001) docker     (123)       35 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_simulation.py
--rw-r--r--   0 runner    (1001) docker     (123)    65888 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_structs.py
--rw-r--r--   0 runner    (1001) docker     (123)     2513 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_synthetic_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     7725 2023-05-23 17:54:51.000000 scikit-rt-0.4.8/tests/test_viewer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.212740 scikit-rt-0.4.9/
+-rw-r--r--   0 runner    (1001) docker     (123)    35129 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-05-31 09:23:05.212740 scikit-rt-0.4.9/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     1505 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      818 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/pypi.md
+-rw-r--r--   0 runner    (1001) docker     (123)      108 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)     2839 2023-05-31 09:23:05.212740 scikit-rt-0.4.9/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)       37 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.180740 scikit-rt-0.4.9/src/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.184740 scikit-rt-0.4.9/src/scikit_rt.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-05-31 09:23:04.000000 scikit-rt-0.4.9/src/scikit_rt.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     1819 2023-05-31 09:23:05.000000 scikit-rt-0.4.9/src/scikit_rt.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-31 09:23:04.000000 scikit-rt-0.4.9/src/scikit_rt.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1936 2023-05-31 09:23:04.000000 scikit-rt-0.4.9/src/scikit_rt.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        5 2023-05-31 09:23:04.000000 scikit-rt-0.4.9/src/scikit_rt.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.192740 scikit-rt-0.4.9/src/skrt/
+-rw-r--r--   0 runner    (1001) docker     (123)      620 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12816 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/application.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.196740 scikit-rt-0.4.9/src/skrt/better_viewer/
+-rw-r--r--   0 runner    (1001) docker     (123)   132448 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/better_viewer/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3958 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/better_viewer/options.py
+-rw-r--r--   0 runner    (1001) docker     (123)    75993 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/core.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.180740 scikit-rt-0.4.9/src/skrt/data/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.196740 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1732 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1801 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_Affine.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1649 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1798 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_Rigid.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1804 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_Translation.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.200740 scikit-rt-0.4.9/src/skrt/data/niftyreg_parameter_files/
+-rw-r--r--   0 runner    (1001) docker     (123)      141 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/niftyreg_parameter_files/Affine.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      124 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/niftyreg_parameter_files/BE_BSpline05.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      113 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/niftyreg_parameter_files/NMI_BSpline05.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/niftyreg_parameter_files/NMI_BSpline15.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/niftyreg_parameter_files/NMI_BSpline30.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      205 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/data/niftyreg_parameter_files/Rigid.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    27334 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/dicom_writer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    39944 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/dose.py
+-rw-r--r--   0 runner    (1001) docker     (123)   257102 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1738 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/multi.py
+-rw-r--r--   0 runner    (1001) docker     (123)   118731 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/patient.py
+-rw-r--r--   0 runner    (1001) docker     (123)   134908 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/registration.py
+-rw-r--r--   0 runner    (1001) docker     (123)    60958 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/segmentation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25011 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/simulation.py
+-rw-r--r--   0 runner    (1001) docker     (123)   358501 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/structures.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.200740 scikit-rt-0.4.9/src/skrt/viewer/
+-rw-r--r--   0 runner    (1001) docker     (123)       43 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/viewer/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   154795 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/viewer/core.py
+-rw-r--r--   0 runner    (1001) docker     (123)   113136 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/src/skrt/viewer/viewer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-31 09:23:05.212740 scikit-rt-0.4.9/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)      820 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_01_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10063 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_application.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15414 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_core.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7248 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_dose.py
+-rw-r--r--   0 runner    (1001) docker     (123)    61981 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1369 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_multi.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9592 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_patient.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1554 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_qv_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8791 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_qv_quickviewer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6165 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_qv_struct_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3876 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_qv_struct_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1156 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_qv_structs.py
+-rw-r--r--   0 runner    (1001) docker     (123)    34152 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_registration.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21138 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_roi_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5429 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_segmentation.py
+-rw-r--r--   0 runner    (1001) docker     (123)       35 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_simulation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65888 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_structs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2513 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_synthetic_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7725 2023-05-31 09:18:51.000000 scikit-rt-0.4.9/tests/test_viewer.py
```

### Comparing `scikit-rt-0.4.8/LICENSE` & `scikit-rt-0.4.9/LICENSE`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/PKG-INFO` & `scikit-rt-0.4.9/PKG-INFO`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: scikit-rt
-Version: 0.4.8
+Version: 0.4.9
 Summary: Toolkit for analysis of radiotherapy data
 Home-page: https://github.com/scikit-rt/scikit-rt
 Author: H. Pullen, K. Harrison
 Author-email: scikit-rt@hep.phy.cam.ac.uk
 License: UNKNOWN
 Project-URL: Bug Tracker, https://github.com/scikit-rt/scikit-rt/issues
 Description: # Scikit-rt
```

### Comparing `scikit-rt-0.4.8/README.md` & `scikit-rt-0.4.9/README.md`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/pypi.md` & `scikit-rt-0.4.9/pypi.md`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/setup.cfg` & `scikit-rt-0.4.9/setup.cfg`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [metadata]
 name = scikit-rt
-version = 0.4.8
+version = 0.4.9
 author = H. Pullen, K. Harrison
 author_email = scikit-rt@hep.phy.cam.ac.uk
 description = Toolkit for analysis of radiotherapy data
 long_description = file: pypi.md
 long_description_content_type = text/markdown
 url = https://github.com/scikit-rt/scikit-rt
 project_urls =
```

### Comparing `scikit-rt-0.4.8/src/scikit_rt.egg-info/PKG-INFO` & `scikit-rt-0.4.9/src/scikit_rt.egg-info/PKG-INFO`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: scikit-rt
-Version: 0.4.8
+Version: 0.4.9
 Summary: Toolkit for analysis of radiotherapy data
 Home-page: https://github.com/scikit-rt/scikit-rt
 Author: H. Pullen, K. Harrison
 Author-email: scikit-rt@hep.phy.cam.ac.uk
 License: UNKNOWN
 Project-URL: Bug Tracker, https://github.com/scikit-rt/scikit-rt/issues
 Description: # Scikit-rt
```

### Comparing `scikit-rt-0.4.8/src/scikit_rt.egg-info/SOURCES.txt` & `scikit-rt-0.4.9/src/scikit_rt.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/scikit_rt.egg-info/requires.txt` & `scikit-rt-0.4.9/src/scikit_rt.egg-info/requires.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/__init__.py` & `scikit-rt-0.4.9/src/skrt/__init__.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/application.py` & `scikit-rt-0.4.9/src/skrt/application.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/better_viewer/__init__.py` & `scikit-rt-0.4.9/src/skrt/better_viewer/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -364,18 +364,18 @@
 
             In cases (a) and (b), QuickViewer will attempt to infer the date
             first from the directory name, then from the filename if no valid
             date is found within the directory name. The date is taken from the
             first unbroken string of numbers that can be successfully parsed
             with dateutil.parser.
 
-        init_view : string, default=None
-            Orientation ('x-y', 'y-z', 'x-z' at which to initially display
-            the image(s).  If None, the initial view is chosen to match
-            the image orienation.
+        init_view : string/None, default='x-y'
+            Orientation ('x-y', 'x-z', 'y-x', 'y-z', 'z-x' , 'z-y')
+            at which to initially display the image(s).  If None, the
+            initial view is chosen to match the image orienation.
 
         init_slice : integer, default=None
             Slice number in the initial orientation direction at which to
             display the first image (can be changed interactively later). If
             None, the central slice will be displayed.  Takes precedence over
             <init_idx>.
 
@@ -1694,15 +1694,15 @@
 
 class SingleViewer:
     """Class for displaying an Image with interactive elements."""
 
     def __init__(
         self,
         im=None,
-        init_view=None,
+        init_view='x-y',
         init_slice=None,
         init_idx=None,
         init_pos=None,
         intensity=None,
         intensity_width=500,
         intensity_limits=None,
         intensity_step=None,
@@ -1807,19 +1807,15 @@
         # Set initial orientation
         if not init_view:
             view = self.image.get_orientation_view()
             if view:
                 init_view = view
             else:
                 init_view = 'x-y'
-        view_map = {"y-x": "x-y", "z-x": "x-z", "z-y": "y-z"}
-        if init_view in view_map:
-            self.view = view_map[init_view]
-        else:
-            self.view = init_view
+        self.view = init_view
 
         # Set initial slice number for each orientation
         self.slice = {
             view: np.ceil(self.image.n_voxels[z] / 2) 
             for view, z in _slice_axes.items()
         }
         if init_pos is not None and self.scale_in_mm:
@@ -1897,16 +1893,19 @@
             self.annotate_slice = True
         self.save_as = str(save_as) if save_as is not None else None
         self.plotting = False
         self.callbacks_set = False
         self.standalone = standalone
         self.custom_ax_lims = {
             'x-y': [xlim, ylim],
-            'y-z': [zlim, ylim],
-            'x-z': [zlim, xlim]
+            'x-z': [xlim, zlim],
+            'y-x': [ylim, xlim],
+            'y-z': [ylim, zlim],
+            'z-x': [zlim, xlim],
+            'z-y': [zlim, ylim],
         }
         self.zoom = zoom
         self.zoom_centre = zoom_centre
         self.zoom_ui = zoom_ui
         if zoom_ui is None:
             self.zoom_ui = bool(self.has_rois or zoom is not None)
         self.major_ticks = major_ticks
@@ -2230,15 +2229,15 @@
 
         shared_ui = isinstance(other_viewer, SingleViewer)
         self.main_ui = []
 
         # View radio buttons
         if not shared_ui:
             self.ui_view = ipyw.RadioButtons(
-                options=['x-y', 'y-z', 'x-z'],
+                options=['x-y', 'x-z', 'y-x', 'y-z', 'z-x', 'z-y'],
                 value=self.view,
                 description='Slice plane selection:',
                 disabled=False,
                 style=_style,
             )
             #  if not self.image.dim2:
             self.main_ui.append(self.ui_view)
```

### Comparing `scikit-rt-0.4.8/src/skrt/better_viewer/options.py` & `scikit-rt-0.4.9/src/skrt/better_viewer/options.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/core.py` & `scikit-rt-0.4.9/src/skrt/core.py`

 * *Files 1% similar despite different names*

```diff
@@ -742,14 +742,23 @@
     def get_n_file(self):
         '''
         Return number of data files associated with this object.
         '''
         # Only 1 data file associated with a non-Archive object.
         return 1
 
+    def get_n_file_below(self):
+        """
+        Where self.path is a directory, return number of files below this.
+
+        Returns None if self.path isn't the path to a directory.  In
+        counting files, hidden files are ignored.
+        """
+        return get_n_file_below(self.path)
+
     def print_paths(self, max_path=None):
         '''
         Print paths of data files associated with this object.
 
         File paths are listed in natural order, with one path per line.
         
         **Parameters:**
@@ -2186,14 +2195,29 @@
     cls : class
         Class for which qualified name is to be determined.  If non-class
         is passed as argument, None is returned.
     """
     if isinstance(cls, type):
         return f"{cls.__module__}.{cls.__name__}"
 
+def get_n_file_below(indir):
+    """
+    Return number of files below a directory, ignoring hidden files.
+
+    Returns None if indir isn't the path to a directory.
+
+    **Parameter:**
+    indir: str, pathlib.Path
+        Path to directory below which files are to be counted.
+    """
+    if isinstance(indir, (str, Path)) and str(indir):
+        indir = Path(indir)
+        if indir.is_dir():
+            return len([path for path in indir.glob("**/[!.]*")
+                        if path.is_file()])
 
 def print_paths(data_dir, max_path=None):
     """
     Print paths to files below a directory, ignoring hidden files.
     
     File paths are listed in natural order, with one path per line.
```

### Comparing `scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt` & `scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_Affine.txt` & `scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_Affine.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt` & `scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt` & `scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt` & `scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_Rigid.txt` & `scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_Rigid.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/data/elastix_parameter_files/MI_Translation.txt` & `scikit-rt-0.4.9/src/skrt/data/elastix_parameter_files/MI_Translation.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/dicom_writer.py` & `scikit-rt-0.4.9/src/skrt/dicom_writer.py`

 * *Files 2% similar despite different names*

```diff
@@ -48,17 +48,18 @@
     - **set_image_slice()** : Add to dataset information for (2d) image slice.
     - **set_structure_set()** : Add to dataset information for structure set.
     - **update_dataset()** : Make arbitrary updates to dataset.
     - **write()** : Write data in DICOM format.
     '''
 
     def __init__(self, outdir=None, data=None, affine=None,
-            overwrite=True, header_source=None, orientation=None,
-            patient_id=None, modality=None, root_uid=None, header_extras=None,
-            source_type=None, outname=None):
+                 overwrite=True, header_source=None, orientation=None,
+                 patient_id=None, patient_position=None, modality=None,
+                 root_uid=None, header_extras=None,
+                 source_type=None, outname=None):
         '''
         Create instance of DicomWriter class.
 
         **Parameters:**
 
         outdir : str/pathlib.Path, default=None
             Path to directory where data are to be written.
@@ -87,14 +88,20 @@
             Direction cosines indicating image orientation.  If None,
             set to standard DICOM-style orientation, [1, 0, 0, 0, 1, 0],
             such that [column, row, slice] correspond to the axes [x, y, z].
 
         patient_id : str, default=None
             Patient identifier.
 
+        patient_position : str, default=None
+            Indicator of patient position relative to imaging equipment.
+            Examples include: "HFS" (head first, supine),
+            "FFP" (feet first, prone), "FFS" (feet first, supine).  If None,
+            use "HFS".
+
         modality : str, default=None
             Modality of data collection.  Supported modalities are
             'CT' and 'RTDOSE'.  If None, the modality is taken to be 'CT'.
 
         root_uid : str, default=None
             Root to be used in Globally Unique Identifiers (GUIDs).  This
             should uniquely identify the institution or group generating
@@ -129,15 +136,16 @@
         self.outdir = Path(fullpath(str(outdir)))
         self.outname = outname
         self.data = data
         self.affine = affine
         self.overwrite = overwrite
         self.header_source = header_source
         self.orientation = orientation or [1, 0, 0, 0, 1, 0]
-        self.patient_id = patient_id or ""
+        self.patient_id = patient_id or "Unknown"
+        self.patient_position = patient_position or "HFS"
         self.modality = modality.upper() if modality is not None else 'CT'
         self.header_extras = header_extras or {}
         self.source_type = source_type
 
         if root_uid:
             self.root_uid = root_uid
         else:
@@ -197,15 +205,15 @@
         **Parameters:**
 
         ds : pydicom.dataset.FileDataset
             FileDataset to which data are to be added.
         '''
         ds.OperatorsName = None
         ds.StructureSetDate = self.date
-        ds.StructureSetLabel = ''
+        ds.StructureSetLabel = 'Unknown'
         ds.StructureSetTime = self.time
 
         return ds
 
     def create_file_dataset(self):
         '''
         Create new pydicom.dataset.FileDataset object.
@@ -238,22 +246,22 @@
         ds.AccessionNumber = None
         ds.ContentDate = self.date
         ds.ContentTime = self.time
         ds.DerivationDescription = None
         ds.InstanceCreationDate = self.date
         ds.InstanceCreationTime = self.time
         ds.InstitutionName = None
-        ds.Manufacturer = None
+        ds.Manufacturer = "Unknown"
         ds.ManufacturerModelName = None
         ds.Modality = self.modality
         ds.PatientID = self.patient_id
-        ds.PatientPosition = None
+        ds.PatientPosition = self.patient_position
         ds.PatientAge = None
         ds.PatientBirthDate = None
-        ds.PatientName = None
+        ds.PatientName = self.patient_id
         ds.PatientSex = None
         ds.ReferringPhysicianName = None
         ds.SeriesDate = self.date
         ds.SeriesDescription = None
         ds.SeriesInstanceUID = self.generate_shortened_uid()
         ds.SeriesNumber = None
         ds.SeriesTime = self.time
```

### Comparing `scikit-rt-0.4.8/src/skrt/dose.py` & `scikit-rt-0.4.9/src/skrt/dose.py`

 * *Files 0% similar despite different names*

```diff
@@ -70,16 +70,17 @@
         **kwargs
     ):
         """Plot this overlay, optionally overlaid on its associated Image.
 
         **Parameters**:
 
         view : str
-            Orientation in which to compute the index. Can be "x-y", "y-z", or
-            "x-z".  If None, the initial view is chosen to match
+            Orientation in which to compute the index. Can be "x-y", "x-z",
+            "y-x", "y-z", "z-x", or
+            "z-y".  If None, the initial view is chosen to match
             the image orienation.
 
         sl : int, default=None
             Slice number to plot. Takes precedence over <idx> and <pos> if not
             None. If all of <sl>, <idx>, and <pos> are None, the central
             slice will be plotted.
```

### Comparing `scikit-rt-0.4.8/src/skrt/image.py` & `scikit-rt-0.4.9/src/skrt/image.py`

 * *Files 1% similar despite different names*

```diff
@@ -36,16 +36,17 @@
 try:
     import mahotas
     _has_mahotas = True
 except ModuleNotFoundError:
     _has_mahotas = False
 
 _axes = ["x", "y", "z"]
-_slice_axes = {"x-y": 2, "y-z": 0, "x-z": 1}
-_plot_axes = {"x-y": [0, 1], "y-z": [2, 1], "x-z": [2, 0]}
+_slice_axes = {"x-y": 2, "x-z": 1, "y-x": 2, "y-z": 0, "z-x": 1, "z-y": 0}
+_plot_axes = {"x-y": [0, 1], "x-z": [0, 2], "y-x": [1, 0], "y-z": [1, 2],
+              "z-x": [2, 0], "z-y": [2, 1]}
 _default_figsize = 6
 _default_stations = {"0210167": "LA3", "0210292": "LA4"}
 _default_bolus_names = ["planning bolus", "virtual bolus", "bolus",
         "fo p/bolus", "for bolus", "for p-bolus", "for virtual bolus",
         "plan bolus", "planning  bolus", "planningl bolus", "pretend bolus",
         "temp-for bolus", "temp- for bolus", "Temp for p/bolus",
         "treatment bolus", "t1-for bolus", "0.5CM BOLUS"]
@@ -1894,15 +1895,15 @@
         The centroid coordinate along a given axis is calculated as the
         unweighted mean of the coordinates of voxels with an intensity at
         least a given fraction of the maximum.
 
         **Parameters:**
 
         view : str, default="x-y"
-            Orientation; can be "x-y", "y-z", or "x-z".
+            Orientation; can be "x-y", "x-z", "y-x", "y-z", "z-x", or "z-y".
 
         fraction : float, default=1
             Minimum fraction of the maximum intensity that a voxel must record
             to be considered in the centroid calculation.
         """
         self.load()
 
@@ -1924,15 +1925,15 @@
         The centroid coordinate along a given axis is calculated as the
         unweighted mean of the coordinates of voxels with an intensity at
         least a given fraction of the maximum.
 
         **Parameters:**
 
         view : str, default="x-y"
-            Orientation; can be "x-y", "y-z", or "x-z".
+            Orientation; can be "x-y", "x-z", "y-x", "y-z", "z-x", or "z-y".
 
         fraction : float, default=1
             Minimum fraction of the maximum intensity that a voxel must record
             to be considered in the centroid calculation.
         """
         return self.idx_to_pos(
                 self.get_centroid_idx(view, fraction), _slice_axes[view])
@@ -1944,15 +1945,15 @@
         The centroid coordinate along a given axis is calculated as the
         unweighted mean of the coordinates of voxels with an intensity at
         least a given fraction of the maximum.
 
         **Parameters:**
 
         view : str, default="x-y"
-            Orientation; can be "x-y", "y-z", or "x-z".
+            Orientation; can be "x-y", "x-z", "y-x", "y-z", "z-x", or "z-y".
 
         fraction : float, default=1
             Minimum fraction of the maximum intensity that a voxel must record
             to be considered in the centroid calculation.
         """
         return self.idx_to_slice(
                 self.get_centroid_idx(view, fraction), _slice_axes[view])
@@ -2163,15 +2164,17 @@
             (
                 self.lims[i][0] - self._svoxel_size[i] / 2,
                 self.lims[i][1] + self._svoxel_size[i] / 2,
             )
             for i in range(3)
         ]
         self.plot_extent = {
-            view: self.image_extent[x_ax] + self.image_extent[y_ax][::-1]
+            view: self.image_extent[x_ax] +
+            (self.image_extent[y_ax][::-1] if 1 == y_ax
+             else self.image_extent[y_ax])
             for view, (x_ax, y_ax) in _plot_axes.items()
         }
         self.image_size = [
                 self.n_voxels[i] * self._svoxel_size[i]
                 for i in range(3)
                 ]
 
@@ -2195,16 +2198,16 @@
         position. If <sl>, <idx>, and <pos> are all None, the index of the 
         central slice of the image in the orienation specified in <view> will 
         be returned.
 
         **Parameters:**
         
         view : str
-            Orientation in which to compute the index. Can be "x-y", "y-z", or
-            "x-z".
+            Orientation in which to compute the index. 
+            Can be "x-y", "x-z", "y-x", "y-z", "z-x", or "z-y".
 
         sl : int, default=None
             Slice number. If given, this number will be converted to an index 
             and returned.
 
         idx : int, default=None
             Slice array index. If given and <sl> is None, this index will be 
@@ -2232,15 +2235,15 @@
         """Get a slice of the data in the correct orientation for plotting. 
         If <sl>, <pos>, and <idx> are all None, the central slice of the image
         in the orientation specified in <view> will be returned.
 
         **Parameters:**
         
         view : str
-            Orientation; can be "x-y", "y-z", or "x-z".
+            Orientation; can be "x-y", "x-z", "y-x", "y-z", "z-x", or "z-y".
 
         sl : int, default=None
             Slice number; used if not None.
 
         idx : int, default=None
             Slice array index; used if not None and <sl> is None.
 
@@ -2272,22 +2275,28 @@
 
         # Check whether index and view match cached slice
         if hasattr(self, "_current_slice") and not force and not flatten:
             if self._current_idx == idx and self._current_view == view:
                 return self._current_slice
 
         # Create slice
-        transposes = {"x-y": [0, 1, 2], "y-z": [0, 2, 1], "x-z": [1, 2, 0]}
+        transposes = {
+                "x-y": [0, 1, 2], "x-z": [2, 1, 0],
+                "y-x": [1, 0, 2], "y-z": [2, 0, 1],
+                "z-x": [1, 2, 0], "z-y": [0, 2, 1],
+                }
         transpose = pad_transpose(transposes[view], self.data.ndim)
         list(_plot_axes[view]) + [_slice_axes[view]]
-        data = np.transpose(self.get_standardised_data(force=force_standardise), 
+        data = np.transpose(self.get_standardised_data(force=force_standardise),
                             transpose)
+        x_ax, y_ax = _plot_axes[view]
+        if y_ax != 1:
+            data = data[::-1, :, :]
 
         # Apply shifts in plane if requested
-        x_ax, y_ax = _plot_axes[view]
         if shift[x_ax]:
             shift_x = round(shift[x_ax] / self.voxel_size[x_ax])
             data = np.roll(data, shift_x, axis=1)
             if shift_x > 0:
                 data[:, :shift_x] = self.get_min()
             else:
                 data[:, shift_x:] = self.get_min()
@@ -2394,16 +2403,16 @@
 
         For information on matplotlib colour maps, see:
             https://matplotlib.org/stable/gallery/color/colormap_reference.html
 
         **Parameters:**
         
         view : str
-            Orientation (any of "x-y", "x-z", "y-z"); needed to compute
-            correct aspect ratio and plot extent.
+            Orientation; (any of "x-y", "x-z", "y-x", "y-z", "z-x", or "z-y");
+            needed to compute correct aspect ratio and plot extent.
 
         mpl_kwargs : dict, default=None
             Dict of kwargs with which to overwrite default kwargs.
 
         scale_in_mm : bool, default=True
             If True, indicates that image will be plotted with axis scales in 
             mm; needed to compute correct aspect ratio and plot extent.
@@ -2448,15 +2457,15 @@
             else:
                 ims.extend(images)
 
         return BetterViewer(ims, **kwargs)
 
     def plot(
         self,
-        view=None,
+        view="x-y",
         sl=None,
         idx=None,
         pos=None,
         scale_in_mm=True,
         ax=None,
         gs=None,
         figsize=_default_figsize,
@@ -2521,18 +2530,18 @@
         df_opacity=None,
         df_kwargs=None,
     ):
         """Plot a 2D slice of the image.
 
         **Parameters:**
         
-        view : str, default=None
+        view : str/None, default='x-y'
             Orientation in which to plot the image. Can be any of 'x-y',
-            'y-z', and 'x-z'.  If None, the initial view is chosen to match
-            the image orienation.
+            'x-z', 'y-x', 'y-z', 'z-x', and 'z-y'.  If None, the initial
+            view is chosen to match the image orienation.
 
         sl : int, default=None
             Slice number to plot. Takes precedence over <idx> and <pos> if not
             None. If all of <sl>, <idx>, and <pos> are None, the central
             slice will be plotted.
 
         idx : int, default=None
@@ -3080,16 +3089,24 @@
                 mask_color=mask_color,
                 clb_kwargs=clb_kwargs2,
                 clb_label_kwargs=clb_label_kwargs2,
             )
 
         # Plot ROIs
         plotted_rois = []
+        image_ready = roi_kwargs.get("image_ready", False)
+        roi_kwargs["image_ready"] = True
         if consensus_type is None:
-            for roi in rois_to_plot:
+            for roi0 in rois_to_plot:
+                if image_ready or roi0.image is self:
+                    roi = roi0
+                else:
+                    roi = roi0.clone(copy_data=False)
+                    roi.set_image(self)
+                    roi.create_contours(force=True)
                 if roi.on_slice(view, pos=pos):
                     roi.plot(
                         view,
                         pos=pos,
                         ax=self.ax,
                         plot_type=roi_plot_type,
                         show=False,
@@ -3098,15 +3115,21 @@
                         color=roi.get_color_from_kwargs(roi_kwargs),
                         **roi_kwargs
                     )
                     plotted_rois.append(roi)
 
         # Consensus plot
         else:
-            roi_input[0].plot(
+            if image_ready or roi_input[0].image is self:
+                roi = roi_input[0]
+            else:
+                roi = roi_input[0].clone(copy_data=False)
+                roi.set_image(self)
+                roi.create_contours(force=True)
+            roi.plot(
                 view,
                 pos=pos,
                 ax=self.ax,
                 plot_type=roi_plot_type,
                 show=False,
                 include_image=False,
                 no_invert=True,
@@ -3460,15 +3483,15 @@
     def get_plot_aspect_ratio(
         self, view, zoom=None, n_colorbars=0, figsize=None
     ):
         """Estimate the ideal width/height ratio for a plot of this image
         in a given orientation.
 
         view : str
-            Orientation ('x-y', 'y-z', or 'x-z')
+            Orientation ('x-y', 'x-z', 'y-x', 'y-z', 'z-x', or 'z-y')
 
         zoom : float/list, default=None
             Zoom factors; either a single value for all axes, or three values
             in order (x, y, z).
 
         n_colorbars : int, default=0
             Number of colorbars to make space for.
@@ -3587,14 +3610,15 @@
         outname,
         standardise=False,
         write_geometry=True,
         nifti_array=False,
         overwrite=True,
         header_source=None,
         patient_id=None,
+        patient_position=None,
         modality=None,
         root_uid=None,
         verbose=True,
         header_extras={},
     ):
         """Write image data to a file. The filetype will automatically be
         set based on the extension of <outname>:
@@ -3675,14 +3699,15 @@
                 outdir,
                 data,
                 affine,
                 overwrite,
                 header_source,
                 orientation,
                 patient_id,
+                patient_position,
                 modality,
                 root_uid,
                 header_extras,
                 type(self).__name__,
                 filename
             )
             self.dicom_dataset = dicom_writer.write()
@@ -4828,15 +4853,15 @@
         from skrt.better_viewer import BetterViewer
         kwargs.setdefault("comparison", True)
 
         BetterViewer(self.ims, **kwargs)
 
     def plot(
         self,
-        view=None,
+        view="x-y",
         sl=None,
         idx=None,
         pos=None,
         scale_in_mm=True,
         invert=False,
         ax=None,
         mpl_kwargs=None,
@@ -5061,15 +5086,15 @@
         if handles:
             self.ax.legend(
                     handles=handles, bbox_to_anchor=legend_bbox_to_anchor,
                     loc=legend_loc, facecolor="white",
                     framealpha=1
                 )
 
-    def get_difference(self, view=None, sl=None, idx=None, pos=None, 
+    def get_difference(self, view="x-y", sl=None, idx=None, pos=None, 
                        invert=False, ab=False, reset_slices=True):
         """Get array containing difference between two Images."""
 
         # No view/position/index/slice given: use 3D arrays
         if reset_slices and (view is None and sl is None and pos is None and idx is None):
             diff = self.ims[1].get_data() - self.ims[0].get_data()
         else:
```

### Comparing `scikit-rt-0.4.8/src/skrt/multi.py` & `scikit-rt-0.4.9/src/skrt/multi.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/patient.py` & `scikit-rt-0.4.9/src/skrt/patient.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/registration.py` & `scikit-rt-0.4.9/src/skrt/registration.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/segmentation.py` & `scikit-rt-0.4.9/src/skrt/segmentation.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/simulation.py` & `scikit-rt-0.4.9/src/skrt/simulation.py`

 * *Files 2% similar despite different names*

```diff
@@ -233,15 +233,16 @@
                 ext_to_use = ext
                 outdir = outname.replace(ext, "")
         structure_set.write(outdir=outdir, ext=ext_to_use, 
                             overwrite=overwrite_roi_dir)
 
     def write_dicom_dataset(
             self, patient_id="001", outdir="synthetic_dicom", modality="CT",
-            series_number=1, root_uid=None, verbose=False):
+            series_number=1, structure_set_label="Geometric structures",
+            root_uid=None, verbose=False):
         """
         Write image and associated structure set as a patient DICOM dataset.
 
         **Parameters:**
 
         patient_id: str, default="001"
             Patient identifier to be assigned to the dataset.
@@ -251,14 +252,17 @@
 
         modality: str, default="CT"
             Modality to be assigned to synthetic image.
 
         series_number: int, default=1
             Series number to be assigned to synthetic image.
 
+        structure_set_label: str, default="Geometric structures"
+            Label to be assigned to structure set, if present.
+
         root_uid : str, default=None
             Root to be used in Globally Unique Identifiers (GUIDs).  This
             should uniquely identify the institution or group generating
             the GUID.  If None, the value of pydicom.uid.PYDICOM_ROOT_UID
             is used.
 
         verbose : bool, default=False
@@ -281,17 +285,19 @@
         
         # Write structure set, if non-empty,
         # after associating to it the DICOM image,
         if ss.get_roi_names():
             im = Image(tmp_dir)
             ds = im.get_dicom_dataset()
             header_extras = {
+                "SeriesNumber" : ds.SeriesNumber,
                 "StudyInstanceUID" : ds.StudyInstanceUID,
                 "StudyDate" : ds.StudyDate,
                 "StudyTime" : ds.StudyTime,
+                "StructureSetLabel" : structure_set_label,
             }
             ss.set_image(im)
             ss.write(outdir=tmp_dir, ext=".dcm", patient_id=patient_id,
                      modality=modality, root_uid=root_uid,
                      header_extras=header_extras, verbose=verbose)
         
         # Load the DICOM data, then rewrite as a sorted dataset.
@@ -693,15 +699,15 @@
     ear_size_x = np.random.uniform(20, 60)
     ear_size_y = np.random.uniform(5, 20)
     ear_size_z = np.random.uniform(40, 60)
 
     # Eyes
     eye_angle = np.random.uniform(15, 40)
     eye_radius = np.random.uniform(5, 15)
-    eye_offset_z = np.random.uniform(0, 10)
+    eye_offset_z = np.random.uniform(-20, -30)
 
     # Teeth
     teeth_bottom_row_from_chin = np.random.uniform(10, 20)
     teeth_row_spacing = np.random.uniform(5, 15)
     teeth_angle_spacing = np.random.uniform(5, 10)
     teeth_size = np.random.uniform(5, 10)
     teeth_radius_frac = np.random.uniform(0.7, 0.9)
@@ -725,46 +731,46 @@
                 centre[1] + ear_offset_y,
                 centre[2] + ear_offset_z
             ],
             group='head'
         )
 
     # Add eyes
-    for i, name in zip([-1, 1], ['right', 'left']):
+    for i, name in zip([-1, 1], ['left', 'right']):
         head_image.add_sphere(
             radius=eye_radius,
             centre=[
-                centre[0] + head_radius * np.sin(np.radians(eye_angle)) * i,
-                centre[1] + head_radius * np.cos(np.radians(eye_angle)),
-                centre[2] + eye_offset_z
+                centre[0] - head_radius * np.sin(np.radians(eye_angle)) * i,
+                centre[1] - head_radius * np.cos(np.radians(eye_angle)),
+                centre[2] - eye_offset_z
             ],
             intensity=40,
             name='eye_' + name
         )
 
     # Add teeth
     for i in [-2, -1, 1, 2]:
         radius = head_radius * teeth_radius_frac
         angle = np.sign(i) * np.radians((abs(i) - 0.5) * teeth_angle_spacing)
         z = centre[2] - head_height / 2 + teeth_bottom_row_from_chin
         head_image.add_cube(
             side_length=teeth_size,
             centre=[
                 centre[0] + np.sin(angle) * radius,
-                centre[1] + np.cos(angle) * radius,
+                centre[1] - np.cos(angle) * radius,
                 z
             ],
             intensity=100,
             group='teeth'
         )
         head_image.add_cube(
             side_length=teeth_size,
             centre=[
                 centre[0] + np.sin(angle) * radius,
-                centre[1] + np.cos(angle) * radius,
+                centre[1] - np.cos(angle) * radius,
                 z + teeth_row_spacing
             ],
             intensity=100,
             group='teeth'
         )
 
     return head_image
```

### Comparing `scikit-rt-0.4.8/src/skrt/structures.py` & `scikit-rt-0.4.9/src/skrt/structures.py`

 * *Files 3% similar despite different names*

```diff
@@ -1337,20683 +1337,21071 @@
 00005380: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
 00005390: 6573 6574 2078 2d79 2063 6f6e 746f 7572  eset x-y contour
 000053a0: 7320 746f 2061 2067 6976 656e 2064 6963  s to a given dic
 000053b0: 7420 6f66 2073 6c69 6365 7320 616e 6420  t of slices and 
 000053c0: 636f 6e74 6f75 7220 6c69 7374 732c 200a  contour lists, .
 000053d0: 2020 2020 2020 2020 616e 6420 656e 7375          and ensu
 000053e0: 7265 2074 6861 7420 6d61 736b 2061 6e64  re that mask and
-000053f0: 2079 2d7a 2f78 2d7a 2063 6f6e 746f 7572   y-z/x-z contour
-00005400: 7320 7769 6c6c 2062 6520 7265 6372 6561  s will be recrea
-00005410: 7465 642e 2049 6620 0a20 2020 2020 2020  ted. If .       
-00005420: 2063 6f6e 746f 7572 7320 6973 204e 6f6e   contours is Non
-00005430: 652c 2063 6f6e 746f 7572 7320 7769 6c6c  e, contours will
-00005440: 2062 6520 7265 7365 7420 7573 696e 6720   be reset using 
-00005450: 6f77 6e20 782d 7920 636f 6e74 6f75 7273  own x-y contours
-00005460: 2e0a 2020 2020 2020 2020 4966 206d 6f73  ..        If mos
-00005470: 745f 706f 696e 7473 2069 7320 5472 7565  t_points is True
-00005480: 2c20 6f6e 6c79 2074 6865 2063 6f6e 746f  , only the conto
-00005490: 7572 2077 6974 6820 6d6f 7374 2070 6f69  ur with most poi
-000054a0: 6e74 7320 666f 720a 2020 2020 2020 2020  nts for.        
-000054b0: 6561 6368 2073 6c69 6365 2069 7320 636f  each slice is co
-000054c0: 6e73 6964 6572 6564 2e22 2222 0a0a 2020  nsidered."""..  
-000054d0: 2020 2020 2020 2320 4368 6563 6b20 666f        # Check fo
-000054e0: 726d 6174 2069 7320 636f 7272 6563 740a  rmat is correct.
-000054f0: 2020 2020 2020 2020 6966 2063 6f6e 746f          if conto
-00005500: 7572 7320 6973 204e 6f6e 653a 0a20 2020  urs is None:.   
-00005510: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
-00005520: 7320 3d20 7365 6c66 2e67 6574 5f63 6f6e  s = self.get_con
-00005530: 746f 7572 7328 290a 2020 2020 2020 2020  tours().        
-00005540: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00005550: 6528 636f 6e74 6f75 7273 2c20 6469 6374  e(contours, dict
-00005560: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00005570: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
-00005580: 636f 6e74 6f75 7273 2073 686f 756c 6420  contours should 
-00005590: 6265 2061 2064 6963 7422 290a 2020 2020  be a dict").    
-000055a0: 2020 2020 666f 7220 7a2c 2063 2069 6e20      for z, c in 
-000055b0: 636f 6e74 6f75 7273 2e69 7465 6d73 2829  contours.items()
-000055c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000055d0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-000055e0: 632c 206c 6973 7429 3a0a 2020 2020 2020  c, list):.      
-000055f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00005600: 5479 7065 4572 726f 7228 6622 636f 6e74  TypeError(f"cont
-00005610: 6f75 7273 5b7b 7a7d 5d20 7368 6f75 6c64  ours[{z}] should
-00005620: 2062 6520 6120 6c69 7374 206f 6620 636f   be a list of co
-00005630: 6e74 6f75 7273 2022 0a20 2020 2020 2020  ntours ".       
-00005640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005650: 2020 2020 2020 2020 2066 226f 6e20 736c           f"on sl
-00005660: 6963 6520 7b7a 7d22 290a 0a20 2020 2020  ice {z}")..     
-00005670: 2020 2023 2046 6f72 2065 6163 6820 736c     # For each sl
-00005680: 6963 652c 206b 6565 7020 6f6e 6c79 2063  ice, keep only c
-00005690: 6f6e 746f 7572 2077 6974 6820 6d6f 7374  ontour with most
-000056a0: 2070 6f69 6e74 732e 0a20 2020 2020 2020   points..       
-000056b0: 2069 6620 6d6f 7374 5f70 6f69 6e74 733a   if most_points:
-000056c0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-000056d0: 746f 7572 7320 3d20 7b6b 6579 3a20 5b6d  tours = {key: [m
-000056e0: 6178 2876 616c 7565 2c20 6b65 793d 6c65  ax(value, key=le
-000056f0: 6e29 5d0a 2020 2020 2020 2020 2020 2020  n)].            
-00005700: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
-00005710: 2076 616c 7565 2069 6e20 636f 6e74 6f75   value in contou
-00005720: 7273 2e69 7465 6d73 2829 7d0a 0a20 2020  rs.items()}..   
-00005730: 2020 2020 2073 656c 662e 696e 7075 745f       self.input_
-00005740: 636f 6e74 6f75 7273 203d 2063 6f6e 746f  contours = conto
-00005750: 7572 730a 2020 2020 2020 2020 7365 6c66  urs.        self
-00005760: 2e65 6d70 7479 203d 206e 6f74 206c 656e  .empty = not len
-00005770: 2873 656c 662e 696e 7075 745f 636f 6e74  (self.input_cont
-00005780: 6f75 7273 290a 2020 2020 2020 2020 7365  ours).        se
-00005790: 6c66 2e63 6f6e 746f 7572 7320 3d20 7b22  lf.contours = {"
-000057a0: 782d 7922 3a20 636f 6e74 6f75 7273 7d0a  x-y": contours}.
-000057b0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-000057c0: 6465 645f 6d61 736b 203d 2046 616c 7365  ded_mask = False
-000057d0: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-000057e0: 736b 203d 204e 6f6e 650a 0a20 2020 2064  sk = None..    d
-000057f0: 6566 2072 6573 6574 5f6d 6173 6b28 7365  ef reset_mask(se
-00005800: 6c66 2c20 6d61 736b 3d4e 6f6e 6529 3a0a  lf, mask=None):.
-00005810: 2020 2020 2020 2020 2222 2253 6574 206d          """Set m
-00005820: 6173 6b20 746f 2065 6974 6865 7220 6120  ask to either a 
-00005830: 6e75 6d70 7920 6172 7261 7920 6f72 2061  numpy array or a
-00005840: 6e20 496d 6167 6520 6f62 6a65 6374 2c20  n Image object, 
-00005850: 616e 6420 656e 7375 7265 200a 2020 2020  and ensure .    
-00005860: 2020 2020 7468 6174 2063 6f6e 746f 7572      that contour
-00005870: 7320 7769 6c6c 2062 6520 7265 6372 6561  s will be recrea
-00005880: 7465 642e 2049 6620 6d61 736b 2069 7320  ted. If mask is 
-00005890: 4e6f 6e65 2c20 636f 6e74 6f75 7273 2077  None, contours w
-000058a0: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
-000058b0: 7265 7365 7420 7573 696e 6720 6f77 6e20  reset using own 
-000058c0: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
-000058d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000058e0: 6d61 736b 2c20 736b 7274 2e69 6d61 6765  mask, skrt.image
-000058f0: 2e49 6d61 6765 293a 0a20 2020 2020 2020  .Image):.       
-00005900: 2020 2020 2073 656c 662e 6d61 736b 203d       self.mask =
-00005910: 206d 6173 6b0a 2020 2020 2020 2020 2020   mask.          
-00005920: 2020 7365 6c66 2e61 6666 696e 6520 3d20    self.affine = 
-00005930: 6d61 736b 2e67 6574 5f61 6666 696e 6528  mask.get_affine(
-00005940: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005950: 6c66 2e76 6f78 656c 5f73 697a 6520 3d20  lf.voxel_size = 
-00005960: 6d61 736b 2e67 6574 5f76 6f78 656c 5f73  mask.get_voxel_s
-00005970: 697a 6528 290a 2020 2020 2020 2020 2020  ize().          
-00005980: 2020 7365 6c66 2e6f 7269 6769 6e20 3d20    self.origin = 
-00005990: 6d61 736b 2e67 6574 5f6f 7269 6769 6e28  mask.get_origin(
-000059a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000059b0: 6c66 2e73 6861 7065 203d 206d 6173 6b2e  lf.shape = mask.
-000059c0: 6765 745f 6461 7461 2829 2e73 6861 7065  get_data().shape
-000059d0: 0a0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-000059e0: 7369 6e73 7461 6e63 6528 6d61 736b 2c20  sinstance(mask, 
-000059f0: 6e70 2e6e 6461 7272 6179 293a 0a20 2020  np.ndarray):.   
-00005a00: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
-00005a10: 736b 203d 2073 6b72 742e 696d 6167 652e  sk = skrt.image.
-00005a20: 496d 6167 6528 0a20 2020 2020 2020 2020  Image(.         
-00005a30: 2020 2020 2020 206d 6173 6b2c 0a20 2020         mask,.   
-00005a40: 2020 2020 2020 2020 2020 2020 2061 6666               aff
-00005a50: 696e 6520 3d20 7365 6c66 2e61 6666 696e  ine = self.affin
-00005a60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00005a70: 2020 2076 6f78 656c 5f73 697a 653d 7365     voxel_size=se
-00005a80: 6c66 2e76 6f78 656c 5f73 697a 652c 0a20  lf.voxel_size,. 
-00005a90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00005aa0: 7269 6769 6e3d 7365 6c66 2e6f 7269 6769  rigin=self.origi
-00005ab0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00005ac0: 2020 2064 7479 7065 3d62 6f6f 6c0a 2020     dtype=bool.  
-00005ad0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00005ae0: 2020 2020 2065 6c69 6620 6d61 736b 2069       elif mask i
-00005af0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00005b00: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00005b10: 7065 4572 726f 7228 226d 6173 6b20 7368  peError("mask sh
-00005b20: 6f75 6c64 2062 6520 616e 2049 6d61 6765  ould be an Image
-00005b30: 206f 7220 6120 6e75 6d70 7920 6172 7261   or a numpy arra
-00005b40: 7922 290a 0a20 2020 2020 2020 2073 656c  y")..        sel
-00005b50: 662e 6d61 736b 2e67 6574 5f73 7461 6e64  f.mask.get_stand
-00005b60: 6172 6469 7365 645f 6461 7461 2866 6f72  ardised_data(for
-00005b70: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
-00005b80: 2073 656c 662e 6c6f 6164 6564 5f6d 6173   self.loaded_mas
-00005b90: 6b20 3d20 5472 7565 0a20 2020 2020 2020  k = True.       
-00005ba0: 2073 656c 662e 636f 6e74 6f75 7273 203d   self.contours =
-00005bb0: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
-00005bc0: 2e65 6d70 7479 203d 206e 6f74 206e 702e  .empty = not np.
-00005bd0: 616e 7928 7365 6c66 2e6d 6173 6b2e 6765  any(self.mask.ge
-00005be0: 745f 6461 7461 2829 290a 2020 2020 2020  t_data()).      
-00005bf0: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
-00005c00: 746f 7572 7320 3d20 4e6f 6e65 0a0a 2020  tours = None..  
-00005c10: 2020 6465 6620 6765 745f 636f 6e74 6f75    def get_contou
-00005c20: 7273 2873 656c 662c 2076 6965 773d 2278  rs(self, view="x
-00005c30: 2d79 222c 2069 6478 5f61 735f 6b65 793d  -y", idx_as_key=
-00005c40: 4661 6c73 652c 206d 6f73 745f 706f 696e  False, most_poin
-00005c50: 7473 3d46 616c 7365 293a 0a20 2020 2020  ts=False):.     
-00005c60: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
-00005c70: 6574 2064 6963 7420 6f66 2063 6f6e 746f  et dict of conto
-00005c80: 7572 7320 696e 2061 2067 6976 656e 206f  urs in a given o
-00005c90: 7269 656e 7461 7469 6f6e 2e0a 0a20 2020  rientation...   
-00005ca0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-00005cb0: 733a 2a2a 0a0a 2020 2020 2020 2020 7669  s:**..        vi
-00005cc0: 6577 203a 2073 7472 2c20 6465 6661 756c  ew : str, defaul
-00005cd0: 743d 2278 2d79 220a 2020 2020 2020 2020  t="x-y".        
-00005ce0: 2020 2020 5669 6577 2069 6e20 7768 6963      View in whic
-00005cf0: 6820 746f 206f 6274 6169 6e20 636f 6e74  h to obtain cont
-00005d00: 6f75 7273 2e0a 0a20 2020 2020 2020 2069  ours...        i
-00005d10: 6478 5f61 735f 6b65 7920 3a20 626f 6f6c  dx_as_key : bool
-00005d20: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00005d30: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00005d40: 7275 652c 2075 7365 2073 6c69 6365 2069  rue, use slice i
-00005d50: 6e64 6963 6573 2061 7320 6469 6374 696f  ndices as dictio
-00005d60: 6e61 7279 206b 6579 733b 2069 6620 4661  nary keys; if Fa
-00005d70: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00005d80: 2075 7365 2073 6c69 6365 207a 2d63 6f6f   use slice z-coo
-00005d90: 7264 696e 6174 6573 2061 7320 6469 6374  rdinates as dict
-00005da0: 696f 6e61 7279 206b 6579 732e 0a0a 2020  ionary keys...  
-00005db0: 2020 2020 2020 6d6f 7374 5f70 6f69 6e74        most_point
-00005dc0: 7320 3a20 626f 6f6c 2c20 6465 6661 756c  s : bool, defaul
-00005dd0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00005de0: 2020 2020 4966 2054 7275 652c 2072 6574      If True, ret
-00005df0: 7572 6e20 6f6e 6c79 2074 6865 2063 6f6e  urn only the con
-00005e00: 746f 7572 2077 6974 6820 6d6f 7374 2070  tour with most p
-00005e10: 6f69 6e74 7320 666f 7220 6561 6368 2073  oints for each s
-00005e20: 6c69 6365 3b0a 2020 2020 2020 2020 2020  lice;.          
-00005e30: 2020 6966 2046 616c 7365 2c20 7265 7475    if False, retu
-00005e40: 726e 2061 6c6c 2063 6f6e 746f 7572 7320  rn all contours 
-00005e50: 666f 7220 6561 6368 2073 6c69 6365 2e0a  for each slice..
-00005e60: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00005e70: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-00005e80: 0a20 2020 2020 2020 2069 6620 7669 6577  .        if view
-00005e90: 206e 6f74 2069 6e20 7365 6c66 2e63 6f6e   not in self.con
-00005ea0: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
-00005eb0: 2020 2073 656c 662e 6372 6561 7465 5f63     self.create_c
-00005ec0: 6f6e 746f 7572 7328 7669 6577 290a 2020  ontours(view).  
-00005ed0: 2020 2020 2020 636f 6e74 6f75 7273 203d        contours =
-00005ee0: 2073 656c 662e 636f 6e74 6f75 7273 5b76   self.contours[v
-00005ef0: 6965 775d 0a0a 2020 2020 2020 2020 2320  iew]..        # 
-00005f00: 436f 6e76 6572 7420 6b65 7973 2074 6f20  Convert keys to 
-00005f10: 696e 6469 6365 7320 7261 7468 6572 2074  indices rather t
-00005f20: 6861 6e20 706f 7369 7469 6f6e 730a 2020  han positions.  
-00005f30: 2020 2020 2020 6966 2069 6478 5f61 735f        if idx_as_
-00005f40: 6b65 793a 0a20 2020 2020 2020 2020 2020  key:.           
-00005f50: 2063 6f6e 746f 7572 7320 3d20 7b73 656c   contours = {sel
-00005f60: 662e 706f 735f 746f 5f69 6478 286b 6579  f.pos_to_idx(key
-00005f70: 2c20 736b 7274 2e69 6d61 6765 2e5f 736c  , skrt.image._sl
-00005f80: 6963 655f 6178 6573 5b76 6965 775d 293a  ice_axes[view]):
-00005f90: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00005fa0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-00005fb0: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
-00005fc0: 6e20 636f 6e74 6f75 7273 2e69 7465 6d73  n contours.items
-00005fd0: 2829 7d0a 0a20 2020 2020 2020 2023 2046  ()}..        # F
-00005fe0: 6f72 2065 6163 6820 736c 6963 652c 206b  or each slice, k
-00005ff0: 6565 7020 6f6e 6c79 2063 6f6e 746f 7572  eep only contour
-00006000: 2077 6974 6820 6d6f 7374 2070 6f69 6e74   with most point
-00006010: 732e 0a20 2020 2020 2020 2069 6620 6d6f  s..        if mo
-00006020: 7374 5f70 6f69 6e74 733a 0a20 2020 2020  st_points:.     
-00006030: 2020 2020 2020 2063 6f6e 746f 7572 7320         contours 
-00006040: 3d20 7b6b 6579 3a20 5b6d 6178 2876 616c  = {key: [max(val
-00006050: 7565 2c20 6b65 793d 6c65 6e29 5d0a 2020  ue, key=len)].  
-00006060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006070: 2020 666f 7220 6b65 792c 2076 616c 7565    for key, value
-00006080: 2069 6e20 636f 6e74 6f75 7273 2e69 7465   in contours.ite
-00006090: 6d73 2829 7d0a 0a20 2020 2020 2020 2072  ms()}..        r
-000060a0: 6574 7572 6e20 636f 6e74 6f75 7273 0a0a  eturn contours..
-000060b0: 2020 2020 6465 6620 6765 745f 636f 6e74      def get_cont
-000060c0: 6f75 7273 5f6f 6e5f 736c 6963 6528 7365  ours_on_slice(se
-000060d0: 6c66 2c20 7669 6577 3d22 782d 7922 2c20  lf, view="x-y", 
-000060e0: 736c 3d4e 6f6e 652c 2069 6478 3d4e 6f6e  sl=None, idx=Non
-000060f0: 652c 2070 6f73 3d4e 6f6e 6529 3a0a 0a20  e, pos=None):.. 
-00006100: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00006110: 2829 0a20 2020 2020 2020 2069 6620 736c  ().        if sl
-00006120: 2069 7320 4e6f 6e65 2061 6e64 2069 6478   is None and idx
-00006130: 2069 7320 4e6f 6e65 2061 6e64 2070 6f73   is None and pos
-00006140: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00006150: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
-00006160: 2e67 6574 5f6d 6964 5f69 6478 2876 6965  .get_mid_idx(vie
-00006170: 7729 0a20 2020 2020 2020 2065 6c73 653a  w).        else:
-00006180: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-00006190: 203d 2073 656c 662e 6765 745f 6964 7828   = self.get_idx(
-000061a0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-000061b0: 6f73 290a 2020 2020 2020 2020 7472 793a  os).        try:
-000061c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000061d0: 7572 6e20 7365 6c66 2e67 6574 5f63 6f6e  urn self.get_con
-000061e0: 746f 7572 7328 7669 6577 2c20 6964 785f  tours(view, idx_
-000061f0: 6173 5f6b 6579 3d54 7275 6529 5b69 6478  as_key=True)[idx
-00006200: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
-00006210: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-00006220: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
-00006230: 0a0a 2020 2020 6465 6620 6765 745f 736c  ..    def get_sl
-00006240: 6963 655f 706f 7369 7469 6f6e 7328 7365  ice_positions(se
-00006250: 6c66 2c20 6f74 6865 723d 4e6f 6e65 2c20  lf, other=None, 
-00006260: 7669 6577 3d22 782d 7922 2c20 706f 7369  view="x-y", posi
-00006270: 7469 6f6e 5f61 735f 6964 783d 4661 6c73  tion_as_idx=Fals
-00006280: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-00006290: 6574 686f 643d 2275 6e69 6f6e 2229 3a0a  ethod="union"):.
-000062a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000062b0: 2020 2020 4765 7420 6f72 6465 7265 6420      Get ordered 
-000062c0: 6c69 7374 206f 6620 736c 6963 6520 706f  list of slice po
-000062d0: 7369 7469 6f6e 7320 666f 7220 7365 6c66  sitions for self
-000062e0: 2061 6e64 206f 7468 6572 2e0a 0a20 2020   and other...   
-000062f0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-00006300: 733a 2a2a 0a0a 2020 2020 2020 2020 6f74  s:**..        ot
-00006310: 6865 7220 3a20 736b 7274 2e73 7472 7563  her : skrt.struc
-00006320: 7475 7265 732e 524f 492c 2064 6566 6175  tures.ROI, defau
-00006330: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00006340: 2020 2020 5365 636f 6e64 2052 4f49 206f      Second ROI o
-00006350: 6620 6120 7061 6972 2066 6f72 2077 6869  f a pair for whi
-00006360: 6368 2073 6c69 6365 2070 6f73 6974 696f  ch slice positio
-00006370: 6e73 2061 7265 2062 6520 6f62 7461 696e  ns are be obtain
-00006380: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-00006390: 4469 7372 6567 6172 6465 6420 6966 204e  Disregarded if N
-000063a0: 6f6e 652e 0a0a 2020 2020 2020 2020 7669  one...        vi
-000063b0: 6577 203a 2073 7472 2c20 6465 6661 756c  ew : str, defaul
-000063c0: 743d 2278 2d79 220a 2020 2020 2020 2020  t="x-y".        
-000063d0: 2020 2020 5669 6577 2069 6e20 7768 6963      View in whic
-000063e0: 6820 746f 206f 6274 6169 6e20 736c 6963  h to obtain slic
-000063f0: 6573 2e0a 0a20 2020 2020 2020 2070 6f73  es...        pos
-00006400: 6974 696f 6e5f 6173 5f69 6478 203a 2062  ition_as_idx : b
-00006410: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
-00006420: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
-00006430: 6620 5472 7565 2c20 7265 7475 726e 2070  f True, return p
-00006440: 6f73 6974 696f 6e73 2061 7320 736c 6963  ositions as slic
-00006450: 6520 696e 6469 6365 733b 2069 6620 4661  e indices; if Fa
-00006460: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00006470: 2072 6574 7572 6e20 706f 7369 7469 6f6e   return position
-00006480: 7320 6173 2073 6c69 6365 207a 2d63 6f6f  s as slice z-coo
-00006490: 7264 696e 6174 6573 2028 6d6d 292e 0a0a  rdinates (mm)...
-000064a0: 2020 2020 2020 2020 6d65 7468 6f64 3a20          method: 
-000064b0: 7374 722c 2064 6566 6175 6c74 3d22 756e  str, default="un
-000064c0: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
-000064d0: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
-000064e0: 6e67 2073 6c69 6365 7320 666f 7220 7768  ng slices for wh
-000064f0: 6963 6820 706f 7369 7469 6f6e 7320 6172  ich positions ar
-00006500: 6520 746f 2062 6520 6f62 7461 696e 6564  e to be obtained
-00006510: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
-00006520: 7220 524f 4973 2073 656c 6620 616e 6420  r ROIs self and 
-00006530: 6f74 6865 722e 0a0a 2020 2020 2020 2020  other...        
-00006540: 2020 2020 2d20 226c 6566 7422 2028 6f72      - "left" (or
-00006550: 206f 7468 6572 2069 7320 4e6f 6e65 293a   other is None):
-00006560: 2072 6574 7572 6e20 706f 7369 7469 6f6e   return position
-00006570: 7320 6f66 0a20 2020 2020 2020 2020 2020  s of.           
-00006580: 2020 2073 6c69 6365 7320 636f 6e74 6169     slices contai
-00006590: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
-000065a0: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
-000065b0: 3a20 7265 7475 726e 2070 6f73 6974 696f  : return positio
-000065c0: 6e73 206f 6620 736c 6963 6573 2063 6f6e  ns of slices con
-000065d0: 7461 696e 696e 6720 6f74 6865 723b 0a20  taining other;. 
-000065e0: 2020 2020 2020 2020 2020 202d 2022 756e             - "un
-000065f0: 696f 6e22 3a20 7265 7475 726e 2070 6f73  ion": return pos
-00006600: 6974 696f 6e73 206f 6620 736c 6963 6573  itions of slices
-00006610: 2063 6f6e 7461 696e 696e 6720 6569 7468   containing eith
-00006620: 6572 2073 656c 660a 2020 2020 2020 2020  er self.        
-00006630: 2020 2020 2020 6f72 206f 7468 6572 3b0a        or other;.
-00006640: 2020 2020 2020 2020 2020 2020 2d20 2269              - "i
-00006650: 6e74 6572 7365 6374 696f 6e22 3a20 7265  ntersection": re
-00006660: 7475 726e 2070 6f73 6974 696f 6e73 206f  turn positions o
-00006670: 6620 736c 6963 6573 2063 6f6e 7461 696e  f slices contain
-00006680: 696e 6720 626f 7468 0a20 2020 2020 2020  ing both.       
-00006690: 2020 2020 2020 2073 656c 6620 616e 6420         self and 
-000066a0: 6f74 6865 722e 0a20 2020 2020 2020 2022  other..        "
-000066b0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-000066c0: 6e20 6765 745f 736c 6963 655f 706f 7369  n get_slice_posi
-000066d0: 7469 6f6e 7328 7365 6c66 2c20 6f74 6865  tions(self, othe
-000066e0: 722c 2076 6965 772c 2070 6f73 6974 696f  r, view, positio
-000066f0: 6e5f 6173 5f69 6478 2c0a 2020 2020 2020  n_as_idx,.      
-00006700: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00006710: 290a 0a20 2020 2064 6566 2067 6574 5f61  )..    def get_a
-00006720: 6666 696e 6528 7365 6c66 2c20 666f 7263  ffine(self, forc
-00006730: 655f 7374 616e 6461 7264 6973 653d 4661  e_standardise=Fa
-00006740: 6c73 652c 202a 2a6b 7761 7267 7329 3a0a  lse, **kwargs):.
-00006750: 2020 2020 2020 2020 2222 224c 6f61 6420          """Load 
-00006760: 7365 6c66 2061 6e64 2067 6574 2061 6666  self and get aff
-00006770: 696e 6520 6d61 7472 6978 2e22 2222 0a0a  ine matrix."""..
-00006780: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-00006790: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
-000067a0: 656c 662e 6c6f 6164 6564 5f6d 6173 6b3a  elf.loaded_mask:
-000067b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000067c0: 7572 6e20 7365 6c66 2e6d 6173 6b2e 6765  urn self.mask.ge
-000067d0: 745f 6166 6669 6e65 2866 6f72 6365 5f73  t_affine(force_s
-000067e0: 7461 6e64 6172 6469 7365 3d66 6f72 6365  tandardise=force
-000067f0: 5f73 7461 6e64 6172 6469 7365 2c20 0a20  _standardise, . 
-00006800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000053f0: 2079 2d78 2f79 2d78 2f79 2d7a 2f7a 2d78   y-x/y-x/y-z/z-x
+00005400: 2f7a 2d79 2063 6f6e 746f 7572 7320 7769  /z-y contours wi
+00005410: 6c6c 2062 6520 7265 6372 6561 7465 642e  ll be recreated.
+00005420: 0a20 2020 2020 2020 2049 6620 636f 6e74  .        If cont
+00005430: 6f75 7273 2069 7320 4e6f 6e65 2c20 636f  ours is None, co
+00005440: 6e74 6f75 7273 2077 696c 6c20 6265 2072  ntours will be r
+00005450: 6573 6574 2075 7369 6e67 206f 776e 2078  eset using own x
+00005460: 2d79 2063 6f6e 746f 7572 732e 0a20 2020  -y contours..   
+00005470: 2020 2020 2049 6620 6d6f 7374 5f70 6f69       If most_poi
+00005480: 6e74 7320 6973 2054 7275 652c 206f 6e6c  nts is True, onl
+00005490: 7920 7468 6520 636f 6e74 6f75 7220 7769  y the contour wi
+000054a0: 7468 206d 6f73 7420 706f 696e 7473 2066  th most points f
+000054b0: 6f72 0a20 2020 2020 2020 2065 6163 6820  or.        each 
+000054c0: 736c 6963 6520 6973 2063 6f6e 7369 6465  slice is conside
+000054d0: 7265 642e 2222 220a 0a20 2020 2020 2020  red."""..       
+000054e0: 2023 2043 6865 636b 2066 6f72 6d61 7420   # Check format 
+000054f0: 6973 2063 6f72 7265 6374 0a20 2020 2020  is correct.     
+00005500: 2020 2069 6620 636f 6e74 6f75 7273 2069     if contours i
+00005510: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00005520: 2020 2020 636f 6e74 6f75 7273 203d 2073      contours = s
+00005530: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
+00005540: 2829 0a20 2020 2020 2020 2069 6620 6e6f  ().        if no
+00005550: 7420 6973 696e 7374 616e 6365 2863 6f6e  t isinstance(con
+00005560: 746f 7572 732c 2064 6963 7429 3a0a 2020  tours, dict):.  
+00005570: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00005580: 5479 7065 4572 726f 7228 2263 6f6e 746f  TypeError("conto
+00005590: 7572 7320 7368 6f75 6c64 2062 6520 6120  urs should be a 
+000055a0: 6469 6374 2229 0a20 2020 2020 2020 2066  dict").        f
+000055b0: 6f72 207a 2c20 6320 696e 2063 6f6e 746f  or z, c in conto
+000055c0: 7572 732e 6974 656d 7328 293a 0a20 2020  urs.items():.   
+000055d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000055e0: 6973 696e 7374 616e 6365 2863 2c20 6c69  isinstance(c, li
+000055f0: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+00005600: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00005610: 7272 6f72 2866 2263 6f6e 746f 7572 735b  rror(f"contours[
+00005620: 7b7a 7d5d 2073 686f 756c 6420 6265 2061  {z}] should be a
+00005630: 206c 6973 7420 6f66 2063 6f6e 746f 7572   list of contour
+00005640: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
+00005650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005660: 2020 2020 6622 6f6e 2073 6c69 6365 207b      f"on slice {
+00005670: 7a7d 2229 0a0a 2020 2020 2020 2020 2320  z}")..        # 
+00005680: 466f 7220 6561 6368 2073 6c69 6365 2c20  For each slice, 
+00005690: 6b65 6570 206f 6e6c 7920 636f 6e74 6f75  keep only contou
+000056a0: 7220 7769 7468 206d 6f73 7420 706f 696e  r with most poin
+000056b0: 7473 2e0a 2020 2020 2020 2020 6966 206d  ts..        if m
+000056c0: 6f73 745f 706f 696e 7473 3a0a 2020 2020  ost_points:.    
+000056d0: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
+000056e0: 203d 207b 6b65 793a 205b 6d61 7828 7661   = {key: [max(va
+000056f0: 6c75 652c 206b 6579 3d6c 656e 295d 0a20  lue, key=len)]. 
+00005700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005710: 2020 2066 6f72 206b 6579 2c20 7661 6c75     for key, valu
+00005720: 6520 696e 2063 6f6e 746f 7572 732e 6974  e in contours.it
+00005730: 656d 7328 297d 0a0a 2020 2020 2020 2020  ems()}..        
+00005740: 7365 6c66 2e69 6e70 7574 5f63 6f6e 746f  self.input_conto
+00005750: 7572 7320 3d20 636f 6e74 6f75 7273 0a20  urs = contours. 
+00005760: 2020 2020 2020 2073 656c 662e 656d 7074         self.empt
+00005770: 7920 3d20 6e6f 7420 6c65 6e28 7365 6c66  y = not len(self
+00005780: 2e69 6e70 7574 5f63 6f6e 746f 7572 7329  .input_contours)
+00005790: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+000057a0: 6e74 6f75 7273 203d 207b 2278 2d79 223a  ntours = {"x-y":
+000057b0: 2063 6f6e 746f 7572 737d 0a20 2020 2020   contours}.     
+000057c0: 2020 2073 656c 662e 6c6f 6164 6564 5f6d     self.loaded_m
+000057d0: 6173 6b20 3d20 4661 6c73 650a 2020 2020  ask = False.    
+000057e0: 2020 2020 7365 6c66 2e6d 6173 6b20 3d20      self.mask = 
+000057f0: 4e6f 6e65 0a0a 2020 2020 6465 6620 7265  None..    def re
+00005800: 7365 745f 6d61 736b 2873 656c 662c 206d  set_mask(self, m
+00005810: 6173 6b3d 4e6f 6e65 293a 0a20 2020 2020  ask=None):.     
+00005820: 2020 2022 2222 5365 7420 6d61 736b 2074     """Set mask t
+00005830: 6f20 6569 7468 6572 2061 206e 756d 7079  o either a numpy
+00005840: 2061 7272 6179 206f 7220 616e 2049 6d61   array or an Ima
+00005850: 6765 206f 626a 6563 742c 2061 6e64 2065  ge object, and e
+00005860: 6e73 7572 6520 0a20 2020 2020 2020 2074  nsure .        t
+00005870: 6861 7420 636f 6e74 6f75 7273 2077 696c  hat contours wil
+00005880: 6c20 6265 2072 6563 7265 6174 6564 2e20  l be recreated. 
+00005890: 4966 206d 6173 6b20 6973 204e 6f6e 652c  If mask is None,
+000058a0: 2063 6f6e 746f 7572 7320 7769 6c6c 2062   contours will b
+000058b0: 6520 0a20 2020 2020 2020 2072 6573 6574  e .        reset
+000058c0: 2075 7369 6e67 206f 776e 206d 6173 6b2e   using own mask.
+000058d0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+000058e0: 6973 696e 7374 616e 6365 286d 6173 6b2c  isinstance(mask,
+000058f0: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+00005900: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00005910: 7365 6c66 2e6d 6173 6b20 3d20 6d61 736b  self.mask = mask
+00005920: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005930: 662e 6166 6669 6e65 203d 206d 6173 6b2e  f.affine = mask.
+00005940: 6765 745f 6166 6669 6e65 2829 0a20 2020  get_affine().   
+00005950: 2020 2020 2020 2020 2073 656c 662e 766f           self.vo
+00005960: 7865 6c5f 7369 7a65 203d 206d 6173 6b2e  xel_size = mask.
+00005970: 6765 745f 766f 7865 6c5f 7369 7a65 2829  get_voxel_size()
+00005980: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005990: 662e 6f72 6967 696e 203d 206d 6173 6b2e  f.origin = mask.
+000059a0: 6765 745f 6f72 6967 696e 2829 0a20 2020  get_origin().   
+000059b0: 2020 2020 2020 2020 2073 656c 662e 7368           self.sh
+000059c0: 6170 6520 3d20 6d61 736b 2e67 6574 5f64  ape = mask.get_d
+000059d0: 6174 6128 292e 7368 6170 650a 0a20 2020  ata().shape..   
+000059e0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+000059f0: 616e 6365 286d 6173 6b2c 206e 702e 6e64  ance(mask, np.nd
+00005a00: 6172 7261 7929 3a0a 2020 2020 2020 2020  array):.        
+00005a10: 2020 2020 7365 6c66 2e6d 6173 6b20 3d20      self.mask = 
+00005a20: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+00005a30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005a40: 2020 6d61 736b 2c0a 2020 2020 2020 2020    mask,.        
+00005a50: 2020 2020 2020 2020 6166 6669 6e65 203d          affine =
+00005a60: 2073 656c 662e 6166 6669 6e65 2c0a 2020   self.affine,.  
+00005a70: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00005a80: 7865 6c5f 7369 7a65 3d73 656c 662e 766f  xel_size=self.vo
+00005a90: 7865 6c5f 7369 7a65 2c0a 2020 2020 2020  xel_size,.      
+00005aa0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+00005ab0: 3d73 656c 662e 6f72 6967 696e 2c0a 2020  =self.origin,.  
+00005ac0: 2020 2020 2020 2020 2020 2020 2020 6474                dt
+00005ad0: 7970 653d 626f 6f6c 0a20 2020 2020 2020  ype=bool.       
+00005ae0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00005af0: 656c 6966 206d 6173 6b20 6973 206e 6f74  elif mask is not
+00005b00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00005b10: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00005b20: 6f72 2822 6d61 736b 2073 686f 756c 6420  or("mask should 
+00005b30: 6265 2061 6e20 496d 6167 6520 6f72 2061  be an Image or a
+00005b40: 206e 756d 7079 2061 7272 6179 2229 0a0a   numpy array")..
+00005b50: 2020 2020 2020 2020 7365 6c66 2e6d 6173          self.mas
+00005b60: 6b2e 6765 745f 7374 616e 6461 7264 6973  k.get_standardis
+00005b70: 6564 5f64 6174 6128 666f 7263 653d 5472  ed_data(force=Tr
+00005b80: 7565 290a 2020 2020 2020 2020 7365 6c66  ue).        self
+00005b90: 2e6c 6f61 6465 645f 6d61 736b 203d 2054  .loaded_mask = T
+00005ba0: 7275 650a 2020 2020 2020 2020 7365 6c66  rue.        self
+00005bb0: 2e63 6f6e 746f 7572 7320 3d20 7b7d 0a20  .contours = {}. 
+00005bc0: 2020 2020 2020 2073 656c 662e 656d 7074         self.empt
+00005bd0: 7920 3d20 6e6f 7420 6e70 2e61 6e79 2873  y = not np.any(s
+00005be0: 656c 662e 6d61 736b 2e67 6574 5f64 6174  elf.mask.get_dat
+00005bf0: 6128 2929 0a20 2020 2020 2020 2073 656c  a()).        sel
+00005c00: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
+00005c10: 203d 204e 6f6e 650a 0a20 2020 2064 6566   = None..    def
+00005c20: 2067 6574 5f63 6f6e 746f 7572 7328 7365   get_contours(se
+00005c30: 6c66 2c20 7669 6577 3d22 782d 7922 2c20  lf, view="x-y", 
+00005c40: 6964 785f 6173 5f6b 6579 3d46 616c 7365  idx_as_key=False
+00005c50: 2c20 6d6f 7374 5f70 6f69 6e74 733d 4661  , most_points=Fa
+00005c60: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+00005c70: 220a 2020 2020 2020 2020 4765 7420 6469  ".        Get di
+00005c80: 6374 206f 6620 636f 6e74 6f75 7273 2069  ct of contours i
+00005c90: 6e20 6120 6769 7665 6e20 6f72 6965 6e74  n a given orient
+00005ca0: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
+00005cb0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+00005cc0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+00005cd0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+00005ce0: 7922 0a20 2020 2020 2020 2020 2020 2056  y".            V
+00005cf0: 6965 7720 696e 2077 6869 6368 2074 6f20  iew in which to 
+00005d00: 6f62 7461 696e 2063 6f6e 746f 7572 732e  obtain contours.
+00005d10: 0a0a 2020 2020 2020 2020 6964 785f 6173  ..        idx_as
+00005d20: 5f6b 6579 203a 2062 6f6f 6c2c 2064 6566  _key : bool, def
+00005d30: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
+00005d40: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00005d50: 7573 6520 736c 6963 6520 696e 6469 6365  use slice indice
+00005d60: 7320 6173 2064 6963 7469 6f6e 6172 7920  s as dictionary 
+00005d70: 6b65 7973 3b20 6966 2046 616c 7365 2c0a  keys; if False,.
+00005d80: 2020 2020 2020 2020 2020 2020 7573 6520              use 
+00005d90: 736c 6963 6520 7a2d 636f 6f72 6469 6e61  slice z-coordina
+00005da0: 7465 7320 6173 2064 6963 7469 6f6e 6172  tes as dictionar
+00005db0: 7920 6b65 7973 2e0a 0a20 2020 2020 2020  y keys...       
+00005dc0: 206d 6f73 745f 706f 696e 7473 203a 2062   most_points : b
+00005dd0: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
+00005de0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
+00005df0: 6620 5472 7565 2c20 7265 7475 726e 206f  f True, return o
+00005e00: 6e6c 7920 7468 6520 636f 6e74 6f75 7220  nly the contour 
+00005e10: 7769 7468 206d 6f73 7420 706f 696e 7473  with most points
+00005e20: 2066 6f72 2065 6163 6820 736c 6963 653b   for each slice;
+00005e30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005e40: 4661 6c73 652c 2072 6574 7572 6e20 616c  False, return al
+00005e50: 6c20 636f 6e74 6f75 7273 2066 6f72 2065  l contours for e
+00005e60: 6163 6820 736c 6963 652e 0a20 2020 2020  ach slice..     
+00005e70: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00005e80: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00005e90: 2020 2020 6966 2076 6965 7720 6e6f 7420      if view not 
+00005ea0: 696e 2073 656c 662e 636f 6e74 6f75 7273  in self.contours
+00005eb0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00005ec0: 6c66 2e63 7265 6174 655f 636f 6e74 6f75  lf.create_contou
+00005ed0: 7273 2876 6965 7729 0a20 2020 2020 2020  rs(view).       
+00005ee0: 2063 6f6e 746f 7572 7320 3d20 7365 6c66   contours = self
+00005ef0: 2e63 6f6e 746f 7572 735b 7669 6577 5d0a  .contours[view].
+00005f00: 0a20 2020 2020 2020 2023 2043 6f6e 7665  .        # Conve
+00005f10: 7274 206b 6579 7320 746f 2069 6e64 6963  rt keys to indic
+00005f20: 6573 2072 6174 6865 7220 7468 616e 2070  es rather than p
+00005f30: 6f73 6974 696f 6e73 0a20 2020 2020 2020  ositions.       
+00005f40: 2069 6620 6964 785f 6173 5f6b 6579 3a0a   if idx_as_key:.
+00005f50: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00005f60: 6f75 7273 203d 207b 7365 6c66 2e70 6f73  ours = {self.pos
+00005f70: 5f74 6f5f 6964 7828 6b65 792c 2073 6b72  _to_idx(key, skr
+00005f80: 742e 696d 6167 652e 5f73 6c69 6365 5f61  t.image._slice_a
+00005f90: 7865 735b 7669 6577 5d29 3a20 0a20 2020  xes[view]): .   
+00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fb0: 2020 2020 2076 616c 7565 2066 6f72 206b       value for k
+00005fc0: 6579 2c20 7661 6c75 6520 696e 2063 6f6e  ey, value in con
+00005fd0: 746f 7572 732e 6974 656d 7328 297d 0a0a  tours.items()}..
+00005fe0: 2020 2020 2020 2020 2320 466f 7220 6561          # For ea
+00005ff0: 6368 2073 6c69 6365 2c20 6b65 6570 206f  ch slice, keep o
+00006000: 6e6c 7920 636f 6e74 6f75 7220 7769 7468  nly contour with
+00006010: 206d 6f73 7420 706f 696e 7473 2e0a 2020   most points..  
+00006020: 2020 2020 2020 6966 206d 6f73 745f 706f        if most_po
+00006030: 696e 7473 3a0a 2020 2020 2020 2020 2020  ints:.          
+00006040: 2020 636f 6e74 6f75 7273 203d 207b 6b65    contours = {ke
+00006050: 793a 205b 6d61 7828 7661 6c75 652c 206b  y: [max(value, k
+00006060: 6579 3d6c 656e 295d 0a20 2020 2020 2020  ey=len)].       
+00006070: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00006080: 206b 6579 2c20 7661 6c75 6520 696e 2063   key, value in c
+00006090: 6f6e 746f 7572 732e 6974 656d 7328 297d  ontours.items()}
+000060a0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000060b0: 2063 6f6e 746f 7572 730a 0a20 2020 2064   contours..    d
+000060c0: 6566 2067 6574 5f63 6f6e 746f 7572 735f  ef get_contours_
+000060d0: 6f6e 5f73 6c69 6365 2873 656c 662c 2076  on_slice(self, v
+000060e0: 6965 773d 2278 2d79 222c 2073 6c3d 4e6f  iew="x-y", sl=No
+000060f0: 6e65 2c20 6964 783d 4e6f 6e65 2c20 706f  ne, idx=None, po
+00006100: 733d 4e6f 6e65 293a 0a0a 2020 2020 2020  s=None):..      
+00006110: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
+00006120: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
+00006130: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
+00006140: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+00006150: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00006160: 2069 6478 203d 2073 656c 662e 6765 745f   idx = self.get_
+00006170: 6d69 645f 6964 7828 7669 6577 290a 2020  mid_idx(view).  
+00006180: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00006190: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
+000061a0: 6c66 2e67 6574 5f69 6478 2876 6965 772c  lf.get_idx(view,
+000061b0: 2073 6c2c 2069 6478 2c20 706f 7329 0a20   sl, idx, pos). 
+000061c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000061d0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000061e0: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
+000061f0: 2876 6965 772c 2069 6478 5f61 735f 6b65  (view, idx_as_ke
+00006200: 793d 5472 7565 295b 6964 785d 0a20 2020  y=True)[idx].   
+00006210: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00006220: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00006230: 2020 7265 7475 726e 205b 5d0a 0a20 2020    return []..   
+00006240: 2064 6566 2067 6574 5f73 6c69 6365 5f70   def get_slice_p
+00006250: 6f73 6974 696f 6e73 2873 656c 662c 206f  ositions(self, o
+00006260: 7468 6572 3d4e 6f6e 652c 2076 6965 773d  ther=None, view=
+00006270: 2278 2d79 222c 2070 6f73 6974 696f 6e5f  "x-y", position_
+00006280: 6173 5f69 6478 3d46 616c 7365 2c0a 2020  as_idx=False,.  
+00006290: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+000062a0: 3d22 756e 696f 6e22 293a 0a20 2020 2020  ="union"):.     
+000062b0: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+000062c0: 6574 206f 7264 6572 6564 206c 6973 7420  et ordered list 
+000062d0: 6f66 2073 6c69 6365 2070 6f73 6974 696f  of slice positio
+000062e0: 6e73 2066 6f72 2073 656c 6620 616e 6420  ns for self and 
+000062f0: 6f74 6865 722e 0a0a 2020 2020 2020 2020  other...        
+00006300: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+00006310: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
+00006320: 2073 6b72 742e 7374 7275 6374 7572 6573   skrt.structures
+00006330: 2e52 4f49 2c20 6465 6661 756c 743d 4e6f  .ROI, default=No
+00006340: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
+00006350: 6563 6f6e 6420 524f 4920 6f66 2061 2070  econd ROI of a p
+00006360: 6169 7220 666f 7220 7768 6963 6820 736c  air for which sl
+00006370: 6963 6520 706f 7369 7469 6f6e 7320 6172  ice positions ar
+00006380: 6520 6265 206f 6274 6169 6e65 642e 0a20  e be obtained.. 
+00006390: 2020 2020 2020 2020 2020 2044 6973 7265             Disre
+000063a0: 6761 7264 6564 2069 6620 4e6f 6e65 2e0a  garded if None..
+000063b0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+000063c0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+000063d0: 7922 0a20 2020 2020 2020 2020 2020 2056  y".            V
+000063e0: 6965 7720 696e 2077 6869 6368 2074 6f20  iew in which to 
+000063f0: 6f62 7461 696e 2073 6c69 6365 732e 0a0a  obtain slices...
+00006400: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+00006410: 5f61 735f 6964 7820 3a20 626f 6f6c 2c20  _as_idx : bool, 
+00006420: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+00006430: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00006440: 652c 2072 6574 7572 6e20 706f 7369 7469  e, return positi
+00006450: 6f6e 7320 6173 2073 6c69 6365 2069 6e64  ons as slice ind
+00006460: 6963 6573 3b20 6966 2046 616c 7365 2c0a  ices; if False,.
+00006470: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006480: 726e 2070 6f73 6974 696f 6e73 2061 7320  rn positions as 
+00006490: 736c 6963 6520 7a2d 636f 6f72 6469 6e61  slice z-coordina
+000064a0: 7465 7320 286d 6d29 2e0a 0a20 2020 2020  tes (mm)...     
+000064b0: 2020 206d 6574 686f 643a 2073 7472 2c20     method: str, 
+000064c0: 6465 6661 756c 743d 2275 6e69 6f6e 220a  default="union".
+000064d0: 2020 2020 2020 2020 2020 2020 5374 7269              Stri
+000064e0: 6e67 2073 7065 6369 6679 696e 6720 736c  ng specifying sl
+000064f0: 6963 6573 2066 6f72 2077 6869 6368 2070  ices for which p
+00006500: 6f73 6974 696f 6e73 2061 7265 2074 6f20  ositions are to 
+00006510: 6265 206f 6274 6169 6e65 642c 0a20 2020  be obtained,.   
+00006520: 2020 2020 2020 2020 2066 6f72 2052 4f49           for ROI
+00006530: 7320 7365 6c66 2061 6e64 206f 7468 6572  s self and other
+00006540: 2e0a 0a20 2020 2020 2020 2020 2020 202d  ...            -
+00006550: 2022 6c65 6674 2220 286f 7220 6f74 6865   "left" (or othe
+00006560: 7220 6973 204e 6f6e 6529 3a20 7265 7475  r is None): retu
+00006570: 726e 2070 6f73 6974 696f 6e73 206f 660a  rn positions of.
+00006580: 2020 2020 2020 2020 2020 2020 2020 736c                sl
+00006590: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+000065a0: 7365 6c66 3b0a 2020 2020 2020 2020 2020  self;.          
+000065b0: 2020 2d20 2272 6967 6874 223a 2072 6574    - "right": ret
+000065c0: 7572 6e20 706f 7369 7469 6f6e 7320 6f66  urn positions of
+000065d0: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+000065e0: 6e67 206f 7468 6572 3b0a 2020 2020 2020  ng other;.      
+000065f0: 2020 2020 2020 2d20 2275 6e69 6f6e 223a        - "union":
+00006600: 2072 6574 7572 6e20 706f 7369 7469 6f6e   return position
+00006610: 7320 6f66 2073 6c69 6365 7320 636f 6e74  s of slices cont
+00006620: 6169 6e69 6e67 2065 6974 6865 7220 7365  aining either se
+00006630: 6c66 0a20 2020 2020 2020 2020 2020 2020  lf.             
+00006640: 206f 7220 6f74 6865 723b 0a20 2020 2020   or other;.     
+00006650: 2020 2020 2020 202d 2022 696e 7465 7273         - "inters
+00006660: 6563 7469 6f6e 223a 2072 6574 7572 6e20  ection": return 
+00006670: 706f 7369 7469 6f6e 7320 6f66 2073 6c69  positions of sli
+00006680: 6365 7320 636f 6e74 6169 6e69 6e67 2062  ces containing b
+00006690: 6f74 680a 2020 2020 2020 2020 2020 2020  oth.            
+000066a0: 2020 7365 6c66 2061 6e64 206f 7468 6572    self and other
+000066b0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000066c0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
+000066d0: 5f73 6c69 6365 5f70 6f73 6974 696f 6e73  _slice_positions
+000066e0: 2873 656c 662c 206f 7468 6572 2c20 7669  (self, other, vi
+000066f0: 6577 2c20 706f 7369 7469 6f6e 5f61 735f  ew, position_as_
+00006700: 6964 782c 0a20 2020 2020 2020 2020 2020  idx,.           
+00006710: 2020 2020 206d 6574 686f 6429 0a0a 2020       method)..  
+00006720: 2020 6465 6620 6765 745f 6166 6669 6e65    def get_affine
+00006730: 2873 656c 662c 2066 6f72 6365 5f73 7461  (self, force_sta
+00006740: 6e64 6172 6469 7365 3d46 616c 7365 2c20  ndardise=False, 
+00006750: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+00006760: 2020 2022 2222 4c6f 6164 2073 656c 6620     """Load self 
+00006770: 616e 6420 6765 7420 6166 6669 6e65 206d  and get affine m
+00006780: 6174 7269 782e 2222 220a 0a20 2020 2020  atrix."""..     
+00006790: 2020 2073 656c 662e 6c6f 6164 2829 0a20     self.load(). 
+000067a0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+000067b0: 6f61 6465 645f 6d61 736b 3a0a 2020 2020  oaded_mask:.    
+000067c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000067d0: 656c 662e 6d61 736b 2e67 6574 5f61 6666  elf.mask.get_aff
+000067e0: 696e 6528 666f 7263 655f 7374 616e 6461  ine(force_standa
+000067f0: 7264 6973 653d 666f 7263 655f 7374 616e  rdise=force_stan
+00006800: 6461 7264 6973 652c 200a 2020 2020 2020  dardise, .      
 00006810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006820: 2020 2020 2020 202a 2a6b 7761 7267 7329         **kwargs)
-00006830: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-00006840: 6c66 2e69 6d61 6765 2069 7320 6e6f 7420  lf.image is not 
-00006850: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00006860: 2020 7265 7475 726e 2073 656c 662e 696d    return self.im
-00006870: 6167 652e 6765 745f 6166 6669 6e65 2866  age.get_affine(f
-00006880: 6f72 6365 5f73 7461 6e64 6172 6469 7365  orce_standardise
-00006890: 3d66 6f72 6365 5f73 7461 6e64 6172 6469  =force_standardi
-000068a0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00006820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006830: 2020 2a2a 6b77 6172 6773 290a 2020 2020    **kwargs).    
+00006840: 2020 2020 656c 6966 2073 656c 662e 696d      elif self.im
+00006850: 6167 6520 6973 206e 6f74 204e 6f6e 653a  age is not None:
+00006860: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00006870: 7572 6e20 7365 6c66 2e69 6d61 6765 2e67  urn self.image.g
+00006880: 6574 5f61 6666 696e 6528 666f 7263 655f  et_affine(force_
+00006890: 7374 616e 6461 7264 6973 653d 666f 7263  standardise=forc
+000068a0: 655f 7374 616e 6461 7264 6973 652c 0a20  e_standardise,. 
 000068b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000068c0: 2020 2020 2020 2020 2020 2020 202a 2a6b               **k
-000068d0: 7761 7267 7329 0a20 2020 2020 2020 2072  wargs).        r
-000068e0: 6574 7572 6e20 7365 6c66 2e61 6666 696e  eturn self.affin
-000068f0: 650a 0a20 2020 2064 6566 2067 6574 5f74  e..    def get_t
-00006900: 7261 6e73 6c61 7469 6f6e 5f74 6f5f 616c  ranslation_to_al
-00006910: 6967 6e28 0a20 2020 2020 2020 2020 2020  ign(.           
-00006920: 2073 656c 662c 206f 7468 6572 2c20 7a5f   self, other, z_
-00006930: 6672 6163 7469 6f6e 313d 4e6f 6e65 2c20  fraction1=None, 
-00006940: 7a5f 6672 6163 7469 6f6e 323d 4e6f 6e65  z_fraction2=None
-00006950: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00006960: 2020 2020 2020 2044 6574 6572 6d69 6e65         Determine
-00006970: 2074 7261 6e73 6c61 7469 6f6e 2066 6f72   translation for
-00006980: 2061 6c69 676e 696e 6720 3c73 656c 663e   aligning <self>
-00006990: 2074 6f20 3c6f 7468 6572 3e2e 0a0a 2020   to <other>...  
-000069a0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-000069b0: 7273 3a2a 2a0a 0a20 2020 2020 2020 206f  rs:**..        o
-000069c0: 7468 6572 203a 2052 4f49 2f53 7472 7563  ther : ROI/Struc
-000069d0: 7475 7265 5365 742f 6c69 7374 0a20 2020  tureSet/list.   
-000069e0: 2020 2020 2020 2020 2052 4f49 2077 6974           ROI wit
-000069f0: 6820 7768 6963 6820 616c 6967 6e6d 656e  h which alignmen
-00006a00: 7420 6973 2074 6f20 6265 2070 6572 666f  t is to be perfo
-00006a10: 726d 6564 2e20 2054 6869 7320 6361 6e20  rmed.  This can 
-00006a20: 6265 0a20 2020 2020 2020 2020 2020 2073  be.            s
-00006a30: 7065 6369 6669 6564 2064 6972 6563 746c  pecified directl
-00006a40: 7920 6173 2061 2073 696e 676c 6520 524f  y as a single RO
-00006a50: 492e 2020 416c 7465 726e 6174 6976 656c  I.  Alternativel
-00006a60: 792c 2069 7420 6361 6e0a 2020 2020 2020  y, it can.      
-00006a70: 2020 2020 2020 6265 2061 2053 7472 7563        be a Struc
-00006a80: 7475 7265 5365 742c 206f 7220 6120 6c69  tureSet, or a li
-00006a90: 7374 206f 7220 524f 492f 5374 7275 6374  st or ROI/Struct
-00006aa0: 7572 6553 6574 206f 626a 6563 7473 2c0a  ureSet objects,.
-00006ab0: 2020 2020 2020 2020 2020 2020 696e 2077              in w
-00006ac0: 6869 6368 2063 6173 6520 7468 6520 696e  hich case the in
-00006ad0: 6469 7669 6475 616c 2052 4f49 7320 7769  dividual ROIs wi
-00006ae0: 6c6c 2062 6520 636f 6d62 696e 6564 2e0a  ll be combined..
-00006af0: 0a20 2020 2020 2020 207a 5f66 7261 6374  .        z_fract
-00006b00: 696f 6e31 203a 2066 6c6f 6174 2c20 6465  ion1 : float, de
-00006b10: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00006b20: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
-00006b30: 616c 6f6e 6720 7a20 6178 6973 206f 6620  along z axis of 
-00006b40: 736c 6963 6520 7468 726f 7567 6820 3c73  slice through <s
-00006b50: 656c 663e 206f 6e20 7768 6963 680a 2020  elf> on which.  
-00006b60: 2020 2020 2020 2020 2020 746f 2061 6c69            to ali
-00006b70: 676e 2e20 2049 6620 4e6f 6e65 2c20 616c  gn.  If None, al
-00006b80: 6967 6e6d 656e 7420 6973 2074 6f20 7468  ignment is to th
-00006b90: 6520 6365 6e74 726f 6964 206f 6620 7468  e centroid of th
-00006ba0: 650a 2020 2020 2020 2020 2020 2020 7768  e.            wh
-00006bb0: 6f6c 6520 524f 4920 766f 6c75 6d65 2e20  ole ROI volume. 
-00006bc0: 204f 7468 6572 7769 7365 2c20 616c 6967   Otherwise, alig
-00006bd0: 6e6d 656e 7420 6973 2074 6f20 7468 650a  nment is to the.
-00006be0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-00006bf0: 726f 6964 206f 6620 7468 6520 736c 6963  roid of the slic
-00006c00: 6520 6174 2074 6865 2073 7065 6369 6669  e at the specifi
-00006c10: 6564 2064 6973 7461 6e63 650a 2020 2020  ed distance.    
-00006c20: 2020 2020 2020 2020 6672 6f6d 2074 6865          from the
-00006c30: 2052 4f49 2773 206d 6f73 742d 696e 6665   ROI's most-infe
-00006c40: 7269 6f72 2070 6f69 6e74 3a20 3020 636f  rior point: 0 co
-00006c50: 7272 6573 706f 6e64 7320 746f 0a20 2020  rresponds to.   
-00006c60: 2020 2020 2020 2020 2074 6865 206d 6f73           the mos
-00006c70: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
-00006c80: 2028 6c6f 7765 7374 207a 293b 2031 2063   (lowest z); 1 c
-00006c90: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
-00006ca0: 650a 2020 2020 2020 2020 2020 2020 6d6f  e.            mo
-00006cb0: 7374 2d73 7570 6572 696f 7220 706f 696e  st-superior poin
-00006cc0: 7420 2868 6967 6865 7374 207a 292e 2020  t (highest z).  
-00006cd0: 5661 6c75 6573 2066 6f72 207a 5f66 7261  Values for z_fra
-00006ce0: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
-00006cf0: 2020 6f75 7473 6964 6520 7468 6520 696e    outside the in
-00006d00: 7465 7276 616c 205b 302c 2031 5d20 7265  terval [0, 1] re
-00006d10: 7375 6c74 2069 6e20 6120 5275 6e74 696d  sult in a Runtim
-00006d20: 6545 7272 6f72 2e0a 0a20 2020 2020 2020  eError...       
-00006d30: 207a 5f66 7261 6374 696f 6e32 203a 2066   z_fraction2 : f
-00006d40: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
-00006d50: 6e65 0a20 2020 2020 2020 2020 2020 2050  ne.            P
-00006d60: 6f73 6974 696f 6e20 616c 6f6e 6720 7a20  osition along z 
-00006d70: 6178 6973 206f 6620 736c 6963 6520 7468  axis of slice th
-00006d80: 726f 7567 6820 3c6f 7468 6572 3e20 6f6e  rough <other> on
-00006d90: 2077 6869 6368 0a20 2020 2020 2020 2020   which.         
-00006da0: 2020 2074 6f20 616c 6967 6e2e 2020 4966     to align.  If
-00006db0: 204e 6f6e 652c 2061 6c69 676e 6d65 6e74   None, alignment
-00006dc0: 2069 7320 746f 2074 6865 2063 656e 7472   is to the centr
-00006dd0: 6f69 6420 6f66 2074 6865 0a20 2020 2020  oid of the.     
-00006de0: 2020 2020 2020 2077 686f 6c65 2052 4f49         whole ROI
-00006df0: 2076 6f6c 756d 652e 2020 4f74 6865 7277   volume.  Otherw
-00006e00: 6973 652c 2061 6c69 676e 6d65 6e74 2069  ise, alignment i
-00006e10: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
-00006e20: 2020 2020 2063 656e 7472 6f69 6420 6f66       centroid of
-00006e30: 2074 6865 2073 6c69 6365 2061 7420 7468   the slice at th
-00006e40: 6520 7370 6563 6966 6965 6420 6469 7374  e specified dist
-00006e50: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
-00006e60: 2066 726f 6d20 7468 6520 524f 4927 7320   from the ROI's 
-00006e70: 6d6f 7374 2d69 6e66 6572 696f 7220 706f  most-inferior po
-00006e80: 696e 743a 2030 2063 6f72 7265 7370 6f6e  int: 0 correspon
-00006e90: 6473 2074 6f0a 2020 2020 2020 2020 2020  ds to.          
-00006ea0: 2020 7468 6520 6d6f 7374 2d69 6e66 6572    the most-infer
-00006eb0: 696f 7220 706f 696e 7420 286c 6f77 6573  ior point (lowes
-00006ec0: 7420 7a29 3b20 3120 636f 7272 6573 706f  t z); 1 correspo
-00006ed0: 6e64 7320 746f 2074 6865 0a20 2020 2020  nds to the.     
-00006ee0: 2020 2020 2020 206d 6f73 742d 7375 7065         most-supe
-00006ef0: 7269 6f72 2070 6f69 6e74 2028 6869 6768  rior point (high
-00006f00: 6573 7420 7a29 2e20 2056 616c 7565 7320  est z).  Values 
-00006f10: 666f 7220 7a5f 6672 6163 7469 6f6e 0a20  for z_fraction. 
-00006f20: 2020 2020 2020 2020 2020 206f 7574 7369             outsi
-00006f30: 6465 2074 6865 2069 6e74 6572 7661 6c20  de the interval 
-00006f40: 5b30 2c20 315d 2072 6573 756c 7420 696e  [0, 1] result in
-00006f50: 2061 2052 756e 7469 6d65 4572 726f 722e   a RuntimeError.
-00006f60: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-00006f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006f80: 6765 745f 7472 616e 736c 6174 696f 6e5f  get_translation_
-00006f90: 746f 5f61 6c69 676e 280a 2020 2020 2020  to_align(.      
-00006fa0: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
-00006fb0: 6f74 6865 722c 207a 5f66 7261 6374 696f  other, z_fractio
-00006fc0: 6e31 2c20 7a5f 6672 6163 7469 6f6e 3229  n1, z_fraction2)
-00006fd0: 0a0a 2020 2020 6465 6620 6765 745f 766f  ..    def get_vo
-00006fe0: 7865 6c5f 7369 7a65 2873 656c 6629 3a0a  xel_size(self):.
-00006ff0: 2020 2020 2020 2020 2222 224c 6f61 6420          """Load 
-00007000: 7365 6c66 2061 6e64 2067 6574 2076 6f78  self and get vox
-00007010: 656c 5f73 697a 652e 2222 220a 0a20 2020  el_size."""..   
-00007020: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-00007030: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007040: 7365 6c66 2e76 6f78 656c 5f73 697a 650a  self.voxel_size.
-00007050: 0a20 2020 2064 6566 2067 6574 5f6e 705f  .    def get_np_
-00007060: 766f 7865 6c5f 7369 7a65 2873 656c 662c  voxel_size(self,
-00007070: 2076 6965 773d 4e6f 6e65 293a 0a20 2020   view=None):.   
-00007080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00007090: 2047 6574 2076 6f78 656c 5f73 697a 6520   Get voxel_size 
-000070a0: 666f 7220 6e75 6d70 7920 6178 6973 206f  for numpy axis o
-000070b0: 7264 6572 696e 6720 616e 6420 7370 6563  rdering and spec
-000070c0: 6966 6965 6420 7669 6577 2e0a 0a20 2020  ified view...   
-000070d0: 2020 2020 2076 6965 7720 3a20 7374 720a       view : str.
-000070e0: 2020 2020 2020 2020 2020 2020 4f72 6965              Orie
-000070f0: 6e74 6174 696f 6e20 636f 6e73 6964 6572  ntation consider
-00007100: 6564 2066 6f72 2032 4420 696d 6167 6520  ed for 2D image 
-00007110: 6f72 2070 726f 6a65 6374 696f 6e2e 0a20  or projection.. 
-00007120: 2020 2020 2020 2020 2020 2043 616e 2062             Can b
-00007130: 6520 2278 2d79 222c 2022 792d 7a22 2c20  e "x-y", "y-z", 
-00007140: 6f72 2022 782d 7a22 2e0a 2020 2020 2020  or "x-z"..      
-00007150: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
-00007160: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
-00007170: 2020 2069 6620 7669 6577 2069 7320 4e6f     if view is No
-00007180: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007190: 7678 2c20 7679 2c20 767a 203d 2073 656c  vx, vy, vz = sel
-000071a0: 662e 766f 7865 6c5f 7369 7a65 0a20 2020  f.voxel_size.   
-000071b0: 2020 2020 2020 2020 2076 6f78 656c 5f73           voxel_s
-000071c0: 697a 6520 3d20 5b76 792c 2076 782c 2076  ize = [vy, vx, v
-000071d0: 7a5d 0a20 2020 2020 2020 2065 6c73 653a  z].        else:
-000071e0: 0a20 2020 2020 2020 2020 2020 2076 6f78  .            vox
-000071f0: 656c 5f73 697a 6520 3d20 5b73 656c 662e  el_size = [self.
-00007200: 766f 7865 6c5f 7369 7a65 5b69 5d0a 2020  voxel_size[i].  
-00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007220: 2020 666f 7220 6920 696e 2073 6b72 742e    for i in skrt.
-00007230: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
-00007240: 5b76 6965 775d 5d0a 0a20 2020 2020 2020  [view]]..       
-00007250: 2072 6574 7572 6e20 766f 7865 6c5f 7369   return voxel_si
-00007260: 7a65 0a0a 2020 2020 6465 6620 6765 745f  ze..    def get_
-00007270: 6f72 6967 696e 2873 656c 6629 3a0a 2020  origin(self):.  
-00007280: 2020 2020 2020 2222 224c 6f61 6420 7365        """Load se
-00007290: 6c66 2061 6e64 2067 6574 206f 7269 6769  lf and get origi
-000072a0: 6e2e 2222 220a 0a20 2020 2020 2020 2073  n."""..        s
-000072b0: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
-000072c0: 2020 2072 6574 7572 6e20 7365 6c66 2e6f     return self.o
-000072d0: 7269 6769 6e0a 0a20 2020 2064 6566 2067  rigin..    def g
-000072e0: 6574 5f6e 616d 6528 7365 6c66 2c20 6f72  et_name(self, or
-000072f0: 6967 696e 616c 3d46 616c 7365 293a 0a20  iginal=False):. 
-00007300: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00007310: 2020 204c 6f61 6420 7365 6c66 2061 6e64     Load self and
-00007320: 2067 6574 206e 616d 652e 2049 6620 3c6f   get name. If <o
-00007330: 7269 6769 6e61 6c3e 2069 7320 5472 7565  riginal> is True
-00007340: 2c20 6765 7420 7468 6520 6f72 6967 696e  , get the origin
-00007350: 616c 206e 616d 652e 0a20 2020 2020 2020  al name..       
-00007360: 2022 2222 0a0a 2020 2020 2020 2020 7365   """..        se
-00007370: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
-00007380: 2020 7265 7475 726e 2028 7365 6c66 2e6f    return (self.o
-00007390: 7269 6769 6e61 6c5f 6e61 6d65 2069 6620  riginal_name if 
-000073a0: 6f72 6967 696e 616c 2065 6c73 6520 7365  original else se
-000073b0: 6c66 2e6e 616d 6529 0a0a 2020 2020 6465  lf.name)..    de
-000073c0: 6620 6765 745f 6d61 736b 2873 656c 662c  f get_mask(self,
-000073d0: 2076 6965 773d 2278 2d79 222c 2066 6c61   view="x-y", fla
-000073e0: 7474 656e 3d46 616c 7365 2c20 7374 616e  tten=False, stan
-000073f0: 6461 7264 6973 653d 4661 6c73 652c 200a  dardise=False, .
-00007400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007410: 2066 6f72 6365 5f73 7461 6e64 6172 6469   force_standardi
-00007420: 7365 3d46 616c 7365 293a 0a20 2020 2020  se=False):.     
-00007430: 2020 2022 2222 4765 7420 6269 6e61 7279     """Get binary
-00007440: 206d 6173 6b2c 206f 7074 696f 6e61 6c6c   mask, optionall
-00007450: 7920 666c 6174 7465 6e65 6420 696e 2061  y flattened in a
-00007460: 2067 6976 656e 206f 7269 656e 7461 7469   given orientati
-00007470: 6f6e 2e22 2222 0a0a 2020 2020 2020 2020  on."""..        
-00007480: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-00007490: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-000074a0: 6d61 736b 2829 0a20 2020 2020 2020 2069  mask().        i
-000074b0: 6620 6e6f 7420 666c 6174 7465 6e3a 0a20  f not flatten:. 
-000074c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000074d0: 6e20 7365 6c66 2e6d 6173 6b2e 6765 745f  n self.mask.get_
-000074e0: 6461 7461 2873 7461 6e64 6172 6469 7365  data(standardise
-000074f0: 3d73 7461 6e64 6172 6469 7365 2c20 0a20  =standardise, . 
-00007500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007520: 2020 2020 2066 6f72 6365 5f73 7461 6e64       force_stand
-00007530: 6172 6469 7365 3d66 6f72 6365 5f73 7461  ardise=force_sta
-00007540: 6e64 6172 6469 7365 290a 2020 2020 2020  ndardise).      
-00007550: 2020 7265 7475 726e 206e 702e 7375 6d28    return np.sum(
-00007560: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007570: 662e 6d61 736b 2e67 6574 5f64 6174 6128  f.mask.get_data(
-00007580: 7374 616e 6461 7264 6973 653d 7374 616e  standardise=stan
-00007590: 6461 7264 6973 652c 200a 2020 2020 2020  dardise, .      
-000075a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075b0: 2020 2020 2020 2020 2066 6f72 6365 5f73           force_s
-000075c0: 7461 6e64 6172 6469 7365 3d66 6f72 6365  tandardise=force
-000075d0: 5f73 7461 6e64 6172 6469 7365 292c 0a20  _standardise),. 
-000075e0: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
-000075f0: 736b 7274 2e69 6d61 6765 2e5f 736c 6963  skrt.image._slic
-00007600: 655f 6178 6573 5b76 6965 775d 0a20 2020  e_axes[view].   
-00007610: 2020 2020 2029 2e61 7374 7970 6528 626f       ).astype(bo
-00007620: 6f6c 290a 0a20 2020 2064 6566 2067 6574  ol)..    def get
-00007630: 5f6d 6173 6b5f 696d 6167 6528 7365 6c66  _mask_image(self
-00007640: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00007650: 7420 696d 6167 6520 6f62 6a65 6374 2072  t image object r
-00007660: 6570 7265 7365 6e74 696e 6720 524f 4920  epresenting ROI 
-00007670: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
-00007680: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
-00007690: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-000076a0: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
-000076b0: 2072 6574 7572 6e20 7365 6c66 2e6d 6173   return self.mas
-000076c0: 6b0a 0a20 2020 2064 6566 2067 6574 5f70  k..    def get_p
-000076d0: 6f6c 7967 6f6e 7328 7365 6c66 2c20 7669  olygons(self, vi
-000076e0: 6577 3d22 782d 7922 2c20 6964 785f 6173  ew="x-y", idx_as
-000076f0: 5f6b 6579 3d46 616c 7365 293a 0a20 2020  _key=False):.   
-00007700: 2020 2020 2022 2222 4765 7420 6469 6374       """Get dict
-00007710: 206f 6620 706f 6c79 676f 6e73 2066 6f72   of polygons for
-00007720: 2065 6163 6820 736c 6963 652e 2222 220a   each slice.""".
-00007730: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
-00007740: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-00007750: 6f72 2069 2c20 636f 6e74 6f75 7273 2069  or i, contours i
-00007760: 6e20 7365 6c66 2e67 6574 5f63 6f6e 746f  n self.get_conto
-00007770: 7572 7328 7669 6577 2c20 6964 785f 6173  urs(view, idx_as
-00007780: 5f6b 6579 292e 6974 656d 7328 293a 0a20  _key).items():. 
-00007790: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-000077a0: 6f6e 735b 695d 203d 205b 636f 6e74 6f75  ons[i] = [contou
-000077b0: 725f 746f 5f70 6f6c 7967 6f6e 2863 2920  r_to_polygon(c) 
-000077c0: 666f 7220 6320 696e 2063 6f6e 746f 7572  for c in contour
-000077d0: 735d 0a20 2020 2020 2020 2072 6574 7572  s].        retur
-000077e0: 6e20 706f 6c79 676f 6e73 0a0a 2020 2020  n polygons..    
-000077f0: 6465 6620 6765 745f 706f 6c79 676f 6e73  def get_polygons
-00007800: 5f6f 6e5f 736c 6963 6528 7365 6c66 2c20  _on_slice(self, 
-00007810: 7669 6577 3d22 782d 7922 2c20 736c 3d4e  view="x-y", sl=N
-00007820: 6f6e 652c 2069 6478 3d4e 6f6e 652c 2070  one, idx=None, p
-00007830: 6f73 3d4e 6f6e 6529 3a0a 2020 2020 2020  os=None):.      
-00007840: 2020 2222 2247 6574 2073 6861 7065 6c79    """Get shapely
-00007850: 2070 6f6c 7967 6f6e 206f 626a 6563 7473   polygon objects
-00007860: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-00007870: 6f20 6120 6769 7665 6e20 736c 6963 652e  o a given slice.
-00007880: 2222 220a 0a20 2020 2020 2020 2063 6f6e  """..        con
-00007890: 746f 7572 7320 3d20 7365 6c66 2e67 6574  tours = self.get
-000078a0: 5f63 6f6e 746f 7572 735f 6f6e 5f73 6c69  _contours_on_sli
-000078b0: 6365 2876 6965 772c 2073 6c2c 2069 6478  ce(view, sl, idx
-000078c0: 2c20 706f 7329 0a20 2020 2020 2020 2072  , pos).        r
-000078d0: 6574 7572 6e20 5b63 6f6e 746f 7572 5f74  eturn [contour_t
-000078e0: 6f5f 706f 6c79 676f 6e28 6329 2066 6f72  o_polygon(c) for
-000078f0: 2063 2069 6e20 636f 6e74 6f75 7273 5d0a   c in contours].
-00007900: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-00007910: 636f 6e74 6f75 7273 2873 656c 662c 2076  contours(self, v
-00007920: 6965 773d 2261 6c6c 222c 2066 6f72 6365  iew="all", force
-00007930: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00007940: 2022 2222 4372 6561 7465 2063 6f6e 746f   """Create conto
-00007950: 7572 7320 696e 2061 6c6c 206f 7269 656e  urs in all orien
-00007960: 7461 7469 6f6e 732e 2222 220a 0a20 2020  tations."""..   
-00007970: 2020 2020 2069 6620 6e6f 7420 666f 7263       if not forc
-00007980: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00007990: 6620 7669 6577 203d 3d20 2261 6c6c 2220  f view == "all" 
-000079a0: 616e 6420 616c 6c28 5b76 2069 6e20 7365  and all([v in se
-000079b0: 6c66 2e63 6f6e 746f 7572 7320 666f 7220  lf.contours for 
-000079c0: 7620 696e 200a 2020 2020 2020 2020 2020  v in .          
-000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079e0: 2020 2020 2020 2020 2020 2020 736b 7274              skrt
-000079f0: 2e69 6d61 6765 2e5f 706c 6f74 5f61 7865  .image._plot_axe
-00007a00: 735d 293a 0a20 2020 2020 2020 2020 2020  s]):.           
-00007a10: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00007a20: 2020 2020 2020 2020 6966 2076 6965 7720          if view 
-00007a30: 696e 2073 656c 662e 636f 6e74 6f75 7273  in self.contours
-00007a40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007a50: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-00007a60: 2020 6966 206e 6f74 2073 656c 662e 6c6f    if not self.lo
-00007a70: 6164 6564 3a0a 2020 2020 2020 2020 2020  aded:.          
-00007a80: 2020 7365 6c66 2e6c 6f61 6428 290a 0a20    self.load().. 
-00007a90: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
-00007aa0: 7465 5f6d 6173 6b28 290a 2020 2020 2020  te_mask().      
-00007ab0: 2020 6966 2066 6f72 6365 3a0a 2020 2020    if force:.    
-00007ac0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00007ad0: 746f 7572 7320 3d20 7b7d 0a0a 2020 2020  tours = {}..    
-00007ae0: 2020 2020 2320 4372 6561 7465 2063 6f6e      # Create con
-00007af0: 746f 7572 7320 696e 2065 7665 7279 206f  tours in every o
-00007b00: 7269 656e 7461 7469 6f6e 0a20 2020 2020  rientation.     
-00007b10: 2020 2076 6965 7773 203d 206c 6973 7428     views = list(
-00007b20: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
-00007b30: 5f61 7865 732e 6b65 7973 2829 2920 6966  _axes.keys()) if
-00007b40: 2076 6965 7720 3d3d 2022 616c 6c22 2065   view == "all" e
-00007b50: 6c73 6520 5b76 6965 775d 0a20 2020 2020  lse [view].     
-00007b60: 2020 2066 6f72 2076 2069 6e20 7669 6577     for v in view
-00007b70: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
-00007b80: 6966 2076 2069 6e20 7365 6c66 2e63 6f6e  if v in self.con
-00007b90: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
-00007ba0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00007bb0: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
-00007bc0: 616b 6520 6e65 7720 636f 6e74 6f75 7273  ake new contours
-00007bd0: 2066 726f 6d20 6d61 736b 0a20 2020 2020   from mask.     
-00007be0: 2020 2020 2020 207a 5f61 7820 3d20 736b         z_ax = sk
-00007bf0: 7274 2e69 6d61 6765 2e5f 736c 6963 655f  rt.image._slice_
-00007c00: 6178 6573 5b76 5d0a 2020 2020 2020 2020  axes[v].        
-00007c10: 2020 2020 7365 6c66 2e63 6f6e 746f 7572      self.contour
-00007c20: 735b 765d 203d 207b 7d0a 2020 2020 2020  s[v] = {}.      
-00007c30: 2020 2020 2020 666f 7220 697a 2069 6e20        for iz in 
-00007c40: 7365 6c66 2e67 6574 5f69 6e64 6963 6573  self.get_indices
-00007c50: 2876 2c20 6d65 7468 6f64 3d22 6d61 736b  (v, method="mask
-00007c60: 2229 3a0a 0a20 2020 2020 2020 2020 2020  "):..           
-00007c70: 2020 2020 2023 2047 6574 2073 6c69 6365       # Get slice
-00007c80: 206f 6620 6d61 736b 2061 7272 6179 0a20   of mask array. 
-00007c90: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00007ca0: 6173 6b5f 736c 6963 6520 3d20 7365 6c66  ask_slice = self
-00007cb0: 2e67 6574 5f73 6c69 6365 2876 2c20 6964  .get_slice(v, id
-00007cc0: 783d 697a 292e 540a 2020 2020 2020 2020  x=iz).T.        
-00007cd0: 2020 2020 2020 2020 6966 206d 6173 6b5f          if mask_
-00007ce0: 736c 6963 652e 6d61 7828 2920 3c20 302e  slice.max() < 0.
-00007cf0: 353a 0a20 2020 2020 2020 2020 2020 2020  5:.             
-00007d00: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00007d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007d20: 2070 6f69 6e74 7320 3d20 7365 6c66 2e6d   points = self.m
-00007d30: 6173 6b5f 746f 5f63 6f6e 746f 7572 7328  ask_to_contours(
-00007d40: 6d61 736b 5f73 6c69 6365 2c20 7629 0a20  mask_slice, v). 
-00007d50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00007d60: 6620 706f 696e 7473 3a0a 2020 2020 2020  f points:.      
-00007d70: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00007d80: 6c66 2e63 6f6e 746f 7572 735b 765d 5b73  lf.contours[v][s
-00007d90: 656c 662e 6964 785f 746f 5f70 6f73 2869  elf.idx_to_pos(i
-00007da0: 7a2c 207a 5f61 7829 5d20 3d20 706f 696e  z, z_ax)] = poin
-00007db0: 7473 0a0a 2020 2020 6465 6620 6d61 736b  ts..    def mask
-00007dc0: 5f74 6f5f 636f 6e74 6f75 7273 2873 656c  _to_contours(sel
-00007dd0: 662c 206d 6173 6b2c 2076 6965 772c 2069  f, mask, view, i
-00007de0: 6e76 6572 743d 4661 6c73 6529 3a0a 2020  nvert=False):.  
-00007df0: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
-00007e00: 636f 6e74 6f75 7273 2066 726f 6d20 6120  contours from a 
-00007e10: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
-00007e20: 2020 636f 6e74 6f75 7273 203d 2073 6b69    contours = ski
-00007e30: 6d61 6765 2e6d 6561 7375 7265 2e66 696e  mage.measure.fin
-00007e40: 645f 636f 6e74 6f75 7273 286d 6173 6b2c  d_contours(mask,
-00007e50: 2030 2e35 2c20 226c 6f77 222c 2022 6c6f   0.5, "low", "lo
-00007e60: 7722 290a 0a20 2020 2020 2020 2023 2043  w")..        # C
-00007e70: 6f6e 7665 7274 2069 6e64 6963 6573 2074  onvert indices t
-00007e80: 6f20 706f 7369 7469 6f6e 7320 696e 206d  o positions in m
-00007e90: 6d0a 2020 2020 2020 2020 785f 6178 2c20  m.        x_ax, 
-00007ea0: 795f 6178 203d 2073 6b72 742e 696d 6167  y_ax = skrt.imag
-00007eb0: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
-00007ec0: 775d 0a20 2020 2020 2020 2070 6f69 6e74  w].        point
-00007ed0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-00007ee0: 6f72 2063 6f6e 746f 7572 2069 6e20 636f  or contour in co
-00007ef0: 6e74 6f75 7273 3a0a 2020 2020 2020 2020  ntours:.        
-00007f00: 2020 2020 636f 6e74 6f75 725f 706f 696e      contour_poin
-00007f10: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
-00007f20: 2020 2020 666f 7220 6978 2c20 6979 2069      for ix, iy i
-00007f30: 6e20 636f 6e74 6f75 723a 0a20 2020 2020  n contour:.     
-00007f40: 2020 2020 2020 2020 2020 2070 7820 3d20             px = 
-00007f50: 7365 6c66 2e69 6478 5f74 6f5f 706f 7328  self.idx_to_pos(
-00007f60: 6978 2c20 785f 6178 290a 2020 2020 2020  ix, x_ax).      
-00007f70: 2020 2020 2020 2020 2020 7079 203d 2073            py = s
-00007f80: 656c 662e 6964 785f 746f 5f70 6f73 2869  elf.idx_to_pos(i
-00007f90: 792c 2079 5f61 7829 0a20 2020 2020 2020  y, y_ax).       
-00007fa0: 2020 2020 2020 2020 2069 6620 696e 7665           if inve
-00007fb0: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
-00007fc0: 2020 2020 2020 2020 7078 2c20 7079 203d          px, py =
-00007fd0: 2070 792c 2070 780a 2020 2020 2020 2020   py, px.        
-00007fe0: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
-00007ff0: 706f 696e 7473 2e61 7070 656e 6428 5b70  points.append([p
-00008000: 782c 2070 795d 290a 2020 2020 2020 2020  x, py]).        
-00008010: 2020 2020 706f 696e 7473 2e61 7070 656e      points.appen
-00008020: 6428 6e70 2e61 7272 6179 2863 6f6e 746f  d(np.array(conto
-00008030: 7572 5f70 6f69 6e74 7329 290a 0a20 2020  ur_points))..   
-00008040: 2020 2020 2072 6574 7572 6e20 706f 696e       return poin
-00008050: 7473 0a0a 2020 2020 6465 6620 6372 6561  ts..    def crea
-00008060: 7465 5f6d 6173 6b28 0a20 2020 2020 2020  te_mask(.       
-00008070: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
-00008080: 666f 7263 653d 4661 6c73 652c 200a 2020  force=False, .  
-00008090: 2020 2020 2020 6f76 6572 6c61 705f 6c65        overlap_le
-000080a0: 7665 6c3d 4e6f 6e65 2c20 0a20 2020 2020  vel=None, .     
-000080b0: 2020 2076 6f78 656c 5f73 697a 653d 4e6f     voxel_size=No
-000080c0: 6e65 2c20 0a20 2020 2020 2020 2073 6861  ne, .        sha
-000080d0: 7065 3d4e 6f6e 650a 2020 2020 293a 0a20  pe=None.    ):. 
-000080e0: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
-000080f0: 2062 696e 6172 7920 6d61 736b 2072 6570   binary mask rep
-00008100: 7265 7365 6e74 6174 696f 6e20 6f66 2074  resentation of t
-00008110: 6869 7320 524f 492e 2049 6620 7468 6520  his ROI. If the 
-00008120: 524f 4920 7761 7320 6372 6561 7465 640a  ROI was created.
-00008130: 2020 2020 2020 2020 6672 6f6d 2063 6f6e          from con
-00008140: 746f 7572 732c 2074 6865 7365 2063 6f6e  tours, these con
-00008150: 746f 7572 7320 7769 6c6c 2062 6520 636f  tours will be co
-00008160: 6e76 6572 7465 6420 746f 2061 206d 6173  nverted to a mas
-00008170: 6b3b 2069 6620 7468 6520 524f 490a 2020  k; if the ROI.  
-00008180: 2020 2020 2020 7761 7320 6372 6561 7465        was create
-00008190: 6420 6672 6f6d 2061 206d 6173 6b2c 2074  d from a mask, t
-000081a0: 6869 7320 6d61 736b 2077 696c 6c20 6265  his mask will be
-000081b0: 2063 6173 7420 746f 2061 2062 6f6f 6c65   cast to a boole
-000081c0: 616e 2061 7272 6179 2061 6e64 0a20 2020  an array and.   
-000081d0: 2020 2020 2069 7473 2067 656f 656d 7472       its geoemtr
-000081e0: 6963 2070 726f 7065 7274 6965 7320 7769  ic properties wi
-000081f0: 6c6c 2062 6520 6173 7369 676e 6564 2074  ll be assigned t
-00008200: 6f20 7468 6973 2052 4f49 2e20 4966 2061  o this ROI. If a
-00008210: 206d 6173 6b20 6861 7320 0a20 2020 2020   mask has .     
-00008220: 2020 2061 6c72 6561 6479 2062 6565 6e20     already been 
-00008230: 6372 6561 7465 642c 206e 6f74 6869 6e67  created, nothing
-00008240: 2077 696c 6c20 6861 7070 656e 2075 6e6c   will happen unl
-00008250: 6573 7320 666f 7263 653d 5472 7565 2e0a  ess force=True..
-00008260: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-00008270: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
-00008280: 200a 2020 2020 2020 2020 666f 7263 6520   .        force 
-00008290: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-000082a0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-000082b0: 2020 4966 2054 7275 652c 2074 6865 206d    If True, the m
-000082c0: 6173 6b20 7769 6c6c 2062 6520 7265 6372  ask will be recr
-000082d0: 6561 7465 6420 6576 656e 2069 6620 6974  eated even if it
-000082e0: 2061 6c72 6561 6479 2065 7869 7374 732e   already exists.
-000082f0: 0a0a 2020 2020 2020 2020 6f76 6572 6c61  ..        overla
-00008300: 705f 6c65 7665 6c20 3a20 666c 6f61 742c  p_level : float,
-00008310: 2064 6566 6175 6c74 3d30 2e32 350a 2020   default=0.25.  
-00008320: 2020 2020 2020 2020 2020 5265 7175 6972            Requir
-00008330: 6564 206f 7665 726c 6170 206f 6620 6120  ed overlap of a 
-00008340: 7069 7865 6c20 7769 7468 2074 6865 2052  pixel with the R
-00008350: 4f49 2063 6f6e 746f 7572 2069 6e20 6f72  OI contour in or
-00008360: 6465 7220 666f 7220 7468 6520 0a20 2020  der for the .   
-00008370: 2020 2020 2020 2020 2070 6978 656c 2074           pixel t
-00008380: 6f20 6265 2061 6464 6564 2074 6f20 7468  o be added to th
-00008390: 6520 6d61 736b 2e20 4966 204e 6f6e 652c  e mask. If None,
-000083a0: 2074 6865 2076 616c 7565 206f 660a 2020   the value of.  
-000083b0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-000083c0: 7665 726c 6170 5f6c 6576 656c 2077 696c  verlap_level wil
-000083d0: 6c20 6265 2075 7365 643b 206f 7468 6572  l be used; other
-000083e0: 7769 7365 2c0a 2020 2020 2020 2020 2020  wise,.          
-000083f0: 2020 7365 6c66 2e6f 7665 726c 6170 5f6c    self.overlap_l
-00008400: 6576 656c 2077 696c 6c20 6265 206f 7665  evel will be ove
-00008410: 7277 7269 7474 656e 2077 6974 6820 7468  rwritten with th
-00008420: 6973 2076 616c 7565 2e20 4966 2062 6f74  is value. If bot
-00008430: 6820 6172 6520 0a20 2020 2020 2020 2020  h are .         
-00008440: 2020 204e 6f6e 652c 2074 6865 206f 7574     None, the out
-00008450: 7075 7420 6f66 2073 6b69 6d61 6765 2e64  put of skimage.d
-00008460: 7261 772e 706f 6c79 676f 6e32 6d61 736b  raw.polygon2mask
-00008470: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
-00008480: 6420 0a20 2020 2020 2020 2020 2020 2077  d .            w
-00008490: 6974 6820 6e6f 2062 6f72 6465 7220 6368  ith no border ch
-000084a0: 6563 6b73 2c20 7768 6963 6820 6973 2066  ecks, which is f
-000084b0: 6173 7465 7220 7468 616e 2070 6572 666f  aster than perfo
-000084c0: 726d 696e 6720 626f 7264 6572 2063 6865  rming border che
-000084d0: 636b 732e 0a0a 2020 2020 2020 2020 766f  cks...        vo
-000084e0: 7865 6c5f 7369 7a65 203a 206c 6973 742c  xel_size : list,
-000084f0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00008500: 2020 2020 2020 2020 2020 566f 7865 6c20            Voxel 
-00008510: 7369 7a65 7320 6f66 2074 6865 2064 6573  sizes of the des
-00008520: 6972 6564 206d 6173 6b20 696e 2074 6865  ired mask in the
-00008530: 205b 782c 2079 5d20 6469 7265 6374 696f   [x, y] directio
-00008540: 6e2e 204f 6e6c 7920 7573 6564 2069 6620  n. Only used if 
-00008550: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00008560: 2052 4f49 2077 6173 2063 7265 6174 6564   ROI was created
-00008570: 2066 726f 6d20 636f 6e74 6f75 7273 3b20   from contours; 
-00008580: 6967 6e6f 7265 6420 6966 2052 4f49 2077  ignored if ROI w
-00008590: 6173 2063 7265 6174 6564 2066 726f 6d20  as created from 
-000085a0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-000085b0: 6b2e 2043 6175 7365 7320 7365 6c66 2e69  k. Causes self.i
-000085c0: 6d61 6765 2074 6f20 6265 2072 6570 6c61  mage to be repla
-000085d0: 6365 6420 7769 7468 2061 200a 2020 2020  ced with a .    
-000085e0: 2020 2020 2020 2020 626c 616e 6b20 6475          blank du
-000085f0: 6d6d 7920 696d 6167 6520 7769 7468 2074  mmy image with t
-00008600: 6865 7365 2076 6f78 656c 2073 697a 6573  hese voxel sizes
-00008610: 2e0a 0a20 2020 2020 2020 2073 6861 7065  ...        shape
-00008620: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
-00008630: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00008640: 2020 5368 6170 6520 6f66 2074 6865 2064    Shape of the d
-00008650: 6573 6972 6564 206d 6173 6b20 696e 2074  esired mask in t
-00008660: 6865 205b 782c 2079 5d20 6469 7265 6374  he [x, y] direct
-00008670: 696f 6e2e 204f 6e6c 7920 7573 6564 2069  ion. Only used i
-00008680: 6620 0a20 2020 2020 2020 2020 2020 203c  f .            <
-00008690: 766f 7865 6c5f 7369 7a65 3e20 6973 204e  voxel_size> is N
-000086a0: 6f6e 6520 616e 6420 7468 6520 524f 4920  one and the ROI 
-000086b0: 7761 7320 6372 6561 7465 6420 6672 6f6d  was created from
-000086c0: 2063 6f6e 746f 7572 733b 200a 2020 2020   contours; .    
-000086d0: 2020 2020 2020 2020 6967 6e6f 7265 6420          ignored 
-000086e0: 6966 2052 4f49 2077 6173 2063 7265 6174  if ROI was creat
-000086f0: 6564 2066 726f 6d20 6d61 736b 2e20 4361  ed from mask. Ca
-00008700: 7573 6573 2073 656c 662e 696d 6167 6520  uses self.image 
-00008710: 746f 2062 6520 0a20 2020 2020 2020 2020  to be .         
-00008720: 2020 2072 6570 6c61 6365 6420 7769 7468     replaced with
-00008730: 2061 2062 6c61 6e6b 2064 756d 6d79 2069   a blank dummy i
-00008740: 6d61 6765 206f 6620 7468 6973 2073 6861  mage of this sha
-00008750: 7065 2e0a 2020 2020 2020 2020 2222 220a  pe..        """.
-00008760: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00008770: 2e6c 6f61 6465 645f 6d61 736b 2061 6e64  .loaded_mask and
-00008780: 206e 6f74 2066 6f72 6365 3a0a 2020 2020   not force:.    
-00008790: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-000087a0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-000087b0: 656c 662e 6c6f 6164 6564 3a0a 2020 2020  elf.loaded:.    
-000087c0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-000087d0: 6428 290a 2020 2020 2020 2020 6966 206f  d().        if o
-000087e0: 7665 726c 6170 5f6c 6576 656c 2069 7320  verlap_level is 
-000087f0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00008800: 2020 2020 2020 7365 6c66 2e6f 7665 726c        self.overl
-00008810: 6170 5f6c 6576 656c 203d 206f 7665 726c  ap_level = overl
-00008820: 6170 5f6c 6576 656c 0a0a 2020 2020 2020  ap_level..      
-00008830: 2020 2320 5365 7420 696d 6167 6520 746f    # Set image to
-00008840: 2064 756d 6d79 2069 6d61 6765 2069 6620   dummy image if 
-00008850: 6e65 6564 6564 0a20 2020 2020 2020 2069  needed.        i
-00008860: 6620 2866 6f72 6365 2061 6e64 2028 7368  f (force and (sh
-00008870: 6170 6520 6973 206e 6f74 204e 6f6e 6520  ape is not None 
-00008880: 6f72 2076 6f78 656c 5f73 697a 6520 6973  or voxel_size is
-00008890: 206e 6f74 204e 6f6e 6529 2920 5c0a 2020   not None)) \.  
-000088a0: 2020 2020 2020 2020 206f 7220 2873 656c           or (sel
-000088b0: 662e 636f 6e74 6f75 7273 5f6f 6e6c 7920  f.contours_only 
-000088c0: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
-000088d0: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
-000088e0: 2020 2020 2073 656c 662e 7365 745f 696d       self.set_im
-000088f0: 6167 655f 746f 5f64 756d 6d79 2873 6861  age_to_dummy(sha
-00008900: 7065 3d73 6861 7065 2c20 766f 7865 6c5f  pe=shape, voxel_
-00008910: 7369 7a65 3d76 6f78 656c 5f73 697a 6529  size=voxel_size)
-00008920: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
-00008930: 7465 206d 6173 6b20 6672 6f6d 2069 6e70  te mask from inp
-00008940: 7574 2078 2d79 2063 6f6e 746f 7572 7320  ut x-y contours 
-00008950: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00008960: 2e69 6e70 7574 5f63 6f6e 746f 7572 733a  .input_contours:
-00008970: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00008980: 496e 6974 6961 6c69 7365 2073 656c 662e  Initialise self.
-00008990: 6d61 736b 2061 7320 696d 6167 650a 2020  mask as image.  
-000089a0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-000089b0: 6173 6b20 3d20 736b 7274 2e69 6d61 6765  ask = skrt.image
-000089c0: 2e49 6d61 6765 280a 2020 2020 2020 2020  .Image(.        
-000089d0: 2020 2020 2020 2020 6e70 2e7a 6572 6f73          np.zeros
-000089e0: 2828 7365 6c66 2e73 6861 7065 5b31 5d2c  ((self.shape[1],
-000089f0: 2073 656c 662e 7368 6170 655b 305d 2c20   self.shape[0], 
-00008a00: 7365 6c66 2e73 6861 7065 5b32 5d29 2c0a  self.shape[2]),.
-00008a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a20: 2020 2020 6474 7970 653d 626f 6f6c 292c      dtype=bool),
-00008a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008a40: 2061 6666 696e 653d 7365 6c66 2e61 6666   affine=self.aff
-00008a50: 696e 652c 200a 2020 2020 2020 2020 2020  ine, .          
-00008a60: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
-00008a70: 3d73 656c 662e 766f 7865 6c5f 7369 7a65  =self.voxel_size
-00008a80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008a90: 2020 6f72 6967 696e 3d73 656c 662e 6f72    origin=self.or
-00008aa0: 6967 696e 0a20 2020 2020 2020 2020 2020  igin.           
-00008ab0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00008ac0: 2320 4372 6561 7465 206d 6173 6b20 6f6e  # Create mask on
-00008ad0: 2065 6163 6820 7a20 6c61 7965 720a 2020   each z layer.  
-00008ae0: 2020 2020 2020 2020 2020 666f 7220 7a2c            for z,
-00008af0: 2063 6f6e 746f 7572 7320 696e 2073 656c   contours in sel
-00008b00: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-00008b10: 2e69 7465 6d73 2829 3a0a 0a20 2020 2020  .items():..     
-00008b20: 2020 2020 2020 2020 2020 2023 204c 6f6f             # Loo
-00008b30: 7020 6f76 6572 2065 6163 6820 636f 6e74  p over each cont
-00008b40: 6f75 7220 6f6e 2074 6865 207a 2073 6c69  our on the z sli
-00008b50: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-00008b60: 2020 2069 7a20 3d20 696e 7428 7365 6c66     iz = int(self
-00008b70: 2e70 6f73 5f74 6f5f 6964 7828 7a2c 2022  .pos_to_idx(z, "
-00008b80: 7a22 2929 0a20 2020 2020 2020 2020 2020  z")).           
-00008b90: 2020 2020 2069 6620 697a 203e 3d20 7365       if iz >= se
-00008ba0: 6c66 2e6d 6173 6b2e 6461 7461 2e73 6861  lf.mask.data.sha
-00008bb0: 7065 5b32 5d3a 2020 2320 4967 6e6f 7265  pe[2]:  # Ignore
-00008bc0: 2073 6c69 6365 7320 6f75 7473 6964 6520   slices outside 
-00008bd0: 6d61 736b 2072 616e 6765 0a20 2020 2020  mask range.     
-00008be0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00008bf0: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
-00008c00: 2020 2020 2020 2020 2070 6f73 5f74 6f5f           pos_to_
-00008c10: 6964 785f 7665 6320 3d20 6e70 2e76 6563  idx_vec = np.vec
-00008c20: 746f 7269 7a65 2873 656c 662e 706f 735f  torize(self.pos_
-00008c30: 746f 5f69 6478 290a 2020 2020 2020 2020  to_idx).        
-00008c40: 2020 2020 2020 2020 666f 7220 706f 696e          for poin
-00008c50: 7473 2069 6e20 636f 6e74 6f75 7273 3a0a  ts in contours:.
-00008c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c70: 2020 2020 2023 2052 6571 7569 7265 2061       # Require a
-00008c80: 7420 6c65 6173 7420 3320 706f 696e 7473  t least 3 points
-00008c90: 2074 6f20 6465 6669 6e65 2061 2070 6f6c   to define a pol
-00008ca0: 7967 6f6e 2e0a 2020 2020 2020 2020 2020  ygon..          
-00008cb0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00008cc0: 2870 6f69 6e74 7329 203c 2033 3a0a 2020  (points) < 3:.  
-00008cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ce0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+000068c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068d0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+000068e0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000068f0: 2073 656c 662e 6166 6669 6e65 0a0a 2020   self.affine..  
+00006900: 2020 6465 6620 6765 745f 7472 616e 736c    def get_transl
+00006910: 6174 696f 6e5f 746f 5f61 6c69 676e 280a  ation_to_align(.
+00006920: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006930: 2c20 6f74 6865 722c 207a 5f66 7261 6374  , other, z_fract
+00006940: 696f 6e31 3d4e 6f6e 652c 207a 5f66 7261  ion1=None, z_fra
+00006950: 6374 696f 6e32 3d4e 6f6e 6529 3a0a 2020  ction2=None):.  
+00006960: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00006970: 2020 4465 7465 726d 696e 6520 7472 616e    Determine tran
+00006980: 736c 6174 696f 6e20 666f 7220 616c 6967  slation for alig
+00006990: 6e69 6e67 203c 7365 6c66 3e20 746f 203c  ning <self> to <
+000069a0: 6f74 6865 723e 2e0a 0a20 2020 2020 2020  other>...       
+000069b0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+000069c0: 0a0a 2020 2020 2020 2020 6f74 6865 7220  ..        other 
+000069d0: 3a20 524f 492f 5374 7275 6374 7572 6553  : ROI/StructureS
+000069e0: 6574 2f6c 6973 740a 2020 2020 2020 2020  et/list.        
+000069f0: 2020 2020 524f 4920 7769 7468 2077 6869      ROI with whi
+00006a00: 6368 2061 6c69 676e 6d65 6e74 2069 7320  ch alignment is 
+00006a10: 746f 2062 6520 7065 7266 6f72 6d65 642e  to be performed.
+00006a20: 2020 5468 6973 2063 616e 2062 650a 2020    This can be.  
+00006a30: 2020 2020 2020 2020 2020 7370 6563 6966            specif
+00006a40: 6965 6420 6469 7265 6374 6c79 2061 7320  ied directly as 
+00006a50: 6120 7369 6e67 6c65 2052 4f49 2e20 2041  a single ROI.  A
+00006a60: 6c74 6572 6e61 7469 7665 6c79 2c20 6974  lternatively, it
+00006a70: 2063 616e 0a20 2020 2020 2020 2020 2020   can.           
+00006a80: 2062 6520 6120 5374 7275 6374 7572 6553   be a StructureS
+00006a90: 6574 2c20 6f72 2061 206c 6973 7420 6f72  et, or a list or
+00006aa0: 2052 4f49 2f53 7472 7563 7475 7265 5365   ROI/StructureSe
+00006ab0: 7420 6f62 6a65 6374 732c 0a20 2020 2020  t objects,.     
+00006ac0: 2020 2020 2020 2069 6e20 7768 6963 6820         in which 
+00006ad0: 6361 7365 2074 6865 2069 6e64 6976 6964  case the individ
+00006ae0: 7561 6c20 524f 4973 2077 696c 6c20 6265  ual ROIs will be
+00006af0: 2063 6f6d 6269 6e65 642e 0a0a 2020 2020   combined...    
+00006b00: 2020 2020 7a5f 6672 6163 7469 6f6e 3120      z_fraction1 
+00006b10: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00006b20: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00006b30: 2020 506f 7369 7469 6f6e 2061 6c6f 6e67    Position along
+00006b40: 207a 2061 7869 7320 6f66 2073 6c69 6365   z axis of slice
+00006b50: 2074 6872 6f75 6768 203c 7365 6c66 3e20   through <self> 
+00006b60: 6f6e 2077 6869 6368 0a20 2020 2020 2020  on which.       
+00006b70: 2020 2020 2074 6f20 616c 6967 6e2e 2020       to align.  
+00006b80: 4966 204e 6f6e 652c 2061 6c69 676e 6d65  If None, alignme
+00006b90: 6e74 2069 7320 746f 2074 6865 2063 656e  nt is to the cen
+00006ba0: 7472 6f69 6420 6f66 2074 6865 0a20 2020  troid of the.   
+00006bb0: 2020 2020 2020 2020 2077 686f 6c65 2052           whole R
+00006bc0: 4f49 2076 6f6c 756d 652e 2020 4f74 6865  OI volume.  Othe
+00006bd0: 7277 6973 652c 2061 6c69 676e 6d65 6e74  rwise, alignment
+00006be0: 2069 7320 746f 2074 6865 0a20 2020 2020   is to the.     
+00006bf0: 2020 2020 2020 2063 656e 7472 6f69 6420         centroid 
+00006c00: 6f66 2074 6865 2073 6c69 6365 2061 7420  of the slice at 
+00006c10: 7468 6520 7370 6563 6966 6965 6420 6469  the specified di
+00006c20: 7374 616e 6365 0a20 2020 2020 2020 2020  stance.         
+00006c30: 2020 2066 726f 6d20 7468 6520 524f 4927     from the ROI'
+00006c40: 7320 6d6f 7374 2d69 6e66 6572 696f 7220  s most-inferior 
+00006c50: 706f 696e 743a 2030 2063 6f72 7265 7370  point: 0 corresp
+00006c60: 6f6e 6473 2074 6f0a 2020 2020 2020 2020  onds to.        
+00006c70: 2020 2020 7468 6520 6d6f 7374 2d69 6e66      the most-inf
+00006c80: 6572 696f 7220 706f 696e 7420 286c 6f77  erior point (low
+00006c90: 6573 7420 7a29 3b20 3120 636f 7272 6573  est z); 1 corres
+00006ca0: 706f 6e64 7320 746f 2074 6865 0a20 2020  ponds to the.   
+00006cb0: 2020 2020 2020 2020 206d 6f73 742d 7375           most-su
+00006cc0: 7065 7269 6f72 2070 6f69 6e74 2028 6869  perior point (hi
+00006cd0: 6768 6573 7420 7a29 2e20 2056 616c 7565  ghest z).  Value
+00006ce0: 7320 666f 7220 7a5f 6672 6163 7469 6f6e  s for z_fraction
+00006cf0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00006d00: 7369 6465 2074 6865 2069 6e74 6572 7661  side the interva
+00006d10: 6c20 5b30 2c20 315d 2072 6573 756c 7420  l [0, 1] result 
+00006d20: 696e 2061 2052 756e 7469 6d65 4572 726f  in a RuntimeErro
+00006d30: 722e 0a0a 2020 2020 2020 2020 7a5f 6672  r...        z_fr
+00006d40: 6163 7469 6f6e 3220 3a20 666c 6f61 742c  action2 : float,
+00006d50: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00006d60: 2020 2020 2020 2020 2020 506f 7369 7469            Positi
+00006d70: 6f6e 2061 6c6f 6e67 207a 2061 7869 7320  on along z axis 
+00006d80: 6f66 2073 6c69 6365 2074 6872 6f75 6768  of slice through
+00006d90: 203c 6f74 6865 723e 206f 6e20 7768 6963   <other> on whic
+00006da0: 680a 2020 2020 2020 2020 2020 2020 746f  h.            to
+00006db0: 2061 6c69 676e 2e20 2049 6620 4e6f 6e65   align.  If None
+00006dc0: 2c20 616c 6967 6e6d 656e 7420 6973 2074  , alignment is t
+00006dd0: 6f20 7468 6520 6365 6e74 726f 6964 206f  o the centroid o
+00006de0: 6620 7468 650a 2020 2020 2020 2020 2020  f the.          
+00006df0: 2020 7768 6f6c 6520 524f 4920 766f 6c75    whole ROI volu
+00006e00: 6d65 2e20 204f 7468 6572 7769 7365 2c20  me.  Otherwise, 
+00006e10: 616c 6967 6e6d 656e 7420 6973 2074 6f20  alignment is to 
+00006e20: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00006e30: 6365 6e74 726f 6964 206f 6620 7468 6520  centroid of the 
+00006e40: 736c 6963 6520 6174 2074 6865 2073 7065  slice at the spe
+00006e50: 6369 6669 6564 2064 6973 7461 6e63 650a  cified distance.
+00006e60: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+00006e70: 2074 6865 2052 4f49 2773 206d 6f73 742d   the ROI's most-
+00006e80: 696e 6665 7269 6f72 2070 6f69 6e74 3a20  inferior point: 
+00006e90: 3020 636f 7272 6573 706f 6e64 7320 746f  0 corresponds to
+00006ea0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00006eb0: 206d 6f73 742d 696e 6665 7269 6f72 2070   most-inferior p
+00006ec0: 6f69 6e74 2028 6c6f 7765 7374 207a 293b  oint (lowest z);
+00006ed0: 2031 2063 6f72 7265 7370 6f6e 6473 2074   1 corresponds t
+00006ee0: 6f20 7468 650a 2020 2020 2020 2020 2020  o the.          
+00006ef0: 2020 6d6f 7374 2d73 7570 6572 696f 7220    most-superior 
+00006f00: 706f 696e 7420 2868 6967 6865 7374 207a  point (highest z
+00006f10: 292e 2020 5661 6c75 6573 2066 6f72 207a  ).  Values for z
+00006f20: 5f66 7261 6374 696f 6e0a 2020 2020 2020  _fraction.      
+00006f30: 2020 2020 2020 6f75 7473 6964 6520 7468        outside th
+00006f40: 6520 696e 7465 7276 616c 205b 302c 2031  e interval [0, 1
+00006f50: 5d20 7265 7375 6c74 2069 6e20 6120 5275  ] result in a Ru
+00006f60: 6e74 696d 6545 7272 6f72 2e0a 2020 2020  ntimeError..    
+00006f70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00006f80: 2020 2020 7265 7475 726e 2067 6574 5f74      return get_t
+00006f90: 7261 6e73 6c61 7469 6f6e 5f74 6f5f 616c  ranslation_to_al
+00006fa0: 6967 6e28 0a20 2020 2020 2020 2020 2020  ign(.           
+00006fb0: 2020 2020 2073 656c 662c 206f 7468 6572       self, other
+00006fc0: 2c20 7a5f 6672 6163 7469 6f6e 312c 207a  , z_fraction1, z
+00006fd0: 5f66 7261 6374 696f 6e32 290a 0a20 2020  _fraction2)..   
+00006fe0: 2064 6566 2067 6574 5f76 6f78 656c 5f73   def get_voxel_s
+00006ff0: 697a 6528 7365 6c66 293a 0a20 2020 2020  ize(self):.     
+00007000: 2020 2022 2222 4c6f 6164 2073 656c 6620     """Load self 
+00007010: 616e 6420 6765 7420 766f 7865 6c5f 7369  and get voxel_si
+00007020: 7a65 2e22 2222 0a0a 2020 2020 2020 2020  ze."""..        
+00007030: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00007040: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00007050: 766f 7865 6c5f 7369 7a65 0a0a 2020 2020  voxel_size..    
+00007060: 6465 6620 6765 745f 6e70 5f76 6f78 656c  def get_np_voxel
+00007070: 5f73 697a 6528 7365 6c66 2c20 7669 6577  _size(self, view
+00007080: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00007090: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+000070a0: 766f 7865 6c5f 7369 7a65 2066 6f72 206e  voxel_size for n
+000070b0: 756d 7079 2061 7869 7320 6f72 6465 7269  umpy axis orderi
+000070c0: 6e67 2061 6e64 2073 7065 6369 6669 6564  ng and specified
+000070d0: 2076 6965 772e 0a0a 2020 2020 2020 2020   view...        
+000070e0: 7669 6577 203a 2073 7472 0a20 2020 2020  view : str.     
+000070f0: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
+00007100: 6f6e 2063 6f6e 7369 6465 7265 6420 666f  on considered fo
+00007110: 7220 3244 2069 6d61 6765 206f 7220 7072  r 2D image or pr
+00007120: 6f6a 6563 7469 6f6e 2e0a 2020 2020 2020  ojection..      
+00007130: 2020 2020 2020 4361 6e20 6265 2022 782d        Can be "x-
+00007140: 7922 2c20 2278 2d7a 222c 2022 792d 7822  y", "x-z", "y-x"
+00007150: 2c20 2279 2d7a 222c 2022 7a2d 7822 2c20  , "y-z", "z-x", 
+00007160: 6f72 2022 7a2d 7922 2e0a 2020 2020 2020  or "z-y"..      
+00007170: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
+00007180: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+00007190: 2020 2069 6620 7669 6577 2069 7320 4e6f     if view is No
+000071a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000071b0: 7678 2c20 7679 2c20 767a 203d 2073 656c  vx, vy, vz = sel
+000071c0: 662e 766f 7865 6c5f 7369 7a65 0a20 2020  f.voxel_size.   
+000071d0: 2020 2020 2020 2020 2076 6f78 656c 5f73           voxel_s
+000071e0: 697a 6520 3d20 5b76 792c 2076 782c 2076  ize = [vy, vx, v
+000071f0: 7a5d 0a20 2020 2020 2020 2065 6c73 653a  z].        else:
+00007200: 0a20 2020 2020 2020 2020 2020 2076 6f78  .            vox
+00007210: 656c 5f73 697a 6520 3d20 5b73 656c 662e  el_size = [self.
+00007220: 766f 7865 6c5f 7369 7a65 5b69 5d0a 2020  voxel_size[i].  
+00007230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007240: 2020 666f 7220 6920 696e 2073 6b72 742e    for i in skrt.
+00007250: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
+00007260: 5b76 6965 775d 5d0a 0a20 2020 2020 2020  [view]]..       
+00007270: 2072 6574 7572 6e20 766f 7865 6c5f 7369   return voxel_si
+00007280: 7a65 0a0a 2020 2020 6465 6620 6765 745f  ze..    def get_
+00007290: 6f72 6967 696e 2873 656c 6629 3a0a 2020  origin(self):.  
+000072a0: 2020 2020 2020 2222 224c 6f61 6420 7365        """Load se
+000072b0: 6c66 2061 6e64 2067 6574 206f 7269 6769  lf and get origi
+000072c0: 6e2e 2222 220a 0a20 2020 2020 2020 2073  n."""..        s
+000072d0: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+000072e0: 2020 2072 6574 7572 6e20 7365 6c66 2e6f     return self.o
+000072f0: 7269 6769 6e0a 0a20 2020 2064 6566 2067  rigin..    def g
+00007300: 6574 5f6e 616d 6528 7365 6c66 2c20 6f72  et_name(self, or
+00007310: 6967 696e 616c 3d46 616c 7365 293a 0a20  iginal=False):. 
+00007320: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007330: 2020 204c 6f61 6420 7365 6c66 2061 6e64     Load self and
+00007340: 2067 6574 206e 616d 652e 2049 6620 3c6f   get name. If <o
+00007350: 7269 6769 6e61 6c3e 2069 7320 5472 7565  riginal> is True
+00007360: 2c20 6765 7420 7468 6520 6f72 6967 696e  , get the origin
+00007370: 616c 206e 616d 652e 0a20 2020 2020 2020  al name..       
+00007380: 2022 2222 0a0a 2020 2020 2020 2020 7365   """..        se
+00007390: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
+000073a0: 2020 7265 7475 726e 2028 7365 6c66 2e6f    return (self.o
+000073b0: 7269 6769 6e61 6c5f 6e61 6d65 2069 6620  riginal_name if 
+000073c0: 6f72 6967 696e 616c 2065 6c73 6520 7365  original else se
+000073d0: 6c66 2e6e 616d 6529 0a0a 2020 2020 6465  lf.name)..    de
+000073e0: 6620 6765 745f 6d61 736b 2873 656c 662c  f get_mask(self,
+000073f0: 2076 6965 773d 2278 2d79 222c 2066 6c61   view="x-y", fla
+00007400: 7474 656e 3d46 616c 7365 2c20 7374 616e  tten=False, stan
+00007410: 6461 7264 6973 653d 4661 6c73 652c 200a  dardise=False, .
+00007420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007430: 2066 6f72 6365 5f73 7461 6e64 6172 6469   force_standardi
+00007440: 7365 3d46 616c 7365 293a 0a20 2020 2020  se=False):.     
+00007450: 2020 2022 2222 4765 7420 6269 6e61 7279     """Get binary
+00007460: 206d 6173 6b2c 206f 7074 696f 6e61 6c6c   mask, optionall
+00007470: 7920 666c 6174 7465 6e65 6420 696e 2061  y flattened in a
+00007480: 2067 6976 656e 206f 7269 656e 7461 7469   given orientati
+00007490: 6f6e 2e22 2222 0a0a 2020 2020 2020 2020  on."""..        
+000074a0: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+000074b0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+000074c0: 6d61 736b 2829 0a20 2020 2020 2020 2069  mask().        i
+000074d0: 6620 6e6f 7420 666c 6174 7465 6e3a 0a20  f not flatten:. 
+000074e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000074f0: 6e20 7365 6c66 2e6d 6173 6b2e 6765 745f  n self.mask.get_
+00007500: 6461 7461 2873 7461 6e64 6172 6469 7365  data(standardise
+00007510: 3d73 7461 6e64 6172 6469 7365 2c20 0a20  =standardise, . 
+00007520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007540: 2020 2020 2066 6f72 6365 5f73 7461 6e64       force_stand
+00007550: 6172 6469 7365 3d66 6f72 6365 5f73 7461  ardise=force_sta
+00007560: 6e64 6172 6469 7365 290a 2020 2020 2020  ndardise).      
+00007570: 2020 7265 7475 726e 206e 702e 7375 6d28    return np.sum(
+00007580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007590: 662e 6d61 736b 2e67 6574 5f64 6174 6128  f.mask.get_data(
+000075a0: 7374 616e 6461 7264 6973 653d 7374 616e  standardise=stan
+000075b0: 6461 7264 6973 652c 200a 2020 2020 2020  dardise, .      
+000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075d0: 2020 2020 2020 2020 2066 6f72 6365 5f73           force_s
+000075e0: 7461 6e64 6172 6469 7365 3d66 6f72 6365  tandardise=force
+000075f0: 5f73 7461 6e64 6172 6469 7365 292c 0a20  _standardise),. 
+00007600: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+00007610: 736b 7274 2e69 6d61 6765 2e5f 736c 6963  skrt.image._slic
+00007620: 655f 6178 6573 5b76 6965 775d 0a20 2020  e_axes[view].   
+00007630: 2020 2020 2029 2e61 7374 7970 6528 626f       ).astype(bo
+00007640: 6f6c 290a 0a20 2020 2064 6566 2067 6574  ol)..    def get
+00007650: 5f6d 6173 6b5f 696d 6167 6528 7365 6c66  _mask_image(self
+00007660: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+00007670: 7420 696d 6167 6520 6f62 6a65 6374 2072  t image object r
+00007680: 6570 7265 7365 6e74 696e 6720 524f 4920  epresenting ROI 
+00007690: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
+000076a0: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
+000076b0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+000076c0: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
+000076d0: 2072 6574 7572 6e20 7365 6c66 2e6d 6173   return self.mas
+000076e0: 6b0a 0a20 2020 2064 6566 2067 6574 5f70  k..    def get_p
+000076f0: 6f6c 7967 6f6e 7328 7365 6c66 2c20 7669  olygons(self, vi
+00007700: 6577 3d22 782d 7922 2c20 6964 785f 6173  ew="x-y", idx_as
+00007710: 5f6b 6579 3d46 616c 7365 293a 0a20 2020  _key=False):.   
+00007720: 2020 2020 2022 2222 4765 7420 6469 6374       """Get dict
+00007730: 206f 6620 706f 6c79 676f 6e73 2066 6f72   of polygons for
+00007740: 2065 6163 6820 736c 6963 652e 2222 220a   each slice.""".
+00007750: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
+00007760: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+00007770: 6f72 2069 2c20 636f 6e74 6f75 7273 2069  or i, contours i
+00007780: 6e20 7365 6c66 2e67 6574 5f63 6f6e 746f  n self.get_conto
+00007790: 7572 7328 7669 6577 2c20 6964 785f 6173  urs(view, idx_as
+000077a0: 5f6b 6579 292e 6974 656d 7328 293a 0a20  _key).items():. 
+000077b0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+000077c0: 6f6e 735b 695d 203d 205b 636f 6e74 6f75  ons[i] = [contou
+000077d0: 725f 746f 5f70 6f6c 7967 6f6e 2863 2920  r_to_polygon(c) 
+000077e0: 666f 7220 6320 696e 2063 6f6e 746f 7572  for c in contour
+000077f0: 735d 0a20 2020 2020 2020 2072 6574 7572  s].        retur
+00007800: 6e20 706f 6c79 676f 6e73 0a0a 2020 2020  n polygons..    
+00007810: 6465 6620 6765 745f 706f 6c79 676f 6e73  def get_polygons
+00007820: 5f6f 6e5f 736c 6963 6528 7365 6c66 2c20  _on_slice(self, 
+00007830: 7669 6577 3d22 782d 7922 2c20 736c 3d4e  view="x-y", sl=N
+00007840: 6f6e 652c 2069 6478 3d4e 6f6e 652c 2070  one, idx=None, p
+00007850: 6f73 3d4e 6f6e 6529 3a0a 2020 2020 2020  os=None):.      
+00007860: 2020 2222 2247 6574 2073 6861 7065 6c79    """Get shapely
+00007870: 2070 6f6c 7967 6f6e 206f 626a 6563 7473   polygon objects
+00007880: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
+00007890: 6f20 6120 6769 7665 6e20 736c 6963 652e  o a given slice.
+000078a0: 2222 220a 0a20 2020 2020 2020 2063 6f6e  """..        con
+000078b0: 746f 7572 7320 3d20 7365 6c66 2e67 6574  tours = self.get
+000078c0: 5f63 6f6e 746f 7572 735f 6f6e 5f73 6c69  _contours_on_sli
+000078d0: 6365 2876 6965 772c 2073 6c2c 2069 6478  ce(view, sl, idx
+000078e0: 2c20 706f 7329 0a20 2020 2020 2020 2072  , pos).        r
+000078f0: 6574 7572 6e20 5b63 6f6e 746f 7572 5f74  eturn [contour_t
+00007900: 6f5f 706f 6c79 676f 6e28 6329 2066 6f72  o_polygon(c) for
+00007910: 2063 2069 6e20 636f 6e74 6f75 7273 5d0a   c in contours].
+00007920: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+00007930: 636f 6e74 6f75 7273 2873 656c 662c 2076  contours(self, v
+00007940: 6965 773d 2261 6c6c 222c 2066 6f72 6365  iew="all", force
+00007950: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00007960: 2022 2222 4372 6561 7465 2063 6f6e 746f   """Create conto
+00007970: 7572 7320 696e 2061 6c6c 206f 7269 656e  urs in all orien
+00007980: 7461 7469 6f6e 732e 2222 220a 0a20 2020  tations."""..   
+00007990: 2020 2020 2069 6620 6e6f 7420 666f 7263       if not forc
+000079a0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+000079b0: 6620 7669 6577 203d 3d20 2261 6c6c 2220  f view == "all" 
+000079c0: 616e 6420 616c 6c28 5b76 2069 6e20 7365  and all([v in se
+000079d0: 6c66 2e63 6f6e 746f 7572 7320 666f 7220  lf.contours for 
+000079e0: 7620 696e 200a 2020 2020 2020 2020 2020  v in .          
+000079f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a00: 2020 2020 2020 2020 2020 2020 736b 7274              skrt
+00007a10: 2e69 6d61 6765 2e5f 706c 6f74 5f61 7865  .image._plot_axe
+00007a20: 735d 293a 0a20 2020 2020 2020 2020 2020  s]):.           
+00007a30: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00007a40: 2020 2020 2020 2020 6966 2076 6965 7720          if view 
+00007a50: 696e 2073 656c 662e 636f 6e74 6f75 7273  in self.contours
+00007a60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007a70: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+00007a80: 2020 6966 206e 6f74 2073 656c 662e 6c6f    if not self.lo
+00007a90: 6164 6564 3a0a 2020 2020 2020 2020 2020  aded:.          
+00007aa0: 2020 7365 6c66 2e6c 6f61 6428 290a 0a20    self.load().. 
+00007ab0: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+00007ac0: 7465 5f6d 6173 6b28 290a 2020 2020 2020  te_mask().      
+00007ad0: 2020 6966 2066 6f72 6365 3a0a 2020 2020    if force:.    
+00007ae0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00007af0: 746f 7572 7320 3d20 7b7d 0a0a 2020 2020  tours = {}..    
+00007b00: 2020 2020 2320 4372 6561 7465 2063 6f6e      # Create con
+00007b10: 746f 7572 7320 696e 2065 7665 7279 206f  tours in every o
+00007b20: 7269 656e 7461 7469 6f6e 0a20 2020 2020  rientation.     
+00007b30: 2020 2076 6965 7773 203d 206c 6973 7428     views = list(
+00007b40: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
+00007b50: 5f61 7865 732e 6b65 7973 2829 2920 6966  _axes.keys()) if
+00007b60: 2076 6965 7720 3d3d 2022 616c 6c22 2065   view == "all" e
+00007b70: 6c73 6520 5b76 6965 775d 0a20 2020 2020  lse [view].     
+00007b80: 2020 2066 6f72 2076 2069 6e20 7669 6577     for v in view
+00007b90: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
+00007ba0: 6966 2076 2069 6e20 7365 6c66 2e63 6f6e  if v in self.con
+00007bb0: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
+00007bc0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00007bd0: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
+00007be0: 616b 6520 6e65 7720 636f 6e74 6f75 7273  ake new contours
+00007bf0: 2066 726f 6d20 6d61 736b 0a20 2020 2020   from mask.     
+00007c00: 2020 2020 2020 207a 5f61 7820 3d20 736b         z_ax = sk
+00007c10: 7274 2e69 6d61 6765 2e5f 736c 6963 655f  rt.image._slice_
+00007c20: 6178 6573 5b76 5d0a 2020 2020 2020 2020  axes[v].        
+00007c30: 2020 2020 7365 6c66 2e63 6f6e 746f 7572      self.contour
+00007c40: 735b 765d 203d 207b 7d0a 2020 2020 2020  s[v] = {}.      
+00007c50: 2020 2020 2020 666f 7220 697a 2069 6e20        for iz in 
+00007c60: 7365 6c66 2e67 6574 5f69 6e64 6963 6573  self.get_indices
+00007c70: 2876 2c20 6d65 7468 6f64 3d22 6d61 736b  (v, method="mask
+00007c80: 2229 3a0a 0a20 2020 2020 2020 2020 2020  "):..           
+00007c90: 2020 2020 2023 2047 6574 2073 6c69 6365       # Get slice
+00007ca0: 206f 6620 6d61 736b 2061 7272 6179 0a20   of mask array. 
+00007cb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00007cc0: 6173 6b5f 736c 6963 6520 3d20 7365 6c66  ask_slice = self
+00007cd0: 2e67 6574 5f73 6c69 6365 2876 2c20 6964  .get_slice(v, id
+00007ce0: 783d 697a 292e 540a 2020 2020 2020 2020  x=iz).T.        
+00007cf0: 2020 2020 2020 2020 6966 206d 6173 6b5f          if mask_
+00007d00: 736c 6963 652e 6d61 7828 2920 3c20 302e  slice.max() < 0.
+00007d10: 353a 0a20 2020 2020 2020 2020 2020 2020  5:.             
+00007d20: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00007d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007d40: 2070 6f69 6e74 7320 3d20 7365 6c66 2e6d   points = self.m
+00007d50: 6173 6b5f 746f 5f63 6f6e 746f 7572 7328  ask_to_contours(
+00007d60: 6d61 736b 5f73 6c69 6365 2c20 7629 0a20  mask_slice, v). 
+00007d70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00007d80: 6620 706f 696e 7473 3a0a 2020 2020 2020  f points:.      
+00007d90: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00007da0: 6c66 2e63 6f6e 746f 7572 735b 765d 5b73  lf.contours[v][s
+00007db0: 656c 662e 6964 785f 746f 5f70 6f73 2869  elf.idx_to_pos(i
+00007dc0: 7a2c 207a 5f61 7829 5d20 3d20 706f 696e  z, z_ax)] = poin
+00007dd0: 7473 0a0a 2020 2020 6465 6620 6d61 736b  ts..    def mask
+00007de0: 5f74 6f5f 636f 6e74 6f75 7273 2873 656c  _to_contours(sel
+00007df0: 662c 206d 6173 6b2c 2076 6965 772c 2069  f, mask, view, i
+00007e00: 6e76 6572 743d 4661 6c73 6529 3a0a 2020  nvert=False):.  
+00007e10: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
+00007e20: 636f 6e74 6f75 7273 2066 726f 6d20 6120  contours from a 
+00007e30: 6d61 736b 2e22 2222 0a0a 2020 2020 2020  mask."""..      
+00007e40: 2020 636f 6e74 6f75 7273 203d 2073 6b69    contours = ski
+00007e50: 6d61 6765 2e6d 6561 7375 7265 2e66 696e  mage.measure.fin
+00007e60: 645f 636f 6e74 6f75 7273 286d 6173 6b2c  d_contours(mask,
+00007e70: 2030 2e35 2c20 226c 6f77 222c 2022 6c6f   0.5, "low", "lo
+00007e80: 7722 290a 0a20 2020 2020 2020 2023 2043  w")..        # C
+00007e90: 6f6e 7665 7274 2069 6e64 6963 6573 2074  onvert indices t
+00007ea0: 6f20 706f 7369 7469 6f6e 7320 696e 206d  o positions in m
+00007eb0: 6d0a 2020 2020 2020 2020 785f 6178 2c20  m.        x_ax, 
+00007ec0: 795f 6178 203d 2073 6b72 742e 696d 6167  y_ax = skrt.imag
+00007ed0: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
+00007ee0: 775d 0a20 2020 2020 2020 2070 6f69 6e74  w].        point
+00007ef0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+00007f00: 6f72 2063 6f6e 746f 7572 2069 6e20 636f  or contour in co
+00007f10: 6e74 6f75 7273 3a0a 2020 2020 2020 2020  ntours:.        
+00007f20: 2020 2020 636f 6e74 6f75 725f 706f 696e      contour_poin
+00007f30: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+00007f40: 2020 2020 666f 7220 6978 2c20 6979 2069      for ix, iy i
+00007f50: 6e20 636f 6e74 6f75 723a 0a20 2020 2020  n contour:.     
+00007f60: 2020 2020 2020 2020 2020 2070 7820 3d20             px = 
+00007f70: 7365 6c66 2e69 6478 5f74 6f5f 706f 7328  self.idx_to_pos(
+00007f80: 6978 2c20 785f 6178 290a 2020 2020 2020  ix, x_ax).      
+00007f90: 2020 2020 2020 2020 2020 7079 203d 2073            py = s
+00007fa0: 656c 662e 6964 785f 746f 5f70 6f73 2869  elf.idx_to_pos(i
+00007fb0: 792c 2079 5f61 7829 0a20 2020 2020 2020  y, y_ax).       
+00007fc0: 2020 2020 2020 2020 2069 6620 696e 7665           if inve
+00007fd0: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
+00007fe0: 2020 2020 2020 2020 7078 2c20 7079 203d          px, py =
+00007ff0: 2070 792c 2070 780a 2020 2020 2020 2020   py, px.        
+00008000: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
+00008010: 706f 696e 7473 2e61 7070 656e 6428 5b70  points.append([p
+00008020: 782c 2070 795d 290a 2020 2020 2020 2020  x, py]).        
+00008030: 2020 2020 706f 696e 7473 2e61 7070 656e      points.appen
+00008040: 6428 6e70 2e61 7272 6179 2863 6f6e 746f  d(np.array(conto
+00008050: 7572 5f70 6f69 6e74 7329 290a 0a20 2020  ur_points))..   
+00008060: 2020 2020 2072 6574 7572 6e20 706f 696e       return poin
+00008070: 7473 0a0a 2020 2020 6465 6620 6372 6561  ts..    def crea
+00008080: 7465 5f6d 6173 6b28 0a20 2020 2020 2020  te_mask(.       
+00008090: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
+000080a0: 666f 7263 653d 4661 6c73 652c 200a 2020  force=False, .  
+000080b0: 2020 2020 2020 6f76 6572 6c61 705f 6c65        overlap_le
+000080c0: 7665 6c3d 4e6f 6e65 2c20 0a20 2020 2020  vel=None, .     
+000080d0: 2020 2076 6f78 656c 5f73 697a 653d 4e6f     voxel_size=No
+000080e0: 6e65 2c20 0a20 2020 2020 2020 2073 6861  ne, .        sha
+000080f0: 7065 3d4e 6f6e 650a 2020 2020 293a 0a20  pe=None.    ):. 
+00008100: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
+00008110: 2062 696e 6172 7920 6d61 736b 2072 6570   binary mask rep
+00008120: 7265 7365 6e74 6174 696f 6e20 6f66 2074  resentation of t
+00008130: 6869 7320 524f 492e 2049 6620 7468 6520  his ROI. If the 
+00008140: 524f 4920 7761 7320 6372 6561 7465 640a  ROI was created.
+00008150: 2020 2020 2020 2020 6672 6f6d 2063 6f6e          from con
+00008160: 746f 7572 732c 2074 6865 7365 2063 6f6e  tours, these con
+00008170: 746f 7572 7320 7769 6c6c 2062 6520 636f  tours will be co
+00008180: 6e76 6572 7465 6420 746f 2061 206d 6173  nverted to a mas
+00008190: 6b3b 2069 6620 7468 6520 524f 490a 2020  k; if the ROI.  
+000081a0: 2020 2020 2020 7761 7320 6372 6561 7465        was create
+000081b0: 6420 6672 6f6d 2061 206d 6173 6b2c 2074  d from a mask, t
+000081c0: 6869 7320 6d61 736b 2077 696c 6c20 6265  his mask will be
+000081d0: 2063 6173 7420 746f 2061 2062 6f6f 6c65   cast to a boole
+000081e0: 616e 2061 7272 6179 2061 6e64 0a20 2020  an array and.   
+000081f0: 2020 2020 2069 7473 2067 656f 656d 7472       its geoemtr
+00008200: 6963 2070 726f 7065 7274 6965 7320 7769  ic properties wi
+00008210: 6c6c 2062 6520 6173 7369 676e 6564 2074  ll be assigned t
+00008220: 6f20 7468 6973 2052 4f49 2e20 4966 2061  o this ROI. If a
+00008230: 206d 6173 6b20 6861 7320 0a20 2020 2020   mask has .     
+00008240: 2020 2061 6c72 6561 6479 2062 6565 6e20     already been 
+00008250: 6372 6561 7465 642c 206e 6f74 6869 6e67  created, nothing
+00008260: 2077 696c 6c20 6861 7070 656e 2075 6e6c   will happen unl
+00008270: 6573 7320 666f 7263 653d 5472 7565 2e0a  ess force=True..
+00008280: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+00008290: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+000082a0: 200a 2020 2020 2020 2020 666f 7263 6520   .        force 
+000082b0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+000082c0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000082d0: 2020 4966 2054 7275 652c 2074 6865 206d    If True, the m
+000082e0: 6173 6b20 7769 6c6c 2062 6520 7265 6372  ask will be recr
+000082f0: 6561 7465 6420 6576 656e 2069 6620 6974  eated even if it
+00008300: 2061 6c72 6561 6479 2065 7869 7374 732e   already exists.
+00008310: 0a0a 2020 2020 2020 2020 6f76 6572 6c61  ..        overla
+00008320: 705f 6c65 7665 6c20 3a20 666c 6f61 742c  p_level : float,
+00008330: 2064 6566 6175 6c74 3d30 2e32 350a 2020   default=0.25.  
+00008340: 2020 2020 2020 2020 2020 5265 7175 6972            Requir
+00008350: 6564 206f 7665 726c 6170 206f 6620 6120  ed overlap of a 
+00008360: 7069 7865 6c20 7769 7468 2074 6865 2052  pixel with the R
+00008370: 4f49 2063 6f6e 746f 7572 2069 6e20 6f72  OI contour in or
+00008380: 6465 7220 666f 7220 7468 6520 0a20 2020  der for the .   
+00008390: 2020 2020 2020 2020 2070 6978 656c 2074           pixel t
+000083a0: 6f20 6265 2061 6464 6564 2074 6f20 7468  o be added to th
+000083b0: 6520 6d61 736b 2e20 4966 204e 6f6e 652c  e mask. If None,
+000083c0: 2074 6865 2076 616c 7565 206f 660a 2020   the value of.  
+000083d0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+000083e0: 7665 726c 6170 5f6c 6576 656c 2077 696c  verlap_level wil
+000083f0: 6c20 6265 2075 7365 643b 206f 7468 6572  l be used; other
+00008400: 7769 7365 2c0a 2020 2020 2020 2020 2020  wise,.          
+00008410: 2020 7365 6c66 2e6f 7665 726c 6170 5f6c    self.overlap_l
+00008420: 6576 656c 2077 696c 6c20 6265 206f 7665  evel will be ove
+00008430: 7277 7269 7474 656e 2077 6974 6820 7468  rwritten with th
+00008440: 6973 2076 616c 7565 2e20 4966 2062 6f74  is value. If bot
+00008450: 6820 6172 6520 0a20 2020 2020 2020 2020  h are .         
+00008460: 2020 204e 6f6e 652c 2074 6865 206f 7574     None, the out
+00008470: 7075 7420 6f66 2073 6b69 6d61 6765 2e64  put of skimage.d
+00008480: 7261 772e 706f 6c79 676f 6e32 6d61 736b  raw.polygon2mask
+00008490: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+000084a0: 6420 0a20 2020 2020 2020 2020 2020 2077  d .            w
+000084b0: 6974 6820 6e6f 2062 6f72 6465 7220 6368  ith no border ch
+000084c0: 6563 6b73 2c20 7768 6963 6820 6973 2066  ecks, which is f
+000084d0: 6173 7465 7220 7468 616e 2070 6572 666f  aster than perfo
+000084e0: 726d 696e 6720 626f 7264 6572 2063 6865  rming border che
+000084f0: 636b 732e 0a0a 2020 2020 2020 2020 766f  cks...        vo
+00008500: 7865 6c5f 7369 7a65 203a 206c 6973 742c  xel_size : list,
+00008510: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00008520: 2020 2020 2020 2020 2020 566f 7865 6c20            Voxel 
+00008530: 7369 7a65 7320 6f66 2074 6865 2064 6573  sizes of the des
+00008540: 6972 6564 206d 6173 6b20 696e 2074 6865  ired mask in the
+00008550: 205b 782c 2079 5d20 6469 7265 6374 696f   [x, y] directio
+00008560: 6e2e 204f 6e6c 7920 7573 6564 2069 6620  n. Only used if 
+00008570: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00008580: 2052 4f49 2077 6173 2063 7265 6174 6564   ROI was created
+00008590: 2066 726f 6d20 636f 6e74 6f75 7273 3b20   from contours; 
+000085a0: 6967 6e6f 7265 6420 6966 2052 4f49 2077  ignored if ROI w
+000085b0: 6173 2063 7265 6174 6564 2066 726f 6d20  as created from 
+000085c0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+000085d0: 6b2e 2043 6175 7365 7320 7365 6c66 2e69  k. Causes self.i
+000085e0: 6d61 6765 2074 6f20 6265 2072 6570 6c61  mage to be repla
+000085f0: 6365 6420 7769 7468 2061 200a 2020 2020  ced with a .    
+00008600: 2020 2020 2020 2020 626c 616e 6b20 6475          blank du
+00008610: 6d6d 7920 696d 6167 6520 7769 7468 2074  mmy image with t
+00008620: 6865 7365 2076 6f78 656c 2073 697a 6573  hese voxel sizes
+00008630: 2e0a 0a20 2020 2020 2020 2073 6861 7065  ...        shape
+00008640: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
+00008650: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00008660: 2020 5368 6170 6520 6f66 2074 6865 2064    Shape of the d
+00008670: 6573 6972 6564 206d 6173 6b20 696e 2074  esired mask in t
+00008680: 6865 205b 782c 2079 5d20 6469 7265 6374  he [x, y] direct
+00008690: 696f 6e2e 204f 6e6c 7920 7573 6564 2069  ion. Only used i
+000086a0: 6620 0a20 2020 2020 2020 2020 2020 203c  f .            <
+000086b0: 766f 7865 6c5f 7369 7a65 3e20 6973 204e  voxel_size> is N
+000086c0: 6f6e 6520 616e 6420 7468 6520 524f 4920  one and the ROI 
+000086d0: 7761 7320 6372 6561 7465 6420 6672 6f6d  was created from
+000086e0: 2063 6f6e 746f 7572 733b 200a 2020 2020   contours; .    
+000086f0: 2020 2020 2020 2020 6967 6e6f 7265 6420          ignored 
+00008700: 6966 2052 4f49 2077 6173 2063 7265 6174  if ROI was creat
+00008710: 6564 2066 726f 6d20 6d61 736b 2e20 4361  ed from mask. Ca
+00008720: 7573 6573 2073 656c 662e 696d 6167 6520  uses self.image 
+00008730: 746f 2062 6520 0a20 2020 2020 2020 2020  to be .         
+00008740: 2020 2072 6570 6c61 6365 6420 7769 7468     replaced with
+00008750: 2061 2062 6c61 6e6b 2064 756d 6d79 2069   a blank dummy i
+00008760: 6d61 6765 206f 6620 7468 6973 2073 6861  mage of this sha
+00008770: 7065 2e0a 2020 2020 2020 2020 2222 220a  pe..        """.
+00008780: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008790: 2e6c 6f61 6465 645f 6d61 736b 2061 6e64  .loaded_mask and
+000087a0: 206e 6f74 2066 6f72 6365 3a0a 2020 2020   not force:.    
+000087b0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+000087c0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+000087d0: 656c 662e 6c6f 6164 6564 3a0a 2020 2020  elf.loaded:.    
+000087e0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+000087f0: 6428 290a 2020 2020 2020 2020 6966 206f  d().        if o
+00008800: 7665 726c 6170 5f6c 6576 656c 2069 7320  verlap_level is 
+00008810: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00008820: 2020 2020 2020 7365 6c66 2e6f 7665 726c        self.overl
+00008830: 6170 5f6c 6576 656c 203d 206f 7665 726c  ap_level = overl
+00008840: 6170 5f6c 6576 656c 0a0a 2020 2020 2020  ap_level..      
+00008850: 2020 2320 5365 7420 696d 6167 6520 746f    # Set image to
+00008860: 2064 756d 6d79 2069 6d61 6765 2069 6620   dummy image if 
+00008870: 6e65 6564 6564 0a20 2020 2020 2020 2069  needed.        i
+00008880: 6620 2866 6f72 6365 2061 6e64 2028 7368  f (force and (sh
+00008890: 6170 6520 6973 206e 6f74 204e 6f6e 6520  ape is not None 
+000088a0: 6f72 2076 6f78 656c 5f73 697a 6520 6973  or voxel_size is
+000088b0: 206e 6f74 204e 6f6e 6529 2920 5c0a 2020   not None)) \.  
+000088c0: 2020 2020 2020 2020 206f 7220 2873 656c           or (sel
+000088d0: 662e 636f 6e74 6f75 7273 5f6f 6e6c 7920  f.contours_only 
+000088e0: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
+000088f0: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
+00008900: 2020 2020 2073 656c 662e 7365 745f 696d       self.set_im
+00008910: 6167 655f 746f 5f64 756d 6d79 2873 6861  age_to_dummy(sha
+00008920: 7065 3d73 6861 7065 2c20 766f 7865 6c5f  pe=shape, voxel_
+00008930: 7369 7a65 3d76 6f78 656c 5f73 697a 6529  size=voxel_size)
+00008940: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
+00008950: 7465 206d 6173 6b20 6672 6f6d 2069 6e70  te mask from inp
+00008960: 7574 2078 2d79 2063 6f6e 746f 7572 7320  ut x-y contours 
+00008970: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008980: 2e69 6e70 7574 5f63 6f6e 746f 7572 733a  .input_contours:
+00008990: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000089a0: 496e 6974 6961 6c69 7365 2073 656c 662e  Initialise self.
+000089b0: 6d61 736b 2061 7320 696d 6167 650a 2020  mask as image.  
+000089c0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+000089d0: 6173 6b20 3d20 736b 7274 2e69 6d61 6765  ask = skrt.image
+000089e0: 2e49 6d61 6765 280a 2020 2020 2020 2020  .Image(.        
+000089f0: 2020 2020 2020 2020 6e70 2e7a 6572 6f73          np.zeros
+00008a00: 2828 7365 6c66 2e73 6861 7065 5b31 5d2c  ((self.shape[1],
+00008a10: 2073 656c 662e 7368 6170 655b 305d 2c20   self.shape[0], 
+00008a20: 7365 6c66 2e73 6861 7065 5b32 5d29 2c0a  self.shape[2]),.
+00008a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a40: 2020 2020 6474 7970 653d 626f 6f6c 292c      dtype=bool),
+00008a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008a60: 2061 6666 696e 653d 7365 6c66 2e61 6666   affine=self.aff
+00008a70: 696e 652c 200a 2020 2020 2020 2020 2020  ine, .          
+00008a80: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00008a90: 3d73 656c 662e 766f 7865 6c5f 7369 7a65  =self.voxel_size
+00008aa0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008ab0: 2020 6f72 6967 696e 3d73 656c 662e 6f72    origin=self.or
+00008ac0: 6967 696e 0a20 2020 2020 2020 2020 2020  igin.           
+00008ad0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00008ae0: 2320 4372 6561 7465 206d 6173 6b20 6f6e  # Create mask on
+00008af0: 2065 6163 6820 7a20 6c61 7965 720a 2020   each z layer.  
+00008b00: 2020 2020 2020 2020 2020 666f 7220 7a2c            for z,
+00008b10: 2063 6f6e 746f 7572 7320 696e 2073 656c   contours in sel
+00008b20: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
+00008b30: 2e69 7465 6d73 2829 3a0a 0a20 2020 2020  .items():..     
+00008b40: 2020 2020 2020 2020 2020 2023 204c 6f6f             # Loo
+00008b50: 7020 6f76 6572 2065 6163 6820 636f 6e74  p over each cont
+00008b60: 6f75 7220 6f6e 2074 6865 207a 2073 6c69  our on the z sli
+00008b70: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+00008b80: 2020 2069 7a20 3d20 696e 7428 7365 6c66     iz = int(self
+00008b90: 2e70 6f73 5f74 6f5f 6964 7828 7a2c 2022  .pos_to_idx(z, "
+00008ba0: 7a22 2929 0a20 2020 2020 2020 2020 2020  z")).           
+00008bb0: 2020 2020 2069 6620 697a 203e 3d20 7365       if iz >= se
+00008bc0: 6c66 2e6d 6173 6b2e 6461 7461 2e73 6861  lf.mask.data.sha
+00008bd0: 7065 5b32 5d3a 2020 2320 4967 6e6f 7265  pe[2]:  # Ignore
+00008be0: 2073 6c69 6365 7320 6f75 7473 6964 6520   slices outside 
+00008bf0: 6d61 736b 2072 616e 6765 0a20 2020 2020  mask range.     
+00008c00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00008c10: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
+00008c20: 2020 2020 2020 2020 2070 6f73 5f74 6f5f           pos_to_
+00008c30: 6964 785f 7665 6320 3d20 6e70 2e76 6563  idx_vec = np.vec
+00008c40: 746f 7269 7a65 2873 656c 662e 706f 735f  torize(self.pos_
+00008c50: 746f 5f69 6478 290a 2020 2020 2020 2020  to_idx).        
+00008c60: 2020 2020 2020 2020 666f 7220 706f 696e          for poin
+00008c70: 7473 2069 6e20 636f 6e74 6f75 7273 3a0a  ts in contours:.
+00008c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008c90: 2020 2020 2023 2052 6571 7569 7265 2061       # Require a
+00008ca0: 7420 6c65 6173 7420 3320 706f 696e 7473  t least 3 points
+00008cb0: 2074 6f20 6465 6669 6e65 2061 2070 6f6c   to define a pol
+00008cc0: 7967 6f6e 2e0a 2020 2020 2020 2020 2020  ygon..          
+00008cd0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00008ce0: 2870 6f69 6e74 7329 203c 2033 3a0a 2020  (points) < 3:.  
 00008cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d00: 2020 2020 2320 436f 6e76 6572 7420 2878      # Convert (x
-00008d10: 2c20 7929 2070 6f73 6974 696f 6e73 2074  , y) positions t
-00008d20: 6f20 6172 7261 7920 696e 6469 6365 730a  o array indices.
-00008d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d40: 2020 2020 706f 696e 7473 5f69 6478 203d      points_idx =
-00008d50: 206e 702e 7a65 726f 7328 2870 6f69 6e74   np.zeros((point
-00008d60: 732e 7368 6170 655b 305d 2c20 3229 290a  s.shape[0], 2)).
-00008d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d80: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-00008d90: 6765 2832 293a 0a20 2020 2020 2020 2020  ge(2):.         
-00008da0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008db0: 6f69 6e74 735f 6964 785b 3a2c 2069 5d20  oints_idx[:, i] 
-00008dc0: 3d20 706f 735f 746f 5f69 6478 5f76 6563  = pos_to_idx_vec
-00008dd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00008de0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00008df0: 696e 7473 5b3a 2c20 695d 2c20 692c 2072  ints[:, i], i, r
-00008e00: 6574 7572 6e5f 696e 743d 4661 6c73 650a  eturn_int=False.
-00008e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e20: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00008e30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00008e40: 2043 7265 6174 6520 706f 6c79 676f 6e20   Create polygon 
-00008e50: 696e 2069 6e64 6578 2073 7061 6365 0a20  in index space. 
-00008e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e70: 2020 2070 6f6c 7967 6f6e 203d 2063 6f6e     polygon = con
-00008e80: 746f 7572 5f74 6f5f 706f 6c79 676f 6e28  tour_to_polygon(
-00008e90: 706f 696e 7473 5f69 6478 290a 0a20 2020  points_idx)..   
-00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008eb0: 2023 2047 6574 206d 6173 6b20 6f66 2061   # Get mask of a
-00008ec0: 6c6c 2070 6978 656c 7320 696e 7369 6465  ll pixels inside
-00008ed0: 2063 6f6e 746f 7572 0a20 2020 2020 2020   contour.       
-00008ee0: 2020 2020 2020 2020 2020 2020 206d 6173               mas
-00008ef0: 6b20 3d20 6472 6177 2e70 6f6c 7967 6f6e  k = draw.polygon
-00008f00: 326d 6173 6b28 5b73 656c 662e 6d61 736b  2mask([self.mask
-00008f10: 2e64 6174 612e 7368 6170 655b 315d 2c20  .data.shape[1], 
-00008f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00008f50: 6c66 2e6d 6173 6b2e 6461 7461 2e73 6861  lf.mask.data.sha
-00008f60: 7065 5b30 5d5d 2c0a 2020 2020 2020 2020  pe[0]],.        
-00008f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f90: 2020 2020 2070 6f69 6e74 735f 6964 7829       points_idx)
-00008fa0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008fb0: 2020 2020 2020 2320 4966 206e 6f20 7069        # If no pi
-00008fc0: 7865 6c20 6964 656e 7469 6669 6564 2061  xel identified a
-00008fd0: 7320 6265 696e 6720 696e 7369 6465 2063  s being inside c
-00008fe0: 6f6e 746f 7572 2c0a 2020 2020 2020 2020  ontour,.        
-00008ff0: 2020 2020 2020 2020 2020 2020 2320 6c61              # la
-00009000: 6265 6c20 7069 7865 6c20 636f 6e74 6169  bel pixel contai
-00009010: 6e69 6e67 2063 6f6e 746f 7572 2063 656e  ning contour cen
-00009020: 7472 6f69 642e 0a20 2020 2020 2020 2020  troid..         
-00009030: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00009040: 7420 6d61 736b 2e73 756d 2829 3a0a 2020  t mask.sum():.  
-00009050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009060: 2020 2020 2020 6978 2c20 6979 203d 205b        ix, iy = [
-00009070: 696e 7428 726f 756e 6428 7879 5b30 5d29  int(round(xy[0])
-00009080: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000090a0: 2020 666f 7220 7879 2069 6e20 706f 6c79    for xy in poly
-000090b0: 676f 6e2e 6365 6e74 726f 6964 2e78 795d  gon.centroid.xy]
-000090c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000090d0: 2020 2020 2020 2020 2069 6620 2828 6978           if ((ix
-000090e0: 203e 3d20 3020 616e 6420 6978 203c 206d   >= 0 and ix < m
-000090f0: 6173 6b2e 7368 6170 655b 305d 290a 2020  ask.shape[0]).  
-00009100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009110: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00009120: 6420 2869 7920 3e3d 2030 2061 6e64 2069  d (iy >= 0 and i
-00009130: 7920 3c20 6d61 736b 2e73 6861 7065 5b31  y < mask.shape[1
-00009140: 5d29 293a 0a20 2020 2020 2020 2020 2020  ])):.           
-00009150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009160: 206d 6173 6b5b 6978 2c20 6979 5d20 3d20   mask[ix, iy] = 
-00009170: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
-00009180: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-00009190: 6b20 6f76 6572 6c61 7020 6f66 2065 6467  k overlap of edg
-000091a0: 6520 7069 7865 6c73 0a20 2020 2020 2020  e pixels.       
-000091b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000091c0: 7365 6c66 2e6f 7665 726c 6170 5f6c 6576  self.overlap_lev
-000091d0: 656c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  el is not None:.
-000091e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091f0: 2020 2020 2020 2020 636f 6e6e 203d 206e          conn = n
-00009200: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
-00009210: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
-00009220: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00009230: 2020 2020 2020 2020 2020 2020 2020 322c                2,
-00009240: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-00009250: 2020 2020 2020 2020 2020 2020 6564 6765              edge
-00009260: 203d 206d 6173 6b20 5e20 6e64 696d 6167   = mask ^ ndimag
-00009270: 652e 6269 6e61 7279 5f64 696c 6174 696f  e.binary_dilatio
-00009280: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00009290: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000092a0: 6173 6b2c 2063 6f6e 6e29 0a20 2020 2020  ask, conn).     
-000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092c0: 2020 2069 6620 7365 6c66 2e6f 7665 726c     if self.overl
-000092d0: 6170 5f6c 6576 656c 203e 3d20 302e 353a  ap_level >= 0.5:
-000092e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000092f0: 2020 2020 2020 2020 2020 2020 2065 6467               edg
-00009300: 6520 2b3d 206d 6173 6b20 5e20 6e64 696d  e += mask ^ ndim
-00009310: 6167 652e 6269 6e61 7279 5f65 726f 7369  age.binary_erosi
-00009320: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00009330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009340: 2020 2020 6d61 736b 2c20 636f 6e6e 290a      mask, conn).
-00009350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009360: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
-00009370: 2077 6865 7468 6572 2065 6163 6820 6564   whether each ed
-00009380: 6765 2070 6978 656c 2068 6173 2073 7566  ge pixel has suf
-00009390: 6669 6369 656e 7420 6f76 6572 6c61 700a  ficient overlap.
-000093a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093b0: 2020 2020 2020 2020 666f 7220 6978 2c20          for ix, 
-000093c0: 6979 2069 6e20 6e70 2e61 7267 7768 6572  iy in np.argwher
-000093d0: 6528 6564 6765 293a 0a0a 2020 2020 2020  e(edge):..      
-000093e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093f0: 2020 2020 2020 2320 4d61 6b65 2070 6f6c        # Make pol
-00009400: 7967 6f6e 206f 6620 6375 7272 656e 7420  ygon of current 
-00009410: 7069 7865 6c0a 2020 2020 2020 2020 2020  pixel.          
-00009420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009430: 2020 7069 7865 6c20 3d20 6765 6f6d 6574    pixel = geomet
-00009440: 7279 2e50 6f6c 7967 6f6e 280a 2020 2020  ry.Polygon(.    
-00009450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009460: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
+00008d00: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+00008d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d20: 2020 2020 2320 436f 6e76 6572 7420 2878      # Convert (x
+00008d30: 2c20 7929 2070 6f73 6974 696f 6e73 2074  , y) positions t
+00008d40: 6f20 6172 7261 7920 696e 6469 6365 730a  o array indices.
+00008d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d60: 2020 2020 706f 696e 7473 5f69 6478 203d      points_idx =
+00008d70: 206e 702e 7a65 726f 7328 2870 6f69 6e74   np.zeros((point
+00008d80: 732e 7368 6170 655b 305d 2c20 3229 290a  s.shape[0], 2)).
+00008d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008da0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00008db0: 6765 2832 293a 0a20 2020 2020 2020 2020  ge(2):.         
+00008dc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00008dd0: 6f69 6e74 735f 6964 785b 3a2c 2069 5d20  oints_idx[:, i] 
+00008de0: 3d20 706f 735f 746f 5f69 6478 5f76 6563  = pos_to_idx_vec
+00008df0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008e00: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00008e10: 696e 7473 5b3a 2c20 695d 2c20 692c 2072  ints[:, i], i, r
+00008e20: 6574 7572 6e5f 696e 743d 4661 6c73 650a  eturn_int=False.
+00008e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e40: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00008e50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00008e60: 2043 7265 6174 6520 706f 6c79 676f 6e20   Create polygon 
+00008e70: 696e 2069 6e64 6578 2073 7061 6365 0a20  in index space. 
+00008e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e90: 2020 2070 6f6c 7967 6f6e 203d 2063 6f6e     polygon = con
+00008ea0: 746f 7572 5f74 6f5f 706f 6c79 676f 6e28  tour_to_polygon(
+00008eb0: 706f 696e 7473 5f69 6478 290a 0a20 2020  points_idx)..   
+00008ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ed0: 2023 2047 6574 206d 6173 6b20 6f66 2061   # Get mask of a
+00008ee0: 6c6c 2070 6978 656c 7320 696e 7369 6465  ll pixels inside
+00008ef0: 2063 6f6e 746f 7572 0a20 2020 2020 2020   contour.       
+00008f00: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+00008f10: 6b20 3d20 6472 6177 2e70 6f6c 7967 6f6e  k = draw.polygon
+00008f20: 326d 6173 6b28 5b73 656c 662e 6d61 736b  2mask([self.mask
+00008f30: 2e64 6174 612e 7368 6170 655b 315d 2c20  .data.shape[1], 
+00008f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f60: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008f70: 6c66 2e6d 6173 6b2e 6461 7461 2e73 6861  lf.mask.data.sha
+00008f80: 7065 5b30 5d5d 2c0a 2020 2020 2020 2020  pe[0]],.        
+00008f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fb0: 2020 2020 2070 6f69 6e74 735f 6964 7829       points_idx)
+00008fc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008fd0: 2020 2020 2020 2320 4966 206e 6f20 7069        # If no pi
+00008fe0: 7865 6c20 6964 656e 7469 6669 6564 2061  xel identified a
+00008ff0: 7320 6265 696e 6720 696e 7369 6465 2063  s being inside c
+00009000: 6f6e 746f 7572 2c0a 2020 2020 2020 2020  ontour,.        
+00009010: 2020 2020 2020 2020 2020 2020 2320 6c61              # la
+00009020: 6265 6c20 7069 7865 6c20 636f 6e74 6169  bel pixel contai
+00009030: 6e69 6e67 2063 6f6e 746f 7572 2063 656e  ning contour cen
+00009040: 7472 6f69 642e 0a20 2020 2020 2020 2020  troid..         
+00009050: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00009060: 7420 6d61 736b 2e73 756d 2829 3a0a 2020  t mask.sum():.  
+00009070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009080: 2020 2020 2020 6978 2c20 6979 203d 205b        ix, iy = [
+00009090: 696e 7428 726f 756e 6428 7879 5b30 5d29  int(round(xy[0])
+000090a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000090b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090c0: 2020 666f 7220 7879 2069 6e20 706f 6c79    for xy in poly
+000090d0: 676f 6e2e 6365 6e74 726f 6964 2e78 795d  gon.centroid.xy]
+000090e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000090f0: 2020 2020 2020 2020 2069 6620 2828 6978           if ((ix
+00009100: 203e 3d20 3020 616e 6420 6978 203c 206d   >= 0 and ix < m
+00009110: 6173 6b2e 7368 6170 655b 305d 290a 2020  ask.shape[0]).  
+00009120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009130: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00009140: 6420 2869 7920 3e3d 2030 2061 6e64 2069  d (iy >= 0 and i
+00009150: 7920 3c20 6d61 736b 2e73 6861 7065 5b31  y < mask.shape[1
+00009160: 5d29 293a 0a20 2020 2020 2020 2020 2020  ])):.           
+00009170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009180: 206d 6173 6b5b 6978 2c20 6979 5d20 3d20   mask[ix, iy] = 
+00009190: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
+000091a0: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
+000091b0: 6b20 6f76 6572 6c61 7020 6f66 2065 6467  k overlap of edg
+000091c0: 6520 7069 7865 6c73 0a20 2020 2020 2020  e pixels.       
+000091d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000091e0: 7365 6c66 2e6f 7665 726c 6170 5f6c 6576  self.overlap_lev
+000091f0: 656c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  el is not None:.
+00009200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009210: 2020 2020 2020 2020 636f 6e6e 203d 206e          conn = n
+00009220: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
+00009230: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
+00009240: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009250: 2020 2020 2020 2020 2020 2020 2020 322c                2,
+00009260: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00009270: 2020 2020 2020 2020 2020 2020 6564 6765              edge
+00009280: 203d 206d 6173 6b20 5e20 6e64 696d 6167   = mask ^ ndimag
+00009290: 652e 6269 6e61 7279 5f64 696c 6174 696f  e.binary_dilatio
+000092a0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+000092b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000092c0: 6173 6b2c 2063 6f6e 6e29 0a20 2020 2020  ask, conn).     
+000092d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092e0: 2020 2069 6620 7365 6c66 2e6f 7665 726c     if self.overl
+000092f0: 6170 5f6c 6576 656c 203e 3d20 302e 353a  ap_level >= 0.5:
+00009300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009310: 2020 2020 2020 2020 2020 2020 2065 6467               edg
+00009320: 6520 2b3d 206d 6173 6b20 5e20 6e64 696d  e += mask ^ ndim
+00009330: 6167 652e 6269 6e61 7279 5f65 726f 7369  age.binary_erosi
+00009340: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00009350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009360: 2020 2020 6d61 736b 2c20 636f 6e6e 290a      mask, conn).
+00009370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009380: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+00009390: 2077 6865 7468 6572 2065 6163 6820 6564   whether each ed
+000093a0: 6765 2070 6978 656c 2068 6173 2073 7566  ge pixel has suf
+000093b0: 6669 6369 656e 7420 6f76 6572 6c61 700a  ficient overlap.
+000093c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093d0: 2020 2020 2020 2020 666f 7220 6978 2c20          for ix, 
+000093e0: 6979 2069 6e20 6e70 2e61 7267 7768 6572  iy in np.argwher
+000093f0: 6528 6564 6765 293a 0a0a 2020 2020 2020  e(edge):..      
+00009400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009410: 2020 2020 2020 2320 4d61 6b65 2070 6f6c        # Make pol
+00009420: 7967 6f6e 206f 6620 6375 7272 656e 7420  ygon of current 
+00009430: 7069 7865 6c0a 2020 2020 2020 2020 2020  pixel.          
+00009440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009450: 2020 7069 7865 6c20 3d20 6765 6f6d 6574    pixel = geomet
+00009460: 7279 2e50 6f6c 7967 6f6e 280a 2020 2020  ry.Polygon(.    
 00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009490: 2020 5b69 7820 2d20 302e 352c 2069 7920    [ix - 0.5, iy 
-000094a0: 2d20 302e 355d 2c0a 2020 2020 2020 2020  - 0.5],.        
-000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094c0: 2020 2020 2020 2020 2020 2020 5b69 7820              [ix 
-000094d0: 2d20 302e 352c 2069 7920 2b20 302e 355d  - 0.5, iy + 0.5]
-000094e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009500: 2020 2020 2020 5b69 7820 2b20 302e 352c        [ix + 0.5,
-00009510: 2069 7920 2b20 302e 355d 2c0a 2020 2020   iy + 0.5],.    
-00009520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009540: 5b69 7820 2b20 302e 352c 2069 7920 2d20  [ix + 0.5, iy - 
-00009550: 302e 355d 2c0a 2020 2020 2020 2020 2020  0.5],.          
-00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009570: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00009480: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
+00009490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094b0: 2020 5b69 7820 2d20 302e 352c 2069 7920    [ix - 0.5, iy 
+000094c0: 2d20 302e 355d 2c0a 2020 2020 2020 2020  - 0.5],.        
+000094d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094e0: 2020 2020 2020 2020 2020 2020 5b69 7820              [ix 
+000094f0: 2d20 302e 352c 2069 7920 2b20 302e 355d  - 0.5, iy + 0.5]
+00009500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009520: 2020 2020 2020 5b69 7820 2b20 302e 352c        [ix + 0.5,
+00009530: 2069 7920 2b20 302e 355d 2c0a 2020 2020   iy + 0.5],.    
+00009540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009560: 5b69 7820 2b20 302e 352c 2069 7920 2d20  [ix + 0.5, iy - 
+00009570: 302e 355d 2c0a 2020 2020 2020 2020 2020  0.5],.          
 00009580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009590: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00009590: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
 000095a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095b0: 2020 2023 2043 6f6d 7075 7465 206f 7665     # Compute ove
-000095c0: 726c 6170 0a20 2020 2020 2020 2020 2020  rlap.           
-000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095e0: 206f 7665 726c 6170 203d 2070 6f6c 7967   overlap = polyg
-000095f0: 6f6e 2e69 6e74 6572 7365 6374 696f 6e28  on.intersection(
-00009600: 7069 7865 6c29 2e61 7265 610a 2020 2020  pixel).area.    
-00009610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009620: 2020 2020 2020 2020 6d61 736b 5b69 782c          mask[ix,
-00009630: 2069 795d 203d 206f 7665 726c 6170 203e   iy] = overlap >
-00009640: 2073 656c 662e 6f76 6572 6c61 705f 6c65   self.overlap_le
-00009650: 7665 6c0a 0a20 2020 2020 2020 2020 2020  vel..           
-00009660: 2020 2020 2020 2020 2023 2041 6464 2074           # Add t
-00009670: 6f20 3344 206d 6173 6b0a 2020 2020 2020  o 3D mask.      
-00009680: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00009690: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000096a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000096b0: 6d61 736b 2e64 6174 615b 3a2c 203a 2c20  mask.data[:, :, 
-000096c0: 697a 5d20 2b3d 206d 6173 6b2e 540a 2020  iz] += mask.T.  
-000096d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096e0: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
-000096f0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-00009700: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00009710: 730a 0a20 2020 2020 2020 2023 2043 6f6e  s..        # Con
-00009720: 7665 7274 2074 6f20 626f 6f6c 6561 6e20  vert to boolean 
-00009730: 6d61 736b 0a20 2020 2020 2020 2069 6620  mask.        if 
-00009740: 6861 7361 7474 7228 7365 6c66 2e6d 6173  hasattr(self.mas
-00009750: 6b2c 2022 6461 7461 2229 3a0a 2020 2020  k, "data"):.    
-00009760: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00009770: 656c 662e 6d61 736b 2e64 6174 612e 6474  elf.mask.data.dt
-00009780: 7970 6520 3d3d 2062 6f6f 6c3a 0a20 2020  ype == bool:.   
-00009790: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000097a0: 662e 6d61 736b 2e64 6174 6120 3d20 7365  f.mask.data = se
-000097b0: 6c66 2e6d 6173 6b2e 6461 7461 2e61 7374  lf.mask.data.ast
-000097c0: 7970 6528 626f 6f6c 290a 2020 2020 2020  ype(bool).      
-000097d0: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
-000097e0: 645f 6d61 736b 203d 2054 7275 650a 0a20  d_mask = True.. 
-000097f0: 2020 2020 2020 2023 2053 6574 206f 776e         # Set own
-00009800: 2067 656f 6d65 7472 6963 2070 726f 7065   geometric prope
-00009810: 7274 6965 7320 6672 6f6d 206d 6173 6b0a  rties from mask.
-00009820: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
-00009830: 656c 5f73 697a 6520 3d20 7365 6c66 2e6d  el_size = self.m
-00009840: 6173 6b2e 6765 745f 766f 7865 6c5f 7369  ask.get_voxel_si
-00009850: 7a65 2829 0a20 2020 2020 2020 2073 656c  ze().        sel
-00009860: 662e 6f72 6967 696e 203d 2073 656c 662e  f.origin = self.
-00009870: 6d61 736b 2e67 6574 5f6f 7269 6769 6e28  mask.get_origin(
-00009880: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00009890: 6666 696e 6520 3d20 7365 6c66 2e6d 6173  ffine = self.mas
-000098a0: 6b2e 6765 745f 6166 6669 6e65 2829 0a20  k.get_affine(). 
-000098b0: 2020 2020 2020 2073 656c 662e 7368 6170         self.shap
-000098c0: 6520 3d20 7365 6c66 2e6d 6173 6b2e 6765  e = self.mask.ge
-000098d0: 745f 6461 7461 2829 2e73 6861 7065 0a0a  t_data().shape..
-000098e0: 2020 2020 6465 6620 6973 5f65 6d70 7479      def is_empty
-000098f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00009900: 2222 2243 6865 636b 2077 6865 7468 6572  """Check whether
-00009910: 2074 6869 7320 524f 4920 6973 2065 6d70   this ROI is emp
-00009920: 7479 2e22 2222 0a0a 2020 2020 2020 2020  ty."""..        
-00009930: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-00009940: 2020 2020 6966 2073 656c 662e 6465 6661      if self.defa
-00009950: 756c 745f 6765 6f6d 5f6d 6574 686f 6420  ult_geom_method 
-00009960: 3d3d 2022 636f 6e74 6f75 7222 3a0a 2020  == "contour":.  
-00009970: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009980: 206e 6f74 2062 6f6f 6c28 6c65 6e28 7365   not bool(len(se
-00009990: 6c66 2e67 6574 5f63 6f6e 746f 7572 7328  lf.get_contours(
-000099a0: 2278 2d79 2229 2929 0a20 2020 2020 2020  "x-y"))).       
-000099b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000099c0: 2020 2072 6574 7572 6e20 6e6f 7420 6e70     return not np
-000099d0: 2e61 6e79 2873 656c 662e 6765 745f 6d61  .any(self.get_ma
-000099e0: 736b 2829 290a 0a20 2020 2064 6566 2072  sk())..    def r
-000099f0: 6573 616d 706c 6528 7365 6c66 2c20 2a61  esample(self, *a
-00009a00: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
-00009a10: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-00009a20: 6174 655f 6d61 736b 2829 0a20 2020 2020  ate_mask().     
-00009a30: 2020 2073 656c 662e 6d61 736b 2e72 6573     self.mask.res
-00009a40: 616d 706c 6528 2a61 7267 732c 202a 2a6b  ample(*args, **k
-00009a50: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-00009a60: 6d61 7463 685f 766f 7865 6c5f 7369 7a65  match_voxel_size
-00009a70: 2873 656c 662c 206f 7468 6572 2c20 2a61  (self, other, *a
-00009a80: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
-00009a90: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00009aa0: 7374 616e 6365 286f 7468 6572 2c20 524f  stance(other, RO
-00009ab0: 4929 3a0a 2020 2020 2020 2020 2020 2020  I):.            
-00009ac0: 6f74 6865 722e 6372 6561 7465 5f6d 6173  other.create_mas
-00009ad0: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-00009ae0: 6d61 736b 203d 206f 7468 6572 2e6d 6173  mask = other.mas
-00009af0: 6b0a 2020 2020 2020 2020 656c 7365 3a0a  k.        else:.
-00009b00: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00009b10: 203d 206f 7468 6572 0a20 2020 2020 2020   = other.       
-00009b20: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
-00009b30: 6b28 290a 2020 2020 2020 2020 7365 6c66  k().        self
-00009b40: 2e6d 6173 6b2e 6d61 7463 685f 766f 7865  .mask.match_voxe
-00009b50: 6c5f 7369 7a65 286d 6173 6b2c 202a 6172  l_size(mask, *ar
-00009b60: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
-00009b70: 2020 2064 6566 2067 6574 5f73 6c69 6365     def get_slice
-00009b80: 2873 656c 662c 202a 6172 6773 2c20 666f  (self, *args, fo
-00009b90: 7263 655f 7374 616e 6461 7264 6973 653d  rce_standardise=
-00009ba0: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
-00009bb0: 3a0a 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-00009bc0: 6372 6561 7465 5f6d 6173 6b28 290a 2020  create_mask().  
-00009bd0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
-00009be0: 662e 6d61 736b 2e67 6574 5f73 6c69 6365  f.mask.get_slice
-00009bf0: 282a 6172 6773 2c20 666f 7263 655f 7374  (*args, force_st
-00009c00: 616e 6461 7264 6973 653d 666f 7263 655f  andardise=force_
-00009c10: 7374 616e 6461 7264 6973 652c 200a 2020  standardise, .  
-00009c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c40: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-00009c50: 2020 2069 6620 6461 7461 2e64 7479 7065     if data.dtype
-00009c60: 2021 3d20 626f 6f6c 3a0a 2020 2020 2020   != bool:.      
-00009c70: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00009c80: 612e 6173 7479 7065 2862 6f6f 6c29 0a20  a.astype(bool). 
-00009c90: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-00009ca0: 7461 0a0a 2020 2020 6465 6620 6765 745f  ta..    def get_
-00009cb0: 726f 695f 736c 6963 6528 7365 6c66 2c20  roi_slice(self, 
-00009cc0: 7a5f 6672 6163 7469 6f6e 3d31 2c20 7375  z_fraction=1, su
-00009cd0: 6666 6978 3d4e 6f6e 6529 3a0a 2020 2020  ffix=None):.    
-00009ce0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00009cf0: 4765 7420 524f 4920 6f62 6a65 6374 2063  Get ROI object c
-00009d00: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
-00009d10: 782d 7920 736c 6963 6520 7468 726f 7567  x-y slice throug
-00009d20: 6820 7468 6973 2052 4f49 2e0a 0a20 2020  h this ROI...   
-00009d30: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-00009d40: 3a2a 2a0a 0a20 2020 2020 2020 207a 5f66  :**..        z_f
-00009d50: 7261 6374 696f 6e20 3a20 666c 6f61 742c  raction : float,
-00009d60: 2064 6566 6175 6c74 3d31 0a20 2020 2020   default=1.     
-00009d70: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
-00009d80: 616c 6f6e 6720 7a20 6178 6973 2061 7420  along z axis at 
-00009d90: 7768 6963 6820 746f 2074 616b 6520 736c  which to take sl
-00009da0: 6963 6520 7468 726f 7567 6820 524f 492e  ice through ROI.
-00009db0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00009dc0: 2070 6f73 6974 696f 6e20 6973 2073 7065   position is spe
-00009dd0: 6369 6669 6564 2061 7320 7468 6520 6672  cified as the fr
-00009de0: 6163 7469 6f6e 616c 2064 6973 7461 6e63  actional distanc
-00009df0: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
-00009e00: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
-00009e10: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
-00009e20: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
-00009e30: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
-00009e40: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
-00009e50: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
-00009e60: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
-00009e70: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-00009e80: 2020 2020 6d6f 7374 2d73 7570 6572 696f      most-superio
-00009e90: 7220 706f 696e 7420 2868 6967 6865 7374  r point (highest
-00009ea0: 207a 292e 2020 5661 6c75 6573 2066 6f72   z).  Values for
-00009eb0: 207a 5f66 7261 6374 696f 6e0a 2020 2020   z_fraction.    
-00009ec0: 2020 2020 2020 2020 6f75 7473 6964 6520          outside 
-00009ed0: 7468 6520 696e 7465 7276 616c 205b 302c  the interval [0,
-00009ee0: 2031 5d20 7265 7375 6c74 2069 6e20 6120   1] result in a 
-00009ef0: 5275 6e74 696d 6545 7272 6f72 2e0a 0a20  RuntimeError... 
-00009f00: 2020 2073 7566 6669 7820 3a20 7374 722c     suffix : str,
-00009f10: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00009f20: 2020 2020 2020 5375 6666 6978 2074 6f20        Suffix to 
-00009f30: 6170 7065 6e64 2074 6f20 6f77 6e20 6e61  append to own na
-00009f40: 6d65 2c20 746f 2066 6f72 6d20 6e61 6d65  me, to form name
-00009f50: 206f 6620 6f75 7470 7574 2052 4f49 2e20   of output ROI. 
-00009f60: 2049 660a 2020 2020 2020 2020 4e6f 6e65   If.        None
-00009f70: 2c20 6170 7065 6e64 207a 5f66 7261 6374  , append z_fract
-00009f80: 696f 6e2c 2077 6974 6820 7661 6c75 6520  ion, with value 
-00009f90: 6769 7665 6e20 746f 2074 776f 2064 6563  given to two dec
-00009fa0: 696d 616c 2070 6c61 6365 732e 0a20 2020  imal places..   
-00009fb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00009fc0: 2072 6574 7572 6e20 6765 745f 726f 695f   return get_roi_
-00009fd0: 736c 6963 6528 7365 6c66 2c20 7a5f 6672  slice(self, z_fr
-00009fe0: 6163 7469 6f6e 290a 0a20 2020 2064 6566  action)..    def
-00009ff0: 2067 6574 5f69 6e64 6963 6573 2873 656c   get_indices(sel
-0000a000: 662c 2076 6965 773d 2278 2d79 222c 206d  f, view="x-y", m
-0000a010: 6574 686f 643d 4e6f 6e65 293a 0a20 2020  ethod=None):.   
-0000a020: 2020 2020 2022 2222 4765 7420 6c69 7374       """Get list
-0000a030: 206f 6620 736c 6963 6520 696e 6469 6365   of slice indice
-0000a040: 7320 6f6e 2077 6869 6368 2074 6869 7320  s on which this 
-0000a050: 524f 4920 6578 6973 7473 2e22 2222 0a0a  ROI exists."""..
-0000a060: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-0000a070: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
-0000a080: 656c 662e 656d 7074 793a 0a20 2020 2020  elf.empty:.     
-0000a090: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
-0000a0a0: 0a0a 2020 2020 2020 2020 6966 206d 6574  ..        if met
-0000a0b0: 686f 6420 6973 204e 6f6e 653a 0a20 2020  hod is None:.   
-0000a0c0: 2020 2020 2020 2020 206d 6574 686f 6420           method 
-0000a0d0: 3d20 7365 6c66 2e64 6566 6175 6c74 5f67  = self.default_g
-0000a0e0: 656f 6d5f 6d65 7468 6f64 0a0a 2020 2020  eom_method..    
-0000a0f0: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
-0000a100: 2022 636f 6e74 6f75 7222 3a0a 2020 2020   "contour":.    
-0000a110: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-0000a120: 6973 7428 7365 6c66 2e67 6574 5f63 6f6e  ist(self.get_con
-0000a130: 746f 7572 7328 7669 6577 2c20 6964 785f  tours(view, idx_
-0000a140: 6173 5f6b 6579 3d54 7275 6529 2e6b 6579  as_key=True).key
-0000a150: 7328 2929 0a20 2020 2020 2020 2065 6c73  s()).        els
-0000a160: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
-0000a170: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
-0000a180: 736c 6963 655f 6178 6573 5b76 6965 775d  slice_axes[view]
-0000a190: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-0000a1a0: 6b20 3d20 7365 6c66 2e67 6574 5f6d 6173  k = self.get_mas
-0000a1b0: 6b28 7374 616e 6461 7264 6973 653d 5472  k(standardise=Tr
-0000a1c0: 7565 292e 7472 616e 7370 6f73 6528 312c  ue).transpose(1,
-0000a1d0: 2030 2c20 3229 0a20 2020 2020 2020 2020   0, 2).         
-0000a1e0: 2020 2072 6574 7572 6e20 6c69 7374 286e     return list(n
-0000a1f0: 702e 756e 6971 7565 286e 702e 6172 6777  p.unique(np.argw
-0000a200: 6865 7265 286d 6173 6b29 5b3a 2c20 6178  here(mask)[:, ax
-0000a210: 5d29 290a 0a20 2020 2064 6566 2067 6574  ]))..    def get
-0000a220: 5f6d 6964 5f69 6478 2873 656c 662c 2076  _mid_idx(self, v
-0000a230: 6965 773d 2278 2d79 222c 202a 2a6b 7761  iew="x-y", **kwa
-0000a240: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-0000a250: 2247 6574 2063 656e 7472 616c 2073 6c69  "Get central sli
-0000a260: 6365 2069 6e64 6578 206f 6620 7468 6973  ce index of this
-0000a270: 2052 4f49 2069 6e20 6120 6769 7665 6e20   ROI in a given 
-0000a280: 6f72 6965 6e74 6174 696f 6e2e 2222 220a  orientation.""".
-0000a290: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
-0000a2a0: 203d 2073 656c 662e 6765 745f 696e 6469   = self.get_indi
-0000a2b0: 6365 7328 7669 6577 2c20 2a2a 6b77 6172  ces(view, **kwar
-0000a2c0: 6773 290a 2020 2020 2020 2020 6966 206e  gs).        if n
-0000a2d0: 6f74 206c 656e 2869 6e64 6963 6573 293a  ot len(indices):
-0000a2e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000a2f0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000a300: 206d 6964 203d 2069 6e74 286c 656e 2869   mid = int(len(i
-0000a310: 6e64 6963 6573 2920 2f20 3229 0a20 2020  ndices) / 2).   
-0000a320: 2020 2020 2072 6574 7572 6e20 696e 6469       return indi
-0000a330: 6365 735b 6d69 645d 0a0a 2020 2020 6465  ces[mid]..    de
-0000a340: 6620 6964 785f 746f 5f70 6f73 2873 656c  f idx_to_pos(sel
-0000a350: 662c 2069 6478 2c20 6178 2c20 7374 616e  f, idx, ax, stan
-0000a360: 6461 7264 6973 653d 5472 7565 293a 0a20  dardise=True):. 
-0000a370: 2020 2020 2020 2022 2222 436f 6e76 6572         """Conver
-0000a380: 7420 616e 2061 7272 6179 2069 6e64 6578  t an array index
-0000a390: 2074 6f20 6120 706f 7369 7469 6f6e 2069   to a position i
-0000a3a0: 6e20 6d6d 2061 6c6f 6e67 2061 2067 6976  n mm along a giv
-0000a3b0: 656e 2061 7869 732e 2222 220a 0a20 2020  en axis."""..   
-0000a3c0: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-0000a3d0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000a3e0: 662e 636f 6e74 6f75 7273 5f6f 6e6c 793a  f.contours_only:
-0000a3f0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000a400: 5573 6520 7365 6c66 2e69 6d61 6765 2773  Use self.image's
-0000a410: 2063 6f6e 7665 7273 696f 6e20 6675 6e63   conversion func
-0000a420: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0000a430: 2069 6620 7365 6c66 2e69 6d61 6765 2069   if self.image i
-0000a440: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000a450: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a460: 726e 2073 656c 662e 696d 6167 652e 6964  rn self.image.id
-0000a470: 785f 746f 5f70 6f73 2869 6478 2c20 6178  x_to_pos(idx, ax
-0000a480: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0000a490: 204f 7468 6572 7769 7365 2063 6f75 6e74   Otherwise count
-0000a4a0: 206e 756d 6265 7220 6f66 207a 2073 6c69   number of z sli
-0000a4b0: 6365 7320 696e 2063 6f6e 746f 7572 7320  ces in contours 
-0000a4c0: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
-0000a4d0: 2023 2049 6620 696e 6465 7820 646f 6573   # If index does
-0000a4e0: 206e 6f74 2063 6f72 7265 7370 6f6e 6420   not correspond 
-0000a4f0: 746f 2061 2073 6c69 6365 2c20 7265 7475  to a slice, retu
-0000a500: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-0000a510: 2020 2020 656c 6966 2061 7820 696e 205b      elif ax in [
-0000a520: 227a 222c 2032 5d3a 0a20 2020 2020 2020  "z", 2]:.       
-0000a530: 2020 2020 2020 2020 2063 6f6e 7665 7273           convers
-0000a540: 696f 6e20 3d20 7b69 3a20 7020 666f 7220  ion = {i: p for 
-0000a550: 692c 2070 2069 6e20 0a20 2020 2020 2020  i, p in .       
-0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a570: 2020 2020 2020 2065 6e75 6d65 7261 7465         enumerate
-0000a580: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
-0000a590: 7273 2822 782d 7922 292e 6b65 7973 2829  rs("x-y").keys()
-0000a5a0: 297d 0a20 2020 2020 2020 2020 2020 2020  )}.             
-0000a5b0: 2020 2072 6574 7572 6e20 636f 6e76 6572     return conver
-0000a5c0: 7369 6f6e 2e67 6574 2869 6478 2c20 4e6f  sion.get(idx, No
-0000a5d0: 6e65 290a 0a20 2020 2020 2020 2020 2020  ne)..           
-0000a5e0: 2023 204f 7468 6572 7769 7365 2c20 6e6f   # Otherwise, no
-0000a5f0: 7420 706f 7373 6962 6c65 2074 6f20 636f  t possible to co
-0000a600: 6e76 6572 7420 782f 7920 706f 696e 7473  nvert x/y points
-0000a610: 2074 6f20 696e 6469 6365 730a 2020 2020   to indices.    
-0000a620: 2020 2020 2020 2020 2320 6672 6f6d 2063          # from c
-0000a630: 6f6e 746f 7572 7320 616c 6f6e 650a 2020  ontours alone.  
-0000a640: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a660: 7072 696e 7428 2257 6172 6e69 6e67 3a20  print("Warning: 
-0000a670: 6361 6e6e 6f74 2063 6f6e 7665 7274 2069  cannot convert i
-0000a680: 6e64 6578 2074 6f20 706f 7369 7469 6f6e  ndex to position
-0000a690: 2069 6e20 7468 6520 782f 7920 220a 2020   in the x/y ".  
-0000a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6b0: 2020 2020 2264 6972 6563 7469 6f6e 7320      "directions 
-0000a6c0: 7769 7468 6f75 7420 6173 736f 6369 6174  without associat
-0000a6d0: 6564 2069 6d61 6765 2067 656f 6d65 7472  ed image geometr
-0000a6e0: 7921 2229 0a20 2020 2020 2020 2020 2020  y!").           
-0000a6f0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-0000a700: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
-0000a710: 2c20 7472 7920 746f 2075 7365 206d 6173  , try to use mas
-0000a720: 6b20 6f72 2069 6d61 6765 2773 2063 6f6e  k or image's con
-0000a730: 7665 7273 696f 6e0a 2020 2020 2020 2020  version.        
-0000a740: 656c 6966 2073 656c 662e 6d61 736b 2069  elif self.mask i
-0000a750: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000a760: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000a770: 656c 662e 6d61 736b 2e69 6478 5f74 6f5f  elf.mask.idx_to_
-0000a780: 706f 7328 6964 782c 2061 7829 0a20 2020  pos(idx, ax).   
-0000a790: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
-0000a7a0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-0000a7b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000a7c0: 7475 726e 2073 656c 662e 696d 6167 652e  turn self.image.
-0000a7d0: 6964 785f 746f 5f70 6f73 2869 6478 2c20  idx_to_pos(idx, 
-0000a7e0: 6178 290a 0a20 2020 2020 2020 2023 2045  ax)..        # E
-0000a7f0: 6c73 652c 2074 7279 2074 6f20 6361 6c63  lse, try to calc
-0000a800: 756c 6174 6520 6672 6f6d 206f 776e 2067  ulate from own g
-0000a810: 656f 6d65 7472 6963 2070 726f 7065 7274  eometric propert
-0000a820: 6965 730a 2020 2020 2020 2020 656c 7365  ies.        else
-0000a830: 3a0a 2020 2020 2020 2020 2020 2020 695f  :.            i_
-0000a840: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
-0000a850: 5f61 7865 732e 696e 6465 7828 6178 2920  _axes.index(ax) 
-0000a860: 6966 2061 7820 696e 2073 6b72 742e 696d  if ax in skrt.im
-0000a870: 6167 652e 5f61 7865 7320 656c 7365 2061  age._axes else a
-0000a880: 780a 2020 2020 2020 2020 2020 2020 7265  x.            re
-0000a890: 7475 726e 2073 656c 662e 6f72 6967 696e  turn self.origin
-0000a8a0: 5b69 5f61 785d 202b 2069 6478 202a 2073  [i_ax] + idx * s
-0000a8b0: 656c 662e 766f 7865 6c5f 7369 7a65 5b69  elf.voxel_size[i
-0000a8c0: 5f61 785d 0a0a 2020 2020 6465 6620 706f  _ax]..    def po
-0000a8d0: 735f 746f 5f69 6478 2873 656c 662c 2070  s_to_idx(self, p
-0000a8e0: 6f73 2c20 6178 2c20 7265 7475 726e 5f69  os, ax, return_i
-0000a8f0: 6e74 3d54 7275 652c 202a 2a6b 7761 7267  nt=True, **kwarg
-0000a900: 7329 3a0a 2020 2020 2020 2020 2222 2243  s):.        """C
-0000a910: 6f6e 7665 7274 2061 2070 6f73 6974 696f  onvert a positio
-0000a920: 6e20 696e 206d 6d20 746f 2061 6e20 6172  n in mm to an ar
-0000a930: 7261 7920 696e 6465 7820 616c 6f6e 6720  ray index along 
-0000a940: 6120 6769 7665 6e20 6178 6973 2e22 2222  a given axis."""
-0000a950: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-0000a960: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
-0000a970: 2073 656c 662e 636f 6e74 6f75 7273 5f6f   self.contours_o
-0000a980: 6e6c 793a 0a0a 2020 2020 2020 2020 2020  nly:..          
-0000a990: 2020 2320 5573 6520 7365 6c66 2e69 6d61    # Use self.ima
-0000a9a0: 6765 2773 2063 6f6e 7665 7273 696f 6e20  ge's conversion 
-0000a9b0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-0000a9c0: 2020 2020 2069 6620 7365 6c66 2e69 6d61       if self.ima
-0000a9d0: 6765 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ge is not None:.
-0000a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9f0: 7265 7475 726e 2073 656c 662e 696d 6167  return self.imag
-0000aa00: 652e 706f 735f 746f 5f69 6478 2870 6f73  e.pos_to_idx(pos
-0000aa10: 2c20 6178 2c20 7265 7475 726e 5f69 6e74  , ax, return_int
-0000aa20: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0000aa30: 204f 7468 6572 7769 7365 2063 6f75 6e74   Otherwise count
-0000aa40: 206e 756d 6265 7220 6f66 207a 2073 6c69   number of z sli
-0000aa50: 6365 7320 696e 2063 6f6e 746f 7572 7320  ces in contours 
-0000aa60: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
-0000aa70: 2023 2049 6620 706f 7369 7469 6f6e 2064   # If position d
-0000aa80: 6f65 7320 6e6f 7420 636f 7272 6573 706f  oes not correspo
-0000aa90: 6e64 2074 6f20 6120 736c 6965 2c20 7265  nd to a slie, re
-0000aaa0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-0000aab0: 2020 2020 2020 656c 6966 2061 7820 696e        elif ax in
-0000aac0: 205b 227a 222c 2032 5d3a 0a20 2020 2020   ["z", 2]:.     
-0000aad0: 2020 2020 2020 2020 2020 2063 6f6e 7665             conve
-0000aae0: 7273 696f 6e20 3d20 7b70 3a20 6920 666f  rsion = {p: i fo
-0000aaf0: 7220 692c 2070 2069 6e20 0a20 2020 2020  r i, p in .     
-0000ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab10: 2020 2020 2020 2020 2065 6e75 6d65 7261           enumera
-0000ab20: 7465 2873 656c 662e 6765 745f 636f 6e74  te(self.get_cont
-0000ab30: 6f75 7273 2822 782d 7922 292e 6b65 7973  ours("x-y").keys
-0000ab40: 2829 297d 0a20 2020 2020 2020 2020 2020  ())}.           
-0000ab50: 2020 2020 2069 6478 203d 2063 6f6e 7665       idx = conve
-0000ab60: 7273 696f 6e2e 6765 7428 706f 732c 204e  rsion.get(pos, N
-0000ab70: 6f6e 6529 0a0a 2020 2020 2020 2020 2020  one)..          
-0000ab80: 2020 2320 4f74 6865 7277 6973 652c 206e    # Otherwise, n
-0000ab90: 6f74 2070 6f73 7369 626c 6520 746f 2063  ot possible to c
-0000aba0: 6f6e 7665 7274 2078 2f79 2070 6f69 6e74  onvert x/y point
-0000abb0: 7320 746f 2069 6e64 6963 6573 0a20 2020  s to indices.   
-0000abc0: 2020 2020 2020 2020 2023 2066 726f 6d20           # from 
-0000abd0: 636f 6e74 6f75 7273 2061 6c6f 6e65 0a20  contours alone. 
-0000abe0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000abf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ac00: 2070 7269 6e74 2822 5761 726e 696e 673a   print("Warning:
-0000ac10: 2063 616e 6e6f 7420 636f 6e76 6572 7420   cannot convert 
-0000ac20: 706f 7369 7469 6f6e 2074 6f20 696e 6465  position to inde
-0000ac30: 7820 696e 2074 6865 2078 2f79 2022 0a20  x in the x/y ". 
-0000ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac50: 2020 2020 2022 6469 7265 6374 696f 6e73       "directions
-0000ac60: 2077 6974 686f 7574 2061 7373 6f63 6961   without associa
-0000ac70: 7465 6420 696d 6167 6520 6765 6f6d 6574  ted image geomet
-0000ac80: 7279 2122 290a 2020 2020 2020 2020 2020  ry!").          
-0000ac90: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0000aca0: 2020 2020 2020 2020 2069 6620 7265 7475           if retu
-0000acb0: 726e 5f69 6e74 2061 6e64 2069 6478 2069  rn_int and idx i
-0000acc0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000acd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000ace0: 726e 2072 6f75 6e64 2869 6478 290a 2020  rn round(idx).  
-0000acf0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad10: 7265 7475 726e 2069 6478 0a0a 2020 2020  return idx..    
-0000ad20: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
-0000ad30: 2074 7279 2074 6f20 7573 6520 6d61 736b   try to use mask
-0000ad40: 206f 7220 696d 6167 6527 7320 636f 6e76   or image's conv
-0000ad50: 6572 7369 6f6e 0a20 2020 2020 2020 2065  ersion.        e
-0000ad60: 6c69 6620 7365 6c66 2e6d 6173 6b20 6973  lif self.mask is
-0000ad70: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000ad80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000ad90: 6c66 2e6d 6173 6b2e 706f 735f 746f 5f69  lf.mask.pos_to_i
-0000ada0: 6478 2870 6f73 2c20 6178 2c20 7265 7475  dx(pos, ax, retu
-0000adb0: 726e 5f69 6e74 290a 2020 2020 2020 2020  rn_int).        
-0000adc0: 656c 6966 2073 656c 662e 696d 6167 6520  elif self.image 
-0000add0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000ade0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000adf0: 7365 6c66 2e69 6d61 6765 2e70 6f73 5f74  self.image.pos_t
-0000ae00: 6f5f 6964 7828 706f 732c 2061 782c 2072  o_idx(pos, ax, r
-0000ae10: 6574 7572 6e5f 696e 7429 0a0a 2020 2020  eturn_int)..    
-0000ae20: 2020 2020 2320 456c 7365 2c20 7472 7920      # Else, try 
-0000ae30: 746f 2063 616c 6375 6c61 7465 2066 726f  to calculate fro
-0000ae40: 6d20 6f77 6e20 6765 6f6d 7472 6963 2070  m own geomtric p
-0000ae50: 726f 7065 7274 6965 730a 2020 2020 2020  roperties.      
-0000ae60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000ae70: 2020 2020 695f 6178 203d 2073 6b72 742e      i_ax = skrt.
-0000ae80: 696d 6167 652e 5f61 7865 732e 696e 6465  image._axes.inde
-0000ae90: 7828 6178 2920 6966 2061 7820 696e 2073  x(ax) if ax in s
-0000aea0: 6b72 742e 696d 6167 652e 5f61 7865 7320  krt.image._axes 
-0000aeb0: 656c 7365 2061 780a 2020 2020 2020 2020  else ax.        
-0000aec0: 2020 2020 6964 7820 3d20 2870 6f73 202d      idx = (pos -
-0000aed0: 2073 656c 662e 6f72 6967 696e 5b69 5f61   self.origin[i_a
-0000aee0: 785d 2920 2f20 7365 6c66 2e76 6f78 656c  x]) / self.voxel
-0000aef0: 5f73 697a 655b 695f 6178 5d0a 2020 2020  _size[i_ax].    
-0000af00: 2020 2020 2020 2020 6966 2072 6574 7572          if retur
-0000af10: 6e5f 696e 743a 0a20 2020 2020 2020 2020  n_int:.         
-0000af20: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
-0000af30: 756e 6428 6964 7829 0a20 2020 2020 2020  und(idx).       
-0000af40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000af50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000af60: 6e20 6964 780a 0a20 2020 2064 6566 2069  n idx..    def i
-0000af70: 6478 5f74 6f5f 736c 6963 6528 7365 6c66  dx_to_slice(self
-0000af80: 2c20 6964 782c 2061 7829 3a0a 2020 2020  , idx, ax):.    
-0000af90: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
-0000afa0: 6e20 6172 7261 7920 696e 6465 7820 746f  n array index to
-0000afb0: 2061 2073 6c69 6365 206e 756d 6265 7220   a slice number 
-0000afc0: 616c 6f6e 6720 6120 6769 7665 6e20 6178  along a given ax
-0000afd0: 6973 2e22 2222 0a0a 2020 2020 2020 2020  is."""..        
-0000afe0: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-0000aff0: 2020 2020 6966 2073 656c 662e 636f 6e74      if self.cont
-0000b000: 6f75 7273 5f6f 6e6c 7920 6f72 2028 7365  ours_only or (se
-0000b010: 6c66 2e6d 6173 6b20 6973 204e 6f6e 6520  lf.mask is None 
-0000b020: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
-0000b030: 7320 4e6f 6e65 293a 0a0a 2020 2020 2020  s None):..      
-0000b040: 2020 2020 2020 2320 436f 756e 7420 6e75        # Count nu
-0000b050: 6d62 6572 206f 6620 7a20 736c 6963 6573  mber of z slices
-0000b060: 2069 6e20 636f 6e74 6f75 7273 2064 6963   in contours dic
-0000b070: 740a 2020 2020 2020 2020 2020 2020 6966  t.            if
-0000b080: 2061 7820 696e 205b 227a 222c 2032 5d3a   ax in ["z", 2]:
-0000b090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b0a0: 206e 7a20 3d20 7365 6c66 2e67 6574 5f6e   nz = self.get_n
-0000b0b0: 7a5f 636f 6e74 6f75 7273 2829 0a20 2020  z_contours().   
-0000b0c0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000b0d0: 7572 6e20 6e7a 202d 2069 6478 0a20 2020  urn nz - idx.   
-0000b0e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000b100: 6574 7572 6e20 6964 7820 2b20 310a 0a20  eturn idx + 1.. 
-0000b110: 2020 2020 2020 2023 2054 7279 2074 6f20         # Try to 
-0000b120: 7573 6520 6d61 736b 206f 7220 696d 6167  use mask or imag
-0000b130: 6527 7320 636f 6e76 6572 7369 6f6e 0a20  e's conversion. 
-0000b140: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-0000b150: 2e6d 6173 6b20 6973 206e 6f74 204e 6f6e  .mask is not Non
-0000b160: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000b170: 6574 7572 6e20 7365 6c66 2e6d 6173 6b2e  eturn self.mask.
-0000b180: 6964 785f 746f 5f73 6c69 6365 2869 6478  idx_to_slice(idx
-0000b190: 2c20 6178 290a 2020 2020 2020 2020 656c  , ax).        el
-0000b1a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000b1b0: 7265 7475 726e 2073 656c 662e 696d 6167  return self.imag
-0000b1c0: 652e 6964 785f 746f 5f73 6c69 6365 2869  e.idx_to_slice(i
-0000b1d0: 6478 2c20 6178 290a 0a20 2020 2064 6566  dx, ax)..    def
-0000b1e0: 2073 6c69 6365 5f74 6f5f 6964 7828 7365   slice_to_idx(se
-0000b1f0: 6c66 2c20 736c 2c20 6178 293a 0a20 2020  lf, sl, ax):.   
-0000b200: 2020 2020 2022 2222 436f 6e76 6572 7420       """Convert 
-0000b210: 6120 736c 6963 6520 6e75 6d62 6572 2074  a slice number t
-0000b220: 6f20 616e 2061 7272 6179 2069 6e64 6578  o an array index
-0000b230: 2e22 2222 0a0a 2020 2020 2020 2020 7365  ."""..        se
-0000b240: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
-0000b250: 2020 6966 2073 656c 662e 636f 6e74 6f75    if self.contou
-0000b260: 7273 5f6f 6e6c 7920 6f72 2028 7365 6c66  rs_only or (self
-0000b270: 2e6d 6173 6b20 6973 204e 6f6e 6520 616e  .mask is None an
-0000b280: 6420 7365 6c66 2e69 6d61 6765 2069 7320  d self.image is 
-0000b290: 4e6f 6e65 293a 0a0a 2020 2020 2020 2020  None):..        
-0000b2a0: 2020 2020 2320 436f 756e 7420 6e75 6d62      # Count numb
-0000b2b0: 6572 206f 6620 7a20 736c 6963 6573 2069  er of z slices i
-0000b2c0: 6e20 636f 6e74 6f75 7273 2064 6963 740a  n contours dict.
-0000b2d0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-0000b2e0: 7820 696e 205b 227a 222c 2032 5d3a 0a20  x in ["z", 2]:. 
-0000b2f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000b300: 7a20 3d20 7365 6c66 2e67 6574 5f6e 7a5f  z = self.get_nz_
-0000b310: 636f 6e74 6f75 7273 2829 0a20 2020 2020  contours().     
-0000b320: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000b330: 6e20 6e7a 202d 2073 6c0a 2020 2020 2020  n nz - sl.      
-0000b340: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000b350: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000b360: 726e 2073 6c20 2d20 310a 0a20 2020 2020  rn sl - 1..     
-0000b370: 2020 2023 2054 7279 2074 6f20 7573 6520     # Try to use 
-0000b380: 6d61 736b 206f 7220 696d 6167 6527 7320  mask or image's 
-0000b390: 636f 6e76 6572 7369 6f6e 0a20 2020 2020  conversion.     
-0000b3a0: 2020 2065 6c69 6620 7365 6c66 2e6d 6173     elif self.mas
-0000b3b0: 6b20 6973 206e 6f74 204e 6f6e 653a 0a20  k is not None:. 
-0000b3c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000b3d0: 6e20 7365 6c66 2e6d 6173 6b2e 736c 6963  n self.mask.slic
-0000b3e0: 655f 746f 5f69 6478 2873 6c2c 2061 7829  e_to_idx(sl, ax)
-0000b3f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000b400: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000b410: 6e20 7365 6c66 2e69 6d61 6765 2e73 6c69  n self.image.sli
-0000b420: 6365 5f74 6f5f 6964 7828 736c 2c20 6178  ce_to_idx(sl, ax
-0000b430: 290a 0a20 2020 2064 6566 2070 6f73 5f74  )..    def pos_t
-0000b440: 6f5f 736c 6963 6528 7365 6c66 2c20 706f  o_slice(self, po
-0000b450: 732c 2061 782c 2072 6574 7572 6e5f 696e  s, ax, return_in
-0000b460: 743d 5472 7565 2c20 7374 616e 6461 7264  t=True, standard
-0000b470: 6973 653d 5472 7565 293a 0a20 2020 2020  ise=True):.     
-0000b480: 2020 2022 2222 436f 6e76 6572 7420 6120     """Convert a 
-0000b490: 706f 7369 7469 6f6e 2069 6e20 6d6d 2074  position in mm t
-0000b4a0: 6f20 6120 736c 6963 6520 6e75 6d62 6572  o a slice number
-0000b4b0: 2061 6c6f 6e67 2061 2067 6976 656e 2061   along a given a
-0000b4c0: 7869 732e 2222 220a 0a20 2020 2020 2020  xis."""..       
-0000b4d0: 2072 6574 7572 6e20 736b 7274 2e69 6d61   return skrt.ima
-0000b4e0: 6765 2e49 6d61 6765 2e70 6f73 5f74 6f5f  ge.Image.pos_to_
-0000b4f0: 736c 6963 6528 7365 6c66 2c20 706f 732c  slice(self, pos,
-0000b500: 2061 782c 2072 6574 7572 6e5f 696e 7429   ax, return_int)
-0000b510: 0a0a 2020 2020 6465 6620 736c 6963 655f  ..    def slice_
-0000b520: 746f 5f70 6f73 2873 656c 662c 2073 6c2c  to_pos(self, sl,
-0000b530: 2061 782c 2073 7461 6e64 6172 6469 7365   ax, standardise
-0000b540: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-0000b550: 2222 2243 6f6e 7665 7274 2061 2073 6c69  """Convert a sli
-0000b560: 6365 206e 756d 6265 7220 746f 2061 2070  ce number to a p
-0000b570: 6f73 6974 696f 6e20 696e 206d 6d20 616c  osition in mm al
-0000b580: 6f6e 6720 6120 6769 7665 6e20 6178 6973  ong a given axis
-0000b590: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
-0000b5a0: 7475 726e 2073 6b72 742e 696d 6167 652e  turn skrt.image.
-0000b5b0: 496d 6167 652e 736c 6963 655f 746f 5f70  Image.slice_to_p
-0000b5c0: 6f73 2873 656c 662c 2073 6c2c 2061 7829  os(self, sl, ax)
-0000b5d0: 0a0a 2020 2020 6465 6620 6765 745f 6964  ..    def get_id
-0000b5e0: 7828 7365 6c66 2c20 7669 6577 2c20 736c  x(self, view, sl
-0000b5f0: 3d4e 6f6e 652c 2069 6478 3d4e 6f6e 652c  =None, idx=None,
-0000b600: 2070 6f73 3d4e 6f6e 6529 3a0a 2020 2020   pos=None):.    
-0000b610: 2020 2020 2222 2247 6574 2061 6e20 6172      """Get an ar
-0000b620: 7261 7920 696e 6465 7820 6672 6f6d 2065  ray index from e
-0000b630: 6974 6865 7220 6120 736c 6963 6520 6e75  ither a slice nu
-0000b640: 6d62 6572 2c20 696e 6465 782c 206f 720a  mber, index, or.
-0000b650: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
-0000b660: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
-0000b670: 7475 726e 2073 6b72 742e 696d 6167 652e  turn skrt.image.
-0000b680: 496d 6167 652e 6765 745f 6964 7828 7365  Image.get_idx(se
-0000b690: 6c66 2c20 7669 6577 2c20 736c 3d73 6c2c  lf, view, sl=sl,
-0000b6a0: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
-0000b6b0: 7329 0a0a 2020 2020 6465 6620 6f6e 5f73  s)..    def on_s
-0000b6c0: 6c69 6365 2873 656c 662c 2076 6965 772c  lice(self, view,
-0000b6d0: 2073 6c3d 4e6f 6e65 2c20 6964 783d 4e6f   sl=None, idx=No
-0000b6e0: 6e65 2c20 706f 733d 4e6f 6e65 293a 0a20  ne, pos=None):. 
-0000b6f0: 2020 2020 2020 2022 2222 4368 6563 6b20         """Check 
-0000b700: 7768 6574 6865 7220 7468 6973 2052 4f49  whether this ROI
-0000b710: 2065 7869 7374 7320 6f6e 2061 2067 6976   exists on a giv
-0000b720: 656e 2073 6c69 6365 2e22 2222 0a0a 2020  en slice."""..  
-0000b730: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
-0000b740: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
-0000b750: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
-0000b760: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000b770: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0000b780: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
-0000b790: 2e67 6574 5f69 6478 2876 6965 772c 2073  .get_idx(view, s
-0000b7a0: 6c2c 2069 6478 2c20 706f 7329 0a20 2020  l, idx, pos).   
-0000b7b0: 2020 2020 2069 6620 6964 7820 6973 204e       if idx is N
-0000b7c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000b7d0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0000b7e0: 2020 2020 2020 7265 7475 726e 2069 6478        return idx
-0000b7f0: 2069 6e20 7365 6c66 2e67 6574 5f69 6e64   in self.get_ind
-0000b800: 6963 6573 2876 6965 7729 0a0a 2020 2020  ices(view)..    
-0000b810: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
-0000b820: 706f 696e 7473 2873 656c 662c 206e 5f70  points(self, n_p
-0000b830: 6f69 6e74 3d4e 6f6e 652c 2064 7879 3d4e  oint=None, dxy=N
-0000b840: 6f6e 652c 0a20 2020 2020 2020 2073 6d6f  one,.        smo
-0000b850: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
-0000b860: 743d 3029 3a0a 2020 2020 2020 2020 2727  t=0):.        ''
-0000b870: 270a 2020 2020 2020 2020 5265 7475 726e  '.        Return
-0000b880: 206e 6577 2052 4f49 206f 626a 6563 742c   new ROI object,
-0000b890: 2077 6974 6820 696e 7465 7270 6f6c 6174   with interpolat
-0000b8a0: 6564 2063 6f6e 746f 7572 2070 6f69 6e74  ed contour point
-0000b8b0: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
-0000b8c0: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
-0000b8d0: 2020 2020 206e 5f70 6f69 6e74 203a 2069       n_point : i
-0000b8e0: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-0000b8f0: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
-0000b900: 6265 7220 6f66 2070 6f69 6e74 7320 7065  ber of points pe
-0000b910: 7220 636f 6e74 6f75 722c 2061 6674 6572  r contour, after
-0000b920: 2069 6e74 6572 706f 6c61 7469 6f6e 2e20   interpolation. 
-0000b930: 2054 6869 7320 6d75 7374 0a20 2020 2020   This must.     
-0000b940: 2020 2020 2020 2062 6520 7365 7420 746f         be set to
-0000b950: 204e 6f6e 6520 666f 7220 6478 7920 746f   None for dxy to
-0000b960: 2062 6520 636f 6e73 6964 6572 6564 2e0a   be considered..
-0000b970: 0a20 2020 2020 2020 2064 7879 203a 2066  .        dxy : f
-0000b980: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
-0000b990: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
-0000b9a0: 7070 726f 7869 6d61 7465 2064 6973 7461  pproximate dista
-0000b9b0: 6e63 6520 7265 7175 6972 6564 2062 6574  nce required bet
-0000b9c0: 7765 656e 2063 6f6e 746f 7572 2070 6f69  ween contour poi
-0000b9d0: 6e74 732e 2020 5468 6973 2069 7320 7461  nts.  This is ta
-0000b9e0: 6b65 6e0a 2020 2020 2020 2020 2020 2020  ken.            
-0000b9f0: 696e 746f 2061 6363 6f75 6e74 206f 6e6c  into account onl
-0000ba00: 7920 6966 206e 5f70 6f69 6e74 2069 7320  y if n_point is 
-0000ba10: 7365 7420 746f 204e 6f6e 652e 2020 466f  set to None.  Fo
-0000ba20: 7220 6120 636f 6e74 6f75 7220 6f66 0a20  r a contour of. 
-0000ba30: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
-0000ba40: 6820 636f 6e74 6f75 725f 6c65 6e67 7468  h contour_length
-0000ba50: 2c20 7468 6520 6e75 6d62 6572 206f 6620  , the number of 
-0000ba60: 636f 6e74 6f75 7220 706f 696e 7473 2069  contour points i
-0000ba70: 7320 7468 656e 2074 616b 656e 0a20 2020  s then taken.   
-0000ba80: 2020 2020 2020 2020 2074 6f20 6265 206d           to be m
-0000ba90: 6178 2869 6e74 2863 6f6e 746f 7572 5f6c  ax(int(contour_l
-0000baa0: 656e 6774 6820 2f20 6478 7929 2c20 3329  ength / dxy), 3)
-0000bab0: 2e20 200a 0a20 2020 2020 2020 2073 6d6f  .  ..        smo
-0000bac0: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
-0000bad0: 7420 3a20 666c 6f61 742c 2064 6566 6175  t : float, defau
-0000bae0: 6c74 3d30 0a20 2020 2020 2020 2020 2020  lt=0.           
-0000baf0: 2050 6172 616d 6574 6572 2064 6574 6572   Parameter deter
-0000bb00: 6d69 6e69 6e67 2074 6865 2073 6d6f 6f74  mining the smoot
-0000bb10: 686e 6573 7320 6f66 2074 6865 2042 2d73  hness of the B-s
-0000bb20: 706c 696e 6520 6375 7276 6520 7573 6564  pline curve used
-0000bb30: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
-0000bb40: 636f 6e74 6f75 7220 6170 7072 6f78 696d  contour approxim
-0000bb50: 6174 696f 6e20 666f 7220 696e 7465 7270  ation for interp
-0000bb60: 6f6c 6174 696f 6e2e 2020 5468 6520 7072  olation.  The pr
-0000bb70: 6f64 7563 7420 6f66 0a20 2020 2020 2020  oduct of.       
-0000bb80: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
-0000bb90: 7065 725f 706f 696e 7420 616e 6420 7468  per_point and th
-0000bba0: 6520 6e75 6d62 6572 206f 6620 636f 6e74  e number of cont
-0000bbb0: 6f75 7220 706f 696e 7473 2028 7370 6563  our points (spec
-0000bbc0: 6966 6965 640a 2020 2020 2020 2020 2020  ified.          
-0000bbd0: 2020 6469 7265 6374 6c79 2076 6961 206e    directly via n
-0000bbe0: 5f70 6f69 6e74 2c20 6f72 2069 6e64 6972  _point, or indir
-0000bbf0: 6563 746c 7920 7669 6120 6478 7929 2063  ectly via dxy) c
-0000bc00: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
-0000bc10: 650a 2020 2020 2020 2020 2020 2020 7061  e.            pa
-0000bc20: 7261 6d65 7465 7220 7320 6f66 2073 6369  rameter s of sci
-0000bc30: 7079 2e69 6e74 6572 706f 6c61 7465 2e73  py.interpolate.s
-0000bc40: 706c 7072 6570 202d 2073 6565 2064 6f63  plprep - see doc
-0000bc50: 756d 656e 7461 7469 6f6e 2061 743a 0a20  umentation at:. 
-0000bc60: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000bc70: 2020 2020 6874 7470 733a 2f2f 7363 6970      https://scip
-0000bc80: 792e 6769 7468 7562 2e69 6f2f 6465 7664  y.github.io/devd
-0000bc90: 6f63 732f 7265 6665 7265 6e63 652f 6765  ocs/reference/ge
-0000bca0: 6e65 7261 7465 642f 7363 6970 792e 696e  nerated/scipy.in
-0000bcb0: 7465 7270 6f6c 6174 652e 7370 6c70 7265  terpolate.splpre
-0000bcc0: 702e 6874 6d6c 2373 6369 7079 2e69 6e74  p.html#scipy.int
-0000bcd0: 6572 706f 6c61 7465 2e73 706c 7072 6570  erpolate.splprep
-0000bce0: 0a0a 2020 2020 2020 2020 2020 2020 4120  ..            A 
-0000bcf0: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
-0000bd00: 6f69 6e74 206f 6620 3020 666f 7263 6573  oint of 0 forces
-0000bd10: 2074 6865 2042 2d73 706c 696e 6520 746f   the B-spline to
-0000bd20: 2070 6173 7320 7468 726f 7567 680a 2020   pass through.  
-0000bd30: 2020 2020 2020 2020 2020 616c 6c20 6f66            all of
-0000bd40: 2074 6865 2070 7265 2d69 6e74 6572 706f   the pre-interpo
-0000bd50: 6c61 7469 6f6e 2063 6f6e 746f 7572 2070  lation contour p
-0000bd60: 6f69 6e74 732e 0a20 2020 2020 2020 2027  oints..        '
-0000bd70: 2727 0a0a 2020 2020 2020 2020 6e65 775f  ''..        new_
-0000bd80: 636f 6e74 6f75 7273 203d 207b 7d0a 2020  contours = {}.  
-0000bd90: 2020 2020 2020 666f 7220 7a2c 2063 6f6e        for z, con
-0000bda0: 746f 7572 7320 696e 2073 656c 662e 6765  tours in self.ge
-0000bdb0: 745f 636f 6e74 6f75 7273 2829 2e69 7465  t_contours().ite
-0000bdc0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000bdd0: 2020 6e65 775f 636f 6e74 6f75 7273 5b7a    new_contours[z
-0000bde0: 5d20 3d20 5b5d 0a20 2020 2020 2020 2020  ] = [].         
-0000bdf0: 2020 2066 6f72 2063 6f6e 746f 7572 2069     for contour i
-0000be00: 6e20 636f 6e74 6f75 7273 3a0a 2020 2020  n contours:.    
-0000be10: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000be20: 636f 6e74 6f75 7220 3d20 696e 7465 7270  contour = interp
-0000be30: 6f6c 6174 655f 706f 696e 7473 5f73 696e  olate_points_sin
-0000be40: 676c 655f 636f 6e74 6f75 7228 0a20 2020  gle_contour(.   
-0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be60: 2020 2020 2063 6f6e 746f 7572 2c20 6e5f       contour, n_
-0000be70: 706f 696e 742c 2064 7879 2c20 736d 6f6f  point, dxy, smoo
-0000be80: 7468 6e65 7373 5f70 6572 5f70 6f69 6e74  thness_per_point
-0000be90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bea0: 2020 6e65 775f 636f 6e74 6f75 7273 5b7a    new_contours[z
-0000beb0: 5d2e 6170 7065 6e64 286e 6577 5f63 6f6e  ].append(new_con
-0000bec0: 746f 7572 290a 0a20 2020 2020 2020 2023  tour)..        #
-0000bed0: 2043 6c6f 6e65 2073 656c 662c 2074 6865   Clone self, the
-0000bee0: 6e20 636c 6561 7220 6d61 736b 2061 6e64  n clear mask and
-0000bef0: 2072 6573 6574 2063 6f6e 746f 7572 7320   reset contours 
-0000bf00: 6f66 2063 6c6f 6e65 0a20 2020 2020 2020  of clone.       
-0000bf10: 2072 6f69 203d 2052 4f49 2873 656c 6629   roi = ROI(self)
-0000bf20: 0a20 2020 2020 2020 2072 6f69 2e69 6e70  .        roi.inp
-0000bf30: 7574 5f63 6f6e 746f 7572 7320 3d20 6e65  ut_contours = ne
-0000bf40: 775f 636f 6e74 6f75 7273 0a20 2020 2020  w_contours.     
-0000bf50: 2020 2072 6f69 2e63 6f6e 746f 7572 7320     roi.contours 
-0000bf60: 3d20 7b22 782d 7922 3a20 6e65 775f 636f  = {"x-y": new_co
-0000bf70: 6e74 6f75 7273 7d0a 2020 2020 2020 2020  ntours}.        
-0000bf80: 726f 692e 6c6f 6164 6564 5f6d 6173 6b20  roi.loaded_mask 
-0000bf90: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0000bfa0: 726f 692e 6d61 736b 203d 204e 6f6e 650a  roi.mask = None.
-0000bfb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000bfc0: 726f 690a 0a20 2020 2064 6566 2067 6574  roi..    def get
-0000bfd0: 5f63 656e 7472 6f69 6428 0a20 2020 2020  _centroid(.     
-0000bfe0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0000bff0: 2076 6965 773d 2278 2d79 222c 0a20 2020   view="x-y",.   
-0000c000: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-0000c010: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
-0000c020: 2073 6c3d 4e6f 6e65 2c0a 2020 2020 2020   sl=None,.      
-0000c030: 2020 6964 783d 4e6f 6e65 2c0a 2020 2020    idx=None,.    
-0000c040: 2020 2020 706f 733d 4e6f 6e65 2c0a 2020      pos=None,.  
-0000c050: 2020 2020 2020 756e 6974 733d 226d 6d22        units="mm"
-0000c060: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
-0000c070: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
-0000c080: 6f72 6365 3d54 7275 652c 0a20 2020 2029  orce=True,.    )
-0000c090: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-0000c0a0: 2065 6974 6865 7220 3344 2067 6c6f 6261   either 3D globa
-0000c0b0: 6c20 6365 6e74 726f 6964 2070 6f73 6974  l centroid posit
-0000c0c0: 696f 6e20 6f72 2032 4420 6365 6e74 726f  ion or 2D centro
-0000c0d0: 6964 2070 6f73 6974 696f 6e20 6f6e 200a  id position on .
-0000c0e0: 2020 2020 2020 2020 6120 7369 6e67 6c65          a single
-0000c0f0: 2073 6c69 6365 2e20 4966 2073 696e 676c   slice. If singl
-0000c100: 655f 736c 6963 653d 4661 6c73 652c 2074  e_slice=False, t
-0000c110: 6865 2063 616c 6375 6c61 7465 6420 676c  he calculated gl
-0000c120: 6f62 616c 2063 656e 7472 6f69 6420 0a20  obal centroid . 
-0000c130: 2020 2020 2020 2077 696c 6c20 6265 2063         will be c
-0000c140: 6163 6865 6420 696e 2073 656c 662e 5f63  ached in self._c
-0000c150: 656e 7472 6f69 645b 756e 6974 735d 2061  entroid[units] a
-0000c160: 6e64 2072 6574 7572 6e65 6420 6966 2063  nd returned if c
-0000c170: 616c 6c65 6420 6167 6169 6e2c 0a20 2020  alled again,.   
-0000c180: 2020 2020 2075 6e6c 6573 7320 666f 7263       unless forc
-0000c190: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
-0000c1a0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0000c1b0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0000c1c0: 2020 7369 6e67 6c65 5f73 6c69 6365 203a    single_slice :
-0000c1d0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-0000c1e0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0000c1f0: 2049 6620 4661 6c73 652c 2074 6865 2067   If False, the g
-0000c200: 6c6f 6261 6c20 3344 2063 656e 7472 6f69  lobal 3D centroi
-0000c210: 6420 6f66 2074 6865 2065 6e74 6972 6520  d of the entire 
-0000c220: 524f 4920 7769 6c6c 2062 6520 7265 7475  ROI will be retu
-0000c230: 726e 6564 3b0a 2020 2020 2020 2020 2020  rned;.          
-0000c240: 2020 6f74 6865 7277 6973 652c 2074 6865    otherwise, the
-0000c250: 2032 4420 6365 6e74 726f 6964 206f 6e20   2D centroid on 
-0000c260: 6120 7369 6e67 6c65 2073 6c69 6365 2077  a single slice w
-0000c270: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
-0000c280: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
-0000c290: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
-0000c2a0: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
-0000c2b0: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
-0000c2c0: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
-0000c2d0: 2067 6574 2063 656e 7472 6f69 642e 204f   get centroid. O
-0000c2e0: 6e6c 7920 7573 6564 2069 6620 0a20 2020  nly used if .   
-0000c2f0: 2020 2020 2020 2020 2073 696e 676c 655f           single_
-0000c300: 736c 6963 653d 5472 7565 2e20 4966 2075  slice=True. If u
-0000c310: 7369 6e67 2c20 3c61 783e 206d 7573 7420  sing, <ax> must 
-0000c320: 6265 2061 6e20 6178 6973 2074 6861 7420  be an axis that 
-0000c330: 6c69 6573 2061 6c6f 6e67 0a20 2020 2020  lies along.     
-0000c340: 2020 2020 2020 2074 6865 2073 6c69 6365         the slice
-0000c350: 2069 6e20 7468 6973 206f 7269 656e 7461   in this orienta
-0000c360: 7469 6f6e 2e0a 0a20 2020 2020 2020 2073  tion...        s
-0000c370: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
-0000c380: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0000c390: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
-0000c3a0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0000c3b0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0000c3c0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-0000c3d0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-0000c3e0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-0000c3f0: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-0000c400: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
-0000c410: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
-0000c420: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
-0000c430: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-0000c440: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
-0000c450: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
-0000c460: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
-0000c470: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-0000c480: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
-0000c490: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
-0000c4a0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-0000c4b0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-0000c4c0: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
-0000c4d0: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
-0000c4e0: 642e 0a0a 2020 2020 2020 2020 706f 7320  d...        pos 
-0000c4f0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-0000c500: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0000c510: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
-0000c520: 2069 6e20 6d6d 2e20 4966 206e 6f6e 6520   in mm. If none 
-0000c530: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-0000c540: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-0000c550: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-0000c560: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-0000c570: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-0000c580: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0000c590: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
-0000c5a0: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
-0000c5b0: 2075 6e69 7473 203a 2073 7472 2c20 6465   units : str, de
-0000c5c0: 6661 756c 743d 226d 6d22 0a20 2020 2020  fault="mm".     
-0000c5d0: 2020 2020 2020 2055 6e69 7473 206f 6620         Units of 
-0000c5e0: 6365 6e74 726f 6964 2e20 4361 6e20 6265  centroid. Can be
-0000c5f0: 2065 6974 6865 7220 6f66 3a0a 2020 2020   either of:.    
-0000c600: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
-0000c610: 6d22 3a20 7265 7475 726e 2063 656e 7472  m": return centr
-0000c620: 6f69 6420 706f 7369 7469 6f6e 2069 6e20  oid position in 
-0000c630: 6d69 6c6c 696d 6574 7265 732e 0a20 2020  millimetres..   
-0000c640: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-0000c650: 766f 7865 6c73 223a 2072 6574 7572 6e20  voxels": return 
-0000c660: 6365 6e74 726f 6964 2070 6f73 6974 696f  centroid positio
-0000c670: 6e20 696e 2074 6572 6d73 206f 6620 6172  n in terms of ar
-0000c680: 7261 7920 696e 6469 6365 732e 0a20 2020  ray indices..   
-0000c690: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-0000c6a0: 736c 6963 6522 3a20 7265 7475 726e 2063  slice": return c
-0000c6b0: 656e 7472 6f69 6420 706f 7369 7469 6f6e  entroid position
-0000c6c0: 2069 6e20 7465 726d 7320 6f66 2073 6c69   in terms of sli
-0000c6d0: 6365 206e 756d 6265 7273 2e0a 0a20 2020  ce numbers...   
-0000c6e0: 2020 2020 2020 2020 2049 6620 756e 6974           If unit
-0000c6f0: 733d 2276 6f78 656c 7322 206f 7220 2273  s="voxels" or "s
-0000c700: 6c69 6365 2220 6973 2072 6571 7565 7374  lice" is request
-0000c710: 6564 2062 7574 2074 6869 7320 524f 4920  ed but this ROI 
-0000c720: 6f6e 6c79 2068 6173 200a 2020 2020 2020  only has .      
-0000c730: 2020 2020 2020 636f 6e74 6f75 7273 2061        contours a
-0000c740: 6e64 206e 6f20 6d61 736b 2073 6861 7065  nd no mask shape
-0000c750: 2f76 6f78 656c 2073 697a 6520 696e 666f  /voxel size info
-0000c760: 726d 6174 696f 6e2c 2061 6e20 6572 726f  rmation, an erro
-0000c770: 7220 7769 6c6c 2062 6520 0a20 2020 2020  r will be .     
-0000c780: 2020 2020 2020 2072 6169 7365 6420 2875         raised (u
-0000c790: 6e6c 6573 7320 6178 3d22 7a22 2c20 696e  nless ax="z", in
-0000c7a0: 2077 6869 6368 2063 6173 6520 766f 7865   which case voxe
-0000c7b0: 6c20 7369 7a65 2077 696c 6c20 6265 2069  l size will be i
-0000c7c0: 6e66 6572 7265 6420 0a20 2020 2020 2020  nferred .       
-0000c7d0: 2020 2020 2066 726f 6d20 7370 6163 696e       from spacin
-0000c7e0: 6720 6265 7477 6565 6e20 736c 6963 6573  g between slices
-0000c7f0: 292e 0a0a 2020 2020 2020 2020 6d65 7468  )...        meth
-0000c800: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
-0000c810: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0000c820: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
-0000c830: 2066 6f72 2063 656e 7472 6f69 6420 6361   for centroid ca
-0000c840: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
-0000c850: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-0000c860: 2020 2020 2d20 2263 6f6e 746f 7572 223a      - "contour":
-0000c870: 2067 6574 2063 656e 7472 6f69 6420 6f66   get centroid of
-0000c880: 2073 6861 7065 6c79 2063 6f6e 746f 7572   shapely contour
-0000c890: 2873 292e 0a20 2020 2020 2020 2020 2020  (s)..           
-0000c8a0: 2020 2020 202d 2022 6d61 736b 223a 2067       - "mask": g
-0000c8b0: 6574 2061 7665 7261 6765 2070 6f73 6974  et average posit
-0000c8c0: 696f 6e20 6f66 2076 6f78 656c 7320 696e  ion of voxels in
-0000c8d0: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
-0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-0000c8f0: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
-0000c900: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
-0000c910: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-0000c920: 7468 6f64 2e0a 0a20 2020 2020 2020 2066  thod...        f
-0000c930: 6f72 6365 203a 2062 6f6f 6c2c 2064 6566  orce : bool, def
-0000c940: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
-0000c950: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-0000c960: 6865 2067 6c6f 6261 6c20 6365 6e74 726f  he global centro
-0000c970: 6964 2077 696c 6c20 616c 7761 7973 2062  id will always b
-0000c980: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
-0000c990: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-0000c9a0: 6572 7769 7365 2c20 6974 2077 696c 6c20  erwise, it will 
-0000c9b0: 6f6e 6c79 2062 6520 6361 6c63 756c 6174  only be calculat
-0000c9c0: 6564 2069 6620 6974 2068 6173 206e 6f74  ed if it has not
-0000c9d0: 2079 6574 2062 6565 6e20 6361 6368 6564   yet been cached
-0000c9e0: 200a 2020 2020 2020 2020 2020 2020 696e   .            in
-0000c9f0: 2073 656c 662e 5f76 6f6c 756d 652e 2020   self._volume.  
-0000ca00: 4e6f 7465 2074 6861 7420 6966 2073 696e  Note that if sin
-0000ca10: 676c 655f 736c 6963 653d 5472 7565 2c20  gle_slice=True, 
-0000ca20: 7468 6520 6365 6e74 726f 6964 2077 696c  the centroid wil
-0000ca30: 6c20 0a20 2020 2020 2020 2020 2020 2061  l .            a
-0000ca40: 6c77 6179 7320 6265 2072 6563 616c 6375  lways be recalcu
-0000ca50: 6c61 7465 642e 0a20 2020 2020 2020 2022  lated..        "
-0000ca60: 2222 0a0a 2020 2020 2020 2020 2320 4966  ""..        # If
-0000ca70: 2067 6c6f 6261 6c20 6365 6e74 726f 6964   global centroid
-0000ca80: 2061 6c72 6561 6479 2063 6163 6865 642c   already cached,
-0000ca90: 2072 6574 7572 6e20 6361 6368 6564 2076   return cached v
-0000caa0: 616c 7565 0a20 2020 2020 2020 2069 6620  alue.        if 
-0000cab0: 6e6f 7420 7369 6e67 6c65 5f73 6c69 6365  not single_slice
-0000cac0: 2061 6e64 206e 6f74 2066 6f72 6365 3a0a   and not force:.
-0000cad0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0000cae0: 6173 6174 7472 2873 656c 662c 2022 5f63  asattr(self, "_c
-0000caf0: 656e 7472 6f69 6422 2920 616e 6420 756e  entroid") and un
-0000cb00: 6974 7320 696e 2073 656c 662e 5f63 656e  its in self._cen
-0000cb10: 7472 6f69 643a 0a20 2020 2020 2020 2020  troid:.         
-0000cb20: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000cb30: 6c66 2e5f 6365 6e74 726f 6964 5b75 6e69  lf._centroid[uni
-0000cb40: 7473 5d0a 0a20 2020 2020 2020 2023 2047  ts]..        # G
-0000cb50: 6574 2064 6566 6175 6c74 2073 6c69 6365  et default slice
-0000cb60: 2061 6e64 206d 6574 686f 640a 2020 2020   and method.    
-0000cb70: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-0000cb80: 2020 2020 2020 2020 6966 206d 6574 686f          if metho
-0000cb90: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
-0000cba0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
-0000cbb0: 7365 6c66 2e64 6566 6175 6c74 5f67 656f  self.default_geo
-0000cbc0: 6d5f 6d65 7468 6f64 0a20 2020 2020 2020  m_method.       
-0000cbd0: 2069 6620 7369 6e67 6c65 5f73 6c69 6365   if single_slice
-0000cbe0: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
-0000cbf0: 2061 6e64 2073 6c20 6973 204e 6f6e 6520   and sl is None 
-0000cc00: 616e 6420 6964 7820 6973 204e 6f6e 653a  and idx is None:
-0000cc10: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-0000cc20: 203d 2073 656c 662e 6765 745f 6d69 645f   = self.get_mid_
-0000cc30: 6964 7828 7669 6577 290a 0a20 2020 2020  idx(view)..     
-0000cc40: 2020 2023 2049 6620 7369 6e67 6c65 2073     # If single s
-0000cc50: 6c69 6365 2072 6571 7565 7374 6564 2061  lice requested a
-0000cc60: 6e64 206e 6f74 206f 6e20 6375 7272 656e  nd not on curren
-0000cc70: 7420 736c 6963 652c 2072 6574 7572 6e20  t slice, return 
-0000cc80: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
-0000cc90: 2020 2069 6620 7369 6e67 6c65 5f73 6c69     if single_sli
-0000cca0: 6365 2061 6e64 206e 6f74 2073 656c 662e  ce and not self.
-0000ccb0: 6f6e 5f73 6c69 6365 2876 6965 772c 2073  on_slice(view, s
-0000ccc0: 6c3d 736c 2c20 6964 783d 6964 782c 2070  l=sl, idx=idx, p
-0000ccd0: 6f73 3d70 6f73 293a 0a20 2020 2020 2020  os=pos):.       
-0000cce0: 2020 2020 2072 6574 7572 6e20 6e70 2e61       return np.a
-0000ccf0: 7272 6179 285b 4e6f 6e65 2c20 4e6f 6e65  rray([None, None
-0000cd00: 5d29 0a0a 2020 2020 2020 2020 2320 4361  ])..        # Ca
-0000cd10: 6c63 756c 6174 6520 6365 6e74 726f 6964  lculate centroid
-0000cd20: 2066 726f 6d20 5368 6170 656c 7920 706f   from Shapely po
-0000cd30: 6c79 676f 6e73 0a20 2020 2020 2020 2063  lygons.        c
-0000cd40: 656e 7472 6f69 6420 3d20 7b7d 0a20 2020  entroid = {}.   
-0000cd50: 2020 2020 2069 6620 6d65 7468 6f64 203d       if method =
-0000cd60: 3d20 2263 6f6e 746f 7572 223a 0a0a 2020  = "contour":..  
-0000cd70: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
-0000cd80: 3244 206f 7220 3344 2063 656e 7472 6f69  2D or 3D centroi
-0000cd90: 6473 2061 6e64 2061 7265 6173 206f 6620  ds and areas of 
-0000cda0: 6561 6368 2070 6f6c 7967 6f6e 206f 6e20  each polygon on 
-0000cdb0: 7468 6520 6465 7369 7265 640a 2020 2020  the desired.    
-0000cdc0: 2020 2020 2020 2020 2320 736c 6963 6528          # slice(
-0000cdd0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-0000cde0: 6620 7369 6e67 6c65 5f73 6c69 6365 3a0a  f single_slice:.
-0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce00: 706f 6c79 676f 6e73 203d 2073 656c 662e  polygons = self.
-0000ce10: 6765 745f 706f 6c79 676f 6e73 5f6f 6e5f  get_polygons_on_
-0000ce20: 736c 6963 6528 7669 6577 2c20 736c 2c20  slice(view, sl, 
-0000ce30: 6964 782c 2070 6f73 290a 2020 2020 2020  idx, pos).      
-0000ce40: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
-0000ce50: 6964 7320 3d20 5b5d 0a20 2020 2020 2020  ids = [].       
-0000ce60: 2020 2020 2020 2020 2061 7265 6173 203d           areas =
-0000ce70: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0000ce80: 2020 2020 666f 7220 7020 696e 2070 6f6c      for p in pol
-0000ce90: 7967 6f6e 733a 0a20 2020 2020 2020 2020  ygons:.         
-0000cea0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-0000ceb0: 6f69 645f 7879 203d 2070 2e63 656e 7472  oid_xy = p.centr
-0000cec0: 6f69 642e 7879 0a20 2020 2020 2020 2020  oid.xy.         
-0000ced0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-0000cee0: 6f69 6473 2e61 7070 656e 6428 6e70 2e61  oids.append(np.a
-0000cef0: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
-0000cf00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000cf10: 656e 7472 6f69 645f 7879 5b30 5d5b 305d  entroid_xy[0][0]
-0000cf20: 2c20 6365 6e74 726f 6964 5f78 795b 315d  , centroid_xy[1]
-0000cf30: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0000cf40: 2020 2020 2020 2020 5d29 290a 2020 2020          ])).    
-0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf60: 6172 6561 732e 6170 7065 6e64 2870 2e61  areas.append(p.a
-0000cf70: 7265 6129 0a20 2020 2020 2020 2020 2020  rea).           
-0000cf80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000cf90: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
-0000cfa0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0000cfb0: 2020 2020 2020 6172 6561 7320 3d20 5b5d        areas = []
-0000cfc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cfd0: 2070 6f6c 7967 6f6e 5f64 6963 7420 3d20   polygon_dict = 
-0000cfe0: 7365 6c66 2e67 6574 5f70 6f6c 7967 6f6e  self.get_polygon
-0000cff0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0000d000: 2020 2020 666f 7220 7a2c 2070 6f6c 7967      for z, polyg
-0000d010: 6f6e 7320 696e 2070 6f6c 7967 6f6e 5f64  ons in polygon_d
-0000d020: 6963 742e 6974 656d 7328 293a 0a20 2020  ict.items():.   
-0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d040: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
-0000d050: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0000d060: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-0000d070: 726f 6964 5f78 7920 3d20 702e 6365 6e74  roid_xy = p.cent
-0000d080: 726f 6964 2e78 790a 2020 2020 2020 2020  roid.xy.        
-0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0a0: 6365 6e74 726f 6964 732e 6170 7065 6e64  centroids.append
-0000d0b0: 286e 702e 6172 7261 7928 5b0a 2020 2020  (np.array([.    
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0d0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0000d0e0: 5f78 795b 305d 5b30 5d2c 2063 656e 7472  _xy[0][0], centr
-0000d0f0: 6f69 645f 7879 5b31 5d5b 305d 2c20 7a0a  oid_xy[1][0], z.
-0000d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d110: 2020 2020 2020 2020 5d29 290a 2020 2020          ])).    
+000095b0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+000095c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095d0: 2020 2023 2043 6f6d 7075 7465 206f 7665     # Compute ove
+000095e0: 726c 6170 0a20 2020 2020 2020 2020 2020  rlap.           
+000095f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009600: 206f 7665 726c 6170 203d 2070 6f6c 7967   overlap = polyg
+00009610: 6f6e 2e69 6e74 6572 7365 6374 696f 6e28  on.intersection(
+00009620: 7069 7865 6c29 2e61 7265 610a 2020 2020  pixel).area.    
+00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009640: 2020 2020 2020 2020 6d61 736b 5b69 782c          mask[ix,
+00009650: 2069 795d 203d 206f 7665 726c 6170 203e   iy] = overlap >
+00009660: 2073 656c 662e 6f76 6572 6c61 705f 6c65   self.overlap_le
+00009670: 7665 6c0a 0a20 2020 2020 2020 2020 2020  vel..           
+00009680: 2020 2020 2020 2020 2023 2041 6464 2074           # Add t
+00009690: 6f20 3344 206d 6173 6b0a 2020 2020 2020  o 3D mask.      
+000096a0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000096b0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000096c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000096d0: 6d61 736b 2e64 6174 615b 3a2c 203a 2c20  mask.data[:, :, 
+000096e0: 697a 5d20 2b3d 206d 6173 6b2e 540a 2020  iz] += mask.T.  
+000096f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009700: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
+00009710: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00009720: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00009730: 730a 0a20 2020 2020 2020 2023 2043 6f6e  s..        # Con
+00009740: 7665 7274 2074 6f20 626f 6f6c 6561 6e20  vert to boolean 
+00009750: 6d61 736b 0a20 2020 2020 2020 2069 6620  mask.        if 
+00009760: 6861 7361 7474 7228 7365 6c66 2e6d 6173  hasattr(self.mas
+00009770: 6b2c 2022 6461 7461 2229 3a0a 2020 2020  k, "data"):.    
+00009780: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00009790: 656c 662e 6d61 736b 2e64 6174 612e 6474  elf.mask.data.dt
+000097a0: 7970 6520 3d3d 2062 6f6f 6c3a 0a20 2020  ype == bool:.   
+000097b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000097c0: 662e 6d61 736b 2e64 6174 6120 3d20 7365  f.mask.data = se
+000097d0: 6c66 2e6d 6173 6b2e 6461 7461 2e61 7374  lf.mask.data.ast
+000097e0: 7970 6528 626f 6f6c 290a 2020 2020 2020  ype(bool).      
+000097f0: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
+00009800: 645f 6d61 736b 203d 2054 7275 650a 0a20  d_mask = True.. 
+00009810: 2020 2020 2020 2023 2053 6574 206f 776e         # Set own
+00009820: 2067 656f 6d65 7472 6963 2070 726f 7065   geometric prope
+00009830: 7274 6965 7320 6672 6f6d 206d 6173 6b0a  rties from mask.
+00009840: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
+00009850: 656c 5f73 697a 6520 3d20 7365 6c66 2e6d  el_size = self.m
+00009860: 6173 6b2e 6765 745f 766f 7865 6c5f 7369  ask.get_voxel_si
+00009870: 7a65 2829 0a20 2020 2020 2020 2073 656c  ze().        sel
+00009880: 662e 6f72 6967 696e 203d 2073 656c 662e  f.origin = self.
+00009890: 6d61 736b 2e67 6574 5f6f 7269 6769 6e28  mask.get_origin(
+000098a0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000098b0: 6666 696e 6520 3d20 7365 6c66 2e6d 6173  ffine = self.mas
+000098c0: 6b2e 6765 745f 6166 6669 6e65 2829 0a20  k.get_affine(). 
+000098d0: 2020 2020 2020 2073 656c 662e 7368 6170         self.shap
+000098e0: 6520 3d20 7365 6c66 2e6d 6173 6b2e 6765  e = self.mask.ge
+000098f0: 745f 6461 7461 2829 2e73 6861 7065 0a0a  t_data().shape..
+00009900: 2020 2020 6465 6620 6973 5f65 6d70 7479      def is_empty
+00009910: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00009920: 2222 2243 6865 636b 2077 6865 7468 6572  """Check whether
+00009930: 2074 6869 7320 524f 4920 6973 2065 6d70   this ROI is emp
+00009940: 7479 2e22 2222 0a0a 2020 2020 2020 2020  ty."""..        
+00009950: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00009960: 2020 2020 6966 2073 656c 662e 6465 6661      if self.defa
+00009970: 756c 745f 6765 6f6d 5f6d 6574 686f 6420  ult_geom_method 
+00009980: 3d3d 2022 636f 6e74 6f75 7222 3a0a 2020  == "contour":.  
+00009990: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000099a0: 206e 6f74 2062 6f6f 6c28 6c65 6e28 7365   not bool(len(se
+000099b0: 6c66 2e67 6574 5f63 6f6e 746f 7572 7328  lf.get_contours(
+000099c0: 2278 2d79 2229 2929 0a20 2020 2020 2020  "x-y"))).       
+000099d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000099e0: 2020 2072 6574 7572 6e20 6e6f 7420 6e70     return not np
+000099f0: 2e61 6e79 2873 656c 662e 6765 745f 6d61  .any(self.get_ma
+00009a00: 736b 2829 290a 0a20 2020 2064 6566 2072  sk())..    def r
+00009a10: 6573 616d 706c 6528 7365 6c66 2c20 2a61  esample(self, *a
+00009a20: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00009a30: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
+00009a40: 6174 655f 6d61 736b 2829 0a20 2020 2020  ate_mask().     
+00009a50: 2020 2073 656c 662e 6d61 736b 2e72 6573     self.mask.res
+00009a60: 616d 706c 6528 2a61 7267 732c 202a 2a6b  ample(*args, **k
+00009a70: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+00009a80: 6d61 7463 685f 766f 7865 6c5f 7369 7a65  match_voxel_size
+00009a90: 2873 656c 662c 206f 7468 6572 2c20 2a61  (self, other, *a
+00009aa0: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00009ab0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00009ac0: 7374 616e 6365 286f 7468 6572 2c20 524f  stance(other, RO
+00009ad0: 4929 3a0a 2020 2020 2020 2020 2020 2020  I):.            
+00009ae0: 6f74 6865 722e 6372 6561 7465 5f6d 6173  other.create_mas
+00009af0: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
+00009b00: 6d61 736b 203d 206f 7468 6572 2e6d 6173  mask = other.mas
+00009b10: 6b0a 2020 2020 2020 2020 656c 7365 3a0a  k.        else:.
+00009b20: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00009b30: 203d 206f 7468 6572 0a20 2020 2020 2020   = other.       
+00009b40: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
+00009b50: 6b28 290a 2020 2020 2020 2020 7365 6c66  k().        self
+00009b60: 2e6d 6173 6b2e 6d61 7463 685f 766f 7865  .mask.match_voxe
+00009b70: 6c5f 7369 7a65 286d 6173 6b2c 202a 6172  l_size(mask, *ar
+00009b80: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
+00009b90: 2020 2064 6566 2067 6574 5f73 6c69 6365     def get_slice
+00009ba0: 2873 656c 662c 202a 6172 6773 2c20 666f  (self, *args, fo
+00009bb0: 7263 655f 7374 616e 6461 7264 6973 653d  rce_standardise=
+00009bc0: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
+00009bd0: 3a0a 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00009be0: 6372 6561 7465 5f6d 6173 6b28 290a 2020  create_mask().  
+00009bf0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
+00009c00: 662e 6d61 736b 2e67 6574 5f73 6c69 6365  f.mask.get_slice
+00009c10: 282a 6172 6773 2c20 666f 7263 655f 7374  (*args, force_st
+00009c20: 616e 6461 7264 6973 653d 666f 7263 655f  andardise=force_
+00009c30: 7374 616e 6461 7264 6973 652c 200a 2020  standardise, .  
+00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c60: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+00009c70: 2020 2069 6620 6461 7461 2e64 7479 7065     if data.dtype
+00009c80: 2021 3d20 626f 6f6c 3a0a 2020 2020 2020   != bool:.      
+00009c90: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+00009ca0: 612e 6173 7479 7065 2862 6f6f 6c29 0a20  a.astype(bool). 
+00009cb0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+00009cc0: 7461 0a0a 2020 2020 6465 6620 6765 745f  ta..    def get_
+00009cd0: 726f 695f 736c 6963 6528 7365 6c66 2c20  roi_slice(self, 
+00009ce0: 7a5f 6672 6163 7469 6f6e 3d31 2c20 7375  z_fraction=1, su
+00009cf0: 6666 6978 3d4e 6f6e 6529 3a0a 2020 2020  ffix=None):.    
+00009d00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00009d10: 4765 7420 524f 4920 6f62 6a65 6374 2063  Get ROI object c
+00009d20: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
+00009d30: 782d 7920 736c 6963 6520 7468 726f 7567  x-y slice throug
+00009d40: 6820 7468 6973 2052 4f49 2e0a 0a20 2020  h this ROI...   
+00009d50: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00009d60: 3a2a 2a0a 0a20 2020 2020 2020 207a 5f66  :**..        z_f
+00009d70: 7261 6374 696f 6e20 3a20 666c 6f61 742c  raction : float,
+00009d80: 2064 6566 6175 6c74 3d31 0a20 2020 2020   default=1.     
+00009d90: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
+00009da0: 616c 6f6e 6720 7a20 6178 6973 2061 7420  along z axis at 
+00009db0: 7768 6963 6820 746f 2074 616b 6520 736c  which to take sl
+00009dc0: 6963 6520 7468 726f 7567 6820 524f 492e  ice through ROI.
+00009dd0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00009de0: 2070 6f73 6974 696f 6e20 6973 2073 7065   position is spe
+00009df0: 6369 6669 6564 2061 7320 7468 6520 6672  cified as the fr
+00009e00: 6163 7469 6f6e 616c 2064 6973 7461 6e63  actional distanc
+00009e10: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
+00009e20: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
+00009e30: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
+00009e40: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
+00009e50: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
+00009e60: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
+00009e70: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
+00009e80: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
+00009e90: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
+00009ea0: 2020 2020 6d6f 7374 2d73 7570 6572 696f      most-superio
+00009eb0: 7220 706f 696e 7420 2868 6967 6865 7374  r point (highest
+00009ec0: 207a 292e 2020 5661 6c75 6573 2066 6f72   z).  Values for
+00009ed0: 207a 5f66 7261 6374 696f 6e0a 2020 2020   z_fraction.    
+00009ee0: 2020 2020 2020 2020 6f75 7473 6964 6520          outside 
+00009ef0: 7468 6520 696e 7465 7276 616c 205b 302c  the interval [0,
+00009f00: 2031 5d20 7265 7375 6c74 2069 6e20 6120   1] result in a 
+00009f10: 5275 6e74 696d 6545 7272 6f72 2e0a 0a20  RuntimeError... 
+00009f20: 2020 2073 7566 6669 7820 3a20 7374 722c     suffix : str,
+00009f30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00009f40: 2020 2020 2020 5375 6666 6978 2074 6f20        Suffix to 
+00009f50: 6170 7065 6e64 2074 6f20 6f77 6e20 6e61  append to own na
+00009f60: 6d65 2c20 746f 2066 6f72 6d20 6e61 6d65  me, to form name
+00009f70: 206f 6620 6f75 7470 7574 2052 4f49 2e20   of output ROI. 
+00009f80: 2049 660a 2020 2020 2020 2020 4e6f 6e65   If.        None
+00009f90: 2c20 6170 7065 6e64 207a 5f66 7261 6374  , append z_fract
+00009fa0: 696f 6e2c 2077 6974 6820 7661 6c75 6520  ion, with value 
+00009fb0: 6769 7665 6e20 746f 2074 776f 2064 6563  given to two dec
+00009fc0: 696d 616c 2070 6c61 6365 732e 0a20 2020  imal places..   
+00009fd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00009fe0: 2072 6574 7572 6e20 6765 745f 726f 695f   return get_roi_
+00009ff0: 736c 6963 6528 7365 6c66 2c20 7a5f 6672  slice(self, z_fr
+0000a000: 6163 7469 6f6e 290a 0a20 2020 2064 6566  action)..    def
+0000a010: 2067 6574 5f69 6e64 6963 6573 2873 656c   get_indices(sel
+0000a020: 662c 2076 6965 773d 2278 2d79 222c 206d  f, view="x-y", m
+0000a030: 6574 686f 643d 4e6f 6e65 293a 0a20 2020  ethod=None):.   
+0000a040: 2020 2020 2022 2222 4765 7420 6c69 7374       """Get list
+0000a050: 206f 6620 736c 6963 6520 696e 6469 6365   of slice indice
+0000a060: 7320 6f6e 2077 6869 6368 2074 6869 7320  s on which this 
+0000a070: 524f 4920 6578 6973 7473 2e22 2222 0a0a  ROI exists."""..
+0000a080: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0000a090: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
+0000a0a0: 656c 662e 656d 7074 793a 0a20 2020 2020  elf.empty:.     
+0000a0b0: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
+0000a0c0: 0a0a 2020 2020 2020 2020 6966 206d 6574  ..        if met
+0000a0d0: 686f 6420 6973 204e 6f6e 653a 0a20 2020  hod is None:.   
+0000a0e0: 2020 2020 2020 2020 206d 6574 686f 6420           method 
+0000a0f0: 3d20 7365 6c66 2e64 6566 6175 6c74 5f67  = self.default_g
+0000a100: 656f 6d5f 6d65 7468 6f64 0a0a 2020 2020  eom_method..    
+0000a110: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
+0000a120: 2022 636f 6e74 6f75 7222 3a0a 2020 2020   "contour":.    
+0000a130: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0000a140: 6973 7428 7365 6c66 2e67 6574 5f63 6f6e  ist(self.get_con
+0000a150: 746f 7572 7328 7669 6577 2c20 6964 785f  tours(view, idx_
+0000a160: 6173 5f6b 6579 3d54 7275 6529 2e6b 6579  as_key=True).key
+0000a170: 7328 2929 0a20 2020 2020 2020 2065 6c73  s()).        els
+0000a180: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
+0000a190: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
+0000a1a0: 736c 6963 655f 6178 6573 5b76 6965 775d  slice_axes[view]
+0000a1b0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+0000a1c0: 6b20 3d20 7365 6c66 2e67 6574 5f6d 6173  k = self.get_mas
+0000a1d0: 6b28 7374 616e 6461 7264 6973 653d 5472  k(standardise=Tr
+0000a1e0: 7565 292e 7472 616e 7370 6f73 6528 312c  ue).transpose(1,
+0000a1f0: 2030 2c20 3229 0a20 2020 2020 2020 2020   0, 2).         
+0000a200: 2020 2072 6574 7572 6e20 6c69 7374 286e     return list(n
+0000a210: 702e 756e 6971 7565 286e 702e 6172 6777  p.unique(np.argw
+0000a220: 6865 7265 286d 6173 6b29 5b3a 2c20 6178  here(mask)[:, ax
+0000a230: 5d29 290a 0a20 2020 2064 6566 2067 6574  ]))..    def get
+0000a240: 5f6d 6964 5f69 6478 2873 656c 662c 2076  _mid_idx(self, v
+0000a250: 6965 773d 2278 2d79 222c 202a 2a6b 7761  iew="x-y", **kwa
+0000a260: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+0000a270: 2247 6574 2063 656e 7472 616c 2073 6c69  "Get central sli
+0000a280: 6365 2069 6e64 6578 206f 6620 7468 6973  ce index of this
+0000a290: 2052 4f49 2069 6e20 6120 6769 7665 6e20   ROI in a given 
+0000a2a0: 6f72 6965 6e74 6174 696f 6e2e 2222 220a  orientation.""".
+0000a2b0: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+0000a2c0: 203d 2073 656c 662e 6765 745f 696e 6469   = self.get_indi
+0000a2d0: 6365 7328 7669 6577 2c20 2a2a 6b77 6172  ces(view, **kwar
+0000a2e0: 6773 290a 2020 2020 2020 2020 6966 206e  gs).        if n
+0000a2f0: 6f74 206c 656e 2869 6e64 6963 6573 293a  ot len(indices):
+0000a300: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000a310: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+0000a320: 206d 6964 203d 2069 6e74 286c 656e 2869   mid = int(len(i
+0000a330: 6e64 6963 6573 2920 2f20 3229 0a20 2020  ndices) / 2).   
+0000a340: 2020 2020 2072 6574 7572 6e20 696e 6469       return indi
+0000a350: 6365 735b 6d69 645d 0a0a 2020 2020 6465  ces[mid]..    de
+0000a360: 6620 6964 785f 746f 5f70 6f73 2873 656c  f idx_to_pos(sel
+0000a370: 662c 2069 6478 2c20 6178 2c20 7374 616e  f, idx, ax, stan
+0000a380: 6461 7264 6973 653d 5472 7565 293a 0a20  dardise=True):. 
+0000a390: 2020 2020 2020 2022 2222 436f 6e76 6572         """Conver
+0000a3a0: 7420 616e 2061 7272 6179 2069 6e64 6578  t an array index
+0000a3b0: 2074 6f20 6120 706f 7369 7469 6f6e 2069   to a position i
+0000a3c0: 6e20 6d6d 2061 6c6f 6e67 2061 2067 6976  n mm along a giv
+0000a3d0: 656e 2061 7869 732e 2222 220a 0a20 2020  en axis."""..   
+0000a3e0: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
+0000a3f0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000a400: 662e 636f 6e74 6f75 7273 5f6f 6e6c 793a  f.contours_only:
+0000a410: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000a420: 5573 6520 7365 6c66 2e69 6d61 6765 2773  Use self.image's
+0000a430: 2063 6f6e 7665 7273 696f 6e20 6675 6e63   conversion func
+0000a440: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+0000a450: 2069 6620 7365 6c66 2e69 6d61 6765 2069   if self.image i
+0000a460: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000a470: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a480: 726e 2073 656c 662e 696d 6167 652e 6964  rn self.image.id
+0000a490: 785f 746f 5f70 6f73 2869 6478 2c20 6178  x_to_pos(idx, ax
+0000a4a0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0000a4b0: 204f 7468 6572 7769 7365 2063 6f75 6e74   Otherwise count
+0000a4c0: 206e 756d 6265 7220 6f66 207a 2073 6c69   number of z sli
+0000a4d0: 6365 7320 696e 2063 6f6e 746f 7572 7320  ces in contours 
+0000a4e0: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
+0000a4f0: 2023 2049 6620 696e 6465 7820 646f 6573   # If index does
+0000a500: 206e 6f74 2063 6f72 7265 7370 6f6e 6420   not correspond 
+0000a510: 746f 2061 2073 6c69 6365 2c20 7265 7475  to a slice, retu
+0000a520: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+0000a530: 2020 2020 656c 6966 2061 7820 696e 205b      elif ax in [
+0000a540: 227a 222c 2032 5d3a 0a20 2020 2020 2020  "z", 2]:.       
+0000a550: 2020 2020 2020 2020 2063 6f6e 7665 7273           convers
+0000a560: 696f 6e20 3d20 7b69 3a20 7020 666f 7220  ion = {i: p for 
+0000a570: 692c 2070 2069 6e20 0a20 2020 2020 2020  i, p in .       
+0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a590: 2020 2020 2020 2065 6e75 6d65 7261 7465         enumerate
+0000a5a0: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
+0000a5b0: 7273 2822 782d 7922 292e 6b65 7973 2829  rs("x-y").keys()
+0000a5c0: 297d 0a20 2020 2020 2020 2020 2020 2020  )}.             
+0000a5d0: 2020 2072 6574 7572 6e20 636f 6e76 6572     return conver
+0000a5e0: 7369 6f6e 2e67 6574 2869 6478 2c20 4e6f  sion.get(idx, No
+0000a5f0: 6e65 290a 0a20 2020 2020 2020 2020 2020  ne)..           
+0000a600: 2023 204f 7468 6572 7769 7365 2c20 6e6f   # Otherwise, no
+0000a610: 7420 706f 7373 6962 6c65 2074 6f20 636f  t possible to co
+0000a620: 6e76 6572 7420 782f 7920 706f 696e 7473  nvert x/y points
+0000a630: 2074 6f20 696e 6469 6365 730a 2020 2020   to indices.    
+0000a640: 2020 2020 2020 2020 2320 6672 6f6d 2063          # from c
+0000a650: 6f6e 746f 7572 7320 616c 6f6e 650a 2020  ontours alone.  
+0000a660: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a680: 7072 696e 7428 2257 6172 6e69 6e67 3a20  print("Warning: 
+0000a690: 6361 6e6e 6f74 2063 6f6e 7665 7274 2069  cannot convert i
+0000a6a0: 6e64 6578 2074 6f20 706f 7369 7469 6f6e  ndex to position
+0000a6b0: 2069 6e20 7468 6520 782f 7920 220a 2020   in the x/y ".  
+0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6d0: 2020 2020 2264 6972 6563 7469 6f6e 7320      "directions 
+0000a6e0: 7769 7468 6f75 7420 6173 736f 6369 6174  without associat
+0000a6f0: 6564 2069 6d61 6765 2067 656f 6d65 7472  ed image geometr
+0000a700: 7921 2229 0a20 2020 2020 2020 2020 2020  y!").           
+0000a710: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0000a720: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
+0000a730: 2c20 7472 7920 746f 2075 7365 206d 6173  , try to use mas
+0000a740: 6b20 6f72 2069 6d61 6765 2773 2063 6f6e  k or image's con
+0000a750: 7665 7273 696f 6e0a 2020 2020 2020 2020  version.        
+0000a760: 656c 6966 2073 656c 662e 6d61 736b 2069  elif self.mask i
+0000a770: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000a780: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000a790: 656c 662e 6d61 736b 2e69 6478 5f74 6f5f  elf.mask.idx_to_
+0000a7a0: 706f 7328 6964 782c 2061 7829 0a20 2020  pos(idx, ax).   
+0000a7b0: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
+0000a7c0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
+0000a7d0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000a7e0: 7475 726e 2073 656c 662e 696d 6167 652e  turn self.image.
+0000a7f0: 6964 785f 746f 5f70 6f73 2869 6478 2c20  idx_to_pos(idx, 
+0000a800: 6178 290a 0a20 2020 2020 2020 2023 2045  ax)..        # E
+0000a810: 6c73 652c 2074 7279 2074 6f20 6361 6c63  lse, try to calc
+0000a820: 756c 6174 6520 6672 6f6d 206f 776e 2067  ulate from own g
+0000a830: 656f 6d65 7472 6963 2070 726f 7065 7274  eometric propert
+0000a840: 6965 730a 2020 2020 2020 2020 656c 7365  ies.        else
+0000a850: 3a0a 2020 2020 2020 2020 2020 2020 695f  :.            i_
+0000a860: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
+0000a870: 5f61 7865 732e 696e 6465 7828 6178 2920  _axes.index(ax) 
+0000a880: 6966 2061 7820 696e 2073 6b72 742e 696d  if ax in skrt.im
+0000a890: 6167 652e 5f61 7865 7320 656c 7365 2061  age._axes else a
+0000a8a0: 780a 2020 2020 2020 2020 2020 2020 7265  x.            re
+0000a8b0: 7475 726e 2073 656c 662e 6f72 6967 696e  turn self.origin
+0000a8c0: 5b69 5f61 785d 202b 2069 6478 202a 2073  [i_ax] + idx * s
+0000a8d0: 656c 662e 766f 7865 6c5f 7369 7a65 5b69  elf.voxel_size[i
+0000a8e0: 5f61 785d 0a0a 2020 2020 6465 6620 706f  _ax]..    def po
+0000a8f0: 735f 746f 5f69 6478 2873 656c 662c 2070  s_to_idx(self, p
+0000a900: 6f73 2c20 6178 2c20 7265 7475 726e 5f69  os, ax, return_i
+0000a910: 6e74 3d54 7275 652c 202a 2a6b 7761 7267  nt=True, **kwarg
+0000a920: 7329 3a0a 2020 2020 2020 2020 2222 2243  s):.        """C
+0000a930: 6f6e 7665 7274 2061 2070 6f73 6974 696f  onvert a positio
+0000a940: 6e20 696e 206d 6d20 746f 2061 6e20 6172  n in mm to an ar
+0000a950: 7261 7920 696e 6465 7820 616c 6f6e 6720  ray index along 
+0000a960: 6120 6769 7665 6e20 6178 6973 2e22 2222  a given axis."""
+0000a970: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+0000a980: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
+0000a990: 2073 656c 662e 636f 6e74 6f75 7273 5f6f   self.contours_o
+0000a9a0: 6e6c 793a 0a0a 2020 2020 2020 2020 2020  nly:..          
+0000a9b0: 2020 2320 5573 6520 7365 6c66 2e69 6d61    # Use self.ima
+0000a9c0: 6765 2773 2063 6f6e 7665 7273 696f 6e20  ge's conversion 
+0000a9d0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
+0000a9e0: 2020 2020 2069 6620 7365 6c66 2e69 6d61       if self.ima
+0000a9f0: 6765 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ge is not None:.
+0000aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa10: 7265 7475 726e 2073 656c 662e 696d 6167  return self.imag
+0000aa20: 652e 706f 735f 746f 5f69 6478 2870 6f73  e.pos_to_idx(pos
+0000aa30: 2c20 6178 2c20 7265 7475 726e 5f69 6e74  , ax, return_int
+0000aa40: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0000aa50: 204f 7468 6572 7769 7365 2063 6f75 6e74   Otherwise count
+0000aa60: 206e 756d 6265 7220 6f66 207a 2073 6c69   number of z sli
+0000aa70: 6365 7320 696e 2063 6f6e 746f 7572 7320  ces in contours 
+0000aa80: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
+0000aa90: 2023 2049 6620 706f 7369 7469 6f6e 2064   # If position d
+0000aaa0: 6f65 7320 6e6f 7420 636f 7272 6573 706f  oes not correspo
+0000aab0: 6e64 2074 6f20 6120 736c 6965 2c20 7265  nd to a slie, re
+0000aac0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+0000aad0: 2020 2020 2020 656c 6966 2061 7820 696e        elif ax in
+0000aae0: 205b 227a 222c 2032 5d3a 0a20 2020 2020   ["z", 2]:.     
+0000aaf0: 2020 2020 2020 2020 2020 2063 6f6e 7665             conve
+0000ab00: 7273 696f 6e20 3d20 7b70 3a20 6920 666f  rsion = {p: i fo
+0000ab10: 7220 692c 2070 2069 6e20 0a20 2020 2020  r i, p in .     
+0000ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab30: 2020 2020 2020 2020 2065 6e75 6d65 7261           enumera
+0000ab40: 7465 2873 656c 662e 6765 745f 636f 6e74  te(self.get_cont
+0000ab50: 6f75 7273 2822 782d 7922 292e 6b65 7973  ours("x-y").keys
+0000ab60: 2829 297d 0a20 2020 2020 2020 2020 2020  ())}.           
+0000ab70: 2020 2020 2069 6478 203d 2063 6f6e 7665       idx = conve
+0000ab80: 7273 696f 6e2e 6765 7428 706f 732c 204e  rsion.get(pos, N
+0000ab90: 6f6e 6529 0a0a 2020 2020 2020 2020 2020  one)..          
+0000aba0: 2020 2320 4f74 6865 7277 6973 652c 206e    # Otherwise, n
+0000abb0: 6f74 2070 6f73 7369 626c 6520 746f 2063  ot possible to c
+0000abc0: 6f6e 7665 7274 2078 2f79 2070 6f69 6e74  onvert x/y point
+0000abd0: 7320 746f 2069 6e64 6963 6573 0a20 2020  s to indices.   
+0000abe0: 2020 2020 2020 2020 2023 2066 726f 6d20           # from 
+0000abf0: 636f 6e74 6f75 7273 2061 6c6f 6e65 0a20  contours alone. 
+0000ac00: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000ac10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ac20: 2070 7269 6e74 2822 5761 726e 696e 673a   print("Warning:
+0000ac30: 2063 616e 6e6f 7420 636f 6e76 6572 7420   cannot convert 
+0000ac40: 706f 7369 7469 6f6e 2074 6f20 696e 6465  position to inde
+0000ac50: 7820 696e 2074 6865 2078 2f79 2022 0a20  x in the x/y ". 
+0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac70: 2020 2020 2022 6469 7265 6374 696f 6e73       "directions
+0000ac80: 2077 6974 686f 7574 2061 7373 6f63 6961   without associa
+0000ac90: 7465 6420 696d 6167 6520 6765 6f6d 6574  ted image geomet
+0000aca0: 7279 2122 290a 2020 2020 2020 2020 2020  ry!").          
+0000acb0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0000acc0: 2020 2020 2020 2020 2069 6620 7265 7475           if retu
+0000acd0: 726e 5f69 6e74 2061 6e64 2069 6478 2069  rn_int and idx i
+0000ace0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000acf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000ad00: 726e 2072 6f75 6e64 2869 6478 290a 2020  rn round(idx).  
+0000ad10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad30: 7265 7475 726e 2069 6478 0a0a 2020 2020  return idx..    
+0000ad40: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
+0000ad50: 2074 7279 2074 6f20 7573 6520 6d61 736b   try to use mask
+0000ad60: 206f 7220 696d 6167 6527 7320 636f 6e76   or image's conv
+0000ad70: 6572 7369 6f6e 0a20 2020 2020 2020 2065  ersion.        e
+0000ad80: 6c69 6620 7365 6c66 2e6d 6173 6b20 6973  lif self.mask is
+0000ad90: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000ada0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000adb0: 6c66 2e6d 6173 6b2e 706f 735f 746f 5f69  lf.mask.pos_to_i
+0000adc0: 6478 2870 6f73 2c20 6178 2c20 7265 7475  dx(pos, ax, retu
+0000add0: 726e 5f69 6e74 290a 2020 2020 2020 2020  rn_int).        
+0000ade0: 656c 6966 2073 656c 662e 696d 6167 6520  elif self.image 
+0000adf0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000ae00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000ae10: 7365 6c66 2e69 6d61 6765 2e70 6f73 5f74  self.image.pos_t
+0000ae20: 6f5f 6964 7828 706f 732c 2061 782c 2072  o_idx(pos, ax, r
+0000ae30: 6574 7572 6e5f 696e 7429 0a0a 2020 2020  eturn_int)..    
+0000ae40: 2020 2020 2320 456c 7365 2c20 7472 7920      # Else, try 
+0000ae50: 746f 2063 616c 6375 6c61 7465 2066 726f  to calculate fro
+0000ae60: 6d20 6f77 6e20 6765 6f6d 7472 6963 2070  m own geomtric p
+0000ae70: 726f 7065 7274 6965 730a 2020 2020 2020  roperties.      
+0000ae80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ae90: 2020 2020 695f 6178 203d 2073 6b72 742e      i_ax = skrt.
+0000aea0: 696d 6167 652e 5f61 7865 732e 696e 6465  image._axes.inde
+0000aeb0: 7828 6178 2920 6966 2061 7820 696e 2073  x(ax) if ax in s
+0000aec0: 6b72 742e 696d 6167 652e 5f61 7865 7320  krt.image._axes 
+0000aed0: 656c 7365 2061 780a 2020 2020 2020 2020  else ax.        
+0000aee0: 2020 2020 6964 7820 3d20 2870 6f73 202d      idx = (pos -
+0000aef0: 2073 656c 662e 6f72 6967 696e 5b69 5f61   self.origin[i_a
+0000af00: 785d 2920 2f20 7365 6c66 2e76 6f78 656c  x]) / self.voxel
+0000af10: 5f73 697a 655b 695f 6178 5d0a 2020 2020  _size[i_ax].    
+0000af20: 2020 2020 2020 2020 6966 2072 6574 7572          if retur
+0000af30: 6e5f 696e 743a 0a20 2020 2020 2020 2020  n_int:.         
+0000af40: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
+0000af50: 756e 6428 6964 7829 0a20 2020 2020 2020  und(idx).       
+0000af60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000af70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000af80: 6e20 6964 780a 0a20 2020 2064 6566 2069  n idx..    def i
+0000af90: 6478 5f74 6f5f 736c 6963 6528 7365 6c66  dx_to_slice(self
+0000afa0: 2c20 6964 782c 2061 7829 3a0a 2020 2020  , idx, ax):.    
+0000afb0: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
+0000afc0: 6e20 6172 7261 7920 696e 6465 7820 746f  n array index to
+0000afd0: 2061 2073 6c69 6365 206e 756d 6265 7220   a slice number 
+0000afe0: 616c 6f6e 6720 6120 6769 7665 6e20 6178  along a given ax
+0000aff0: 6973 2e22 2222 0a0a 2020 2020 2020 2020  is."""..        
+0000b000: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+0000b010: 2020 2020 6966 2073 656c 662e 636f 6e74      if self.cont
+0000b020: 6f75 7273 5f6f 6e6c 7920 6f72 2028 7365  ours_only or (se
+0000b030: 6c66 2e6d 6173 6b20 6973 204e 6f6e 6520  lf.mask is None 
+0000b040: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
+0000b050: 7320 4e6f 6e65 293a 0a0a 2020 2020 2020  s None):..      
+0000b060: 2020 2020 2020 2320 436f 756e 7420 6e75        # Count nu
+0000b070: 6d62 6572 206f 6620 7a20 736c 6963 6573  mber of z slices
+0000b080: 2069 6e20 636f 6e74 6f75 7273 2064 6963   in contours dic
+0000b090: 740a 2020 2020 2020 2020 2020 2020 6966  t.            if
+0000b0a0: 2061 7820 696e 205b 227a 222c 2032 5d3a   ax in ["z", 2]:
+0000b0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b0c0: 206e 7a20 3d20 7365 6c66 2e67 6574 5f6e   nz = self.get_n
+0000b0d0: 7a5f 636f 6e74 6f75 7273 2829 0a20 2020  z_contours().   
+0000b0e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000b0f0: 7572 6e20 6e7a 202d 2069 6478 0a20 2020  urn nz - idx.   
+0000b100: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000b110: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000b120: 6574 7572 6e20 6964 7820 2b20 310a 0a20  eturn idx + 1.. 
+0000b130: 2020 2020 2020 2023 2054 7279 2074 6f20         # Try to 
+0000b140: 7573 6520 6d61 736b 206f 7220 696d 6167  use mask or imag
+0000b150: 6527 7320 636f 6e76 6572 7369 6f6e 0a20  e's conversion. 
+0000b160: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000b170: 2e6d 6173 6b20 6973 206e 6f74 204e 6f6e  .mask is not Non
+0000b180: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000b190: 6574 7572 6e20 7365 6c66 2e6d 6173 6b2e  eturn self.mask.
+0000b1a0: 6964 785f 746f 5f73 6c69 6365 2869 6478  idx_to_slice(idx
+0000b1b0: 2c20 6178 290a 2020 2020 2020 2020 656c  , ax).        el
+0000b1c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000b1d0: 7265 7475 726e 2073 656c 662e 696d 6167  return self.imag
+0000b1e0: 652e 6964 785f 746f 5f73 6c69 6365 2869  e.idx_to_slice(i
+0000b1f0: 6478 2c20 6178 290a 0a20 2020 2064 6566  dx, ax)..    def
+0000b200: 2073 6c69 6365 5f74 6f5f 6964 7828 7365   slice_to_idx(se
+0000b210: 6c66 2c20 736c 2c20 6178 293a 0a20 2020  lf, sl, ax):.   
+0000b220: 2020 2020 2022 2222 436f 6e76 6572 7420       """Convert 
+0000b230: 6120 736c 6963 6520 6e75 6d62 6572 2074  a slice number t
+0000b240: 6f20 616e 2061 7272 6179 2069 6e64 6578  o an array index
+0000b250: 2e22 2222 0a0a 2020 2020 2020 2020 7365  ."""..        se
+0000b260: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
+0000b270: 2020 6966 2073 656c 662e 636f 6e74 6f75    if self.contou
+0000b280: 7273 5f6f 6e6c 7920 6f72 2028 7365 6c66  rs_only or (self
+0000b290: 2e6d 6173 6b20 6973 204e 6f6e 6520 616e  .mask is None an
+0000b2a0: 6420 7365 6c66 2e69 6d61 6765 2069 7320  d self.image is 
+0000b2b0: 4e6f 6e65 293a 0a0a 2020 2020 2020 2020  None):..        
+0000b2c0: 2020 2020 2320 436f 756e 7420 6e75 6d62      # Count numb
+0000b2d0: 6572 206f 6620 7a20 736c 6963 6573 2069  er of z slices i
+0000b2e0: 6e20 636f 6e74 6f75 7273 2064 6963 740a  n contours dict.
+0000b2f0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+0000b300: 7820 696e 205b 227a 222c 2032 5d3a 0a20  x in ["z", 2]:. 
+0000b310: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000b320: 7a20 3d20 7365 6c66 2e67 6574 5f6e 7a5f  z = self.get_nz_
+0000b330: 636f 6e74 6f75 7273 2829 0a20 2020 2020  contours().     
+0000b340: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000b350: 6e20 6e7a 202d 2073 6c0a 2020 2020 2020  n nz - sl.      
+0000b360: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000b370: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000b380: 726e 2073 6c20 2d20 310a 0a20 2020 2020  rn sl - 1..     
+0000b390: 2020 2023 2054 7279 2074 6f20 7573 6520     # Try to use 
+0000b3a0: 6d61 736b 206f 7220 696d 6167 6527 7320  mask or image's 
+0000b3b0: 636f 6e76 6572 7369 6f6e 0a20 2020 2020  conversion.     
+0000b3c0: 2020 2065 6c69 6620 7365 6c66 2e6d 6173     elif self.mas
+0000b3d0: 6b20 6973 206e 6f74 204e 6f6e 653a 0a20  k is not None:. 
+0000b3e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000b3f0: 6e20 7365 6c66 2e6d 6173 6b2e 736c 6963  n self.mask.slic
+0000b400: 655f 746f 5f69 6478 2873 6c2c 2061 7829  e_to_idx(sl, ax)
+0000b410: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000b420: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000b430: 6e20 7365 6c66 2e69 6d61 6765 2e73 6c69  n self.image.sli
+0000b440: 6365 5f74 6f5f 6964 7828 736c 2c20 6178  ce_to_idx(sl, ax
+0000b450: 290a 0a20 2020 2064 6566 2070 6f73 5f74  )..    def pos_t
+0000b460: 6f5f 736c 6963 6528 7365 6c66 2c20 706f  o_slice(self, po
+0000b470: 732c 2061 782c 2072 6574 7572 6e5f 696e  s, ax, return_in
+0000b480: 743d 5472 7565 2c20 7374 616e 6461 7264  t=True, standard
+0000b490: 6973 653d 5472 7565 293a 0a20 2020 2020  ise=True):.     
+0000b4a0: 2020 2022 2222 436f 6e76 6572 7420 6120     """Convert a 
+0000b4b0: 706f 7369 7469 6f6e 2069 6e20 6d6d 2074  position in mm t
+0000b4c0: 6f20 6120 736c 6963 6520 6e75 6d62 6572  o a slice number
+0000b4d0: 2061 6c6f 6e67 2061 2067 6976 656e 2061   along a given a
+0000b4e0: 7869 732e 2222 220a 0a20 2020 2020 2020  xis."""..       
+0000b4f0: 2072 6574 7572 6e20 736b 7274 2e69 6d61   return skrt.ima
+0000b500: 6765 2e49 6d61 6765 2e70 6f73 5f74 6f5f  ge.Image.pos_to_
+0000b510: 736c 6963 6528 7365 6c66 2c20 706f 732c  slice(self, pos,
+0000b520: 2061 782c 2072 6574 7572 6e5f 696e 7429   ax, return_int)
+0000b530: 0a0a 2020 2020 6465 6620 736c 6963 655f  ..    def slice_
+0000b540: 746f 5f70 6f73 2873 656c 662c 2073 6c2c  to_pos(self, sl,
+0000b550: 2061 782c 2073 7461 6e64 6172 6469 7365   ax, standardise
+0000b560: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0000b570: 2222 2243 6f6e 7665 7274 2061 2073 6c69  """Convert a sli
+0000b580: 6365 206e 756d 6265 7220 746f 2061 2070  ce number to a p
+0000b590: 6f73 6974 696f 6e20 696e 206d 6d20 616c  osition in mm al
+0000b5a0: 6f6e 6720 6120 6769 7665 6e20 6178 6973  ong a given axis
+0000b5b0: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
+0000b5c0: 7475 726e 2073 6b72 742e 696d 6167 652e  turn skrt.image.
+0000b5d0: 496d 6167 652e 736c 6963 655f 746f 5f70  Image.slice_to_p
+0000b5e0: 6f73 2873 656c 662c 2073 6c2c 2061 7829  os(self, sl, ax)
+0000b5f0: 0a0a 2020 2020 6465 6620 6765 745f 6964  ..    def get_id
+0000b600: 7828 7365 6c66 2c20 7669 6577 2c20 736c  x(self, view, sl
+0000b610: 3d4e 6f6e 652c 2069 6478 3d4e 6f6e 652c  =None, idx=None,
+0000b620: 2070 6f73 3d4e 6f6e 6529 3a0a 2020 2020   pos=None):.    
+0000b630: 2020 2020 2222 2247 6574 2061 6e20 6172      """Get an ar
+0000b640: 7261 7920 696e 6465 7820 6672 6f6d 2065  ray index from e
+0000b650: 6974 6865 7220 6120 736c 6963 6520 6e75  ither a slice nu
+0000b660: 6d62 6572 2c20 696e 6465 782c 206f 720a  mber, index, or.
+0000b670: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+0000b680: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
+0000b690: 7475 726e 2073 6b72 742e 696d 6167 652e  turn skrt.image.
+0000b6a0: 496d 6167 652e 6765 745f 6964 7828 7365  Image.get_idx(se
+0000b6b0: 6c66 2c20 7669 6577 2c20 736c 3d73 6c2c  lf, view, sl=sl,
+0000b6c0: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
+0000b6d0: 7329 0a0a 2020 2020 6465 6620 6f6e 5f73  s)..    def on_s
+0000b6e0: 6c69 6365 2873 656c 662c 2076 6965 772c  lice(self, view,
+0000b6f0: 2073 6c3d 4e6f 6e65 2c20 6964 783d 4e6f   sl=None, idx=No
+0000b700: 6e65 2c20 706f 733d 4e6f 6e65 293a 0a20  ne, pos=None):. 
+0000b710: 2020 2020 2020 2022 2222 4368 6563 6b20         """Check 
+0000b720: 7768 6574 6865 7220 7468 6973 2052 4f49  whether this ROI
+0000b730: 2065 7869 7374 7320 6f6e 2061 2067 6976   exists on a giv
+0000b740: 656e 2073 6c69 6365 2e22 2222 0a0a 2020  en slice."""..  
+0000b750: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
+0000b760: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
+0000b770: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+0000b780: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000b790: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000b7a0: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
+0000b7b0: 2e67 6574 5f69 6478 2876 6965 772c 2073  .get_idx(view, s
+0000b7c0: 6c2c 2069 6478 2c20 706f 7329 0a20 2020  l, idx, pos).   
+0000b7d0: 2020 2020 2069 6620 6964 7820 6973 204e       if idx is N
+0000b7e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000b7f0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000b800: 2020 2020 2020 7265 7475 726e 2069 6478        return idx
+0000b810: 2069 6e20 7365 6c66 2e67 6574 5f69 6e64   in self.get_ind
+0000b820: 6963 6573 2876 6965 7729 0a0a 2020 2020  ices(view)..    
+0000b830: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
+0000b840: 706f 696e 7473 2873 656c 662c 206e 5f70  points(self, n_p
+0000b850: 6f69 6e74 3d4e 6f6e 652c 2064 7879 3d4e  oint=None, dxy=N
+0000b860: 6f6e 652c 0a20 2020 2020 2020 2073 6d6f  one,.        smo
+0000b870: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0000b880: 743d 3029 3a0a 2020 2020 2020 2020 2727  t=0):.        ''
+0000b890: 270a 2020 2020 2020 2020 5265 7475 726e  '.        Return
+0000b8a0: 206e 6577 2052 4f49 206f 626a 6563 742c   new ROI object,
+0000b8b0: 2077 6974 6820 696e 7465 7270 6f6c 6174   with interpolat
+0000b8c0: 6564 2063 6f6e 746f 7572 2070 6f69 6e74  ed contour point
+0000b8d0: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
+0000b8e0: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
+0000b8f0: 2020 2020 206e 5f70 6f69 6e74 203a 2069       n_point : i
+0000b900: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+0000b910: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
+0000b920: 6265 7220 6f66 2070 6f69 6e74 7320 7065  ber of points pe
+0000b930: 7220 636f 6e74 6f75 722c 2061 6674 6572  r contour, after
+0000b940: 2069 6e74 6572 706f 6c61 7469 6f6e 2e20   interpolation. 
+0000b950: 2054 6869 7320 6d75 7374 0a20 2020 2020   This must.     
+0000b960: 2020 2020 2020 2062 6520 7365 7420 746f         be set to
+0000b970: 204e 6f6e 6520 666f 7220 6478 7920 746f   None for dxy to
+0000b980: 2062 6520 636f 6e73 6964 6572 6564 2e0a   be considered..
+0000b990: 0a20 2020 2020 2020 2064 7879 203a 2066  .        dxy : f
+0000b9a0: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
+0000b9b0: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
+0000b9c0: 7070 726f 7869 6d61 7465 2064 6973 7461  pproximate dista
+0000b9d0: 6e63 6520 7265 7175 6972 6564 2062 6574  nce required bet
+0000b9e0: 7765 656e 2063 6f6e 746f 7572 2070 6f69  ween contour poi
+0000b9f0: 6e74 732e 2020 5468 6973 2069 7320 7461  nts.  This is ta
+0000ba00: 6b65 6e0a 2020 2020 2020 2020 2020 2020  ken.            
+0000ba10: 696e 746f 2061 6363 6f75 6e74 206f 6e6c  into account onl
+0000ba20: 7920 6966 206e 5f70 6f69 6e74 2069 7320  y if n_point is 
+0000ba30: 7365 7420 746f 204e 6f6e 652e 2020 466f  set to None.  Fo
+0000ba40: 7220 6120 636f 6e74 6f75 7220 6f66 0a20  r a contour of. 
+0000ba50: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
+0000ba60: 6820 636f 6e74 6f75 725f 6c65 6e67 7468  h contour_length
+0000ba70: 2c20 7468 6520 6e75 6d62 6572 206f 6620  , the number of 
+0000ba80: 636f 6e74 6f75 7220 706f 696e 7473 2069  contour points i
+0000ba90: 7320 7468 656e 2074 616b 656e 0a20 2020  s then taken.   
+0000baa0: 2020 2020 2020 2020 2074 6f20 6265 206d           to be m
+0000bab0: 6178 2869 6e74 2863 6f6e 746f 7572 5f6c  ax(int(contour_l
+0000bac0: 656e 6774 6820 2f20 6478 7929 2c20 3329  ength / dxy), 3)
+0000bad0: 2e20 200a 0a20 2020 2020 2020 2073 6d6f  .  ..        smo
+0000bae0: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0000baf0: 7420 3a20 666c 6f61 742c 2064 6566 6175  t : float, defau
+0000bb00: 6c74 3d30 0a20 2020 2020 2020 2020 2020  lt=0.           
+0000bb10: 2050 6172 616d 6574 6572 2064 6574 6572   Parameter deter
+0000bb20: 6d69 6e69 6e67 2074 6865 2073 6d6f 6f74  mining the smoot
+0000bb30: 686e 6573 7320 6f66 2074 6865 2042 2d73  hness of the B-s
+0000bb40: 706c 696e 6520 6375 7276 6520 7573 6564  pline curve used
+0000bb50: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+0000bb60: 636f 6e74 6f75 7220 6170 7072 6f78 696d  contour approxim
+0000bb70: 6174 696f 6e20 666f 7220 696e 7465 7270  ation for interp
+0000bb80: 6f6c 6174 696f 6e2e 2020 5468 6520 7072  olation.  The pr
+0000bb90: 6f64 7563 7420 6f66 0a20 2020 2020 2020  oduct of.       
+0000bba0: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
+0000bbb0: 7065 725f 706f 696e 7420 616e 6420 7468  per_point and th
+0000bbc0: 6520 6e75 6d62 6572 206f 6620 636f 6e74  e number of cont
+0000bbd0: 6f75 7220 706f 696e 7473 2028 7370 6563  our points (spec
+0000bbe0: 6966 6965 640a 2020 2020 2020 2020 2020  ified.          
+0000bbf0: 2020 6469 7265 6374 6c79 2076 6961 206e    directly via n
+0000bc00: 5f70 6f69 6e74 2c20 6f72 2069 6e64 6972  _point, or indir
+0000bc10: 6563 746c 7920 7669 6120 6478 7929 2063  ectly via dxy) c
+0000bc20: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
+0000bc30: 650a 2020 2020 2020 2020 2020 2020 7061  e.            pa
+0000bc40: 7261 6d65 7465 7220 7320 6f66 2073 6369  rameter s of sci
+0000bc50: 7079 2e69 6e74 6572 706f 6c61 7465 2e73  py.interpolate.s
+0000bc60: 706c 7072 6570 202d 2073 6565 2064 6f63  plprep - see doc
+0000bc70: 756d 656e 7461 7469 6f6e 2061 743a 0a20  umentation at:. 
+0000bc80: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0000bc90: 2020 2020 6874 7470 733a 2f2f 7363 6970      https://scip
+0000bca0: 792e 6769 7468 7562 2e69 6f2f 6465 7664  y.github.io/devd
+0000bcb0: 6f63 732f 7265 6665 7265 6e63 652f 6765  ocs/reference/ge
+0000bcc0: 6e65 7261 7465 642f 7363 6970 792e 696e  nerated/scipy.in
+0000bcd0: 7465 7270 6f6c 6174 652e 7370 6c70 7265  terpolate.splpre
+0000bce0: 702e 6874 6d6c 2373 6369 7079 2e69 6e74  p.html#scipy.int
+0000bcf0: 6572 706f 6c61 7465 2e73 706c 7072 6570  erpolate.splprep
+0000bd00: 0a0a 2020 2020 2020 2020 2020 2020 4120  ..            A 
+0000bd10: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
+0000bd20: 6f69 6e74 206f 6620 3020 666f 7263 6573  oint of 0 forces
+0000bd30: 2074 6865 2042 2d73 706c 696e 6520 746f   the B-spline to
+0000bd40: 2070 6173 7320 7468 726f 7567 680a 2020   pass through.  
+0000bd50: 2020 2020 2020 2020 2020 616c 6c20 6f66            all of
+0000bd60: 2074 6865 2070 7265 2d69 6e74 6572 706f   the pre-interpo
+0000bd70: 6c61 7469 6f6e 2063 6f6e 746f 7572 2070  lation contour p
+0000bd80: 6f69 6e74 732e 0a20 2020 2020 2020 2027  oints..        '
+0000bd90: 2727 0a0a 2020 2020 2020 2020 6e65 775f  ''..        new_
+0000bda0: 636f 6e74 6f75 7273 203d 207b 7d0a 2020  contours = {}.  
+0000bdb0: 2020 2020 2020 666f 7220 7a2c 2063 6f6e        for z, con
+0000bdc0: 746f 7572 7320 696e 2073 656c 662e 6765  tours in self.ge
+0000bdd0: 745f 636f 6e74 6f75 7273 2829 2e69 7465  t_contours().ite
+0000bde0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0000bdf0: 2020 6e65 775f 636f 6e74 6f75 7273 5b7a    new_contours[z
+0000be00: 5d20 3d20 5b5d 0a20 2020 2020 2020 2020  ] = [].         
+0000be10: 2020 2066 6f72 2063 6f6e 746f 7572 2069     for contour i
+0000be20: 6e20 636f 6e74 6f75 7273 3a0a 2020 2020  n contours:.    
+0000be30: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000be40: 636f 6e74 6f75 7220 3d20 696e 7465 7270  contour = interp
+0000be50: 6f6c 6174 655f 706f 696e 7473 5f73 696e  olate_points_sin
+0000be60: 676c 655f 636f 6e74 6f75 7228 0a20 2020  gle_contour(.   
+0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be80: 2020 2020 2063 6f6e 746f 7572 2c20 6e5f       contour, n_
+0000be90: 706f 696e 742c 2064 7879 2c20 736d 6f6f  point, dxy, smoo
+0000bea0: 7468 6e65 7373 5f70 6572 5f70 6f69 6e74  thness_per_point
+0000beb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000bec0: 2020 6e65 775f 636f 6e74 6f75 7273 5b7a    new_contours[z
+0000bed0: 5d2e 6170 7065 6e64 286e 6577 5f63 6f6e  ].append(new_con
+0000bee0: 746f 7572 290a 0a20 2020 2020 2020 2023  tour)..        #
+0000bef0: 2043 6c6f 6e65 2073 656c 662c 2074 6865   Clone self, the
+0000bf00: 6e20 636c 6561 7220 6d61 736b 2061 6e64  n clear mask and
+0000bf10: 2072 6573 6574 2063 6f6e 746f 7572 7320   reset contours 
+0000bf20: 6f66 2063 6c6f 6e65 0a20 2020 2020 2020  of clone.       
+0000bf30: 2072 6f69 203d 2052 4f49 2873 656c 6629   roi = ROI(self)
+0000bf40: 0a20 2020 2020 2020 2072 6f69 2e69 6e70  .        roi.inp
+0000bf50: 7574 5f63 6f6e 746f 7572 7320 3d20 6e65  ut_contours = ne
+0000bf60: 775f 636f 6e74 6f75 7273 0a20 2020 2020  w_contours.     
+0000bf70: 2020 2072 6f69 2e63 6f6e 746f 7572 7320     roi.contours 
+0000bf80: 3d20 7b22 782d 7922 3a20 6e65 775f 636f  = {"x-y": new_co
+0000bf90: 6e74 6f75 7273 7d0a 2020 2020 2020 2020  ntours}.        
+0000bfa0: 726f 692e 6c6f 6164 6564 5f6d 6173 6b20  roi.loaded_mask 
+0000bfb0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0000bfc0: 726f 692e 6d61 736b 203d 204e 6f6e 650a  roi.mask = None.
+0000bfd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000bfe0: 726f 690a 0a20 2020 2064 6566 2067 6574  roi..    def get
+0000bff0: 5f63 656e 7472 6f69 6428 0a20 2020 2020  _centroid(.     
+0000c000: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000c010: 2076 6965 773d 2278 2d79 222c 0a20 2020   view="x-y",.   
+0000c020: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+0000c030: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+0000c040: 2073 6c3d 4e6f 6e65 2c0a 2020 2020 2020   sl=None,.      
+0000c050: 2020 6964 783d 4e6f 6e65 2c0a 2020 2020    idx=None,.    
+0000c060: 2020 2020 706f 733d 4e6f 6e65 2c0a 2020      pos=None,.  
+0000c070: 2020 2020 2020 756e 6974 733d 226d 6d22        units="mm"
+0000c080: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
+0000c090: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
+0000c0a0: 6f72 6365 3d54 7275 652c 0a20 2020 2029  orce=True,.    )
+0000c0b0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+0000c0c0: 2065 6974 6865 7220 3344 2067 6c6f 6261   either 3D globa
+0000c0d0: 6c20 6365 6e74 726f 6964 2070 6f73 6974  l centroid posit
+0000c0e0: 696f 6e20 6f72 2032 4420 6365 6e74 726f  ion or 2D centro
+0000c0f0: 6964 2070 6f73 6974 696f 6e20 6f6e 200a  id position on .
+0000c100: 2020 2020 2020 2020 6120 7369 6e67 6c65          a single
+0000c110: 2073 6c69 6365 2e20 4966 2073 696e 676c   slice. If singl
+0000c120: 655f 736c 6963 653d 4661 6c73 652c 2074  e_slice=False, t
+0000c130: 6865 2063 616c 6375 6c61 7465 6420 676c  he calculated gl
+0000c140: 6f62 616c 2063 656e 7472 6f69 6420 0a20  obal centroid . 
+0000c150: 2020 2020 2020 2077 696c 6c20 6265 2063         will be c
+0000c160: 6163 6865 6420 696e 2073 656c 662e 5f63  ached in self._c
+0000c170: 656e 7472 6f69 645b 756e 6974 735d 2061  entroid[units] a
+0000c180: 6e64 2072 6574 7572 6e65 6420 6966 2063  nd returned if c
+0000c190: 616c 6c65 6420 6167 6169 6e2c 0a20 2020  alled again,.   
+0000c1a0: 2020 2020 2075 6e6c 6573 7320 666f 7263       unless forc
+0000c1b0: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
+0000c1c0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0000c1d0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0000c1e0: 2020 7369 6e67 6c65 5f73 6c69 6365 203a    single_slice :
+0000c1f0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+0000c200: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0000c210: 2049 6620 4661 6c73 652c 2074 6865 2067   If False, the g
+0000c220: 6c6f 6261 6c20 3344 2063 656e 7472 6f69  lobal 3D centroi
+0000c230: 6420 6f66 2074 6865 2065 6e74 6972 6520  d of the entire 
+0000c240: 524f 4920 7769 6c6c 2062 6520 7265 7475  ROI will be retu
+0000c250: 726e 6564 3b0a 2020 2020 2020 2020 2020  rned;.          
+0000c260: 2020 6f74 6865 7277 6973 652c 2074 6865    otherwise, the
+0000c270: 2032 4420 6365 6e74 726f 6964 206f 6e20   2D centroid on 
+0000c280: 6120 7369 6e67 6c65 2073 6c69 6365 2077  a single slice w
+0000c290: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+0000c2a0: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
+0000c2b0: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
+0000c2c0: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
+0000c2d0: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
+0000c2e0: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
+0000c2f0: 2067 6574 2063 656e 7472 6f69 642e 204f   get centroid. O
+0000c300: 6e6c 7920 7573 6564 2069 6620 0a20 2020  nly used if .   
+0000c310: 2020 2020 2020 2020 2073 696e 676c 655f           single_
+0000c320: 736c 6963 653d 5472 7565 2e20 4966 2075  slice=True. If u
+0000c330: 7369 6e67 2c20 3c61 783e 206d 7573 7420  sing, <ax> must 
+0000c340: 6265 2061 6e20 6178 6973 2074 6861 7420  be an axis that 
+0000c350: 6c69 6573 2061 6c6f 6e67 0a20 2020 2020  lies along.     
+0000c360: 2020 2020 2020 2074 6865 2073 6c69 6365         the slice
+0000c370: 2069 6e20 7468 6973 206f 7269 656e 7461   in this orienta
+0000c380: 7469 6f6e 2e0a 0a20 2020 2020 2020 2073  tion...        s
+0000c390: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
+0000c3a0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0000c3b0: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
+0000c3c0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0000c3d0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0000c3e0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0000c3f0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0000c400: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0000c410: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0000c420: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+0000c430: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+0000c440: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
+0000c450: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+0000c460: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
+0000c470: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
+0000c480: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
+0000c490: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+0000c4a0: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
+0000c4b0: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
+0000c4c0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+0000c4d0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+0000c4e0: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+0000c4f0: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+0000c500: 642e 0a0a 2020 2020 2020 2020 706f 7320  d...        pos 
+0000c510: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0000c520: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0000c530: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
+0000c540: 2069 6e20 6d6d 2e20 4966 206e 6f6e 6520   in mm. If none 
+0000c550: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0000c560: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0000c570: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0000c580: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0000c590: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0000c5a0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0000c5b0: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
+0000c5c0: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+0000c5d0: 2075 6e69 7473 203a 2073 7472 2c20 6465   units : str, de
+0000c5e0: 6661 756c 743d 226d 6d22 0a20 2020 2020  fault="mm".     
+0000c5f0: 2020 2020 2020 2055 6e69 7473 206f 6620         Units of 
+0000c600: 6365 6e74 726f 6964 2e20 4361 6e20 6265  centroid. Can be
+0000c610: 2065 6974 6865 7220 6f66 3a0a 2020 2020   either of:.    
+0000c620: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
+0000c630: 6d22 3a20 7265 7475 726e 2063 656e 7472  m": return centr
+0000c640: 6f69 6420 706f 7369 7469 6f6e 2069 6e20  oid position in 
+0000c650: 6d69 6c6c 696d 6574 7265 732e 0a20 2020  millimetres..   
+0000c660: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+0000c670: 766f 7865 6c73 223a 2072 6574 7572 6e20  voxels": return 
+0000c680: 6365 6e74 726f 6964 2070 6f73 6974 696f  centroid positio
+0000c690: 6e20 696e 2074 6572 6d73 206f 6620 6172  n in terms of ar
+0000c6a0: 7261 7920 696e 6469 6365 732e 0a20 2020  ray indices..   
+0000c6b0: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+0000c6c0: 736c 6963 6522 3a20 7265 7475 726e 2063  slice": return c
+0000c6d0: 656e 7472 6f69 6420 706f 7369 7469 6f6e  entroid position
+0000c6e0: 2069 6e20 7465 726d 7320 6f66 2073 6c69   in terms of sli
+0000c6f0: 6365 206e 756d 6265 7273 2e0a 0a20 2020  ce numbers...   
+0000c700: 2020 2020 2020 2020 2049 6620 756e 6974           If unit
+0000c710: 733d 2276 6f78 656c 7322 206f 7220 2273  s="voxels" or "s
+0000c720: 6c69 6365 2220 6973 2072 6571 7565 7374  lice" is request
+0000c730: 6564 2062 7574 2074 6869 7320 524f 4920  ed but this ROI 
+0000c740: 6f6e 6c79 2068 6173 200a 2020 2020 2020  only has .      
+0000c750: 2020 2020 2020 636f 6e74 6f75 7273 2061        contours a
+0000c760: 6e64 206e 6f20 6d61 736b 2073 6861 7065  nd no mask shape
+0000c770: 2f76 6f78 656c 2073 697a 6520 696e 666f  /voxel size info
+0000c780: 726d 6174 696f 6e2c 2061 6e20 6572 726f  rmation, an erro
+0000c790: 7220 7769 6c6c 2062 6520 0a20 2020 2020  r will be .     
+0000c7a0: 2020 2020 2020 2072 6169 7365 6420 2875         raised (u
+0000c7b0: 6e6c 6573 7320 6178 3d22 7a22 2c20 696e  nless ax="z", in
+0000c7c0: 2077 6869 6368 2063 6173 6520 766f 7865   which case voxe
+0000c7d0: 6c20 7369 7a65 2077 696c 6c20 6265 2069  l size will be i
+0000c7e0: 6e66 6572 7265 6420 0a20 2020 2020 2020  nferred .       
+0000c7f0: 2020 2020 2066 726f 6d20 7370 6163 696e       from spacin
+0000c800: 6720 6265 7477 6565 6e20 736c 6963 6573  g between slices
+0000c810: 292e 0a0a 2020 2020 2020 2020 6d65 7468  )...        meth
+0000c820: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
+0000c830: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0000c840: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
+0000c850: 2066 6f72 2063 656e 7472 6f69 6420 6361   for centroid ca
+0000c860: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
+0000c870: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+0000c880: 2020 2020 2d20 2263 6f6e 746f 7572 223a      - "contour":
+0000c890: 2067 6574 2063 656e 7472 6f69 6420 6f66   get centroid of
+0000c8a0: 2073 6861 7065 6c79 2063 6f6e 746f 7572   shapely contour
+0000c8b0: 2873 292e 0a20 2020 2020 2020 2020 2020  (s)..           
+0000c8c0: 2020 2020 202d 2022 6d61 736b 223a 2067       - "mask": g
+0000c8d0: 6574 2061 7665 7261 6765 2070 6f73 6974  et average posit
+0000c8e0: 696f 6e20 6f66 2076 6f78 656c 7320 696e  ion of voxels in
+0000c8f0: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
+0000c900: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+0000c910: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+0000c920: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+0000c930: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+0000c940: 7468 6f64 2e0a 0a20 2020 2020 2020 2066  thod...        f
+0000c950: 6f72 6365 203a 2062 6f6f 6c2c 2064 6566  orce : bool, def
+0000c960: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
+0000c970: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+0000c980: 6865 2067 6c6f 6261 6c20 6365 6e74 726f  he global centro
+0000c990: 6964 2077 696c 6c20 616c 7761 7973 2062  id will always b
+0000c9a0: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
+0000c9b0: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+0000c9c0: 6572 7769 7365 2c20 6974 2077 696c 6c20  erwise, it will 
+0000c9d0: 6f6e 6c79 2062 6520 6361 6c63 756c 6174  only be calculat
+0000c9e0: 6564 2069 6620 6974 2068 6173 206e 6f74  ed if it has not
+0000c9f0: 2079 6574 2062 6565 6e20 6361 6368 6564   yet been cached
+0000ca00: 200a 2020 2020 2020 2020 2020 2020 696e   .            in
+0000ca10: 2073 656c 662e 5f76 6f6c 756d 652e 2020   self._volume.  
+0000ca20: 4e6f 7465 2074 6861 7420 6966 2073 696e  Note that if sin
+0000ca30: 676c 655f 736c 6963 653d 5472 7565 2c20  gle_slice=True, 
+0000ca40: 7468 6520 6365 6e74 726f 6964 2077 696c  the centroid wil
+0000ca50: 6c20 0a20 2020 2020 2020 2020 2020 2061  l .            a
+0000ca60: 6c77 6179 7320 6265 2072 6563 616c 6375  lways be recalcu
+0000ca70: 6c61 7465 642e 0a20 2020 2020 2020 2022  lated..        "
+0000ca80: 2222 0a0a 2020 2020 2020 2020 2320 4966  ""..        # If
+0000ca90: 2067 6c6f 6261 6c20 6365 6e74 726f 6964   global centroid
+0000caa0: 2061 6c72 6561 6479 2063 6163 6865 642c   already cached,
+0000cab0: 2072 6574 7572 6e20 6361 6368 6564 2076   return cached v
+0000cac0: 616c 7565 0a20 2020 2020 2020 2069 6620  alue.        if 
+0000cad0: 6e6f 7420 7369 6e67 6c65 5f73 6c69 6365  not single_slice
+0000cae0: 2061 6e64 206e 6f74 2066 6f72 6365 3a0a   and not force:.
+0000caf0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+0000cb00: 6173 6174 7472 2873 656c 662c 2022 5f63  asattr(self, "_c
+0000cb10: 656e 7472 6f69 6422 2920 616e 6420 756e  entroid") and un
+0000cb20: 6974 7320 696e 2073 656c 662e 5f63 656e  its in self._cen
+0000cb30: 7472 6f69 643a 0a20 2020 2020 2020 2020  troid:.         
+0000cb40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000cb50: 6c66 2e5f 6365 6e74 726f 6964 5b75 6e69  lf._centroid[uni
+0000cb60: 7473 5d0a 0a20 2020 2020 2020 2023 2047  ts]..        # G
+0000cb70: 6574 2064 6566 6175 6c74 2073 6c69 6365  et default slice
+0000cb80: 2061 6e64 206d 6574 686f 640a 2020 2020   and method.    
+0000cb90: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
+0000cba0: 2020 2020 2020 2020 6966 206d 6574 686f          if metho
+0000cbb0: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
+0000cbc0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
+0000cbd0: 7365 6c66 2e64 6566 6175 6c74 5f67 656f  self.default_geo
+0000cbe0: 6d5f 6d65 7468 6f64 0a20 2020 2020 2020  m_method.       
+0000cbf0: 2069 6620 7369 6e67 6c65 5f73 6c69 6365   if single_slice
+0000cc00: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
+0000cc10: 2061 6e64 2073 6c20 6973 204e 6f6e 6520   and sl is None 
+0000cc20: 616e 6420 6964 7820 6973 204e 6f6e 653a  and idx is None:
+0000cc30: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
+0000cc40: 203d 2073 656c 662e 6765 745f 6d69 645f   = self.get_mid_
+0000cc50: 6964 7828 7669 6577 290a 0a20 2020 2020  idx(view)..     
+0000cc60: 2020 2023 2049 6620 7369 6e67 6c65 2073     # If single s
+0000cc70: 6c69 6365 2072 6571 7565 7374 6564 2061  lice requested a
+0000cc80: 6e64 206e 6f74 206f 6e20 6375 7272 656e  nd not on curren
+0000cc90: 7420 736c 6963 652c 2072 6574 7572 6e20  t slice, return 
+0000cca0: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+0000ccb0: 2020 2069 6620 7369 6e67 6c65 5f73 6c69     if single_sli
+0000ccc0: 6365 2061 6e64 206e 6f74 2073 656c 662e  ce and not self.
+0000ccd0: 6f6e 5f73 6c69 6365 2876 6965 772c 2073  on_slice(view, s
+0000cce0: 6c3d 736c 2c20 6964 783d 6964 782c 2070  l=sl, idx=idx, p
+0000ccf0: 6f73 3d70 6f73 293a 0a20 2020 2020 2020  os=pos):.       
+0000cd00: 2020 2020 2072 6574 7572 6e20 6e70 2e61       return np.a
+0000cd10: 7272 6179 285b 4e6f 6e65 2c20 4e6f 6e65  rray([None, None
+0000cd20: 5d29 0a0a 2020 2020 2020 2020 2320 4361  ])..        # Ca
+0000cd30: 6c63 756c 6174 6520 6365 6e74 726f 6964  lculate centroid
+0000cd40: 2066 726f 6d20 5368 6170 656c 7920 706f   from Shapely po
+0000cd50: 6c79 676f 6e73 0a20 2020 2020 2020 2063  lygons.        c
+0000cd60: 656e 7472 6f69 6420 3d20 7b7d 0a20 2020  entroid = {}.   
+0000cd70: 2020 2020 2069 6620 6d65 7468 6f64 203d       if method =
+0000cd80: 3d20 2263 6f6e 746f 7572 223a 0a0a 2020  = "contour":..  
+0000cd90: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+0000cda0: 3244 206f 7220 3344 2063 656e 7472 6f69  2D or 3D centroi
+0000cdb0: 6473 2061 6e64 2061 7265 6173 206f 6620  ds and areas of 
+0000cdc0: 6561 6368 2070 6f6c 7967 6f6e 206f 6e20  each polygon on 
+0000cdd0: 7468 6520 6465 7369 7265 640a 2020 2020  the desired.    
+0000cde0: 2020 2020 2020 2020 2320 736c 6963 6528          # slice(
+0000cdf0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
+0000ce00: 6620 7369 6e67 6c65 5f73 6c69 6365 3a0a  f single_slice:.
+0000ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce20: 706f 6c79 676f 6e73 203d 2073 656c 662e  polygons = self.
+0000ce30: 6765 745f 706f 6c79 676f 6e73 5f6f 6e5f  get_polygons_on_
+0000ce40: 736c 6963 6528 7669 6577 2c20 736c 2c20  slice(view, sl, 
+0000ce50: 6964 782c 2070 6f73 290a 2020 2020 2020  idx, pos).      
+0000ce60: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+0000ce70: 6964 7320 3d20 5b5d 0a20 2020 2020 2020  ids = [].       
+0000ce80: 2020 2020 2020 2020 2061 7265 6173 203d           areas =
+0000ce90: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0000cea0: 2020 2020 666f 7220 7020 696e 2070 6f6c      for p in pol
+0000ceb0: 7967 6f6e 733a 0a20 2020 2020 2020 2020  ygons:.         
+0000cec0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+0000ced0: 6f69 645f 7879 203d 2070 2e63 656e 7472  oid_xy = p.centr
+0000cee0: 6f69 642e 7879 0a20 2020 2020 2020 2020  oid.xy.         
+0000cef0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+0000cf00: 6f69 6473 2e61 7070 656e 6428 6e70 2e61  oids.append(np.a
+0000cf10: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000cf30: 656e 7472 6f69 645f 7879 5b30 5d5b 305d  entroid_xy[0][0]
+0000cf40: 2c20 6365 6e74 726f 6964 5f78 795b 315d  , centroid_xy[1]
+0000cf50: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0000cf60: 2020 2020 2020 2020 5d29 290a 2020 2020          ])).    
+0000cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf80: 6172 6561 732e 6170 7065 6e64 2870 2e61  areas.append(p.a
+0000cf90: 7265 6129 0a20 2020 2020 2020 2020 2020  rea).           
+0000cfa0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000cfb0: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
+0000cfc0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0000cfd0: 2020 2020 2020 6172 6561 7320 3d20 5b5d        areas = []
+0000cfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cff0: 2070 6f6c 7967 6f6e 5f64 6963 7420 3d20   polygon_dict = 
+0000d000: 7365 6c66 2e67 6574 5f70 6f6c 7967 6f6e  self.get_polygon
+0000d010: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0000d020: 2020 2020 666f 7220 7a2c 2070 6f6c 7967      for z, polyg
+0000d030: 6f6e 7320 696e 2070 6f6c 7967 6f6e 5f64  ons in polygon_d
+0000d040: 6963 742e 6974 656d 7328 293a 0a20 2020  ict.items():.   
+0000d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d060: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
+0000d070: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0000d080: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+0000d090: 726f 6964 5f78 7920 3d20 702e 6365 6e74  roid_xy = p.cent
+0000d0a0: 726f 6964 2e78 790a 2020 2020 2020 2020  roid.xy.        
+0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0c0: 6365 6e74 726f 6964 732e 6170 7065 6e64  centroids.append
+0000d0d0: 286e 702e 6172 7261 7928 5b0a 2020 2020  (np.array([.    
+0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0f0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0000d100: 5f78 795b 305d 5b30 5d2c 2063 656e 7472  _xy[0][0], centr
+0000d110: 6f69 645f 7879 5b31 5d5b 305d 2c20 7a0a  oid_xy[1][0], z.
 0000d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d130: 2020 2020 6172 6561 732e 6170 7065 6e64      areas.append
-0000d140: 2870 2e61 7265 6129 0a0a 2020 2020 2020  (p.area)..      
-0000d150: 2020 2020 2020 2320 4765 7420 7765 6967        # Get weig
-0000d160: 6874 6564 2061 7665 7261 6765 206f 6620  hted average of 
-0000d170: 706f 6c79 676f 6e20 6365 6e74 726f 6964  polygon centroid
-0000d180: 730a 2020 2020 2020 2020 2020 2020 7765  s.            we
-0000d190: 6967 6874 6564 5f73 756d 203d 206e 702e  ighted_sum = np.
-0000d1a0: 7375 6d28 0a20 2020 2020 2020 2020 2020  sum(.           
-0000d1b0: 2020 2020 205b 6365 6e74 726f 6964 735b       [centroids[
-0000d1c0: 695d 202a 2061 7265 6173 5b69 5d20 666f  i] * areas[i] fo
-0000d1d0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-0000d1e0: 2863 656e 7472 6f69 6473 2929 5d2c 0a20  (centroids))],. 
-0000d1f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000d200: 7869 733d 300a 2020 2020 2020 2020 2020  xis=0.          
-0000d210: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000d220: 6365 6e74 726f 6964 5b22 6d6d 225d 203d  centroid["mm"] =
-0000d230: 2077 6569 6768 7465 645f 7375 6d20 2f20   weighted_sum / 
-0000d240: 7375 6d28 6172 6561 7329 0a0a 2020 2020  sum(areas)..    
-0000d250: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-0000d260: 6174 6520 696e 2076 6f78 656c 7320 616e  ate in voxels an
-0000d270: 6420 736c 6963 6573 2069 6620 706f 7373  d slices if poss
-0000d280: 6962 6c65 0a20 2020 2020 2020 2020 2020  ible.           
-0000d290: 2069 6620 7365 6c66 2e76 6f78 656c 5f73   if self.voxel_s
-0000d2a0: 697a 6520 6973 204e 6f6e 6520 616e 6420  ize is None and 
-0000d2b0: 7365 6c66 2e73 6861 7065 2069 7320 4e6f  self.shape is No
-0000d2c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000d2d0: 2020 2020 6966 2075 6e69 7473 2069 6e20      if units in 
-0000d2e0: 5b22 766f 7865 6c73 222c 2022 736c 6963  ["voxels", "slic
-0000d2f0: 6522 5d20 2061 6e64 2073 656c 662e 7368  e"]  and self.sh
-0000d300: 6170 6520 6973 204e 6f6e 653a 0a20 2020  ape is None:.   
-0000d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d320: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
-0000d330: 726f 7228 2243 616e 6e6f 7420 636f 6d70  ror("Cannot comp
-0000d340: 7574 6520 6365 6e74 726f 6964 2069 6e20  ute centroid in 
-0000d350: 766f 7865 6c73 2f73 6c69 6365 220a 2020  voxels/slice".  
-0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d380: 2020 2020 2022 206e 756d 6265 7273 2066       " numbers f
-0000d390: 726f 6d20 636f 6e74 6f75 7273 2077 6974  rom contours wit
-0000d3a0: 686f 7574 206b 6e6f 7769 6e67 2076 6f78  hout knowing vox
-0000d3b0: 656c 220a 2020 2020 2020 2020 2020 2020  el".            
-0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3d0: 2020 2020 2020 2020 2020 2022 2073 697a             " siz
-0000d3e0: 6573 2061 6e64 206d 6173 6b20 7368 6170  es and mask shap
-0000d3f0: 6521 2229 0a20 2020 2020 2020 2020 2020  e!").           
-0000d400: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d410: 2020 2020 2020 2076 6965 775f 6178 6573         view_axes
-0000d420: 203d 2028 5b30 2c20 312c 2032 5d20 6966   = ([0, 1, 2] if
-0000d430: 206c 656e 2863 656e 7472 6f69 645b 276d   len(centroid['m
-0000d440: 6d27 5d29 203d 3d20 3320 656c 7365 0a20  m']) == 3 else. 
-0000d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d460: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
-0000d470: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
-0000d480: 775d 290a 0a20 2020 2020 2020 2020 2020  w])..           
-0000d490: 2020 2020 2063 656e 7472 6f69 645b 2276       centroid["v
-0000d4a0: 6f78 656c 7322 5d20 3d20 6e70 2e61 7272  oxels"] = np.arr
-0000d4b0: 6179 285b 0a20 2020 2020 2020 2020 2020  ay([.           
-0000d4c0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0000d4d0: 735f 746f 5f69 6478 2863 2c20 6178 3d69  s_to_idx(c, ax=i
-0000d4e0: 2c20 7265 7475 726e 5f69 6e74 3d46 616c  , return_int=Fal
-0000d4f0: 7365 2920 0a20 2020 2020 2020 2020 2020  se) .           
-0000d500: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0000d510: 6320 696e 207a 6970 2876 6965 775f 6178  c in zip(view_ax
-0000d520: 6573 2c20 6365 6e74 726f 6964 5b22 6d6d  es, centroid["mm
-0000d530: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-0000d540: 2020 2020 5d29 0a0a 2020 2020 2020 2020      ])..        
-0000d550: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0000d560: 5b22 736c 6963 6522 5d20 3d20 6e70 2e61  ["slice"] = np.a
-0000d570: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
-0000d580: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d590: 706f 735f 746f 5f73 6c69 6365 2863 2c20  pos_to_slice(c, 
-0000d5a0: 6178 3d69 2c20 7265 7475 726e 5f69 6e74  ax=i, return_int
-0000d5b0: 3d46 616c 7365 2920 0a20 2020 2020 2020  =False) .       
-0000d5c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000d5d0: 2069 2c20 6320 696e 207a 6970 2876 6965   i, c in zip(vie
-0000d5e0: 775f 6178 6573 2c20 6365 6e74 726f 6964  w_axes, centroid
-0000d5f0: 5b22 6d6d 225d 290a 2020 2020 2020 2020  ["mm"]).        
-0000d600: 2020 2020 2020 2020 5d29 0a0a 2020 2020          ])..    
-0000d610: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
-0000d620: 2063 616c 6375 6c61 7465 2063 656e 7472   calculate centr
-0000d630: 6f69 6420 6672 6f6d 2062 696e 6172 7920  oid from binary 
-0000d640: 6d61 736b 0a20 2020 2020 2020 2065 6c73  mask.        els
-0000d650: 653a 200a 0a20 2020 2020 2020 2020 2020  e: ..           
-0000d660: 2023 2047 6574 2032 4420 6f72 2033 4420   # Get 2D or 3D 
-0000d670: 6461 7461 2066 726f 6d20 7768 6963 6820  data from which 
-0000d680: 746f 2063 616c 6375 6c61 7465 2063 656e  to calculate cen
-0000d690: 7472 6f69 640a 2020 2020 2020 2020 2020  troid.          
-0000d6a0: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
-0000d6b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000d6c0: 2020 2069 6620 6e6f 7420 7365 6c66 2e6f     if not self.o
-0000d6d0: 6e5f 736c 6963 6528 7669 6577 2c20 736c  n_slice(view, sl
-0000d6e0: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
-0000d6f0: 733d 706f 7329 3a0a 2020 2020 2020 2020  s=pos):.        
-0000d700: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d710: 726e 206e 702e 6172 7261 7928 5b4e 6f6e  rn np.array([Non
-0000d720: 652c 204e 6f6e 655d 290a 2020 2020 2020  e, None]).      
-0000d730: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-0000d740: 2073 656c 662e 6765 745f 736c 6963 6528   self.get_slice(
-0000d750: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
-0000d760: 3d69 6478 2c20 706f 733d 706f 7329 0a20  =idx, pos=pos). 
-0000d770: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000d780: 7865 7320 3d20 736b 7274 2e69 6d61 6765  xes = skrt.image
-0000d790: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
-0000d7a0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-0000d7b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d7c0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-0000d7d0: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
-0000d7e0: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
-0000d7f0: 6c66 2e67 6574 5f6d 6173 6b28 7374 616e  lf.get_mask(stan
-0000d800: 6461 7264 6973 653d 5472 7565 290a 2020  dardise=True).  
-0000d810: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-0000d820: 6573 203d 2073 6b72 742e 696d 6167 652e  es = skrt.image.
-0000d830: 5f61 7865 730a 0a20 2020 2020 2020 2020  _axes..         
-0000d840: 2020 2023 2043 6f6d 7075 7465 2063 656e     # Compute cen
-0000d850: 7472 6f69 6420 6672 6f6d 2032 4420 6f72  troid from 2D or
-0000d860: 2033 4420 6269 6e61 7279 206d 6173 6b0a   3D binary mask.
-0000d870: 2020 2020 2020 2020 2020 2020 6e6f 6e5f              non_
-0000d880: 7a65 726f 203d 206e 702e 6172 6777 6865  zero = np.argwhe
-0000d890: 7265 2864 6174 6129 0a20 2020 2020 2020  re(data).       
-0000d8a0: 2020 2020 2069 6620 6e6f 7420 6c65 6e28       if not len(
-0000d8b0: 6e6f 6e5f 7a65 726f 293a 0a20 2020 2020  non_zero):.     
-0000d8c0: 2020 2020 2020 2020 2020 2069 6620 6461             if da
-0000d8d0: 7461 2e6e 6469 6d20 3d3d 2032 3a0a 2020  ta.ndim == 2:.  
-0000d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8f0: 2020 7265 7475 726e 204e 6f6e 652c 204e    return None, N
-0000d900: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0000d910: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d920: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000d930: 7475 726e 204e 6f6e 652c 204e 6f6e 652c  turn None, None,
-0000d940: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0000d950: 2020 6365 6e74 726f 6964 5f72 6f77 636f    centroid_rowco
-0000d960: 6c20 3d20 6c69 7374 286e 6f6e 5f7a 6572  l = list(non_zer
-0000d970: 6f2e 6d65 616e 2830 2929 0a20 2020 2020  o.mean(0)).     
-0000d980: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
-0000d990: 766f 7865 6c73 203d 205b 6365 6e74 726f  voxels = [centro
-0000d9a0: 6964 5f72 6f77 636f 6c5b 315d 2c20 6365  id_rowcol[1], ce
-0000d9b0: 6e74 726f 6964 5f72 6f77 636f 6c5b 305d  ntroid_rowcol[0]
-0000d9c0: 5d20 5c0a 2020 2020 2020 2020 2020 2020  ] \.            
-0000d9d0: 2020 2020 2020 2020 2b20 6365 6e74 726f          + centro
-0000d9e0: 6964 5f72 6f77 636f 6c5b 323a 5d0a 2020  id_rowcol[2:].  
-0000d9f0: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
-0000da00: 6964 5b22 766f 7865 6c73 225d 203d 206e  id["voxels"] = n
-0000da10: 702e 6172 7261 7928 6365 6e74 726f 6964  p.array(centroid
-0000da20: 5f76 6f78 656c 7329 0a0a 2020 2020 2020  _voxels)..      
-0000da30: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-0000da40: 746f 206d 6d20 616e 6420 736c 6963 6573  to mm and slices
-0000da50: 0a20 2020 2020 2020 2020 2020 2076 6965  .            vie
-0000da60: 775f 6178 6573 203d 2028 5b30 2c20 312c  w_axes = ([0, 1,
-0000da70: 2032 5d20 6966 206c 656e 2863 656e 7472   2] if len(centr
-0000da80: 6f69 645b 2776 6f78 656c 7327 5d29 203d  oid['voxels']) =
-0000da90: 3d20 3320 656c 7365 0a20 2020 2020 2020  = 3 else.       
-0000daa0: 2020 2020 2020 2020 2020 2020 2073 6b72               skr
-0000dab0: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
-0000dac0: 6573 5b76 6965 775d 290a 0a20 2020 2020  es[view])..     
-0000dad0: 2020 2020 2020 2063 656e 7472 6f69 645b         centroid[
-0000dae0: 226d 6d22 5d20 3d20 6e70 2e61 7272 6179  "mm"] = np.array
-0000daf0: 285b 0a20 2020 2020 2020 2020 2020 2020  ([.             
-0000db00: 2020 2073 656c 662e 6964 785f 746f 5f70     self.idx_to_p
-0000db10: 6f73 2863 2c20 6178 3d69 290a 2020 2020  os(c, ax=i).    
-0000db20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000db30: 692c 2063 2069 6e20 7a69 7028 7669 6577  i, c in zip(view
-0000db40: 5f61 7865 732c 2063 656e 7472 6f69 645b  _axes, centroid[
-0000db50: 2276 6f78 656c 7322 5d29 0a20 2020 2020  "voxels"]).     
-0000db60: 2020 2020 2020 205d 290a 0a20 2020 2020         ])..     
-0000db70: 2020 2020 2020 2063 656e 7472 6f69 645b         centroid[
-0000db80: 2273 6c69 6365 225d 203d 206e 702e 6172  "slice"] = np.ar
-0000db90: 7261 7928 5b0a 2020 2020 2020 2020 2020  ray([.          
-0000dba0: 2020 2020 2020 7365 6c66 2e69 6478 5f74        self.idx_t
-0000dbb0: 6f5f 736c 6963 6528 632c 2061 783d 6929  o_slice(c, ax=i)
-0000dbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dbd0: 2066 6f72 2069 2c20 6320 696e 207a 6970   for i, c in zip
-0000dbe0: 2876 6965 775f 6178 6573 2c20 6365 6e74  (view_axes, cent
-0000dbf0: 726f 6964 5b22 766f 7865 6c73 225d 290a  roid["voxels"]).
-0000dc00: 2020 2020 2020 2020 2020 2020 5d29 0a0a              ])..
-0000dc10: 2020 2020 2020 2020 2320 4361 6368 6520          # Cache 
-0000dc20: 676c 6f62 616c 2063 656e 7472 6f69 640a  global centroid.
-0000dc30: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000dc40: 696e 676c 655f 736c 6963 653a 0a20 2020  ingle_slice:.   
-0000dc50: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0000dc60: 656e 7472 6f69 6420 3d20 6365 6e74 726f  entroid = centro
-0000dc70: 6964 0a0a 2020 2020 2020 2020 2320 5265  id..        # Re
-0000dc80: 7475 726e 2063 656e 7472 6f69 6420 696e  turn centroid in
-0000dc90: 2072 6571 7565 7374 6564 2075 6e69 7473   requested units
-0000dca0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000dcb0: 6365 6e74 726f 6964 5b75 6e69 7473 5d0a  centroid[units].
-0000dcc0: 0a20 2020 2064 6566 2073 6574 5f73 6c69  .    def set_sli
-0000dcd0: 6365 5f74 6869 636b 6e65 7373 5f63 6f6e  ce_thickness_con
-0000dce0: 746f 7572 7328 7365 6c66 2c20 647a 293a  tours(self, dz):
-0000dcf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000dd00: 2020 2020 2053 6574 206e 6f6d 696e 616c       Set nominal
-0000dd10: 207a 2073 7061 6369 6e67 206f 6620 636f   z spacing of co
-0000dd20: 6e74 6f75 7273 2e0a 0a20 2020 2020 2020  ntours...       
-0000dd30: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
-0000dd40: 6675 6c20 696e 2070 6172 7469 6375 6c61  ful in particula
-0000dd50: 7220 666f 7220 2073 696e 676c 652d 736c  r for  single-sl
-0000dd60: 6963 6520 524f 4973 2e0a 2020 2020 2020  ice ROIs..      
-0000dd70: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
-0000dd80: 656c 662e 736c 6963 655f 7468 6963 6b6e  elf.slice_thickn
-0000dd90: 6573 735f 636f 6e74 6f75 7273 203d 2064  ess_contours = d
-0000dda0: 7a0a 0a20 2020 2064 6566 2067 6574 5f73  z..    def get_s
-0000ddb0: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
-0000ddc0: 6f6e 746f 7572 7328 7365 6c66 293a 0a20  ontours(self):. 
-0000ddd0: 2020 2020 2020 2022 2222 4765 7420 7a20         """Get z 
-0000dde0: 766f 7865 6c20 7369 7a65 2075 7369 6e67  voxel size using
-0000ddf0: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
-0000de00: 6e74 6f75 7273 2e22 2222 0a0a 2020 2020  ntours."""..    
-0000de10: 2020 2020 636f 6e74 6f75 7273 203d 2073      contours = s
-0000de20: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
-0000de30: 2822 782d 7922 290a 2020 2020 2020 2020  ("x-y").        
-0000de40: 7a5f 6b65 7973 203d 2073 6f72 7465 6428  z_keys = sorted(
-0000de50: 636f 6e74 6f75 7273 2e6b 6579 7328 2929  contours.keys())
-0000de60: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0000de70: 7a5f 6b65 7973 2920 3c20 323a 0a20 2020  z_keys) < 2:.   
-0000de80: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000de90: 2e73 6f75 7263 655f 7479 7065 203d 3d20  .source_type == 
-0000dea0: 2263 6f6e 746f 7572 2220 616e 6420 7365  "contour" and se
-0000deb0: 6c66 2e73 6c69 6365 5f74 6869 636b 6e65  lf.slice_thickne
-0000dec0: 7373 5f63 6f6e 746f 7572 733a 0a20 2020  ss_contours:.   
-0000ded0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000dee0: 7572 6e20 7365 6c66 2e73 6c69 6365 5f74  urn self.slice_t
-0000def0: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
-0000df00: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
-0000df10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000df20: 2020 2020 766f 7865 6c5f 7369 7a65 203d      voxel_size =
-0000df30: 2073 656c 662e 6765 745f 766f 7865 6c5f   self.get_voxel_
-0000df40: 7369 7a65 2829 0a20 2020 2020 2020 2020  size().         
-0000df50: 2020 2020 2020 2069 6620 766f 7865 6c5f         if voxel_
-0000df60: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-0000df70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000df80: 2020 2020 2020 7265 7475 726e 2076 6f78        return vox
-0000df90: 656c 5f73 697a 655b 325d 0a20 2020 2020  el_size[2].     
-0000dfa0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000dfb0: 6e0a 2020 2020 2020 2020 6469 6666 7320  n.        diffs 
-0000dfc0: 3d20 5b7a 5f6b 6579 735b 695d 202d 207a  = [z_keys[i] - z
-0000dfd0: 5f6b 6579 735b 6920 2d20 315d 2066 6f72  _keys[i - 1] for
-0000dfe0: 2069 2069 6e20 7261 6e67 6528 312c 206c   i in range(1, l
-0000dff0: 656e 287a 5f6b 6579 7329 295d 0a20 2020  en(z_keys))].   
-0000e000: 2020 2020 2072 6574 7572 6e20 6d69 6e28       return min(
-0000e010: 6469 6666 7329 0a0a 2020 2020 6465 6620  diffs)..    def 
-0000e020: 6765 745f 6e7a 5f63 6f6e 746f 7572 7328  get_nz_contours(
-0000e030: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000e040: 2222 4765 7420 6e75 6d62 6572 206f 6620  ""Get number of 
-0000e050: 766f 7865 6c73 2069 6e20 7468 6520 7a20  voxels in the z 
-0000e060: 6469 7265 6374 696f 6e20 7573 696e 6720  direction using 
-0000e070: 706f 7369 7469 6f6e 7320 6f66 2063 6f6e  positions of con
-0000e080: 746f 7572 732e 2222 220a 0a20 2020 2020  tours."""..     
-0000e090: 2020 2076 7a20 3d20 7365 6c66 2e67 6574     vz = self.get
-0000e0a0: 5f73 6c69 6365 5f74 6869 636b 6e65 7373  _slice_thickness
-0000e0b0: 5f63 6f6e 746f 7572 7328 290a 2020 2020  _contours().    
-0000e0c0: 2020 2020 7a5f 6b65 7973 203d 206c 6973      z_keys = lis
-0000e0d0: 7428 7365 6c66 2e67 6574 5f63 6f6e 746f  t(self.get_conto
-0000e0e0: 7572 7328 2278 2d79 2229 2e6b 6579 7328  urs("x-y").keys(
-0000e0f0: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-0000e100: 6e20 696e 7428 286d 6178 287a 5f6b 6579  n int((max(z_key
-0000e110: 7329 202d 206d 696e 287a 5f6b 6579 7329  s) - min(z_keys)
-0000e120: 2920 2f20 767a 2920 2b20 310a 0a20 2020  ) / vz) + 1..   
-0000e130: 2064 6566 2067 6574 5f63 656e 7472 6528   def get_centre(
-0000e140: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
-0000e150: 2020 2020 2020 2020 7669 6577 3d22 782d          view="x-
-0000e160: 7922 2c20 0a20 2020 2020 2020 2073 696e  y", .        sin
-0000e170: 676c 655f 736c 6963 653d 4661 6c73 652c  gle_slice=False,
-0000e180: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
-0000e190: 2c20 0a20 2020 2020 2020 2069 6478 3d4e  , .        idx=N
-0000e1a0: 6f6e 652c 200a 2020 2020 2020 2020 706f  one, .        po
-0000e1b0: 733d 4e6f 6e65 2c20 0a20 2020 2020 2020  s=None, .       
-0000e1c0: 206d 6574 686f 643d 4e6f 6e65 2c0a 2020   method=None,.  
-0000e1d0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0000e1e0: 4765 7420 6365 6e74 7265 2070 6f73 6974  Get centre posit
-0000e1f0: 696f 6e20 696e 2032 4420 6f72 2033 4420  ion in 2D or 3D 
-0000e200: 696e 206d 6d2e 2222 220a 0a20 2020 2020  in mm."""..     
-0000e210: 2020 2023 2047 6574 2064 6566 6175 6c74     # Get default
-0000e220: 2073 6c69 6365 2069 6e64 6578 2061 6e64   slice index and
-0000e230: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
-0000e240: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-0000e250: 2020 2020 6966 2073 6c20 6973 204e 6f6e      if sl is Non
-0000e260: 6520 616e 6420 6964 7820 6973 204e 6f6e  e and idx is Non
-0000e270: 6520 616e 6420 706f 7320 6973 204e 6f6e  e and pos is Non
-0000e280: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-0000e290: 6964 7820 3d20 7365 6c66 2e67 6574 5f6d  idx = self.get_m
-0000e2a0: 6964 5f69 6478 2876 6965 7729 0a20 2020  id_idx(view).   
-0000e2b0: 2020 2020 2069 6620 6d65 7468 6f64 2069       if method i
-0000e2c0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000e2d0: 2020 2020 6d65 7468 6f64 203d 2073 656c      method = sel
-0000e2e0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
-0000e2f0: 6574 686f 640a 0a20 2020 2020 2020 2023  ethod..        #
-0000e300: 2047 6574 206c 6973 7420 6f66 2061 7865   Get list of axe
-0000e310: 7320 746f 2063 6f6e 7369 6465 720a 2020  s to consider.  
-0000e320: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
-0000e330: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
-0000e340: 2020 2061 7865 7320 3d20 736b 7274 2e69     axes = skrt.i
-0000e350: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
-0000e360: 7669 6577 5d0a 2020 2020 2020 2020 656c  view].        el
-0000e370: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000e380: 6178 6573 203d 2073 6b72 742e 696d 6167  axes = skrt.imag
-0000e390: 652e 5f61 7865 730a 0a20 2020 2020 2020  e._axes..       
-0000e3a0: 2023 2047 6574 2063 656e 7472 6520 696e   # Get centre in
-0000e3b0: 206d 6d0a 2020 2020 2020 2020 6365 6e74   mm.        cent
-0000e3c0: 7265 203d 205b 5d0a 2020 2020 2020 2020  re = [].        
-0000e3d0: 666f 7220 6178 2069 6e20 6178 6573 3a0a  for ax in axes:.
-0000e3e0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-0000e3f0: 6e74 203d 2073 656c 662e 6765 745f 6578  nt = self.get_ex
-0000e400: 7465 6e74 280a 2020 2020 2020 2020 2020  tent(.          
-0000e410: 2020 2020 2020 6178 3d61 782c 0a20 2020        ax=ax,.   
-0000e420: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-0000e430: 676c 655f 736c 6963 653d 7369 6e67 6c65  gle_slice=single
-0000e440: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-0000e450: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
-0000e460: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
-0000e470: 2020 2073 6c3d 736c 2c0a 2020 2020 2020     sl=sl,.      
-0000e480: 2020 2020 2020 2020 2020 6964 783d 6964            idx=id
-0000e490: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-0000e4a0: 2020 2070 6f73 3d70 6f73 2c0a 2020 2020     pos=pos,.    
-0000e4b0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-0000e4c0: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
-0000e4d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000e4e0: 2020 2020 2069 6620 4e6f 6e65 2069 6e20       if None in 
-0000e4f0: 6578 7465 6e74 3a0a 2020 2020 2020 2020  extent:.        
-0000e500: 2020 2020 2020 2020 6365 6e74 7265 2e61          centre.a
-0000e510: 7070 656e 6428 4e6f 6e65 290a 2020 2020  ppend(None).    
-0000e520: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000e530: 2020 2020 2020 2020 2020 2020 2020 6365                ce
-0000e540: 6e74 7265 2e61 7070 656e 6428 6e70 2e6d  ntre.append(np.m
-0000e550: 6561 6e28 6578 7465 6e74 2929 0a0a 2020  ean(extent))..  
-0000e560: 2020 2020 2020 7265 7475 726e 206e 702e        return np.
-0000e570: 6172 7261 7928 6365 6e74 7265 290a 0a20  array(centre).. 
-0000e580: 2020 2064 6566 2067 6574 5f76 6f6c 756d     def get_volum
-0000e590: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0000e5a0: 200a 2020 2020 2020 2020 756e 6974 733d   .        units=
-0000e5b0: 226d 6d22 2c20 0a20 2020 2020 2020 206d  "mm", .        m
-0000e5c0: 6574 686f 643d 4e6f 6e65 2c20 0a20 2020  ethod=None, .   
-0000e5d0: 2020 2020 2066 6f72 6365 3d54 7275 650a       force=True.
-0000e5e0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0000e5f0: 2222 4765 7420 524f 4920 766f 6c75 6d65  ""Get ROI volume
-0000e600: 2e20 5468 6520 6361 6c63 756c 6174 6564  . The calculated
-0000e610: 2076 6f6c 756d 6520 7769 6c6c 2062 6520   volume will be 
-0000e620: 6361 6368 6564 2069 6e20 0a20 2020 2020  cached in .     
-0000e630: 2020 2073 656c 662e 5f76 6f6c 756d 655b     self._volume[
-0000e640: 756e 6974 735d 2061 6e64 2072 6574 7572  units] and retur
-0000e650: 6e65 6420 6966 2063 616c 6c65 6420 6167  ned if called ag
-0000e660: 6169 6e2c 2075 6e6c 6573 7320 666f 7263  ain, unless forc
-0000e670: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
-0000e680: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0000e690: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0000e6a0: 2020 756e 6974 7320 3a20 7374 722c 2064    units : str, d
-0000e6b0: 6566 6175 6c74 3d22 6d6d 220a 2020 2020  efault="mm".    
-0000e6c0: 2020 2020 2020 2020 556e 6974 7320 6f66          Units of
-0000e6d0: 2076 6f6c 756d 652e 2043 616e 2062 6520   volume. Can be 
-0000e6e0: 616e 7920 6f66 3a0a 2020 2020 2020 2020  any of:.        
-0000e6f0: 2020 2020 2020 2020 2d20 226d 6d22 3a20          - "mm": 
-0000e700: 7265 7475 726e 2076 6f6c 756d 6520 696e  return volume in
-0000e710: 206d 696c 6c69 6d65 7472 6573 2063 7562   millimetres cub
-0000e720: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0000e730: 2020 2020 2d20 226d 6c22 3a20 7265 7475      - "ml": retu
-0000e740: 726e 2076 6f6c 756d 6520 696e 206d 696c  rn volume in mil
-0000e750: 6c69 6c69 7472 6573 2e0a 2020 2020 2020  lilitres..      
-0000e760: 2020 2020 2020 2020 2020 2d20 2263 6322            - "cc"
-0000e770: 3a20 7265 7475 726e 2076 6f6c 756d 6520  : return volume 
-0000e780: 696e 2063 7562 6963 2063 656e 7469 6d65  in cubic centime
-0000e790: 7472 6573 2028 6571 7569 7661 6c65 6e74  tres (equivalent
-0000e7a0: 2074 6f20 226d 6c22 290a 2020 2020 2020   to "ml").      
-0000e7b0: 2020 2020 2020 2020 2020 2d20 2276 6f78            - "vox
-0000e7c0: 656c 7322 3a20 7265 7475 726e 2076 6f6c  els": return vol
-0000e7d0: 756d 6520 696e 206e 756d 6265 7220 6f66  ume in number of
-0000e7e0: 2076 6f78 656c 732e 0a0a 2020 2020 2020   voxels...      
-0000e7f0: 2020 2020 2020 4966 2075 6e69 7473 3d22        If units="
-0000e800: 766f 7865 6c73 2220 6973 2072 6571 7565  voxels" is reque
-0000e810: 7374 6564 2062 7574 2074 6869 7320 524f  sted but this RO
-0000e820: 4920 6f6e 6c79 2068 6173 2063 6f6e 746f  I only has conto
-0000e830: 7572 7320 616e 6420 6e6f 0a20 2020 2020  urs and no.     
-0000e840: 2020 2020 2020 2076 6f78 656c 2073 697a         voxel siz
-0000e850: 6520 696e 666f 726d 6174 696f 6e2c 2061  e information, a
-0000e860: 6e20 6572 726f 7220 7769 6c6c 2062 6520  n error will be 
-0000e870: 7261 6973 6564 2e0a 0a20 2020 2020 2020  raised...       
-0000e880: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
-0000e890: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0000e8a0: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
-0000e8b0: 6f20 7573 6520 666f 7220 766f 6c75 6d65  o use for volume
-0000e8c0: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
-0000e8d0: 6e20 6265 3a20 0a20 2020 2020 2020 2020  n be: .         
-0000e8e0: 2020 2020 2020 202d 2022 636f 6e74 6f75         - "contou
-0000e8f0: 7222 3a20 636f 6d70 7574 6520 766f 6c75  r": compute volu
-0000e900: 6d65 2062 7920 7375 6d6d 696e 6720 6172  me by summing ar
-0000e910: 6561 7320 6f66 2073 6861 7065 6c79 0a20  eas of shapely. 
-0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e930: 2070 6f6c 7967 6f6e 7320 6f6e 2065 6163   polygons on eac
-0000e940: 6820 736c 6963 6520 616e 6420 6d75 6c74  h slice and mult
-0000e950: 6970 6c79 696e 6720 6279 2073 6c69 6365  iplying by slice
-0000e960: 2074 6869 636b 6e65 7373 2e0a 2020 2020   thickness..    
-0000e970: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
-0000e980: 6173 6b22 3a20 636f 6d70 7574 6520 766f  ask": compute vo
-0000e990: 6c75 6d65 2062 7920 7375 6d6d 696e 6720  lume by summing 
-0000e9a0: 766f 7865 6c73 2069 6e73 6964 6520 7468  voxels inside th
-0000e9b0: 6520 524f 4920 616e 640a 2020 2020 2020  e ROI and.      
-0000e9c0: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
-0000e9d0: 6970 6c79 696e 6720 6279 2074 6865 2076  iplying by the v
-0000e9e0: 6f6c 756d 6520 6f66 206f 6e65 2076 6f78  olume of one vox
-0000e9f0: 656c 2e0a 2020 2020 2020 2020 2020 2020  el..            
-0000ea00: 2020 2020 2d20 4e6f 6e65 3a20 7573 6520      - None: use 
-0000ea10: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
-0000ea20: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
-0000ea30: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
-0000ea40: 2020 2020 2020 2020 204e 6f74 6520 7468           Note th
-0000ea50: 6174 2069 6620 7365 6c66 2e67 6574 5f76  at if self.get_v
-0000ea60: 6f6c 756d 6520 6861 7320 616c 7265 6164  olume has alread
-0000ea70: 7920 6265 656e 2063 616c 6c65 6420 7769  y been called wi
-0000ea80: 7468 206f 6e65 200a 2020 2020 2020 2020  th one .        
-0000ea90: 2020 2020 6d65 7468 6f64 2c20 7468 6520      method, the 
-0000eaa0: 7361 6d65 2063 6163 6865 6420 7265 7375  same cached resu
-0000eab0: 6c74 2077 696c 6c20 6265 2072 6574 7572  lt will be retur
-0000eac0: 6e65 6420 6966 2063 616c 6c69 6e67 2077  ned if calling w
-0000ead0: 6974 6820 6120 0a20 2020 2020 2020 2020  ith a .         
-0000eae0: 2020 2064 6966 6665 7265 6e74 206d 6574     different met
-0000eaf0: 686f 6420 756e 6c65 7373 2066 6f72 6365  hod unless force
-0000eb00: 3d54 7275 652e 0a0a 2020 2020 2020 2020  =True...        
-0000eb10: 666f 7263 6520 3a20 626f 6f6c 2c20 6465  force : bool, de
-0000eb20: 6661 756c 743d 5472 7565 0a20 2020 2020  fault=True.     
-0000eb30: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-0000eb40: 7468 6520 766f 6c75 6d65 2077 696c 6c20  the volume will 
-0000eb50: 616c 7761 7973 2062 6520 7265 6361 6c63  always be recalc
-0000eb60: 756c 6174 6564 3b20 6f74 6865 7277 6973  ulated; otherwis
-0000eb70: 652c 2069 7420 7769 6c6c 0a20 2020 2020  e, it will.     
-0000eb80: 2020 2020 2020 206f 6e6c 7920 6265 2063         only be c
-0000eb90: 616c 6375 6c61 7465 6420 6966 2069 7420  alculated if it 
-0000eba0: 6861 7320 6e6f 7420 7965 7420 6265 656e  has not yet been
-0000ebb0: 2063 6163 6865 6420 696e 2073 656c 662e   cached in self.
-0000ebc0: 5f76 6f6c 756d 652e 0a20 2020 2020 2020  _volume..       
-0000ebd0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
-0000ebe0: 4966 2061 6c72 6561 6479 2063 6163 6865  If already cache
-0000ebf0: 6420 616e 6420 6e6f 7420 666f 7263 696e  d and not forcin
-0000ec00: 672c 2072 6574 7572 6e0a 2020 2020 2020  g, return.      
-0000ec10: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
-0000ec20: 662c 2022 5f76 6f6c 756d 6522 2920 616e  f, "_volume") an
-0000ec30: 6420 6e6f 7420 666f 7263 653a 0a20 2020  d not force:.   
-0000ec40: 2020 2020 2020 2020 2069 6620 756e 6974           if unit
-0000ec50: 7320 696e 2073 656c 662e 5f76 6f6c 756d  s in self._volum
-0000ec60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ec70: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000ec80: 766f 6c75 6d65 5b75 6e69 7473 5d0a 0a20  volume[units].. 
-0000ec90: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-0000eca0: 2829 0a20 2020 2020 2020 2069 6620 6d65  ().        if me
-0000ecb0: 7468 6f64 2069 7320 4e6f 6e65 3a0a 2020  thod is None:.  
-0000ecc0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0000ecd0: 203d 2073 656c 662e 6465 6661 756c 745f   = self.default_
-0000ece0: 6765 6f6d 5f6d 6574 686f 640a 0a20 2020  geom_method..   
-0000ecf0: 2020 2020 2023 204d 616b 6520 6361 6368       # Make cach
-0000ed00: 6564 2070 726f 7065 7274 790a 2020 2020  ed property.    
-0000ed10: 2020 2020 7365 6c66 2e5f 766f 6c75 6d65      self._volume
-0000ed20: 203d 207b 7d0a 0a20 2020 2020 2020 2023   = {}..        #
-0000ed30: 2043 616c 6375 6c61 7465 2066 726f 6d20   Calculate from 
-0000ed40: 706f 6c79 676f 6e20 6172 6561 730a 2020  polygon areas.  
-0000ed50: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
-0000ed60: 3d3d 2022 636f 6e74 6f75 7222 3a0a 0a20  == "contour":.. 
-0000ed70: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-0000ed80: 636b 2069 7427 7320 706f 7373 6962 6c65  ck it's possible
-0000ed90: 2074 6f20 6361 6c63 756c 6174 6520 766f   to calculate vo
-0000eda0: 6c75 6d65 2077 6974 6820 7468 6520 7265  lume with the re
-0000edb0: 7175 6573 7465 6420 756e 6974 730a 2020  quested units.  
-0000edc0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000edd0: 662e 766f 7865 6c5f 7369 7a65 2069 7320  f.voxel_size is 
-0000ede0: 4e6f 6e65 2061 6e64 2075 6e69 7473 203d  None and units =
-0000edf0: 3d20 2276 6f78 656c 7322 3a0a 2020 2020  = "voxels":.    
-0000ee00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000ee10: 6520 5275 6e74 696d 6545 7272 6f72 2822  e RuntimeError("
-0000ee20: 4361 6e6e 6f74 2063 6f6d 7075 7465 2076  Cannot compute v
-0000ee30: 6f6c 756d 6520 696e 2076 6f78 656c 7320  olume in voxels 
-0000ee40: 6672 6f6d 2022 0a20 2020 2020 2020 2020  from ".         
-0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee60: 2020 2020 2020 2020 2020 2263 6f6e 746f            "conto
-0000ee70: 7572 7320 7769 7468 6f75 7420 6b6e 6f77  urs without know
-0000ee80: 696e 6720 766f 7865 6c20 7369 7a65 7321  ing voxel sizes!
-0000ee90: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0000eea0: 2320 4361 6c63 756c 6174 6520 6172 6561  # Calculate area
-0000eeb0: 206f 6e20 6561 6368 2073 6c69 6365 0a20   on each slice. 
-0000eec0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-0000eed0: 5f61 7265 6173 203d 205b 5d0a 2020 2020  _areas = [].    
-0000eee0: 2020 2020 2020 2020 666f 7220 6964 7820          for idx 
-0000eef0: 696e 2073 656c 662e 6765 745f 636f 6e74  in self.get_cont
-0000ef00: 6f75 7273 2822 782d 7922 2c20 6964 785f  ours("x-y", idx_
-0000ef10: 6173 5f6b 6579 3d54 7275 6529 3a0a 2020  as_key=True):.  
-0000ef20: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-0000ef30: 6963 655f 6172 6561 732e 6170 7065 6e64  ice_areas.append
-0000ef40: 2873 656c 662e 6765 745f 6172 6561 2822  (self.get_area("
-0000ef50: 782d 7922 2c20 6964 783d 6964 782c 206d  x-y", idx=idx, m
-0000ef60: 6574 686f 643d 6d65 7468 6f64 2929 0a0a  ethod=method))..
-0000ef70: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-0000ef80: 6e76 6572 7420 746f 2076 6f6c 756d 6520  nvert to volume 
-0000ef90: 696e 206d 6d0a 2020 2020 2020 2020 2020  in mm.          
-0000efa0: 2020 6172 6561 5f73 756d 203d 2073 756d    area_sum = sum
-0000efb0: 2873 6c69 6365 5f61 7265 6173 290a 2020  (slice_areas).  
-0000efc0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000efd0: 766f 6c75 6d65 5b22 6d6d 225d 203d 2061  volume["mm"] = a
-0000efe0: 7265 615f 7375 6d20 2a20 7365 6c66 2e67  rea_sum * self.g
-0000eff0: 6574 5f73 6c69 6365 5f74 6869 636b 6e65  et_slice_thickne
-0000f000: 7373 5f63 6f6e 746f 7572 7328 290a 0a20  ss_contours().. 
-0000f010: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0000f020: 706f 7373 6962 6c65 2c20 636f 6e76 6572  possible, conver
-0000f030: 7420 746f 2076 6f6c 756d 6520 696e 2076  t to volume in v
-0000f040: 6f78 656c 730a 2020 2020 2020 2020 2020  oxels.          
-0000f050: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
-0000f060: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-0000f070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f080: 2020 7879 5f76 6f78 656c 5f61 7265 6120    xy_voxel_area 
-0000f090: 3d20 7365 6c66 2e76 6f78 656c 5f73 697a  = self.voxel_siz
-0000f0a0: 655b 305d 202a 2073 656c 662e 766f 7865  e[0] * self.voxe
-0000f0b0: 6c5f 7369 7a65 5b31 5d0a 2020 2020 2020  l_size[1].      
-0000f0c0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000f0d0: 766f 6c75 6d65 5b22 766f 7865 6c73 225d  volume["voxels"]
-0000f0e0: 203d 2061 7265 615f 7375 6d20 2f20 7879   = area_sum / xy
-0000f0f0: 5f76 6f78 656c 5f61 7265 610a 0a20 2020  _voxel_area..   
-0000f100: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
-0000f110: 2c20 6361 6c63 756c 6174 6520 6672 6f6d  , calculate from
-0000f120: 206e 756d 6265 7220 6f66 2076 6f78 656c   number of voxel
-0000f130: 7320 696e 206d 6173 6b0a 2020 2020 2020  s in mask.      
-0000f140: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000f150: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-0000f160: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
-0000f170: 2020 2073 656c 662e 5f76 6f6c 756d 655b     self._volume[
-0000f180: 2276 6f78 656c 7322 5d20 3d20 7365 6c66  "voxels"] = self
-0000f190: 2e6d 6173 6b2e 6461 7461 2e61 7374 7970  .mask.data.astyp
-0000f1a0: 6528 626f 6f6c 292e 7375 6d28 290a 2020  e(bool).sum().  
-0000f1b0: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
-0000f1c0: 766f 6c20 3d20 6162 7328 6e70 2e70 726f  vol = abs(np.pro
-0000f1d0: 6428 7365 6c66 2e67 6574 5f76 6f78 656c  d(self.get_voxel
-0000f1e0: 5f73 697a 6528 2929 290a 2020 2020 2020  _size())).      
-0000f1f0: 2020 2020 2020 7365 6c66 2e5f 766f 6c75        self._volu
-0000f200: 6d65 5b22 6d6d 225d 203d 2073 656c 662e  me["mm"] = self.
-0000f210: 5f76 6f6c 756d 655b 2276 6f78 656c 7322  _volume["voxels"
-0000f220: 5d20 2a20 766f 7865 6c5f 766f 6c0a 0a20  ] * voxel_vol.. 
-0000f230: 2020 2020 2020 2023 2047 6574 2076 6f6c         # Get vol
-0000f240: 756d 6520 696e 206d 6c20 6f72 2065 7175  ume in ml or equ
-0000f250: 6976 616c 656e 746c 7920 6363 0a20 2020  ivalently cc.   
-0000f260: 2020 2020 2073 656c 662e 5f76 6f6c 756d       self._volum
-0000f270: 655b 226d 6c22 5d20 3d20 7365 6c66 2e5f  e["ml"] = self._
-0000f280: 766f 6c75 6d65 5b22 6d6d 225d 202f 2031  volume["mm"] / 1
-0000f290: 3030 300a 2020 2020 2020 2020 7365 6c66  000.        self
-0000f2a0: 2e5f 766f 6c75 6d65 5b22 6363 225d 203d  ._volume["cc"] =
-0000f2b0: 2073 656c 662e 5f76 6f6c 756d 655b 226d   self._volume["m
-0000f2c0: 6c22 5d0a 0a20 2020 2020 2020 2023 2052  l"]..        # R
-0000f2d0: 6574 7572 6e20 766f 6c75 6d65 2069 6e20  eturn volume in 
-0000f2e0: 7468 6520 7265 7175 6573 7465 6420 756e  the requested un
-0000f2f0: 6974 730a 2020 2020 2020 2020 7265 7475  its.        retu
-0000f300: 726e 2073 656c 662e 5f76 6f6c 756d 655b  rn self._volume[
-0000f310: 756e 6974 735d 0a0a 2020 2020 6465 6620  units]..    def 
-0000f320: 6765 745f 6d61 736b 5f74 6f5f 636f 6e74  get_mask_to_cont
-0000f330: 6f75 725f 766f 6c75 6d65 5f72 6174 696f  our_volume_ratio
-0000f340: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000f350: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-0000f360: 7261 7469 6f20 746f 2052 4f49 2022 6d61  ratio to ROI "ma
-0000f370: 736b 2220 766f 6c75 6d65 2074 6f20 524f  sk" volume to RO
-0000f380: 4920 2263 6f6e 746f 7572 2220 766f 6c75  I "contour" volu
-0000f390: 6d65 2e0a 0a20 2020 2020 2020 2049 6e20  me...        In 
-0000f3a0: 7072 696e 6369 706c 652c 2076 6f6c 756d  principle, volum
-0000f3b0: 6520 6573 7469 6d61 7465 7320 6672 6f6d  e estimates from
-0000f3c0: 2022 6d61 736b 2220 616e 6420 2263 6f6e   "mask" and "con
-0000f3d0: 746f 7572 2220 6d65 7468 6f64 730a 2020  tour" methods.  
-0000f3e0: 2020 2020 2020 7368 6f75 6c64 2062 6520        should be 
-0000f3f0: 7369 6d69 6c61 722e 2020 5468 6520 7477  similar.  The tw
-0000f400: 6f20 6573 7469 6d61 7465 7320 6d61 7920  o estimates may 
-0000f410: 6265 2064 6966 6665 7265 6e74 2069 662c  be different if,
-0000f420: 2066 6f72 0a20 2020 2020 2020 2065 7861   for.        exa
-0000f430: 6d70 6c65 2c20 7468 6520 696d 6167 6520  mple, the image 
-0000f440: 6672 6f6d 2077 6869 6368 2061 206d 6173  from which a mas
-0000f450: 6b20 6973 2063 7265 6174 6564 2064 6f65  k is created doe
-0000f460: 736e 2774 2066 756c 6c79 2063 6f76 6572  sn't fully cover
-0000f470: 0a20 2020 2020 2020 2074 6865 2063 6f6e  .        the con
-0000f480: 746f 7572 2065 7874 656e 7473 2e0a 2020  tour extents..  
-0000f490: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f4a0: 2020 7265 7475 726e 2028 7365 6c66 2e67    return (self.g
-0000f4b0: 6574 5f76 6f6c 756d 6528 6d65 7468 6f64  et_volume(method
-0000f4c0: 3d22 6d61 736b 222c 2066 6f72 6365 3d54  ="mask", force=T
-0000f4d0: 7275 6529 202f 0a20 2020 2020 2020 2020  rue) /.         
-0000f4e0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-0000f4f0: 766f 6c75 6d65 286d 6574 686f 643d 2263  volume(method="c
-0000f500: 6f6e 746f 7572 222c 2066 6f72 6365 3d54  ontour", force=T
-0000f510: 7275 6529 290a 0a20 2020 2064 6566 2067  rue))..    def g
-0000f520: 6574 5f61 7265 6128 0a20 2020 2020 2020  et_area(.       
-0000f530: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
-0000f540: 7669 6577 3d22 782d 7922 2c20 0a20 2020  view="x-y", .   
-0000f550: 2020 2020 2073 6c3d 4e6f 6e65 2c20 0a20       sl=None, . 
-0000f560: 2020 2020 2020 2069 6478 3d4e 6f6e 652c         idx=None,
-0000f570: 200a 2020 2020 2020 2020 706f 733d 4e6f   .        pos=No
-0000f580: 6e65 2c20 0a20 2020 2020 2020 2075 6e69  ne, .        uni
-0000f590: 7473 3d22 6d6d 222c 200a 2020 2020 2020  ts="mm", .      
-0000f5a0: 2020 6d65 7468 6f64 3d4e 6f6e 652c 0a20    method=None,. 
-0000f5b0: 2020 2020 2020 2066 6c61 7474 656e 3d46         flatten=F
-0000f5c0: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
-0000f5d0: 2020 2020 2022 2222 4765 7420 7468 6520       """Get the 
-0000f5e0: 6172 6561 206f 6620 7468 6520 524f 4920  area of the ROI 
-0000f5f0: 6f6e 2061 2067 6976 656e 2073 6c69 6365  on a given slice
-0000f600: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-0000f610: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
-0000f620: 2020 200a 2020 2020 2020 2020 7669 6577     .        view
-0000f630: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-0000f640: 2278 2d79 220a 2020 2020 2020 2020 2020  "x-y".          
-0000f650: 2020 4f72 6965 6e74 6174 696f 6e20 6f66    Orientation of
-0000f660: 2073 6c69 6365 2066 6f72 2077 6869 6368   slice for which
-0000f670: 2074 6f20 6765 7420 6172 6561 2e0a 0a20   to get area... 
-0000f680: 2020 2020 2020 2073 6c20 3a20 696e 742c         sl : int,
-0000f690: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0000f6a0: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
-0000f6b0: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
-0000f6c0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-0000f6d0: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-0000f6e0: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-0000f6f0: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-0000f700: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-0000f710: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0000f720: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
-0000f730: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
-0000f740: 2069 6478 203a 2069 6e74 2c20 6465 6661   idx : int, defa
-0000f750: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0000f760: 2020 2020 2041 7272 6179 2069 6e64 6578       Array index
-0000f770: 206f 6620 736c 6963 652e 2049 6620 6e6f   of slice. If no
-0000f780: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
-0000f790: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
-0000f7a0: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
-0000f7b0: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
-0000f7c0: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-0000f7d0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-0000f7e0: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
-0000f7f0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-0000f800: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
-0000f810: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0000f820: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
-0000f830: 706f 7369 7469 6f6e 2069 6e20 6d6d 2e20  position in mm. 
-0000f840: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0000f850: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0000f860: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-0000f870: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-0000f880: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-0000f890: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-0000f8a0: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
-0000f8b0: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
-0000f8c0: 0a20 2020 2020 2020 2075 6e69 7473 203a  .        units :
-0000f8d0: 2073 7472 2c20 6465 6661 756c 743d 226d   str, default="m
-0000f8e0: 6d22 0a20 2020 2020 2020 2020 2020 2055  m".            U
-0000f8f0: 6e69 7473 206f 6620 6172 6561 2e20 4361  nits of area. Ca
-0000f900: 6e20 6265 2065 6974 6865 7220 6f66 3a0a  n be either of:.
-0000f910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f920: 202a 2022 6d6d 223a 2072 6574 7572 6e20   * "mm": return 
-0000f930: 6172 6561 2069 6e20 6d69 6c6c 696d 6574  area in millimet
-0000f940: 7265 7320 7371 7561 7265 642e 0a20 2020  res squared..   
-0000f950: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-0000f960: 766f 7865 6c73 223a 2072 6574 7572 6e20  voxels": return 
-0000f970: 6172 6561 2069 6e20 6e75 6d62 6572 206f  area in number o
-0000f980: 6620 766f 7865 6c73 2e0a 0a20 2020 2020  f voxels...     
-0000f990: 2020 2020 2020 2049 6620 756e 6974 733d         If units=
-0000f9a0: 2276 6f78 656c 7322 2069 7320 7265 7175  "voxels" is requ
-0000f9b0: 6573 7465 6420 6275 7420 7468 6973 2052  ested but this R
-0000f9c0: 4f49 206f 6e6c 7920 6861 7320 636f 6e74  OI only has cont
-0000f9d0: 6f75 7273 2061 6e64 206e 6f0a 2020 2020  ours and no.    
-0000f9e0: 2020 2020 2020 2020 766f 7865 6c20 7369          voxel si
-0000f9f0: 7a65 2069 6e66 6f72 6d61 7469 6f6e 2c20  ze information, 
-0000fa00: 616e 2065 7272 6f72 2077 696c 6c20 6265  an error will be
-0000fa10: 2072 6169 7365 642e 0a0a 2020 2020 2020   raised...      
-0000fa20: 2020 6d65 7468 6f64 203a 2073 7472 2c20    method : str, 
-0000fa30: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0000fa40: 2020 2020 2020 2020 204d 6574 686f 6420           Method 
-0000fa50: 746f 2075 7365 2066 6f72 2061 7265 6120  to use for area 
-0000fa60: 6361 6c63 756c 6174 696f 6e2e 2043 616e  calculation. Can
-0000fa70: 2062 653a 200a 0a20 2020 2020 2020 2020   be: ..         
-0000fa80: 2020 2020 2020 202a 2022 636f 6e74 6f75         * "contou
-0000fa90: 7222 3a20 636f 6d70 7574 6520 6172 6561  r": compute area
-0000faa0: 2066 726f 6d20 7368 6170 656c 7920 706f   from shapely po
-0000fab0: 6c79 676f 6e20 6f6e 2074 6865 2073 6c69  lygon on the sli
-0000fac0: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-0000fad0: 2020 2020 2a20 226d 6173 6b22 3a20 636f      * "mask": co
-0000fae0: 6d70 7574 6520 6172 6561 2062 7920 7375  mpute area by su
-0000faf0: 6d6d 696e 6720 7069 7865 6c73 206f 6e20  mming pixels on 
-0000fb00: 7468 6520 736c 6963 6520 616e 6420 0a20  the slice and . 
-0000fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb20: 206d 756c 7469 706c 7969 6e67 2062 7920   multiplying by 
-0000fb30: 7468 6520 6172 6561 206f 6620 6f6e 6520  the area of one 
-0000fb40: 7069 7865 6c2e 0a20 2020 2020 2020 2020  pixel..         
-0000fb50: 2020 2020 2020 202a 204e 6f6e 653a 2075         * None: u
-0000fb60: 7365 2074 6865 206d 6574 686f 6420 7365  se the method se
-0000fb70: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
-0000fb80: 745f 6765 6f6d 5f6d 6574 686f 642e 0a0a  t_geom_method...
-0000fb90: 2020 2020 2020 2020 666c 6174 7465 6e20          flatten 
-0000fba0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-0000fbb0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0000fbc0: 2020 4966 2054 7275 652c 2061 6c6c 2073    If True, all s
-0000fbd0: 6c69 6365 7320 7769 6c6c 2062 6520 666c  lices will be fl
-0000fbe0: 6174 7465 6e65 6420 696e 2074 6865 2067  attened in the g
-0000fbf0: 6976 656e 206f 7269 656e 7461 7469 6f6e  iven orientation
-0000fc00: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
-0000fc10: 2074 6865 2061 7265 6120 6f66 2074 6865   the area of the
-0000fc20: 2066 6c61 7474 656e 6564 2073 6c69 6365   flattened slice
-0000fc30: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
-0000fc40: 642e 204f 6e6c 7920 6176 6169 6c61 626c  d. Only availabl
-0000fc50: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0000fc60: 206d 6574 686f 643d 226d 6173 6b22 2e0a   method="mask"..
-0000fc70: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000fc80: 2020 2020 2023 2047 6574 2064 6566 6175       # Get defau
-0000fc90: 6c74 2073 6c69 6365 2069 6e64 6578 2061  lt slice index a
-0000fca0: 6e64 206d 6574 686f 640a 2020 2020 2020  nd method.      
-0000fcb0: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
-0000fcc0: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
-0000fcd0: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
-0000fce0: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
-0000fcf0: 6f6e 653a 200a 2020 2020 2020 2020 2020  one: .          
-0000fd00: 2020 6964 7820 3d20 7365 6c66 2e67 6574    idx = self.get
-0000fd10: 5f6d 6964 5f69 6478 2876 6965 7729 0a20  _mid_idx(view). 
-0000fd20: 2020 2020 2020 2069 6620 6d65 7468 6f64         if method
-0000fd30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000fd40: 2020 2020 2020 6d65 7468 6f64 203d 2073        method = s
-0000fd50: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-0000fd60: 5f6d 6574 686f 640a 0a20 2020 2020 2020  _method..       
-0000fd70: 2023 2049 6620 524f 4920 6973 206e 6f74   # If ROI is not
-0000fd80: 206f 6e20 7468 6520 6769 7665 6e20 736c   on the given sl
-0000fd90: 6963 652c 2072 6574 7572 6e20 4e6f 6e65  ice, return None
-0000fda0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000fdb0: 7365 6c66 2e6f 6e5f 736c 6963 6528 7669  self.on_slice(vi
-0000fdc0: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
-0000fdd0: 6478 2c20 706f 733d 706f 7329 3a0a 2020  dx, pos=pos):.  
-0000fde0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000fdf0: 0a0a 2020 2020 2020 2020 6966 2066 6c61  ..        if fla
-0000fe00: 7474 656e 3a20 2023 2046 6c61 7474 656e  tten:  # Flatten
-0000fe10: 696e 6720 6f6e 6c79 2070 6f73 7369 626c  ing only possibl
-0000fe20: 6520 7769 7468 2022 6d61 736b 220a 2020  e with "mask".  
-0000fe30: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0000fe40: 203d 2022 6d61 736b 220a 0a20 2020 2020   = "mask"..     
-0000fe50: 2020 2023 2043 616c 6375 6c61 7465 2061     # Calculate a
-0000fe60: 7265 6120 6672 6f6d 2073 6861 7065 6c79  rea from shapely
-0000fe70: 2070 6f6c 7967 6f6e 2873 290a 2020 2020   polygon(s).    
-0000fe80: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
-0000fe90: 2022 636f 6e74 6f75 7222 3a0a 0a20 2020   "contour":..   
-0000fea0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
-0000feb0: 2069 7427 7320 706f 7373 6962 6c65 2074   it's possible t
-0000fec0: 6f20 6361 6c63 756c 6174 6520 6172 6561  o calculate area
-0000fed0: 2077 6974 6820 7468 6520 7265 7175 6573   with the reques
-0000fee0: 7465 6420 756e 6974 730a 2020 2020 2020  ted units.      
-0000fef0: 2020 2020 2020 6966 2073 656c 662e 766f        if self.vo
-0000ff00: 7865 6c5f 7369 7a65 2069 7320 4e6f 6e65  xel_size is None
-0000ff10: 2061 6e64 2075 6e69 7473 203d 3d20 2276   and units == "v
-0000ff20: 6f78 656c 7322 3a0a 2020 2020 2020 2020  oxels":.        
-0000ff30: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-0000ff40: 6e74 696d 6545 7272 6f72 2822 4361 6e6e  ntimeError("Cann
-0000ff50: 6f74 2063 6f6d 7075 7465 2061 7265 6120  ot compute area 
-0000ff60: 696e 2076 6f78 656c 7320 6672 6f6d 2022  in voxels from "
-0000ff70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff90: 2020 2020 2263 6f6e 746f 7572 7320 7769      "contours wi
-0000ffa0: 7468 6f75 7420 6b6e 6f77 696e 6720 766f  thout knowing vo
-0000ffb0: 7865 6c20 7369 7a65 7321 2229 0a0a 2020  xel sizes!")..  
-0000ffc0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
-0000ffd0: 6e73 203d 2073 656c 662e 6765 745f 706f  ns = self.get_po
-0000ffe0: 6c79 676f 6e73 5f6f 6e5f 736c 6963 6528  lygons_on_slice(
-0000fff0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-00010000: 6f73 290a 2020 2020 2020 2020 2020 2020  os).            
-00010010: 6172 6561 203d 2073 756d 285b 702e 6172  area = sum([p.ar
-00010020: 6561 2066 6f72 2070 2069 6e20 706f 6c79  ea for p in poly
-00010030: 676f 6e73 5d29 0a20 2020 2020 2020 2020  gons]).         
-00010040: 2020 2069 6620 756e 6974 7320 3d3d 2022     if units == "
-00010050: 766f 7865 6c73 223a 0a20 2020 2020 2020  voxels":.       
-00010060: 2020 2020 2020 2020 2078 5f61 782c 2079           x_ax, y
-00010070: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
-00010080: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
-00010090: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000100a0: 2020 7879 5f61 7265 6120 3d20 6162 7328    xy_area = abs(
-000100b0: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
-000100c0: 785f 6178 5d20 2a20 7365 6c66 2e76 6f78  x_ax] * self.vox
-000100d0: 656c 5f73 697a 655b 795f 6178 5d29 0a20  el_size[y_ax]). 
-000100e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000100f0: 7265 6120 2f3d 2078 795f 6172 6561 0a20  rea /= xy_area. 
-00010100: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00010110: 6e20 6172 6561 0a0a 2020 2020 2020 2020  n area..        
-00010120: 2320 4f74 6865 7277 6973 652c 2063 616c  # Otherwise, cal
-00010130: 6375 6c61 7465 2061 7265 6120 6672 6f6d  culate area from
-00010140: 2062 696e 6172 7920 6d61 736b 0a20 2020   binary mask.   
-00010150: 2020 2020 2069 6d5f 736c 6963 6520 3d20       im_slice = 
-00010160: 7365 6c66 2e67 6574 5f73 6c69 6365 2876  self.get_slice(v
-00010170: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
-00010180: 6964 782c 2070 6f73 3d70 6f73 2c20 0a20  idx, pos=pos, . 
-00010190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101b0: 2066 6c61 7474 656e 3d66 6c61 7474 656e   flatten=flatten
-000101c0: 290a 2020 2020 2020 2020 6172 6561 203d  ).        area =
-000101d0: 2069 6d5f 736c 6963 652e 6173 7479 7065   im_slice.astype
-000101e0: 2862 6f6f 6c29 2e73 756d 2829 0a20 2020  (bool).sum().   
-000101f0: 2020 2020 2069 6620 756e 6974 7320 3d3d       if units ==
-00010200: 2022 6d6d 223a 0a20 2020 2020 2020 2020   "mm":.         
-00010210: 2020 2078 5f61 782c 2079 5f61 7820 3d20     x_ax, y_ax = 
-00010220: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
-00010230: 5f61 7865 735b 7669 6577 5d0a 2020 2020  _axes[view].    
-00010240: 2020 2020 2020 2020 7879 5f61 7265 6120          xy_area 
-00010250: 3d20 6162 7328 7365 6c66 2e76 6f78 656c  = abs(self.voxel
-00010260: 5f73 697a 655b 785f 6178 5d20 2a20 7365  _size[x_ax] * se
-00010270: 6c66 2e76 6f78 656c 5f73 697a 655b 795f  lf.voxel_size[y_
-00010280: 6178 5d29 0a20 2020 2020 2020 2020 2020  ax]).           
-00010290: 2061 7265 6120 2a3d 2078 795f 6172 6561   area *= xy_area
-000102a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000102b0: 6172 6561 0a0a 2020 2020 6465 6620 6765  area..    def ge
-000102c0: 745f 6262 6f78 5f63 656e 7472 655f 616e  t_bbox_centre_an
-000102d0: 645f 7769 6474 6873 2873 656c 662c 0a20  d_widths(self,. 
-000102e0: 2020 2020 2020 2020 2020 2062 7566 6665             buffe
-000102f0: 723d 4e6f 6e65 2c20 6275 6666 6572 5f75  r=None, buffer_u
-00010300: 6e69 7473 3d22 6d6d 222c 206d 6574 686f  nits="mm", metho
-00010310: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
-00010320: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-00010330: 2063 656e 7472 6520 616e 6420 7769 6474   centre and widt
-00010340: 6873 2069 6e20 6d6d 2061 6c6f 6e67 2061  hs in mm along a
-00010350: 6c6c 2074 6872 6565 2061 7865 7320 6f66  ll three axes of
-00010360: 2061 0a20 2020 2020 2020 2062 6f75 6e64   a.        bound
-00010370: 696e 6720 626f 7820 656e 636c 6f73 696e  ing box enclosin
-00010380: 6720 7468 6520 524f 4920 616e 6420 6f70  g the ROI and op
-00010390: 7469 6f6e 616c 2062 7566 6665 722e 2020  tional buffer.  
-000103a0: 4365 6e74 7265 0a20 2020 2020 2020 2061  Centre.        a
-000103b0: 6e64 2077 6964 7468 7320 6172 6520 7265  nd widths are re
-000103c0: 7475 726e 6564 2061 7320 6120 7475 706c  turned as a tupl
-000103d0: 6520 285b 782c 2079 2c20 7a5d 2c20 5b64  e ([x, y, z], [d
-000103e0: 782c 2064 792c 2064 7a5d 292e 0a0a 2020  x, dy, dz])...  
-000103f0: 2020 2020 2020 4d65 7468 6f64 2070 6172        Method par
-00010400: 616d 6574 6572 7320 6172 6520 7061 7373  ameters are pass
-00010410: 6564 2074 6f20 736b 7274 2e73 7472 7563  ed to skrt.struc
-00010420: 7475 7265 732e 524f 492e 6765 745f 6578  tures.ROI.get_ex
-00010430: 7465 6e74 7328 290a 2020 2020 2020 2020  tents().        
-00010440: 746f 206f 6274 6169 6e20 524f 4920 6578  to obtain ROI ex
-00010450: 7465 6e74 732e 2020 466f 7220 7061 7261  tents.  For para
-00010460: 6d65 7465 7220 6578 706c 616e 6174 696f  meter explanatio
-00010470: 6e73 2c20 7365 650a 2020 2020 2020 2020  ns, see.        
-00010480: 736b 7274 2e73 7472 7563 7475 7265 732e  skrt.structures.
-00010490: 524f 492e 6765 745f 6578 7465 6e74 7328  ROI.get_extents(
-000104a0: 2920 646f 6375 6d65 6e74 6174 696f 6e2e  ) documentation.
-000104b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000104c0: 2020 2020 2065 7874 656e 7473 203d 2073       extents = s
-000104d0: 656c 662e 6765 745f 6578 7465 6e74 7328  elf.get_extents(
-000104e0: 6275 6666 6572 2c20 6275 6666 6572 5f75  buffer, buffer_u
-000104f0: 6e69 7473 2c20 6d65 7468 6f64 2920 0a20  nits, method) . 
-00010500: 2020 2020 2020 2063 656e 7472 6520 3d20         centre = 
-00010510: 5b30 2e35 202a 2028 6578 7465 6e74 5b30  [0.5 * (extent[0
-00010520: 5d20 2b20 6578 7465 6e74 5b31 5d29 2066  ] + extent[1]) f
-00010530: 6f72 2065 7874 656e 7420 696e 2065 7874  or extent in ext
-00010540: 656e 7473 5d0a 2020 2020 2020 2020 7769  ents].        wi
-00010550: 6474 6873 203d 205b 2865 7874 656e 745b  dths = [(extent[
-00010560: 315d 202d 2065 7874 656e 745b 305d 2920  1] - extent[0]) 
-00010570: 666f 7220 6578 7465 6e74 2069 6e20 6578  for extent in ex
-00010580: 7465 6e74 735d 0a20 2020 2020 2020 2072  tents].        r
-00010590: 6574 7572 6e20 2863 656e 7472 652c 2077  eturn (centre, w
-000105a0: 6964 7468 7329 0a0a 2020 2020 6465 6620  idths)..    def 
-000105b0: 6765 745f 6578 7465 6e74 7328 7365 6c66  get_extents(self
-000105c0: 2c20 6275 6666 6572 3d4e 6f6e 652c 2062  , buffer=None, b
-000105d0: 7566 6665 725f 756e 6974 733d 226d 6d22  uffer_units="mm"
-000105e0: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 0a20  , method=None,. 
-000105f0: 2020 2020 2020 2020 2020 206f 7269 6769             origi
-00010600: 6e3d 4e6f 6e65 293a 0a20 2020 2020 2020  n=None):.       
-00010610: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-00010620: 206d 696e 696d 756d 2061 6e64 206d 6178   minimum and max
-00010630: 696d 756d 2065 7874 656e 7420 6f66 2074  imum extent of t
-00010640: 6865 2052 4f49 2069 6e20 6d6d 2061 6c6f  he ROI in mm alo
-00010650: 6e67 2061 6c6c 2074 6872 6565 2061 7865  ng all three axe
-00010660: 732c 0a20 2020 2020 2020 2072 6574 7572  s,.        retur
-00010670: 6e65 6420 696e 206f 7264 6572 205b 782c  ned in order [x,
-00010680: 2079 2c20 7a5d 2e20 4f70 7469 6f6e 616c   y, z]. Optional
-00010690: 6c79 2061 7070 6c79 2061 2062 7566 6665  ly apply a buffe
-000106a0: 7220 746f 2074 6865 2065 7874 656e 7473  r to the extents
-000106b0: 0a20 2020 2020 2020 2073 7563 6820 7468  .        such th
-000106c0: 6174 2074 6865 7920 636f 7665 7220 6d6f  at they cover mo
-000106d0: 7265 2074 6861 6e20 7468 6520 524f 4927  re than the ROI'
-000106e0: 7320 6172 6561 2e0a 0a20 2020 2020 2020  s area...       
-000106f0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-00010700: 0a0a 2020 2020 2020 2020 6275 6666 6572  ..        buffer
-00010710: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
-00010720: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00010730: 2020 204f 7074 696f 6e61 6c20 6275 6666     Optional buff
-00010740: 6572 2074 6f20 6164 6420 746f 2074 6865  er to add to the
-00010750: 2065 7874 656e 7473 2e20 556e 6974 7320   extents. Units 
-00010760: 7365 7420 6279 2060 6275 6666 6572 5f75  set by `buffer_u
-00010770: 6e69 7473 602e 0a0a 2020 2020 2020 2020  nits`...        
-00010780: 6275 6666 6572 5f75 6e69 7473 203a 2073  buffer_units : s
-00010790: 7472 2c20 6465 6661 756c 743d 226d 6d22  tr, default="mm"
-000107a0: 0a20 2020 2020 2020 2020 2020 2055 6e69  .            Uni
-000107b0: 7473 2066 6f72 2062 7566 6665 722c 2069  ts for buffer, i
-000107c0: 6620 7573 696e 672e 2043 616e 2062 6520  f using. Can be 
-000107d0: 226d 6d22 2c20 2276 6f78 656c 7322 2c20  "mm", "voxels", 
-000107e0: 6f72 2022 6672 6163 2220 2877 6869 6368  or "frac" (which
-000107f0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
-00010800: 6c69 6573 2062 7566 6665 7220 6173 2061  lies buffer as a
-00010810: 2066 7261 6374 696f 6e20 6f66 2074 6f74   fraction of tot
-00010820: 616c 206c 656e 6774 6820 696e 2065 6163  al length in eac
-00010830: 6820 6469 6d65 6e73 696f 6e29 2e0a 0a20  h dimension)... 
-00010840: 2020 2020 2020 206d 6574 686f 6420 3a20         method : 
-00010850: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-00010860: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
-00010870: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
-00010880: 6578 7465 6e74 2063 616c 6375 6c61 7469  extent calculati
-00010890: 6f6e 2e20 4361 6e20 6265 3a20 0a0a 2020  on. Can be: ..  
-000108a0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-000108b0: 2263 6f6e 746f 7572 223a 2067 6574 2065  "contour": get e
-000108c0: 7874 656e 7420 6672 6f6d 206d 696e 2f6d  xtent from min/m
-000108d0: 6178 2070 6f73 6974 696f 6e73 206f 6620  ax positions of 
-000108e0: 636f 6e74 6f75 7228 7329 2e0a 2020 2020  contour(s)..    
-000108f0: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
-00010900: 6173 6b22 3a20 6765 7420 6578 7465 6e74  ask": get extent
-00010910: 2066 726f 6d20 6d69 6e2f 6d61 7820 706f   from min/max po
-00010920: 7369 7469 6f6e 7320 6f66 2076 6f78 656c  sitions of voxel
-00010930: 7320 696e 2074 6865 200a 2020 2020 2020  s in the .      
-00010940: 2020 2020 2020 2020 2020 2020 6269 6e61              bina
-00010950: 7279 206d 6173 6b2e 0a20 2020 2020 2020  ry mask..       
-00010960: 2020 2020 2020 2020 202a 204e 6f6e 653a           * None:
-00010970: 2075 7365 2074 6865 206d 6574 686f 6420   use the method 
-00010980: 7365 7420 696e 2073 656c 662e 6465 6661  set in self.defa
-00010990: 756c 745f 6765 6f6d 5f6d 6574 686f 642e  ult_geom_method.
-000109a0: 0a0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
-000109b0: 203a 2074 7570 6c65 2c20 6465 6661 756c   : tuple, defaul
-000109c0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000109d0: 2020 2054 7570 6c65 2073 7065 6369 6679     Tuple specify
-000109e0: 696e 6720 7468 6520 2878 2c20 792c 207a  ing the (x, y, z
-000109f0: 2920 636f 6f72 6469 6e61 7465 7320 6f66  ) coordinates of
-00010a00: 2074 6865 2070 6f69 6e74 0a20 2020 2020   the point.     
-00010a10: 2020 2020 2020 2077 6974 6820 7265 7370         with resp
-00010a20: 6563 7420 746f 2077 6869 6368 2065 7874  ect to which ext
-00010a30: 656e 7473 2061 7265 2074 6f20 6265 2064  ents are to be d
-00010a40: 6574 6572 6d69 6e65 642e 0a20 2020 2020  etermined..     
-00010a50: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
-00010a60: 7468 656e 2028 302c 2030 2c20 3029 2069  then (0, 0, 0) i
-00010a70: 7320 7573 6564 2e0a 2020 2020 2020 2020  s used..        
-00010a80: 2222 220a 2020 2020 2020 2020 2320 456e  """.        # En
-00010a90: 7375 7265 2074 6861 7420 6f72 6967 696e  sure that origin
-00010aa0: 2069 7320 6465 6669 6e65 642e 0a20 2020   is defined..   
-00010ab0: 2020 2020 206f 7269 6769 6e20 3d20 6f72       origin = or
-00010ac0: 6967 696e 206f 7220 2830 2c20 302c 2030  igin or (0, 0, 0
-00010ad0: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
-00010ae0: 2065 7874 656e 7420 696e 2065 6163 6820   extent in each 
-00010af0: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
-00010b00: 2020 6578 7465 6e74 7320 3d20 5b5d 0a20    extents = []. 
-00010b10: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
-00010b20: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
-00010b30: 733a 0a20 2020 2020 2020 2020 2020 2065  s:.            e
-00010b40: 7874 656e 7473 2e61 7070 656e 6428 7365  xtents.append(se
-00010b50: 6c66 2e67 6574 5f65 7874 656e 7428 6178  lf.get_extent(ax
-00010b60: 2c20 6d65 7468 6f64 3d6d 6574 686f 642c  , method=method,
-00010b70: 206f 7269 6769 6e3d 6f72 6967 696e 2929   origin=origin))
-00010b80: 0a0a 2020 2020 2020 2020 2320 4170 706c  ..        # Appl
-00010b90: 7920 6275 6666 6572 2069 6620 7265 7175  y buffer if requ
-00010ba0: 6573 7465 640a 2020 2020 2020 2020 6966  ested.        if
-00010bb0: 2062 7566 6665 723a 0a20 2020 2020 2020   buffer:.       
-00010bc0: 2020 2020 2066 6f72 2061 7820 696e 2072       for ax in r
-00010bd0: 616e 6765 2833 293a 0a20 2020 2020 2020  ange(3):.       
-00010be0: 2020 2020 2020 2020 2069 6620 6275 6666           if buff
-00010bf0: 6572 5f75 6e69 7473 203d 3d20 226d 6d22  er_units == "mm"
-00010c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010c10: 2020 2020 2020 6465 6c74 6120 3d20 6275        delta = bu
-00010c20: 6666 6572 0a20 2020 2020 2020 2020 2020  ffer.           
-00010c30: 2020 2020 2065 6c69 6620 6275 6666 6572       elif buffer
-00010c40: 5f75 6e69 7473 203d 3d20 2276 6f78 656c  _units == "voxel
-00010c50: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-00010c60: 2020 2020 2020 2020 6465 6c74 6120 3d20          delta = 
-00010c70: 6162 7328 6275 6666 6572 202a 2073 656c  abs(buffer * sel
-00010c80: 662e 766f 7865 6c5f 7369 7a65 5b61 785d  f.voxel_size[ax]
-00010c90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00010ca0: 2020 656c 6966 2062 7566 6665 725f 756e    elif buffer_un
-00010cb0: 6974 7320 3d3d 2022 6672 6163 223a 0a20  its == "frac":. 
-00010cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cd0: 2020 2064 656c 7461 203d 2062 7566 6665     delta = buffe
-00010ce0: 7220 2a20 6162 7328 6578 7465 6e74 735b  r * abs(extents[
-00010cf0: 6178 5d5b 315d 202d 2065 7874 656e 7473  ax][1] - extents
-00010d00: 5b61 785d 5b30 5d29 0a20 2020 2020 2020  [ax][0]).       
-00010d10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00010d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d30: 2020 2070 7269 6e74 2866 2255 6e72 6563     print(f"Unrec
-00010d40: 6f67 6e69 7365 6420 6275 6666 6572 2075  ognised buffer u
-00010d50: 6e69 7473 207b 6275 6666 6572 5f75 6e69  nits {buffer_uni
-00010d60: 7473 7d2e 2053 686f 756c 6420 220a 2020  ts}. Should ".  
-00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d80: 2020 2020 2020 2020 2762 6520 226d 6d22          'be "mm"
-00010d90: 2c20 2276 6f78 656c 7322 2c20 6f72 2022  , "voxels", or "
-00010da0: 6672 6163 222e 2729 0a20 2020 2020 2020  frac".').       
-00010db0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00010dc0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-00010dd0: 2020 2020 6578 7465 6e74 735b 6178 5d5b      extents[ax][
-00010de0: 305d 202d 3d20 6465 6c74 610a 2020 2020  0] -= delta.    
-00010df0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-00010e00: 6e74 735b 6178 5d5b 315d 202b 3d20 6465  nts[ax][1] += de
-00010e10: 6c74 610a 0a20 2020 2020 2020 2072 6574  lta..        ret
-00010e20: 7572 6e20 6578 7465 6e74 730a 0a20 2020  urn extents..   
-00010e30: 2064 6566 2067 6574 5f65 7874 656e 7428   def get_extent(
-00010e40: 7365 6c66 2c20 0a20 2020 2020 2020 2020  self, .         
-00010e50: 2020 2020 2020 2020 2020 6178 3d22 7a22            ax="z"
-00010e60: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00010e70: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
-00010e80: 6365 3d46 616c 7365 2c0a 2020 2020 2020  ce=False,.      
-00010e90: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-00010ea0: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
-00010eb0: 2020 2020 2020 2020 2020 2020 736c 3d4e              sl=N
-00010ec0: 6f6e 652c 200a 2020 2020 2020 2020 2020  one, .          
-00010ed0: 2020 2020 2020 2020 2069 6478 3d4e 6f6e           idx=Non
-00010ee0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00010ef0: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
-00010f00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00010f10: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
-00010f20: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00010f30: 2020 2020 2020 6f72 6967 696e 3d4e 6f6e        origin=Non
-00010f40: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00010f50: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00010f60: 2222 2247 6574 206d 696e 696d 756d 2061  """Get minimum a
-00010f70: 6e64 206d 6178 696d 756d 2065 7874 656e  nd maximum exten
-00010f80: 7420 6f66 2074 6865 2052 4f49 2069 6e20  t of the ROI in 
-00010f90: 6d6d 2061 6c6f 6e67 2061 2067 6976 656e  mm along a given
-00010fa0: 2061 7869 732e 0a0a 2020 2020 2020 2020   axis...        
-00010fb0: 6178 203a 2073 7472 2f69 6e74 2c20 6465  ax : str/int, de
-00010fc0: 6661 756c 743d 227a 220a 2020 2020 2020  fault="z".      
-00010fd0: 2020 2020 2020 4178 6973 2061 6c6f 6e67        Axis along
-00010fe0: 2077 6869 6368 2074 6f20 7265 7475 726e   which to return
-00010ff0: 2065 7874 656e 742e 2053 686f 756c 6420   extent. Should 
-00011000: 6265 206f 6e65 206f 6620 5b22 7822 2c20  be one of ["x", 
-00011010: 2279 222c 2022 7a22 5d20 0a20 2020 2020  "y", "z"] .     
-00011020: 2020 2020 2020 206f 7220 5b30 2c20 312c         or [0, 1,
-00011030: 2032 5d0a 0a20 2020 2020 2020 2073 696e   2]..        sin
-00011040: 676c 655f 736c 6963 6520 3a20 626f 6f6c  gle_slice : bool
-00011050: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00011060: 2020 2020 2020 2020 2020 2020 4966 2046              If F
-00011070: 616c 7365 2c20 7468 6520 3344 2065 7874  alse, the 3D ext
-00011080: 656e 7420 6f66 2074 6865 2065 6e74 6972  ent of the entir
-00011090: 6520 524f 4920 7769 6c6c 2062 6520 7265  e ROI will be re
-000110a0: 7475 726e 6564 3b0a 2020 2020 2020 2020  turned;.        
-000110b0: 2020 2020 6f74 6865 7277 6973 652c 2074      otherwise, t
-000110c0: 6865 2032 4420 6578 7465 6e74 206f 6620  he 2D extent of 
-000110d0: 6120 7369 6e67 6c65 2073 6c69 6365 2077  a single slice w
-000110e0: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
-000110f0: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
-00011100: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
-00011110: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
-00011120: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
-00011130: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
-00011140: 2067 6574 2065 7874 656e 742e 204f 6e6c   get extent. Onl
-00011150: 7920 7573 6564 2069 6620 0a20 2020 2020  y used if .     
-00011160: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
-00011170: 6963 653d 5472 7565 2e20 4966 2075 7369  ice=True. If usi
-00011180: 6e67 2c20 3c61 783e 206d 7573 7420 6265  ng, <ax> must be
-00011190: 2061 6e20 6178 6973 2074 6861 7420 6c69   an axis that li
-000111a0: 6573 2061 6c6f 6e67 0a20 2020 2020 2020  es along.       
-000111b0: 2020 2020 2074 6865 2073 6c69 6365 2069       the slice i
-000111c0: 6e20 7468 6973 206f 7269 656e 7461 7469  n this orientati
-000111d0: 6f6e 2e0a 0a20 2020 2020 2020 2073 6c20  on...        sl 
-000111e0: 3a20 696e 742c 2064 6566 6175 6c74 3d4e  : int, default=N
-000111f0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00011200: 536c 6963 6520 6e75 6d62 6572 2e20 4966  Slice number. If
-00011210: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00011220: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-00011230: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
-00011240: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
-00011250: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-00011260: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-00011270: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
-00011280: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-00011290: 2020 2020 2020 2069 6478 203a 2069 6e74         idx : int
-000112a0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000112b0: 2020 2020 2020 2020 2020 2041 7272 6179             Array
-000112c0: 2069 6e64 6578 206f 6620 736c 6963 652e   index of slice.
-000112d0: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
-000112e0: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
-000112f0: 2061 7265 2073 7570 706c 6965 6420 6275   are supplied bu
-00011300: 740a 2020 2020 2020 2020 2020 2020 3c73  t.            <s
-00011310: 696e 676c 655f 736c 6963 653e 2069 7320  ingle_slice> is 
-00011320: 5472 7565 2c20 7468 6520 6365 6e74 7261  True, the centra
-00011330: 6c20 736c 6963 6520 6f66 2074 6865 2052  l slice of the R
-00011340: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
-00011350: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
-00011360: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-00011370: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00011380: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
-00011390: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
-000113a0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-000113b0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
-000113c0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
-000113d0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
-000113e0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
-000113f0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-00011400: 7468 6520 524f 4920 7769 6c6c 2062 6520  the ROI will be 
-00011410: 7573 6564 2e0a 0a20 2020 2020 2020 206d  used...        m
-00011420: 6574 686f 6420 3a20 7374 722c 2064 6566  ethod : str, def
-00011430: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00011440: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
-00011450: 7573 6520 666f 7220 6578 7465 6e74 2063  use for extent c
-00011460: 616c 6375 6c61 7469 6f6e 2e20 4361 6e20  alculation. Can 
-00011470: 6265 3a20 0a0a 2020 2020 2020 2020 2020  be: ..          
-00011480: 2020 2020 2020 2a20 2263 6f6e 746f 7572        * "contour
-00011490: 223a 2067 6574 2065 7874 656e 7420 6672  ": get extent fr
-000114a0: 6f6d 206d 696e 2f6d 6178 2070 6f73 6974  om min/max posit
-000114b0: 696f 6e73 206f 6620 636f 6e74 6f75 7228  ions of contour(
-000114c0: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
-000114d0: 2020 2020 2a20 226d 6173 6b22 3a20 6765      * "mask": ge
-000114e0: 7420 6578 7465 6e74 2066 726f 6d20 6d69  t extent from mi
-000114f0: 6e2f 6d61 7820 706f 7369 7469 6f6e 7320  n/max positions 
-00011500: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
-00011510: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00011520: 2020 2020 6269 6e61 7279 206d 6173 6b2e      binary mask.
-00011530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011540: 202a 204e 6f6e 653a 2075 7365 2074 6865   * None: use the
-00011550: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
-00011560: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-00011570: 5f6d 6574 686f 642e 0a0a 2020 2020 2020  _method...      
-00011580: 2020 6f72 6967 696e 203a 2069 6e74 2f66    origin : int/f
-00011590: 6c6f 6174 2f74 7570 6c65 2c20 6465 6661  loat/tuple, defa
-000115a0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-000115b0: 2020 2020 2050 6f69 6e74 2077 6974 6820       Point with 
-000115c0: 7265 7370 6563 7420 746f 2077 6869 6368  respect to which
-000115d0: 2065 7874 656e 7473 2061 7265 2074 6f20   extents are to 
-000115e0: 6265 2064 6574 6572 6d69 6e65 642e 0a20  be determined.. 
-000115f0: 2020 2020 2020 2020 2020 2054 6869 7320             This 
-00011600: 6361 6e20 6265 2061 6e20 696e 7465 6765  can be an intege
-00011610: 7220 6f72 2066 6c6f 6174 2073 7065 6369  r or float speci
-00011620: 6679 696e 6720 7468 6520 706f 696e 7427  fying the point'
-00011630: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
-00011640: 6f72 6469 6e61 7465 2061 6c6f 6e67 2061  ordinate along a
-00011650: 7869 7320 3c61 783e 3b20 6f72 2069 7420  xis <ax>; or it 
-00011660: 6361 6e20 6265 2061 2074 7570 6c65 2073  can be a tuple s
-00011670: 7065 6369 6679 696e 670a 2020 2020 2020  pecifying.      
-00011680: 2020 2020 2020 7468 6520 706f 696e 7427        the point'
-00011690: 7320 2878 2c20 792c 207a 2920 636f 6f72  s (x, y, z) coor
-000116a0: 6469 6e61 7465 732c 2077 6865 7265 206f  dinates, where o
-000116b0: 6e6c 7920 7468 6520 636f 6f72 6469 6e61  nly the coordina
-000116c0: 7465 0a20 2020 2020 2020 2020 2020 2061  te.            a
-000116d0: 6c6f 6e67 2061 7869 7320 3c61 783e 2077  long axis <ax> w
-000116e0: 696c 6c20 6265 2063 6f6e 7369 6465 7265  ill be considere
-000116f0: 642e 2020 4966 204e 6f6e 652c 2074 6865  d.  If None, the
-00011700: 206f 7269 6769 6e0a 2020 2020 2020 2020   origin.        
-00011710: 2020 2020 636f 6f72 6469 6e61 7465 2069      coordinate i
-00011720: 7320 7461 6b65 6e20 746f 2062 6520 302e  s taken to be 0.
-00011730: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00011740: 2020 2020 2020 2320 4765 7420 6465 6661        # Get defa
-00011750: 756c 7420 736c 6963 6520 616e 6420 6d65  ult slice and me
-00011760: 7468 6f64 0a20 2020 2020 2020 2073 656c  thod.        sel
-00011770: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-00011780: 2069 6620 6d65 7468 6f64 2069 7320 4e6f   if method is No
-00011790: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000117a0: 6d65 7468 6f64 203d 2073 656c 662e 6465  method = self.de
-000117b0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-000117c0: 640a 2020 2020 2020 2020 6966 2073 696e  d.        if sin
-000117d0: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
-000117e0: 2020 2020 2020 2069 6620 6964 7820 6973         if idx is
-000117f0: 204e 6f6e 6520 616e 6420 736c 2069 7320   None and sl is 
-00011800: 4e6f 6e65 2061 6e64 2070 6f73 2069 7320  None and pos is 
-00011810: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00011820: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
-00011830: 2e67 6574 5f6d 6964 5f69 6478 2829 0a0a  .get_mid_idx()..
-00011840: 2020 2020 2020 2020 2320 4966 2075 7369          # If usi
-00011850: 6e67 2073 696e 676c 6520 736c 6963 652c  ng single slice,
-00011860: 2063 6865 636b 2074 6865 2061 7869 7320   check the axis 
-00011870: 6c69 6573 2061 6c6f 6e67 2074 6865 2073  lies along the s
-00011880: 6c69 6365 0a20 2020 2020 2020 2069 5f61  lice.        i_a
-00011890: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
-000118a0: 6178 6573 2e69 6e64 6578 2861 7829 2069  axes.index(ax) i
-000118b0: 6620 6973 696e 7374 616e 6365 2861 782c  f isinstance(ax,
-000118c0: 2073 7472 2920 656c 7365 2061 780a 2020   str) else ax.  
-000118d0: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
-000118e0: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
-000118f0: 2020 2069 6620 695f 6178 206e 6f74 2069     if i_ax not i
-00011900: 6e20 736b 7274 2e69 6d61 6765 2e5f 706c  n skrt.image._pl
-00011910: 6f74 5f61 7865 735b 7669 6577 5d3a 0a20  ot_axes[view]:. 
-00011920: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00011930: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
-00011940: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00011950: 2020 2020 2020 2066 2243 616e 6e6f 7420         f"Cannot 
-00011960: 636f 6d70 7574 6520 6578 7465 6e74 206f  compute extent o
-00011970: 6620 6178 6973 207b 6178 7d20 696e 2074  f axis {ax} in t
-00011980: 6865 207b 7669 6577 7d20 706c 616e 6521  he {view} plane!
-00011990: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-000119a0: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
-000119b0: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
-000119c0: 5d2e 696e 6465 7828 695f 6178 290a 0a20  ].index(i_ax).. 
-000119d0: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
-000119e0: 7468 6174 206f 7269 6769 6e20 6973 2061  that origin is a
-000119f0: 2073 696e 676c 6520 6e75 6d65 7269 6320   single numeric 
-00011a00: 7661 6c75 652e 0a20 2020 2020 2020 206f  value..        o
-00011a10: 7269 6769 6e20 3d20 6f72 6967 696e 206f  rigin = origin o
-00011a20: 7220 300a 2020 2020 2020 2020 6966 206e  r 0.        if n
-00011a30: 6f74 2069 7369 6e73 7461 6e63 6528 6f72  ot isinstance(or
-00011a40: 6967 696e 2c20 2866 6c6f 6174 2c20 696e  igin, (float, in
-00011a50: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
-00011a60: 206f 7269 6769 6e20 3d20 6f72 6967 696e   origin = origin
-00011a70: 5b69 5f61 785d 0a0a 2020 2020 2020 2020  [i_ax]..        
-00011a80: 2320 4361 6c63 756c 6174 6520 6578 7465  # Calculate exte
-00011a90: 6e74 2066 726f 6d20 636f 6e74 6f75 7273  nt from contours
-00011aa0: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
-00011ab0: 6f64 203d 3d20 2263 6f6e 746f 7572 223a  od == "contour":
-00011ac0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00011ad0: 4361 6c63 756c 6174 6520 6675 6c6c 207a  Calculate full z
-00011ae0: 2065 7874 656e 7420 6672 6f6d 2063 6f6e   extent from con
-00011af0: 746f 7572 2070 6f73 6974 696f 6e73 0a20  tour positions. 
-00011b00: 2020 2020 2020 2020 2020 2069 6620 2861             if (a
-00011b10: 7820 3d3d 2022 7a22 206f 7220 6178 203d  x == "z" or ax =
-00011b20: 3d20 3229 2061 6e64 206e 6f74 2073 696e  = 2) and not sin
-00011b30: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
-00011b40: 2020 2020 2020 2020 2020 207a 5f6b 6579             z_key
-00011b50: 7320 3d20 6c69 7374 2873 656c 662e 6765  s = list(self.ge
-00011b60: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
-00011b70: 292e 6b65 7973 2829 290a 2020 2020 2020  ).keys()).      
-00011b80: 2020 2020 2020 2020 2020 767a 203d 2073            vz = s
-00011b90: 656c 662e 6765 745f 736c 6963 655f 7468  elf.get_slice_th
-00011ba0: 6963 6b6e 6573 735f 636f 6e74 6f75 7273  ickness_contours
-00011bb0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00011bc0: 2020 2069 6620 7a5f 6b65 7973 3a0a 2020     if z_keys:.  
-00011bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011be0: 2020 7a5f 6d61 7820 3d20 6d61 7828 7a5f    z_max = max(z_
-00011bf0: 6b65 7973 2920 2b20 2076 7a20 2f20 320a  keys) +  vz / 2.
-00011c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c10: 2020 2020 7a5f 6d69 6e20 3d20 6d69 6e28      z_min = min(
-00011c20: 7a5f 6b65 7973 2920 2d20 767a 202f 2032  z_keys) - vz / 2
-00011c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011c40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00011c50: 2020 2020 2020 2020 2020 207a 5f6d 696e             z_min
-00011c60: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00011c70: 2020 2020 2020 2020 2020 2020 7a5f 6d61              z_ma
-00011c80: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
-00011c90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011ca0: 5b7a 5f6d 696e 2c20 7a5f 6d61 785d 0a0a  [z_min, z_max]..
-00011cb0: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
-00011cc0: 6865 7277 6973 652c 2063 616c 6375 6c61  herwise, calcula
-00011cd0: 7465 2065 7874 656e 7420 6672 6f6d 206d  te extent from m
-00011ce0: 696e 2f6d 6178 2063 6f6e 746f 7572 2070  in/max contour p
-00011cf0: 6f73 6974 696f 6e73 200a 2020 2020 2020  ositions .      
-00011d00: 2020 2020 2020 706f 696e 7473 203d 205b        points = [
-00011d10: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
-00011d20: 2047 6c6f 6261 6c3a 2075 7365 2065 7665   Global: use eve
-00011d30: 7279 2063 6f6e 746f 7572 0a20 2020 2020  ry contour.     
-00011d40: 2020 2020 2020 2069 6620 6e6f 7420 7369         if not si
-00011d50: 6e67 6c65 5f73 6c69 6365 3a0a 2020 2020  ngle_slice:.    
-00011d60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011d70: 692c 2063 6f6e 746f 7572 7320 696e 2073  i, contours in s
-00011d80: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
-00011d90: 2822 782d 7922 292e 6974 656d 7328 293a  ("x-y").items():
-00011da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011db0: 2020 2020 2066 6f72 2063 6f6e 746f 7572       for contour
-00011dc0: 2069 6e20 636f 6e74 6f75 7273 3a0a 2020   in contours:.  
-00011dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011de0: 2020 2020 2020 706f 696e 7473 2e65 7874        points.ext
-00011df0: 656e 6428 5b70 5b69 5f61 785d 2066 6f72  end([p[i_ax] for
-00011e00: 2070 2069 6e20 636f 6e74 6f75 725d 290a   p in contour]).
-00011e10: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-00011e20: 696e 676c 6520 736c 6963 653a 206a 7573  ingle slice: jus
-00011e30: 7420 7573 6520 7468 6520 636f 6e74 6f75  t use the contou
-00011e40: 7220 6f6e 2074 6865 2073 6c69 6365 0a20  r on the slice. 
-00011e50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00011e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011e70: 2066 6f72 2063 6f6e 746f 7572 2069 6e20   for contour in 
-00011e80: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
-00011e90: 735f 6f6e 5f73 6c69 6365 280a 2020 2020  s_on_slice(.    
-00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011eb0: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
-00011ec0: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
-00011ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ee0: 2020 2020 706f 696e 7473 2e65 7874 656e      points.exten
-00011ef0: 6428 5b70 5b69 5f61 785d 2066 6f72 2070  d([p[i_ax] for p
-00011f00: 2069 6e20 636f 6e74 6f75 725d 290a 0a20   in contour]).. 
-00011f10: 2020 2020 2020 2020 2020 2023 2052 6574             # Ret
-00011f20: 7572 6e20 6d69 6e20 616e 6420 6d61 7820  urn min and max 
-00011f30: 6f66 2074 6865 2070 6f69 6e74 7320 696e  of the points in
-00011f40: 2074 6865 2063 6f6e 746f 7572 2873 290a   the contour(s).
-00011f50: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00011f60: 656e 2870 6f69 6e74 7329 3a0a 2020 2020  en(points):.    
-00011f70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00011f80: 726e 205b 6d69 6e28 706f 696e 7473 2920  rn [min(points) 
-00011f90: 2d20 6f72 6967 696e 2c20 6d61 7828 706f  - origin, max(po
-00011fa0: 696e 7473 2920 2d20 6f72 6967 696e 5d0a  ints) - origin].
-00011fb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00011fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011fd0: 2020 7265 7475 726e 205b 4e6f 6e65 2c20    return [None, 
-00011fe0: 4e6f 6e65 5d0a 0a20 2020 2020 2020 2023  None]..        #
-00011ff0: 204f 7468 6572 7769 7365 2c20 6765 7420   Otherwise, get 
-00012000: 6578 7465 6e74 2066 726f 6d20 6d61 736b  extent from mask
-00012010: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
-00012020: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
-00012030: 2020 2020 6966 2069 5f61 7820 213d 2032      if i_ax != 2
-00012040: 3a20 2023 2054 7261 6e73 706f 7365 2078  :  # Transpose x
-00012050: 2d79 2061 7865 730a 2020 2020 2020 2020  -y axes.        
-00012060: 2020 2020 695f 6178 203d 2031 202d 2069      i_ax = 1 - i
-00012070: 5f61 780a 0a20 2020 2020 2020 2023 2047  _ax..        # G
-00012080: 6574 2070 6f73 6974 696f 6e73 206f 6620  et positions of 
-00012090: 766f 7865 6c73 2069 6e73 6964 6520 7468  voxels inside th
-000120a0: 6520 6d61 736b 0a20 2020 2020 2020 2069  e mask.        i
-000120b0: 6620 6e6f 7420 7369 6e67 6c65 5f73 6c69  f not single_sli
-000120c0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-000120d0: 6e6f 6e7a 6572 6f20 3d20 6e70 2e61 7267  nonzero = np.arg
-000120e0: 7768 6572 6528 7365 6c66 2e67 6574 5f6d  where(self.get_m
-000120f0: 6173 6b28 7374 616e 6461 7264 6973 653d  ask(standardise=
-00012100: 5472 7565 2929 0a20 2020 2020 2020 2065  True)).        e
-00012110: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00012120: 206e 6f6e 7a65 726f 203d 206e 702e 6172   nonzero = np.ar
-00012130: 6777 6865 7265 2873 656c 662e 6765 745f  gwhere(self.get_
-00012140: 736c 6963 6528 0a20 2020 2020 2020 2020  slice(.         
-00012150: 2020 2020 2020 2076 6965 772c 2073 6c3d         view, sl=
-00012160: 736c 2c20 6964 783d 6964 782c 2070 6f73  sl, idx=idx, pos
-00012170: 3d70 6f73 2929 0a20 2020 2020 2020 2076  =pos)).        v
-00012180: 616c 7320 3d20 6e6f 6e7a 6572 6f5b 3a2c  als = nonzero[:,
-00012190: 2069 5f61 785d 0a20 2020 2020 2020 2069   i_ax].        i
-000121a0: 6620 6e6f 7420 6c65 6e28 7661 6c73 293a  f not len(vals):
-000121b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000121c0: 7572 6e20 5b4e 6f6e 652c 204e 6f6e 655d  urn [None, None]
-000121d0: 0a0a 2020 2020 2020 2020 2320 4669 6e64  ..        # Find
-000121e0: 206d 696e 2061 6e64 206d 6178 2076 6f78   min and max vox
-000121f0: 656c 733b 2061 6464 2068 616c 6620 6120  els; add half a 
-00012200: 766f 7865 6c20 6569 7468 6572 2073 6964  voxel either sid
-00012210: 6520 746f 2067 6574 200a 2020 2020 2020  e to get .      
-00012220: 2020 2320 6675 6c6c 2065 7874 656e 740a    # full extent.
-00012230: 2020 2020 2020 2020 6d69 6e5f 706f 7320          min_pos 
-00012240: 3d20 6d69 6e28 7661 6c73 2920 2d20 302e  = min(vals) - 0.
-00012250: 350a 2020 2020 2020 2020 6d61 785f 706f  5.        max_po
-00012260: 7320 3d20 6d61 7828 7661 6c73 2920 2b20  s = max(vals) + 
-00012270: 302e 350a 0a20 2020 2020 2020 2023 2043  0.5..        # C
-00012280: 6f6e 7665 7274 2070 6f73 6974 696f 6e73  onvert positions
-00012290: 2074 6f20 6d6d 0a20 2020 2020 2020 2072   to mm.        r
-000122a0: 6574 7572 6e20 5b73 656c 662e 6964 785f  eturn [self.idx_
-000122b0: 746f 5f70 6f73 286d 696e 5f70 6f73 2c20  to_pos(min_pos, 
-000122c0: 6178 2920 2d20 6f72 6967 696e 2c0a 2020  ax) - origin,.  
-000122d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000122e0: 6c66 2e69 6478 5f74 6f5f 706f 7328 6d61  lf.idx_to_pos(ma
-000122f0: 785f 706f 732c 2061 7829 202d 206f 7269  x_pos, ax) - ori
-00012300: 6769 6e5d 0a0a 2020 2020 6465 6620 6765  gin]..    def ge
-00012310: 745f 6372 6f70 5f6c 696d 6974 7328 7365  t_crop_limits(se
-00012320: 6c66 2c20 6372 6f70 5f6d 6172 6769 6e73  lf, crop_margins
-00012330: 3d4e 6f6e 652c 206d 6574 686f 643d 4e6f  =None, method=No
-00012340: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00012350: 0a20 2020 2020 2020 2047 6574 2063 726f  .        Get cro
-00012360: 7020 6c69 6d69 7473 2063 6f72 7265 7370  p limits corresp
-00012370: 6f6e 6469 6e67 2074 6f20 524f 4920 6578  onding to ROI ex
-00012380: 7465 6e74 7320 706c 7573 206d 6172 6769  tents plus margi
-00012390: 6e73 2e0a 0a20 2020 2020 2020 2054 6865  ns...        The
-000123a0: 2074 7570 6c65 7320 6f66 206c 696d 6974   tuples of limit
-000123b0: 7320 7265 7475 726e 6564 2c20 696e 2074  s returned, in t
-000123c0: 6865 206f 7264 6572 2028 782c 2079 2c20  he order (x, y, 
-000123d0: 7a29 2063 616e 0a20 2020 2020 2020 2062  z) can.        b
-000123e0: 6520 7573 6564 2c20 666f 7220 6578 616d  e used, for exam
-000123f0: 706c 652c 2061 7320 696e 7075 7473 2074  ple, as inputs t
-00012400: 6f20 736b 7274 2e69 6d61 6765 2e49 6d61  o skrt.image.Ima
-00012410: 6765 2e63 726f 7028 292e 0a0a 2020 2020  ge.crop()...    
-00012420: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
-00012430: 6973 2073 696d 696c 6172 2074 6f20 7468  is similar to th
-00012440: 6520 6d65 7468 6f64 2067 6574 5f65 7874  e method get_ext
-00012450: 656e 7473 2829 2c20 6275 7420 616c 6c6f  ents(), but allo
-00012460: 7773 0a20 2020 2020 2020 2064 6966 6665  ws.        diffe
-00012470: 7265 6e74 206d 6172 6769 6e73 206f 6e20  rent margins on 
-00012480: 6561 6368 2073 6964 6520 6f66 2074 6865  each side of the
-00012490: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
-000124a0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
-000124b0: 2020 2020 2020 2020 6372 6f70 5f6d 6172          crop_mar
-000124c0: 6769 6e73 203a 2066 6c6f 6174 2f74 7570  gins : float/tup
-000124d0: 6c65 2c20 6465 6661 756c 743d 4e6f 6e65  le, default=None
-000124e0: 0a20 2020 2020 2020 2020 2020 2046 6c6f  .            Flo
-000124f0: 6174 206f 7220 7468 7265 652d 656c 656d  at or three-elem
-00012500: 656e 7420 7475 706c 6520 7370 6563 6966  ent tuple specif
-00012510: 7969 6e67 2074 6865 206d 6172 6769 6e73  ying the margins
-00012520: 2c20 696e 206d 6d2c 0a20 2020 2020 2020  , in mm,.       
-00012530: 2020 2020 2074 6f20 6265 2061 6464 6564       to be added
-00012540: 2074 6f20 524f 4920 6578 7465 6e74 732e   to ROI extents.
-00012550: 2020 4966 2061 2066 6c6f 6174 2c20 6d69    If a float, mi
-00012560: 6e75 7320 616e 6420 706c 7573 2074 6865  nus and plus the
-00012570: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00012580: 7565 2073 7065 6369 6669 6564 2061 7265  ue specified are
-00012590: 2061 6464 6564 2074 6f20 6c6f 7765 7220   added to lower 
-000125a0: 616e 6420 7570 7065 7220 6578 7465 6e74  and upper extent
-000125b0: 7320 7265 7370 6563 7469 7665 6c79 0a20  s respectively. 
-000125c0: 2020 2020 2020 2020 2020 2061 6c6f 6e67             along
-000125d0: 2065 6163 6820 6178 6973 2e20 2049 6620   each axis.  If 
-000125e0: 6120 7468 7265 652d 656c 656d 656e 7420  a three-element 
-000125f0: 7475 706c 652c 2065 6c65 6d65 6e74 7320  tuple, elements 
-00012600: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
-00012610: 7461 6b65 6e20 746f 2073 7065 6369 6679  taken to specify
-00012620: 206d 6172 6769 6e73 2069 6e20 7468 6520   margins in the 
-00012630: 6f72 6465 7220 2878 2c20 792c 207a 292e  order (x, y, z).
-00012640: 2020 456c 656d 656e 7473 0a20 2020 2020    Elements.     
-00012650: 2020 2020 2020 2063 616e 2062 6520 6569         can be ei
-00012660: 7468 6572 2066 6c6f 6174 7320 286d 696e  ther floats (min
-00012670: 7573 2061 6e64 2070 6c75 7320 7468 6520  us and plus the 
-00012680: 7661 6c75 6520 6164 6465 6420 7265 7370  value added resp
-00012690: 6563 7469 7665 6c79 0a20 2020 2020 2020  ectively.       
-000126a0: 2020 2020 2074 6f20 6c6f 7765 7220 616e       to lower an
-000126b0: 6420 7570 7065 7220 6578 7465 6e74 7329  d upper extents)
-000126c0: 206f 7220 7477 6f2d 656c 656d 656e 7420   or two-element 
-000126d0: 7475 706c 6573 2028 656c 656d 656e 7473  tuples (elements
-000126e0: 2030 2061 6e64 2031 0a20 2020 2020 2020   0 and 1.       
-000126f0: 2020 2020 2061 6464 6564 2072 6573 7065       added respe
-00012700: 6374 6976 656c 7920 746f 206c 6f77 6572  ctively to lower
-00012710: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
-00012720: 7473 292e 0a0a 2020 2020 2020 2020 6d65  ts)...        me
-00012730: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
-00012740: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00012750: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-00012760: 7365 2066 6f72 2065 7874 656e 7420 6361  se for extent ca
-00012770: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
-00012780: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-00012790: 2020 2020 2a20 2263 6f6e 746f 7572 223a      * "contour":
-000127a0: 2067 6574 2065 7874 656e 7420 6672 6f6d   get extent from
-000127b0: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
-000127c0: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
-000127d0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000127e0: 2020 2a20 226d 6173 6b22 3a20 6765 7420    * "mask": get 
-000127f0: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
-00012800: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
-00012810: 2076 6f78 656c 7320 696e 2074 6865 0a20   voxels in the. 
-00012820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012830: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
-00012840: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00012850: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
-00012860: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
-00012870: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-00012880: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
-00012890: 220a 2020 2020 2020 2020 6372 6f70 5f6c  ".        crop_l
-000128a0: 696d 6974 7320 3d20 7365 6c66 2e67 6574  imits = self.get
-000128b0: 5f65 7874 656e 7473 286d 6574 686f 643d  _extents(method=
-000128c0: 6d65 7468 6f64 290a 2020 2020 2020 2020  method).        
-000128d0: 6d61 7267 696e 7320 3d20 736b 7274 2e69  margins = skrt.i
-000128e0: 6d61 6765 2e63 6865 636b 6564 5f63 726f  mage.checked_cro
-000128f0: 705f 6c69 6d69 7473 2863 726f 705f 6d61  p_limits(crop_ma
-00012900: 7267 696e 7329 0a20 2020 2020 2020 2066  rgins).        f
-00012910: 6f72 2069 6478 3120 696e 2072 616e 6765  or idx1 in range
-00012920: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
-00012930: 2069 6620 6d61 7267 696e 735b 6964 7831   if margins[idx1
-00012940: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
-00012950: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00012960: 6f72 2069 6478 3220 696e 2072 616e 6765  or idx2 in range
-00012970: 2832 293a 0a20 2020 2020 2020 2020 2020  (2):.           
-00012980: 2020 2020 2020 2020 2063 726f 705f 6c69           crop_li
-00012990: 6d69 7473 5b69 6478 315d 5b69 6478 325d  mits[idx1][idx2]
-000129a0: 202b 3d20 6d61 7267 696e 735b 6964 7831   += margins[idx1
-000129b0: 5d5b 6964 7832 5d0a 0a20 2020 2020 2020  ][idx2]..       
-000129c0: 2072 6574 7572 6e20 6372 6f70 5f6c 696d   return crop_lim
-000129d0: 6974 730a 0a20 2020 2064 6566 2067 6574  its..    def get
-000129e0: 5f6c 656e 6774 6828 0a20 2020 2020 2020  _length(.       
-000129f0: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
-00012a00: 6178 3d22 7a22 2c20 0a20 2020 2020 2020  ax="z", .       
-00012a10: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
-00012a20: 6c73 652c 0a20 2020 2020 2020 2076 6965  lse,.        vie
-00012a30: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
-00012a40: 2073 6c3d 4e6f 6e65 2c20 0a20 2020 2020   sl=None, .     
-00012a50: 2020 2069 6478 3d4e 6f6e 652c 200a 2020     idx=None, .  
-00012a60: 2020 2020 2020 706f 733d 4e6f 6e65 2c20        pos=None, 
-00012a70: 0a20 2020 2020 2020 2075 6e69 7473 3d22  .        units="
-00012a80: 6d6d 222c 0a20 2020 2020 2020 206d 6574  mm",.        met
-00012a90: 686f 643d 4e6f 6e65 2c20 0a20 2020 2020  hod=None, .     
-00012aa0: 2020 2066 6f72 6365 3d54 7275 650a 2020     force=True.  
-00012ab0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00012ac0: 4765 7420 524f 4920 6c65 6e67 7468 2061  Get ROI length a
-00012ad0: 6c6f 6e67 2061 2067 6976 656e 2061 7869  long a given axi
-00012ae0: 732e 2049 6620 7369 6e67 6c65 5f73 6c69  s. If single_sli
-00012af0: 6365 3d46 616c 7365 2028 692e 652e 2061  ce=False (i.e. a
-00012b00: 200a 2020 2020 2020 2020 676c 6f62 616c   .        global
-00012b10: 206c 656e 6774 6820 6973 2072 6571 7565   length is reque
-00012b20: 7374 6564 292c 2063 616c 6375 6c61 7465  sted), calculate
-00012b30: 6420 6c65 6e67 7468 2077 696c 6c20 6265  d length will be
-00012b40: 2063 6163 6865 6420 696e 200a 2020 2020   cached in .    
-00012b50: 2020 2020 7365 6c66 2e5f 6c65 6e67 7468      self._length
-00012b60: 5b61 785d 5b75 6e69 7473 5d20 616e 6420  [ax][units] and 
-00012b70: 7265 7475 726e 6564 2069 6620 6361 6c6c  returned if call
-00012b80: 6564 2061 6761 696e 2c20 756e 6c65 7373  ed again, unless
-00012b90: 2066 6f72 6365 3d54 7275 652e 0a0a 2020   force=True...  
-00012ba0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-00012bb0: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
-00012bc0: 2020 2020 2020 2061 7820 3a20 7374 722f         ax : str/
-00012bd0: 696e 742c 2064 6566 6175 6c74 3d22 7a22  int, default="z"
-00012be0: 0a20 2020 2020 2020 2020 2020 2041 7869  .            Axi
-00012bf0: 7320 616c 6f6e 6720 7768 6963 6820 746f  s along which to
-00012c00: 2072 6574 7572 6e20 6c65 6e67 7468 3b20   return length; 
-00012c10: 7368 6f75 6c64 2062 6520 6f6e 6520 6f66  should be one of
-00012c20: 205b 2278 222c 2022 7922 2c20 227a 225d   ["x", "y", "z"]
-00012c30: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-00012c40: 5b30 2c20 312c 2032 5d2e 0a0a 2020 2020  [0, 1, 2]...    
-00012c50: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
-00012c60: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00012c70: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-00012c80: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
-00012c90: 206c 656e 6774 6820 6f66 2074 6865 2065   length of the e
-00012ca0: 6e74 6972 6520 524f 4920 7769 6c6c 2062  ntire ROI will b
-00012cb0: 6520 7265 7475 726e 6564 3b0a 2020 2020  e returned;.    
-00012cc0: 2020 2020 2020 2020 6f74 6865 7277 6973          otherwis
-00012cd0: 652c 2074 6865 206c 656e 6774 6820 6f6e  e, the length on
-00012ce0: 2061 2073 696e 676c 6520 736c 6963 6520   a single slice 
-00012cf0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-00012d00: 2e0a 0a20 2020 2020 2020 2076 6965 7720  ...        view 
-00012d10: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
-00012d20: 782d 7922 0a20 2020 2020 2020 2020 2020  x-y".           
-00012d30: 204f 7269 656e 7461 7469 6f6e 206f 6620   Orientation of 
-00012d40: 736c 6963 6520 6f6e 2077 6869 6368 2074  slice on which t
-00012d50: 6f20 6765 7420 6c65 6e67 7468 2e20 4f6e  o get length. On
-00012d60: 6c79 2075 7365 6420 6966 200a 2020 2020  ly used if .    
-00012d70: 2020 2020 2020 2020 7369 6e67 6c65 5f73          single_s
-00012d80: 6c69 6365 3d54 7275 652e 2049 6620 7573  lice=True. If us
-00012d90: 696e 672c 203c 6178 3e20 6d75 7374 2062  ing, <ax> must b
-00012da0: 6520 616e 2061 7869 7320 7468 6174 206c  e an axis that l
-00012db0: 6965 7320 616c 6f6e 670a 2020 2020 2020  ies along.      
-00012dc0: 2020 2020 2020 7468 6520 736c 6963 6520        the slice 
-00012dd0: 696e 2074 6869 7320 6f72 6965 6e74 6174  in this orientat
-00012de0: 696f 6e2e 0a0a 2020 2020 2020 2020 736c  ion...        sl
-00012df0: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
-00012e00: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00012e10: 2053 6c69 6365 206e 756d 6265 722e 2049   Slice number. I
-00012e20: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
-00012e30: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
-00012e40: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
-00012e50: 2020 2020 2020 2020 2020 2020 3c73 696e              <sin
-00012e60: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
-00012e70: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
-00012e80: 736c 6963 6520 6f66 2074 6865 2052 4f49  slice of the ROI
-00012e90: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-00012ea0: 2020 2020 2020 2020 6964 7820 3a20 696e          idx : in
-00012eb0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00012ec0: 2020 2020 2020 2020 2020 2020 4172 7261              Arra
-00012ed0: 7920 696e 6465 7820 6f66 2073 6c69 6365  y index of slice
-00012ee0: 2e20 4966 206e 6f6e 6520 6f66 203c 736c  . If none of <sl
-00012ef0: 3e2c 203c 6964 783e 206f 7220 3c70 6f73  >, <idx> or <pos
-00012f00: 3e20 6172 6520 7375 7070 6c69 6564 2062  > are supplied b
-00012f10: 7574 0a20 2020 2020 2020 2020 2020 203c  ut.            <
-00012f20: 7369 6e67 6c65 5f73 6c69 6365 3e20 6973  single_slice> is
-00012f30: 2054 7275 652c 2074 6865 2063 656e 7472   True, the centr
-00012f40: 616c 2073 6c69 6365 206f 6620 7468 6520  al slice of the 
-00012f50: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
-00012f60: 2e0a 0a20 2020 2020 2020 2070 6f73 203a  ...        pos :
-00012f70: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
-00012f80: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00012f90: 2053 6c69 6365 2070 6f73 6974 696f 6e20   Slice position 
-00012fa0: 696e 206d 6d2e 2049 6620 6e6f 6e65 206f  in mm. If none o
-00012fb0: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
-00012fc0: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
-00012fd0: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
-00012fe0: 2020 2020 3c73 696e 676c 655f 736c 6963      <single_slic
-00012ff0: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
-00013000: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
-00013010: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
-00013020: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00013030: 756e 6974 7320 3a20 7374 722c 2064 6566  units : str, def
-00013040: 6175 6c74 3d22 6d6d 220a 2020 2020 2020  ault="mm".      
-00013050: 2020 2020 2020 556e 6974 7320 6f66 206c        Units of l
-00013060: 656e 6774 682e 2043 616e 2062 6520 6569  ength. Can be ei
-00013070: 7468 6572 206f 663a 0a20 2020 2020 2020  ther of:.       
-00013080: 2020 2020 2020 2020 202d 2022 6d6d 223a           - "mm":
-00013090: 2072 6574 7572 6e20 6c65 6e67 7468 2069   return length i
-000130a0: 6e20 6d69 6c6c 696d 6574 7265 732e 0a20  n millimetres.. 
-000130b0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-000130c0: 2022 766f 7865 6c73 223a 2072 6574 7572   "voxels": retur
-000130d0: 6e20 6c65 6e67 7468 2069 6e20 6e75 6d62  n length in numb
-000130e0: 6572 206f 6620 766f 7865 6c73 2e0a 0a20  er of voxels... 
-000130f0: 2020 2020 2020 2020 2020 2049 6620 756e             If un
-00013100: 6974 733d 2276 6f78 656c 7322 2069 7320  its="voxels" is 
-00013110: 7265 7175 6573 7465 6420 6275 7420 7468  requested but th
-00013120: 6973 2052 4f49 206f 6e6c 7920 6861 7320  is ROI only has 
-00013130: 636f 6e74 6f75 7273 2061 6e64 206e 6f0a  contours and no.
-00013140: 2020 2020 2020 2020 2020 2020 766f 7865              voxe
-00013150: 6c20 7369 7a65 2069 6e66 6f72 6d61 7469  l size informati
-00013160: 6f6e 2c20 616e 2065 7272 6f72 2077 696c  on, an error wil
-00013170: 6c20 6265 2072 6169 7365 6420 2875 6e6c  l be raised (unl
-00013180: 6573 7320 6178 3d22 7a22 2c20 0a20 2020  ess ax="z", .   
-00013190: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
-000131a0: 6820 6361 7365 2076 6f78 656c 2073 697a  h case voxel siz
-000131b0: 6520 7769 6c6c 2062 6520 696e 6665 7272  e will be inferr
-000131c0: 6564 2066 726f 6d20 7370 6163 696e 6720  ed from spacing 
-000131d0: 6265 7477 6565 6e0a 2020 2020 2020 2020  between.        
-000131e0: 2020 2020 736c 6963 6573 292e 0a0a 2020      slices)...  
-000131f0: 2020 2020 2020 6d65 7468 6f64 203a 2073        method : s
-00013200: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-00013210: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
-00013220: 686f 6420 746f 2075 7365 2066 6f72 206c  hod to use for l
-00013230: 656e 6774 6820 6361 6c63 756c 6174 696f  ength calculatio
-00013240: 6e2e 2043 616e 2062 653a 200a 2020 2020  n. Can be: .    
-00013250: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
-00013260: 6f6e 746f 7572 223a 2067 6574 206c 656e  ontour": get len
-00013270: 6774 6820 6672 6f6d 206d 696e 2f6d 6178  gth from min/max
-00013280: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
-00013290: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
-000132a0: 2020 2020 2020 2020 2020 2d20 226d 6173            - "mas
-000132b0: 6b22 3a20 6765 7420 6c65 6e67 7468 2066  k": get length f
-000132c0: 726f 6d20 6d69 6e2f 6d61 7820 706f 7369  rom min/max posi
-000132d0: 7469 6f6e 7320 6f66 2076 6f78 656c 7320  tions of voxels 
-000132e0: 696e 2074 6865 200a 2020 2020 2020 2020  in the .        
-000132f0: 2020 2020 2020 2020 2020 6269 6e61 7279            binary
-00013300: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
-00013310: 2020 2020 2020 202d 204e 6f6e 653a 2075         - None: u
-00013320: 7365 2074 6865 206d 6574 686f 6420 7365  se the method se
-00013330: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
-00013340: 745f 6765 6f6d 5f6d 6574 686f 642e 0a0a  t_geom_method...
-00013350: 2020 2020 2020 2020 666f 7263 6520 3a20          force : 
-00013360: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
-00013370: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
-00013380: 6620 5472 7565 2c20 7468 6520 6c65 6e67  f True, the leng
-00013390: 7468 2077 696c 6c20 616c 7761 7973 2062  th will always b
-000133a0: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
-000133b0: 6f74 6865 7277 6973 652c 2069 7420 7769  otherwise, it wi
-000133c0: 6c6c 0a20 2020 2020 2020 2020 2020 206f  ll.            o
-000133d0: 6e6c 7920 6265 2063 616c 6375 6c61 7465  nly be calculate
-000133e0: 6420 6966 2069 7420 6861 7320 6e6f 7420  d if it has not 
-000133f0: 7965 7420 6265 656e 2063 6163 6865 6420  yet been cached 
-00013400: 696e 2073 656c 662e 5f76 6f6c 756d 652e  in self._volume.
-00013410: 0a20 2020 2020 2020 2020 2020 204e 6f74  .            Not
-00013420: 6520 7468 6174 2069 6620 7369 6e67 6c65  e that if single
-00013430: 5f73 6c69 6365 3d54 7275 652c 2074 6865  _slice=True, the
-00013440: 206c 656e 6774 6820 7769 6c6c 2061 6c77   length will alw
-00013450: 6179 7320 6265 200a 2020 2020 2020 2020  ays be .        
-00013460: 2020 2020 7265 6361 6c63 756c 6174 6564      recalculated
-00013470: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00013480: 2020 2020 2020 2023 2049 6620 676c 6f62         # If glob
-00013490: 616c 206c 656e 6774 6820 616c 7265 6164  al length alread
-000134a0: 7920 6361 6368 6564 2c20 7265 7475 726e  y cached, return
-000134b0: 2063 6163 6865 6420 7661 6c75 650a 2020   cached value.  
-000134c0: 2020 2020 2020 6966 206e 6f74 2073 696e        if not sin
-000134d0: 676c 655f 736c 6963 6520 616e 6420 6e6f  gle_slice and no
-000134e0: 7420 666f 7263 653a 0a20 2020 2020 2020  t force:.       
-000134f0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00013500: 7365 6c66 2c20 225f 6c65 6e67 7468 2229  self, "_length")
-00013510: 2061 6e64 2061 7820 696e 2073 656c 662e   and ax in self.
-00013520: 5f6c 656e 6774 6820 5c0a 2020 2020 2020  _length \.      
-00013530: 2020 2020 2020 2020 2061 6e64 2075 6e69           and uni
-00013540: 7473 2069 6e20 7365 6c66 2e5f 6c65 6e67  ts in self._leng
-00013550: 7468 5b61 785d 3a0a 2020 2020 2020 2020  th[ax]:.        
-00013560: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00013570: 656c 662e 5f6c 656e 6774 685b 6178 5d5b  elf._length[ax][
-00013580: 756e 6974 735d 0a0a 2020 2020 2020 2020  units]..        
-00013590: 2320 4966 2073 696e 676c 6520 736c 6963  # If single slic
-000135a0: 6520 7265 7175 6573 7465 6420 616e 6420  e requested and 
-000135b0: 6e6f 7420 6f6e 2063 7572 7265 6e74 2073  not on current s
-000135c0: 6c69 6365 2c20 7265 7475 726e 204e 6f6e  lice, return Non
-000135d0: 650a 2020 2020 2020 2020 6966 2073 696e  e.        if sin
-000135e0: 676c 655f 736c 6963 6520 616e 6420 6e6f  gle_slice and no
-000135f0: 7420 7365 6c66 2e6f 6e5f 736c 6963 6528  t self.on_slice(
-00013600: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
-00013610: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
-00013620: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013630: 726e 204e 6f6e 650a 0a20 2020 2020 2020  rn None..       
-00013640: 2023 2047 6574 206c 656e 6774 6820 696e   # Get length in
-00013650: 206d 6d20 6672 6f6d 206d 696e 2061 6e64   mm from min and
-00013660: 206d 6178 2070 6f73 6974 696f 6e73 0a20   max positions. 
-00013670: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00013680: 2829 0a20 2020 2020 2020 206d 696e 5f70  ().        min_p
-00013690: 6f73 2c20 6d61 785f 706f 7320 3d20 7365  os, max_pos = se
-000136a0: 6c66 2e67 6574 5f65 7874 656e 7428 0a20  lf.get_extent(. 
-000136b0: 2020 2020 2020 2020 2020 2061 783d 6178             ax=ax
-000136c0: 2c20 0a20 2020 2020 2020 2020 2020 2073  , .            s
-000136d0: 696e 676c 655f 736c 6963 653d 7369 6e67  ingle_slice=sing
-000136e0: 6c65 5f73 6c69 6365 2c0a 2020 2020 2020  le_slice,.      
-000136f0: 2020 2020 2020 7669 6577 3d76 6965 772c        view=view,
-00013700: 0a20 2020 2020 2020 2020 2020 2073 6c3d  .            sl=
-00013710: 736c 2c0a 2020 2020 2020 2020 2020 2020  sl,.            
-00013720: 6964 783d 6964 782c 0a20 2020 2020 2020  idx=idx,.       
-00013730: 2020 2020 2070 6f73 3d70 6f73 2c0a 2020       pos=pos,.  
-00013740: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00013750: 3d6d 6574 686f 640a 2020 2020 2020 2020  =method.        
-00013760: 290a 2020 2020 2020 2020 6c65 6e67 7468  ).        length
-00013770: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00013780: 2022 6d6d 223a 2061 6273 286d 6178 5f70   "mm": abs(max_p
-00013790: 6f73 202d 206d 696e 5f70 6f73 290a 2020  os - min_pos).  
-000137a0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-000137b0: 2023 2047 6574 206c 656e 6774 6820 696e   # Get length in
-000137c0: 2076 6f78 656c 730a 2020 2020 2020 2020   voxels.        
-000137d0: 2320 4361 7365 2077 6865 7265 2076 6f78  # Case where vox
-000137e0: 656c 2073 697a 6520 6973 206b 6e6f 776e  el size is known
-000137f0: 0a20 2020 2020 2020 2069 5f61 7820 3d20  .        i_ax = 
-00013800: 736b 7274 2e69 6d61 6765 2e5f 6178 6573  skrt.image._axes
-00013810: 2e69 6e64 6578 2861 7829 2069 6620 6973  .index(ax) if is
-00013820: 696e 7374 616e 6365 2861 782c 2073 7472  instance(ax, str
-00013830: 2920 656c 7365 2061 780a 2020 2020 2020  ) else ax.      
-00013840: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
-00013850: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-00013860: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
-00013870: 6e67 7468 5b22 766f 7865 6c73 225d 203d  ngth["voxels"] =
-00013880: 206c 656e 6774 685b 226d 6d22 5d20 2f20   length["mm"] / 
-00013890: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
-000138a0: 695f 6178 5d0a 0a20 2020 2020 2020 2023  i_ax]..        #
-000138b0: 2044 6561 6c20 7769 7468 2063 6173 6520   Deal with case 
-000138c0: 7768 6572 6520 7365 6c66 2e76 6f78 656c  where self.voxel
-000138d0: 5f73 697a 6520 6973 204e 6f6e 650a 2020  _size is None.  
-000138e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000138f0: 2020 2020 2020 2020 6966 2069 5f61 7820          if i_ax 
-00013900: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
-00013910: 2020 2020 2020 6c65 6e67 7468 5b22 766f        length["vo
-00013920: 7865 6c73 225d 203d 206c 656e 6774 685b  xels"] = length[
-00013930: 226d 6d22 5d20 2f20 7365 6c66 2e67 6574  "mm"] / self.get
-00013940: 5f73 6c69 6365 5f74 6869 636b 6e65 7373  _slice_thickness
-00013950: 5f63 6f6e 746f 7572 7328 290a 2020 2020  _contours().    
-00013960: 2020 2020 2020 2020 656c 6966 2075 6e69          elif uni
-00013970: 7473 203d 3d20 2276 6f78 656c 7322 3a0a  ts == "voxels":.
-00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013990: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-000139a0: 6f72 2822 4361 6e6e 6f74 2063 6f6d 7075  or("Cannot compu
-000139b0: 7465 206c 656e 6774 6820 696e 2076 6f78  te length in vox
-000139c0: 656c 7320 6672 6f6d 2022 0a20 2020 2020  els from ".     
-000139d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139e0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-000139f0: 6f6e 746f 7572 7320 7769 7468 6f75 7420  ontours without 
-00013a00: 6b6e 6f77 696e 6720 766f 7865 6c20 7369  knowing voxel si
-00013a10: 7a65 7321 2229 0a0a 2020 2020 2020 2020  zes!")..        
-00013a20: 0a20 2020 2020 2020 2023 2043 6163 6865  .        # Cache
-00013a30: 2074 6865 2070 726f 7065 7274 7920 6966   the property if
-00013a40: 2067 6c6f 6261 6c0a 2020 2020 2020 2020   global.        
-00013a50: 6966 206e 6f74 2073 696e 676c 655f 736c  if not single_sl
-00013a60: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
-00013a70: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00013a80: 7365 6c66 2c20 225f 6c65 6e67 7468 2229  self, "_length")
-00013a90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013aa0: 2020 7365 6c66 2e5f 6c65 6e67 7468 203d    self._length =
-00013ab0: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-00013ac0: 7365 6c66 2e5f 6c65 6e67 7468 5b73 6b72  self._length[skr
-00013ad0: 742e 696d 6167 652e 5f61 7865 735b 695f  t.image._axes[i_
-00013ae0: 6178 5d5d 203d 206c 656e 6774 680a 2020  ax]] = length.  
-00013af0: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
-00013b00: 2052 6574 7572 6e20 6465 7369 7265 6420   Return desired 
-00013b10: 756e 6974 730a 2020 2020 2020 2020 7265  units.        re
-00013b20: 7475 726e 206c 656e 6774 685b 756e 6974  turn length[unit
-00013b30: 735d 0a0a 2020 2020 6465 6620 6765 745f  s]..    def get_
-00013b40: 6765 6f6d 6574 7279 280a 2020 2020 2020  geometry(.      
-00013b50: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00013b60: 6d65 7472 6963 733d 4e6f 6e65 2c0a 2020  metrics=None,.  
-00013b70: 2020 2020 2020 766f 6c5f 756e 6974 733d        vol_units=
-00013b80: 226d 6d22 2c0a 2020 2020 2020 2020 6172  "mm",.        ar
-00013b90: 6561 5f75 6e69 7473 3d22 6d6d 222c 0a20  ea_units="mm",. 
-00013ba0: 2020 2020 2020 206c 656e 6774 685f 756e         length_un
-00013bb0: 6974 733d 226d 6d22 2c0a 2020 2020 2020  its="mm",.      
-00013bc0: 2020 6365 6e74 726f 6964 5f75 6e69 7473    centroid_units
-00013bd0: 3d22 6d6d 222c 0a20 2020 2020 2020 2076  ="mm",.        v
-00013be0: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
-00013bf0: 2020 2073 6c3d 4e6f 6e65 2c0a 2020 2020     sl=None,.    
-00013c00: 2020 2020 706f 733d 4e6f 6e65 2c0a 2020      pos=None,.  
-00013c10: 2020 2020 2020 6964 783d 4e6f 6e65 2c0a        idx=None,.
-00013c20: 2020 2020 2020 2020 6d65 7468 6f64 3d4e          method=N
-00013c30: 6f6e 652c 0a20 2020 2020 2020 2075 6e69  one,.        uni
-00013c40: 7473 5f69 6e5f 6865 6164 6572 3d46 616c  ts_in_header=Fal
-00013c50: 7365 2c0a 2020 2020 2020 2020 676c 6f62  se,.        glob
-00013c60: 616c 5f76 735f 736c 6963 655f 6865 6164  al_vs_slice_head
-00013c70: 6572 3d46 616c 7365 2c0a 2020 2020 2020  er=False,.      
-00013c80: 2020 6e61 6d65 5f61 735f 696e 6465 783d    name_as_index=
-00013c90: 5472 7565 2c0a 2020 2020 2020 2020 6e69  True,.        ni
-00013ca0: 6365 5f63 6f6c 756d 6e73 3d46 616c 7365  ce_columns=False
-00013cb0: 2c0a 2020 2020 2020 2020 6465 6369 6d61  ,.        decima
-00013cc0: 6c5f 706c 6163 6573 3d4e 6f6e 652c 0a20  l_places=None,. 
-00013cd0: 2020 2020 2020 2066 6f72 6365 3d54 7275         force=Tru
-00013ce0: 652c 0a20 2020 2020 2020 2068 746d 6c3d  e,.        html=
-00013cf0: 4661 6c73 650a 2020 2020 293a 0a20 2020  False.    ):.   
-00013d00: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
-00013d10: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-00013d20: 6520 6f72 2068 746d 6c20 7461 626c 6520  e or html table 
-00013d30: 6f66 2074 6865 2067 656f 6d65 7472 6963  of the geometric
-00013d40: 2070 726f 7065 7274 6965 7320 0a20 2020   properties .   
-00013d50: 2020 2020 206c 6973 7465 6420 696e 203c       listed in <
-00013d60: 6d65 7472 6963 733e 2e0a 0a20 2020 2020  metrics>...     
-00013d70: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00013d80: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-00013d90: 2020 2020 6d65 7472 6963 7320 3a20 6c69      metrics : li
-00013da0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
-00013db0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
-00013dc0: 7420 6f66 206d 6574 7269 6373 2074 6f20  t of metrics to 
-00013dd0: 696e 636c 7564 6520 696e 2074 6865 2074  include in the t
-00013de0: 6162 6c65 2e20 4f70 7469 6f6e 733a 0a0a  able. Options:..
-00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e00: 2d20 2276 6f6c 756d 6522 203a 2076 6f6c  - "volume" : vol
-00013e10: 756d 6520 6f66 2065 6e74 6972 6520 524f  ume of entire RO
-00013e20: 492e 0a20 2020 2020 2020 2020 2020 2020  I..             
-00013e30: 2020 202d 2022 6172 6561 223a 2061 7265     - "area": are
-00013e40: 6120 6f66 2052 4f49 206f 6e20 6120 7369  a of ROI on a si
-00013e50: 6e67 6c65 2073 6c69 6365 2e0a 0a20 2020  ngle slice...   
-00013e60: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-00013e70: 6365 6e74 726f 6964 223a 2033 4420 6365  centroid": 3D ce
-00013e80: 6e74 7265 2d6f 662d 6d61 7373 206f 6620  ntre-of-mass of 
-00013e90: 524f 493b 2077 696c 6c20 6265 2073 706c  ROI; will be spl
-00013ea0: 6974 2069 6e74 6f0a 2020 2020 2020 2020  it into.        
-00013eb0: 2020 2020 2020 2020 2020 7468 7265 6520            three 
-00013ec0: 636f 6c75 6d6e 7320 636f 7272 6573 706f  columns correspo
-00013ed0: 6e64 696e 6720 746f 2074 6865 2074 6872  nding to the thr
-00013ee0: 6565 2061 7865 732e 0a20 2020 2020 2020  ee axes..       
-00013ef0: 2020 2020 2020 2020 202d 2022 6365 6e74           - "cent
-00013f00: 726f 6964 5f73 6c69 6365 223a 2032 4420  roid_slice": 2D 
-00013f10: 6365 6e74 7265 206f 6620 6d61 7373 206f  centre of mass o
-00013f20: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
-00013f30: 2e20 5769 6c6c 0a20 2020 2020 2020 2020  . Will.         
-00013f40: 2020 2020 2020 2020 2062 6520 7370 6c69           be spli
-00013f50: 7420 696e 746f 2074 776f 2063 6f6c 756d  t into two colum
-00013f60: 6e73 2063 6f72 7265 7370 6f6e 6469 6e67  ns corresponding
-00013f70: 2074 6f20 7468 6520 7477 6f20 6178 6573   to the two axes
-00013f80: 206f 6e0a 2020 2020 2020 2020 2020 2020   on.            
-00013f90: 2020 2020 2020 7468 6520 736c 6963 652e        the slice.
-00013fa0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013fb0: 2020 2d20 226c 656e 6774 6822 3a20 6c65    - "length": le
-00013fc0: 6e67 7468 7320 6f66 2074 6865 2052 4f49  ngths of the ROI
-00013fd0: 2069 6e20 6561 6368 2064 6972 6563 7469   in each directi
-00013fe0: 6f6e 3b20 7769 6c6c 2062 6520 7370 6c69  on; will be spli
-00013ff0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00014000: 2020 2020 696e 746f 2074 6872 6565 2063      into three c
-00014010: 6f6c 756d 6e73 2063 6f72 7265 7370 6f6e  olumns correspon
-00014020: 6469 6e67 2074 6f20 7468 6520 7468 7265  ding to the thre
-00014030: 6520 6178 6573 2e0a 2020 2020 2020 2020  e axes..        
-00014040: 2020 2020 2020 2020 2d20 226c 656e 6774          - "lengt
-00014050: 685f 736c 6963 6522 3a20 6c65 6e67 7468  h_slice": length
-00014060: 206f 6620 7468 6520 524f 4920 6f6e 2061   of the ROI on a
-00014070: 2073 696e 676c 6520 736c 6963 653b 2077   single slice; w
-00014080: 696c 6c20 6265 0a20 2020 2020 2020 2020  ill be.         
-00014090: 2020 2020 2020 2020 2073 706c 6974 2069           split i
-000140a0: 6e74 6f20 7477 6f20 636f 6c75 6d6e 7320  nto two columns 
-000140b0: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
-000140c0: 2074 6865 2074 776f 2061 7865 7320 6f6e   the two axes on
-000140d0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-000140e0: 2020 2020 2020 2073 6c69 6365 2e0a 0a20         slice... 
-000140f0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
-00014100: 6e65 2c20 6465 6661 756c 7473 2074 6f20  ne, defaults to 
-00014110: 5b22 766f 6c75 6d65 222c 2022 6365 6e74  ["volume", "cent
-00014120: 726f 6964 225d 0a0a 2020 2020 2020 2020  roid"]..        
-00014130: 766f 6c5f 756e 6974 7320 3a20 7374 722c  vol_units : str,
-00014140: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
-00014150: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
-00014160: 746f 2075 7365 2066 6f72 2076 6f6c 756d  to use for volum
-00014170: 652e 2043 616e 2062 6520 226d 6d22 2028  e. Can be "mm" (
-00014180: 3d6d 6d5e 3329 2c20 226d 6c22 2c0a 2020  =mm^3), "ml",.  
-00014190: 2020 2020 2020 2020 2020 6f72 2022 766f            or "vo
-000141a0: 7865 6c73 222e 0a0a 2020 2020 2020 2020  xels"...        
-000141b0: 6172 6561 5f75 6e69 7473 203a 2073 7472  area_units : str
-000141c0: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
-000141d0: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
-000141e0: 2074 6f20 7573 6520 666f 7220 6172 6561   to use for area
-000141f0: 732e 2043 616e 2062 6520 226d 6d22 2028  s. Can be "mm" (
-00014200: 3d6d 6d5e 3229 206f 7220 2276 6f78 656c  =mm^2) or "voxel
-00014210: 7322 2e0a 0a20 2020 2020 2020 206c 656e  s"...        len
-00014220: 6774 685f 756e 6974 7320 3a20 7374 722c  gth_units : str,
-00014230: 2064 6566 6175 6c74 3d22 6d6d 223a 0a20   default="mm":. 
-00014240: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
-00014250: 2074 6f20 7573 6520 666f 7220 6c65 6e67   to use for leng
-00014260: 7468 732e 2043 616e 2062 6520 226d 6d22  ths. Can be "mm"
-00014270: 206f 7220 2276 6f78 656c 7322 2e0a 0a20   or "voxels"... 
-00014280: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
-00014290: 756e 6974 733a 0a20 2020 2020 2020 2020  units:.         
-000142a0: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
-000142b0: 666f 7220 6365 6e74 726f 6964 732e 2043  for centroids. C
-000142c0: 616e 2062 6520 226d 6d22 206f 7220 2276  an be "mm" or "v
-000142d0: 6f78 656c 7322 2e0a 0a20 2020 2020 2020  oxels"...       
-000142e0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
-000142f0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
-00014300: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
-00014310: 6f6e 2069 6e20 7768 6963 6820 746f 2063  on in which to c
-00014320: 6f6d 7075 7465 206d 6574 7269 6373 2e20  ompute metrics. 
-00014330: 4f6e 6c79 2072 656c 6576 616e 7420 666f  Only relevant fo
-00014340: 7220 0a20 2020 2020 2020 2020 2020 2073  r .            s
-00014350: 696e 676c 652d 736c 6963 6520 6d65 7472  ingle-slice metr
-00014360: 6963 7320 2861 7265 612c 2063 656e 7472  ics (area, centr
-00014370: 6f69 645f 736c 6963 652c 206c 656e 6774  oid_slice, lengt
-00014380: 685f 736c 6963 6529 2e0a 0a20 2020 2020  h_slice)...     
-00014390: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
-000143a0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-000143b0: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
-000143c0: 6572 206f 6e20 7768 6963 6820 746f 2063  er on which to c
-000143d0: 6f6d 7075 7465 206d 6574 7269 6373 2e20  ompute metrics. 
-000143e0: 4f6e 6c79 2072 656c 6576 616e 7420 666f  Only relevant fo
-000143f0: 7220 0a20 2020 2020 2020 2020 2020 2073  r .            s
-00014400: 696e 676c 652d 736c 6963 6520 6d65 7472  ingle-slice metr
-00014410: 6963 7320 2861 7265 612c 2063 656e 7472  ics (area, centr
-00014420: 6f69 645f 736c 6963 652c 206c 656e 6774  oid_slice, lengt
-00014430: 685f 736c 6963 6529 2e0a 2020 2020 2020  h_slice)..      
-00014440: 2020 2020 2020 4966 203c 736c 3e2c 203c        If <sl>, <
-00014450: 6964 783e 2c20 616e 6420 3c70 6f73 3e20  idx>, and <pos> 
-00014460: 6172 6520 616c 6c20 4e6f 6e65 2c20 7468  are all None, th
-00014470: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
-00014480: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
-00014490: 2020 2052 4f49 2077 696c 6c20 6265 2075     ROI will be u
-000144a0: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
-000144b0: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
-000144c0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000144d0: 2020 536c 6963 6520 696e 6465 7820 6172    Slice index ar
-000144e0: 7261 7920 6f6e 2077 6869 6368 2074 6f20  ray on which to 
-000144f0: 636f 6d70 7574 6520 6d65 7472 6963 732e  compute metrics.
-00014500: 204f 6e6c 7920 7265 6c65 7661 6e74 2066   Only relevant f
-00014510: 6f72 200a 2020 2020 2020 2020 2020 2020  or .            
-00014520: 7369 6e67 6c65 2d73 6c69 6365 206d 6574  single-slice met
-00014530: 7269 6373 2028 6172 6561 2c20 6365 6e74  rics (area, cent
-00014540: 726f 6964 5f73 6c69 6365 2c20 6c65 6e67  roid_slice, leng
-00014550: 7468 5f73 6c69 6365 292e 0a20 2020 2020  th_slice)..     
-00014560: 2020 2020 2020 2055 7365 6420 6966 203c         Used if <
-00014570: 736c 3e20 6973 204e 6f6e 652e 0a0a 2020  sl> is None...  
-00014580: 2020 2020 2020 706f 7320 3a20 666c 6f61        pos : floa
-00014590: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-000145a0: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
-000145b0: 6520 706f 7369 7469 6f6e 2069 6e20 6d6d  e position in mm
-000145c0: 206f 6e20 7768 6963 6820 746f 2063 6f6d   on which to com
-000145d0: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
-000145e0: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
-000145f0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00014600: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
-00014610: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
-00014620: 645f 736c 6963 652c 206c 656e 6774 685f  d_slice, length_
-00014630: 736c 6963 6529 2e0a 2020 2020 2020 2020  slice)..        
-00014640: 2020 2020 5573 6564 2069 6620 3c73 6c3e      Used if <sl>
-00014650: 2061 6e64 203c 6964 783e 2061 7265 2062   and <idx> are b
-00014660: 6f74 6820 4e6f 6e65 2e0a 0a20 2020 2020  oth None...     
-00014670: 2020 206d 6574 686f 6420 3a20 7374 722c     method : str,
-00014680: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00014690: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
-000146a0: 2074 6f20 7573 6520 666f 7220 6d65 7472   to use for metr
-000146b0: 6963 2063 616c 6375 6c61 7469 6f6e 2e20  ic calculation. 
-000146c0: 4361 6e20 6265 2065 6974 6865 7220 2263  Can be either "c
-000146d0: 6f6e 746f 7572 2220 0a20 2020 2020 2020  ontour" .       
-000146e0: 2020 2020 2028 7573 6520 7368 6170 656c       (use shapel
-000146f0: 7920 706f 6c79 676f 6e73 2920 6f72 2022  y polygons) or "
-00014700: 6d61 736b 2220 2875 7365 2062 696e 6172  mask" (use binar
-00014710: 7920 6d61 736b 292e 2049 6620 4e6f 6e65  y mask). If None
-00014720: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
-00014730: 6520 7661 6c75 6520 7365 7420 696e 2073  e value set in s
-00014740: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-00014750: 5f6d 6574 686f 6420 7769 6c6c 2062 6520  _method will be 
-00014760: 7573 6564 2e0a 0a20 2020 2020 2020 2075  used...        u
-00014770: 6e69 7473 5f69 6e5f 6865 6164 6572 203a  nits_in_header :
-00014780: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-00014790: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-000147a0: 2049 6620 5472 7565 2c20 756e 6974 7320   If True, units 
-000147b0: 7769 6c6c 2062 6520 696e 636c 7564 6564  will be included
-000147c0: 2069 6e20 636f 6c75 6d6e 2068 6561 6465   in column heade
-000147d0: 7273 2e0a 0a20 2020 2020 2020 2067 6c6f  rs...        glo
-000147e0: 6261 6c5f 7673 5f73 6c69 6365 5f68 6561  bal_vs_slice_hea
-000147f0: 6465 7220 3a20 626f 6f6c 2c20 6465 6661  der : bool, defa
-00014800: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-00014810: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-00014820: 6865 2072 6574 7572 6e65 6420 4461 7461  he returned Data
-00014830: 4672 616d 6520 7769 6c6c 2068 6176 6520  Frame will have 
-00014840: 616e 2065 7874 7261 2073 6574 206f 6620  an extra set of 
-00014850: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
-00014860: 2020 2020 7370 6c69 7474 696e 6720 7468      splitting th
-00014870: 6520 7461 626c 6520 696e 746f 2022 676c  e table into "gl
-00014880: 6f62 616c 2220 616e 6420 2273 6c69 6365  obal" and "slice
-00014890: 2220 6d65 7472 6963 732e 0a0a 2020 2020  " metrics...    
-000148a0: 2020 2020 6e61 6d65 5f61 735f 696e 6465      name_as_inde
-000148b0: 7820 3a20 626f 6f6c 2c20 6465 6661 756c  x : bool, defaul
-000148c0: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
-000148d0: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-000148e0: 696e 6465 7820 636f 6c75 6d6e 206f 6620  index column of 
-000148f0: 7468 6520 7061 6e64 6173 2044 6174 6146  the pandas DataF
-00014900: 7261 6d65 2077 696c 6c20 0a20 2020 2020  rame will .     
-00014910: 2020 2020 2020 2063 6f6e 7461 696e 2074         contain t
-00014920: 6865 2052 4f49 2773 206e 616d 653b 206f  he ROI's name; o
-00014930: 7468 6572 7769 7365 2c20 7468 6520 6e61  therwise, the na
-00014940: 6d65 2077 696c 6c20 6170 7065 6172 2069  me will appear i
-00014950: 6e20 6120 636f 6c75 6d6e 0a20 2020 2020  n a column.     
-00014960: 2020 2020 2020 206e 616d 6564 2022 524f         named "RO
-00014970: 4922 2e0a 0a20 2020 2020 2020 206e 6963  I"...        nic
-00014980: 655f 636f 6c75 6d6e 7320 3a20 626f 6f6c  e_columns : bool
-00014990: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-000149a0: 2020 2020 2020 2020 2020 2020 4966 2046              If F
-000149b0: 616c 7365 2c20 636f 6c75 6d6e 206e 616d  alse, column nam
-000149c0: 6573 2077 696c 6c20 6265 2074 6865 2073  es will be the s
-000149d0: 616d 6520 6173 2074 6865 2069 6e70 7574  ame as the input
-000149e0: 206d 6574 7269 6373 206e 616d 6573 3b0a   metrics names;.
-000149f0: 2020 2020 2020 2020 2020 2020 6966 2054              if T
-00014a00: 7275 652c 2074 6865 206e 616d 6573 2077  rue, the names w
-00014a10: 696c 6c20 6265 2063 6170 6974 616c 697a  ill be capitaliz
-00014a20: 6564 2061 6e64 2075 6e64 6572 7363 6f72  ed and underscor
-00014a30: 6573 2077 696c 6c20 6265 200a 2020 2020  es will be .    
-00014a40: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
-00014a50: 2077 6974 6820 7370 6163 6573 2e0a 0a20   with spaces... 
-00014a60: 2020 2020 2020 2064 6563 696d 616c 5f70         decimal_p
-00014a70: 6c61 6365 7320 3a20 696e 742c 2064 6566  laces : int, def
-00014a80: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00014a90: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-00014aa0: 6465 6369 6d61 6c20 706c 6163 6573 2074  decimal places t
-00014ab0: 6f20 6b65 6570 2066 6f72 2065 6163 6820  o keep for each 
-00014ac0: 6d65 7472 6963 2e20 4966 204e 6f6e 652c  metric. If None,
-00014ad0: 2066 756c 6c0a 2020 2020 2020 2020 2020   full.          
-00014ae0: 2020 7072 6563 6973 696f 6e20 7769 6c6c    precision will
-00014af0: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
-00014b00: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
-00014b10: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
-00014b20: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
-00014b30: 7365 2c20 676c 6f62 616c 206d 6574 7269  se, global metri
-00014b40: 6373 2028 766f 6c75 6d65 2c20 3344 2063  cs (volume, 3D c
-00014b50: 656e 7472 6f69 642c 2033 4420 6c65 6e67  entroid, 3D leng
-00014b60: 7468 7329 2077 696c 6c0a 2020 2020 2020  ths) will.      
-00014b70: 2020 2020 2020 6f6e 6c79 2062 6520 6361        only be ca
-00014b80: 6c63 756c 6174 6564 2069 6620 7468 6579  lculated if they
-00014b90: 2068 6176 6520 6e6f 7420 6265 656e 2063   have not been c
-00014ba0: 616c 6375 6c61 7465 6420 6265 666f 7265  alculated before
-00014bb0: 3b0a 2020 2020 2020 2020 2020 2020 6966  ;.            if
-00014bc0: 2054 7275 652c 2061 6c6c 206d 6574 7269   True, all metri
-00014bd0: 6373 2077 696c 6c20 6265 2072 6563 616c  cs will be recal
-00014be0: 6375 6c61 7465 642e 0a20 2020 2020 2020  culated..       
-00014bf0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
-00014c00: 4966 206e 6f20 696e 6465 7820 6769 7665  If no index give
-00014c10: 6e2c 2075 7365 2063 656e 7472 616c 2073  n, use central s
-00014c20: 6c69 6365 0a20 2020 2020 2020 2069 6620  lice.        if 
-00014c30: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
-00014c40: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
-00014c50: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
-00014c60: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
-00014c70: 6c66 2e67 6574 5f6d 6964 5f69 6478 2876  lf.get_mid_idx(v
-00014c80: 6965 7729 0a0a 2020 2020 2020 2020 2320  iew)..        # 
-00014c90: 4465 6661 756c 7420 6d65 7472 6963 730a  Default metrics.
-00014ca0: 2020 2020 2020 2020 6966 206d 6574 7269          if metri
-00014cb0: 6373 2069 7320 4e6f 6e65 3a0a 2020 2020  cs is None:.    
-00014cc0: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
-00014cd0: 3d20 5b22 766f 6c75 6d65 222c 2022 6365  = ["volume", "ce
-00014ce0: 6e74 726f 6964 225d 0a0a 2020 2020 2020  ntroid"]..      
-00014cf0: 2020 2320 436f 6d70 7574 6520 6d65 7472    # Compute metr
-00014d00: 6963 730a 2020 2020 2020 2020 6765 6f6d  ics.        geom
-00014d10: 203d 207b 7d0a 2020 2020 2020 2020 736c   = {}.        sl
-00014d20: 6963 655f 6b77 6172 6773 203d 207b 0a20  ice_kwargs = {. 
-00014d30: 2020 2020 2020 2020 2020 2022 7669 6577             "view
-00014d40: 223a 2076 6965 772c 0a20 2020 2020 2020  ": view,.       
-00014d50: 2020 2020 2022 736c 223a 2073 6c2c 0a20       "sl": sl,. 
-00014d60: 2020 2020 2020 2020 2020 2022 6964 7822             "idx"
-00014d70: 3a20 6964 782c 0a20 2020 2020 2020 2020  : idx,.         
-00014d80: 2020 2022 706f 7322 3a20 706f 730a 2020     "pos": pos.  
-00014d90: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00014da0: 666f 7220 6d20 696e 206d 6574 7269 6373  for m in metrics
-00014db0: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00014dc0: 2033 4420 766f 6c75 6d65 0a20 2020 2020   3D volume.     
-00014dd0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
-00014de0: 766f 6c75 6d65 223a 0a20 2020 2020 2020  volume":.       
-00014df0: 2020 2020 2020 2020 2067 656f 6d5b 6d5d           geom[m]
-00014e00: 203d 2073 656c 662e 6765 745f 766f 6c75   = self.get_volu
-00014e10: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-00014e20: 2020 2020 2020 2020 756e 6974 733d 766f          units=vo
-00014e30: 6c5f 756e 6974 732c 200a 2020 2020 2020  l_units, .      
-00014e40: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00014e50: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
-00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e70: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
-00014e80: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00014e90: 2020 2020 2020 2020 2020 2020 2320 4172              # Ar
-00014ea0: 6561 206f 6e20 6120 736c 6963 650a 2020  ea on a slice.  
-00014eb0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00014ec0: 203d 3d20 2261 7265 6122 3a0a 2020 2020   == "area":.    
-00014ed0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-00014ee0: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f61  [m] = self.get_a
-00014ef0: 7265 6128 0a20 2020 2020 2020 2020 2020  rea(.           
-00014f00: 2020 2020 2020 2020 2075 6e69 7473 3d61           units=a
-00014f10: 7265 615f 756e 6974 732c 200a 2020 2020  rea_units, .    
-00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f30: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+0000d130: 2020 2020 2020 2020 5d29 290a 2020 2020          ])).    
+0000d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d150: 2020 2020 6172 6561 732e 6170 7065 6e64      areas.append
+0000d160: 2870 2e61 7265 6129 0a0a 2020 2020 2020  (p.area)..      
+0000d170: 2020 2020 2020 2320 4765 7420 7765 6967        # Get weig
+0000d180: 6874 6564 2061 7665 7261 6765 206f 6620  hted average of 
+0000d190: 706f 6c79 676f 6e20 6365 6e74 726f 6964  polygon centroid
+0000d1a0: 730a 2020 2020 2020 2020 2020 2020 7765  s.            we
+0000d1b0: 6967 6874 6564 5f73 756d 203d 206e 702e  ighted_sum = np.
+0000d1c0: 7375 6d28 0a20 2020 2020 2020 2020 2020  sum(.           
+0000d1d0: 2020 2020 205b 6365 6e74 726f 6964 735b       [centroids[
+0000d1e0: 695d 202a 2061 7265 6173 5b69 5d20 666f  i] * areas[i] fo
+0000d1f0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0000d200: 2863 656e 7472 6f69 6473 2929 5d2c 0a20  (centroids))],. 
+0000d210: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000d220: 7869 733d 300a 2020 2020 2020 2020 2020  xis=0.          
+0000d230: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000d240: 6365 6e74 726f 6964 5b22 6d6d 225d 203d  centroid["mm"] =
+0000d250: 2077 6569 6768 7465 645f 7375 6d20 2f20   weighted_sum / 
+0000d260: 7375 6d28 6172 6561 7329 0a0a 2020 2020  sum(areas)..    
+0000d270: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+0000d280: 6174 6520 696e 2076 6f78 656c 7320 616e  ate in voxels an
+0000d290: 6420 736c 6963 6573 2069 6620 706f 7373  d slices if poss
+0000d2a0: 6962 6c65 0a20 2020 2020 2020 2020 2020  ible.           
+0000d2b0: 2069 6620 7365 6c66 2e76 6f78 656c 5f73   if self.voxel_s
+0000d2c0: 697a 6520 6973 204e 6f6e 6520 616e 6420  ize is None and 
+0000d2d0: 7365 6c66 2e73 6861 7065 2069 7320 4e6f  self.shape is No
+0000d2e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000d2f0: 2020 2020 6966 2075 6e69 7473 2069 6e20      if units in 
+0000d300: 5b22 766f 7865 6c73 222c 2022 736c 6963  ["voxels", "slic
+0000d310: 6522 5d20 2061 6e64 2073 656c 662e 7368  e"]  and self.sh
+0000d320: 6170 6520 6973 204e 6f6e 653a 0a20 2020  ape is None:.   
+0000d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d340: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+0000d350: 726f 7228 2243 616e 6e6f 7420 636f 6d70  ror("Cannot comp
+0000d360: 7574 6520 6365 6e74 726f 6964 2069 6e20  ute centroid in 
+0000d370: 766f 7865 6c73 2f73 6c69 6365 220a 2020  voxels/slice".  
+0000d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3a0: 2020 2020 2022 206e 756d 6265 7273 2066       " numbers f
+0000d3b0: 726f 6d20 636f 6e74 6f75 7273 2077 6974  rom contours wit
+0000d3c0: 686f 7574 206b 6e6f 7769 6e67 2076 6f78  hout knowing vox
+0000d3d0: 656c 220a 2020 2020 2020 2020 2020 2020  el".            
+0000d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3f0: 2020 2020 2020 2020 2020 2022 2073 697a             " siz
+0000d400: 6573 2061 6e64 206d 6173 6b20 7368 6170  es and mask shap
+0000d410: 6521 2229 0a20 2020 2020 2020 2020 2020  e!").           
+0000d420: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000d430: 2020 2020 2020 2076 6965 775f 6178 6573         view_axes
+0000d440: 203d 2028 5b30 2c20 312c 2032 5d20 6966   = ([0, 1, 2] if
+0000d450: 206c 656e 2863 656e 7472 6f69 645b 276d   len(centroid['m
+0000d460: 6d27 5d29 203d 3d20 3320 656c 7365 0a20  m']) == 3 else. 
+0000d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d480: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
+0000d490: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
+0000d4a0: 775d 290a 0a20 2020 2020 2020 2020 2020  w])..           
+0000d4b0: 2020 2020 2063 656e 7472 6f69 645b 2276       centroid["v
+0000d4c0: 6f78 656c 7322 5d20 3d20 6e70 2e61 7272  oxels"] = np.arr
+0000d4d0: 6179 285b 0a20 2020 2020 2020 2020 2020  ay([.           
+0000d4e0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
+0000d4f0: 735f 746f 5f69 6478 2863 2c20 6178 3d69  s_to_idx(c, ax=i
+0000d500: 2c20 7265 7475 726e 5f69 6e74 3d46 616c  , return_int=Fal
+0000d510: 7365 2920 0a20 2020 2020 2020 2020 2020  se) .           
+0000d520: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+0000d530: 6320 696e 207a 6970 2876 6965 775f 6178  c in zip(view_ax
+0000d540: 6573 2c20 6365 6e74 726f 6964 5b22 6d6d  es, centroid["mm
+0000d550: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+0000d560: 2020 2020 5d29 0a0a 2020 2020 2020 2020      ])..        
+0000d570: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0000d580: 5b22 736c 6963 6522 5d20 3d20 6e70 2e61  ["slice"] = np.a
+0000d590: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
+0000d5a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d5b0: 706f 735f 746f 5f73 6c69 6365 2863 2c20  pos_to_slice(c, 
+0000d5c0: 6178 3d69 2c20 7265 7475 726e 5f69 6e74  ax=i, return_int
+0000d5d0: 3d46 616c 7365 2920 0a20 2020 2020 2020  =False) .       
+0000d5e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000d5f0: 2069 2c20 6320 696e 207a 6970 2876 6965   i, c in zip(vie
+0000d600: 775f 6178 6573 2c20 6365 6e74 726f 6964  w_axes, centroid
+0000d610: 5b22 6d6d 225d 290a 2020 2020 2020 2020  ["mm"]).        
+0000d620: 2020 2020 2020 2020 5d29 0a0a 2020 2020          ])..    
+0000d630: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
+0000d640: 2063 616c 6375 6c61 7465 2063 656e 7472   calculate centr
+0000d650: 6f69 6420 6672 6f6d 2062 696e 6172 7920  oid from binary 
+0000d660: 6d61 736b 0a20 2020 2020 2020 2065 6c73  mask.        els
+0000d670: 653a 200a 0a20 2020 2020 2020 2020 2020  e: ..           
+0000d680: 2023 2047 6574 2032 4420 6f72 2033 4420   # Get 2D or 3D 
+0000d690: 6461 7461 2066 726f 6d20 7768 6963 6820  data from which 
+0000d6a0: 746f 2063 616c 6375 6c61 7465 2063 656e  to calculate cen
+0000d6b0: 7472 6f69 640a 2020 2020 2020 2020 2020  troid.          
+0000d6c0: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
+0000d6d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000d6e0: 2020 2069 6620 6e6f 7420 7365 6c66 2e6f     if not self.o
+0000d6f0: 6e5f 736c 6963 6528 7669 6577 2c20 736c  n_slice(view, sl
+0000d700: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
+0000d710: 733d 706f 7329 3a0a 2020 2020 2020 2020  s=pos):.        
+0000d720: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d730: 726e 206e 702e 6172 7261 7928 5b4e 6f6e  rn np.array([Non
+0000d740: 652c 204e 6f6e 655d 290a 2020 2020 2020  e, None]).      
+0000d750: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0000d760: 2073 656c 662e 6765 745f 736c 6963 6528   self.get_slice(
+0000d770: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
+0000d780: 3d69 6478 2c20 706f 733d 706f 7329 0a20  =idx, pos=pos). 
+0000d790: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000d7a0: 7865 7320 3d20 736b 7274 2e69 6d61 6765  xes = skrt.image
+0000d7b0: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+0000d7c0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+0000d7d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d7e0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+0000d7f0: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
+0000d800: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
+0000d810: 6c66 2e67 6574 5f6d 6173 6b28 7374 616e  lf.get_mask(stan
+0000d820: 6461 7264 6973 653d 5472 7565 290a 2020  dardise=True).  
+0000d830: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0000d840: 6573 203d 2073 6b72 742e 696d 6167 652e  es = skrt.image.
+0000d850: 5f61 7865 730a 0a20 2020 2020 2020 2020  _axes..         
+0000d860: 2020 2023 2043 6f6d 7075 7465 2063 656e     # Compute cen
+0000d870: 7472 6f69 6420 6672 6f6d 2032 4420 6f72  troid from 2D or
+0000d880: 2033 4420 6269 6e61 7279 206d 6173 6b0a   3D binary mask.
+0000d890: 2020 2020 2020 2020 2020 2020 6e6f 6e5f              non_
+0000d8a0: 7a65 726f 203d 206e 702e 6172 6777 6865  zero = np.argwhe
+0000d8b0: 7265 2864 6174 6129 0a20 2020 2020 2020  re(data).       
+0000d8c0: 2020 2020 2069 6620 6e6f 7420 6c65 6e28       if not len(
+0000d8d0: 6e6f 6e5f 7a65 726f 293a 0a20 2020 2020  non_zero):.     
+0000d8e0: 2020 2020 2020 2020 2020 2069 6620 6461             if da
+0000d8f0: 7461 2e6e 6469 6d20 3d3d 2032 3a0a 2020  ta.ndim == 2:.  
+0000d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d910: 2020 7265 7475 726e 204e 6f6e 652c 204e    return None, N
+0000d920: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0000d930: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000d940: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000d950: 7475 726e 204e 6f6e 652c 204e 6f6e 652c  turn None, None,
+0000d960: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000d970: 2020 6365 6e74 726f 6964 5f72 6f77 636f    centroid_rowco
+0000d980: 6c20 3d20 6c69 7374 286e 6f6e 5f7a 6572  l = list(non_zer
+0000d990: 6f2e 6d65 616e 2830 2929 0a20 2020 2020  o.mean(0)).     
+0000d9a0: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
+0000d9b0: 766f 7865 6c73 203d 205b 6365 6e74 726f  voxels = [centro
+0000d9c0: 6964 5f72 6f77 636f 6c5b 315d 2c20 6365  id_rowcol[1], ce
+0000d9d0: 6e74 726f 6964 5f72 6f77 636f 6c5b 305d  ntroid_rowcol[0]
+0000d9e0: 5d20 5c0a 2020 2020 2020 2020 2020 2020  ] \.            
+0000d9f0: 2020 2020 2020 2020 2b20 6365 6e74 726f          + centro
+0000da00: 6964 5f72 6f77 636f 6c5b 323a 5d0a 2020  id_rowcol[2:].  
+0000da10: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+0000da20: 6964 5b22 766f 7865 6c73 225d 203d 206e  id["voxels"] = n
+0000da30: 702e 6172 7261 7928 6365 6e74 726f 6964  p.array(centroid
+0000da40: 5f76 6f78 656c 7329 0a0a 2020 2020 2020  _voxels)..      
+0000da50: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+0000da60: 746f 206d 6d20 616e 6420 736c 6963 6573  to mm and slices
+0000da70: 0a20 2020 2020 2020 2020 2020 2076 6965  .            vie
+0000da80: 775f 6178 6573 203d 2028 5b30 2c20 312c  w_axes = ([0, 1,
+0000da90: 2032 5d20 6966 206c 656e 2863 656e 7472   2] if len(centr
+0000daa0: 6f69 645b 2776 6f78 656c 7327 5d29 203d  oid['voxels']) =
+0000dab0: 3d20 3320 656c 7365 0a20 2020 2020 2020  = 3 else.       
+0000dac0: 2020 2020 2020 2020 2020 2020 2073 6b72               skr
+0000dad0: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
+0000dae0: 6573 5b76 6965 775d 290a 0a20 2020 2020  es[view])..     
+0000daf0: 2020 2020 2020 2063 656e 7472 6f69 645b         centroid[
+0000db00: 226d 6d22 5d20 3d20 6e70 2e61 7272 6179  "mm"] = np.array
+0000db10: 285b 0a20 2020 2020 2020 2020 2020 2020  ([.             
+0000db20: 2020 2073 656c 662e 6964 785f 746f 5f70     self.idx_to_p
+0000db30: 6f73 2863 2c20 6178 3d69 290a 2020 2020  os(c, ax=i).    
+0000db40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000db50: 692c 2063 2069 6e20 7a69 7028 7669 6577  i, c in zip(view
+0000db60: 5f61 7865 732c 2063 656e 7472 6f69 645b  _axes, centroid[
+0000db70: 2276 6f78 656c 7322 5d29 0a20 2020 2020  "voxels"]).     
+0000db80: 2020 2020 2020 205d 290a 0a20 2020 2020         ])..     
+0000db90: 2020 2020 2020 2063 656e 7472 6f69 645b         centroid[
+0000dba0: 2273 6c69 6365 225d 203d 206e 702e 6172  "slice"] = np.ar
+0000dbb0: 7261 7928 5b0a 2020 2020 2020 2020 2020  ray([.          
+0000dbc0: 2020 2020 2020 7365 6c66 2e69 6478 5f74        self.idx_t
+0000dbd0: 6f5f 736c 6963 6528 632c 2061 783d 6929  o_slice(c, ax=i)
+0000dbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dbf0: 2066 6f72 2069 2c20 6320 696e 207a 6970   for i, c in zip
+0000dc00: 2876 6965 775f 6178 6573 2c20 6365 6e74  (view_axes, cent
+0000dc10: 726f 6964 5b22 766f 7865 6c73 225d 290a  roid["voxels"]).
+0000dc20: 2020 2020 2020 2020 2020 2020 5d29 0a0a              ])..
+0000dc30: 2020 2020 2020 2020 2320 4361 6368 6520          # Cache 
+0000dc40: 676c 6f62 616c 2063 656e 7472 6f69 640a  global centroid.
+0000dc50: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000dc60: 696e 676c 655f 736c 6963 653a 0a20 2020  ingle_slice:.   
+0000dc70: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+0000dc80: 656e 7472 6f69 6420 3d20 6365 6e74 726f  entroid = centro
+0000dc90: 6964 0a0a 2020 2020 2020 2020 2320 5265  id..        # Re
+0000dca0: 7475 726e 2063 656e 7472 6f69 6420 696e  turn centroid in
+0000dcb0: 2072 6571 7565 7374 6564 2075 6e69 7473   requested units
+0000dcc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000dcd0: 6365 6e74 726f 6964 5b75 6e69 7473 5d0a  centroid[units].
+0000dce0: 0a20 2020 2064 6566 2073 6574 5f73 6c69  .    def set_sli
+0000dcf0: 6365 5f74 6869 636b 6e65 7373 5f63 6f6e  ce_thickness_con
+0000dd00: 746f 7572 7328 7365 6c66 2c20 647a 293a  tours(self, dz):
+0000dd10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000dd20: 2020 2020 2053 6574 206e 6f6d 696e 616c       Set nominal
+0000dd30: 207a 2073 7061 6369 6e67 206f 6620 636f   z spacing of co
+0000dd40: 6e74 6f75 7273 2e0a 0a20 2020 2020 2020  ntours...       
+0000dd50: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
+0000dd60: 6675 6c20 696e 2070 6172 7469 6375 6c61  ful in particula
+0000dd70: 7220 666f 7220 2073 696e 676c 652d 736c  r for  single-sl
+0000dd80: 6963 6520 524f 4973 2e0a 2020 2020 2020  ice ROIs..      
+0000dd90: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
+0000dda0: 656c 662e 736c 6963 655f 7468 6963 6b6e  elf.slice_thickn
+0000ddb0: 6573 735f 636f 6e74 6f75 7273 203d 2064  ess_contours = d
+0000ddc0: 7a0a 0a20 2020 2064 6566 2067 6574 5f73  z..    def get_s
+0000ddd0: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
+0000dde0: 6f6e 746f 7572 7328 7365 6c66 293a 0a20  ontours(self):. 
+0000ddf0: 2020 2020 2020 2022 2222 4765 7420 7a20         """Get z 
+0000de00: 766f 7865 6c20 7369 7a65 2075 7369 6e67  voxel size using
+0000de10: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
+0000de20: 6e74 6f75 7273 2e22 2222 0a0a 2020 2020  ntours."""..    
+0000de30: 2020 2020 636f 6e74 6f75 7273 203d 2073      contours = s
+0000de40: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
+0000de50: 2822 782d 7922 290a 2020 2020 2020 2020  ("x-y").        
+0000de60: 7a5f 6b65 7973 203d 2073 6f72 7465 6428  z_keys = sorted(
+0000de70: 636f 6e74 6f75 7273 2e6b 6579 7328 2929  contours.keys())
+0000de80: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0000de90: 7a5f 6b65 7973 2920 3c20 323a 0a20 2020  z_keys) < 2:.   
+0000dea0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000deb0: 2e73 6f75 7263 655f 7479 7065 203d 3d20  .source_type == 
+0000dec0: 2263 6f6e 746f 7572 2220 616e 6420 7365  "contour" and se
+0000ded0: 6c66 2e73 6c69 6365 5f74 6869 636b 6e65  lf.slice_thickne
+0000dee0: 7373 5f63 6f6e 746f 7572 733a 0a20 2020  ss_contours:.   
+0000def0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000df00: 7572 6e20 7365 6c66 2e73 6c69 6365 5f74  urn self.slice_t
+0000df10: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+0000df20: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
+0000df30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000df40: 2020 2020 766f 7865 6c5f 7369 7a65 203d      voxel_size =
+0000df50: 2073 656c 662e 6765 745f 766f 7865 6c5f   self.get_voxel_
+0000df60: 7369 7a65 2829 0a20 2020 2020 2020 2020  size().         
+0000df70: 2020 2020 2020 2069 6620 766f 7865 6c5f         if voxel_
+0000df80: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+0000df90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000dfa0: 2020 2020 2020 7265 7475 726e 2076 6f78        return vox
+0000dfb0: 656c 5f73 697a 655b 325d 0a20 2020 2020  el_size[2].     
+0000dfc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000dfd0: 6e0a 2020 2020 2020 2020 6469 6666 7320  n.        diffs 
+0000dfe0: 3d20 5b7a 5f6b 6579 735b 695d 202d 207a  = [z_keys[i] - z
+0000dff0: 5f6b 6579 735b 6920 2d20 315d 2066 6f72  _keys[i - 1] for
+0000e000: 2069 2069 6e20 7261 6e67 6528 312c 206c   i in range(1, l
+0000e010: 656e 287a 5f6b 6579 7329 295d 0a20 2020  en(z_keys))].   
+0000e020: 2020 2020 2072 6574 7572 6e20 6d69 6e28       return min(
+0000e030: 6469 6666 7329 0a0a 2020 2020 6465 6620  diffs)..    def 
+0000e040: 6765 745f 6e7a 5f63 6f6e 746f 7572 7328  get_nz_contours(
+0000e050: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000e060: 2222 4765 7420 6e75 6d62 6572 206f 6620  ""Get number of 
+0000e070: 766f 7865 6c73 2069 6e20 7468 6520 7a20  voxels in the z 
+0000e080: 6469 7265 6374 696f 6e20 7573 696e 6720  direction using 
+0000e090: 706f 7369 7469 6f6e 7320 6f66 2063 6f6e  positions of con
+0000e0a0: 746f 7572 732e 2222 220a 0a20 2020 2020  tours."""..     
+0000e0b0: 2020 2076 7a20 3d20 7365 6c66 2e67 6574     vz = self.get
+0000e0c0: 5f73 6c69 6365 5f74 6869 636b 6e65 7373  _slice_thickness
+0000e0d0: 5f63 6f6e 746f 7572 7328 290a 2020 2020  _contours().    
+0000e0e0: 2020 2020 7a5f 6b65 7973 203d 206c 6973      z_keys = lis
+0000e0f0: 7428 7365 6c66 2e67 6574 5f63 6f6e 746f  t(self.get_conto
+0000e100: 7572 7328 2278 2d79 2229 2e6b 6579 7328  urs("x-y").keys(
+0000e110: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+0000e120: 6e20 696e 7428 286d 6178 287a 5f6b 6579  n int((max(z_key
+0000e130: 7329 202d 206d 696e 287a 5f6b 6579 7329  s) - min(z_keys)
+0000e140: 2920 2f20 767a 2920 2b20 310a 0a20 2020  ) / vz) + 1..   
+0000e150: 2064 6566 2067 6574 5f63 656e 7472 6528   def get_centre(
+0000e160: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
+0000e170: 2020 2020 2020 2020 7669 6577 3d22 782d          view="x-
+0000e180: 7922 2c20 0a20 2020 2020 2020 2073 696e  y", .        sin
+0000e190: 676c 655f 736c 6963 653d 4661 6c73 652c  gle_slice=False,
+0000e1a0: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
+0000e1b0: 2c20 0a20 2020 2020 2020 2069 6478 3d4e  , .        idx=N
+0000e1c0: 6f6e 652c 200a 2020 2020 2020 2020 706f  one, .        po
+0000e1d0: 733d 4e6f 6e65 2c20 0a20 2020 2020 2020  s=None, .       
+0000e1e0: 206d 6574 686f 643d 4e6f 6e65 2c0a 2020   method=None,.  
+0000e1f0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000e200: 4765 7420 6365 6e74 7265 2070 6f73 6974  Get centre posit
+0000e210: 696f 6e20 696e 2032 4420 6f72 2033 4420  ion in 2D or 3D 
+0000e220: 696e 206d 6d2e 2222 220a 0a20 2020 2020  in mm."""..     
+0000e230: 2020 2023 2047 6574 2064 6566 6175 6c74     # Get default
+0000e240: 2073 6c69 6365 2069 6e64 6578 2061 6e64   slice index and
+0000e250: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
+0000e260: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+0000e270: 2020 2020 6966 2073 6c20 6973 204e 6f6e      if sl is Non
+0000e280: 6520 616e 6420 6964 7820 6973 204e 6f6e  e and idx is Non
+0000e290: 6520 616e 6420 706f 7320 6973 204e 6f6e  e and pos is Non
+0000e2a0: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+0000e2b0: 6964 7820 3d20 7365 6c66 2e67 6574 5f6d  idx = self.get_m
+0000e2c0: 6964 5f69 6478 2876 6965 7729 0a20 2020  id_idx(view).   
+0000e2d0: 2020 2020 2069 6620 6d65 7468 6f64 2069       if method i
+0000e2e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0000e2f0: 2020 2020 6d65 7468 6f64 203d 2073 656c      method = sel
+0000e300: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
+0000e310: 6574 686f 640a 0a20 2020 2020 2020 2023  ethod..        #
+0000e320: 2047 6574 206c 6973 7420 6f66 2061 7865   Get list of axe
+0000e330: 7320 746f 2063 6f6e 7369 6465 720a 2020  s to consider.  
+0000e340: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
+0000e350: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
+0000e360: 2020 2061 7865 7320 3d20 736b 7274 2e69     axes = skrt.i
+0000e370: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
+0000e380: 7669 6577 5d0a 2020 2020 2020 2020 656c  view].        el
+0000e390: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000e3a0: 6178 6573 203d 2073 6b72 742e 696d 6167  axes = skrt.imag
+0000e3b0: 652e 5f61 7865 730a 0a20 2020 2020 2020  e._axes..       
+0000e3c0: 2023 2047 6574 2063 656e 7472 6520 696e   # Get centre in
+0000e3d0: 206d 6d0a 2020 2020 2020 2020 6365 6e74   mm.        cent
+0000e3e0: 7265 203d 205b 5d0a 2020 2020 2020 2020  re = [].        
+0000e3f0: 666f 7220 6178 2069 6e20 6178 6573 3a0a  for ax in axes:.
+0000e400: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0000e410: 6e74 203d 2073 656c 662e 6765 745f 6578  nt = self.get_ex
+0000e420: 7465 6e74 280a 2020 2020 2020 2020 2020  tent(.          
+0000e430: 2020 2020 2020 6178 3d61 782c 0a20 2020        ax=ax,.   
+0000e440: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+0000e450: 676c 655f 736c 6963 653d 7369 6e67 6c65  gle_slice=single
+0000e460: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+0000e470: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
+0000e480: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
+0000e490: 2020 2073 6c3d 736c 2c0a 2020 2020 2020     sl=sl,.      
+0000e4a0: 2020 2020 2020 2020 2020 6964 783d 6964            idx=id
+0000e4b0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+0000e4c0: 2020 2070 6f73 3d70 6f73 2c0a 2020 2020     pos=pos,.    
+0000e4d0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0000e4e0: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
+0000e4f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000e500: 2020 2020 2069 6620 4e6f 6e65 2069 6e20       if None in 
+0000e510: 6578 7465 6e74 3a0a 2020 2020 2020 2020  extent:.        
+0000e520: 2020 2020 2020 2020 6365 6e74 7265 2e61          centre.a
+0000e530: 7070 656e 6428 4e6f 6e65 290a 2020 2020  ppend(None).    
+0000e540: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000e550: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+0000e560: 6e74 7265 2e61 7070 656e 6428 6e70 2e6d  ntre.append(np.m
+0000e570: 6561 6e28 6578 7465 6e74 2929 0a0a 2020  ean(extent))..  
+0000e580: 2020 2020 2020 7265 7475 726e 206e 702e        return np.
+0000e590: 6172 7261 7928 6365 6e74 7265 290a 0a20  array(centre).. 
+0000e5a0: 2020 2064 6566 2067 6574 5f76 6f6c 756d     def get_volum
+0000e5b0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0000e5c0: 200a 2020 2020 2020 2020 756e 6974 733d   .        units=
+0000e5d0: 226d 6d22 2c20 0a20 2020 2020 2020 206d  "mm", .        m
+0000e5e0: 6574 686f 643d 4e6f 6e65 2c20 0a20 2020  ethod=None, .   
+0000e5f0: 2020 2020 2066 6f72 6365 3d54 7275 650a       force=True.
+0000e600: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0000e610: 2222 4765 7420 524f 4920 766f 6c75 6d65  ""Get ROI volume
+0000e620: 2e20 5468 6520 6361 6c63 756c 6174 6564  . The calculated
+0000e630: 2076 6f6c 756d 6520 7769 6c6c 2062 6520   volume will be 
+0000e640: 6361 6368 6564 2069 6e20 0a20 2020 2020  cached in .     
+0000e650: 2020 2073 656c 662e 5f76 6f6c 756d 655b     self._volume[
+0000e660: 756e 6974 735d 2061 6e64 2072 6574 7572  units] and retur
+0000e670: 6e65 6420 6966 2063 616c 6c65 6420 6167  ned if called ag
+0000e680: 6169 6e2c 2075 6e6c 6573 7320 666f 7263  ain, unless forc
+0000e690: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
+0000e6a0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0000e6b0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0000e6c0: 2020 756e 6974 7320 3a20 7374 722c 2064    units : str, d
+0000e6d0: 6566 6175 6c74 3d22 6d6d 220a 2020 2020  efault="mm".    
+0000e6e0: 2020 2020 2020 2020 556e 6974 7320 6f66          Units of
+0000e6f0: 2076 6f6c 756d 652e 2043 616e 2062 6520   volume. Can be 
+0000e700: 616e 7920 6f66 3a0a 2020 2020 2020 2020  any of:.        
+0000e710: 2020 2020 2020 2020 2d20 226d 6d22 3a20          - "mm": 
+0000e720: 7265 7475 726e 2076 6f6c 756d 6520 696e  return volume in
+0000e730: 206d 696c 6c69 6d65 7472 6573 2063 7562   millimetres cub
+0000e740: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+0000e750: 2020 2020 2d20 226d 6c22 3a20 7265 7475      - "ml": retu
+0000e760: 726e 2076 6f6c 756d 6520 696e 206d 696c  rn volume in mil
+0000e770: 6c69 6c69 7472 6573 2e0a 2020 2020 2020  lilitres..      
+0000e780: 2020 2020 2020 2020 2020 2d20 2263 6322            - "cc"
+0000e790: 3a20 7265 7475 726e 2076 6f6c 756d 6520  : return volume 
+0000e7a0: 696e 2063 7562 6963 2063 656e 7469 6d65  in cubic centime
+0000e7b0: 7472 6573 2028 6571 7569 7661 6c65 6e74  tres (equivalent
+0000e7c0: 2074 6f20 226d 6c22 290a 2020 2020 2020   to "ml").      
+0000e7d0: 2020 2020 2020 2020 2020 2d20 2276 6f78            - "vox
+0000e7e0: 656c 7322 3a20 7265 7475 726e 2076 6f6c  els": return vol
+0000e7f0: 756d 6520 696e 206e 756d 6265 7220 6f66  ume in number of
+0000e800: 2076 6f78 656c 732e 0a0a 2020 2020 2020   voxels...      
+0000e810: 2020 2020 2020 4966 2075 6e69 7473 3d22        If units="
+0000e820: 766f 7865 6c73 2220 6973 2072 6571 7565  voxels" is reque
+0000e830: 7374 6564 2062 7574 2074 6869 7320 524f  sted but this RO
+0000e840: 4920 6f6e 6c79 2068 6173 2063 6f6e 746f  I only has conto
+0000e850: 7572 7320 616e 6420 6e6f 0a20 2020 2020  urs and no.     
+0000e860: 2020 2020 2020 2076 6f78 656c 2073 697a         voxel siz
+0000e870: 6520 696e 666f 726d 6174 696f 6e2c 2061  e information, a
+0000e880: 6e20 6572 726f 7220 7769 6c6c 2062 6520  n error will be 
+0000e890: 7261 6973 6564 2e0a 0a20 2020 2020 2020  raised...       
+0000e8a0: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
+0000e8b0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0000e8c0: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
+0000e8d0: 6f20 7573 6520 666f 7220 766f 6c75 6d65  o use for volume
+0000e8e0: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
+0000e8f0: 6e20 6265 3a20 0a20 2020 2020 2020 2020  n be: .         
+0000e900: 2020 2020 2020 202d 2022 636f 6e74 6f75         - "contou
+0000e910: 7222 3a20 636f 6d70 7574 6520 766f 6c75  r": compute volu
+0000e920: 6d65 2062 7920 7375 6d6d 696e 6720 6172  me by summing ar
+0000e930: 6561 7320 6f66 2073 6861 7065 6c79 0a20  eas of shapely. 
+0000e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e950: 2070 6f6c 7967 6f6e 7320 6f6e 2065 6163   polygons on eac
+0000e960: 6820 736c 6963 6520 616e 6420 6d75 6c74  h slice and mult
+0000e970: 6970 6c79 696e 6720 6279 2073 6c69 6365  iplying by slice
+0000e980: 2074 6869 636b 6e65 7373 2e0a 2020 2020   thickness..    
+0000e990: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
+0000e9a0: 6173 6b22 3a20 636f 6d70 7574 6520 766f  ask": compute vo
+0000e9b0: 6c75 6d65 2062 7920 7375 6d6d 696e 6720  lume by summing 
+0000e9c0: 766f 7865 6c73 2069 6e73 6964 6520 7468  voxels inside th
+0000e9d0: 6520 524f 4920 616e 640a 2020 2020 2020  e ROI and.      
+0000e9e0: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
+0000e9f0: 6970 6c79 696e 6720 6279 2074 6865 2076  iplying by the v
+0000ea00: 6f6c 756d 6520 6f66 206f 6e65 2076 6f78  olume of one vox
+0000ea10: 656c 2e0a 2020 2020 2020 2020 2020 2020  el..            
+0000ea20: 2020 2020 2d20 4e6f 6e65 3a20 7573 6520      - None: use 
+0000ea30: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
+0000ea40: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
+0000ea50: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
+0000ea60: 2020 2020 2020 2020 204e 6f74 6520 7468           Note th
+0000ea70: 6174 2069 6620 7365 6c66 2e67 6574 5f76  at if self.get_v
+0000ea80: 6f6c 756d 6520 6861 7320 616c 7265 6164  olume has alread
+0000ea90: 7920 6265 656e 2063 616c 6c65 6420 7769  y been called wi
+0000eaa0: 7468 206f 6e65 200a 2020 2020 2020 2020  th one .        
+0000eab0: 2020 2020 6d65 7468 6f64 2c20 7468 6520      method, the 
+0000eac0: 7361 6d65 2063 6163 6865 6420 7265 7375  same cached resu
+0000ead0: 6c74 2077 696c 6c20 6265 2072 6574 7572  lt will be retur
+0000eae0: 6e65 6420 6966 2063 616c 6c69 6e67 2077  ned if calling w
+0000eaf0: 6974 6820 6120 0a20 2020 2020 2020 2020  ith a .         
+0000eb00: 2020 2064 6966 6665 7265 6e74 206d 6574     different met
+0000eb10: 686f 6420 756e 6c65 7373 2066 6f72 6365  hod unless force
+0000eb20: 3d54 7275 652e 0a0a 2020 2020 2020 2020  =True...        
+0000eb30: 666f 7263 6520 3a20 626f 6f6c 2c20 6465  force : bool, de
+0000eb40: 6661 756c 743d 5472 7565 0a20 2020 2020  fault=True.     
+0000eb50: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+0000eb60: 7468 6520 766f 6c75 6d65 2077 696c 6c20  the volume will 
+0000eb70: 616c 7761 7973 2062 6520 7265 6361 6c63  always be recalc
+0000eb80: 756c 6174 6564 3b20 6f74 6865 7277 6973  ulated; otherwis
+0000eb90: 652c 2069 7420 7769 6c6c 0a20 2020 2020  e, it will.     
+0000eba0: 2020 2020 2020 206f 6e6c 7920 6265 2063         only be c
+0000ebb0: 616c 6375 6c61 7465 6420 6966 2069 7420  alculated if it 
+0000ebc0: 6861 7320 6e6f 7420 7965 7420 6265 656e  has not yet been
+0000ebd0: 2063 6163 6865 6420 696e 2073 656c 662e   cached in self.
+0000ebe0: 5f76 6f6c 756d 652e 0a20 2020 2020 2020  _volume..       
+0000ebf0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+0000ec00: 4966 2061 6c72 6561 6479 2063 6163 6865  If already cache
+0000ec10: 6420 616e 6420 6e6f 7420 666f 7263 696e  d and not forcin
+0000ec20: 672c 2072 6574 7572 6e0a 2020 2020 2020  g, return.      
+0000ec30: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
+0000ec40: 662c 2022 5f76 6f6c 756d 6522 2920 616e  f, "_volume") an
+0000ec50: 6420 6e6f 7420 666f 7263 653a 0a20 2020  d not force:.   
+0000ec60: 2020 2020 2020 2020 2069 6620 756e 6974           if unit
+0000ec70: 7320 696e 2073 656c 662e 5f76 6f6c 756d  s in self._volum
+0000ec80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000ec90: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000eca0: 766f 6c75 6d65 5b75 6e69 7473 5d0a 0a20  volume[units].. 
+0000ecb0: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+0000ecc0: 2829 0a20 2020 2020 2020 2069 6620 6d65  ().        if me
+0000ecd0: 7468 6f64 2069 7320 4e6f 6e65 3a0a 2020  thod is None:.  
+0000ece0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+0000ecf0: 203d 2073 656c 662e 6465 6661 756c 745f   = self.default_
+0000ed00: 6765 6f6d 5f6d 6574 686f 640a 0a20 2020  geom_method..   
+0000ed10: 2020 2020 2023 204d 616b 6520 6361 6368       # Make cach
+0000ed20: 6564 2070 726f 7065 7274 790a 2020 2020  ed property.    
+0000ed30: 2020 2020 7365 6c66 2e5f 766f 6c75 6d65      self._volume
+0000ed40: 203d 207b 7d0a 0a20 2020 2020 2020 2023   = {}..        #
+0000ed50: 2043 616c 6375 6c61 7465 2066 726f 6d20   Calculate from 
+0000ed60: 706f 6c79 676f 6e20 6172 6561 730a 2020  polygon areas.  
+0000ed70: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
+0000ed80: 3d3d 2022 636f 6e74 6f75 7222 3a0a 0a20  == "contour":.. 
+0000ed90: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+0000eda0: 636b 2069 7427 7320 706f 7373 6962 6c65  ck it's possible
+0000edb0: 2074 6f20 6361 6c63 756c 6174 6520 766f   to calculate vo
+0000edc0: 6c75 6d65 2077 6974 6820 7468 6520 7265  lume with the re
+0000edd0: 7175 6573 7465 6420 756e 6974 730a 2020  quested units.  
+0000ede0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000edf0: 662e 766f 7865 6c5f 7369 7a65 2069 7320  f.voxel_size is 
+0000ee00: 4e6f 6e65 2061 6e64 2075 6e69 7473 203d  None and units =
+0000ee10: 3d20 2276 6f78 656c 7322 3a0a 2020 2020  = "voxels":.    
+0000ee20: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000ee30: 6520 5275 6e74 696d 6545 7272 6f72 2822  e RuntimeError("
+0000ee40: 4361 6e6e 6f74 2063 6f6d 7075 7465 2076  Cannot compute v
+0000ee50: 6f6c 756d 6520 696e 2076 6f78 656c 7320  olume in voxels 
+0000ee60: 6672 6f6d 2022 0a20 2020 2020 2020 2020  from ".         
+0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee80: 2020 2020 2020 2020 2020 2263 6f6e 746f            "conto
+0000ee90: 7572 7320 7769 7468 6f75 7420 6b6e 6f77  urs without know
+0000eea0: 696e 6720 766f 7865 6c20 7369 7a65 7321  ing voxel sizes!
+0000eeb0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0000eec0: 2320 4361 6c63 756c 6174 6520 6172 6561  # Calculate area
+0000eed0: 206f 6e20 6561 6368 2073 6c69 6365 0a20   on each slice. 
+0000eee0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+0000eef0: 5f61 7265 6173 203d 205b 5d0a 2020 2020  _areas = [].    
+0000ef00: 2020 2020 2020 2020 666f 7220 6964 7820          for idx 
+0000ef10: 696e 2073 656c 662e 6765 745f 636f 6e74  in self.get_cont
+0000ef20: 6f75 7273 2822 782d 7922 2c20 6964 785f  ours("x-y", idx_
+0000ef30: 6173 5f6b 6579 3d54 7275 6529 3a0a 2020  as_key=True):.  
+0000ef40: 2020 2020 2020 2020 2020 2020 2020 736c                sl
+0000ef50: 6963 655f 6172 6561 732e 6170 7065 6e64  ice_areas.append
+0000ef60: 2873 656c 662e 6765 745f 6172 6561 2822  (self.get_area("
+0000ef70: 782d 7922 2c20 6964 783d 6964 782c 206d  x-y", idx=idx, m
+0000ef80: 6574 686f 643d 6d65 7468 6f64 2929 0a0a  ethod=method))..
+0000ef90: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+0000efa0: 6e76 6572 7420 746f 2076 6f6c 756d 6520  nvert to volume 
+0000efb0: 696e 206d 6d0a 2020 2020 2020 2020 2020  in mm.          
+0000efc0: 2020 6172 6561 5f73 756d 203d 2073 756d    area_sum = sum
+0000efd0: 2873 6c69 6365 5f61 7265 6173 290a 2020  (slice_areas).  
+0000efe0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000eff0: 766f 6c75 6d65 5b22 6d6d 225d 203d 2061  volume["mm"] = a
+0000f000: 7265 615f 7375 6d20 2a20 7365 6c66 2e67  rea_sum * self.g
+0000f010: 6574 5f73 6c69 6365 5f74 6869 636b 6e65  et_slice_thickne
+0000f020: 7373 5f63 6f6e 746f 7572 7328 290a 0a20  ss_contours().. 
+0000f030: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0000f040: 706f 7373 6962 6c65 2c20 636f 6e76 6572  possible, conver
+0000f050: 7420 746f 2076 6f6c 756d 6520 696e 2076  t to volume in v
+0000f060: 6f78 656c 730a 2020 2020 2020 2020 2020  oxels.          
+0000f070: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
+0000f080: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+0000f090: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f0a0: 2020 7879 5f76 6f78 656c 5f61 7265 6120    xy_voxel_area 
+0000f0b0: 3d20 7365 6c66 2e76 6f78 656c 5f73 697a  = self.voxel_siz
+0000f0c0: 655b 305d 202a 2073 656c 662e 766f 7865  e[0] * self.voxe
+0000f0d0: 6c5f 7369 7a65 5b31 5d0a 2020 2020 2020  l_size[1].      
+0000f0e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000f0f0: 766f 6c75 6d65 5b22 766f 7865 6c73 225d  volume["voxels"]
+0000f100: 203d 2061 7265 615f 7375 6d20 2f20 7879   = area_sum / xy
+0000f110: 5f76 6f78 656c 5f61 7265 610a 0a20 2020  _voxel_area..   
+0000f120: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
+0000f130: 2c20 6361 6c63 756c 6174 6520 6672 6f6d  , calculate from
+0000f140: 206e 756d 6265 7220 6f66 2076 6f78 656c   number of voxel
+0000f150: 7320 696e 206d 6173 6b0a 2020 2020 2020  s in mask.      
+0000f160: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000f170: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+0000f180: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
+0000f190: 2020 2073 656c 662e 5f76 6f6c 756d 655b     self._volume[
+0000f1a0: 2276 6f78 656c 7322 5d20 3d20 7365 6c66  "voxels"] = self
+0000f1b0: 2e6d 6173 6b2e 6461 7461 2e61 7374 7970  .mask.data.astyp
+0000f1c0: 6528 626f 6f6c 292e 7375 6d28 290a 2020  e(bool).sum().  
+0000f1d0: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
+0000f1e0: 766f 6c20 3d20 6162 7328 6e70 2e70 726f  vol = abs(np.pro
+0000f1f0: 6428 7365 6c66 2e67 6574 5f76 6f78 656c  d(self.get_voxel
+0000f200: 5f73 697a 6528 2929 290a 2020 2020 2020  _size())).      
+0000f210: 2020 2020 2020 7365 6c66 2e5f 766f 6c75        self._volu
+0000f220: 6d65 5b22 6d6d 225d 203d 2073 656c 662e  me["mm"] = self.
+0000f230: 5f76 6f6c 756d 655b 2276 6f78 656c 7322  _volume["voxels"
+0000f240: 5d20 2a20 766f 7865 6c5f 766f 6c0a 0a20  ] * voxel_vol.. 
+0000f250: 2020 2020 2020 2023 2047 6574 2076 6f6c         # Get vol
+0000f260: 756d 6520 696e 206d 6c20 6f72 2065 7175  ume in ml or equ
+0000f270: 6976 616c 656e 746c 7920 6363 0a20 2020  ivalently cc.   
+0000f280: 2020 2020 2073 656c 662e 5f76 6f6c 756d       self._volum
+0000f290: 655b 226d 6c22 5d20 3d20 7365 6c66 2e5f  e["ml"] = self._
+0000f2a0: 766f 6c75 6d65 5b22 6d6d 225d 202f 2031  volume["mm"] / 1
+0000f2b0: 3030 300a 2020 2020 2020 2020 7365 6c66  000.        self
+0000f2c0: 2e5f 766f 6c75 6d65 5b22 6363 225d 203d  ._volume["cc"] =
+0000f2d0: 2073 656c 662e 5f76 6f6c 756d 655b 226d   self._volume["m
+0000f2e0: 6c22 5d0a 0a20 2020 2020 2020 2023 2052  l"]..        # R
+0000f2f0: 6574 7572 6e20 766f 6c75 6d65 2069 6e20  eturn volume in 
+0000f300: 7468 6520 7265 7175 6573 7465 6420 756e  the requested un
+0000f310: 6974 730a 2020 2020 2020 2020 7265 7475  its.        retu
+0000f320: 726e 2073 656c 662e 5f76 6f6c 756d 655b  rn self._volume[
+0000f330: 756e 6974 735d 0a0a 2020 2020 6465 6620  units]..    def 
+0000f340: 6765 745f 6d61 736b 5f74 6f5f 636f 6e74  get_mask_to_cont
+0000f350: 6f75 725f 766f 6c75 6d65 5f72 6174 696f  our_volume_ratio
+0000f360: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000f370: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+0000f380: 7261 7469 6f20 746f 2052 4f49 2022 6d61  ratio to ROI "ma
+0000f390: 736b 2220 766f 6c75 6d65 2074 6f20 524f  sk" volume to RO
+0000f3a0: 4920 2263 6f6e 746f 7572 2220 766f 6c75  I "contour" volu
+0000f3b0: 6d65 2e0a 0a20 2020 2020 2020 2049 6e20  me...        In 
+0000f3c0: 7072 696e 6369 706c 652c 2076 6f6c 756d  principle, volum
+0000f3d0: 6520 6573 7469 6d61 7465 7320 6672 6f6d  e estimates from
+0000f3e0: 2022 6d61 736b 2220 616e 6420 2263 6f6e   "mask" and "con
+0000f3f0: 746f 7572 2220 6d65 7468 6f64 730a 2020  tour" methods.  
+0000f400: 2020 2020 2020 7368 6f75 6c64 2062 6520        should be 
+0000f410: 7369 6d69 6c61 722e 2020 5468 6520 7477  similar.  The tw
+0000f420: 6f20 6573 7469 6d61 7465 7320 6d61 7920  o estimates may 
+0000f430: 6265 2064 6966 6665 7265 6e74 2069 662c  be different if,
+0000f440: 2066 6f72 0a20 2020 2020 2020 2065 7861   for.        exa
+0000f450: 6d70 6c65 2c20 7468 6520 696d 6167 6520  mple, the image 
+0000f460: 6672 6f6d 2077 6869 6368 2061 206d 6173  from which a mas
+0000f470: 6b20 6973 2063 7265 6174 6564 2064 6f65  k is created doe
+0000f480: 736e 2774 2066 756c 6c79 2063 6f76 6572  sn't fully cover
+0000f490: 0a20 2020 2020 2020 2074 6865 2063 6f6e  .        the con
+0000f4a0: 746f 7572 2065 7874 656e 7473 2e0a 2020  tour extents..  
+0000f4b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000f4c0: 2020 7265 7475 726e 2028 7365 6c66 2e67    return (self.g
+0000f4d0: 6574 5f76 6f6c 756d 6528 6d65 7468 6f64  et_volume(method
+0000f4e0: 3d22 6d61 736b 222c 2066 6f72 6365 3d54  ="mask", force=T
+0000f4f0: 7275 6529 202f 0a20 2020 2020 2020 2020  rue) /.         
+0000f500: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+0000f510: 766f 6c75 6d65 286d 6574 686f 643d 2263  volume(method="c
+0000f520: 6f6e 746f 7572 222c 2066 6f72 6365 3d54  ontour", force=T
+0000f530: 7275 6529 290a 0a20 2020 2064 6566 2067  rue))..    def g
+0000f540: 6574 5f61 7265 6128 0a20 2020 2020 2020  et_area(.       
+0000f550: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
+0000f560: 7669 6577 3d22 782d 7922 2c20 0a20 2020  view="x-y", .   
+0000f570: 2020 2020 2073 6c3d 4e6f 6e65 2c20 0a20       sl=None, . 
+0000f580: 2020 2020 2020 2069 6478 3d4e 6f6e 652c         idx=None,
+0000f590: 200a 2020 2020 2020 2020 706f 733d 4e6f   .        pos=No
+0000f5a0: 6e65 2c20 0a20 2020 2020 2020 2075 6e69  ne, .        uni
+0000f5b0: 7473 3d22 6d6d 222c 200a 2020 2020 2020  ts="mm", .      
+0000f5c0: 2020 6d65 7468 6f64 3d4e 6f6e 652c 0a20    method=None,. 
+0000f5d0: 2020 2020 2020 2066 6c61 7474 656e 3d46         flatten=F
+0000f5e0: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
+0000f5f0: 2020 2020 2022 2222 4765 7420 7468 6520       """Get the 
+0000f600: 6172 6561 206f 6620 7468 6520 524f 4920  area of the ROI 
+0000f610: 6f6e 2061 2067 6976 656e 2073 6c69 6365  on a given slice
+0000f620: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0000f630: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
+0000f640: 2020 200a 2020 2020 2020 2020 7669 6577     .        view
+0000f650: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
+0000f660: 2278 2d79 220a 2020 2020 2020 2020 2020  "x-y".          
+0000f670: 2020 4f72 6965 6e74 6174 696f 6e20 6f66    Orientation of
+0000f680: 2073 6c69 6365 2066 6f72 2077 6869 6368   slice for which
+0000f690: 2074 6f20 6765 7420 6172 6561 2e0a 0a20   to get area... 
+0000f6a0: 2020 2020 2020 2073 6c20 3a20 696e 742c         sl : int,
+0000f6b0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0000f6c0: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+0000f6d0: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
+0000f6e0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0000f6f0: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0000f700: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0000f710: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0000f720: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0000f730: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0000f740: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
+0000f750: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+0000f760: 2069 6478 203a 2069 6e74 2c20 6465 6661   idx : int, defa
+0000f770: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0000f780: 2020 2020 2041 7272 6179 2069 6e64 6578       Array index
+0000f790: 206f 6620 736c 6963 652e 2049 6620 6e6f   of slice. If no
+0000f7a0: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
+0000f7b0: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
+0000f7c0: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
+0000f7d0: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
+0000f7e0: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+0000f7f0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+0000f800: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
+0000f810: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+0000f820: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
+0000f830: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0000f840: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+0000f850: 706f 7369 7469 6f6e 2069 6e20 6d6d 2e20  position in mm. 
+0000f860: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0000f870: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0000f880: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0000f890: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0000f8a0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0000f8b0: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0000f8c0: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+0000f8d0: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+0000f8e0: 0a20 2020 2020 2020 2075 6e69 7473 203a  .        units :
+0000f8f0: 2073 7472 2c20 6465 6661 756c 743d 226d   str, default="m
+0000f900: 6d22 0a20 2020 2020 2020 2020 2020 2055  m".            U
+0000f910: 6e69 7473 206f 6620 6172 6561 2e20 4361  nits of area. Ca
+0000f920: 6e20 6265 2065 6974 6865 7220 6f66 3a0a  n be either of:.
+0000f930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f940: 202a 2022 6d6d 223a 2072 6574 7572 6e20   * "mm": return 
+0000f950: 6172 6561 2069 6e20 6d69 6c6c 696d 6574  area in millimet
+0000f960: 7265 7320 7371 7561 7265 642e 0a20 2020  res squared..   
+0000f970: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+0000f980: 766f 7865 6c73 223a 2072 6574 7572 6e20  voxels": return 
+0000f990: 6172 6561 2069 6e20 6e75 6d62 6572 206f  area in number o
+0000f9a0: 6620 766f 7865 6c73 2e0a 0a20 2020 2020  f voxels...     
+0000f9b0: 2020 2020 2020 2049 6620 756e 6974 733d         If units=
+0000f9c0: 2276 6f78 656c 7322 2069 7320 7265 7175  "voxels" is requ
+0000f9d0: 6573 7465 6420 6275 7420 7468 6973 2052  ested but this R
+0000f9e0: 4f49 206f 6e6c 7920 6861 7320 636f 6e74  OI only has cont
+0000f9f0: 6f75 7273 2061 6e64 206e 6f0a 2020 2020  ours and no.    
+0000fa00: 2020 2020 2020 2020 766f 7865 6c20 7369          voxel si
+0000fa10: 7a65 2069 6e66 6f72 6d61 7469 6f6e 2c20  ze information, 
+0000fa20: 616e 2065 7272 6f72 2077 696c 6c20 6265  an error will be
+0000fa30: 2072 6169 7365 642e 0a0a 2020 2020 2020   raised...      
+0000fa40: 2020 6d65 7468 6f64 203a 2073 7472 2c20    method : str, 
+0000fa50: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+0000fa60: 2020 2020 2020 2020 204d 6574 686f 6420           Method 
+0000fa70: 746f 2075 7365 2066 6f72 2061 7265 6120  to use for area 
+0000fa80: 6361 6c63 756c 6174 696f 6e2e 2043 616e  calculation. Can
+0000fa90: 2062 653a 200a 0a20 2020 2020 2020 2020   be: ..         
+0000faa0: 2020 2020 2020 202a 2022 636f 6e74 6f75         * "contou
+0000fab0: 7222 3a20 636f 6d70 7574 6520 6172 6561  r": compute area
+0000fac0: 2066 726f 6d20 7368 6170 656c 7920 706f   from shapely po
+0000fad0: 6c79 676f 6e20 6f6e 2074 6865 2073 6c69  lygon on the sli
+0000fae0: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+0000faf0: 2020 2020 2a20 226d 6173 6b22 3a20 636f      * "mask": co
+0000fb00: 6d70 7574 6520 6172 6561 2062 7920 7375  mpute area by su
+0000fb10: 6d6d 696e 6720 7069 7865 6c73 206f 6e20  mming pixels on 
+0000fb20: 7468 6520 736c 6963 6520 616e 6420 0a20  the slice and . 
+0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb40: 206d 756c 7469 706c 7969 6e67 2062 7920   multiplying by 
+0000fb50: 7468 6520 6172 6561 206f 6620 6f6e 6520  the area of one 
+0000fb60: 7069 7865 6c2e 0a20 2020 2020 2020 2020  pixel..         
+0000fb70: 2020 2020 2020 202a 204e 6f6e 653a 2075         * None: u
+0000fb80: 7365 2074 6865 206d 6574 686f 6420 7365  se the method se
+0000fb90: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
+0000fba0: 745f 6765 6f6d 5f6d 6574 686f 642e 0a0a  t_geom_method...
+0000fbb0: 2020 2020 2020 2020 666c 6174 7465 6e20          flatten 
+0000fbc0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+0000fbd0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0000fbe0: 2020 4966 2054 7275 652c 2061 6c6c 2073    If True, all s
+0000fbf0: 6c69 6365 7320 7769 6c6c 2062 6520 666c  lices will be fl
+0000fc00: 6174 7465 6e65 6420 696e 2074 6865 2067  attened in the g
+0000fc10: 6976 656e 206f 7269 656e 7461 7469 6f6e  iven orientation
+0000fc20: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+0000fc30: 2074 6865 2061 7265 6120 6f66 2074 6865   the area of the
+0000fc40: 2066 6c61 7474 656e 6564 2073 6c69 6365   flattened slice
+0000fc50: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+0000fc60: 642e 204f 6e6c 7920 6176 6169 6c61 626c  d. Only availabl
+0000fc70: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0000fc80: 206d 6574 686f 643d 226d 6173 6b22 2e0a   method="mask"..
+0000fc90: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000fca0: 2020 2020 2023 2047 6574 2064 6566 6175       # Get defau
+0000fcb0: 6c74 2073 6c69 6365 2069 6e64 6578 2061  lt slice index a
+0000fcc0: 6e64 206d 6574 686f 640a 2020 2020 2020  nd method.      
+0000fcd0: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
+0000fce0: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
+0000fcf0: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
+0000fd00: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+0000fd10: 6f6e 653a 200a 2020 2020 2020 2020 2020  one: .          
+0000fd20: 2020 6964 7820 3d20 7365 6c66 2e67 6574    idx = self.get
+0000fd30: 5f6d 6964 5f69 6478 2876 6965 7729 0a20  _mid_idx(view). 
+0000fd40: 2020 2020 2020 2069 6620 6d65 7468 6f64         if method
+0000fd50: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000fd60: 2020 2020 2020 6d65 7468 6f64 203d 2073        method = s
+0000fd70: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+0000fd80: 5f6d 6574 686f 640a 0a20 2020 2020 2020  _method..       
+0000fd90: 2023 2049 6620 524f 4920 6973 206e 6f74   # If ROI is not
+0000fda0: 206f 6e20 7468 6520 6769 7665 6e20 736c   on the given sl
+0000fdb0: 6963 652c 2072 6574 7572 6e20 4e6f 6e65  ice, return None
+0000fdc0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000fdd0: 7365 6c66 2e6f 6e5f 736c 6963 6528 7669  self.on_slice(vi
+0000fde0: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
+0000fdf0: 6478 2c20 706f 733d 706f 7329 3a0a 2020  dx, pos=pos):.  
+0000fe00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000fe10: 0a0a 2020 2020 2020 2020 6966 2066 6c61  ..        if fla
+0000fe20: 7474 656e 3a20 2023 2046 6c61 7474 656e  tten:  # Flatten
+0000fe30: 696e 6720 6f6e 6c79 2070 6f73 7369 626c  ing only possibl
+0000fe40: 6520 7769 7468 2022 6d61 736b 220a 2020  e with "mask".  
+0000fe50: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+0000fe60: 203d 2022 6d61 736b 220a 0a20 2020 2020   = "mask"..     
+0000fe70: 2020 2023 2043 616c 6375 6c61 7465 2061     # Calculate a
+0000fe80: 7265 6120 6672 6f6d 2073 6861 7065 6c79  rea from shapely
+0000fe90: 2070 6f6c 7967 6f6e 2873 290a 2020 2020   polygon(s).    
+0000fea0: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
+0000feb0: 2022 636f 6e74 6f75 7222 3a0a 0a20 2020   "contour":..   
+0000fec0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+0000fed0: 2069 7427 7320 706f 7373 6962 6c65 2074   it's possible t
+0000fee0: 6f20 6361 6c63 756c 6174 6520 6172 6561  o calculate area
+0000fef0: 2077 6974 6820 7468 6520 7265 7175 6573   with the reques
+0000ff00: 7465 6420 756e 6974 730a 2020 2020 2020  ted units.      
+0000ff10: 2020 2020 2020 6966 2073 656c 662e 766f        if self.vo
+0000ff20: 7865 6c5f 7369 7a65 2069 7320 4e6f 6e65  xel_size is None
+0000ff30: 2061 6e64 2075 6e69 7473 203d 3d20 2276   and units == "v
+0000ff40: 6f78 656c 7322 3a0a 2020 2020 2020 2020  oxels":.        
+0000ff50: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+0000ff60: 6e74 696d 6545 7272 6f72 2822 4361 6e6e  ntimeError("Cann
+0000ff70: 6f74 2063 6f6d 7075 7465 2061 7265 6120  ot compute area 
+0000ff80: 696e 2076 6f78 656c 7320 6672 6f6d 2022  in voxels from "
+0000ff90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffb0: 2020 2020 2263 6f6e 746f 7572 7320 7769      "contours wi
+0000ffc0: 7468 6f75 7420 6b6e 6f77 696e 6720 766f  thout knowing vo
+0000ffd0: 7865 6c20 7369 7a65 7321 2229 0a0a 2020  xel sizes!")..  
+0000ffe0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+0000fff0: 6e73 203d 2073 656c 662e 6765 745f 706f  ns = self.get_po
+00010000: 6c79 676f 6e73 5f6f 6e5f 736c 6963 6528  lygons_on_slice(
+00010010: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+00010020: 6f73 290a 2020 2020 2020 2020 2020 2020  os).            
+00010030: 6172 6561 203d 2073 756d 285b 702e 6172  area = sum([p.ar
+00010040: 6561 2066 6f72 2070 2069 6e20 706f 6c79  ea for p in poly
+00010050: 676f 6e73 5d29 0a20 2020 2020 2020 2020  gons]).         
+00010060: 2020 2069 6620 756e 6974 7320 3d3d 2022     if units == "
+00010070: 766f 7865 6c73 223a 0a20 2020 2020 2020  voxels":.       
+00010080: 2020 2020 2020 2020 2078 5f61 782c 2079           x_ax, y
+00010090: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
+000100a0: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+000100b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000100c0: 2020 7879 5f61 7265 6120 3d20 6162 7328    xy_area = abs(
+000100d0: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
+000100e0: 785f 6178 5d20 2a20 7365 6c66 2e76 6f78  x_ax] * self.vox
+000100f0: 656c 5f73 697a 655b 795f 6178 5d29 0a20  el_size[y_ax]). 
+00010100: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00010110: 7265 6120 2f3d 2078 795f 6172 6561 0a20  rea /= xy_area. 
+00010120: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00010130: 6e20 6172 6561 0a0a 2020 2020 2020 2020  n area..        
+00010140: 2320 4f74 6865 7277 6973 652c 2063 616c  # Otherwise, cal
+00010150: 6375 6c61 7465 2061 7265 6120 6672 6f6d  culate area from
+00010160: 2062 696e 6172 7920 6d61 736b 0a20 2020   binary mask.   
+00010170: 2020 2020 2069 6d5f 736c 6963 6520 3d20       im_slice = 
+00010180: 7365 6c66 2e67 6574 5f73 6c69 6365 2876  self.get_slice(v
+00010190: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
+000101a0: 6964 782c 2070 6f73 3d70 6f73 2c20 0a20  idx, pos=pos, . 
+000101b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101d0: 2066 6c61 7474 656e 3d66 6c61 7474 656e   flatten=flatten
+000101e0: 290a 2020 2020 2020 2020 6172 6561 203d  ).        area =
+000101f0: 2069 6d5f 736c 6963 652e 6173 7479 7065   im_slice.astype
+00010200: 2862 6f6f 6c29 2e73 756d 2829 0a20 2020  (bool).sum().   
+00010210: 2020 2020 2069 6620 756e 6974 7320 3d3d       if units ==
+00010220: 2022 6d6d 223a 0a20 2020 2020 2020 2020   "mm":.         
+00010230: 2020 2078 5f61 782c 2079 5f61 7820 3d20     x_ax, y_ax = 
+00010240: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
+00010250: 5f61 7865 735b 7669 6577 5d0a 2020 2020  _axes[view].    
+00010260: 2020 2020 2020 2020 7879 5f61 7265 6120          xy_area 
+00010270: 3d20 6162 7328 7365 6c66 2e76 6f78 656c  = abs(self.voxel
+00010280: 5f73 697a 655b 785f 6178 5d20 2a20 7365  _size[x_ax] * se
+00010290: 6c66 2e76 6f78 656c 5f73 697a 655b 795f  lf.voxel_size[y_
+000102a0: 6178 5d29 0a20 2020 2020 2020 2020 2020  ax]).           
+000102b0: 2061 7265 6120 2a3d 2078 795f 6172 6561   area *= xy_area
+000102c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000102d0: 6172 6561 0a0a 2020 2020 6465 6620 6765  area..    def ge
+000102e0: 745f 6262 6f78 5f63 656e 7472 655f 616e  t_bbox_centre_an
+000102f0: 645f 7769 6474 6873 2873 656c 662c 0a20  d_widths(self,. 
+00010300: 2020 2020 2020 2020 2020 2062 7566 6665             buffe
+00010310: 723d 4e6f 6e65 2c20 6275 6666 6572 5f75  r=None, buffer_u
+00010320: 6e69 7473 3d22 6d6d 222c 206d 6574 686f  nits="mm", metho
+00010330: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
+00010340: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+00010350: 2063 656e 7472 6520 616e 6420 7769 6474   centre and widt
+00010360: 6873 2069 6e20 6d6d 2061 6c6f 6e67 2061  hs in mm along a
+00010370: 6c6c 2074 6872 6565 2061 7865 7320 6f66  ll three axes of
+00010380: 2061 0a20 2020 2020 2020 2062 6f75 6e64   a.        bound
+00010390: 696e 6720 626f 7820 656e 636c 6f73 696e  ing box enclosin
+000103a0: 6720 7468 6520 524f 4920 616e 6420 6f70  g the ROI and op
+000103b0: 7469 6f6e 616c 2062 7566 6665 722e 2020  tional buffer.  
+000103c0: 4365 6e74 7265 0a20 2020 2020 2020 2061  Centre.        a
+000103d0: 6e64 2077 6964 7468 7320 6172 6520 7265  nd widths are re
+000103e0: 7475 726e 6564 2061 7320 6120 7475 706c  turned as a tupl
+000103f0: 6520 285b 782c 2079 2c20 7a5d 2c20 5b64  e ([x, y, z], [d
+00010400: 782c 2064 792c 2064 7a5d 292e 0a0a 2020  x, dy, dz])...  
+00010410: 2020 2020 2020 4d65 7468 6f64 2070 6172        Method par
+00010420: 616d 6574 6572 7320 6172 6520 7061 7373  ameters are pass
+00010430: 6564 2074 6f20 736b 7274 2e73 7472 7563  ed to skrt.struc
+00010440: 7475 7265 732e 524f 492e 6765 745f 6578  tures.ROI.get_ex
+00010450: 7465 6e74 7328 290a 2020 2020 2020 2020  tents().        
+00010460: 746f 206f 6274 6169 6e20 524f 4920 6578  to obtain ROI ex
+00010470: 7465 6e74 732e 2020 466f 7220 7061 7261  tents.  For para
+00010480: 6d65 7465 7220 6578 706c 616e 6174 696f  meter explanatio
+00010490: 6e73 2c20 7365 650a 2020 2020 2020 2020  ns, see.        
+000104a0: 736b 7274 2e73 7472 7563 7475 7265 732e  skrt.structures.
+000104b0: 524f 492e 6765 745f 6578 7465 6e74 7328  ROI.get_extents(
+000104c0: 2920 646f 6375 6d65 6e74 6174 696f 6e2e  ) documentation.
+000104d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000104e0: 2020 2020 2065 7874 656e 7473 203d 2073       extents = s
+000104f0: 656c 662e 6765 745f 6578 7465 6e74 7328  elf.get_extents(
+00010500: 6275 6666 6572 2c20 6275 6666 6572 5f75  buffer, buffer_u
+00010510: 6e69 7473 2c20 6d65 7468 6f64 2920 0a20  nits, method) . 
+00010520: 2020 2020 2020 2063 656e 7472 6520 3d20         centre = 
+00010530: 5b30 2e35 202a 2028 6578 7465 6e74 5b30  [0.5 * (extent[0
+00010540: 5d20 2b20 6578 7465 6e74 5b31 5d29 2066  ] + extent[1]) f
+00010550: 6f72 2065 7874 656e 7420 696e 2065 7874  or extent in ext
+00010560: 656e 7473 5d0a 2020 2020 2020 2020 7769  ents].        wi
+00010570: 6474 6873 203d 205b 2865 7874 656e 745b  dths = [(extent[
+00010580: 315d 202d 2065 7874 656e 745b 305d 2920  1] - extent[0]) 
+00010590: 666f 7220 6578 7465 6e74 2069 6e20 6578  for extent in ex
+000105a0: 7465 6e74 735d 0a20 2020 2020 2020 2072  tents].        r
+000105b0: 6574 7572 6e20 2863 656e 7472 652c 2077  eturn (centre, w
+000105c0: 6964 7468 7329 0a0a 2020 2020 6465 6620  idths)..    def 
+000105d0: 6765 745f 6578 7465 6e74 7328 7365 6c66  get_extents(self
+000105e0: 2c20 6275 6666 6572 3d4e 6f6e 652c 2062  , buffer=None, b
+000105f0: 7566 6665 725f 756e 6974 733d 226d 6d22  uffer_units="mm"
+00010600: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 0a20  , method=None,. 
+00010610: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00010620: 6e3d 4e6f 6e65 293a 0a20 2020 2020 2020  n=None):.       
+00010630: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+00010640: 206d 696e 696d 756d 2061 6e64 206d 6178   minimum and max
+00010650: 696d 756d 2065 7874 656e 7420 6f66 2074  imum extent of t
+00010660: 6865 2052 4f49 2069 6e20 6d6d 2061 6c6f  he ROI in mm alo
+00010670: 6e67 2061 6c6c 2074 6872 6565 2061 7865  ng all three axe
+00010680: 732c 0a20 2020 2020 2020 2072 6574 7572  s,.        retur
+00010690: 6e65 6420 696e 206f 7264 6572 205b 782c  ned in order [x,
+000106a0: 2079 2c20 7a5d 2e20 4f70 7469 6f6e 616c   y, z]. Optional
+000106b0: 6c79 2061 7070 6c79 2061 2062 7566 6665  ly apply a buffe
+000106c0: 7220 746f 2074 6865 2065 7874 656e 7473  r to the extents
+000106d0: 0a20 2020 2020 2020 2073 7563 6820 7468  .        such th
+000106e0: 6174 2074 6865 7920 636f 7665 7220 6d6f  at they cover mo
+000106f0: 7265 2074 6861 6e20 7468 6520 524f 4927  re than the ROI'
+00010700: 7320 6172 6561 2e0a 0a20 2020 2020 2020  s area...       
+00010710: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00010720: 0a0a 2020 2020 2020 2020 6275 6666 6572  ..        buffer
+00010730: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+00010740: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00010750: 2020 204f 7074 696f 6e61 6c20 6275 6666     Optional buff
+00010760: 6572 2074 6f20 6164 6420 746f 2074 6865  er to add to the
+00010770: 2065 7874 656e 7473 2e20 556e 6974 7320   extents. Units 
+00010780: 7365 7420 6279 2060 6275 6666 6572 5f75  set by `buffer_u
+00010790: 6e69 7473 602e 0a0a 2020 2020 2020 2020  nits`...        
+000107a0: 6275 6666 6572 5f75 6e69 7473 203a 2073  buffer_units : s
+000107b0: 7472 2c20 6465 6661 756c 743d 226d 6d22  tr, default="mm"
+000107c0: 0a20 2020 2020 2020 2020 2020 2055 6e69  .            Uni
+000107d0: 7473 2066 6f72 2062 7566 6665 722c 2069  ts for buffer, i
+000107e0: 6620 7573 696e 672e 2043 616e 2062 6520  f using. Can be 
+000107f0: 226d 6d22 2c20 2276 6f78 656c 7322 2c20  "mm", "voxels", 
+00010800: 6f72 2022 6672 6163 2220 2877 6869 6368  or "frac" (which
+00010810: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
+00010820: 6c69 6573 2062 7566 6665 7220 6173 2061  lies buffer as a
+00010830: 2066 7261 6374 696f 6e20 6f66 2074 6f74   fraction of tot
+00010840: 616c 206c 656e 6774 6820 696e 2065 6163  al length in eac
+00010850: 6820 6469 6d65 6e73 696f 6e29 2e0a 0a20  h dimension)... 
+00010860: 2020 2020 2020 206d 6574 686f 6420 3a20         method : 
+00010870: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+00010880: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
+00010890: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
+000108a0: 6578 7465 6e74 2063 616c 6375 6c61 7469  extent calculati
+000108b0: 6f6e 2e20 4361 6e20 6265 3a20 0a0a 2020  on. Can be: ..  
+000108c0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+000108d0: 2263 6f6e 746f 7572 223a 2067 6574 2065  "contour": get e
+000108e0: 7874 656e 7420 6672 6f6d 206d 696e 2f6d  xtent from min/m
+000108f0: 6178 2070 6f73 6974 696f 6e73 206f 6620  ax positions of 
+00010900: 636f 6e74 6f75 7228 7329 2e0a 2020 2020  contour(s)..    
+00010910: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
+00010920: 6173 6b22 3a20 6765 7420 6578 7465 6e74  ask": get extent
+00010930: 2066 726f 6d20 6d69 6e2f 6d61 7820 706f   from min/max po
+00010940: 7369 7469 6f6e 7320 6f66 2076 6f78 656c  sitions of voxel
+00010950: 7320 696e 2074 6865 200a 2020 2020 2020  s in the .      
+00010960: 2020 2020 2020 2020 2020 2020 6269 6e61              bina
+00010970: 7279 206d 6173 6b2e 0a20 2020 2020 2020  ry mask..       
+00010980: 2020 2020 2020 2020 202a 204e 6f6e 653a           * None:
+00010990: 2075 7365 2074 6865 206d 6574 686f 6420   use the method 
+000109a0: 7365 7420 696e 2073 656c 662e 6465 6661  set in self.defa
+000109b0: 756c 745f 6765 6f6d 5f6d 6574 686f 642e  ult_geom_method.
+000109c0: 0a0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
+000109d0: 203a 2074 7570 6c65 2c20 6465 6661 756c   : tuple, defaul
+000109e0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+000109f0: 2020 2054 7570 6c65 2073 7065 6369 6679     Tuple specify
+00010a00: 696e 6720 7468 6520 2878 2c20 792c 207a  ing the (x, y, z
+00010a10: 2920 636f 6f72 6469 6e61 7465 7320 6f66  ) coordinates of
+00010a20: 2074 6865 2070 6f69 6e74 0a20 2020 2020   the point.     
+00010a30: 2020 2020 2020 2077 6974 6820 7265 7370         with resp
+00010a40: 6563 7420 746f 2077 6869 6368 2065 7874  ect to which ext
+00010a50: 656e 7473 2061 7265 2074 6f20 6265 2064  ents are to be d
+00010a60: 6574 6572 6d69 6e65 642e 0a20 2020 2020  etermined..     
+00010a70: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
+00010a80: 7468 656e 2028 302c 2030 2c20 3029 2069  then (0, 0, 0) i
+00010a90: 7320 7573 6564 2e0a 2020 2020 2020 2020  s used..        
+00010aa0: 2222 220a 2020 2020 2020 2020 2320 456e  """.        # En
+00010ab0: 7375 7265 2074 6861 7420 6f72 6967 696e  sure that origin
+00010ac0: 2069 7320 6465 6669 6e65 642e 0a20 2020   is defined..   
+00010ad0: 2020 2020 206f 7269 6769 6e20 3d20 6f72       origin = or
+00010ae0: 6967 696e 206f 7220 2830 2c20 302c 2030  igin or (0, 0, 0
+00010af0: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+00010b00: 2065 7874 656e 7420 696e 2065 6163 6820   extent in each 
+00010b10: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
+00010b20: 2020 6578 7465 6e74 7320 3d20 5b5d 0a20    extents = []. 
+00010b30: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
+00010b40: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
+00010b50: 733a 0a20 2020 2020 2020 2020 2020 2065  s:.            e
+00010b60: 7874 656e 7473 2e61 7070 656e 6428 7365  xtents.append(se
+00010b70: 6c66 2e67 6574 5f65 7874 656e 7428 6178  lf.get_extent(ax
+00010b80: 2c20 6d65 7468 6f64 3d6d 6574 686f 642c  , method=method,
+00010b90: 206f 7269 6769 6e3d 6f72 6967 696e 2929   origin=origin))
+00010ba0: 0a0a 2020 2020 2020 2020 2320 4170 706c  ..        # Appl
+00010bb0: 7920 6275 6666 6572 2069 6620 7265 7175  y buffer if requ
+00010bc0: 6573 7465 640a 2020 2020 2020 2020 6966  ested.        if
+00010bd0: 2062 7566 6665 723a 0a20 2020 2020 2020   buffer:.       
+00010be0: 2020 2020 2066 6f72 2061 7820 696e 2072       for ax in r
+00010bf0: 616e 6765 2833 293a 0a20 2020 2020 2020  ange(3):.       
+00010c00: 2020 2020 2020 2020 2069 6620 6275 6666           if buff
+00010c10: 6572 5f75 6e69 7473 203d 3d20 226d 6d22  er_units == "mm"
+00010c20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010c30: 2020 2020 2020 6465 6c74 6120 3d20 6275        delta = bu
+00010c40: 6666 6572 0a20 2020 2020 2020 2020 2020  ffer.           
+00010c50: 2020 2020 2065 6c69 6620 6275 6666 6572       elif buffer
+00010c60: 5f75 6e69 7473 203d 3d20 2276 6f78 656c  _units == "voxel
+00010c70: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+00010c80: 2020 2020 2020 2020 6465 6c74 6120 3d20          delta = 
+00010c90: 6162 7328 6275 6666 6572 202a 2073 656c  abs(buffer * sel
+00010ca0: 662e 766f 7865 6c5f 7369 7a65 5b61 785d  f.voxel_size[ax]
+00010cb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010cc0: 2020 656c 6966 2062 7566 6665 725f 756e    elif buffer_un
+00010cd0: 6974 7320 3d3d 2022 6672 6163 223a 0a20  its == "frac":. 
+00010ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cf0: 2020 2064 656c 7461 203d 2062 7566 6665     delta = buffe
+00010d00: 7220 2a20 6162 7328 6578 7465 6e74 735b  r * abs(extents[
+00010d10: 6178 5d5b 315d 202d 2065 7874 656e 7473  ax][1] - extents
+00010d20: 5b61 785d 5b30 5d29 0a20 2020 2020 2020  [ax][0]).       
+00010d30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00010d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d50: 2020 2070 7269 6e74 2866 2255 6e72 6563     print(f"Unrec
+00010d60: 6f67 6e69 7365 6420 6275 6666 6572 2075  ognised buffer u
+00010d70: 6e69 7473 207b 6275 6666 6572 5f75 6e69  nits {buffer_uni
+00010d80: 7473 7d2e 2053 686f 756c 6420 220a 2020  ts}. Should ".  
+00010d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010da0: 2020 2020 2020 2020 2762 6520 226d 6d22          'be "mm"
+00010db0: 2c20 2276 6f78 656c 7322 2c20 6f72 2022  , "voxels", or "
+00010dc0: 6672 6163 222e 2729 0a20 2020 2020 2020  frac".').       
+00010dd0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010de0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+00010df0: 2020 2020 6578 7465 6e74 735b 6178 5d5b      extents[ax][
+00010e00: 305d 202d 3d20 6465 6c74 610a 2020 2020  0] -= delta.    
+00010e10: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+00010e20: 6e74 735b 6178 5d5b 315d 202b 3d20 6465  nts[ax][1] += de
+00010e30: 6c74 610a 0a20 2020 2020 2020 2072 6574  lta..        ret
+00010e40: 7572 6e20 6578 7465 6e74 730a 0a20 2020  urn extents..   
+00010e50: 2064 6566 2067 6574 5f65 7874 656e 7428   def get_extent(
+00010e60: 7365 6c66 2c20 0a20 2020 2020 2020 2020  self, .         
+00010e70: 2020 2020 2020 2020 2020 6178 3d22 7a22            ax="z"
+00010e80: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00010e90: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
+00010ea0: 6365 3d46 616c 7365 2c0a 2020 2020 2020  ce=False,.      
+00010eb0: 2020 2020 2020 2020 2020 2020 2076 6965               vie
+00010ec0: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
+00010ed0: 2020 2020 2020 2020 2020 2020 736c 3d4e              sl=N
+00010ee0: 6f6e 652c 200a 2020 2020 2020 2020 2020  one, .          
+00010ef0: 2020 2020 2020 2020 2069 6478 3d4e 6f6e           idx=Non
+00010f00: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00010f10: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
+00010f20: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00010f30: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
+00010f40: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00010f50: 2020 2020 2020 6f72 6967 696e 3d4e 6f6e        origin=Non
+00010f60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00010f70: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00010f80: 2222 2247 6574 206d 696e 696d 756d 2061  """Get minimum a
+00010f90: 6e64 206d 6178 696d 756d 2065 7874 656e  nd maximum exten
+00010fa0: 7420 6f66 2074 6865 2052 4f49 2069 6e20  t of the ROI in 
+00010fb0: 6d6d 2061 6c6f 6e67 2061 2067 6976 656e  mm along a given
+00010fc0: 2061 7869 732e 0a0a 2020 2020 2020 2020   axis...        
+00010fd0: 6178 203a 2073 7472 2f69 6e74 2c20 6465  ax : str/int, de
+00010fe0: 6661 756c 743d 227a 220a 2020 2020 2020  fault="z".      
+00010ff0: 2020 2020 2020 4178 6973 2061 6c6f 6e67        Axis along
+00011000: 2077 6869 6368 2074 6f20 7265 7475 726e   which to return
+00011010: 2065 7874 656e 742e 2053 686f 756c 6420   extent. Should 
+00011020: 6265 206f 6e65 206f 6620 5b22 7822 2c20  be one of ["x", 
+00011030: 2279 222c 2022 7a22 5d20 0a20 2020 2020  "y", "z"] .     
+00011040: 2020 2020 2020 206f 7220 5b30 2c20 312c         or [0, 1,
+00011050: 2032 5d0a 0a20 2020 2020 2020 2073 696e   2]..        sin
+00011060: 676c 655f 736c 6963 6520 3a20 626f 6f6c  gle_slice : bool
+00011070: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+00011080: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+00011090: 616c 7365 2c20 7468 6520 3344 2065 7874  alse, the 3D ext
+000110a0: 656e 7420 6f66 2074 6865 2065 6e74 6972  ent of the entir
+000110b0: 6520 524f 4920 7769 6c6c 2062 6520 7265  e ROI will be re
+000110c0: 7475 726e 6564 3b0a 2020 2020 2020 2020  turned;.        
+000110d0: 2020 2020 6f74 6865 7277 6973 652c 2074      otherwise, t
+000110e0: 6865 2032 4420 6578 7465 6e74 206f 6620  he 2D extent of 
+000110f0: 6120 7369 6e67 6c65 2073 6c69 6365 2077  a single slice w
+00011100: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+00011110: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
+00011120: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
+00011130: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
+00011140: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
+00011150: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
+00011160: 2067 6574 2065 7874 656e 742e 204f 6e6c   get extent. Onl
+00011170: 7920 7573 6564 2069 6620 0a20 2020 2020  y used if .     
+00011180: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
+00011190: 6963 653d 5472 7565 2e20 4966 2075 7369  ice=True. If usi
+000111a0: 6e67 2c20 3c61 783e 206d 7573 7420 6265  ng, <ax> must be
+000111b0: 2061 6e20 6178 6973 2074 6861 7420 6c69   an axis that li
+000111c0: 6573 2061 6c6f 6e67 0a20 2020 2020 2020  es along.       
+000111d0: 2020 2020 2074 6865 2073 6c69 6365 2069       the slice i
+000111e0: 6e20 7468 6973 206f 7269 656e 7461 7469  n this orientati
+000111f0: 6f6e 2e0a 0a20 2020 2020 2020 2073 6c20  on...        sl 
+00011200: 3a20 696e 742c 2064 6566 6175 6c74 3d4e  : int, default=N
+00011210: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00011220: 536c 6963 6520 6e75 6d62 6572 2e20 4966  Slice number. If
+00011230: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00011240: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00011250: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+00011260: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+00011270: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+00011280: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+00011290: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
+000112a0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+000112b0: 2020 2020 2020 2069 6478 203a 2069 6e74         idx : int
+000112c0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+000112d0: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+000112e0: 2069 6e64 6578 206f 6620 736c 6963 652e   index of slice.
+000112f0: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
+00011300: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
+00011310: 2061 7265 2073 7570 706c 6965 6420 6275   are supplied bu
+00011320: 740a 2020 2020 2020 2020 2020 2020 3c73  t.            <s
+00011330: 696e 676c 655f 736c 6963 653e 2069 7320  ingle_slice> is 
+00011340: 5472 7565 2c20 7468 6520 6365 6e74 7261  True, the centra
+00011350: 6c20 736c 6963 6520 6f66 2074 6865 2052  l slice of the R
+00011360: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+00011370: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+00011380: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00011390: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000113a0: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+000113b0: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+000113c0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+000113d0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+000113e0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
+000113f0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
+00011400: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+00011410: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00011420: 7468 6520 524f 4920 7769 6c6c 2062 6520  the ROI will be 
+00011430: 7573 6564 2e0a 0a20 2020 2020 2020 206d  used...        m
+00011440: 6574 686f 6420 3a20 7374 722c 2064 6566  ethod : str, def
+00011450: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00011460: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
+00011470: 7573 6520 666f 7220 6578 7465 6e74 2063  use for extent c
+00011480: 616c 6375 6c61 7469 6f6e 2e20 4361 6e20  alculation. Can 
+00011490: 6265 3a20 0a0a 2020 2020 2020 2020 2020  be: ..          
+000114a0: 2020 2020 2020 2a20 2263 6f6e 746f 7572        * "contour
+000114b0: 223a 2067 6574 2065 7874 656e 7420 6672  ": get extent fr
+000114c0: 6f6d 206d 696e 2f6d 6178 2070 6f73 6974  om min/max posit
+000114d0: 696f 6e73 206f 6620 636f 6e74 6f75 7228  ions of contour(
+000114e0: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
+000114f0: 2020 2020 2a20 226d 6173 6b22 3a20 6765      * "mask": ge
+00011500: 7420 6578 7465 6e74 2066 726f 6d20 6d69  t extent from mi
+00011510: 6e2f 6d61 7820 706f 7369 7469 6f6e 7320  n/max positions 
+00011520: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
+00011530: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011540: 2020 2020 6269 6e61 7279 206d 6173 6b2e      binary mask.
+00011550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011560: 202a 204e 6f6e 653a 2075 7365 2074 6865   * None: use the
+00011570: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
+00011580: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+00011590: 5f6d 6574 686f 642e 0a0a 2020 2020 2020  _method...      
+000115a0: 2020 6f72 6967 696e 203a 2069 6e74 2f66    origin : int/f
+000115b0: 6c6f 6174 2f74 7570 6c65 2c20 6465 6661  loat/tuple, defa
+000115c0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000115d0: 2020 2020 2050 6f69 6e74 2077 6974 6820       Point with 
+000115e0: 7265 7370 6563 7420 746f 2077 6869 6368  respect to which
+000115f0: 2065 7874 656e 7473 2061 7265 2074 6f20   extents are to 
+00011600: 6265 2064 6574 6572 6d69 6e65 642e 0a20  be determined.. 
+00011610: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+00011620: 6361 6e20 6265 2061 6e20 696e 7465 6765  can be an intege
+00011630: 7220 6f72 2066 6c6f 6174 2073 7065 6369  r or float speci
+00011640: 6679 696e 6720 7468 6520 706f 696e 7427  fying the point'
+00011650: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
+00011660: 6f72 6469 6e61 7465 2061 6c6f 6e67 2061  ordinate along a
+00011670: 7869 7320 3c61 783e 3b20 6f72 2069 7420  xis <ax>; or it 
+00011680: 6361 6e20 6265 2061 2074 7570 6c65 2073  can be a tuple s
+00011690: 7065 6369 6679 696e 670a 2020 2020 2020  pecifying.      
+000116a0: 2020 2020 2020 7468 6520 706f 696e 7427        the point'
+000116b0: 7320 2878 2c20 792c 207a 2920 636f 6f72  s (x, y, z) coor
+000116c0: 6469 6e61 7465 732c 2077 6865 7265 206f  dinates, where o
+000116d0: 6e6c 7920 7468 6520 636f 6f72 6469 6e61  nly the coordina
+000116e0: 7465 0a20 2020 2020 2020 2020 2020 2061  te.            a
+000116f0: 6c6f 6e67 2061 7869 7320 3c61 783e 2077  long axis <ax> w
+00011700: 696c 6c20 6265 2063 6f6e 7369 6465 7265  ill be considere
+00011710: 642e 2020 4966 204e 6f6e 652c 2074 6865  d.  If None, the
+00011720: 206f 7269 6769 6e0a 2020 2020 2020 2020   origin.        
+00011730: 2020 2020 636f 6f72 6469 6e61 7465 2069      coordinate i
+00011740: 7320 7461 6b65 6e20 746f 2062 6520 302e  s taken to be 0.
+00011750: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00011760: 2020 2020 2020 2320 4765 7420 6465 6661        # Get defa
+00011770: 756c 7420 736c 6963 6520 616e 6420 6d65  ult slice and me
+00011780: 7468 6f64 0a20 2020 2020 2020 2073 656c  thod.        sel
+00011790: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+000117a0: 2069 6620 6d65 7468 6f64 2069 7320 4e6f   if method is No
+000117b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000117c0: 6d65 7468 6f64 203d 2073 656c 662e 6465  method = self.de
+000117d0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+000117e0: 640a 2020 2020 2020 2020 6966 2073 696e  d.        if sin
+000117f0: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
+00011800: 2020 2020 2020 2069 6620 6964 7820 6973         if idx is
+00011810: 204e 6f6e 6520 616e 6420 736c 2069 7320   None and sl is 
+00011820: 4e6f 6e65 2061 6e64 2070 6f73 2069 7320  None and pos is 
+00011830: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00011840: 2020 2020 2020 6964 7820 3d20 7365 6c66        idx = self
+00011850: 2e67 6574 5f6d 6964 5f69 6478 2829 0a0a  .get_mid_idx()..
+00011860: 2020 2020 2020 2020 2320 4966 2075 7369          # If usi
+00011870: 6e67 2073 696e 676c 6520 736c 6963 652c  ng single slice,
+00011880: 2063 6865 636b 2074 6865 2061 7869 7320   check the axis 
+00011890: 6c69 6573 2061 6c6f 6e67 2074 6865 2073  lies along the s
+000118a0: 6c69 6365 0a20 2020 2020 2020 2069 5f61  lice.        i_a
+000118b0: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
+000118c0: 6178 6573 2e69 6e64 6578 2861 7829 2069  axes.index(ax) i
+000118d0: 6620 6973 696e 7374 616e 6365 2861 782c  f isinstance(ax,
+000118e0: 2073 7472 2920 656c 7365 2061 780a 2020   str) else ax.  
+000118f0: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
+00011900: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
+00011910: 2020 2069 6620 695f 6178 206e 6f74 2069     if i_ax not i
+00011920: 6e20 736b 7274 2e69 6d61 6765 2e5f 706c  n skrt.image._pl
+00011930: 6f74 5f61 7865 735b 7669 6577 5d3a 0a20  ot_axes[view]:. 
+00011940: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00011950: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+00011960: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00011970: 2020 2020 2020 2066 2243 616e 6e6f 7420         f"Cannot 
+00011980: 636f 6d70 7574 6520 6578 7465 6e74 206f  compute extent o
+00011990: 6620 6178 6973 207b 6178 7d20 696e 2074  f axis {ax} in t
+000119a0: 6865 207b 7669 6577 7d20 706c 616e 6521  he {view} plane!
+000119b0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+000119c0: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
+000119d0: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+000119e0: 5d2e 696e 6465 7828 695f 6178 290a 0a20  ].index(i_ax).. 
+000119f0: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
+00011a00: 7468 6174 206f 7269 6769 6e20 6973 2061  that origin is a
+00011a10: 2073 696e 676c 6520 6e75 6d65 7269 6320   single numeric 
+00011a20: 7661 6c75 652e 0a20 2020 2020 2020 206f  value..        o
+00011a30: 7269 6769 6e20 3d20 6f72 6967 696e 206f  rigin = origin o
+00011a40: 7220 300a 2020 2020 2020 2020 6966 206e  r 0.        if n
+00011a50: 6f74 2069 7369 6e73 7461 6e63 6528 6f72  ot isinstance(or
+00011a60: 6967 696e 2c20 2866 6c6f 6174 2c20 696e  igin, (float, in
+00011a70: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
+00011a80: 206f 7269 6769 6e20 3d20 6f72 6967 696e   origin = origin
+00011a90: 5b69 5f61 785d 0a0a 2020 2020 2020 2020  [i_ax]..        
+00011aa0: 2320 4361 6c63 756c 6174 6520 6578 7465  # Calculate exte
+00011ab0: 6e74 2066 726f 6d20 636f 6e74 6f75 7273  nt from contours
+00011ac0: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
+00011ad0: 6f64 203d 3d20 2263 6f6e 746f 7572 223a  od == "contour":
+00011ae0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00011af0: 4361 6c63 756c 6174 6520 6675 6c6c 207a  Calculate full z
+00011b00: 2065 7874 656e 7420 6672 6f6d 2063 6f6e   extent from con
+00011b10: 746f 7572 2070 6f73 6974 696f 6e73 0a20  tour positions. 
+00011b20: 2020 2020 2020 2020 2020 2069 6620 2861             if (a
+00011b30: 7820 3d3d 2022 7a22 206f 7220 6178 203d  x == "z" or ax =
+00011b40: 3d20 3229 2061 6e64 206e 6f74 2073 696e  = 2) and not sin
+00011b50: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
+00011b60: 2020 2020 2020 2020 2020 207a 5f6b 6579             z_key
+00011b70: 7320 3d20 6c69 7374 2873 656c 662e 6765  s = list(self.ge
+00011b80: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
+00011b90: 292e 6b65 7973 2829 290a 2020 2020 2020  ).keys()).      
+00011ba0: 2020 2020 2020 2020 2020 767a 203d 2073            vz = s
+00011bb0: 656c 662e 6765 745f 736c 6963 655f 7468  elf.get_slice_th
+00011bc0: 6963 6b6e 6573 735f 636f 6e74 6f75 7273  ickness_contours
+00011bd0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00011be0: 2020 2069 6620 7a5f 6b65 7973 3a0a 2020     if z_keys:.  
+00011bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c00: 2020 7a5f 6d61 7820 3d20 6d61 7828 7a5f    z_max = max(z_
+00011c10: 6b65 7973 2920 2b20 2076 7a20 2f20 320a  keys) +  vz / 2.
+00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c30: 2020 2020 7a5f 6d69 6e20 3d20 6d69 6e28      z_min = min(
+00011c40: 7a5f 6b65 7973 2920 2d20 767a 202f 2032  z_keys) - vz / 2
+00011c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011c60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011c70: 2020 2020 2020 2020 2020 207a 5f6d 696e             z_min
+00011c80: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00011c90: 2020 2020 2020 2020 2020 2020 7a5f 6d61              z_ma
+00011ca0: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
+00011cb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011cc0: 5b7a 5f6d 696e 2c20 7a5f 6d61 785d 0a0a  [z_min, z_max]..
+00011cd0: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
+00011ce0: 6865 7277 6973 652c 2063 616c 6375 6c61  herwise, calcula
+00011cf0: 7465 2065 7874 656e 7420 6672 6f6d 206d  te extent from m
+00011d00: 696e 2f6d 6178 2063 6f6e 746f 7572 2070  in/max contour p
+00011d10: 6f73 6974 696f 6e73 200a 2020 2020 2020  ositions .      
+00011d20: 2020 2020 2020 706f 696e 7473 203d 205b        points = [
+00011d30: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+00011d40: 2047 6c6f 6261 6c3a 2075 7365 2065 7665   Global: use eve
+00011d50: 7279 2063 6f6e 746f 7572 0a20 2020 2020  ry contour.     
+00011d60: 2020 2020 2020 2069 6620 6e6f 7420 7369         if not si
+00011d70: 6e67 6c65 5f73 6c69 6365 3a0a 2020 2020  ngle_slice:.    
+00011d80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00011d90: 692c 2063 6f6e 746f 7572 7320 696e 2073  i, contours in s
+00011da0: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
+00011db0: 2822 782d 7922 292e 6974 656d 7328 293a  ("x-y").items():
+00011dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011dd0: 2020 2020 2066 6f72 2063 6f6e 746f 7572       for contour
+00011de0: 2069 6e20 636f 6e74 6f75 7273 3a0a 2020   in contours:.  
+00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e00: 2020 2020 2020 706f 696e 7473 2e65 7874        points.ext
+00011e10: 656e 6428 5b70 5b69 5f61 785d 2066 6f72  end([p[i_ax] for
+00011e20: 2070 2069 6e20 636f 6e74 6f75 725d 290a   p in contour]).
+00011e30: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00011e40: 696e 676c 6520 736c 6963 653a 206a 7573  ingle slice: jus
+00011e50: 7420 7573 6520 7468 6520 636f 6e74 6f75  t use the contou
+00011e60: 7220 6f6e 2074 6865 2073 6c69 6365 0a20  r on the slice. 
+00011e70: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011e90: 2066 6f72 2063 6f6e 746f 7572 2069 6e20   for contour in 
+00011ea0: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
+00011eb0: 735f 6f6e 5f73 6c69 6365 280a 2020 2020  s_on_slice(.    
+00011ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ed0: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
+00011ee0: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
+00011ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f00: 2020 2020 706f 696e 7473 2e65 7874 656e      points.exten
+00011f10: 6428 5b70 5b69 5f61 785d 2066 6f72 2070  d([p[i_ax] for p
+00011f20: 2069 6e20 636f 6e74 6f75 725d 290a 0a20   in contour]).. 
+00011f30: 2020 2020 2020 2020 2020 2023 2052 6574             # Ret
+00011f40: 7572 6e20 6d69 6e20 616e 6420 6d61 7820  urn min and max 
+00011f50: 6f66 2074 6865 2070 6f69 6e74 7320 696e  of the points in
+00011f60: 2074 6865 2063 6f6e 746f 7572 2873 290a   the contour(s).
+00011f70: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00011f80: 656e 2870 6f69 6e74 7329 3a0a 2020 2020  en(points):.    
+00011f90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00011fa0: 726e 205b 6d69 6e28 706f 696e 7473 2920  rn [min(points) 
+00011fb0: 2d20 6f72 6967 696e 2c20 6d61 7828 706f  - origin, max(po
+00011fc0: 696e 7473 2920 2d20 6f72 6967 696e 5d0a  ints) - origin].
+00011fd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00011fe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011ff0: 2020 7265 7475 726e 205b 4e6f 6e65 2c20    return [None, 
+00012000: 4e6f 6e65 5d0a 0a20 2020 2020 2020 2023  None]..        #
+00012010: 204f 7468 6572 7769 7365 2c20 6765 7420   Otherwise, get 
+00012020: 6578 7465 6e74 2066 726f 6d20 6d61 736b  extent from mask
+00012030: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
+00012040: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
+00012050: 2020 2020 6966 2069 5f61 7820 213d 2032      if i_ax != 2
+00012060: 3a20 2023 2054 7261 6e73 706f 7365 2078  :  # Transpose x
+00012070: 2d79 2061 7865 730a 2020 2020 2020 2020  -y axes.        
+00012080: 2020 2020 695f 6178 203d 2031 202d 2069      i_ax = 1 - i
+00012090: 5f61 780a 0a20 2020 2020 2020 2023 2047  _ax..        # G
+000120a0: 6574 2070 6f73 6974 696f 6e73 206f 6620  et positions of 
+000120b0: 766f 7865 6c73 2069 6e73 6964 6520 7468  voxels inside th
+000120c0: 6520 6d61 736b 0a20 2020 2020 2020 2069  e mask.        i
+000120d0: 6620 6e6f 7420 7369 6e67 6c65 5f73 6c69  f not single_sli
+000120e0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000120f0: 6e6f 6e7a 6572 6f20 3d20 6e70 2e61 7267  nonzero = np.arg
+00012100: 7768 6572 6528 7365 6c66 2e67 6574 5f6d  where(self.get_m
+00012110: 6173 6b28 7374 616e 6461 7264 6973 653d  ask(standardise=
+00012120: 5472 7565 2929 0a20 2020 2020 2020 2065  True)).        e
+00012130: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012140: 206e 6f6e 7a65 726f 203d 206e 702e 6172   nonzero = np.ar
+00012150: 6777 6865 7265 2873 656c 662e 6765 745f  gwhere(self.get_
+00012160: 736c 6963 6528 0a20 2020 2020 2020 2020  slice(.         
+00012170: 2020 2020 2020 2076 6965 772c 2073 6c3d         view, sl=
+00012180: 736c 2c20 6964 783d 6964 782c 2070 6f73  sl, idx=idx, pos
+00012190: 3d70 6f73 2929 0a20 2020 2020 2020 2076  =pos)).        v
+000121a0: 616c 7320 3d20 6e6f 6e7a 6572 6f5b 3a2c  als = nonzero[:,
+000121b0: 2069 5f61 785d 0a20 2020 2020 2020 2069   i_ax].        i
+000121c0: 6620 6e6f 7420 6c65 6e28 7661 6c73 293a  f not len(vals):
+000121d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000121e0: 7572 6e20 5b4e 6f6e 652c 204e 6f6e 655d  urn [None, None]
+000121f0: 0a0a 2020 2020 2020 2020 2320 4669 6e64  ..        # Find
+00012200: 206d 696e 2061 6e64 206d 6178 2076 6f78   min and max vox
+00012210: 656c 733b 2061 6464 2068 616c 6620 6120  els; add half a 
+00012220: 766f 7865 6c20 6569 7468 6572 2073 6964  voxel either sid
+00012230: 6520 746f 2067 6574 200a 2020 2020 2020  e to get .      
+00012240: 2020 2320 6675 6c6c 2065 7874 656e 740a    # full extent.
+00012250: 2020 2020 2020 2020 6d69 6e5f 706f 7320          min_pos 
+00012260: 3d20 6d69 6e28 7661 6c73 2920 2d20 302e  = min(vals) - 0.
+00012270: 350a 2020 2020 2020 2020 6d61 785f 706f  5.        max_po
+00012280: 7320 3d20 6d61 7828 7661 6c73 2920 2b20  s = max(vals) + 
+00012290: 302e 350a 0a20 2020 2020 2020 2023 2043  0.5..        # C
+000122a0: 6f6e 7665 7274 2070 6f73 6974 696f 6e73  onvert positions
+000122b0: 2074 6f20 6d6d 0a20 2020 2020 2020 2072   to mm.        r
+000122c0: 6574 7572 6e20 5b73 656c 662e 6964 785f  eturn [self.idx_
+000122d0: 746f 5f70 6f73 286d 696e 5f70 6f73 2c20  to_pos(min_pos, 
+000122e0: 6178 2920 2d20 6f72 6967 696e 2c0a 2020  ax) - origin,.  
+000122f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00012300: 6c66 2e69 6478 5f74 6f5f 706f 7328 6d61  lf.idx_to_pos(ma
+00012310: 785f 706f 732c 2061 7829 202d 206f 7269  x_pos, ax) - ori
+00012320: 6769 6e5d 0a0a 2020 2020 6465 6620 6765  gin]..    def ge
+00012330: 745f 6372 6f70 5f6c 696d 6974 7328 7365  t_crop_limits(se
+00012340: 6c66 2c20 6372 6f70 5f6d 6172 6769 6e73  lf, crop_margins
+00012350: 3d4e 6f6e 652c 206d 6574 686f 643d 4e6f  =None, method=No
+00012360: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00012370: 0a20 2020 2020 2020 2047 6574 2063 726f  .        Get cro
+00012380: 7020 6c69 6d69 7473 2063 6f72 7265 7370  p limits corresp
+00012390: 6f6e 6469 6e67 2074 6f20 524f 4920 6578  onding to ROI ex
+000123a0: 7465 6e74 7320 706c 7573 206d 6172 6769  tents plus margi
+000123b0: 6e73 2e0a 0a20 2020 2020 2020 2054 6865  ns...        The
+000123c0: 2074 7570 6c65 7320 6f66 206c 696d 6974   tuples of limit
+000123d0: 7320 7265 7475 726e 6564 2c20 696e 2074  s returned, in t
+000123e0: 6865 206f 7264 6572 2028 782c 2079 2c20  he order (x, y, 
+000123f0: 7a29 2063 616e 0a20 2020 2020 2020 2062  z) can.        b
+00012400: 6520 7573 6564 2c20 666f 7220 6578 616d  e used, for exam
+00012410: 706c 652c 2061 7320 696e 7075 7473 2074  ple, as inputs t
+00012420: 6f20 736b 7274 2e69 6d61 6765 2e49 6d61  o skrt.image.Ima
+00012430: 6765 2e63 726f 7028 292e 0a0a 2020 2020  ge.crop()...    
+00012440: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
+00012450: 6973 2073 696d 696c 6172 2074 6f20 7468  is similar to th
+00012460: 6520 6d65 7468 6f64 2067 6574 5f65 7874  e method get_ext
+00012470: 656e 7473 2829 2c20 6275 7420 616c 6c6f  ents(), but allo
+00012480: 7773 0a20 2020 2020 2020 2064 6966 6665  ws.        diffe
+00012490: 7265 6e74 206d 6172 6769 6e73 206f 6e20  rent margins on 
+000124a0: 6561 6368 2073 6964 6520 6f66 2074 6865  each side of the
+000124b0: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
+000124c0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
+000124d0: 2020 2020 2020 2020 6372 6f70 5f6d 6172          crop_mar
+000124e0: 6769 6e73 203a 2066 6c6f 6174 2f74 7570  gins : float/tup
+000124f0: 6c65 2c20 6465 6661 756c 743d 4e6f 6e65  le, default=None
+00012500: 0a20 2020 2020 2020 2020 2020 2046 6c6f  .            Flo
+00012510: 6174 206f 7220 7468 7265 652d 656c 656d  at or three-elem
+00012520: 656e 7420 7475 706c 6520 7370 6563 6966  ent tuple specif
+00012530: 7969 6e67 2074 6865 206d 6172 6769 6e73  ying the margins
+00012540: 2c20 696e 206d 6d2c 0a20 2020 2020 2020  , in mm,.       
+00012550: 2020 2020 2074 6f20 6265 2061 6464 6564       to be added
+00012560: 2074 6f20 524f 4920 6578 7465 6e74 732e   to ROI extents.
+00012570: 2020 4966 2061 2066 6c6f 6174 2c20 6d69    If a float, mi
+00012580: 6e75 7320 616e 6420 706c 7573 2074 6865  nus and plus the
+00012590: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+000125a0: 7565 2073 7065 6369 6669 6564 2061 7265  ue specified are
+000125b0: 2061 6464 6564 2074 6f20 6c6f 7765 7220   added to lower 
+000125c0: 616e 6420 7570 7065 7220 6578 7465 6e74  and upper extent
+000125d0: 7320 7265 7370 6563 7469 7665 6c79 0a20  s respectively. 
+000125e0: 2020 2020 2020 2020 2020 2061 6c6f 6e67             along
+000125f0: 2065 6163 6820 6178 6973 2e20 2049 6620   each axis.  If 
+00012600: 6120 7468 7265 652d 656c 656d 656e 7420  a three-element 
+00012610: 7475 706c 652c 2065 6c65 6d65 6e74 7320  tuple, elements 
+00012620: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+00012630: 7461 6b65 6e20 746f 2073 7065 6369 6679  taken to specify
+00012640: 206d 6172 6769 6e73 2069 6e20 7468 6520   margins in the 
+00012650: 6f72 6465 7220 2878 2c20 792c 207a 292e  order (x, y, z).
+00012660: 2020 456c 656d 656e 7473 0a20 2020 2020    Elements.     
+00012670: 2020 2020 2020 2063 616e 2062 6520 6569         can be ei
+00012680: 7468 6572 2066 6c6f 6174 7320 286d 696e  ther floats (min
+00012690: 7573 2061 6e64 2070 6c75 7320 7468 6520  us and plus the 
+000126a0: 7661 6c75 6520 6164 6465 6420 7265 7370  value added resp
+000126b0: 6563 7469 7665 6c79 0a20 2020 2020 2020  ectively.       
+000126c0: 2020 2020 2074 6f20 6c6f 7765 7220 616e       to lower an
+000126d0: 6420 7570 7065 7220 6578 7465 6e74 7329  d upper extents)
+000126e0: 206f 7220 7477 6f2d 656c 656d 656e 7420   or two-element 
+000126f0: 7475 706c 6573 2028 656c 656d 656e 7473  tuples (elements
+00012700: 2030 2061 6e64 2031 0a20 2020 2020 2020   0 and 1.       
+00012710: 2020 2020 2061 6464 6564 2072 6573 7065       added respe
+00012720: 6374 6976 656c 7920 746f 206c 6f77 6572  ctively to lower
+00012730: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
+00012740: 7473 292e 0a0a 2020 2020 2020 2020 6d65  ts)...        me
+00012750: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
+00012760: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00012770: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
+00012780: 7365 2066 6f72 2065 7874 656e 7420 6361  se for extent ca
+00012790: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
+000127a0: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+000127b0: 2020 2020 2a20 2263 6f6e 746f 7572 223a      * "contour":
+000127c0: 2067 6574 2065 7874 656e 7420 6672 6f6d   get extent from
+000127d0: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
+000127e0: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
+000127f0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012800: 2020 2a20 226d 6173 6b22 3a20 6765 7420    * "mask": get 
+00012810: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
+00012820: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
+00012830: 2076 6f78 656c 7320 696e 2074 6865 0a20   voxels in the. 
+00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012850: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
+00012860: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00012870: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+00012880: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+00012890: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+000128a0: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
+000128b0: 220a 2020 2020 2020 2020 6372 6f70 5f6c  ".        crop_l
+000128c0: 696d 6974 7320 3d20 7365 6c66 2e67 6574  imits = self.get
+000128d0: 5f65 7874 656e 7473 286d 6574 686f 643d  _extents(method=
+000128e0: 6d65 7468 6f64 290a 2020 2020 2020 2020  method).        
+000128f0: 6d61 7267 696e 7320 3d20 736b 7274 2e69  margins = skrt.i
+00012900: 6d61 6765 2e63 6865 636b 6564 5f63 726f  mage.checked_cro
+00012910: 705f 6c69 6d69 7473 2863 726f 705f 6d61  p_limits(crop_ma
+00012920: 7267 696e 7329 0a20 2020 2020 2020 2066  rgins).        f
+00012930: 6f72 2069 6478 3120 696e 2072 616e 6765  or idx1 in range
+00012940: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
+00012950: 2069 6620 6d61 7267 696e 735b 6964 7831   if margins[idx1
+00012960: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
+00012970: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00012980: 6f72 2069 6478 3220 696e 2072 616e 6765  or idx2 in range
+00012990: 2832 293a 0a20 2020 2020 2020 2020 2020  (2):.           
+000129a0: 2020 2020 2020 2020 2063 726f 705f 6c69           crop_li
+000129b0: 6d69 7473 5b69 6478 315d 5b69 6478 325d  mits[idx1][idx2]
+000129c0: 202b 3d20 6d61 7267 696e 735b 6964 7831   += margins[idx1
+000129d0: 5d5b 6964 7832 5d0a 0a20 2020 2020 2020  ][idx2]..       
+000129e0: 2072 6574 7572 6e20 6372 6f70 5f6c 696d   return crop_lim
+000129f0: 6974 730a 0a20 2020 2064 6566 2067 6574  its..    def get
+00012a00: 5f6c 656e 6774 6828 0a20 2020 2020 2020  _length(.       
+00012a10: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
+00012a20: 6178 3d22 7a22 2c20 0a20 2020 2020 2020  ax="z", .       
+00012a30: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
+00012a40: 6c73 652c 0a20 2020 2020 2020 2076 6965  lse,.        vie
+00012a50: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
+00012a60: 2073 6c3d 4e6f 6e65 2c20 0a20 2020 2020   sl=None, .     
+00012a70: 2020 2069 6478 3d4e 6f6e 652c 200a 2020     idx=None, .  
+00012a80: 2020 2020 2020 706f 733d 4e6f 6e65 2c20        pos=None, 
+00012a90: 0a20 2020 2020 2020 2075 6e69 7473 3d22  .        units="
+00012aa0: 6d6d 222c 0a20 2020 2020 2020 206d 6574  mm",.        met
+00012ab0: 686f 643d 4e6f 6e65 2c20 0a20 2020 2020  hod=None, .     
+00012ac0: 2020 2066 6f72 6365 3d54 7275 650a 2020     force=True.  
+00012ad0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00012ae0: 4765 7420 524f 4920 6c65 6e67 7468 2061  Get ROI length a
+00012af0: 6c6f 6e67 2061 2067 6976 656e 2061 7869  long a given axi
+00012b00: 732e 2049 6620 7369 6e67 6c65 5f73 6c69  s. If single_sli
+00012b10: 6365 3d46 616c 7365 2028 692e 652e 2061  ce=False (i.e. a
+00012b20: 200a 2020 2020 2020 2020 676c 6f62 616c   .        global
+00012b30: 206c 656e 6774 6820 6973 2072 6571 7565   length is reque
+00012b40: 7374 6564 292c 2063 616c 6375 6c61 7465  sted), calculate
+00012b50: 6420 6c65 6e67 7468 2077 696c 6c20 6265  d length will be
+00012b60: 2063 6163 6865 6420 696e 200a 2020 2020   cached in .    
+00012b70: 2020 2020 7365 6c66 2e5f 6c65 6e67 7468      self._length
+00012b80: 5b61 785d 5b75 6e69 7473 5d20 616e 6420  [ax][units] and 
+00012b90: 7265 7475 726e 6564 2069 6620 6361 6c6c  returned if call
+00012ba0: 6564 2061 6761 696e 2c20 756e 6c65 7373  ed again, unless
+00012bb0: 2066 6f72 6365 3d54 7275 652e 0a0a 2020   force=True...  
+00012bc0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+00012bd0: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
+00012be0: 2020 2020 2020 2061 7820 3a20 7374 722f         ax : str/
+00012bf0: 696e 742c 2064 6566 6175 6c74 3d22 7a22  int, default="z"
+00012c00: 0a20 2020 2020 2020 2020 2020 2041 7869  .            Axi
+00012c10: 7320 616c 6f6e 6720 7768 6963 6820 746f  s along which to
+00012c20: 2072 6574 7572 6e20 6c65 6e67 7468 3b20   return length; 
+00012c30: 7368 6f75 6c64 2062 6520 6f6e 6520 6f66  should be one of
+00012c40: 205b 2278 222c 2022 7922 2c20 227a 225d   ["x", "y", "z"]
+00012c50: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00012c60: 5b30 2c20 312c 2032 5d2e 0a0a 2020 2020  [0, 1, 2]...    
+00012c70: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
+00012c80: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00012c90: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+00012ca0: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
+00012cb0: 206c 656e 6774 6820 6f66 2074 6865 2065   length of the e
+00012cc0: 6e74 6972 6520 524f 4920 7769 6c6c 2062  ntire ROI will b
+00012cd0: 6520 7265 7475 726e 6564 3b0a 2020 2020  e returned;.    
+00012ce0: 2020 2020 2020 2020 6f74 6865 7277 6973          otherwis
+00012cf0: 652c 2074 6865 206c 656e 6774 6820 6f6e  e, the length on
+00012d00: 2061 2073 696e 676c 6520 736c 6963 6520   a single slice 
+00012d10: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+00012d20: 2e0a 0a20 2020 2020 2020 2076 6965 7720  ...        view 
+00012d30: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
+00012d40: 782d 7922 0a20 2020 2020 2020 2020 2020  x-y".           
+00012d50: 204f 7269 656e 7461 7469 6f6e 206f 6620   Orientation of 
+00012d60: 736c 6963 6520 6f6e 2077 6869 6368 2074  slice on which t
+00012d70: 6f20 6765 7420 6c65 6e67 7468 2e20 4f6e  o get length. On
+00012d80: 6c79 2075 7365 6420 6966 200a 2020 2020  ly used if .    
+00012d90: 2020 2020 2020 2020 7369 6e67 6c65 5f73          single_s
+00012da0: 6c69 6365 3d54 7275 652e 2049 6620 7573  lice=True. If us
+00012db0: 696e 672c 203c 6178 3e20 6d75 7374 2062  ing, <ax> must b
+00012dc0: 6520 616e 2061 7869 7320 7468 6174 206c  e an axis that l
+00012dd0: 6965 7320 616c 6f6e 670a 2020 2020 2020  ies along.      
+00012de0: 2020 2020 2020 7468 6520 736c 6963 6520        the slice 
+00012df0: 696e 2074 6869 7320 6f72 6965 6e74 6174  in this orientat
+00012e00: 696f 6e2e 0a0a 2020 2020 2020 2020 736c  ion...        sl
+00012e10: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
+00012e20: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00012e30: 2053 6c69 6365 206e 756d 6265 722e 2049   Slice number. I
+00012e40: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
+00012e50: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
+00012e60: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
+00012e70: 2020 2020 2020 2020 2020 2020 3c73 696e              <sin
+00012e80: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
+00012e90: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
+00012ea0: 736c 6963 6520 6f66 2074 6865 2052 4f49  slice of the ROI
+00012eb0: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+00012ec0: 2020 2020 2020 2020 6964 7820 3a20 696e          idx : in
+00012ed0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00012ee0: 2020 2020 2020 2020 2020 2020 4172 7261              Arra
+00012ef0: 7920 696e 6465 7820 6f66 2073 6c69 6365  y index of slice
+00012f00: 2e20 4966 206e 6f6e 6520 6f66 203c 736c  . If none of <sl
+00012f10: 3e2c 203c 6964 783e 206f 7220 3c70 6f73  >, <idx> or <pos
+00012f20: 3e20 6172 6520 7375 7070 6c69 6564 2062  > are supplied b
+00012f30: 7574 0a20 2020 2020 2020 2020 2020 203c  ut.            <
+00012f40: 7369 6e67 6c65 5f73 6c69 6365 3e20 6973  single_slice> is
+00012f50: 2054 7275 652c 2074 6865 2063 656e 7472   True, the centr
+00012f60: 616c 2073 6c69 6365 206f 6620 7468 6520  al slice of the 
+00012f70: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
+00012f80: 2e0a 0a20 2020 2020 2020 2070 6f73 203a  ...        pos :
+00012f90: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
+00012fa0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00012fb0: 2053 6c69 6365 2070 6f73 6974 696f 6e20   Slice position 
+00012fc0: 696e 206d 6d2e 2049 6620 6e6f 6e65 206f  in mm. If none o
+00012fd0: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
+00012fe0: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
+00012ff0: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
+00013000: 2020 2020 3c73 696e 676c 655f 736c 6963      <single_slic
+00013010: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
+00013020: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
+00013030: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
+00013040: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00013050: 756e 6974 7320 3a20 7374 722c 2064 6566  units : str, def
+00013060: 6175 6c74 3d22 6d6d 220a 2020 2020 2020  ault="mm".      
+00013070: 2020 2020 2020 556e 6974 7320 6f66 206c        Units of l
+00013080: 656e 6774 682e 2043 616e 2062 6520 6569  ength. Can be ei
+00013090: 7468 6572 206f 663a 0a20 2020 2020 2020  ther of:.       
+000130a0: 2020 2020 2020 2020 202d 2022 6d6d 223a           - "mm":
+000130b0: 2072 6574 7572 6e20 6c65 6e67 7468 2069   return length i
+000130c0: 6e20 6d69 6c6c 696d 6574 7265 732e 0a20  n millimetres.. 
+000130d0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+000130e0: 2022 766f 7865 6c73 223a 2072 6574 7572   "voxels": retur
+000130f0: 6e20 6c65 6e67 7468 2069 6e20 6e75 6d62  n length in numb
+00013100: 6572 206f 6620 766f 7865 6c73 2e0a 0a20  er of voxels... 
+00013110: 2020 2020 2020 2020 2020 2049 6620 756e             If un
+00013120: 6974 733d 2276 6f78 656c 7322 2069 7320  its="voxels" is 
+00013130: 7265 7175 6573 7465 6420 6275 7420 7468  requested but th
+00013140: 6973 2052 4f49 206f 6e6c 7920 6861 7320  is ROI only has 
+00013150: 636f 6e74 6f75 7273 2061 6e64 206e 6f0a  contours and no.
+00013160: 2020 2020 2020 2020 2020 2020 766f 7865              voxe
+00013170: 6c20 7369 7a65 2069 6e66 6f72 6d61 7469  l size informati
+00013180: 6f6e 2c20 616e 2065 7272 6f72 2077 696c  on, an error wil
+00013190: 6c20 6265 2072 6169 7365 6420 2875 6e6c  l be raised (unl
+000131a0: 6573 7320 6178 3d22 7a22 2c20 0a20 2020  ess ax="z", .   
+000131b0: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
+000131c0: 6820 6361 7365 2076 6f78 656c 2073 697a  h case voxel siz
+000131d0: 6520 7769 6c6c 2062 6520 696e 6665 7272  e will be inferr
+000131e0: 6564 2066 726f 6d20 7370 6163 696e 6720  ed from spacing 
+000131f0: 6265 7477 6565 6e0a 2020 2020 2020 2020  between.        
+00013200: 2020 2020 736c 6963 6573 292e 0a0a 2020      slices)...  
+00013210: 2020 2020 2020 6d65 7468 6f64 203a 2073        method : s
+00013220: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
+00013230: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
+00013240: 686f 6420 746f 2075 7365 2066 6f72 206c  hod to use for l
+00013250: 656e 6774 6820 6361 6c63 756c 6174 696f  ength calculatio
+00013260: 6e2e 2043 616e 2062 653a 200a 2020 2020  n. Can be: .    
+00013270: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
+00013280: 6f6e 746f 7572 223a 2067 6574 206c 656e  ontour": get len
+00013290: 6774 6820 6672 6f6d 206d 696e 2f6d 6178  gth from min/max
+000132a0: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
+000132b0: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
+000132c0: 2020 2020 2020 2020 2020 2d20 226d 6173            - "mas
+000132d0: 6b22 3a20 6765 7420 6c65 6e67 7468 2066  k": get length f
+000132e0: 726f 6d20 6d69 6e2f 6d61 7820 706f 7369  rom min/max posi
+000132f0: 7469 6f6e 7320 6f66 2076 6f78 656c 7320  tions of voxels 
+00013300: 696e 2074 6865 200a 2020 2020 2020 2020  in the .        
+00013310: 2020 2020 2020 2020 2020 6269 6e61 7279            binary
+00013320: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
+00013330: 2020 2020 2020 202d 204e 6f6e 653a 2075         - None: u
+00013340: 7365 2074 6865 206d 6574 686f 6420 7365  se the method se
+00013350: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
+00013360: 745f 6765 6f6d 5f6d 6574 686f 642e 0a0a  t_geom_method...
+00013370: 2020 2020 2020 2020 666f 7263 6520 3a20          force : 
+00013380: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
+00013390: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+000133a0: 6620 5472 7565 2c20 7468 6520 6c65 6e67  f True, the leng
+000133b0: 7468 2077 696c 6c20 616c 7761 7973 2062  th will always b
+000133c0: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
+000133d0: 6f74 6865 7277 6973 652c 2069 7420 7769  otherwise, it wi
+000133e0: 6c6c 0a20 2020 2020 2020 2020 2020 206f  ll.            o
+000133f0: 6e6c 7920 6265 2063 616c 6375 6c61 7465  nly be calculate
+00013400: 6420 6966 2069 7420 6861 7320 6e6f 7420  d if it has not 
+00013410: 7965 7420 6265 656e 2063 6163 6865 6420  yet been cached 
+00013420: 696e 2073 656c 662e 5f76 6f6c 756d 652e  in self._volume.
+00013430: 0a20 2020 2020 2020 2020 2020 204e 6f74  .            Not
+00013440: 6520 7468 6174 2069 6620 7369 6e67 6c65  e that if single
+00013450: 5f73 6c69 6365 3d54 7275 652c 2074 6865  _slice=True, the
+00013460: 206c 656e 6774 6820 7769 6c6c 2061 6c77   length will alw
+00013470: 6179 7320 6265 200a 2020 2020 2020 2020  ays be .        
+00013480: 2020 2020 7265 6361 6c63 756c 6174 6564      recalculated
+00013490: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+000134a0: 2020 2020 2020 2023 2049 6620 676c 6f62         # If glob
+000134b0: 616c 206c 656e 6774 6820 616c 7265 6164  al length alread
+000134c0: 7920 6361 6368 6564 2c20 7265 7475 726e  y cached, return
+000134d0: 2063 6163 6865 6420 7661 6c75 650a 2020   cached value.  
+000134e0: 2020 2020 2020 6966 206e 6f74 2073 696e        if not sin
+000134f0: 676c 655f 736c 6963 6520 616e 6420 6e6f  gle_slice and no
+00013500: 7420 666f 7263 653a 0a20 2020 2020 2020  t force:.       
+00013510: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00013520: 7365 6c66 2c20 225f 6c65 6e67 7468 2229  self, "_length")
+00013530: 2061 6e64 2061 7820 696e 2073 656c 662e   and ax in self.
+00013540: 5f6c 656e 6774 6820 5c0a 2020 2020 2020  _length \.      
+00013550: 2020 2020 2020 2020 2061 6e64 2075 6e69           and uni
+00013560: 7473 2069 6e20 7365 6c66 2e5f 6c65 6e67  ts in self._leng
+00013570: 7468 5b61 785d 3a0a 2020 2020 2020 2020  th[ax]:.        
+00013580: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00013590: 656c 662e 5f6c 656e 6774 685b 6178 5d5b  elf._length[ax][
+000135a0: 756e 6974 735d 0a0a 2020 2020 2020 2020  units]..        
+000135b0: 2320 4966 2073 696e 676c 6520 736c 6963  # If single slic
+000135c0: 6520 7265 7175 6573 7465 6420 616e 6420  e requested and 
+000135d0: 6e6f 7420 6f6e 2063 7572 7265 6e74 2073  not on current s
+000135e0: 6c69 6365 2c20 7265 7475 726e 204e 6f6e  lice, return Non
+000135f0: 650a 2020 2020 2020 2020 6966 2073 696e  e.        if sin
+00013600: 676c 655f 736c 6963 6520 616e 6420 6e6f  gle_slice and no
+00013610: 7420 7365 6c66 2e6f 6e5f 736c 6963 6528  t self.on_slice(
+00013620: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
+00013630: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
+00013640: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013650: 726e 204e 6f6e 650a 0a20 2020 2020 2020  rn None..       
+00013660: 2023 2047 6574 206c 656e 6774 6820 696e   # Get length in
+00013670: 206d 6d20 6672 6f6d 206d 696e 2061 6e64   mm from min and
+00013680: 206d 6178 2070 6f73 6974 696f 6e73 0a20   max positions. 
+00013690: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+000136a0: 2829 0a20 2020 2020 2020 206d 696e 5f70  ().        min_p
+000136b0: 6f73 2c20 6d61 785f 706f 7320 3d20 7365  os, max_pos = se
+000136c0: 6c66 2e67 6574 5f65 7874 656e 7428 0a20  lf.get_extent(. 
+000136d0: 2020 2020 2020 2020 2020 2061 783d 6178             ax=ax
+000136e0: 2c20 0a20 2020 2020 2020 2020 2020 2073  , .            s
+000136f0: 696e 676c 655f 736c 6963 653d 7369 6e67  ingle_slice=sing
+00013700: 6c65 5f73 6c69 6365 2c0a 2020 2020 2020  le_slice,.      
+00013710: 2020 2020 2020 7669 6577 3d76 6965 772c        view=view,
+00013720: 0a20 2020 2020 2020 2020 2020 2073 6c3d  .            sl=
+00013730: 736c 2c0a 2020 2020 2020 2020 2020 2020  sl,.            
+00013740: 6964 783d 6964 782c 0a20 2020 2020 2020  idx=idx,.       
+00013750: 2020 2020 2070 6f73 3d70 6f73 2c0a 2020       pos=pos,.  
+00013760: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00013770: 3d6d 6574 686f 640a 2020 2020 2020 2020  =method.        
+00013780: 290a 2020 2020 2020 2020 6c65 6e67 7468  ).        length
+00013790: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+000137a0: 2022 6d6d 223a 2061 6273 286d 6178 5f70   "mm": abs(max_p
+000137b0: 6f73 202d 206d 696e 5f70 6f73 290a 2020  os - min_pos).  
+000137c0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+000137d0: 2023 2047 6574 206c 656e 6774 6820 696e   # Get length in
+000137e0: 2076 6f78 656c 730a 2020 2020 2020 2020   voxels.        
+000137f0: 2320 4361 7365 2077 6865 7265 2076 6f78  # Case where vox
+00013800: 656c 2073 697a 6520 6973 206b 6e6f 776e  el size is known
+00013810: 0a20 2020 2020 2020 2069 5f61 7820 3d20  .        i_ax = 
+00013820: 736b 7274 2e69 6d61 6765 2e5f 6178 6573  skrt.image._axes
+00013830: 2e69 6e64 6578 2861 7829 2069 6620 6973  .index(ax) if is
+00013840: 696e 7374 616e 6365 2861 782c 2073 7472  instance(ax, str
+00013850: 2920 656c 7365 2061 780a 2020 2020 2020  ) else ax.      
+00013860: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
+00013870: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+00013880: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
+00013890: 6e67 7468 5b22 766f 7865 6c73 225d 203d  ngth["voxels"] =
+000138a0: 206c 656e 6774 685b 226d 6d22 5d20 2f20   length["mm"] / 
+000138b0: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
+000138c0: 695f 6178 5d0a 0a20 2020 2020 2020 2023  i_ax]..        #
+000138d0: 2044 6561 6c20 7769 7468 2063 6173 6520   Deal with case 
+000138e0: 7768 6572 6520 7365 6c66 2e76 6f78 656c  where self.voxel
+000138f0: 5f73 697a 6520 6973 204e 6f6e 650a 2020  _size is None.  
+00013900: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00013910: 2020 2020 2020 2020 6966 2069 5f61 7820          if i_ax 
+00013920: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00013930: 2020 2020 2020 6c65 6e67 7468 5b22 766f        length["vo
+00013940: 7865 6c73 225d 203d 206c 656e 6774 685b  xels"] = length[
+00013950: 226d 6d22 5d20 2f20 7365 6c66 2e67 6574  "mm"] / self.get
+00013960: 5f73 6c69 6365 5f74 6869 636b 6e65 7373  _slice_thickness
+00013970: 5f63 6f6e 746f 7572 7328 290a 2020 2020  _contours().    
+00013980: 2020 2020 2020 2020 656c 6966 2075 6e69          elif uni
+00013990: 7473 203d 3d20 2276 6f78 656c 7322 3a0a  ts == "voxels":.
+000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139b0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+000139c0: 6f72 2822 4361 6e6e 6f74 2063 6f6d 7075  or("Cannot compu
+000139d0: 7465 206c 656e 6774 6820 696e 2076 6f78  te length in vox
+000139e0: 656c 7320 6672 6f6d 2022 0a20 2020 2020  els from ".     
+000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a00: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+00013a10: 6f6e 746f 7572 7320 7769 7468 6f75 7420  ontours without 
+00013a20: 6b6e 6f77 696e 6720 766f 7865 6c20 7369  knowing voxel si
+00013a30: 7a65 7321 2229 0a0a 2020 2020 2020 2020  zes!")..        
+00013a40: 0a20 2020 2020 2020 2023 2043 6163 6865  .        # Cache
+00013a50: 2074 6865 2070 726f 7065 7274 7920 6966   the property if
+00013a60: 2067 6c6f 6261 6c0a 2020 2020 2020 2020   global.        
+00013a70: 6966 206e 6f74 2073 696e 676c 655f 736c  if not single_sl
+00013a80: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+00013a90: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00013aa0: 7365 6c66 2c20 225f 6c65 6e67 7468 2229  self, "_length")
+00013ab0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013ac0: 2020 7365 6c66 2e5f 6c65 6e67 7468 203d    self._length =
+00013ad0: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+00013ae0: 7365 6c66 2e5f 6c65 6e67 7468 5b73 6b72  self._length[skr
+00013af0: 742e 696d 6167 652e 5f61 7865 735b 695f  t.image._axes[i_
+00013b00: 6178 5d5d 203d 206c 656e 6774 680a 2020  ax]] = length.  
+00013b10: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00013b20: 2052 6574 7572 6e20 6465 7369 7265 6420   Return desired 
+00013b30: 756e 6974 730a 2020 2020 2020 2020 7265  units.        re
+00013b40: 7475 726e 206c 656e 6774 685b 756e 6974  turn length[unit
+00013b50: 735d 0a0a 2020 2020 6465 6620 6765 745f  s]..    def get_
+00013b60: 6765 6f6d 6574 7279 280a 2020 2020 2020  geometry(.      
+00013b70: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00013b80: 6d65 7472 6963 733d 4e6f 6e65 2c0a 2020  metrics=None,.  
+00013b90: 2020 2020 2020 766f 6c5f 756e 6974 733d        vol_units=
+00013ba0: 226d 6d22 2c0a 2020 2020 2020 2020 6172  "mm",.        ar
+00013bb0: 6561 5f75 6e69 7473 3d22 6d6d 222c 0a20  ea_units="mm",. 
+00013bc0: 2020 2020 2020 206c 656e 6774 685f 756e         length_un
+00013bd0: 6974 733d 226d 6d22 2c0a 2020 2020 2020  its="mm",.      
+00013be0: 2020 6365 6e74 726f 6964 5f75 6e69 7473    centroid_units
+00013bf0: 3d22 6d6d 222c 0a20 2020 2020 2020 2076  ="mm",.        v
+00013c00: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
+00013c10: 2020 2073 6c3d 4e6f 6e65 2c0a 2020 2020     sl=None,.    
+00013c20: 2020 2020 706f 733d 4e6f 6e65 2c0a 2020      pos=None,.  
+00013c30: 2020 2020 2020 6964 783d 4e6f 6e65 2c0a        idx=None,.
+00013c40: 2020 2020 2020 2020 6d65 7468 6f64 3d4e          method=N
+00013c50: 6f6e 652c 0a20 2020 2020 2020 2075 6e69  one,.        uni
+00013c60: 7473 5f69 6e5f 6865 6164 6572 3d46 616c  ts_in_header=Fal
+00013c70: 7365 2c0a 2020 2020 2020 2020 676c 6f62  se,.        glob
+00013c80: 616c 5f76 735f 736c 6963 655f 6865 6164  al_vs_slice_head
+00013c90: 6572 3d46 616c 7365 2c0a 2020 2020 2020  er=False,.      
+00013ca0: 2020 6e61 6d65 5f61 735f 696e 6465 783d    name_as_index=
+00013cb0: 5472 7565 2c0a 2020 2020 2020 2020 6e69  True,.        ni
+00013cc0: 6365 5f63 6f6c 756d 6e73 3d46 616c 7365  ce_columns=False
+00013cd0: 2c0a 2020 2020 2020 2020 6465 6369 6d61  ,.        decima
+00013ce0: 6c5f 706c 6163 6573 3d4e 6f6e 652c 0a20  l_places=None,. 
+00013cf0: 2020 2020 2020 2066 6f72 6365 3d54 7275         force=Tru
+00013d00: 652c 0a20 2020 2020 2020 2068 746d 6c3d  e,.        html=
+00013d10: 4661 6c73 650a 2020 2020 293a 0a20 2020  False.    ):.   
+00013d20: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
+00013d30: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+00013d40: 6520 6f72 2068 746d 6c20 7461 626c 6520  e or html table 
+00013d50: 6f66 2074 6865 2067 656f 6d65 7472 6963  of the geometric
+00013d60: 2070 726f 7065 7274 6965 7320 0a20 2020   properties .   
+00013d70: 2020 2020 206c 6973 7465 6420 696e 203c       listed in <
+00013d80: 6d65 7472 6963 733e 2e0a 0a20 2020 2020  metrics>...     
+00013d90: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00013da0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+00013db0: 2020 2020 6d65 7472 6963 7320 3a20 6c69      metrics : li
+00013dc0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+00013dd0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
+00013de0: 7420 6f66 206d 6574 7269 6373 2074 6f20  t of metrics to 
+00013df0: 696e 636c 7564 6520 696e 2074 6865 2074  include in the t
+00013e00: 6162 6c65 2e20 4f70 7469 6f6e 733a 0a0a  able. Options:..
+00013e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e20: 2d20 2276 6f6c 756d 6522 203a 2076 6f6c  - "volume" : vol
+00013e30: 756d 6520 6f66 2065 6e74 6972 6520 524f  ume of entire RO
+00013e40: 492e 0a20 2020 2020 2020 2020 2020 2020  I..             
+00013e50: 2020 202d 2022 6172 6561 223a 2061 7265     - "area": are
+00013e60: 6120 6f66 2052 4f49 206f 6e20 6120 7369  a of ROI on a si
+00013e70: 6e67 6c65 2073 6c69 6365 2e0a 0a20 2020  ngle slice...   
+00013e80: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+00013e90: 6365 6e74 726f 6964 223a 2033 4420 6365  centroid": 3D ce
+00013ea0: 6e74 7265 2d6f 662d 6d61 7373 206f 6620  ntre-of-mass of 
+00013eb0: 524f 493b 2077 696c 6c20 6265 2073 706c  ROI; will be spl
+00013ec0: 6974 2069 6e74 6f0a 2020 2020 2020 2020  it into.        
+00013ed0: 2020 2020 2020 2020 2020 7468 7265 6520            three 
+00013ee0: 636f 6c75 6d6e 7320 636f 7272 6573 706f  columns correspo
+00013ef0: 6e64 696e 6720 746f 2074 6865 2074 6872  nding to the thr
+00013f00: 6565 2061 7865 732e 0a20 2020 2020 2020  ee axes..       
+00013f10: 2020 2020 2020 2020 202d 2022 6365 6e74           - "cent
+00013f20: 726f 6964 5f73 6c69 6365 223a 2032 4420  roid_slice": 2D 
+00013f30: 6365 6e74 7265 206f 6620 6d61 7373 206f  centre of mass o
+00013f40: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
+00013f50: 2e20 5769 6c6c 0a20 2020 2020 2020 2020  . Will.         
+00013f60: 2020 2020 2020 2020 2062 6520 7370 6c69           be spli
+00013f70: 7420 696e 746f 2074 776f 2063 6f6c 756d  t into two colum
+00013f80: 6e73 2063 6f72 7265 7370 6f6e 6469 6e67  ns corresponding
+00013f90: 2074 6f20 7468 6520 7477 6f20 6178 6573   to the two axes
+00013fa0: 206f 6e0a 2020 2020 2020 2020 2020 2020   on.            
+00013fb0: 2020 2020 2020 7468 6520 736c 6963 652e        the slice.
+00013fc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013fd0: 2020 2d20 226c 656e 6774 6822 3a20 6c65    - "length": le
+00013fe0: 6e67 7468 7320 6f66 2074 6865 2052 4f49  ngths of the ROI
+00013ff0: 2069 6e20 6561 6368 2064 6972 6563 7469   in each directi
+00014000: 6f6e 3b20 7769 6c6c 2062 6520 7370 6c69  on; will be spli
+00014010: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00014020: 2020 2020 696e 746f 2074 6872 6565 2063      into three c
+00014030: 6f6c 756d 6e73 2063 6f72 7265 7370 6f6e  olumns correspon
+00014040: 6469 6e67 2074 6f20 7468 6520 7468 7265  ding to the thre
+00014050: 6520 6178 6573 2e0a 2020 2020 2020 2020  e axes..        
+00014060: 2020 2020 2020 2020 2d20 226c 656e 6774          - "lengt
+00014070: 685f 736c 6963 6522 3a20 6c65 6e67 7468  h_slice": length
+00014080: 206f 6620 7468 6520 524f 4920 6f6e 2061   of the ROI on a
+00014090: 2073 696e 676c 6520 736c 6963 653b 2077   single slice; w
+000140a0: 696c 6c20 6265 0a20 2020 2020 2020 2020  ill be.         
+000140b0: 2020 2020 2020 2020 2073 706c 6974 2069           split i
+000140c0: 6e74 6f20 7477 6f20 636f 6c75 6d6e 7320  nto two columns 
+000140d0: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
+000140e0: 2074 6865 2074 776f 2061 7865 7320 6f6e   the two axes on
+000140f0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00014100: 2020 2020 2020 2073 6c69 6365 2e0a 0a20         slice... 
+00014110: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
+00014120: 6e65 2c20 6465 6661 756c 7473 2074 6f20  ne, defaults to 
+00014130: 5b22 766f 6c75 6d65 222c 2022 6365 6e74  ["volume", "cent
+00014140: 726f 6964 225d 0a0a 2020 2020 2020 2020  roid"]..        
+00014150: 766f 6c5f 756e 6974 7320 3a20 7374 722c  vol_units : str,
+00014160: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
+00014170: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
+00014180: 746f 2075 7365 2066 6f72 2076 6f6c 756d  to use for volum
+00014190: 652e 2043 616e 2062 6520 226d 6d22 2028  e. Can be "mm" (
+000141a0: 3d6d 6d5e 3329 2c20 226d 6c22 2c0a 2020  =mm^3), "ml",.  
+000141b0: 2020 2020 2020 2020 2020 6f72 2022 766f            or "vo
+000141c0: 7865 6c73 222e 0a0a 2020 2020 2020 2020  xels"...        
+000141d0: 6172 6561 5f75 6e69 7473 203a 2073 7472  area_units : str
+000141e0: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
+000141f0: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+00014200: 2074 6f20 7573 6520 666f 7220 6172 6561   to use for area
+00014210: 732e 2043 616e 2062 6520 226d 6d22 2028  s. Can be "mm" (
+00014220: 3d6d 6d5e 3229 206f 7220 2276 6f78 656c  =mm^2) or "voxel
+00014230: 7322 2e0a 0a20 2020 2020 2020 206c 656e  s"...        len
+00014240: 6774 685f 756e 6974 7320 3a20 7374 722c  gth_units : str,
+00014250: 2064 6566 6175 6c74 3d22 6d6d 223a 0a20   default="mm":. 
+00014260: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+00014270: 2074 6f20 7573 6520 666f 7220 6c65 6e67   to use for leng
+00014280: 7468 732e 2043 616e 2062 6520 226d 6d22  ths. Can be "mm"
+00014290: 206f 7220 2276 6f78 656c 7322 2e0a 0a20   or "voxels"... 
+000142a0: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
+000142b0: 756e 6974 733a 0a20 2020 2020 2020 2020  units:.         
+000142c0: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
+000142d0: 666f 7220 6365 6e74 726f 6964 732e 2043  for centroids. C
+000142e0: 616e 2062 6520 226d 6d22 206f 7220 2276  an be "mm" or "v
+000142f0: 6f78 656c 7322 2e0a 0a20 2020 2020 2020  oxels"...       
+00014300: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
+00014310: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
+00014320: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
+00014330: 6f6e 2069 6e20 7768 6963 6820 746f 2063  on in which to c
+00014340: 6f6d 7075 7465 206d 6574 7269 6373 2e20  ompute metrics. 
+00014350: 4f6e 6c79 2072 656c 6576 616e 7420 666f  Only relevant fo
+00014360: 7220 0a20 2020 2020 2020 2020 2020 2073  r .            s
+00014370: 696e 676c 652d 736c 6963 6520 6d65 7472  ingle-slice metr
+00014380: 6963 7320 2861 7265 612c 2063 656e 7472  ics (area, centr
+00014390: 6f69 645f 736c 6963 652c 206c 656e 6774  oid_slice, lengt
+000143a0: 685f 736c 6963 6529 2e0a 0a20 2020 2020  h_slice)...     
+000143b0: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
+000143c0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+000143d0: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
+000143e0: 6572 206f 6e20 7768 6963 6820 746f 2063  er on which to c
+000143f0: 6f6d 7075 7465 206d 6574 7269 6373 2e20  ompute metrics. 
+00014400: 4f6e 6c79 2072 656c 6576 616e 7420 666f  Only relevant fo
+00014410: 7220 0a20 2020 2020 2020 2020 2020 2073  r .            s
+00014420: 696e 676c 652d 736c 6963 6520 6d65 7472  ingle-slice metr
+00014430: 6963 7320 2861 7265 612c 2063 656e 7472  ics (area, centr
+00014440: 6f69 645f 736c 6963 652c 206c 656e 6774  oid_slice, lengt
+00014450: 685f 736c 6963 6529 2e0a 2020 2020 2020  h_slice)..      
+00014460: 2020 2020 2020 4966 203c 736c 3e2c 203c        If <sl>, <
+00014470: 6964 783e 2c20 616e 6420 3c70 6f73 3e20  idx>, and <pos> 
+00014480: 6172 6520 616c 6c20 4e6f 6e65 2c20 7468  are all None, th
+00014490: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
+000144a0: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
+000144b0: 2020 2052 4f49 2077 696c 6c20 6265 2075     ROI will be u
+000144c0: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
+000144d0: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
+000144e0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+000144f0: 2020 536c 6963 6520 696e 6465 7820 6172    Slice index ar
+00014500: 7261 7920 6f6e 2077 6869 6368 2074 6f20  ray on which to 
+00014510: 636f 6d70 7574 6520 6d65 7472 6963 732e  compute metrics.
+00014520: 204f 6e6c 7920 7265 6c65 7661 6e74 2066   Only relevant f
+00014530: 6f72 200a 2020 2020 2020 2020 2020 2020  or .            
+00014540: 7369 6e67 6c65 2d73 6c69 6365 206d 6574  single-slice met
+00014550: 7269 6373 2028 6172 6561 2c20 6365 6e74  rics (area, cent
+00014560: 726f 6964 5f73 6c69 6365 2c20 6c65 6e67  roid_slice, leng
+00014570: 7468 5f73 6c69 6365 292e 0a20 2020 2020  th_slice)..     
+00014580: 2020 2020 2020 2055 7365 6420 6966 203c         Used if <
+00014590: 736c 3e20 6973 204e 6f6e 652e 0a0a 2020  sl> is None...  
+000145a0: 2020 2020 2020 706f 7320 3a20 666c 6f61        pos : floa
+000145b0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+000145c0: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
+000145d0: 6520 706f 7369 7469 6f6e 2069 6e20 6d6d  e position in mm
+000145e0: 206f 6e20 7768 6963 6820 746f 2063 6f6d   on which to com
+000145f0: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
+00014600: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
+00014610: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00014620: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
+00014630: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
+00014640: 645f 736c 6963 652c 206c 656e 6774 685f  d_slice, length_
+00014650: 736c 6963 6529 2e0a 2020 2020 2020 2020  slice)..        
+00014660: 2020 2020 5573 6564 2069 6620 3c73 6c3e      Used if <sl>
+00014670: 2061 6e64 203c 6964 783e 2061 7265 2062   and <idx> are b
+00014680: 6f74 6820 4e6f 6e65 2e0a 0a20 2020 2020  oth None...     
+00014690: 2020 206d 6574 686f 6420 3a20 7374 722c     method : str,
+000146a0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+000146b0: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
+000146c0: 2074 6f20 7573 6520 666f 7220 6d65 7472   to use for metr
+000146d0: 6963 2063 616c 6375 6c61 7469 6f6e 2e20  ic calculation. 
+000146e0: 4361 6e20 6265 2065 6974 6865 7220 2263  Can be either "c
+000146f0: 6f6e 746f 7572 2220 0a20 2020 2020 2020  ontour" .       
+00014700: 2020 2020 2028 7573 6520 7368 6170 656c       (use shapel
+00014710: 7920 706f 6c79 676f 6e73 2920 6f72 2022  y polygons) or "
+00014720: 6d61 736b 2220 2875 7365 2062 696e 6172  mask" (use binar
+00014730: 7920 6d61 736b 292e 2049 6620 4e6f 6e65  y mask). If None
+00014740: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
+00014750: 6520 7661 6c75 6520 7365 7420 696e 2073  e value set in s
+00014760: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+00014770: 5f6d 6574 686f 6420 7769 6c6c 2062 6520  _method will be 
+00014780: 7573 6564 2e0a 0a20 2020 2020 2020 2075  used...        u
+00014790: 6e69 7473 5f69 6e5f 6865 6164 6572 203a  nits_in_header :
+000147a0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+000147b0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+000147c0: 2049 6620 5472 7565 2c20 756e 6974 7320   If True, units 
+000147d0: 7769 6c6c 2062 6520 696e 636c 7564 6564  will be included
+000147e0: 2069 6e20 636f 6c75 6d6e 2068 6561 6465   in column heade
+000147f0: 7273 2e0a 0a20 2020 2020 2020 2067 6c6f  rs...        glo
+00014800: 6261 6c5f 7673 5f73 6c69 6365 5f68 6561  bal_vs_slice_hea
+00014810: 6465 7220 3a20 626f 6f6c 2c20 6465 6661  der : bool, defa
+00014820: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+00014830: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00014840: 6865 2072 6574 7572 6e65 6420 4461 7461  he returned Data
+00014850: 4672 616d 6520 7769 6c6c 2068 6176 6520  Frame will have 
+00014860: 616e 2065 7874 7261 2073 6574 206f 6620  an extra set of 
+00014870: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
+00014880: 2020 2020 7370 6c69 7474 696e 6720 7468      splitting th
+00014890: 6520 7461 626c 6520 696e 746f 2022 676c  e table into "gl
+000148a0: 6f62 616c 2220 616e 6420 2273 6c69 6365  obal" and "slice
+000148b0: 2220 6d65 7472 6963 732e 0a0a 2020 2020  " metrics...    
+000148c0: 2020 2020 6e61 6d65 5f61 735f 696e 6465      name_as_inde
+000148d0: 7820 3a20 626f 6f6c 2c20 6465 6661 756c  x : bool, defaul
+000148e0: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
+000148f0: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
+00014900: 696e 6465 7820 636f 6c75 6d6e 206f 6620  index column of 
+00014910: 7468 6520 7061 6e64 6173 2044 6174 6146  the pandas DataF
+00014920: 7261 6d65 2077 696c 6c20 0a20 2020 2020  rame will .     
+00014930: 2020 2020 2020 2063 6f6e 7461 696e 2074         contain t
+00014940: 6865 2052 4f49 2773 206e 616d 653b 206f  he ROI's name; o
+00014950: 7468 6572 7769 7365 2c20 7468 6520 6e61  therwise, the na
+00014960: 6d65 2077 696c 6c20 6170 7065 6172 2069  me will appear i
+00014970: 6e20 6120 636f 6c75 6d6e 0a20 2020 2020  n a column.     
+00014980: 2020 2020 2020 206e 616d 6564 2022 524f         named "RO
+00014990: 4922 2e0a 0a20 2020 2020 2020 206e 6963  I"...        nic
+000149a0: 655f 636f 6c75 6d6e 7320 3a20 626f 6f6c  e_columns : bool
+000149b0: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+000149c0: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+000149d0: 616c 7365 2c20 636f 6c75 6d6e 206e 616d  alse, column nam
+000149e0: 6573 2077 696c 6c20 6265 2074 6865 2073  es will be the s
+000149f0: 616d 6520 6173 2074 6865 2069 6e70 7574  ame as the input
+00014a00: 206d 6574 7269 6373 206e 616d 6573 3b0a   metrics names;.
+00014a10: 2020 2020 2020 2020 2020 2020 6966 2054              if T
+00014a20: 7275 652c 2074 6865 206e 616d 6573 2077  rue, the names w
+00014a30: 696c 6c20 6265 2063 6170 6974 616c 697a  ill be capitaliz
+00014a40: 6564 2061 6e64 2075 6e64 6572 7363 6f72  ed and underscor
+00014a50: 6573 2077 696c 6c20 6265 200a 2020 2020  es will be .    
+00014a60: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
+00014a70: 2077 6974 6820 7370 6163 6573 2e0a 0a20   with spaces... 
+00014a80: 2020 2020 2020 2064 6563 696d 616c 5f70         decimal_p
+00014a90: 6c61 6365 7320 3a20 696e 742c 2064 6566  laces : int, def
+00014aa0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00014ab0: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
+00014ac0: 6465 6369 6d61 6c20 706c 6163 6573 2074  decimal places t
+00014ad0: 6f20 6b65 6570 2066 6f72 2065 6163 6820  o keep for each 
+00014ae0: 6d65 7472 6963 2e20 4966 204e 6f6e 652c  metric. If None,
+00014af0: 2066 756c 6c0a 2020 2020 2020 2020 2020   full.          
+00014b00: 2020 7072 6563 6973 696f 6e20 7769 6c6c    precision will
+00014b10: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00014b20: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
+00014b30: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+00014b40: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
+00014b50: 7365 2c20 676c 6f62 616c 206d 6574 7269  se, global metri
+00014b60: 6373 2028 766f 6c75 6d65 2c20 3344 2063  cs (volume, 3D c
+00014b70: 656e 7472 6f69 642c 2033 4420 6c65 6e67  entroid, 3D leng
+00014b80: 7468 7329 2077 696c 6c0a 2020 2020 2020  ths) will.      
+00014b90: 2020 2020 2020 6f6e 6c79 2062 6520 6361        only be ca
+00014ba0: 6c63 756c 6174 6564 2069 6620 7468 6579  lculated if they
+00014bb0: 2068 6176 6520 6e6f 7420 6265 656e 2063   have not been c
+00014bc0: 616c 6375 6c61 7465 6420 6265 666f 7265  alculated before
+00014bd0: 3b0a 2020 2020 2020 2020 2020 2020 6966  ;.            if
+00014be0: 2054 7275 652c 2061 6c6c 206d 6574 7269   True, all metri
+00014bf0: 6373 2077 696c 6c20 6265 2072 6563 616c  cs will be recal
+00014c00: 6375 6c61 7465 642e 0a20 2020 2020 2020  culated..       
+00014c10: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+00014c20: 4966 206e 6f20 696e 6465 7820 6769 7665  If no index give
+00014c30: 6e2c 2075 7365 2063 656e 7472 616c 2073  n, use central s
+00014c40: 6c69 6365 0a20 2020 2020 2020 2069 6620  lice.        if 
+00014c50: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
+00014c60: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
+00014c70: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
+00014c80: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
+00014c90: 6c66 2e67 6574 5f6d 6964 5f69 6478 2876  lf.get_mid_idx(v
+00014ca0: 6965 7729 0a0a 2020 2020 2020 2020 2320  iew)..        # 
+00014cb0: 4465 6661 756c 7420 6d65 7472 6963 730a  Default metrics.
+00014cc0: 2020 2020 2020 2020 6966 206d 6574 7269          if metri
+00014cd0: 6373 2069 7320 4e6f 6e65 3a0a 2020 2020  cs is None:.    
+00014ce0: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
+00014cf0: 3d20 5b22 766f 6c75 6d65 222c 2022 6365  = ["volume", "ce
+00014d00: 6e74 726f 6964 225d 0a0a 2020 2020 2020  ntroid"]..      
+00014d10: 2020 2320 436f 6d70 7574 6520 6d65 7472    # Compute metr
+00014d20: 6963 730a 2020 2020 2020 2020 6765 6f6d  ics.        geom
+00014d30: 203d 207b 7d0a 2020 2020 2020 2020 736c   = {}.        sl
+00014d40: 6963 655f 6b77 6172 6773 203d 207b 0a20  ice_kwargs = {. 
+00014d50: 2020 2020 2020 2020 2020 2022 7669 6577             "view
+00014d60: 223a 2076 6965 772c 0a20 2020 2020 2020  ": view,.       
+00014d70: 2020 2020 2022 736c 223a 2073 6c2c 0a20       "sl": sl,. 
+00014d80: 2020 2020 2020 2020 2020 2022 6964 7822             "idx"
+00014d90: 3a20 6964 782c 0a20 2020 2020 2020 2020  : idx,.         
+00014da0: 2020 2022 706f 7322 3a20 706f 730a 2020     "pos": pos.  
+00014db0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00014dc0: 666f 7220 6d20 696e 206d 6574 7269 6373  for m in metrics
+00014dd0: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00014de0: 2033 4420 766f 6c75 6d65 0a20 2020 2020   3D volume.     
+00014df0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
+00014e00: 766f 6c75 6d65 223a 0a20 2020 2020 2020  volume":.       
+00014e10: 2020 2020 2020 2020 2067 656f 6d5b 6d5d           geom[m]
+00014e20: 203d 2073 656c 662e 6765 745f 766f 6c75   = self.get_volu
+00014e30: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
+00014e40: 2020 2020 2020 2020 756e 6974 733d 766f          units=vo
+00014e50: 6c5f 756e 6974 732c 200a 2020 2020 2020  l_units, .      
+00014e60: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00014e70: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e90: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
+00014ea0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00014eb0: 2020 2020 2020 2020 2020 2020 2320 4172              # Ar
+00014ec0: 6561 206f 6e20 6120 736c 6963 650a 2020  ea on a slice.  
+00014ed0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00014ee0: 203d 3d20 2261 7265 6122 3a0a 2020 2020   == "area":.    
+00014ef0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00014f00: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f61  [m] = self.get_a
+00014f10: 7265 6128 0a20 2020 2020 2020 2020 2020  rea(.           
+00014f20: 2020 2020 2020 2020 2075 6e69 7473 3d61           units=a
+00014f30: 7265 615f 756e 6974 732c 200a 2020 2020  rea_units, .    
 00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f50: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
-00014f60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00014f70: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00014f80: 2023 2033 4420 6365 6e74 726f 6964 0a20   # 3D centroid. 
-00014f90: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00014fa0: 6d20 3d3d 2022 6365 6e74 726f 6964 223a  m == "centroid":
-00014fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014fc0: 2063 656e 7472 6f69 6420 3d20 7365 6c66   centroid = self
-00014fd0: 2e67 6574 5f63 656e 7472 6f69 6428 0a20  .get_centroid(. 
-00014fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ff0: 2020 2075 6e69 7473 3d63 656e 7472 6f69     units=centroi
-00015000: 645f 756e 6974 732c 200a 2020 2020 2020  d_units, .      
-00015010: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00015020: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
-00015030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015040: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
-00015050: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00015060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00015070: 6f72 2069 2c20 6178 2069 6e20 656e 756d  or i, ax in enum
-00015080: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
-00015090: 2e5f 6178 6573 293a 0a20 2020 2020 2020  ._axes):.       
-000150a0: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-000150b0: 6d5b 6622 6365 6e74 726f 6964 5f7b 6178  m[f"centroid_{ax
-000150c0: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
-000150d0: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
-000150e0: 2032 4420 6365 6e74 726f 6964 0a20 2020   2D centroid.   
-000150f0: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-00015100: 3d3d 2022 6365 6e74 726f 6964 5f73 6c69  == "centroid_sli
-00015110: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
-00015120: 2020 2020 2063 656e 7472 6f69 6420 3d20       centroid = 
-00015130: 7365 6c66 2e67 6574 5f63 656e 7472 6f69  self.get_centroi
-00015140: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-00015150: 2020 2020 2020 2075 6e69 7473 3d63 656e         units=cen
-00015160: 7472 6f69 645f 756e 6974 732c 200a 2020  troid_units, .  
-00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015180: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-00015190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000151a0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-000151b0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-000151c0: 2020 2020 2020 2020 2020 2020 2a2a 736c              **sl
-000151d0: 6963 655f 6b77 6172 6773 0a20 2020 2020  ice_kwargs.     
-000151e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000151f0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00015200: 2069 2c20 695f 6178 2069 6e20 656e 756d   i, i_ax in enum
-00015210: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
-00015220: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
-00015230: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00015240: 2020 2020 2020 2020 6178 203d 2073 6b72          ax = skr
-00015250: 742e 696d 6167 652e 5f61 7865 735b 695f  t.image._axes[i_
-00015260: 6178 5d0a 2020 2020 2020 2020 2020 2020  ax].            
-00015270: 2020 2020 2020 2020 6765 6f6d 5b66 2263          geom[f"c
-00015280: 656e 7472 6f69 645f 736c 6963 655f 7b61  entroid_slice_{a
-00015290: 787d 225d 203d 2063 656e 7472 6f69 645b  x}"] = centroid[
-000152a0: 695d 0a0a 2020 2020 2020 2020 2020 2020  i]..            
-000152b0: 2320 4675 6c6c 206c 656e 6774 6873 2061  # Full lengths a
-000152c0: 6c6f 6e67 2065 6163 6820 6178 6973 0a20  long each axis. 
-000152d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000152e0: 6d20 3d3d 2022 6c65 6e67 7468 223a 0a20  m == "length":. 
-000152f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00015300: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
-00015310: 6167 652e 5f61 7865 733a 0a20 2020 2020  age._axes:.     
-00015320: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00015330: 656f 6d5b 6622 6c65 6e67 7468 5f7b 6178  eom[f"length_{ax
-00015340: 7d22 5d20 3d20 7365 6c66 2e67 6574 5f6c  }"] = self.get_l
-00015350: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
-00015360: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00015370: 783d 6178 2c20 0a20 2020 2020 2020 2020  x=ax, .         
-00015380: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00015390: 6e69 7473 3d6c 656e 6774 685f 756e 6974  nits=length_unit
-000153a0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000153b0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-000153c0: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
-000153d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153e0: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
+00014f50: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00014f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f70: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
+00014f80: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00014f90: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00014fa0: 2023 2033 4420 6365 6e74 726f 6964 0a20   # 3D centroid. 
+00014fb0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00014fc0: 6d20 3d3d 2022 6365 6e74 726f 6964 223a  m == "centroid":
+00014fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014fe0: 2063 656e 7472 6f69 6420 3d20 7365 6c66   centroid = self
+00014ff0: 2e67 6574 5f63 656e 7472 6f69 6428 0a20  .get_centroid(. 
+00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015010: 2020 2075 6e69 7473 3d63 656e 7472 6f69     units=centroi
+00015020: 645f 756e 6974 732c 200a 2020 2020 2020  d_units, .      
+00015030: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00015040: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+00015050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015060: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
+00015070: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00015080: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015090: 6f72 2069 2c20 6178 2069 6e20 656e 756d  or i, ax in enum
+000150a0: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
+000150b0: 2e5f 6178 6573 293a 0a20 2020 2020 2020  ._axes):.       
+000150c0: 2020 2020 2020 2020 2020 2020 2067 656f               geo
+000150d0: 6d5b 6622 6365 6e74 726f 6964 5f7b 6178  m[f"centroid_{ax
+000150e0: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
+000150f0: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+00015100: 2032 4420 6365 6e74 726f 6964 0a20 2020   2D centroid.   
+00015110: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00015120: 3d3d 2022 6365 6e74 726f 6964 5f73 6c69  == "centroid_sli
+00015130: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
+00015140: 2020 2020 2063 656e 7472 6f69 6420 3d20       centroid = 
+00015150: 7365 6c66 2e67 6574 5f63 656e 7472 6f69  self.get_centroi
+00015160: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+00015170: 2020 2020 2020 2075 6e69 7473 3d63 656e         units=cen
+00015180: 7472 6f69 645f 756e 6974 732c 200a 2020  troid_units, .  
+00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151a0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+000151b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000151c0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+000151d0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+000151e0: 2020 2020 2020 2020 2020 2020 2a2a 736c              **sl
+000151f0: 6963 655f 6b77 6172 6773 0a20 2020 2020  ice_kwargs.     
+00015200: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00015210: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00015220: 2069 2c20 695f 6178 2069 6e20 656e 756d   i, i_ax in enum
+00015230: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
+00015240: 2e5f 706c 6f74 5f61 7865 735b 7669 6577  ._plot_axes[view
+00015250: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+00015260: 2020 2020 2020 2020 6178 203d 2073 6b72          ax = skr
+00015270: 742e 696d 6167 652e 5f61 7865 735b 695f  t.image._axes[i_
+00015280: 6178 5d0a 2020 2020 2020 2020 2020 2020  ax].            
+00015290: 2020 2020 2020 2020 6765 6f6d 5b66 2263          geom[f"c
+000152a0: 656e 7472 6f69 645f 736c 6963 655f 7b61  entroid_slice_{a
+000152b0: 787d 225d 203d 2063 656e 7472 6f69 645b  x}"] = centroid[
+000152c0: 695d 0a0a 2020 2020 2020 2020 2020 2020  i]..            
+000152d0: 2320 4675 6c6c 206c 656e 6774 6873 2061  # Full lengths a
+000152e0: 6c6f 6e67 2065 6163 6820 6178 6973 0a20  long each axis. 
+000152f0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00015300: 6d20 3d3d 2022 6c65 6e67 7468 223a 0a20  m == "length":. 
+00015310: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015320: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
+00015330: 6167 652e 5f61 7865 733a 0a20 2020 2020  age._axes:.     
+00015340: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00015350: 656f 6d5b 6622 6c65 6e67 7468 5f7b 6178  eom[f"length_{ax
+00015360: 7d22 5d20 3d20 7365 6c66 2e67 6574 5f6c  }"] = self.get_l
+00015370: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
+00015380: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00015390: 783d 6178 2c20 0a20 2020 2020 2020 2020  x=ax, .         
+000153a0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000153b0: 6e69 7473 3d6c 656e 6774 685f 756e 6974  nits=length_unit
+000153c0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000153d0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+000153e0: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
 000153f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015400: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00015410: 2023 204c 656e 6774 6873 206f 6e20 6120   # Lengths on a 
-00015420: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
-00015430: 2020 656c 6966 206d 203d 3d20 226c 656e    elif m == "len
-00015440: 6774 685f 736c 6963 6522 3a0a 2020 2020  gth_slice":.    
-00015450: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00015460: 695f 6178 2069 6e20 736b 7274 2e69 6d61  i_ax in skrt.ima
-00015470: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
-00015480: 6577 5d3a 0a20 2020 2020 2020 2020 2020  ew]:.           
-00015490: 2020 2020 2020 2020 2061 7820 3d20 736b           ax = sk
-000154a0: 7274 2e69 6d61 6765 2e5f 6178 6573 5b69  rt.image._axes[i
-000154b0: 5f61 785d 0a20 2020 2020 2020 2020 2020  _ax].           
-000154c0: 2020 2020 2020 2020 2067 656f 6d5b 6622           geom[f"
-000154d0: 6c65 6e67 7468 5f73 6c69 6365 5f7b 6178  length_slice_{ax
-000154e0: 7d22 5d20 3d20 7365 6c66 2e67 6574 5f6c  }"] = self.get_l
-000154f0: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
-00015500: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00015510: 783d 6178 2c20 0a20 2020 2020 2020 2020  x=ax, .         
-00015520: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00015530: 6e69 7473 3d6c 656e 6774 685f 756e 6974  nits=length_unit
-00015540: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00015550: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00015560: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
-00015570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015580: 2020 7369 6e67 6c65 5f73 6c69 6365 3d54    single_slice=T
-00015590: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-000155a0: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
-000155b0: 6c69 6365 5f6b 7761 7267 730a 2020 2020  lice_kwargs.    
-000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155d0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-000155e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000155f0: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
-00015600: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
-00015610: 2020 2020 2320 4178 6973 2d73 7065 6369      # Axis-speci
-00015620: 6669 6320 6d65 7472 6963 730a 2020 2020  fic metrics.    
-00015630: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00015640: 692c 2061 7820 696e 2065 6e75 6d65 7261  i, ax in enumera
-00015650: 7465 2873 6b72 742e 696d 6167 652e 5f61  te(skrt.image._a
-00015660: 7865 7329 3a0a 0a20 2020 2020 2020 2020  xes):..         
-00015670: 2020 2020 2020 2020 2020 2023 2047 6c6f             # Glo
-00015680: 6261 6c20 6365 6e74 726f 6964 2070 6f73  bal centroid pos
-00015690: 6974 696f 6e20 6f6e 2061 2067 6976 656e  ition on a given
-000156a0: 2061 7869 730a 2020 2020 2020 2020 2020   axis.          
-000156b0: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
-000156c0: 3d20 6622 6365 6e74 726f 6964 5f7b 6178  = f"centroid_{ax
-000156d0: 7d22 3a0a 2020 2020 2020 2020 2020 2020  }":.            
-000156e0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-000156f0: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f63  [m] = self.get_c
-00015700: 656e 7472 6f69 6428 0a20 2020 2020 2020  entroid(.       
-00015710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015720: 2020 2020 2075 6e69 7473 3d63 656e 7472       units=centr
-00015730: 6f69 645f 756e 6974 732c 0a20 2020 2020  oid_units,.     
-00015740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015750: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00015760: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015780: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
+00015400: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
+00015410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015420: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00015430: 2023 204c 656e 6774 6873 206f 6e20 6120   # Lengths on a 
+00015440: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
+00015450: 2020 656c 6966 206d 203d 3d20 226c 656e    elif m == "len
+00015460: 6774 685f 736c 6963 6522 3a0a 2020 2020  gth_slice":.    
+00015470: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015480: 695f 6178 2069 6e20 736b 7274 2e69 6d61  i_ax in skrt.ima
+00015490: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
+000154a0: 6577 5d3a 0a20 2020 2020 2020 2020 2020  ew]:.           
+000154b0: 2020 2020 2020 2020 2061 7820 3d20 736b           ax = sk
+000154c0: 7274 2e69 6d61 6765 2e5f 6178 6573 5b69  rt.image._axes[i
+000154d0: 5f61 785d 0a20 2020 2020 2020 2020 2020  _ax].           
+000154e0: 2020 2020 2020 2020 2067 656f 6d5b 6622           geom[f"
+000154f0: 6c65 6e67 7468 5f73 6c69 6365 5f7b 6178  length_slice_{ax
+00015500: 7d22 5d20 3d20 7365 6c66 2e67 6574 5f6c  }"] = self.get_l
+00015510: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
+00015520: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00015530: 783d 6178 2c20 0a20 2020 2020 2020 2020  x=ax, .         
+00015540: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00015550: 6e69 7473 3d6c 656e 6774 685f 756e 6974  nits=length_unit
+00015560: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00015570: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00015580: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
+00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155a0: 2020 7369 6e67 6c65 5f73 6c69 6365 3d54    single_slice=T
+000155b0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+000155c0: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+000155d0: 6c69 6365 5f6b 7761 7267 730a 2020 2020  lice_kwargs.    
+000155e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155f0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00015600: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00015610: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
+00015620: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
+00015630: 2020 2020 2320 4178 6973 2d73 7065 6369      # Axis-speci
+00015640: 6669 6320 6d65 7472 6963 730a 2020 2020  fic metrics.    
+00015650: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015660: 692c 2061 7820 696e 2065 6e75 6d65 7261  i, ax in enumera
+00015670: 7465 2873 6b72 742e 696d 6167 652e 5f61  te(skrt.image._a
+00015680: 7865 7329 3a0a 0a20 2020 2020 2020 2020  xes):..         
+00015690: 2020 2020 2020 2020 2020 2023 2047 6c6f             # Glo
+000156a0: 6261 6c20 6365 6e74 726f 6964 2070 6f73  bal centroid pos
+000156b0: 6974 696f 6e20 6f6e 2061 2067 6976 656e  ition on a given
+000156c0: 2061 7869 730a 2020 2020 2020 2020 2020   axis.          
+000156d0: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
+000156e0: 3d20 6622 6365 6e74 726f 6964 5f7b 6178  = f"centroid_{ax
+000156f0: 7d22 3a0a 2020 2020 2020 2020 2020 2020  }":.            
+00015700: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00015710: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f63  [m] = self.get_c
+00015720: 656e 7472 6f69 6428 0a20 2020 2020 2020  entroid(.       
+00015730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015740: 2020 2020 2075 6e69 7473 3d63 656e 7472       units=centr
+00015750: 6f69 645f 756e 6974 732c 0a20 2020 2020  oid_units,.     
+00015760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015770: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00015780: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
 00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157a0: 2020 2020 2020 295b 695d 0a20 2020 2020        )[i].     
+000157a0: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
 000157b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157c0: 2020 2066 6f75 6e64 203d 2054 7275 650a     found = True.
-000157d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000157e0: 2020 2020 2023 2046 756c 6c20 6c65 6e67       # Full leng
-000157f0: 7468 2061 6c6f 6e67 2061 2067 6976 656e  th along a given
-00015800: 2061 7869 730a 2020 2020 2020 2020 2020   axis.          
-00015810: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00015820: 203d 3d20 6622 6c65 6e67 7468 5f7b 6178   == f"length_{ax
-00015830: 7d22 3a0a 2020 2020 2020 2020 2020 2020  }":.            
-00015840: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-00015850: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f6c  [m] = self.get_l
-00015860: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
-00015870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015880: 2020 2061 783d 6178 2c0a 2020 2020 2020     ax=ax,.      
+000157c0: 2020 2020 2020 295b 695d 0a20 2020 2020        )[i].     
+000157d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157e0: 2020 2066 6f75 6e64 203d 2054 7275 650a     found = True.
+000157f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015800: 2020 2020 2023 2046 756c 6c20 6c65 6e67       # Full leng
+00015810: 7468 2061 6c6f 6e67 2061 2067 6976 656e  th along a given
+00015820: 2061 7869 730a 2020 2020 2020 2020 2020   axis.          
+00015830: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00015840: 203d 3d20 6622 6c65 6e67 7468 5f7b 6178   == f"length_{ax
+00015850: 7d22 3a0a 2020 2020 2020 2020 2020 2020  }":.            
+00015860: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00015870: 5b6d 5d20 3d20 7365 6c66 2e67 6574 5f6c  [m] = self.get_l
+00015880: 656e 6774 6828 0a20 2020 2020 2020 2020  ength(.         
 00015890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158a0: 2020 2020 2020 756e 6974 733d 6c65 6e67        units=leng
-000158b0: 7468 5f75 6e69 7473 2c20 0a20 2020 2020  th_units, .     
-000158c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158d0: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-000158e0: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015900: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
+000158a0: 2020 2061 783d 6178 2c0a 2020 2020 2020     ax=ax,.      
+000158b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158c0: 2020 2020 2020 756e 6974 733d 6c65 6e67        units=leng
+000158d0: 7468 5f75 6e69 7473 2c20 0a20 2020 2020  th_units, .     
+000158e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158f0: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00015900: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
 00015910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015920: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00015920: 2020 666f 7263 653d 666f 7263 650a 2020    force=force.  
 00015930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015940: 666f 756e 6420 3d20 5472 7565 0a0a 2020  found = True..  
-00015950: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00015960: 206e 6f74 2066 6f75 6e64 3a0a 2020 2020   not found:.    
-00015970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015980: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-00015990: 6f72 2866 224d 6574 7269 6320 7b6d 7d20  or(f"Metric {m} 
-000159a0: 6e6f 7420 7265 636f 676e 6973 6564 2062  not recognised b
-000159b0: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
-000159c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159d0: 2020 2020 2020 2020 2020 2022 524f 492e             "ROI.
-000159e0: 6765 745f 6765 6f6d 6574 7279 2829 2229  get_geometry()")
-000159f0: 0a0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
-00015a00: 756e 6974 7320 746f 206d 6574 7269 6320  units to metric 
-00015a10: 6e61 6d65 7320 6966 2072 6571 7565 7374  names if request
-00015a20: 6564 0a20 2020 2020 2020 2067 656f 6d5f  ed.        geom_
-00015a30: 6e61 6d65 6420 3d20 7b7d 0a20 2020 2020  named = {}.     
-00015a40: 2020 2069 6620 6e6f 7420 756e 6974 735f     if not units_
-00015a50: 696e 5f68 6561 6465 723a 0a20 2020 2020  in_header:.     
-00015a60: 2020 2020 2020 2067 656f 6d5f 6e61 6d65         geom_name
-00015a70: 6420 3d20 6765 6f6d 0a20 2020 2020 2020  d = geom.       
-00015a80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00015a90: 2020 2066 6f72 206d 6574 7269 632c 2076     for metric, v
-00015aa0: 616c 2069 6e20 6765 6f6d 2e69 7465 6d73  al in geom.items
-00015ab0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00015ac0: 2020 2020 6e61 6d65 203d 206d 6574 7269      name = metri
-00015ad0: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
-00015ae0: 2020 6966 2022 766f 6c75 6d65 2220 696e    if "volume" in
-00015af0: 206d 6574 7269 633a 0a20 2020 2020 2020   metric:.       
-00015b00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015b10: 766f 6c5f 756e 6974 7320 3d3d 2022 6d6d  vol_units == "mm
-00015b20: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00015b30: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-00015b40: 2b3d 2022 2028 6d6d 5e33 2922 0a20 2020  += " (mm^3)".   
-00015b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00015b70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00015b80: 616d 6520 2b3d 2022 2028 2220 2b20 766f  ame += " (" + vo
-00015b90: 6c5f 756e 6974 7320 2b20 2229 220a 2020  l_units + ")".  
-00015ba0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00015bb0: 6966 2022 6172 6561 2220 696e 206d 6574  if "area" in met
-00015bc0: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
-00015bd0: 2020 2020 2020 2020 2069 6620 6172 6561           if area
-00015be0: 5f75 6e69 7473 203d 3d20 226d 6d22 3a0a  _units == "mm":.
-00015bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c00: 2020 2020 2020 2020 6e61 6d65 202b 3d20          name += 
-00015c10: 2220 286d 6d5e 3229 220a 2020 2020 2020  " (mm^2)".      
-00015c20: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00015c30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00015c40: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00015c50: 202b 3d20 2220 2822 202b 2061 7265 615f   += " (" + area_
-00015c60: 756e 6974 7320 2b20 2229 220a 2020 2020  units + ")".    
-00015c70: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00015c80: 2022 6c65 6e67 7468 2220 696e 206d 6574   "length" in met
-00015c90: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
-00015ca0: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
-00015cb0: 2022 2028 2220 2b20 6c65 6e67 7468 5f75   " (" + length_u
-00015cc0: 6e69 7473 202b 2022 2922 0a20 2020 2020  nits + ")".     
-00015cd0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00015ce0: 2263 656e 7472 6f69 6422 2069 6e20 6d65  "centroid" in me
-00015cf0: 7472 6963 3a0a 2020 2020 2020 2020 2020  tric:.          
-00015d00: 2020 2020 2020 2020 2020 6e61 6d65 202b            name +
-00015d10: 3d20 2220 2822 202b 2063 656e 7472 6f69  = " (" + centroi
-00015d20: 645f 756e 6974 7320 2b20 2229 220a 2020  d_units + ")".  
-00015d30: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-00015d40: 6f6d 5f6e 616d 6564 5b6e 616d 655d 203d  om_named[name] =
-00015d50: 2076 616c 0a0a 2020 2020 2020 2020 2320   val..        # 
-00015d60: 4164 6a75 7374 206e 756d 6265 7220 6f66  Adjust number of
-00015d70: 2064 6563 696d 616c 2070 6c61 6365 730a   decimal places.
-00015d80: 2020 2020 2020 2020 6966 2064 6563 696d          if decim
-00015d90: 616c 5f70 6c61 6365 7320 6973 206e 6f74  al_places is not
-00015da0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00015db0: 2020 2066 6f72 206d 6574 7269 632c 2076     for metric, v
-00015dc0: 616c 2069 6e20 6765 6f6d 5f6e 616d 6564  al in geom_named
-00015dd0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00015de0: 2020 2020 2020 2020 2020 666d 7420 3d20            fmt = 
-00015df0: 6622 7b7b 7661 6c3a 2e7b 6465 6369 6d61  f"{{val:.{decima
-00015e00: 6c5f 706c 6163 6573 7d66 7d7d 220a 2020  l_places}f}}".  
-00015e10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00015e20: 2067 656f 6d5f 6e61 6d65 645b 6d65 7472   geom_named[metr
-00015e30: 6963 5d20 6973 206e 6f74 204e 6f6e 653a  ic] is not None:
-00015e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015e50: 2020 2020 2067 656f 6d5f 6e61 6d65 645b       geom_named[
-00015e60: 6d65 7472 6963 5d20 3d20 666c 6f61 7428  metric] = float(
-00015e70: 666d 742e 666f 726d 6174 2876 616c 3d76  fmt.format(val=v
-00015e80: 616c 2929 0a0a 2020 2020 2020 2020 2320  al))..        # 
-00015e90: 436f 6e76 6572 7420 746f 2070 616e 6461  Convert to panda
-00015ea0: 7320 4461 7461 4672 616d 650a 2020 2020  s DataFrame.    
-00015eb0: 2020 2020 6466 203d 2070 642e 4461 7461      df = pd.Data
-00015ec0: 4672 616d 6528 6765 6f6d 5f6e 616d 6564  Frame(geom_named
-00015ed0: 2c20 696e 6465 783d 5b73 656c 662e 6e61  , index=[self.na
-00015ee0: 6d65 5d29 0a0a 2020 2020 2020 2020 2320  me])..        # 
-00015ef0: 4361 7069 7461 6c69 7a65 2063 6f6c 756d  Capitalize colum
-00015f00: 6e20 6e61 6d65 7320 616e 6420 7265 6d6f  n names and remo
-00015f10: 7665 2075 6e64 6572 7363 6f72 6573 2069  ve underscores i
-00015f20: 6620 7265 7175 6573 7465 640a 2020 2020  f requested.    
-00015f30: 2020 2020 6966 206e 6963 655f 636f 6c75      if nice_colu
-00015f40: 6d6e 7320 616e 6420 6e6f 7420 676c 6f62  mns and not glob
-00015f50: 616c 5f76 735f 736c 6963 655f 6865 6164  al_vs_slice_head
-00015f60: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00015f70: 6466 2e63 6f6c 756d 6e73 203d 205b 636f  df.columns = [co
-00015f80: 6c2e 6361 7069 7461 6c69 7a65 2829 2e72  l.capitalize().r
-00015f90: 6570 6c61 6365 2822 5f22 2c20 2220 2229  eplace("_", " ")
-00015fa0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00015fb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00015fc0: 636f 6c20 696e 2064 662e 636f 6c75 6d6e  col in df.column
-00015fd0: 735d 0a0a 2020 2020 2020 2020 2320 5475  s]..        # Tu
-00015fe0: 726e 206e 616d 6520 696e 746f 2061 2072  rn name into a r
-00015ff0: 6567 756c 6172 2063 6f6c 756d 6e20 6966  egular column if
-00016000: 2072 6571 7565 7374 6564 0a20 2020 2020   requested.     
-00016010: 2020 2069 6620 6e6f 7420 6e61 6d65 5f61     if not name_a
-00016020: 735f 696e 6465 783a 0a20 2020 2020 2020  s_index:.       
-00016030: 2020 2020 2064 6620 3d20 6466 2e72 6573       df = df.res
-00016040: 6574 5f69 6e64 6578 2829 2e72 656e 616d  et_index().renam
-00016050: 6528 7b22 696e 6465 7822 3a20 2252 4f49  e({"index": "ROI
-00016060: 227d 2c20 6178 6973 3d31 290a 0a20 2020  "}, axis=1)..   
-00016070: 2020 2020 2023 2041 6464 2067 6c6f 6261       # Add globa
-00016080: 6c2f 736c 6963 6520 6865 6164 6572 730a  l/slice headers.
-00016090: 2020 2020 2020 2020 6966 2067 6c6f 6261          if globa
-000160a0: 6c5f 7673 5f73 6c69 6365 5f68 6561 6465  l_vs_slice_heade
-000160b0: 723a 0a0a 2020 2020 2020 2020 2020 2020  r:..            
-000160c0: 2320 536f 7274 2063 6f6c 756d 6e73 2069  # Sort columns i
-000160d0: 6e74 6f20 676c 6f62 616c 206f 7220 736c  nto global or sl
-000160e0: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
-000160f0: 6865 6164 6572 7320 3d20 5b5d 0a20 2020  headers = [].   
-00016100: 2020 2020 2020 2020 2073 6c69 6365 5f63           slice_c
-00016110: 6f6c 7320 3d20 5b5d 0a20 2020 2020 2020  ols = [].       
-00016120: 2020 2020 2067 6c6f 6261 6c5f 636f 6c73       global_cols
-00016130: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-00016140: 2020 736c 6963 655f 6e61 6d65 203d 2022    slice_name = "
-00016150: 736c 6963 6522 2069 6620 6e6f 7420 6e69  slice" if not ni
-00016160: 6365 5f63 6f6c 756d 6e73 2065 6c73 6520  ce_columns else 
-00016170: 2253 6c69 6365 220a 2020 2020 2020 2020  "Slice".        
-00016180: 2020 2020 676c 6f62 616c 5f6e 616d 6520      global_name 
-00016190: 3d20 2267 6c6f 6261 6c22 2069 6620 6e6f  = "global" if no
-000161a0: 7420 6e69 6365 5f63 6f6c 756d 6e73 2065  t nice_columns e
-000161b0: 6c73 6520 2247 6c6f 6261 6c22 0a20 2020  lse "Global".   
-000161c0: 2020 2020 2020 2020 2066 6f72 206d 6574           for met
-000161d0: 7269 6320 696e 2067 656f 6d5f 6e61 6d65  ric in geom_name
-000161e0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-000161f0: 2020 206e 616d 6520 3d20 6d65 7472 6963     name = metric
-00016200: 2069 6620 6e6f 7420 6e69 6365 5f63 6f6c   if not nice_col
-00016210: 756d 6e73 2065 6c73 6520 5c0a 2020 2020  umns else \.    
-00016220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016230: 2020 2020 6d65 7472 6963 2e63 6170 6974      metric.capit
-00016240: 616c 697a 6528 292e 7265 706c 6163 6528  alize().replace(
-00016250: 225f 222c 2022 2229 0a20 2020 2020 2020  "_", "").       
-00016260: 2020 2020 2020 2020 2069 6620 2261 7265           if "are
-00016270: 6122 2069 6e20 6d65 7472 6963 206f 7220  a" in metric or 
-00016280: 2273 6c69 6365 2220 696e 206d 6574 7269  "slice" in metri
-00016290: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
-000162a0: 2020 2020 2020 2068 6561 6465 7273 2e61         headers.a
-000162b0: 7070 656e 6428 2873 6c69 6365 5f6e 616d  ppend((slice_nam
-000162c0: 652c 206d 6574 7269 6329 290a 2020 2020  e, metric)).    
-000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162e0: 736c 6963 655f 636f 6c73 2e61 7070 656e  slice_cols.appen
-000162f0: 6428 6d65 7472 6963 290a 2020 2020 2020  d(metric).      
-00016300: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00016310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016320: 2020 2020 6865 6164 6572 732e 6170 7065      headers.appe
-00016330: 6e64 2828 676c 6f62 616c 5f6e 616d 652c  nd((global_name,
-00016340: 206d 6574 7269 6329 290a 2020 2020 2020   metric)).      
-00016350: 2020 2020 2020 2020 2020 2020 2020 676c                gl
-00016360: 6f62 616c 5f63 6f6c 732e 6170 7065 6e64  obal_cols.append
-00016370: 286d 6574 7269 6329 0a0a 2020 2020 2020  (metric)..      
-00016380: 2020 2020 2020 2320 5265 6f72 6465 7220        # Reorder 
-00016390: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-000163a0: 2020 2020 6466 735f 6f72 6465 7265 6420      dfs_ordered 
-000163b0: 3d20 5b64 665b 676c 6f62 616c 5f63 6f6c  = [df[global_col
-000163c0: 735d 2c20 6466 5b73 6c69 6365 5f63 6f6c  s], df[slice_col
-000163d0: 735d 5d0a 2020 2020 2020 2020 2020 2020  s]].            
-000163e0: 6966 206e 6f74 206e 616d 655f 6173 5f69  if not name_as_i
-000163f0: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
-00016400: 2020 2020 2020 6466 735f 6f72 6465 7265        dfs_ordere
-00016410: 642e 696e 7365 7274 2830 2c20 6466 5b22  d.insert(0, df["
-00016420: 524f 4922 5d29 0a20 2020 2020 2020 2020  ROI"]).         
-00016430: 2020 2064 6620 3d20 7064 2e63 6f6e 6361     df = pd.conca
-00016440: 7428 6466 735f 6f72 6465 7265 642c 2061  t(dfs_ordered, a
-00016450: 7869 733d 3129 0a0a 2020 2020 2020 2020  xis=1)..        
-00016460: 2020 2020 2320 536f 7274 2068 6561 6465      # Sort heade
-00016470: 7273 2062 7920 676c 6f62 616c 2f73 6c69  rs by global/sli
-00016480: 6365 0a20 2020 2020 2020 2020 2020 2068  ce.            h
-00016490: 6561 6465 7273 203d 205b 6820 666f 7220  eaders = [h for 
-000164a0: 6820 696e 2068 6561 6465 7273 2069 6620  h in headers if 
-000164b0: 685b 305d 203d 3d20 676c 6f62 616c 5f6e  h[0] == global_n
-000164c0: 616d 655d 205c 0a20 2020 2020 2020 2020  ame] \.         
-000164d0: 2020 2020 2020 2020 2020 202b 205b 6820             + [h 
-000164e0: 666f 7220 6820 696e 2068 6561 6465 7273  for h in headers
-000164f0: 2069 6620 685b 305d 203d 3d20 736c 6963   if h[0] == slic
-00016500: 655f 6e61 6d65 5d0a 2020 2020 2020 2020  e_name].        
-00016510: 2020 2020 6966 206e 6f74 206e 616d 655f      if not name_
-00016520: 6173 5f69 6e64 6578 3a0a 2020 2020 2020  as_index:.      
-00016530: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00016540: 732e 696e 7365 7274 2830 2c20 2822 222c  s.insert(0, ("",
-00016550: 2022 524f 4922 2929 0a0a 2020 2020 2020   "ROI"))..      
-00016560: 2020 2020 2020 2320 4164 6420 4d75 6c74        # Add Mult
-00016570: 6949 6e64 6578 0a20 2020 2020 2020 2020  iIndex.         
-00016580: 2020 2064 662e 636f 6c75 6d6e 7320 3d20     df.columns = 
-00016590: 7064 2e4d 756c 7469 496e 6465 782e 6672  pd.MultiIndex.fr
-000165a0: 6f6d 5f74 7570 6c65 7328 6865 6164 6572  om_tuples(header
-000165b0: 7329 0a0a 2020 2020 2020 2020 6966 2068  s)..        if h
-000165c0: 746d 6c3a 0a20 2020 2020 2020 2020 2020  tml:.           
-000165d0: 2072 6574 7572 6e20 6466 5f74 6f5f 6874   return df_to_ht
-000165e0: 6d6c 2864 6629 0a20 2020 2020 2020 2072  ml(df).        r
-000165f0: 6574 7572 6e20 6466 0a0a 2020 2020 6465  eturn df..    de
-00016600: 6620 6765 745f 6365 6e74 726f 6964 5f64  f get_centroid_d
-00016610: 6973 7461 6e63 6528 7365 6c66 2c20 726f  istance(self, ro
-00016620: 692c 2073 696e 676c 655f 736c 6963 653d  i, single_slice=
-00016630: 4661 6c73 652c 2076 6965 773d 2278 2d79  False, view="x-y
-00016640: 222c 0a20 2020 2020 2020 2020 2020 2073  ",.            s
-00016650: 6c3d 4e6f 6e65 2c20 6964 783d 4e6f 6e65  l=None, idx=None
-00016660: 2c20 706f 733d 4e6f 6e65 2c20 756e 6974  , pos=None, unit
-00016670: 733d 226d 6d22 2c20 6d65 7468 6f64 3d4e  s="mm", method=N
-00016680: 6f6e 652c 2066 6f72 6365 3d54 7275 652c  one, force=True,
-00016690: 0a20 2020 2020 2020 2020 2020 2062 795f  .            by_
-000166a0: 736c 6963 653d 4e6f 6e65 2c20 7661 6c75  slice=None, valu
-000166b0: 655f 666f 725f 6e6f 6e65 3d4e 6f6e 652c  e_for_none=None,
-000166c0: 2073 6c69 6365 5f73 7461 743d 4e6f 6e65   slice_stat=None
-000166d0: 2c0a 2020 2020 2020 2020 2020 2020 2a2a  ,.            **
-000166e0: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
-000166f0: 7329 3a0a 2020 2020 2020 2020 2222 2247  s):.        """G
-00016700: 6574 2063 656e 7472 6f69 6420 6469 7370  et centroid disp
-00016710: 6c61 6365 6d65 6e74 2076 6563 746f 7220  lacement vector 
-00016720: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
-00016730: 616e 6f74 6865 7220 524f 492e 0a0a 2020  another ROI...  
-00016740: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-00016750: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
-00016760: 2020 2020 2020 2072 6f69 203a 2052 4f49         roi : ROI
-00016770: 0a20 2020 2020 2020 2020 2020 204f 7468  .            Oth
-00016780: 6572 2052 4f49 2077 6974 6820 7768 6963  er ROI with whic
-00016790: 6820 746f 2063 6f6d 7061 7265 2063 656e  h to compare cen
-000167a0: 7472 6f69 642e 0a0a 2020 2020 2020 2020  troid...        
-000167b0: 7369 6e67 6c65 5f73 6c69 6365 203a 2062  single_slice : b
-000167c0: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
-000167d0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
-000167e0: 6620 5472 7565 2c20 7468 6520 6365 6e74  f True, the cent
-000167f0: 726f 6964 2077 696c 6c20 6265 2072 6574  roid will be ret
-00016800: 7572 6e65 6420 666f 7220 6120 7369 6e67  urned for a sing
-00016810: 6c65 2073 6c69 6365 2e0a 0a20 2020 2020  le slice...     
-00016820: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
-00016830: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
-00016840: 2020 2020 2020 2020 204f 7269 656e 7461           Orienta
-00016850: 7469 6f6e 2069 6e20 7768 6963 6820 746f  tion in which to
-00016860: 2067 6574 2063 656e 7472 6f69 6473 2069   get centroids i
-00016870: 6620 7573 696e 6720 6120 7369 6e67 6c65  f using a single
-00016880: 2073 6c69 6365 206f 720a 2020 2020 2020   slice or.      
-00016890: 2020 2020 2020 666c 6174 7465 6e69 6e67        flattening
-000168a0: 2e0a 0a20 2020 2020 2020 2066 6c61 7474  ...        flatt
-000168b0: 656e 203a 2062 6f6f 6c2c 2064 6566 6175  en : bool, defau
-000168c0: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-000168d0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-000168e0: 6520 3344 2063 656e 7472 6f69 6420 7769  e 3D centroid wi
-000168f0: 6c6c 2062 6520 6f62 7461 696e 6564 2061  ll be obtained a
-00016900: 6e64 2074 6865 6e20 7468 6520 6162 736f  nd then the abso
-00016910: 6c75 7465 200a 2020 2020 2020 2020 2020  lute .          
-00016920: 2020 7661 6c75 6520 616c 6f6e 6720 6f6e    value along on
-00016930: 6c79 2074 6865 2032 4420 6178 6573 2069  ly the 2D axes i
-00016940: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
-00016950: 6e20 696e 203c 7669 6577 3e20 7769 6c6c  n in <view> will
-00016960: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
-00016970: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
-00016980: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
-00016990: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-000169a0: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
-000169b0: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
-000169c0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-000169d0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
-000169e0: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
-000169f0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-00016a00: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-00016a10: 7472 616c 2073 6c69 6365 206f 6620 6561  tral slice of ea
-00016a20: 6368 2052 4f49 0a20 2020 2020 2020 2020  ch ROI.         
-00016a30: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
-00016a40: 0a0a 2020 2020 2020 2020 6964 7820 3a20  ..        idx : 
-00016a50: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-00016a60: 650a 2020 2020 2020 2020 2020 2020 4172  e.            Ar
-00016a70: 7261 7920 696e 6465 7820 6f66 2073 6c69  ray index of sli
-00016a80: 6365 2e20 4966 206e 6f6e 6520 6f66 203c  ce. If none of <
-00016a90: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-00016aa0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
-00016ab0: 0a20 2020 2020 2020 2020 2020 2062 7574  .            but
-00016ac0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-00016ad0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-00016ae0: 7472 616c 2073 6c69 6365 206f 6620 6561  tral slice of ea
-00016af0: 6368 2052 4f49 0a20 2020 2020 2020 2020  ch ROI.         
-00016b00: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
-00016b10: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
-00016b20: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-00016b30: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00016b40: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
-00016b50: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
-00016b60: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-00016b70: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
-00016b80: 6564 0a20 2020 2020 2020 2020 2020 2062  ed.            b
-00016b90: 7574 203c 7369 6e67 6c65 5f73 6c69 6365  ut <single_slice
-00016ba0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
-00016bb0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-00016bc0: 6561 6368 2052 4f49 0a20 2020 2020 2020  each ROI.       
-00016bd0: 2020 2020 2077 696c 6c20 6265 2075 7365       will be use
-00016be0: 642e 0a0a 2020 2020 2020 2020 756e 6974  d...        unit
-00016bf0: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
-00016c00: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
-00016c10: 2020 556e 6974 7320 6f66 2061 6273 6f6c    Units of absol
-00016c20: 7574 6520 6365 6e74 726f 6964 2064 6973  ute centroid dis
-00016c30: 7461 6e63 652e 2043 616e 2062 6520 616e  tance. Can be an
-00016c40: 7920 6f66 3a0a 2020 2020 2020 2020 2020  y of:.          
-00016c50: 2020 2020 2020 2d20 226d 6d22 3a20 7265        - "mm": re
-00016c60: 7475 726e 2063 656e 7472 6f69 6420 706f  turn centroid po
-00016c70: 7369 7469 6f6e 2069 6e20 6d69 6c6c 696d  sition in millim
-00016c80: 6574 7265 732e 0a20 2020 2020 2020 2020  etres..         
-00016c90: 2020 2020 2020 202d 2022 766f 7865 6c73         - "voxels
-00016ca0: 223a 2072 6574 7572 6e20 6365 6e74 726f  ": return centro
-00016cb0: 6964 2070 6f73 6974 696f 6e20 696e 2074  id position in t
-00016cc0: 6572 6d73 206f 6620 6172 7261 7920 696e  erms of array in
-00016cd0: 6469 6365 732e 0a20 2020 2020 2020 2020  dices..         
-00016ce0: 2020 2020 2020 202d 2022 736c 6963 6522         - "slice"
-00016cf0: 3a20 7265 7475 726e 2063 656e 7472 6f69  : return centroi
-00016d00: 6420 706f 7369 7469 6f6e 2069 6e20 7465  d position in te
-00016d10: 726d 7320 6f66 2073 6c69 6365 206e 756d  rms of slice num
-00016d20: 6265 7273 2e0a 0a20 2020 2020 2020 2020  bers...         
-00016d30: 2020 2049 6620 756e 6974 733d 2276 6f78     If units="vox
-00016d40: 656c 7322 206f 7220 2273 6c69 6365 2220  els" or "slice" 
-00016d50: 6973 2072 6571 7565 7374 6564 2062 7574  is requested but
-00016d60: 2065 6974 6865 7220 524f 4920 6f6e 6c79   either ROI only
-00016d70: 2068 6173 200a 2020 2020 2020 2020 2020   has .          
-00016d80: 2020 636f 6e74 6f75 7273 2061 6e64 206e    contours and n
-00016d90: 6f20 6d61 736b 2073 6861 7065 2f76 6f78  o mask shape/vox
-00016da0: 656c 2073 697a 6520 696e 666f 726d 6174  el size informat
-00016db0: 696f 6e2c 2061 6e20 6572 726f 7220 7769  ion, an error wi
-00016dc0: 6c6c 2062 6520 0a20 2020 2020 2020 2020  ll be .         
-00016dd0: 2020 2072 6169 7365 6420 2875 6e6c 6573     raised (unles
-00016de0: 7320 6178 3d22 7a22 2c20 696e 2077 6869  s ax="z", in whi
-00016df0: 6368 2063 6173 6520 766f 7865 6c20 7369  ch case voxel si
-00016e00: 7a65 2077 696c 6c20 6265 2069 6e66 6572  ze will be infer
-00016e10: 7265 6420 0a20 2020 2020 2020 2020 2020  red .           
-00016e20: 2066 726f 6d20 7370 6163 696e 6720 6265   from spacing be
-00016e30: 7477 6565 6e20 736c 6963 6573 292e 0a0a  tween slices)...
-00016e40: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
-00016e50: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-00016e60: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
-00016e70: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-00016e80: 2063 656e 7472 6f69 6420 6361 6c63 756c   centroid calcul
-00016e90: 6174 696f 6e2e 2043 616e 2062 653a 200a  ation. Can be: .
-00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016eb0: 2d20 2263 6f6e 746f 7572 223a 2067 6574  - "contour": get
-00016ec0: 2063 656e 7472 6f69 6420 6f66 2073 6861   centroid of sha
-00016ed0: 7065 6c79 2063 6f6e 746f 7572 2873 292e  pely contour(s).
-00016ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ef0: 202d 2022 6d61 736b 223a 2067 6574 2061   - "mask": get a
-00016f00: 7665 7261 6765 2070 6f73 6974 696f 6e20  verage position 
-00016f10: 6f66 2076 6f78 656c 7320 696e 2062 696e  of voxels in bin
-00016f20: 6172 7920 6d61 736b 2e0a 2020 2020 2020  ary mask..      
-00016f30: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
-00016f40: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
-00016f50: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
-00016f60: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
-00016f70: 2e0a 0a20 2020 2020 2020 2066 6f72 6365  ...        force
-00016f80: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00016f90: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
-00016fa0: 2020 4966 2054 7275 652c 2074 6865 2067    If True, the g
-00016fb0: 6c6f 6261 6c20 6365 6e74 726f 6964 2077  lobal centroid w
-00016fc0: 696c 6c20 616c 7761 7973 2062 6520 7265  ill always be re
-00016fd0: 6361 6c63 756c 6174 6564 3b20 0a20 2020  calculated; .   
-00016fe0: 2020 2020 2020 2020 206f 7468 6572 7769           otherwi
-00016ff0: 7365 2c20 6974 2077 696c 6c20 6f6e 6c79  se, it will only
-00017000: 2062 6520 6361 6c63 756c 6174 6564 2069   be calculated i
-00017010: 6620 6974 2068 6173 206e 6f74 2079 6574  f it has not yet
-00017020: 2062 6565 6e20 6361 6368 6564 200a 2020   been cached .  
-00017030: 2020 2020 2020 2020 2020 696e 2073 656c            in sel
-00017040: 662e 5f76 6f6c 756d 652e 2020 4e6f 7465  f._volume.  Note
-00017050: 2074 6861 7420 6966 2073 696e 676c 655f   that if single_
-00017060: 736c 6963 653d 5472 7565 2c20 7468 6520  slice=True, the 
-00017070: 6365 6e74 726f 6964 2077 696c 6c20 0a20  centroid will . 
-00017080: 2020 2020 2020 2020 2020 2061 6c77 6179             alway
-00017090: 7320 6265 2072 6563 616c 6375 6c61 7465  s be recalculate
-000170a0: 642e 0a0a 2020 2020 2020 2020 6279 5f73  d...        by_s
-000170b0: 6c69 6365 203a 2073 7472 2c20 6465 6661  lice : str, defa
-000170c0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-000170d0: 2020 2020 2049 6620 6f6e 6520 6f66 2022       If one of "
-000170e0: 6c65 6674 222c 2022 7269 6768 7422 2c20  left", "right", 
-000170f0: 2275 6e69 6f6e 222c 2022 696e 7465 7273  "union", "inters
-00017100: 6563 7469 6f6e 222c 2063 616c 6375 6c61  ection", calcula
-00017110: 7465 0a20 2020 2020 2020 2020 2020 2044  te.            D
-00017120: 6963 6520 7363 6f72 6573 2073 6c69 6365  ice scores slice
-00017130: 2062 7920 736c 6963 6520 666f 7220 6561   by slice for ea
-00017140: 6368 2073 6c69 6365 2063 6f6e 7461 696e  ch slice contain
-00017150: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00017160: 7365 6c66 2061 6e64 2f6f 7220 6f74 6865  self and/or othe
-00017170: 723a 0a0a 2020 2020 2020 2020 2020 2020  r:..            
-00017180: 2d20 226c 6566 7422 3a20 636f 6e73 6964  - "left": consid
-00017190: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-000171a0: 6f6e 7461 696e 696e 6720 7365 6c66 3b0a  ontaining self;.
-000171b0: 2020 2020 2020 2020 2020 2020 2d20 2272              - "r
-000171c0: 6967 6874 223a 2063 6f6e 7369 6465 7220  ight": consider 
-000171d0: 6f6e 6c79 2073 6c69 6365 7320 636f 6e74  only slices cont
-000171e0: 6169 6e69 6e67 206f 7468 6572 3b0a 2020  aining other;.  
-000171f0: 2020 2020 2020 2020 2020 2d20 2275 6e69            - "uni
-00017200: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
-00017210: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-00017220: 6569 7468 6572 206f 6620 7365 6c66 2061  either of self a
-00017230: 6e64 206f 7468 6572 3b0a 2020 2020 2020  nd other;.      
-00017240: 2020 2020 2020 2d20 2269 6e74 6572 7365        - "interse
-00017250: 6374 696f 6e22 3a20 636f 6e73 6964 6572  ction": consider
-00017260: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-00017270: 6e67 2062 6f74 6820 6f66 2073 656c 6620  ng both of self 
-00017280: 616e 6420 6f74 6865 722e 0a0a 2020 2020  and other...    
-00017290: 2020 2020 2020 2020 4966 2073 6c69 6365          If slice
-000172a0: 5f73 7461 7420 6973 204e 6f6e 652c 2072  _stat is None, r
-000172b0: 6574 7572 6e20 6120 6469 6374 696f 6e61  eturn a dictiona
-000172c0: 7279 2077 6865 7265 206b 6579 7320 6172  ry where keys ar
-000172d0: 650a 2020 2020 2020 2020 2020 2020 736c  e.            sl
-000172e0: 6963 6520 706f 7369 7469 6f6e 7320 616e  ice positions an
-000172f0: 6420 7661 6c75 6573 2061 7265 2074 6865  d values are the
-00017300: 2063 616c 6375 6c61 7465 6420 4469 6365   calculated Dice
-00017310: 2073 636f 7265 732e 0a20 2020 2020 2020   scores..       
-00017320: 2020 2020 204f 7468 6572 7769 7365 2c20       Otherwise, 
-00017330: 7265 7475 726e 2066 6f72 2074 6865 2063  return for the c
-00017340: 616c 6375 6c61 7465 6420 4469 6365 2073  alculated Dice s
-00017350: 636f 7265 7320 7468 6520 7374 6174 6973  cores the statis
-00017360: 7469 630a 2020 2020 2020 2020 2020 2020  tic.            
-00017370: 7370 6563 6966 6965 6420 6279 2073 6c69  specified by sli
-00017380: 6365 5f73 7461 742e 0a0a 2020 2020 2020  ce_stat...      
-00017390: 2020 7661 6c75 655f 666f 725f 6e6f 6e65    value_for_none
-000173a0: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
-000173b0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000173c0: 2020 2046 6f72 2073 696e 676c 655f 736c     For single_sl
-000173d0: 6963 6520 616e 6420 6279 5f73 6c69 6365  ice and by_slice
-000173e0: 2c20 7661 6c75 6520 746f 2062 6520 7265  , value to be re
-000173f0: 7475 726e 6564 2066 6f72 0a20 2020 2020  turned for.     
-00017400: 2020 2020 2020 2073 6c69 6365 7320 7768         slices wh
-00017410: 6572 6520 4469 6365 2073 636f 7265 2069  ere Dice score i
-00017420: 7320 756e 6465 7465 726d 696e 6564 2028  s undetermined (
-00017430: 4e6f 6e65 292e 2020 466f 7220 736c 6963  None).  For slic
-00017440: 655f 7374 6174 2c0a 2020 2020 2020 2020  e_stat,.        
-00017450: 2020 2020 7661 6c75 6520 746f 2073 7562      value to sub
-00017460: 7374 6974 7574 6520 666f 7220 616e 7920  stitute for any 
-00017470: 4e6f 6e65 2076 616c 7565 7320 616d 6f6e  None values amon
-00017480: 6720 7468 6520 696e 7075 7473 0a20 2020  g the inputs.   
-00017490: 2020 2020 2020 2020 2066 6f72 2063 616c           for cal
-000174a0: 6375 6c61 7469 6e67 2073 6c69 6365 2d62  culating slice-b
-000174b0: 6173 6564 2073 7461 7469 7374 6963 2e20  ased statistic. 
-000174c0: 2049 6620 4e6f 6e65 2069 6e20 7468 6520   If None in the 
-000174d0: 6c61 7474 6572 0a20 2020 2020 2020 2020  latter.         
-000174e0: 2020 2063 6173 652c 204e 6f6e 6520 7661     case, None va
-000174f0: 6c75 6573 2061 6d6f 6e67 2074 6865 2069  lues among the i
-00017500: 6e70 7574 7320 6172 6520 6f6d 6974 7465  nputs are omitte
-00017510: 642e 0a0a 2020 2020 2020 2020 736c 6963  d...        slic
-00017520: 655f 7374 6174 203a 2073 7472 2c20 6465  e_stat : str, de
-00017530: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00017540: 2020 2020 2020 2053 696e 676c 652d 7661         Single-va
-00017550: 7269 6162 6c65 2073 7461 7469 7374 6963  riable statistic
-00017560: 2873 2920 746f 2062 6520 7265 7475 726e  (s) to be return
-00017570: 6564 2066 6f72 2073 6c69 6365 2d62 792d  ed for slice-by-
-00017580: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
-00017590: 2020 4469 6365 2073 636f 7265 732e 2020    Dice scores.  
-000175a0: 5468 6973 2073 686f 756c 6420 6265 2074  This should be t
-000175b0: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
-000175c0: 756e 6374 696f 6e20 666f 720a 2020 2020  unction for.    
-000175d0: 2020 2020 2020 2020 6361 6c63 756c 6174          calculat
-000175e0: 696f 6e20 6f66 2074 6865 2073 7461 7469  ion of the stati
-000175f0: 7374 6963 2873 2920 696e 2074 6865 2050  stic(s) in the P
-00017600: 7974 686f 6e20 7374 6174 6973 7469 6373  ython statistics
-00017610: 206d 6f64 756c 653a 0a0a 2020 2020 2020   module:..      
-00017620: 2020 2020 2020 6874 7470 733a 2f2f 646f        https://do
-00017630: 6373 2e70 7974 686f 6e2e 6f72 672f 332f  cs.python.org/3/
-00017640: 6c69 6272 6172 792f 7374 6174 6973 7469  library/statisti
-00017650: 6373 2e68 746d 6c0a 0a20 2020 2020 2020  cs.html..       
-00017660: 2020 2020 2041 7661 696c 6162 6c65 206f       Available o
-00017670: 7074 696f 6e73 2069 6e63 6c75 6465 3a20  ptions include: 
-00017680: 226d 6561 6e22 2c20 226d 6564 6961 6e22  "mean", "median"
-00017690: 2c20 226d 6f64 6522 2c0a 2020 2020 2020  , "mode",.      
-000176a0: 2020 2020 2020 2273 7464 6576 222c 2022        "stdev", "
-000176b0: 7175 616e 7469 6c65 7322 2e20 2044 6973  quantiles".  Dis
-000176c0: 7265 6761 7264 6564 2069 6620 4e6f 6e65  regarded if None
-000176d0: 2e0a 0a20 2020 2020 2020 2020 2020 2049  ...            I
-000176e0: 6620 6279 5f73 6c69 6365 2069 7320 4e6f  f by_slice is No
-000176f0: 6e65 2061 6e64 2073 6c69 6365 5f73 7461  ne and slice_sta
-00017700: 7420 6973 2064 6966 6665 7265 6e74 2066  t is different f
-00017710: 726f 6d20 4e6f 6e65 2c0a 2020 2020 2020  rom None,.      
-00017720: 2020 2020 2020 736b 7274 2e63 6f72 652e        skrt.core.
-00017730: 4465 6661 756c 7473 2829 2e62 795f 736c  Defaults().by_sl
-00017740: 6963 6520 6973 2075 7365 6420 666f 7220  ice is used for 
-00017750: 7468 6520 666f 726d 6572 2e0a 0a20 2020  the former...   
-00017760: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
-00017770: 6b77 6172 6773 203a 2064 6963 742c 2064  kwargs : dict, d
-00017780: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00017790: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-000177a0: 6172 6775 6d65 6e74 7320 746f 2062 6520  arguments to be 
-000177b0: 7061 7373 6564 2074 6f20 6675 6e63 7469  passed to functi
-000177c0: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
-000177d0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-000177e0: 756c 6520 666f 7220 6361 6c63 756c 6174  ule for calculat
-000177f0: 696f 6e20 7265 6c61 7469 7665 2074 6f20  ion relative to 
-00017800: 736c 6963 6520 7661 6c75 6573 2e20 2046  slice values.  F
-00017810: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
-00017820: 2020 2020 2020 2020 6966 2071 7561 6e74          if quant
-00017830: 696c 6573 2061 7265 2072 6571 7569 7265  iles are require
-00017840: 6420 666f 7220 3130 2069 6e74 6572 7661  d for 10 interva
-00017850: 6c73 2c20 7261 7468 6572 2074 6861 6e20  ls, rather than 
-00017860: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-00017870: 7468 6520 6465 6661 756c 7420 6f66 2034  the default of 4
-00017880: 2c20 7468 6973 2063 616e 2062 6520 7370  , this can be sp
-00017890: 6563 6966 6965 6420 7573 696e 673a 0a0a  ecified using:..
-000178a0: 2020 2020 2020 2020 2020 2020 736c 6963              slic
-000178b0: 655f 7374 6174 5f6b 7761 7267 737b 226e  e_stat_kwargs{"n
-000178c0: 2220 3a20 3130 7d0a 0a20 2020 2020 2020  " : 10}..       
-000178d0: 2020 2020 2046 6f72 2061 7661 696c 6162       For availab
-000178e0: 6c65 206b 6579 776f 7264 206f 7074 696f  le keyword optio
-000178f0: 6e73 2c20 7365 6520 646f 6375 6d65 6e74  ns, see document
-00017900: 6174 696f 6e20 6f66 2073 7461 7469 7374  ation of statist
-00017910: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
-00017920: 6d6f 6475 6c65 2061 743a 0a0a 2020 2020  module at:..    
-00017930: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
-00017940: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
-00017950: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
-00017960: 7469 6373 2e68 746d 6c0a 2020 2020 2020  tics.html.      
-00017970: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00017980: 2073 6c69 6365 5f73 7461 743a 0a20 2020   slice_stat:.   
-00017990: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000179a0: 7365 6c66 2e67 6574 5f73 6c69 6365 5f73  self.get_slice_s
-000179b0: 7461 7428 726f 692c 2022 6365 6e74 726f  tat(roi, "centro
-000179c0: 6964 222c 2073 6c69 6365 5f73 7461 742c  id", slice_stat,
-000179d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000179e0: 2020 2020 2062 795f 736c 6963 652c 2076       by_slice, v
-000179f0: 616c 7565 5f66 6f72 5f6e 6f6e 652c 2076  alue_for_none, v
-00017a00: 6965 772c 206d 6574 686f 642c 0a20 2020  iew, method,.   
-00017a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a20: 202a 2a28 736c 6963 655f 7374 6174 5f6b   **(slice_stat_k
-00017a30: 7761 7267 7320 6f72 207b 7d29 290a 0a20  wargs or {})).. 
-00017a40: 2020 2020 2020 2069 6620 6279 5f73 6c69         if by_sli
-00017a50: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00017a60: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
-00017a70: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
-00017a80: 726f 692c 2022 6365 6e74 726f 6964 222c  roi, "centroid",
-00017a90: 2062 795f 736c 6963 652c 0a20 2020 2020   by_slice,.     
-00017aa0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00017ab0: 6965 772c 206d 6574 686f 6429 0a0a 2020  iew, method)..  
-00017ac0: 2020 2020 2020 7468 6973 5f63 656e 7472        this_centr
-00017ad0: 6f69 6420 3d20 6e70 2e61 7272 6179 2873  oid = np.array(s
-00017ae0: 656c 662e 6765 745f 6365 6e74 726f 6964  elf.get_centroid
-00017af0: 280a 2020 2020 2020 2020 2020 2020 7369  (.            si
-00017b00: 6e67 6c65 5f73 6c69 6365 3d73 696e 676c  ngle_slice=singl
-00017b10: 655f 736c 6963 652c 2076 6965 773d 7669  e_slice, view=vi
-00017b20: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
-00017b30: 6478 2c20 706f 733d 706f 732c 0a20 2020  dx, pos=pos,.   
-00017b40: 2020 2020 2020 2020 2075 6e69 7473 3d75           units=u
-00017b50: 6e69 7473 2c20 6d65 7468 6f64 3d6d 6574  nits, method=met
-00017b60: 686f 642c 2066 6f72 6365 3d66 6f72 6365  hod, force=force
-00017b70: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
-00017b80: 2020 2020 6f74 6865 725f 6365 6e74 726f      other_centro
-00017b90: 6964 203d 206e 702e 6172 7261 7928 726f  id = np.array(ro
-00017ba0: 692e 6765 745f 6365 6e74 726f 6964 280a  i.get_centroid(.
-00017bb0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
-00017bc0: 6c65 5f73 6c69 6365 3d73 696e 676c 655f  le_slice=single_
-00017bd0: 736c 6963 652c 2076 6965 773d 7669 6577  slice, view=view
-00017be0: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
-00017bf0: 2c20 706f 733d 706f 732c 0a20 2020 2020  , pos=pos,.     
-00017c00: 2020 2020 2020 2075 6e69 7473 3d75 6e69         units=uni
-00017c10: 7473 2c20 6d65 7468 6f64 3d6d 6574 686f  ts, method=metho
-00017c20: 642c 2066 6f72 6365 3d66 6f72 6365 290a  d, force=force).
-00017c30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00017c40: 2020 6966 204e 6f6e 6520 696e 2074 6869    if None in thi
-00017c50: 735f 6365 6e74 726f 6964 206f 7220 4e6f  s_centroid or No
-00017c60: 6e65 2069 6e20 6f74 6865 725f 6365 6e74  ne in other_cent
-00017c70: 726f 6964 3a0a 2020 2020 2020 2020 2020  roid:.          
-00017c80: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
-00017c90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00017ca0: 2020 2072 6574 7572 6e20 6e70 2e61 7272     return np.arr
-00017cb0: 6179 285b 7661 6c75 655f 666f 725f 6e6f  ay([value_for_no
-00017cc0: 6e65 2c20 7661 6c75 655f 666f 725f 6e6f  ne, value_for_no
-00017cd0: 6e65 5d29 0a20 2020 2020 2020 2020 2020  ne]).           
-00017ce0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00017cf0: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
-00017d00: 2e61 7272 6179 285b 7661 6c75 655f 666f  .array([value_fo
-00017d10: 725f 6e6f 6e65 2c20 7661 6c75 655f 666f  r_none, value_fo
-00017d20: 725f 6e6f 6e65 2c0a 2020 2020 2020 2020  r_none,.        
-00017d30: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-00017d40: 655f 666f 725f 6e6f 6e65 5d29 0a20 2020  e_for_none]).   
-00017d50: 2020 2020 2072 6574 7572 6e20 6f74 6865       return othe
-00017d60: 725f 6365 6e74 726f 6964 202d 2074 6869  r_centroid - thi
-00017d70: 735f 6365 6e74 726f 6964 0a0a 2020 2020  s_centroid..    
-00017d80: 6465 6620 6765 745f 6162 735f 6365 6e74  def get_abs_cent
-00017d90: 726f 6964 5f64 6973 7461 6e63 6528 0a20  roid_distance(. 
-00017da0: 2020 2020 2020 2073 656c 662c 200a 2020         self, .  
-00017db0: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
-00017dc0: 2020 2020 7669 6577 3d22 782d 7922 2c20      view="x-y", 
-00017dd0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
-00017de0: 736c 6963 653d 4661 6c73 652c 0a20 2020  slice=False,.   
-00017df0: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
-00017e00: 7365 2c20 0a20 2020 2020 2020 2073 6c3d  se, .        sl=
-00017e10: 4e6f 6e65 2c0a 2020 2020 2020 2020 6964  None,.        id
-00017e20: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
-00017e30: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
-00017e40: 2020 756e 6974 733d 226d 6d22 2c0a 2020    units="mm",.  
-00017e50: 2020 2020 2020 6d65 7468 6f64 3d4e 6f6e        method=Non
-00017e60: 652c 0a20 2020 2020 2020 2066 6f72 6365  e,.        force
-00017e70: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
-00017e80: 795f 736c 6963 653d 4e6f 6e65 2c0a 2020  y_slice=None,.  
-00017e90: 2020 2020 2020 7661 6c75 655f 666f 725f        value_for_
-00017ea0: 6e6f 6e65 3d4e 6f6e 652c 0a20 2020 2020  none=None,.     
-00017eb0: 2020 2073 6c69 6365 5f73 7461 743d 4e6f     slice_stat=No
-00017ec0: 6e65 2c0a 2020 2020 2020 2020 736c 6963  ne,.        slic
-00017ed0: 655f 7374 6174 5f6b 7761 7267 733d 4e6f  e_stat_kwargs=No
-00017ee0: 6e65 2c0a 2020 2020 2020 2020 293a 0a20  ne,.        ):. 
-00017ef0: 2020 2020 2020 2022 2222 4765 7420 6162         """Get ab
-00017f00: 736f 6c75 7465 2063 656e 7472 6f69 6420  solute centroid 
-00017f10: 6469 7374 616e 6365 2077 6974 6820 7265  distance with re
-00017f20: 7370 6563 7420 746f 2061 6e6f 7468 6572  spect to another
-00017f30: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
-00017f40: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
-00017f50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00017f60: 726f 6920 3a20 524f 490a 2020 2020 2020  roi : ROI.      
-00017f70: 2020 2020 2020 4f74 6865 7220 524f 4920        Other ROI 
-00017f80: 7769 7468 2077 6869 6368 2074 6f20 636f  with which to co
-00017f90: 6d70 6172 6520 6365 6e74 726f 6964 2e0a  mpare centroid..
-00017fa0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
-00017fb0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
-00017fc0: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
-00017fd0: 7269 656e 7461 7469 6f6e 2069 6e20 7768  rientation in wh
-00017fe0: 6963 6820 746f 2067 6574 2063 656e 7472  ich to get centr
-00017ff0: 6f69 6473 2069 6620 7573 696e 6720 6120  oids if using a 
-00018000: 7369 6e67 6c65 2073 6c69 6365 206f 720a  single slice or.
-00018010: 2020 2020 2020 2020 2020 2020 666c 6174              flat
-00018020: 7465 6e69 6e67 2e0a 0a20 2020 2020 2020  tening...       
-00018030: 2073 696e 676c 655f 736c 6963 6520 3a20   single_slice : 
-00018040: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00018050: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00018060: 4966 2054 7275 652c 2074 6865 2063 656e  If True, the cen
-00018070: 7472 6f69 6420 7769 6c6c 2062 6520 7265  troid will be re
-00018080: 7475 726e 6564 2066 6f72 2061 2073 696e  turned for a sin
-00018090: 676c 6520 736c 6963 652e 0a0a 2020 2020  gle slice...    
-000180a0: 2020 2020 666c 6174 7465 6e20 3a20 626f      flatten : bo
-000180b0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-000180c0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-000180d0: 2054 7275 652c 2074 6865 2033 4420 6365   True, the 3D ce
-000180e0: 6e74 726f 6964 2077 696c 6c20 6265 206f  ntroid will be o
-000180f0: 6274 6169 6e65 6420 616e 6420 7468 656e  btained and then
-00018100: 2074 6865 2061 6273 6f6c 7574 6520 0a20   the absolute . 
-00018110: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00018120: 2061 6c6f 6e67 206f 6e6c 7920 7468 6520   along only the 
-00018130: 3244 2061 7865 7320 696e 2074 6865 206f  2D axes in the o
-00018140: 7269 656e 7461 7469 6f6e 2069 6e20 3c76  rientation in <v
-00018150: 6965 773e 2077 696c 6c0a 2020 2020 2020  iew> will.      
-00018160: 2020 2020 2020 6265 2072 6574 7572 6e65        be returne
-00018170: 642e 0a0a 2020 2020 2020 2020 736c 203a  d...        sl :
-00018180: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-00018190: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-000181a0: 6c69 6365 206e 756d 6265 722e 2049 6620  lice number. If 
-000181b0: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
-000181c0: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
-000181d0: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
-000181e0: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
-000181f0: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
-00018200: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
-00018210: 6963 6520 6f66 2065 6163 6820 524f 490a  ice of each ROI.
-00018220: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-00018230: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
-00018240: 2020 2069 6478 203a 2069 6e74 2c20 6465     idx : int, de
-00018250: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00018260: 2020 2020 2020 2041 7272 6179 2069 6e64         Array ind
-00018270: 6578 206f 6620 736c 6963 652e 2049 6620  ex of slice. If 
-00018280: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
-00018290: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
-000182a0: 2073 7570 706c 6965 640a 2020 2020 2020   supplied.      
-000182b0: 2020 2020 2020 6275 7420 3c73 696e 676c        but <singl
-000182c0: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
-000182d0: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
-000182e0: 6963 6520 6f66 2065 6163 6820 524f 490a  ice of each ROI.
-000182f0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-00018300: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
-00018310: 2020 2070 6f73 203a 2066 6c6f 6174 2c20     pos : float, 
-00018320: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00018330: 2020 2020 2020 2020 2053 6c69 6365 2070           Slice p
-00018340: 6f73 6974 696f 6e20 696e 206d 6d2e 2049  osition in mm. I
-00018350: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
-00018360: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
-00018370: 7265 2073 7570 706c 6965 640a 2020 2020  re supplied.    
-00018380: 2020 2020 2020 2020 6275 7420 3c73 696e          but <sin
-00018390: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
-000183a0: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
-000183b0: 736c 6963 6520 6f66 2065 6163 6820 524f  slice of each RO
-000183c0: 490a 2020 2020 2020 2020 2020 2020 7769  I.            wi
-000183d0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
-000183e0: 2020 2020 2075 6e69 7473 203a 2073 7472       units : str
-000183f0: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
-00018400: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
-00018410: 206f 6620 6162 736f 6c75 7465 2063 656e   of absolute cen
-00018420: 7472 6f69 6420 6469 7374 616e 6365 2e20  troid distance. 
-00018430: 4361 6e20 6265 2061 6e79 206f 663a 0a20  Can be any of:. 
-00018440: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00018450: 2022 6d6d 223a 2072 6574 7572 6e20 6365   "mm": return ce
-00018460: 6e74 726f 6964 2070 6f73 6974 696f 6e20  ntroid position 
-00018470: 696e 206d 696c 6c69 6d65 7472 6573 2e0a  in millimetres..
-00018480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018490: 2d20 2276 6f78 656c 7322 3a20 7265 7475  - "voxels": retu
-000184a0: 726e 2063 656e 7472 6f69 6420 706f 7369  rn centroid posi
-000184b0: 7469 6f6e 2069 6e20 7465 726d 7320 6f66  tion in terms of
-000184c0: 2061 7272 6179 2069 6e64 6963 6573 2e0a   array indices..
-000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184e0: 2d20 2273 6c69 6365 223a 2072 6574 7572  - "slice": retur
-000184f0: 6e20 6365 6e74 726f 6964 2070 6f73 6974  n centroid posit
-00018500: 696f 6e20 696e 2074 6572 6d73 206f 6620  ion in terms of 
-00018510: 736c 6963 6520 6e75 6d62 6572 732e 0a0a  slice numbers...
-00018520: 2020 2020 2020 2020 2020 2020 4966 2075              If u
-00018530: 6e69 7473 3d22 766f 7865 6c73 2220 6f72  nits="voxels" or
-00018540: 2022 736c 6963 6522 2069 7320 7265 7175   "slice" is requ
-00018550: 6573 7465 6420 6275 7420 6569 7468 6572  ested but either
-00018560: 2052 4f49 206f 6e6c 7920 6861 7320 0a20   ROI only has . 
-00018570: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
-00018580: 7572 7320 616e 6420 6e6f 206d 6173 6b20  urs and no mask 
-00018590: 7368 6170 652f 766f 7865 6c20 7369 7a65  shape/voxel size
-000185a0: 2069 6e66 6f72 6d61 7469 6f6e 2c20 616e   information, an
-000185b0: 2065 7272 6f72 2077 696c 6c20 6265 200a   error will be .
-000185c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000185d0: 6564 2028 756e 6c65 7373 2061 783d 227a  ed (unless ax="z
-000185e0: 222c 2069 6e20 7768 6963 6820 6361 7365  ", in which case
-000185f0: 2076 6f78 656c 2073 697a 6520 7769 6c6c   voxel size will
-00018600: 2062 6520 696e 6665 7272 6564 200a 2020   be inferred .  
-00018610: 2020 2020 2020 2020 2020 6672 6f6d 2073            from s
-00018620: 7061 6369 6e67 2062 6574 7765 656e 2073  pacing between s
-00018630: 6c69 6365 7329 2e0a 0a20 2020 2020 2020  lices)...       
-00018640: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
-00018650: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00018660: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
-00018670: 6f20 7573 6520 666f 7220 6365 6e74 726f  o use for centro
-00018680: 6964 2063 616c 6375 6c61 7469 6f6e 2e20  id calculation. 
-00018690: 4361 6e20 6265 3a20 0a20 2020 2020 2020  Can be: .       
-000186a0: 2020 2020 2020 2020 202d 2022 636f 6e74           - "cont
-000186b0: 6f75 7222 3a20 6765 7420 6365 6e74 726f  our": get centro
-000186c0: 6964 206f 6620 7368 6170 656c 7920 636f  id of shapely co
-000186d0: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
-000186e0: 2020 2020 2020 2020 2020 2d20 226d 6173            - "mas
-000186f0: 6b22 3a20 6765 7420 6176 6572 6167 6520  k": get average 
-00018700: 706f 7369 7469 6f6e 206f 6620 766f 7865  position of voxe
-00018710: 6c73 2069 6e20 6269 6e61 7279 206d 6173  ls in binary mas
-00018720: 6b2e 0a20 2020 2020 2020 2020 2020 2020  k..             
-00018730: 2020 202d 204e 6f6e 653a 2075 7365 2074     - None: use t
-00018740: 6865 206d 6574 686f 6420 7365 7420 696e  he method set in
-00018750: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
-00018760: 6f6d 5f6d 6574 686f 642e 0a0a 2020 2020  om_method...    
-00018770: 2020 2020 666f 7263 6520 3a20 626f 6f6c      force : bool
-00018780: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
-00018790: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-000187a0: 7565 2c20 7468 6520 676c 6f62 616c 2063  ue, the global c
-000187b0: 656e 7472 6f69 6420 7769 6c6c 2061 6c77  entroid will alw
-000187c0: 6179 7320 6265 2072 6563 616c 6375 6c61  ays be recalcula
-000187d0: 7465 643b 200a 2020 2020 2020 2020 2020  ted; .          
-000187e0: 2020 6f74 6865 7277 6973 652c 2069 7420    otherwise, it 
-000187f0: 7769 6c6c 206f 6e6c 7920 6265 2063 616c  will only be cal
-00018800: 6375 6c61 7465 6420 6966 2069 7420 6861  culated if it ha
-00018810: 7320 6e6f 7420 7965 7420 6265 656e 2063  s not yet been c
-00018820: 6163 6865 6420 0a20 2020 2020 2020 2020  ached .         
-00018830: 2020 2069 6e20 7365 6c66 2e5f 766f 6c75     in self._volu
-00018840: 6d65 2e20 204e 6f74 6520 7468 6174 2069  me.  Note that i
-00018850: 6620 7369 6e67 6c65 5f73 6c69 6365 3d54  f single_slice=T
-00018860: 7275 652c 2074 6865 2063 656e 7472 6f69  rue, the centroi
-00018870: 6420 7769 6c6c 200a 2020 2020 2020 2020  d will .        
-00018880: 2020 2020 616c 7761 7973 2062 6520 7265      always be re
-00018890: 6361 6c63 756c 6174 6564 2e0a 0a20 2020  calculated...   
-000188a0: 2020 2020 2062 795f 736c 6963 6520 3a20       by_slice : 
-000188b0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-000188c0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-000188d0: 206f 6e65 206f 6620 226c 6566 7422 2c20   one of "left", 
-000188e0: 2272 6967 6874 222c 2022 756e 696f 6e22  "right", "union"
-000188f0: 2c20 2269 6e74 6572 7365 6374 696f 6e22  , "intersection"
-00018900: 2c20 6361 6c63 756c 6174 650a 2020 2020  , calculate.    
-00018910: 2020 2020 2020 2020 4469 6365 2073 636f          Dice sco
-00018920: 7265 7320 736c 6963 6520 6279 2073 6c69  res slice by sli
-00018930: 6365 2066 6f72 2065 6163 6820 736c 6963  ce for each slic
-00018940: 6520 636f 6e74 6169 6e69 6e67 0a20 2020  e containing.   
-00018950: 2020 2020 2020 2020 2073 656c 6620 616e           self an
-00018960: 642f 6f72 206f 7468 6572 3a0a 0a20 2020  d/or other:..   
-00018970: 2020 2020 2020 2020 202d 2022 6c65 6674           - "left
-00018980: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
-00018990: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-000189a0: 6e67 2073 656c 663b 0a20 2020 2020 2020  ng self;.       
-000189b0: 2020 2020 202d 2022 7269 6768 7422 3a20       - "right": 
-000189c0: 636f 6e73 6964 6572 206f 6e6c 7920 736c  consider only sl
-000189d0: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-000189e0: 6f74 6865 723b 0a20 2020 2020 2020 2020  other;.         
-000189f0: 2020 202d 2022 756e 696f 6e22 3a20 636f     - "union": co
-00018a00: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
-00018a10: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
-00018a20: 6f66 2073 656c 6620 616e 6420 6f74 6865  of self and othe
-00018a30: 723b 0a20 2020 2020 2020 2020 2020 202d  r;.            -
-00018a40: 2022 696e 7465 7273 6563 7469 6f6e 223a   "intersection":
-00018a50: 2063 6f6e 7369 6465 7220 736c 6963 6573   consider slices
-00018a60: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
-00018a70: 206f 6620 7365 6c66 2061 6e64 206f 7468   of self and oth
-00018a80: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
-00018a90: 2049 6620 736c 6963 655f 7374 6174 2069   If slice_stat i
-00018aa0: 7320 4e6f 6e65 2c20 7265 7475 726e 2061  s None, return a
-00018ab0: 2064 6963 7469 6f6e 6172 7920 7768 6572   dictionary wher
-00018ac0: 6520 6b65 7973 2061 7265 0a20 2020 2020  e keys are.     
-00018ad0: 2020 2020 2020 2073 6c69 6365 2070 6f73         slice pos
-00018ae0: 6974 696f 6e73 2061 6e64 2076 616c 7565  itions and value
-00018af0: 7320 6172 6520 7468 6520 6361 6c63 756c  s are the calcul
-00018b00: 6174 6564 2044 6963 6520 7363 6f72 6573  ated Dice scores
-00018b10: 2e0a 2020 2020 2020 2020 2020 2020 4f74  ..            Ot
-00018b20: 6865 7277 6973 652c 2072 6574 7572 6e20  herwise, return 
-00018b30: 666f 7220 7468 6520 6361 6c63 756c 6174  for the calculat
-00018b40: 6564 2044 6963 6520 7363 6f72 6573 2074  ed Dice scores t
-00018b50: 6865 2073 7461 7469 7374 6963 0a20 2020  he statistic.   
-00018b60: 2020 2020 2020 2020 2073 7065 6369 6669           specifi
-00018b70: 6564 2062 7920 736c 6963 655f 7374 6174  ed by slice_stat
-00018b80: 2e0a 0a20 2020 2020 2020 2076 616c 7565  ...        value
-00018b90: 5f66 6f72 5f6e 6f6e 6520 3a20 666c 6f61  _for_none : floa
-00018ba0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00018bb0: 2020 2020 2020 2020 2020 2020 466f 7220              For 
-00018bc0: 7369 6e67 6c65 5f73 6c69 6365 2061 6e64  single_slice and
-00018bd0: 2062 795f 736c 6963 652c 2076 616c 7565   by_slice, value
-00018be0: 2074 6f20 6265 2072 6574 7572 6e65 6420   to be returned 
-00018bf0: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-00018c00: 736c 6963 6573 2077 6865 7265 2044 6963  slices where Dic
-00018c10: 6520 7363 6f72 6520 6973 2075 6e64 6574  e score is undet
-00018c20: 6572 6d69 6e65 6420 284e 6f6e 6529 2e20  ermined (None). 
-00018c30: 2046 6f72 2073 6c69 6365 5f73 7461 742c   For slice_stat,
-00018c40: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00018c50: 7565 2074 6f20 7375 6273 7469 7475 7465  ue to substitute
-00018c60: 2066 6f72 2061 6e79 204e 6f6e 6520 7661   for any None va
-00018c70: 6c75 6573 2061 6d6f 6e67 2074 6865 2069  lues among the i
-00018c80: 6e70 7574 730a 2020 2020 2020 2020 2020  nputs.          
-00018c90: 2020 666f 7220 6361 6c63 756c 6174 696e    for calculatin
-00018ca0: 6720 736c 6963 652d 6261 7365 6420 7374  g slice-based st
-00018cb0: 6174 6973 7469 632e 2020 4966 204e 6f6e  atistic.  If Non
-00018cc0: 6520 696e 2074 6865 206c 6174 7465 720a  e in the latter.
-00018cd0: 2020 2020 2020 2020 2020 2020 6361 7365              case
-00018ce0: 2c20 4e6f 6e65 2076 616c 7565 7320 616d  , None values am
-00018cf0: 6f6e 6720 7468 6520 696e 7075 7473 2061  ong the inputs a
-00018d00: 7265 206f 6d69 7474 6564 2e0a 0a20 2020  re omitted...   
-00018d10: 2020 2020 2073 6c69 6365 5f73 7461 7420       slice_stat 
-00018d20: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-00018d30: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00018d40: 5369 6e67 6c65 2d76 6172 6961 626c 6520  Single-variable 
-00018d50: 7374 6174 6973 7469 6328 7329 2074 6f20  statistic(s) to 
-00018d60: 6265 2072 6574 7572 6e65 6420 666f 7220  be returned for 
-00018d70: 736c 6963 652d 6279 2d73 6c69 6365 0a20  slice-by-slice. 
-00018d80: 2020 2020 2020 2020 2020 2044 6963 6520             Dice 
-00018d90: 7363 6f72 6573 2e20 2054 6869 7320 7368  scores.  This sh
-00018da0: 6f75 6c64 2062 6520 7468 6520 6e61 6d65  ould be the name
-00018db0: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
-00018dc0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
-00018dd0: 2063 616c 6375 6c61 7469 6f6e 206f 6620   calculation of 
-00018de0: 7468 6520 7374 6174 6973 7469 6328 7329  the statistic(s)
-00018df0: 2069 6e20 7468 6520 5079 7468 6f6e 2073   in the Python s
-00018e00: 7461 7469 7374 6963 7320 6d6f 6475 6c65  tatistics module
-00018e10: 3a0a 0a20 2020 2020 2020 2020 2020 2068  :..            h
-00018e20: 7474 7073 3a2f 2f64 6f63 732e 7079 7468  ttps://docs.pyth
-00018e30: 6f6e 2e6f 7267 2f33 2f6c 6962 7261 7279  on.org/3/library
-00018e40: 2f73 7461 7469 7374 6963 732e 6874 6d6c  /statistics.html
-00018e50: 0a0a 2020 2020 2020 2020 2020 2020 4176  ..            Av
-00018e60: 6169 6c61 626c 6520 6f70 7469 6f6e 7320  ailable options 
-00018e70: 696e 636c 7564 653a 2022 6d65 616e 222c  include: "mean",
-00018e80: 2022 6d65 6469 616e 222c 2022 6d6f 6465   "median", "mode
-00018e90: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00018ea0: 7374 6465 7622 2c20 2271 7561 6e74 696c  stdev", "quantil
-00018eb0: 6573 222e 2020 4469 7372 6567 6172 6465  es".  Disregarde
-00018ec0: 6420 6966 204e 6f6e 652e 0a0a 2020 2020  d if None...    
-00018ed0: 2020 2020 2020 2020 4966 2062 795f 736c          If by_sl
-00018ee0: 6963 6520 6973 204e 6f6e 6520 616e 6420  ice is None and 
-00018ef0: 736c 6963 655f 7374 6174 2069 7320 6469  slice_stat is di
-00018f00: 6666 6572 656e 7420 6672 6f6d 204e 6f6e  fferent from Non
-00018f10: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00018f20: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
-00018f30: 7328 292e 6279 5f73 6c69 6365 2069 7320  s().by_slice is 
-00018f40: 7573 6564 2066 6f72 2074 6865 2066 6f72  used for the for
-00018f50: 6d65 722e 0a0a 2020 2020 2020 2020 736c  mer...        sl
-00018f60: 6963 655f 7374 6174 5f6b 7761 7267 7320  ice_stat_kwargs 
-00018f70: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
-00018f80: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00018f90: 204b 6579 776f 7264 2061 7267 756d 656e   Keyword argumen
-00018fa0: 7473 2074 6f20 6265 2070 6173 7365 6420  ts to be passed 
-00018fb0: 746f 2066 756e 6374 696f 6e20 6f66 2073  to function of s
-00018fc0: 7461 7469 7374 6963 730a 2020 2020 2020  tatistics.      
-00018fd0: 2020 2020 2020 6d6f 6475 6c65 2066 6f72        module for
-00018fe0: 2063 616c 6375 6c61 7469 6f6e 2072 656c   calculation rel
-00018ff0: 6174 6976 6520 746f 2073 6c69 6365 2076  ative to slice v
-00019000: 616c 7565 732e 2020 466f 7220 6578 616d  alues.  For exam
-00019010: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
-00019020: 2069 6620 7175 616e 7469 6c65 7320 6172   if quantiles ar
-00019030: 6520 7265 7175 6972 6564 2066 6f72 2031  e required for 1
-00019040: 3020 696e 7465 7276 616c 732c 2072 6174  0 intervals, rat
-00019050: 6865 7220 7468 616e 2066 6f72 0a20 2020  her than for.   
-00019060: 2020 2020 2020 2020 2074 6865 2064 6566           the def
-00019070: 6175 6c74 206f 6620 342c 2074 6869 7320  ault of 4, this 
-00019080: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
-00019090: 2075 7369 6e67 3a0a 0a20 2020 2020 2020   using:..       
-000190a0: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
-000190b0: 6b77 6172 6773 7b22 6e22 203a 2031 307d  kwargs{"n" : 10}
-000190c0: 0a0a 2020 2020 2020 2020 2020 2020 466f  ..            Fo
-000190d0: 7220 6176 6169 6c61 626c 6520 6b65 7977  r available keyw
-000190e0: 6f72 6420 6f70 7469 6f6e 732c 2073 6565  ord options, see
-000190f0: 2064 6f63 756d 656e 7461 7469 6f6e 206f   documentation o
-00019100: 6620 7374 6174 6973 7469 6373 0a20 2020  f statistics.   
-00019110: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
-00019120: 6174 3a0a 0a20 2020 2020 2020 2020 2020  at:..           
-00019130: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
-00019140: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
-00019150: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
-00019160: 6d6c 0a20 2020 2020 2020 2022 2222 0a20  ml.        """. 
-00019170: 2020 2020 2020 2069 6620 736c 6963 655f         if slice_
-00019180: 7374 6174 3a0a 2020 2020 2020 2020 2020  stat:.          
-00019190: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
-000191a0: 745f 736c 6963 655f 7374 6174 2872 6f69  t_slice_stat(roi
-000191b0: 2c20 2261 6273 5f63 656e 7472 6f69 6422  , "abs_centroid"
-000191c0: 2c20 736c 6963 655f 7374 6174 2c0a 2020  , slice_stat,.  
-000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191e0: 2020 6279 5f73 6c69 6365 2c20 7661 6c75    by_slice, valu
-000191f0: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
-00019200: 2c20 6d65 7468 6f64 2c0a 2020 2020 2020  , method,.      
-00019210: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-00019220: 2873 6c69 6365 5f73 7461 745f 6b77 6172  (slice_stat_kwar
-00019230: 6773 206f 7220 7b7d 2929 0a0a 2020 2020  gs or {}))..    
-00019240: 2020 2020 6966 2062 795f 736c 6963 653a      if by_slice:
-00019250: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00019260: 7572 6e20 7365 6c66 2e67 6574 5f6d 6574  urn self.get_met
-00019270: 7269 635f 6279 5f73 6c69 6365 2872 6f69  ric_by_slice(roi
-00019280: 2c20 2261 6273 5f63 656e 7472 6f69 6422  , "abs_centroid"
-00019290: 2c20 6279 5f73 6c69 6365 2c0a 2020 2020  , by_slice,.    
-000192a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192b0: 7669 6577 2c20 6d65 7468 6f64 290a 0a20  view, method).. 
-000192c0: 2020 2020 2020 2023 2049 6620 666c 6174         # If flat
-000192d0: 7465 6e69 6e67 2c20 6e65 6564 2074 6f20  tening, need to 
-000192e0: 6765 7420 3344 2063 656e 7472 6f69 6420  get 3D centroid 
-000192f0: 7665 6374 6f72 0a20 2020 2020 2020 2069  vector.        i
-00019300: 6620 666c 6174 7465 6e3a 0a20 2020 2020  f flatten:.     
-00019310: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
-00019320: 6963 6520 3d20 4661 6c73 650a 0a20 2020  ice = False..   
-00019330: 2020 2020 2023 2047 6574 2063 656e 7472       # Get centr
-00019340: 6f69 6420 7665 6374 6f72 0a20 2020 2020  oid vector.     
-00019350: 2020 2063 656e 7472 6f69 6420 3d20 7365     centroid = se
-00019360: 6c66 2e67 6574 5f63 656e 7472 6f69 645f  lf.get_centroid_
-00019370: 6469 7374 616e 6365 280a 2020 2020 2020  distance(.      
-00019380: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
-00019390: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
-000193a0: 772c 200a 2020 2020 2020 2020 2020 2020  w, .            
-000193b0: 7369 6e67 6c65 5f73 6c69 6365 3d73 696e  single_slice=sin
-000193c0: 676c 655f 736c 6963 652c 0a20 2020 2020  gle_slice,.     
-000193d0: 2020 2020 2020 2073 6c3d 736c 2c0a 2020         sl=sl,.  
-000193e0: 2020 2020 2020 2020 2020 6964 783d 6964            idx=id
-000193f0: 782c 0a20 2020 2020 2020 2020 2020 2070  x,.            p
-00019400: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
-00019410: 2020 2020 756e 6974 733d 756e 6974 732c      units=units,
-00019420: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-00019430: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
-00019440: 2020 2020 2020 2020 666f 7263 653d 666f          force=fo
-00019450: 7263 652c 0a20 2020 2020 2020 2029 0a0a  rce,.        )..
-00019460: 2020 2020 2020 2020 2320 4966 2063 656e          # If cen
-00019470: 7472 6f69 6420 7761 736e 2774 2061 7661  troid wasn't ava
-00019480: 696c 6162 6c65 2c20 7265 7475 726e 204e  ilable, return N
-00019490: 6f6e 650a 2020 2020 2020 2020 6966 204e  one.        if N
-000194a0: 6f6e 6520 696e 2063 656e 7472 6f69 643a  one in centroid:
-000194b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000194c0: 7572 6e20 7661 6c75 655f 666f 725f 6e6f  urn value_for_no
-000194d0: 6e65 0a0a 2020 2020 2020 2020 2320 4966  ne..        # If
-000194e0: 2066 6c61 7474 656e 696e 672c 2074 616b   flattening, tak
-000194f0: 6520 3220 6178 6573 206f 6e6c 790a 2020  e 2 axes only.  
-00019500: 2020 2020 2020 6966 2066 6c61 7474 656e        if flatten
-00019510: 3a0a 2020 2020 2020 2020 2020 2020 785f  :.            x_
-00019520: 6178 2c20 795f 6178 203d 2073 6b72 742e  ax, y_ax = skrt.
-00019530: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
-00019540: 5b76 6965 775d 0a20 2020 2020 2020 2020  [view].         
-00019550: 2020 2063 656e 7472 6f69 6420 3d20 6e70     centroid = np
-00019560: 2e61 7272 6179 285b 6365 6e74 726f 6964  .array([centroid
-00019570: 5b78 5f61 785d 2c20 6365 6e74 726f 6964  [x_ax], centroid
-00019580: 5b79 5f61 785d 5d29 0a0a 2020 2020 2020  [y_ax]])..      
-00019590: 2020 2320 5265 7475 726e 206d 6167 6e69    # Return magni
-000195a0: 7475 6465 206f 6620 7665 6374 6f72 0a20  tude of vector. 
-000195b0: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
-000195c0: 2e6c 696e 616c 672e 6e6f 726d 2863 656e  .linalg.norm(cen
-000195d0: 7472 6f69 6429 0a0a 2020 2020 6465 6620  troid)..    def 
-000195e0: 6765 745f 6469 6365 280a 2020 2020 2020  get_dice(.      
-000195f0: 2020 7365 6c66 2c20 0a20 2020 2020 2020    self, .       
-00019600: 206f 7468 6572 2c20 0a20 2020 2020 2020   other, .       
-00019610: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
-00019620: 6c73 652c 0a20 2020 2020 2020 2076 6965  lse,.        vie
-00019630: 773d 2278 2d79 222c 200a 2020 2020 2020  w="x-y", .      
-00019640: 2020 736c 3d4e 6f6e 652c 200a 2020 2020    sl=None, .    
-00019650: 2020 2020 6964 783d 4e6f 6e65 2c20 0a20      idx=None, . 
-00019660: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
-00019670: 200a 2020 2020 2020 2020 6d65 7468 6f64   .        method
-00019680: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
-00019690: 6c61 7474 656e 3d46 616c 7365 2c0a 2020  latten=False,.  
-000196a0: 2020 2020 2020 6279 5f73 6c69 6365 3d4e        by_slice=N
-000196b0: 6f6e 652c 0a20 2020 2020 2020 2076 616c  one,.        val
-000196c0: 7565 5f66 6f72 5f6e 6f6e 653d 4e6f 6e65  ue_for_none=None
-000196d0: 2c0a 2020 2020 2020 2020 736c 6963 655f  ,.        slice_
-000196e0: 7374 6174 3d4e 6f6e 652c 0a20 2020 2020  stat=None,.     
-000196f0: 2020 2073 6c69 6365 5f73 7461 745f 6b77     slice_stat_kw
-00019700: 6172 6773 3d4e 6f6e 652c 0a20 2020 2029  args=None,.    )
-00019710: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00019720: 2020 2020 2020 4765 7420 4469 6365 2073        Get Dice s
-00019730: 636f 7265 2077 6974 6820 7265 7370 6563  core with respec
-00019740: 7420 746f 2061 6e6f 7468 6572 2052 4f49  t to another ROI
-00019750: 2c0a 2020 2020 2020 2020 676c 6f62 616c  ,.        global
-00019760: 6c79 2c20 6f6e 2061 2073 696e 676c 6520  ly, on a single 
-00019770: 736c 6963 652c 2073 6c69 6365 2062 7920  slice, slice by 
-00019780: 736c 6963 652c 206f 7220 736c 6963 6520  slice, or slice 
-00019790: 6176 6572 6167 6564 2e0a 0a20 2020 2020  averaged...     
-000197a0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-000197b0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-000197c0: 2020 2020 6f74 6865 7220 3a20 524f 490a      other : ROI.
-000197d0: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
-000197e0: 7220 524f 4920 746f 2063 6f6d 7061 7265  r ROI to compare
-000197f0: 2077 6974 6820 7468 6973 2052 4f49 2e0a   with this ROI..
-00019800: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
-00019810: 736c 6963 6520 3a20 626f 6f6c 2c20 6465  slice : bool, de
-00019820: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00019830: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-00019840: 2c20 7468 6520 676c 6f62 616c 2033 4420  , the global 3D 
-00019850: 4469 6365 2073 636f 7265 206f 6620 7468  Dice score of th
-00019860: 6520 6675 6c6c 2052 4f49 7320 7769 6c6c  e full ROIs will
-00019870: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
-00019880: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
-00019890: 6973 652c 2074 6865 2032 4420 4469 6365  ise, the 2D Dice
-000198a0: 2073 636f 7265 206f 6e20 6120 7369 6e67   score on a sing
-000198b0: 6c65 2073 6c69 6365 2077 696c 6c20 6265  le slice will be
-000198c0: 2072 6574 7572 6e65 642e 0a0a 2020 2020   returned...    
-000198d0: 2020 2020 7669 6577 203a 2073 7472 2c20      view : str, 
-000198e0: 6465 6661 756c 743d 2278 2d79 220a 2020  default="x-y".  
-000198f0: 2020 2020 2020 2020 2020 4f72 6965 6e74            Orient
-00019900: 6174 696f 6e20 6f66 2073 6c69 6365 206f  ation of slice o
-00019910: 6e20 7768 6963 6820 746f 2067 6574 2044  n which to get D
-00019920: 6963 6520 7363 6f72 652e 204f 6e6c 7920  ice score. Only 
-00019930: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
-00019940: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-00019950: 653d 5472 7565 2e20 4966 2075 7369 6e67  e=True. If using
-00019960: 2c20 3c61 783e 206d 7573 7420 6265 2061  , <ax> must be a
-00019970: 6e20 6178 6973 2074 6861 7420 6c69 6573  n axis that lies
-00019980: 2061 6c6f 6e67 0a20 2020 2020 2020 2020   along.         
-00019990: 2020 2074 6865 2073 6c69 6365 2069 6e20     the slice in 
-000199a0: 7468 6973 206f 7269 656e 7461 7469 6f6e  this orientation
-000199b0: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
-000199c0: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-000199d0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-000199e0: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
-000199f0: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-00019a00: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-00019a10: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
-00019a20: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
-00019a30: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-00019a40: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-00019a50: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
-00019a60: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-00019a70: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
-00019a80: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00019a90: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
-00019aa0: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
-00019ab0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-00019ac0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-00019ad0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-00019ae0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-00019af0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-00019b00: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-00019b10: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
-00019b20: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
-00019b30: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
-00019b40: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-00019b50: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00019b60: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
-00019b70: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
-00019b80: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-00019b90: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
-00019ba0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
-00019bb0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
-00019bc0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
-00019bd0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-00019be0: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
-00019bf0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00019c00: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
-00019c10: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00019c20: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
-00019c30: 2075 7365 2066 6f72 2044 6963 6520 7363   use for Dice sc
-00019c40: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
-00019c50: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
-00019c60: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
-00019c70: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
-00019c80: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
-00019c90: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
-00019ca0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
-00019cb0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-00019cc0: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
-00019cd0: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
-00019ce0: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
-00019cf0: 2020 2020 2020 2020 2020 2020 202d 204e               - N
-00019d00: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
-00019d10: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
-00019d20: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
-00019d30: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
-00019d40: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
-00019d50: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00019d60: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00019d70: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
-00019d80: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
-00019d90: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
-00019da0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
-00019db0: 2020 2020 2020 2074 6865 2044 6963 6520         the Dice 
-00019dc0: 7363 6f72 6520 6f66 2074 6865 2066 6c61  score of the fla
-00019dd0: 7474 656e 6564 2073 6c69 6365 7320 7769  ttened slices wi
-00019de0: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
-00019df0: 4f6e 6c79 200a 2020 2020 2020 2020 2020  Only .          
-00019e00: 2020 6176 6169 6c61 626c 6520 6966 206d    available if m
-00019e10: 6574 686f 643d 226d 6173 6b22 2e0a 0a20  ethod="mask"... 
-00019e20: 2020 2020 2020 2062 795f 736c 6963 6520         by_slice 
-00019e30: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-00019e40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00019e50: 4966 206f 6e65 206f 6620 226c 6566 7422  If one of "left"
-00019e60: 2c20 2272 6967 6874 222c 2022 756e 696f  , "right", "unio
-00019e70: 6e22 2c20 2269 6e74 6572 7365 6374 696f  n", "intersectio
-00019e80: 6e22 2c20 6361 6c63 756c 6174 650a 2020  n", calculate.  
-00019e90: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
-00019ea0: 636f 7265 7320 736c 6963 6520 6279 2073  cores slice by s
-00019eb0: 6c69 6365 2066 6f72 2065 6163 6820 736c  lice for each sl
-00019ec0: 6963 6520 636f 6e74 6169 6e69 6e67 0a20  ice containing. 
-00019ed0: 2020 2020 2020 2020 2020 2073 656c 6620             self 
-00019ee0: 616e 642f 6f72 206f 7468 6572 3a0a 0a20  and/or other:.. 
-00019ef0: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
-00019f00: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
-00019f10: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-00019f20: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
-00019f30: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
-00019f40: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
-00019f50: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-00019f60: 6720 6f74 6865 723b 0a20 2020 2020 2020  g other;.       
-00019f70: 2020 2020 202d 2022 756e 696f 6e22 3a20       - "union": 
-00019f80: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
-00019f90: 636f 6e74 6169 6e69 6e67 2065 6974 6865  containing eithe
-00019fa0: 7220 6f66 2073 656c 6620 616e 6420 6f74  r of self and ot
-00019fb0: 6865 723b 0a20 2020 2020 2020 2020 2020  her;.           
-00019fc0: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
-00019fd0: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
-00019fe0: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
-00019ff0: 7468 206f 6620 7365 6c66 2061 6e64 206f  th of self and o
-0001a000: 7468 6572 2e0a 0a20 2020 2020 2020 2020  ther...         
-0001a010: 2020 2049 6620 736c 6963 655f 7374 6174     If slice_stat
-0001a020: 2069 7320 4e6f 6e65 2c20 7265 7475 726e   is None, return
-0001a030: 2061 2064 6963 7469 6f6e 6172 7920 7768   a dictionary wh
-0001a040: 6572 6520 6b65 7973 2061 7265 0a20 2020  ere keys are.   
-0001a050: 2020 2020 2020 2020 2073 6c69 6365 2070           slice p
-0001a060: 6f73 6974 696f 6e73 2061 6e64 2076 616c  ositions and val
-0001a070: 7565 7320 6172 6520 7468 6520 6361 6c63  ues are the calc
-0001a080: 756c 6174 6564 2044 6963 6520 7363 6f72  ulated Dice scor
-0001a090: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-0001a0a0: 4f74 6865 7277 6973 652c 2072 6574 7572  Otherwise, retur
-0001a0b0: 6e20 666f 7220 7468 6520 6361 6c63 756c  n for the calcul
-0001a0c0: 6174 6564 2044 6963 6520 7363 6f72 6573  ated Dice scores
-0001a0d0: 2074 6865 2073 7461 7469 7374 6963 0a20   the statistic. 
-0001a0e0: 2020 2020 2020 2020 2020 2073 7065 6369             speci
-0001a0f0: 6669 6564 2062 7920 736c 6963 655f 7374  fied by slice_st
-0001a100: 6174 2e0a 0a20 2020 2020 2020 2076 616c  at...        val
-0001a110: 7565 5f66 6f72 5f6e 6f6e 6520 3a20 666c  ue_for_none : fl
-0001a120: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
-0001a130: 650a 2020 2020 2020 2020 2020 2020 466f  e.            Fo
-0001a140: 7220 7369 6e67 6c65 5f73 6c69 6365 2061  r single_slice a
-0001a150: 6e64 2062 795f 736c 6963 652c 2076 616c  nd by_slice, val
-0001a160: 7565 2074 6f20 6265 2072 6574 7572 6e65  ue to be returne
-0001a170: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
-0001a180: 2020 736c 6963 6573 2077 6865 7265 2044    slices where D
-0001a190: 6963 6520 7363 6f72 6520 6973 2075 6e64  ice score is und
-0001a1a0: 6574 6572 6d69 6e65 6420 284e 6f6e 6529  etermined (None)
-0001a1b0: 2e20 2046 6f72 2073 6c69 6365 5f73 7461  .  For slice_sta
-0001a1c0: 742c 0a20 2020 2020 2020 2020 2020 2076  t,.            v
-0001a1d0: 616c 7565 2074 6f20 7375 6273 7469 7475  alue to substitu
-0001a1e0: 7465 2066 6f72 2061 6e79 204e 6f6e 6520  te for any None 
-0001a1f0: 7661 6c75 6573 2061 6d6f 6e67 2074 6865  values among the
-0001a200: 2069 6e70 7574 730a 2020 2020 2020 2020   inputs.        
-0001a210: 2020 2020 666f 7220 6361 6c63 756c 6174      for calculat
-0001a220: 696e 6720 736c 6963 652d 6261 7365 6420  ing slice-based 
-0001a230: 7374 6174 6973 7469 632e 2020 4966 204e  statistic.  If N
-0001a240: 6f6e 6520 696e 2074 6865 206c 6174 7465  one in the latte
-0001a250: 720a 2020 2020 2020 2020 2020 2020 6361  r.            ca
-0001a260: 7365 2c20 4e6f 6e65 2076 616c 7565 7320  se, None values 
-0001a270: 616d 6f6e 6720 7468 6520 696e 7075 7473  among the inputs
-0001a280: 2061 7265 206f 6d69 7474 6564 2e0a 0a20   are omitted... 
-0001a290: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
-0001a2a0: 7420 3a20 7374 722c 2064 6566 6175 6c74  t : str, default
-0001a2b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0001a2c0: 2020 5369 6e67 6c65 2d76 6172 6961 626c    Single-variabl
-0001a2d0: 6520 7374 6174 6973 7469 6328 7329 2074  e statistic(s) t
-0001a2e0: 6f20 6265 2072 6574 7572 6e65 6420 666f  o be returned fo
-0001a2f0: 7220 736c 6963 652d 6279 2d73 6c69 6365  r slice-by-slice
-0001a300: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
-0001a310: 6520 7363 6f72 6573 2e20 2054 6869 7320  e scores.  This 
-0001a320: 7368 6f75 6c64 2062 6520 7468 6520 6e61  should be the na
-0001a330: 6d65 206f 6620 7468 6520 6675 6e63 7469  me of the functi
-0001a340: 6f6e 2066 6f72 0a20 2020 2020 2020 2020  on for.         
-0001a350: 2020 2063 616c 6375 6c61 7469 6f6e 206f     calculation o
-0001a360: 6620 7468 6520 7374 6174 6973 7469 6328  f the statistic(
-0001a370: 7329 2069 6e20 7468 6520 5079 7468 6f6e  s) in the Python
-0001a380: 2073 7461 7469 7374 6963 7320 6d6f 6475   statistics modu
-0001a390: 6c65 3a0a 0a20 2020 2020 2020 2020 2020  le:..           
-0001a3a0: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
-0001a3b0: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
-0001a3c0: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
-0001a3d0: 6d6c 0a0a 2020 2020 2020 2020 2020 2020  ml..            
-0001a3e0: 4176 6169 6c61 626c 6520 6f70 7469 6f6e  Available option
-0001a3f0: 7320 696e 636c 7564 653a 2022 6d65 616e  s include: "mean
-0001a400: 222c 2022 6d65 6469 616e 222c 2022 6d6f  ", "median", "mo
-0001a410: 6465 222c 0a20 2020 2020 2020 2020 2020  de",.           
-0001a420: 2022 7374 6465 7622 2c20 2271 7561 6e74   "stdev", "quant
-0001a430: 696c 6573 222e 2020 4469 7372 6567 6172  iles".  Disregar
-0001a440: 6465 6420 6966 204e 6f6e 652e 0a0a 2020  ded if None...  
-0001a450: 2020 2020 2020 2020 2020 4966 2062 795f            If by_
-0001a460: 736c 6963 6520 6973 204e 6f6e 6520 616e  slice is None an
-0001a470: 6420 736c 6963 655f 7374 6174 2069 7320  d slice_stat is 
-0001a480: 6469 6666 6572 656e 7420 6672 6f6d 204e  different from N
-0001a490: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0001a4a0: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
-0001a4b0: 6c74 7328 292e 6279 5f73 6c69 6365 2069  lts().by_slice i
-0001a4c0: 7320 7573 6564 2066 6f72 2074 6865 2066  s used for the f
-0001a4d0: 6f72 6d65 722e 0a0a 2020 2020 2020 2020  ormer...        
-0001a4e0: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
-0001a4f0: 7320 3a20 6469 6374 2c20 6465 6661 756c  s : dict, defaul
-0001a500: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0001a510: 2020 204b 6579 776f 7264 2061 7267 756d     Keyword argum
-0001a520: 656e 7473 2074 6f20 6265 2070 6173 7365  ents to be passe
-0001a530: 6420 746f 2066 756e 6374 696f 6e20 6f66  d to function of
-0001a540: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
-0001a550: 2020 2020 2020 2020 6d6f 6475 6c65 2066          module f
-0001a560: 6f72 2063 616c 6375 6c61 7469 6f6e 2072  or calculation r
-0001a570: 656c 6174 6976 6520 746f 2073 6c69 6365  elative to slice
-0001a580: 2076 616c 7565 732e 2020 466f 7220 6578   values.  For ex
-0001a590: 616d 706c 652c 0a20 2020 2020 2020 2020  ample,.         
-0001a5a0: 2020 2069 6620 7175 616e 7469 6c65 7320     if quantiles 
-0001a5b0: 6172 6520 7265 7175 6972 6564 2066 6f72  are required for
-0001a5c0: 2031 3020 696e 7465 7276 616c 732c 2072   10 intervals, r
-0001a5d0: 6174 6865 7220 7468 616e 2066 6f72 0a20  ather than for. 
-0001a5e0: 2020 2020 2020 2020 2020 2074 6865 2064             the d
-0001a5f0: 6566 6175 6c74 206f 6620 342c 2074 6869  efault of 4, thi
-0001a600: 7320 6361 6e20 6265 2073 7065 6369 6669  s can be specifi
-0001a610: 6564 2075 7369 6e67 3a0a 0a20 2020 2020  ed using:..     
-0001a620: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
-0001a630: 745f 6b77 6172 6773 7b22 6e22 203a 2031  t_kwargs{"n" : 1
-0001a640: 307d 0a0a 2020 2020 2020 2020 2020 2020  0}..            
-0001a650: 466f 7220 6176 6169 6c61 626c 6520 6b65  For available ke
-0001a660: 7977 6f72 6420 6f70 7469 6f6e 732c 2073  yword options, s
-0001a670: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
-0001a680: 206f 6620 7374 6174 6973 7469 6373 0a20   of statistics. 
-0001a690: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-0001a6a0: 6520 6174 3a0a 0a20 2020 2020 2020 2020  e at:..         
-0001a6b0: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
-0001a6c0: 7079 7468 6f6e 2e6f 7267 2f33 2f6c 6962  python.org/3/lib
-0001a6d0: 7261 7279 2f73 7461 7469 7374 6963 732e  rary/statistics.
-0001a6e0: 6874 6d6c 0a20 2020 2020 2020 2022 2222  html.        """
-0001a6f0: 0a20 2020 2020 2020 2069 6620 736c 6963  .        if slic
-0001a700: 655f 7374 6174 3a0a 2020 2020 2020 2020  e_stat:.        
-0001a710: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001a720: 6765 745f 736c 6963 655f 7374 6174 286f  get_slice_stat(o
-0001a730: 7468 6572 2c20 2264 6963 6522 2c20 736c  ther, "dice", sl
-0001a740: 6963 655f 7374 6174 2c20 6279 5f73 6c69  ice_stat, by_sli
-0001a750: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-0001a760: 2020 2020 2020 2020 7661 6c75 655f 666f          value_fo
-0001a770: 725f 6e6f 6e65 2c20 7669 6577 2c20 6d65  r_none, view, me
-0001a780: 7468 6f64 2c20 2a2a 2873 6c69 6365 5f73  thod, **(slice_s
-0001a790: 7461 745f 6b77 6172 6773 206f 7220 7b7d  tat_kwargs or {}
-0001a7a0: 2929 0a0a 2020 2020 2020 2020 6966 2062  ))..        if b
-0001a7b0: 795f 736c 6963 653a 0a20 2020 2020 2020  y_slice:.       
-0001a7c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001a7d0: 2e67 6574 5f6d 6574 7269 635f 6279 5f73  .get_metric_by_s
-0001a7e0: 6c69 6365 286f 7468 6572 2c20 2264 6963  lice(other, "dic
-0001a7f0: 6522 2c20 6279 5f73 6c69 6365 2c0a 2020  e", by_slice,.  
-0001a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a810: 2020 7669 6577 2c20 6d65 7468 6f64 290a    view, method).
-0001a820: 0a20 2020 2020 2020 2069 6e74 6572 7365  .        interse
-0001a830: 6374 696f 6e2c 2075 6e69 6f6e 2c20 6d65  ction, union, me
-0001a840: 616e 5f73 697a 6520 3d20 7365 6c66 2e67  an_size = self.g
-0001a850: 6574 5f69 6e74 6572 7365 6374 696f 6e5f  et_intersection_
-0001a860: 756e 696f 6e5f 7369 7a65 280a 2020 2020  union_size(.    
-0001a870: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-0001a880: 722c 2073 696e 676c 655f 736c 6963 652c  r, single_slice,
-0001a890: 2076 6965 772c 2073 6c2c 2069 6478 2c20   view, sl, idx, 
-0001a8a0: 706f 732c 206d 6574 686f 642c 2066 6c61  pos, method, fla
-0001a8b0: 7474 656e 290a 0a20 2020 2020 2020 2072  tten)..        r
-0001a8c0: 6574 7572 6e20 2869 6e74 6572 7365 6374  eturn (intersect
-0001a8d0: 696f 6e20 2f20 6d65 616e 5f73 697a 6520  ion / mean_size 
-0001a8e0: 6966 206d 6561 6e5f 7369 7a65 2065 6c73  if mean_size els
-0001a8f0: 6520 7661 6c75 655f 666f 725f 6e6f 6e65  e value_for_none
-0001a900: 290a 0a20 2020 2064 6566 2067 6574 5f6a  )..    def get_j
-0001a910: 6163 6361 7264 280a 2020 2020 2020 2020  accard(.        
-0001a920: 7365 6c66 2c20 0a20 2020 2020 2020 206f  self, .        o
-0001a930: 7468 6572 2c20 0a20 2020 2020 2020 2073  ther, .        s
-0001a940: 696e 676c 655f 736c 6963 653d 4661 6c73  ingle_slice=Fals
-0001a950: 652c 0a20 2020 2020 2020 2076 6965 773d  e,.        view=
-0001a960: 2278 2d79 222c 200a 2020 2020 2020 2020  "x-y", .        
-0001a970: 736c 3d4e 6f6e 652c 200a 2020 2020 2020  sl=None, .      
-0001a980: 2020 6964 783d 4e6f 6e65 2c20 0a20 2020    idx=None, .   
-0001a990: 2020 2020 2070 6f73 3d4e 6f6e 652c 200a       pos=None, .
-0001a9a0: 2020 2020 2020 2020 6d65 7468 6f64 3d4e          method=N
-0001a9b0: 6f6e 652c 0a20 2020 2020 2020 2066 6c61  one,.        fla
-0001a9c0: 7474 656e 3d46 616c 7365 2c0a 2020 2020  tten=False,.    
-0001a9d0: 2020 2020 6279 5f73 6c69 6365 3d4e 6f6e      by_slice=Non
-0001a9e0: 652c 0a20 2020 2020 2020 2076 616c 7565  e,.        value
-0001a9f0: 5f66 6f72 5f6e 6f6e 653d 4e6f 6e65 2c0a  _for_none=None,.
-0001aa00: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-0001aa10: 6174 3d4e 6f6e 652c 0a20 2020 2020 2020  at=None,.       
-0001aa20: 2073 6c69 6365 5f73 7461 745f 6b77 6172   slice_stat_kwar
-0001aa30: 6773 3d4e 6f6e 652c 0a20 2020 2029 3a0a  gs=None,.    ):.
-0001aa40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001aa50: 2020 2020 4765 7420 4a61 6363 6172 6420      Get Jaccard 
-0001aa60: 696e 6465 7820 7769 7468 2072 6573 7065  index with respe
-0001aa70: 6374 2074 6f20 616e 6f74 6865 7220 524f  ct to another RO
-0001aa80: 492e 0a0a 2020 2020 2020 2020 5468 6520  I...        The 
-0001aa90: 4a61 6363 6172 6420 696e 6465 7820 6d61  Jaccard index ma
-0001aaa0: 7920 6265 206f 6274 6169 6e65 6420 6569  y be obtained ei
-0001aab0: 7468 6572 2067 6c6f 6261 6c6c 7920 6f72  ther globally or
-0001aac0: 206f 6e20 6120 0a20 2020 2020 2020 2073   on a .        s
-0001aad0: 696e 676c 6520 736c 6963 652e 0a0a 2020  ingle slice...  
-0001aae0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0001aaf0: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
-0001ab00: 2020 2020 2020 206f 7468 6572 203a 2052         other : R
-0001ab10: 4f49 0a20 2020 2020 2020 2020 2020 204f  OI.            O
-0001ab20: 7468 6572 2052 4f49 2074 6f20 636f 6d70  ther ROI to comp
-0001ab30: 6172 6520 7769 7468 2074 6869 7320 524f  are with this RO
-0001ab40: 492e 0a0a 2020 2020 2020 2020 7369 6e67  I...        sing
-0001ab50: 6c65 5f73 6c69 6365 203a 2062 6f6f 6c2c  le_slice : bool,
-0001ab60: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-0001ab70: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
-0001ab80: 6c73 652c 2074 6865 2067 6c6f 6261 6c20  lse, the global 
-0001ab90: 3344 204a 6163 6361 7264 2069 6e64 6578  3D Jaccard index
-0001aba0: 206f 6620 7468 6520 6675 6c6c 2052 4f49   of the full ROI
-0001abb0: 7320 7769 6c6c 2062 650a 2020 2020 2020  s will be.      
-0001abc0: 2020 2020 2020 7265 7475 726e 6564 3b20        returned; 
-0001abd0: 6f74 6865 7277 6973 652c 2074 6865 2032  otherwise, the 2
-0001abe0: 4420 4a61 6363 6172 6420 696e 6465 7820  D Jaccard index 
-0001abf0: 6f6e 2061 2073 696e 676c 6520 736c 6963  on a single slic
-0001ac00: 650a 2020 2020 2020 2020 2020 2020 7769  e.            wi
-0001ac10: 6c6c 2062 6520 7265 7475 726e 6564 2e0a  ll be returned..
-0001ac20: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
-0001ac30: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
-0001ac40: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
-0001ac50: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
-0001ac60: 6963 6520 6f6e 2077 6869 6368 2074 6f20  ice on which to 
-0001ac70: 6765 7420 4a61 6363 6172 6420 696e 6465  get Jaccard inde
-0001ac80: 782e 204f 6e6c 7920 7573 6564 2069 6620  x. Only used if 
-0001ac90: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-0001aca0: 676c 655f 736c 6963 653d 5472 7565 2e20  gle_slice=True. 
-0001acb0: 4966 2075 7369 6e67 2c20 3c61 783e 206d  If using, <ax> m
-0001acc0: 7573 7420 6265 2061 6e20 6178 6973 2074  ust be an axis t
-0001acd0: 6861 7420 6c69 6573 2061 6c6f 6e67 0a20  hat lies along. 
-0001ace0: 2020 2020 2020 2020 2020 2074 6865 2073             the s
-0001acf0: 6c69 6365 2069 6e20 7468 6973 206f 7269  lice in this ori
-0001ad00: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
-0001ad10: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
-0001ad20: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001ad30: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
-0001ad40: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
-0001ad50: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-0001ad60: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
-0001ad70: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
-0001ad80: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-0001ad90: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-0001ada0: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-0001adb0: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
-0001adc0: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
-0001add0: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
-0001ade0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0001adf0: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
-0001ae00: 2073 6c69 6365 2e20 4966 206e 6f6e 6520   slice. If none 
-0001ae10: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-0001ae20: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-0001ae30: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-0001ae40: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-0001ae50: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-0001ae60: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0001ae70: 6620 7468 6973 2052 4f49 2077 696c 6c20  f this ROI will 
-0001ae80: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-0001ae90: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
-0001aea0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0001aeb0: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
-0001aec0: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
-0001aed0: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-0001aee0: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-0001aef0: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
-0001af00: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
-0001af10: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-0001af20: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-0001af30: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
-0001af40: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-0001af50: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
-0001af60: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-0001af70: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
-0001af80: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-0001af90: 2044 6963 6520 7363 6f72 6520 6361 6c63   Dice score calc
-0001afa0: 756c 6174 696f 6e2e 2043 616e 2062 653a  ulation. Can be:
-0001afb0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0001afc0: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
-0001afd0: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
-0001afe0: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
-0001aff0: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
-0001b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b010: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
-0001b020: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
-0001b030: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
-0001b040: 736b 732e 0a20 2020 2020 2020 2020 2020  sks..           
-0001b050: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
-0001b060: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
-0001b070: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
-0001b080: 6765 6f6d 5f6d 6574 686f 642e 0a0a 2020  geom_method...  
-0001b090: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
-0001b0a0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-0001b0b0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0001b0c0: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
-0001b0d0: 6365 7320 7769 6c6c 2062 6520 666c 6174  ces will be flat
-0001b0e0: 7465 6e65 6420 696e 2074 6865 2067 6976  tened in the giv
-0001b0f0: 656e 206f 7269 656e 7461 7469 6f6e 2061  en orientation a
-0001b100: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
-0001b110: 6865 2044 6963 6520 7363 6f72 6520 6f66  he Dice score of
-0001b120: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
-0001b130: 6c69 6365 7320 7769 6c6c 2062 6520 7265  lices will be re
-0001b140: 7475 726e 6564 2e20 4f6e 6c79 200a 2020  turned. Only .  
-0001b150: 2020 2020 2020 2020 2020 6176 6169 6c61            availa
-0001b160: 626c 6520 6966 206d 6574 686f 643d 226d  ble if method="m
-0001b170: 6173 6b22 2e0a 0a20 2020 2020 2020 2062  ask"...        b
-0001b180: 795f 736c 6963 6520 3a20 7374 722c 2064  y_slice : str, d
-0001b190: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0001b1a0: 2020 2020 2020 2020 4966 206f 6e65 206f          If one o
-0001b1b0: 6620 226c 6566 7422 2c20 2272 6967 6874  f "left", "right
-0001b1c0: 222c 2022 756e 696f 6e22 2c20 2269 6e74  ", "union", "int
-0001b1d0: 6572 7365 6374 696f 6e22 2c20 6361 6c63  ersection", calc
-0001b1e0: 756c 6174 650a 2020 2020 2020 2020 2020  ulate.          
-0001b1f0: 2020 4469 6365 2073 636f 7265 7320 736c    Dice scores sl
-0001b200: 6963 6520 6279 2073 6c69 6365 2066 6f72  ice by slice for
-0001b210: 2065 6163 6820 736c 6963 6520 636f 6e74   each slice cont
-0001b220: 6169 6e69 6e67 0a20 2020 2020 2020 2020  aining.         
-0001b230: 2020 2073 656c 6620 616e 642f 6f72 206f     self and/or o
-0001b240: 7468 6572 3a0a 0a20 2020 2020 2020 2020  ther:..         
-0001b250: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
-0001b260: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
-0001b270: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
-0001b280: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
-0001b290: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
-0001b2a0: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-0001b2b0: 6f6e 7461 696e 696e 6720 6f74 6865 723b  ontaining other;
-0001b2c0: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
-0001b2d0: 756e 696f 6e22 3a20 636f 6e73 6964 6572  union": consider
-0001b2e0: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-0001b2f0: 6e67 2065 6974 6865 7220 6f66 2073 656c  ng either of sel
-0001b300: 6620 616e 6420 6f74 6865 723b 0a20 2020  f and other;.   
-0001b310: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
-0001b320: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
-0001b330: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
-0001b340: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
-0001b350: 6c66 2061 6e64 206f 7468 6572 2e0a 0a20  lf and other... 
-0001b360: 2020 2020 2020 2020 2020 2049 6620 736c             If sl
-0001b370: 6963 655f 7374 6174 2069 7320 4e6f 6e65  ice_stat is None
-0001b380: 2c20 7265 7475 726e 2061 2064 6963 7469  , return a dicti
-0001b390: 6f6e 6172 7920 7768 6572 6520 6b65 7973  onary where keys
-0001b3a0: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
-0001b3b0: 2073 6c69 6365 2070 6f73 6974 696f 6e73   slice positions
-0001b3c0: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
-0001b3d0: 7468 6520 6361 6c63 756c 6174 6564 204a  the calculated J
-0001b3e0: 6163 6361 7264 2069 6e64 6963 6573 2e0a  accard indices..
-0001b3f0: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
-0001b400: 7277 6973 652c 2072 6574 7572 6e20 666f  rwise, return fo
-0001b410: 7220 7468 6520 6361 6c63 756c 6174 6564  r the calculated
-0001b420: 204a 6163 6361 7264 2069 6e64 6963 6573   Jaccard indices
-0001b430: 2074 6865 2073 7461 7469 7374 6963 0a20   the statistic. 
-0001b440: 2020 2020 2020 2020 2020 2073 7065 6369             speci
-0001b450: 6669 6564 2062 7920 736c 6963 655f 7374  fied by slice_st
-0001b460: 6174 2e0a 0a20 2020 2020 2020 2076 616c  at...        val
-0001b470: 7565 5f66 6f72 5f6e 6f6e 6520 3a20 666c  ue_for_none : fl
-0001b480: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
-0001b490: 650a 2020 2020 2020 2020 2020 2020 466f  e.            Fo
-0001b4a0: 7220 7369 6e67 6c65 5f73 6c69 6365 2061  r single_slice a
-0001b4b0: 6e64 2062 795f 736c 6963 652c 2076 616c  nd by_slice, val
-0001b4c0: 7565 2074 6f20 6265 2072 6574 7572 6e65  ue to be returne
-0001b4d0: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
-0001b4e0: 2020 736c 6963 6573 2077 6865 7265 204a    slices where J
-0001b4f0: 6163 6361 7264 2069 6e64 6578 2069 7320  accard index is 
-0001b500: 756e 6465 7465 726d 696e 6564 2028 4e6f  undetermined (No
-0001b510: 6e65 292e 2020 466f 7220 736c 6963 655f  ne).  For slice_
-0001b520: 7374 6174 2c0a 2020 2020 2020 2020 2020  stat,.          
-0001b530: 2020 7661 6c75 6520 746f 2073 7562 7374    value to subst
-0001b540: 6974 7574 6520 666f 7220 616e 7920 4e6f  itute for any No
-0001b550: 6e65 2076 616c 7565 7320 616d 6f6e 6720  ne values among 
-0001b560: 7468 6520 696e 7075 7473 0a20 2020 2020  the inputs.     
-0001b570: 2020 2020 2020 2066 6f72 2063 616c 6375         for calcu
-0001b580: 6c61 7469 6e67 2073 6c69 6365 2d62 6173  lating slice-bas
-0001b590: 6564 2073 7461 7469 7374 6963 2e20 2049  ed statistic.  I
-0001b5a0: 6620 4e6f 6e65 2069 6e20 7468 6520 6c61  f None in the la
-0001b5b0: 7474 6572 0a20 2020 2020 2020 2020 2020  tter.           
-0001b5c0: 2063 6173 652c 204e 6f6e 6520 7661 6c75   case, None valu
-0001b5d0: 6573 2061 6d6f 6e67 2074 6865 2069 6e70  es among the inp
-0001b5e0: 7574 7320 6172 6520 6f6d 6974 7465 642e  uts are omitted.
-0001b5f0: 0a0a 2020 2020 2020 2020 736c 6963 655f  ..        slice_
-0001b600: 7374 6174 203a 2073 7472 2c20 6465 6661  stat : str, defa
-0001b610: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0001b620: 2020 2020 2053 696e 676c 652d 7661 7269       Single-vari
-0001b630: 6162 6c65 2073 7461 7469 7374 6963 2873  able statistic(s
-0001b640: 2920 746f 2062 6520 7265 7475 726e 6564  ) to be returned
-0001b650: 2066 6f72 2073 6c69 6365 2d62 792d 736c   for slice-by-sl
-0001b660: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
-0001b670: 4a61 6363 6172 6420 696e 6469 6365 732e  Jaccard indices.
-0001b680: 2020 5468 6973 2073 686f 756c 6420 6265    This should be
-0001b690: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-0001b6a0: 2066 756e 6374 696f 6e20 666f 720a 2020   function for.  
-0001b6b0: 2020 2020 2020 2020 2020 6361 6c63 756c            calcul
-0001b6c0: 6174 696f 6e20 6f66 2074 6865 2073 7461  ation of the sta
-0001b6d0: 7469 7374 6963 2873 2920 696e 2074 6865  tistic(s) in the
-0001b6e0: 2050 7974 686f 6e20 7374 6174 6973 7469   Python statisti
-0001b6f0: 6373 206d 6f64 756c 653a 0a0a 2020 2020  cs module:..    
-0001b700: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
-0001b710: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
-0001b720: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
-0001b730: 7469 6373 2e68 746d 6c0a 0a20 2020 2020  tics.html..     
-0001b740: 2020 2020 2020 2041 7661 696c 6162 6c65         Available
-0001b750: 206f 7074 696f 6e73 2069 6e63 6c75 6465   options include
-0001b760: 3a20 226d 6561 6e22 2c20 226d 6564 6961  : "mean", "media
-0001b770: 6e22 2c20 226d 6f64 6522 2c0a 2020 2020  n", "mode",.    
-0001b780: 2020 2020 2020 2020 2273 7464 6576 222c          "stdev",
-0001b790: 2022 7175 616e 7469 6c65 7322 2e20 2044   "quantiles".  D
-0001b7a0: 6973 7265 6761 7264 6564 2069 6620 4e6f  isregarded if No
-0001b7b0: 6e65 2e0a 0a20 2020 2020 2020 2020 2020  ne...           
-0001b7c0: 2049 6620 6279 5f73 6c69 6365 2069 7320   If by_slice is 
-0001b7d0: 4e6f 6e65 2061 6e64 2073 6c69 6365 5f73  None and slice_s
-0001b7e0: 7461 7420 6973 2064 6966 6665 7265 6e74  tat is different
-0001b7f0: 2066 726f 6d20 4e6f 6e65 2c0a 2020 2020   from None,.    
-0001b800: 2020 2020 2020 2020 7468 6520 666f 726d          the form
-0001b810: 6572 2064 6566 6175 6c74 7320 746f 2022  er defaults to "
-0001b820: 756e 696f 6e22 2e0a 0a20 2020 2020 2020  union"...       
-0001b830: 2073 6c69 6365 5f73 7461 745f 6b77 6172   slice_stat_kwar
-0001b840: 6773 203a 2064 6963 742c 2064 6566 6175  gs : dict, defau
-0001b850: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0001b860: 2020 2020 4b65 7977 6f72 6420 6172 6775      Keyword argu
-0001b870: 6d65 6e74 7320 746f 2062 6520 7061 7373  ments to be pass
-0001b880: 6564 2074 6f20 6675 6e63 7469 6f6e 206f  ed to function o
-0001b890: 6620 7374 6174 6973 7469 6373 0a20 2020  f statistics.   
-0001b8a0: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
-0001b8b0: 666f 7220 6361 6c63 756c 6174 696f 6e20  for calculation 
-0001b8c0: 7265 6c61 7469 7665 2074 6f20 736c 6963  relative to slic
-0001b8d0: 6520 7661 6c75 6573 2e20 2046 6f72 2065  e values.  For e
-0001b8e0: 7861 6d70 6c65 2c0a 2020 2020 2020 2020  xample,.        
-0001b8f0: 2020 2020 6966 2071 7561 6e74 696c 6573      if quantiles
-0001b900: 2061 7265 2072 6571 7569 7265 6420 666f   are required fo
-0001b910: 7220 3130 2069 6e74 6572 7661 6c73 2c20  r 10 intervals, 
-0001b920: 7261 7468 6572 2074 6861 6e20 666f 720a  rather than for.
-0001b930: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-0001b940: 6465 6661 756c 7420 6f66 2034 2c20 7468  default of 4, th
-0001b950: 6973 2063 616e 2062 6520 7370 6563 6966  is can be specif
-0001b960: 6965 6420 7573 696e 673a 0a0a 2020 2020  ied using:..    
-0001b970: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-0001b980: 6174 5f6b 7761 7267 737b 226e 2220 3a20  at_kwargs{"n" : 
-0001b990: 3130 7d0a 0a20 2020 2020 2020 2020 2020  10}..           
-0001b9a0: 2046 6f72 2061 7661 696c 6162 6c65 206b   For available k
-0001b9b0: 6579 776f 7264 206f 7074 696f 6e73 2c20  eyword options, 
-0001b9c0: 7365 6520 646f 6375 6d65 6e74 6174 696f  see documentatio
-0001b9d0: 6e20 6f66 2073 7461 7469 7374 6963 730a  n of statistics.
-0001b9e0: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
-0001b9f0: 6c65 2061 743a 0a0a 2020 2020 2020 2020  le at:..        
-0001ba00: 2020 2020 6874 7470 733a 2f2f 646f 6373      https://docs
-0001ba10: 2e70 7974 686f 6e2e 6f72 672f 332f 6c69  .python.org/3/li
-0001ba20: 6272 6172 792f 7374 6174 6973 7469 6373  brary/statistics
-0001ba30: 2e68 746d 6c0a 2020 2020 2020 2020 2222  .html.        ""
-0001ba40: 220a 2020 2020 2020 2020 6966 2073 6c69  ".        if sli
-0001ba50: 6365 5f73 7461 743a 0a20 2020 2020 2020  ce_stat:.       
-0001ba60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001ba70: 2e67 6574 5f73 6c69 6365 5f73 7461 7428  .get_slice_stat(
-0001ba80: 6f74 6865 722c 2022 6a61 6363 6172 6422  other, "jaccard"
-0001ba90: 2c20 736c 6963 655f 7374 6174 2c20 6279  , slice_stat, by
-0001baa0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-0001bab0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0001bac0: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
-0001bad0: 2c20 6d65 7468 6f64 2c20 2a2a 2873 6c69  , method, **(sli
-0001bae0: 6365 5f73 7461 745f 6b77 6172 6773 206f  ce_stat_kwargs o
-0001baf0: 7220 7b7d 2929 0a0a 2020 2020 2020 2020  r {}))..        
-0001bb00: 6966 2062 795f 736c 6963 653a 0a20 2020  if by_slice:.   
-0001bb10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001bb20: 7365 6c66 2e67 6574 5f6d 6574 7269 635f  self.get_metric_
-0001bb30: 6279 5f73 6c69 6365 286f 7468 6572 2c20  by_slice(other, 
-0001bb40: 226a 6163 6361 7264 222c 2062 795f 736c  "jaccard", by_sl
-0001bb50: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
-0001bb60: 2020 2020 2020 2020 2076 6965 772c 206d           view, m
-0001bb70: 6574 686f 6429 0a0a 2020 2020 2020 2020  ethod)..        
-0001bb80: 696e 7465 7273 6563 7469 6f6e 2c20 756e  intersection, un
-0001bb90: 696f 6e2c 206d 6561 6e5f 7369 7a65 203d  ion, mean_size =
-0001bba0: 2073 656c 662e 6765 745f 696e 7465 7273   self.get_inters
-0001bbb0: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
-0001bbc0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0001bbd0: 2020 206f 7468 6572 2c20 7369 6e67 6c65     other, single
-0001bbe0: 5f73 6c69 6365 2c20 7669 6577 2c20 736c  _slice, view, sl
-0001bbf0: 2c20 6964 782c 2070 6f73 2c20 6d65 7468  , idx, pos, meth
-0001bc00: 6f64 2c20 666c 6174 7465 6e29 0a0a 2020  od, flatten)..  
-0001bc10: 2020 2020 2020 7265 7475 726e 2028 696e        return (in
-0001bc20: 7465 7273 6563 7469 6f6e 202f 2075 6e69  tersection / uni
-0001bc30: 6f6e 2069 6620 756e 696f 6e20 656c 7365  on if union else
-0001bc40: 2076 616c 7565 5f66 6f72 5f6e 6f6e 6529   value_for_none)
-0001bc50: 0a0a 2020 2020 6465 6620 6765 745f 766f  ..    def get_vo
-0001bc60: 6c75 6d65 5f72 6174 696f 2873 656c 662c  lume_ratio(self,
-0001bc70: 206f 7468 6572 2c20 2a2a 6b77 6172 6773   other, **kwargs
-0001bc80: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-0001bc90: 7420 7261 7469 6f20 6f66 2061 6e6f 7468  t ratio of anoth
-0001bca0: 6572 2052 4f49 2773 2076 6f6c 756d 6520  er ROI's volume 
-0001bcb0: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
-0001bcc0: 6f77 6e20 766f 6c75 6d65 2e22 2222 0a0a  own volume."""..
-0001bcd0: 2020 2020 2020 2020 6f77 6e5f 766f 6c75          own_volu
-0001bce0: 6d65 203d 206f 7468 6572 2e67 6574 5f76  me = other.get_v
-0001bcf0: 6f6c 756d 6528 2a2a 6b77 6172 6773 290a  olume(**kwargs).
-0001bd00: 2020 2020 2020 2020 6f74 6865 725f 766f          other_vo
-0001bd10: 6c75 6d65 203d 2073 656c 662e 6765 745f  lume = self.get_
-0001bd20: 766f 6c75 6d65 282a 2a6b 7761 7267 7329  volume(**kwargs)
-0001bd30: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001bd40: 6f74 6865 725f 766f 6c75 6d65 206f 7220  other_volume or 
-0001bd50: 6e6f 7420 6f77 6e5f 766f 6c75 6d65 3a0a  not own_volume:.
-0001bd60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001bd70: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-0001bd80: 7265 7475 726e 206f 776e 5f76 6f6c 756d  return own_volum
-0001bd90: 6520 2f20 6f74 6865 725f 766f 6c75 6d65  e / other_volume
-0001bda0: 0a0a 2020 2020 6465 6620 6765 745f 6172  ..    def get_ar
-0001bdb0: 6561 5f72 6174 696f 2873 656c 662c 206f  ea_ratio(self, o
-0001bdc0: 7468 6572 2c20 7669 6577 3d22 782d 7922  ther, view="x-y"
-0001bdd0: 2c20 736c 3d4e 6f6e 652c 2069 6478 3d4e  , sl=None, idx=N
-0001bde0: 6f6e 652c 2070 6f73 3d4e 6f6e 652c 0a20  one, pos=None,. 
-0001bdf0: 2020 2020 2020 2020 2020 2075 6e69 7473             units
-0001be00: 3d22 6d6d 222c 206d 6574 686f 643d 4e6f  ="mm", method=No
-0001be10: 6e65 2c20 666c 6174 7465 6e3d 4661 6c73  ne, flatten=Fals
-0001be20: 652c 2062 795f 736c 6963 653d 4e6f 6e65  e, by_slice=None
-0001be30: 2c0a 2020 2020 2020 2020 2020 2020 736c  ,.            sl
-0001be40: 6963 655f 7374 6174 3d4e 6f6e 652c 2076  ice_stat=None, v
-0001be50: 616c 7565 5f66 6f72 5f6e 6f6e 653d 4e6f  alue_for_none=No
-0001be60: 6e65 2c20 2a2a 736c 6963 655f 7374 6174  ne, **slice_stat
-0001be70: 5f6b 7761 7267 7329 3a0a 2020 2020 2020  _kwargs):.      
-0001be80: 2020 2222 2247 6574 2072 6174 696f 206f    """Get ratio o
-0001be90: 6620 616e 6f74 6865 7220 524f 4927 7320  f another ROI's 
-0001bea0: 6172 6561 2077 6974 6820 7265 7370 6563  area with respec
-0001beb0: 7420 746f 206f 776e 2061 7265 612e 2222  t to own area.""
-0001bec0: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
-0001bed0: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
-0001bee0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001bef0: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
-0001bf00: 286f 7468 6572 2c20 2261 7265 615f 7261  (other, "area_ra
-0001bf10: 7469 6f22 2c20 736c 6963 655f 7374 6174  tio", slice_stat
-0001bf20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001bf30: 2020 2020 2020 6279 5f73 6c69 6365 2c20        by_slice, 
-0001bf40: 7661 6c75 655f 666f 725f 6e6f 6e65 2c20  value_for_none, 
-0001bf50: 7669 6577 2c20 6d65 7468 6f64 2c0a 2020  view, method,.  
-0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf70: 2020 2a2a 2873 6c69 6365 5f73 7461 745f    **(slice_stat_
-0001bf80: 6b77 6172 6773 206f 7220 7b7d 2929 0a0a  kwargs or {}))..
-0001bf90: 2020 2020 2020 2020 6966 2062 795f 736c          if by_sl
-0001bfa0: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
-0001bfb0: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
-0001bfc0: 5f6d 6574 7269 635f 6279 5f73 6c69 6365  _metric_by_slice
-0001bfd0: 286f 7468 6572 2c20 2261 7265 615f 7261  (other, "area_ra
-0001bfe0: 7469 6f22 2c20 6279 5f73 6c69 6365 2c0a  tio", by_slice,.
-0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c000: 2020 2020 7669 6577 2c20 6d65 7468 6f64      view, method
-0001c010: 290a 0a20 2020 2020 2020 206f 776e 5f61  )..        own_a
-0001c020: 7265 6120 3d20 6f74 6865 722e 6765 745f  rea = other.get_
-0001c030: 6172 6561 2876 6965 772c 2073 6c2c 2069  area(view, sl, i
-0001c040: 6478 2c20 706f 732c 2075 6e69 7473 2c20  dx, pos, units, 
-0001c050: 6d65 7468 6f64 2c20 666c 6174 7465 6e29  method, flatten)
-0001c060: 0a20 2020 2020 2020 206f 7468 6572 5f61  .        other_a
-0001c070: 7265 6120 3d20 7365 6c66 2e67 6574 5f61  rea = self.get_a
-0001c080: 7265 6128 7669 6577 2c20 736c 2c20 6964  rea(view, sl, id
-0001c090: 782c 2070 6f73 2c20 756e 6974 732c 206d  x, pos, units, m
-0001c0a0: 6574 686f 642c 2066 6c61 7474 656e 290a  ethod, flatten).
-0001c0b0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-0001c0c0: 7468 6572 5f61 7265 6120 6f72 206e 6f74  ther_area or not
-0001c0d0: 206f 776e 5f61 7265 613a 0a20 2020 2020   own_area:.     
-0001c0e0: 2020 2020 2020 2072 6574 7572 6e20 7661         return va
-0001c0f0: 6c75 655f 666f 725f 6e6f 6e65 0a20 2020  lue_for_none.   
-0001c100: 2020 2020 2072 6574 7572 6e20 6f77 6e5f       return own_
-0001c110: 6172 6561 202f 206f 7468 6572 5f61 7265  area / other_are
-0001c120: 610a 0a20 2020 2064 6566 2067 6574 5f76  a..    def get_v
-0001c130: 6f6c 756d 655f 6469 6666 2873 656c 662c  olume_diff(self,
-0001c140: 206f 7468 6572 2c20 2a2a 6b77 6172 6773   other, **kwargs
-0001c150: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-0001c160: 7420 6f77 6e20 766f 6c75 6d65 206d 696e  t own volume min
-0001c170: 7573 2076 6f6c 756d 6520 6f66 206f 7468  us volume of oth
-0001c180: 6572 2052 4f49 2e22 2222 0a0a 2020 2020  er ROI."""..    
-0001c190: 2020 2020 6f77 6e5f 766f 6c75 6d65 203d      own_volume =
-0001c1a0: 2073 656c 662e 6765 745f 766f 6c75 6d65   self.get_volume
-0001c1b0: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
-0001c1c0: 2020 206f 7468 6572 5f76 6f6c 756d 6520     other_volume 
-0001c1d0: 3d20 6f74 6865 722e 6765 745f 766f 6c75  = other.get_volu
-0001c1e0: 6d65 282a 2a6b 7761 7267 7329 0a20 2020  me(**kwargs).   
-0001c1f0: 2020 2020 2069 6620 6e6f 7420 6f77 6e5f       if not own_
-0001c200: 766f 6c75 6d65 206f 7220 6e6f 7420 6f74  volume or not ot
-0001c210: 6865 725f 766f 6c75 6d65 3a0a 2020 2020  her_volume:.    
-0001c220: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001c230: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
-0001c240: 726e 2028 6f77 6e5f 766f 6c75 6d65 202d  rn (own_volume -
-0001c250: 206f 7468 6572 5f76 6f6c 756d 6529 0a0a   other_volume)..
-0001c260: 2020 2020 6465 6620 6765 745f 7265 6c61      def get_rela
-0001c270: 7469 7665 5f76 6f6c 756d 655f 6469 6666  tive_volume_diff
-0001c280: 2873 656c 662c 206f 7468 6572 2c20 2a2a  (self, other, **
-0001c290: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-0001c2a0: 2022 2222 4765 7420 7265 6c61 7469 7665   """Get relative
-0001c2b0: 2076 6f6c 756d 6520 6f66 2061 6e6f 7468   volume of anoth
-0001c2c0: 6572 2052 4f49 2077 6974 6820 7265 7370  er ROI with resp
-0001c2d0: 6563 7420 746f 206f 776e 2076 6f6c 756d  ect to own volum
-0001c2e0: 652e 2222 220a 0a20 2020 2020 2020 206f  e."""..        o
-0001c2f0: 776e 5f76 6f6c 756d 6520 3d20 7365 6c66  wn_volume = self
-0001c300: 2e67 6574 5f76 6f6c 756d 6528 2a2a 6b77  .get_volume(**kw
-0001c310: 6172 6773 290a 2020 2020 2020 2020 766f  args).        vo
-0001c320: 6c75 6d65 5f64 6966 6620 3d20 7365 6c66  lume_diff = self
-0001c330: 2e67 6574 5f76 6f6c 756d 655f 6469 6666  .get_volume_diff
-0001c340: 286f 7468 6572 2c20 2a2a 6b77 6172 6773  (other, **kwargs
-0001c350: 290a 2020 2020 2020 2020 6966 2076 6f6c  ).        if vol
-0001c360: 756d 655f 6469 6666 2069 7320 4e6f 6e65  ume_diff is None
-0001c370: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001c380: 7475 726e 0a20 2020 2020 2020 2072 6574  turn.        ret
-0001c390: 7572 6e20 766f 6c75 6d65 5f64 6966 6620  urn volume_diff 
-0001c3a0: 2f20 6f77 6e5f 766f 6c75 6d65 0a0a 2020  / own_volume..  
-0001c3b0: 2020 6465 6620 6765 745f 6172 6561 5f64    def get_area_d
-0001c3c0: 6966 6628 7365 6c66 2c20 6f74 6865 722c  iff(self, other,
-0001c3d0: 2076 6965 773d 2278 2d79 222c 2073 6c3d   view="x-y", sl=
-0001c3e0: 4e6f 6e65 2c20 6964 783d 4e6f 6e65 2c20  None, idx=None, 
-0001c3f0: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
-0001c400: 2020 2020 2020 756e 6974 733d 226d 6d22        units="mm"
-0001c410: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 2066  , method=None, f
-0001c420: 6c61 7474 656e 3d46 616c 7365 2c20 6279  latten=False, by
-0001c430: 5f73 6c69 6365 3d4e 6f6e 652c 0a20 2020  _slice=None,.   
-0001c440: 2020 2020 2020 2020 2073 6c69 6365 5f73           slice_s
-0001c450: 7461 743d 4e6f 6e65 2c20 7661 6c75 655f  tat=None, value_
-0001c460: 666f 725f 6e6f 6e65 3d4e 6f6e 652c 202a  for_none=None, *
-0001c470: 2a73 6c69 6365 5f73 7461 745f 6b77 6172  *slice_stat_kwar
-0001c480: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-0001c490: 4765 7420 6162 736f 6c75 7465 2061 7265  Get absolute are
-0001c4a0: 6120 6469 6666 6572 656e 6365 2062 6574  a difference bet
-0001c4b0: 7765 656e 2074 776f 2052 4f49 732e 2222  ween two ROIs.""
-0001c4c0: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
-0001c4d0: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
-0001c4e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001c4f0: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
-0001c500: 286f 7468 6572 2c20 2261 7265 615f 6469  (other, "area_di
-0001c510: 6666 222c 2073 6c69 6365 5f73 7461 742c  ff", slice_stat,
-0001c520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c530: 2020 2020 2062 795f 736c 6963 652c 2076       by_slice, v
-0001c540: 616c 7565 5f66 6f72 5f6e 6f6e 652c 2076  alue_for_none, v
-0001c550: 6965 772c 206d 6574 686f 642c 0a20 2020  iew, method,.   
-0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c570: 202a 2a28 736c 6963 655f 7374 6174 5f6b   **(slice_stat_k
-0001c580: 7761 7267 7320 6f72 207b 7d29 290a 0a20  wargs or {})).. 
-0001c590: 2020 2020 2020 2069 6620 6279 5f73 6c69         if by_sli
-0001c5a0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-0001c5b0: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
-0001c5c0: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
-0001c5d0: 6f74 6865 722c 2022 6172 6561 5f64 6966  other, "area_dif
-0001c5e0: 6622 2c20 6279 5f73 6c69 6365 2c0a 2020  f", by_slice,.  
-0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c600: 2020 7669 6577 2c20 6d65 7468 6f64 290a    view, method).
-0001c610: 0a20 2020 2020 2020 206f 776e 5f61 7265  .        own_are
-0001c620: 6120 3d20 7365 6c66 2e67 6574 5f61 7265  a = self.get_are
-0001c630: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
-0001c640: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
-0001c650: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
-0001c660: 2020 2020 2020 6f74 6865 725f 6172 6561        other_area
-0001c670: 203d 206f 7468 6572 2e67 6574 5f61 7265   = other.get_are
-0001c680: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
-0001c690: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
-0001c6a0: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
-0001c6b0: 2020 2020 2020 6966 206e 6f74 206f 776e        if not own
-0001c6c0: 5f61 7265 6120 6f72 206e 6f74 206f 7468  _area or not oth
-0001c6d0: 6572 5f61 7265 613a 0a20 2020 2020 2020  er_area:.       
-0001c6e0: 2020 2020 2072 6574 7572 6e20 7661 6c75       return valu
-0001c6f0: 655f 666f 725f 6e6f 6e65 0a20 2020 2020  e_for_none.     
-0001c700: 2020 2072 6574 7572 6e20 6f77 6e5f 6172     return own_ar
-0001c710: 6561 202d 206f 7468 6572 5f61 7265 610a  ea - other_area.
-0001c720: 0a20 2020 2064 6566 2067 6574 5f72 656c  .    def get_rel
-0001c730: 6174 6976 655f 6172 6561 5f64 6966 6628  ative_area_diff(
-0001c740: 7365 6c66 2c20 6f74 6865 722c 2076 6965  self, other, vie
-0001c750: 773d 2278 2d79 222c 2073 6c3d 4e6f 6e65  w="x-y", sl=None
-0001c760: 2c20 6964 783d 4e6f 6e65 2c0a 2020 2020  , idx=None,.    
-0001c770: 2020 2020 2020 2020 706f 733d 4e6f 6e65          pos=None
-0001c780: 2c20 756e 6974 733d 226d 6d22 2c20 6d65  , units="mm", me
-0001c790: 7468 6f64 3d4e 6f6e 652c 2066 6c61 7474  thod=None, flatt
-0001c7a0: 656e 3d46 616c 7365 2c20 6279 5f73 6c69  en=False, by_sli
-0001c7b0: 6365 3d4e 6f6e 652c 0a20 2020 2020 2020  ce=None,.       
-0001c7c0: 2020 2020 2073 6c69 6365 5f73 7461 743d       slice_stat=
-0001c7d0: 4e6f 6e65 2c20 7661 6c75 655f 666f 725f  None, value_for_
-0001c7e0: 6e6f 6e65 3d4e 6f6e 652c 202a 2a73 6c69  none=None, **sli
-0001c7f0: 6365 5f73 7461 745f 6b77 6172 6773 293a  ce_stat_kwargs):
-0001c800: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-0001c810: 7265 6c61 7469 7665 2061 7265 6120 6f66  relative area of
-0001c820: 2061 6e6f 7468 6572 2052 4f49 2077 6974   another ROI wit
-0001c830: 6820 7265 7370 6563 7420 746f 206f 776e  h respect to own
-0001c840: 2061 7265 612e 2222 220a 0a20 2020 2020   area."""..     
-0001c850: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
-0001c860: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001c870: 7475 726e 2073 656c 662e 6765 745f 736c  turn self.get_sl
-0001c880: 6963 655f 7374 6174 286f 7468 6572 2c20  ice_stat(other, 
-0001c890: 2272 656c 5f61 7265 615f 6469 6666 222c  "rel_area_diff",
-0001c8a0: 2073 6c69 6365 5f73 7461 742c 0a20 2020   slice_stat,.   
-0001c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8c0: 2062 795f 736c 6963 652c 2076 616c 7565   by_slice, value
-0001c8d0: 5f66 6f72 5f6e 6f6e 652c 2076 6965 772c  _for_none, view,
-0001c8e0: 206d 6574 686f 642c 0a20 2020 2020 2020   method,.       
-0001c8f0: 2020 2020 2020 2020 2020 2020 202a 2a28               **(
-0001c900: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
-0001c910: 7320 6f72 207b 7d29 290a 0a20 2020 2020  s or {}))..     
-0001c920: 2020 2069 6620 6279 5f73 6c69 6365 3a0a     if by_slice:.
-0001c930: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001c940: 726e 2073 656c 662e 6765 745f 6d65 7472  rn self.get_metr
-0001c950: 6963 5f62 795f 736c 6963 6528 6f74 6865  ic_by_slice(othe
-0001c960: 722c 2022 7265 6c5f 6172 6561 5f64 6966  r, "rel_area_dif
-0001c970: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
-0001c980: 2020 2020 2020 2020 6279 5f73 6c69 6365          by_slice
-0001c990: 2c20 7669 6577 2c20 6d65 7468 6f64 290a  , view, method).
-0001c9a0: 0a20 2020 2020 2020 206f 776e 5f61 7265  .        own_are
-0001c9b0: 6120 3d20 7365 6c66 2e67 6574 5f61 7265  a = self.get_are
-0001c9c0: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
-0001c9d0: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
-0001c9e0: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
-0001c9f0: 2020 2020 2020 6172 6561 5f64 6966 6620        area_diff 
-0001ca00: 3d20 7365 6c66 2e67 6574 5f61 7265 615f  = self.get_area_
-0001ca10: 6469 6666 286f 7468 6572 2c20 7669 6577  diff(other, view
-0001ca20: 2c20 736c 2c20 6964 782c 2070 6f73 2c20  , sl, idx, pos, 
-0001ca30: 756e 6974 732c 206d 6574 686f 642c 0a20  units, method,. 
-0001ca40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001ca50: 6c61 7474 656e 290a 0a20 2020 2020 2020  latten)..       
-0001ca60: 2069 6620 6172 6561 5f64 6966 6620 6973   if area_diff is
-0001ca70: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001ca80: 2020 2072 6574 7572 6e20 7661 6c75 655f     return value_
-0001ca90: 666f 725f 6e6f 6e65 0a20 2020 2020 2020  for_none.       
-0001caa0: 2072 6574 7572 6e20 6172 6561 5f64 6966   return area_dif
-0001cab0: 6620 2f20 6f77 6e5f 6172 6561 0a0a 2020  f / own_area..  
-0001cac0: 2020 6465 6620 6765 745f 696e 7465 7273    def get_inters
-0001cad0: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
-0001cae0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0001caf0: 200a 2020 2020 2020 2020 6f74 6865 722c   .        other,
-0001cb00: 200a 2020 2020 2020 2020 7369 6e67 6c65   .        single
-0001cb10: 5f73 6c69 6365 3d46 616c 7365 2c0a 2020  _slice=False,.  
-0001cb20: 2020 2020 2020 7669 6577 3d22 782d 7922        view="x-y"
-0001cb30: 2c20 0a20 2020 2020 2020 2073 6c3d 4e6f  , .        sl=No
-0001cb40: 6e65 2c20 0a20 2020 2020 2020 2069 6478  ne, .        idx
-0001cb50: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
-0001cb60: 706f 733d 4e6f 6e65 2c20 0a20 2020 2020  pos=None, .     
-0001cb70: 2020 206d 6574 686f 643d 4e6f 6e65 2c0a     method=None,.
-0001cb80: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
-0001cb90: 4661 6c73 652c 0a20 2020 2029 3a0a 2020  False,.    ):.  
-0001cba0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001cbb0: 2020 4765 7420 696e 7465 7273 6563 7469    Get intersecti
-0001cbc0: 6f6e 2c20 756e 696f 6e20 616e 6420 6d65  on, union and me
-0001cbd0: 616e 2073 697a 6520 7769 7468 2072 6573  an size with res
-0001cbe0: 7065 6374 2074 6f20 616e 6f74 6865 7220  pect to another 
-0001cbf0: 524f 492e 0a20 2020 2020 2020 2056 616c  ROI..        Val
-0001cc00: 7565 7320 6172 6520 7265 7475 726e 6564  ues are returned
-0001cc10: 2061 7320 766f 6c75 6d65 7320 666f 7220   as volumes for 
-0001cc20: 7468 6520 6675 6c6c 2052 4f49 732c 0a20  the full ROIs,. 
-0001cc30: 2020 2020 2020 206f 7220 6173 2061 7265         or as are
-0001cc40: 6173 2066 6f72 2061 2073 696e 676c 6520  as for a single 
-0001cc50: 736c 6963 652e 0a0a 2020 2020 2020 2020  slice...        
-0001cc60: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-0001cc70: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0001cc80: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
-0001cc90: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
-0001cca0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
-0001ccb0: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
-0001ccc0: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
-0001ccd0: 6365 203a 2062 6f6f 6c2c 2064 6566 6175  ce : bool, defau
-0001cce0: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-0001ccf0: 2020 2020 2049 6620 4661 6c73 652c 2074       If False, t
-0001cd00: 6865 2076 6f6c 756d 6573 206f 6620 696e  he volumes of in
-0001cd10: 7465 7273 6563 7469 6f6e 2061 6e64 2020  tersection and  
-0001cd20: 756e 696f 6e20 6f66 2074 6865 2066 756c  union of the ful
-0001cd30: 6c20 524f 4973 2c0a 2020 2020 2020 2020  l ROIs,.        
-0001cd40: 2020 2020 616e 6420 7468 6520 6d65 616e      and the mean
-0001cd50: 2052 4f49 2076 6f6c 756d 6520 7769 6c6c   ROI volume will
-0001cd60: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
-0001cd70: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
-0001cd80: 6973 652c 2074 6865 2061 7265 6173 206f  ise, the areas o
-0001cd90: 6620 696e 7465 7273 6563 7469 6f6e 2061  f intersection a
-0001cda0: 6e64 2075 6e69 6f6e 206f 6e20 6120 7369  nd union on a si
-0001cdb0: 6e67 6c65 2073 6c69 6365 2c0a 2020 2020  ngle slice,.    
-0001cdc0: 2020 2020 2020 2020 616e 6420 7468 6520          and the 
-0001cdd0: 6d65 616e 2052 4f49 2061 7265 612c 2077  mean ROI area, w
-0001cde0: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
-0001cdf0: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
-0001ce00: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
-0001ce10: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
-0001ce20: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
-0001ce30: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
-0001ce40: 2067 6574 2061 7265 6173 206f 6620 696e   get areas of in
-0001ce50: 7465 7273 6563 7469 6f6e 0a20 2020 2020  tersection.     
-0001ce60: 2020 2020 2020 2061 6e64 2075 6e69 6f6e         and union
-0001ce70: 2c20 616e 6420 6d65 616e 2052 4f49 2061  , and mean ROI a
-0001ce80: 7265 612e 2020 4f6e 6c79 2075 7365 6420  rea.  Only used 
-0001ce90: 6966 2073 696e 676c 655f 736c 6963 653d  if single_slice=
-0001cea0: 5472 7565 2e0a 0a20 2020 2020 2020 2073  True...        s
-0001ceb0: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
-0001cec0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0001ced0: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
-0001cee0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0001cef0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0001cf00: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-0001cf10: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-0001cf20: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-0001cf30: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-0001cf40: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
-0001cf50: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
-0001cf60: 0a0a 2020 2020 2020 2020 6964 7820 3a20  ..        idx : 
-0001cf70: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-0001cf80: 650a 2020 2020 2020 2020 2020 2020 4172  e.            Ar
-0001cf90: 7261 7920 696e 6465 7820 6f66 2073 6c69  ray index of sli
-0001cfa0: 6365 2e20 4966 206e 6f6e 6520 6f66 203c  ce. If none of <
-0001cfb0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-0001cfc0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
-0001cfd0: 0a20 2020 2020 2020 2020 2020 2062 7574  .            but
-0001cfe0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-0001cff0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-0001d000: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-0001d010: 6973 2052 4f49 2077 696c 6c20 6265 0a20  is ROI will be. 
-0001d020: 2020 2020 2020 2020 2020 2075 7365 642e             used.
-0001d030: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
-0001d040: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-0001d050: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001d060: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
-0001d070: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
-0001d080: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-0001d090: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
-0001d0a0: 6564 0a20 2020 2020 2020 2020 2020 2062  ed.            b
-0001d0b0: 7574 203c 7369 6e67 6c65 5f73 6c69 6365  ut <single_slice
-0001d0c0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
-0001d0d0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-0001d0e0: 7468 6973 2052 4f49 2077 696c 6c0a 2020  this ROI will.  
-0001d0f0: 2020 2020 2020 2020 2020 6265 2075 7365            be use
-0001d100: 642e 0a0a 2020 2020 2020 2020 6d65 7468  d...        meth
-0001d110: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
-0001d120: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0001d130: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
-0001d140: 2066 6f72 2063 616c 6375 6c61 7469 6e67   for calculating
-0001d150: 2069 6e74 6572 7365 6374 696f 6e2c 2075   intersection, u
-0001d160: 6e69 6f6e 2c20 616e 6420 6d65 616e 0a20  nion, and mean. 
-0001d170: 2020 2020 2020 2020 2020 2073 697a 652e             size.
-0001d180: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
-0001d190: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
-0001d1a0: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
-0001d1b0: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
-0001d1c0: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
-0001d1d0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
-0001d1e0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-0001d1f0: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
-0001d200: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
-0001d210: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
-0001d220: 2020 2020 2020 2020 2020 2020 202d 204e               - N
-0001d230: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
-0001d240: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
-0001d250: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
-0001d260: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
-0001d270: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
-0001d280: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-0001d290: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0001d2a0: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
-0001d2b0: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
-0001d2c0: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
-0001d2d0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
-0001d2e0: 2020 2020 2020 2074 6865 2061 7265 6173         the areas
-0001d2f0: 206f 6620 696e 7465 7273 6563 7469 6f6e   of intersection
-0001d300: 2061 6e64 2075 6e69 6f6e 2c20 616e 6420   and union, and 
-0001d310: 7468 6520 6d65 616e 2052 4f49 2061 7265  the mean ROI are
-0001d320: 612c 0a20 2020 2020 2020 2020 2020 2077  a,.            w
-0001d330: 696c 6c20 6265 2072 6574 7572 6e65 6420  ill be returned 
-0001d340: 666f 7220 7468 6520 666c 6174 7465 6e65  for the flattene
-0001d350: 6420 736c 6963 6573 2e20 4f6e 6c79 2061  d slices. Only a
-0001d360: 7661 696c 6162 6c65 0a20 2020 2020 2020  vailable.       
-0001d370: 2020 2020 2069 6620 6d65 7468 6f64 3d22       if method="
-0001d380: 6d61 736b 222e 0a20 2020 2020 2020 2022  mask"..        "
-0001d390: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
-0001d3a0: 2e63 7265 6174 655f 6d61 736b 2829 0a0a  .create_mask()..
-0001d3b0: 2020 2020 2020 2020 2320 4465 6669 6e65          # Define
-0001d3c0: 2076 6f78 656c 2076 6f6c 756d 652c 2061   voxel volume, a
-0001d3d0: 6e64 2076 6f78 656c 2061 7265 6120 696e  nd voxel area in
-0001d3e0: 2076 6965 772e 0a20 2020 2020 2020 2076   view..        v
-0001d3f0: 6f78 656c 5f76 6f6c 756d 6520 3d20 310a  oxel_volume = 1.
-0001d400: 2020 2020 2020 2020 666f 7220 6478 797a          for dxyz
-0001d410: 2069 6e20 7365 6c66 2e6d 6173 6b2e 766f   in self.mask.vo
-0001d420: 7865 6c5f 7369 7a65 3a0a 2020 2020 2020  xel_size:.      
-0001d430: 2020 2020 2020 766f 7865 6c5f 766f 6c75        voxel_volu
-0001d440: 6d65 202a 3d20 6478 797a 0a20 2020 2020  me *= dxyz.     
-0001d450: 2020 207a 5f61 7820 3d20 736b 7274 2e69     z_ax = skrt.i
-0001d460: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
-0001d470: 5b76 6965 775d 0a20 2020 2020 2020 2073  [view].        s
-0001d480: 6c69 6365 5f74 6869 636b 6e65 7373 203d  lice_thickness =
-0001d490: 2073 656c 662e 6d61 736b 2e76 6f78 656c   self.mask.voxel
-0001d4a0: 5f73 697a 655b 7a5f 6178 5d0a 2020 2020  _size[z_ax].    
-0001d4b0: 2020 2020 766f 7865 6c5f 6172 6561 203d      voxel_area =
-0001d4c0: 2076 6f78 656c 5f76 6f6c 756d 6520 2f20   voxel_volume / 
-0001d4d0: 736c 6963 655f 7468 6963 6b6e 6573 730a  slice_thickness.
-0001d4e0: 0a20 2020 2020 2020 2023 2047 6574 2064  .        # Get d
-0001d4f0: 6566 6175 6c74 2073 6c69 6365 2061 6e64  efault slice and
-0001d500: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
-0001d510: 6966 2073 696e 676c 655f 736c 6963 653a  if single_slice:
-0001d520: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001d530: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
-0001d540: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
-0001d550: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
-0001d560: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
-0001d570: 3d20 7365 6c66 2e67 6574 5f6d 6964 5f69  = self.get_mid_i
-0001d580: 6478 2876 6965 7729 0a20 2020 2020 2020  dx(view).       
-0001d590: 2069 6620 6d65 7468 6f64 2069 7320 4e6f   if method is No
-0001d5a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001d5b0: 6d65 7468 6f64 203d 2073 656c 662e 6465  method = self.de
-0001d5c0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-0001d5d0: 640a 0a20 2020 2020 2020 2069 6620 666c  d..        if fl
-0001d5e0: 6174 7465 6e3a 2020 2320 466c 6174 7465  atten:  # Flatte
-0001d5f0: 6e69 6e67 206f 6e6c 7920 706f 7373 6962  ning only possib
-0001d600: 6c65 2077 6974 6820 226d 6173 6b22 0a20  le with "mask". 
-0001d610: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-0001d620: 6420 3d20 226d 6173 6b22 0a0a 2020 2020  d = "mask"..    
-0001d630: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-0001d640: 696e 7465 7273 6563 7469 6f6e 7320 616e  intersections an
-0001d650: 6420 6172 6561 7320 6672 6f6d 2070 6f6c  d areas from pol
-0001d660: 7967 6f6e 730a 2020 2020 2020 2020 6966  ygons.        if
-0001d670: 206d 6574 686f 6420 3d3d 2022 636f 6e74   method == "cont
-0001d680: 6f75 7222 3a0a 0a20 2020 2020 2020 2020  our":..         
-0001d690: 2020 2023 2047 6574 2070 6f73 6974 696f     # Get positio
-0001d6a0: 6e73 206f 6620 736c 6963 6528 7329 0a20  ns of slice(s). 
-0001d6b0: 2020 2020 2020 2020 2020 2023 206f 6e20             # on 
-0001d6c0: 7768 6963 6820 746f 2063 6f6d 7061 7265  which to compare
-0001d6d0: 2061 7265 6173 2061 6e64 2074 6f74 616c   areas and total
-0001d6e0: 2061 7265 6173 2e0a 2020 2020 2020 2020   areas..        
-0001d6f0: 2020 2020 6966 206e 6f74 2073 696e 676c      if not singl
-0001d700: 655f 736c 6963 653a 0a20 2020 2020 2020  e_slice:.       
-0001d710: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
-0001d720: 6e73 203d 2073 6574 2873 656c 662e 6765  ns = set(self.ge
-0001d730: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
-0001d740: 292e 6b65 7973 2829 292e 756e 696f 6e28  ).keys()).union(
-0001d750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d760: 2020 2020 2020 2020 2073 6574 286f 7468           set(oth
-0001d770: 6572 2e67 6574 5f63 6f6e 746f 7572 7328  er.get_contours(
-0001d780: 2278 2d79 2229 2e6b 6579 7328 2929 290a  "x-y").keys())).
-0001d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7a0: 6172 6561 7331 203d 205b 7365 6c66 2e67  areas1 = [self.g
-0001d7b0: 6574 5f61 7265 6128 2278 2d79 222c 2070  et_area("x-y", p
-0001d7c0: 6f73 3d70 2c20 6d65 7468 6f64 3d6d 6574  os=p, method=met
-0001d7d0: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
-0001d7e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001d7f0: 2070 2069 6e20 706f 7369 7469 6f6e 735d   p in positions]
-0001d800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d810: 2076 6f6c 756d 6573 3120 3d20 5b61 202a   volumes1 = [a *
-0001d820: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
-0001d830: 2066 6f72 2061 2069 6e20 6172 6561 7331   for a in areas1
-0001d840: 2069 6620 615d 0a20 2020 2020 2020 2020   if a].         
-0001d850: 2020 2020 2020 2076 6f6c 756d 6531 203d         volume1 =
-0001d860: 2073 756d 2876 6f6c 756d 6573 3129 0a20   sum(volumes1). 
-0001d870: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001d880: 7265 6173 3220 3d20 5b6f 7468 6572 2e67  reas2 = [other.g
-0001d890: 6574 5f61 7265 6128 2278 2d79 222c 2070  et_area("x-y", p
-0001d8a0: 6f73 3d70 2c20 6d65 7468 6f64 3d6d 6574  os=p, method=met
-0001d8b0: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
-0001d8c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001d8d0: 2070 2069 6e20 706f 7369 7469 6f6e 735d   p in positions]
-0001d8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d8f0: 2076 6f6c 756d 6573 3220 3d20 5b61 202a   volumes2 = [a *
-0001d900: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
-0001d910: 2066 6f72 2061 2069 6e20 6172 6561 7332   for a in areas2
-0001d920: 2069 6620 615d 0a20 2020 2020 2020 2020   if a].         
-0001d930: 2020 2020 2020 2076 6f6c 756d 6532 203d         volume2 =
-0001d940: 2073 756d 2876 6f6c 756d 6573 3229 0a20   sum(volumes2). 
-0001d950: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001d960: 6561 6e5f 7369 7a65 203d 2030 2e35 202a  ean_size = 0.5 *
-0001d970: 2028 766f 6c75 6d65 3120 2b20 766f 6c75   (volume1 + volu
-0001d980: 6d65 3229 0a20 2020 2020 2020 2020 2020  me2).           
-0001d990: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001d9a0: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-0001d9b0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-0001d9c0: 2020 2020 2020 2020 2073 656c 662e 6964           self.id
-0001d9d0: 785f 746f 5f70 6f73 2873 656c 662e 6765  x_to_pos(self.ge
-0001d9e0: 745f 6964 7828 7669 6577 2c20 736c 2c20  t_idx(view, sl, 
-0001d9f0: 6964 782c 2070 6f73 292c 0a20 2020 2020  idx, pos),.     
-0001da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da10: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001da20: 783d 736b 7274 2e69 6d61 6765 2e5f 736c  x=skrt.image._sl
-0001da30: 6963 655f 6178 6573 5b76 6965 775d 290a  ice_axes[view]).
-0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001da60: 2020 6172 6561 3120 3d20 7365 6c66 2e67    area1 = self.g
-0001da70: 6574 5f61 7265 6128 7669 6577 2c20 736c  et_area(view, sl
-0001da80: 2c20 6964 782c 2070 6f73 2c20 6d65 7468  , idx, pos, meth
-0001da90: 6f64 3d6d 6574 686f 6429 0a20 2020 2020  od=method).     
-0001daa0: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
-0001dab0: 6561 3120 6973 204e 6f6e 653a 0a20 2020  ea1 is None:.   
-0001dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dad0: 2061 7265 6131 203d 2030 0a20 2020 2020   area1 = 0.     
-0001dae0: 2020 2020 2020 2020 2020 2061 7265 6132             area2
-0001daf0: 203d 206f 7468 6572 2e67 6574 5f61 7265   = other.get_are
-0001db00: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
-0001db10: 2070 6f73 2c20 6d65 7468 6f64 3d6d 6574   pos, method=met
-0001db20: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
-0001db30: 2020 2020 2069 6620 6172 6561 3220 6973       if area2 is
-0001db40: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001db50: 2020 2020 2020 2020 2020 2061 7265 6132             area2
-0001db60: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0001db70: 2020 2020 206d 6561 6e5f 7369 7a65 203d       mean_size =
-0001db80: 2030 2e35 202a 2028 6172 6561 3120 2b20   0.5 * (area1 + 
-0001db90: 6172 6561 3229 0a20 2020 2020 2020 2020  area2).         
-0001dba0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0001dbb0: 2320 436f 6d70 7574 6520 6172 6561 7320  # Compute areas 
-0001dbc0: 6f66 2069 6e74 6572 7365 6374 696f 6e20  of intersection 
-0001dbd0: 616e 6420 756e 696f 6e20 6f6e 2073 6c69  and union on sli
-0001dbe0: 6365 2873 290a 2020 2020 2020 2020 2020  ce(s).          
-0001dbf0: 2020 696e 7465 7273 6563 7469 6f6e 203d    intersection =
-0001dc00: 2030 0a20 2020 2020 2020 2020 2020 2075   0.            u
-0001dc10: 6e69 6f6e 203d 2030 0a20 2020 2020 2020  nion = 0.       
-0001dc20: 2020 2020 2066 6163 746f 7220 3d20 3120       factor = 1 
-0001dc30: 6966 2028 7369 6e67 6c65 5f73 6c69 6365  if (single_slice
-0001dc40: 206f 7220 666c 6174 7465 6e29 2065 6c73   or flatten) els
-0001dc50: 6520 736c 6963 655f 7468 6963 6b6e 6573  e slice_thicknes
-0001dc60: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
-0001dc70: 7220 7020 696e 2070 6f73 6974 696f 6e73  r p in positions
-0001dc80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001dc90: 2020 7365 7431 203d 206f 7073 2e75 6e61    set1 = ops.una
-0001dca0: 7279 5f75 6e69 6f6e 2873 656c 662e 6765  ry_union(self.ge
-0001dcb0: 745f 706f 6c79 676f 6e73 5f6f 6e5f 736c  t_polygons_on_sl
-0001dcc0: 6963 6528 7669 6577 2c20 706f 733d 7029  ice(view, pos=p)
-0001dcd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001dce0: 2020 7365 7432 203d 206f 7073 2e75 6e61    set2 = ops.una
-0001dcf0: 7279 5f75 6e69 6f6e 286f 7468 6572 2e67  ry_union(other.g
-0001dd00: 6574 5f70 6f6c 7967 6f6e 735f 6f6e 5f73  et_polygons_on_s
-0001dd10: 6c69 6365 2876 6965 772c 2070 6f73 3d70  lice(view, pos=p
-0001dd20: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0001dd30: 2020 2069 6e74 6572 7365 6374 696f 6e20     intersection 
-0001dd40: 2b3d 2073 6574 312e 696e 7465 7273 6563  += set1.intersec
-0001dd50: 7469 6f6e 2873 6574 3229 2e61 7265 6120  tion(set2).area 
-0001dd60: 2a20 6661 6374 6f72 0a20 2020 2020 2020  * factor.       
-0001dd70: 2020 2020 2020 2020 2075 6e69 6f6e 202b           union +
-0001dd80: 3d20 7365 7431 2e75 6e69 6f6e 2873 6574  = set1.union(set
-0001dd90: 3229 2e61 7265 6120 2a20 6661 6374 6f72  2).area * factor
-0001dda0: 0a0a 2020 2020 2020 2020 2320 4361 6c63  ..        # Calc
-0001ddb0: 756c 6174 6520 696e 7465 7273 6563 7469  ulate intersecti
-0001ddc0: 6f6e 7320 616e 6420 6172 6561 7320 6672  ons and areas fr
-0001ddd0: 6f6d 2062 696e 6172 7920 6d61 736b 2076  om binary mask v
-0001dde0: 6f78 656c 2063 6f75 6e74 730a 2020 2020  oxel counts.    
-0001ddf0: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
-0001de00: 2020 2020 2020 2023 2055 7365 2033 4420         # Use 3D 
-0001de10: 6d61 736b 0a20 2020 2020 2020 2020 2020  mask.           
-0001de20: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
-0001de30: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
-0001de40: 2020 2020 2020 6461 7461 3120 3d20 7365        data1 = se
-0001de50: 6c66 2e67 6574 5f6d 6173 6b28 7669 6577  lf.get_mask(view
-0001de60: 2c20 666c 6174 7465 6e2c 2073 7461 6e64  , flatten, stand
-0001de70: 6172 6469 7365 3d54 7275 6529 0a20 2020  ardise=True).   
-0001de80: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0001de90: 6132 203d 206f 7468 6572 2e67 6574 5f6d  a2 = other.get_m
-0001dea0: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
-0001deb0: 6e2c 2073 7461 6e64 6172 6469 7365 3d54  n, standardise=T
-0001dec0: 7275 6529 0a0a 2020 2020 2020 2020 2020  rue)..          
-0001ded0: 2020 2320 4f74 6865 7277 6973 652c 2075    # Otherwise, u
-0001dee0: 7365 2073 696e 676c 6520 3244 2073 6c69  se single 2D sli
-0001def0: 6365 0a20 2020 2020 2020 2020 2020 2065  ce.            e
-0001df00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001df10: 2020 2020 2064 6174 6131 203d 2073 656c       data1 = sel
-0001df20: 662e 6765 745f 736c 6963 6528 7669 6577  f.get_slice(view
-0001df30: 2c20 736c 2c20 6964 782c 2070 6f73 290a  , sl, idx, pos).
-0001df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df50: 6461 7461 3220 3d20 6f74 6865 722e 6765  data2 = other.ge
-0001df60: 745f 736c 6963 6528 7669 6577 2c20 736c  t_slice(view, sl
-0001df70: 2c20 6964 782c 2070 6f73 290a 0a20 2020  , idx, pos)..   
-0001df80: 2020 2020 2020 2020 2066 6163 746f 7220           factor 
-0001df90: 3d20 766f 7865 6c5f 6172 6561 2069 6620  = voxel_area if 
-0001dfa0: 2873 696e 676c 655f 736c 6963 6520 6f72  (single_slice or
-0001dfb0: 2066 6c61 7474 656e 2920 656c 7365 2076   flatten) else v
-0001dfc0: 6f78 656c 5f76 6f6c 756d 650a 2020 2020  oxel_volume.    
-0001dfd0: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
-0001dfe0: 7469 6f6e 203d 2028 6461 7461 3120 2620  tion = (data1 & 
-0001dff0: 6461 7461 3229 2e73 756d 2829 202a 2066  data2).sum() * f
-0001e000: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
-0001e010: 2020 756e 696f 6e20 3d20 2864 6174 6131    union = (data1
-0001e020: 207c 2064 6174 6132 292e 7375 6d28 2920   | data2).sum() 
-0001e030: 2a20 6661 6374 6f72 0a20 2020 2020 2020  * factor.       
-0001e040: 2020 2020 206d 6561 6e5f 7369 7a65 203d       mean_size =
-0001e050: 2030 2e35 202a 2028 6461 7461 312e 7375   0.5 * (data1.su
-0001e060: 6d28 2920 2b20 6461 7461 322e 7375 6d28  m() + data2.sum(
-0001e070: 2929 202a 2066 6163 746f 720a 0a20 2020  )) * factor..   
-0001e080: 2020 2020 2072 6574 7572 6e20 2869 6e74       return (int
-0001e090: 6572 7365 6374 696f 6e2c 2075 6e69 6f6e  ersection, union
-0001e0a0: 2c20 6d65 616e 5f73 697a 6529 0a0a 2020  , mean_size)..  
-0001e0b0: 2020 6465 6620 6765 745f 6d65 7472 6963    def get_metric
-0001e0c0: 5f62 795f 736c 6963 6528 7365 6c66 2c20  _by_slice(self, 
-0001e0d0: 6f74 6865 722c 206d 6574 7269 633d 4e6f  other, metric=No
-0001e0e0: 6e65 2c20 6279 5f73 6c69 6365 3d4e 6f6e  ne, by_slice=Non
-0001e0f0: 652c 0a20 2020 2020 2020 2020 2020 2076  e,.            v
-0001e100: 6965 773d 2278 2d79 222c 206d 6574 686f  iew="x-y", metho
-0001e110: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
-0001e120: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-0001e130: 2064 6963 7469 6f6e 6172 7920 6f66 2073   dictionary of s
-0001e140: 6c69 6365 2d62 792d 736c 6963 6520 7661  lice-by-slice va
-0001e150: 6c75 6573 2066 6f72 2063 6f6d 7061 7269  lues for compari
-0001e160: 736f 6e20 6d65 7472 6963 2e0a 0a20 2020  son metric...   
-0001e170: 2020 2020 2045 6163 6820 6b65 7920 6f66       Each key of
-0001e180: 2074 6865 2072 6574 7572 6e65 6420 6469   the returned di
-0001e190: 6374 696f 6e61 7279 2069 7320 6120 736c  ctionary is a sl
-0001e1a0: 6963 6520 706f 7369 7469 6f6e 2028 6d6d  ice position (mm
-0001e1b0: 292c 2061 6e64 0a20 2020 2020 2020 2074  ), and.        t
-0001e1c0: 6865 2061 7373 6f63 6961 7465 6420 7661  he associated va
-0001e1d0: 6c75 6520 6973 2074 6865 206d 6574 7269  lue is the metri
-0001e1e0: 6320 7661 6c75 6520 666f 7220 7468 6520  c value for the 
-0001e1f0: 736c 6963 652e 0a0a 2020 2020 2020 2020  slice...        
-0001e200: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-0001e210: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
-0001e220: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
-0001e230: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
-0001e240: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
-0001e250: 524f 492e 0a0a 2020 2020 2020 2020 6d65  ROI...        me
-0001e260: 7472 6963 203a 2073 7472 2c20 6465 6661  tric : str, defa
-0001e270: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0001e280: 2020 2020 204d 6574 7269 6320 746f 2062       Metric to b
-0001e290: 6520 6576 616c 7561 7465 642e 0a0a 2020  e evaluated...  
-0001e2a0: 2020 2020 2020 6279 5f73 6c69 6365 3a20        by_slice: 
-0001e2b0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-0001e2c0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-0001e2d0: 6963 6573 2074 6f20 6265 2063 6f6e 7369  ices to be consi
-0001e2e0: 6465 7265 642e 2020 5468 6520 7661 6c69  dered.  The vali
-0001e2f0: 6420 7370 6563 6966 6963 6174 696f 6e73  d specifications
-0001e300: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
-0001e310: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
-0001e320: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
-0001e330: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
-0001e340: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
-0001e350: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
-0001e360: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-0001e370: 6f6e 7461 696e 696e 6720 6f74 6865 7220  ontaining other 
-0001e380: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
-0001e390: 202d 2022 756e 696f 6e22 3a20 636f 6e73   - "union": cons
-0001e3a0: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
-0001e3b0: 6169 6e69 6e67 2065 6974 6865 7220 6f66  aining either of
-0001e3c0: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
-0001e3d0: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
-0001e3e0: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
-0001e3f0: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
-0001e400: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
-0001e410: 7468 206f 6620 7365 6c66 2061 6e64 0a20  th of self and. 
-0001e420: 2020 2020 2020 2020 2020 2020 206f 7468               oth
-0001e430: 6572 2072 6f69 2e0a 0a20 2020 2020 2020  er roi...       
-0001e440: 2020 2020 2049 6620 4e6f 6e65 2c20 7573       If None, us
-0001e450: 6520 736b 7274 2e63 6f72 652e 4465 6661  e skrt.core.Defa
-0001e460: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
-0001e470: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
-0001e480: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
-0001e490: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
-0001e4a0: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
-0001e4b0: 6963 6573 206f 6e20 7768 6963 6820 746f  ices on which to
-0001e4c0: 2067 6574 206d 6574 7269 6320 7661 6c75   get metric valu
-0001e4d0: 6573 2e0a 0a20 2020 2020 2020 206d 6574  es...        met
-0001e4e0: 686f 6420 3a20 7374 722c 2064 6566 6175  hod : str, defau
-0001e4f0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0001e500: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
-0001e510: 6520 666f 7220 6d65 7472 6963 2063 616c  e for metric cal
-0001e520: 6375 6c61 7469 6f6e 2e20 4361 6e20 6265  culation. Can be
-0001e530: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0001e540: 2020 202d 2022 636f 6e74 6f75 7222 3a20     - "contour": 
-0001e550: 6361 6c63 756c 6174 6520 6d65 7472 6963  calculate metric
-0001e560: 2066 726f 6d20 7368 6170 656c 7920 636f   from shapely co
-0001e570: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
-0001e580: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-0001e590: 3a20 6361 6c63 7561 6c74 6520 6d65 7472  : calcualte metr
-0001e5a0: 6963 2066 726f 6d20 6269 6e61 7279 206d  ic from binary m
-0001e5b0: 6173 6b73 2e0a 2020 2020 2020 2020 2020  asks..          
-0001e5c0: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
-0001e5d0: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
-0001e5e0: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
-0001e5f0: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 2020  _geom_method..  
-0001e600: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001e610: 2020 6966 206d 6574 7269 6320 6e6f 7420    if metric not 
-0001e620: 696e 2067 6574 5f63 6f6d 7061 7269 736f  in get_compariso
-0001e630: 6e5f 6d65 7472 6963 7328 293a 0a20 2020  n_metrics():.   
-0001e640: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
-0001e650: 756e 7469 6d65 4572 726f 7228 6622 4d65  untimeError(f"Me
-0001e660: 7472 6963 207b 6d65 7472 6963 7d20 6e6f  tric {metric} no
-0001e670: 7420 7265 636f 676e 6973 6564 2062 7920  t recognised by 
-0001e680: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001e690: 2020 2020 2020 2020 2020 2252 4f49 2e67            "ROI.g
-0001e6a0: 6574 5f6d 6574 7269 635f 6279 5f73 6c69  et_metric_by_sli
-0001e6b0: 6365 2829 2229 0a0a 2020 2020 2020 2020  ce()")..        
-0001e6c0: 6279 5f73 6c69 6365 203d 2062 795f 736c  by_slice = by_sl
-0001e6d0: 6963 6520 6f72 2073 6b72 742e 636f 7265  ice or skrt.core
-0001e6e0: 2e44 6566 6175 6c74 7328 292e 6279 5f73  .Defaults().by_s
-0001e6f0: 6c69 6365 0a0a 2020 2020 2020 2020 7265  lice..        re
-0001e700: 7475 726e 207b 706f 733a 2067 6574 6174  turn {pos: getat
-0001e710: 7472 2873 656c 662c 2066 2267 6574 5f7b  tr(self, f"get_{
-0001e720: 6765 745f 6d65 7472 6963 5f6d 6574 686f  get_metric_metho
-0001e730: 6428 6d65 7472 6963 297d 2229 280a 2020  d(metric)}")(.  
-0001e740: 2020 2020 2020 2020 2020 6f74 6865 722c            other,
-0001e750: 2073 696e 676c 655f 736c 6963 653d 5472   single_slice=Tr
-0001e760: 7565 2c20 7669 6577 3d76 6965 772c 2070  ue, view=view, p
-0001e770: 6f73 3d70 6f73 2c20 6d65 7468 6f64 3d6d  os=pos, method=m
-0001e780: 6574 686f 6429 0a20 2020 2020 2020 2020  ethod).         
-0001e790: 2020 2066 6f72 2070 6f73 2069 6e20 7365     for pos in se
-0001e7a0: 6c66 2e67 6574 5f73 6c69 6365 5f70 6f73  lf.get_slice_pos
-0001e7b0: 6974 696f 6e73 286f 7468 6572 2c20 7669  itions(other, vi
-0001e7c0: 6577 2c20 6d65 7468 6f64 3d62 795f 736c  ew, method=by_sl
-0001e7d0: 6963 6529 7d0a 0a20 2020 2064 6566 2067  ice)}..    def g
-0001e7e0: 6574 5f73 6c69 6365 5f73 7461 7428 7365  et_slice_stat(se
-0001e7f0: 6c66 2c20 6f74 6865 722c 206d 6574 7269  lf, other, metri
-0001e800: 633d 4e6f 6e65 2c20 736c 6963 655f 7374  c=None, slice_st
-0001e810: 6174 3d4e 6f6e 652c 2062 795f 736c 6963  at=None, by_slic
-0001e820: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-0001e830: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
-0001e840: 6e65 3d4e 6f6e 652c 2076 6965 773d 2278  ne=None, view="x
-0001e850: 2d79 222c 206d 6574 686f 643d 4e6f 6e65  -y", method=None
-0001e860: 2c20 2a2a 736c 6963 655f 7374 6174 5f6b  , **slice_stat_k
-0001e870: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0001e880: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-0001e890: 7374 6174 6973 7469 6320 666f 7220 736c  statistic for sl
-0001e8a0: 6963 652d 6279 2d73 6c69 6365 2063 6f6d  ice-by-slice com
-0001e8b0: 7061 7269 736f 6e20 6d65 7472 6963 2e0a  parison metric..
-0001e8c0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-0001e8d0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
-0001e8e0: 2020 6f74 6865 7220 3a20 524f 490a 2020    other : ROI.  
-0001e8f0: 2020 2020 2020 2020 2020 4f74 6865 7220            Other 
-0001e900: 524f 4920 746f 2063 6f6d 7061 7265 2077  ROI to compare w
-0001e910: 6974 6820 7468 6973 2052 4f49 2e0a 0a20  ith this ROI... 
-0001e920: 2020 2020 2020 206d 6574 7269 6320 3a20         metric : 
-0001e930: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-0001e940: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
-0001e950: 7472 6963 2066 6f72 2077 6869 6368 2073  tric for which s
-0001e960: 7461 7469 7374 6963 2066 6f72 2073 6c69  tatistic for sli
-0001e970: 6365 2d62 792d 736c 6963 6520 7661 6c75  ce-by-slice valu
-0001e980: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
-0001e990: 7320 746f 2062 6520 7265 7475 726e 6564  s to be returned
-0001e9a0: 2e0a 0a20 2020 2020 2020 2073 6c69 6365  ...        slice
-0001e9b0: 5f73 7461 7420 3a20 7374 722c 2064 6566  _stat : str, def
-0001e9c0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0001e9d0: 2020 2020 2020 5369 6e67 6c65 2d76 6172        Single-var
-0001e9e0: 6961 626c 6520 7374 6174 6973 7469 6328  iable statistic(
-0001e9f0: 7329 2074 6f20 6265 2072 6574 7572 6e65  s) to be returne
-0001ea00: 6420 666f 7220 736c 6963 652d 6279 2d73  d for slice-by-s
-0001ea10: 6c69 6365 0a20 2020 2020 2020 2020 2020  lice.           
-0001ea20: 2044 6963 6520 7363 6f72 6573 2e20 2054   Dice scores.  T
-0001ea30: 6869 7320 7368 6f75 6c64 2062 6520 7468  his should be th
-0001ea40: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
-0001ea50: 6e63 7469 6f6e 2066 6f72 0a20 2020 2020  nction for.     
-0001ea60: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
-0001ea70: 6f6e 206f 6620 7468 6520 7374 6174 6973  on of the statis
-0001ea80: 7469 6328 7329 2069 6e20 7468 6520 5079  tic(s) in the Py
-0001ea90: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
-0001eaa0: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
-0001eab0: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
-0001eac0: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
-0001ead0: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
-0001eae0: 732e 6874 6d6c 0a0a 2020 2020 2020 2020  s.html..        
-0001eaf0: 2020 2020 4176 6169 6c61 626c 6520 6f70      Available op
-0001eb00: 7469 6f6e 7320 696e 636c 7564 653a 2022  tions include: "
-0001eb10: 6d65 616e 222c 2022 6d65 6469 616e 222c  mean", "median",
-0001eb20: 2022 6d6f 6465 222c 0a20 2020 2020 2020   "mode",.       
-0001eb30: 2020 2020 2022 7374 6465 7622 2c20 2271       "stdev", "q
-0001eb40: 7561 6e74 696c 6573 222e 0a0a 2020 2020  uantiles"...    
-0001eb50: 2020 2020 6279 5f73 6c69 6365 3a20 7374      by_slice: st
-0001eb60: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-0001eb70: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
-0001eb80: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
-0001eb90: 7265 642e 2020 5468 6520 7661 6c69 6420  red.  The valid 
-0001eba0: 7370 6563 6966 6963 6174 696f 6e73 2061  specifications a
-0001ebb0: 7265 3a0a 0a20 2020 2020 2020 2020 2020  re:..           
-0001ebc0: 202d 2022 6c65 6674 223a 2063 6f6e 7369   - "left": consi
-0001ebd0: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
-0001ebe0: 636f 6e74 6169 6e69 6e67 2073 656c 663b  containing self;
-0001ebf0: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
-0001ec00: 7269 6768 7422 3a20 636f 6e73 6964 6572  right": consider
-0001ec10: 206f 6e6c 7920 736c 6963 6573 2063 6f6e   only slices con
-0001ec20: 7461 696e 696e 6720 6f74 6865 7220 726f  taining other ro
-0001ec30: 693b 0a20 2020 2020 2020 2020 2020 202d  i;.            -
-0001ec40: 2022 756e 696f 6e22 3a20 636f 6e73 6964   "union": consid
-0001ec50: 6572 2073 6c69 6365 7320 636f 6e74 6169  er slices contai
-0001ec60: 6e69 6e67 2065 6974 6865 7220 6f66 2073  ning either of s
-0001ec70: 656c 6620 616e 6420 6f74 6865 7220 726f  elf and other ro
-0001ec80: 693b 0a20 2020 2020 2020 2020 2020 202d  i;.            -
-0001ec90: 2022 696e 7465 7273 6563 7469 6f6e 223a   "intersection":
-0001eca0: 2063 6f6e 7369 6465 7220 736c 6963 6573   consider slices
-0001ecb0: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
-0001ecc0: 206f 6620 7365 6c66 2061 6e64 0a20 2020   of self and.   
-0001ecd0: 2020 2020 2020 2020 2020 206f 7468 6572             other
-0001ece0: 2072 6f69 2e0a 0a20 2020 2020 2020 2020   roi...         
-0001ecf0: 2020 2049 6620 4e6f 6e65 2c20 7573 6520     If None, use 
-0001ed00: 736b 7274 2e63 6f72 652e 4465 6661 756c  skrt.core.Defaul
-0001ed10: 7473 2829 2e62 795f 736c 6963 650a 0a20  ts().by_slice.. 
-0001ed20: 2020 2020 2020 2076 616c 7565 5f66 6f72         value_for
-0001ed30: 5f6e 6f6e 6520 3a20 666c 6f61 742c 2064  _none : float, d
-0001ed40: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0001ed50: 2020 2020 2020 2020 5661 6c75 6520 746f          Value to
-0001ed60: 2073 7562 7374 6974 7574 6520 666f 7220   substitute for 
-0001ed70: 616e 7920 4e6f 6e65 2076 616c 7565 7320  any None values 
-0001ed80: 616d 6f6e 6720 736c 6963 650a 2020 2020  among slice.    
-0001ed90: 2020 2020 2020 2020 6d65 7472 6963 2076          metric v
-0001eda0: 616c 7565 732e 2020 4966 204e 6f6e 652c  alues.  If None,
-0001edb0: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
-0001edc0: 6e67 2074 6865 206d 6574 7269 6320 7661  ng the metric va
-0001edd0: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
-0001ede0: 2061 7265 206f 6d69 7474 6564 2e0a 0a20   are omitted... 
-0001edf0: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-0001ee00: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-0001ee10: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-0001ee20: 656e 7461 7469 6f6e 206f 6620 736c 6963  entation of slic
-0001ee30: 6573 206f 6e20 7768 6963 6820 746f 2067  es on which to g
-0001ee40: 6574 206d 6574 7269 6320 7661 6c75 6573  et metric values
-0001ee50: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
-0001ee60: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
-0001ee70: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0001ee80: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
-0001ee90: 666f 7220 6d65 7472 6963 2063 616c 6375  for metric calcu
-0001eea0: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
-0001eeb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eec0: 202d 2022 636f 6e74 6f75 7222 3a20 6361   - "contour": ca
-0001eed0: 6c63 756c 6174 6520 6d65 7472 6963 2066  lculate metric f
-0001eee0: 726f 6d20 7368 6170 656c 7920 636f 6e74  rom shapely cont
-0001eef0: 6f75 7273 2e0a 2020 2020 2020 2020 2020  ours..          
-0001ef00: 2020 2020 2020 2d20 226d 6173 6b22 3a20        - "mask": 
-0001ef10: 6361 6c63 7561 6c74 6520 6d65 7472 6963  calcualte metric
-0001ef20: 2066 726f 6d20 6269 6e61 7279 206d 6173   from binary mas
-0001ef30: 6b73 2e0a 2020 2020 2020 2020 2020 2020  ks..            
-0001ef40: 2020 2020 2d20 4e6f 6e65 3a20 7573 6520      - None: use 
-0001ef50: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
-0001ef60: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
-0001ef70: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
-0001ef80: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
-0001ef90: 6b77 6172 6773 203a 2064 6963 742c 2064  kwargs : dict, d
-0001efa0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0001efb0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-0001efc0: 6172 6775 6d65 6e74 7320 746f 2062 6520  arguments to be 
-0001efd0: 7061 7373 6564 2074 6f20 6675 6e63 7469  passed to functi
-0001efe0: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
-0001eff0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-0001f000: 756c 6520 666f 7220 6361 6c63 756c 6174  ule for calculat
-0001f010: 696f 6e20 7265 6c61 7469 7665 2074 6f20  ion relative to 
-0001f020: 736c 6963 6520 7661 6c75 6573 2e20 2046  slice values.  F
-0001f030: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
-0001f040: 2020 2020 2020 2020 6966 2071 7561 6e74          if quant
-0001f050: 696c 6573 2061 7265 2072 6571 7569 7265  iles are require
-0001f060: 6420 666f 7220 3130 2069 6e74 6572 7661  d for 10 interva
-0001f070: 6c73 2c20 7261 7468 6572 2074 6861 6e20  ls, rather than 
-0001f080: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-0001f090: 7468 6520 6465 6661 756c 7420 6f66 2034  the default of 4
-0001f0a0: 2c20 7468 6973 2063 616e 2062 6520 7370  , this can be sp
-0001f0b0: 6563 6966 6965 6420 7573 696e 673a 0a0a  ecified using:..
-0001f0c0: 2020 2020 2020 2020 2020 2020 736c 6963              slic
-0001f0d0: 655f 7374 6174 5f6b 7761 7267 737b 226e  e_stat_kwargs{"n
-0001f0e0: 2220 3a20 3130 7d0a 0a20 2020 2020 2020  " : 10}..       
-0001f0f0: 2020 2020 2046 6f72 2061 7661 696c 6162       For availab
-0001f100: 6c65 206b 6579 776f 7264 206f 7074 696f  le keyword optio
-0001f110: 6e73 2c20 7365 6520 646f 6375 6d65 6e74  ns, see document
-0001f120: 6174 696f 6e20 6f66 2073 7461 7469 7374  ation of statist
-0001f130: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
-0001f140: 6d6f 6475 6c65 2061 743a 0a0a 2020 2020  module at:..    
-0001f150: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
-0001f160: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
-0001f170: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
-0001f180: 7469 6373 2e68 746d 6c0a 2020 2020 2020  tics.html.      
-0001f190: 2020 2222 220a 2020 2020 2020 2020 6279    """.        by
-0001f1a0: 5f73 6c69 6365 203d 2062 795f 736c 6963  _slice = by_slic
-0001f1b0: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
-0001f1c0: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
-0001f1d0: 6365 0a20 2020 2020 2020 2073 6c69 6365  ce.        slice
-0001f1e0: 5f73 7461 745f 6b77 6172 6773 203d 2073  _stat_kwargs = s
-0001f1f0: 6c69 6365 5f73 7461 745f 6b77 6172 6773  lice_stat_kwargs
-0001f200: 206f 7220 7b7d 0a0a 2020 2020 2020 2020   or {}..        
-0001f210: 7265 7475 726e 2073 6b72 742e 636f 7265  return skrt.core
-0001f220: 2e67 6574 5f73 7461 7428 7365 6c66 2e67  .get_stat(self.g
-0001f230: 6574 5f6d 6574 7269 635f 6279 5f73 6c69  et_metric_by_sli
-0001f240: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-0001f250: 6f74 6865 722c 206d 6574 7269 632c 2062  other, metric, b
-0001f260: 795f 736c 6963 652c 2076 6965 772c 206d  y_slice, view, m
-0001f270: 6574 686f 6429 2c0a 2020 2020 2020 2020  ethod),.        
-0001f280: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
-0001f290: 6e65 2c20 736c 6963 655f 7374 6174 2c20  ne, slice_stat, 
-0001f2a0: 2a2a 736c 6963 655f 7374 6174 5f6b 7761  **slice_stat_kwa
-0001f2b0: 7267 7329 0a0a 2020 2020 6465 6620 6765  rgs)..    def ge
-0001f2c0: 745f 736c 6963 655f 7374 6174 7328 7365  t_slice_stats(se
-0001f2d0: 6c66 2c20 6f74 6865 722c 206d 6574 7269  lf, other, metri
-0001f2e0: 6373 3d4e 6f6e 652c 2073 6c69 6365 5f73  cs=None, slice_s
-0001f2f0: 7461 7473 3d4e 6f6e 652c 0a20 2020 2020  tats=None,.     
-0001f300: 2020 2020 2020 2064 6566 6175 6c74 5f62         default_b
-0001f310: 795f 736c 6963 653d 4e6f 6e65 2c20 6d65  y_slice=None, me
-0001f320: 7468 6f64 3d4e 6f6e 652c 2076 6965 773d  thod=None, view=
-0001f330: 2278 2d79 222c 0a20 2020 2020 2020 2020  "x-y",.         
-0001f340: 2020 2073 6570 6172 6174 655f 636f 6d70     separate_comp
-0001f350: 6f6e 656e 7473 3d46 616c 7365 293a 0a20  onents=False):. 
-0001f360: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001f370: 2020 2047 6574 2064 6963 7469 6f6e 6172     Get dictionar
-0001f380: 7920 6f66 2073 7461 7469 7374 6963 7320  y of statistics 
-0001f390: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
-0001f3a0: 6365 2063 6f6d 7061 7269 736f 6e20 6d65  ce comparison me
-0001f3b0: 7472 6963 732e 0a0a 2020 2020 2020 2020  trics...        
-0001f3c0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-0001f3d0: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
-0001f3e0: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
-0001f3f0: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
-0001f400: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
-0001f410: 524f 492e 0a0a 2020 2020 2020 2020 6d65  ROI...        me
-0001f420: 7472 6963 7320 3a20 7374 722f 6c69 7374  trics : str/list
-0001f430: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001f440: 2020 2020 2020 2020 2020 204d 6574 7269             Metri
-0001f450: 6328 7329 2066 6f72 2077 6869 6368 2073  c(s) for which s
-0001f460: 7461 7469 7374 6963 2873 2920 666f 7220  tatistic(s) for 
-0001f470: 736c 6963 652d 6279 2d73 6c69 6365 2063  slice-by-slice c
-0001f480: 616c 6375 6c61 7469 6f6e 730a 2020 2020  alculations.    
-0001f490: 2020 2020 2020 2020 6172 6520 746f 2062          are to b
-0001f4a0: 6520 7265 7475 726e 6564 2e20 2041 2073  e returned.  A s
-0001f4b0: 696e 676c 6520 6d65 7472 6963 2063 616e  ingle metric can
-0001f4c0: 2062 7920 7370 6566 6963 6965 6420 6173   by speficied as
-0001f4d0: 2061 2073 7472 696e 672e 0a20 2020 2020   a string..     
-0001f4e0: 2020 2020 2020 204d 756c 7469 706c 6520         Multiple 
-0001f4f0: 6d65 7472 6963 7320 6361 6e20 6265 2073  metrics can be s
-0001f500: 7065 6369 6669 6564 2061 7320 6120 6c69  pecified as a li
-0001f510: 7374 206f 6620 7374 7269 6e67 732e 0a0a  st of strings...
-0001f520: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-0001f530: 6174 7320 3a20 7374 722f 6c69 7374 2f64  ats : str/list/d
-0001f540: 6963 742c 2064 6566 6175 6c74 3d4e 6f6e  ict, default=Non
-0001f550: 650a 2020 2020 2020 2020 2020 2020 5370  e.            Sp
-0001f560: 6563 6966 6963 6174 696f 6e20 6f66 2073  ecification of s
-0001f570: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
-0001f580: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
-0001f590: 6976 650a 2020 2020 2020 2020 2020 2020  ive.            
-0001f5a0: 746f 2073 6c69 6365 2d62 792d 736c 6963  to slice-by-slic
-0001f5b0: 6520 6d65 7472 6963 2076 616c 7565 732e  e metric values.
-0001f5c0: 2020 5573 6564 2066 6f72 2061 6c6c 206d    Used for all m
-0001f5d0: 6574 7269 6373 2077 6974 680a 2020 2020  etrics with.    
-0001f5e0: 2020 2020 2020 2020 7375 6666 6978 2022          suffix "
-0001f5f0: 5f73 6c69 6365 5f73 7461 7473 2220 696e  _slice_stats" in
-0001f600: 2074 6865 203c 6d65 7472 6963 733e 206c   the <metrics> l
-0001f610: 6973 742e 0a0a 2020 2020 2020 2020 2020  ist...          
-0001f620: 2020 4120 7374 6174 6973 7469 6320 6973    A statistic is
-0001f630: 2073 7065 6369 6669 6564 2062 7920 7468   specified by th
-0001f640: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
-0001f650: 6e63 7469 6f6e 2066 6f72 0a20 2020 2020  nction for.     
-0001f660: 2020 2020 2020 2069 7473 2063 616c 6375         its calcu
-0001f670: 6c61 7469 6f6e 2069 6e20 7468 6520 5079  lation in the Py
-0001f680: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
-0001f690: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
-0001f6a0: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
-0001f6b0: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
-0001f6c0: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
-0001f6d0: 732e 6874 6d6c 0a0a 2020 2020 2020 2020  s.html..        
-0001f6e0: 2020 2020 466f 7220 6974 7320 7573 6520      For its use 
-0001f6f0: 6865 7265 2c20 7468 6520 7265 6c65 7661  here, the releva
-0001f700: 6e74 2066 756e 6374 696f 6e20 6d75 7374  nt function must
-0001f710: 2072 6571 7569 7265 0a20 2020 2020 2020   require.       
-0001f720: 2020 2020 2061 2073 696e 676c 652d 7661       a single-va
-0001f730: 7269 6162 6c65 2069 6e70 7574 2c20 6d75  riable input, mu
-0001f740: 7374 206e 6f74 2072 6571 7569 7265 2061  st not require a
-0001f750: 6e79 206b 6579 776f 7264 0a20 2020 2020  ny keyword.     
-0001f760: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
-0001f770: 2c20 616e 6420 6d75 7374 2072 6574 7572  , and must retur
-0001f780: 6e20 6120 7369 6e67 6c65 206e 756d 6265  n a single numbe
-0001f790: 722e 0a0a 2020 2020 2020 2020 2020 2020  r...            
-0001f7a0: 4176 6169 6c61 626c 6520 6f70 7469 6f6e  Available option
-0001f7b0: 7320 696e 636c 7564 653a 2022 6d65 616e  s include: "mean
-0001f7c0: 222c 2022 6d65 6469 616e 222c 2022 6d6f  ", "median", "mo
-0001f7d0: 6465 222c 0a20 2020 2020 2020 2020 2020  de",.           
-0001f7e0: 2022 7374 6465 7622 2e0a 0a20 2020 2020   "stdev"...     
-0001f7f0: 2020 2020 2020 5374 6174 6973 7469 6373        Statistics
-0001f800: 2074 6f20 6265 2063 616c 6375 6c61 7465   to be calculate
-0001f810: 6420 6361 6e20 6265 2073 7065 6369 6669  d can be specifi
-0001f820: 6564 2075 7369 6e67 2061 6e79 206f 660a  ed using any of.
-0001f830: 2020 2020 2020 2020 2020 2074 6865 2066             the f
-0001f840: 6f6c 6c6f 7769 6e67 3a0a 0a20 2020 2020  ollowing:..     
-0001f850: 2020 2020 2020 2d20 5374 7269 6e67 2073        - String s
-0001f860: 7065 6369 6679 696e 6720 7369 6e67 6c65  pecifying single
-0001f870: 2073 7461 7469 7374 6963 2074 6f20 6265   statistic to be
-0001f880: 2063 616c 6375 6c61 7465 642c 0a20 2020   calculated,.   
-0001f890: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-0001f8a0: 6c69 6365 7320 636f 6e73 6964 6572 6564  lices considered
-0001f8b0: 2061 7320 6769 7665 6e20 6279 2064 6566   as given by def
-0001f8c0: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
-0001f8d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001f8e0: 6578 616d 706c 653a 2022 6d65 616e 223b  example: "mean";
-0001f8f0: 0a20 2020 2020 2020 2020 2020 2d20 4c69  .           - Li
-0001f900: 7374 2073 7065 6369 6679 696e 6720 6d75  st specifying mu
-0001f910: 6c74 6970 6c65 2073 7461 7469 7374 6963  ltiple statistic
-0001f920: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
-0001f930: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-0001f940: 2077 6974 6820 736c 6963 6573 2063 6f6e   with slices con
-0001f950: 7369 6465 7265 6420 6173 2067 6976 656e  sidered as given
-0001f960: 2062 7920 6465 6661 756c 745f 6279 5f73   by default_by_s
-0001f970: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
-0001f980: 2020 2066 6f72 2065 7861 6d70 6c65 3a20     for example: 
-0001f990: 5b22 6d65 616e 222c 2022 7374 6465 7622  ["mean", "stdev"
-0001f9a0: 5d3b 0a20 2020 2020 2020 2020 2020 2d20  ];.           - 
-0001f9b0: 4469 6374 696f 6e61 7279 2077 6865 7265  Dictionary where
-0001f9c0: 206b 6579 7320 7370 6563 6966 7920 736c   keys specify sl
-0001f9d0: 6963 6573 2074 6f20 6265 2063 6f6e 7369  ices to be consi
-0001f9e0: 6465 7265 642c 0a20 2020 2020 2020 2020  dered,.         
-0001f9f0: 2020 2020 616e 6420 7661 6c75 6573 2073      and values s
-0001fa00: 7065 6369 6679 2073 7461 7469 7374 6963  pecify statistic
-0001fa10: 7320 2873 7472 696e 6720 6f72 206c 6973  s (string or lis
-0001fa20: 7429 2c20 666f 720a 2020 2020 2020 2020  t), for.        
-0001fa30: 2020 2020 2065 7861 6d70 6c65 3a20 7b22       example: {"
-0001fa40: 756e 696f 6e22 3a20 5b22 6d65 616e 222c  union": ["mean",
-0001fa50: 2022 7374 6465 7622 5d7d 2e20 2056 616c   "stdev"]}.  Val
-0001fa60: 6964 2073 6c69 6365 0a20 2020 2020 2020  id slice.       
-0001fa70: 2020 2020 2020 7370 6563 6966 6963 6174        specificat
-0001fa80: 696f 6e73 2061 7265 2061 7320 6c69 7374  ions are as list
-0001fa90: 6564 2066 6f72 2064 6566 6175 6c74 5f62  ed for default_b
-0001faa0: 795f 736c 6963 652e 0a0a 2020 2020 2020  y_slice...      
-0001fab0: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
-0001fac0: 6365 3a20 7374 722c 2064 6566 6175 6c74  ce: str, default
-0001fad0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0001fae0: 2020 4465 6661 756c 7420 7370 6563 6966    Default specif
-0001faf0: 6963 6174 696f 6e20 6f66 2073 6c69 6365  ication of slice
-0001fb00: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
-0001fb10: 6564 2077 6865 6e0a 2020 2020 2020 2020  ed when.        
-0001fb20: 2020 2020 6361 6c63 756c 6174 696e 6720      calculating 
-0001fb30: 736c 6963 652d 6279 2d73 6c69 6365 2073  slice-by-slice s
-0001fb40: 7461 7469 7374 6963 732e 2020 5468 6520  tatistics.  The 
-0001fb50: 7661 6c69 6420 7370 6563 6966 6963 6174  valid specificat
-0001fb60: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-0001fb70: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
-0001fb80: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
-0001fb90: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
-0001fba0: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
-0001fbb0: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
-0001fbc0: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
-0001fbd0: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-0001fbe0: 6f6e 7461 696e 696e 6720 6f74 6865 7220  ontaining other 
-0001fbf0: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
-0001fc00: 202d 2022 756e 696f 6e22 3a20 636f 6e73   - "union": cons
-0001fc10: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
-0001fc20: 6169 6e69 6e67 2065 6974 6865 7220 6f66  aining either of
-0001fc30: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
-0001fc40: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
-0001fc50: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
-0001fc60: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
-0001fc70: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
-0001fc80: 7468 206f 6620 7365 6c66 2061 6e64 0a20  th of self and. 
-0001fc90: 2020 2020 2020 2020 2020 2020 206f 7468               oth
-0001fca0: 6572 2072 6f69 2e0a 0a20 2020 2020 2020  er roi...       
-0001fcb0: 2020 2020 2049 6620 4e6f 6e65 2c20 7573       If None, us
-0001fcc0: 6520 736b 7274 2e63 6f72 652e 4465 6661  e skrt.core.Defa
-0001fcd0: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
-0001fce0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
-0001fcf0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
-0001fd00: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
-0001fd10: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
-0001fd20: 6963 6573 206f 6e20 7768 6963 6820 746f  ices on which to
-0001fd30: 2067 6574 206d 6574 7269 6320 7661 6c75   get metric valu
-0001fd40: 6573 2e0a 0a20 2020 2020 2020 206d 6574  es...        met
-0001fd50: 686f 6420 3a20 7374 722c 2064 6566 6175  hod : str, defau
-0001fd60: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0001fd70: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
-0001fd80: 6520 666f 7220 6d65 7472 6963 2063 616c  e for metric cal
-0001fd90: 6375 6c61 7469 6f6e 2e20 4361 6e20 6265  culation. Can be
-0001fda0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0001fdb0: 2020 202d 2022 636f 6e74 6f75 7222 3a20     - "contour": 
-0001fdc0: 6361 6c63 756c 6174 6520 6d65 7472 6963  calculate metric
-0001fdd0: 2066 726f 6d20 7368 6170 656c 7920 636f   from shapely co
-0001fde0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
-0001fdf0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-0001fe00: 3a20 6361 6c63 756c 6174 6520 6d65 7472  : calculate metr
-0001fe10: 6963 2066 726f 6d20 6269 6e61 7279 206d  ic from binary m
-0001fe20: 6173 6b73 2e0a 2020 2020 2020 2020 2020  asks..          
-0001fe30: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
-0001fe40: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
-0001fe50: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
-0001fe60: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 0a20  _geom_method... 
-0001fe70: 2020 2020 2020 2073 6570 6172 6174 655f         separate_
-0001fe80: 636f 6d70 6f6e 656e 7473 3a20 626f 6f6c  components: bool
-0001fe90: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-0001fea0: 2020 2020 2020 2020 2020 2020 4966 2046              If F
-0001feb0: 616c 7365 2c20 7265 7475 726e 2061 206d  alse, return a m
-0001fec0: 6574 7269 6320 7265 7072 6573 656e 7465  etric represente
-0001fed0: 6420 6279 2061 2076 6563 746f 7220 6173  d by a vector as
-0001fee0: 2061 0a20 2020 2020 2020 2020 2020 206c   a.            l
-0001fef0: 6973 7420 6f66 2063 6f6d 706f 6e65 6e74  ist of component
-0001ff00: 2076 616c 7565 732e 2020 4966 2074 7275   values.  If tru
-0001ff10: 652c 2072 6574 7572 6e20 6120 7365 7061  e, return a sepa
-0001ff20: 7261 7465 206d 6574 7269 6320 666f 720a  rate metric for.
-0001ff30: 2020 2020 2020 2020 2020 2020 6561 6368              each
-0001ff40: 2063 6f6d 706f 6e65 6e74 2c20 6c61 6265   component, labe
-0001ff50: 6c6c 696e 6720 6279 2074 6865 2063 6f6d  lling by the com
-0001ff60: 706f 6e65 6e74 2061 7865 7320 6465 7465  ponent axes dete
-0001ff70: 726d 696e 6564 0a20 2020 2020 2020 2020  rmined.         
-0001ff80: 2020 2066 726f 6d20 3c76 6965 773e 2e0a     from <view>..
-0001ff90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001ffa0: 2020 2020 6966 206d 6574 7269 6373 2069      if metrics i
-0001ffb0: 7320 4e6f 6e65 206f 7220 736c 6963 655f  s None or slice_
-0001ffc0: 7374 6174 7320 6973 204e 6f6e 653a 0a20  stats is None:. 
-0001ffd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001ffe0: 6e20 7b7d 0a0a 2020 2020 2020 2020 6465  n {}..        de
-0001fff0: 6661 756c 745f 6279 5f73 6c69 6365 203d  fault_by_slice =
-00020000: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
-00020010: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
-00020020: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
-00020030: 6365 0a0a 2020 2020 2020 2020 2320 456e  ce..        # En
-00020040: 7375 7265 2074 6861 7420 6d65 7472 6963  sure that metric
-00020050: 7320 6973 2061 206e 6f6e 2d65 6d70 7479  s is a non-empty
-00020060: 206c 6973 742e 0a20 2020 2020 2020 2069   list..        i
-00020070: 6620 6973 696e 7374 616e 6365 286d 6574  f isinstance(met
-00020080: 7269 6373 2c20 7374 7229 3a0a 2020 2020  rics, str):.    
-00020090: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
-000200a0: 3d20 5b6d 6574 7269 6373 5d0a 2020 2020  = [metrics].    
-000200b0: 2020 2020 656c 6966 206e 6f74 2073 6b72      elif not skr
-000200c0: 742e 636f 7265 2e69 735f 6c69 7374 286d  t.core.is_list(m
-000200d0: 6574 7269 6373 293a 0a20 2020 2020 2020  etrics):.       
-000200e0: 2020 2020 2072 6574 7572 6e20 7b7d 0a20       return {}. 
-000200f0: 2020 2020 2020 206d 6574 7269 6373 203d         metrics =
-00020100: 205b 6d65 7472 6963 2066 6f72 206d 6574   [metric for met
-00020110: 7269 6320 696e 206d 6574 7269 6373 0a20  ric in metrics. 
-00020120: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00020130: 6620 6622 7b6d 6574 7269 637d 5f73 6c69  f f"{metric}_sli
-00020140: 6365 5f73 7461 7473 2220 696e 2067 6574  ce_stats" in get
-00020150: 5f63 6f6d 7061 7269 736f 6e5f 6d65 7472  _comparison_metr
-00020160: 6963 7328 295d 0a20 2020 2020 2020 2069  ics()].        i
-00020170: 6620 6e6f 7420 6d65 7472 6963 733a 0a20  f not metrics:. 
-00020180: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00020190: 6e20 7b7d 0a0a 2020 2020 2020 2020 736c  n {}..        sl
-000201a0: 6963 655f 7374 6174 7320 3d20 6578 7061  ice_stats = expa
-000201b0: 6e64 5f73 6c69 6365 5f73 7461 7473 2873  nd_slice_stats(s
-000201c0: 6c69 6365 5f73 7461 7473 2c20 6465 6661  lice_stats, defa
-000201d0: 756c 745f 6279 5f73 6c69 6365 290a 2020  ult_by_slice).  
-000201e0: 2020 2020 2020 6966 206e 6f74 2073 6c69        if not sli
-000201f0: 6365 5f73 7461 7473 3a0a 2020 2020 2020  ce_stats:.      
-00020200: 2020 2020 2020 7265 7475 726e 207b 7d0a        return {}.
-00020210: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
-00020220: 6c61 7465 2073 7461 7469 7374 6963 2873  late statistic(s
-00020230: 2920 666f 7220 6d65 7472 6963 2076 616c  ) for metric val
-00020240: 7565 7320 6361 6c63 756c 6174 6564 2073  ues calculated s
-00020250: 6c69 6365 2062 7920 736c 6963 652e 0a20  lice by slice.. 
-00020260: 2020 2020 2020 2063 616c 6375 6c61 7465         calculate
-00020270: 645f 736c 6963 655f 7374 6174 7320 3d20  d_slice_stats = 
-00020280: 7b7d 0a20 2020 2020 2020 2066 6f72 206d  {}.        for m
-00020290: 6574 7269 6320 696e 206d 6574 7269 6373  etric in metrics
-000202a0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-000202b0: 7220 6279 5f73 6c69 6365 2c20 7374 6174  r by_slice, stat
-000202c0: 7320 696e 2073 6c69 6365 5f73 7461 7473  s in slice_stats
-000202d0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-000202e0: 2020 2020 2020 2020 2020 7661 6c75 6573            values
-000202f0: 203d 2073 656c 662e 6765 745f 6d65 7472   = self.get_metr
-00020300: 6963 5f62 795f 736c 6963 6528 0a20 2020  ic_by_slice(.   
-00020310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020320: 2020 2020 206f 7468 6572 2c20 6d65 7472       other, metr
-00020330: 6963 2c20 6279 5f73 6c69 6365 2c20 7669  ic, by_slice, vi
-00020340: 6577 2c20 6d65 7468 6f64 290a 2020 2020  ew, method).    
-00020350: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00020360: 7374 6174 2069 6e20 7374 6174 733a 0a20  stat in stats:. 
-00020370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020380: 2020 206b 6579 203d 2066 227b 6d65 7472     key = f"{metr
-00020390: 6963 7d5f 736c 6963 655f 7b62 795f 736c  ic}_slice_{by_sl
-000203a0: 6963 657d 5f7b 7374 6174 7d22 0a20 2020  ice}_{stat}".   
-000203b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203c0: 2063 616c 6375 6c61 7465 645f 736c 6963   calculated_slic
-000203d0: 655f 7374 6174 735b 6b65 795d 203d 2028  e_stats[key] = (
-000203e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000203f0: 2020 2020 2020 2020 2020 2020 2073 6b72               skr
-00020400: 742e 636f 7265 2e67 6574 5f73 7461 7428  t.core.get_stat(
-00020410: 7661 6c75 6573 2c20 7374 6174 3d73 7461  values, stat=sta
-00020420: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-00020430: 2020 2020 2020 2020 6966 2028 736b 7274          if (skrt
-00020440: 2e63 6f72 652e 6973 5f6c 6973 7428 6361  .core.is_list(ca
-00020450: 6c63 756c 6174 6564 5f73 6c69 6365 5f73  lculated_slice_s
-00020460: 7461 7473 5b6b 6579 5d29 0a20 2020 2020  tats[key]).     
-00020470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020480: 2020 2020 2020 2061 6e64 2073 6570 6172         and separ
-00020490: 6174 655f 636f 6d70 6f6e 656e 7473 293a  ate_components):
-000204a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000204b0: 2020 2020 2020 2020 2076 6563 746f 7220           vector 
-000204c0: 3d20 6361 6c63 756c 6174 6564 5f73 6c69  = calculated_sli
-000204d0: 6365 5f73 7461 7473 2e70 6f70 286b 6579  ce_stats.pop(key
-000204e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000204f0: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
-00020500: 2069 5f61 7820 696e 2065 6e75 6d65 7261   i_ax in enumera
-00020510: 7465 2873 6b72 742e 696d 6167 652e 5f70  te(skrt.image._p
-00020520: 6c6f 745f 6178 6573 5b76 6965 775d 293a  lot_axes[view]):
-00020530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020540: 2020 2020 2020 2020 2020 2020 2061 7820               ax 
-00020550: 3d20 736b 7274 2e69 6d61 6765 2e5f 6178  = skrt.image._ax
-00020560: 6573 5b69 5f61 785d 0a20 2020 2020 2020  es[i_ax].       
-00020570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020580: 2020 2020 2061 785f 6b65 7920 3d20 6622       ax_key = f"
-00020590: 7b6d 6574 7269 637d 5f7b 6178 7d5f 736c  {metric}_{ax}_sl
-000205a0: 6963 655f 7b62 795f 736c 6963 657d 5f7b  ice_{by_slice}_{
-000205b0: 7374 6174 7d22 0a20 2020 2020 2020 2020  stat}".         
-000205c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205d0: 2020 2063 616c 6375 6c61 7465 645f 736c     calculated_sl
-000205e0: 6963 655f 7374 6174 735b 6178 5f6b 6579  ice_stats[ax_key
-000205f0: 5d20 3d20 7665 6374 6f72 5b69 5d0a 0a20  ] = vector[i].. 
-00020600: 2020 2020 2020 2072 6574 7572 6e20 6361         return ca
-00020610: 6c63 756c 6174 6564 5f73 6c69 6365 5f73  lculated_slice_s
-00020620: 7461 7473 0a0a 2020 2020 6465 6620 6d61  tats..    def ma
-00020630: 7463 685f 6d61 736b 5f76 6f78 656c 5f73  tch_mask_voxel_s
-00020640: 697a 6528 7365 6c66 2c20 6f74 6865 722c  ize(self, other,
-00020650: 2076 6f78 656c 5f73 697a 653d 4e6f 6e65   voxel_size=None
-00020660: 2c0a 2020 2020 2020 2020 2020 2020 766f  ,.            vo
-00020670: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
-00020680: 653d 302e 3129 3a0a 2020 2020 2020 2020  e=0.1):.        
-00020690: 2727 270a 2020 2020 2020 2020 456e 7375  '''.        Ensu
-000206a0: 7265 2074 6861 7420 7468 6520 6d61 736b  re that the mask
-000206b0: 2076 6f78 656c 2073 697a 6573 206f 6620   voxel sizes of 
-000206c0: 3c73 656c 663e 2061 6e64 203c 6f74 6865  <self> and <othe
-000206d0: 723e 206d 6174 6368 2e0a 0a20 2020 2020  r> match...     
-000206e0: 2020 2054 6865 206d 6173 6b20 766f 7865     The mask voxe
-000206f0: 6c5f 7369 7a65 7320 666f 7220 626f 7468  l_sizes for both
-00020700: 206d 6179 206f 7074 696f 6e61 6c6c 7920   may optionally 
-00020710: 6265 2073 6574 2074 6f20 6120 6e65 770a  be set to a new.
-00020720: 2020 2020 2020 2020 636f 6d6d 6f6e 2076          common v
-00020730: 616c 7565 2e0a 0a20 2020 2020 2020 202a  alue...        *
-00020740: 2a50 6172 616d 7465 7273 3a2a 2a0a 0a20  *Paramters:**.. 
-00020750: 2020 2020 2020 206f 7468 6572 203a 2073         other : s
-00020760: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
-00020770: 4f49 0a20 2020 2020 2020 2020 2020 2052  OI.            R
-00020780: 4f49 2077 6974 6820 7768 6963 6820 766f  OI with which vo
-00020790: 7865 6c20 7369 7a65 2069 7320 746f 2062  xel size is to b
-000207a0: 6520 6d61 7463 6865 642e 0a0a 2020 2020  e matched...    
-000207b0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
-000207c0: 2074 7570 6c65 2c20 6465 6661 756c 743d   tuple, default=
-000207d0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000207e0: 2056 6f78 656c 2073 697a 6520 2864 782c   Voxel size (dx,
-000207f0: 2064 792c 2064 7a29 2069 6e20 6d6d 2074   dy, dz) in mm t
-00020800: 6f20 6265 2075 7365 6420 666f 7220 524f  o be used for RO
-00020810: 4920 6d61 736b 730a 2020 2020 2020 2020  I masks.        
-00020820: 2020 2020 6672 6f6d 2077 6869 6368 2074      from which t
-00020830: 6f20 6361 6c63 756c 6174 6520 7375 7266  o calculate surf
-00020840: 6163 6520 6469 7374 616e 6365 732e 2020  ace distances.  
-00020850: 4966 204e 6f6e 652c 0a20 2020 2020 2020  If None,.       
-00020860: 2020 2020 2074 6865 206d 6173 6b20 766f       the mask vo
-00020870: 7865 6c20 7369 7a65 206f 6620 3c6f 7468  xel size of <oth
-00020880: 6572 3e20 6973 2075 7365 6420 6966 206e  er> is used if n
-00020890: 6f74 204e 6f6e 653b 0a20 2020 2020 2020  ot None;.       
-000208a0: 2020 2020 206f 7468 6572 7769 7365 2074       otherwise t
-000208b0: 6865 2064 6566 6175 6c74 2076 6f78 656c  he default voxel
-000208c0: 2073 697a 6520 666f 7220 6475 6d6d 7920   size for dummy 
-000208d0: 696d 6167 6573 2c0a 2020 2020 2020 2020  images,.        
-000208e0: 2020 2020 6e61 6d65 6c79 2028 312c 2031      namely (1, 1
-000208f0: 2c20 3129 2c20 6973 2075 7365 642e 2020  , 1), is used.  
-00020900: 4966 2061 6e20 656c 656d 656e 7420 6f66  If an element of
-00020910: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00020920: 2074 7570 6c65 2073 7065 6369 6679 696e   tuple specifyin
-00020930: 6720 766f 7865 6c20 7369 7a65 2069 7320  g voxel size is 
-00020940: 4e6f 6e65 2c20 7468 6520 7661 6c75 6520  None, the value 
-00020950: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-00020960: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
-00020970: 6720 656c 656d 656e 7420 6f66 2074 6865  g element of the
-00020980: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
-00020990: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-000209a0: 3c6f 7468 6572 3e20 6973 2075 7365 642e  <other> is used.
-000209b0: 0a0a 2020 2020 2020 2020 766f 7865 6c5f  ..        voxel_
-000209c0: 6469 6d5f 746f 6c65 7261 6e63 6520 3a20  dim_tolerance : 
-000209d0: 666c 6f61 742c 2064 6566 6175 6c74 3d30  float, default=0
-000209e0: 2e31 0a20 2020 2020 2020 2020 2020 204d  .1.            M
-000209f0: 6178 696d 756d 2061 6363 6570 7465 6420  aximum accepted 
-00020a00: 7661 6c75 6520 666f 7220 7468 6520 6162  value for the ab
-00020a10: 736f 6c75 7465 2064 6966 6665 7265 6e63  solute differenc
-00020a20: 6520 696e 2076 6f78 656c 2073 697a 650a  e in voxel size.
-00020a30: 2020 2020 2020 2020 2020 2020 2861 6e79              (any
-00020a40: 2064 696d 656e 7369 6f6e 2920 6f66 2074   dimension) of t
-00020a50: 6865 2052 4f49 206d 6173 6b73 2066 6f72  he ROI masks for
-00020a60: 2074 6865 6d20 746f 2062 6520 636f 6e73   them to be cons
-00020a70: 6964 6572 6564 0a20 2020 2020 2020 2020  idered.         
-00020a80: 2020 2061 7320 6861 7669 6e67 2074 6865     as having the
-00020a90: 2073 616d 6520 766f 7865 6c20 7369 7a65   same voxel size
-00020aa0: 2e20 2049 6620 6120 6e65 6761 7469 7665  .  If a negative
-00020ab0: 2076 616c 7565 2069 7320 6769 7665 6e2c   value is given,
-00020ac0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00020ad0: 2061 6273 6f6c 7574 6520 6469 6666 6572   absolute differ
-00020ae0: 656e 6365 2069 7320 6e65 7665 7220 6265  ence is never be
-00020af0: 6c6f 7720 7468 6973 2c20 666f 7263 696e  low this, forcin
-00020b00: 6720 6372 6561 7469 6f6e 0a20 2020 2020  g creation.     
-00020b10: 2020 2020 2020 206f 6620 6e65 7720 6d61         of new ma
-00020b20: 736b 7320 7769 7468 2074 6865 2074 6865  sks with the the
-00020b30: 2073 7065 6369 6669 6564 2076 6f78 656c   specified voxel
-00020b40: 2073 697a 652e 2020 5468 6973 2063 616e   size.  This can
-00020b50: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
-00020b60: 7573 6566 756c 2066 6f72 206f 6274 6169  useful for obtai
-00020b70: 6e69 6e67 206d 6173 6b73 2074 6861 7420  ning masks that 
-00020b80: 6172 6520 6a75 7374 206c 6172 6765 2065  are just large e
-00020b90: 6e6f 7567 6820 746f 2063 6f6e 7461 696e  nough to contain
-00020ba0: 0a20 2020 2020 2020 2020 2020 2062 6f74  .            bot
-00020bb0: 6820 524f 4973 2c20 706f 7465 6e74 6961  h ROIs, potentia
-00020bc0: 6c6c 7920 7265 6475 6369 6e67 2074 6865  lly reducing the
-00020bd0: 2074 696d 6520 666f 7220 7375 7266 6163   time for surfac
-00020be0: 652d 6469 7374 616e 6365 0a20 2020 2020  e-distance.     
-00020bf0: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
-00020c00: 6f6e 732e 0a20 2020 2020 2020 2027 2727  ons..        '''
-00020c10: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-00020c20: 6520 524f 4920 636c 6f6e 6573 2c20 666f  e ROI clones, fo
-00020c30: 7220 7768 6963 6820 766f 7865 6c20 7369  r which voxel si
-00020c40: 7a65 7320 6d61 7920 6265 2061 6c74 6572  zes may be alter
-00020c50: 6564 2e0a 2020 2020 2020 2020 726f 6931  ed..        roi1
-00020c60: 203d 2073 656c 662e 636c 6f6e 6528 290a   = self.clone().
-00020c70: 2020 2020 2020 2020 726f 6932 203d 206f          roi2 = o
-00020c80: 7468 6572 2e63 6c6f 6e65 2829 0a0a 2020  ther.clone()..  
-00020c90: 2020 2020 2020 2320 4173 736f 6369 6174        # Associat
-00020ca0: 6520 6e65 7720 6475 6d6d 7920 696d 6167  e new dummy imag
-00020cb0: 6520 7769 7468 2052 4f49 7320 6966 2072  e with ROIs if r
-00020cc0: 6571 7565 7374 6564 2076 6f78 656c 2073  equested voxel s
-00020cd0: 697a 650a 2020 2020 2020 2020 2320 6973  ize.        # is
-00020ce0: 2064 6966 6665 7265 6e74 2066 726f 6d20   different from 
-00020cf0: 766f 7865 6c20 7369 7a65 206f 6620 6569  voxel size of ei
-00020d00: 7468 6572 2063 7572 7265 6e74 2069 6d61  ther current ima
-00020d10: 6765 2c0a 2020 2020 2020 2020 2320 6f72  ge,.        # or
-00020d20: 2069 6620 6162 736f 6c75 7465 2064 6966   if absolute dif
-00020d30: 6665 7265 6e63 6520 696e 2061 6e79 2064  ference in any d
-00020d40: 696d 656e 7369 6f6e 2062 6574 7765 656e  imension between
-00020d50: 2076 6f78 656c 2073 697a 6573 0a20 2020   voxel sizes.   
-00020d60: 2020 2020 2023 206f 6620 6375 7272 656e       # of curren
-00020d70: 7420 696d 6167 6573 2064 6f6e 2774 206d  t images don't m
-00020d80: 6174 6368 2069 7320 6772 6561 7465 7220  atch is greater 
-00020d90: 7468 616e 2074 6f6c 6572 616e 6365 2e0a  than tolerance..
-00020da0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-00020db0: 7a65 203d 2076 6f78 656c 5f73 697a 6520  ze = voxel_size 
-00020dc0: 6966 2076 6f78 656c 5f73 697a 6520 656c  if voxel_size el
-00020dd0: 7365 2072 6f69 322e 6765 745f 766f 7865  se roi2.get_voxe
-00020de0: 6c5f 7369 7a65 2829 0a20 2020 2020 2020  l_size().       
-00020df0: 2069 6620 766f 7865 6c5f 7369 7a65 2061   if voxel_size a
-00020e00: 6e64 2072 6f69 322e 6765 745f 766f 7865  nd roi2.get_voxe
-00020e10: 6c5f 7369 7a65 2829 3a0a 2020 2020 2020  l_size():.      
-00020e20: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
-00020e30: 203d 205b 766f 7865 6c5f 7369 7a65 5b69   = [voxel_size[i
-00020e40: 6478 5d20 6966 2076 6f78 656c 5f73 697a  dx] if voxel_siz
-00020e50: 655b 6964 785d 2069 7320 6e6f 7420 4e6f  e[idx] is not No
-00020e60: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00020e70: 2020 2020 2020 2065 6c73 6520 726f 6932         else roi2
-00020e80: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
-00020e90: 295b 6964 785d 2066 6f72 2069 6478 2069  )[idx] for idx i
-00020ea0: 6e20 7261 6e67 6528 3329 5d0a 2020 2020  n range(3)].    
-00020eb0: 2020 2020 7265 7369 7a65 203d 206e 6f74      resize = not
-00020ec0: 2072 6f69 312e 6765 745f 766f 7865 6c5f   roi1.get_voxel_
-00020ed0: 7369 7a65 2829 206f 7220 6e6f 7420 726f  size() or not ro
-00020ee0: 6932 2e67 6574 5f76 6f78 656c 5f73 697a  i2.get_voxel_siz
-00020ef0: 6528 290a 2020 2020 2020 2020 6966 206e  e().        if n
-00020f00: 6f74 2072 6573 697a 653a 0a20 2020 2020  ot resize:.     
-00020f10: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
-00020f20: 6e20 5b72 6f69 312c 2072 6f69 325d 3a0a  n [roi1, roi2]:.
-00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f40: 6d61 7463 6865 7320 3d20 5b64 7879 7a31  matches = [dxyz1
-00020f50: 2066 6f72 2064 7879 7a31 2c20 6478 797a   for dxyz1, dxyz
-00020f60: 3220 696e 0a20 2020 2020 2020 2020 2020  2 in.           
-00020f70: 2020 2020 2020 2020 2020 2020 207a 6970               zip
-00020f80: 2876 6f78 656c 5f73 697a 652c 2072 6f69  (voxel_size, roi
-00020f90: 2e76 6f78 656c 5f73 697a 6529 0a20 2020  .voxel_size).   
-00020fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fb0: 2020 2020 2069 6620 6162 7328 6478 797a       if abs(dxyz
-00020fc0: 3120 2d20 6478 797a 3229 203c 2076 6f78  1 - dxyz2) < vox
-00020fd0: 656c 5f64 696d 5f74 6f6c 6572 616e 6365  el_dim_tolerance
-00020fe0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00020ff0: 2020 6966 2033 2021 3d20 6c65 6e28 6d61    if 3 != len(ma
-00021000: 7463 6865 7329 3a0a 2020 2020 2020 2020  tches):.        
-00021010: 2020 2020 2020 2020 2020 2020 7265 7369              resi
-00021020: 7a65 203d 2054 7275 650a 2020 2020 2020  ze = True.      
-00021030: 2020 6966 2072 6573 697a 653a 0a20 2020    if resize:.   
-00021040: 2020 2020 2020 2020 2069 6620 766f 7865           if voxe
-00021050: 6c5f 7369 7a65 3a0a 2020 2020 2020 2020  l_size:.        
-00021060: 2020 2020 2020 2020 736c 6963 655f 7468          slice_th
-00021070: 6963 6b6e 6573 7320 3d20 766f 7865 6c5f  ickness = voxel_
-00021080: 7369 7a65 5b32 5d0a 2020 2020 2020 2020  size[2].        
-00021090: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-000210a0: 7a65 5f32 6420 3d20 766f 7865 6c5f 7369  ze_2d = voxel_si
-000210b0: 7a65 5b3a 325d 0a20 2020 2020 2020 2020  ze[:2].         
-000210c0: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
-000210d0: 7468 6174 2069 6e69 7469 616c 2076 6f78  that initial vox
-000210e0: 656c 2073 697a 6520 6973 2073 6574 2e0a  el size is set..
-000210f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021100: 2320 5468 6973 2069 7320 7573 6564 2074  # This is used t
-00021110: 6f20 6465 6669 6e65 2073 6c69 6365 2074  o define slice t
-00021120: 6869 636b 6e65 7373 0a20 2020 2020 2020  hickness.       
-00021130: 2020 2020 2020 2020 2023 2066 6f72 2061           # for a
-00021140: 6e20 524f 4920 7468 6174 2068 6173 206e  n ROI that has n
-00021150: 6f20 6173 736f 6369 6174 6564 2069 6d61  o associated ima
-00021160: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
-00021170: 2020 2020 2320 616e 6420 6973 2064 6566      # and is def
-00021180: 696e 6564 2062 7920 6f6e 6520 6f72 206d  ined by one or m
-00021190: 6f72 6520 636f 6e74 6f75 7273 206f 6e20  ore contours on 
-000211a0: 6120 7369 6e67 6c65 0a20 2020 2020 2020  a single.       
-000211b0: 2020 2020 2020 2020 2023 2069 6d61 6765           # image
-000211c0: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
-000211d0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-000211e0: 6f69 312e 766f 7865 6c5f 7369 7a65 3a0a  oi1.voxel_size:.
-000211f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021200: 2020 2020 726f 6931 2e76 6f78 656c 5f73      roi1.voxel_s
-00021210: 697a 6520 3d20 766f 7865 6c5f 7369 7a65  ize = voxel_size
-00021220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021230: 2069 6620 6e6f 7420 726f 6932 2e76 6f78   if not roi2.vox
-00021240: 656c 5f73 697a 653a 0a20 2020 2020 2020  el_size:.       
-00021250: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00021260: 322e 766f 7865 6c5f 7369 7a65 203d 2076  2.voxel_size = v
-00021270: 6f78 656c 5f73 697a 650a 2020 2020 2020  oxel_size.      
-00021280: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00021290: 2020 2020 2020 2020 2020 2020 736c 6963              slic
-000212a0: 655f 7468 6963 6b6e 6573 7320 3d20 4e6f  e_thickness = No
-000212b0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-000212c0: 2020 2076 6f78 656c 5f73 697a 655f 3264     voxel_size_2d
-000212d0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-000212e0: 2020 2020 2053 7472 7563 7475 7265 5365       StructureSe
-000212f0: 7428 5b72 6f69 312c 2072 6f69 325d 292e  t([roi1, roi2]).
-00021300: 7365 745f 696d 6167 655f 746f 5f64 756d  set_image_to_dum
-00021310: 6d79 280a 2020 2020 2020 2020 2020 2020  my(.            
-00021320: 2020 2020 2020 2020 736c 6963 655f 7468          slice_th
-00021330: 6963 6b6e 6573 733d 736c 6963 655f 7468  ickness=slice_th
-00021340: 6963 6b6e 6573 732c 2076 6f78 656c 5f73  ickness, voxel_s
-00021350: 697a 653d 766f 7865 6c5f 7369 7a65 5f32  ize=voxel_size_2
-00021360: 6429 0a0a 2020 2020 2020 2020 7265 7475  d)..        retu
-00021370: 726e 2028 726f 6931 2c20 726f 6932 290a  rn (roi1, roi2).
-00021380: 0a20 2020 2064 6566 2067 6574 5f73 7572  .    def get_sur
-00021390: 6661 6365 5f64 6973 7461 6e63 6573 280a  face_distances(.
-000213a0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000213b0: 2020 2020 2020 6f74 6865 722c 0a20 2020        other,.   
-000213c0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-000213d0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
-000213e0: 2073 6967 6e65 643d 4661 6c73 652c 0a20   signed=False,. 
-000213f0: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
-00021400: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
-00021410: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
-00021420: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
-00021430: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-00021440: 636f 6e6e 6563 7469 7669 7479 3d32 2c0a  connectivity=2,.
-00021450: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
-00021460: 4661 6c73 652c 0a20 2020 2020 2020 2073  False,.        s
-00021470: 796d 6d65 7472 6963 3d4e 6f6e 652c 0a20  ymmetric=None,. 
-00021480: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
-00021490: 793d 4661 6c73 652c 0a20 2020 2020 2020  y=False,.       
-000214a0: 2069 6e5f 736c 6963 653d 5472 7565 2c0a   in_slice=True,.
-000214b0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-000214c0: 7a65 3d4e 6f6e 652c 0a20 2020 2020 2020  ze=None,.       
-000214d0: 2076 6f78 656c 5f64 696d 5f74 6f6c 6572   voxel_dim_toler
-000214e0: 616e 6365 3d30 2e31 2c0a 2020 2020 293a  ance=0.1,.    ):
-000214f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00021500: 2020 2020 2047 6574 2076 6563 746f 7220       Get vector 
-00021510: 6f66 2073 7572 6661 6365 2064 6973 7461  of surface dista
-00021520: 6e63 6573 2062 6574 7765 656e 2074 776f  nces between two
-00021530: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
-00021540: 5375 7266 6163 6520 6469 7374 616e 6365  Surface distance
-00021550: 7320 6d61 7920 6265 2073 6967 6e65 6420  s may be signed 
-00021560: 6f72 2075 6e73 6967 6e65 642c 2061 6e64  or unsigned, and
-00021570: 206d 6179 2062 6520 666f 7220 6120 7369   may be for a si
-00021580: 6e67 6c65 0a20 2020 2020 2020 2073 6c69  ngle.        sli
-00021590: 6365 2074 6872 6f75 6768 2074 6865 2052  ce through the R
-000215a0: 4f49 732c 206f 7220 666f 7220 7468 6520  OIs, or for the 
-000215b0: 3344 2076 6f6c 756d 6573 2e20 200a 0a20  3D volumes.  .. 
-000215c0: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
-000215d0: 7469 6f6e 2075 7365 7320 6964 6561 7320  tion uses ideas 
-000215e0: 6f75 746c 696e 6564 2061 743a 0a20 2020  outlined at:.   
-000215f0: 2020 2020 2068 7474 7073 3a2f 2f6d 6c6e       https://mln
-00021600: 6f74 6562 6f6f 6b2e 6769 7468 7562 2e69  otebook.github.i
-00021610: 6f2f 706f 7374 2f73 7572 6661 6365 2d64  o/post/surface-d
-00021620: 6973 7461 6e63 652d 6675 6e63 7469 6f6e  istance-function
-00021630: 2f0a 0a20 2020 2020 2020 202a 2a50 6172  /..        **Par
-00021640: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
-00021650: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
-00021660: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00021670: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-00021680: 2020 2049 6620 4661 6c73 652c 2072 6574     If False, ret
-00021690: 7572 6e20 7375 7266 6163 6520 6469 7374  urn surface dist
-000216a0: 616e 6365 7320 7265 6c61 7469 7665 2074  ances relative t
-000216b0: 6f20 3344 2076 6f6c 756d 6573 2e0a 2020  o 3D volumes..  
-000216c0: 2020 2020 2020 2020 2020 4f74 6865 7277            Otherw
-000216d0: 6973 652c 2072 6574 7572 6e20 7375 7266  ise, return surf
-000216e0: 6163 6520 6469 7374 616e 6365 7320 666f  ace distances fo
-000216f0: 7220 6120 7369 6e67 6c65 2069 6d61 6765  r a single image
-00021700: 2073 6c69 6365 2e0a 0a20 2020 2020 2020   slice...       
-00021710: 2073 6967 6e65 6420 3a20 626f 6f6c 2c20   signed : bool, 
-00021720: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
-00021730: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
-00021740: 7365 2c20 7265 7475 726e 2061 6273 6f6c  se, return absol
-00021750: 7574 6520 7375 7266 6163 6520 6469 7374  ute surface dist
-00021760: 616e 6365 732e 0a20 2020 2020 2020 2020  ances..         
-00021770: 2020 2049 6620 5472 7565 2c20 7265 7475     If True, retu
-00021780: 726e 2073 6967 6e65 6420 7375 7266 6163  rn signed surfac
-00021790: 6520 6469 7374 616e 6365 732e 2020 4120  e distances.  A 
-000217a0: 706f 696e 7420 6f6e 2074 6865 0a20 2020  point on the.   
-000217b0: 2020 2020 2020 2020 2073 7572 6661 6365           surface
-000217c0: 206f 6620 3c6f 7468 6572 3e20 6973 2074   of <other> is t
-000217d0: 616b 656e 2074 6f20 6265 2061 7420 6120  aken to be at a 
-000217e0: 706f 7369 7469 7665 2064 6973 7461 6e63  positive distanc
-000217f0: 6520 6966 0a20 2020 2020 2020 2020 2020  e if.           
-00021800: 206f 7574 7369 6465 203c 7365 6c66 3e2c   outside <self>,
-00021810: 2061 6e64 2061 7420 6120 6e65 6761 7469   and at a negati
-00021820: 7665 2064 6973 7461 6e63 6520 6966 2069  ve distance if i
-00021830: 6e73 6964 652e 0a0a 2020 2020 2020 2020  nside...        
-00021840: 7669 6577 203a 2073 7472 2c20 6465 6661  view : str, defa
-00021850: 756c 743d 2278 2d79 220a 2020 2020 2020  ult="x-y".      
-00021860: 2020 2020 2020 4f72 6965 6e74 6174 696f        Orientatio
-00021870: 6e20 6f66 2073 6c69 6365 2066 6f72 2077  n of slice for w
-00021880: 6869 6368 2074 6f20 6f62 7461 696e 2073  hich to obtain s
-00021890: 7572 6661 6365 2064 6973 7461 6e63 6573  urface distances
-000218a0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
-000218b0: 6c79 2075 7365 6420 6966 2065 6974 6865  ly used if eithe
-000218c0: 7220 3c73 696e 676c 655f 736c 6963 653e  r <single_slice>
-000218d0: 206f 7220 3c66 6c61 7474 656e 3e20 6973   or <flatten> is
-000218e0: 2054 7275 652e 0a0a 2020 2020 2020 2020   True...        
-000218f0: 736c 203a 2069 6e74 2c20 6465 6661 756c  sl : int, defaul
-00021900: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00021910: 2020 2053 6c69 6365 206e 756d 6265 722e     Slice number.
-00021920: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
-00021930: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
-00021940: 2069 7320 7375 7070 6c69 6564 2062 7574   is supplied but
-00021950: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-00021960: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-00021970: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-00021980: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
-00021990: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
-000219a0: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
-000219b0: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-000219c0: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
-000219d0: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
-000219e0: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
-000219f0: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-00021a00: 733e 2069 7320 0a20 2020 2020 2020 2020  s> is .         
-00021a10: 2020 2073 7570 706c 6965 6420 6275 7420     supplied but 
-00021a20: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-00021a30: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-00021a40: 7261 6c20 736c 6963 6520 6f66 0a20 2020  ral slice of.   
-00021a50: 2020 2020 2020 2020 2074 6865 2052 4f49           the ROI
-00021a60: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-00021a70: 2020 2020 2020 2020 706f 7320 3a20 666c          pos : fl
-00021a80: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
-00021a90: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-00021aa0: 6963 6520 706f 7369 7469 6f6e 2069 6e20  ice position in 
-00021ab0: 6d6d 2e20 4966 206e 6f6e 6520 6f66 203c  mm. If none of <
-00021ac0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-00021ad0: 6f73 3e20 6973 2073 7570 706c 6965 640a  os> is supplied.
-00021ae0: 2020 2020 2020 2020 2020 2020 6275 7420              but 
-00021af0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-00021b00: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-00021b10: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
-00021b20: 2052 4f49 2077 696c 6c0a 2020 2020 2020   ROI will.      
-00021b30: 2020 2020 2020 6265 2075 7365 642e 0a0a        be used...
-00021b40: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-00021b50: 7669 7479 3a20 696e 742c 2064 6566 6175  vity: int, defau
-00021b60: 6c74 3d32 0a20 2020 2020 2020 2020 2020  lt=2.           
-00021b70: 2049 6e74 6567 6572 2064 6566 696e 696e   Integer definin
-00021b80: 6720 7768 6963 6820 766f 7865 6c73 2074  g which voxels t
-00021b90: 6f20 636f 6e73 6964 6572 2061 7320 6e65  o consider as ne
-00021ba0: 6967 6862 6f75 7273 0a20 2020 2020 2020  ighbours.       
-00021bb0: 2020 2020 2077 6865 6e20 7065 7266 6f72       when perfor
-00021bc0: 6d69 6e67 2065 726f 7369 6f6e 206f 7065  ming erosion ope
-00021bd0: 7261 7469 6f6e 2074 6f20 6964 656e 7469  ration to identi
-00021be0: 6679 2052 4f49 2073 7572 6661 6365 732e  fy ROI surfaces.
-00021bf0: 2020 5468 6973 0a20 2020 2020 2020 2020    This.         
-00021c00: 2020 2069 7320 7061 7373 6564 2061 7320     is passed as 
-00021c10: 3c63 6f6e 6e65 6374 6976 6974 793e 2070  <connectivity> p
-00021c20: 6172 616d 6574 6572 2074 6f3a 0a20 2020  arameter to:.   
-00021c30: 2020 2020 2020 2020 2073 6369 7079 2e6e           scipy.n
-00021c40: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
-00021c50: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
-00021c60: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
-00021c70: 2066 7572 7468 6572 2064 6574 6169 6c73   further details
-00021c80: 2c20 7365 653a 0a20 2020 2020 2020 2020  , see:.         
-00021c90: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
-00021ca0: 7363 6970 792e 6f72 672f 646f 632f 7363  scipy.org/doc/sc
-00021cb0: 6970 792f 7265 6665 7265 6e63 652f 6765  ipy/reference/ge
-00021cc0: 6e65 7261 7465 642f 7363 6970 792e 6e64  nerated/scipy.nd
-00021cd0: 696d 6167 652e 6765 6e65 7261 7465 5f62  image.generate_b
-00021ce0: 696e 6172 795f 7374 7275 6374 7572 652e  inary_structure.
-00021cf0: 6874 6d6c 0a0a 2020 2020 2020 2020 666c  html..        fl
-00021d00: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
-00021d10: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00021d20: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00021d30: 2061 6c6c 2073 6c69 6365 7320 666f 7220   all slices for 
-00021d40: 6561 6368 2052 4f49 2077 696c 6c20 6265  each ROI will be
-00021d50: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
-00021d60: 6520 6769 7665 6e0a 2020 2020 2020 2020  e given.        
-00021d70: 2020 2020 6f72 6965 6e74 6174 696f 6e2c      orientation,
-00021d80: 2061 6e64 2073 7572 6661 6365 2064 6973   and surface dis
-00021d90: 7461 6e63 6573 2072 656c 6174 6976 6520  tances relative 
-00021da0: 746f 2074 6865 2066 6c61 7474 656e 6564  to the flattened
-00021db0: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
-00021dc0: 6365 2077 696c 6c20 6265 2072 6574 7572  ce will be retur
-00021dd0: 6e65 642e 0a0a 2020 2020 2020 2020 7379  ned...        sy
-00021de0: 6d6d 6574 7269 6320 3a20 626f 6f6c 2c20  mmetric : bool, 
-00021df0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00021e00: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00021e10: 2c20 7468 6520 6469 7374 616e 6365 7320  , the distances 
-00021e20: 7265 7475 726e 6564 2061 7265 2066 726f  returned are fro
-00021e30: 6d20 7468 6520 7375 7266 6163 6520 6f66  m the surface of
-00021e40: 203c 6f74 6865 723e 0a20 2020 2020 2020   <other>.       
-00021e50: 2020 2020 2074 6f20 7468 6520 7375 7266       to the surf
-00021e60: 6163 6520 6f66 203c 7365 6c66 3e20 616e  ace of <self> an
-00021e70: 6420 6672 6f6d 2074 6865 2073 7572 6661  d from the surfa
-00021e80: 6365 206f 6620 3c73 656c 663e 2074 6f20  ce of <self> to 
-00021e90: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00021ea0: 7375 7266 6163 6520 6f66 203c 6f74 6865  surface of <othe
-00021eb0: 723e 2e20 2049 6620 4661 6c73 652c 2064  r>.  If False, d
-00021ec0: 6973 7461 6e63 6573 2061 7265 2066 726f  istances are fro
-00021ed0: 6d20 7468 6520 7375 7266 6163 650a 2020  m the surface.  
-00021ee0: 2020 2020 2020 2020 2020 6f66 203c 6f74            of <ot
-00021ef0: 6865 723e 2074 6f20 7468 6520 7375 7266  her> to the surf
-00021f00: 6163 6520 6f66 203c 7365 6c66 3e20 6f6e  ace of <self> on
-00021f10: 6c79 2e20 2049 6620 4e6f 6e65 2c20 7365  ly.  If None, se
-00021f20: 7420 746f 0a20 2020 2020 2020 2020 2020  t to.           
-00021f30: 2074 6865 206f 7070 6f73 6973 7465 206f   the opposiste o
-00021f40: 6620 3c73 6967 6e65 643e 2e0a 0a20 2020  f <signed>...   
-00021f50: 2020 2020 2020 636f 6e66 6f72 6d69 7479        conformity
-00021f60: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00021f70: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-00021f80: 2020 2020 4966 2054 7275 652c 2064 6973      If True, dis
-00021f90: 7461 6e63 6573 2072 6574 7572 6e65 6420  tances returned 
-00021fa0: 6172 6520 7369 676e 6564 2064 6973 7461  are signed dista
-00021fb0: 6e63 6573 2074 6f20 636f 6e66 6f72 6d69  nces to conformi
-00021fc0: 7479 2c0a 2020 2020 2020 2020 2020 2020  ty,.            
-00021fd0: 2061 7320 6465 6669 6e65 6420 696e 3a0a   as defined in:.
-00021fe0: 2020 2020 2020 2020 2020 2020 2068 7474               htt
-00021ff0: 7073 3a2f 2f64 6f69 2e6f 7267 2f31 302e  ps://doi.org/10.
-00022000: 3132 3539 2f62 6a72 2f32 3736 3734 3538  1259/bjr/2767458
-00022010: 310a 2020 2020 2020 2020 2020 2020 2049  1.             I
-00022020: 6e20 7468 6973 2063 6173 652c 2074 6865  n this case, the
-00022030: 2076 616c 7565 7320 6f66 203c 7369 676e   values of <sign
-00022040: 6564 3e20 616e 6420 3c73 796d 6d65 7472  ed> and <symmetr
-00022050: 6963 3e0a 2020 2020 2020 2020 2020 2020  ic>.            
-00022060: 2061 7265 2064 6973 7265 6761 7264 6564   are disregarded
-00022070: 2e0a 0a20 2020 2020 2020 2069 6e5f 736c  ...        in_sl
-00022080: 6963 6520 3a20 626f 6f6c 2c20 6465 6661  ice : bool, defa
-00022090: 756c 743d 5472 7565 0a20 2020 2020 2020  ult=True.       
-000220a0: 2020 2020 2049 6620 5472 7565 2c20 6f6e       If True, on
-000220b0: 6c79 2069 6e74 7261 2d73 6c69 6365 2063  ly intra-slice c
-000220c0: 6f6e 6e65 6374 6976 6974 7920 6973 2063  onnectivity is c
-000220d0: 6f6e 7369 6465 7265 6420 7768 656e 0a20  onsidered when. 
-000220e0: 2020 2020 2020 2020 2020 2070 6572 666f             perfo
-000220f0: 726d 696e 6720 6572 6f73 696f 6e20 746f  rming erosion to
-00022100: 2069 6465 6e74 6966 7920 524f 4920 7375   identify ROI su
-00022110: 7266 6163 6573 2e0a 0a20 2020 2020 2020  rfaces...       
-00022120: 2076 6f78 656c 5f73 697a 6520 3a20 7475   voxel_size : tu
-00022130: 706c 652c 2064 6566 6175 6c74 3d4e 6f6e  ple, default=Non
-00022140: 650a 2020 2020 2020 2020 2020 2020 566f  e.            Vo
-00022150: 7865 6c20 7369 7a65 2028 6478 2c20 6479  xel size (dx, dy
-00022160: 2c20 647a 2920 696e 206d 6d20 746f 2062  , dz) in mm to b
-00022170: 6520 7573 6564 2066 6f72 2052 4f49 206d  e used for ROI m
-00022180: 6173 6b73 0a20 2020 2020 2020 2020 2020  asks.           
-00022190: 2066 726f 6d20 7768 6963 6820 746f 2063   from which to c
-000221a0: 616c 6375 6c61 7465 2073 7572 6661 6365  alculate surface
-000221b0: 2064 6973 7461 6e63 6573 2e20 2049 6620   distances.  If 
-000221c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-000221d0: 2020 7468 6520 6d61 736b 2076 6f78 656c    the mask voxel
-000221e0: 2073 697a 6520 6f66 203c 6f74 6865 723e   size of <other>
-000221f0: 2069 7320 7573 6564 2e20 2049 6620 616e   is used.  If an
-00022200: 2069 6e64 6976 6964 7561 6c0a 2020 2020   individual.    
-00022210: 2020 2020 2020 2020 656c 656d 656e 7420          element 
-00022220: 6973 204e 6f6e 652c 2074 6865 2076 616c  is None, the val
-00022230: 7565 206f 6620 7468 6520 636f 7272 6573  ue of the corres
-00022240: 706f 6e64 696e 6720 656c 656d 656e 7420  ponding element 
-00022250: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-00022260: 7468 6520 6d61 736b 2076 6f78 656c 2073  the mask voxel s
-00022270: 697a 6520 6f66 203c 6f74 6865 723e 2069  ize of <other> i
-00022280: 7320 7573 6564 2e0a 0a20 2020 2020 2020  s used...       
-00022290: 2076 6f78 656c 5f64 696d 5f74 6f6c 6572   voxel_dim_toler
-000222a0: 616e 6365 203a 2066 6c6f 6174 2c20 6465  ance : float, de
-000222b0: 6661 756c 743d 302e 310a 2020 2020 2020  fault=0.1.      
-000222c0: 2020 2020 2020 546f 6c65 7265 6e63 6520        Tolerence 
-000222d0: 7573 6564 2077 6865 6e20 6465 7465 726d  used when determ
-000222e0: 696e 696e 6720 7768 6574 6865 7220 3c76  ining whether <v
-000222f0: 6f78 656c 5f73 697a 653e 2069 730a 2020  oxel_size> is.  
-00022300: 2020 2020 2020 2020 2020 6469 6666 6572            differ
-00022310: 656e 7420 6672 6f6d 2074 6865 2076 6f78  ent from the vox
-00022320: 656c 2073 697a 6520 6f66 2074 6865 2069  el size of the i
-00022330: 6d61 6765 7320 6173 736f 6369 6174 6564  mages associated
-00022340: 2077 6974 680a 2020 2020 2020 2020 2020   with.          
-00022350: 2020 6561 6368 2052 4f49 2e0a 2020 2020    each ROI..    
-00022360: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00022370: 2023 2053 6574 2076 6965 7720 746f 204e   # Set view to N
-00022380: 6f6e 6520 6966 2063 6f6e 7369 6465 7269  one if consideri
-00022390: 6e67 2033 4420 6d61 736b 2e0a 2020 2020  ng 3D mask..    
-000223a0: 2020 2020 6966 206e 6f74 2073 696e 676c      if not singl
-000223b0: 655f 736c 6963 6520 616e 6420 6e6f 7420  e_slice and not 
-000223c0: 666c 6174 7465 6e3a 0a20 2020 2020 2020  flatten:.       
-000223d0: 2020 2020 2076 6965 7720 3d20 4e6f 6e65       view = None
-000223e0: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-000223f0: 746f 2046 616c 7365 2070 6172 616d 6574  to False paramet
-00022400: 6572 7320 7468 6174 2061 7265 2074 6f20  ers that are to 
-00022410: 6265 2069 676e 6f72 6564 0a20 2020 2020  be ignored.     
-00022420: 2020 2023 2077 6865 6e20 6361 6c63 756c     # when calcul
-00022430: 6174 696e 6720 6469 7374 616e 6365 7320  ating distances 
-00022440: 746f 2063 6f6e 666f 726d 6974 792e 0a20  to conformity.. 
-00022450: 2020 2020 2020 2069 6620 636f 6e66 6f72         if confor
-00022460: 6d69 7479 3a0a 2020 2020 2020 2020 2020  mity:.          
-00022470: 2020 7379 6d6d 6574 7269 6320 3d20 7369    symmetric = si
-00022480: 676e 6564 203d 2046 616c 7365 0a0a 2020  gned = False..  
-00022490: 2020 2020 2020 2320 4465 6661 756c 7420        # Default 
-000224a0: 746f 2073 796d 6d65 7472 6963 206f 7220  to symmetric or 
-000224b0: 6f6e 652d 7761 7920 6469 7374 616e 6365  one-way distance
-000224c0: 732c 0a20 2020 2020 2020 2023 2064 6570  s,.        # dep
-000224d0: 656e 6469 6e67 206f 6e20 7768 6574 6865  ending on whethe
-000224e0: 7220 6469 7374 616e 6365 7320 6172 6520  r distances are 
-000224f0: 7369 676e 6564 206f 7220 756e 7369 676e  signed or unsign
-00022500: 6564 2e0a 2020 2020 2020 2020 6966 2073  ed..        if s
-00022510: 796d 6d65 7472 6963 2069 7320 4e6f 6e65  ymmetric is None
-00022520: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
-00022530: 6d6d 6574 7269 6320 3d20 4661 6c73 6520  mmetric = False 
-00022540: 6966 2073 6967 6e65 6420 6973 2054 7275  if signed is Tru
-00022550: 6520 656c 7365 2054 7275 650a 0a20 2020  e else True..   
-00022560: 2020 2020 2023 204f 6274 6169 6e20 524f       # Obtain RO
-00022570: 4920 636c 6f6e 6573 2c20 7769 7468 206d  I clones, with m
-00022580: 6173 6b20 766f 7865 6c20 7369 7a65 7320  ask voxel sizes 
-00022590: 6d61 7463 6865 6420 746f 2076 6f78 656c  matched to voxel
-000225a0: 5f73 697a 650a 2020 2020 2020 2020 2320  _size.        # 
-000225b0: 6966 206e 6f6e 2d6e 756c 6c2c 206f 7220  if non-null, or 
-000225c0: 6f74 6865 7277 6973 6520 746f 2074 6865  otherwise to the
-000225d0: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
-000225e0: 206f 6620 6f74 6865 722e 0a20 2020 2020   of other..     
-000225f0: 2020 2072 6f69 312c 2072 6f69 3220 3d20     roi1, roi2 = 
-00022600: 7365 6c66 2e6d 6174 6368 5f6d 6173 6b5f  self.match_mask_
-00022610: 766f 7865 6c5f 7369 7a65 286f 7468 6572  voxel_size(other
-00022620: 2c20 766f 7865 6c5f 7369 7a65 2c0a 2020  , voxel_size,.  
-00022630: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-00022640: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
-00022650: 6529 0a0a 2020 2020 2020 2020 2320 4368  e)..        # Ch
-00022660: 6563 6b20 7768 6574 6865 7220 524f 4973  eck whether ROIs
-00022670: 2061 7265 2065 6d70 7479 0a20 2020 2020   are empty.     
-00022680: 2020 2069 6620 6e6f 7420 6e70 2e61 6e79     if not np.any
-00022690: 2872 6f69 312e 6765 745f 6d61 736b 2829  (roi1.get_mask()
-000226a0: 2920 6f72 206e 6f74 206e 702e 616e 7928  ) or not np.any(
-000226b0: 726f 6932 2e67 6574 5f6d 6173 6b28 2929  roi2.get_mask())
-000226c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000226d0: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
-000226e0: 4765 7420 766f 7865 6c20 7369 7a65 2072  Get voxel size r
-000226f0: 656c 6174 6976 6520 746f 2061 7865 7320  elative to axes 
-00022700: 6f66 206e 756d 7079 2061 7272 6179 2e0a  of numpy array..
-00022710: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-00022720: 7a65 203d 2072 6f69 312e 6765 745f 6e70  ze = roi1.get_np
-00022730: 5f76 6f78 656c 5f73 697a 6528 7669 6577  _voxel_size(view
-00022740: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
-00022750: 2062 696e 6172 7920 6d61 736b 730a 2020   binary masks.  
-00022760: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
-00022770: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
-00022780: 2020 206d 6173 6b31 203d 2072 6f69 312e     mask1 = roi1.
-00022790: 6765 745f 736c 6963 6528 7669 6577 2c20  get_slice(view, 
-000227a0: 736c 3d73 6c2c 2069 6478 3d69 6478 2c20  sl=sl, idx=idx, 
-000227b0: 706f 733d 706f 7329 0a20 2020 2020 2020  pos=pos).       
-000227c0: 2020 2020 206d 6173 6b32 203d 2072 6f69       mask2 = roi
-000227d0: 322e 6765 745f 736c 6963 6528 7669 6577  2.get_slice(view
-000227e0: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
-000227f0: 2c20 706f 733d 706f 7329 0a20 2020 2020  , pos=pos).     
-00022800: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00022810: 2020 2020 206d 6173 6b31 203d 2072 6f69       mask1 = roi
-00022820: 312e 6765 745f 6d61 736b 2876 6965 772c  1.get_mask(view,
-00022830: 2066 6c61 7474 656e 3d66 6c61 7474 656e   flatten=flatten
-00022840: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
-00022850: 736b 3220 3d20 726f 6932 2e67 6574 5f6d  sk2 = roi2.get_m
-00022860: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
-00022870: 6e3d 666c 6174 7465 6e29 0a0a 2020 2020  n=flatten)..    
-00022880: 2020 2020 2320 4d61 6b65 2073 7472 7563      # Make struc
-00022890: 7475 7269 6e67 2065 6c65 6d65 6e74 0a20  turing element. 
-000228a0: 2020 2020 2020 2063 6f6e 6e32 203d 206e         conn2 = n
-000228b0: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
-000228c0: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
-000228d0: 2832 2c20 636f 6e6e 6563 7469 7669 7479  (2, connectivity
-000228e0: 290a 2020 2020 2020 2020 6966 206d 6173  ).        if mas
-000228f0: 6b31 2e6e 6469 6d20 3d3d 2032 3a0a 2020  k1.ndim == 2:.  
-00022900: 2020 2020 2020 2020 2020 636f 6e6e 203d            conn =
-00022910: 2063 6f6e 6e32 0a20 2020 2020 2020 2065   conn2.        e
-00022920: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00022930: 2069 6620 696e 5f73 6c69 6365 3a0a 2020   if in_slice:.  
-00022940: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00022950: 6e6e 203d 206e 702e 7a65 726f 7328 2833  nn = np.zeros((3
-00022960: 2c20 332c 2033 292c 2064 7479 7065 3d62  , 3, 3), dtype=b
-00022970: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
-00022980: 2020 2020 2063 6f6e 6e5b 3a2c 203a 2c20       conn[:, :, 
-00022990: 315d 203d 2063 6f6e 6e32 0a20 2020 2020  1] = conn2.     
-000229a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000229b0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000229c0: 6e20 3d20 6e64 696d 6167 652e 6765 6e65  n = ndimage.gene
-000229d0: 7261 7465 5f62 696e 6172 795f 7374 7275  rate_binary_stru
-000229e0: 6374 7572 6528 332c 2063 6f6e 6e65 6374  cture(3, connect
-000229f0: 6976 6974 7929 0a0a 2020 2020 2020 2020  ivity)..        
-00022a00: 2320 4765 7420 6f75 7465 7220 7069 7865  # Get outer pixe
-00022a10: 6c20 6f66 2062 696e 6172 7920 6d61 7073  l of binary maps
-00022a20: 0a20 2020 2020 2020 2073 7572 6631 203d  .        surf1 =
-00022a30: 206d 6173 6b31 205e 206e 6469 6d61 6765   mask1 ^ ndimage
-00022a40: 2e62 696e 6172 795f 6572 6f73 696f 6e28  .binary_erosion(
-00022a50: 6d61 736b 312c 2063 6f6e 6e29 0a20 2020  mask1, conn).   
-00022a60: 2020 2020 2073 7572 6632 203d 206d 6173       surf2 = mas
-00022a70: 6b32 205e 206e 6469 6d61 6765 2e62 696e  k2 ^ ndimage.bin
-00022a80: 6172 795f 6572 6f73 696f 6e28 6d61 736b  ary_erosion(mask
-00022a90: 322c 2063 6f6e 6e29 0a0a 2020 2020 2020  2, conn)..      
-00022aa0: 2020 2320 4d61 6b65 2061 7272 6179 7320    # Make arrays 
-00022ab0: 6f66 2064 6973 7461 6e63 6573 2074 6f20  of distances to 
-00022ac0: 7375 7266 6163 6520 6f66 2065 6163 6820  surface of each 
-00022ad0: 524f 490a 2020 2020 2020 2020 6469 7374  ROI.        dist
-00022ae0: 3120 3d20 6e64 696d 6167 652e 6469 7374  1 = ndimage.dist
-00022af0: 616e 6365 5f74 7261 6e73 666f 726d 5f65  ance_transform_e
-00022b00: 6474 287e 7375 7266 312c 2076 6f78 656c  dt(~surf1, voxel
-00022b10: 5f73 697a 6529 0a20 2020 2020 2020 2064  _size).        d
-00022b20: 6973 7432 203d 206e 6469 6d61 6765 2e64  ist2 = ndimage.d
-00022b30: 6973 7461 6e63 655f 7472 616e 7366 6f72  istance_transfor
-00022b40: 6d5f 6564 7428 7e73 7572 6632 2c20 766f  m_edt(~surf2, vo
-00022b50: 7865 6c5f 7369 7a65 290a 0a20 2020 2020  xel_size)..     
-00022b60: 2020 2023 2047 6574 2073 6967 6e65 6420     # Get signed 
-00022b70: 6469 7374 616e 6365 730a 2020 2020 2020  distances.      
-00022b80: 2020 6966 2073 6967 6e65 643a 0a20 2020    if signed:.   
-00022b90: 2020 2020 2020 2020 2064 6973 7431 203d           dist1 =
-00022ba0: 2064 6973 7431 202a 207e 6d61 736b 3120   dist1 * ~mask1 
-00022bb0: 2d20 6469 7374 3120 2a20 6d61 736b 310a  - dist1 * mask1.
-00022bc0: 2020 2020 2020 2020 2020 2020 6469 7374              dist
-00022bd0: 3220 3d20 6469 7374 3220 2a20 7e6d 6173  2 = dist2 * ~mas
-00022be0: 6b32 202d 2064 6973 7432 202a 206d 6173  k2 - dist2 * mas
-00022bf0: 6b32 0a0a 2020 2020 2020 2020 2320 4d61  k2..        # Ma
-00022c00: 6b65 2076 6563 746f 7220 636f 6e74 6169  ke vector contai
-00022c10: 6e69 6e67 2061 6c6c 2064 6973 7461 6e63  ning all distanc
-00022c20: 6573 0a20 2020 2020 2020 2069 6620 636f  es.        if co
-00022c30: 6e66 6f72 6d69 7479 3a0a 2020 2020 2020  nformity:.      
-00022c40: 2020 2020 2020 6469 7374 315b 6d61 736b        dist1[mask
-00022c50: 3120 2620 6d61 736b 325d 203d 2030 0a20  1 & mask2] = 0. 
-00022c60: 2020 2020 2020 2020 2020 2064 6973 7431             dist1
-00022c70: 5b6d 6173 6b31 2026 207e 6d61 736b 325d  [mask1 & ~mask2]
-00022c80: 203d 202d 6469 7374 325b 6d61 736b 3120   = -dist2[mask1 
-00022c90: 2620 7e6d 6173 6b32 5d0a 2020 2020 2020  & ~mask2].      
-00022ca0: 2020 2020 2020 7364 7320 3d20 6e70 2e72        sds = np.r
-00022cb0: 6176 656c 2864 6973 7431 5b6d 6173 6b31  avel(dist1[mask1
-00022cc0: 207c 206d 6173 6b32 5d29 0a20 2020 2020   | mask2]).     
-00022cd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00022ce0: 2020 2020 2073 6473 203d 206e 702e 7261       sds = np.ra
-00022cf0: 7665 6c28 6469 7374 315b 7375 7266 3220  vel(dist1[surf2 
-00022d00: 213d 2030 5d29 0a20 2020 2020 2020 2020  != 0]).         
-00022d10: 2020 2069 6620 7379 6d6d 6574 7269 633a     if symmetric:
-00022d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022d30: 2073 6473 203d 206e 702e 636f 6e63 6174   sds = np.concat
-00022d40: 656e 6174 6528 5b73 6473 2c20 6e70 2e72  enate([sds, np.r
-00022d50: 6176 656c 2864 6973 7432 5b73 7572 6631  avel(dist2[surf1
-00022d60: 2021 3d20 305d 295d 290a 2020 2020 2020   != 0])]).      
-00022d70: 2020 7265 7475 726e 2073 6473 0a0a 2020    return sds..  
-00022d80: 2020 6465 6620 6765 745f 6d65 616e 5f73    def get_mean_s
-00022d90: 7572 6661 6365 5f64 6973 7461 6e63 6528  urface_distance(
-00022da0: 7365 6c66 2c20 6f74 6865 722c 202a 2a6b  self, other, **k
-00022db0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00022dc0: 2727 270a 2020 2020 2020 2020 4f62 7461  '''.        Obta
-00022dd0: 696e 206d 6561 6e20 6469 7374 616e 6365  in mean distance
-00022de0: 2062 6574 7765 656e 2073 7572 6661 6365   between surface
-00022df0: 206f 6620 3c6f 7468 6572 3e20 616e 6420   of <other> and 
-00022e00: 7375 7266 6163 6520 6f66 203c 7365 6c66  surface of <self
-00022e10: 3e2e 0a0a 2020 2020 2020 2020 466f 7220  >...        For 
-00022e20: 7061 7261 6d65 7465 7273 2074 6861 7420  parameters that 
-00022e30: 6d61 7920 6265 2070 6173 7365 642c 2073  may be passed, s
-00022e40: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
-00022e50: 2066 6f72 3a0a 2020 2020 2020 2020 736b   for:.        sk
-00022e60: 7274 2e52 4f49 2e67 6574 5f73 7572 6661  rt.ROI.get_surfa
-00022e70: 6365 5f64 6973 7461 6e63 6573 2829 2e0a  ce_distances()..
-00022e80: 2020 2020 2020 2020 2727 270a 0a20 2020          '''..   
-00022e90: 2020 2020 2073 6473 203d 2073 656c 662e       sds = self.
-00022ea0: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
-00022eb0: 616e 6365 7328 6f74 6865 722c 202a 2a6b  ances(other, **k
-00022ec0: 7761 7267 7329 0a20 2020 2020 2020 2069  wargs).        i
-00022ed0: 6620 7364 7320 6973 204e 6f6e 653a 0a20  f sds is None:. 
-00022ee0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00022ef0: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
-00022f00: 2073 6473 2e6d 6561 6e28 290a 0a20 2020   sds.mean()..   
-00022f10: 2064 6566 2067 6574 5f72 6d73 5f73 7572   def get_rms_sur
-00022f20: 6661 6365 5f64 6973 7461 6e63 6528 7365  face_distance(se
-00022f30: 6c66 2c20 6f74 6865 722c 202a 2a6b 7761  lf, other, **kwa
-00022f40: 7267 7329 3a0a 0a20 2020 2020 2020 2073  rgs):..        s
-00022f50: 6473 203d 2073 656c 662e 6765 745f 7375  ds = self.get_su
-00022f60: 7266 6163 655f 6469 7374 616e 6365 7328  rface_distances(
-00022f70: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
-00022f80: 0a20 2020 2020 2020 2069 6620 7364 7320  .        if sds 
-00022f90: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00022fa0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00022fb0: 2020 2020 7265 7475 726e 206e 702e 7371      return np.sq
-00022fc0: 7274 2828 7364 7320 2a2a 2032 292e 6d65  rt((sds ** 2).me
-00022fd0: 616e 2829 290a 0a20 2020 2064 6566 2067  an())..    def g
-00022fe0: 6574 5f68 6175 7364 6f72 6666 5f64 6973  et_hausdorff_dis
-00022ff0: 7461 6e63 6528 7365 6c66 2c20 6f74 6865  tance(self, othe
-00023000: 722c 202a 2a6b 7761 7267 7329 3a0a 0a20  r, **kwargs):.. 
-00023010: 2020 2020 2020 2073 6473 203d 2073 656c         sds = sel
-00023020: 662e 6765 745f 7375 7266 6163 655f 6469  f.get_surface_di
-00023030: 7374 616e 6365 7328 6f74 6865 722c 202a  stances(other, *
-00023040: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-00023050: 2069 6620 7364 7320 6973 204e 6f6e 653a   if sds is None:
-00023060: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00023070: 7572 6e0a 2020 2020 2020 2020 7265 7475  urn.        retu
-00023080: 726e 2073 6473 2e6d 6178 2829 0a0a 2020  rn sds.max()..  
-00023090: 2020 6465 6620 6765 745f 6d65 616e 5f64    def get_mean_d
-000230a0: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
-000230b0: 726d 6974 7928 7365 6c66 2c20 6f74 6865  rmity(self, othe
-000230c0: 722c 2076 6f6c 5f75 6e69 7473 3d22 6d6d  r, vol_units="mm
-000230d0: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
-000230e0: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
-000230f0: 2020 4f62 7461 696e 206d 6561 6e20 6469    Obtain mean di
-00023100: 7374 616e 6365 2074 6f20 636f 6e66 6f72  stance to confor
-00023110: 6d69 7479 2066 6f72 203c 6f74 6865 723e  mity for <other>
-00023120: 2072 656c 6174 6976 6520 746f 203c 7365   relative to <se
-00023130: 6c66 3e2e 0a0a 2020 2020 2020 2020 5468  lf>...        Th
-00023140: 6520 6d65 616e 2064 6973 7461 6e63 6520  e mean distance 
-00023150: 746f 2063 6f6e 666f 726d 6974 7920 6973  to conformity is
-00023160: 2061 7320 6465 6669 6e65 6420 696e 3a0a   as defined in:.
-00023170: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
-00023180: 646f 692e 6f72 672f 3130 2e31 3235 392f  doi.org/10.1259/
-00023190: 626a 722f 3237 3637 3435 3831 0a20 2020  bjr/27674581.   
-000231a0: 2020 2020 2054 6563 686e 6963 616c 6c79       Technically
-000231b0: 2074 6865 206d 6561 6e20 6469 7374 616e   the mean distan
-000231c0: 6365 2074 6f20 636f 6e66 6f72 6d69 7479  ce to conformity
-000231d0: 2069 736e 2774 2061 2064 6973 7461 6e63   isn't a distanc
-000231e0: 652c 0a20 2020 2020 2020 2062 7574 2069  e,.        but i
-000231f0: 7320 6120 6469 7374 616e 6365 2064 6976  s a distance div
-00023200: 6964 6564 2062 7920 6120 766f 6c75 6d65  ided by a volume
-00023210: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-00023220: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
-00023230: 2061 2073 6b72 742e 636f 7265 2e44 6174   a skrt.core.Dat
-00023240: 6120 6f62 6a65 6374 2c20 7769 7468 2074  a object, with t
-00023250: 6865 2066 6f6c 6c6f 7769 6e67 0a20 2020  he following.   
-00023260: 2020 2020 2069 6e66 6f72 6d61 7469 6f6e       information
-00023270: 3a0a 0a20 2020 2020 2020 206e 5f76 6f78  :..        n_vox
-00023280: 656c 203a 206e 756d 6265 7220 6f66 2076  el : number of v
-00023290: 6f78 656c 7320 696e 2074 6865 2075 6e69  oxels in the uni
-000232a0: 6f6e 206f 6620 7468 6520 524f 4973 2063  on of the ROIs c
-000232b0: 6f6e 7369 6465 7265 642e 0a0a 2020 2020  onsidered...    
-000232c0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
-000232d0: 2076 6f78 656c 2073 697a 6520 2864 782c   voxel size (dx,
-000232e0: 2064 792c 2064 7a29 2069 6e20 6d69 6c6c   dy, dz) in mill
-000232f0: 696d 6574 7265 732c 2069 6e20 7468 650a  imetres, in the.
-00023300: 2020 2020 2020 2020 524f 4920 6d61 736b          ROI mask
-00023310: 7320 7573 6564 2069 6e20 6469 7374 616e  s used in distan
-00023320: 6365 2063 616c 6375 6c61 7469 6f6e 732e  ce calculations.
-00023330: 0a0a 2020 2020 2020 2020 6d65 616e 5f75  ..        mean_u
-00023340: 6e64 6572 5f63 6f6e 746f 7572 696e 6720  nder_contouring 
-00023350: 3a20 7375 6d20 6f66 2061 6273 6f6c 7574  : sum of absolut
-00023360: 6520 7661 6c75 6573 206f 6620 6e65 6761  e values of nega
-00023370: 7469 7665 2064 6973 7461 6e63 6573 0a20  tive distances. 
-00023380: 2020 2020 2020 2074 6f20 636f 6e66 6f72         to confor
-00023390: 6d69 7479 2c20 6469 7669 6465 6420 6279  mity, divided by
-000233a0: 2076 6f6c 756d 6520 696e 2075 6e69 6f6e   volume in union
-000233b0: 206f 6620 524f 4973 2063 6f6e 7369 6465   of ROIs conside
-000233c0: 7265 642e 0a0a 2020 2020 2020 2020 6d65  red...        me
-000233d0: 616e 5f6f 7665 725f 636f 6e74 6f75 7269  an_over_contouri
-000233e0: 6e67 203a 2073 756d 206f 6620 706f 7369  ng : sum of posi
-000233f0: 7469 7665 2064 6973 7461 6e63 6573 2074  tive distances t
-00023400: 6f20 636f 6e66 6f72 6d69 7479 2c0a 2020  o conformity,.  
-00023410: 2020 2020 2020 6469 7669 6465 6420 6279        divided by
-00023420: 2076 6f6c 756d 6520 696e 2075 6e69 6f6e   volume in union
-00023430: 206f 6620 524f 4973 2063 6f6e 7369 6465   of ROIs conside
-00023440: 7265 642e 0a0a 2020 2020 2020 2020 6d65  red...        me
-00023450: 616e 5f64 6973 7461 6e63 655f 746f 5f63  an_distance_to_c
-00023460: 6f6e 666f 726d 6974 7920 3a20 7375 6d20  onformity : sum 
-00023470: 6f66 206d 6561 6e5f 756e 6465 725f 636f  of mean_under_co
-00023480: 6e74 6f75 7269 6e67 2061 6e64 0a20 2020  ntouring and.   
-00023490: 2020 2020 206d 6561 6e5f 6f76 6572 5f63       mean_over_c
-000234a0: 6f6e 746f 7572 696e 672e 0a0a 2020 2020  ontouring...    
-000234b0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-000234c0: 3a2a 2a0a 2020 2020 2020 2020 766f 6c5f  :**.        vol_
-000234d0: 756e 6974 7320 3a20 7374 722c 2064 6566  units : str, def
-000234e0: 6175 6c74 3d22 6d6d 220a 2020 2020 2020  ault="mm".      
-000234f0: 2020 2020 2020 556e 6974 7320 746f 2075        Units to u
-00023500: 7365 2066 6f72 2076 6f6c 756d 6520 696e  se for volume in
-00023510: 2064 656e 6f6d 696e 6174 6f72 2077 6865   denominator whe
-00023520: 6e20 6361 6c63 756c 6174 696e 670a 2020  n calculating.  
-00023530: 2020 2020 2020 2020 2020 6d65 616e 5f75            mean_u
-00023540: 6e64 6572 5f63 6f6e 746f 7572 696e 6720  nder_contouring 
-00023550: 616e 6420 6d65 616e 5f6f 7665 7263 6f6e  and mean_overcon
-00023560: 746f 7572 696e 672e 2043 616e 2062 650a  touring. Can be.
-00023570: 2020 2020 2020 2020 2020 2020 226d 6d22              "mm"
-00023580: 2028 3d6d 6d5e 3329 2c20 226d 6c22 2c20   (=mm^3), "ml", 
-00023590: 6f72 2022 766f 7865 6c73 222e 0a0a 2020  or "voxels"...  
-000235a0: 2020 2020 2020 6b77 6172 6773 0a20 2020        kwargs.   
-000235b0: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
-000235c0: 2061 7267 756d 656e 7473 2061 7265 2070   arguments are p
-000235d0: 6173 7365 6420 746f 0a20 2020 2020 2020  assed to.       
-000235e0: 2020 2020 2073 6b72 742e 7374 7275 6374       skrt.struct
-000235f0: 7572 6573 2e52 4f49 2e67 6574 5f73 7572  ures.ROI.get_sur
-00023600: 6661 6365 5f64 6973 7461 6e63 6573 2829  face_distances()
-00023610: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
-00023620: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-00023630: 6f66 2074 6869 7320 6d65 7468 6f64 2066  of this method f
-00023640: 6f72 2070 6172 616d 6574 6572 2064 6574  or parameter det
-00023650: 6169 6c73 2e0a 2020 2020 2020 2020 2727  ails..        ''
-00023660: 270a 0a20 2020 2020 2020 2023 204f 6274  '..        # Obt
-00023670: 6169 6e20 6469 7374 616e 6365 7320 746f  ain distances to
-00023680: 2063 6f6e 666f 726d 6974 792e 0a20 2020   conformity..   
-00023690: 2020 2020 206b 7761 7267 735b 2263 6f6e       kwargs["con
-000236a0: 666f 726d 6974 7922 5d20 3d20 5472 7565  formity"] = True
-000236b0: 0a20 2020 2020 2020 2073 6473 203d 2073  .        sds = s
-000236c0: 656c 662e 6765 745f 7375 7266 6163 655f  elf.get_surface_
-000236d0: 6469 7374 616e 6365 7328 6f74 6865 722c  distances(other,
-000236e0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-000236f0: 2020 2020 2320 4f62 7461 696e 206d 6173      # Obtain mas
-00023700: 6b20 6172 7261 7920 7265 7072 6573 656e  k array represen
-00023710: 7469 6e67 2075 6e69 6f6e 206f 6620 524f  ting union of RO
-00023720: 4973 2e0a 2020 2020 2020 2020 756e 696f  Is..        unio
-00023730: 6e20 3d20 5374 7275 6374 7572 6553 6574  n = StructureSet
-00023740: 285b 7365 6c66 2c20 6f74 6865 725d 292e  ([self, other]).
-00023750: 636f 6d62 696e 655f 726f 6973 2829 0a20  combine_rois(). 
-00023760: 2020 2020 2020 2076 6965 7720 3d20 6b77         view = kw
-00023770: 6172 6773 2e67 6574 2822 7669 6577 222c  args.get("view",
-00023780: 2022 782d 7922 290a 2020 2020 2020 2020   "x-y").        
-00023790: 6966 206b 7761 7267 732e 6765 7428 2273  if kwargs.get("s
-000237a0: 696e 676c 655f 736c 6963 6522 2c20 4661  ingle_slice", Fa
-000237b0: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
-000237c0: 2020 736c 203d 206b 7761 7267 732e 6765    sl = kwargs.ge
-000237d0: 7428 2273 6c22 2c20 4e6f 6e65 290a 2020  t("sl", None).  
-000237e0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-000237f0: 6b77 6172 6773 2e67 6574 2822 6964 7822  kwargs.get("idx"
-00023800: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-00023810: 2020 2020 706f 7320 3d20 6b77 6172 6773      pos = kwargs
-00023820: 2e67 6574 2822 706f 7322 2c20 4e6f 6e65  .get("pos", None
-00023830: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
-00023840: 736b 5f64 6174 6120 3d20 756e 696f 6e2e  sk_data = union.
-00023850: 6765 745f 736c 6963 6528 7669 6577 2c20  get_slice(view, 
-00023860: 736c 2c20 6964 782c 2070 6f73 290a 2020  sl, idx, pos).  
-00023870: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00023880: 2020 2020 2020 2020 666c 6174 7465 6e20          flatten 
-00023890: 3d20 6b77 6172 6773 2e67 6574 2822 666c  = kwargs.get("fl
-000238a0: 6174 7465 6e22 2c20 4661 6c73 6529 0a20  atten", False). 
-000238b0: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
-000238c0: 6461 7461 203d 2075 6e69 6f6e 2e67 6574  data = union.get
-000238d0: 5f6d 6173 6b28 7669 6577 2c20 666c 6174  _mask(view, flat
-000238e0: 7465 6e29 0a0a 2020 2020 2020 2020 2320  ten)..        # 
-000238f0: 4361 6c63 756c 6174 6520 636f 6e66 6f72  Calculate confor
-00023900: 6d69 7479 2073 636f 7265 732e 0a20 2020  mity scores..   
-00023910: 2020 2020 2063 6f6e 666f 726d 6974 7920       conformity 
-00023920: 3d20 736b 7274 2e63 6f72 652e 4461 7461  = skrt.core.Data
-00023930: 2829 0a20 2020 2020 2020 2063 6f6e 666f  ().        confo
-00023940: 726d 6974 792e 6e5f 766f 7865 6c20 3d20  rmity.n_voxel = 
-00023950: 6d61 736b 5f64 6174 612e 7375 6d28 290a  mask_data.sum().
-00023960: 2020 2020 2020 2020 636f 6e66 6f72 6d69          conformi
-00023970: 7479 2e76 6f78 656c 5f73 697a 6520 3d20  ty.voxel_size = 
-00023980: 756e 696f 6e2e 6765 745f 766f 7865 6c5f  union.get_voxel_
-00023990: 7369 7a65 2829 0a20 2020 2020 2020 2069  size().        i
-000239a0: 6620 7364 7320 6973 204e 6f6e 653a 0a20  f sds is None:. 
-000239b0: 2020 2020 2020 2020 2020 2063 6f6e 666f             confo
-000239c0: 726d 6974 792e 6d65 616e 5f75 6e64 6572  rmity.mean_under
-000239d0: 5f63 6f6e 746f 7572 696e 6720 3d20 4e6f  _contouring = No
-000239e0: 6e65 0a20 2020 2020 2020 2020 2020 2063  ne.            c
-000239f0: 6f6e 666f 726d 6974 792e 6d65 616e 5f6f  onformity.mean_o
-00023a00: 7665 725f 636f 6e74 6f75 7269 6e67 203d  ver_contouring =
-00023a10: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00023a20: 2020 636f 6e66 6f72 6d69 7479 2e6d 6561    conformity.mea
-00023a30: 6e5f 6469 7374 616e 6365 5f74 6f5f 636f  n_distance_to_co
-00023a40: 6e66 6f72 6d69 7479 203d 204e 6f6e 650a  nformity = None.
-00023a50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00023a60: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
-00023a70: 6d69 7479 2e6d 6561 6e5f 756e 6465 725f  mity.mean_under_
-00023a80: 636f 6e74 6f75 7269 6e67 203d 2028 6162  contouring = (ab
-00023a90: 7328 7364 735b 7364 7320 3c20 305d 2e73  s(sds[sds < 0].s
-00023aa0: 756d 2829 290a 2020 2020 2020 2020 2020  um()).          
-00023ab0: 2020 2020 2020 2020 2020 2f20 756e 696f            / unio
-00023ac0: 6e2e 6765 745f 766f 6c75 6d65 2876 6f6c  n.get_volume(vol
-00023ad0: 5f75 6e69 7473 2929 0a20 2020 2020 2020  _units)).       
-00023ae0: 2020 2020 2063 6f6e 666f 726d 6974 792e       conformity.
-00023af0: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
-00023b00: 7269 6e67 203d 2028 7364 735b 7364 7320  ring = (sds[sds 
-00023b10: 3e20 305d 2e73 756d 2829 0a20 2020 2020  > 0].sum().     
-00023b20: 2020 2020 2020 2020 2020 2020 2020 202f                 /
-00023b30: 2075 6e69 6f6e 2e67 6574 5f76 6f6c 756d   union.get_volum
-00023b40: 6528 766f 6c5f 756e 6974 7329 290a 2020  e(vol_units)).  
-00023b50: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
-00023b60: 6d69 7479 2e6d 6561 6e5f 6469 7374 616e  mity.mean_distan
-00023b70: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
-00023b80: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00023b90: 2020 2020 2020 2020 2063 6f6e 666f 726d           conform
-00023ba0: 6974 792e 6d65 616e 5f75 6e64 6572 5f63  ity.mean_under_c
-00023bb0: 6f6e 746f 7572 696e 6720 2b0a 2020 2020  ontouring +.    
-00023bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023bd0: 636f 6e66 6f72 6d69 7479 2e6d 6561 6e5f  conformity.mean_
-00023be0: 6f76 6572 5f63 6f6e 746f 7572 696e 6729  over_contouring)
-00023bf0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00023c00: 2063 6f6e 666f 726d 6974 790a 0a20 2020   conformity..   
-00023c10: 2064 6566 2067 6574 5f73 7572 6661 6365   def get_surface
-00023c20: 5f64 6973 7461 6e63 655f 6d65 7472 6963  _distance_metric
-00023c30: 7328 7365 6c66 2c20 6f74 6865 722c 202a  s(self, other, *
-00023c40: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00023c50: 2020 2222 2247 6574 2074 6865 206d 6561    """Get the mea
-00023c60: 6e20 7375 7266 6163 6520 6469 7374 616e  n surface distan
-00023c70: 6365 2c20 524d 5320 7375 7266 6163 6520  ce, RMS surface 
-00023c80: 6469 7374 616e 6365 2c20 616e 6420 4861  distance, and Ha
-00023c90: 7573 646f 7266 660a 2020 2020 2020 2020  usdorff.        
-00023ca0: 6469 7374 616e 6365 2e22 2222 0a0a 2020  distance."""..  
-00023cb0: 2020 2020 2020 7364 7320 3d20 7365 6c66        sds = self
-00023cc0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
-00023cd0: 7461 6e63 6573 286f 7468 6572 2c20 2a2a  tances(other, **
-00023ce0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-00023cf0: 6966 2073 6473 2069 7320 4e6f 6e65 3a0a  if sds is None:.
-00023d00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00023d10: 726e 0a20 2020 2020 2020 2072 6574 7572  rn.        retur
-00023d20: 6e20 7364 732e 6d65 616e 2829 2c20 6e70  n sds.mean(), np
-00023d30: 2e73 7172 7428 2873 6473 202a 2a20 3229  .sqrt((sds ** 2)
-00023d40: 2e6d 6561 6e28 2929 2c20 7364 732e 6d61  .mean()), sds.ma
-00023d50: 7828 290a 0a20 2020 2064 6566 2070 6c6f  x()..    def plo
-00023d60: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
-00023d70: 6365 7328 7365 6c66 2c20 6f74 6865 722c  ces(self, other,
-00023d80: 2073 6176 655f 6173 3d4e 6f6e 652c 2073   save_as=None, s
-00023d90: 6967 6e65 643d 4661 6c73 652c 202a 2a6b  igned=False, **k
-00023da0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00023db0: 2222 2250 6c6f 7420 6869 7374 6f67 7261  """Plot histogra
-00023dc0: 6d20 6f66 2073 7572 6661 6365 2064 6973  m of surface dis
-00023dd0: 7461 6e63 6573 2e22 2222 0a0a 2020 2020  tances."""..    
-00023de0: 2020 2020 7364 7320 3d20 7365 6c66 2e67      sds = self.g
-00023df0: 6574 5f73 7572 6661 6365 5f64 6973 7461  et_surface_dista
-00023e00: 6e63 6573 286f 7468 6572 2c20 7369 676e  nces(other, sign
-00023e10: 6564 3d73 6967 6e65 642c 202a 2a6b 7761  ed=signed, **kwa
-00023e20: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
-00023e30: 7364 7320 6973 204e 6f6e 653a 0a20 2020  sds is None:.   
-00023e40: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00023e50: 2020 2020 2020 2020 6669 672c 2061 7820          fig, ax 
-00023e60: 3d20 706c 742e 7375 6270 6c6f 7473 2829  = plt.subplots()
-00023e70: 0a20 2020 2020 2020 2061 782e 6869 7374  .        ax.hist
-00023e80: 2873 6473 290a 2020 2020 2020 2020 786c  (sds).        xl
-00023e90: 6162 656c 203d 2028 0a20 2020 2020 2020  abel = (.       
-00023ea0: 2020 2020 2022 5375 7266 6163 6520 6469       "Surface di
-00023eb0: 7374 616e 6365 2028 6d6d 2922 2069 6620  stance (mm)" if 
-00023ec0: 6e6f 7420 7369 676e 6564 2065 6c73 6520  not signed else 
-00023ed0: 2253 6967 6e65 6420 7375 7266 6163 6520  "Signed surface 
-00023ee0: 6469 7374 616e 6365 2028 6d6d 2922 0a20  distance (mm)". 
-00023ef0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00023f00: 2061 782e 7365 745f 786c 6162 656c 2878   ax.set_xlabel(x
-00023f10: 6c61 6265 6c29 0a20 2020 2020 2020 2061  label).        a
-00023f20: 782e 7365 745f 796c 6162 656c 2822 4e75  x.set_ylabel("Nu
-00023f30: 6d62 6572 206f 6620 766f 7865 6c73 2229  mber of voxels")
-00023f40: 0a20 2020 2020 2020 2069 6620 7361 7665  .        if save
-00023f50: 5f61 733a 0a20 2020 2020 2020 2020 2020  _as:.           
-00023f60: 2070 6c74 2e74 6967 6874 5f6c 6179 6f75   plt.tight_layou
-00023f70: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00023f80: 6669 672e 7361 7665 6669 6728 7361 7665  fig.savefig(save
-00023f90: 5f61 7329 0a0a 2020 2020 6465 6620 6765  _as)..    def ge
-00023fa0: 745f 636f 6d70 6172 6973 6f6e 280a 2020  t_comparison(.  
-00023fb0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00023fc0: 2020 2020 726f 692c 0a20 2020 2020 2020      roi,.       
-00023fd0: 206d 6574 7269 6373 3d4e 6f6e 652c 0a20   metrics=None,. 
-00023fe0: 2020 2020 2020 2076 6f6c 5f75 6e69 7473         vol_units
-00023ff0: 3d22 6d6d 222c 0a20 2020 2020 2020 2061  ="mm",.        a
-00024000: 7265 615f 756e 6974 733d 226d 6d22 2c0a  rea_units="mm",.
-00024010: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-00024020: 5f75 6e69 7473 3d22 6d6d 222c 0a20 2020  _units="mm",.   
-00024030: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
-00024040: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
-00024050: 2c0a 2020 2020 2020 2020 706f 733d 4e6f  ,.        pos=No
-00024060: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
-00024070: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d65  None,.        me
-00024080: 7468 6f64 3d4e 6f6e 652c 0a20 2020 2020  thod=None,.     
-00024090: 2020 2073 6c69 6365 5f73 7461 7473 3d4e     slice_stats=N
-000240a0: 6f6e 652c 0a20 2020 2020 2020 2064 6566  one,.        def
-000240b0: 6175 6c74 5f62 795f 736c 6963 653d 4e6f  ault_by_slice=No
-000240c0: 6e65 2c0a 2020 2020 2020 2020 756e 6974  ne,.        unit
-000240d0: 735f 696e 5f68 6561 6465 723d 4661 6c73  s_in_header=Fals
-000240e0: 652c 0a20 2020 2020 2020 2067 6c6f 6261  e,.        globa
-000240f0: 6c5f 7673 5f73 6c69 6365 5f68 6561 6465  l_vs_slice_heade
-00024100: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
-00024110: 206e 616d 655f 6173 5f69 6e64 6578 3d54   name_as_index=T
-00024120: 7275 652c 0a20 2020 2020 2020 206e 6963  rue,.        nic
-00024130: 655f 636f 6c75 6d6e 733d 4661 6c73 652c  e_columns=False,
-00024140: 0a20 2020 2020 2020 2064 6563 696d 616c  .        decimal
-00024150: 5f70 6c61 6365 733d 4e6f 6e65 2c0a 2020  _places=None,.  
-00024160: 2020 2020 2020 666f 7263 653d 5472 7565        force=True
-00024170: 2c0a 2020 2020 2020 2020 766f 7865 6c5f  ,.        voxel_
-00024180: 7369 7a65 3d28 312c 2031 2c20 3129 2c0a  size=(1, 1, 1),.
-00024190: 2020 2020 2020 2020 6d61 7463 685f 6c65          match_le
-000241a0: 6e67 7468 733d 4661 6c73 652c 0a20 2020  ngths=False,.   
-000241b0: 2020 2020 206d 6174 6368 5f6c 656e 6774       match_lengt
-000241c0: 6873 5f73 7472 6174 6567 793d 310a 2020  hs_strategy=1.  
-000241d0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-000241e0: 5265 7475 726e 2061 2070 616e 6461 7320  Return a pandas 
-000241f0: 4461 7461 4672 616d 6520 6f66 2074 6865  DataFrame of the
-00024200: 2063 6f6d 7061 7269 736f 6e20 6d65 7472   comparison metr
-00024210: 6963 7320 6c69 7374 6564 2069 6e20 0a20  ics listed in . 
-00024220: 2020 2020 2020 203c 6d65 7472 6963 733e         <metrics>
-00024230: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
-00024240: 2061 6e6f 7468 6572 2052 4f49 2e0a 0a20   another ROI... 
-00024250: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-00024260: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
-00024270: 2020 2020 2020 2020 726f 6920 3a20 524f          roi : RO
-00024280: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
-00024290: 6865 7220 524f 4920 7769 7468 2077 6869  her ROI with whi
-000242a0: 6368 2074 6f20 636f 6d70 6172 6520 7468  ch to compare th
-000242b0: 6973 2052 4f49 2e0a 0a20 2020 2020 2020  is ROI...       
-000242c0: 206d 6574 7269 6373 203a 206c 6973 742c   metrics : list,
-000242d0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-000242e0: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-000242f0: 6620 6d65 7472 6963 7320 746f 2069 6e63  f metrics to inc
-00024300: 6c75 6465 2069 6e20 7468 6520 7461 626c  lude in the tabl
-00024310: 652e 204f 7074 696f 6e73 3a0a 0a20 2020  e. Options:..   
-00024320: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00024330: 6469 6365 2220 3a20 676c 6f62 616c 2044  dice" : global D
-00024340: 6963 6520 7363 6f72 652e 0a20 2020 2020  ice score..     
-00024350: 2020 2020 2020 2020 2020 202a 2022 6469             * "di
-00024360: 6365 5f66 6c61 7422 3a20 4469 6365 2073  ce_flat": Dice s
-00024370: 636f 7265 206f 6620 524f 4973 2066 6c61  core of ROIs fla
-00024380: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
-00024390: 6965 6e74 6174 696f 6e0a 2020 2020 2020  ientation.      
-000243a0: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-000243b0: 6966 6965 6420 696e 203c 7669 6577 3e2e  ified in <view>.
-000243c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000243d0: 202a 2022 6469 6365 5f73 6c69 6365 223a   * "dice_slice":
-000243e0: 2044 6963 6520 7363 6f72 6520 6f6e 2061   Dice score on a
-000243f0: 2073 696e 676c 6520 736c 6963 652e 0a20   single slice.. 
-00024400: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024410: 2022 6469 6365 5f73 6c69 6365 5f73 7461   "dice_slice_sta
-00024420: 7473 223a 2073 7461 7469 7374 6963 7320  ts": statistics 
-00024430: 7370 6563 6966 6965 6420 696e 203c 736c  specified in <sl
-00024440: 6963 655f 7374 6174 733e 0a20 2020 2020  ice_stats>.     
-00024450: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00024460: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
-00024470: 4469 6365 2073 636f 7265 732e 0a0a 2020  Dice scores...  
-00024480: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00024490: 226a 6163 6361 7264 2220 3a20 676c 6f62  "jaccard" : glob
-000244a0: 616c 204a 6163 6361 7264 2069 6e64 6578  al Jaccard index
-000244b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000244c0: 2020 2a20 226a 6163 6361 7264 5f66 6c61    * "jaccard_fla
-000244d0: 7422 3a20 4a61 6363 6172 6420 696e 6465  t": Jaccard inde
-000244e0: 7820 6f66 2052 4f49 7320 666c 6174 7465  x of ROIs flatte
-000244f0: 6e65 6420 696e 0a20 2020 2020 2020 2020  ned in.         
-00024500: 2020 2020 2020 2020 2074 6865 206f 7269           the ori
-00024510: 656e 7461 7469 6f6e 2073 7065 6369 6669  entation specifi
-00024520: 6564 2069 6e20 3c76 6965 773e 2e0a 2020  ed in <view>..  
-00024530: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00024540: 226a 6163 6361 7264 5f73 6c69 6365 223a  "jaccard_slice":
-00024550: 204a 6163 6361 7264 2069 6e64 6578 206f   Jaccard index o
-00024560: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
-00024570: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024580: 2020 2a20 226a 6163 6361 7264 5f73 6c69    * "jaccard_sli
-00024590: 6365 5f73 7461 7473 223a 2073 7461 7469  ce_stats": stati
-000245a0: 7374 6963 7320 7370 6563 6966 6965 6420  stics specified 
-000245b0: 696e 203c 736c 6963 655f 7374 6174 733e  in <slice_stats>
-000245c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000245d0: 2020 2066 6f72 2073 6c69 6365 2d62 792d     for slice-by-
-000245e0: 736c 6963 6520 4a61 6363 6172 6420 696e  slice Jaccard in
-000245f0: 6469 6365 732e 0a0a 2020 2020 2020 2020  dices...        
-00024600: 2020 2020 2020 2020 2a20 2263 656e 7472          * "centr
-00024610: 6f69 6422 3a20 3344 2063 656e 7472 6f69  oid": 3D centroi
-00024620: 6420 6469 7374 616e 6365 2076 6563 746f  d distance vecto
-00024630: 722e 0a20 2020 2020 2020 2020 2020 2020  r..             
-00024640: 2020 202a 2022 6162 735f 6365 6e74 726f     * "abs_centro
-00024650: 6964 223a 206d 6167 6e69 7475 6465 206f  id": magnitude o
-00024660: 6620 3344 2063 656e 7472 6f69 6420 6469  f 3D centroid di
-00024670: 7374 616e 6365 2076 6563 746f 722e 0a20  stance vector.. 
-00024680: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024690: 2022 6162 735f 6365 6e74 726f 6964 5f66   "abs_centroid_f
-000246a0: 6c61 7422 3a20 6d61 676e 6974 7564 6520  lat": magnitude 
-000246b0: 6f66 2033 4420 6365 6e74 726f 6964 2064  of 3D centroid d
-000246c0: 6973 7461 6e63 6520 7665 6374 6f72 0a20  istance vector. 
-000246d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000246e0: 2070 726f 6a65 6374 6564 2069 6e74 6f20   projected into 
-000246f0: 7468 6520 706c 616e 6520 7370 6563 6966  the plane specif
-00024700: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
-00024710: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024720: 2022 6365 6e74 726f 6964 5f73 6c69 6365   "centroid_slice
-00024730: 223a 2032 4420 6365 6e74 726f 6964 2064  ": 2D centroid d
-00024740: 6973 7461 6e63 6520 7665 6374 6f72 206f  istance vector o
-00024750: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
-00024760: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024770: 2020 2a20 2263 656e 7472 6f69 645f 736c    * "centroid_sl
-00024780: 6963 655f 7374 6174 7322 3a20 7374 6174  ice_stats": stat
-00024790: 6973 7469 6373 2073 7065 6369 6669 6564  istics specified
-000247a0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-000247b0: 2020 2020 2020 3c73 6c69 6365 5f73 7461        <slice_sta
-000247c0: 7473 3e20 666f 7220 736c 6963 652d 6279  ts> for slice-by
-000247d0: 2d73 6c69 6365 2032 4420 6365 6e74 726f  -slice 2D centro
-000247e0: 6964 2064 6973 7461 6e63 6520 7665 6374  id distance vect
-000247f0: 6f72 732e 0a20 2020 2020 2020 2020 2020  ors..           
-00024800: 2020 2020 202a 2022 6162 735f 6365 6e74       * "abs_cent
-00024810: 726f 6964 5f73 6c69 6365 223a 206d 6167  roid_slice": mag
-00024820: 6e69 7475 6465 206f 6620 3244 2063 656e  nitude of 2D cen
-00024830: 7472 6f69 6420 6469 7374 616e 6365 200a  troid distance .
-00024840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024850: 2020 7665 6374 6f72 206f 6e20 6120 7369    vector on a si
-00024860: 6e67 6c65 2073 6c69 6365 2e0a 2020 2020  ngle slice..    
-00024870: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
-00024880: 6273 5f63 656e 7472 6f69 645f 736c 6963  bs_centroid_slic
-00024890: 655f 7374 6174 7322 3a20 7374 6174 6973  e_stats": statis
-000248a0: 7469 6373 2073 7065 6369 6669 6564 2069  tics specified i
-000248b0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-000248c0: 2020 2020 3c73 6c69 6365 5f73 7461 7473      <slice_stats
-000248d0: 3e20 666f 7220 736c 6963 652d 6279 2d73  > for slice-by-s
-000248e0: 6c69 6365 206d 6167 6e69 7475 6465 7320  lice magnitudes 
-000248f0: 6f66 2032 440a 2020 2020 2020 2020 2020  of 2D.          
-00024900: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-00024910: 2064 6973 7461 6e63 6520 7665 6374 6f72   distance vector
-00024920: 732e 0a0a 2020 2020 2020 2020 2020 2020  s...            
-00024930: 2020 2020 2a20 2276 6f6c 756d 655f 6469      * "volume_di
-00024940: 6666 223a 2076 6f6c 756d 6520 6469 6666  ff": volume diff
-00024950: 6572 656e 6365 2028 6f77 6e20 766f 6c75  erence (own volu
-00024960: 6d65 202d 206f 7468 6572 2076 6f6c 756d  me - other volum
-00024970: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
-00024980: 2020 2020 2a20 2272 656c 5f76 6f6c 756d      * "rel_volum
-00024990: 655f 6469 6666 223a 2076 6f6c 756d 6520  e_diff": volume 
-000249a0: 6469 6666 6572 656e 6365 2064 6976 6964  difference divid
-000249b0: 6564 2062 7920 6f77 6e20 766f 6c75 6d65  ed by own volume
-000249c0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000249d0: 2020 2a20 2276 6f6c 756d 655f 7261 7469    * "volume_rati
-000249e0: 6f22 3a20 766f 6c75 6d65 2072 6174 696f  o": volume ratio
-000249f0: 2028 6f77 6e20 766f 6c75 6d65 202f 206f   (own volume / o
-00024a00: 7468 6572 2076 6f6c 756d 6529 2e0a 0a20  ther volume)... 
-00024a10: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024a20: 2022 6172 6561 5f64 6966 6622 3a20 6172   "area_diff": ar
-00024a30: 6561 2064 6966 6665 7265 6e63 6520 286f  ea difference (o
-00024a40: 776e 2061 7265 6120 2d20 6f74 6865 7220  wn area - other 
-00024a50: 6172 6561 2920 6f6e 2061 200a 2020 2020  area) on a .    
-00024a60: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00024a70: 6e67 6c65 2073 6c69 6365 2e0a 2020 2020  ngle slice..    
-00024a80: 2020 2020 2020 2020 2020 2020 2a20 2272              * "r
-00024a90: 656c 5f61 7265 615f 6469 6666 223a 2061  el_area_diff": a
-00024aa0: 7265 6120 6469 6666 6572 656e 6365 2064  rea difference d
-00024ab0: 6976 6964 6564 2062 7920 6f77 6e20 6172  ivided by own ar
-00024ac0: 6561 206f 6e20 6120 0a20 2020 2020 2020  ea on a .       
-00024ad0: 2020 2020 2020 2020 2020 2073 696e 676c             singl
-00024ae0: 6520 736c 6963 652e 0a20 2020 2020 2020  e slice..       
-00024af0: 2020 2020 2020 2020 202a 2022 6172 6561           * "area
-00024b00: 5f72 6174 696f 223a 2061 7265 6120 7261  _ratio": area ra
-00024b10: 7469 6f20 286f 776e 2061 7265 6120 2f20  tio (own area / 
-00024b20: 6f74 6865 7220 6172 6561 292e 0a20 2020  other area)..   
-00024b30: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00024b40: 6172 6561 5f64 6966 665f 666c 6174 223a  area_diff_flat":
-00024b50: 2061 7265 6120 6469 6666 6572 656e 6365   area difference
-00024b60: 206f 6620 524f 4973 2066 6c61 7474 656e   of ROIs flatten
-00024b70: 6564 2069 6e20 7468 650a 2020 2020 2020  ed in the.      
-00024b80: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
-00024b90: 6e74 6174 696f 6e20 7370 6563 6966 6965  ntation specifie
-00024ba0: 6420 696e 203c 7669 6577 3e2e 0a20 2020  d in <view>..   
-00024bb0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00024bc0: 6172 6561 5f64 6966 665f 736c 6963 655f  area_diff_slice_
-00024bd0: 7374 6174 7322 3a20 7374 6174 6973 7469  stats": statisti
-00024be0: 6373 2073 7065 6369 6669 6564 2069 6e0a  cs specified in.
-00024bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024c00: 2020 3c73 6c69 6365 5f73 7461 7473 3e20    <slice_stats> 
-00024c10: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
-00024c20: 6365 2061 7265 6120 6469 6666 6572 656e  ce area differen
-00024c30: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
-00024c40: 2020 2020 202a 2022 7265 6c5f 6172 6561       * "rel_area
-00024c50: 5f64 6966 665f 666c 6174 223a 2072 656c  _diff_flat": rel
-00024c60: 6174 6976 6520 6172 6561 2064 6966 6665  ative area diffe
-00024c70: 7265 6e63 6520 6f66 2052 4f49 730a 2020  rence of ROIs.  
-00024c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024c90: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
-00024ca0: 206f 7269 656e 7461 7469 6f6e 2073 7065   orientation spe
-00024cb0: 6369 6669 6564 2069 6e20 3c76 6965 773e  cified in <view>
-00024cc0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024cd0: 2020 2a20 2272 656c 5f61 7265 615f 6469    * "rel_area_di
-00024ce0: 6666 5f73 6c69 6365 5f73 7461 7473 223a  ff_slice_stats":
-00024cf0: 2073 7461 7469 7374 6963 7320 7370 6563   statistics spec
-00024d00: 6966 6965 6420 696e 0a20 2020 2020 2020  ified in.       
-00024d10: 2020 2020 2020 2020 2020 203c 736c 6963             <slic
-00024d20: 655f 7374 6174 733e 2066 6f72 2072 656c  e_stats> for rel
-00024d30: 6174 6976 6520 6172 6561 2064 6966 6665  ative area diffe
-00024d40: 7265 6e63 6573 206f 6620 524f 4973 2e0a  rences of ROIs..
-00024d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d60: 2a20 2261 7265 615f 7261 7469 6f5f 666c  * "area_ratio_fl
-00024d70: 6174 223a 2061 7265 6120 7261 7469 6f20  at": area ratio 
-00024d80: 6f66 2052 4f49 7320 666c 6174 7465 6e65  of ROIs flattene
-00024d90: 6420 696e 2074 6865 0a20 2020 2020 2020  d in the.       
-00024da0: 2020 2020 2020 2020 2020 206f 7269 656e             orien
-00024db0: 7461 7469 6f6e 2073 7065 6369 6669 6564  tation specified
-00024dc0: 2069 6e20 3c76 6965 773e 2e0a 2020 2020   in <view>..    
-00024dd0: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
-00024de0: 7265 615f 7261 7469 6f5f 736c 6963 655f  rea_ratio_slice_
-00024df0: 7374 6174 7322 3a20 7374 6174 6973 7469  stats": statisti
-00024e00: 6373 2073 7065 6369 6669 6564 2069 6e0a  cs specified in.
-00024e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e20: 2020 3c73 6c69 6365 5f73 7461 7473 3e20    <slice_stats> 
-00024e30: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
-00024e40: 6365 2061 7265 6120 7261 7469 6f73 2e0a  ce area ratios..
-00024e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024e60: 202a 2022 6d65 616e 5f73 6967 6e65 645f   * "mean_signed_
-00024e70: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00024e80: 223a 206d 6561 6e20 7369 676e 6564 2073  ": mean signed s
-00024e90: 7572 6661 6365 2064 6973 7461 6e63 652e  urface distance.
-00024ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024eb0: 202a 2022 6d65 616e 5f73 6967 6e65 645f   * "mean_signed_
-00024ec0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00024ed0: 5f66 6c61 7422 3a20 6d65 616e 2073 6967  _flat": mean sig
-00024ee0: 6e65 6420 7375 7266 6163 650a 2020 2020  ned surface.    
-00024ef0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00024f00: 7374 616e 6365 206f 6620 524f 4973 2066  stance of ROIs f
-00024f10: 6c61 7474 656e 6564 2069 6e20 7468 6520  lattened in the 
-00024f20: 6f72 6965 6e74 6174 696f 6e20 7370 6563  orientation spec
-00024f30: 6966 6965 640a 2020 2020 2020 2020 2020  ified.          
-00024f40: 2020 2020 2020 2020 696e 203c 7669 6577          in <view
-00024f50: 3e2e 0a20 2020 2020 2020 2020 2020 2020  >..             
-00024f60: 2020 202a 2022 6d65 616e 5f73 7572 6661     * "mean_surfa
-00024f70: 6365 5f64 6973 7461 6e63 6522 3a20 6d65  ce_distance": me
-00024f80: 616e 2073 7572 6661 6365 2064 6973 7461  an surface dista
-00024f90: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
-00024fa0: 2020 2020 202a 2022 6d65 616e 5f73 7572       * "mean_sur
-00024fb0: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
-00024fc0: 6174 223a 206d 6561 6e20 7375 7266 6163  at": mean surfac
-00024fd0: 6520 6469 7374 616e 6365 206f 6620 524f  e distance of RO
-00024fe0: 4973 0a20 2020 2020 2020 2020 2020 2020  Is.             
-00024ff0: 2020 2020 2066 6c61 7474 656e 6564 2069       flattened i
-00025000: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
-00025010: 6e20 7370 6563 6966 6965 6420 696e 203c  n specified in <
-00025020: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
-00025030: 2020 2020 2020 202a 2022 726d 735f 7375         * "rms_su
-00025040: 7266 6163 655f 6469 7374 616e 6365 223a  rface_distance":
-00025050: 2052 4d53 2073 7572 6661 6365 2064 6973   RMS surface dis
-00025060: 7461 6e63 652e 0a20 2020 2020 2020 2020  tance..         
-00025070: 2020 2020 2020 202a 2022 726d 735f 7375         * "rms_su
-00025080: 7266 6163 655f 6469 7374 616e 6365 5f66  rface_distance_f
-00025090: 6c61 7422 3a20 524d 5320 7375 7266 6163  lat": RMS surfac
-000250a0: 6520 6469 7374 616e 6365 206f 6620 524f  e distance of RO
-000250b0: 4973 0a20 2020 2020 2020 2020 2020 2020  Is.             
-000250c0: 2020 2020 2066 6c61 7474 656e 6564 2069       flattened i
-000250d0: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
-000250e0: 6e20 7370 6563 6966 6965 6420 696e 203c  n specified in <
-000250f0: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
-00025100: 2020 2020 2020 202a 2022 726d 735f 7369         * "rms_si
-00025110: 676e 6564 5f73 7572 6661 6365 5f64 6973  gned_surface_dis
-00025120: 7461 6e63 6522 3a20 524d 5320 7369 676e  tance": RMS sign
-00025130: 6564 2073 7572 6661 6365 2064 6973 7461  ed surface dista
-00025140: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
-00025150: 2020 2020 202a 2022 726d 735f 7369 676e       * "rms_sign
-00025160: 6564 5f73 7572 6661 6365 5f64 6973 7461  ed_surface_dista
-00025170: 6e63 655f 666c 6174 223a 2052 4d53 2073  nce_flat": RMS s
-00025180: 6967 6e65 6420 7375 7266 6163 650a 2020  igned surface.  
-00025190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251a0: 6469 7374 616e 6365 206f 6620 524f 4973  distance of ROIs
-000251b0: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
-000251c0: 6520 6f72 6965 6e74 6174 696f 6e20 7370  e orientation sp
-000251d0: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
-000251e0: 2020 2020 2020 2020 2020 696e 203c 7669            in <vi
-000251f0: 6577 3e2e 0a20 2020 2020 2020 2020 2020  ew>..           
-00025200: 2020 2020 202a 2022 6861 7573 646f 7266       * "hausdorf
-00025210: 665f 6469 7374 616e 6365 223a 2048 6175  f_distance": Hau
-00025220: 7364 6f72 6666 2064 6973 7461 6e63 652e  sdorff distance.
-00025230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025240: 202a 2022 6861 7573 646f 7266 665f 6469   * "hausdorff_di
-00025250: 7374 616e 6365 5f66 6c61 7422 3a20 4861  stance_flat": Ha
-00025260: 7573 646f 7266 6620 6469 7374 616e 6365  usdorff distance
-00025270: 206f 6620 524f 4973 0a20 2020 2020 2020   of ROIs.       
-00025280: 2020 2020 2020 2020 2020 2066 6c61 7474             flatt
-00025290: 656e 6564 2069 6e20 7468 6520 6f72 6965  ened in the orie
-000252a0: 6e74 6174 696f 6e20 7370 6563 6966 6965  ntation specifie
-000252b0: 6420 696e 203c 7669 6577 3e2e 0a20 2020  d in <view>..   
-000252c0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-000252d0: 6d65 616e 5f75 6e64 6572 5f63 6f6e 746f  mean_under_conto
-000252e0: 7572 696e 6722 3a20 5375 6d20 6f66 2061  uring": Sum of a
-000252f0: 6273 6f6c 7574 6520 7661 6c75 6573 206f  bsolute values o
-00025300: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-00025310: 2020 2020 6e65 6761 7469 7665 2064 6973      negative dis
-00025320: 7461 6e63 6573 2074 6f20 636f 6e66 6f72  tances to confor
-00025330: 6d69 7479 2c20 6469 7669 6465 6420 6279  mity, divided by
-00025340: 2076 6f6c 756d 650a 2020 2020 2020 2020   volume.        
-00025350: 2020 2020 2020 2020 2020 696e 2075 6e69            in uni
-00025360: 6f6e 206f 6620 524f 4973 2063 6f6d 7061  on of ROIs compa
-00025370: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
-00025380: 2020 2020 202a 2022 6d65 616e 5f75 6e64       * "mean_und
-00025390: 6572 5f63 6f6e 746f 7572 696e 675f 666c  er_contouring_fl
-000253a0: 6174 223a 2053 756d 206f 6620 6162 736f  at": Sum of abso
-000253b0: 6c75 7465 2076 616c 7565 7320 6f66 0a20  lute values of. 
-000253c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253d0: 206e 6567 6174 6976 6520 6469 7374 616e   negative distan
-000253e0: 6365 7320 746f 2063 6f6e 666f 726d 6974  ces to conformit
-000253f0: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
-00025400: 6c75 6d65 2c0a 2020 2020 2020 2020 2020  lume,.          
-00025410: 2020 2020 2020 2020 666c 6174 7465 6e65          flattene
-00025420: 6420 696e 2074 6865 206f 7269 656e 7461  d in the orienta
-00025430: 7469 6f6e 2073 7065 6369 6669 6564 2069  tion specified i
-00025440: 6e20 3c76 6965 773e 2e0a 2020 2020 2020  n <view>..      
-00025450: 2020 2020 2020 2020 2020 2020 696e 2075              in u
-00025460: 6e69 6f6e 206f 6620 524f 4973 2063 6f6d  nion of ROIs com
-00025470: 7061 7265 642e 0a20 2020 2020 2020 2020  pared..         
-00025480: 2020 2020 2020 202a 2022 6d65 616e 5f6f         * "mean_o
-00025490: 7665 725f 636f 6e74 6f75 7269 6e67 223a  ver_contouring":
-000254a0: 2053 756d 206f 6620 706f 7369 7469 7665   Sum of positive
-000254b0: 2064 6973 7461 6e63 6573 0a20 2020 2020   distances.     
-000254c0: 2020 2020 2020 2020 2020 2020 2074 6f20               to 
-000254d0: 636f 6e66 6f72 6d69 7479 2c20 6469 7669  conformity, divi
-000254e0: 6465 6420 6279 2076 6f6c 756d 6520 696e  ded by volume in
-000254f0: 2075 6e69 6f6e 206f 6620 524f 4973 2063   union of ROIs c
-00025500: 6f6d 7061 7265 642e 0a20 2020 2020 2020  ompared..       
-00025510: 2020 2020 2020 2020 202a 2022 6d65 616e           * "mean
-00025520: 5f6f 7665 725f 636f 6e74 6f75 7269 6e67  _over_contouring
-00025530: 5f66 6c61 7422 3a20 5375 6d20 6f66 2070  _flat": Sum of p
-00025540: 6f73 6974 6976 6520 6469 7374 616e 6365  ositive distance
-00025550: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00025560: 2020 2020 746f 2063 6f6e 666f 726d 6974      to conformit
-00025570: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
-00025580: 6c75 6d65 2069 6e20 756e 696f 6e20 6f66  lume in union of
-00025590: 2052 4f49 7320 636f 6d70 6172 6564 2c0a   ROIs compared,.
-000255a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000255b0: 2020 666c 6174 7465 6e65 6420 696e 2074    flattened in t
-000255c0: 6865 206f 7269 656e 7461 7469 6f6e 2073  he orientation s
-000255d0: 7065 6369 6669 6564 2069 6e20 3c76 6965  pecified in <vie
-000255e0: 773e 2e0a 2020 2020 2020 2020 2020 2020  w>..            
-000255f0: 2020 2020 2a20 226d 6561 6e5f 6469 7374      * "mean_dist
-00025600: 616e 6365 5f74 6f5f 636f 6e66 6f72 6d69  ance_to_conformi
-00025610: 7479 223a 2053 756d 206f 6620 6d65 616e  ty": Sum of mean
-00025620: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
-00025630: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00025640: 2020 2020 616e 6420 6d65 616e 5f6f 7665      and mean_ove
-00025650: 725f 636f 6e74 6f75 7269 6e67 2e0a 2020  r_contouring..  
-00025660: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00025670: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
-00025680: 6f5f 636f 6e66 6f72 6d69 7479 5f66 6c61  o_conformity_fla
-00025690: 7422 3a20 5375 6d20 6f66 0a20 2020 2020  t": Sum of.     
-000256a0: 2020 2020 2020 2020 2020 2020 206d 6561               mea
-000256b0: 6e5f 756e 6465 725f 636f 6e74 6f75 7269  n_under_contouri
-000256c0: 6e67 5f66 6c61 7420 616e 6420 6d65 616e  ng_flat and mean
-000256d0: 5f6f 7665 725f 636f 6e74 6f75 7269 6e67  _over_contouring
-000256e0: 5f66 6c61 742e 0a0a 2020 2020 2020 2020  _flat...        
-000256f0: 2020 2020 4966 204e 6f6e 652c 2064 6566      If None, def
-00025700: 6175 6c74 7320 746f 205b 2264 6963 6522  aults to ["dice"
-00025710: 2c20 2263 656e 7472 6f69 6422 5d2e 0a0a  , "centroid"]...
-00025720: 2020 2020 2020 2020 766f 6c5f 756e 6974          vol_unit
-00025730: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
-00025740: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
-00025750: 2020 556e 6974 7320 746f 2075 7365 2066    Units to use f
-00025760: 6f72 2076 6f6c 756d 652e 2043 616e 2062  or volume. Can b
-00025770: 6520 226d 6d22 2028 3d6d 6d5e 3329 2c20  e "mm" (=mm^3), 
-00025780: 226d 6c22 2c0a 2020 2020 2020 2020 2020  "ml",.          
-00025790: 2020 6f72 2022 766f 7865 6c73 222e 0a0a    or "voxels"...
-000257a0: 2020 2020 2020 2020 6172 6561 5f75 6e69          area_uni
-000257b0: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
-000257c0: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
-000257d0: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
-000257e0: 666f 7220 6172 6561 732e 2043 616e 2062  for areas. Can b
-000257f0: 6520 226d 6d22 2028 3d6d 6d5e 3229 206f  e "mm" (=mm^2) o
-00025800: 7220 2276 6f78 656c 7322 2e0a 0a20 2020  r "voxels"...   
-00025810: 2020 2020 2063 656e 7472 6f69 645f 756e       centroid_un
-00025820: 6974 733a 0a20 2020 2020 2020 2020 2020  its:.           
-00025830: 2055 6e69 7473 2074 6f20 7573 6520 666f   Units to use fo
-00025840: 7220 6365 6e74 726f 6964 732e 2043 616e  r centroids. Can
-00025850: 2062 6520 226d 6d22 206f 7220 2276 6f78   be "mm" or "vox
-00025860: 656c 7322 2e0a 0a20 2020 2020 2020 2076  els"...        v
-00025870: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
-00025880: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
-00025890: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
-000258a0: 2069 6e20 7768 6963 6820 746f 2063 6f6d   in which to com
-000258b0: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
-000258c0: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
-000258d0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-000258e0: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
-000258f0: 7320 6f72 2066 6c61 7474 656e 6564 206d  s or flattened m
-00025900: 6574 7269 6373 2e0a 0a20 2020 2020 2020  etrics...       
-00025910: 2073 6c20 3a20 696e 742c 2064 6566 6175   sl : int, defau
-00025920: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00025930: 2020 2020 536c 6963 6520 6e75 6d62 6572      Slice number
-00025940: 206f 6e20 7768 6963 6820 746f 2063 6f6d   on which to com
-00025950: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
-00025960: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
-00025970: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00025980: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
-00025990: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
-000259a0: 645f 736c 6963 652c 206c 656e 6774 685f  d_slice, length_
-000259b0: 736c 6963 6529 2e0a 2020 2020 2020 2020  slice)..        
-000259c0: 2020 2020 4966 203c 736c 3e2c 203c 6964      If <sl>, <id
-000259d0: 783e 2c20 616e 6420 3c70 6f73 3e20 6172  x>, and <pos> ar
-000259e0: 6520 616c 6c20 4e6f 6e65 2c20 7468 6520  e all None, the 
-000259f0: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
-00025a00: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00025a10: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
-00025a20: 642e 0a0a 2020 2020 2020 2020 6964 7820  d...        idx 
-00025a30: 3a20 696e 742c 2064 6566 6175 6c74 3d4e  : int, default=N
-00025a40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00025a50: 536c 6963 6520 696e 6465 7820 6172 7261  Slice index arra
-00025a60: 7920 6f6e 2077 6869 6368 2074 6f20 636f  y on which to co
-00025a70: 6d70 7574 6520 6d65 7472 6963 732e 204f  mpute metrics. O
-00025a80: 6e6c 7920 7265 6c65 7661 6e74 2066 6f72  nly relevant for
-00025a90: 200a 2020 2020 2020 2020 2020 2020 7369   .            si
-00025aa0: 6e67 6c65 2d73 6c69 6365 206d 6574 7269  ngle-slice metri
-00025ab0: 6373 2028 6172 6561 2c20 6365 6e74 726f  cs (area, centro
-00025ac0: 6964 5f73 6c69 6365 2c20 6c65 6e67 7468  id_slice, length
-00025ad0: 5f73 6c69 6365 292e 0a20 2020 2020 2020  _slice)..       
-00025ae0: 2020 2020 2055 7365 6420 6966 203c 736c       Used if <sl
-00025af0: 3e20 6973 204e 6f6e 652e 0a0a 2020 2020  > is None...    
-00025b00: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
-00025b10: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00025b20: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
-00025b30: 706f 7369 7469 6f6e 2069 6e20 6d6d 206f  position in mm o
-00025b40: 6e20 7768 6963 6820 746f 2063 6f6d 7075  n which to compu
-00025b50: 7465 206d 6574 7269 6373 2e20 4f6e 6c79  te metrics. Only
-00025b60: 2072 656c 6576 616e 7420 666f 7220 0a20   relevant for . 
-00025b70: 2020 2020 2020 2020 2020 2073 696e 676c             singl
-00025b80: 652d 736c 6963 6520 6d65 7472 6963 7320  e-slice metrics 
-00025b90: 2861 7265 612c 2063 656e 7472 6f69 645f  (area, centroid_
-00025ba0: 736c 6963 652c 206c 656e 6774 685f 736c  slice, length_sl
-00025bb0: 6963 6529 2e0a 2020 2020 2020 2020 2020  ice)..          
-00025bc0: 2020 5573 6564 2069 6620 3c73 6c3e 2061    Used if <sl> a
-00025bd0: 6e64 203c 6964 783e 2061 7265 2062 6f74  nd <idx> are bot
-00025be0: 6820 4e6f 6e65 2e0a 0a20 2020 2020 2020  h None...       
-00025bf0: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
-00025c00: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00025c10: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
-00025c20: 6f20 7573 6520 666f 7220 6d65 7472 6963  o use for metric
-00025c30: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
-00025c40: 6e20 6265 2065 6974 6865 7220 2263 6f6e  n be either "con
-00025c50: 746f 7572 2220 0a20 2020 2020 2020 2020  tour" .         
-00025c60: 2020 2028 7573 6520 7368 6170 656c 7920     (use shapely 
-00025c70: 706f 6c79 676f 6e73 2920 6f72 2022 6d61  polygons) or "ma
-00025c80: 736b 2220 2875 7365 2062 696e 6172 7920  sk" (use binary 
-00025c90: 6d61 736b 292e 2049 6620 4e6f 6e65 2c0a  mask). If None,.
-00025ca0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00025cb0: 7661 6c75 6520 7365 7420 696e 2073 656c  value set in sel
-00025cc0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
-00025cd0: 6574 686f 6420 7769 6c6c 2062 6520 7573  ethod will be us
-00025ce0: 6564 2e20 4e6f 7465 200a 2020 2020 2020  ed. Note .      
-00025cf0: 2020 2020 2020 7468 6174 2066 6c61 7474        that flatt
-00025d00: 656e 6564 206d 6574 7269 6373 2061 6e64  ened metrics and
-00025d10: 2073 7572 6661 6365 2064 6973 7461 6e63   surface distanc
-00025d20: 6520 6d65 7472 6963 7320 656e 666f 7263  e metrics enforc
-00025d30: 6520 7573 650a 2020 2020 2020 2020 2020  e use.          
-00025d40: 2020 6f66 2074 6865 2022 6d61 736b 2220    of the "mask" 
-00025d50: 6d65 7468 6f64 2e0a 0a20 2020 2020 2020  method...       
-00025d60: 2073 6c69 6365 5f73 7461 7473 203a 2073   slice_stats : s
-00025d70: 7472 2f6c 6973 742f 6469 6374 2c20 6465  tr/list/dict, de
-00025d80: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00025d90: 2020 2020 2020 2053 7065 6369 6669 6361         Specifica
-00025da0: 7469 6f6e 206f 6620 7374 6174 6973 7469  tion of statisti
-00025db0: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
-00025dc0: 7465 6420 7265 6c61 7469 7665 0a20 2020  ted relative.   
-00025dd0: 2020 2020 2020 2020 2074 6f20 736c 6963           to slic
-00025de0: 652d 6279 2d73 6c69 6365 206d 6574 7269  e-by-slice metri
-00025df0: 6320 7661 6c75 6573 2e20 2055 7365 6420  c values.  Used 
-00025e00: 666f 7220 616c 6c20 6d65 7472 6963 7320  for all metrics 
-00025e10: 7769 7468 0a20 2020 2020 2020 2020 2020  with.           
-00025e20: 2073 7566 6669 7820 225f 736c 6963 655f   suffix "_slice_
-00025e30: 7374 6174 7322 2069 6e20 7468 6520 3c6d  stats" in the <m
-00025e40: 6574 7269 6373 3e20 6c69 7374 2e0a 0a20  etrics> list... 
-00025e50: 2020 2020 2020 2020 2020 2041 2073 7461             A sta
-00025e60: 7469 7374 6963 2069 7320 7370 6563 6966  tistic is specif
-00025e70: 6965 6420 6279 2074 6865 206e 616d 6520  ied by the name 
-00025e80: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
-00025e90: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-00025ea0: 6974 7320 6361 6c63 756c 6174 696f 6e20  its calculation 
-00025eb0: 696e 2074 6865 2050 7974 686f 6e20 7374  in the Python st
-00025ec0: 6174 6973 7469 6373 206d 6f64 756c 653a  atistics module:
-00025ed0: 0a0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
-00025ee0: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
-00025ef0: 6e2e 6f72 672f 332f 6c69 6272 6172 792f  n.org/3/library/
-00025f00: 7374 6174 6973 7469 6373 2e68 746d 6c0a  statistics.html.
-00025f10: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
-00025f20: 2069 7473 2075 7365 2068 6572 652c 2074   its use here, t
-00025f30: 6865 2072 656c 6576 616e 7420 6675 6e63  he relevant func
-00025f40: 7469 6f6e 206d 7573 7420 7265 7175 6972  tion must requir
-00025f50: 650a 2020 2020 2020 2020 2020 2020 6120  e.            a 
-00025f60: 7369 6e67 6c65 2d76 6172 6961 626c 6520  single-variable 
-00025f70: 696e 7075 742c 206d 7573 7420 6e6f 7420  input, must not 
-00025f80: 7265 7175 6972 6520 616e 7920 6b65 7977  require any keyw
-00025f90: 6f72 640a 2020 2020 2020 2020 2020 2020  ord.            
-00025fa0: 6172 6775 6d65 6e74 732c 2061 6e64 206d  arguments, and m
-00025fb0: 7573 7420 7265 7475 726e 2061 2073 696e  ust return a sin
-00025fc0: 676c 6520 6e75 6d62 6572 2e0a 0a20 2020  gle number...   
-00025fd0: 2020 2020 2020 2020 2041 7661 696c 6162           Availab
-00025fe0: 6c65 206f 7074 696f 6e73 2069 6e63 6c75  le options inclu
-00025ff0: 6465 3a20 226d 6561 6e22 2c20 226d 6564  de: "mean", "med
-00026000: 6961 6e22 2c20 226d 6f64 6522 2c0a 2020  ian", "mode",.  
-00026010: 2020 2020 2020 2020 2020 2273 7464 6576            "stdev
-00026020: 222e 0a0a 2020 2020 2020 2020 2020 2053  "...           S
-00026030: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
-00026040: 6361 6c63 756c 6174 6564 2063 616e 2062  calculated can b
-00026050: 6520 7370 6563 6966 6965 6420 7573 696e  e specified usin
-00026060: 6720 616e 7920 6f66 0a20 2020 2020 2020  g any of.       
-00026070: 2020 2020 7468 6520 666f 6c6c 6f77 696e      the followin
-00026080: 673a 0a0a 2020 2020 2020 2020 2020 202d  g:..           -
-00026090: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
-000260a0: 6e67 2073 696e 676c 6520 7374 6174 6973  ng single statis
-000260b0: 7469 6320 746f 2062 6520 6361 6c63 756c  tic to be calcul
-000260c0: 6174 6564 2c0a 2020 2020 2020 2020 2020  ated,.          
-000260d0: 2020 2077 6974 6820 736c 6963 6573 2063     with slices c
-000260e0: 6f6e 7369 6465 7265 6420 6173 2067 6976  onsidered as giv
-000260f0: 656e 2062 7920 6465 6661 756c 745f 6279  en by default_by
-00026100: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-00026110: 2020 2020 2066 6f72 2065 7861 6d70 6c65       for example
-00026120: 3a20 226d 6561 6e22 3b0a 2020 2020 2020  : "mean";.      
-00026130: 2020 2020 202d 204c 6973 7420 7370 6563       - List spec
-00026140: 6966 7969 6e67 206d 756c 7469 706c 6520  ifying multiple 
-00026150: 7374 6174 6973 7469 6373 2074 6f20 6265  statistics to be
-00026160: 2063 616c 6375 6c61 7465 642c 0a20 2020   calculated,.   
-00026170: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-00026180: 6c69 6365 7320 636f 6e73 6964 6572 6564  lices considered
-00026190: 2061 7320 6769 7665 6e20 6279 2064 6566   as given by def
-000261a0: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
-000261b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000261c0: 6578 616d 706c 653a 205b 226d 6561 6e22  example: ["mean"
-000261d0: 2c20 2273 7464 6576 225d 3b0a 2020 2020  , "stdev"];.    
-000261e0: 2020 2020 2020 202d 2044 6963 7469 6f6e         - Diction
-000261f0: 6172 7920 7768 6572 6520 6b65 7973 2073  ary where keys s
-00026200: 7065 6369 6679 2073 6c69 6365 7320 746f  pecify slices to
-00026210: 2062 6520 636f 6e73 6964 6572 6564 2c0a   be considered,.
-00026220: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00026230: 2076 616c 7565 7320 7370 6563 6966 7920   values specify 
-00026240: 7374 6174 6973 7469 6373 2028 7374 7269  statistics (stri
-00026250: 6e67 206f 7220 6c69 7374 292c 2066 6f72  ng or list), for
-00026260: 0a20 2020 2020 2020 2020 2020 2020 6578  .             ex
-00026270: 616d 706c 653a 207b 2275 6e69 6f6e 223a  ample: {"union":
-00026280: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
-00026290: 225d 7d2e 2020 5661 6c69 6420 736c 6963  "]}.  Valid slic
-000262a0: 650a 2020 2020 2020 2020 2020 2020 2073  e.             s
-000262b0: 7065 6369 6669 6361 7469 6f6e 7320 6172  pecifications ar
-000262c0: 6520 6173 206c 6973 7465 6420 666f 7220  e as listed for 
-000262d0: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-000262e0: 2e0a 0a20 2020 2020 2020 2064 6566 6175  ...        defau
-000262f0: 6c74 5f62 795f 736c 6963 653a 2073 7472  lt_by_slice: str
-00026300: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00026310: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-00026320: 6c74 2073 7065 6369 6669 6361 7469 6f6e  lt specification
-00026330: 206f 6620 736c 6963 6573 2074 6f20 6265   of slices to be
-00026340: 2063 6f6e 7369 6465 7265 6420 7768 656e   considered when
-00026350: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-00026360: 6375 6c61 7469 6e67 2073 6c69 6365 2d62  culating slice-b
-00026370: 792d 736c 6963 6520 7374 6174 6973 7469  y-slice statisti
-00026380: 6373 2e20 2054 6865 2076 616c 6964 2073  cs.  The valid s
-00026390: 7065 6369 6669 6361 7469 6f6e 730a 2020  pecifications.  
-000263a0: 2020 2020 2020 2020 2020 6172 653a 0a0a            are:..
-000263b0: 2020 2020 2020 2020 2020 2020 2d20 226c              - "l
-000263c0: 6566 7422 3a20 636f 6e73 6964 6572 206f  eft": consider o
-000263d0: 6e6c 7920 736c 6963 6573 2063 6f6e 7461  nly slices conta
-000263e0: 696e 696e 6720 7365 6c66 3b0a 2020 2020  ining self;.    
-000263f0: 2020 2020 2020 2020 2d20 2272 6967 6874          - "right
-00026400: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
-00026410: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-00026420: 6e67 206f 7468 6572 2072 6f69 3b0a 2020  ng other roi;.  
-00026430: 2020 2020 2020 2020 2020 2d20 2275 6e69            - "uni
-00026440: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
-00026450: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-00026460: 6569 7468 6572 206f 6620 7365 6c66 2061  either of self a
-00026470: 6e64 206f 7468 6572 2072 6f69 3b0a 2020  nd other roi;.  
-00026480: 2020 2020 2020 2020 2020 2d20 2269 6e74            - "int
-00026490: 6572 7365 6374 696f 6e22 3a20 636f 6e73  ersection": cons
-000264a0: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
-000264b0: 6169 6e69 6e67 2062 6f74 6820 6f66 2073  aining both of s
-000264c0: 656c 6620 616e 640a 2020 2020 2020 2020  elf and.        
-000264d0: 2020 2020 2020 6f74 6865 7220 726f 692e        other roi.
-000264e0: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-000264f0: 204e 6f6e 652c 2075 7365 2073 6b72 742e   None, use skrt.
-00026500: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
-00026510: 6279 5f73 6c69 6365 0a0a 2020 2020 2020  by_slice..      
-00026520: 2020 756e 6974 735f 696e 5f68 6561 6465    units_in_heade
-00026530: 7220 3a20 626f 6f6c 2c20 6465 6661 756c  r : bool, defaul
-00026540: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00026550: 2020 2020 4966 2054 7275 652c 2075 6e69      If True, uni
-00026560: 7473 2077 696c 6c20 6265 2069 6e63 6c75  ts will be inclu
-00026570: 6465 6420 696e 2063 6f6c 756d 6e20 6865  ded in column he
-00026580: 6164 6572 732e 0a0a 2020 2020 2020 2020  aders...        
-00026590: 676c 6f62 616c 5f76 735f 736c 6963 655f  global_vs_slice_
-000265a0: 6865 6164 6572 203a 2062 6f6f 6c2c 2064  header : bool, d
-000265b0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-000265c0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-000265d0: 2c20 7468 6520 7265 7475 726e 6564 2044  , the returned D
-000265e0: 6174 6146 7261 6d65 2077 696c 6c20 6861  ataFrame will ha
-000265f0: 7665 2061 6e20 6578 7472 6120 7365 7420  ve an extra set 
-00026600: 6f66 2068 6561 6465 7273 0a20 2020 2020  of headers.     
-00026610: 2020 2020 2020 2073 706c 6974 7469 6e67         splitting
-00026620: 2074 6865 2074 6162 6c65 2069 6e74 6f20   the table into 
-00026630: 2267 6c6f 6261 6c22 2061 6e64 2022 736c  "global" and "sl
-00026640: 6963 6522 206d 6574 7269 6373 2e0a 0a20  ice" metrics... 
-00026650: 2020 2020 2020 206e 616d 655f 6173 5f69         name_as_i
-00026660: 6e64 6578 203a 2062 6f6f 6c2c 2064 6566  ndex : bool, def
-00026670: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
-00026680: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-00026690: 6865 2069 6e64 6578 2063 6f6c 756d 6e20  he index column 
-000266a0: 6f66 2074 6865 2070 616e 6461 7320 4461  of the pandas Da
-000266b0: 7461 4672 616d 6520 7769 6c6c 200a 2020  taFrame will .  
-000266c0: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
-000266d0: 6e20 7468 6520 524f 4927 7320 6e61 6d65  n the ROI's name
-000266e0: 733b 206f 7468 6572 7769 7365 2c20 7468  s; otherwise, th
-000266f0: 6520 6e61 6d65 2077 696c 6c20 6170 7065  e name will appe
-00026700: 6172 2069 6e20 6120 636f 6c75 6d6e 0a20  ar in a column. 
-00026710: 2020 2020 2020 2020 2020 206e 616d 6564             named
-00026720: 2022 524f 4922 2e0a 0a20 2020 2020 2020   "ROI"...       
-00026730: 206e 6963 655f 636f 6c75 6d6e 7320 3a20   nice_columns : 
-00026740: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00026750: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00026760: 4966 2046 616c 7365 2c20 636f 6c75 6d6e  If False, column
-00026770: 206e 616d 6573 2077 696c 6c20 6265 2074   names will be t
-00026780: 6865 2073 616d 6520 6173 2074 6865 2069  he same as the i
-00026790: 6e70 7574 206d 6574 7269 6373 206e 616d  nput metrics nam
-000267a0: 6573 3b0a 2020 2020 2020 2020 2020 2020  es;.            
-000267b0: 6966 2054 7275 652c 2074 6865 206e 616d  if True, the nam
-000267c0: 6573 2077 696c 6c20 6265 2063 6170 6974  es will be capit
-000267d0: 616c 697a 6564 2061 6e64 2075 6e64 6572  alized and under
-000267e0: 7363 6f72 6573 2077 696c 6c20 6265 200a  scores will be .
-000267f0: 2020 2020 2020 2020 2020 2020 7265 706c              repl
-00026800: 6163 6564 2077 6974 6820 7370 6163 6573  aced with spaces
-00026810: 2e0a 0a20 2020 2020 2020 2064 6563 696d  ...        decim
-00026820: 616c 5f70 6c61 6365 7320 3a20 696e 742c  al_places : int,
-00026830: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00026840: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
-00026850: 206f 6620 6465 6369 6d61 6c20 706c 6163   of decimal plac
-00026860: 6573 2074 6f20 6b65 6570 2066 6f72 2065  es to keep for e
-00026870: 6163 6820 6d65 7472 6963 2e20 4966 204e  ach metric. If N
-00026880: 6f6e 652c 2066 756c 6c0a 2020 2020 2020  one, full.      
-00026890: 2020 2020 2020 7072 6563 6973 696f 6e20        precision 
-000268a0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-000268b0: 2020 2020 2020 2066 6f72 6365 203a 2062         force : b
-000268c0: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
-000268d0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-000268e0: 2046 616c 7365 2c20 676c 6f62 616c 206d   False, global m
-000268f0: 6574 7269 6373 2066 6f72 2065 6163 6820  etrics for each 
-00026900: 524f 4920 2876 6f6c 756d 652c 2033 4420  ROI (volume, 3D 
-00026910: 6365 6e74 726f 6964 2c20 0a20 2020 2020  centroid, .     
-00026920: 2020 2020 2020 2033 4420 6c65 6e67 7468         3D length
-00026930: 7329 2077 696c 6c20 6f6e 6c79 2062 6520  s) will only be 
-00026940: 6361 6c63 756c 6174 6564 2069 6620 7468  calculated if th
-00026950: 6579 2068 6176 6520 6e6f 7420 6265 656e  ey have not been
-00026960: 200a 2020 2020 2020 2020 2020 2020 6361   .            ca
-00026970: 6c63 756c 6174 6564 2062 6566 6f72 653b  lculated before;
-00026980: 2069 6620 5472 7565 2c20 616c 6c20 6d65   if True, all me
-00026990: 7472 6963 7320 7769 6c6c 2062 6520 7265  trics will be re
-000269a0: 6361 6c63 756c 6174 6564 2e0a 0a20 2020  calculated...   
-000269b0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
-000269c0: 3a20 7475 706c 652c 2064 6566 6175 6c74  : tuple, default
-000269d0: 3d28 312c 2031 2c20 3129 0a20 2020 2020  =(1, 1, 1).     
-000269e0: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
-000269f0: 6520 2864 782c 2064 792c 2064 7a29 2069  e (dx, dy, dz) i
-00026a00: 6e20 6d6d 2074 6f20 6265 2075 7365 6420  n mm to be used 
-00026a10: 666f 7220 524f 4920 6d61 736b 730a 2020  for ROI masks.  
-00026a20: 2020 2020 2020 2020 2020 6672 6f6d 2077            from w
-00026a30: 6869 6368 2074 6f20 6361 6c63 756c 6174  hich to calculat
-00026a40: 6520 7375 7266 6163 6520 6469 7374 616e  e surface distan
-00026a50: 6365 732e 2020 4966 204e 6f6e 652c 0a20  ces.  If None,. 
-00026a60: 2020 2020 2020 2020 2020 2074 6865 206d             the m
-00026a70: 6173 6b20 766f 7865 6c20 7369 7a65 206f  ask voxel size o
-00026a80: 6620 3c6f 7468 6572 3e20 6973 2075 7365  f <other> is use
-00026a90: 642e 2020 4966 2061 6e20 696e 6469 7669  d.  If an indivi
-00026aa0: 6475 616c 0a20 2020 2020 2020 2020 2020  dual.           
-00026ab0: 2065 6c65 6d65 6e74 2069 7320 4e6f 6e65   element is None
-00026ac0: 2c20 7468 6520 7661 6c75 6520 6f66 2074  , the value of t
-00026ad0: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
-00026ae0: 2065 6c65 6d65 6e74 2066 6f72 0a20 2020   element for.   
-00026af0: 2020 2020 2020 2020 2074 6865 206d 6173           the mas
-00026b00: 6b20 766f 7865 6c20 7369 7a65 206f 6620  k voxel size of 
-00026b10: 3c6f 7468 6572 3e20 6973 2075 7365 642e  <other> is used.
-00026b20: 2020 4120 7661 6c75 650a 2020 2020 2020    A value.      
-00026b30: 2020 2020 2020 6f74 6865 7220 7468 616e        other than
-00026b40: 204e 6f6e 6520 666f 7263 6573 2063 7265   None forces cre
-00026b50: 6174 696f 6e20 6f66 206d 6173 6b73 2074  ation of masks t
-00026b60: 6861 7420 6a75 7374 2063 6f76 6572 0a20  hat just cover. 
-00026b70: 2020 2020 2020 2020 2020 2074 6865 2076             the v
-00026b80: 6f6c 756d 6520 6f63 6375 7069 6564 2062  olume occupied b
-00026b90: 7920 7468 6520 7477 6f20 524f 4973 2062  y the two ROIs b
-00026ba0: 6569 6e67 2063 6f6d 7061 7265 642c 0a20  eing compared,. 
-00026bb0: 2020 2020 2020 2020 2020 2070 6f74 656e             poten
-00026bc0: 7469 616c 6c79 2072 6564 7563 696e 6720  tially reducing 
-00026bd0: 7468 6520 7469 6d65 2066 6f72 2073 7572  the time for sur
-00026be0: 6661 6365 2d64 6973 7461 6e63 6520 6361  face-distance ca
-00026bf0: 6c63 756c 6174 696f 6e73 2e0a 0a20 2020  lculations...   
-00026c00: 2020 2020 206d 6174 6368 5f6c 656e 6774       match_lengt
-00026c10: 6873 203a 2062 6f6f 6c2f 7374 722f 6c69  hs : bool/str/li
-00026c20: 7374 2c20 6465 6661 756c 743d 4661 6c73  st, default=Fals
-00026c30: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-00026c40: 2073 6574 2074 6f20 5472 7565 2c20 746f   set to True, to
-00026c50: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-00026c60: 206f 7468 6572 2052 4f49 2c20 6f72 2074   other ROI, or t
-00026c70: 6f20 6120 6c69 7374 0a20 2020 2020 2020  o a list.       
-00026c80: 2020 2020 206f 6620 6e61 6d65 7320 696e       of names in
-00026c90: 636c 7564 696e 6720 7468 6520 6e61 6d65  cluding the name
-00026ca0: 206f 6620 7468 6520 6f74 6865 7220 524f   of the other RO
-00026cb0: 492c 206d 6174 6368 2052 4f49 206c 656e  I, match ROI len
-00026cc0: 6774 6873 0a20 2020 2020 2020 2020 2020  gths.           
-00026cd0: 2028 7a2d 6469 6d65 6e73 696f 6e73 2920   (z-dimensions) 
-00026ce0: 6265 666f 7265 2063 6f6d 7061 7269 736f  before compariso
-00026cf0: 6e2e 2020 5468 6520 7374 7261 7465 6779  n.  The strategy
-00026d00: 2075 7365 6420 6973 2064 6566 696e 6564   used is defined
-00026d10: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
-00026d20: 7468 6520 7661 6c75 6520 6f66 206d 6174  the value of mat
-00026d30: 6368 5f6c 656e 6774 6873 5f73 7472 6174  ch_lengths_strat
-00026d40: 6567 792e 0a0a 2020 2020 2020 2020 6d61  egy...        ma
-00026d50: 7463 685f 6c65 6e67 7468 735f 7374 7261  tch_lengths_stra
-00026d60: 7465 6779 203a 2069 6e74 2c20 6465 6661  tegy : int, defa
-00026d70: 756c 743d 310a 2020 2020 2020 2020 2020  ult=1.          
-00026d80: 2020 5374 7261 7465 6779 2074 6f20 7573    Strategy to us
-00026d90: 6520 666f 7220 6d61 7463 6869 6e67 2052  e for matching R
-00026da0: 4f49 206c 656e 6774 6873 2028 7a2d 6469  OI lengths (z-di
-00026db0: 6d65 6e73 696f 6e73 293a 0a0a 2020 2020  mensions):..    
-00026dc0: 2020 2020 2020 2020 2d20 3020 3a20 4372          - 0 : Cr
-00026dd0: 6f70 2074 6869 7320 524f 4920 746f 2074  op this ROI to t
-00026de0: 6865 207a 2d65 7874 656e 7473 206f 6620  he z-extents of 
-00026df0: 7468 6520 6f74 6865 7220 524f 493b 0a20  the other ROI;. 
-00026e00: 2020 2020 2020 2020 2020 202d 2031 203a             - 1 :
-00026e10: 2043 726f 7020 7468 6520 6f74 6865 7220   Crop the other 
-00026e20: 524f 4920 746f 2074 6865 207a 2d65 7865  ROI to the z-exe
-00026e30: 6e74 7320 6f66 2074 6869 7320 524f 493b  nts of this ROI;
-00026e40: 0a20 2020 2020 2020 2020 2020 202d 2032  .            - 2
-00026e50: 203a 2043 726f 7020 7468 6973 2052 4f49   : Crop this ROI
-00026e60: 2074 6f20 7468 6520 7a2d 6578 7465 6e74   to the z-extent
-00026e70: 7320 6f66 2074 6865 206f 7468 6572 2052  s of the other R
-00026e80: 4f49 2c20 7468 656e 0a20 2020 2020 2020  OI, then.       
-00026e90: 2020 2020 2020 2020 2020 2063 726f 7020             crop 
-00026ea0: 7468 6520 6f74 6865 7220 524f 4920 746f  the other ROI to
-00026eb0: 2074 6865 2063 726f 7070 6564 207a 2d65   the cropped z-e
-00026ec0: 7874 656e 7473 206f 6620 7468 6973 2052  xtents of this R
-00026ed0: 4f49 2e0a 0a20 2020 2020 2020 2020 2020  OI...           
-00026ee0: 2046 6f72 2061 2076 616c 7565 206f 7468   For a value oth
-00026ef0: 6572 2074 6861 6e20 302c 2031 2c20 322c  er than 0, 1, 2,
-00026f00: 206e 6f20 6c65 6e67 7468 206d 6174 6368   no length match
-00026f10: 696e 6720 6973 2070 6572 666f 726d 6564  ing is performed
-00026f20: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00026f30: 2020 2020 2020 6966 2076 6f78 656c 5f73        if voxel_s
-00026f40: 697a 6520 6973 206e 6f74 204e 6f6e 653a  ize is not None:
-00026f50: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-00026f60: 7265 6174 6520 524f 4920 6d61 736b 732c  reate ROI masks,
-00026f70: 206a 7573 7420 636f 7665 7269 6e67 2076   just covering v
-00026f80: 6f6c 756d 6520 6f63 6375 7069 6564 0a20  olume occupied. 
-00026f90: 2020 2020 2020 2020 2020 2023 2062 7920             # by 
-00026fa0: 524f 4973 2062 6569 6e67 2063 6f6d 7061  ROIs being compa
-00026fb0: 7265 642c 2077 6974 6820 7370 6563 6966  red, with specif
-00026fc0: 6965 6420 766f 7865 6c20 7369 7a65 2e0a  ied voxel size..
-00026fd0: 2020 2020 2020 2020 2020 2020 2320 2854              # (T
-00026fe0: 6865 2072 6573 697a 696e 6720 6973 2070  he resizing is p
-00026ff0: 6572 666f 726d 6564 206f 6e20 636c 6f6e  erformed on clon
-00027000: 6573 206f 6e20 7468 6520 524f 4973 2c0a  es on the ROIs,.
-00027010: 2020 2020 2020 2020 2020 2020 2320 7769              # wi
-00027020: 7468 6f75 7420 6368 616e 6769 6e67 2074  thout changing t
-00027030: 6865 206f 7269 6769 6e61 6c73 2e29 0a20  he originals.). 
-00027040: 2020 2020 2020 2020 2020 2072 6f69 302c             roi0,
-00027050: 2072 6f69 203d 2073 656c 662e 6d61 7463   roi = self.matc
-00027060: 685f 6d61 736b 5f76 6f78 656c 5f73 697a  h_mask_voxel_siz
-00027070: 6528 726f 692c 0a20 2020 2020 2020 2020  e(roi,.         
-00027080: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
-00027090: 5f73 697a 653d 766f 7865 6c5f 7369 7a65  _size=voxel_size
-000270a0: 2c20 766f 7865 6c5f 6469 6d5f 746f 6c65  , voxel_dim_tole
-000270b0: 7261 6e63 653d 2d31 290a 2020 2020 2020  rance=-1).      
-000270c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000270d0: 2020 2020 2320 446f 6e27 7420 6578 706c      # Don't expl
-000270e0: 6963 6974 6c79 2063 7265 6174 6520 524f  icitly create RO
-000270f0: 4920 6d61 736b 732e 0a20 2020 2020 2020  I masks..       
-00027100: 2020 2020 2072 6f69 3020 3d20 7365 6c66       roi0 = self
-00027110: 0a0a 2020 2020 2020 2020 2320 4f70 7469  ..        # Opti
-00027120: 6f6e 616c 6c79 206d 6174 6368 2052 4f49  onally match ROI
-00027130: 206c 656e 6774 6873 2e0a 2020 2020 2020   lengths..      
-00027140: 2020 6966 2028 286d 6174 6368 5f6c 656e    if ((match_len
-00027150: 6774 6873 2069 7320 5472 7565 2920 6f72  gths is True) or
-00027160: 2028 726f 692e 6e61 6d65 203d 3d20 6d61   (roi.name == ma
-00027170: 7463 685f 6c65 6e67 7468 7329 0a20 2020  tch_lengths).   
-00027180: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-00027190: 2869 7369 6e73 7461 6e63 6528 6d61 7463  (isinstance(matc
-000271a0: 685f 6c65 6e67 7468 732c 2028 6c69 7374  h_lengths, (list
-000271b0: 2c20 7475 706c 652c 2073 6574 2929 0a20  , tuple, set)). 
-000271c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000271d0: 2020 2061 6e64 2072 6f69 2e6e 616d 6520     and roi.name 
-000271e0: 696e 206d 6174 6368 5f6c 656e 6774 6873  in match_lengths
-000271f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00027200: 2320 4372 6561 7465 2052 4f49 2063 6c6f  # Create ROI clo
-00027210: 6e65 7320 666f 7220 6372 6f70 7069 6e67  nes for cropping
-00027220: 3b20 7468 6520 6f72 6967 696e 616c 7320  ; the originals 
-00027230: 7769 6c6c 2062 6520 756e 6368 616e 6765  will be unchange
-00027240: 642e 0a20 2020 2020 2020 2020 2020 2069  d..            i
-00027250: 6620 6d61 7463 685f 6c65 6e67 7468 735f  f match_lengths_
-00027260: 7374 7261 7465 6779 2069 6e20 5b30 2c20  strategy in [0, 
-00027270: 312c 2032 5d20 616e 6420 766f 7865 6c5f  1, 2] and voxel_
-00027280: 7369 7a65 2069 7320 4e6f 6e65 3a0a 2020  size is None:.  
-00027290: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000272a0: 6930 203d 2073 656c 662e 636c 6f6e 6528  i0 = self.clone(
-000272b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000272c0: 2020 726f 6920 3d20 726f 692e 636c 6f6e    roi = roi.clon
-000272d0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-000272e0: 2320 4372 6f70 2074 6869 7320 524f 4920  # Crop this ROI 
-000272f0: 746f 207a 2d65 7874 656e 7473 206f 6620  to z-extents of 
-00027300: 6f74 6865 7220 524f 492e 0a20 2020 2020  other ROI..     
-00027310: 2020 2020 2020 2069 6620 6d61 7463 685f         if match_
-00027320: 6c65 6e67 7468 735f 7374 7261 7465 6779  lengths_strategy
-00027330: 2069 6e20 5b30 2c20 325d 3a0a 2020 2020   in [0, 2]:.    
-00027340: 2020 2020 2020 2020 2020 2020 726f 6930              roi0
-00027350: 2e63 726f 705f 746f 5f72 6f69 5f6c 656e  .crop_to_roi_len
-00027360: 6774 6828 726f 6929 0a20 2020 2020 2020  gth(roi).       
-00027370: 2020 2020 2023 2043 726f 7020 6f74 6865       # Crop othe
-00027380: 7220 524f 4920 746f 207a 2d65 7874 656e  r ROI to z-exten
-00027390: 7473 206f 6620 7468 6973 2052 4f49 2e0a  ts of this ROI..
-000273a0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-000273b0: 6174 6368 5f6c 656e 6774 6873 5f73 7472  atch_lengths_str
-000273c0: 6174 6567 7920 696e 205b 312c 2032 5d3a  ategy in [1, 2]:
-000273d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000273e0: 2072 6f69 2e63 726f 705f 746f 5f72 6f69   roi.crop_to_roi
-000273f0: 5f6c 656e 6774 6828 726f 6930 290a 0a20  _length(roi0).. 
-00027400: 2020 2020 2020 2023 2044 6566 6175 6c74         # Default
-00027410: 206d 6574 7269 6373 0a20 2020 2020 2020   metrics.       
-00027420: 2069 6620 6d65 7472 6963 7320 6973 204e   if metrics is N
-00027430: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00027440: 206d 6574 7269 6373 203d 205b 2264 6963   metrics = ["dic
-00027450: 6522 2c20 2263 656e 7472 6f69 6422 5d0a  e", "centroid"].
-00027460: 0a20 2020 2020 2020 2023 2044 6566 6175  .        # Defau
-00027470: 6c74 2073 6c69 6365 7320 746f 2063 6f6e  lt slices to con
-00027480: 7369 6465 7220 666f 7220 736c 6963 652d  sider for slice-
-00027490: 6279 2d73 6c69 6365 206d 6574 7269 6320  by-slice metric 
-000274a0: 6361 6c63 756c 6174 696f 6e73 2e0a 2020  calculations..  
-000274b0: 2020 2020 2020 6465 6661 756c 745f 6279        default_by
-000274c0: 5f73 6c69 6365 203d 2073 6b72 742e 636f  _slice = skrt.co
-000274d0: 7265 2e44 6566 6175 6c74 7328 292e 6279  re.Defaults().by
-000274e0: 5f73 6c69 6365 0a0a 2020 2020 2020 2020  _slice..        
-000274f0: 2320 496e 6974 6961 6c69 7365 2076 6172  # Initialise var
-00027500: 6961 626c 6573 2066 6f72 2064 6973 7461  iables for dista
-00027510: 6e63 6520 6d65 7472 6963 732e 0a20 2020  nce metrics..   
-00027520: 2020 2020 2063 6f6e 666f 726d 6974 7920       conformity 
-00027530: 3d20 4e6f 6e65 0a20 2020 2020 2020 2063  = None.        c
-00027540: 6f6e 666f 726d 6974 795f 666c 6174 203d  onformity_flat =
-00027550: 204e 6f6e 650a 2020 2020 2020 2020 6469   None.        di
-00027560: 7374 616e 6365 7320 3d20 4e6f 6e65 0a20  stances = None. 
-00027570: 2020 2020 2020 2064 6973 7461 6e63 6573         distances
-00027580: 5f66 6c61 7420 3d20 4e6f 6e65 0a20 2020  _flat = None.   
-00027590: 2020 2020 2073 6967 6e65 645f 6469 7374       signed_dist
-000275a0: 616e 6365 7320 3d20 4e6f 6e65 0a20 2020  ances = None.   
+00015940: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00015950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015960: 666f 756e 6420 3d20 5472 7565 0a0a 2020  found = True..  
+00015970: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015980: 206e 6f74 2066 6f75 6e64 3a0a 2020 2020   not found:.    
+00015990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159a0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+000159b0: 6f72 2866 224d 6574 7269 6320 7b6d 7d20  or(f"Metric {m} 
+000159c0: 6e6f 7420 7265 636f 676e 6973 6564 2062  not recognised b
+000159d0: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
+000159e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159f0: 2020 2020 2020 2020 2020 2022 524f 492e             "ROI.
+00015a00: 6765 745f 6765 6f6d 6574 7279 2829 2229  get_geometry()")
+00015a10: 0a0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
+00015a20: 756e 6974 7320 746f 206d 6574 7269 6320  units to metric 
+00015a30: 6e61 6d65 7320 6966 2072 6571 7565 7374  names if request
+00015a40: 6564 0a20 2020 2020 2020 2067 656f 6d5f  ed.        geom_
+00015a50: 6e61 6d65 6420 3d20 7b7d 0a20 2020 2020  named = {}.     
+00015a60: 2020 2069 6620 6e6f 7420 756e 6974 735f     if not units_
+00015a70: 696e 5f68 6561 6465 723a 0a20 2020 2020  in_header:.     
+00015a80: 2020 2020 2020 2067 656f 6d5f 6e61 6d65         geom_name
+00015a90: 6420 3d20 6765 6f6d 0a20 2020 2020 2020  d = geom.       
+00015aa0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015ab0: 2020 2066 6f72 206d 6574 7269 632c 2076     for metric, v
+00015ac0: 616c 2069 6e20 6765 6f6d 2e69 7465 6d73  al in geom.items
+00015ad0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00015ae0: 2020 2020 6e61 6d65 203d 206d 6574 7269      name = metri
+00015af0: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+00015b00: 2020 6966 2022 766f 6c75 6d65 2220 696e    if "volume" in
+00015b10: 206d 6574 7269 633a 0a20 2020 2020 2020   metric:.       
+00015b20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00015b30: 766f 6c5f 756e 6974 7320 3d3d 2022 6d6d  vol_units == "mm
+00015b40: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00015b50: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+00015b60: 2b3d 2022 2028 6d6d 5e33 2922 0a20 2020  += " (mm^3)".   
+00015b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015b90: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00015ba0: 616d 6520 2b3d 2022 2028 2220 2b20 766f  ame += " (" + vo
+00015bb0: 6c5f 756e 6974 7320 2b20 2229 220a 2020  l_units + ")".  
+00015bc0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00015bd0: 6966 2022 6172 6561 2220 696e 206d 6574  if "area" in met
+00015be0: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
+00015bf0: 2020 2020 2020 2020 2069 6620 6172 6561           if area
+00015c00: 5f75 6e69 7473 203d 3d20 226d 6d22 3a0a  _units == "mm":.
+00015c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c20: 2020 2020 2020 2020 6e61 6d65 202b 3d20          name += 
+00015c30: 2220 286d 6d5e 3229 220a 2020 2020 2020  " (mm^2)".      
+00015c40: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00015c50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00015c60: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00015c70: 202b 3d20 2220 2822 202b 2061 7265 615f   += " (" + area_
+00015c80: 756e 6974 7320 2b20 2229 220a 2020 2020  units + ")".    
+00015c90: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00015ca0: 2022 6c65 6e67 7468 2220 696e 206d 6574   "length" in met
+00015cb0: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
+00015cc0: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
+00015cd0: 2022 2028 2220 2b20 6c65 6e67 7468 5f75   " (" + length_u
+00015ce0: 6e69 7473 202b 2022 2922 0a20 2020 2020  nits + ")".     
+00015cf0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00015d00: 2263 656e 7472 6f69 6422 2069 6e20 6d65  "centroid" in me
+00015d10: 7472 6963 3a0a 2020 2020 2020 2020 2020  tric:.          
+00015d20: 2020 2020 2020 2020 2020 6e61 6d65 202b            name +
+00015d30: 3d20 2220 2822 202b 2063 656e 7472 6f69  = " (" + centroi
+00015d40: 645f 756e 6974 7320 2b20 2229 220a 2020  d_units + ")".  
+00015d50: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+00015d60: 6f6d 5f6e 616d 6564 5b6e 616d 655d 203d  om_named[name] =
+00015d70: 2076 616c 0a0a 2020 2020 2020 2020 2320   val..        # 
+00015d80: 4164 6a75 7374 206e 756d 6265 7220 6f66  Adjust number of
+00015d90: 2064 6563 696d 616c 2070 6c61 6365 730a   decimal places.
+00015da0: 2020 2020 2020 2020 6966 2064 6563 696d          if decim
+00015db0: 616c 5f70 6c61 6365 7320 6973 206e 6f74  al_places is not
+00015dc0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00015dd0: 2020 2066 6f72 206d 6574 7269 632c 2076     for metric, v
+00015de0: 616c 2069 6e20 6765 6f6d 5f6e 616d 6564  al in geom_named
+00015df0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00015e00: 2020 2020 2020 2020 2020 666d 7420 3d20            fmt = 
+00015e10: 6622 7b7b 7661 6c3a 2e7b 6465 6369 6d61  f"{{val:.{decima
+00015e20: 6c5f 706c 6163 6573 7d66 7d7d 220a 2020  l_places}f}}".  
+00015e30: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015e40: 2067 656f 6d5f 6e61 6d65 645b 6d65 7472   geom_named[metr
+00015e50: 6963 5d20 6973 206e 6f74 204e 6f6e 653a  ic] is not None:
+00015e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015e70: 2020 2020 2067 656f 6d5f 6e61 6d65 645b       geom_named[
+00015e80: 6d65 7472 6963 5d20 3d20 666c 6f61 7428  metric] = float(
+00015e90: 666d 742e 666f 726d 6174 2876 616c 3d76  fmt.format(val=v
+00015ea0: 616c 2929 0a0a 2020 2020 2020 2020 2320  al))..        # 
+00015eb0: 436f 6e76 6572 7420 746f 2070 616e 6461  Convert to panda
+00015ec0: 7320 4461 7461 4672 616d 650a 2020 2020  s DataFrame.    
+00015ed0: 2020 2020 6466 203d 2070 642e 4461 7461      df = pd.Data
+00015ee0: 4672 616d 6528 6765 6f6d 5f6e 616d 6564  Frame(geom_named
+00015ef0: 2c20 696e 6465 783d 5b73 656c 662e 6e61  , index=[self.na
+00015f00: 6d65 5d29 0a0a 2020 2020 2020 2020 2320  me])..        # 
+00015f10: 4361 7069 7461 6c69 7a65 2063 6f6c 756d  Capitalize colum
+00015f20: 6e20 6e61 6d65 7320 616e 6420 7265 6d6f  n names and remo
+00015f30: 7665 2075 6e64 6572 7363 6f72 6573 2069  ve underscores i
+00015f40: 6620 7265 7175 6573 7465 640a 2020 2020  f requested.    
+00015f50: 2020 2020 6966 206e 6963 655f 636f 6c75      if nice_colu
+00015f60: 6d6e 7320 616e 6420 6e6f 7420 676c 6f62  mns and not glob
+00015f70: 616c 5f76 735f 736c 6963 655f 6865 6164  al_vs_slice_head
+00015f80: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00015f90: 6466 2e63 6f6c 756d 6e73 203d 205b 636f  df.columns = [co
+00015fa0: 6c2e 6361 7069 7461 6c69 7a65 2829 2e72  l.capitalize().r
+00015fb0: 6570 6c61 6365 2822 5f22 2c20 2220 2229  eplace("_", " ")
+00015fc0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00015fd0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015fe0: 636f 6c20 696e 2064 662e 636f 6c75 6d6e  col in df.column
+00015ff0: 735d 0a0a 2020 2020 2020 2020 2320 5475  s]..        # Tu
+00016000: 726e 206e 616d 6520 696e 746f 2061 2072  rn name into a r
+00016010: 6567 756c 6172 2063 6f6c 756d 6e20 6966  egular column if
+00016020: 2072 6571 7565 7374 6564 0a20 2020 2020   requested.     
+00016030: 2020 2069 6620 6e6f 7420 6e61 6d65 5f61     if not name_a
+00016040: 735f 696e 6465 783a 0a20 2020 2020 2020  s_index:.       
+00016050: 2020 2020 2064 6620 3d20 6466 2e72 6573       df = df.res
+00016060: 6574 5f69 6e64 6578 2829 2e72 656e 616d  et_index().renam
+00016070: 6528 7b22 696e 6465 7822 3a20 2252 4f49  e({"index": "ROI
+00016080: 227d 2c20 6178 6973 3d31 290a 0a20 2020  "}, axis=1)..   
+00016090: 2020 2020 2023 2041 6464 2067 6c6f 6261       # Add globa
+000160a0: 6c2f 736c 6963 6520 6865 6164 6572 730a  l/slice headers.
+000160b0: 2020 2020 2020 2020 6966 2067 6c6f 6261          if globa
+000160c0: 6c5f 7673 5f73 6c69 6365 5f68 6561 6465  l_vs_slice_heade
+000160d0: 723a 0a0a 2020 2020 2020 2020 2020 2020  r:..            
+000160e0: 2320 536f 7274 2063 6f6c 756d 6e73 2069  # Sort columns i
+000160f0: 6e74 6f20 676c 6f62 616c 206f 7220 736c  nto global or sl
+00016100: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+00016110: 6865 6164 6572 7320 3d20 5b5d 0a20 2020  headers = [].   
+00016120: 2020 2020 2020 2020 2073 6c69 6365 5f63           slice_c
+00016130: 6f6c 7320 3d20 5b5d 0a20 2020 2020 2020  ols = [].       
+00016140: 2020 2020 2067 6c6f 6261 6c5f 636f 6c73       global_cols
+00016150: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00016160: 2020 736c 6963 655f 6e61 6d65 203d 2022    slice_name = "
+00016170: 736c 6963 6522 2069 6620 6e6f 7420 6e69  slice" if not ni
+00016180: 6365 5f63 6f6c 756d 6e73 2065 6c73 6520  ce_columns else 
+00016190: 2253 6c69 6365 220a 2020 2020 2020 2020  "Slice".        
+000161a0: 2020 2020 676c 6f62 616c 5f6e 616d 6520      global_name 
+000161b0: 3d20 2267 6c6f 6261 6c22 2069 6620 6e6f  = "global" if no
+000161c0: 7420 6e69 6365 5f63 6f6c 756d 6e73 2065  t nice_columns e
+000161d0: 6c73 6520 2247 6c6f 6261 6c22 0a20 2020  lse "Global".   
+000161e0: 2020 2020 2020 2020 2066 6f72 206d 6574           for met
+000161f0: 7269 6320 696e 2067 656f 6d5f 6e61 6d65  ric in geom_name
+00016200: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+00016210: 2020 206e 616d 6520 3d20 6d65 7472 6963     name = metric
+00016220: 2069 6620 6e6f 7420 6e69 6365 5f63 6f6c   if not nice_col
+00016230: 756d 6e73 2065 6c73 6520 5c0a 2020 2020  umns else \.    
+00016240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016250: 2020 2020 6d65 7472 6963 2e63 6170 6974      metric.capit
+00016260: 616c 697a 6528 292e 7265 706c 6163 6528  alize().replace(
+00016270: 225f 222c 2022 2229 0a20 2020 2020 2020  "_", "").       
+00016280: 2020 2020 2020 2020 2069 6620 2261 7265           if "are
+00016290: 6122 2069 6e20 6d65 7472 6963 206f 7220  a" in metric or 
+000162a0: 2273 6c69 6365 2220 696e 206d 6574 7269  "slice" in metri
+000162b0: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
+000162c0: 2020 2020 2020 2068 6561 6465 7273 2e61         headers.a
+000162d0: 7070 656e 6428 2873 6c69 6365 5f6e 616d  ppend((slice_nam
+000162e0: 652c 206d 6574 7269 6329 290a 2020 2020  e, metric)).    
+000162f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016300: 736c 6963 655f 636f 6c73 2e61 7070 656e  slice_cols.appen
+00016310: 6428 6d65 7472 6963 290a 2020 2020 2020  d(metric).      
+00016320: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00016330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016340: 2020 2020 6865 6164 6572 732e 6170 7065      headers.appe
+00016350: 6e64 2828 676c 6f62 616c 5f6e 616d 652c  nd((global_name,
+00016360: 206d 6574 7269 6329 290a 2020 2020 2020   metric)).      
+00016370: 2020 2020 2020 2020 2020 2020 2020 676c                gl
+00016380: 6f62 616c 5f63 6f6c 732e 6170 7065 6e64  obal_cols.append
+00016390: 286d 6574 7269 6329 0a0a 2020 2020 2020  (metric)..      
+000163a0: 2020 2020 2020 2320 5265 6f72 6465 7220        # Reorder 
+000163b0: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
+000163c0: 2020 2020 6466 735f 6f72 6465 7265 6420      dfs_ordered 
+000163d0: 3d20 5b64 665b 676c 6f62 616c 5f63 6f6c  = [df[global_col
+000163e0: 735d 2c20 6466 5b73 6c69 6365 5f63 6f6c  s], df[slice_col
+000163f0: 735d 5d0a 2020 2020 2020 2020 2020 2020  s]].            
+00016400: 6966 206e 6f74 206e 616d 655f 6173 5f69  if not name_as_i
+00016410: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
+00016420: 2020 2020 2020 6466 735f 6f72 6465 7265        dfs_ordere
+00016430: 642e 696e 7365 7274 2830 2c20 6466 5b22  d.insert(0, df["
+00016440: 524f 4922 5d29 0a20 2020 2020 2020 2020  ROI"]).         
+00016450: 2020 2064 6620 3d20 7064 2e63 6f6e 6361     df = pd.conca
+00016460: 7428 6466 735f 6f72 6465 7265 642c 2061  t(dfs_ordered, a
+00016470: 7869 733d 3129 0a0a 2020 2020 2020 2020  xis=1)..        
+00016480: 2020 2020 2320 536f 7274 2068 6561 6465      # Sort heade
+00016490: 7273 2062 7920 676c 6f62 616c 2f73 6c69  rs by global/sli
+000164a0: 6365 0a20 2020 2020 2020 2020 2020 2068  ce.            h
+000164b0: 6561 6465 7273 203d 205b 6820 666f 7220  eaders = [h for 
+000164c0: 6820 696e 2068 6561 6465 7273 2069 6620  h in headers if 
+000164d0: 685b 305d 203d 3d20 676c 6f62 616c 5f6e  h[0] == global_n
+000164e0: 616d 655d 205c 0a20 2020 2020 2020 2020  ame] \.         
+000164f0: 2020 2020 2020 2020 2020 202b 205b 6820             + [h 
+00016500: 666f 7220 6820 696e 2068 6561 6465 7273  for h in headers
+00016510: 2069 6620 685b 305d 203d 3d20 736c 6963   if h[0] == slic
+00016520: 655f 6e61 6d65 5d0a 2020 2020 2020 2020  e_name].        
+00016530: 2020 2020 6966 206e 6f74 206e 616d 655f      if not name_
+00016540: 6173 5f69 6e64 6578 3a0a 2020 2020 2020  as_index:.      
+00016550: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00016560: 732e 696e 7365 7274 2830 2c20 2822 222c  s.insert(0, ("",
+00016570: 2022 524f 4922 2929 0a0a 2020 2020 2020   "ROI"))..      
+00016580: 2020 2020 2020 2320 4164 6420 4d75 6c74        # Add Mult
+00016590: 6949 6e64 6578 0a20 2020 2020 2020 2020  iIndex.         
+000165a0: 2020 2064 662e 636f 6c75 6d6e 7320 3d20     df.columns = 
+000165b0: 7064 2e4d 756c 7469 496e 6465 782e 6672  pd.MultiIndex.fr
+000165c0: 6f6d 5f74 7570 6c65 7328 6865 6164 6572  om_tuples(header
+000165d0: 7329 0a0a 2020 2020 2020 2020 6966 2068  s)..        if h
+000165e0: 746d 6c3a 0a20 2020 2020 2020 2020 2020  tml:.           
+000165f0: 2072 6574 7572 6e20 6466 5f74 6f5f 6874   return df_to_ht
+00016600: 6d6c 2864 6629 0a20 2020 2020 2020 2072  ml(df).        r
+00016610: 6574 7572 6e20 6466 0a0a 2020 2020 6465  eturn df..    de
+00016620: 6620 6765 745f 6365 6e74 726f 6964 5f64  f get_centroid_d
+00016630: 6973 7461 6e63 6528 7365 6c66 2c20 726f  istance(self, ro
+00016640: 692c 2073 696e 676c 655f 736c 6963 653d  i, single_slice=
+00016650: 4661 6c73 652c 2076 6965 773d 2278 2d79  False, view="x-y
+00016660: 222c 0a20 2020 2020 2020 2020 2020 2073  ",.            s
+00016670: 6c3d 4e6f 6e65 2c20 6964 783d 4e6f 6e65  l=None, idx=None
+00016680: 2c20 706f 733d 4e6f 6e65 2c20 756e 6974  , pos=None, unit
+00016690: 733d 226d 6d22 2c20 6d65 7468 6f64 3d4e  s="mm", method=N
+000166a0: 6f6e 652c 2066 6f72 6365 3d54 7275 652c  one, force=True,
+000166b0: 0a20 2020 2020 2020 2020 2020 2062 795f  .            by_
+000166c0: 736c 6963 653d 4e6f 6e65 2c20 7661 6c75  slice=None, valu
+000166d0: 655f 666f 725f 6e6f 6e65 3d4e 6f6e 652c  e_for_none=None,
+000166e0: 2073 6c69 6365 5f73 7461 743d 4e6f 6e65   slice_stat=None
+000166f0: 2c0a 2020 2020 2020 2020 2020 2020 2a2a  ,.            **
+00016700: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
+00016710: 7329 3a0a 2020 2020 2020 2020 2222 2247  s):.        """G
+00016720: 6574 2063 656e 7472 6f69 6420 6469 7370  et centroid disp
+00016730: 6c61 6365 6d65 6e74 2076 6563 746f 7220  lacement vector 
+00016740: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
+00016750: 616e 6f74 6865 7220 524f 492e 0a0a 2020  another ROI...  
+00016760: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+00016770: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
+00016780: 2020 2020 2020 2072 6f69 203a 2052 4f49         roi : ROI
+00016790: 0a20 2020 2020 2020 2020 2020 204f 7468  .            Oth
+000167a0: 6572 2052 4f49 2077 6974 6820 7768 6963  er ROI with whic
+000167b0: 6820 746f 2063 6f6d 7061 7265 2063 656e  h to compare cen
+000167c0: 7472 6f69 642e 0a0a 2020 2020 2020 2020  troid...        
+000167d0: 7369 6e67 6c65 5f73 6c69 6365 203a 2062  single_slice : b
+000167e0: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
+000167f0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
+00016800: 6620 5472 7565 2c20 7468 6520 6365 6e74  f True, the cent
+00016810: 726f 6964 2077 696c 6c20 6265 2072 6574  roid will be ret
+00016820: 7572 6e65 6420 666f 7220 6120 7369 6e67  urned for a sing
+00016830: 6c65 2073 6c69 6365 2e0a 0a20 2020 2020  le slice...     
+00016840: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
+00016850: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
+00016860: 2020 2020 2020 2020 204f 7269 656e 7461           Orienta
+00016870: 7469 6f6e 2069 6e20 7768 6963 6820 746f  tion in which to
+00016880: 2067 6574 2063 656e 7472 6f69 6473 2069   get centroids i
+00016890: 6620 7573 696e 6720 6120 7369 6e67 6c65  f using a single
+000168a0: 2073 6c69 6365 206f 720a 2020 2020 2020   slice or.      
+000168b0: 2020 2020 2020 666c 6174 7465 6e69 6e67        flattening
+000168c0: 2e0a 0a20 2020 2020 2020 2066 6c61 7474  ...        flatt
+000168d0: 656e 203a 2062 6f6f 6c2c 2064 6566 6175  en : bool, defau
+000168e0: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+000168f0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+00016900: 6520 3344 2063 656e 7472 6f69 6420 7769  e 3D centroid wi
+00016910: 6c6c 2062 6520 6f62 7461 696e 6564 2061  ll be obtained a
+00016920: 6e64 2074 6865 6e20 7468 6520 6162 736f  nd then the abso
+00016930: 6c75 7465 200a 2020 2020 2020 2020 2020  lute .          
+00016940: 2020 7661 6c75 6520 616c 6f6e 6720 6f6e    value along on
+00016950: 6c79 2074 6865 2032 4420 6178 6573 2069  ly the 2D axes i
+00016960: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
+00016970: 6e20 696e 203c 7669 6577 3e20 7769 6c6c  n in <view> will
+00016980: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
+00016990: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
+000169a0: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
+000169b0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+000169c0: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
+000169d0: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
+000169e0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+000169f0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+00016a00: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
+00016a10: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+00016a20: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+00016a30: 7472 616c 2073 6c69 6365 206f 6620 6561  tral slice of ea
+00016a40: 6368 2052 4f49 0a20 2020 2020 2020 2020  ch ROI.         
+00016a50: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
+00016a60: 0a0a 2020 2020 2020 2020 6964 7820 3a20  ..        idx : 
+00016a70: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+00016a80: 650a 2020 2020 2020 2020 2020 2020 4172  e.            Ar
+00016a90: 7261 7920 696e 6465 7820 6f66 2073 6c69  ray index of sli
+00016aa0: 6365 2e20 4966 206e 6f6e 6520 6f66 203c  ce. If none of <
+00016ab0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+00016ac0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+00016ad0: 0a20 2020 2020 2020 2020 2020 2062 7574  .            but
+00016ae0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+00016af0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+00016b00: 7472 616c 2073 6c69 6365 206f 6620 6561  tral slice of ea
+00016b10: 6368 2052 4f49 0a20 2020 2020 2020 2020  ch ROI.         
+00016b20: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
+00016b30: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+00016b40: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00016b50: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00016b60: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+00016b70: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+00016b80: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+00016b90: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+00016ba0: 6564 0a20 2020 2020 2020 2020 2020 2062  ed.            b
+00016bb0: 7574 203c 7369 6e67 6c65 5f73 6c69 6365  ut <single_slice
+00016bc0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+00016bd0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00016be0: 6561 6368 2052 4f49 0a20 2020 2020 2020  each ROI.       
+00016bf0: 2020 2020 2077 696c 6c20 6265 2075 7365       will be use
+00016c00: 642e 0a0a 2020 2020 2020 2020 756e 6974  d...        unit
+00016c10: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
+00016c20: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
+00016c30: 2020 556e 6974 7320 6f66 2061 6273 6f6c    Units of absol
+00016c40: 7574 6520 6365 6e74 726f 6964 2064 6973  ute centroid dis
+00016c50: 7461 6e63 652e 2043 616e 2062 6520 616e  tance. Can be an
+00016c60: 7920 6f66 3a0a 2020 2020 2020 2020 2020  y of:.          
+00016c70: 2020 2020 2020 2d20 226d 6d22 3a20 7265        - "mm": re
+00016c80: 7475 726e 2063 656e 7472 6f69 6420 706f  turn centroid po
+00016c90: 7369 7469 6f6e 2069 6e20 6d69 6c6c 696d  sition in millim
+00016ca0: 6574 7265 732e 0a20 2020 2020 2020 2020  etres..         
+00016cb0: 2020 2020 2020 202d 2022 766f 7865 6c73         - "voxels
+00016cc0: 223a 2072 6574 7572 6e20 6365 6e74 726f  ": return centro
+00016cd0: 6964 2070 6f73 6974 696f 6e20 696e 2074  id position in t
+00016ce0: 6572 6d73 206f 6620 6172 7261 7920 696e  erms of array in
+00016cf0: 6469 6365 732e 0a20 2020 2020 2020 2020  dices..         
+00016d00: 2020 2020 2020 202d 2022 736c 6963 6522         - "slice"
+00016d10: 3a20 7265 7475 726e 2063 656e 7472 6f69  : return centroi
+00016d20: 6420 706f 7369 7469 6f6e 2069 6e20 7465  d position in te
+00016d30: 726d 7320 6f66 2073 6c69 6365 206e 756d  rms of slice num
+00016d40: 6265 7273 2e0a 0a20 2020 2020 2020 2020  bers...         
+00016d50: 2020 2049 6620 756e 6974 733d 2276 6f78     If units="vox
+00016d60: 656c 7322 206f 7220 2273 6c69 6365 2220  els" or "slice" 
+00016d70: 6973 2072 6571 7565 7374 6564 2062 7574  is requested but
+00016d80: 2065 6974 6865 7220 524f 4920 6f6e 6c79   either ROI only
+00016d90: 2068 6173 200a 2020 2020 2020 2020 2020   has .          
+00016da0: 2020 636f 6e74 6f75 7273 2061 6e64 206e    contours and n
+00016db0: 6f20 6d61 736b 2073 6861 7065 2f76 6f78  o mask shape/vox
+00016dc0: 656c 2073 697a 6520 696e 666f 726d 6174  el size informat
+00016dd0: 696f 6e2c 2061 6e20 6572 726f 7220 7769  ion, an error wi
+00016de0: 6c6c 2062 6520 0a20 2020 2020 2020 2020  ll be .         
+00016df0: 2020 2072 6169 7365 6420 2875 6e6c 6573     raised (unles
+00016e00: 7320 6178 3d22 7a22 2c20 696e 2077 6869  s ax="z", in whi
+00016e10: 6368 2063 6173 6520 766f 7865 6c20 7369  ch case voxel si
+00016e20: 7a65 2077 696c 6c20 6265 2069 6e66 6572  ze will be infer
+00016e30: 7265 6420 0a20 2020 2020 2020 2020 2020  red .           
+00016e40: 2066 726f 6d20 7370 6163 696e 6720 6265   from spacing be
+00016e50: 7477 6565 6e20 736c 6963 6573 292e 0a0a  tween slices)...
+00016e60: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+00016e70: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+00016e80: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+00016e90: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+00016ea0: 2063 656e 7472 6f69 6420 6361 6c63 756c   centroid calcul
+00016eb0: 6174 696f 6e2e 2043 616e 2062 653a 200a  ation. Can be: .
+00016ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ed0: 2d20 2263 6f6e 746f 7572 223a 2067 6574  - "contour": get
+00016ee0: 2063 656e 7472 6f69 6420 6f66 2073 6861   centroid of sha
+00016ef0: 7065 6c79 2063 6f6e 746f 7572 2873 292e  pely contour(s).
+00016f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016f10: 202d 2022 6d61 736b 223a 2067 6574 2061   - "mask": get a
+00016f20: 7665 7261 6765 2070 6f73 6974 696f 6e20  verage position 
+00016f30: 6f66 2076 6f78 656c 7320 696e 2062 696e  of voxels in bin
+00016f40: 6172 7920 6d61 736b 2e0a 2020 2020 2020  ary mask..      
+00016f50: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
+00016f60: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
+00016f70: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
+00016f80: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
+00016f90: 2e0a 0a20 2020 2020 2020 2066 6f72 6365  ...        force
+00016fa0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00016fb0: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
+00016fc0: 2020 4966 2054 7275 652c 2074 6865 2067    If True, the g
+00016fd0: 6c6f 6261 6c20 6365 6e74 726f 6964 2077  lobal centroid w
+00016fe0: 696c 6c20 616c 7761 7973 2062 6520 7265  ill always be re
+00016ff0: 6361 6c63 756c 6174 6564 3b20 0a20 2020  calculated; .   
+00017000: 2020 2020 2020 2020 206f 7468 6572 7769           otherwi
+00017010: 7365 2c20 6974 2077 696c 6c20 6f6e 6c79  se, it will only
+00017020: 2062 6520 6361 6c63 756c 6174 6564 2069   be calculated i
+00017030: 6620 6974 2068 6173 206e 6f74 2079 6574  f it has not yet
+00017040: 2062 6565 6e20 6361 6368 6564 200a 2020   been cached .  
+00017050: 2020 2020 2020 2020 2020 696e 2073 656c            in sel
+00017060: 662e 5f76 6f6c 756d 652e 2020 4e6f 7465  f._volume.  Note
+00017070: 2074 6861 7420 6966 2073 696e 676c 655f   that if single_
+00017080: 736c 6963 653d 5472 7565 2c20 7468 6520  slice=True, the 
+00017090: 6365 6e74 726f 6964 2077 696c 6c20 0a20  centroid will . 
+000170a0: 2020 2020 2020 2020 2020 2061 6c77 6179             alway
+000170b0: 7320 6265 2072 6563 616c 6375 6c61 7465  s be recalculate
+000170c0: 642e 0a0a 2020 2020 2020 2020 6279 5f73  d...        by_s
+000170d0: 6c69 6365 203a 2073 7472 2c20 6465 6661  lice : str, defa
+000170e0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000170f0: 2020 2020 2049 6620 6f6e 6520 6f66 2022       If one of "
+00017100: 6c65 6674 222c 2022 7269 6768 7422 2c20  left", "right", 
+00017110: 2275 6e69 6f6e 222c 2022 696e 7465 7273  "union", "inters
+00017120: 6563 7469 6f6e 222c 2063 616c 6375 6c61  ection", calcula
+00017130: 7465 0a20 2020 2020 2020 2020 2020 2044  te.            D
+00017140: 6963 6520 7363 6f72 6573 2073 6c69 6365  ice scores slice
+00017150: 2062 7920 736c 6963 6520 666f 7220 6561   by slice for ea
+00017160: 6368 2073 6c69 6365 2063 6f6e 7461 696e  ch slice contain
+00017170: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+00017180: 7365 6c66 2061 6e64 2f6f 7220 6f74 6865  self and/or othe
+00017190: 723a 0a0a 2020 2020 2020 2020 2020 2020  r:..            
+000171a0: 2d20 226c 6566 7422 3a20 636f 6e73 6964  - "left": consid
+000171b0: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+000171c0: 6f6e 7461 696e 696e 6720 7365 6c66 3b0a  ontaining self;.
+000171d0: 2020 2020 2020 2020 2020 2020 2d20 2272              - "r
+000171e0: 6967 6874 223a 2063 6f6e 7369 6465 7220  ight": consider 
+000171f0: 6f6e 6c79 2073 6c69 6365 7320 636f 6e74  only slices cont
+00017200: 6169 6e69 6e67 206f 7468 6572 3b0a 2020  aining other;.  
+00017210: 2020 2020 2020 2020 2020 2d20 2275 6e69            - "uni
+00017220: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
+00017230: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+00017240: 6569 7468 6572 206f 6620 7365 6c66 2061  either of self a
+00017250: 6e64 206f 7468 6572 3b0a 2020 2020 2020  nd other;.      
+00017260: 2020 2020 2020 2d20 2269 6e74 6572 7365        - "interse
+00017270: 6374 696f 6e22 3a20 636f 6e73 6964 6572  ction": consider
+00017280: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+00017290: 6e67 2062 6f74 6820 6f66 2073 656c 6620  ng both of self 
+000172a0: 616e 6420 6f74 6865 722e 0a0a 2020 2020  and other...    
+000172b0: 2020 2020 2020 2020 4966 2073 6c69 6365          If slice
+000172c0: 5f73 7461 7420 6973 204e 6f6e 652c 2072  _stat is None, r
+000172d0: 6574 7572 6e20 6120 6469 6374 696f 6e61  eturn a dictiona
+000172e0: 7279 2077 6865 7265 206b 6579 7320 6172  ry where keys ar
+000172f0: 650a 2020 2020 2020 2020 2020 2020 736c  e.            sl
+00017300: 6963 6520 706f 7369 7469 6f6e 7320 616e  ice positions an
+00017310: 6420 7661 6c75 6573 2061 7265 2074 6865  d values are the
+00017320: 2063 616c 6375 6c61 7465 6420 4469 6365   calculated Dice
+00017330: 2073 636f 7265 732e 0a20 2020 2020 2020   scores..       
+00017340: 2020 2020 204f 7468 6572 7769 7365 2c20       Otherwise, 
+00017350: 7265 7475 726e 2066 6f72 2074 6865 2063  return for the c
+00017360: 616c 6375 6c61 7465 6420 4469 6365 2073  alculated Dice s
+00017370: 636f 7265 7320 7468 6520 7374 6174 6973  cores the statis
+00017380: 7469 630a 2020 2020 2020 2020 2020 2020  tic.            
+00017390: 7370 6563 6966 6965 6420 6279 2073 6c69  specified by sli
+000173a0: 6365 5f73 7461 742e 0a0a 2020 2020 2020  ce_stat...      
+000173b0: 2020 7661 6c75 655f 666f 725f 6e6f 6e65    value_for_none
+000173c0: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+000173d0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+000173e0: 2020 2046 6f72 2073 696e 676c 655f 736c     For single_sl
+000173f0: 6963 6520 616e 6420 6279 5f73 6c69 6365  ice and by_slice
+00017400: 2c20 7661 6c75 6520 746f 2062 6520 7265  , value to be re
+00017410: 7475 726e 6564 2066 6f72 0a20 2020 2020  turned for.     
+00017420: 2020 2020 2020 2073 6c69 6365 7320 7768         slices wh
+00017430: 6572 6520 4469 6365 2073 636f 7265 2069  ere Dice score i
+00017440: 7320 756e 6465 7465 726d 696e 6564 2028  s undetermined (
+00017450: 4e6f 6e65 292e 2020 466f 7220 736c 6963  None).  For slic
+00017460: 655f 7374 6174 2c0a 2020 2020 2020 2020  e_stat,.        
+00017470: 2020 2020 7661 6c75 6520 746f 2073 7562      value to sub
+00017480: 7374 6974 7574 6520 666f 7220 616e 7920  stitute for any 
+00017490: 4e6f 6e65 2076 616c 7565 7320 616d 6f6e  None values amon
+000174a0: 6720 7468 6520 696e 7075 7473 0a20 2020  g the inputs.   
+000174b0: 2020 2020 2020 2020 2066 6f72 2063 616c           for cal
+000174c0: 6375 6c61 7469 6e67 2073 6c69 6365 2d62  culating slice-b
+000174d0: 6173 6564 2073 7461 7469 7374 6963 2e20  ased statistic. 
+000174e0: 2049 6620 4e6f 6e65 2069 6e20 7468 6520   If None in the 
+000174f0: 6c61 7474 6572 0a20 2020 2020 2020 2020  latter.         
+00017500: 2020 2063 6173 652c 204e 6f6e 6520 7661     case, None va
+00017510: 6c75 6573 2061 6d6f 6e67 2074 6865 2069  lues among the i
+00017520: 6e70 7574 7320 6172 6520 6f6d 6974 7465  nputs are omitte
+00017530: 642e 0a0a 2020 2020 2020 2020 736c 6963  d...        slic
+00017540: 655f 7374 6174 203a 2073 7472 2c20 6465  e_stat : str, de
+00017550: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00017560: 2020 2020 2020 2053 696e 676c 652d 7661         Single-va
+00017570: 7269 6162 6c65 2073 7461 7469 7374 6963  riable statistic
+00017580: 2873 2920 746f 2062 6520 7265 7475 726e  (s) to be return
+00017590: 6564 2066 6f72 2073 6c69 6365 2d62 792d  ed for slice-by-
+000175a0: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
+000175b0: 2020 4469 6365 2073 636f 7265 732e 2020    Dice scores.  
+000175c0: 5468 6973 2073 686f 756c 6420 6265 2074  This should be t
+000175d0: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
+000175e0: 756e 6374 696f 6e20 666f 720a 2020 2020  unction for.    
+000175f0: 2020 2020 2020 2020 6361 6c63 756c 6174          calculat
+00017600: 696f 6e20 6f66 2074 6865 2073 7461 7469  ion of the stati
+00017610: 7374 6963 2873 2920 696e 2074 6865 2050  stic(s) in the P
+00017620: 7974 686f 6e20 7374 6174 6973 7469 6373  ython statistics
+00017630: 206d 6f64 756c 653a 0a0a 2020 2020 2020   module:..      
+00017640: 2020 2020 2020 6874 7470 733a 2f2f 646f        https://do
+00017650: 6373 2e70 7974 686f 6e2e 6f72 672f 332f  cs.python.org/3/
+00017660: 6c69 6272 6172 792f 7374 6174 6973 7469  library/statisti
+00017670: 6373 2e68 746d 6c0a 0a20 2020 2020 2020  cs.html..       
+00017680: 2020 2020 2041 7661 696c 6162 6c65 206f       Available o
+00017690: 7074 696f 6e73 2069 6e63 6c75 6465 3a20  ptions include: 
+000176a0: 226d 6561 6e22 2c20 226d 6564 6961 6e22  "mean", "median"
+000176b0: 2c20 226d 6f64 6522 2c0a 2020 2020 2020  , "mode",.      
+000176c0: 2020 2020 2020 2273 7464 6576 222c 2022        "stdev", "
+000176d0: 7175 616e 7469 6c65 7322 2e20 2044 6973  quantiles".  Dis
+000176e0: 7265 6761 7264 6564 2069 6620 4e6f 6e65  regarded if None
+000176f0: 2e0a 0a20 2020 2020 2020 2020 2020 2049  ...            I
+00017700: 6620 6279 5f73 6c69 6365 2069 7320 4e6f  f by_slice is No
+00017710: 6e65 2061 6e64 2073 6c69 6365 5f73 7461  ne and slice_sta
+00017720: 7420 6973 2064 6966 6665 7265 6e74 2066  t is different f
+00017730: 726f 6d20 4e6f 6e65 2c0a 2020 2020 2020  rom None,.      
+00017740: 2020 2020 2020 736b 7274 2e63 6f72 652e        skrt.core.
+00017750: 4465 6661 756c 7473 2829 2e62 795f 736c  Defaults().by_sl
+00017760: 6963 6520 6973 2075 7365 6420 666f 7220  ice is used for 
+00017770: 7468 6520 666f 726d 6572 2e0a 0a20 2020  the former...   
+00017780: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
+00017790: 6b77 6172 6773 203a 2064 6963 742c 2064  kwargs : dict, d
+000177a0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+000177b0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+000177c0: 6172 6775 6d65 6e74 7320 746f 2062 6520  arguments to be 
+000177d0: 7061 7373 6564 2074 6f20 6675 6e63 7469  passed to functi
+000177e0: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
+000177f0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+00017800: 756c 6520 666f 7220 6361 6c63 756c 6174  ule for calculat
+00017810: 696f 6e20 7265 6c61 7469 7665 2074 6f20  ion relative to 
+00017820: 736c 6963 6520 7661 6c75 6573 2e20 2046  slice values.  F
+00017830: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
+00017840: 2020 2020 2020 2020 6966 2071 7561 6e74          if quant
+00017850: 696c 6573 2061 7265 2072 6571 7569 7265  iles are require
+00017860: 6420 666f 7220 3130 2069 6e74 6572 7661  d for 10 interva
+00017870: 6c73 2c20 7261 7468 6572 2074 6861 6e20  ls, rather than 
+00017880: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00017890: 7468 6520 6465 6661 756c 7420 6f66 2034  the default of 4
+000178a0: 2c20 7468 6973 2063 616e 2062 6520 7370  , this can be sp
+000178b0: 6563 6966 6965 6420 7573 696e 673a 0a0a  ecified using:..
+000178c0: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+000178d0: 655f 7374 6174 5f6b 7761 7267 737b 226e  e_stat_kwargs{"n
+000178e0: 2220 3a20 3130 7d0a 0a20 2020 2020 2020  " : 10}..       
+000178f0: 2020 2020 2046 6f72 2061 7661 696c 6162       For availab
+00017900: 6c65 206b 6579 776f 7264 206f 7074 696f  le keyword optio
+00017910: 6e73 2c20 7365 6520 646f 6375 6d65 6e74  ns, see document
+00017920: 6174 696f 6e20 6f66 2073 7461 7469 7374  ation of statist
+00017930: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+00017940: 6d6f 6475 6c65 2061 743a 0a0a 2020 2020  module at:..    
+00017950: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+00017960: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+00017970: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
+00017980: 7469 6373 2e68 746d 6c0a 2020 2020 2020  tics.html.      
+00017990: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+000179a0: 2073 6c69 6365 5f73 7461 743a 0a20 2020   slice_stat:.   
+000179b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000179c0: 7365 6c66 2e67 6574 5f73 6c69 6365 5f73  self.get_slice_s
+000179d0: 7461 7428 726f 692c 2022 6365 6e74 726f  tat(roi, "centro
+000179e0: 6964 222c 2073 6c69 6365 5f73 7461 742c  id", slice_stat,
+000179f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017a00: 2020 2020 2062 795f 736c 6963 652c 2076       by_slice, v
+00017a10: 616c 7565 5f66 6f72 5f6e 6f6e 652c 2076  alue_for_none, v
+00017a20: 6965 772c 206d 6574 686f 642c 0a20 2020  iew, method,.   
+00017a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a40: 202a 2a28 736c 6963 655f 7374 6174 5f6b   **(slice_stat_k
+00017a50: 7761 7267 7320 6f72 207b 7d29 290a 0a20  wargs or {})).. 
+00017a60: 2020 2020 2020 2069 6620 6279 5f73 6c69         if by_sli
+00017a70: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00017a80: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+00017a90: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
+00017aa0: 726f 692c 2022 6365 6e74 726f 6964 222c  roi, "centroid",
+00017ab0: 2062 795f 736c 6963 652c 0a20 2020 2020   by_slice,.     
+00017ac0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00017ad0: 6965 772c 206d 6574 686f 6429 0a0a 2020  iew, method)..  
+00017ae0: 2020 2020 2020 7468 6973 5f63 656e 7472        this_centr
+00017af0: 6f69 6420 3d20 6e70 2e61 7272 6179 2873  oid = np.array(s
+00017b00: 656c 662e 6765 745f 6365 6e74 726f 6964  elf.get_centroid
+00017b10: 280a 2020 2020 2020 2020 2020 2020 7369  (.            si
+00017b20: 6e67 6c65 5f73 6c69 6365 3d73 696e 676c  ngle_slice=singl
+00017b30: 655f 736c 6963 652c 2076 6965 773d 7669  e_slice, view=vi
+00017b40: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
+00017b50: 6478 2c20 706f 733d 706f 732c 0a20 2020  dx, pos=pos,.   
+00017b60: 2020 2020 2020 2020 2075 6e69 7473 3d75           units=u
+00017b70: 6e69 7473 2c20 6d65 7468 6f64 3d6d 6574  nits, method=met
+00017b80: 686f 642c 2066 6f72 6365 3d66 6f72 6365  hod, force=force
+00017b90: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00017ba0: 2020 2020 6f74 6865 725f 6365 6e74 726f      other_centro
+00017bb0: 6964 203d 206e 702e 6172 7261 7928 726f  id = np.array(ro
+00017bc0: 692e 6765 745f 6365 6e74 726f 6964 280a  i.get_centroid(.
+00017bd0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
+00017be0: 6c65 5f73 6c69 6365 3d73 696e 676c 655f  le_slice=single_
+00017bf0: 736c 6963 652c 2076 6965 773d 7669 6577  slice, view=view
+00017c00: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
+00017c10: 2c20 706f 733d 706f 732c 0a20 2020 2020  , pos=pos,.     
+00017c20: 2020 2020 2020 2075 6e69 7473 3d75 6e69         units=uni
+00017c30: 7473 2c20 6d65 7468 6f64 3d6d 6574 686f  ts, method=metho
+00017c40: 642c 2066 6f72 6365 3d66 6f72 6365 290a  d, force=force).
+00017c50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00017c60: 2020 6966 204e 6f6e 6520 696e 2074 6869    if None in thi
+00017c70: 735f 6365 6e74 726f 6964 206f 7220 4e6f  s_centroid or No
+00017c80: 6e65 2069 6e20 6f74 6865 725f 6365 6e74  ne in other_cent
+00017c90: 726f 6964 3a0a 2020 2020 2020 2020 2020  roid:.          
+00017ca0: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
+00017cb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017cc0: 2020 2072 6574 7572 6e20 6e70 2e61 7272     return np.arr
+00017cd0: 6179 285b 7661 6c75 655f 666f 725f 6e6f  ay([value_for_no
+00017ce0: 6e65 2c20 7661 6c75 655f 666f 725f 6e6f  ne, value_for_no
+00017cf0: 6e65 5d29 0a20 2020 2020 2020 2020 2020  ne]).           
+00017d00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017d10: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
+00017d20: 2e61 7272 6179 285b 7661 6c75 655f 666f  .array([value_fo
+00017d30: 725f 6e6f 6e65 2c20 7661 6c75 655f 666f  r_none, value_fo
+00017d40: 725f 6e6f 6e65 2c0a 2020 2020 2020 2020  r_none,.        
+00017d50: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00017d60: 655f 666f 725f 6e6f 6e65 5d29 0a20 2020  e_for_none]).   
+00017d70: 2020 2020 2072 6574 7572 6e20 6f74 6865       return othe
+00017d80: 725f 6365 6e74 726f 6964 202d 2074 6869  r_centroid - thi
+00017d90: 735f 6365 6e74 726f 6964 0a0a 2020 2020  s_centroid..    
+00017da0: 6465 6620 6765 745f 6162 735f 6365 6e74  def get_abs_cent
+00017db0: 726f 6964 5f64 6973 7461 6e63 6528 0a20  roid_distance(. 
+00017dc0: 2020 2020 2020 2073 656c 662c 200a 2020         self, .  
+00017dd0: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
+00017de0: 2020 2020 7669 6577 3d22 782d 7922 2c20      view="x-y", 
+00017df0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
+00017e00: 736c 6963 653d 4661 6c73 652c 0a20 2020  slice=False,.   
+00017e10: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
+00017e20: 7365 2c20 0a20 2020 2020 2020 2073 6c3d  se, .        sl=
+00017e30: 4e6f 6e65 2c0a 2020 2020 2020 2020 6964  None,.        id
+00017e40: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
+00017e50: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
+00017e60: 2020 756e 6974 733d 226d 6d22 2c0a 2020    units="mm",.  
+00017e70: 2020 2020 2020 6d65 7468 6f64 3d4e 6f6e        method=Non
+00017e80: 652c 0a20 2020 2020 2020 2066 6f72 6365  e,.        force
+00017e90: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
+00017ea0: 795f 736c 6963 653d 4e6f 6e65 2c0a 2020  y_slice=None,.  
+00017eb0: 2020 2020 2020 7661 6c75 655f 666f 725f        value_for_
+00017ec0: 6e6f 6e65 3d4e 6f6e 652c 0a20 2020 2020  none=None,.     
+00017ed0: 2020 2073 6c69 6365 5f73 7461 743d 4e6f     slice_stat=No
+00017ee0: 6e65 2c0a 2020 2020 2020 2020 736c 6963  ne,.        slic
+00017ef0: 655f 7374 6174 5f6b 7761 7267 733d 4e6f  e_stat_kwargs=No
+00017f00: 6e65 2c0a 2020 2020 2020 2020 293a 0a20  ne,.        ):. 
+00017f10: 2020 2020 2020 2022 2222 4765 7420 6162         """Get ab
+00017f20: 736f 6c75 7465 2063 656e 7472 6f69 6420  solute centroid 
+00017f30: 6469 7374 616e 6365 2077 6974 6820 7265  distance with re
+00017f40: 7370 6563 7420 746f 2061 6e6f 7468 6572  spect to another
+00017f50: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
+00017f60: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
+00017f70: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00017f80: 726f 6920 3a20 524f 490a 2020 2020 2020  roi : ROI.      
+00017f90: 2020 2020 2020 4f74 6865 7220 524f 4920        Other ROI 
+00017fa0: 7769 7468 2077 6869 6368 2074 6f20 636f  with which to co
+00017fb0: 6d70 6172 6520 6365 6e74 726f 6964 2e0a  mpare centroid..
+00017fc0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+00017fd0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+00017fe0: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+00017ff0: 7269 656e 7461 7469 6f6e 2069 6e20 7768  rientation in wh
+00018000: 6963 6820 746f 2067 6574 2063 656e 7472  ich to get centr
+00018010: 6f69 6473 2069 6620 7573 696e 6720 6120  oids if using a 
+00018020: 7369 6e67 6c65 2073 6c69 6365 206f 720a  single slice or.
+00018030: 2020 2020 2020 2020 2020 2020 666c 6174              flat
+00018040: 7465 6e69 6e67 2e0a 0a20 2020 2020 2020  tening...       
+00018050: 2073 696e 676c 655f 736c 6963 6520 3a20   single_slice : 
+00018060: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00018070: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00018080: 4966 2054 7275 652c 2074 6865 2063 656e  If True, the cen
+00018090: 7472 6f69 6420 7769 6c6c 2062 6520 7265  troid will be re
+000180a0: 7475 726e 6564 2066 6f72 2061 2073 696e  turned for a sin
+000180b0: 676c 6520 736c 6963 652e 0a0a 2020 2020  gle slice...    
+000180c0: 2020 2020 666c 6174 7465 6e20 3a20 626f      flatten : bo
+000180d0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+000180e0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+000180f0: 2054 7275 652c 2074 6865 2033 4420 6365   True, the 3D ce
+00018100: 6e74 726f 6964 2077 696c 6c20 6265 206f  ntroid will be o
+00018110: 6274 6169 6e65 6420 616e 6420 7468 656e  btained and then
+00018120: 2074 6865 2061 6273 6f6c 7574 6520 0a20   the absolute . 
+00018130: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00018140: 2061 6c6f 6e67 206f 6e6c 7920 7468 6520   along only the 
+00018150: 3244 2061 7865 7320 696e 2074 6865 206f  2D axes in the o
+00018160: 7269 656e 7461 7469 6f6e 2069 6e20 3c76  rientation in <v
+00018170: 6965 773e 2077 696c 6c0a 2020 2020 2020  iew> will.      
+00018180: 2020 2020 2020 6265 2072 6574 7572 6e65        be returne
+00018190: 642e 0a0a 2020 2020 2020 2020 736c 203a  d...        sl :
+000181a0: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
+000181b0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
+000181c0: 6c69 6365 206e 756d 6265 722e 2049 6620  lice number. If 
+000181d0: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
+000181e0: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
+000181f0: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
+00018200: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
+00018210: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
+00018220: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
+00018230: 6963 6520 6f66 2065 6163 6820 524f 490a  ice of each ROI.
+00018240: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00018250: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00018260: 2020 2069 6478 203a 2069 6e74 2c20 6465     idx : int, de
+00018270: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00018280: 2020 2020 2020 2041 7272 6179 2069 6e64         Array ind
+00018290: 6578 206f 6620 736c 6963 652e 2049 6620  ex of slice. If 
+000182a0: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
+000182b0: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
+000182c0: 2073 7570 706c 6965 640a 2020 2020 2020   supplied.      
+000182d0: 2020 2020 2020 6275 7420 3c73 696e 676c        but <singl
+000182e0: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
+000182f0: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
+00018300: 6963 6520 6f66 2065 6163 6820 524f 490a  ice of each ROI.
+00018310: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00018320: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00018330: 2020 2070 6f73 203a 2066 6c6f 6174 2c20     pos : float, 
+00018340: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00018350: 2020 2020 2020 2020 2053 6c69 6365 2070           Slice p
+00018360: 6f73 6974 696f 6e20 696e 206d 6d2e 2049  osition in mm. I
+00018370: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
+00018380: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
+00018390: 7265 2073 7570 706c 6965 640a 2020 2020  re supplied.    
+000183a0: 2020 2020 2020 2020 6275 7420 3c73 696e          but <sin
+000183b0: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
+000183c0: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
+000183d0: 736c 6963 6520 6f66 2065 6163 6820 524f  slice of each RO
+000183e0: 490a 2020 2020 2020 2020 2020 2020 7769  I.            wi
+000183f0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
+00018400: 2020 2020 2075 6e69 7473 203a 2073 7472       units : str
+00018410: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
+00018420: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+00018430: 206f 6620 6162 736f 6c75 7465 2063 656e   of absolute cen
+00018440: 7472 6f69 6420 6469 7374 616e 6365 2e20  troid distance. 
+00018450: 4361 6e20 6265 2061 6e79 206f 663a 0a20  Can be any of:. 
+00018460: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00018470: 2022 6d6d 223a 2072 6574 7572 6e20 6365   "mm": return ce
+00018480: 6e74 726f 6964 2070 6f73 6974 696f 6e20  ntroid position 
+00018490: 696e 206d 696c 6c69 6d65 7472 6573 2e0a  in millimetres..
+000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184b0: 2d20 2276 6f78 656c 7322 3a20 7265 7475  - "voxels": retu
+000184c0: 726e 2063 656e 7472 6f69 6420 706f 7369  rn centroid posi
+000184d0: 7469 6f6e 2069 6e20 7465 726d 7320 6f66  tion in terms of
+000184e0: 2061 7272 6179 2069 6e64 6963 6573 2e0a   array indices..
+000184f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018500: 2d20 2273 6c69 6365 223a 2072 6574 7572  - "slice": retur
+00018510: 6e20 6365 6e74 726f 6964 2070 6f73 6974  n centroid posit
+00018520: 696f 6e20 696e 2074 6572 6d73 206f 6620  ion in terms of 
+00018530: 736c 6963 6520 6e75 6d62 6572 732e 0a0a  slice numbers...
+00018540: 2020 2020 2020 2020 2020 2020 4966 2075              If u
+00018550: 6e69 7473 3d22 766f 7865 6c73 2220 6f72  nits="voxels" or
+00018560: 2022 736c 6963 6522 2069 7320 7265 7175   "slice" is requ
+00018570: 6573 7465 6420 6275 7420 6569 7468 6572  ested but either
+00018580: 2052 4f49 206f 6e6c 7920 6861 7320 0a20   ROI only has . 
+00018590: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
+000185a0: 7572 7320 616e 6420 6e6f 206d 6173 6b20  urs and no mask 
+000185b0: 7368 6170 652f 766f 7865 6c20 7369 7a65  shape/voxel size
+000185c0: 2069 6e66 6f72 6d61 7469 6f6e 2c20 616e   information, an
+000185d0: 2065 7272 6f72 2077 696c 6c20 6265 200a   error will be .
+000185e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000185f0: 6564 2028 756e 6c65 7373 2061 783d 227a  ed (unless ax="z
+00018600: 222c 2069 6e20 7768 6963 6820 6361 7365  ", in which case
+00018610: 2076 6f78 656c 2073 697a 6520 7769 6c6c   voxel size will
+00018620: 2062 6520 696e 6665 7272 6564 200a 2020   be inferred .  
+00018630: 2020 2020 2020 2020 2020 6672 6f6d 2073            from s
+00018640: 7061 6369 6e67 2062 6574 7765 656e 2073  pacing between s
+00018650: 6c69 6365 7329 2e0a 0a20 2020 2020 2020  lices)...       
+00018660: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
+00018670: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00018680: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
+00018690: 6f20 7573 6520 666f 7220 6365 6e74 726f  o use for centro
+000186a0: 6964 2063 616c 6375 6c61 7469 6f6e 2e20  id calculation. 
+000186b0: 4361 6e20 6265 3a20 0a20 2020 2020 2020  Can be: .       
+000186c0: 2020 2020 2020 2020 202d 2022 636f 6e74           - "cont
+000186d0: 6f75 7222 3a20 6765 7420 6365 6e74 726f  our": get centro
+000186e0: 6964 206f 6620 7368 6170 656c 7920 636f  id of shapely co
+000186f0: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
+00018700: 2020 2020 2020 2020 2020 2d20 226d 6173            - "mas
+00018710: 6b22 3a20 6765 7420 6176 6572 6167 6520  k": get average 
+00018720: 706f 7369 7469 6f6e 206f 6620 766f 7865  position of voxe
+00018730: 6c73 2069 6e20 6269 6e61 7279 206d 6173  ls in binary mas
+00018740: 6b2e 0a20 2020 2020 2020 2020 2020 2020  k..             
+00018750: 2020 202d 204e 6f6e 653a 2075 7365 2074     - None: use t
+00018760: 6865 206d 6574 686f 6420 7365 7420 696e  he method set in
+00018770: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
+00018780: 6f6d 5f6d 6574 686f 642e 0a0a 2020 2020  om_method...    
+00018790: 2020 2020 666f 7263 6520 3a20 626f 6f6c      force : bool
+000187a0: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
+000187b0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+000187c0: 7565 2c20 7468 6520 676c 6f62 616c 2063  ue, the global c
+000187d0: 656e 7472 6f69 6420 7769 6c6c 2061 6c77  entroid will alw
+000187e0: 6179 7320 6265 2072 6563 616c 6375 6c61  ays be recalcula
+000187f0: 7465 643b 200a 2020 2020 2020 2020 2020  ted; .          
+00018800: 2020 6f74 6865 7277 6973 652c 2069 7420    otherwise, it 
+00018810: 7769 6c6c 206f 6e6c 7920 6265 2063 616c  will only be cal
+00018820: 6375 6c61 7465 6420 6966 2069 7420 6861  culated if it ha
+00018830: 7320 6e6f 7420 7965 7420 6265 656e 2063  s not yet been c
+00018840: 6163 6865 6420 0a20 2020 2020 2020 2020  ached .         
+00018850: 2020 2069 6e20 7365 6c66 2e5f 766f 6c75     in self._volu
+00018860: 6d65 2e20 204e 6f74 6520 7468 6174 2069  me.  Note that i
+00018870: 6620 7369 6e67 6c65 5f73 6c69 6365 3d54  f single_slice=T
+00018880: 7275 652c 2074 6865 2063 656e 7472 6f69  rue, the centroi
+00018890: 6420 7769 6c6c 200a 2020 2020 2020 2020  d will .        
+000188a0: 2020 2020 616c 7761 7973 2062 6520 7265      always be re
+000188b0: 6361 6c63 756c 6174 6564 2e0a 0a20 2020  calculated...   
+000188c0: 2020 2020 2062 795f 736c 6963 6520 3a20       by_slice : 
+000188d0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+000188e0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+000188f0: 206f 6e65 206f 6620 226c 6566 7422 2c20   one of "left", 
+00018900: 2272 6967 6874 222c 2022 756e 696f 6e22  "right", "union"
+00018910: 2c20 2269 6e74 6572 7365 6374 696f 6e22  , "intersection"
+00018920: 2c20 6361 6c63 756c 6174 650a 2020 2020  , calculate.    
+00018930: 2020 2020 2020 2020 4469 6365 2073 636f          Dice sco
+00018940: 7265 7320 736c 6963 6520 6279 2073 6c69  res slice by sli
+00018950: 6365 2066 6f72 2065 6163 6820 736c 6963  ce for each slic
+00018960: 6520 636f 6e74 6169 6e69 6e67 0a20 2020  e containing.   
+00018970: 2020 2020 2020 2020 2073 656c 6620 616e           self an
+00018980: 642f 6f72 206f 7468 6572 3a0a 0a20 2020  d/or other:..   
+00018990: 2020 2020 2020 2020 202d 2022 6c65 6674           - "left
+000189a0: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
+000189b0: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+000189c0: 6e67 2073 656c 663b 0a20 2020 2020 2020  ng self;.       
+000189d0: 2020 2020 202d 2022 7269 6768 7422 3a20       - "right": 
+000189e0: 636f 6e73 6964 6572 206f 6e6c 7920 736c  consider only sl
+000189f0: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+00018a00: 6f74 6865 723b 0a20 2020 2020 2020 2020  other;.         
+00018a10: 2020 202d 2022 756e 696f 6e22 3a20 636f     - "union": co
+00018a20: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
+00018a30: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
+00018a40: 6f66 2073 656c 6620 616e 6420 6f74 6865  of self and othe
+00018a50: 723b 0a20 2020 2020 2020 2020 2020 202d  r;.            -
+00018a60: 2022 696e 7465 7273 6563 7469 6f6e 223a   "intersection":
+00018a70: 2063 6f6e 7369 6465 7220 736c 6963 6573   consider slices
+00018a80: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
+00018a90: 206f 6620 7365 6c66 2061 6e64 206f 7468   of self and oth
+00018aa0: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
+00018ab0: 2049 6620 736c 6963 655f 7374 6174 2069   If slice_stat i
+00018ac0: 7320 4e6f 6e65 2c20 7265 7475 726e 2061  s None, return a
+00018ad0: 2064 6963 7469 6f6e 6172 7920 7768 6572   dictionary wher
+00018ae0: 6520 6b65 7973 2061 7265 0a20 2020 2020  e keys are.     
+00018af0: 2020 2020 2020 2073 6c69 6365 2070 6f73         slice pos
+00018b00: 6974 696f 6e73 2061 6e64 2076 616c 7565  itions and value
+00018b10: 7320 6172 6520 7468 6520 6361 6c63 756c  s are the calcul
+00018b20: 6174 6564 2044 6963 6520 7363 6f72 6573  ated Dice scores
+00018b30: 2e0a 2020 2020 2020 2020 2020 2020 4f74  ..            Ot
+00018b40: 6865 7277 6973 652c 2072 6574 7572 6e20  herwise, return 
+00018b50: 666f 7220 7468 6520 6361 6c63 756c 6174  for the calculat
+00018b60: 6564 2044 6963 6520 7363 6f72 6573 2074  ed Dice scores t
+00018b70: 6865 2073 7461 7469 7374 6963 0a20 2020  he statistic.   
+00018b80: 2020 2020 2020 2020 2073 7065 6369 6669           specifi
+00018b90: 6564 2062 7920 736c 6963 655f 7374 6174  ed by slice_stat
+00018ba0: 2e0a 0a20 2020 2020 2020 2076 616c 7565  ...        value
+00018bb0: 5f66 6f72 5f6e 6f6e 6520 3a20 666c 6f61  _for_none : floa
+00018bc0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00018bd0: 2020 2020 2020 2020 2020 2020 466f 7220              For 
+00018be0: 7369 6e67 6c65 5f73 6c69 6365 2061 6e64  single_slice and
+00018bf0: 2062 795f 736c 6963 652c 2076 616c 7565   by_slice, value
+00018c00: 2074 6f20 6265 2072 6574 7572 6e65 6420   to be returned 
+00018c10: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00018c20: 736c 6963 6573 2077 6865 7265 2044 6963  slices where Dic
+00018c30: 6520 7363 6f72 6520 6973 2075 6e64 6574  e score is undet
+00018c40: 6572 6d69 6e65 6420 284e 6f6e 6529 2e20  ermined (None). 
+00018c50: 2046 6f72 2073 6c69 6365 5f73 7461 742c   For slice_stat,
+00018c60: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00018c70: 7565 2074 6f20 7375 6273 7469 7475 7465  ue to substitute
+00018c80: 2066 6f72 2061 6e79 204e 6f6e 6520 7661   for any None va
+00018c90: 6c75 6573 2061 6d6f 6e67 2074 6865 2069  lues among the i
+00018ca0: 6e70 7574 730a 2020 2020 2020 2020 2020  nputs.          
+00018cb0: 2020 666f 7220 6361 6c63 756c 6174 696e    for calculatin
+00018cc0: 6720 736c 6963 652d 6261 7365 6420 7374  g slice-based st
+00018cd0: 6174 6973 7469 632e 2020 4966 204e 6f6e  atistic.  If Non
+00018ce0: 6520 696e 2074 6865 206c 6174 7465 720a  e in the latter.
+00018cf0: 2020 2020 2020 2020 2020 2020 6361 7365              case
+00018d00: 2c20 4e6f 6e65 2076 616c 7565 7320 616d  , None values am
+00018d10: 6f6e 6720 7468 6520 696e 7075 7473 2061  ong the inputs a
+00018d20: 7265 206f 6d69 7474 6564 2e0a 0a20 2020  re omitted...   
+00018d30: 2020 2020 2073 6c69 6365 5f73 7461 7420       slice_stat 
+00018d40: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+00018d50: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00018d60: 5369 6e67 6c65 2d76 6172 6961 626c 6520  Single-variable 
+00018d70: 7374 6174 6973 7469 6328 7329 2074 6f20  statistic(s) to 
+00018d80: 6265 2072 6574 7572 6e65 6420 666f 7220  be returned for 
+00018d90: 736c 6963 652d 6279 2d73 6c69 6365 0a20  slice-by-slice. 
+00018da0: 2020 2020 2020 2020 2020 2044 6963 6520             Dice 
+00018db0: 7363 6f72 6573 2e20 2054 6869 7320 7368  scores.  This sh
+00018dc0: 6f75 6c64 2062 6520 7468 6520 6e61 6d65  ould be the name
+00018dd0: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+00018de0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+00018df0: 2063 616c 6375 6c61 7469 6f6e 206f 6620   calculation of 
+00018e00: 7468 6520 7374 6174 6973 7469 6328 7329  the statistic(s)
+00018e10: 2069 6e20 7468 6520 5079 7468 6f6e 2073   in the Python s
+00018e20: 7461 7469 7374 6963 7320 6d6f 6475 6c65  tatistics module
+00018e30: 3a0a 0a20 2020 2020 2020 2020 2020 2068  :..            h
+00018e40: 7474 7073 3a2f 2f64 6f63 732e 7079 7468  ttps://docs.pyth
+00018e50: 6f6e 2e6f 7267 2f33 2f6c 6962 7261 7279  on.org/3/library
+00018e60: 2f73 7461 7469 7374 6963 732e 6874 6d6c  /statistics.html
+00018e70: 0a0a 2020 2020 2020 2020 2020 2020 4176  ..            Av
+00018e80: 6169 6c61 626c 6520 6f70 7469 6f6e 7320  ailable options 
+00018e90: 696e 636c 7564 653a 2022 6d65 616e 222c  include: "mean",
+00018ea0: 2022 6d65 6469 616e 222c 2022 6d6f 6465   "median", "mode
+00018eb0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00018ec0: 7374 6465 7622 2c20 2271 7561 6e74 696c  stdev", "quantil
+00018ed0: 6573 222e 2020 4469 7372 6567 6172 6465  es".  Disregarde
+00018ee0: 6420 6966 204e 6f6e 652e 0a0a 2020 2020  d if None...    
+00018ef0: 2020 2020 2020 2020 4966 2062 795f 736c          If by_sl
+00018f00: 6963 6520 6973 204e 6f6e 6520 616e 6420  ice is None and 
+00018f10: 736c 6963 655f 7374 6174 2069 7320 6469  slice_stat is di
+00018f20: 6666 6572 656e 7420 6672 6f6d 204e 6f6e  fferent from Non
+00018f30: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+00018f40: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
+00018f50: 7328 292e 6279 5f73 6c69 6365 2069 7320  s().by_slice is 
+00018f60: 7573 6564 2066 6f72 2074 6865 2066 6f72  used for the for
+00018f70: 6d65 722e 0a0a 2020 2020 2020 2020 736c  mer...        sl
+00018f80: 6963 655f 7374 6174 5f6b 7761 7267 7320  ice_stat_kwargs 
+00018f90: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
+00018fa0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00018fb0: 204b 6579 776f 7264 2061 7267 756d 656e   Keyword argumen
+00018fc0: 7473 2074 6f20 6265 2070 6173 7365 6420  ts to be passed 
+00018fd0: 746f 2066 756e 6374 696f 6e20 6f66 2073  to function of s
+00018fe0: 7461 7469 7374 6963 730a 2020 2020 2020  tatistics.      
+00018ff0: 2020 2020 2020 6d6f 6475 6c65 2066 6f72        module for
+00019000: 2063 616c 6375 6c61 7469 6f6e 2072 656c   calculation rel
+00019010: 6174 6976 6520 746f 2073 6c69 6365 2076  ative to slice v
+00019020: 616c 7565 732e 2020 466f 7220 6578 616d  alues.  For exam
+00019030: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
+00019040: 2069 6620 7175 616e 7469 6c65 7320 6172   if quantiles ar
+00019050: 6520 7265 7175 6972 6564 2066 6f72 2031  e required for 1
+00019060: 3020 696e 7465 7276 616c 732c 2072 6174  0 intervals, rat
+00019070: 6865 7220 7468 616e 2066 6f72 0a20 2020  her than for.   
+00019080: 2020 2020 2020 2020 2074 6865 2064 6566           the def
+00019090: 6175 6c74 206f 6620 342c 2074 6869 7320  ault of 4, this 
+000190a0: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
+000190b0: 2075 7369 6e67 3a0a 0a20 2020 2020 2020   using:..       
+000190c0: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
+000190d0: 6b77 6172 6773 7b22 6e22 203a 2031 307d  kwargs{"n" : 10}
+000190e0: 0a0a 2020 2020 2020 2020 2020 2020 466f  ..            Fo
+000190f0: 7220 6176 6169 6c61 626c 6520 6b65 7977  r available keyw
+00019100: 6f72 6420 6f70 7469 6f6e 732c 2073 6565  ord options, see
+00019110: 2064 6f63 756d 656e 7461 7469 6f6e 206f   documentation o
+00019120: 6620 7374 6174 6973 7469 6373 0a20 2020  f statistics.   
+00019130: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
+00019140: 6174 3a0a 0a20 2020 2020 2020 2020 2020  at:..           
+00019150: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
+00019160: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
+00019170: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
+00019180: 6d6c 0a20 2020 2020 2020 2022 2222 0a20  ml.        """. 
+00019190: 2020 2020 2020 2069 6620 736c 6963 655f         if slice_
+000191a0: 7374 6174 3a0a 2020 2020 2020 2020 2020  stat:.          
+000191b0: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
+000191c0: 745f 736c 6963 655f 7374 6174 2872 6f69  t_slice_stat(roi
+000191d0: 2c20 2261 6273 5f63 656e 7472 6f69 6422  , "abs_centroid"
+000191e0: 2c20 736c 6963 655f 7374 6174 2c0a 2020  , slice_stat,.  
+000191f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019200: 2020 6279 5f73 6c69 6365 2c20 7661 6c75    by_slice, valu
+00019210: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
+00019220: 2c20 6d65 7468 6f64 2c0a 2020 2020 2020  , method,.      
+00019230: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+00019240: 2873 6c69 6365 5f73 7461 745f 6b77 6172  (slice_stat_kwar
+00019250: 6773 206f 7220 7b7d 2929 0a0a 2020 2020  gs or {}))..    
+00019260: 2020 2020 6966 2062 795f 736c 6963 653a      if by_slice:
+00019270: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00019280: 7572 6e20 7365 6c66 2e67 6574 5f6d 6574  urn self.get_met
+00019290: 7269 635f 6279 5f73 6c69 6365 2872 6f69  ric_by_slice(roi
+000192a0: 2c20 2261 6273 5f63 656e 7472 6f69 6422  , "abs_centroid"
+000192b0: 2c20 6279 5f73 6c69 6365 2c0a 2020 2020  , by_slice,.    
+000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192d0: 7669 6577 2c20 6d65 7468 6f64 290a 0a20  view, method).. 
+000192e0: 2020 2020 2020 2023 2049 6620 666c 6174         # If flat
+000192f0: 7465 6e69 6e67 2c20 6e65 6564 2074 6f20  tening, need to 
+00019300: 6765 7420 3344 2063 656e 7472 6f69 6420  get 3D centroid 
+00019310: 7665 6374 6f72 0a20 2020 2020 2020 2069  vector.        i
+00019320: 6620 666c 6174 7465 6e3a 0a20 2020 2020  f flatten:.     
+00019330: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
+00019340: 6963 6520 3d20 4661 6c73 650a 0a20 2020  ice = False..   
+00019350: 2020 2020 2023 2047 6574 2063 656e 7472       # Get centr
+00019360: 6f69 6420 7665 6374 6f72 0a20 2020 2020  oid vector.     
+00019370: 2020 2063 656e 7472 6f69 6420 3d20 7365     centroid = se
+00019380: 6c66 2e67 6574 5f63 656e 7472 6f69 645f  lf.get_centroid_
+00019390: 6469 7374 616e 6365 280a 2020 2020 2020  distance(.      
+000193a0: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
+000193b0: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
+000193c0: 772c 200a 2020 2020 2020 2020 2020 2020  w, .            
+000193d0: 7369 6e67 6c65 5f73 6c69 6365 3d73 696e  single_slice=sin
+000193e0: 676c 655f 736c 6963 652c 0a20 2020 2020  gle_slice,.     
+000193f0: 2020 2020 2020 2073 6c3d 736c 2c0a 2020         sl=sl,.  
+00019400: 2020 2020 2020 2020 2020 6964 783d 6964            idx=id
+00019410: 782c 0a20 2020 2020 2020 2020 2020 2070  x,.            p
+00019420: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
+00019430: 2020 2020 756e 6974 733d 756e 6974 732c      units=units,
+00019440: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+00019450: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
+00019460: 2020 2020 2020 2020 666f 7263 653d 666f          force=fo
+00019470: 7263 652c 0a20 2020 2020 2020 2029 0a0a  rce,.        )..
+00019480: 2020 2020 2020 2020 2320 4966 2063 656e          # If cen
+00019490: 7472 6f69 6420 7761 736e 2774 2061 7661  troid wasn't ava
+000194a0: 696c 6162 6c65 2c20 7265 7475 726e 204e  ilable, return N
+000194b0: 6f6e 650a 2020 2020 2020 2020 6966 204e  one.        if N
+000194c0: 6f6e 6520 696e 2063 656e 7472 6f69 643a  one in centroid:
+000194d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000194e0: 7572 6e20 7661 6c75 655f 666f 725f 6e6f  urn value_for_no
+000194f0: 6e65 0a0a 2020 2020 2020 2020 2320 4966  ne..        # If
+00019500: 2066 6c61 7474 656e 696e 672c 2074 616b   flattening, tak
+00019510: 6520 3220 6178 6573 206f 6e6c 790a 2020  e 2 axes only.  
+00019520: 2020 2020 2020 6966 2066 6c61 7474 656e        if flatten
+00019530: 3a0a 2020 2020 2020 2020 2020 2020 785f  :.            x_
+00019540: 6178 2c20 795f 6178 203d 2073 6b72 742e  ax, y_ax = skrt.
+00019550: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
+00019560: 5b76 6965 775d 0a20 2020 2020 2020 2020  [view].         
+00019570: 2020 2063 656e 7472 6f69 6420 3d20 6e70     centroid = np
+00019580: 2e61 7272 6179 285b 6365 6e74 726f 6964  .array([centroid
+00019590: 5b78 5f61 785d 2c20 6365 6e74 726f 6964  [x_ax], centroid
+000195a0: 5b79 5f61 785d 5d29 0a0a 2020 2020 2020  [y_ax]])..      
+000195b0: 2020 2320 5265 7475 726e 206d 6167 6e69    # Return magni
+000195c0: 7475 6465 206f 6620 7665 6374 6f72 0a20  tude of vector. 
+000195d0: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
+000195e0: 2e6c 696e 616c 672e 6e6f 726d 2863 656e  .linalg.norm(cen
+000195f0: 7472 6f69 6429 0a0a 2020 2020 6465 6620  troid)..    def 
+00019600: 6765 745f 6469 6365 280a 2020 2020 2020  get_dice(.      
+00019610: 2020 7365 6c66 2c20 0a20 2020 2020 2020    self, .       
+00019620: 206f 7468 6572 2c20 0a20 2020 2020 2020   other, .       
+00019630: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
+00019640: 6c73 652c 0a20 2020 2020 2020 2076 6965  lse,.        vie
+00019650: 773d 2278 2d79 222c 200a 2020 2020 2020  w="x-y", .      
+00019660: 2020 736c 3d4e 6f6e 652c 200a 2020 2020    sl=None, .    
+00019670: 2020 2020 6964 783d 4e6f 6e65 2c20 0a20      idx=None, . 
+00019680: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
+00019690: 200a 2020 2020 2020 2020 6d65 7468 6f64   .        method
+000196a0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
+000196b0: 6c61 7474 656e 3d46 616c 7365 2c0a 2020  latten=False,.  
+000196c0: 2020 2020 2020 6279 5f73 6c69 6365 3d4e        by_slice=N
+000196d0: 6f6e 652c 0a20 2020 2020 2020 2076 616c  one,.        val
+000196e0: 7565 5f66 6f72 5f6e 6f6e 653d 4e6f 6e65  ue_for_none=None
+000196f0: 2c0a 2020 2020 2020 2020 736c 6963 655f  ,.        slice_
+00019700: 7374 6174 3d4e 6f6e 652c 0a20 2020 2020  stat=None,.     
+00019710: 2020 2073 6c69 6365 5f73 7461 745f 6b77     slice_stat_kw
+00019720: 6172 6773 3d4e 6f6e 652c 0a20 2020 2029  args=None,.    )
+00019730: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00019740: 2020 2020 2020 4765 7420 4469 6365 2073        Get Dice s
+00019750: 636f 7265 2077 6974 6820 7265 7370 6563  core with respec
+00019760: 7420 746f 2061 6e6f 7468 6572 2052 4f49  t to another ROI
+00019770: 2c0a 2020 2020 2020 2020 676c 6f62 616c  ,.        global
+00019780: 6c79 2c20 6f6e 2061 2073 696e 676c 6520  ly, on a single 
+00019790: 736c 6963 652c 2073 6c69 6365 2062 7920  slice, slice by 
+000197a0: 736c 6963 652c 206f 7220 736c 6963 6520  slice, or slice 
+000197b0: 6176 6572 6167 6564 2e0a 0a20 2020 2020  averaged...     
+000197c0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+000197d0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+000197e0: 2020 2020 6f74 6865 7220 3a20 524f 490a      other : ROI.
+000197f0: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
+00019800: 7220 524f 4920 746f 2063 6f6d 7061 7265  r ROI to compare
+00019810: 2077 6974 6820 7468 6973 2052 4f49 2e0a   with this ROI..
+00019820: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
+00019830: 736c 6963 6520 3a20 626f 6f6c 2c20 6465  slice : bool, de
+00019840: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00019850: 2020 2020 2020 2020 4966 2046 616c 7365          If False
+00019860: 2c20 7468 6520 676c 6f62 616c 2033 4420  , the global 3D 
+00019870: 4469 6365 2073 636f 7265 206f 6620 7468  Dice score of th
+00019880: 6520 6675 6c6c 2052 4f49 7320 7769 6c6c  e full ROIs will
+00019890: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
+000198a0: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
+000198b0: 6973 652c 2074 6865 2032 4420 4469 6365  ise, the 2D Dice
+000198c0: 2073 636f 7265 206f 6e20 6120 7369 6e67   score on a sing
+000198d0: 6c65 2073 6c69 6365 2077 696c 6c20 6265  le slice will be
+000198e0: 2072 6574 7572 6e65 642e 0a0a 2020 2020   returned...    
+000198f0: 2020 2020 7669 6577 203a 2073 7472 2c20      view : str, 
+00019900: 6465 6661 756c 743d 2278 2d79 220a 2020  default="x-y".  
+00019910: 2020 2020 2020 2020 2020 4f72 6965 6e74            Orient
+00019920: 6174 696f 6e20 6f66 2073 6c69 6365 206f  ation of slice o
+00019930: 6e20 7768 6963 6820 746f 2067 6574 2044  n which to get D
+00019940: 6963 6520 7363 6f72 652e 204f 6e6c 7920  ice score. Only 
+00019950: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
+00019960: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+00019970: 653d 5472 7565 2e20 4966 2075 7369 6e67  e=True. If using
+00019980: 2c20 3c61 783e 206d 7573 7420 6265 2061  , <ax> must be a
+00019990: 6e20 6178 6973 2074 6861 7420 6c69 6573  n axis that lies
+000199a0: 2061 6c6f 6e67 0a20 2020 2020 2020 2020   along.         
+000199b0: 2020 2074 6865 2073 6c69 6365 2069 6e20     the slice in 
+000199c0: 7468 6973 206f 7269 656e 7461 7469 6f6e  this orientation
+000199d0: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
+000199e0: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+000199f0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+00019a00: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
+00019a10: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+00019a20: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
+00019a30: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
+00019a40: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
+00019a50: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
+00019a60: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+00019a70: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
+00019a80: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
+00019a90: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
+00019aa0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00019ab0: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
+00019ac0: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
+00019ad0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+00019ae0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+00019af0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+00019b00: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+00019b10: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+00019b20: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+00019b30: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
+00019b40: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+00019b50: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+00019b60: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00019b70: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00019b80: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+00019b90: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+00019ba0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+00019bb0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+00019bc0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
+00019bd0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
+00019be0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+00019bf0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00019c00: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
+00019c10: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00019c20: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
+00019c30: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00019c40: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
+00019c50: 2075 7365 2066 6f72 2044 6963 6520 7363   use for Dice sc
+00019c60: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
+00019c70: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
+00019c80: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
+00019c90: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
+00019ca0: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
+00019cb0: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
+00019cc0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+00019cd0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+00019ce0: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
+00019cf0: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
+00019d00: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
+00019d10: 2020 2020 2020 2020 2020 2020 202d 204e               - N
+00019d20: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
+00019d30: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
+00019d40: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+00019d50: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
+00019d60: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+00019d70: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00019d80: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00019d90: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
+00019da0: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
+00019db0: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
+00019dc0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
+00019dd0: 2020 2020 2020 2074 6865 2044 6963 6520         the Dice 
+00019de0: 7363 6f72 6520 6f66 2074 6865 2066 6c61  score of the fla
+00019df0: 7474 656e 6564 2073 6c69 6365 7320 7769  ttened slices wi
+00019e00: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
+00019e10: 4f6e 6c79 200a 2020 2020 2020 2020 2020  Only .          
+00019e20: 2020 6176 6169 6c61 626c 6520 6966 206d    available if m
+00019e30: 6574 686f 643d 226d 6173 6b22 2e0a 0a20  ethod="mask"... 
+00019e40: 2020 2020 2020 2062 795f 736c 6963 6520         by_slice 
+00019e50: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+00019e60: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00019e70: 4966 206f 6e65 206f 6620 226c 6566 7422  If one of "left"
+00019e80: 2c20 2272 6967 6874 222c 2022 756e 696f  , "right", "unio
+00019e90: 6e22 2c20 2269 6e74 6572 7365 6374 696f  n", "intersectio
+00019ea0: 6e22 2c20 6361 6c63 756c 6174 650a 2020  n", calculate.  
+00019eb0: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
+00019ec0: 636f 7265 7320 736c 6963 6520 6279 2073  cores slice by s
+00019ed0: 6c69 6365 2066 6f72 2065 6163 6820 736c  lice for each sl
+00019ee0: 6963 6520 636f 6e74 6169 6e69 6e67 0a20  ice containing. 
+00019ef0: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+00019f00: 616e 642f 6f72 206f 7468 6572 3a0a 0a20  and/or other:.. 
+00019f10: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
+00019f20: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
+00019f30: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+00019f40: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
+00019f50: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
+00019f60: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
+00019f70: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
+00019f80: 6720 6f74 6865 723b 0a20 2020 2020 2020  g other;.       
+00019f90: 2020 2020 202d 2022 756e 696f 6e22 3a20       - "union": 
+00019fa0: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
+00019fb0: 636f 6e74 6169 6e69 6e67 2065 6974 6865  containing eithe
+00019fc0: 7220 6f66 2073 656c 6620 616e 6420 6f74  r of self and ot
+00019fd0: 6865 723b 0a20 2020 2020 2020 2020 2020  her;.           
+00019fe0: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
+00019ff0: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
+0001a000: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+0001a010: 7468 206f 6620 7365 6c66 2061 6e64 206f  th of self and o
+0001a020: 7468 6572 2e0a 0a20 2020 2020 2020 2020  ther...         
+0001a030: 2020 2049 6620 736c 6963 655f 7374 6174     If slice_stat
+0001a040: 2069 7320 4e6f 6e65 2c20 7265 7475 726e   is None, return
+0001a050: 2061 2064 6963 7469 6f6e 6172 7920 7768   a dictionary wh
+0001a060: 6572 6520 6b65 7973 2061 7265 0a20 2020  ere keys are.   
+0001a070: 2020 2020 2020 2020 2073 6c69 6365 2070           slice p
+0001a080: 6f73 6974 696f 6e73 2061 6e64 2076 616c  ositions and val
+0001a090: 7565 7320 6172 6520 7468 6520 6361 6c63  ues are the calc
+0001a0a0: 756c 6174 6564 2044 6963 6520 7363 6f72  ulated Dice scor
+0001a0b0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+0001a0c0: 4f74 6865 7277 6973 652c 2072 6574 7572  Otherwise, retur
+0001a0d0: 6e20 666f 7220 7468 6520 6361 6c63 756c  n for the calcul
+0001a0e0: 6174 6564 2044 6963 6520 7363 6f72 6573  ated Dice scores
+0001a0f0: 2074 6865 2073 7461 7469 7374 6963 0a20   the statistic. 
+0001a100: 2020 2020 2020 2020 2020 2073 7065 6369             speci
+0001a110: 6669 6564 2062 7920 736c 6963 655f 7374  fied by slice_st
+0001a120: 6174 2e0a 0a20 2020 2020 2020 2076 616c  at...        val
+0001a130: 7565 5f66 6f72 5f6e 6f6e 6520 3a20 666c  ue_for_none : fl
+0001a140: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+0001a150: 650a 2020 2020 2020 2020 2020 2020 466f  e.            Fo
+0001a160: 7220 7369 6e67 6c65 5f73 6c69 6365 2061  r single_slice a
+0001a170: 6e64 2062 795f 736c 6963 652c 2076 616c  nd by_slice, val
+0001a180: 7565 2074 6f20 6265 2072 6574 7572 6e65  ue to be returne
+0001a190: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
+0001a1a0: 2020 736c 6963 6573 2077 6865 7265 2044    slices where D
+0001a1b0: 6963 6520 7363 6f72 6520 6973 2075 6e64  ice score is und
+0001a1c0: 6574 6572 6d69 6e65 6420 284e 6f6e 6529  etermined (None)
+0001a1d0: 2e20 2046 6f72 2073 6c69 6365 5f73 7461  .  For slice_sta
+0001a1e0: 742c 0a20 2020 2020 2020 2020 2020 2076  t,.            v
+0001a1f0: 616c 7565 2074 6f20 7375 6273 7469 7475  alue to substitu
+0001a200: 7465 2066 6f72 2061 6e79 204e 6f6e 6520  te for any None 
+0001a210: 7661 6c75 6573 2061 6d6f 6e67 2074 6865  values among the
+0001a220: 2069 6e70 7574 730a 2020 2020 2020 2020   inputs.        
+0001a230: 2020 2020 666f 7220 6361 6c63 756c 6174      for calculat
+0001a240: 696e 6720 736c 6963 652d 6261 7365 6420  ing slice-based 
+0001a250: 7374 6174 6973 7469 632e 2020 4966 204e  statistic.  If N
+0001a260: 6f6e 6520 696e 2074 6865 206c 6174 7465  one in the latte
+0001a270: 720a 2020 2020 2020 2020 2020 2020 6361  r.            ca
+0001a280: 7365 2c20 4e6f 6e65 2076 616c 7565 7320  se, None values 
+0001a290: 616d 6f6e 6720 7468 6520 696e 7075 7473  among the inputs
+0001a2a0: 2061 7265 206f 6d69 7474 6564 2e0a 0a20   are omitted... 
+0001a2b0: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+0001a2c0: 7420 3a20 7374 722c 2064 6566 6175 6c74  t : str, default
+0001a2d0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001a2e0: 2020 5369 6e67 6c65 2d76 6172 6961 626c    Single-variabl
+0001a2f0: 6520 7374 6174 6973 7469 6328 7329 2074  e statistic(s) t
+0001a300: 6f20 6265 2072 6574 7572 6e65 6420 666f  o be returned fo
+0001a310: 7220 736c 6963 652d 6279 2d73 6c69 6365  r slice-by-slice
+0001a320: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
+0001a330: 6520 7363 6f72 6573 2e20 2054 6869 7320  e scores.  This 
+0001a340: 7368 6f75 6c64 2062 6520 7468 6520 6e61  should be the na
+0001a350: 6d65 206f 6620 7468 6520 6675 6e63 7469  me of the functi
+0001a360: 6f6e 2066 6f72 0a20 2020 2020 2020 2020  on for.         
+0001a370: 2020 2063 616c 6375 6c61 7469 6f6e 206f     calculation o
+0001a380: 6620 7468 6520 7374 6174 6973 7469 6328  f the statistic(
+0001a390: 7329 2069 6e20 7468 6520 5079 7468 6f6e  s) in the Python
+0001a3a0: 2073 7461 7469 7374 6963 7320 6d6f 6475   statistics modu
+0001a3b0: 6c65 3a0a 0a20 2020 2020 2020 2020 2020  le:..           
+0001a3c0: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
+0001a3d0: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
+0001a3e0: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
+0001a3f0: 6d6c 0a0a 2020 2020 2020 2020 2020 2020  ml..            
+0001a400: 4176 6169 6c61 626c 6520 6f70 7469 6f6e  Available option
+0001a410: 7320 696e 636c 7564 653a 2022 6d65 616e  s include: "mean
+0001a420: 222c 2022 6d65 6469 616e 222c 2022 6d6f  ", "median", "mo
+0001a430: 6465 222c 0a20 2020 2020 2020 2020 2020  de",.           
+0001a440: 2022 7374 6465 7622 2c20 2271 7561 6e74   "stdev", "quant
+0001a450: 696c 6573 222e 2020 4469 7372 6567 6172  iles".  Disregar
+0001a460: 6465 6420 6966 204e 6f6e 652e 0a0a 2020  ded if None...  
+0001a470: 2020 2020 2020 2020 2020 4966 2062 795f            If by_
+0001a480: 736c 6963 6520 6973 204e 6f6e 6520 616e  slice is None an
+0001a490: 6420 736c 6963 655f 7374 6174 2069 7320  d slice_stat is 
+0001a4a0: 6469 6666 6572 656e 7420 6672 6f6d 204e  different from N
+0001a4b0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0001a4c0: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
+0001a4d0: 6c74 7328 292e 6279 5f73 6c69 6365 2069  lts().by_slice i
+0001a4e0: 7320 7573 6564 2066 6f72 2074 6865 2066  s used for the f
+0001a4f0: 6f72 6d65 722e 0a0a 2020 2020 2020 2020  ormer...        
+0001a500: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
+0001a510: 7320 3a20 6469 6374 2c20 6465 6661 756c  s : dict, defaul
+0001a520: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0001a530: 2020 204b 6579 776f 7264 2061 7267 756d     Keyword argum
+0001a540: 656e 7473 2074 6f20 6265 2070 6173 7365  ents to be passe
+0001a550: 6420 746f 2066 756e 6374 696f 6e20 6f66  d to function of
+0001a560: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
+0001a570: 2020 2020 2020 2020 6d6f 6475 6c65 2066          module f
+0001a580: 6f72 2063 616c 6375 6c61 7469 6f6e 2072  or calculation r
+0001a590: 656c 6174 6976 6520 746f 2073 6c69 6365  elative to slice
+0001a5a0: 2076 616c 7565 732e 2020 466f 7220 6578   values.  For ex
+0001a5b0: 616d 706c 652c 0a20 2020 2020 2020 2020  ample,.         
+0001a5c0: 2020 2069 6620 7175 616e 7469 6c65 7320     if quantiles 
+0001a5d0: 6172 6520 7265 7175 6972 6564 2066 6f72  are required for
+0001a5e0: 2031 3020 696e 7465 7276 616c 732c 2072   10 intervals, r
+0001a5f0: 6174 6865 7220 7468 616e 2066 6f72 0a20  ather than for. 
+0001a600: 2020 2020 2020 2020 2020 2074 6865 2064             the d
+0001a610: 6566 6175 6c74 206f 6620 342c 2074 6869  efault of 4, thi
+0001a620: 7320 6361 6e20 6265 2073 7065 6369 6669  s can be specifi
+0001a630: 6564 2075 7369 6e67 3a0a 0a20 2020 2020  ed using:..     
+0001a640: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+0001a650: 745f 6b77 6172 6773 7b22 6e22 203a 2031  t_kwargs{"n" : 1
+0001a660: 307d 0a0a 2020 2020 2020 2020 2020 2020  0}..            
+0001a670: 466f 7220 6176 6169 6c61 626c 6520 6b65  For available ke
+0001a680: 7977 6f72 6420 6f70 7469 6f6e 732c 2073  yword options, s
+0001a690: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
+0001a6a0: 206f 6620 7374 6174 6973 7469 6373 0a20   of statistics. 
+0001a6b0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+0001a6c0: 6520 6174 3a0a 0a20 2020 2020 2020 2020  e at:..         
+0001a6d0: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
+0001a6e0: 7079 7468 6f6e 2e6f 7267 2f33 2f6c 6962  python.org/3/lib
+0001a6f0: 7261 7279 2f73 7461 7469 7374 6963 732e  rary/statistics.
+0001a700: 6874 6d6c 0a20 2020 2020 2020 2022 2222  html.        """
+0001a710: 0a20 2020 2020 2020 2069 6620 736c 6963  .        if slic
+0001a720: 655f 7374 6174 3a0a 2020 2020 2020 2020  e_stat:.        
+0001a730: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001a740: 6765 745f 736c 6963 655f 7374 6174 286f  get_slice_stat(o
+0001a750: 7468 6572 2c20 2264 6963 6522 2c20 736c  ther, "dice", sl
+0001a760: 6963 655f 7374 6174 2c20 6279 5f73 6c69  ice_stat, by_sli
+0001a770: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+0001a780: 2020 2020 2020 2020 7661 6c75 655f 666f          value_fo
+0001a790: 725f 6e6f 6e65 2c20 7669 6577 2c20 6d65  r_none, view, me
+0001a7a0: 7468 6f64 2c20 2a2a 2873 6c69 6365 5f73  thod, **(slice_s
+0001a7b0: 7461 745f 6b77 6172 6773 206f 7220 7b7d  tat_kwargs or {}
+0001a7c0: 2929 0a0a 2020 2020 2020 2020 6966 2062  ))..        if b
+0001a7d0: 795f 736c 6963 653a 0a20 2020 2020 2020  y_slice:.       
+0001a7e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001a7f0: 2e67 6574 5f6d 6574 7269 635f 6279 5f73  .get_metric_by_s
+0001a800: 6c69 6365 286f 7468 6572 2c20 2264 6963  lice(other, "dic
+0001a810: 6522 2c20 6279 5f73 6c69 6365 2c0a 2020  e", by_slice,.  
+0001a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a830: 2020 7669 6577 2c20 6d65 7468 6f64 290a    view, method).
+0001a840: 0a20 2020 2020 2020 2069 6e74 6572 7365  .        interse
+0001a850: 6374 696f 6e2c 2075 6e69 6f6e 2c20 6d65  ction, union, me
+0001a860: 616e 5f73 697a 6520 3d20 7365 6c66 2e67  an_size = self.g
+0001a870: 6574 5f69 6e74 6572 7365 6374 696f 6e5f  et_intersection_
+0001a880: 756e 696f 6e5f 7369 7a65 280a 2020 2020  union_size(.    
+0001a890: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+0001a8a0: 722c 2073 696e 676c 655f 736c 6963 652c  r, single_slice,
+0001a8b0: 2076 6965 772c 2073 6c2c 2069 6478 2c20   view, sl, idx, 
+0001a8c0: 706f 732c 206d 6574 686f 642c 2066 6c61  pos, method, fla
+0001a8d0: 7474 656e 290a 0a20 2020 2020 2020 2072  tten)..        r
+0001a8e0: 6574 7572 6e20 2869 6e74 6572 7365 6374  eturn (intersect
+0001a8f0: 696f 6e20 2f20 6d65 616e 5f73 697a 6520  ion / mean_size 
+0001a900: 6966 206d 6561 6e5f 7369 7a65 2065 6c73  if mean_size els
+0001a910: 6520 7661 6c75 655f 666f 725f 6e6f 6e65  e value_for_none
+0001a920: 290a 0a20 2020 2064 6566 2067 6574 5f6a  )..    def get_j
+0001a930: 6163 6361 7264 280a 2020 2020 2020 2020  accard(.        
+0001a940: 7365 6c66 2c20 0a20 2020 2020 2020 206f  self, .        o
+0001a950: 7468 6572 2c20 0a20 2020 2020 2020 2073  ther, .        s
+0001a960: 696e 676c 655f 736c 6963 653d 4661 6c73  ingle_slice=Fals
+0001a970: 652c 0a20 2020 2020 2020 2076 6965 773d  e,.        view=
+0001a980: 2278 2d79 222c 200a 2020 2020 2020 2020  "x-y", .        
+0001a990: 736c 3d4e 6f6e 652c 200a 2020 2020 2020  sl=None, .      
+0001a9a0: 2020 6964 783d 4e6f 6e65 2c20 0a20 2020    idx=None, .   
+0001a9b0: 2020 2020 2070 6f73 3d4e 6f6e 652c 200a       pos=None, .
+0001a9c0: 2020 2020 2020 2020 6d65 7468 6f64 3d4e          method=N
+0001a9d0: 6f6e 652c 0a20 2020 2020 2020 2066 6c61  one,.        fla
+0001a9e0: 7474 656e 3d46 616c 7365 2c0a 2020 2020  tten=False,.    
+0001a9f0: 2020 2020 6279 5f73 6c69 6365 3d4e 6f6e      by_slice=Non
+0001aa00: 652c 0a20 2020 2020 2020 2076 616c 7565  e,.        value
+0001aa10: 5f66 6f72 5f6e 6f6e 653d 4e6f 6e65 2c0a  _for_none=None,.
+0001aa20: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+0001aa30: 6174 3d4e 6f6e 652c 0a20 2020 2020 2020  at=None,.       
+0001aa40: 2073 6c69 6365 5f73 7461 745f 6b77 6172   slice_stat_kwar
+0001aa50: 6773 3d4e 6f6e 652c 0a20 2020 2029 3a0a  gs=None,.    ):.
+0001aa60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001aa70: 2020 2020 4765 7420 4a61 6363 6172 6420      Get Jaccard 
+0001aa80: 696e 6465 7820 7769 7468 2072 6573 7065  index with respe
+0001aa90: 6374 2074 6f20 616e 6f74 6865 7220 524f  ct to another RO
+0001aaa0: 492e 0a0a 2020 2020 2020 2020 5468 6520  I...        The 
+0001aab0: 4a61 6363 6172 6420 696e 6465 7820 6d61  Jaccard index ma
+0001aac0: 7920 6265 206f 6274 6169 6e65 6420 6569  y be obtained ei
+0001aad0: 7468 6572 2067 6c6f 6261 6c6c 7920 6f72  ther globally or
+0001aae0: 206f 6e20 6120 0a20 2020 2020 2020 2073   on a .        s
+0001aaf0: 696e 676c 6520 736c 6963 652e 0a0a 2020  ingle slice...  
+0001ab00: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0001ab10: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
+0001ab20: 2020 2020 2020 206f 7468 6572 203a 2052         other : R
+0001ab30: 4f49 0a20 2020 2020 2020 2020 2020 204f  OI.            O
+0001ab40: 7468 6572 2052 4f49 2074 6f20 636f 6d70  ther ROI to comp
+0001ab50: 6172 6520 7769 7468 2074 6869 7320 524f  are with this RO
+0001ab60: 492e 0a0a 2020 2020 2020 2020 7369 6e67  I...        sing
+0001ab70: 6c65 5f73 6c69 6365 203a 2062 6f6f 6c2c  le_slice : bool,
+0001ab80: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+0001ab90: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
+0001aba0: 6c73 652c 2074 6865 2067 6c6f 6261 6c20  lse, the global 
+0001abb0: 3344 204a 6163 6361 7264 2069 6e64 6578  3D Jaccard index
+0001abc0: 206f 6620 7468 6520 6675 6c6c 2052 4f49   of the full ROI
+0001abd0: 7320 7769 6c6c 2062 650a 2020 2020 2020  s will be.      
+0001abe0: 2020 2020 2020 7265 7475 726e 6564 3b20        returned; 
+0001abf0: 6f74 6865 7277 6973 652c 2074 6865 2032  otherwise, the 2
+0001ac00: 4420 4a61 6363 6172 6420 696e 6465 7820  D Jaccard index 
+0001ac10: 6f6e 2061 2073 696e 676c 6520 736c 6963  on a single slic
+0001ac20: 650a 2020 2020 2020 2020 2020 2020 7769  e.            wi
+0001ac30: 6c6c 2062 6520 7265 7475 726e 6564 2e0a  ll be returned..
+0001ac40: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+0001ac50: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+0001ac60: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+0001ac70: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
+0001ac80: 6963 6520 6f6e 2077 6869 6368 2074 6f20  ice on which to 
+0001ac90: 6765 7420 4a61 6363 6172 6420 696e 6465  get Jaccard inde
+0001aca0: 782e 204f 6e6c 7920 7573 6564 2069 6620  x. Only used if 
+0001acb0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+0001acc0: 676c 655f 736c 6963 653d 5472 7565 2e20  gle_slice=True. 
+0001acd0: 4966 2075 7369 6e67 2c20 3c61 783e 206d  If using, <ax> m
+0001ace0: 7573 7420 6265 2061 6e20 6178 6973 2074  ust be an axis t
+0001acf0: 6861 7420 6c69 6573 2061 6c6f 6e67 0a20  hat lies along. 
+0001ad00: 2020 2020 2020 2020 2020 2074 6865 2073             the s
+0001ad10: 6c69 6365 2069 6e20 7468 6973 206f 7269  lice in this ori
+0001ad20: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+0001ad30: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
+0001ad40: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001ad50: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
+0001ad60: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
+0001ad70: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+0001ad80: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+0001ad90: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
+0001ada0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+0001adb0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+0001adc0: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
+0001add0: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
+0001ade0: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
+0001adf0: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
+0001ae00: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001ae10: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
+0001ae20: 2073 6c69 6365 2e20 4966 206e 6f6e 6520   slice. If none 
+0001ae30: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0001ae40: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0001ae50: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0001ae60: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0001ae70: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0001ae80: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0001ae90: 6620 7468 6973 2052 4f49 2077 696c 6c20  f this ROI will 
+0001aea0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+0001aeb0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
+0001aec0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001aed0: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
+0001aee0: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
+0001aef0: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+0001af00: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+0001af10: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+0001af20: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+0001af30: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+0001af40: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+0001af50: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
+0001af60: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+0001af70: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+0001af80: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+0001af90: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+0001afa0: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+0001afb0: 2044 6963 6520 7363 6f72 6520 6361 6c63   Dice score calc
+0001afc0: 756c 6174 696f 6e2e 2043 616e 2062 653a  ulation. Can be:
+0001afd0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0001afe0: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
+0001aff0: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
+0001b000: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
+0001b010: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
+0001b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b030: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
+0001b040: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
+0001b050: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
+0001b060: 736b 732e 0a20 2020 2020 2020 2020 2020  sks..           
+0001b070: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
+0001b080: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
+0001b090: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
+0001b0a0: 6765 6f6d 5f6d 6574 686f 642e 0a0a 2020  geom_method...  
+0001b0b0: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
+0001b0c0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+0001b0d0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0001b0e0: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
+0001b0f0: 6365 7320 7769 6c6c 2062 6520 666c 6174  ces will be flat
+0001b100: 7465 6e65 6420 696e 2074 6865 2067 6976  tened in the giv
+0001b110: 656e 206f 7269 656e 7461 7469 6f6e 2061  en orientation a
+0001b120: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
+0001b130: 6865 2044 6963 6520 7363 6f72 6520 6f66  he Dice score of
+0001b140: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
+0001b150: 6c69 6365 7320 7769 6c6c 2062 6520 7265  lices will be re
+0001b160: 7475 726e 6564 2e20 4f6e 6c79 200a 2020  turned. Only .  
+0001b170: 2020 2020 2020 2020 2020 6176 6169 6c61            availa
+0001b180: 626c 6520 6966 206d 6574 686f 643d 226d  ble if method="m
+0001b190: 6173 6b22 2e0a 0a20 2020 2020 2020 2062  ask"...        b
+0001b1a0: 795f 736c 6963 6520 3a20 7374 722c 2064  y_slice : str, d
+0001b1b0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001b1c0: 2020 2020 2020 2020 4966 206f 6e65 206f          If one o
+0001b1d0: 6620 226c 6566 7422 2c20 2272 6967 6874  f "left", "right
+0001b1e0: 222c 2022 756e 696f 6e22 2c20 2269 6e74  ", "union", "int
+0001b1f0: 6572 7365 6374 696f 6e22 2c20 6361 6c63  ersection", calc
+0001b200: 756c 6174 650a 2020 2020 2020 2020 2020  ulate.          
+0001b210: 2020 4469 6365 2073 636f 7265 7320 736c    Dice scores sl
+0001b220: 6963 6520 6279 2073 6c69 6365 2066 6f72  ice by slice for
+0001b230: 2065 6163 6820 736c 6963 6520 636f 6e74   each slice cont
+0001b240: 6169 6e69 6e67 0a20 2020 2020 2020 2020  aining.         
+0001b250: 2020 2073 656c 6620 616e 642f 6f72 206f     self and/or o
+0001b260: 7468 6572 3a0a 0a20 2020 2020 2020 2020  ther:..         
+0001b270: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+0001b280: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+0001b290: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+0001b2a0: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+0001b2b0: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
+0001b2c0: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+0001b2d0: 6f6e 7461 696e 696e 6720 6f74 6865 723b  ontaining other;
+0001b2e0: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+0001b2f0: 756e 696f 6e22 3a20 636f 6e73 6964 6572  union": consider
+0001b300: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+0001b310: 6e67 2065 6974 6865 7220 6f66 2073 656c  ng either of sel
+0001b320: 6620 616e 6420 6f74 6865 723b 0a20 2020  f and other;.   
+0001b330: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
+0001b340: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
+0001b350: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
+0001b360: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
+0001b370: 6c66 2061 6e64 206f 7468 6572 2e0a 0a20  lf and other... 
+0001b380: 2020 2020 2020 2020 2020 2049 6620 736c             If sl
+0001b390: 6963 655f 7374 6174 2069 7320 4e6f 6e65  ice_stat is None
+0001b3a0: 2c20 7265 7475 726e 2061 2064 6963 7469  , return a dicti
+0001b3b0: 6f6e 6172 7920 7768 6572 6520 6b65 7973  onary where keys
+0001b3c0: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
+0001b3d0: 2073 6c69 6365 2070 6f73 6974 696f 6e73   slice positions
+0001b3e0: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
+0001b3f0: 7468 6520 6361 6c63 756c 6174 6564 204a  the calculated J
+0001b400: 6163 6361 7264 2069 6e64 6963 6573 2e0a  accard indices..
+0001b410: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
+0001b420: 7277 6973 652c 2072 6574 7572 6e20 666f  rwise, return fo
+0001b430: 7220 7468 6520 6361 6c63 756c 6174 6564  r the calculated
+0001b440: 204a 6163 6361 7264 2069 6e64 6963 6573   Jaccard indices
+0001b450: 2074 6865 2073 7461 7469 7374 6963 0a20   the statistic. 
+0001b460: 2020 2020 2020 2020 2020 2073 7065 6369             speci
+0001b470: 6669 6564 2062 7920 736c 6963 655f 7374  fied by slice_st
+0001b480: 6174 2e0a 0a20 2020 2020 2020 2076 616c  at...        val
+0001b490: 7565 5f66 6f72 5f6e 6f6e 6520 3a20 666c  ue_for_none : fl
+0001b4a0: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+0001b4b0: 650a 2020 2020 2020 2020 2020 2020 466f  e.            Fo
+0001b4c0: 7220 7369 6e67 6c65 5f73 6c69 6365 2061  r single_slice a
+0001b4d0: 6e64 2062 795f 736c 6963 652c 2076 616c  nd by_slice, val
+0001b4e0: 7565 2074 6f20 6265 2072 6574 7572 6e65  ue to be returne
+0001b4f0: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
+0001b500: 2020 736c 6963 6573 2077 6865 7265 204a    slices where J
+0001b510: 6163 6361 7264 2069 6e64 6578 2069 7320  accard index is 
+0001b520: 756e 6465 7465 726d 696e 6564 2028 4e6f  undetermined (No
+0001b530: 6e65 292e 2020 466f 7220 736c 6963 655f  ne).  For slice_
+0001b540: 7374 6174 2c0a 2020 2020 2020 2020 2020  stat,.          
+0001b550: 2020 7661 6c75 6520 746f 2073 7562 7374    value to subst
+0001b560: 6974 7574 6520 666f 7220 616e 7920 4e6f  itute for any No
+0001b570: 6e65 2076 616c 7565 7320 616d 6f6e 6720  ne values among 
+0001b580: 7468 6520 696e 7075 7473 0a20 2020 2020  the inputs.     
+0001b590: 2020 2020 2020 2066 6f72 2063 616c 6375         for calcu
+0001b5a0: 6c61 7469 6e67 2073 6c69 6365 2d62 6173  lating slice-bas
+0001b5b0: 6564 2073 7461 7469 7374 6963 2e20 2049  ed statistic.  I
+0001b5c0: 6620 4e6f 6e65 2069 6e20 7468 6520 6c61  f None in the la
+0001b5d0: 7474 6572 0a20 2020 2020 2020 2020 2020  tter.           
+0001b5e0: 2063 6173 652c 204e 6f6e 6520 7661 6c75   case, None valu
+0001b5f0: 6573 2061 6d6f 6e67 2074 6865 2069 6e70  es among the inp
+0001b600: 7574 7320 6172 6520 6f6d 6974 7465 642e  uts are omitted.
+0001b610: 0a0a 2020 2020 2020 2020 736c 6963 655f  ..        slice_
+0001b620: 7374 6174 203a 2073 7472 2c20 6465 6661  stat : str, defa
+0001b630: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0001b640: 2020 2020 2053 696e 676c 652d 7661 7269       Single-vari
+0001b650: 6162 6c65 2073 7461 7469 7374 6963 2873  able statistic(s
+0001b660: 2920 746f 2062 6520 7265 7475 726e 6564  ) to be returned
+0001b670: 2066 6f72 2073 6c69 6365 2d62 792d 736c   for slice-by-sl
+0001b680: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+0001b690: 4a61 6363 6172 6420 696e 6469 6365 732e  Jaccard indices.
+0001b6a0: 2020 5468 6973 2073 686f 756c 6420 6265    This should be
+0001b6b0: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+0001b6c0: 2066 756e 6374 696f 6e20 666f 720a 2020   function for.  
+0001b6d0: 2020 2020 2020 2020 2020 6361 6c63 756c            calcul
+0001b6e0: 6174 696f 6e20 6f66 2074 6865 2073 7461  ation of the sta
+0001b6f0: 7469 7374 6963 2873 2920 696e 2074 6865  tistic(s) in the
+0001b700: 2050 7974 686f 6e20 7374 6174 6973 7469   Python statisti
+0001b710: 6373 206d 6f64 756c 653a 0a0a 2020 2020  cs module:..    
+0001b720: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0001b730: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+0001b740: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
+0001b750: 7469 6373 2e68 746d 6c0a 0a20 2020 2020  tics.html..     
+0001b760: 2020 2020 2020 2041 7661 696c 6162 6c65         Available
+0001b770: 206f 7074 696f 6e73 2069 6e63 6c75 6465   options include
+0001b780: 3a20 226d 6561 6e22 2c20 226d 6564 6961  : "mean", "media
+0001b790: 6e22 2c20 226d 6f64 6522 2c0a 2020 2020  n", "mode",.    
+0001b7a0: 2020 2020 2020 2020 2273 7464 6576 222c          "stdev",
+0001b7b0: 2022 7175 616e 7469 6c65 7322 2e20 2044   "quantiles".  D
+0001b7c0: 6973 7265 6761 7264 6564 2069 6620 4e6f  isregarded if No
+0001b7d0: 6e65 2e0a 0a20 2020 2020 2020 2020 2020  ne...           
+0001b7e0: 2049 6620 6279 5f73 6c69 6365 2069 7320   If by_slice is 
+0001b7f0: 4e6f 6e65 2061 6e64 2073 6c69 6365 5f73  None and slice_s
+0001b800: 7461 7420 6973 2064 6966 6665 7265 6e74  tat is different
+0001b810: 2066 726f 6d20 4e6f 6e65 2c0a 2020 2020   from None,.    
+0001b820: 2020 2020 2020 2020 7468 6520 666f 726d          the form
+0001b830: 6572 2064 6566 6175 6c74 7320 746f 2022  er defaults to "
+0001b840: 756e 696f 6e22 2e0a 0a20 2020 2020 2020  union"...       
+0001b850: 2073 6c69 6365 5f73 7461 745f 6b77 6172   slice_stat_kwar
+0001b860: 6773 203a 2064 6963 742c 2064 6566 6175  gs : dict, defau
+0001b870: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0001b880: 2020 2020 4b65 7977 6f72 6420 6172 6775      Keyword argu
+0001b890: 6d65 6e74 7320 746f 2062 6520 7061 7373  ments to be pass
+0001b8a0: 6564 2074 6f20 6675 6e63 7469 6f6e 206f  ed to function o
+0001b8b0: 6620 7374 6174 6973 7469 6373 0a20 2020  f statistics.   
+0001b8c0: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
+0001b8d0: 666f 7220 6361 6c63 756c 6174 696f 6e20  for calculation 
+0001b8e0: 7265 6c61 7469 7665 2074 6f20 736c 6963  relative to slic
+0001b8f0: 6520 7661 6c75 6573 2e20 2046 6f72 2065  e values.  For e
+0001b900: 7861 6d70 6c65 2c0a 2020 2020 2020 2020  xample,.        
+0001b910: 2020 2020 6966 2071 7561 6e74 696c 6573      if quantiles
+0001b920: 2061 7265 2072 6571 7569 7265 6420 666f   are required fo
+0001b930: 7220 3130 2069 6e74 6572 7661 6c73 2c20  r 10 intervals, 
+0001b940: 7261 7468 6572 2074 6861 6e20 666f 720a  rather than for.
+0001b950: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+0001b960: 6465 6661 756c 7420 6f66 2034 2c20 7468  default of 4, th
+0001b970: 6973 2063 616e 2062 6520 7370 6563 6966  is can be specif
+0001b980: 6965 6420 7573 696e 673a 0a0a 2020 2020  ied using:..    
+0001b990: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+0001b9a0: 6174 5f6b 7761 7267 737b 226e 2220 3a20  at_kwargs{"n" : 
+0001b9b0: 3130 7d0a 0a20 2020 2020 2020 2020 2020  10}..           
+0001b9c0: 2046 6f72 2061 7661 696c 6162 6c65 206b   For available k
+0001b9d0: 6579 776f 7264 206f 7074 696f 6e73 2c20  eyword options, 
+0001b9e0: 7365 6520 646f 6375 6d65 6e74 6174 696f  see documentatio
+0001b9f0: 6e20 6f66 2073 7461 7469 7374 6963 730a  n of statistics.
+0001ba00: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
+0001ba10: 6c65 2061 743a 0a0a 2020 2020 2020 2020  le at:..        
+0001ba20: 2020 2020 6874 7470 733a 2f2f 646f 6373      https://docs
+0001ba30: 2e70 7974 686f 6e2e 6f72 672f 332f 6c69  .python.org/3/li
+0001ba40: 6272 6172 792f 7374 6174 6973 7469 6373  brary/statistics
+0001ba50: 2e68 746d 6c0a 2020 2020 2020 2020 2222  .html.        ""
+0001ba60: 220a 2020 2020 2020 2020 6966 2073 6c69  ".        if sli
+0001ba70: 6365 5f73 7461 743a 0a20 2020 2020 2020  ce_stat:.       
+0001ba80: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001ba90: 2e67 6574 5f73 6c69 6365 5f73 7461 7428  .get_slice_stat(
+0001baa0: 6f74 6865 722c 2022 6a61 6363 6172 6422  other, "jaccard"
+0001bab0: 2c20 736c 6963 655f 7374 6174 2c20 6279  , slice_stat, by
+0001bac0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+0001bad0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0001bae0: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
+0001baf0: 2c20 6d65 7468 6f64 2c20 2a2a 2873 6c69  , method, **(sli
+0001bb00: 6365 5f73 7461 745f 6b77 6172 6773 206f  ce_stat_kwargs o
+0001bb10: 7220 7b7d 2929 0a0a 2020 2020 2020 2020  r {}))..        
+0001bb20: 6966 2062 795f 736c 6963 653a 0a20 2020  if by_slice:.   
+0001bb30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001bb40: 7365 6c66 2e67 6574 5f6d 6574 7269 635f  self.get_metric_
+0001bb50: 6279 5f73 6c69 6365 286f 7468 6572 2c20  by_slice(other, 
+0001bb60: 226a 6163 6361 7264 222c 2062 795f 736c  "jaccard", by_sl
+0001bb70: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
+0001bb80: 2020 2020 2020 2020 2076 6965 772c 206d           view, m
+0001bb90: 6574 686f 6429 0a0a 2020 2020 2020 2020  ethod)..        
+0001bba0: 696e 7465 7273 6563 7469 6f6e 2c20 756e  intersection, un
+0001bbb0: 696f 6e2c 206d 6561 6e5f 7369 7a65 203d  ion, mean_size =
+0001bbc0: 2073 656c 662e 6765 745f 696e 7465 7273   self.get_inters
+0001bbd0: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
+0001bbe0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0001bbf0: 2020 206f 7468 6572 2c20 7369 6e67 6c65     other, single
+0001bc00: 5f73 6c69 6365 2c20 7669 6577 2c20 736c  _slice, view, sl
+0001bc10: 2c20 6964 782c 2070 6f73 2c20 6d65 7468  , idx, pos, meth
+0001bc20: 6f64 2c20 666c 6174 7465 6e29 0a0a 2020  od, flatten)..  
+0001bc30: 2020 2020 2020 7265 7475 726e 2028 696e        return (in
+0001bc40: 7465 7273 6563 7469 6f6e 202f 2075 6e69  tersection / uni
+0001bc50: 6f6e 2069 6620 756e 696f 6e20 656c 7365  on if union else
+0001bc60: 2076 616c 7565 5f66 6f72 5f6e 6f6e 6529   value_for_none)
+0001bc70: 0a0a 2020 2020 6465 6620 6765 745f 766f  ..    def get_vo
+0001bc80: 6c75 6d65 5f72 6174 696f 2873 656c 662c  lume_ratio(self,
+0001bc90: 206f 7468 6572 2c20 2a2a 6b77 6172 6773   other, **kwargs
+0001bca0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0001bcb0: 7420 7261 7469 6f20 6f66 2061 6e6f 7468  t ratio of anoth
+0001bcc0: 6572 2052 4f49 2773 2076 6f6c 756d 6520  er ROI's volume 
+0001bcd0: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
+0001bce0: 6f77 6e20 766f 6c75 6d65 2e22 2222 0a0a  own volume."""..
+0001bcf0: 2020 2020 2020 2020 6f77 6e5f 766f 6c75          own_volu
+0001bd00: 6d65 203d 206f 7468 6572 2e67 6574 5f76  me = other.get_v
+0001bd10: 6f6c 756d 6528 2a2a 6b77 6172 6773 290a  olume(**kwargs).
+0001bd20: 2020 2020 2020 2020 6f74 6865 725f 766f          other_vo
+0001bd30: 6c75 6d65 203d 2073 656c 662e 6765 745f  lume = self.get_
+0001bd40: 766f 6c75 6d65 282a 2a6b 7761 7267 7329  volume(**kwargs)
+0001bd50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001bd60: 6f74 6865 725f 766f 6c75 6d65 206f 7220  other_volume or 
+0001bd70: 6e6f 7420 6f77 6e5f 766f 6c75 6d65 3a0a  not own_volume:.
+0001bd80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bd90: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+0001bda0: 7265 7475 726e 206f 776e 5f76 6f6c 756d  return own_volum
+0001bdb0: 6520 2f20 6f74 6865 725f 766f 6c75 6d65  e / other_volume
+0001bdc0: 0a0a 2020 2020 6465 6620 6765 745f 6172  ..    def get_ar
+0001bdd0: 6561 5f72 6174 696f 2873 656c 662c 206f  ea_ratio(self, o
+0001bde0: 7468 6572 2c20 7669 6577 3d22 782d 7922  ther, view="x-y"
+0001bdf0: 2c20 736c 3d4e 6f6e 652c 2069 6478 3d4e  , sl=None, idx=N
+0001be00: 6f6e 652c 2070 6f73 3d4e 6f6e 652c 0a20  one, pos=None,. 
+0001be10: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+0001be20: 3d22 6d6d 222c 206d 6574 686f 643d 4e6f  ="mm", method=No
+0001be30: 6e65 2c20 666c 6174 7465 6e3d 4661 6c73  ne, flatten=Fals
+0001be40: 652c 2062 795f 736c 6963 653d 4e6f 6e65  e, by_slice=None
+0001be50: 2c0a 2020 2020 2020 2020 2020 2020 736c  ,.            sl
+0001be60: 6963 655f 7374 6174 3d4e 6f6e 652c 2076  ice_stat=None, v
+0001be70: 616c 7565 5f66 6f72 5f6e 6f6e 653d 4e6f  alue_for_none=No
+0001be80: 6e65 2c20 2a2a 736c 6963 655f 7374 6174  ne, **slice_stat
+0001be90: 5f6b 7761 7267 7329 3a0a 2020 2020 2020  _kwargs):.      
+0001bea0: 2020 2222 2247 6574 2072 6174 696f 206f    """Get ratio o
+0001beb0: 6620 616e 6f74 6865 7220 524f 4927 7320  f another ROI's 
+0001bec0: 6172 6561 2077 6974 6820 7265 7370 6563  area with respec
+0001bed0: 7420 746f 206f 776e 2061 7265 612e 2222  t to own area.""
+0001bee0: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
+0001bef0: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
+0001bf00: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001bf10: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
+0001bf20: 286f 7468 6572 2c20 2261 7265 615f 7261  (other, "area_ra
+0001bf30: 7469 6f22 2c20 736c 6963 655f 7374 6174  tio", slice_stat
+0001bf40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001bf50: 2020 2020 2020 6279 5f73 6c69 6365 2c20        by_slice, 
+0001bf60: 7661 6c75 655f 666f 725f 6e6f 6e65 2c20  value_for_none, 
+0001bf70: 7669 6577 2c20 6d65 7468 6f64 2c0a 2020  view, method,.  
+0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf90: 2020 2a2a 2873 6c69 6365 5f73 7461 745f    **(slice_stat_
+0001bfa0: 6b77 6172 6773 206f 7220 7b7d 2929 0a0a  kwargs or {}))..
+0001bfb0: 2020 2020 2020 2020 6966 2062 795f 736c          if by_sl
+0001bfc0: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+0001bfd0: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
+0001bfe0: 5f6d 6574 7269 635f 6279 5f73 6c69 6365  _metric_by_slice
+0001bff0: 286f 7468 6572 2c20 2261 7265 615f 7261  (other, "area_ra
+0001c000: 7469 6f22 2c20 6279 5f73 6c69 6365 2c0a  tio", by_slice,.
+0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c020: 2020 2020 7669 6577 2c20 6d65 7468 6f64      view, method
+0001c030: 290a 0a20 2020 2020 2020 206f 776e 5f61  )..        own_a
+0001c040: 7265 6120 3d20 6f74 6865 722e 6765 745f  rea = other.get_
+0001c050: 6172 6561 2876 6965 772c 2073 6c2c 2069  area(view, sl, i
+0001c060: 6478 2c20 706f 732c 2075 6e69 7473 2c20  dx, pos, units, 
+0001c070: 6d65 7468 6f64 2c20 666c 6174 7465 6e29  method, flatten)
+0001c080: 0a20 2020 2020 2020 206f 7468 6572 5f61  .        other_a
+0001c090: 7265 6120 3d20 7365 6c66 2e67 6574 5f61  rea = self.get_a
+0001c0a0: 7265 6128 7669 6577 2c20 736c 2c20 6964  rea(view, sl, id
+0001c0b0: 782c 2070 6f73 2c20 756e 6974 732c 206d  x, pos, units, m
+0001c0c0: 6574 686f 642c 2066 6c61 7474 656e 290a  ethod, flatten).
+0001c0d0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0001c0e0: 7468 6572 5f61 7265 6120 6f72 206e 6f74  ther_area or not
+0001c0f0: 206f 776e 5f61 7265 613a 0a20 2020 2020   own_area:.     
+0001c100: 2020 2020 2020 2072 6574 7572 6e20 7661         return va
+0001c110: 6c75 655f 666f 725f 6e6f 6e65 0a20 2020  lue_for_none.   
+0001c120: 2020 2020 2072 6574 7572 6e20 6f77 6e5f       return own_
+0001c130: 6172 6561 202f 206f 7468 6572 5f61 7265  area / other_are
+0001c140: 610a 0a20 2020 2064 6566 2067 6574 5f76  a..    def get_v
+0001c150: 6f6c 756d 655f 6469 6666 2873 656c 662c  olume_diff(self,
+0001c160: 206f 7468 6572 2c20 2a2a 6b77 6172 6773   other, **kwargs
+0001c170: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0001c180: 7420 6f77 6e20 766f 6c75 6d65 206d 696e  t own volume min
+0001c190: 7573 2076 6f6c 756d 6520 6f66 206f 7468  us volume of oth
+0001c1a0: 6572 2052 4f49 2e22 2222 0a0a 2020 2020  er ROI."""..    
+0001c1b0: 2020 2020 6f77 6e5f 766f 6c75 6d65 203d      own_volume =
+0001c1c0: 2073 656c 662e 6765 745f 766f 6c75 6d65   self.get_volume
+0001c1d0: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
+0001c1e0: 2020 206f 7468 6572 5f76 6f6c 756d 6520     other_volume 
+0001c1f0: 3d20 6f74 6865 722e 6765 745f 766f 6c75  = other.get_volu
+0001c200: 6d65 282a 2a6b 7761 7267 7329 0a20 2020  me(**kwargs).   
+0001c210: 2020 2020 2069 6620 6e6f 7420 6f77 6e5f       if not own_
+0001c220: 766f 6c75 6d65 206f 7220 6e6f 7420 6f74  volume or not ot
+0001c230: 6865 725f 766f 6c75 6d65 3a0a 2020 2020  her_volume:.    
+0001c240: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001c250: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
+0001c260: 726e 2028 6f77 6e5f 766f 6c75 6d65 202d  rn (own_volume -
+0001c270: 206f 7468 6572 5f76 6f6c 756d 6529 0a0a   other_volume)..
+0001c280: 2020 2020 6465 6620 6765 745f 7265 6c61      def get_rela
+0001c290: 7469 7665 5f76 6f6c 756d 655f 6469 6666  tive_volume_diff
+0001c2a0: 2873 656c 662c 206f 7468 6572 2c20 2a2a  (self, other, **
+0001c2b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+0001c2c0: 2022 2222 4765 7420 7265 6c61 7469 7665   """Get relative
+0001c2d0: 2076 6f6c 756d 6520 6f66 2061 6e6f 7468   volume of anoth
+0001c2e0: 6572 2052 4f49 2077 6974 6820 7265 7370  er ROI with resp
+0001c2f0: 6563 7420 746f 206f 776e 2076 6f6c 756d  ect to own volum
+0001c300: 652e 2222 220a 0a20 2020 2020 2020 206f  e."""..        o
+0001c310: 776e 5f76 6f6c 756d 6520 3d20 7365 6c66  wn_volume = self
+0001c320: 2e67 6574 5f76 6f6c 756d 6528 2a2a 6b77  .get_volume(**kw
+0001c330: 6172 6773 290a 2020 2020 2020 2020 766f  args).        vo
+0001c340: 6c75 6d65 5f64 6966 6620 3d20 7365 6c66  lume_diff = self
+0001c350: 2e67 6574 5f76 6f6c 756d 655f 6469 6666  .get_volume_diff
+0001c360: 286f 7468 6572 2c20 2a2a 6b77 6172 6773  (other, **kwargs
+0001c370: 290a 2020 2020 2020 2020 6966 2076 6f6c  ).        if vol
+0001c380: 756d 655f 6469 6666 2069 7320 4e6f 6e65  ume_diff is None
+0001c390: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001c3a0: 7475 726e 0a20 2020 2020 2020 2072 6574  turn.        ret
+0001c3b0: 7572 6e20 766f 6c75 6d65 5f64 6966 6620  urn volume_diff 
+0001c3c0: 2f20 6f77 6e5f 766f 6c75 6d65 0a0a 2020  / own_volume..  
+0001c3d0: 2020 6465 6620 6765 745f 6172 6561 5f64    def get_area_d
+0001c3e0: 6966 6628 7365 6c66 2c20 6f74 6865 722c  iff(self, other,
+0001c3f0: 2076 6965 773d 2278 2d79 222c 2073 6c3d   view="x-y", sl=
+0001c400: 4e6f 6e65 2c20 6964 783d 4e6f 6e65 2c20  None, idx=None, 
+0001c410: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
+0001c420: 2020 2020 2020 756e 6974 733d 226d 6d22        units="mm"
+0001c430: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 2066  , method=None, f
+0001c440: 6c61 7474 656e 3d46 616c 7365 2c20 6279  latten=False, by
+0001c450: 5f73 6c69 6365 3d4e 6f6e 652c 0a20 2020  _slice=None,.   
+0001c460: 2020 2020 2020 2020 2073 6c69 6365 5f73           slice_s
+0001c470: 7461 743d 4e6f 6e65 2c20 7661 6c75 655f  tat=None, value_
+0001c480: 666f 725f 6e6f 6e65 3d4e 6f6e 652c 202a  for_none=None, *
+0001c490: 2a73 6c69 6365 5f73 7461 745f 6b77 6172  *slice_stat_kwar
+0001c4a0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+0001c4b0: 4765 7420 6162 736f 6c75 7465 2061 7265  Get absolute are
+0001c4c0: 6120 6469 6666 6572 656e 6365 2062 6574  a difference bet
+0001c4d0: 7765 656e 2074 776f 2052 4f49 732e 2222  ween two ROIs.""
+0001c4e0: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
+0001c4f0: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
+0001c500: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001c510: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
+0001c520: 286f 7468 6572 2c20 2261 7265 615f 6469  (other, "area_di
+0001c530: 6666 222c 2073 6c69 6365 5f73 7461 742c  ff", slice_stat,
+0001c540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c550: 2020 2020 2062 795f 736c 6963 652c 2076       by_slice, v
+0001c560: 616c 7565 5f66 6f72 5f6e 6f6e 652c 2076  alue_for_none, v
+0001c570: 6965 772c 206d 6574 686f 642c 0a20 2020  iew, method,.   
+0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c590: 202a 2a28 736c 6963 655f 7374 6174 5f6b   **(slice_stat_k
+0001c5a0: 7761 7267 7320 6f72 207b 7d29 290a 0a20  wargs or {})).. 
+0001c5b0: 2020 2020 2020 2069 6620 6279 5f73 6c69         if by_sli
+0001c5c0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0001c5d0: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+0001c5e0: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
+0001c5f0: 6f74 6865 722c 2022 6172 6561 5f64 6966  other, "area_dif
+0001c600: 6622 2c20 6279 5f73 6c69 6365 2c0a 2020  f", by_slice,.  
+0001c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c620: 2020 7669 6577 2c20 6d65 7468 6f64 290a    view, method).
+0001c630: 0a20 2020 2020 2020 206f 776e 5f61 7265  .        own_are
+0001c640: 6120 3d20 7365 6c66 2e67 6574 5f61 7265  a = self.get_are
+0001c650: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001c660: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
+0001c670: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
+0001c680: 2020 2020 2020 6f74 6865 725f 6172 6561        other_area
+0001c690: 203d 206f 7468 6572 2e67 6574 5f61 7265   = other.get_are
+0001c6a0: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001c6b0: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
+0001c6c0: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
+0001c6d0: 2020 2020 2020 6966 206e 6f74 206f 776e        if not own
+0001c6e0: 5f61 7265 6120 6f72 206e 6f74 206f 7468  _area or not oth
+0001c6f0: 6572 5f61 7265 613a 0a20 2020 2020 2020  er_area:.       
+0001c700: 2020 2020 2072 6574 7572 6e20 7661 6c75       return valu
+0001c710: 655f 666f 725f 6e6f 6e65 0a20 2020 2020  e_for_none.     
+0001c720: 2020 2072 6574 7572 6e20 6f77 6e5f 6172     return own_ar
+0001c730: 6561 202d 206f 7468 6572 5f61 7265 610a  ea - other_area.
+0001c740: 0a20 2020 2064 6566 2067 6574 5f72 656c  .    def get_rel
+0001c750: 6174 6976 655f 6172 6561 5f64 6966 6628  ative_area_diff(
+0001c760: 7365 6c66 2c20 6f74 6865 722c 2076 6965  self, other, vie
+0001c770: 773d 2278 2d79 222c 2073 6c3d 4e6f 6e65  w="x-y", sl=None
+0001c780: 2c20 6964 783d 4e6f 6e65 2c0a 2020 2020  , idx=None,.    
+0001c790: 2020 2020 2020 2020 706f 733d 4e6f 6e65          pos=None
+0001c7a0: 2c20 756e 6974 733d 226d 6d22 2c20 6d65  , units="mm", me
+0001c7b0: 7468 6f64 3d4e 6f6e 652c 2066 6c61 7474  thod=None, flatt
+0001c7c0: 656e 3d46 616c 7365 2c20 6279 5f73 6c69  en=False, by_sli
+0001c7d0: 6365 3d4e 6f6e 652c 0a20 2020 2020 2020  ce=None,.       
+0001c7e0: 2020 2020 2073 6c69 6365 5f73 7461 743d       slice_stat=
+0001c7f0: 4e6f 6e65 2c20 7661 6c75 655f 666f 725f  None, value_for_
+0001c800: 6e6f 6e65 3d4e 6f6e 652c 202a 2a73 6c69  none=None, **sli
+0001c810: 6365 5f73 7461 745f 6b77 6172 6773 293a  ce_stat_kwargs):
+0001c820: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+0001c830: 7265 6c61 7469 7665 2061 7265 6120 6f66  relative area of
+0001c840: 2061 6e6f 7468 6572 2052 4f49 2077 6974   another ROI wit
+0001c850: 6820 7265 7370 6563 7420 746f 206f 776e  h respect to own
+0001c860: 2061 7265 612e 2222 220a 0a20 2020 2020   area."""..     
+0001c870: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
+0001c880: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001c890: 7475 726e 2073 656c 662e 6765 745f 736c  turn self.get_sl
+0001c8a0: 6963 655f 7374 6174 286f 7468 6572 2c20  ice_stat(other, 
+0001c8b0: 2272 656c 5f61 7265 615f 6469 6666 222c  "rel_area_diff",
+0001c8c0: 2073 6c69 6365 5f73 7461 742c 0a20 2020   slice_stat,.   
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8e0: 2062 795f 736c 6963 652c 2076 616c 7565   by_slice, value
+0001c8f0: 5f66 6f72 5f6e 6f6e 652c 2076 6965 772c  _for_none, view,
+0001c900: 206d 6574 686f 642c 0a20 2020 2020 2020   method,.       
+0001c910: 2020 2020 2020 2020 2020 2020 202a 2a28               **(
+0001c920: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
+0001c930: 7320 6f72 207b 7d29 290a 0a20 2020 2020  s or {}))..     
+0001c940: 2020 2069 6620 6279 5f73 6c69 6365 3a0a     if by_slice:.
+0001c950: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001c960: 726e 2073 656c 662e 6765 745f 6d65 7472  rn self.get_metr
+0001c970: 6963 5f62 795f 736c 6963 6528 6f74 6865  ic_by_slice(othe
+0001c980: 722c 2022 7265 6c5f 6172 6561 5f64 6966  r, "rel_area_dif
+0001c990: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
+0001c9a0: 2020 2020 2020 2020 6279 5f73 6c69 6365          by_slice
+0001c9b0: 2c20 7669 6577 2c20 6d65 7468 6f64 290a  , view, method).
+0001c9c0: 0a20 2020 2020 2020 206f 776e 5f61 7265  .        own_are
+0001c9d0: 6120 3d20 7365 6c66 2e67 6574 5f61 7265  a = self.get_are
+0001c9e0: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001c9f0: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
+0001ca00: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
+0001ca10: 2020 2020 2020 6172 6561 5f64 6966 6620        area_diff 
+0001ca20: 3d20 7365 6c66 2e67 6574 5f61 7265 615f  = self.get_area_
+0001ca30: 6469 6666 286f 7468 6572 2c20 7669 6577  diff(other, view
+0001ca40: 2c20 736c 2c20 6964 782c 2070 6f73 2c20  , sl, idx, pos, 
+0001ca50: 756e 6974 732c 206d 6574 686f 642c 0a20  units, method,. 
+0001ca60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001ca70: 6c61 7474 656e 290a 0a20 2020 2020 2020  latten)..       
+0001ca80: 2069 6620 6172 6561 5f64 6966 6620 6973   if area_diff is
+0001ca90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001caa0: 2020 2072 6574 7572 6e20 7661 6c75 655f     return value_
+0001cab0: 666f 725f 6e6f 6e65 0a20 2020 2020 2020  for_none.       
+0001cac0: 2072 6574 7572 6e20 6172 6561 5f64 6966   return area_dif
+0001cad0: 6620 2f20 6f77 6e5f 6172 6561 0a0a 2020  f / own_area..  
+0001cae0: 2020 6465 6620 6765 745f 696e 7465 7273    def get_inters
+0001caf0: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
+0001cb00: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0001cb10: 200a 2020 2020 2020 2020 6f74 6865 722c   .        other,
+0001cb20: 200a 2020 2020 2020 2020 7369 6e67 6c65   .        single
+0001cb30: 5f73 6c69 6365 3d46 616c 7365 2c0a 2020  _slice=False,.  
+0001cb40: 2020 2020 2020 7669 6577 3d22 782d 7922        view="x-y"
+0001cb50: 2c20 0a20 2020 2020 2020 2073 6c3d 4e6f  , .        sl=No
+0001cb60: 6e65 2c20 0a20 2020 2020 2020 2069 6478  ne, .        idx
+0001cb70: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
+0001cb80: 706f 733d 4e6f 6e65 2c20 0a20 2020 2020  pos=None, .     
+0001cb90: 2020 206d 6574 686f 643d 4e6f 6e65 2c0a     method=None,.
+0001cba0: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
+0001cbb0: 4661 6c73 652c 0a20 2020 2029 3a0a 2020  False,.    ):.  
+0001cbc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001cbd0: 2020 4765 7420 696e 7465 7273 6563 7469    Get intersecti
+0001cbe0: 6f6e 2c20 756e 696f 6e20 616e 6420 6d65  on, union and me
+0001cbf0: 616e 2073 697a 6520 7769 7468 2072 6573  an size with res
+0001cc00: 7065 6374 2074 6f20 616e 6f74 6865 7220  pect to another 
+0001cc10: 524f 492e 0a20 2020 2020 2020 2056 616c  ROI..        Val
+0001cc20: 7565 7320 6172 6520 7265 7475 726e 6564  ues are returned
+0001cc30: 2061 7320 766f 6c75 6d65 7320 666f 7220   as volumes for 
+0001cc40: 7468 6520 6675 6c6c 2052 4f49 732c 0a20  the full ROIs,. 
+0001cc50: 2020 2020 2020 206f 7220 6173 2061 7265         or as are
+0001cc60: 6173 2066 6f72 2061 2073 696e 676c 6520  as for a single 
+0001cc70: 736c 6963 652e 0a0a 2020 2020 2020 2020  slice...        
+0001cc80: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+0001cc90: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0001cca0: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
+0001ccb0: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
+0001ccc0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
+0001ccd0: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
+0001cce0: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
+0001ccf0: 6365 203a 2062 6f6f 6c2c 2064 6566 6175  ce : bool, defau
+0001cd00: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+0001cd10: 2020 2020 2049 6620 4661 6c73 652c 2074       If False, t
+0001cd20: 6865 2076 6f6c 756d 6573 206f 6620 696e  he volumes of in
+0001cd30: 7465 7273 6563 7469 6f6e 2061 6e64 2020  tersection and  
+0001cd40: 756e 696f 6e20 6f66 2074 6865 2066 756c  union of the ful
+0001cd50: 6c20 524f 4973 2c0a 2020 2020 2020 2020  l ROIs,.        
+0001cd60: 2020 2020 616e 6420 7468 6520 6d65 616e      and the mean
+0001cd70: 2052 4f49 2076 6f6c 756d 6520 7769 6c6c   ROI volume will
+0001cd80: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
+0001cd90: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
+0001cda0: 6973 652c 2074 6865 2061 7265 6173 206f  ise, the areas o
+0001cdb0: 6620 696e 7465 7273 6563 7469 6f6e 2061  f intersection a
+0001cdc0: 6e64 2075 6e69 6f6e 206f 6e20 6120 7369  nd union on a si
+0001cdd0: 6e67 6c65 2073 6c69 6365 2c0a 2020 2020  ngle slice,.    
+0001cde0: 2020 2020 2020 2020 616e 6420 7468 6520          and the 
+0001cdf0: 6d65 616e 2052 4f49 2061 7265 612c 2077  mean ROI area, w
+0001ce00: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+0001ce10: 0a0a 2020 2020 2020 2020 7669 6577 203a  ..        view :
+0001ce20: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
+0001ce30: 2d79 220a 2020 2020 2020 2020 2020 2020  -y".            
+0001ce40: 4f72 6965 6e74 6174 696f 6e20 6f66 2073  Orientation of s
+0001ce50: 6c69 6365 206f 6e20 7768 6963 6820 746f  lice on which to
+0001ce60: 2067 6574 2061 7265 6173 206f 6620 696e   get areas of in
+0001ce70: 7465 7273 6563 7469 6f6e 0a20 2020 2020  tersection.     
+0001ce80: 2020 2020 2020 2061 6e64 2075 6e69 6f6e         and union
+0001ce90: 2c20 616e 6420 6d65 616e 2052 4f49 2061  , and mean ROI a
+0001cea0: 7265 612e 2020 4f6e 6c79 2075 7365 6420  rea.  Only used 
+0001ceb0: 6966 2073 696e 676c 655f 736c 6963 653d  if single_slice=
+0001cec0: 5472 7565 2e0a 0a20 2020 2020 2020 2073  True...        s
+0001ced0: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
+0001cee0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001cef0: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
+0001cf00: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0001cf10: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0001cf20: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0001cf30: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0001cf40: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0001cf50: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0001cf60: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
+0001cf70: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+0001cf80: 0a0a 2020 2020 2020 2020 6964 7820 3a20  ..        idx : 
+0001cf90: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+0001cfa0: 650a 2020 2020 2020 2020 2020 2020 4172  e.            Ar
+0001cfb0: 7261 7920 696e 6465 7820 6f66 2073 6c69  ray index of sli
+0001cfc0: 6365 2e20 4966 206e 6f6e 6520 6f66 203c  ce. If none of <
+0001cfd0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+0001cfe0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+0001cff0: 0a20 2020 2020 2020 2020 2020 2062 7574  .            but
+0001d000: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+0001d010: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+0001d020: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
+0001d030: 6973 2052 4f49 2077 696c 6c20 6265 0a20  is ROI will be. 
+0001d040: 2020 2020 2020 2020 2020 2075 7365 642e             used.
+0001d050: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+0001d060: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+0001d070: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001d080: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+0001d090: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+0001d0a0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+0001d0b0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+0001d0c0: 6564 0a20 2020 2020 2020 2020 2020 2062  ed.            b
+0001d0d0: 7574 203c 7369 6e67 6c65 5f73 6c69 6365  ut <single_slice
+0001d0e0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+0001d0f0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+0001d100: 7468 6973 2052 4f49 2077 696c 6c0a 2020  this ROI will.  
+0001d110: 2020 2020 2020 2020 2020 6265 2075 7365            be use
+0001d120: 642e 0a0a 2020 2020 2020 2020 6d65 7468  d...        meth
+0001d130: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
+0001d140: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0001d150: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
+0001d160: 2066 6f72 2063 616c 6375 6c61 7469 6e67   for calculating
+0001d170: 2069 6e74 6572 7365 6374 696f 6e2c 2075   intersection, u
+0001d180: 6e69 6f6e 2c20 616e 6420 6d65 616e 0a20  nion, and mean. 
+0001d190: 2020 2020 2020 2020 2020 2073 697a 652e             size.
+0001d1a0: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
+0001d1b0: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
+0001d1c0: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
+0001d1d0: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
+0001d1e0: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
+0001d1f0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+0001d200: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0001d210: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
+0001d220: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
+0001d230: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
+0001d240: 2020 2020 2020 2020 2020 2020 202d 204e               - N
+0001d250: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
+0001d260: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
+0001d270: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+0001d280: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
+0001d290: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+0001d2a0: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+0001d2b0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0001d2c0: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
+0001d2d0: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
+0001d2e0: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
+0001d2f0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
+0001d300: 2020 2020 2020 2074 6865 2061 7265 6173         the areas
+0001d310: 206f 6620 696e 7465 7273 6563 7469 6f6e   of intersection
+0001d320: 2061 6e64 2075 6e69 6f6e 2c20 616e 6420   and union, and 
+0001d330: 7468 6520 6d65 616e 2052 4f49 2061 7265  the mean ROI are
+0001d340: 612c 0a20 2020 2020 2020 2020 2020 2077  a,.            w
+0001d350: 696c 6c20 6265 2072 6574 7572 6e65 6420  ill be returned 
+0001d360: 666f 7220 7468 6520 666c 6174 7465 6e65  for the flattene
+0001d370: 6420 736c 6963 6573 2e20 4f6e 6c79 2061  d slices. Only a
+0001d380: 7661 696c 6162 6c65 0a20 2020 2020 2020  vailable.       
+0001d390: 2020 2020 2069 6620 6d65 7468 6f64 3d22       if method="
+0001d3a0: 6d61 736b 222e 0a20 2020 2020 2020 2022  mask"..        "
+0001d3b0: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
+0001d3c0: 2e63 7265 6174 655f 6d61 736b 2829 0a0a  .create_mask()..
+0001d3d0: 2020 2020 2020 2020 2320 4465 6669 6e65          # Define
+0001d3e0: 2076 6f78 656c 2076 6f6c 756d 652c 2061   voxel volume, a
+0001d3f0: 6e64 2076 6f78 656c 2061 7265 6120 696e  nd voxel area in
+0001d400: 2076 6965 772e 0a20 2020 2020 2020 2076   view..        v
+0001d410: 6f78 656c 5f76 6f6c 756d 6520 3d20 310a  oxel_volume = 1.
+0001d420: 2020 2020 2020 2020 666f 7220 6478 797a          for dxyz
+0001d430: 2069 6e20 7365 6c66 2e6d 6173 6b2e 766f   in self.mask.vo
+0001d440: 7865 6c5f 7369 7a65 3a0a 2020 2020 2020  xel_size:.      
+0001d450: 2020 2020 2020 766f 7865 6c5f 766f 6c75        voxel_volu
+0001d460: 6d65 202a 3d20 6478 797a 0a20 2020 2020  me *= dxyz.     
+0001d470: 2020 207a 5f61 7820 3d20 736b 7274 2e69     z_ax = skrt.i
+0001d480: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
+0001d490: 5b76 6965 775d 0a20 2020 2020 2020 2073  [view].        s
+0001d4a0: 6c69 6365 5f74 6869 636b 6e65 7373 203d  lice_thickness =
+0001d4b0: 2073 656c 662e 6d61 736b 2e76 6f78 656c   self.mask.voxel
+0001d4c0: 5f73 697a 655b 7a5f 6178 5d0a 2020 2020  _size[z_ax].    
+0001d4d0: 2020 2020 766f 7865 6c5f 6172 6561 203d      voxel_area =
+0001d4e0: 2076 6f78 656c 5f76 6f6c 756d 6520 2f20   voxel_volume / 
+0001d4f0: 736c 6963 655f 7468 6963 6b6e 6573 730a  slice_thickness.
+0001d500: 0a20 2020 2020 2020 2023 2047 6574 2064  .        # Get d
+0001d510: 6566 6175 6c74 2073 6c69 6365 2061 6e64  efault slice and
+0001d520: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
+0001d530: 6966 2073 696e 676c 655f 736c 6963 653a  if single_slice:
+0001d540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001d550: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
+0001d560: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
+0001d570: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
+0001d580: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
+0001d590: 3d20 7365 6c66 2e67 6574 5f6d 6964 5f69  = self.get_mid_i
+0001d5a0: 6478 2876 6965 7729 0a20 2020 2020 2020  dx(view).       
+0001d5b0: 2069 6620 6d65 7468 6f64 2069 7320 4e6f   if method is No
+0001d5c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001d5d0: 6d65 7468 6f64 203d 2073 656c 662e 6465  method = self.de
+0001d5e0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+0001d5f0: 640a 0a20 2020 2020 2020 2069 6620 666c  d..        if fl
+0001d600: 6174 7465 6e3a 2020 2320 466c 6174 7465  atten:  # Flatte
+0001d610: 6e69 6e67 206f 6e6c 7920 706f 7373 6962  ning only possib
+0001d620: 6c65 2077 6974 6820 226d 6173 6b22 0a20  le with "mask". 
+0001d630: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+0001d640: 6420 3d20 226d 6173 6b22 0a0a 2020 2020  d = "mask"..    
+0001d650: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+0001d660: 696e 7465 7273 6563 7469 6f6e 7320 616e  intersections an
+0001d670: 6420 6172 6561 7320 6672 6f6d 2070 6f6c  d areas from pol
+0001d680: 7967 6f6e 730a 2020 2020 2020 2020 6966  ygons.        if
+0001d690: 206d 6574 686f 6420 3d3d 2022 636f 6e74   method == "cont
+0001d6a0: 6f75 7222 3a0a 0a20 2020 2020 2020 2020  our":..         
+0001d6b0: 2020 2023 2047 6574 2070 6f73 6974 696f     # Get positio
+0001d6c0: 6e73 206f 6620 736c 6963 6528 7329 0a20  ns of slice(s). 
+0001d6d0: 2020 2020 2020 2020 2020 2023 206f 6e20             # on 
+0001d6e0: 7768 6963 6820 746f 2063 6f6d 7061 7265  which to compare
+0001d6f0: 2061 7265 6173 2061 6e64 2074 6f74 616c   areas and total
+0001d700: 2061 7265 6173 2e0a 2020 2020 2020 2020   areas..        
+0001d710: 2020 2020 6966 206e 6f74 2073 696e 676c      if not singl
+0001d720: 655f 736c 6963 653a 0a20 2020 2020 2020  e_slice:.       
+0001d730: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
+0001d740: 6e73 203d 2073 6574 2873 656c 662e 6765  ns = set(self.ge
+0001d750: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
+0001d760: 292e 6b65 7973 2829 292e 756e 696f 6e28  ).keys()).union(
+0001d770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d780: 2020 2020 2020 2020 2073 6574 286f 7468           set(oth
+0001d790: 6572 2e67 6574 5f63 6f6e 746f 7572 7328  er.get_contours(
+0001d7a0: 2278 2d79 2229 2e6b 6579 7328 2929 290a  "x-y").keys())).
+0001d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7c0: 6172 6561 7331 203d 205b 7365 6c66 2e67  areas1 = [self.g
+0001d7d0: 6574 5f61 7265 6128 2278 2d79 222c 2070  et_area("x-y", p
+0001d7e0: 6f73 3d70 2c20 6d65 7468 6f64 3d6d 6574  os=p, method=met
+0001d7f0: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
+0001d800: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001d810: 2070 2069 6e20 706f 7369 7469 6f6e 735d   p in positions]
+0001d820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d830: 2076 6f6c 756d 6573 3120 3d20 5b61 202a   volumes1 = [a *
+0001d840: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+0001d850: 2066 6f72 2061 2069 6e20 6172 6561 7331   for a in areas1
+0001d860: 2069 6620 615d 0a20 2020 2020 2020 2020   if a].         
+0001d870: 2020 2020 2020 2076 6f6c 756d 6531 203d         volume1 =
+0001d880: 2073 756d 2876 6f6c 756d 6573 3129 0a20   sum(volumes1). 
+0001d890: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001d8a0: 7265 6173 3220 3d20 5b6f 7468 6572 2e67  reas2 = [other.g
+0001d8b0: 6574 5f61 7265 6128 2278 2d79 222c 2070  et_area("x-y", p
+0001d8c0: 6f73 3d70 2c20 6d65 7468 6f64 3d6d 6574  os=p, method=met
+0001d8d0: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
+0001d8e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001d8f0: 2070 2069 6e20 706f 7369 7469 6f6e 735d   p in positions]
+0001d900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d910: 2076 6f6c 756d 6573 3220 3d20 5b61 202a   volumes2 = [a *
+0001d920: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+0001d930: 2066 6f72 2061 2069 6e20 6172 6561 7332   for a in areas2
+0001d940: 2069 6620 615d 0a20 2020 2020 2020 2020   if a].         
+0001d950: 2020 2020 2020 2076 6f6c 756d 6532 203d         volume2 =
+0001d960: 2073 756d 2876 6f6c 756d 6573 3229 0a20   sum(volumes2). 
+0001d970: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001d980: 6561 6e5f 7369 7a65 203d 2030 2e35 202a  ean_size = 0.5 *
+0001d990: 2028 766f 6c75 6d65 3120 2b20 766f 6c75   (volume1 + volu
+0001d9a0: 6d65 3229 0a20 2020 2020 2020 2020 2020  me2).           
+0001d9b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001d9c0: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+0001d9d0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0001d9e0: 2020 2020 2020 2020 2073 656c 662e 6964           self.id
+0001d9f0: 785f 746f 5f70 6f73 2873 656c 662e 6765  x_to_pos(self.ge
+0001da00: 745f 6964 7828 7669 6577 2c20 736c 2c20  t_idx(view, sl, 
+0001da10: 6964 782c 2070 6f73 292c 0a20 2020 2020  idx, pos),.     
+0001da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da30: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001da40: 783d 736b 7274 2e69 6d61 6765 2e5f 736c  x=skrt.image._sl
+0001da50: 6963 655f 6178 6573 5b76 6965 775d 290a  ice_axes[view]).
+0001da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da70: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001da80: 2020 6172 6561 3120 3d20 7365 6c66 2e67    area1 = self.g
+0001da90: 6574 5f61 7265 6128 7669 6577 2c20 736c  et_area(view, sl
+0001daa0: 2c20 6964 782c 2070 6f73 2c20 6d65 7468  , idx, pos, meth
+0001dab0: 6f64 3d6d 6574 686f 6429 0a20 2020 2020  od=method).     
+0001dac0: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
+0001dad0: 6561 3120 6973 204e 6f6e 653a 0a20 2020  ea1 is None:.   
+0001dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001daf0: 2061 7265 6131 203d 2030 0a20 2020 2020   area1 = 0.     
+0001db00: 2020 2020 2020 2020 2020 2061 7265 6132             area2
+0001db10: 203d 206f 7468 6572 2e67 6574 5f61 7265   = other.get_are
+0001db20: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
+0001db30: 2070 6f73 2c20 6d65 7468 6f64 3d6d 6574   pos, method=met
+0001db40: 686f 6429 0a20 2020 2020 2020 2020 2020  hod).           
+0001db50: 2020 2020 2069 6620 6172 6561 3220 6973       if area2 is
+0001db60: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001db70: 2020 2020 2020 2020 2020 2061 7265 6132             area2
+0001db80: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0001db90: 2020 2020 206d 6561 6e5f 7369 7a65 203d       mean_size =
+0001dba0: 2030 2e35 202a 2028 6172 6561 3120 2b20   0.5 * (area1 + 
+0001dbb0: 6172 6561 3229 0a20 2020 2020 2020 2020  area2).         
+0001dbc0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0001dbd0: 2320 436f 6d70 7574 6520 6172 6561 7320  # Compute areas 
+0001dbe0: 6f66 2069 6e74 6572 7365 6374 696f 6e20  of intersection 
+0001dbf0: 616e 6420 756e 696f 6e20 6f6e 2073 6c69  and union on sli
+0001dc00: 6365 2873 290a 2020 2020 2020 2020 2020  ce(s).          
+0001dc10: 2020 696e 7465 7273 6563 7469 6f6e 203d    intersection =
+0001dc20: 2030 0a20 2020 2020 2020 2020 2020 2075   0.            u
+0001dc30: 6e69 6f6e 203d 2030 0a20 2020 2020 2020  nion = 0.       
+0001dc40: 2020 2020 2066 6163 746f 7220 3d20 3120       factor = 1 
+0001dc50: 6966 2028 7369 6e67 6c65 5f73 6c69 6365  if (single_slice
+0001dc60: 206f 7220 666c 6174 7465 6e29 2065 6c73   or flatten) els
+0001dc70: 6520 736c 6963 655f 7468 6963 6b6e 6573  e slice_thicknes
+0001dc80: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
+0001dc90: 7220 7020 696e 2070 6f73 6974 696f 6e73  r p in positions
+0001dca0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001dcb0: 2020 7365 7431 203d 206f 7073 2e75 6e61    set1 = ops.una
+0001dcc0: 7279 5f75 6e69 6f6e 2873 656c 662e 6765  ry_union(self.ge
+0001dcd0: 745f 706f 6c79 676f 6e73 5f6f 6e5f 736c  t_polygons_on_sl
+0001dce0: 6963 6528 7669 6577 2c20 706f 733d 7029  ice(view, pos=p)
+0001dcf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001dd00: 2020 7365 7432 203d 206f 7073 2e75 6e61    set2 = ops.una
+0001dd10: 7279 5f75 6e69 6f6e 286f 7468 6572 2e67  ry_union(other.g
+0001dd20: 6574 5f70 6f6c 7967 6f6e 735f 6f6e 5f73  et_polygons_on_s
+0001dd30: 6c69 6365 2876 6965 772c 2070 6f73 3d70  lice(view, pos=p
+0001dd40: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0001dd50: 2020 2069 6e74 6572 7365 6374 696f 6e20     intersection 
+0001dd60: 2b3d 2073 6574 312e 696e 7465 7273 6563  += set1.intersec
+0001dd70: 7469 6f6e 2873 6574 3229 2e61 7265 6120  tion(set2).area 
+0001dd80: 2a20 6661 6374 6f72 0a20 2020 2020 2020  * factor.       
+0001dd90: 2020 2020 2020 2020 2075 6e69 6f6e 202b           union +
+0001dda0: 3d20 7365 7431 2e75 6e69 6f6e 2873 6574  = set1.union(set
+0001ddb0: 3229 2e61 7265 6120 2a20 6661 6374 6f72  2).area * factor
+0001ddc0: 0a0a 2020 2020 2020 2020 2320 4361 6c63  ..        # Calc
+0001ddd0: 756c 6174 6520 696e 7465 7273 6563 7469  ulate intersecti
+0001dde0: 6f6e 7320 616e 6420 6172 6561 7320 6672  ons and areas fr
+0001ddf0: 6f6d 2062 696e 6172 7920 6d61 736b 2076  om binary mask v
+0001de00: 6f78 656c 2063 6f75 6e74 730a 2020 2020  oxel counts.    
+0001de10: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
+0001de20: 2020 2020 2020 2023 2055 7365 2033 4420         # Use 3D 
+0001de30: 6d61 736b 0a20 2020 2020 2020 2020 2020  mask.           
+0001de40: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
+0001de50: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
+0001de60: 2020 2020 2020 6461 7461 3120 3d20 7365        data1 = se
+0001de70: 6c66 2e67 6574 5f6d 6173 6b28 7669 6577  lf.get_mask(view
+0001de80: 2c20 666c 6174 7465 6e2c 2073 7461 6e64  , flatten, stand
+0001de90: 6172 6469 7365 3d54 7275 6529 0a20 2020  ardise=True).   
+0001dea0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0001deb0: 6132 203d 206f 7468 6572 2e67 6574 5f6d  a2 = other.get_m
+0001dec0: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
+0001ded0: 6e2c 2073 7461 6e64 6172 6469 7365 3d54  n, standardise=T
+0001dee0: 7275 6529 0a0a 2020 2020 2020 2020 2020  rue)..          
+0001def0: 2020 2320 4f74 6865 7277 6973 652c 2075    # Otherwise, u
+0001df00: 7365 2073 696e 676c 6520 3244 2073 6c69  se single 2D sli
+0001df10: 6365 0a20 2020 2020 2020 2020 2020 2065  ce.            e
+0001df20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001df30: 2020 2020 2064 6174 6131 203d 2073 656c       data1 = sel
+0001df40: 662e 6765 745f 736c 6963 6528 7669 6577  f.get_slice(view
+0001df50: 2c20 736c 2c20 6964 782c 2070 6f73 290a  , sl, idx, pos).
+0001df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df70: 6461 7461 3220 3d20 6f74 6865 722e 6765  data2 = other.ge
+0001df80: 745f 736c 6963 6528 7669 6577 2c20 736c  t_slice(view, sl
+0001df90: 2c20 6964 782c 2070 6f73 290a 0a20 2020  , idx, pos)..   
+0001dfa0: 2020 2020 2020 2020 2066 6163 746f 7220           factor 
+0001dfb0: 3d20 766f 7865 6c5f 6172 6561 2069 6620  = voxel_area if 
+0001dfc0: 2873 696e 676c 655f 736c 6963 6520 6f72  (single_slice or
+0001dfd0: 2066 6c61 7474 656e 2920 656c 7365 2076   flatten) else v
+0001dfe0: 6f78 656c 5f76 6f6c 756d 650a 2020 2020  oxel_volume.    
+0001dff0: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
+0001e000: 7469 6f6e 203d 2028 6461 7461 3120 2620  tion = (data1 & 
+0001e010: 6461 7461 3229 2e73 756d 2829 202a 2066  data2).sum() * f
+0001e020: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+0001e030: 2020 756e 696f 6e20 3d20 2864 6174 6131    union = (data1
+0001e040: 207c 2064 6174 6132 292e 7375 6d28 2920   | data2).sum() 
+0001e050: 2a20 6661 6374 6f72 0a20 2020 2020 2020  * factor.       
+0001e060: 2020 2020 206d 6561 6e5f 7369 7a65 203d       mean_size =
+0001e070: 2030 2e35 202a 2028 6461 7461 312e 7375   0.5 * (data1.su
+0001e080: 6d28 2920 2b20 6461 7461 322e 7375 6d28  m() + data2.sum(
+0001e090: 2929 202a 2066 6163 746f 720a 0a20 2020  )) * factor..   
+0001e0a0: 2020 2020 2072 6574 7572 6e20 2869 6e74       return (int
+0001e0b0: 6572 7365 6374 696f 6e2c 2075 6e69 6f6e  ersection, union
+0001e0c0: 2c20 6d65 616e 5f73 697a 6529 0a0a 2020  , mean_size)..  
+0001e0d0: 2020 6465 6620 6765 745f 6d65 7472 6963    def get_metric
+0001e0e0: 5f62 795f 736c 6963 6528 7365 6c66 2c20  _by_slice(self, 
+0001e0f0: 6f74 6865 722c 206d 6574 7269 633d 4e6f  other, metric=No
+0001e100: 6e65 2c20 6279 5f73 6c69 6365 3d4e 6f6e  ne, by_slice=Non
+0001e110: 652c 0a20 2020 2020 2020 2020 2020 2076  e,.            v
+0001e120: 6965 773d 2278 2d79 222c 206d 6574 686f  iew="x-y", metho
+0001e130: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
+0001e140: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+0001e150: 2064 6963 7469 6f6e 6172 7920 6f66 2073   dictionary of s
+0001e160: 6c69 6365 2d62 792d 736c 6963 6520 7661  lice-by-slice va
+0001e170: 6c75 6573 2066 6f72 2063 6f6d 7061 7269  lues for compari
+0001e180: 736f 6e20 6d65 7472 6963 2e0a 0a20 2020  son metric...   
+0001e190: 2020 2020 2045 6163 6820 6b65 7920 6f66       Each key of
+0001e1a0: 2074 6865 2072 6574 7572 6e65 6420 6469   the returned di
+0001e1b0: 6374 696f 6e61 7279 2069 7320 6120 736c  ctionary is a sl
+0001e1c0: 6963 6520 706f 7369 7469 6f6e 2028 6d6d  ice position (mm
+0001e1d0: 292c 2061 6e64 0a20 2020 2020 2020 2074  ), and.        t
+0001e1e0: 6865 2061 7373 6f63 6961 7465 6420 7661  he associated va
+0001e1f0: 6c75 6520 6973 2074 6865 206d 6574 7269  lue is the metri
+0001e200: 6320 7661 6c75 6520 666f 7220 7468 6520  c value for the 
+0001e210: 736c 6963 652e 0a0a 2020 2020 2020 2020  slice...        
+0001e220: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+0001e230: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
+0001e240: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+0001e250: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
+0001e260: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
+0001e270: 524f 492e 0a0a 2020 2020 2020 2020 6d65  ROI...        me
+0001e280: 7472 6963 203a 2073 7472 2c20 6465 6661  tric : str, defa
+0001e290: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0001e2a0: 2020 2020 204d 6574 7269 6320 746f 2062       Metric to b
+0001e2b0: 6520 6576 616c 7561 7465 642e 0a0a 2020  e evaluated...  
+0001e2c0: 2020 2020 2020 6279 5f73 6c69 6365 3a20        by_slice: 
+0001e2d0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+0001e2e0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+0001e2f0: 6963 6573 2074 6f20 6265 2063 6f6e 7369  ices to be consi
+0001e300: 6465 7265 642e 2020 5468 6520 7661 6c69  dered.  The vali
+0001e310: 6420 7370 6563 6966 6963 6174 696f 6e73  d specifications
+0001e320: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
+0001e330: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+0001e340: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+0001e350: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+0001e360: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+0001e370: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
+0001e380: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+0001e390: 6f6e 7461 696e 696e 6720 6f74 6865 7220  ontaining other 
+0001e3a0: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001e3b0: 202d 2022 756e 696f 6e22 3a20 636f 6e73   - "union": cons
+0001e3c0: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+0001e3d0: 6169 6e69 6e67 2065 6974 6865 7220 6f66  aining either of
+0001e3e0: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
+0001e3f0: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001e400: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
+0001e410: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
+0001e420: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+0001e430: 7468 206f 6620 7365 6c66 2061 6e64 0a20  th of self and. 
+0001e440: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+0001e450: 6572 2072 6f69 2e0a 0a20 2020 2020 2020  er roi...       
+0001e460: 2020 2020 2049 6620 4e6f 6e65 2c20 7573       If None, us
+0001e470: 6520 736b 7274 2e63 6f72 652e 4465 6661  e skrt.core.Defa
+0001e480: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
+0001e490: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+0001e4a0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+0001e4b0: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+0001e4c0: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
+0001e4d0: 6963 6573 206f 6e20 7768 6963 6820 746f  ices on which to
+0001e4e0: 2067 6574 206d 6574 7269 6320 7661 6c75   get metric valu
+0001e4f0: 6573 2e0a 0a20 2020 2020 2020 206d 6574  es...        met
+0001e500: 686f 6420 3a20 7374 722c 2064 6566 6175  hod : str, defau
+0001e510: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0001e520: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
+0001e530: 6520 666f 7220 6d65 7472 6963 2063 616c  e for metric cal
+0001e540: 6375 6c61 7469 6f6e 2e20 4361 6e20 6265  culation. Can be
+0001e550: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0001e560: 2020 202d 2022 636f 6e74 6f75 7222 3a20     - "contour": 
+0001e570: 6361 6c63 756c 6174 6520 6d65 7472 6963  calculate metric
+0001e580: 2066 726f 6d20 7368 6170 656c 7920 636f   from shapely co
+0001e590: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+0001e5a0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0001e5b0: 3a20 6361 6c63 7561 6c74 6520 6d65 7472  : calcualte metr
+0001e5c0: 6963 2066 726f 6d20 6269 6e61 7279 206d  ic from binary m
+0001e5d0: 6173 6b73 2e0a 2020 2020 2020 2020 2020  asks..          
+0001e5e0: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
+0001e5f0: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
+0001e600: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
+0001e610: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 2020  _geom_method..  
+0001e620: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001e630: 2020 6966 206d 6574 7269 6320 6e6f 7420    if metric not 
+0001e640: 696e 2067 6574 5f63 6f6d 7061 7269 736f  in get_compariso
+0001e650: 6e5f 6d65 7472 6963 7328 293a 0a20 2020  n_metrics():.   
+0001e660: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
+0001e670: 756e 7469 6d65 4572 726f 7228 6622 4d65  untimeError(f"Me
+0001e680: 7472 6963 207b 6d65 7472 6963 7d20 6e6f  tric {metric} no
+0001e690: 7420 7265 636f 676e 6973 6564 2062 7920  t recognised by 
+0001e6a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001e6b0: 2020 2020 2020 2020 2020 2252 4f49 2e67            "ROI.g
+0001e6c0: 6574 5f6d 6574 7269 635f 6279 5f73 6c69  et_metric_by_sli
+0001e6d0: 6365 2829 2229 0a0a 2020 2020 2020 2020  ce()")..        
+0001e6e0: 6279 5f73 6c69 6365 203d 2062 795f 736c  by_slice = by_sl
+0001e6f0: 6963 6520 6f72 2073 6b72 742e 636f 7265  ice or skrt.core
+0001e700: 2e44 6566 6175 6c74 7328 292e 6279 5f73  .Defaults().by_s
+0001e710: 6c69 6365 0a0a 2020 2020 2020 2020 7265  lice..        re
+0001e720: 7475 726e 207b 706f 733a 2067 6574 6174  turn {pos: getat
+0001e730: 7472 2873 656c 662c 2066 2267 6574 5f7b  tr(self, f"get_{
+0001e740: 6765 745f 6d65 7472 6963 5f6d 6574 686f  get_metric_metho
+0001e750: 6428 6d65 7472 6963 297d 2229 280a 2020  d(metric)}")(.  
+0001e760: 2020 2020 2020 2020 2020 6f74 6865 722c            other,
+0001e770: 2073 696e 676c 655f 736c 6963 653d 5472   single_slice=Tr
+0001e780: 7565 2c20 7669 6577 3d76 6965 772c 2070  ue, view=view, p
+0001e790: 6f73 3d70 6f73 2c20 6d65 7468 6f64 3d6d  os=pos, method=m
+0001e7a0: 6574 686f 6429 0a20 2020 2020 2020 2020  ethod).         
+0001e7b0: 2020 2066 6f72 2070 6f73 2069 6e20 7365     for pos in se
+0001e7c0: 6c66 2e67 6574 5f73 6c69 6365 5f70 6f73  lf.get_slice_pos
+0001e7d0: 6974 696f 6e73 286f 7468 6572 2c20 7669  itions(other, vi
+0001e7e0: 6577 2c20 6d65 7468 6f64 3d62 795f 736c  ew, method=by_sl
+0001e7f0: 6963 6529 7d0a 0a20 2020 2064 6566 2067  ice)}..    def g
+0001e800: 6574 5f73 6c69 6365 5f73 7461 7428 7365  et_slice_stat(se
+0001e810: 6c66 2c20 6f74 6865 722c 206d 6574 7269  lf, other, metri
+0001e820: 633d 4e6f 6e65 2c20 736c 6963 655f 7374  c=None, slice_st
+0001e830: 6174 3d4e 6f6e 652c 2062 795f 736c 6963  at=None, by_slic
+0001e840: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0001e850: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
+0001e860: 6e65 3d4e 6f6e 652c 2076 6965 773d 2278  ne=None, view="x
+0001e870: 2d79 222c 206d 6574 686f 643d 4e6f 6e65  -y", method=None
+0001e880: 2c20 2a2a 736c 6963 655f 7374 6174 5f6b  , **slice_stat_k
+0001e890: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0001e8a0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+0001e8b0: 7374 6174 6973 7469 6320 666f 7220 736c  statistic for sl
+0001e8c0: 6963 652d 6279 2d73 6c69 6365 2063 6f6d  ice-by-slice com
+0001e8d0: 7061 7269 736f 6e20 6d65 7472 6963 2e0a  parison metric..
+0001e8e0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0001e8f0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
+0001e900: 2020 6f74 6865 7220 3a20 524f 490a 2020    other : ROI.  
+0001e910: 2020 2020 2020 2020 2020 4f74 6865 7220            Other 
+0001e920: 524f 4920 746f 2063 6f6d 7061 7265 2077  ROI to compare w
+0001e930: 6974 6820 7468 6973 2052 4f49 2e0a 0a20  ith this ROI... 
+0001e940: 2020 2020 2020 206d 6574 7269 6320 3a20         metric : 
+0001e950: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+0001e960: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
+0001e970: 7472 6963 2066 6f72 2077 6869 6368 2073  tric for which s
+0001e980: 7461 7469 7374 6963 2066 6f72 2073 6c69  tatistic for sli
+0001e990: 6365 2d62 792d 736c 6963 6520 7661 6c75  ce-by-slice valu
+0001e9a0: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
+0001e9b0: 7320 746f 2062 6520 7265 7475 726e 6564  s to be returned
+0001e9c0: 2e0a 0a20 2020 2020 2020 2073 6c69 6365  ...        slice
+0001e9d0: 5f73 7461 7420 3a20 7374 722c 2064 6566  _stat : str, def
+0001e9e0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001e9f0: 2020 2020 2020 5369 6e67 6c65 2d76 6172        Single-var
+0001ea00: 6961 626c 6520 7374 6174 6973 7469 6328  iable statistic(
+0001ea10: 7329 2074 6f20 6265 2072 6574 7572 6e65  s) to be returne
+0001ea20: 6420 666f 7220 736c 6963 652d 6279 2d73  d for slice-by-s
+0001ea30: 6c69 6365 0a20 2020 2020 2020 2020 2020  lice.           
+0001ea40: 2044 6963 6520 7363 6f72 6573 2e20 2054   Dice scores.  T
+0001ea50: 6869 7320 7368 6f75 6c64 2062 6520 7468  his should be th
+0001ea60: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
+0001ea70: 6e63 7469 6f6e 2066 6f72 0a20 2020 2020  nction for.     
+0001ea80: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
+0001ea90: 6f6e 206f 6620 7468 6520 7374 6174 6973  on of the statis
+0001eaa0: 7469 6328 7329 2069 6e20 7468 6520 5079  tic(s) in the Py
+0001eab0: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
+0001eac0: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
+0001ead0: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
+0001eae0: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
+0001eaf0: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
+0001eb00: 732e 6874 6d6c 0a0a 2020 2020 2020 2020  s.html..        
+0001eb10: 2020 2020 4176 6169 6c61 626c 6520 6f70      Available op
+0001eb20: 7469 6f6e 7320 696e 636c 7564 653a 2022  tions include: "
+0001eb30: 6d65 616e 222c 2022 6d65 6469 616e 222c  mean", "median",
+0001eb40: 2022 6d6f 6465 222c 0a20 2020 2020 2020   "mode",.       
+0001eb50: 2020 2020 2022 7374 6465 7622 2c20 2271       "stdev", "q
+0001eb60: 7561 6e74 696c 6573 222e 0a0a 2020 2020  uantiles"...    
+0001eb70: 2020 2020 6279 5f73 6c69 6365 3a20 7374      by_slice: st
+0001eb80: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0001eb90: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
+0001eba0: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
+0001ebb0: 7265 642e 2020 5468 6520 7661 6c69 6420  red.  The valid 
+0001ebc0: 7370 6563 6966 6963 6174 696f 6e73 2061  specifications a
+0001ebd0: 7265 3a0a 0a20 2020 2020 2020 2020 2020  re:..           
+0001ebe0: 202d 2022 6c65 6674 223a 2063 6f6e 7369   - "left": consi
+0001ebf0: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
+0001ec00: 636f 6e74 6169 6e69 6e67 2073 656c 663b  containing self;
+0001ec10: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+0001ec20: 7269 6768 7422 3a20 636f 6e73 6964 6572  right": consider
+0001ec30: 206f 6e6c 7920 736c 6963 6573 2063 6f6e   only slices con
+0001ec40: 7461 696e 696e 6720 6f74 6865 7220 726f  taining other ro
+0001ec50: 693b 0a20 2020 2020 2020 2020 2020 202d  i;.            -
+0001ec60: 2022 756e 696f 6e22 3a20 636f 6e73 6964   "union": consid
+0001ec70: 6572 2073 6c69 6365 7320 636f 6e74 6169  er slices contai
+0001ec80: 6e69 6e67 2065 6974 6865 7220 6f66 2073  ning either of s
+0001ec90: 656c 6620 616e 6420 6f74 6865 7220 726f  elf and other ro
+0001eca0: 693b 0a20 2020 2020 2020 2020 2020 202d  i;.            -
+0001ecb0: 2022 696e 7465 7273 6563 7469 6f6e 223a   "intersection":
+0001ecc0: 2063 6f6e 7369 6465 7220 736c 6963 6573   consider slices
+0001ecd0: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
+0001ece0: 206f 6620 7365 6c66 2061 6e64 0a20 2020   of self and.   
+0001ecf0: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0001ed00: 2072 6f69 2e0a 0a20 2020 2020 2020 2020   roi...         
+0001ed10: 2020 2049 6620 4e6f 6e65 2c20 7573 6520     If None, use 
+0001ed20: 736b 7274 2e63 6f72 652e 4465 6661 756c  skrt.core.Defaul
+0001ed30: 7473 2829 2e62 795f 736c 6963 650a 0a20  ts().by_slice.. 
+0001ed40: 2020 2020 2020 2076 616c 7565 5f66 6f72         value_for
+0001ed50: 5f6e 6f6e 6520 3a20 666c 6f61 742c 2064  _none : float, d
+0001ed60: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001ed70: 2020 2020 2020 2020 5661 6c75 6520 746f          Value to
+0001ed80: 2073 7562 7374 6974 7574 6520 666f 7220   substitute for 
+0001ed90: 616e 7920 4e6f 6e65 2076 616c 7565 7320  any None values 
+0001eda0: 616d 6f6e 6720 736c 6963 650a 2020 2020  among slice.    
+0001edb0: 2020 2020 2020 2020 6d65 7472 6963 2076          metric v
+0001edc0: 616c 7565 732e 2020 4966 204e 6f6e 652c  alues.  If None,
+0001edd0: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
+0001ede0: 6e67 2074 6865 206d 6574 7269 6320 7661  ng the metric va
+0001edf0: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
+0001ee00: 2061 7265 206f 6d69 7474 6564 2e0a 0a20   are omitted... 
+0001ee10: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
+0001ee20: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
+0001ee30: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
+0001ee40: 656e 7461 7469 6f6e 206f 6620 736c 6963  entation of slic
+0001ee50: 6573 206f 6e20 7768 6963 6820 746f 2067  es on which to g
+0001ee60: 6574 206d 6574 7269 6320 7661 6c75 6573  et metric values
+0001ee70: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
+0001ee80: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
+0001ee90: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001eea0: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
+0001eeb0: 666f 7220 6d65 7472 6963 2063 616c 6375  for metric calcu
+0001eec0: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
+0001eed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001eee0: 202d 2022 636f 6e74 6f75 7222 3a20 6361   - "contour": ca
+0001eef0: 6c63 756c 6174 6520 6d65 7472 6963 2066  lculate metric f
+0001ef00: 726f 6d20 7368 6170 656c 7920 636f 6e74  rom shapely cont
+0001ef10: 6f75 7273 2e0a 2020 2020 2020 2020 2020  ours..          
+0001ef20: 2020 2020 2020 2d20 226d 6173 6b22 3a20        - "mask": 
+0001ef30: 6361 6c63 7561 6c74 6520 6d65 7472 6963  calcualte metric
+0001ef40: 2066 726f 6d20 6269 6e61 7279 206d 6173   from binary mas
+0001ef50: 6b73 2e0a 2020 2020 2020 2020 2020 2020  ks..            
+0001ef60: 2020 2020 2d20 4e6f 6e65 3a20 7573 6520      - None: use 
+0001ef70: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
+0001ef80: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
+0001ef90: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
+0001efa0: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
+0001efb0: 6b77 6172 6773 203a 2064 6963 742c 2064  kwargs : dict, d
+0001efc0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001efd0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+0001efe0: 6172 6775 6d65 6e74 7320 746f 2062 6520  arguments to be 
+0001eff0: 7061 7373 6564 2074 6f20 6675 6e63 7469  passed to functi
+0001f000: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
+0001f010: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+0001f020: 756c 6520 666f 7220 6361 6c63 756c 6174  ule for calculat
+0001f030: 696f 6e20 7265 6c61 7469 7665 2074 6f20  ion relative to 
+0001f040: 736c 6963 6520 7661 6c75 6573 2e20 2046  slice values.  F
+0001f050: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
+0001f060: 2020 2020 2020 2020 6966 2071 7561 6e74          if quant
+0001f070: 696c 6573 2061 7265 2072 6571 7569 7265  iles are require
+0001f080: 6420 666f 7220 3130 2069 6e74 6572 7661  d for 10 interva
+0001f090: 6c73 2c20 7261 7468 6572 2074 6861 6e20  ls, rather than 
+0001f0a0: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+0001f0b0: 7468 6520 6465 6661 756c 7420 6f66 2034  the default of 4
+0001f0c0: 2c20 7468 6973 2063 616e 2062 6520 7370  , this can be sp
+0001f0d0: 6563 6966 6965 6420 7573 696e 673a 0a0a  ecified using:..
+0001f0e0: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+0001f0f0: 655f 7374 6174 5f6b 7761 7267 737b 226e  e_stat_kwargs{"n
+0001f100: 2220 3a20 3130 7d0a 0a20 2020 2020 2020  " : 10}..       
+0001f110: 2020 2020 2046 6f72 2061 7661 696c 6162       For availab
+0001f120: 6c65 206b 6579 776f 7264 206f 7074 696f  le keyword optio
+0001f130: 6e73 2c20 7365 6520 646f 6375 6d65 6e74  ns, see document
+0001f140: 6174 696f 6e20 6f66 2073 7461 7469 7374  ation of statist
+0001f150: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+0001f160: 6d6f 6475 6c65 2061 743a 0a0a 2020 2020  module at:..    
+0001f170: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0001f180: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+0001f190: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
+0001f1a0: 7469 6373 2e68 746d 6c0a 2020 2020 2020  tics.html.      
+0001f1b0: 2020 2222 220a 2020 2020 2020 2020 6279    """.        by
+0001f1c0: 5f73 6c69 6365 203d 2062 795f 736c 6963  _slice = by_slic
+0001f1d0: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
+0001f1e0: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
+0001f1f0: 6365 0a20 2020 2020 2020 2073 6c69 6365  ce.        slice
+0001f200: 5f73 7461 745f 6b77 6172 6773 203d 2073  _stat_kwargs = s
+0001f210: 6c69 6365 5f73 7461 745f 6b77 6172 6773  lice_stat_kwargs
+0001f220: 206f 7220 7b7d 0a0a 2020 2020 2020 2020   or {}..        
+0001f230: 7265 7475 726e 2073 6b72 742e 636f 7265  return skrt.core
+0001f240: 2e67 6574 5f73 7461 7428 7365 6c66 2e67  .get_stat(self.g
+0001f250: 6574 5f6d 6574 7269 635f 6279 5f73 6c69  et_metric_by_sli
+0001f260: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+0001f270: 6f74 6865 722c 206d 6574 7269 632c 2062  other, metric, b
+0001f280: 795f 736c 6963 652c 2076 6965 772c 206d  y_slice, view, m
+0001f290: 6574 686f 6429 2c0a 2020 2020 2020 2020  ethod),.        
+0001f2a0: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
+0001f2b0: 6e65 2c20 736c 6963 655f 7374 6174 2c20  ne, slice_stat, 
+0001f2c0: 2a2a 736c 6963 655f 7374 6174 5f6b 7761  **slice_stat_kwa
+0001f2d0: 7267 7329 0a0a 2020 2020 6465 6620 6765  rgs)..    def ge
+0001f2e0: 745f 736c 6963 655f 7374 6174 7328 7365  t_slice_stats(se
+0001f2f0: 6c66 2c20 6f74 6865 722c 206d 6574 7269  lf, other, metri
+0001f300: 6373 3d4e 6f6e 652c 2073 6c69 6365 5f73  cs=None, slice_s
+0001f310: 7461 7473 3d4e 6f6e 652c 0a20 2020 2020  tats=None,.     
+0001f320: 2020 2020 2020 2064 6566 6175 6c74 5f62         default_b
+0001f330: 795f 736c 6963 653d 4e6f 6e65 2c20 6d65  y_slice=None, me
+0001f340: 7468 6f64 3d4e 6f6e 652c 2076 6965 773d  thod=None, view=
+0001f350: 2278 2d79 222c 0a20 2020 2020 2020 2020  "x-y",.         
+0001f360: 2020 2073 6570 6172 6174 655f 636f 6d70     separate_comp
+0001f370: 6f6e 656e 7473 3d46 616c 7365 293a 0a20  onents=False):. 
+0001f380: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001f390: 2020 2047 6574 2064 6963 7469 6f6e 6172     Get dictionar
+0001f3a0: 7920 6f66 2073 7461 7469 7374 6963 7320  y of statistics 
+0001f3b0: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
+0001f3c0: 6365 2063 6f6d 7061 7269 736f 6e20 6d65  ce comparison me
+0001f3d0: 7472 6963 732e 0a0a 2020 2020 2020 2020  trics...        
+0001f3e0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+0001f3f0: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
+0001f400: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+0001f410: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
+0001f420: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
+0001f430: 524f 492e 0a0a 2020 2020 2020 2020 6d65  ROI...        me
+0001f440: 7472 6963 7320 3a20 7374 722f 6c69 7374  trics : str/list
+0001f450: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0001f460: 2020 2020 2020 2020 2020 204d 6574 7269             Metri
+0001f470: 6328 7329 2066 6f72 2077 6869 6368 2073  c(s) for which s
+0001f480: 7461 7469 7374 6963 2873 2920 666f 7220  tatistic(s) for 
+0001f490: 736c 6963 652d 6279 2d73 6c69 6365 2063  slice-by-slice c
+0001f4a0: 616c 6375 6c61 7469 6f6e 730a 2020 2020  alculations.    
+0001f4b0: 2020 2020 2020 2020 6172 6520 746f 2062          are to b
+0001f4c0: 6520 7265 7475 726e 6564 2e20 2041 2073  e returned.  A s
+0001f4d0: 696e 676c 6520 6d65 7472 6963 2063 616e  ingle metric can
+0001f4e0: 2062 7920 7370 6566 6963 6965 6420 6173   by speficied as
+0001f4f0: 2061 2073 7472 696e 672e 0a20 2020 2020   a string..     
+0001f500: 2020 2020 2020 204d 756c 7469 706c 6520         Multiple 
+0001f510: 6d65 7472 6963 7320 6361 6e20 6265 2073  metrics can be s
+0001f520: 7065 6369 6669 6564 2061 7320 6120 6c69  pecified as a li
+0001f530: 7374 206f 6620 7374 7269 6e67 732e 0a0a  st of strings...
+0001f540: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+0001f550: 6174 7320 3a20 7374 722f 6c69 7374 2f64  ats : str/list/d
+0001f560: 6963 742c 2064 6566 6175 6c74 3d4e 6f6e  ict, default=Non
+0001f570: 650a 2020 2020 2020 2020 2020 2020 5370  e.            Sp
+0001f580: 6563 6966 6963 6174 696f 6e20 6f66 2073  ecification of s
+0001f590: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+0001f5a0: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
+0001f5b0: 6976 650a 2020 2020 2020 2020 2020 2020  ive.            
+0001f5c0: 746f 2073 6c69 6365 2d62 792d 736c 6963  to slice-by-slic
+0001f5d0: 6520 6d65 7472 6963 2076 616c 7565 732e  e metric values.
+0001f5e0: 2020 5573 6564 2066 6f72 2061 6c6c 206d    Used for all m
+0001f5f0: 6574 7269 6373 2077 6974 680a 2020 2020  etrics with.    
+0001f600: 2020 2020 2020 2020 7375 6666 6978 2022          suffix "
+0001f610: 5f73 6c69 6365 5f73 7461 7473 2220 696e  _slice_stats" in
+0001f620: 2074 6865 203c 6d65 7472 6963 733e 206c   the <metrics> l
+0001f630: 6973 742e 0a0a 2020 2020 2020 2020 2020  ist...          
+0001f640: 2020 4120 7374 6174 6973 7469 6320 6973    A statistic is
+0001f650: 2073 7065 6369 6669 6564 2062 7920 7468   specified by th
+0001f660: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
+0001f670: 6e63 7469 6f6e 2066 6f72 0a20 2020 2020  nction for.     
+0001f680: 2020 2020 2020 2069 7473 2063 616c 6375         its calcu
+0001f690: 6c61 7469 6f6e 2069 6e20 7468 6520 5079  lation in the Py
+0001f6a0: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
+0001f6b0: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
+0001f6c0: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
+0001f6d0: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
+0001f6e0: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
+0001f6f0: 732e 6874 6d6c 0a0a 2020 2020 2020 2020  s.html..        
+0001f700: 2020 2020 466f 7220 6974 7320 7573 6520      For its use 
+0001f710: 6865 7265 2c20 7468 6520 7265 6c65 7661  here, the releva
+0001f720: 6e74 2066 756e 6374 696f 6e20 6d75 7374  nt function must
+0001f730: 2072 6571 7569 7265 0a20 2020 2020 2020   require.       
+0001f740: 2020 2020 2061 2073 696e 676c 652d 7661       a single-va
+0001f750: 7269 6162 6c65 2069 6e70 7574 2c20 6d75  riable input, mu
+0001f760: 7374 206e 6f74 2072 6571 7569 7265 2061  st not require a
+0001f770: 6e79 206b 6579 776f 7264 0a20 2020 2020  ny keyword.     
+0001f780: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
+0001f790: 2c20 616e 6420 6d75 7374 2072 6574 7572  , and must retur
+0001f7a0: 6e20 6120 7369 6e67 6c65 206e 756d 6265  n a single numbe
+0001f7b0: 722e 0a0a 2020 2020 2020 2020 2020 2020  r...            
+0001f7c0: 4176 6169 6c61 626c 6520 6f70 7469 6f6e  Available option
+0001f7d0: 7320 696e 636c 7564 653a 2022 6d65 616e  s include: "mean
+0001f7e0: 222c 2022 6d65 6469 616e 222c 2022 6d6f  ", "median", "mo
+0001f7f0: 6465 222c 0a20 2020 2020 2020 2020 2020  de",.           
+0001f800: 2022 7374 6465 7622 2e0a 0a20 2020 2020   "stdev"...     
+0001f810: 2020 2020 2020 5374 6174 6973 7469 6373        Statistics
+0001f820: 2074 6f20 6265 2063 616c 6375 6c61 7465   to be calculate
+0001f830: 6420 6361 6e20 6265 2073 7065 6369 6669  d can be specifi
+0001f840: 6564 2075 7369 6e67 2061 6e79 206f 660a  ed using any of.
+0001f850: 2020 2020 2020 2020 2020 2074 6865 2066             the f
+0001f860: 6f6c 6c6f 7769 6e67 3a0a 0a20 2020 2020  ollowing:..     
+0001f870: 2020 2020 2020 2d20 5374 7269 6e67 2073        - String s
+0001f880: 7065 6369 6679 696e 6720 7369 6e67 6c65  pecifying single
+0001f890: 2073 7461 7469 7374 6963 2074 6f20 6265   statistic to be
+0001f8a0: 2063 616c 6375 6c61 7465 642c 0a20 2020   calculated,.   
+0001f8b0: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+0001f8c0: 6c69 6365 7320 636f 6e73 6964 6572 6564  lices considered
+0001f8d0: 2061 7320 6769 7665 6e20 6279 2064 6566   as given by def
+0001f8e0: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
+0001f8f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001f900: 6578 616d 706c 653a 2022 6d65 616e 223b  example: "mean";
+0001f910: 0a20 2020 2020 2020 2020 2020 2d20 4c69  .           - Li
+0001f920: 7374 2073 7065 6369 6679 696e 6720 6d75  st specifying mu
+0001f930: 6c74 6970 6c65 2073 7461 7469 7374 6963  ltiple statistic
+0001f940: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
+0001f950: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+0001f960: 2077 6974 6820 736c 6963 6573 2063 6f6e   with slices con
+0001f970: 7369 6465 7265 6420 6173 2067 6976 656e  sidered as given
+0001f980: 2062 7920 6465 6661 756c 745f 6279 5f73   by default_by_s
+0001f990: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
+0001f9a0: 2020 2066 6f72 2065 7861 6d70 6c65 3a20     for example: 
+0001f9b0: 5b22 6d65 616e 222c 2022 7374 6465 7622  ["mean", "stdev"
+0001f9c0: 5d3b 0a20 2020 2020 2020 2020 2020 2d20  ];.           - 
+0001f9d0: 4469 6374 696f 6e61 7279 2077 6865 7265  Dictionary where
+0001f9e0: 206b 6579 7320 7370 6563 6966 7920 736c   keys specify sl
+0001f9f0: 6963 6573 2074 6f20 6265 2063 6f6e 7369  ices to be consi
+0001fa00: 6465 7265 642c 0a20 2020 2020 2020 2020  dered,.         
+0001fa10: 2020 2020 616e 6420 7661 6c75 6573 2073      and values s
+0001fa20: 7065 6369 6679 2073 7461 7469 7374 6963  pecify statistic
+0001fa30: 7320 2873 7472 696e 6720 6f72 206c 6973  s (string or lis
+0001fa40: 7429 2c20 666f 720a 2020 2020 2020 2020  t), for.        
+0001fa50: 2020 2020 2065 7861 6d70 6c65 3a20 7b22       example: {"
+0001fa60: 756e 696f 6e22 3a20 5b22 6d65 616e 222c  union": ["mean",
+0001fa70: 2022 7374 6465 7622 5d7d 2e20 2056 616c   "stdev"]}.  Val
+0001fa80: 6964 2073 6c69 6365 0a20 2020 2020 2020  id slice.       
+0001fa90: 2020 2020 2020 7370 6563 6966 6963 6174        specificat
+0001faa0: 696f 6e73 2061 7265 2061 7320 6c69 7374  ions are as list
+0001fab0: 6564 2066 6f72 2064 6566 6175 6c74 5f62  ed for default_b
+0001fac0: 795f 736c 6963 652e 0a0a 2020 2020 2020  y_slice...      
+0001fad0: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
+0001fae0: 6365 3a20 7374 722c 2064 6566 6175 6c74  ce: str, default
+0001faf0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0001fb00: 2020 4465 6661 756c 7420 7370 6563 6966    Default specif
+0001fb10: 6963 6174 696f 6e20 6f66 2073 6c69 6365  ication of slice
+0001fb20: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
+0001fb30: 6564 2077 6865 6e0a 2020 2020 2020 2020  ed when.        
+0001fb40: 2020 2020 6361 6c63 756c 6174 696e 6720      calculating 
+0001fb50: 736c 6963 652d 6279 2d73 6c69 6365 2073  slice-by-slice s
+0001fb60: 7461 7469 7374 6963 732e 2020 5468 6520  tatistics.  The 
+0001fb70: 7661 6c69 6420 7370 6563 6966 6963 6174  valid specificat
+0001fb80: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+0001fb90: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
+0001fba0: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+0001fbb0: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+0001fbc0: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+0001fbd0: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+0001fbe0: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
+0001fbf0: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+0001fc00: 6f6e 7461 696e 696e 6720 6f74 6865 7220  ontaining other 
+0001fc10: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001fc20: 202d 2022 756e 696f 6e22 3a20 636f 6e73   - "union": cons
+0001fc30: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+0001fc40: 6169 6e69 6e67 2065 6974 6865 7220 6f66  aining either of
+0001fc50: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
+0001fc60: 726f 693b 0a20 2020 2020 2020 2020 2020  roi;.           
+0001fc70: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
+0001fc80: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
+0001fc90: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+0001fca0: 7468 206f 6620 7365 6c66 2061 6e64 0a20  th of self and. 
+0001fcb0: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+0001fcc0: 6572 2072 6f69 2e0a 0a20 2020 2020 2020  er roi...       
+0001fcd0: 2020 2020 2049 6620 4e6f 6e65 2c20 7573       If None, us
+0001fce0: 6520 736b 7274 2e63 6f72 652e 4465 6661  e skrt.core.Defa
+0001fcf0: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
+0001fd00: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+0001fd10: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+0001fd20: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+0001fd30: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
+0001fd40: 6963 6573 206f 6e20 7768 6963 6820 746f  ices on which to
+0001fd50: 2067 6574 206d 6574 7269 6320 7661 6c75   get metric valu
+0001fd60: 6573 2e0a 0a20 2020 2020 2020 206d 6574  es...        met
+0001fd70: 686f 6420 3a20 7374 722c 2064 6566 6175  hod : str, defau
+0001fd80: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0001fd90: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
+0001fda0: 6520 666f 7220 6d65 7472 6963 2063 616c  e for metric cal
+0001fdb0: 6375 6c61 7469 6f6e 2e20 4361 6e20 6265  culation. Can be
+0001fdc0: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+0001fdd0: 2020 202d 2022 636f 6e74 6f75 7222 3a20     - "contour": 
+0001fde0: 6361 6c63 756c 6174 6520 6d65 7472 6963  calculate metric
+0001fdf0: 2066 726f 6d20 7368 6170 656c 7920 636f   from shapely co
+0001fe00: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+0001fe10: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0001fe20: 3a20 6361 6c63 756c 6174 6520 6d65 7472  : calculate metr
+0001fe30: 6963 2066 726f 6d20 6269 6e61 7279 206d  ic from binary m
+0001fe40: 6173 6b73 2e0a 2020 2020 2020 2020 2020  asks..          
+0001fe50: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
+0001fe60: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
+0001fe70: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
+0001fe80: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 0a20  _geom_method... 
+0001fe90: 2020 2020 2020 2073 6570 6172 6174 655f         separate_
+0001fea0: 636f 6d70 6f6e 656e 7473 3a20 626f 6f6c  components: bool
+0001feb0: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+0001fec0: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+0001fed0: 616c 7365 2c20 7265 7475 726e 2061 206d  alse, return a m
+0001fee0: 6574 7269 6320 7265 7072 6573 656e 7465  etric represente
+0001fef0: 6420 6279 2061 2076 6563 746f 7220 6173  d by a vector as
+0001ff00: 2061 0a20 2020 2020 2020 2020 2020 206c   a.            l
+0001ff10: 6973 7420 6f66 2063 6f6d 706f 6e65 6e74  ist of component
+0001ff20: 2076 616c 7565 732e 2020 4966 2074 7275   values.  If tru
+0001ff30: 652c 2072 6574 7572 6e20 6120 7365 7061  e, return a sepa
+0001ff40: 7261 7465 206d 6574 7269 6320 666f 720a  rate metric for.
+0001ff50: 2020 2020 2020 2020 2020 2020 6561 6368              each
+0001ff60: 2063 6f6d 706f 6e65 6e74 2c20 6c61 6265   component, labe
+0001ff70: 6c6c 696e 6720 6279 2074 6865 2063 6f6d  lling by the com
+0001ff80: 706f 6e65 6e74 2061 7865 7320 6465 7465  ponent axes dete
+0001ff90: 726d 696e 6564 0a20 2020 2020 2020 2020  rmined.         
+0001ffa0: 2020 2066 726f 6d20 3c76 6965 773e 2e0a     from <view>..
+0001ffb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ffc0: 2020 2020 6966 206d 6574 7269 6373 2069      if metrics i
+0001ffd0: 7320 4e6f 6e65 206f 7220 736c 6963 655f  s None or slice_
+0001ffe0: 7374 6174 7320 6973 204e 6f6e 653a 0a20  stats is None:. 
+0001fff0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00020000: 6e20 7b7d 0a0a 2020 2020 2020 2020 6465  n {}..        de
+00020010: 6661 756c 745f 6279 5f73 6c69 6365 203d  fault_by_slice =
+00020020: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
+00020030: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
+00020040: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
+00020050: 6365 0a0a 2020 2020 2020 2020 2320 456e  ce..        # En
+00020060: 7375 7265 2074 6861 7420 6d65 7472 6963  sure that metric
+00020070: 7320 6973 2061 206e 6f6e 2d65 6d70 7479  s is a non-empty
+00020080: 206c 6973 742e 0a20 2020 2020 2020 2069   list..        i
+00020090: 6620 6973 696e 7374 616e 6365 286d 6574  f isinstance(met
+000200a0: 7269 6373 2c20 7374 7229 3a0a 2020 2020  rics, str):.    
+000200b0: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
+000200c0: 3d20 5b6d 6574 7269 6373 5d0a 2020 2020  = [metrics].    
+000200d0: 2020 2020 656c 6966 206e 6f74 2073 6b72      elif not skr
+000200e0: 742e 636f 7265 2e69 735f 6c69 7374 286d  t.core.is_list(m
+000200f0: 6574 7269 6373 293a 0a20 2020 2020 2020  etrics):.       
+00020100: 2020 2020 2072 6574 7572 6e20 7b7d 0a20       return {}. 
+00020110: 2020 2020 2020 206d 6574 7269 6373 203d         metrics =
+00020120: 205b 6d65 7472 6963 2066 6f72 206d 6574   [metric for met
+00020130: 7269 6320 696e 206d 6574 7269 6373 0a20  ric in metrics. 
+00020140: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00020150: 6620 6622 7b6d 6574 7269 637d 5f73 6c69  f f"{metric}_sli
+00020160: 6365 5f73 7461 7473 2220 696e 2067 6574  ce_stats" in get
+00020170: 5f63 6f6d 7061 7269 736f 6e5f 6d65 7472  _comparison_metr
+00020180: 6963 7328 295d 0a20 2020 2020 2020 2069  ics()].        i
+00020190: 6620 6e6f 7420 6d65 7472 6963 733a 0a20  f not metrics:. 
+000201a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000201b0: 6e20 7b7d 0a0a 2020 2020 2020 2020 736c  n {}..        sl
+000201c0: 6963 655f 7374 6174 7320 3d20 6578 7061  ice_stats = expa
+000201d0: 6e64 5f73 6c69 6365 5f73 7461 7473 2873  nd_slice_stats(s
+000201e0: 6c69 6365 5f73 7461 7473 2c20 6465 6661  lice_stats, defa
+000201f0: 756c 745f 6279 5f73 6c69 6365 290a 2020  ult_by_slice).  
+00020200: 2020 2020 2020 6966 206e 6f74 2073 6c69        if not sli
+00020210: 6365 5f73 7461 7473 3a0a 2020 2020 2020  ce_stats:.      
+00020220: 2020 2020 2020 7265 7475 726e 207b 7d0a        return {}.
+00020230: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
+00020240: 6c61 7465 2073 7461 7469 7374 6963 2873  late statistic(s
+00020250: 2920 666f 7220 6d65 7472 6963 2076 616c  ) for metric val
+00020260: 7565 7320 6361 6c63 756c 6174 6564 2073  ues calculated s
+00020270: 6c69 6365 2062 7920 736c 6963 652e 0a20  lice by slice.. 
+00020280: 2020 2020 2020 2063 616c 6375 6c61 7465         calculate
+00020290: 645f 736c 6963 655f 7374 6174 7320 3d20  d_slice_stats = 
+000202a0: 7b7d 0a20 2020 2020 2020 2066 6f72 206d  {}.        for m
+000202b0: 6574 7269 6320 696e 206d 6574 7269 6373  etric in metrics
+000202c0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+000202d0: 7220 6279 5f73 6c69 6365 2c20 7374 6174  r by_slice, stat
+000202e0: 7320 696e 2073 6c69 6365 5f73 7461 7473  s in slice_stats
+000202f0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00020300: 2020 2020 2020 2020 2020 7661 6c75 6573            values
+00020310: 203d 2073 656c 662e 6765 745f 6d65 7472   = self.get_metr
+00020320: 6963 5f62 795f 736c 6963 6528 0a20 2020  ic_by_slice(.   
+00020330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020340: 2020 2020 206f 7468 6572 2c20 6d65 7472       other, metr
+00020350: 6963 2c20 6279 5f73 6c69 6365 2c20 7669  ic, by_slice, vi
+00020360: 6577 2c20 6d65 7468 6f64 290a 2020 2020  ew, method).    
+00020370: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00020380: 7374 6174 2069 6e20 7374 6174 733a 0a20  stat in stats:. 
+00020390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203a0: 2020 206b 6579 203d 2066 227b 6d65 7472     key = f"{metr
+000203b0: 6963 7d5f 736c 6963 655f 7b62 795f 736c  ic}_slice_{by_sl
+000203c0: 6963 657d 5f7b 7374 6174 7d22 0a20 2020  ice}_{stat}".   
+000203d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203e0: 2063 616c 6375 6c61 7465 645f 736c 6963   calculated_slic
+000203f0: 655f 7374 6174 735b 6b65 795d 203d 2028  e_stats[key] = (
+00020400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020410: 2020 2020 2020 2020 2020 2020 2073 6b72               skr
+00020420: 742e 636f 7265 2e67 6574 5f73 7461 7428  t.core.get_stat(
+00020430: 7661 6c75 6573 2c20 7374 6174 3d73 7461  values, stat=sta
+00020440: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+00020450: 2020 2020 2020 2020 6966 2028 736b 7274          if (skrt
+00020460: 2e63 6f72 652e 6973 5f6c 6973 7428 6361  .core.is_list(ca
+00020470: 6c63 756c 6174 6564 5f73 6c69 6365 5f73  lculated_slice_s
+00020480: 7461 7473 5b6b 6579 5d29 0a20 2020 2020  tats[key]).     
+00020490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204a0: 2020 2020 2020 2061 6e64 2073 6570 6172         and separ
+000204b0: 6174 655f 636f 6d70 6f6e 656e 7473 293a  ate_components):
+000204c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000204d0: 2020 2020 2020 2020 2076 6563 746f 7220           vector 
+000204e0: 3d20 6361 6c63 756c 6174 6564 5f73 6c69  = calculated_sli
+000204f0: 6365 5f73 7461 7473 2e70 6f70 286b 6579  ce_stats.pop(key
+00020500: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020510: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+00020520: 2069 5f61 7820 696e 2065 6e75 6d65 7261   i_ax in enumera
+00020530: 7465 2873 6b72 742e 696d 6167 652e 5f70  te(skrt.image._p
+00020540: 6c6f 745f 6178 6573 5b76 6965 775d 293a  lot_axes[view]):
+00020550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020560: 2020 2020 2020 2020 2020 2020 2061 7820               ax 
+00020570: 3d20 736b 7274 2e69 6d61 6765 2e5f 6178  = skrt.image._ax
+00020580: 6573 5b69 5f61 785d 0a20 2020 2020 2020  es[i_ax].       
+00020590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205a0: 2020 2020 2061 785f 6b65 7920 3d20 6622       ax_key = f"
+000205b0: 7b6d 6574 7269 637d 5f7b 6178 7d5f 736c  {metric}_{ax}_sl
+000205c0: 6963 655f 7b62 795f 736c 6963 657d 5f7b  ice_{by_slice}_{
+000205d0: 7374 6174 7d22 0a20 2020 2020 2020 2020  stat}".         
+000205e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205f0: 2020 2063 616c 6375 6c61 7465 645f 736c     calculated_sl
+00020600: 6963 655f 7374 6174 735b 6178 5f6b 6579  ice_stats[ax_key
+00020610: 5d20 3d20 7665 6374 6f72 5b69 5d0a 0a20  ] = vector[i].. 
+00020620: 2020 2020 2020 2072 6574 7572 6e20 6361         return ca
+00020630: 6c63 756c 6174 6564 5f73 6c69 6365 5f73  lculated_slice_s
+00020640: 7461 7473 0a0a 2020 2020 6465 6620 6d61  tats..    def ma
+00020650: 7463 685f 6d61 736b 5f76 6f78 656c 5f73  tch_mask_voxel_s
+00020660: 697a 6528 7365 6c66 2c20 6f74 6865 722c  ize(self, other,
+00020670: 2076 6f78 656c 5f73 697a 653d 4e6f 6e65   voxel_size=None
+00020680: 2c0a 2020 2020 2020 2020 2020 2020 766f  ,.            vo
+00020690: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
+000206a0: 653d 302e 3129 3a0a 2020 2020 2020 2020  e=0.1):.        
+000206b0: 2727 270a 2020 2020 2020 2020 456e 7375  '''.        Ensu
+000206c0: 7265 2074 6861 7420 7468 6520 6d61 736b  re that the mask
+000206d0: 2076 6f78 656c 2073 697a 6573 206f 6620   voxel sizes of 
+000206e0: 3c73 656c 663e 2061 6e64 203c 6f74 6865  <self> and <othe
+000206f0: 723e 206d 6174 6368 2e0a 0a20 2020 2020  r> match...     
+00020700: 2020 2054 6865 206d 6173 6b20 766f 7865     The mask voxe
+00020710: 6c5f 7369 7a65 7320 666f 7220 626f 7468  l_sizes for both
+00020720: 206d 6179 206f 7074 696f 6e61 6c6c 7920   may optionally 
+00020730: 6265 2073 6574 2074 6f20 6120 6e65 770a  be set to a new.
+00020740: 2020 2020 2020 2020 636f 6d6d 6f6e 2076          common v
+00020750: 616c 7565 2e0a 0a20 2020 2020 2020 202a  alue...        *
+00020760: 2a50 6172 616d 7465 7273 3a2a 2a0a 0a20  *Paramters:**.. 
+00020770: 2020 2020 2020 206f 7468 6572 203a 2073         other : s
+00020780: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
+00020790: 4f49 0a20 2020 2020 2020 2020 2020 2052  OI.            R
+000207a0: 4f49 2077 6974 6820 7768 6963 6820 766f  OI with which vo
+000207b0: 7865 6c20 7369 7a65 2069 7320 746f 2062  xel size is to b
+000207c0: 6520 6d61 7463 6865 642e 0a0a 2020 2020  e matched...    
+000207d0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
+000207e0: 2074 7570 6c65 2c20 6465 6661 756c 743d   tuple, default=
+000207f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00020800: 2056 6f78 656c 2073 697a 6520 2864 782c   Voxel size (dx,
+00020810: 2064 792c 2064 7a29 2069 6e20 6d6d 2074   dy, dz) in mm t
+00020820: 6f20 6265 2075 7365 6420 666f 7220 524f  o be used for RO
+00020830: 4920 6d61 736b 730a 2020 2020 2020 2020  I masks.        
+00020840: 2020 2020 6672 6f6d 2077 6869 6368 2074      from which t
+00020850: 6f20 6361 6c63 756c 6174 6520 7375 7266  o calculate surf
+00020860: 6163 6520 6469 7374 616e 6365 732e 2020  ace distances.  
+00020870: 4966 204e 6f6e 652c 0a20 2020 2020 2020  If None,.       
+00020880: 2020 2020 2074 6865 206d 6173 6b20 766f       the mask vo
+00020890: 7865 6c20 7369 7a65 206f 6620 3c6f 7468  xel size of <oth
+000208a0: 6572 3e20 6973 2075 7365 6420 6966 206e  er> is used if n
+000208b0: 6f74 204e 6f6e 653b 0a20 2020 2020 2020  ot None;.       
+000208c0: 2020 2020 206f 7468 6572 7769 7365 2074       otherwise t
+000208d0: 6865 2064 6566 6175 6c74 2076 6f78 656c  he default voxel
+000208e0: 2073 697a 6520 666f 7220 6475 6d6d 7920   size for dummy 
+000208f0: 696d 6167 6573 2c0a 2020 2020 2020 2020  images,.        
+00020900: 2020 2020 6e61 6d65 6c79 2028 312c 2031      namely (1, 1
+00020910: 2c20 3129 2c20 6973 2075 7365 642e 2020  , 1), is used.  
+00020920: 4966 2061 6e20 656c 656d 656e 7420 6f66  If an element of
+00020930: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00020940: 2074 7570 6c65 2073 7065 6369 6679 696e   tuple specifyin
+00020950: 6720 766f 7865 6c20 7369 7a65 2069 7320  g voxel size is 
+00020960: 4e6f 6e65 2c20 7468 6520 7661 6c75 6520  None, the value 
+00020970: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00020980: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
+00020990: 6720 656c 656d 656e 7420 6f66 2074 6865  g element of the
+000209a0: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
+000209b0: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
+000209c0: 3c6f 7468 6572 3e20 6973 2075 7365 642e  <other> is used.
+000209d0: 0a0a 2020 2020 2020 2020 766f 7865 6c5f  ..        voxel_
+000209e0: 6469 6d5f 746f 6c65 7261 6e63 6520 3a20  dim_tolerance : 
+000209f0: 666c 6f61 742c 2064 6566 6175 6c74 3d30  float, default=0
+00020a00: 2e31 0a20 2020 2020 2020 2020 2020 204d  .1.            M
+00020a10: 6178 696d 756d 2061 6363 6570 7465 6420  aximum accepted 
+00020a20: 7661 6c75 6520 666f 7220 7468 6520 6162  value for the ab
+00020a30: 736f 6c75 7465 2064 6966 6665 7265 6e63  solute differenc
+00020a40: 6520 696e 2076 6f78 656c 2073 697a 650a  e in voxel size.
+00020a50: 2020 2020 2020 2020 2020 2020 2861 6e79              (any
+00020a60: 2064 696d 656e 7369 6f6e 2920 6f66 2074   dimension) of t
+00020a70: 6865 2052 4f49 206d 6173 6b73 2066 6f72  he ROI masks for
+00020a80: 2074 6865 6d20 746f 2062 6520 636f 6e73   them to be cons
+00020a90: 6964 6572 6564 0a20 2020 2020 2020 2020  idered.         
+00020aa0: 2020 2061 7320 6861 7669 6e67 2074 6865     as having the
+00020ab0: 2073 616d 6520 766f 7865 6c20 7369 7a65   same voxel size
+00020ac0: 2e20 2049 6620 6120 6e65 6761 7469 7665  .  If a negative
+00020ad0: 2076 616c 7565 2069 7320 6769 7665 6e2c   value is given,
+00020ae0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00020af0: 2061 6273 6f6c 7574 6520 6469 6666 6572   absolute differ
+00020b00: 656e 6365 2069 7320 6e65 7665 7220 6265  ence is never be
+00020b10: 6c6f 7720 7468 6973 2c20 666f 7263 696e  low this, forcin
+00020b20: 6720 6372 6561 7469 6f6e 0a20 2020 2020  g creation.     
+00020b30: 2020 2020 2020 206f 6620 6e65 7720 6d61         of new ma
+00020b40: 736b 7320 7769 7468 2074 6865 2074 6865  sks with the the
+00020b50: 2073 7065 6369 6669 6564 2076 6f78 656c   specified voxel
+00020b60: 2073 697a 652e 2020 5468 6973 2063 616e   size.  This can
+00020b70: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00020b80: 7573 6566 756c 2066 6f72 206f 6274 6169  useful for obtai
+00020b90: 6e69 6e67 206d 6173 6b73 2074 6861 7420  ning masks that 
+00020ba0: 6172 6520 6a75 7374 206c 6172 6765 2065  are just large e
+00020bb0: 6e6f 7567 6820 746f 2063 6f6e 7461 696e  nough to contain
+00020bc0: 0a20 2020 2020 2020 2020 2020 2062 6f74  .            bot
+00020bd0: 6820 524f 4973 2c20 706f 7465 6e74 6961  h ROIs, potentia
+00020be0: 6c6c 7920 7265 6475 6369 6e67 2074 6865  lly reducing the
+00020bf0: 2074 696d 6520 666f 7220 7375 7266 6163   time for surfac
+00020c00: 652d 6469 7374 616e 6365 0a20 2020 2020  e-distance.     
+00020c10: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
+00020c20: 6f6e 732e 0a20 2020 2020 2020 2027 2727  ons..        '''
+00020c30: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
+00020c40: 6520 524f 4920 636c 6f6e 6573 2c20 666f  e ROI clones, fo
+00020c50: 7220 7768 6963 6820 766f 7865 6c20 7369  r which voxel si
+00020c60: 7a65 7320 6d61 7920 6265 2061 6c74 6572  zes may be alter
+00020c70: 6564 2e0a 2020 2020 2020 2020 726f 6931  ed..        roi1
+00020c80: 203d 2073 656c 662e 636c 6f6e 6528 290a   = self.clone().
+00020c90: 2020 2020 2020 2020 726f 6932 203d 206f          roi2 = o
+00020ca0: 7468 6572 2e63 6c6f 6e65 2829 0a0a 2020  ther.clone()..  
+00020cb0: 2020 2020 2020 2320 4173 736f 6369 6174        # Associat
+00020cc0: 6520 6e65 7720 6475 6d6d 7920 696d 6167  e new dummy imag
+00020cd0: 6520 7769 7468 2052 4f49 7320 6966 2072  e with ROIs if r
+00020ce0: 6571 7565 7374 6564 2076 6f78 656c 2073  equested voxel s
+00020cf0: 697a 650a 2020 2020 2020 2020 2320 6973  ize.        # is
+00020d00: 2064 6966 6665 7265 6e74 2066 726f 6d20   different from 
+00020d10: 766f 7865 6c20 7369 7a65 206f 6620 6569  voxel size of ei
+00020d20: 7468 6572 2063 7572 7265 6e74 2069 6d61  ther current ima
+00020d30: 6765 2c0a 2020 2020 2020 2020 2320 6f72  ge,.        # or
+00020d40: 2069 6620 6162 736f 6c75 7465 2064 6966   if absolute dif
+00020d50: 6665 7265 6e63 6520 696e 2061 6e79 2064  ference in any d
+00020d60: 696d 656e 7369 6f6e 2062 6574 7765 656e  imension between
+00020d70: 2076 6f78 656c 2073 697a 6573 0a20 2020   voxel sizes.   
+00020d80: 2020 2020 2023 206f 6620 6375 7272 656e       # of curren
+00020d90: 7420 696d 6167 6573 2064 6f6e 2774 206d  t images don't m
+00020da0: 6174 6368 2069 7320 6772 6561 7465 7220  atch is greater 
+00020db0: 7468 616e 2074 6f6c 6572 616e 6365 2e0a  than tolerance..
+00020dc0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+00020dd0: 7a65 203d 2076 6f78 656c 5f73 697a 6520  ze = voxel_size 
+00020de0: 6966 2076 6f78 656c 5f73 697a 6520 656c  if voxel_size el
+00020df0: 7365 2072 6f69 322e 6765 745f 766f 7865  se roi2.get_voxe
+00020e00: 6c5f 7369 7a65 2829 0a20 2020 2020 2020  l_size().       
+00020e10: 2069 6620 766f 7865 6c5f 7369 7a65 2061   if voxel_size a
+00020e20: 6e64 2072 6f69 322e 6765 745f 766f 7865  nd roi2.get_voxe
+00020e30: 6c5f 7369 7a65 2829 3a0a 2020 2020 2020  l_size():.      
+00020e40: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00020e50: 203d 205b 766f 7865 6c5f 7369 7a65 5b69   = [voxel_size[i
+00020e60: 6478 5d20 6966 2076 6f78 656c 5f73 697a  dx] if voxel_siz
+00020e70: 655b 6964 785d 2069 7320 6e6f 7420 4e6f  e[idx] is not No
+00020e80: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+00020e90: 2020 2020 2020 2065 6c73 6520 726f 6932         else roi2
+00020ea0: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
+00020eb0: 295b 6964 785d 2066 6f72 2069 6478 2069  )[idx] for idx i
+00020ec0: 6e20 7261 6e67 6528 3329 5d0a 2020 2020  n range(3)].    
+00020ed0: 2020 2020 7265 7369 7a65 203d 206e 6f74      resize = not
+00020ee0: 2072 6f69 312e 6765 745f 766f 7865 6c5f   roi1.get_voxel_
+00020ef0: 7369 7a65 2829 206f 7220 6e6f 7420 726f  size() or not ro
+00020f00: 6932 2e67 6574 5f76 6f78 656c 5f73 697a  i2.get_voxel_siz
+00020f10: 6528 290a 2020 2020 2020 2020 6966 206e  e().        if n
+00020f20: 6f74 2072 6573 697a 653a 0a20 2020 2020  ot resize:.     
+00020f30: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+00020f40: 6e20 5b72 6f69 312c 2072 6f69 325d 3a0a  n [roi1, roi2]:.
+00020f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f60: 6d61 7463 6865 7320 3d20 5b64 7879 7a31  matches = [dxyz1
+00020f70: 2066 6f72 2064 7879 7a31 2c20 6478 797a   for dxyz1, dxyz
+00020f80: 3220 696e 0a20 2020 2020 2020 2020 2020  2 in.           
+00020f90: 2020 2020 2020 2020 2020 2020 207a 6970               zip
+00020fa0: 2876 6f78 656c 5f73 697a 652c 2072 6f69  (voxel_size, roi
+00020fb0: 2e76 6f78 656c 5f73 697a 6529 0a20 2020  .voxel_size).   
+00020fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fd0: 2020 2020 2069 6620 6162 7328 6478 797a       if abs(dxyz
+00020fe0: 3120 2d20 6478 797a 3229 203c 2076 6f78  1 - dxyz2) < vox
+00020ff0: 656c 5f64 696d 5f74 6f6c 6572 616e 6365  el_dim_tolerance
+00021000: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00021010: 2020 6966 2033 2021 3d20 6c65 6e28 6d61    if 3 != len(ma
+00021020: 7463 6865 7329 3a0a 2020 2020 2020 2020  tches):.        
+00021030: 2020 2020 2020 2020 2020 2020 7265 7369              resi
+00021040: 7a65 203d 2054 7275 650a 2020 2020 2020  ze = True.      
+00021050: 2020 6966 2072 6573 697a 653a 0a20 2020    if resize:.   
+00021060: 2020 2020 2020 2020 2069 6620 766f 7865           if voxe
+00021070: 6c5f 7369 7a65 3a0a 2020 2020 2020 2020  l_size:.        
+00021080: 2020 2020 2020 2020 736c 6963 655f 7468          slice_th
+00021090: 6963 6b6e 6573 7320 3d20 766f 7865 6c5f  ickness = voxel_
+000210a0: 7369 7a65 5b32 5d0a 2020 2020 2020 2020  size[2].        
+000210b0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+000210c0: 7a65 5f32 6420 3d20 766f 7865 6c5f 7369  ze_2d = voxel_si
+000210d0: 7a65 5b3a 325d 0a20 2020 2020 2020 2020  ze[:2].         
+000210e0: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
+000210f0: 7468 6174 2069 6e69 7469 616c 2076 6f78  that initial vox
+00021100: 656c 2073 697a 6520 6973 2073 6574 2e0a  el size is set..
+00021110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021120: 2320 5468 6973 2069 7320 7573 6564 2074  # This is used t
+00021130: 6f20 6465 6669 6e65 2073 6c69 6365 2074  o define slice t
+00021140: 6869 636b 6e65 7373 0a20 2020 2020 2020  hickness.       
+00021150: 2020 2020 2020 2020 2023 2066 6f72 2061           # for a
+00021160: 6e20 524f 4920 7468 6174 2068 6173 206e  n ROI that has n
+00021170: 6f20 6173 736f 6369 6174 6564 2069 6d61  o associated ima
+00021180: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
+00021190: 2020 2020 2320 616e 6420 6973 2064 6566      # and is def
+000211a0: 696e 6564 2062 7920 6f6e 6520 6f72 206d  ined by one or m
+000211b0: 6f72 6520 636f 6e74 6f75 7273 206f 6e20  ore contours on 
+000211c0: 6120 7369 6e67 6c65 0a20 2020 2020 2020  a single.       
+000211d0: 2020 2020 2020 2020 2023 2069 6d61 6765           # image
+000211e0: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
+000211f0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+00021200: 6f69 312e 766f 7865 6c5f 7369 7a65 3a0a  oi1.voxel_size:.
+00021210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021220: 2020 2020 726f 6931 2e76 6f78 656c 5f73      roi1.voxel_s
+00021230: 697a 6520 3d20 766f 7865 6c5f 7369 7a65  ize = voxel_size
+00021240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021250: 2069 6620 6e6f 7420 726f 6932 2e76 6f78   if not roi2.vox
+00021260: 656c 5f73 697a 653a 0a20 2020 2020 2020  el_size:.       
+00021270: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00021280: 322e 766f 7865 6c5f 7369 7a65 203d 2076  2.voxel_size = v
+00021290: 6f78 656c 5f73 697a 650a 2020 2020 2020  oxel_size.      
+000212a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000212b0: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+000212c0: 655f 7468 6963 6b6e 6573 7320 3d20 4e6f  e_thickness = No
+000212d0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+000212e0: 2020 2076 6f78 656c 5f73 697a 655f 3264     voxel_size_2d
+000212f0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+00021300: 2020 2020 2053 7472 7563 7475 7265 5365       StructureSe
+00021310: 7428 5b72 6f69 312c 2072 6f69 325d 292e  t([roi1, roi2]).
+00021320: 7365 745f 696d 6167 655f 746f 5f64 756d  set_image_to_dum
+00021330: 6d79 280a 2020 2020 2020 2020 2020 2020  my(.            
+00021340: 2020 2020 2020 2020 736c 6963 655f 7468          slice_th
+00021350: 6963 6b6e 6573 733d 736c 6963 655f 7468  ickness=slice_th
+00021360: 6963 6b6e 6573 732c 2076 6f78 656c 5f73  ickness, voxel_s
+00021370: 697a 653d 766f 7865 6c5f 7369 7a65 5f32  ize=voxel_size_2
+00021380: 6429 0a0a 2020 2020 2020 2020 7265 7475  d)..        retu
+00021390: 726e 2028 726f 6931 2c20 726f 6932 290a  rn (roi1, roi2).
+000213a0: 0a20 2020 2064 6566 2067 6574 5f73 7572  .    def get_sur
+000213b0: 6661 6365 5f64 6973 7461 6e63 6573 280a  face_distances(.
+000213c0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000213d0: 2020 2020 2020 6f74 6865 722c 0a20 2020        other,.   
+000213e0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+000213f0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+00021400: 2073 6967 6e65 643d 4661 6c73 652c 0a20   signed=False,. 
+00021410: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
+00021420: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
+00021430: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
+00021440: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
+00021450: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+00021460: 636f 6e6e 6563 7469 7669 7479 3d32 2c0a  connectivity=2,.
+00021470: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
+00021480: 4661 6c73 652c 0a20 2020 2020 2020 2073  False,.        s
+00021490: 796d 6d65 7472 6963 3d4e 6f6e 652c 0a20  ymmetric=None,. 
+000214a0: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
+000214b0: 793d 4661 6c73 652c 0a20 2020 2020 2020  y=False,.       
+000214c0: 2069 6e5f 736c 6963 653d 5472 7565 2c0a   in_slice=True,.
+000214d0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+000214e0: 7a65 3d4e 6f6e 652c 0a20 2020 2020 2020  ze=None,.       
+000214f0: 2076 6f78 656c 5f64 696d 5f74 6f6c 6572   voxel_dim_toler
+00021500: 616e 6365 3d30 2e31 2c0a 2020 2020 293a  ance=0.1,.    ):
+00021510: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00021520: 2020 2020 2047 6574 2076 6563 746f 7220       Get vector 
+00021530: 6f66 2073 7572 6661 6365 2064 6973 7461  of surface dista
+00021540: 6e63 6573 2062 6574 7765 656e 2074 776f  nces between two
+00021550: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
+00021560: 5375 7266 6163 6520 6469 7374 616e 6365  Surface distance
+00021570: 7320 6d61 7920 6265 2073 6967 6e65 6420  s may be signed 
+00021580: 6f72 2075 6e73 6967 6e65 642c 2061 6e64  or unsigned, and
+00021590: 206d 6179 2062 6520 666f 7220 6120 7369   may be for a si
+000215a0: 6e67 6c65 0a20 2020 2020 2020 2073 6c69  ngle.        sli
+000215b0: 6365 2074 6872 6f75 6768 2074 6865 2052  ce through the R
+000215c0: 4f49 732c 206f 7220 666f 7220 7468 6520  OIs, or for the 
+000215d0: 3344 2076 6f6c 756d 6573 2e20 200a 0a20  3D volumes.  .. 
+000215e0: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
+000215f0: 7469 6f6e 2075 7365 7320 6964 6561 7320  tion uses ideas 
+00021600: 6f75 746c 696e 6564 2061 743a 0a20 2020  outlined at:.   
+00021610: 2020 2020 2068 7474 7073 3a2f 2f6d 6c6e       https://mln
+00021620: 6f74 6562 6f6f 6b2e 6769 7468 7562 2e69  otebook.github.i
+00021630: 6f2f 706f 7374 2f73 7572 6661 6365 2d64  o/post/surface-d
+00021640: 6973 7461 6e63 652d 6675 6e63 7469 6f6e  istance-function
+00021650: 2f0a 0a20 2020 2020 2020 202a 2a50 6172  /..        **Par
+00021660: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+00021670: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
+00021680: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00021690: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+000216a0: 2020 2049 6620 4661 6c73 652c 2072 6574     If False, ret
+000216b0: 7572 6e20 7375 7266 6163 6520 6469 7374  urn surface dist
+000216c0: 616e 6365 7320 7265 6c61 7469 7665 2074  ances relative t
+000216d0: 6f20 3344 2076 6f6c 756d 6573 2e0a 2020  o 3D volumes..  
+000216e0: 2020 2020 2020 2020 2020 4f74 6865 7277            Otherw
+000216f0: 6973 652c 2072 6574 7572 6e20 7375 7266  ise, return surf
+00021700: 6163 6520 6469 7374 616e 6365 7320 666f  ace distances fo
+00021710: 7220 6120 7369 6e67 6c65 2069 6d61 6765  r a single image
+00021720: 2073 6c69 6365 2e0a 0a20 2020 2020 2020   slice...       
+00021730: 2073 6967 6e65 6420 3a20 626f 6f6c 2c20   signed : bool, 
+00021740: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+00021750: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
+00021760: 7365 2c20 7265 7475 726e 2061 6273 6f6c  se, return absol
+00021770: 7574 6520 7375 7266 6163 6520 6469 7374  ute surface dist
+00021780: 616e 6365 732e 0a20 2020 2020 2020 2020  ances..         
+00021790: 2020 2049 6620 5472 7565 2c20 7265 7475     If True, retu
+000217a0: 726e 2073 6967 6e65 6420 7375 7266 6163  rn signed surfac
+000217b0: 6520 6469 7374 616e 6365 732e 2020 4120  e distances.  A 
+000217c0: 706f 696e 7420 6f6e 2074 6865 0a20 2020  point on the.   
+000217d0: 2020 2020 2020 2020 2073 7572 6661 6365           surface
+000217e0: 206f 6620 3c6f 7468 6572 3e20 6973 2074   of <other> is t
+000217f0: 616b 656e 2074 6f20 6265 2061 7420 6120  aken to be at a 
+00021800: 706f 7369 7469 7665 2064 6973 7461 6e63  positive distanc
+00021810: 6520 6966 0a20 2020 2020 2020 2020 2020  e if.           
+00021820: 206f 7574 7369 6465 203c 7365 6c66 3e2c   outside <self>,
+00021830: 2061 6e64 2061 7420 6120 6e65 6761 7469   and at a negati
+00021840: 7665 2064 6973 7461 6e63 6520 6966 2069  ve distance if i
+00021850: 6e73 6964 652e 0a0a 2020 2020 2020 2020  nside...        
+00021860: 7669 6577 203a 2073 7472 2c20 6465 6661  view : str, defa
+00021870: 756c 743d 2278 2d79 220a 2020 2020 2020  ult="x-y".      
+00021880: 2020 2020 2020 4f72 6965 6e74 6174 696f        Orientatio
+00021890: 6e20 6f66 2073 6c69 6365 2066 6f72 2077  n of slice for w
+000218a0: 6869 6368 2074 6f20 6f62 7461 696e 2073  hich to obtain s
+000218b0: 7572 6661 6365 2064 6973 7461 6e63 6573  urface distances
+000218c0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
+000218d0: 6c79 2075 7365 6420 6966 2065 6974 6865  ly used if eithe
+000218e0: 7220 3c73 696e 676c 655f 736c 6963 653e  r <single_slice>
+000218f0: 206f 7220 3c66 6c61 7474 656e 3e20 6973   or <flatten> is
+00021900: 2054 7275 652e 0a0a 2020 2020 2020 2020   True...        
+00021910: 736c 203a 2069 6e74 2c20 6465 6661 756c  sl : int, defaul
+00021920: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00021930: 2020 2053 6c69 6365 206e 756d 6265 722e     Slice number.
+00021940: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
+00021950: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
+00021960: 2069 7320 7375 7070 6c69 6564 2062 7574   is supplied but
+00021970: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+00021980: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+00021990: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+000219a0: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+000219b0: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+000219c0: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
+000219d0: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+000219e0: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
+000219f0: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
+00021a00: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
+00021a10: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+00021a20: 733e 2069 7320 0a20 2020 2020 2020 2020  s> is .         
+00021a30: 2020 2073 7570 706c 6965 6420 6275 7420     supplied but 
+00021a40: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+00021a50: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+00021a60: 7261 6c20 736c 6963 6520 6f66 0a20 2020  ral slice of.   
+00021a70: 2020 2020 2020 2020 2074 6865 2052 4f49           the ROI
+00021a80: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+00021a90: 2020 2020 2020 2020 706f 7320 3a20 666c          pos : fl
+00021aa0: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+00021ab0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+00021ac0: 6963 6520 706f 7369 7469 6f6e 2069 6e20  ice position in 
+00021ad0: 6d6d 2e20 4966 206e 6f6e 6520 6f66 203c  mm. If none of <
+00021ae0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+00021af0: 6f73 3e20 6973 2073 7570 706c 6965 640a  os> is supplied.
+00021b00: 2020 2020 2020 2020 2020 2020 6275 7420              but 
+00021b10: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+00021b20: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+00021b30: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+00021b40: 2052 4f49 2077 696c 6c0a 2020 2020 2020   ROI will.      
+00021b50: 2020 2020 2020 6265 2075 7365 642e 0a0a        be used...
+00021b60: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00021b70: 7669 7479 3a20 696e 742c 2064 6566 6175  vity: int, defau
+00021b80: 6c74 3d32 0a20 2020 2020 2020 2020 2020  lt=2.           
+00021b90: 2049 6e74 6567 6572 2064 6566 696e 696e   Integer definin
+00021ba0: 6720 7768 6963 6820 766f 7865 6c73 2074  g which voxels t
+00021bb0: 6f20 636f 6e73 6964 6572 2061 7320 6e65  o consider as ne
+00021bc0: 6967 6862 6f75 7273 0a20 2020 2020 2020  ighbours.       
+00021bd0: 2020 2020 2077 6865 6e20 7065 7266 6f72       when perfor
+00021be0: 6d69 6e67 2065 726f 7369 6f6e 206f 7065  ming erosion ope
+00021bf0: 7261 7469 6f6e 2074 6f20 6964 656e 7469  ration to identi
+00021c00: 6679 2052 4f49 2073 7572 6661 6365 732e  fy ROI surfaces.
+00021c10: 2020 5468 6973 0a20 2020 2020 2020 2020    This.         
+00021c20: 2020 2069 7320 7061 7373 6564 2061 7320     is passed as 
+00021c30: 3c63 6f6e 6e65 6374 6976 6974 793e 2070  <connectivity> p
+00021c40: 6172 616d 6574 6572 2074 6f3a 0a20 2020  arameter to:.   
+00021c50: 2020 2020 2020 2020 2073 6369 7079 2e6e           scipy.n
+00021c60: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
+00021c70: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
+00021c80: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
+00021c90: 2066 7572 7468 6572 2064 6574 6169 6c73   further details
+00021ca0: 2c20 7365 653a 0a20 2020 2020 2020 2020  , see:.         
+00021cb0: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
+00021cc0: 7363 6970 792e 6f72 672f 646f 632f 7363  scipy.org/doc/sc
+00021cd0: 6970 792f 7265 6665 7265 6e63 652f 6765  ipy/reference/ge
+00021ce0: 6e65 7261 7465 642f 7363 6970 792e 6e64  nerated/scipy.nd
+00021cf0: 696d 6167 652e 6765 6e65 7261 7465 5f62  image.generate_b
+00021d00: 696e 6172 795f 7374 7275 6374 7572 652e  inary_structure.
+00021d10: 6874 6d6c 0a0a 2020 2020 2020 2020 666c  html..        fl
+00021d20: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+00021d30: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00021d40: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00021d50: 2061 6c6c 2073 6c69 6365 7320 666f 7220   all slices for 
+00021d60: 6561 6368 2052 4f49 2077 696c 6c20 6265  each ROI will be
+00021d70: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
+00021d80: 6520 6769 7665 6e0a 2020 2020 2020 2020  e given.        
+00021d90: 2020 2020 6f72 6965 6e74 6174 696f 6e2c      orientation,
+00021da0: 2061 6e64 2073 7572 6661 6365 2064 6973   and surface dis
+00021db0: 7461 6e63 6573 2072 656c 6174 6976 6520  tances relative 
+00021dc0: 746f 2074 6865 2066 6c61 7474 656e 6564  to the flattened
+00021dd0: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
+00021de0: 6365 2077 696c 6c20 6265 2072 6574 7572  ce will be retur
+00021df0: 6e65 642e 0a0a 2020 2020 2020 2020 7379  ned...        sy
+00021e00: 6d6d 6574 7269 6320 3a20 626f 6f6c 2c20  mmetric : bool, 
+00021e10: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00021e20: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+00021e30: 2c20 7468 6520 6469 7374 616e 6365 7320  , the distances 
+00021e40: 7265 7475 726e 6564 2061 7265 2066 726f  returned are fro
+00021e50: 6d20 7468 6520 7375 7266 6163 6520 6f66  m the surface of
+00021e60: 203c 6f74 6865 723e 0a20 2020 2020 2020   <other>.       
+00021e70: 2020 2020 2074 6f20 7468 6520 7375 7266       to the surf
+00021e80: 6163 6520 6f66 203c 7365 6c66 3e20 616e  ace of <self> an
+00021e90: 6420 6672 6f6d 2074 6865 2073 7572 6661  d from the surfa
+00021ea0: 6365 206f 6620 3c73 656c 663e 2074 6f20  ce of <self> to 
+00021eb0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00021ec0: 7375 7266 6163 6520 6f66 203c 6f74 6865  surface of <othe
+00021ed0: 723e 2e20 2049 6620 4661 6c73 652c 2064  r>.  If False, d
+00021ee0: 6973 7461 6e63 6573 2061 7265 2066 726f  istances are fro
+00021ef0: 6d20 7468 6520 7375 7266 6163 650a 2020  m the surface.  
+00021f00: 2020 2020 2020 2020 2020 6f66 203c 6f74            of <ot
+00021f10: 6865 723e 2074 6f20 7468 6520 7375 7266  her> to the surf
+00021f20: 6163 6520 6f66 203c 7365 6c66 3e20 6f6e  ace of <self> on
+00021f30: 6c79 2e20 2049 6620 4e6f 6e65 2c20 7365  ly.  If None, se
+00021f40: 7420 746f 0a20 2020 2020 2020 2020 2020  t to.           
+00021f50: 2074 6865 206f 7070 6f73 6973 7465 206f   the opposiste o
+00021f60: 6620 3c73 6967 6e65 643e 2e0a 0a20 2020  f <signed>...   
+00021f70: 2020 2020 2020 636f 6e66 6f72 6d69 7479        conformity
+00021f80: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00021f90: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+00021fa0: 2020 2020 4966 2054 7275 652c 2064 6973      If True, dis
+00021fb0: 7461 6e63 6573 2072 6574 7572 6e65 6420  tances returned 
+00021fc0: 6172 6520 7369 676e 6564 2064 6973 7461  are signed dista
+00021fd0: 6e63 6573 2074 6f20 636f 6e66 6f72 6d69  nces to conformi
+00021fe0: 7479 2c0a 2020 2020 2020 2020 2020 2020  ty,.            
+00021ff0: 2061 7320 6465 6669 6e65 6420 696e 3a0a   as defined in:.
+00022000: 2020 2020 2020 2020 2020 2020 2068 7474               htt
+00022010: 7073 3a2f 2f64 6f69 2e6f 7267 2f31 302e  ps://doi.org/10.
+00022020: 3132 3539 2f62 6a72 2f32 3736 3734 3538  1259/bjr/2767458
+00022030: 310a 2020 2020 2020 2020 2020 2020 2049  1.             I
+00022040: 6e20 7468 6973 2063 6173 652c 2074 6865  n this case, the
+00022050: 2076 616c 7565 7320 6f66 203c 7369 676e   values of <sign
+00022060: 6564 3e20 616e 6420 3c73 796d 6d65 7472  ed> and <symmetr
+00022070: 6963 3e0a 2020 2020 2020 2020 2020 2020  ic>.            
+00022080: 2061 7265 2064 6973 7265 6761 7264 6564   are disregarded
+00022090: 2e0a 0a20 2020 2020 2020 2069 6e5f 736c  ...        in_sl
+000220a0: 6963 6520 3a20 626f 6f6c 2c20 6465 6661  ice : bool, defa
+000220b0: 756c 743d 5472 7565 0a20 2020 2020 2020  ult=True.       
+000220c0: 2020 2020 2049 6620 5472 7565 2c20 6f6e       If True, on
+000220d0: 6c79 2069 6e74 7261 2d73 6c69 6365 2063  ly intra-slice c
+000220e0: 6f6e 6e65 6374 6976 6974 7920 6973 2063  onnectivity is c
+000220f0: 6f6e 7369 6465 7265 6420 7768 656e 0a20  onsidered when. 
+00022100: 2020 2020 2020 2020 2020 2070 6572 666f             perfo
+00022110: 726d 696e 6720 6572 6f73 696f 6e20 746f  rming erosion to
+00022120: 2069 6465 6e74 6966 7920 524f 4920 7375   identify ROI su
+00022130: 7266 6163 6573 2e0a 0a20 2020 2020 2020  rfaces...       
+00022140: 2076 6f78 656c 5f73 697a 6520 3a20 7475   voxel_size : tu
+00022150: 706c 652c 2064 6566 6175 6c74 3d4e 6f6e  ple, default=Non
+00022160: 650a 2020 2020 2020 2020 2020 2020 566f  e.            Vo
+00022170: 7865 6c20 7369 7a65 2028 6478 2c20 6479  xel size (dx, dy
+00022180: 2c20 647a 2920 696e 206d 6d20 746f 2062  , dz) in mm to b
+00022190: 6520 7573 6564 2066 6f72 2052 4f49 206d  e used for ROI m
+000221a0: 6173 6b73 0a20 2020 2020 2020 2020 2020  asks.           
+000221b0: 2066 726f 6d20 7768 6963 6820 746f 2063   from which to c
+000221c0: 616c 6375 6c61 7465 2073 7572 6661 6365  alculate surface
+000221d0: 2064 6973 7461 6e63 6573 2e20 2049 6620   distances.  If 
+000221e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+000221f0: 2020 7468 6520 6d61 736b 2076 6f78 656c    the mask voxel
+00022200: 2073 697a 6520 6f66 203c 6f74 6865 723e   size of <other>
+00022210: 2069 7320 7573 6564 2e20 2049 6620 616e   is used.  If an
+00022220: 2069 6e64 6976 6964 7561 6c0a 2020 2020   individual.    
+00022230: 2020 2020 2020 2020 656c 656d 656e 7420          element 
+00022240: 6973 204e 6f6e 652c 2074 6865 2076 616c  is None, the val
+00022250: 7565 206f 6620 7468 6520 636f 7272 6573  ue of the corres
+00022260: 706f 6e64 696e 6720 656c 656d 656e 7420  ponding element 
+00022270: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00022280: 7468 6520 6d61 736b 2076 6f78 656c 2073  the mask voxel s
+00022290: 697a 6520 6f66 203c 6f74 6865 723e 2069  ize of <other> i
+000222a0: 7320 7573 6564 2e0a 0a20 2020 2020 2020  s used...       
+000222b0: 2076 6f78 656c 5f64 696d 5f74 6f6c 6572   voxel_dim_toler
+000222c0: 616e 6365 203a 2066 6c6f 6174 2c20 6465  ance : float, de
+000222d0: 6661 756c 743d 302e 310a 2020 2020 2020  fault=0.1.      
+000222e0: 2020 2020 2020 546f 6c65 7265 6e63 6520        Tolerence 
+000222f0: 7573 6564 2077 6865 6e20 6465 7465 726d  used when determ
+00022300: 696e 696e 6720 7768 6574 6865 7220 3c76  ining whether <v
+00022310: 6f78 656c 5f73 697a 653e 2069 730a 2020  oxel_size> is.  
+00022320: 2020 2020 2020 2020 2020 6469 6666 6572            differ
+00022330: 656e 7420 6672 6f6d 2074 6865 2076 6f78  ent from the vox
+00022340: 656c 2073 697a 6520 6f66 2074 6865 2069  el size of the i
+00022350: 6d61 6765 7320 6173 736f 6369 6174 6564  mages associated
+00022360: 2077 6974 680a 2020 2020 2020 2020 2020   with.          
+00022370: 2020 6561 6368 2052 4f49 2e0a 2020 2020    each ROI..    
+00022380: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00022390: 2023 2053 6574 2076 6965 7720 746f 204e   # Set view to N
+000223a0: 6f6e 6520 6966 2063 6f6e 7369 6465 7269  one if consideri
+000223b0: 6e67 2033 4420 6d61 736b 2e0a 2020 2020  ng 3D mask..    
+000223c0: 2020 2020 6966 206e 6f74 2073 696e 676c      if not singl
+000223d0: 655f 736c 6963 6520 616e 6420 6e6f 7420  e_slice and not 
+000223e0: 666c 6174 7465 6e3a 0a20 2020 2020 2020  flatten:.       
+000223f0: 2020 2020 2076 6965 7720 3d20 4e6f 6e65       view = None
+00022400: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+00022410: 746f 2046 616c 7365 2070 6172 616d 6574  to False paramet
+00022420: 6572 7320 7468 6174 2061 7265 2074 6f20  ers that are to 
+00022430: 6265 2069 676e 6f72 6564 0a20 2020 2020  be ignored.     
+00022440: 2020 2023 2077 6865 6e20 6361 6c63 756c     # when calcul
+00022450: 6174 696e 6720 6469 7374 616e 6365 7320  ating distances 
+00022460: 746f 2063 6f6e 666f 726d 6974 792e 0a20  to conformity.. 
+00022470: 2020 2020 2020 2069 6620 636f 6e66 6f72         if confor
+00022480: 6d69 7479 3a0a 2020 2020 2020 2020 2020  mity:.          
+00022490: 2020 7379 6d6d 6574 7269 6320 3d20 7369    symmetric = si
+000224a0: 676e 6564 203d 2046 616c 7365 0a0a 2020  gned = False..  
+000224b0: 2020 2020 2020 2320 4465 6661 756c 7420        # Default 
+000224c0: 746f 2073 796d 6d65 7472 6963 206f 7220  to symmetric or 
+000224d0: 6f6e 652d 7761 7920 6469 7374 616e 6365  one-way distance
+000224e0: 732c 0a20 2020 2020 2020 2023 2064 6570  s,.        # dep
+000224f0: 656e 6469 6e67 206f 6e20 7768 6574 6865  ending on whethe
+00022500: 7220 6469 7374 616e 6365 7320 6172 6520  r distances are 
+00022510: 7369 676e 6564 206f 7220 756e 7369 676e  signed or unsign
+00022520: 6564 2e0a 2020 2020 2020 2020 6966 2073  ed..        if s
+00022530: 796d 6d65 7472 6963 2069 7320 4e6f 6e65  ymmetric is None
+00022540: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+00022550: 6d6d 6574 7269 6320 3d20 4661 6c73 6520  mmetric = False 
+00022560: 6966 2073 6967 6e65 6420 6973 2054 7275  if signed is Tru
+00022570: 6520 656c 7365 2054 7275 650a 0a20 2020  e else True..   
+00022580: 2020 2020 2023 204f 6274 6169 6e20 524f       # Obtain RO
+00022590: 4920 636c 6f6e 6573 2c20 7769 7468 206d  I clones, with m
+000225a0: 6173 6b20 766f 7865 6c20 7369 7a65 7320  ask voxel sizes 
+000225b0: 6d61 7463 6865 6420 746f 2076 6f78 656c  matched to voxel
+000225c0: 5f73 697a 650a 2020 2020 2020 2020 2320  _size.        # 
+000225d0: 6966 206e 6f6e 2d6e 756c 6c2c 206f 7220  if non-null, or 
+000225e0: 6f74 6865 7277 6973 6520 746f 2074 6865  otherwise to the
+000225f0: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
+00022600: 206f 6620 6f74 6865 722e 0a20 2020 2020   of other..     
+00022610: 2020 2072 6f69 312c 2072 6f69 3220 3d20     roi1, roi2 = 
+00022620: 7365 6c66 2e6d 6174 6368 5f6d 6173 6b5f  self.match_mask_
+00022630: 766f 7865 6c5f 7369 7a65 286f 7468 6572  voxel_size(other
+00022640: 2c20 766f 7865 6c5f 7369 7a65 2c0a 2020  , voxel_size,.  
+00022650: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00022660: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
+00022670: 6529 0a0a 2020 2020 2020 2020 2320 4368  e)..        # Ch
+00022680: 6563 6b20 7768 6574 6865 7220 524f 4973  eck whether ROIs
+00022690: 2061 7265 2065 6d70 7479 0a20 2020 2020   are empty.     
+000226a0: 2020 2069 6620 6e6f 7420 6e70 2e61 6e79     if not np.any
+000226b0: 2872 6f69 312e 6765 745f 6d61 736b 2829  (roi1.get_mask()
+000226c0: 2920 6f72 206e 6f74 206e 702e 616e 7928  ) or not np.any(
+000226d0: 726f 6932 2e67 6574 5f6d 6173 6b28 2929  roi2.get_mask())
+000226e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000226f0: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
+00022700: 4765 7420 766f 7865 6c20 7369 7a65 2072  Get voxel size r
+00022710: 656c 6174 6976 6520 746f 2061 7865 7320  elative to axes 
+00022720: 6f66 206e 756d 7079 2061 7272 6179 2e0a  of numpy array..
+00022730: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+00022740: 7a65 203d 2072 6f69 312e 6765 745f 6e70  ze = roi1.get_np
+00022750: 5f76 6f78 656c 5f73 697a 6528 7669 6577  _voxel_size(view
+00022760: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+00022770: 2062 696e 6172 7920 6d61 736b 730a 2020   binary masks.  
+00022780: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
+00022790: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
+000227a0: 2020 206d 6173 6b31 203d 2072 6f69 312e     mask1 = roi1.
+000227b0: 6765 745f 736c 6963 6528 7669 6577 2c20  get_slice(view, 
+000227c0: 736c 3d73 6c2c 2069 6478 3d69 6478 2c20  sl=sl, idx=idx, 
+000227d0: 706f 733d 706f 7329 0a20 2020 2020 2020  pos=pos).       
+000227e0: 2020 2020 206d 6173 6b32 203d 2072 6f69       mask2 = roi
+000227f0: 322e 6765 745f 736c 6963 6528 7669 6577  2.get_slice(view
+00022800: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
+00022810: 2c20 706f 733d 706f 7329 0a20 2020 2020  , pos=pos).     
+00022820: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022830: 2020 2020 206d 6173 6b31 203d 2072 6f69       mask1 = roi
+00022840: 312e 6765 745f 6d61 736b 2876 6965 772c  1.get_mask(view,
+00022850: 2066 6c61 7474 656e 3d66 6c61 7474 656e   flatten=flatten
+00022860: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00022870: 736b 3220 3d20 726f 6932 2e67 6574 5f6d  sk2 = roi2.get_m
+00022880: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
+00022890: 6e3d 666c 6174 7465 6e29 0a0a 2020 2020  n=flatten)..    
+000228a0: 2020 2020 2320 4d61 6b65 2073 7472 7563      # Make struc
+000228b0: 7475 7269 6e67 2065 6c65 6d65 6e74 0a20  turing element. 
+000228c0: 2020 2020 2020 2063 6f6e 6e32 203d 206e         conn2 = n
+000228d0: 6469 6d61 6765 2e67 656e 6572 6174 655f  dimage.generate_
+000228e0: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
+000228f0: 2832 2c20 636f 6e6e 6563 7469 7669 7479  (2, connectivity
+00022900: 290a 2020 2020 2020 2020 6966 206d 6173  ).        if mas
+00022910: 6b31 2e6e 6469 6d20 3d3d 2032 3a0a 2020  k1.ndim == 2:.  
+00022920: 2020 2020 2020 2020 2020 636f 6e6e 203d            conn =
+00022930: 2063 6f6e 6e32 0a20 2020 2020 2020 2065   conn2.        e
+00022940: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022950: 2069 6620 696e 5f73 6c69 6365 3a0a 2020   if in_slice:.  
+00022960: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00022970: 6e6e 203d 206e 702e 7a65 726f 7328 2833  nn = np.zeros((3
+00022980: 2c20 332c 2033 292c 2064 7479 7065 3d62  , 3, 3), dtype=b
+00022990: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
+000229a0: 2020 2020 2063 6f6e 6e5b 3a2c 203a 2c20       conn[:, :, 
+000229b0: 315d 203d 2063 6f6e 6e32 0a20 2020 2020  1] = conn2.     
+000229c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000229d0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000229e0: 6e20 3d20 6e64 696d 6167 652e 6765 6e65  n = ndimage.gene
+000229f0: 7261 7465 5f62 696e 6172 795f 7374 7275  rate_binary_stru
+00022a00: 6374 7572 6528 332c 2063 6f6e 6e65 6374  cture(3, connect
+00022a10: 6976 6974 7929 0a0a 2020 2020 2020 2020  ivity)..        
+00022a20: 2320 4765 7420 6f75 7465 7220 7069 7865  # Get outer pixe
+00022a30: 6c20 6f66 2062 696e 6172 7920 6d61 7073  l of binary maps
+00022a40: 0a20 2020 2020 2020 2073 7572 6631 203d  .        surf1 =
+00022a50: 206d 6173 6b31 205e 206e 6469 6d61 6765   mask1 ^ ndimage
+00022a60: 2e62 696e 6172 795f 6572 6f73 696f 6e28  .binary_erosion(
+00022a70: 6d61 736b 312c 2063 6f6e 6e29 0a20 2020  mask1, conn).   
+00022a80: 2020 2020 2073 7572 6632 203d 206d 6173       surf2 = mas
+00022a90: 6b32 205e 206e 6469 6d61 6765 2e62 696e  k2 ^ ndimage.bin
+00022aa0: 6172 795f 6572 6f73 696f 6e28 6d61 736b  ary_erosion(mask
+00022ab0: 322c 2063 6f6e 6e29 0a0a 2020 2020 2020  2, conn)..      
+00022ac0: 2020 2320 4d61 6b65 2061 7272 6179 7320    # Make arrays 
+00022ad0: 6f66 2064 6973 7461 6e63 6573 2074 6f20  of distances to 
+00022ae0: 7375 7266 6163 6520 6f66 2065 6163 6820  surface of each 
+00022af0: 524f 490a 2020 2020 2020 2020 6469 7374  ROI.        dist
+00022b00: 3120 3d20 6e64 696d 6167 652e 6469 7374  1 = ndimage.dist
+00022b10: 616e 6365 5f74 7261 6e73 666f 726d 5f65  ance_transform_e
+00022b20: 6474 287e 7375 7266 312c 2076 6f78 656c  dt(~surf1, voxel
+00022b30: 5f73 697a 6529 0a20 2020 2020 2020 2064  _size).        d
+00022b40: 6973 7432 203d 206e 6469 6d61 6765 2e64  ist2 = ndimage.d
+00022b50: 6973 7461 6e63 655f 7472 616e 7366 6f72  istance_transfor
+00022b60: 6d5f 6564 7428 7e73 7572 6632 2c20 766f  m_edt(~surf2, vo
+00022b70: 7865 6c5f 7369 7a65 290a 0a20 2020 2020  xel_size)..     
+00022b80: 2020 2023 2047 6574 2073 6967 6e65 6420     # Get signed 
+00022b90: 6469 7374 616e 6365 730a 2020 2020 2020  distances.      
+00022ba0: 2020 6966 2073 6967 6e65 643a 0a20 2020    if signed:.   
+00022bb0: 2020 2020 2020 2020 2064 6973 7431 203d           dist1 =
+00022bc0: 2064 6973 7431 202a 207e 6d61 736b 3120   dist1 * ~mask1 
+00022bd0: 2d20 6469 7374 3120 2a20 6d61 736b 310a  - dist1 * mask1.
+00022be0: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+00022bf0: 3220 3d20 6469 7374 3220 2a20 7e6d 6173  2 = dist2 * ~mas
+00022c00: 6b32 202d 2064 6973 7432 202a 206d 6173  k2 - dist2 * mas
+00022c10: 6b32 0a0a 2020 2020 2020 2020 2320 4d61  k2..        # Ma
+00022c20: 6b65 2076 6563 746f 7220 636f 6e74 6169  ke vector contai
+00022c30: 6e69 6e67 2061 6c6c 2064 6973 7461 6e63  ning all distanc
+00022c40: 6573 0a20 2020 2020 2020 2069 6620 636f  es.        if co
+00022c50: 6e66 6f72 6d69 7479 3a0a 2020 2020 2020  nformity:.      
+00022c60: 2020 2020 2020 6469 7374 315b 6d61 736b        dist1[mask
+00022c70: 3120 2620 6d61 736b 325d 203d 2030 0a20  1 & mask2] = 0. 
+00022c80: 2020 2020 2020 2020 2020 2064 6973 7431             dist1
+00022c90: 5b6d 6173 6b31 2026 207e 6d61 736b 325d  [mask1 & ~mask2]
+00022ca0: 203d 202d 6469 7374 325b 6d61 736b 3120   = -dist2[mask1 
+00022cb0: 2620 7e6d 6173 6b32 5d0a 2020 2020 2020  & ~mask2].      
+00022cc0: 2020 2020 2020 7364 7320 3d20 6e70 2e72        sds = np.r
+00022cd0: 6176 656c 2864 6973 7431 5b6d 6173 6b31  avel(dist1[mask1
+00022ce0: 207c 206d 6173 6b32 5d29 0a20 2020 2020   | mask2]).     
+00022cf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022d00: 2020 2020 2073 6473 203d 206e 702e 7261       sds = np.ra
+00022d10: 7665 6c28 6469 7374 315b 7375 7266 3220  vel(dist1[surf2 
+00022d20: 213d 2030 5d29 0a20 2020 2020 2020 2020  != 0]).         
+00022d30: 2020 2069 6620 7379 6d6d 6574 7269 633a     if symmetric:
+00022d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022d50: 2073 6473 203d 206e 702e 636f 6e63 6174   sds = np.concat
+00022d60: 656e 6174 6528 5b73 6473 2c20 6e70 2e72  enate([sds, np.r
+00022d70: 6176 656c 2864 6973 7432 5b73 7572 6631  avel(dist2[surf1
+00022d80: 2021 3d20 305d 295d 290a 2020 2020 2020   != 0])]).      
+00022d90: 2020 7265 7475 726e 2073 6473 0a0a 2020    return sds..  
+00022da0: 2020 6465 6620 6765 745f 6d65 616e 5f73    def get_mean_s
+00022db0: 7572 6661 6365 5f64 6973 7461 6e63 6528  urface_distance(
+00022dc0: 7365 6c66 2c20 6f74 6865 722c 202a 2a6b  self, other, **k
+00022dd0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00022de0: 2727 270a 2020 2020 2020 2020 4f62 7461  '''.        Obta
+00022df0: 696e 206d 6561 6e20 6469 7374 616e 6365  in mean distance
+00022e00: 2062 6574 7765 656e 2073 7572 6661 6365   between surface
+00022e10: 206f 6620 3c6f 7468 6572 3e20 616e 6420   of <other> and 
+00022e20: 7375 7266 6163 6520 6f66 203c 7365 6c66  surface of <self
+00022e30: 3e2e 0a0a 2020 2020 2020 2020 466f 7220  >...        For 
+00022e40: 7061 7261 6d65 7465 7273 2074 6861 7420  parameters that 
+00022e50: 6d61 7920 6265 2070 6173 7365 642c 2073  may be passed, s
+00022e60: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
+00022e70: 2066 6f72 3a0a 2020 2020 2020 2020 736b   for:.        sk
+00022e80: 7274 2e52 4f49 2e67 6574 5f73 7572 6661  rt.ROI.get_surfa
+00022e90: 6365 5f64 6973 7461 6e63 6573 2829 2e0a  ce_distances()..
+00022ea0: 2020 2020 2020 2020 2727 270a 0a20 2020          '''..   
+00022eb0: 2020 2020 2073 6473 203d 2073 656c 662e       sds = self.
+00022ec0: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
+00022ed0: 616e 6365 7328 6f74 6865 722c 202a 2a6b  ances(other, **k
+00022ee0: 7761 7267 7329 0a20 2020 2020 2020 2069  wargs).        i
+00022ef0: 6620 7364 7320 6973 204e 6f6e 653a 0a20  f sds is None:. 
+00022f00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00022f10: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
+00022f20: 2073 6473 2e6d 6561 6e28 290a 0a20 2020   sds.mean()..   
+00022f30: 2064 6566 2067 6574 5f72 6d73 5f73 7572   def get_rms_sur
+00022f40: 6661 6365 5f64 6973 7461 6e63 6528 7365  face_distance(se
+00022f50: 6c66 2c20 6f74 6865 722c 202a 2a6b 7761  lf, other, **kwa
+00022f60: 7267 7329 3a0a 0a20 2020 2020 2020 2073  rgs):..        s
+00022f70: 6473 203d 2073 656c 662e 6765 745f 7375  ds = self.get_su
+00022f80: 7266 6163 655f 6469 7374 616e 6365 7328  rface_distances(
+00022f90: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
+00022fa0: 0a20 2020 2020 2020 2069 6620 7364 7320  .        if sds 
+00022fb0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00022fc0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00022fd0: 2020 2020 7265 7475 726e 206e 702e 7371      return np.sq
+00022fe0: 7274 2828 7364 7320 2a2a 2032 292e 6d65  rt((sds ** 2).me
+00022ff0: 616e 2829 290a 0a20 2020 2064 6566 2067  an())..    def g
+00023000: 6574 5f68 6175 7364 6f72 6666 5f64 6973  et_hausdorff_dis
+00023010: 7461 6e63 6528 7365 6c66 2c20 6f74 6865  tance(self, othe
+00023020: 722c 202a 2a6b 7761 7267 7329 3a0a 0a20  r, **kwargs):.. 
+00023030: 2020 2020 2020 2073 6473 203d 2073 656c         sds = sel
+00023040: 662e 6765 745f 7375 7266 6163 655f 6469  f.get_surface_di
+00023050: 7374 616e 6365 7328 6f74 6865 722c 202a  stances(other, *
+00023060: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+00023070: 2069 6620 7364 7320 6973 204e 6f6e 653a   if sds is None:
+00023080: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00023090: 7572 6e0a 2020 2020 2020 2020 7265 7475  urn.        retu
+000230a0: 726e 2073 6473 2e6d 6178 2829 0a0a 2020  rn sds.max()..  
+000230b0: 2020 6465 6620 6765 745f 6d65 616e 5f64    def get_mean_d
+000230c0: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
+000230d0: 726d 6974 7928 7365 6c66 2c20 6f74 6865  rmity(self, othe
+000230e0: 722c 2076 6f6c 5f75 6e69 7473 3d22 6d6d  r, vol_units="mm
+000230f0: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
+00023100: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+00023110: 2020 4f62 7461 696e 206d 6561 6e20 6469    Obtain mean di
+00023120: 7374 616e 6365 2074 6f20 636f 6e66 6f72  stance to confor
+00023130: 6d69 7479 2066 6f72 203c 6f74 6865 723e  mity for <other>
+00023140: 2072 656c 6174 6976 6520 746f 203c 7365   relative to <se
+00023150: 6c66 3e2e 0a0a 2020 2020 2020 2020 5468  lf>...        Th
+00023160: 6520 6d65 616e 2064 6973 7461 6e63 6520  e mean distance 
+00023170: 746f 2063 6f6e 666f 726d 6974 7920 6973  to conformity is
+00023180: 2061 7320 6465 6669 6e65 6420 696e 3a0a   as defined in:.
+00023190: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+000231a0: 646f 692e 6f72 672f 3130 2e31 3235 392f  doi.org/10.1259/
+000231b0: 626a 722f 3237 3637 3435 3831 0a20 2020  bjr/27674581.   
+000231c0: 2020 2020 2054 6563 686e 6963 616c 6c79       Technically
+000231d0: 2074 6865 206d 6561 6e20 6469 7374 616e   the mean distan
+000231e0: 6365 2074 6f20 636f 6e66 6f72 6d69 7479  ce to conformity
+000231f0: 2069 736e 2774 2061 2064 6973 7461 6e63   isn't a distanc
+00023200: 652c 0a20 2020 2020 2020 2062 7574 2069  e,.        but i
+00023210: 7320 6120 6469 7374 616e 6365 2064 6976  s a distance div
+00023220: 6964 6564 2062 7920 6120 766f 6c75 6d65  ided by a volume
+00023230: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
+00023240: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
+00023250: 2061 2073 6b72 742e 636f 7265 2e44 6174   a skrt.core.Dat
+00023260: 6120 6f62 6a65 6374 2c20 7769 7468 2074  a object, with t
+00023270: 6865 2066 6f6c 6c6f 7769 6e67 0a20 2020  he following.   
+00023280: 2020 2020 2069 6e66 6f72 6d61 7469 6f6e       information
+00023290: 3a0a 0a20 2020 2020 2020 206e 5f76 6f78  :..        n_vox
+000232a0: 656c 203a 206e 756d 6265 7220 6f66 2076  el : number of v
+000232b0: 6f78 656c 7320 696e 2074 6865 2075 6e69  oxels in the uni
+000232c0: 6f6e 206f 6620 7468 6520 524f 4973 2063  on of the ROIs c
+000232d0: 6f6e 7369 6465 7265 642e 0a0a 2020 2020  onsidered...    
+000232e0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
+000232f0: 2076 6f78 656c 2073 697a 6520 2864 782c   voxel size (dx,
+00023300: 2064 792c 2064 7a29 2069 6e20 6d69 6c6c   dy, dz) in mill
+00023310: 696d 6574 7265 732c 2069 6e20 7468 650a  imetres, in the.
+00023320: 2020 2020 2020 2020 524f 4920 6d61 736b          ROI mask
+00023330: 7320 7573 6564 2069 6e20 6469 7374 616e  s used in distan
+00023340: 6365 2063 616c 6375 6c61 7469 6f6e 732e  ce calculations.
+00023350: 0a0a 2020 2020 2020 2020 6d65 616e 5f75  ..        mean_u
+00023360: 6e64 6572 5f63 6f6e 746f 7572 696e 6720  nder_contouring 
+00023370: 3a20 7375 6d20 6f66 2061 6273 6f6c 7574  : sum of absolut
+00023380: 6520 7661 6c75 6573 206f 6620 6e65 6761  e values of nega
+00023390: 7469 7665 2064 6973 7461 6e63 6573 0a20  tive distances. 
+000233a0: 2020 2020 2020 2074 6f20 636f 6e66 6f72         to confor
+000233b0: 6d69 7479 2c20 6469 7669 6465 6420 6279  mity, divided by
+000233c0: 2076 6f6c 756d 6520 696e 2075 6e69 6f6e   volume in union
+000233d0: 206f 6620 524f 4973 2063 6f6e 7369 6465   of ROIs conside
+000233e0: 7265 642e 0a0a 2020 2020 2020 2020 6d65  red...        me
+000233f0: 616e 5f6f 7665 725f 636f 6e74 6f75 7269  an_over_contouri
+00023400: 6e67 203a 2073 756d 206f 6620 706f 7369  ng : sum of posi
+00023410: 7469 7665 2064 6973 7461 6e63 6573 2074  tive distances t
+00023420: 6f20 636f 6e66 6f72 6d69 7479 2c0a 2020  o conformity,.  
+00023430: 2020 2020 2020 6469 7669 6465 6420 6279        divided by
+00023440: 2076 6f6c 756d 6520 696e 2075 6e69 6f6e   volume in union
+00023450: 206f 6620 524f 4973 2063 6f6e 7369 6465   of ROIs conside
+00023460: 7265 642e 0a0a 2020 2020 2020 2020 6d65  red...        me
+00023470: 616e 5f64 6973 7461 6e63 655f 746f 5f63  an_distance_to_c
+00023480: 6f6e 666f 726d 6974 7920 3a20 7375 6d20  onformity : sum 
+00023490: 6f66 206d 6561 6e5f 756e 6465 725f 636f  of mean_under_co
+000234a0: 6e74 6f75 7269 6e67 2061 6e64 0a20 2020  ntouring and.   
+000234b0: 2020 2020 206d 6561 6e5f 6f76 6572 5f63       mean_over_c
+000234c0: 6f6e 746f 7572 696e 672e 0a0a 2020 2020  ontouring...    
+000234d0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+000234e0: 3a2a 2a0a 2020 2020 2020 2020 766f 6c5f  :**.        vol_
+000234f0: 756e 6974 7320 3a20 7374 722c 2064 6566  units : str, def
+00023500: 6175 6c74 3d22 6d6d 220a 2020 2020 2020  ault="mm".      
+00023510: 2020 2020 2020 556e 6974 7320 746f 2075        Units to u
+00023520: 7365 2066 6f72 2076 6f6c 756d 6520 696e  se for volume in
+00023530: 2064 656e 6f6d 696e 6174 6f72 2077 6865   denominator whe
+00023540: 6e20 6361 6c63 756c 6174 696e 670a 2020  n calculating.  
+00023550: 2020 2020 2020 2020 2020 6d65 616e 5f75            mean_u
+00023560: 6e64 6572 5f63 6f6e 746f 7572 696e 6720  nder_contouring 
+00023570: 616e 6420 6d65 616e 5f6f 7665 7263 6f6e  and mean_overcon
+00023580: 746f 7572 696e 672e 2043 616e 2062 650a  touring. Can be.
+00023590: 2020 2020 2020 2020 2020 2020 226d 6d22              "mm"
+000235a0: 2028 3d6d 6d5e 3329 2c20 226d 6c22 2c20   (=mm^3), "ml", 
+000235b0: 6f72 2022 766f 7865 6c73 222e 0a0a 2020  or "voxels"...  
+000235c0: 2020 2020 2020 6b77 6172 6773 0a20 2020        kwargs.   
+000235d0: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+000235e0: 2061 7267 756d 656e 7473 2061 7265 2070   arguments are p
+000235f0: 6173 7365 6420 746f 0a20 2020 2020 2020  assed to.       
+00023600: 2020 2020 2073 6b72 742e 7374 7275 6374       skrt.struct
+00023610: 7572 6573 2e52 4f49 2e67 6574 5f73 7572  ures.ROI.get_sur
+00023620: 6661 6365 5f64 6973 7461 6e63 6573 2829  face_distances()
+00023630: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
+00023640: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
+00023650: 6f66 2074 6869 7320 6d65 7468 6f64 2066  of this method f
+00023660: 6f72 2070 6172 616d 6574 6572 2064 6574  or parameter det
+00023670: 6169 6c73 2e0a 2020 2020 2020 2020 2727  ails..        ''
+00023680: 270a 0a20 2020 2020 2020 2023 204f 6274  '..        # Obt
+00023690: 6169 6e20 6469 7374 616e 6365 7320 746f  ain distances to
+000236a0: 2063 6f6e 666f 726d 6974 792e 0a20 2020   conformity..   
+000236b0: 2020 2020 206b 7761 7267 735b 2263 6f6e       kwargs["con
+000236c0: 666f 726d 6974 7922 5d20 3d20 5472 7565  formity"] = True
+000236d0: 0a20 2020 2020 2020 2073 6473 203d 2073  .        sds = s
+000236e0: 656c 662e 6765 745f 7375 7266 6163 655f  elf.get_surface_
+000236f0: 6469 7374 616e 6365 7328 6f74 6865 722c  distances(other,
+00023700: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00023710: 2020 2020 2320 4f62 7461 696e 206d 6173      # Obtain mas
+00023720: 6b20 6172 7261 7920 7265 7072 6573 656e  k array represen
+00023730: 7469 6e67 2075 6e69 6f6e 206f 6620 524f  ting union of RO
+00023740: 4973 2e0a 2020 2020 2020 2020 756e 696f  Is..        unio
+00023750: 6e20 3d20 5374 7275 6374 7572 6553 6574  n = StructureSet
+00023760: 285b 7365 6c66 2c20 6f74 6865 725d 292e  ([self, other]).
+00023770: 636f 6d62 696e 655f 726f 6973 2829 0a20  combine_rois(). 
+00023780: 2020 2020 2020 2076 6965 7720 3d20 6b77         view = kw
+00023790: 6172 6773 2e67 6574 2822 7669 6577 222c  args.get("view",
+000237a0: 2022 782d 7922 290a 2020 2020 2020 2020   "x-y").        
+000237b0: 6966 206b 7761 7267 732e 6765 7428 2273  if kwargs.get("s
+000237c0: 696e 676c 655f 736c 6963 6522 2c20 4661  ingle_slice", Fa
+000237d0: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
+000237e0: 2020 736c 203d 206b 7761 7267 732e 6765    sl = kwargs.ge
+000237f0: 7428 2273 6c22 2c20 4e6f 6e65 290a 2020  t("sl", None).  
+00023800: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+00023810: 6b77 6172 6773 2e67 6574 2822 6964 7822  kwargs.get("idx"
+00023820: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+00023830: 2020 2020 706f 7320 3d20 6b77 6172 6773      pos = kwargs
+00023840: 2e67 6574 2822 706f 7322 2c20 4e6f 6e65  .get("pos", None
+00023850: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00023860: 736b 5f64 6174 6120 3d20 756e 696f 6e2e  sk_data = union.
+00023870: 6765 745f 736c 6963 6528 7669 6577 2c20  get_slice(view, 
+00023880: 736c 2c20 6964 782c 2070 6f73 290a 2020  sl, idx, pos).  
+00023890: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000238a0: 2020 2020 2020 2020 666c 6174 7465 6e20          flatten 
+000238b0: 3d20 6b77 6172 6773 2e67 6574 2822 666c  = kwargs.get("fl
+000238c0: 6174 7465 6e22 2c20 4661 6c73 6529 0a20  atten", False). 
+000238d0: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
+000238e0: 6461 7461 203d 2075 6e69 6f6e 2e67 6574  data = union.get
+000238f0: 5f6d 6173 6b28 7669 6577 2c20 666c 6174  _mask(view, flat
+00023900: 7465 6e29 0a0a 2020 2020 2020 2020 2320  ten)..        # 
+00023910: 4361 6c63 756c 6174 6520 636f 6e66 6f72  Calculate confor
+00023920: 6d69 7479 2073 636f 7265 732e 0a20 2020  mity scores..   
+00023930: 2020 2020 2063 6f6e 666f 726d 6974 7920       conformity 
+00023940: 3d20 736b 7274 2e63 6f72 652e 4461 7461  = skrt.core.Data
+00023950: 2829 0a20 2020 2020 2020 2063 6f6e 666f  ().        confo
+00023960: 726d 6974 792e 6e5f 766f 7865 6c20 3d20  rmity.n_voxel = 
+00023970: 6d61 736b 5f64 6174 612e 7375 6d28 290a  mask_data.sum().
+00023980: 2020 2020 2020 2020 636f 6e66 6f72 6d69          conformi
+00023990: 7479 2e76 6f78 656c 5f73 697a 6520 3d20  ty.voxel_size = 
+000239a0: 756e 696f 6e2e 6765 745f 766f 7865 6c5f  union.get_voxel_
+000239b0: 7369 7a65 2829 0a20 2020 2020 2020 2069  size().        i
+000239c0: 6620 7364 7320 6973 204e 6f6e 653a 0a20  f sds is None:. 
+000239d0: 2020 2020 2020 2020 2020 2063 6f6e 666f             confo
+000239e0: 726d 6974 792e 6d65 616e 5f75 6e64 6572  rmity.mean_under
+000239f0: 5f63 6f6e 746f 7572 696e 6720 3d20 4e6f  _contouring = No
+00023a00: 6e65 0a20 2020 2020 2020 2020 2020 2063  ne.            c
+00023a10: 6f6e 666f 726d 6974 792e 6d65 616e 5f6f  onformity.mean_o
+00023a20: 7665 725f 636f 6e74 6f75 7269 6e67 203d  ver_contouring =
+00023a30: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00023a40: 2020 636f 6e66 6f72 6d69 7479 2e6d 6561    conformity.mea
+00023a50: 6e5f 6469 7374 616e 6365 5f74 6f5f 636f  n_distance_to_co
+00023a60: 6e66 6f72 6d69 7479 203d 204e 6f6e 650a  nformity = None.
+00023a70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00023a80: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
+00023a90: 6d69 7479 2e6d 6561 6e5f 756e 6465 725f  mity.mean_under_
+00023aa0: 636f 6e74 6f75 7269 6e67 203d 2028 6162  contouring = (ab
+00023ab0: 7328 7364 735b 7364 7320 3c20 305d 2e73  s(sds[sds < 0].s
+00023ac0: 756d 2829 290a 2020 2020 2020 2020 2020  um()).          
+00023ad0: 2020 2020 2020 2020 2020 2f20 756e 696f            / unio
+00023ae0: 6e2e 6765 745f 766f 6c75 6d65 2876 6f6c  n.get_volume(vol
+00023af0: 5f75 6e69 7473 2929 0a20 2020 2020 2020  _units)).       
+00023b00: 2020 2020 2063 6f6e 666f 726d 6974 792e       conformity.
+00023b10: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
+00023b20: 7269 6e67 203d 2028 7364 735b 7364 7320  ring = (sds[sds 
+00023b30: 3e20 305d 2e73 756d 2829 0a20 2020 2020  > 0].sum().     
+00023b40: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+00023b50: 2075 6e69 6f6e 2e67 6574 5f76 6f6c 756d   union.get_volum
+00023b60: 6528 766f 6c5f 756e 6974 7329 290a 2020  e(vol_units)).  
+00023b70: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
+00023b80: 6d69 7479 2e6d 6561 6e5f 6469 7374 616e  mity.mean_distan
+00023b90: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
+00023ba0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00023bb0: 2020 2020 2020 2020 2063 6f6e 666f 726d           conform
+00023bc0: 6974 792e 6d65 616e 5f75 6e64 6572 5f63  ity.mean_under_c
+00023bd0: 6f6e 746f 7572 696e 6720 2b0a 2020 2020  ontouring +.    
+00023be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bf0: 636f 6e66 6f72 6d69 7479 2e6d 6561 6e5f  conformity.mean_
+00023c00: 6f76 6572 5f63 6f6e 746f 7572 696e 6729  over_contouring)
+00023c10: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00023c20: 2063 6f6e 666f 726d 6974 790a 0a20 2020   conformity..   
+00023c30: 2064 6566 2067 6574 5f73 7572 6661 6365   def get_surface
+00023c40: 5f64 6973 7461 6e63 655f 6d65 7472 6963  _distance_metric
+00023c50: 7328 7365 6c66 2c20 6f74 6865 722c 202a  s(self, other, *
+00023c60: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+00023c70: 2020 2222 2247 6574 2074 6865 206d 6561    """Get the mea
+00023c80: 6e20 7375 7266 6163 6520 6469 7374 616e  n surface distan
+00023c90: 6365 2c20 524d 5320 7375 7266 6163 6520  ce, RMS surface 
+00023ca0: 6469 7374 616e 6365 2c20 616e 6420 4861  distance, and Ha
+00023cb0: 7573 646f 7266 660a 2020 2020 2020 2020  usdorff.        
+00023cc0: 6469 7374 616e 6365 2e22 2222 0a0a 2020  distance."""..  
+00023cd0: 2020 2020 2020 7364 7320 3d20 7365 6c66        sds = self
+00023ce0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
+00023cf0: 7461 6e63 6573 286f 7468 6572 2c20 2a2a  tances(other, **
+00023d00: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00023d10: 6966 2073 6473 2069 7320 4e6f 6e65 3a0a  if sds is None:.
+00023d20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00023d30: 726e 0a20 2020 2020 2020 2072 6574 7572  rn.        retur
+00023d40: 6e20 7364 732e 6d65 616e 2829 2c20 6e70  n sds.mean(), np
+00023d50: 2e73 7172 7428 2873 6473 202a 2a20 3229  .sqrt((sds ** 2)
+00023d60: 2e6d 6561 6e28 2929 2c20 7364 732e 6d61  .mean()), sds.ma
+00023d70: 7828 290a 0a20 2020 2064 6566 2070 6c6f  x()..    def plo
+00023d80: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
+00023d90: 6365 7328 7365 6c66 2c20 6f74 6865 722c  ces(self, other,
+00023da0: 2073 6176 655f 6173 3d4e 6f6e 652c 2073   save_as=None, s
+00023db0: 6967 6e65 643d 4661 6c73 652c 202a 2a6b  igned=False, **k
+00023dc0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00023dd0: 2222 2250 6c6f 7420 6869 7374 6f67 7261  """Plot histogra
+00023de0: 6d20 6f66 2073 7572 6661 6365 2064 6973  m of surface dis
+00023df0: 7461 6e63 6573 2e22 2222 0a0a 2020 2020  tances."""..    
+00023e00: 2020 2020 7364 7320 3d20 7365 6c66 2e67      sds = self.g
+00023e10: 6574 5f73 7572 6661 6365 5f64 6973 7461  et_surface_dista
+00023e20: 6e63 6573 286f 7468 6572 2c20 7369 676e  nces(other, sign
+00023e30: 6564 3d73 6967 6e65 642c 202a 2a6b 7761  ed=signed, **kwa
+00023e40: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
+00023e50: 7364 7320 6973 204e 6f6e 653a 0a20 2020  sds is None:.   
+00023e60: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00023e70: 2020 2020 2020 2020 6669 672c 2061 7820          fig, ax 
+00023e80: 3d20 706c 742e 7375 6270 6c6f 7473 2829  = plt.subplots()
+00023e90: 0a20 2020 2020 2020 2061 782e 6869 7374  .        ax.hist
+00023ea0: 2873 6473 290a 2020 2020 2020 2020 786c  (sds).        xl
+00023eb0: 6162 656c 203d 2028 0a20 2020 2020 2020  abel = (.       
+00023ec0: 2020 2020 2022 5375 7266 6163 6520 6469       "Surface di
+00023ed0: 7374 616e 6365 2028 6d6d 2922 2069 6620  stance (mm)" if 
+00023ee0: 6e6f 7420 7369 676e 6564 2065 6c73 6520  not signed else 
+00023ef0: 2253 6967 6e65 6420 7375 7266 6163 6520  "Signed surface 
+00023f00: 6469 7374 616e 6365 2028 6d6d 2922 0a20  distance (mm)". 
+00023f10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00023f20: 2061 782e 7365 745f 786c 6162 656c 2878   ax.set_xlabel(x
+00023f30: 6c61 6265 6c29 0a20 2020 2020 2020 2061  label).        a
+00023f40: 782e 7365 745f 796c 6162 656c 2822 4e75  x.set_ylabel("Nu
+00023f50: 6d62 6572 206f 6620 766f 7865 6c73 2229  mber of voxels")
+00023f60: 0a20 2020 2020 2020 2069 6620 7361 7665  .        if save
+00023f70: 5f61 733a 0a20 2020 2020 2020 2020 2020  _as:.           
+00023f80: 2070 6c74 2e74 6967 6874 5f6c 6179 6f75   plt.tight_layou
+00023f90: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00023fa0: 6669 672e 7361 7665 6669 6728 7361 7665  fig.savefig(save
+00023fb0: 5f61 7329 0a0a 2020 2020 6465 6620 6765  _as)..    def ge
+00023fc0: 745f 636f 6d70 6172 6973 6f6e 280a 2020  t_comparison(.  
+00023fd0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00023fe0: 2020 2020 726f 692c 0a20 2020 2020 2020      roi,.       
+00023ff0: 206d 6574 7269 6373 3d4e 6f6e 652c 0a20   metrics=None,. 
+00024000: 2020 2020 2020 2076 6f6c 5f75 6e69 7473         vol_units
+00024010: 3d22 6d6d 222c 0a20 2020 2020 2020 2061  ="mm",.        a
+00024020: 7265 615f 756e 6974 733d 226d 6d22 2c0a  rea_units="mm",.
+00024030: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00024040: 5f75 6e69 7473 3d22 6d6d 222c 0a20 2020  _units="mm",.   
+00024050: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
+00024060: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
+00024070: 2c0a 2020 2020 2020 2020 706f 733d 4e6f  ,.        pos=No
+00024080: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
+00024090: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d65  None,.        me
+000240a0: 7468 6f64 3d4e 6f6e 652c 0a20 2020 2020  thod=None,.     
+000240b0: 2020 2073 6c69 6365 5f73 7461 7473 3d4e     slice_stats=N
+000240c0: 6f6e 652c 0a20 2020 2020 2020 2064 6566  one,.        def
+000240d0: 6175 6c74 5f62 795f 736c 6963 653d 4e6f  ault_by_slice=No
+000240e0: 6e65 2c0a 2020 2020 2020 2020 756e 6974  ne,.        unit
+000240f0: 735f 696e 5f68 6561 6465 723d 4661 6c73  s_in_header=Fals
+00024100: 652c 0a20 2020 2020 2020 2067 6c6f 6261  e,.        globa
+00024110: 6c5f 7673 5f73 6c69 6365 5f68 6561 6465  l_vs_slice_heade
+00024120: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
+00024130: 206e 616d 655f 6173 5f69 6e64 6578 3d54   name_as_index=T
+00024140: 7275 652c 0a20 2020 2020 2020 206e 6963  rue,.        nic
+00024150: 655f 636f 6c75 6d6e 733d 4661 6c73 652c  e_columns=False,
+00024160: 0a20 2020 2020 2020 2064 6563 696d 616c  .        decimal
+00024170: 5f70 6c61 6365 733d 4e6f 6e65 2c0a 2020  _places=None,.  
+00024180: 2020 2020 2020 666f 7263 653d 5472 7565        force=True
+00024190: 2c0a 2020 2020 2020 2020 766f 7865 6c5f  ,.        voxel_
+000241a0: 7369 7a65 3d28 312c 2031 2c20 3129 2c0a  size=(1, 1, 1),.
+000241b0: 2020 2020 2020 2020 6d61 7463 685f 6c65          match_le
+000241c0: 6e67 7468 733d 4661 6c73 652c 0a20 2020  ngths=False,.   
+000241d0: 2020 2020 206d 6174 6368 5f6c 656e 6774       match_lengt
+000241e0: 6873 5f73 7472 6174 6567 793d 310a 2020  hs_strategy=1.  
+000241f0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00024200: 5265 7475 726e 2061 2070 616e 6461 7320  Return a pandas 
+00024210: 4461 7461 4672 616d 6520 6f66 2074 6865  DataFrame of the
+00024220: 2063 6f6d 7061 7269 736f 6e20 6d65 7472   comparison metr
+00024230: 6963 7320 6c69 7374 6564 2069 6e20 0a20  ics listed in . 
+00024240: 2020 2020 2020 203c 6d65 7472 6963 733e         <metrics>
+00024250: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
+00024260: 2061 6e6f 7468 6572 2052 4f49 2e0a 0a20   another ROI... 
+00024270: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+00024280: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
+00024290: 2020 2020 2020 2020 726f 6920 3a20 524f          roi : RO
+000242a0: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
+000242b0: 6865 7220 524f 4920 7769 7468 2077 6869  her ROI with whi
+000242c0: 6368 2074 6f20 636f 6d70 6172 6520 7468  ch to compare th
+000242d0: 6973 2052 4f49 2e0a 0a20 2020 2020 2020  is ROI...       
+000242e0: 206d 6574 7269 6373 203a 206c 6973 742c   metrics : list,
+000242f0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00024300: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
+00024310: 6620 6d65 7472 6963 7320 746f 2069 6e63  f metrics to inc
+00024320: 6c75 6465 2069 6e20 7468 6520 7461 626c  lude in the tabl
+00024330: 652e 204f 7074 696f 6e73 3a0a 0a20 2020  e. Options:..   
+00024340: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024350: 6469 6365 2220 3a20 676c 6f62 616c 2044  dice" : global D
+00024360: 6963 6520 7363 6f72 652e 0a20 2020 2020  ice score..     
+00024370: 2020 2020 2020 2020 2020 202a 2022 6469             * "di
+00024380: 6365 5f66 6c61 7422 3a20 4469 6365 2073  ce_flat": Dice s
+00024390: 636f 7265 206f 6620 524f 4973 2066 6c61  core of ROIs fla
+000243a0: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
+000243b0: 6965 6e74 6174 696f 6e0a 2020 2020 2020  ientation.      
+000243c0: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+000243d0: 6966 6965 6420 696e 203c 7669 6577 3e2e  ified in <view>.
+000243e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000243f0: 202a 2022 6469 6365 5f73 6c69 6365 223a   * "dice_slice":
+00024400: 2044 6963 6520 7363 6f72 6520 6f6e 2061   Dice score on a
+00024410: 2073 696e 676c 6520 736c 6963 652e 0a20   single slice.. 
+00024420: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024430: 2022 6469 6365 5f73 6c69 6365 5f73 7461   "dice_slice_sta
+00024440: 7473 223a 2073 7461 7469 7374 6963 7320  ts": statistics 
+00024450: 7370 6563 6966 6965 6420 696e 203c 736c  specified in <sl
+00024460: 6963 655f 7374 6174 733e 0a20 2020 2020  ice_stats>.     
+00024470: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00024480: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
+00024490: 4469 6365 2073 636f 7265 732e 0a0a 2020  Dice scores...  
+000244a0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+000244b0: 226a 6163 6361 7264 2220 3a20 676c 6f62  "jaccard" : glob
+000244c0: 616c 204a 6163 6361 7264 2069 6e64 6578  al Jaccard index
+000244d0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000244e0: 2020 2a20 226a 6163 6361 7264 5f66 6c61    * "jaccard_fla
+000244f0: 7422 3a20 4a61 6363 6172 6420 696e 6465  t": Jaccard inde
+00024500: 7820 6f66 2052 4f49 7320 666c 6174 7465  x of ROIs flatte
+00024510: 6e65 6420 696e 0a20 2020 2020 2020 2020  ned in.         
+00024520: 2020 2020 2020 2020 2074 6865 206f 7269           the ori
+00024530: 656e 7461 7469 6f6e 2073 7065 6369 6669  entation specifi
+00024540: 6564 2069 6e20 3c76 6965 773e 2e0a 2020  ed in <view>..  
+00024550: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00024560: 226a 6163 6361 7264 5f73 6c69 6365 223a  "jaccard_slice":
+00024570: 204a 6163 6361 7264 2069 6e64 6578 206f   Jaccard index o
+00024580: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
+00024590: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000245a0: 2020 2a20 226a 6163 6361 7264 5f73 6c69    * "jaccard_sli
+000245b0: 6365 5f73 7461 7473 223a 2073 7461 7469  ce_stats": stati
+000245c0: 7374 6963 7320 7370 6563 6966 6965 6420  stics specified 
+000245d0: 696e 203c 736c 6963 655f 7374 6174 733e  in <slice_stats>
+000245e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000245f0: 2020 2066 6f72 2073 6c69 6365 2d62 792d     for slice-by-
+00024600: 736c 6963 6520 4a61 6363 6172 6420 696e  slice Jaccard in
+00024610: 6469 6365 732e 0a0a 2020 2020 2020 2020  dices...        
+00024620: 2020 2020 2020 2020 2a20 2263 656e 7472          * "centr
+00024630: 6f69 6422 3a20 3344 2063 656e 7472 6f69  oid": 3D centroi
+00024640: 6420 6469 7374 616e 6365 2076 6563 746f  d distance vecto
+00024650: 722e 0a20 2020 2020 2020 2020 2020 2020  r..             
+00024660: 2020 202a 2022 6162 735f 6365 6e74 726f     * "abs_centro
+00024670: 6964 223a 206d 6167 6e69 7475 6465 206f  id": magnitude o
+00024680: 6620 3344 2063 656e 7472 6f69 6420 6469  f 3D centroid di
+00024690: 7374 616e 6365 2076 6563 746f 722e 0a20  stance vector.. 
+000246a0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+000246b0: 2022 6162 735f 6365 6e74 726f 6964 5f66   "abs_centroid_f
+000246c0: 6c61 7422 3a20 6d61 676e 6974 7564 6520  lat": magnitude 
+000246d0: 6f66 2033 4420 6365 6e74 726f 6964 2064  of 3D centroid d
+000246e0: 6973 7461 6e63 6520 7665 6374 6f72 0a20  istance vector. 
+000246f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024700: 2070 726f 6a65 6374 6564 2069 6e74 6f20   projected into 
+00024710: 7468 6520 706c 616e 6520 7370 6563 6966  the plane specif
+00024720: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
+00024730: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024740: 2022 6365 6e74 726f 6964 5f73 6c69 6365   "centroid_slice
+00024750: 223a 2032 4420 6365 6e74 726f 6964 2064  ": 2D centroid d
+00024760: 6973 7461 6e63 6520 7665 6374 6f72 206f  istance vector o
+00024770: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
+00024780: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024790: 2020 2a20 2263 656e 7472 6f69 645f 736c    * "centroid_sl
+000247a0: 6963 655f 7374 6174 7322 3a20 7374 6174  ice_stats": stat
+000247b0: 6973 7469 6373 2073 7065 6369 6669 6564  istics specified
+000247c0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
+000247d0: 2020 2020 2020 3c73 6c69 6365 5f73 7461        <slice_sta
+000247e0: 7473 3e20 666f 7220 736c 6963 652d 6279  ts> for slice-by
+000247f0: 2d73 6c69 6365 2032 4420 6365 6e74 726f  -slice 2D centro
+00024800: 6964 2064 6973 7461 6e63 6520 7665 6374  id distance vect
+00024810: 6f72 732e 0a20 2020 2020 2020 2020 2020  ors..           
+00024820: 2020 2020 202a 2022 6162 735f 6365 6e74       * "abs_cent
+00024830: 726f 6964 5f73 6c69 6365 223a 206d 6167  roid_slice": mag
+00024840: 6e69 7475 6465 206f 6620 3244 2063 656e  nitude of 2D cen
+00024850: 7472 6f69 6420 6469 7374 616e 6365 200a  troid distance .
+00024860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024870: 2020 7665 6374 6f72 206f 6e20 6120 7369    vector on a si
+00024880: 6e67 6c65 2073 6c69 6365 2e0a 2020 2020  ngle slice..    
+00024890: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
+000248a0: 6273 5f63 656e 7472 6f69 645f 736c 6963  bs_centroid_slic
+000248b0: 655f 7374 6174 7322 3a20 7374 6174 6973  e_stats": statis
+000248c0: 7469 6373 2073 7065 6369 6669 6564 2069  tics specified i
+000248d0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000248e0: 2020 2020 3c73 6c69 6365 5f73 7461 7473      <slice_stats
+000248f0: 3e20 666f 7220 736c 6963 652d 6279 2d73  > for slice-by-s
+00024900: 6c69 6365 206d 6167 6e69 7475 6465 7320  lice magnitudes 
+00024910: 6f66 2032 440a 2020 2020 2020 2020 2020  of 2D.          
+00024920: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00024930: 2064 6973 7461 6e63 6520 7665 6374 6f72   distance vector
+00024940: 732e 0a0a 2020 2020 2020 2020 2020 2020  s...            
+00024950: 2020 2020 2a20 2276 6f6c 756d 655f 6469      * "volume_di
+00024960: 6666 223a 2076 6f6c 756d 6520 6469 6666  ff": volume diff
+00024970: 6572 656e 6365 2028 6f77 6e20 766f 6c75  erence (own volu
+00024980: 6d65 202d 206f 7468 6572 2076 6f6c 756d  me - other volum
+00024990: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
+000249a0: 2020 2020 2a20 2272 656c 5f76 6f6c 756d      * "rel_volum
+000249b0: 655f 6469 6666 223a 2076 6f6c 756d 6520  e_diff": volume 
+000249c0: 6469 6666 6572 656e 6365 2064 6976 6964  difference divid
+000249d0: 6564 2062 7920 6f77 6e20 766f 6c75 6d65  ed by own volume
+000249e0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000249f0: 2020 2a20 2276 6f6c 756d 655f 7261 7469    * "volume_rati
+00024a00: 6f22 3a20 766f 6c75 6d65 2072 6174 696f  o": volume ratio
+00024a10: 2028 6f77 6e20 766f 6c75 6d65 202f 206f   (own volume / o
+00024a20: 7468 6572 2076 6f6c 756d 6529 2e0a 0a20  ther volume)... 
+00024a30: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024a40: 2022 6172 6561 5f64 6966 6622 3a20 6172   "area_diff": ar
+00024a50: 6561 2064 6966 6665 7265 6e63 6520 286f  ea difference (o
+00024a60: 776e 2061 7265 6120 2d20 6f74 6865 7220  wn area - other 
+00024a70: 6172 6561 2920 6f6e 2061 200a 2020 2020  area) on a .    
+00024a80: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00024a90: 6e67 6c65 2073 6c69 6365 2e0a 2020 2020  ngle slice..    
+00024aa0: 2020 2020 2020 2020 2020 2020 2a20 2272              * "r
+00024ab0: 656c 5f61 7265 615f 6469 6666 223a 2061  el_area_diff": a
+00024ac0: 7265 6120 6469 6666 6572 656e 6365 2064  rea difference d
+00024ad0: 6976 6964 6564 2062 7920 6f77 6e20 6172  ivided by own ar
+00024ae0: 6561 206f 6e20 6120 0a20 2020 2020 2020  ea on a .       
+00024af0: 2020 2020 2020 2020 2020 2073 696e 676c             singl
+00024b00: 6520 736c 6963 652e 0a20 2020 2020 2020  e slice..       
+00024b10: 2020 2020 2020 2020 202a 2022 6172 6561           * "area
+00024b20: 5f72 6174 696f 223a 2061 7265 6120 7261  _ratio": area ra
+00024b30: 7469 6f20 286f 776e 2061 7265 6120 2f20  tio (own area / 
+00024b40: 6f74 6865 7220 6172 6561 292e 0a20 2020  other area)..   
+00024b50: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024b60: 6172 6561 5f64 6966 665f 666c 6174 223a  area_diff_flat":
+00024b70: 2061 7265 6120 6469 6666 6572 656e 6365   area difference
+00024b80: 206f 6620 524f 4973 2066 6c61 7474 656e   of ROIs flatten
+00024b90: 6564 2069 6e20 7468 650a 2020 2020 2020  ed in the.      
+00024ba0: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+00024bb0: 6e74 6174 696f 6e20 7370 6563 6966 6965  ntation specifie
+00024bc0: 6420 696e 203c 7669 6577 3e2e 0a20 2020  d in <view>..   
+00024bd0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024be0: 6172 6561 5f64 6966 665f 736c 6963 655f  area_diff_slice_
+00024bf0: 7374 6174 7322 3a20 7374 6174 6973 7469  stats": statisti
+00024c00: 6373 2073 7065 6369 6669 6564 2069 6e0a  cs specified in.
+00024c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024c20: 2020 3c73 6c69 6365 5f73 7461 7473 3e20    <slice_stats> 
+00024c30: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
+00024c40: 6365 2061 7265 6120 6469 6666 6572 656e  ce area differen
+00024c50: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
+00024c60: 2020 2020 202a 2022 7265 6c5f 6172 6561       * "rel_area
+00024c70: 5f64 6966 665f 666c 6174 223a 2072 656c  _diff_flat": rel
+00024c80: 6174 6976 6520 6172 6561 2064 6966 6665  ative area diffe
+00024c90: 7265 6e63 6520 6f66 2052 4f49 730a 2020  rence of ROIs.  
+00024ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024cb0: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
+00024cc0: 206f 7269 656e 7461 7469 6f6e 2073 7065   orientation spe
+00024cd0: 6369 6669 6564 2069 6e20 3c76 6965 773e  cified in <view>
+00024ce0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024cf0: 2020 2a20 2272 656c 5f61 7265 615f 6469    * "rel_area_di
+00024d00: 6666 5f73 6c69 6365 5f73 7461 7473 223a  ff_slice_stats":
+00024d10: 2073 7461 7469 7374 6963 7320 7370 6563   statistics spec
+00024d20: 6966 6965 6420 696e 0a20 2020 2020 2020  ified in.       
+00024d30: 2020 2020 2020 2020 2020 203c 736c 6963             <slic
+00024d40: 655f 7374 6174 733e 2066 6f72 2072 656c  e_stats> for rel
+00024d50: 6174 6976 6520 6172 6561 2064 6966 6665  ative area diffe
+00024d60: 7265 6e63 6573 206f 6620 524f 4973 2e0a  rences of ROIs..
+00024d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d80: 2a20 2261 7265 615f 7261 7469 6f5f 666c  * "area_ratio_fl
+00024d90: 6174 223a 2061 7265 6120 7261 7469 6f20  at": area ratio 
+00024da0: 6f66 2052 4f49 7320 666c 6174 7465 6e65  of ROIs flattene
+00024db0: 6420 696e 2074 6865 0a20 2020 2020 2020  d in the.       
+00024dc0: 2020 2020 2020 2020 2020 206f 7269 656e             orien
+00024dd0: 7461 7469 6f6e 2073 7065 6369 6669 6564  tation specified
+00024de0: 2069 6e20 3c76 6965 773e 2e0a 2020 2020   in <view>..    
+00024df0: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
+00024e00: 7265 615f 7261 7469 6f5f 736c 6963 655f  rea_ratio_slice_
+00024e10: 7374 6174 7322 3a20 7374 6174 6973 7469  stats": statisti
+00024e20: 6373 2073 7065 6369 6669 6564 2069 6e0a  cs specified in.
+00024e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e40: 2020 3c73 6c69 6365 5f73 7461 7473 3e20    <slice_stats> 
+00024e50: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
+00024e60: 6365 2061 7265 6120 7261 7469 6f73 2e0a  ce area ratios..
+00024e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024e80: 202a 2022 6d65 616e 5f73 6967 6e65 645f   * "mean_signed_
+00024e90: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00024ea0: 223a 206d 6561 6e20 7369 676e 6564 2073  ": mean signed s
+00024eb0: 7572 6661 6365 2064 6973 7461 6e63 652e  urface distance.
+00024ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024ed0: 202a 2022 6d65 616e 5f73 6967 6e65 645f   * "mean_signed_
+00024ee0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00024ef0: 5f66 6c61 7422 3a20 6d65 616e 2073 6967  _flat": mean sig
+00024f00: 6e65 6420 7375 7266 6163 650a 2020 2020  ned surface.    
+00024f10: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00024f20: 7374 616e 6365 206f 6620 524f 4973 2066  stance of ROIs f
+00024f30: 6c61 7474 656e 6564 2069 6e20 7468 6520  lattened in the 
+00024f40: 6f72 6965 6e74 6174 696f 6e20 7370 6563  orientation spec
+00024f50: 6966 6965 640a 2020 2020 2020 2020 2020  ified.          
+00024f60: 2020 2020 2020 2020 696e 203c 7669 6577          in <view
+00024f70: 3e2e 0a20 2020 2020 2020 2020 2020 2020  >..             
+00024f80: 2020 202a 2022 6d65 616e 5f73 7572 6661     * "mean_surfa
+00024f90: 6365 5f64 6973 7461 6e63 6522 3a20 6d65  ce_distance": me
+00024fa0: 616e 2073 7572 6661 6365 2064 6973 7461  an surface dista
+00024fb0: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+00024fc0: 2020 2020 202a 2022 6d65 616e 5f73 7572       * "mean_sur
+00024fd0: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
+00024fe0: 6174 223a 206d 6561 6e20 7375 7266 6163  at": mean surfac
+00024ff0: 6520 6469 7374 616e 6365 206f 6620 524f  e distance of RO
+00025000: 4973 0a20 2020 2020 2020 2020 2020 2020  Is.             
+00025010: 2020 2020 2066 6c61 7474 656e 6564 2069       flattened i
+00025020: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
+00025030: 6e20 7370 6563 6966 6965 6420 696e 203c  n specified in <
+00025040: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
+00025050: 2020 2020 2020 202a 2022 726d 735f 7375         * "rms_su
+00025060: 7266 6163 655f 6469 7374 616e 6365 223a  rface_distance":
+00025070: 2052 4d53 2073 7572 6661 6365 2064 6973   RMS surface dis
+00025080: 7461 6e63 652e 0a20 2020 2020 2020 2020  tance..         
+00025090: 2020 2020 2020 202a 2022 726d 735f 7375         * "rms_su
+000250a0: 7266 6163 655f 6469 7374 616e 6365 5f66  rface_distance_f
+000250b0: 6c61 7422 3a20 524d 5320 7375 7266 6163  lat": RMS surfac
+000250c0: 6520 6469 7374 616e 6365 206f 6620 524f  e distance of RO
+000250d0: 4973 0a20 2020 2020 2020 2020 2020 2020  Is.             
+000250e0: 2020 2020 2066 6c61 7474 656e 6564 2069       flattened i
+000250f0: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
+00025100: 6e20 7370 6563 6966 6965 6420 696e 203c  n specified in <
+00025110: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
+00025120: 2020 2020 2020 202a 2022 726d 735f 7369         * "rms_si
+00025130: 676e 6564 5f73 7572 6661 6365 5f64 6973  gned_surface_dis
+00025140: 7461 6e63 6522 3a20 524d 5320 7369 676e  tance": RMS sign
+00025150: 6564 2073 7572 6661 6365 2064 6973 7461  ed surface dista
+00025160: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+00025170: 2020 2020 202a 2022 726d 735f 7369 676e       * "rms_sign
+00025180: 6564 5f73 7572 6661 6365 5f64 6973 7461  ed_surface_dista
+00025190: 6e63 655f 666c 6174 223a 2052 4d53 2073  nce_flat": RMS s
+000251a0: 6967 6e65 6420 7375 7266 6163 650a 2020  igned surface.  
+000251b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251c0: 6469 7374 616e 6365 206f 6620 524f 4973  distance of ROIs
+000251d0: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
+000251e0: 6520 6f72 6965 6e74 6174 696f 6e20 7370  e orientation sp
+000251f0: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
+00025200: 2020 2020 2020 2020 2020 696e 203c 7669            in <vi
+00025210: 6577 3e2e 0a20 2020 2020 2020 2020 2020  ew>..           
+00025220: 2020 2020 202a 2022 6861 7573 646f 7266       * "hausdorf
+00025230: 665f 6469 7374 616e 6365 223a 2048 6175  f_distance": Hau
+00025240: 7364 6f72 6666 2064 6973 7461 6e63 652e  sdorff distance.
+00025250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025260: 202a 2022 6861 7573 646f 7266 665f 6469   * "hausdorff_di
+00025270: 7374 616e 6365 5f66 6c61 7422 3a20 4861  stance_flat": Ha
+00025280: 7573 646f 7266 6620 6469 7374 616e 6365  usdorff distance
+00025290: 206f 6620 524f 4973 0a20 2020 2020 2020   of ROIs.       
+000252a0: 2020 2020 2020 2020 2020 2066 6c61 7474             flatt
+000252b0: 656e 6564 2069 6e20 7468 6520 6f72 6965  ened in the orie
+000252c0: 6e74 6174 696f 6e20 7370 6563 6966 6965  ntation specifie
+000252d0: 6420 696e 203c 7669 6577 3e2e 0a20 2020  d in <view>..   
+000252e0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+000252f0: 6d65 616e 5f75 6e64 6572 5f63 6f6e 746f  mean_under_conto
+00025300: 7572 696e 6722 3a20 5375 6d20 6f66 2061  uring": Sum of a
+00025310: 6273 6f6c 7574 6520 7661 6c75 6573 206f  bsolute values o
+00025320: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+00025330: 2020 2020 6e65 6761 7469 7665 2064 6973      negative dis
+00025340: 7461 6e63 6573 2074 6f20 636f 6e66 6f72  tances to confor
+00025350: 6d69 7479 2c20 6469 7669 6465 6420 6279  mity, divided by
+00025360: 2076 6f6c 756d 650a 2020 2020 2020 2020   volume.        
+00025370: 2020 2020 2020 2020 2020 696e 2075 6e69            in uni
+00025380: 6f6e 206f 6620 524f 4973 2063 6f6d 7061  on of ROIs compa
+00025390: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
+000253a0: 2020 2020 202a 2022 6d65 616e 5f75 6e64       * "mean_und
+000253b0: 6572 5f63 6f6e 746f 7572 696e 675f 666c  er_contouring_fl
+000253c0: 6174 223a 2053 756d 206f 6620 6162 736f  at": Sum of abso
+000253d0: 6c75 7465 2076 616c 7565 7320 6f66 0a20  lute values of. 
+000253e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253f0: 206e 6567 6174 6976 6520 6469 7374 616e   negative distan
+00025400: 6365 7320 746f 2063 6f6e 666f 726d 6974  ces to conformit
+00025410: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
+00025420: 6c75 6d65 2c0a 2020 2020 2020 2020 2020  lume,.          
+00025430: 2020 2020 2020 2020 666c 6174 7465 6e65          flattene
+00025440: 6420 696e 2074 6865 206f 7269 656e 7461  d in the orienta
+00025450: 7469 6f6e 2073 7065 6369 6669 6564 2069  tion specified i
+00025460: 6e20 3c76 6965 773e 2e0a 2020 2020 2020  n <view>..      
+00025470: 2020 2020 2020 2020 2020 2020 696e 2075              in u
+00025480: 6e69 6f6e 206f 6620 524f 4973 2063 6f6d  nion of ROIs com
+00025490: 7061 7265 642e 0a20 2020 2020 2020 2020  pared..         
+000254a0: 2020 2020 2020 202a 2022 6d65 616e 5f6f         * "mean_o
+000254b0: 7665 725f 636f 6e74 6f75 7269 6e67 223a  ver_contouring":
+000254c0: 2053 756d 206f 6620 706f 7369 7469 7665   Sum of positive
+000254d0: 2064 6973 7461 6e63 6573 0a20 2020 2020   distances.     
+000254e0: 2020 2020 2020 2020 2020 2020 2074 6f20               to 
+000254f0: 636f 6e66 6f72 6d69 7479 2c20 6469 7669  conformity, divi
+00025500: 6465 6420 6279 2076 6f6c 756d 6520 696e  ded by volume in
+00025510: 2075 6e69 6f6e 206f 6620 524f 4973 2063   union of ROIs c
+00025520: 6f6d 7061 7265 642e 0a20 2020 2020 2020  ompared..       
+00025530: 2020 2020 2020 2020 202a 2022 6d65 616e           * "mean
+00025540: 5f6f 7665 725f 636f 6e74 6f75 7269 6e67  _over_contouring
+00025550: 5f66 6c61 7422 3a20 5375 6d20 6f66 2070  _flat": Sum of p
+00025560: 6f73 6974 6976 6520 6469 7374 616e 6365  ositive distance
+00025570: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00025580: 2020 2020 746f 2063 6f6e 666f 726d 6974      to conformit
+00025590: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
+000255a0: 6c75 6d65 2069 6e20 756e 696f 6e20 6f66  lume in union of
+000255b0: 2052 4f49 7320 636f 6d70 6172 6564 2c0a   ROIs compared,.
+000255c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255d0: 2020 666c 6174 7465 6e65 6420 696e 2074    flattened in t
+000255e0: 6865 206f 7269 656e 7461 7469 6f6e 2073  he orientation s
+000255f0: 7065 6369 6669 6564 2069 6e20 3c76 6965  pecified in <vie
+00025600: 773e 2e0a 2020 2020 2020 2020 2020 2020  w>..            
+00025610: 2020 2020 2a20 226d 6561 6e5f 6469 7374      * "mean_dist
+00025620: 616e 6365 5f74 6f5f 636f 6e66 6f72 6d69  ance_to_conformi
+00025630: 7479 223a 2053 756d 206f 6620 6d65 616e  ty": Sum of mean
+00025640: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
+00025650: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+00025660: 2020 2020 616e 6420 6d65 616e 5f6f 7665      and mean_ove
+00025670: 725f 636f 6e74 6f75 7269 6e67 2e0a 2020  r_contouring..  
+00025680: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00025690: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
+000256a0: 6f5f 636f 6e66 6f72 6d69 7479 5f66 6c61  o_conformity_fla
+000256b0: 7422 3a20 5375 6d20 6f66 0a20 2020 2020  t": Sum of.     
+000256c0: 2020 2020 2020 2020 2020 2020 206d 6561               mea
+000256d0: 6e5f 756e 6465 725f 636f 6e74 6f75 7269  n_under_contouri
+000256e0: 6e67 5f66 6c61 7420 616e 6420 6d65 616e  ng_flat and mean
+000256f0: 5f6f 7665 725f 636f 6e74 6f75 7269 6e67  _over_contouring
+00025700: 5f66 6c61 742e 0a0a 2020 2020 2020 2020  _flat...        
+00025710: 2020 2020 4966 204e 6f6e 652c 2064 6566      If None, def
+00025720: 6175 6c74 7320 746f 205b 2264 6963 6522  aults to ["dice"
+00025730: 2c20 2263 656e 7472 6f69 6422 5d2e 0a0a  , "centroid"]...
+00025740: 2020 2020 2020 2020 766f 6c5f 756e 6974          vol_unit
+00025750: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
+00025760: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
+00025770: 2020 556e 6974 7320 746f 2075 7365 2066    Units to use f
+00025780: 6f72 2076 6f6c 756d 652e 2043 616e 2062  or volume. Can b
+00025790: 6520 226d 6d22 2028 3d6d 6d5e 3329 2c20  e "mm" (=mm^3), 
+000257a0: 226d 6c22 2c0a 2020 2020 2020 2020 2020  "ml",.          
+000257b0: 2020 6f72 2022 766f 7865 6c73 222e 0a0a    or "voxels"...
+000257c0: 2020 2020 2020 2020 6172 6561 5f75 6e69          area_uni
+000257d0: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
+000257e0: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
+000257f0: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
+00025800: 666f 7220 6172 6561 732e 2043 616e 2062  for areas. Can b
+00025810: 6520 226d 6d22 2028 3d6d 6d5e 3229 206f  e "mm" (=mm^2) o
+00025820: 7220 2276 6f78 656c 7322 2e0a 0a20 2020  r "voxels"...   
+00025830: 2020 2020 2063 656e 7472 6f69 645f 756e       centroid_un
+00025840: 6974 733a 0a20 2020 2020 2020 2020 2020  its:.           
+00025850: 2055 6e69 7473 2074 6f20 7573 6520 666f   Units to use fo
+00025860: 7220 6365 6e74 726f 6964 732e 2043 616e  r centroids. Can
+00025870: 2062 6520 226d 6d22 206f 7220 2276 6f78   be "mm" or "vox
+00025880: 656c 7322 2e0a 0a20 2020 2020 2020 2076  els"...        v
+00025890: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
+000258a0: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
+000258b0: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
+000258c0: 2069 6e20 7768 6963 6820 746f 2063 6f6d   in which to com
+000258d0: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
+000258e0: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
+000258f0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00025900: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
+00025910: 7320 6f72 2066 6c61 7474 656e 6564 206d  s or flattened m
+00025920: 6574 7269 6373 2e0a 0a20 2020 2020 2020  etrics...       
+00025930: 2073 6c20 3a20 696e 742c 2064 6566 6175   sl : int, defau
+00025940: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00025950: 2020 2020 536c 6963 6520 6e75 6d62 6572      Slice number
+00025960: 206f 6e20 7768 6963 6820 746f 2063 6f6d   on which to com
+00025970: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
+00025980: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
+00025990: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+000259a0: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
+000259b0: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
+000259c0: 645f 736c 6963 652c 206c 656e 6774 685f  d_slice, length_
+000259d0: 736c 6963 6529 2e0a 2020 2020 2020 2020  slice)..        
+000259e0: 2020 2020 4966 203c 736c 3e2c 203c 6964      If <sl>, <id
+000259f0: 783e 2c20 616e 6420 3c70 6f73 3e20 6172  x>, and <pos> ar
+00025a00: 6520 616c 6c20 4e6f 6e65 2c20 7468 6520  e all None, the 
+00025a10: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
+00025a20: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00025a30: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+00025a40: 642e 0a0a 2020 2020 2020 2020 6964 7820  d...        idx 
+00025a50: 3a20 696e 742c 2064 6566 6175 6c74 3d4e  : int, default=N
+00025a60: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00025a70: 536c 6963 6520 696e 6465 7820 6172 7261  Slice index arra
+00025a80: 7920 6f6e 2077 6869 6368 2074 6f20 636f  y on which to co
+00025a90: 6d70 7574 6520 6d65 7472 6963 732e 204f  mpute metrics. O
+00025aa0: 6e6c 7920 7265 6c65 7661 6e74 2066 6f72  nly relevant for
+00025ab0: 200a 2020 2020 2020 2020 2020 2020 7369   .            si
+00025ac0: 6e67 6c65 2d73 6c69 6365 206d 6574 7269  ngle-slice metri
+00025ad0: 6373 2028 6172 6561 2c20 6365 6e74 726f  cs (area, centro
+00025ae0: 6964 5f73 6c69 6365 2c20 6c65 6e67 7468  id_slice, length
+00025af0: 5f73 6c69 6365 292e 0a20 2020 2020 2020  _slice)..       
+00025b00: 2020 2020 2055 7365 6420 6966 203c 736c       Used if <sl
+00025b10: 3e20 6973 204e 6f6e 652e 0a0a 2020 2020  > is None...    
+00025b20: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
+00025b30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00025b40: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+00025b50: 706f 7369 7469 6f6e 2069 6e20 6d6d 206f  position in mm o
+00025b60: 6e20 7768 6963 6820 746f 2063 6f6d 7075  n which to compu
+00025b70: 7465 206d 6574 7269 6373 2e20 4f6e 6c79  te metrics. Only
+00025b80: 2072 656c 6576 616e 7420 666f 7220 0a20   relevant for . 
+00025b90: 2020 2020 2020 2020 2020 2073 696e 676c             singl
+00025ba0: 652d 736c 6963 6520 6d65 7472 6963 7320  e-slice metrics 
+00025bb0: 2861 7265 612c 2063 656e 7472 6f69 645f  (area, centroid_
+00025bc0: 736c 6963 652c 206c 656e 6774 685f 736c  slice, length_sl
+00025bd0: 6963 6529 2e0a 2020 2020 2020 2020 2020  ice)..          
+00025be0: 2020 5573 6564 2069 6620 3c73 6c3e 2061    Used if <sl> a
+00025bf0: 6e64 203c 6964 783e 2061 7265 2062 6f74  nd <idx> are bot
+00025c00: 6820 4e6f 6e65 2e0a 0a20 2020 2020 2020  h None...       
+00025c10: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
+00025c20: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00025c30: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
+00025c40: 6f20 7573 6520 666f 7220 6d65 7472 6963  o use for metric
+00025c50: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
+00025c60: 6e20 6265 2065 6974 6865 7220 2263 6f6e  n be either "con
+00025c70: 746f 7572 2220 0a20 2020 2020 2020 2020  tour" .         
+00025c80: 2020 2028 7573 6520 7368 6170 656c 7920     (use shapely 
+00025c90: 706f 6c79 676f 6e73 2920 6f72 2022 6d61  polygons) or "ma
+00025ca0: 736b 2220 2875 7365 2062 696e 6172 7920  sk" (use binary 
+00025cb0: 6d61 736b 292e 2049 6620 4e6f 6e65 2c0a  mask). If None,.
+00025cc0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00025cd0: 7661 6c75 6520 7365 7420 696e 2073 656c  value set in sel
+00025ce0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
+00025cf0: 6574 686f 6420 7769 6c6c 2062 6520 7573  ethod will be us
+00025d00: 6564 2e20 4e6f 7465 200a 2020 2020 2020  ed. Note .      
+00025d10: 2020 2020 2020 7468 6174 2066 6c61 7474        that flatt
+00025d20: 656e 6564 206d 6574 7269 6373 2061 6e64  ened metrics and
+00025d30: 2073 7572 6661 6365 2064 6973 7461 6e63   surface distanc
+00025d40: 6520 6d65 7472 6963 7320 656e 666f 7263  e metrics enforc
+00025d50: 6520 7573 650a 2020 2020 2020 2020 2020  e use.          
+00025d60: 2020 6f66 2074 6865 2022 6d61 736b 2220    of the "mask" 
+00025d70: 6d65 7468 6f64 2e0a 0a20 2020 2020 2020  method...       
+00025d80: 2073 6c69 6365 5f73 7461 7473 203a 2073   slice_stats : s
+00025d90: 7472 2f6c 6973 742f 6469 6374 2c20 6465  tr/list/dict, de
+00025da0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00025db0: 2020 2020 2020 2053 7065 6369 6669 6361         Specifica
+00025dc0: 7469 6f6e 206f 6620 7374 6174 6973 7469  tion of statisti
+00025dd0: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
+00025de0: 7465 6420 7265 6c61 7469 7665 0a20 2020  ted relative.   
+00025df0: 2020 2020 2020 2020 2074 6f20 736c 6963           to slic
+00025e00: 652d 6279 2d73 6c69 6365 206d 6574 7269  e-by-slice metri
+00025e10: 6320 7661 6c75 6573 2e20 2055 7365 6420  c values.  Used 
+00025e20: 666f 7220 616c 6c20 6d65 7472 6963 7320  for all metrics 
+00025e30: 7769 7468 0a20 2020 2020 2020 2020 2020  with.           
+00025e40: 2073 7566 6669 7820 225f 736c 6963 655f   suffix "_slice_
+00025e50: 7374 6174 7322 2069 6e20 7468 6520 3c6d  stats" in the <m
+00025e60: 6574 7269 6373 3e20 6c69 7374 2e0a 0a20  etrics> list... 
+00025e70: 2020 2020 2020 2020 2020 2041 2073 7461             A sta
+00025e80: 7469 7374 6963 2069 7320 7370 6563 6966  tistic is specif
+00025e90: 6965 6420 6279 2074 6865 206e 616d 6520  ied by the name 
+00025ea0: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
+00025eb0: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00025ec0: 6974 7320 6361 6c63 756c 6174 696f 6e20  its calculation 
+00025ed0: 696e 2074 6865 2050 7974 686f 6e20 7374  in the Python st
+00025ee0: 6174 6973 7469 6373 206d 6f64 756c 653a  atistics module:
+00025ef0: 0a0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
+00025f00: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
+00025f10: 6e2e 6f72 672f 332f 6c69 6272 6172 792f  n.org/3/library/
+00025f20: 7374 6174 6973 7469 6373 2e68 746d 6c0a  statistics.html.
+00025f30: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
+00025f40: 2069 7473 2075 7365 2068 6572 652c 2074   its use here, t
+00025f50: 6865 2072 656c 6576 616e 7420 6675 6e63  he relevant func
+00025f60: 7469 6f6e 206d 7573 7420 7265 7175 6972  tion must requir
+00025f70: 650a 2020 2020 2020 2020 2020 2020 6120  e.            a 
+00025f80: 7369 6e67 6c65 2d76 6172 6961 626c 6520  single-variable 
+00025f90: 696e 7075 742c 206d 7573 7420 6e6f 7420  input, must not 
+00025fa0: 7265 7175 6972 6520 616e 7920 6b65 7977  require any keyw
+00025fb0: 6f72 640a 2020 2020 2020 2020 2020 2020  ord.            
+00025fc0: 6172 6775 6d65 6e74 732c 2061 6e64 206d  arguments, and m
+00025fd0: 7573 7420 7265 7475 726e 2061 2073 696e  ust return a sin
+00025fe0: 676c 6520 6e75 6d62 6572 2e0a 0a20 2020  gle number...   
+00025ff0: 2020 2020 2020 2020 2041 7661 696c 6162           Availab
+00026000: 6c65 206f 7074 696f 6e73 2069 6e63 6c75  le options inclu
+00026010: 6465 3a20 226d 6561 6e22 2c20 226d 6564  de: "mean", "med
+00026020: 6961 6e22 2c20 226d 6f64 6522 2c0a 2020  ian", "mode",.  
+00026030: 2020 2020 2020 2020 2020 2273 7464 6576            "stdev
+00026040: 222e 0a0a 2020 2020 2020 2020 2020 2053  "...           S
+00026050: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+00026060: 6361 6c63 756c 6174 6564 2063 616e 2062  calculated can b
+00026070: 6520 7370 6563 6966 6965 6420 7573 696e  e specified usin
+00026080: 6720 616e 7920 6f66 0a20 2020 2020 2020  g any of.       
+00026090: 2020 2020 7468 6520 666f 6c6c 6f77 696e      the followin
+000260a0: 673a 0a0a 2020 2020 2020 2020 2020 202d  g:..           -
+000260b0: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
+000260c0: 6e67 2073 696e 676c 6520 7374 6174 6973  ng single statis
+000260d0: 7469 6320 746f 2062 6520 6361 6c63 756c  tic to be calcul
+000260e0: 6174 6564 2c0a 2020 2020 2020 2020 2020  ated,.          
+000260f0: 2020 2077 6974 6820 736c 6963 6573 2063     with slices c
+00026100: 6f6e 7369 6465 7265 6420 6173 2067 6976  onsidered as giv
+00026110: 656e 2062 7920 6465 6661 756c 745f 6279  en by default_by
+00026120: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+00026130: 2020 2020 2066 6f72 2065 7861 6d70 6c65       for example
+00026140: 3a20 226d 6561 6e22 3b0a 2020 2020 2020  : "mean";.      
+00026150: 2020 2020 202d 204c 6973 7420 7370 6563       - List spec
+00026160: 6966 7969 6e67 206d 756c 7469 706c 6520  ifying multiple 
+00026170: 7374 6174 6973 7469 6373 2074 6f20 6265  statistics to be
+00026180: 2063 616c 6375 6c61 7465 642c 0a20 2020   calculated,.   
+00026190: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+000261a0: 6c69 6365 7320 636f 6e73 6964 6572 6564  lices considered
+000261b0: 2061 7320 6769 7665 6e20 6279 2064 6566   as given by def
+000261c0: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
+000261d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000261e0: 6578 616d 706c 653a 205b 226d 6561 6e22  example: ["mean"
+000261f0: 2c20 2273 7464 6576 225d 3b0a 2020 2020  , "stdev"];.    
+00026200: 2020 2020 2020 202d 2044 6963 7469 6f6e         - Diction
+00026210: 6172 7920 7768 6572 6520 6b65 7973 2073  ary where keys s
+00026220: 7065 6369 6679 2073 6c69 6365 7320 746f  pecify slices to
+00026230: 2062 6520 636f 6e73 6964 6572 6564 2c0a   be considered,.
+00026240: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00026250: 2076 616c 7565 7320 7370 6563 6966 7920   values specify 
+00026260: 7374 6174 6973 7469 6373 2028 7374 7269  statistics (stri
+00026270: 6e67 206f 7220 6c69 7374 292c 2066 6f72  ng or list), for
+00026280: 0a20 2020 2020 2020 2020 2020 2020 6578  .             ex
+00026290: 616d 706c 653a 207b 2275 6e69 6f6e 223a  ample: {"union":
+000262a0: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
+000262b0: 225d 7d2e 2020 5661 6c69 6420 736c 6963  "]}.  Valid slic
+000262c0: 650a 2020 2020 2020 2020 2020 2020 2073  e.             s
+000262d0: 7065 6369 6669 6361 7469 6f6e 7320 6172  pecifications ar
+000262e0: 6520 6173 206c 6973 7465 6420 666f 7220  e as listed for 
+000262f0: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00026300: 2e0a 0a20 2020 2020 2020 2064 6566 6175  ...        defau
+00026310: 6c74 5f62 795f 736c 6963 653a 2073 7472  lt_by_slice: str
+00026320: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00026330: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00026340: 6c74 2073 7065 6369 6669 6361 7469 6f6e  lt specification
+00026350: 206f 6620 736c 6963 6573 2074 6f20 6265   of slices to be
+00026360: 2063 6f6e 7369 6465 7265 6420 7768 656e   considered when
+00026370: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
+00026380: 6375 6c61 7469 6e67 2073 6c69 6365 2d62  culating slice-b
+00026390: 792d 736c 6963 6520 7374 6174 6973 7469  y-slice statisti
+000263a0: 6373 2e20 2054 6865 2076 616c 6964 2073  cs.  The valid s
+000263b0: 7065 6369 6669 6361 7469 6f6e 730a 2020  pecifications.  
+000263c0: 2020 2020 2020 2020 2020 6172 653a 0a0a            are:..
+000263d0: 2020 2020 2020 2020 2020 2020 2d20 226c              - "l
+000263e0: 6566 7422 3a20 636f 6e73 6964 6572 206f  eft": consider o
+000263f0: 6e6c 7920 736c 6963 6573 2063 6f6e 7461  nly slices conta
+00026400: 696e 696e 6720 7365 6c66 3b0a 2020 2020  ining self;.    
+00026410: 2020 2020 2020 2020 2d20 2272 6967 6874          - "right
+00026420: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
+00026430: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+00026440: 6e67 206f 7468 6572 2072 6f69 3b0a 2020  ng other roi;.  
+00026450: 2020 2020 2020 2020 2020 2d20 2275 6e69            - "uni
+00026460: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
+00026470: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+00026480: 6569 7468 6572 206f 6620 7365 6c66 2061  either of self a
+00026490: 6e64 206f 7468 6572 2072 6f69 3b0a 2020  nd other roi;.  
+000264a0: 2020 2020 2020 2020 2020 2d20 2269 6e74            - "int
+000264b0: 6572 7365 6374 696f 6e22 3a20 636f 6e73  ersection": cons
+000264c0: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+000264d0: 6169 6e69 6e67 2062 6f74 6820 6f66 2073  aining both of s
+000264e0: 656c 6620 616e 640a 2020 2020 2020 2020  elf and.        
+000264f0: 2020 2020 2020 6f74 6865 7220 726f 692e        other roi.
+00026500: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+00026510: 204e 6f6e 652c 2075 7365 2073 6b72 742e   None, use skrt.
+00026520: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
+00026530: 6279 5f73 6c69 6365 0a0a 2020 2020 2020  by_slice..      
+00026540: 2020 756e 6974 735f 696e 5f68 6561 6465    units_in_heade
+00026550: 7220 3a20 626f 6f6c 2c20 6465 6661 756c  r : bool, defaul
+00026560: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00026570: 2020 2020 4966 2054 7275 652c 2075 6e69      If True, uni
+00026580: 7473 2077 696c 6c20 6265 2069 6e63 6c75  ts will be inclu
+00026590: 6465 6420 696e 2063 6f6c 756d 6e20 6865  ded in column he
+000265a0: 6164 6572 732e 0a0a 2020 2020 2020 2020  aders...        
+000265b0: 676c 6f62 616c 5f76 735f 736c 6963 655f  global_vs_slice_
+000265c0: 6865 6164 6572 203a 2062 6f6f 6c2c 2064  header : bool, d
+000265d0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+000265e0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+000265f0: 2c20 7468 6520 7265 7475 726e 6564 2044  , the returned D
+00026600: 6174 6146 7261 6d65 2077 696c 6c20 6861  ataFrame will ha
+00026610: 7665 2061 6e20 6578 7472 6120 7365 7420  ve an extra set 
+00026620: 6f66 2068 6561 6465 7273 0a20 2020 2020  of headers.     
+00026630: 2020 2020 2020 2073 706c 6974 7469 6e67         splitting
+00026640: 2074 6865 2074 6162 6c65 2069 6e74 6f20   the table into 
+00026650: 2267 6c6f 6261 6c22 2061 6e64 2022 736c  "global" and "sl
+00026660: 6963 6522 206d 6574 7269 6373 2e0a 0a20  ice" metrics... 
+00026670: 2020 2020 2020 206e 616d 655f 6173 5f69         name_as_i
+00026680: 6e64 6578 203a 2062 6f6f 6c2c 2064 6566  ndex : bool, def
+00026690: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
+000266a0: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+000266b0: 6865 2069 6e64 6578 2063 6f6c 756d 6e20  he index column 
+000266c0: 6f66 2074 6865 2070 616e 6461 7320 4461  of the pandas Da
+000266d0: 7461 4672 616d 6520 7769 6c6c 200a 2020  taFrame will .  
+000266e0: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
+000266f0: 6e20 7468 6520 524f 4927 7320 6e61 6d65  n the ROI's name
+00026700: 733b 206f 7468 6572 7769 7365 2c20 7468  s; otherwise, th
+00026710: 6520 6e61 6d65 2077 696c 6c20 6170 7065  e name will appe
+00026720: 6172 2069 6e20 6120 636f 6c75 6d6e 0a20  ar in a column. 
+00026730: 2020 2020 2020 2020 2020 206e 616d 6564             named
+00026740: 2022 524f 4922 2e0a 0a20 2020 2020 2020   "ROI"...       
+00026750: 206e 6963 655f 636f 6c75 6d6e 7320 3a20   nice_columns : 
+00026760: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00026770: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00026780: 4966 2046 616c 7365 2c20 636f 6c75 6d6e  If False, column
+00026790: 206e 616d 6573 2077 696c 6c20 6265 2074   names will be t
+000267a0: 6865 2073 616d 6520 6173 2074 6865 2069  he same as the i
+000267b0: 6e70 7574 206d 6574 7269 6373 206e 616d  nput metrics nam
+000267c0: 6573 3b0a 2020 2020 2020 2020 2020 2020  es;.            
+000267d0: 6966 2054 7275 652c 2074 6865 206e 616d  if True, the nam
+000267e0: 6573 2077 696c 6c20 6265 2063 6170 6974  es will be capit
+000267f0: 616c 697a 6564 2061 6e64 2075 6e64 6572  alized and under
+00026800: 7363 6f72 6573 2077 696c 6c20 6265 200a  scores will be .
+00026810: 2020 2020 2020 2020 2020 2020 7265 706c              repl
+00026820: 6163 6564 2077 6974 6820 7370 6163 6573  aced with spaces
+00026830: 2e0a 0a20 2020 2020 2020 2064 6563 696d  ...        decim
+00026840: 616c 5f70 6c61 6365 7320 3a20 696e 742c  al_places : int,
+00026850: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00026860: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
+00026870: 206f 6620 6465 6369 6d61 6c20 706c 6163   of decimal plac
+00026880: 6573 2074 6f20 6b65 6570 2066 6f72 2065  es to keep for e
+00026890: 6163 6820 6d65 7472 6963 2e20 4966 204e  ach metric. If N
+000268a0: 6f6e 652c 2066 756c 6c0a 2020 2020 2020  one, full.      
+000268b0: 2020 2020 2020 7072 6563 6973 696f 6e20        precision 
+000268c0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+000268d0: 2020 2020 2020 2066 6f72 6365 203a 2062         force : b
+000268e0: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
+000268f0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00026900: 2046 616c 7365 2c20 676c 6f62 616c 206d   False, global m
+00026910: 6574 7269 6373 2066 6f72 2065 6163 6820  etrics for each 
+00026920: 524f 4920 2876 6f6c 756d 652c 2033 4420  ROI (volume, 3D 
+00026930: 6365 6e74 726f 6964 2c20 0a20 2020 2020  centroid, .     
+00026940: 2020 2020 2020 2033 4420 6c65 6e67 7468         3D length
+00026950: 7329 2077 696c 6c20 6f6e 6c79 2062 6520  s) will only be 
+00026960: 6361 6c63 756c 6174 6564 2069 6620 7468  calculated if th
+00026970: 6579 2068 6176 6520 6e6f 7420 6265 656e  ey have not been
+00026980: 200a 2020 2020 2020 2020 2020 2020 6361   .            ca
+00026990: 6c63 756c 6174 6564 2062 6566 6f72 653b  lculated before;
+000269a0: 2069 6620 5472 7565 2c20 616c 6c20 6d65   if True, all me
+000269b0: 7472 6963 7320 7769 6c6c 2062 6520 7265  trics will be re
+000269c0: 6361 6c63 756c 6174 6564 2e0a 0a20 2020  calculated...   
+000269d0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
+000269e0: 3a20 7475 706c 652c 2064 6566 6175 6c74  : tuple, default
+000269f0: 3d28 312c 2031 2c20 3129 0a20 2020 2020  =(1, 1, 1).     
+00026a00: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
+00026a10: 6520 2864 782c 2064 792c 2064 7a29 2069  e (dx, dy, dz) i
+00026a20: 6e20 6d6d 2074 6f20 6265 2075 7365 6420  n mm to be used 
+00026a30: 666f 7220 524f 4920 6d61 736b 730a 2020  for ROI masks.  
+00026a40: 2020 2020 2020 2020 2020 6672 6f6d 2077            from w
+00026a50: 6869 6368 2074 6f20 6361 6c63 756c 6174  hich to calculat
+00026a60: 6520 7375 7266 6163 6520 6469 7374 616e  e surface distan
+00026a70: 6365 732e 2020 4966 204e 6f6e 652c 0a20  ces.  If None,. 
+00026a80: 2020 2020 2020 2020 2020 2074 6865 206d             the m
+00026a90: 6173 6b20 766f 7865 6c20 7369 7a65 206f  ask voxel size o
+00026aa0: 6620 3c6f 7468 6572 3e20 6973 2075 7365  f <other> is use
+00026ab0: 642e 2020 4966 2061 6e20 696e 6469 7669  d.  If an indivi
+00026ac0: 6475 616c 0a20 2020 2020 2020 2020 2020  dual.           
+00026ad0: 2065 6c65 6d65 6e74 2069 7320 4e6f 6e65   element is None
+00026ae0: 2c20 7468 6520 7661 6c75 6520 6f66 2074  , the value of t
+00026af0: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
+00026b00: 2065 6c65 6d65 6e74 2066 6f72 0a20 2020   element for.   
+00026b10: 2020 2020 2020 2020 2074 6865 206d 6173           the mas
+00026b20: 6b20 766f 7865 6c20 7369 7a65 206f 6620  k voxel size of 
+00026b30: 3c6f 7468 6572 3e20 6973 2075 7365 642e  <other> is used.
+00026b40: 2020 4120 7661 6c75 650a 2020 2020 2020    A value.      
+00026b50: 2020 2020 2020 6f74 6865 7220 7468 616e        other than
+00026b60: 204e 6f6e 6520 666f 7263 6573 2063 7265   None forces cre
+00026b70: 6174 696f 6e20 6f66 206d 6173 6b73 2074  ation of masks t
+00026b80: 6861 7420 6a75 7374 2063 6f76 6572 0a20  hat just cover. 
+00026b90: 2020 2020 2020 2020 2020 2074 6865 2076             the v
+00026ba0: 6f6c 756d 6520 6f63 6375 7069 6564 2062  olume occupied b
+00026bb0: 7920 7468 6520 7477 6f20 524f 4973 2062  y the two ROIs b
+00026bc0: 6569 6e67 2063 6f6d 7061 7265 642c 0a20  eing compared,. 
+00026bd0: 2020 2020 2020 2020 2020 2070 6f74 656e             poten
+00026be0: 7469 616c 6c79 2072 6564 7563 696e 6720  tially reducing 
+00026bf0: 7468 6520 7469 6d65 2066 6f72 2073 7572  the time for sur
+00026c00: 6661 6365 2d64 6973 7461 6e63 6520 6361  face-distance ca
+00026c10: 6c63 756c 6174 696f 6e73 2e0a 0a20 2020  lculations...   
+00026c20: 2020 2020 206d 6174 6368 5f6c 656e 6774       match_lengt
+00026c30: 6873 203a 2062 6f6f 6c2f 7374 722f 6c69  hs : bool/str/li
+00026c40: 7374 2c20 6465 6661 756c 743d 4661 6c73  st, default=Fals
+00026c50: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00026c60: 2073 6574 2074 6f20 5472 7565 2c20 746f   set to True, to
+00026c70: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+00026c80: 206f 7468 6572 2052 4f49 2c20 6f72 2074   other ROI, or t
+00026c90: 6f20 6120 6c69 7374 0a20 2020 2020 2020  o a list.       
+00026ca0: 2020 2020 206f 6620 6e61 6d65 7320 696e       of names in
+00026cb0: 636c 7564 696e 6720 7468 6520 6e61 6d65  cluding the name
+00026cc0: 206f 6620 7468 6520 6f74 6865 7220 524f   of the other RO
+00026cd0: 492c 206d 6174 6368 2052 4f49 206c 656e  I, match ROI len
+00026ce0: 6774 6873 0a20 2020 2020 2020 2020 2020  gths.           
+00026cf0: 2028 7a2d 6469 6d65 6e73 696f 6e73 2920   (z-dimensions) 
+00026d00: 6265 666f 7265 2063 6f6d 7061 7269 736f  before compariso
+00026d10: 6e2e 2020 5468 6520 7374 7261 7465 6779  n.  The strategy
+00026d20: 2075 7365 6420 6973 2064 6566 696e 6564   used is defined
+00026d30: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
+00026d40: 7468 6520 7661 6c75 6520 6f66 206d 6174  the value of mat
+00026d50: 6368 5f6c 656e 6774 6873 5f73 7472 6174  ch_lengths_strat
+00026d60: 6567 792e 0a0a 2020 2020 2020 2020 6d61  egy...        ma
+00026d70: 7463 685f 6c65 6e67 7468 735f 7374 7261  tch_lengths_stra
+00026d80: 7465 6779 203a 2069 6e74 2c20 6465 6661  tegy : int, defa
+00026d90: 756c 743d 310a 2020 2020 2020 2020 2020  ult=1.          
+00026da0: 2020 5374 7261 7465 6779 2074 6f20 7573    Strategy to us
+00026db0: 6520 666f 7220 6d61 7463 6869 6e67 2052  e for matching R
+00026dc0: 4f49 206c 656e 6774 6873 2028 7a2d 6469  OI lengths (z-di
+00026dd0: 6d65 6e73 696f 6e73 293a 0a0a 2020 2020  mensions):..    
+00026de0: 2020 2020 2020 2020 2d20 3020 3a20 4372          - 0 : Cr
+00026df0: 6f70 2074 6869 7320 524f 4920 746f 2074  op this ROI to t
+00026e00: 6865 207a 2d65 7874 656e 7473 206f 6620  he z-extents of 
+00026e10: 7468 6520 6f74 6865 7220 524f 493b 0a20  the other ROI;. 
+00026e20: 2020 2020 2020 2020 2020 202d 2031 203a             - 1 :
+00026e30: 2043 726f 7020 7468 6520 6f74 6865 7220   Crop the other 
+00026e40: 524f 4920 746f 2074 6865 207a 2d65 7865  ROI to the z-exe
+00026e50: 6e74 7320 6f66 2074 6869 7320 524f 493b  nts of this ROI;
+00026e60: 0a20 2020 2020 2020 2020 2020 202d 2032  .            - 2
+00026e70: 203a 2043 726f 7020 7468 6973 2052 4f49   : Crop this ROI
+00026e80: 2074 6f20 7468 6520 7a2d 6578 7465 6e74   to the z-extent
+00026e90: 7320 6f66 2074 6865 206f 7468 6572 2052  s of the other R
+00026ea0: 4f49 2c20 7468 656e 0a20 2020 2020 2020  OI, then.       
+00026eb0: 2020 2020 2020 2020 2020 2063 726f 7020             crop 
+00026ec0: 7468 6520 6f74 6865 7220 524f 4920 746f  the other ROI to
+00026ed0: 2074 6865 2063 726f 7070 6564 207a 2d65   the cropped z-e
+00026ee0: 7874 656e 7473 206f 6620 7468 6973 2052  xtents of this R
+00026ef0: 4f49 2e0a 0a20 2020 2020 2020 2020 2020  OI...           
+00026f00: 2046 6f72 2061 2076 616c 7565 206f 7468   For a value oth
+00026f10: 6572 2074 6861 6e20 302c 2031 2c20 322c  er than 0, 1, 2,
+00026f20: 206e 6f20 6c65 6e67 7468 206d 6174 6368   no length match
+00026f30: 696e 6720 6973 2070 6572 666f 726d 6564  ing is performed
+00026f40: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00026f50: 2020 2020 2020 6966 2076 6f78 656c 5f73        if voxel_s
+00026f60: 697a 6520 6973 206e 6f74 204e 6f6e 653a  ize is not None:
+00026f70: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00026f80: 7265 6174 6520 524f 4920 6d61 736b 732c  reate ROI masks,
+00026f90: 206a 7573 7420 636f 7665 7269 6e67 2076   just covering v
+00026fa0: 6f6c 756d 6520 6f63 6375 7069 6564 0a20  olume occupied. 
+00026fb0: 2020 2020 2020 2020 2020 2023 2062 7920             # by 
+00026fc0: 524f 4973 2062 6569 6e67 2063 6f6d 7061  ROIs being compa
+00026fd0: 7265 642c 2077 6974 6820 7370 6563 6966  red, with specif
+00026fe0: 6965 6420 766f 7865 6c20 7369 7a65 2e0a  ied voxel size..
+00026ff0: 2020 2020 2020 2020 2020 2020 2320 2854              # (T
+00027000: 6865 2072 6573 697a 696e 6720 6973 2070  he resizing is p
+00027010: 6572 666f 726d 6564 206f 6e20 636c 6f6e  erformed on clon
+00027020: 6573 206f 6e20 7468 6520 524f 4973 2c0a  es on the ROIs,.
+00027030: 2020 2020 2020 2020 2020 2020 2320 7769              # wi
+00027040: 7468 6f75 7420 6368 616e 6769 6e67 2074  thout changing t
+00027050: 6865 206f 7269 6769 6e61 6c73 2e29 0a20  he originals.). 
+00027060: 2020 2020 2020 2020 2020 2072 6f69 302c             roi0,
+00027070: 2072 6f69 203d 2073 656c 662e 6d61 7463   roi = self.matc
+00027080: 685f 6d61 736b 5f76 6f78 656c 5f73 697a  h_mask_voxel_siz
+00027090: 6528 726f 692c 0a20 2020 2020 2020 2020  e(roi,.         
+000270a0: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
+000270b0: 5f73 697a 653d 766f 7865 6c5f 7369 7a65  _size=voxel_size
+000270c0: 2c20 766f 7865 6c5f 6469 6d5f 746f 6c65  , voxel_dim_tole
+000270d0: 7261 6e63 653d 2d31 290a 2020 2020 2020  rance=-1).      
+000270e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000270f0: 2020 2020 2320 446f 6e27 7420 6578 706c      # Don't expl
+00027100: 6963 6974 6c79 2063 7265 6174 6520 524f  icitly create RO
+00027110: 4920 6d61 736b 732e 0a20 2020 2020 2020  I masks..       
+00027120: 2020 2020 2072 6f69 3020 3d20 7365 6c66       roi0 = self
+00027130: 0a0a 2020 2020 2020 2020 2320 4f70 7469  ..        # Opti
+00027140: 6f6e 616c 6c79 206d 6174 6368 2052 4f49  onally match ROI
+00027150: 206c 656e 6774 6873 2e0a 2020 2020 2020   lengths..      
+00027160: 2020 6966 2028 286d 6174 6368 5f6c 656e    if ((match_len
+00027170: 6774 6873 2069 7320 5472 7565 2920 6f72  gths is True) or
+00027180: 2028 726f 692e 6e61 6d65 203d 3d20 6d61   (roi.name == ma
+00027190: 7463 685f 6c65 6e67 7468 7329 0a20 2020  tch_lengths).   
+000271a0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+000271b0: 2869 7369 6e73 7461 6e63 6528 6d61 7463  (isinstance(matc
+000271c0: 685f 6c65 6e67 7468 732c 2028 6c69 7374  h_lengths, (list
+000271d0: 2c20 7475 706c 652c 2073 6574 2929 0a20  , tuple, set)). 
+000271e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271f0: 2020 2061 6e64 2072 6f69 2e6e 616d 6520     and roi.name 
+00027200: 696e 206d 6174 6368 5f6c 656e 6774 6873  in match_lengths
+00027210: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00027220: 2320 4372 6561 7465 2052 4f49 2063 6c6f  # Create ROI clo
+00027230: 6e65 7320 666f 7220 6372 6f70 7069 6e67  nes for cropping
+00027240: 3b20 7468 6520 6f72 6967 696e 616c 7320  ; the originals 
+00027250: 7769 6c6c 2062 6520 756e 6368 616e 6765  will be unchange
+00027260: 642e 0a20 2020 2020 2020 2020 2020 2069  d..            i
+00027270: 6620 6d61 7463 685f 6c65 6e67 7468 735f  f match_lengths_
+00027280: 7374 7261 7465 6779 2069 6e20 5b30 2c20  strategy in [0, 
+00027290: 312c 2032 5d20 616e 6420 766f 7865 6c5f  1, 2] and voxel_
+000272a0: 7369 7a65 2069 7320 4e6f 6e65 3a0a 2020  size is None:.  
+000272b0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000272c0: 6930 203d 2073 656c 662e 636c 6f6e 6528  i0 = self.clone(
+000272d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000272e0: 2020 726f 6920 3d20 726f 692e 636c 6f6e    roi = roi.clon
+000272f0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00027300: 2320 4372 6f70 2074 6869 7320 524f 4920  # Crop this ROI 
+00027310: 746f 207a 2d65 7874 656e 7473 206f 6620  to z-extents of 
+00027320: 6f74 6865 7220 524f 492e 0a20 2020 2020  other ROI..     
+00027330: 2020 2020 2020 2069 6620 6d61 7463 685f         if match_
+00027340: 6c65 6e67 7468 735f 7374 7261 7465 6779  lengths_strategy
+00027350: 2069 6e20 5b30 2c20 325d 3a0a 2020 2020   in [0, 2]:.    
+00027360: 2020 2020 2020 2020 2020 2020 726f 6930              roi0
+00027370: 2e63 726f 705f 746f 5f72 6f69 5f6c 656e  .crop_to_roi_len
+00027380: 6774 6828 726f 6929 0a20 2020 2020 2020  gth(roi).       
+00027390: 2020 2020 2023 2043 726f 7020 6f74 6865       # Crop othe
+000273a0: 7220 524f 4920 746f 207a 2d65 7874 656e  r ROI to z-exten
+000273b0: 7473 206f 6620 7468 6973 2052 4f49 2e0a  ts of this ROI..
+000273c0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+000273d0: 6174 6368 5f6c 656e 6774 6873 5f73 7472  atch_lengths_str
+000273e0: 6174 6567 7920 696e 205b 312c 2032 5d3a  ategy in [1, 2]:
+000273f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027400: 2072 6f69 2e63 726f 705f 746f 5f72 6f69   roi.crop_to_roi
+00027410: 5f6c 656e 6774 6828 726f 6930 290a 0a20  _length(roi0).. 
+00027420: 2020 2020 2020 2023 2044 6566 6175 6c74         # Default
+00027430: 206d 6574 7269 6373 0a20 2020 2020 2020   metrics.       
+00027440: 2069 6620 6d65 7472 6963 7320 6973 204e   if metrics is N
+00027450: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00027460: 206d 6574 7269 6373 203d 205b 2264 6963   metrics = ["dic
+00027470: 6522 2c20 2263 656e 7472 6f69 6422 5d0a  e", "centroid"].
+00027480: 0a20 2020 2020 2020 2023 2044 6566 6175  .        # Defau
+00027490: 6c74 2073 6c69 6365 7320 746f 2063 6f6e  lt slices to con
+000274a0: 7369 6465 7220 666f 7220 736c 6963 652d  sider for slice-
+000274b0: 6279 2d73 6c69 6365 206d 6574 7269 6320  by-slice metric 
+000274c0: 6361 6c63 756c 6174 696f 6e73 2e0a 2020  calculations..  
+000274d0: 2020 2020 2020 6465 6661 756c 745f 6279        default_by
+000274e0: 5f73 6c69 6365 203d 2073 6b72 742e 636f  _slice = skrt.co
+000274f0: 7265 2e44 6566 6175 6c74 7328 292e 6279  re.Defaults().by
+00027500: 5f73 6c69 6365 0a0a 2020 2020 2020 2020  _slice..        
+00027510: 2320 496e 6974 6961 6c69 7365 2076 6172  # Initialise var
+00027520: 6961 626c 6573 2066 6f72 2064 6973 7461  iables for dista
+00027530: 6e63 6520 6d65 7472 6963 732e 0a20 2020  nce metrics..   
+00027540: 2020 2020 2063 6f6e 666f 726d 6974 7920       conformity 
+00027550: 3d20 4e6f 6e65 0a20 2020 2020 2020 2063  = None.        c
+00027560: 6f6e 666f 726d 6974 795f 666c 6174 203d  onformity_flat =
+00027570: 204e 6f6e 650a 2020 2020 2020 2020 6469   None.        di
+00027580: 7374 616e 6365 7320 3d20 4e6f 6e65 0a20  stances = None. 
+00027590: 2020 2020 2020 2064 6973 7461 6e63 6573         distances
+000275a0: 5f66 6c61 7420 3d20 4e6f 6e65 0a20 2020  _flat = None.   
 000275b0: 2020 2020 2073 6967 6e65 645f 6469 7374       signed_dist
-000275c0: 616e 6365 735f 666c 6174 203d 204e 6f6e  ances_flat = Non
-000275d0: 650a 0a20 2020 2020 2020 2023 2049 6620  e..        # If 
-000275e0: 6e6f 2069 6e64 6578 2067 6976 656e 2c20  no index given, 
-000275f0: 7573 6520 6365 6e74 7261 6c20 736c 6963  use central slic
-00027600: 650a 2020 2020 2020 2020 6966 2073 6c20  e.        if sl 
-00027610: 6973 204e 6f6e 6520 616e 6420 6964 7820  is None and idx 
-00027620: 6973 204e 6f6e 6520 616e 6420 706f 7320  is None and pos 
-00027630: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00027640: 2020 2020 2069 6478 203d 2072 6f69 302e       idx = roi0.
-00027650: 6765 745f 6d69 645f 6964 7828 7669 6577  get_mid_idx(view
-00027660: 290a 0a20 2020 2020 2020 2023 2043 6f6d  )..        # Com
-00027670: 7075 7465 206d 6574 7269 6373 0a20 2020  pute metrics.   
-00027680: 2020 2020 2063 6f6d 7020 3d20 7b7d 0a20       comp = {}. 
-00027690: 2020 2020 2020 2073 6c69 6365 5f6b 7761         slice_kwa
-000276a0: 7267 7320 3d20 7b0a 2020 2020 2020 2020  rgs = {.        
-000276b0: 2020 2020 2273 696e 676c 655f 736c 6963      "single_slic
-000276c0: 6522 3a20 5472 7565 2c0a 2020 2020 2020  e": True,.      
-000276d0: 2020 2020 2020 2276 6965 7722 3a20 7669        "view": vi
-000276e0: 6577 2c0a 2020 2020 2020 2020 2020 2020  ew,.            
-000276f0: 2273 6c22 3a20 736c 2c0a 2020 2020 2020  "sl": sl,.      
-00027700: 2020 2020 2020 2269 6478 223a 2069 6478        "idx": idx
-00027710: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
-00027720: 6f73 223a 2070 6f73 0a20 2020 2020 2020  os": pos.       
-00027730: 207d 0a0a 2020 2020 2020 2020 666f 7220   }..        for 
-00027740: 6d20 696e 206d 6574 7269 6373 3a0a 2020  m in metrics:.  
-00027750: 2020 2020 2020 2020 2020 6966 206d 206e            if m n
-00027760: 6f74 2069 6e20 6765 745f 636f 6d70 6172  ot in get_compar
-00027770: 6973 6f6e 5f6d 6574 7269 6373 2829 3a0a  ison_metrics():.
-00027780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027790: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-000277a0: 6f72 2866 224d 6574 7269 6320 7b6d 7d20  or(f"Metric {m} 
-000277b0: 6e6f 7420 7265 636f 676e 6973 6564 2062  not recognised b
-000277c0: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
-000277d0: 2020 2020 2020 2020 2020 2020 2252 4f49              "ROI
-000277e0: 2e67 6574 5f63 6f6d 7061 7269 736f 6e28  .get_comparison(
-000277f0: 2922 290a 0a20 2020 2020 2020 2066 6f72  )")..        for
-00027800: 206d 2069 6e20 6d65 7472 6963 733a 0a0a   m in metrics:..
-00027810: 2020 2020 2020 2020 2020 2020 2320 4469              # Di
-00027820: 6365 2073 636f 7265 0a20 2020 2020 2020  ce score.       
-00027830: 2020 2020 2069 6620 6d20 3d3d 2022 6469       if m == "di
-00027840: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
-00027850: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
-00027860: 6f69 302e 6765 745f 6469 6365 2872 6f69  oi0.get_dice(roi
-00027870: 2c20 6d65 7468 6f64 3d6d 6574 686f 6429  , method=method)
-00027880: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00027890: 6620 6d20 3d3d 2022 6469 6365 5f66 6c61  f m == "dice_fla
-000278a0: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-000278b0: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
-000278c0: 6930 2e67 6574 5f64 6963 6528 0a20 2020  i0.get_dice(.   
-000278d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278e0: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
-000278f0: 2020 2020 2020 2020 2020 2076 6965 773d             view=
-00027900: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
-00027910: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00027920: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
-00027930: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00027940: 7474 656e 3d54 7275 652c 200a 2020 2020  tten=True, .    
-00027950: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00027960: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00027970: 203d 3d20 2264 6963 655f 736c 6963 6522   == "dice_slice"
-00027980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027990: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
-000279a0: 2e67 6574 5f64 6963 6528 726f 692c 206d  .get_dice(roi, m
-000279b0: 6574 686f 643d 6d65 7468 6f64 2c20 2a2a  ethod=method, **
-000279c0: 736c 6963 655f 6b77 6172 6773 290a 0a20  slice_kwargs).. 
-000279d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000279e0: 6d20 3d3d 2022 6469 6365 5f73 6c69 6365  m == "dice_slice
-000279f0: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
-00027a00: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
-00027a10: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
-00027a20: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
-00027a30: 6574 7269 6373 3d22 6469 6365 222c 0a20  etrics="dice",. 
-00027a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a50: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
-00027a60: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
-00027a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a80: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00027a90: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
-00027aa0: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
-00027ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ac0: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00027ad0: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
-00027ae0: 2020 2020 2020 2020 2020 2023 204a 6163             # Jac
-00027af0: 6361 7264 2069 6e64 6578 0a20 2020 2020  card index.     
-00027b00: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00027b10: 2022 6a61 6363 6172 6422 3a0a 2020 2020   "jaccard":.    
-00027b20: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00027b30: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f6a  [m] = roi0.get_j
-00027b40: 6163 6361 7264 2872 6f69 2c20 6d65 7468  accard(roi, meth
-00027b50: 6f64 3d6d 6574 686f 6429 0a20 2020 2020  od=method).     
-00027b60: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00027b70: 2022 6a61 6363 6172 645f 666c 6174 223a   "jaccard_flat":
-00027b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027b90: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
-00027ba0: 6765 745f 6a61 6363 6172 6428 0a20 2020  get_jaccard(.   
-00027bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027bc0: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
-00027bd0: 2020 2020 2020 2020 2020 2076 6965 773d             view=
-00027be0: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
-00027bf0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00027c00: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
-00027c10: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00027c20: 7474 656e 3d54 7275 652c 200a 2020 2020  tten=True, .    
-00027c30: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00027c40: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00027c50: 203d 3d20 226a 6163 6361 7264 5f73 6c69   == "jaccard_sli
-00027c60: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
-00027c70: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
-00027c80: 6f69 302e 6765 745f 6a61 6363 6172 6428  oi0.get_jaccard(
-00027c90: 726f 692c 206d 6574 686f 643d 6d65 7468  roi, method=meth
-00027ca0: 6f64 2c20 2a2a 736c 6963 655f 6b77 6172  od, **slice_kwar
-00027cb0: 6773 290a 0a20 2020 2020 2020 2020 2020  gs)..           
-00027cc0: 2065 6c69 6620 6d20 3d3d 2022 6a61 6363   elif m == "jacc
-00027cd0: 6172 645f 736c 6963 655f 7374 6174 7322  ard_slice_stats"
-00027ce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027cf0: 2020 636f 6d70 2e75 7064 6174 6528 726f    comp.update(ro
-00027d00: 6930 2e67 6574 5f73 6c69 6365 5f73 7461  i0.get_slice_sta
-00027d10: 7473 2872 6f69 2c20 6d65 7472 6963 733d  ts(roi, metrics=
-00027d20: 226a 6163 6361 7264 222c 0a20 2020 2020  "jaccard",.     
-00027d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d40: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
-00027d50: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
-00027d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d70: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
-00027d80: 6c69 6365 3d64 6566 6175 6c74 5f62 795f  lice=default_by_
-00027d90: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
-00027da0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00027db0: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
-00027dc0: 6577 3d76 6965 7729 290a 0a20 2020 2020  ew=view))..     
-00027dd0: 2020 2020 2020 2023 2043 656e 7472 6f69         # Centroi
-00027de0: 6420 6469 7374 616e 6365 730a 2020 2020  d distances.    
-00027df0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00027e00: 3d20 2263 656e 7472 6f69 6422 3a0a 2020  = "centroid":.  
-00027e10: 2020 2020 2020 2020 2020 2020 2020 6365                ce
-00027e20: 6e74 726f 6964 203d 2072 6f69 302e 6765  ntroid = roi0.ge
-00027e30: 745f 6365 6e74 726f 6964 5f64 6973 7461  t_centroid_dista
-00027e40: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
-00027e50: 2020 2020 2020 2020 2072 6f69 2c20 0a20           roi, . 
-00027e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e70: 2020 2075 6e69 7473 3d63 656e 7472 6f69     units=centroi
-00027e80: 645f 756e 6974 732c 200a 2020 2020 2020  d_units, .      
-00027e90: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00027ea0: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
-00027eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ec0: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
-00027ed0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00027ee0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00027ef0: 6f72 2069 2c20 6178 2069 6e20 656e 756d  or i, ax in enum
-00027f00: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
-00027f10: 2e5f 6178 6573 293a 0a20 2020 2020 2020  ._axes):.       
-00027f20: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00027f30: 705b 6622 6365 6e74 726f 6964 5f7b 6178  p[f"centroid_{ax
-00027f40: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
-00027f50: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-00027f60: 6966 206d 203d 3d20 2261 6273 5f63 656e  if m == "abs_cen
-00027f70: 7472 6f69 6422 3a0a 2020 2020 2020 2020  troid":.        
-00027f80: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-00027f90: 3d20 726f 6930 2e67 6574 5f61 6273 5f63  = roi0.get_abs_c
-00027fa0: 656e 7472 6f69 645f 6469 7374 616e 6365  entroid_distance
-00027fb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00027fc0: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
-00027fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fe0: 756e 6974 733d 6365 6e74 726f 6964 5f75  units=centroid_u
-00027ff0: 6e69 7473 2c0a 2020 2020 2020 2020 2020  nits,.          
-00028000: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00028010: 3d6d 6574 686f 642c 200a 2020 2020 2020  =method, .      
-00028020: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00028030: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
-00028040: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00028050: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00028060: 3d20 2261 6273 5f63 656e 7472 6f69 645f  = "abs_centroid_
-00028070: 666c 6174 223a 0a20 2020 2020 2020 2020  flat":.         
-00028080: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-00028090: 2072 6f69 302e 6765 745f 6162 735f 6365   roi0.get_abs_ce
-000280a0: 6e74 726f 6964 5f64 6973 7461 6e63 6528  ntroid_distance(
-000280b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000280c0: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
-000280d0: 2020 2020 2020 2020 2020 2020 2020 7669                vi
-000280e0: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
-000280f0: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
-00028100: 7473 3d63 656e 7472 6f69 645f 756e 6974  ts=centroid_unit
-00028110: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00028120: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00028130: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-00028140: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
-00028150: 6e3d 5472 7565 2c0a 2020 2020 2020 2020  n=True,.        
-00028160: 2020 2020 2020 2020 2020 2020 666f 7263              forc
-00028170: 653d 666f 7263 650a 2020 2020 2020 2020  e=force.        
-00028180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00028190: 2020 2020 2020 656c 6966 206d 203d 3d20        elif m == 
-000281a0: 2263 656e 7472 6f69 645f 736c 6963 6522  "centroid_slice"
-000281b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000281c0: 2020 6365 6e74 726f 6964 203d 2072 6f69    centroid = roi
-000281d0: 302e 6765 745f 6365 6e74 726f 6964 5f64  0.get_centroid_d
-000281e0: 6973 7461 6e63 6528 0a20 2020 2020 2020  istance(.       
-000281f0: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00028200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028210: 2020 2020 2020 756e 6974 733d 6365 6e74        units=cent
-00028220: 726f 6964 5f75 6e69 7473 2c0a 2020 2020  roid_units,.    
-00028230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028240: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+000275c0: 616e 6365 7320 3d20 4e6f 6e65 0a20 2020  ances = None.   
+000275d0: 2020 2020 2073 6967 6e65 645f 6469 7374       signed_dist
+000275e0: 616e 6365 735f 666c 6174 203d 204e 6f6e  ances_flat = Non
+000275f0: 650a 0a20 2020 2020 2020 2023 2049 6620  e..        # If 
+00027600: 6e6f 2069 6e64 6578 2067 6976 656e 2c20  no index given, 
+00027610: 7573 6520 6365 6e74 7261 6c20 736c 6963  use central slic
+00027620: 650a 2020 2020 2020 2020 6966 2073 6c20  e.        if sl 
+00027630: 6973 204e 6f6e 6520 616e 6420 6964 7820  is None and idx 
+00027640: 6973 204e 6f6e 6520 616e 6420 706f 7320  is None and pos 
+00027650: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00027660: 2020 2020 2069 6478 203d 2072 6f69 302e       idx = roi0.
+00027670: 6765 745f 6d69 645f 6964 7828 7669 6577  get_mid_idx(view
+00027680: 290a 0a20 2020 2020 2020 2023 2043 6f6d  )..        # Com
+00027690: 7075 7465 206d 6574 7269 6373 0a20 2020  pute metrics.   
+000276a0: 2020 2020 2063 6f6d 7020 3d20 7b7d 0a20       comp = {}. 
+000276b0: 2020 2020 2020 2073 6c69 6365 5f6b 7761         slice_kwa
+000276c0: 7267 7320 3d20 7b0a 2020 2020 2020 2020  rgs = {.        
+000276d0: 2020 2020 2273 696e 676c 655f 736c 6963      "single_slic
+000276e0: 6522 3a20 5472 7565 2c0a 2020 2020 2020  e": True,.      
+000276f0: 2020 2020 2020 2276 6965 7722 3a20 7669        "view": vi
+00027700: 6577 2c0a 2020 2020 2020 2020 2020 2020  ew,.            
+00027710: 2273 6c22 3a20 736c 2c0a 2020 2020 2020  "sl": sl,.      
+00027720: 2020 2020 2020 2269 6478 223a 2069 6478        "idx": idx
+00027730: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
+00027740: 6f73 223a 2070 6f73 0a20 2020 2020 2020  os": pos.       
+00027750: 207d 0a0a 2020 2020 2020 2020 666f 7220   }..        for 
+00027760: 6d20 696e 206d 6574 7269 6373 3a0a 2020  m in metrics:.  
+00027770: 2020 2020 2020 2020 2020 6966 206d 206e            if m n
+00027780: 6f74 2069 6e20 6765 745f 636f 6d70 6172  ot in get_compar
+00027790: 6973 6f6e 5f6d 6574 7269 6373 2829 3a0a  ison_metrics():.
+000277a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000277b0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+000277c0: 6f72 2866 224d 6574 7269 6320 7b6d 7d20  or(f"Metric {m} 
+000277d0: 6e6f 7420 7265 636f 676e 6973 6564 2062  not recognised b
+000277e0: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
+000277f0: 2020 2020 2020 2020 2020 2020 2252 4f49              "ROI
+00027800: 2e67 6574 5f63 6f6d 7061 7269 736f 6e28  .get_comparison(
+00027810: 2922 290a 0a20 2020 2020 2020 2066 6f72  )")..        for
+00027820: 206d 2069 6e20 6d65 7472 6963 733a 0a0a   m in metrics:..
+00027830: 2020 2020 2020 2020 2020 2020 2320 4469              # Di
+00027840: 6365 2073 636f 7265 0a20 2020 2020 2020  ce score.       
+00027850: 2020 2020 2069 6620 6d20 3d3d 2022 6469       if m == "di
+00027860: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
+00027870: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
+00027880: 6f69 302e 6765 745f 6469 6365 2872 6f69  oi0.get_dice(roi
+00027890: 2c20 6d65 7468 6f64 3d6d 6574 686f 6429  , method=method)
+000278a0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000278b0: 6620 6d20 3d3d 2022 6469 6365 5f66 6c61  f m == "dice_fla
+000278c0: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+000278d0: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
+000278e0: 6930 2e67 6574 5f64 6963 6528 0a20 2020  i0.get_dice(.   
+000278f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027900: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
+00027910: 2020 2020 2020 2020 2020 2076 6965 773d             view=
+00027920: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
+00027930: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00027940: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
+00027950: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00027960: 7474 656e 3d54 7275 652c 200a 2020 2020  tten=True, .    
+00027970: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00027980: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00027990: 203d 3d20 2264 6963 655f 736c 6963 6522   == "dice_slice"
+000279a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000279b0: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
+000279c0: 2e67 6574 5f64 6963 6528 726f 692c 206d  .get_dice(roi, m
+000279d0: 6574 686f 643d 6d65 7468 6f64 2c20 2a2a  ethod=method, **
+000279e0: 736c 6963 655f 6b77 6172 6773 290a 0a20  slice_kwargs).. 
+000279f0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00027a00: 6d20 3d3d 2022 6469 6365 5f73 6c69 6365  m == "dice_slice
+00027a10: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
+00027a20: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
+00027a30: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
+00027a40: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
+00027a50: 6574 7269 6373 3d22 6469 6365 222c 0a20  etrics="dice",. 
+00027a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a70: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+00027a80: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
+00027a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027aa0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00027ab0: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
+00027ac0: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
+00027ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ae0: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00027af0: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
+00027b00: 2020 2020 2020 2020 2020 2023 204a 6163             # Jac
+00027b10: 6361 7264 2069 6e64 6578 0a20 2020 2020  card index.     
+00027b20: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00027b30: 2022 6a61 6363 6172 6422 3a0a 2020 2020   "jaccard":.    
+00027b40: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00027b50: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f6a  [m] = roi0.get_j
+00027b60: 6163 6361 7264 2872 6f69 2c20 6d65 7468  accard(roi, meth
+00027b70: 6f64 3d6d 6574 686f 6429 0a20 2020 2020  od=method).     
+00027b80: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00027b90: 2022 6a61 6363 6172 645f 666c 6174 223a   "jaccard_flat":
+00027ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027bb0: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
+00027bc0: 6765 745f 6a61 6363 6172 6428 0a20 2020  get_jaccard(.   
+00027bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027be0: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
+00027bf0: 2020 2020 2020 2020 2020 2076 6965 773d             view=
+00027c00: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
+00027c10: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00027c20: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
+00027c30: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00027c40: 7474 656e 3d54 7275 652c 200a 2020 2020  tten=True, .    
+00027c50: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00027c60: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00027c70: 203d 3d20 226a 6163 6361 7264 5f73 6c69   == "jaccard_sli
+00027c80: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
+00027c90: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
+00027ca0: 6f69 302e 6765 745f 6a61 6363 6172 6428  oi0.get_jaccard(
+00027cb0: 726f 692c 206d 6574 686f 643d 6d65 7468  roi, method=meth
+00027cc0: 6f64 2c20 2a2a 736c 6963 655f 6b77 6172  od, **slice_kwar
+00027cd0: 6773 290a 0a20 2020 2020 2020 2020 2020  gs)..           
+00027ce0: 2065 6c69 6620 6d20 3d3d 2022 6a61 6363   elif m == "jacc
+00027cf0: 6172 645f 736c 6963 655f 7374 6174 7322  ard_slice_stats"
+00027d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00027d10: 2020 636f 6d70 2e75 7064 6174 6528 726f    comp.update(ro
+00027d20: 6930 2e67 6574 5f73 6c69 6365 5f73 7461  i0.get_slice_sta
+00027d30: 7473 2872 6f69 2c20 6d65 7472 6963 733d  ts(roi, metrics=
+00027d40: 226a 6163 6361 7264 222c 0a20 2020 2020  "jaccard",.     
+00027d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d60: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
+00027d70: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
+00027d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d90: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
+00027da0: 6c69 6365 3d64 6566 6175 6c74 5f62 795f  lice=default_by_
+00027db0: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
+00027dc0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00027dd0: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
+00027de0: 6577 3d76 6965 7729 290a 0a20 2020 2020  ew=view))..     
+00027df0: 2020 2020 2020 2023 2043 656e 7472 6f69         # Centroi
+00027e00: 6420 6469 7374 616e 6365 730a 2020 2020  d distances.    
+00027e10: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00027e20: 3d20 2263 656e 7472 6f69 6422 3a0a 2020  = "centroid":.  
+00027e30: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00027e40: 6e74 726f 6964 203d 2072 6f69 302e 6765  ntroid = roi0.ge
+00027e50: 745f 6365 6e74 726f 6964 5f64 6973 7461  t_centroid_dista
+00027e60: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+00027e70: 2020 2020 2020 2020 2072 6f69 2c20 0a20           roi, . 
+00027e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e90: 2020 2075 6e69 7473 3d63 656e 7472 6f69     units=centroi
+00027ea0: 645f 756e 6974 732c 200a 2020 2020 2020  d_units, .      
+00027eb0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00027ec0: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+00027ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ee0: 2066 6f72 6365 3d66 6f72 6365 0a20 2020   force=force.   
+00027ef0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00027f00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00027f10: 6f72 2069 2c20 6178 2069 6e20 656e 756d  or i, ax in enum
+00027f20: 6572 6174 6528 736b 7274 2e69 6d61 6765  erate(skrt.image
+00027f30: 2e5f 6178 6573 293a 0a20 2020 2020 2020  ._axes):.       
+00027f40: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00027f50: 705b 6622 6365 6e74 726f 6964 5f7b 6178  p[f"centroid_{ax
+00027f60: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
+00027f70: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+00027f80: 6966 206d 203d 3d20 2261 6273 5f63 656e  if m == "abs_cen
+00027f90: 7472 6f69 6422 3a0a 2020 2020 2020 2020  troid":.        
+00027fa0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00027fb0: 3d20 726f 6930 2e67 6574 5f61 6273 5f63  = roi0.get_abs_c
+00027fc0: 656e 7472 6f69 645f 6469 7374 616e 6365  entroid_distance
+00027fd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00027fe0: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
+00027ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028000: 756e 6974 733d 6365 6e74 726f 6964 5f75  units=centroid_u
+00028010: 6e69 7473 2c0a 2020 2020 2020 2020 2020  nits,.          
+00028020: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00028030: 3d6d 6574 686f 642c 200a 2020 2020 2020  =method, .      
+00028040: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00028050: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
+00028060: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00028070: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00028080: 3d20 2261 6273 5f63 656e 7472 6f69 645f  = "abs_centroid_
+00028090: 666c 6174 223a 0a20 2020 2020 2020 2020  flat":.         
+000280a0: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+000280b0: 2072 6f69 302e 6765 745f 6162 735f 6365   roi0.get_abs_ce
+000280c0: 6e74 726f 6964 5f64 6973 7461 6e63 6528  ntroid_distance(
+000280d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000280e0: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
+000280f0: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+00028100: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
+00028110: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
+00028120: 7473 3d63 656e 7472 6f69 645f 756e 6974  ts=centroid_unit
+00028130: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00028140: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00028150: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
+00028160: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
+00028170: 6e3d 5472 7565 2c0a 2020 2020 2020 2020  n=True,.        
+00028180: 2020 2020 2020 2020 2020 2020 666f 7263              forc
+00028190: 653d 666f 7263 650a 2020 2020 2020 2020  e=force.        
+000281a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000281b0: 2020 2020 2020 656c 6966 206d 203d 3d20        elif m == 
+000281c0: 2263 656e 7472 6f69 645f 736c 6963 6522  "centroid_slice"
+000281d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000281e0: 2020 6365 6e74 726f 6964 203d 2072 6f69    centroid = roi
+000281f0: 302e 6765 745f 6365 6e74 726f 6964 5f64  0.get_centroid_d
+00028200: 6973 7461 6e63 6528 0a20 2020 2020 2020  istance(.       
+00028210: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00028220: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028230: 2020 2020 2020 756e 6974 733d 6365 6e74        units=cent
+00028240: 726f 6964 5f75 6e69 7473 2c0a 2020 2020  roid_units,.    
 00028250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028260: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
-00028270: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00028280: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00028290: 2020 2020 666f 7220 692c 2069 5f61 7820      for i, i_ax 
-000282a0: 696e 2065 6e75 6d65 7261 7465 2873 6b72  in enumerate(skr
-000282b0: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
-000282c0: 6573 5b76 6965 775d 293a 0a20 2020 2020  es[view]):.     
-000282d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000282e0: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
-000282f0: 6178 6573 5b69 5f61 785d 0a20 2020 2020  axes[i_ax].     
-00028300: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00028310: 6f6d 705b 6622 6365 6e74 726f 6964 5f73  omp[f"centroid_s
-00028320: 6c69 6365 5f7b 6178 7d22 5d20 3d20 6365  lice_{ax}"] = ce
-00028330: 6e74 726f 6964 5b69 5d0a 0a20 2020 2020  ntroid[i]..     
-00028340: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00028350: 2022 6365 6e74 726f 6964 5f73 6c69 6365   "centroid_slice
-00028360: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
-00028370: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
-00028380: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
-00028390: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
-000283a0: 6574 7269 6373 3d22 6365 6e74 726f 6964  etrics="centroid
-000283b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000283c0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-000283d0: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
-000283e0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-000283f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00028400: 756c 745f 6279 5f73 6c69 6365 3d64 6566  ult_by_slice=def
-00028410: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
-00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028430: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00028440: 7468 6f64 2c20 7669 6577 3d76 6965 772c  thod, view=view,
-00028450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028460: 2020 2020 2020 2020 2073 6570 6172 6174           separat
-00028470: 655f 636f 6d70 6f6e 656e 7473 3d54 7275  e_components=Tru
-00028480: 6529 290a 0a20 2020 2020 2020 2020 2020  e))..           
-00028490: 2065 6c69 6620 6d20 3d3d 2022 6162 735f   elif m == "abs_
-000284a0: 6365 6e74 726f 6964 5f73 6c69 6365 223a  centroid_slice":
-000284b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000284c0: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
-000284d0: 6765 745f 6162 735f 6365 6e74 726f 6964  get_abs_centroid
-000284e0: 5f64 6973 7461 6e63 6528 0a20 2020 2020  _distance(.     
-000284f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00028500: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-00028510: 2020 2020 2020 2020 756e 6974 733d 6365          units=ce
-00028520: 6e74 726f 6964 5f75 6e69 7473 2c0a 2020  ntroid_units,.  
-00028530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028540: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-00028550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028560: 2020 2020 202a 2a73 6c69 6365 5f6b 7761       **slice_kwa
-00028570: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-00028580: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00028590: 2020 2065 6c69 6620 6d20 3d3d 2022 6162     elif m == "ab
-000285a0: 735f 6365 6e74 726f 6964 5f73 6c69 6365  s_centroid_slice
-000285b0: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
-000285c0: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
-000285d0: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
-000285e0: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
-000285f0: 6574 7269 6373 3d22 6162 735f 6365 6e74  etrics="abs_cent
-00028600: 726f 6964 222c 0a20 2020 2020 2020 2020  roid",.         
-00028610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00028620: 6c69 6365 5f73 7461 7473 3d73 6c69 6365  lice_stats=slice
-00028630: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
-00028640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028650: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
-00028660: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
-00028670: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00028680: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00028690: 643d 6d65 7468 6f64 2c20 7669 6577 3d76  d=method, view=v
-000286a0: 6965 7729 290a 0a20 2020 2020 2020 2020  iew))..         
-000286b0: 2020 2023 2056 6f6c 756d 6520 6d65 7472     # Volume metr
-000286c0: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
-000286d0: 656c 6966 206d 203d 3d20 2276 6f6c 756d  elif m == "volum
-000286e0: 655f 6469 6666 223a 0a20 2020 2020 2020  e_diff":.       
-000286f0: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
-00028700: 203d 2072 6f69 302e 6765 745f 766f 6c75   = roi0.get_volu
-00028710: 6d65 5f64 6966 6628 0a20 2020 2020 2020  me_diff(.       
-00028720: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00028730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028740: 2020 2020 2020 756e 6974 733d 766f 6c5f        units=vol_
-00028750: 756e 6974 732c 0a20 2020 2020 2020 2020  units,.         
-00028760: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00028770: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
-00028780: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00028790: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
-000287a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000287b0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-000287c0: 3d20 2272 656c 5f76 6f6c 756d 655f 6469  = "rel_volume_di
-000287d0: 6666 223a 0a20 2020 2020 2020 2020 2020  ff":.           
-000287e0: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
-000287f0: 6f69 302e 6765 745f 7265 6c61 7469 7665  oi0.get_relative
-00028800: 5f76 6f6c 756d 655f 6469 6666 280a 2020  _volume_diff(.  
-00028810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028820: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
-00028830: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00028840: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
-00028850: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00028860: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
-00028870: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00028880: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00028890: 3d20 2276 6f6c 756d 655f 7261 7469 6f22  = "volume_ratio"
-000288a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000288b0: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
-000288c0: 2e67 6574 5f76 6f6c 756d 655f 7261 7469  .get_volume_rati
-000288d0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-000288e0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
-000288f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028900: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028260: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028280: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
+00028290: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+000282a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+000282b0: 2020 2020 666f 7220 692c 2069 5f61 7820      for i, i_ax 
+000282c0: 696e 2065 6e75 6d65 7261 7465 2873 6b72  in enumerate(skr
+000282d0: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
+000282e0: 6573 5b76 6965 775d 293a 0a20 2020 2020  es[view]):.     
+000282f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00028300: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
+00028310: 6178 6573 5b69 5f61 785d 0a20 2020 2020  axes[i_ax].     
+00028320: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00028330: 6f6d 705b 6622 6365 6e74 726f 6964 5f73  omp[f"centroid_s
+00028340: 6c69 6365 5f7b 6178 7d22 5d20 3d20 6365  lice_{ax}"] = ce
+00028350: 6e74 726f 6964 5b69 5d0a 0a20 2020 2020  ntroid[i]..     
+00028360: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00028370: 2022 6365 6e74 726f 6964 5f73 6c69 6365   "centroid_slice
+00028380: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
+00028390: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
+000283a0: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
+000283b0: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
+000283c0: 6574 7269 6373 3d22 6365 6e74 726f 6964  etrics="centroid
+000283d0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+000283e0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+000283f0: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
+00028400: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00028410: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00028420: 756c 745f 6279 5f73 6c69 6365 3d64 6566  ult_by_slice=def
+00028430: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
+00028440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028450: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00028460: 7468 6f64 2c20 7669 6577 3d76 6965 772c  thod, view=view,
+00028470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028480: 2020 2020 2020 2020 2073 6570 6172 6174           separat
+00028490: 655f 636f 6d70 6f6e 656e 7473 3d54 7275  e_components=Tru
+000284a0: 6529 290a 0a20 2020 2020 2020 2020 2020  e))..           
+000284b0: 2065 6c69 6620 6d20 3d3d 2022 6162 735f   elif m == "abs_
+000284c0: 6365 6e74 726f 6964 5f73 6c69 6365 223a  centroid_slice":
+000284d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000284e0: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
+000284f0: 6765 745f 6162 735f 6365 6e74 726f 6964  get_abs_centroid
+00028500: 5f64 6973 7461 6e63 6528 0a20 2020 2020  _distance(.     
+00028510: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00028520: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
+00028530: 2020 2020 2020 2020 756e 6974 733d 6365          units=ce
+00028540: 6e74 726f 6964 5f75 6e69 7473 2c0a 2020  ntroid_units,.  
+00028550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028560: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+00028570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028580: 2020 2020 202a 2a73 6c69 6365 5f6b 7761       **slice_kwa
+00028590: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+000285a0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+000285b0: 2020 2065 6c69 6620 6d20 3d3d 2022 6162     elif m == "ab
+000285c0: 735f 6365 6e74 726f 6964 5f73 6c69 6365  s_centroid_slice
+000285d0: 5f73 7461 7473 223a 0a20 2020 2020 2020  _stats":.       
+000285e0: 2020 2020 2020 2020 2063 6f6d 702e 7570           comp.up
+000285f0: 6461 7465 2872 6f69 302e 6765 745f 736c  date(roi0.get_sl
+00028600: 6963 655f 7374 6174 7328 726f 692c 206d  ice_stats(roi, m
+00028610: 6574 7269 6373 3d22 6162 735f 6365 6e74  etrics="abs_cent
+00028620: 726f 6964 222c 0a20 2020 2020 2020 2020  roid",.         
+00028630: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00028640: 6c69 6365 5f73 7461 7473 3d73 6c69 6365  lice_stats=slice
+00028650: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
+00028660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028670: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00028680: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
+00028690: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000286a0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+000286b0: 643d 6d65 7468 6f64 2c20 7669 6577 3d76  d=method, view=v
+000286c0: 6965 7729 290a 0a20 2020 2020 2020 2020  iew))..         
+000286d0: 2020 2023 2056 6f6c 756d 6520 6d65 7472     # Volume metr
+000286e0: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+000286f0: 656c 6966 206d 203d 3d20 2276 6f6c 756d  elif m == "volum
+00028700: 655f 6469 6666 223a 0a20 2020 2020 2020  e_diff":.       
+00028710: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
+00028720: 203d 2072 6f69 302e 6765 745f 766f 6c75   = roi0.get_volu
+00028730: 6d65 5f64 6966 6628 0a20 2020 2020 2020  me_diff(.       
+00028740: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00028750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028760: 2020 2020 2020 756e 6974 733d 766f 6c5f        units=vol_
+00028770: 756e 6974 732c 0a20 2020 2020 2020 2020  units,.         
+00028780: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00028790: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
+000287a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000287b0: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
+000287c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000287d0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+000287e0: 3d20 2272 656c 5f76 6f6c 756d 655f 6469  = "rel_volume_di
+000287f0: 6666 223a 0a20 2020 2020 2020 2020 2020  ff":.           
+00028800: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
+00028810: 6f69 302e 6765 745f 7265 6c61 7469 7665  oi0.get_relative
+00028820: 5f76 6f6c 756d 655f 6469 6666 280a 2020  _volume_diff(.  
+00028830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028840: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
+00028850: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00028860: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
+00028870: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00028880: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
+00028890: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000288a0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+000288b0: 3d20 2276 6f6c 756d 655f 7261 7469 6f22  = "volume_ratio"
+000288c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000288d0: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
+000288e0: 2e67 6574 5f76 6f6c 756d 655f 7261 7469  .get_volume_rati
+000288f0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+00028900: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
 00028910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028920: 2020 2066 6f72 6365 3d66 6f72 6365 0a20     force=force. 
-00028930: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00028940: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00028950: 4172 6561 206d 6574 7269 6373 0a20 2020  Area metrics.   
-00028960: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-00028970: 3d3d 2022 6172 6561 5f64 6966 6622 3a0a  == "area_diff":.
-00028980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028990: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
-000289a0: 6574 5f61 7265 615f 6469 6666 280a 2020  et_area_diff(.  
-000289b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289c0: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
-000289d0: 2020 2020 2020 2020 2020 2075 6e69 7473             units
-000289e0: 3d61 7265 615f 756e 6974 732c 0a20 2020  =area_units,.   
-000289f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a00: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
+00028920: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028940: 2020 2066 6f72 6365 3d66 6f72 6365 0a20     force=force. 
+00028950: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00028960: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00028970: 4172 6561 206d 6574 7269 6373 0a20 2020  Area metrics.   
+00028980: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00028990: 3d3d 2022 6172 6561 5f64 6966 6622 3a0a  == "area_diff":.
+000289a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000289b0: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
+000289c0: 6574 5f61 7265 615f 6469 6666 280a 2020  et_area_diff(.  
+000289d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000289e0: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
+000289f0: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+00028a00: 3d61 7265 615f 756e 6974 732c 0a20 2020  =area_units,.   
 00028a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a20: 2020 2020 2a2a 736c 6963 655f 6b77 6172      **slice_kwar
-00028a30: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-00028a40: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00028a50: 2065 6c69 6620 6d20 3d3d 2022 7265 6c5f   elif m == "rel_
-00028a60: 6172 6561 5f64 6966 6622 3a0a 2020 2020  area_diff":.    
-00028a70: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00028a80: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f72  [m] = roi0.get_r
-00028a90: 656c 6174 6976 655f 6172 6561 5f64 6966  elative_area_dif
-00028aa0: 6628 0a20 2020 2020 2020 2020 2020 2020  f(.             
-00028ab0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
-00028ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ad0: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028a20: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
+00028a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a40: 2020 2020 2a2a 736c 6963 655f 6b77 6172      **slice_kwar
+00028a50: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
+00028a60: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00028a70: 2065 6c69 6620 6d20 3d3d 2022 7265 6c5f   elif m == "rel_
+00028a80: 6172 6561 5f64 6966 6622 3a0a 2020 2020  area_diff":.    
+00028a90: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00028aa0: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f72  [m] = roi0.get_r
+00028ab0: 656c 6174 6976 655f 6172 6561 5f64 6966  elative_area_dif
+00028ac0: 6628 0a20 2020 2020 2020 2020 2020 2020  f(.             
+00028ad0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
 00028ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028af0: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
-00028b00: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00028b10: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00028b20: 656c 6966 206d 203d 3d20 2261 7265 615f  elif m == "area_
-00028b30: 7261 7469 6f22 3a0a 2020 2020 2020 2020  ratio":.        
-00028b40: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-00028b50: 3d20 726f 6930 2e67 6574 5f61 7265 615f  = roi0.get_area_
-00028b60: 7261 7469 6f28 0a20 2020 2020 2020 2020  ratio(.         
-00028b70: 2020 2020 2020 2020 2020 2072 6f69 2c0a             roi,.
-00028b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b90: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-00028ba0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-00028bb0: 2020 2020 2020 202a 2a73 6c69 6365 5f6b         **slice_k
-00028bc0: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
-00028bd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00028be0: 2020 2020 656c 6966 206d 203d 3d20 2261      elif m == "a
-00028bf0: 7265 615f 6469 6666 5f66 6c61 7422 3a0a  rea_diff_flat":.
-00028c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c10: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
-00028c20: 6574 5f61 7265 615f 6469 6666 280a 2020  et_area_diff(.  
-00028c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c40: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
-00028c50: 2020 2020 2020 2020 2020 2075 6e69 7473             units
-00028c60: 3d61 7265 615f 756e 6974 732c 0a20 2020  =area_units,.   
-00028c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c80: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
+00028af0: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+00028b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b10: 2020 202a 2a73 6c69 6365 5f6b 7761 7267     **slice_kwarg
+00028b20: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00028b30: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00028b40: 656c 6966 206d 203d 3d20 2261 7265 615f  elif m == "area_
+00028b50: 7261 7469 6f22 3a0a 2020 2020 2020 2020  ratio":.        
+00028b60: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00028b70: 3d20 726f 6930 2e67 6574 5f61 7265 615f  = roi0.get_area_
+00028b80: 7261 7469 6f28 0a20 2020 2020 2020 2020  ratio(.         
+00028b90: 2020 2020 2020 2020 2020 2072 6f69 2c0a             roi,.
+00028ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028bb0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
+00028bc0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00028bd0: 2020 2020 2020 202a 2a73 6c69 6365 5f6b         **slice_k
+00028be0: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
+00028bf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00028c00: 2020 2020 656c 6966 206d 203d 3d20 2261      elif m == "a
+00028c10: 7265 615f 6469 6666 5f66 6c61 7422 3a0a  rea_diff_flat":.
+00028c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c30: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
+00028c40: 6574 5f61 7265 615f 6469 6666 280a 2020  et_area_diff(.  
+00028c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c60: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
+00028c70: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+00028c80: 3d61 7265 615f 756e 6974 732c 0a20 2020  =area_units,.   
 00028c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ca0: 2020 2020 7669 6577 3d76 6965 772c 0a20      view=view,. 
+00028ca0: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
 00028cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028cc0: 2020 2066 6c61 7474 656e 3d54 7275 652c     flatten=True,
-00028cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028ce0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00028cf0: 656c 6966 206d 203d 3d20 2261 7265 615f  elif m == "area_
-00028d00: 6469 6666 5f73 6c69 6365 5f73 7461 7473  diff_slice_stats
-00028d10: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00028d20: 2020 2063 6f6d 702e 7570 6461 7465 2872     comp.update(r
-00028d30: 6f69 302e 6765 745f 736c 6963 655f 7374  oi0.get_slice_st
-00028d40: 6174 7328 726f 692c 206d 6574 7269 6373  ats(roi, metrics
-00028d50: 3d22 6172 6561 5f64 6966 6622 2c0a 2020  ="area_diff",.  
-00028d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d70: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
-00028d80: 733d 736c 6963 655f 7374 6174 732c 0a20  s=slice_stats,. 
-00028d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028da0: 2020 2020 2020 2064 6566 6175 6c74 5f62         default_b
-00028db0: 795f 736c 6963 653d 6465 6661 756c 745f  y_slice=default_
-00028dc0: 6279 5f73 6c69 6365 2c0a 2020 2020 2020  by_slice,.      
-00028dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028de0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-00028df0: 2076 6965 773d 7669 6577 2929 0a0a 2020   view=view))..  
-00028e00: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00028e10: 203d 3d20 2272 656c 5f61 7265 615f 6469   == "rel_area_di
-00028e20: 6666 5f66 6c61 7422 3a0a 2020 2020 2020  ff_flat":.      
-00028e30: 2020 2020 2020 2020 2020 636f 6d70 5b6d            comp[m
-00028e40: 5d20 3d20 726f 6930 2e67 6574 5f72 656c  ] = roi0.get_rel
-00028e50: 6174 6976 655f 6172 6561 5f64 6966 6628  ative_area_diff(
-00028e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028e70: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
-00028e80: 2020 2020 2020 2020 2020 2020 2020 7669                vi
-00028e90: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
-00028ea0: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00028eb0: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
-00028ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ed0: 666c 6174 7465 6e3d 5472 7565 2c0a 2020  flatten=True,.  
-00028ee0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00028ef0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00028f00: 6620 6d20 3d3d 2022 7265 6c5f 6172 6561  f m == "rel_area
-00028f10: 5f64 6966 665f 736c 6963 655f 7374 6174  _diff_slice_stat
-00028f20: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-00028f30: 2020 2020 636f 6d70 2e75 7064 6174 6528      comp.update(
-00028f40: 726f 6930 2e67 6574 5f73 6c69 6365 5f73  roi0.get_slice_s
-00028f50: 7461 7473 2872 6f69 2c0a 2020 2020 2020  tats(roi,.      
-00028f60: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00028f70: 7472 6963 733d 2272 656c 5f61 7265 615f  trics="rel_area_
-00028f80: 6469 6666 222c 0a20 2020 2020 2020 2020  diff",.         
-00028f90: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-00028fa0: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
-00028fb0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-00028fc0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00028fd0: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
-00028fe0: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
-00028ff0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00029000: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
-00029010: 6577 3d76 6965 7729 290a 0a20 2020 2020  ew=view))..     
-00029020: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00029030: 2022 6172 6561 5f72 6174 696f 5f66 6c61   "area_ratio_fla
-00029040: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-00029050: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
-00029060: 6930 2e67 6574 5f61 7265 615f 7261 7469  i0.get_area_rati
-00029070: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-00029080: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
-00029090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290a0: 7669 6577 3d76 6965 772c 0a20 2020 2020  view=view,.     
-000290b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000290c0: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
-000290d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290e0: 2020 666c 6174 7465 6e3d 5472 7565 2c0a    flatten=True,.
+00028cc0: 2020 2020 7669 6577 3d76 6965 772c 0a20      view=view,. 
+00028cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ce0: 2020 2066 6c61 7474 656e 3d54 7275 652c     flatten=True,
+00028cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028d00: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00028d10: 656c 6966 206d 203d 3d20 2261 7265 615f  elif m == "area_
+00028d20: 6469 6666 5f73 6c69 6365 5f73 7461 7473  diff_slice_stats
+00028d30: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00028d40: 2020 2063 6f6d 702e 7570 6461 7465 2872     comp.update(r
+00028d50: 6f69 302e 6765 745f 736c 6963 655f 7374  oi0.get_slice_st
+00028d60: 6174 7328 726f 692c 206d 6574 7269 6373  ats(roi, metrics
+00028d70: 3d22 6172 6561 5f64 6966 6622 2c0a 2020  ="area_diff",.  
+00028d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028d90: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
+00028da0: 733d 736c 6963 655f 7374 6174 732c 0a20  s=slice_stats,. 
+00028db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028dc0: 2020 2020 2020 2064 6566 6175 6c74 5f62         default_b
+00028dd0: 795f 736c 6963 653d 6465 6661 756c 745f  y_slice=default_
+00028de0: 6279 5f73 6c69 6365 2c0a 2020 2020 2020  by_slice,.      
+00028df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028e00: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+00028e10: 2076 6965 773d 7669 6577 2929 0a0a 2020   view=view))..  
+00028e20: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00028e30: 203d 3d20 2272 656c 5f61 7265 615f 6469   == "rel_area_di
+00028e40: 6666 5f66 6c61 7422 3a0a 2020 2020 2020  ff_flat":.      
+00028e50: 2020 2020 2020 2020 2020 636f 6d70 5b6d            comp[m
+00028e60: 5d20 3d20 726f 6930 2e67 6574 5f72 656c  ] = roi0.get_rel
+00028e70: 6174 6976 655f 6172 6561 5f64 6966 6628  ative_area_diff(
+00028e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028e90: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
+00028ea0: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+00028eb0: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
+00028ec0: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00028ed0: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
+00028ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ef0: 666c 6174 7465 6e3d 5472 7565 2c0a 2020  flatten=True,.  
+00028f00: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00028f10: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00028f20: 6620 6d20 3d3d 2022 7265 6c5f 6172 6561  f m == "rel_area
+00028f30: 5f64 6966 665f 736c 6963 655f 7374 6174  _diff_slice_stat
+00028f40: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+00028f50: 2020 2020 636f 6d70 2e75 7064 6174 6528      comp.update(
+00028f60: 726f 6930 2e67 6574 5f73 6c69 6365 5f73  roi0.get_slice_s
+00028f70: 7461 7473 2872 6f69 2c0a 2020 2020 2020  tats(roi,.      
+00028f80: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00028f90: 7472 6963 733d 2272 656c 5f61 7265 615f  trics="rel_area_
+00028fa0: 6469 6666 222c 0a20 2020 2020 2020 2020  diff",.         
+00028fb0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+00028fc0: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
+00028fd0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00028fe0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00028ff0: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
+00029000: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
+00029010: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00029020: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
+00029030: 6577 3d76 6965 7729 290a 0a20 2020 2020  ew=view))..     
+00029040: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00029050: 2022 6172 6561 5f72 6174 696f 5f66 6c61   "area_ratio_fla
+00029060: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+00029070: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
+00029080: 6930 2e67 6574 5f61 7265 615f 7261 7469  i0.get_area_rati
+00029090: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+000290a0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
+000290b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290c0: 7669 6577 3d76 6965 772c 0a20 2020 2020  view=view,.     
+000290d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000290e0: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
 000290f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029100: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00029110: 6c69 6620 6d20 3d3d 2022 6172 6561 5f72  lif m == "area_r
-00029120: 6174 696f 5f73 6c69 6365 5f73 7461 7473  atio_slice_stats
-00029130: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00029140: 2020 2063 6f6d 702e 7570 6461 7465 2872     comp.update(r
-00029150: 6f69 302e 6765 745f 736c 6963 655f 7374  oi0.get_slice_st
-00029160: 6174 7328 726f 692c 206d 6574 7269 6373  ats(roi, metrics
-00029170: 3d22 6172 6561 5f72 6174 696f 222c 0a20  ="area_ratio",. 
-00029180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029190: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
-000291a0: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
-000291b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291c0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-000291d0: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
-000291e0: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
-000291f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029200: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00029210: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
-00029220: 2020 2020 2020 2020 2020 2023 2053 7572             # Sur
-00029230: 6661 6365 2064 6973 7461 6e63 6520 6d65  face distance me
-00029240: 7472 6963 730a 2020 2020 2020 2020 2020  trics.          
-00029250: 2020 656c 6966 206d 2069 6e20 5b22 6d65    elif m in ["me
-00029260: 616e 5f73 7572 6661 6365 5f64 6973 7461  an_surface_dista
-00029270: 6e63 6522 2c0a 2020 2020 2020 2020 2020  nce",.          
-00029280: 2020 2020 2020 2020 2020 2272 6d73 5f73            "rms_s
-00029290: 7572 6661 6365 5f64 6973 7461 6e63 6522  urface_distance"
-000292a0: 2c20 2268 6175 7364 6f72 6666 5f64 6973  , "hausdorff_dis
-000292b0: 7461 6e63 6522 5d3a 0a20 2020 2020 2020  tance"]:.       
-000292c0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
-000292d0: 6573 203d 2028 6469 7374 616e 6365 730a  es = (distances.
-000292e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000292f0: 2020 2020 2020 2020 6f72 2072 6f69 302e          or roi0.
-00029300: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
-00029310: 616e 6365 5f6d 6574 7269 6373 2872 6f69  ance_metrics(roi
-00029320: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00029330: 2020 2069 6620 6d20 3d3d 2022 6d65 616e     if m == "mean
-00029340: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00029350: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-00029360: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-00029370: 3d20 6469 7374 616e 6365 735b 305d 0a20  = distances[0]. 
-00029380: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00029390: 6c69 6620 6d20 3d3d 2022 726d 735f 7375  lif m == "rms_su
-000293a0: 7266 6163 655f 6469 7374 616e 6365 223a  rface_distance":
-000293b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000293c0: 2020 2020 2063 6f6d 705b 6d5d 203d 2064       comp[m] = d
-000293d0: 6973 7461 6e63 6573 5b31 5d0a 2020 2020  istances[1].    
-000293e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000293f0: 206d 203d 3d20 2268 6175 7364 6f72 6666   m == "hausdorff
-00029400: 5f64 6973 7461 6e63 6522 3a0a 2020 2020  _distance":.    
-00029410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029420: 636f 6d70 5b6d 5d20 3d20 6469 7374 616e  comp[m] = distan
-00029430: 6365 735b 325d 0a20 2020 2020 2020 2020  ces[2].         
-00029440: 2020 2065 6c69 6620 6d20 696e 205b 226d     elif m in ["m
-00029450: 6561 6e5f 7375 7266 6163 655f 6469 7374  ean_surface_dist
-00029460: 616e 6365 5f66 6c61 7422 2c0a 2020 2020  ance_flat",.    
-00029470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029480: 2272 6d73 5f73 7572 6661 6365 5f64 6973  "rms_surface_dis
-00029490: 7461 6e63 655f 666c 6174 222c 2022 6861  tance_flat", "ha
-000294a0: 7573 646f 7266 665f 6469 7374 616e 6365  usdorff_distance
-000294b0: 5f66 6c61 7422 5d3a 0a20 2020 2020 2020  _flat"]:.       
-000294c0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
-000294d0: 6573 5f66 6c61 7420 3d20 2864 6973 7461  es_flat = (dista
-000294e0: 6e63 6573 5f66 6c61 740a 2020 2020 2020  nces_flat.      
-000294f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029500: 2020 6f72 2072 6f69 302e 6765 745f 7375    or roi0.get_su
-00029510: 7266 6163 655f 6469 7374 616e 6365 5f6d  rface_distance_m
-00029520: 6574 7269 6373 2872 6f69 2c0a 2020 2020  etrics(roi,.    
-00029530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029540: 2020 2020 7669 6577 3d76 6965 772c 2066      view=view, f
-00029550: 6c61 7474 656e 3d54 7275 6529 290a 2020  latten=True)).  
-00029560: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00029570: 206d 203d 3d20 226d 6561 6e5f 7375 7266   m == "mean_surf
-00029580: 6163 655f 6469 7374 616e 6365 5f66 6c61  ace_distance_fla
-00029590: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-000295a0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
-000295b0: 3d20 6469 7374 616e 6365 735f 666c 6174  = distances_flat
-000295c0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-000295d0: 2020 2020 656c 6966 206d 203d 3d20 2272      elif m == "r
-000295e0: 6d73 5f73 7572 6661 6365 5f64 6973 7461  ms_surface_dista
-000295f0: 6e63 655f 666c 6174 223a 0a20 2020 2020  nce_flat":.     
-00029600: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00029610: 6f6d 705b 6d5d 203d 2064 6973 7461 6e63  omp[m] = distanc
-00029620: 6573 5f66 6c61 745b 315d 0a20 2020 2020  es_flat[1].     
-00029630: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00029640: 6d20 3d3d 2022 6861 7573 646f 7266 665f  m == "hausdorff_
-00029650: 6469 7374 616e 6365 5f66 6c61 7422 3a0a  distance_flat":.
-00029660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029670: 2020 2020 636f 6d70 5b6d 5d20 3d20 6469      comp[m] = di
-00029680: 7374 616e 6365 735f 666c 6174 5b32 5d0a  stances_flat[2].
-00029690: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000296a0: 206d 2069 6e20 5b22 6d65 616e 5f73 6967   m in ["mean_sig
-000296b0: 6e65 645f 7375 7266 6163 655f 6469 7374  ned_surface_dist
-000296c0: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
-000296d0: 2020 2020 2020 2020 2020 2022 726d 735f             "rms_
-000296e0: 7369 676e 6564 5f73 7572 6661 6365 5f64  signed_surface_d
-000296f0: 6973 7461 6e63 6522 5d3a 0a20 2020 2020  istance"]:.     
-00029700: 2020 2020 2020 2020 2020 2073 6967 6e65             signe
-00029710: 645f 6469 7374 616e 6365 7320 3d20 2873  d_distances = (s
-00029720: 6967 6e65 645f 6469 7374 616e 6365 730a  igned_distances.
-00029730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029740: 2020 2020 2020 2020 6f72 2072 6f69 302e          or roi0.
-00029750: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
-00029760: 616e 6365 5f6d 6574 7269 6373 2872 6f69  ance_metrics(roi
-00029770: 2c20 7369 676e 6564 3d54 7275 6529 290a  , signed=True)).
-00029780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029790: 6966 206d 203d 3d20 226d 6561 6e5f 7369  if m == "mean_si
-000297a0: 676e 6564 5f73 7572 6661 6365 5f64 6973  gned_surface_dis
-000297b0: 7461 6e63 6522 3a0a 2020 2020 2020 2020  tance":.        
-000297c0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-000297d0: 5b6d 5d20 3d20 7369 676e 6564 5f64 6973  [m] = signed_dis
-000297e0: 7461 6e63 6573 5b30 5d0a 2020 2020 2020  tances[0].      
-000297f0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00029800: 203d 3d20 2272 6d73 5f73 6967 6e65 645f   == "rms_signed_
-00029810: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00029820: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00029830: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-00029840: 2073 6967 6e65 645f 6469 7374 616e 6365   signed_distance
-00029850: 735b 315d 0a20 2020 2020 2020 2020 2020  s[1].           
-00029860: 2065 6c69 6620 6d20 696e 205b 226d 6561   elif m in ["mea
-00029870: 6e5f 7369 676e 6564 5f73 7572 6661 6365  n_signed_surface
-00029880: 5f64 6973 7461 6e63 655f 666c 6174 222c  _distance_flat",
-00029890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000298a0: 2020 2020 2022 726d 735f 7369 676e 6564       "rms_signed
-000298b0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-000298c0: 655f 666c 6174 225d 3a0a 2020 2020 2020  e_flat"]:.      
-000298d0: 2020 2020 2020 2020 2020 7369 676e 6564            signed
-000298e0: 5f64 6973 7461 6e63 6573 5f66 6c61 7420  _distances_flat 
-000298f0: 3d20 2873 6967 6e65 645f 6469 7374 616e  = (signed_distan
-00029900: 6365 735f 666c 6174 0a20 2020 2020 2020  ces_flat.       
-00029910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029920: 206f 7220 726f 6930 2e67 6574 5f73 7572   or roi0.get_sur
-00029930: 6661 6365 5f64 6973 7461 6e63 655f 6d65  face_distance_me
-00029940: 7472 6963 7328 726f 692c 2073 6967 6e65  trics(roi, signe
-00029950: 643d 5472 7565 2c0a 2020 2020 2020 2020  d=True,.        
-00029960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029970: 2020 2020 7669 6577 3d76 6965 772c 2066      view=view, f
-00029980: 6c61 7474 656e 3d54 7275 6529 290a 2020  latten=True)).  
-00029990: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000299a0: 206d 203d 3d20 226d 6561 6e5f 7369 676e   m == "mean_sign
-000299b0: 6564 5f73 7572 6661 6365 5f64 6973 7461  ed_surface_dista
-000299c0: 6e63 655f 666c 6174 223a 0a20 2020 2020  nce_flat":.     
-000299d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000299e0: 6f6d 705b 6d5d 203d 2073 6967 6e65 645f  omp[m] = signed_
-000299f0: 6469 7374 616e 6365 735f 666c 6174 5b30  distances_flat[0
-00029a00: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00029a10: 2020 656c 6966 206d 203d 3d20 2272 6d73    elif m == "rms
-00029a20: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
-00029a30: 6469 7374 616e 6365 5f66 6c61 7422 3a0a  distance_flat":.
-00029a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029a50: 2020 2020 636f 6d70 5b6d 5d20 3d20 7369      comp[m] = si
-00029a60: 676e 6564 5f64 6973 7461 6e63 6573 5f66  gned_distances_f
-00029a70: 6c61 745b 315d 0a20 2020 2020 2020 2020  lat[1].         
-00029a80: 2020 2065 6c69 6620 6d20 696e 205b 226d     elif m in ["m
-00029a90: 6561 6e5f 756e 6465 725f 636f 6e74 6f75  ean_under_contou
-00029aa0: 7269 6e67 222c 2022 6d65 616e 5f6f 7665  ring", "mean_ove
-00029ab0: 725f 636f 6e74 6f75 7269 6e67 222c 0a20  r_contouring",. 
-00029ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ad0: 2020 2022 6d65 616e 5f64 6973 7461 6e63     "mean_distanc
-00029ae0: 655f 746f 5f63 6f6e 666f 726d 6974 7922  e_to_conformity"
-00029af0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00029b00: 2020 2063 6f6e 666f 726d 6974 7920 3d20     conformity = 
-00029b10: 2863 6f6e 666f 726d 6974 790a 2020 2020  (conformity.    
-00029b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029b30: 2020 2020 6f72 2072 6f69 302e 6765 745f      or roi0.get_
-00029b40: 6d65 616e 5f64 6973 7461 6e63 655f 746f  mean_distance_to
-00029b50: 5f63 6f6e 666f 726d 6974 7928 0a20 2020  _conformity(.   
-00029b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029b70: 2020 2020 2020 2020 2072 6f69 2c20 766f           roi, vo
-00029b80: 6c5f 756e 6974 7329 290a 2020 2020 2020  l_units)).      
-00029b90: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
-00029ba0: 3d20 226d 6561 6e5f 756e 6465 725f 636f  = "mean_under_co
-00029bb0: 6e74 6f75 7269 6e67 223a 0a20 2020 2020  ntouring":.     
-00029bc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00029bd0: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
-00029be0: 6974 792e 6d65 616e 5f75 6e64 6572 5f63  ity.mean_under_c
-00029bf0: 6f6e 746f 7572 696e 670a 2020 2020 2020  ontouring.      
-00029c00: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
-00029c10: 3d20 226d 6561 6e5f 6f76 6572 5f63 6f6e  = "mean_over_con
-00029c20: 746f 7572 696e 6722 3a0a 2020 2020 2020  touring":.      
-00029c30: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00029c40: 6d70 5b6d 5d20 3d20 636f 6e66 6f72 6d69  mp[m] = conformi
-00029c50: 7479 2e6d 6561 6e5f 6f76 6572 5f63 6f6e  ty.mean_over_con
-00029c60: 746f 7572 696e 670a 2020 2020 2020 2020  touring.        
-00029c70: 2020 2020 2020 2020 6966 206d 203d 3d20          if m == 
-00029c80: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
-00029c90: 6f5f 636f 6e66 6f72 6d69 7479 223a 0a20  o_conformity":. 
-00029ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029cb0: 2020 2063 6f6d 705b 6d5d 203d 2063 6f6e     comp[m] = con
-00029cc0: 666f 726d 6974 792e 6d65 616e 5f64 6973  formity.mean_dis
-00029cd0: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
-00029ce0: 6974 790a 2020 2020 2020 2020 2020 2020  ity.            
-00029cf0: 656c 6966 206d 2069 6e20 5b22 6d65 616e  elif m in ["mean
-00029d00: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
-00029d10: 675f 666c 6174 222c 0a20 2020 2020 2020  g_flat",.       
-00029d20: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
-00029d30: 616e 5f6f 7665 725f 636f 6e74 6f75 7269  an_over_contouri
-00029d40: 6e67 5f66 6c61 7422 2c0a 2020 2020 2020  ng_flat",.      
-00029d50: 2020 2020 2020 2020 2020 2020 2020 226d                "m
-00029d60: 6561 6e5f 6469 7374 616e 6365 5f74 6f5f  ean_distance_to_
-00029d70: 636f 6e66 6f72 6d69 7479 5f66 6c61 7422  conformity_flat"
-00029d80: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00029d90: 2020 2063 6f6e 666f 726d 6974 795f 666c     conformity_fl
-00029da0: 6174 203d 2028 636f 6e66 6f72 6d69 7479  at = (conformity
-00029db0: 5f66 6c61 740a 2020 2020 2020 2020 2020  _flat.          
-00029dc0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00029dd0: 2072 6f69 302e 6765 745f 6d65 616e 5f64   roi0.get_mean_d
-00029de0: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
-00029df0: 726d 6974 7928 0a20 2020 2020 2020 2020  rmity(.         
-00029e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e10: 2020 2072 6f69 2c20 766f 6c5f 756e 6974     roi, vol_unit
-00029e20: 732c 2076 6965 773d 7669 6577 2c20 666c  s, view=view, fl
-00029e30: 6174 7465 6e3d 5472 7565 2929 0a20 2020  atten=True)).   
-00029e40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00029e50: 6d20 3d3d 2022 6d65 616e 5f75 6e64 6572  m == "mean_under
-00029e60: 5f63 6f6e 746f 7572 696e 675f 666c 6174  _contouring_flat
-00029e70: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00029e80: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-00029e90: 2063 6f6e 666f 726d 6974 795f 666c 6174   conformity_flat
-00029ea0: 2e6d 6561 6e5f 756e 6465 725f 636f 6e74  .mean_under_cont
-00029eb0: 6f75 7269 6e67 0a20 2020 2020 2020 2020  ouring.         
-00029ec0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
-00029ed0: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
-00029ee0: 7269 6e67 5f66 6c61 7422 3a0a 2020 2020  ring_flat":.    
-00029ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029f00: 636f 6d70 5b6d 5d20 3d20 636f 6e66 6f72  comp[m] = confor
-00029f10: 6d69 7479 5f66 6c61 742e 6d65 616e 5f6f  mity_flat.mean_o
-00029f20: 7665 725f 636f 6e74 6f75 7269 6e67 0a20  ver_contouring. 
-00029f30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00029f40: 6620 6d20 3d3d 2022 6d65 616e 5f64 6973  f m == "mean_dis
-00029f50: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
-00029f60: 6974 795f 666c 6174 223a 0a20 2020 2020  ity_flat":.     
-00029f70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00029f80: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
-00029f90: 6974 795f 666c 6174 2e6d 6561 6e5f 6469  ity_flat.mean_di
-00029fa0: 7374 616e 6365 5f74 6f5f 636f 6e66 6f72  stance_to_confor
-00029fb0: 6d69 7479 0a20 2020 2020 2020 2020 2020  mity.           
-00029fc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00029fd0: 2020 2020 2020 2023 2054 6869 7320 636f         # This co
-00029fe0: 6465 2062 6c6f 636b 2063 616e 2062 6520  de block can be 
-00029ff0: 7265 6163 6865 6420 6966 2074 6869 7320  reached if this 
-0002a000: 6d65 7468 6f64 2064 6f65 736e 2774 2068  method doesn't h
-0002a010: 616e 646c 650a 2020 2020 2020 2020 2020  andle.          
-0002a020: 2020 2020 2020 2320 6120 6d65 7472 6963        # a metric
-0002a030: 2074 6861 7427 7320 6c69 7374 6564 2062   that's listed b
-0002a040: 7920 6765 745f 636f 6d70 6172 6973 6f6e  y get_comparison
-0002a050: 5f6d 6574 7269 6373 2829 2e0a 2020 2020  _metrics()..    
-0002a060: 2020 2020 2020 2020 2020 2020 666f 756e              foun
-0002a070: 6420 3d20 4661 6c73 650a 0a20 2020 2020  d = False..     
-0002a080: 2020 2020 2020 2020 2020 2023 2041 7869             # Axi
-0002a090: 732d 7370 6563 6966 6963 206d 6574 7269  s-specific metri
-0002a0a0: 6373 0a20 2020 2020 2020 2020 2020 2020  cs.             
-0002a0b0: 2020 2066 6f72 2069 2c20 6178 2069 6e20     for i, ax in 
-0002a0c0: 656e 756d 6572 6174 6528 736b 7274 2e69  enumerate(skrt.i
-0002a0d0: 6d61 6765 2e5f 6178 6573 293a 0a0a 2020  mage._axes):..  
-0002a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0f0: 2020 2320 476c 6f62 616c 2063 656e 7472    # Global centr
-0002a100: 6f69 6420 706f 7369 7469 6f6e 206f 6e20  oid position on 
-0002a110: 6120 6769 7665 6e20 6178 6973 0a20 2020  a given axis.   
-0002a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a130: 2069 6620 6d20 3d3d 2066 2263 656e 7472   if m == f"centr
-0002a140: 6f69 645f 7b61 787d 223a 0a20 2020 2020  oid_{ax}":.     
-0002a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a160: 2020 2063 6f6d 705b 6d5d 203d 2072 6f69     comp[m] = roi
-0002a170: 302e 6765 745f 6162 735f 6365 6e74 726f  0.get_abs_centro
-0002a180: 6964 5f64 6973 7461 6e63 6528 0a20 2020  id_distance(.   
-0002a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1a0: 2020 2020 2020 2020 2072 6f69 2c0a 2020           roi,.  
+00029100: 2020 666c 6174 7465 6e3d 5472 7565 2c0a    flatten=True,.
+00029110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029120: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00029130: 6c69 6620 6d20 3d3d 2022 6172 6561 5f72  lif m == "area_r
+00029140: 6174 696f 5f73 6c69 6365 5f73 7461 7473  atio_slice_stats
+00029150: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029160: 2020 2063 6f6d 702e 7570 6461 7465 2872     comp.update(r
+00029170: 6f69 302e 6765 745f 736c 6963 655f 7374  oi0.get_slice_st
+00029180: 6174 7328 726f 692c 206d 6574 7269 6373  ats(roi, metrics
+00029190: 3d22 6172 6561 5f72 6174 696f 222c 0a20  ="area_ratio",. 
+000291a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291b0: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+000291c0: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
+000291d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291e0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+000291f0: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
+00029200: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
+00029210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029220: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00029230: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
+00029240: 2020 2020 2020 2020 2020 2023 2053 7572             # Sur
+00029250: 6661 6365 2064 6973 7461 6e63 6520 6d65  face distance me
+00029260: 7472 6963 730a 2020 2020 2020 2020 2020  trics.          
+00029270: 2020 656c 6966 206d 2069 6e20 5b22 6d65    elif m in ["me
+00029280: 616e 5f73 7572 6661 6365 5f64 6973 7461  an_surface_dista
+00029290: 6e63 6522 2c0a 2020 2020 2020 2020 2020  nce",.          
+000292a0: 2020 2020 2020 2020 2020 2272 6d73 5f73            "rms_s
+000292b0: 7572 6661 6365 5f64 6973 7461 6e63 6522  urface_distance"
+000292c0: 2c20 2268 6175 7364 6f72 6666 5f64 6973  , "hausdorff_dis
+000292d0: 7461 6e63 6522 5d3a 0a20 2020 2020 2020  tance"]:.       
+000292e0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+000292f0: 6573 203d 2028 6469 7374 616e 6365 730a  es = (distances.
+00029300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029310: 2020 2020 2020 2020 6f72 2072 6f69 302e          or roi0.
+00029320: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
+00029330: 616e 6365 5f6d 6574 7269 6373 2872 6f69  ance_metrics(roi
+00029340: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00029350: 2020 2069 6620 6d20 3d3d 2022 6d65 616e     if m == "mean
+00029360: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+00029370: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+00029380: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00029390: 3d20 6469 7374 616e 6365 735b 305d 0a20  = distances[0]. 
+000293a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000293b0: 6c69 6620 6d20 3d3d 2022 726d 735f 7375  lif m == "rms_su
+000293c0: 7266 6163 655f 6469 7374 616e 6365 223a  rface_distance":
+000293d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000293e0: 2020 2020 2063 6f6d 705b 6d5d 203d 2064       comp[m] = d
+000293f0: 6973 7461 6e63 6573 5b31 5d0a 2020 2020  istances[1].    
+00029400: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00029410: 206d 203d 3d20 2268 6175 7364 6f72 6666   m == "hausdorff
+00029420: 5f64 6973 7461 6e63 6522 3a0a 2020 2020  _distance":.    
+00029430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029440: 636f 6d70 5b6d 5d20 3d20 6469 7374 616e  comp[m] = distan
+00029450: 6365 735b 325d 0a20 2020 2020 2020 2020  ces[2].         
+00029460: 2020 2065 6c69 6620 6d20 696e 205b 226d     elif m in ["m
+00029470: 6561 6e5f 7375 7266 6163 655f 6469 7374  ean_surface_dist
+00029480: 616e 6365 5f66 6c61 7422 2c0a 2020 2020  ance_flat",.    
+00029490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000294a0: 2272 6d73 5f73 7572 6661 6365 5f64 6973  "rms_surface_dis
+000294b0: 7461 6e63 655f 666c 6174 222c 2022 6861  tance_flat", "ha
+000294c0: 7573 646f 7266 665f 6469 7374 616e 6365  usdorff_distance
+000294d0: 5f66 6c61 7422 5d3a 0a20 2020 2020 2020  _flat"]:.       
+000294e0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+000294f0: 6573 5f66 6c61 7420 3d20 2864 6973 7461  es_flat = (dista
+00029500: 6e63 6573 5f66 6c61 740a 2020 2020 2020  nces_flat.      
+00029510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029520: 2020 6f72 2072 6f69 302e 6765 745f 7375    or roi0.get_su
+00029530: 7266 6163 655f 6469 7374 616e 6365 5f6d  rface_distance_m
+00029540: 6574 7269 6373 2872 6f69 2c0a 2020 2020  etrics(roi,.    
+00029550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029560: 2020 2020 7669 6577 3d76 6965 772c 2066      view=view, f
+00029570: 6c61 7474 656e 3d54 7275 6529 290a 2020  latten=True)).  
+00029580: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00029590: 206d 203d 3d20 226d 6561 6e5f 7375 7266   m == "mean_surf
+000295a0: 6163 655f 6469 7374 616e 6365 5f66 6c61  ace_distance_fla
+000295b0: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+000295c0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+000295d0: 3d20 6469 7374 616e 6365 735f 666c 6174  = distances_flat
+000295e0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+000295f0: 2020 2020 656c 6966 206d 203d 3d20 2272      elif m == "r
+00029600: 6d73 5f73 7572 6661 6365 5f64 6973 7461  ms_surface_dista
+00029610: 6e63 655f 666c 6174 223a 0a20 2020 2020  nce_flat":.     
+00029620: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029630: 6f6d 705b 6d5d 203d 2064 6973 7461 6e63  omp[m] = distanc
+00029640: 6573 5f66 6c61 745b 315d 0a20 2020 2020  es_flat[1].     
+00029650: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00029660: 6d20 3d3d 2022 6861 7573 646f 7266 665f  m == "hausdorff_
+00029670: 6469 7374 616e 6365 5f66 6c61 7422 3a0a  distance_flat":.
+00029680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029690: 2020 2020 636f 6d70 5b6d 5d20 3d20 6469      comp[m] = di
+000296a0: 7374 616e 6365 735f 666c 6174 5b32 5d0a  stances_flat[2].
+000296b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000296c0: 206d 2069 6e20 5b22 6d65 616e 5f73 6967   m in ["mean_sig
+000296d0: 6e65 645f 7375 7266 6163 655f 6469 7374  ned_surface_dist
+000296e0: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
+000296f0: 2020 2020 2020 2020 2020 2022 726d 735f             "rms_
+00029700: 7369 676e 6564 5f73 7572 6661 6365 5f64  signed_surface_d
+00029710: 6973 7461 6e63 6522 5d3a 0a20 2020 2020  istance"]:.     
+00029720: 2020 2020 2020 2020 2020 2073 6967 6e65             signe
+00029730: 645f 6469 7374 616e 6365 7320 3d20 2873  d_distances = (s
+00029740: 6967 6e65 645f 6469 7374 616e 6365 730a  igned_distances.
+00029750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029760: 2020 2020 2020 2020 6f72 2072 6f69 302e          or roi0.
+00029770: 6765 745f 7375 7266 6163 655f 6469 7374  get_surface_dist
+00029780: 616e 6365 5f6d 6574 7269 6373 2872 6f69  ance_metrics(roi
+00029790: 2c20 7369 676e 6564 3d54 7275 6529 290a  , signed=True)).
+000297a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297b0: 6966 206d 203d 3d20 226d 6561 6e5f 7369  if m == "mean_si
+000297c0: 676e 6564 5f73 7572 6661 6365 5f64 6973  gned_surface_dis
+000297d0: 7461 6e63 6522 3a0a 2020 2020 2020 2020  tance":.        
+000297e0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+000297f0: 5b6d 5d20 3d20 7369 676e 6564 5f64 6973  [m] = signed_dis
+00029800: 7461 6e63 6573 5b30 5d0a 2020 2020 2020  tances[0].      
+00029810: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00029820: 203d 3d20 2272 6d73 5f73 6967 6e65 645f   == "rms_signed_
+00029830: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00029840: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029850: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+00029860: 2073 6967 6e65 645f 6469 7374 616e 6365   signed_distance
+00029870: 735b 315d 0a20 2020 2020 2020 2020 2020  s[1].           
+00029880: 2065 6c69 6620 6d20 696e 205b 226d 6561   elif m in ["mea
+00029890: 6e5f 7369 676e 6564 5f73 7572 6661 6365  n_signed_surface
+000298a0: 5f64 6973 7461 6e63 655f 666c 6174 222c  _distance_flat",
+000298b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000298c0: 2020 2020 2022 726d 735f 7369 676e 6564       "rms_signed
+000298d0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+000298e0: 655f 666c 6174 225d 3a0a 2020 2020 2020  e_flat"]:.      
+000298f0: 2020 2020 2020 2020 2020 7369 676e 6564            signed
+00029900: 5f64 6973 7461 6e63 6573 5f66 6c61 7420  _distances_flat 
+00029910: 3d20 2873 6967 6e65 645f 6469 7374 616e  = (signed_distan
+00029920: 6365 735f 666c 6174 0a20 2020 2020 2020  ces_flat.       
+00029930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029940: 206f 7220 726f 6930 2e67 6574 5f73 7572   or roi0.get_sur
+00029950: 6661 6365 5f64 6973 7461 6e63 655f 6d65  face_distance_me
+00029960: 7472 6963 7328 726f 692c 2073 6967 6e65  trics(roi, signe
+00029970: 643d 5472 7565 2c0a 2020 2020 2020 2020  d=True,.        
+00029980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029990: 2020 2020 7669 6577 3d76 6965 772c 2066      view=view, f
+000299a0: 6c61 7474 656e 3d54 7275 6529 290a 2020  latten=True)).  
+000299b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000299c0: 206d 203d 3d20 226d 6561 6e5f 7369 676e   m == "mean_sign
+000299d0: 6564 5f73 7572 6661 6365 5f64 6973 7461  ed_surface_dista
+000299e0: 6e63 655f 666c 6174 223a 0a20 2020 2020  nce_flat":.     
+000299f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029a00: 6f6d 705b 6d5d 203d 2073 6967 6e65 645f  omp[m] = signed_
+00029a10: 6469 7374 616e 6365 735f 666c 6174 5b30  distances_flat[0
+00029a20: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00029a30: 2020 656c 6966 206d 203d 3d20 2272 6d73    elif m == "rms
+00029a40: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
+00029a50: 6469 7374 616e 6365 5f66 6c61 7422 3a0a  distance_flat":.
+00029a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a70: 2020 2020 636f 6d70 5b6d 5d20 3d20 7369      comp[m] = si
+00029a80: 676e 6564 5f64 6973 7461 6e63 6573 5f66  gned_distances_f
+00029a90: 6c61 745b 315d 0a20 2020 2020 2020 2020  lat[1].         
+00029aa0: 2020 2065 6c69 6620 6d20 696e 205b 226d     elif m in ["m
+00029ab0: 6561 6e5f 756e 6465 725f 636f 6e74 6f75  ean_under_contou
+00029ac0: 7269 6e67 222c 2022 6d65 616e 5f6f 7665  ring", "mean_ove
+00029ad0: 725f 636f 6e74 6f75 7269 6e67 222c 0a20  r_contouring",. 
+00029ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029af0: 2020 2022 6d65 616e 5f64 6973 7461 6e63     "mean_distanc
+00029b00: 655f 746f 5f63 6f6e 666f 726d 6974 7922  e_to_conformity"
+00029b10: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00029b20: 2020 2063 6f6e 666f 726d 6974 7920 3d20     conformity = 
+00029b30: 2863 6f6e 666f 726d 6974 790a 2020 2020  (conformity.    
+00029b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b50: 2020 2020 6f72 2072 6f69 302e 6765 745f      or roi0.get_
+00029b60: 6d65 616e 5f64 6973 7461 6e63 655f 746f  mean_distance_to
+00029b70: 5f63 6f6e 666f 726d 6974 7928 0a20 2020  _conformity(.   
+00029b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b90: 2020 2020 2020 2020 2072 6f69 2c20 766f           roi, vo
+00029ba0: 6c5f 756e 6974 7329 290a 2020 2020 2020  l_units)).      
+00029bb0: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
+00029bc0: 3d20 226d 6561 6e5f 756e 6465 725f 636f  = "mean_under_co
+00029bd0: 6e74 6f75 7269 6e67 223a 0a20 2020 2020  ntouring":.     
+00029be0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029bf0: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
+00029c00: 6974 792e 6d65 616e 5f75 6e64 6572 5f63  ity.mean_under_c
+00029c10: 6f6e 746f 7572 696e 670a 2020 2020 2020  ontouring.      
+00029c20: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
+00029c30: 3d20 226d 6561 6e5f 6f76 6572 5f63 6f6e  = "mean_over_con
+00029c40: 746f 7572 696e 6722 3a0a 2020 2020 2020  touring":.      
+00029c50: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00029c60: 6d70 5b6d 5d20 3d20 636f 6e66 6f72 6d69  mp[m] = conformi
+00029c70: 7479 2e6d 6561 6e5f 6f76 6572 5f63 6f6e  ty.mean_over_con
+00029c80: 746f 7572 696e 670a 2020 2020 2020 2020  touring.        
+00029c90: 2020 2020 2020 2020 6966 206d 203d 3d20          if m == 
+00029ca0: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
+00029cb0: 6f5f 636f 6e66 6f72 6d69 7479 223a 0a20  o_conformity":. 
+00029cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029cd0: 2020 2063 6f6d 705b 6d5d 203d 2063 6f6e     comp[m] = con
+00029ce0: 666f 726d 6974 792e 6d65 616e 5f64 6973  formity.mean_dis
+00029cf0: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
+00029d00: 6974 790a 2020 2020 2020 2020 2020 2020  ity.            
+00029d10: 656c 6966 206d 2069 6e20 5b22 6d65 616e  elif m in ["mean
+00029d20: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
+00029d30: 675f 666c 6174 222c 0a20 2020 2020 2020  g_flat",.       
+00029d40: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
+00029d50: 616e 5f6f 7665 725f 636f 6e74 6f75 7269  an_over_contouri
+00029d60: 6e67 5f66 6c61 7422 2c0a 2020 2020 2020  ng_flat",.      
+00029d70: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+00029d80: 6561 6e5f 6469 7374 616e 6365 5f74 6f5f  ean_distance_to_
+00029d90: 636f 6e66 6f72 6d69 7479 5f66 6c61 7422  conformity_flat"
+00029da0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00029db0: 2020 2063 6f6e 666f 726d 6974 795f 666c     conformity_fl
+00029dc0: 6174 203d 2028 636f 6e66 6f72 6d69 7479  at = (conformity
+00029dd0: 5f66 6c61 740a 2020 2020 2020 2020 2020  _flat.          
+00029de0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00029df0: 2072 6f69 302e 6765 745f 6d65 616e 5f64   roi0.get_mean_d
+00029e00: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
+00029e10: 726d 6974 7928 0a20 2020 2020 2020 2020  rmity(.         
+00029e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e30: 2020 2072 6f69 2c20 766f 6c5f 756e 6974     roi, vol_unit
+00029e40: 732c 2076 6965 773d 7669 6577 2c20 666c  s, view=view, fl
+00029e50: 6174 7465 6e3d 5472 7565 2929 0a20 2020  atten=True)).   
+00029e60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00029e70: 6d20 3d3d 2022 6d65 616e 5f75 6e64 6572  m == "mean_under
+00029e80: 5f63 6f6e 746f 7572 696e 675f 666c 6174  _contouring_flat
+00029e90: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029ea0: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+00029eb0: 2063 6f6e 666f 726d 6974 795f 666c 6174   conformity_flat
+00029ec0: 2e6d 6561 6e5f 756e 6465 725f 636f 6e74  .mean_under_cont
+00029ed0: 6f75 7269 6e67 0a20 2020 2020 2020 2020  ouring.         
+00029ee0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
+00029ef0: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
+00029f00: 7269 6e67 5f66 6c61 7422 3a0a 2020 2020  ring_flat":.    
+00029f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f20: 636f 6d70 5b6d 5d20 3d20 636f 6e66 6f72  comp[m] = confor
+00029f30: 6d69 7479 5f66 6c61 742e 6d65 616e 5f6f  mity_flat.mean_o
+00029f40: 7665 725f 636f 6e74 6f75 7269 6e67 0a20  ver_contouring. 
+00029f50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00029f60: 6620 6d20 3d3d 2022 6d65 616e 5f64 6973  f m == "mean_dis
+00029f70: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
+00029f80: 6974 795f 666c 6174 223a 0a20 2020 2020  ity_flat":.     
+00029f90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029fa0: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
+00029fb0: 6974 795f 666c 6174 2e6d 6561 6e5f 6469  ity_flat.mean_di
+00029fc0: 7374 616e 6365 5f74 6f5f 636f 6e66 6f72  stance_to_confor
+00029fd0: 6d69 7479 0a20 2020 2020 2020 2020 2020  mity.           
+00029fe0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00029ff0: 2020 2020 2020 2023 2054 6869 7320 636f         # This co
+0002a000: 6465 2062 6c6f 636b 2063 616e 2062 6520  de block can be 
+0002a010: 7265 6163 6865 6420 6966 2074 6869 7320  reached if this 
+0002a020: 6d65 7468 6f64 2064 6f65 736e 2774 2068  method doesn't h
+0002a030: 616e 646c 650a 2020 2020 2020 2020 2020  andle.          
+0002a040: 2020 2020 2020 2320 6120 6d65 7472 6963        # a metric
+0002a050: 2074 6861 7427 7320 6c69 7374 6564 2062   that's listed b
+0002a060: 7920 6765 745f 636f 6d70 6172 6973 6f6e  y get_comparison
+0002a070: 5f6d 6574 7269 6373 2829 2e0a 2020 2020  _metrics()..    
+0002a080: 2020 2020 2020 2020 2020 2020 666f 756e              foun
+0002a090: 6420 3d20 4661 6c73 650a 0a20 2020 2020  d = False..     
+0002a0a0: 2020 2020 2020 2020 2020 2023 2041 7869             # Axi
+0002a0b0: 732d 7370 6563 6966 6963 206d 6574 7269  s-specific metri
+0002a0c0: 6373 0a20 2020 2020 2020 2020 2020 2020  cs.             
+0002a0d0: 2020 2066 6f72 2069 2c20 6178 2069 6e20     for i, ax in 
+0002a0e0: 656e 756d 6572 6174 6528 736b 7274 2e69  enumerate(skrt.i
+0002a0f0: 6d61 6765 2e5f 6178 6573 293a 0a0a 2020  mage._axes):..  
+0002a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a110: 2020 2320 476c 6f62 616c 2063 656e 7472    # Global centr
+0002a120: 6f69 6420 706f 7369 7469 6f6e 206f 6e20  oid position on 
+0002a130: 6120 6769 7665 6e20 6178 6973 0a20 2020  a given axis.   
+0002a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a150: 2069 6620 6d20 3d3d 2066 2263 656e 7472   if m == f"centr
+0002a160: 6f69 645f 7b61 787d 223a 0a20 2020 2020  oid_{ax}":.     
+0002a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a180: 2020 2063 6f6d 705b 6d5d 203d 2072 6f69     comp[m] = roi
+0002a190: 302e 6765 745f 6162 735f 6365 6e74 726f  0.get_abs_centro
+0002a1a0: 6964 5f64 6973 7461 6e63 6528 0a20 2020  id_distance(.   
 0002a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1c0: 2020 2020 2020 2020 2020 756e 6974 733d            units=
-0002a1d0: 6365 6e74 726f 6964 5f75 6e69 7473 2c0a  centroid_units,.
-0002a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1f0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-0002a200: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
-0002a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a220: 2020 2020 2020 2066 6f72 6365 3d66 6f72         force=for
-0002a230: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-0002a240: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0002a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a260: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
-0002a270: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-0002a280: 2020 2069 6620 6e6f 7420 666f 756e 643a     if not found:
-0002a290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a2a0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-0002a2b0: 6d65 4572 726f 7228 6622 4d65 7472 6963  meError(f"Metric
-0002a2c0: 207b 6d7d 206e 6f74 2072 6563 6f67 6e69   {m} not recogni
-0002a2d0: 7365 6420 6279 2022 0a20 2020 2020 2020  sed by ".       
-0002a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a300: 2252 4f49 2e67 6574 5f63 6f6d 7061 7269  "ROI.get_compari
-0002a310: 736f 6e28 2922 290a 0a20 2020 2020 2020  son()")..       
-0002a320: 2023 2041 6464 2075 6e69 7473 2074 6f20   # Add units to 
-0002a330: 6d65 7472 6963 206e 616d 6573 2069 6620  metric names if 
-0002a340: 7265 7175 6573 7465 640a 2020 2020 2020  requested.      
-0002a350: 2020 636f 6d70 5f6e 616d 6564 203d 207b    comp_named = {
-0002a360: 7d0a 2020 2020 2020 2020 6966 206e 6f74  }.        if not
-0002a370: 2075 6e69 7473 5f69 6e5f 6865 6164 6572   units_in_header
-0002a380: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0002a390: 6d70 5f6e 616d 6564 203d 2063 6f6d 700a  mp_named = comp.
-0002a3a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002a3b0: 2020 2020 2020 2020 2020 666f 7220 6d65            for me
-0002a3c0: 7472 6963 2c20 7661 6c20 696e 2063 6f6d  tric, val in com
-0002a3d0: 702e 6974 656d 7328 293a 0a20 2020 2020  p.items():.     
-0002a3e0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-0002a3f0: 3d20 6d65 7472 6963 0a20 2020 2020 2020  = metric.       
-0002a400: 2020 2020 2020 2020 2069 6620 6d65 7472           if metr
-0002a410: 6963 203d 3d20 2276 6f6c 756d 655f 6469  ic == "volume_di
-0002a420: 6666 223a 0a20 2020 2020 2020 2020 2020  ff":.           
-0002a430: 2020 2020 2020 2020 2069 6620 766f 6c5f           if vol_
-0002a440: 756e 6974 7320 3d3d 2022 6d6d 223a 0a20  units == "mm":. 
-0002a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a460: 2020 2020 2020 206e 616d 6520 2b3d 2022         name += "
-0002a470: 2028 6d6d 5e33 2922 0a20 2020 2020 2020   (mm^3)".       
-0002a480: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0002a490: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002a4a0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-0002a4b0: 2b3d 2022 2028 2220 2b20 766f 6c5f 756e  += " (" + vol_un
-0002a4c0: 6974 7320 2b20 2229 220a 2020 2020 2020  its + ")".      
-0002a4d0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-0002a4e0: 6574 7269 6320 3d3d 2022 6172 6561 5f64  etric == "area_d
-0002a4f0: 6966 6622 3a0a 2020 2020 2020 2020 2020  iff":.          
-0002a500: 2020 2020 2020 2020 2020 6966 2061 7265            if are
-0002a510: 615f 756e 6974 7320 3d3d 2022 6d6d 223a  a_units == "mm":
-0002a520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a530: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
-0002a540: 2022 2028 6d6d 5e32 2922 0a20 2020 2020   " (mm^2)".     
-0002a550: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002a560: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002a570: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-0002a580: 6520 2b3d 2022 2028 2220 2b20 6172 6561  e += " (" + area
-0002a590: 5f75 6e69 7473 202b 2022 2922 0a20 2020  _units + ")".   
-0002a5a0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0002a5b0: 6620 2263 656e 7472 6f69 6422 2069 6e20  f "centroid" in 
-0002a5c0: 6d65 7472 6963 3a0a 2020 2020 2020 2020  metric:.        
-0002a5d0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0002a5e0: 202b 3d20 2220 2822 202b 2063 656e 7472   += " (" + centr
-0002a5f0: 6f69 645f 756e 6974 7320 2b20 2229 220a  oid_units + ")".
-0002a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a610: 636f 6d70 5f6e 616d 6564 5b6e 616d 655d  comp_named[name]
-0002a620: 203d 2076 616c 0a0a 2020 2020 2020 2020   = val..        
-0002a630: 2320 4164 6a75 7374 206e 756d 6265 7220  # Adjust number 
-0002a640: 6f66 2064 6563 696d 616c 2070 6c61 6365  of decimal place
-0002a650: 730a 2020 2020 2020 2020 6966 2064 6563  s.        if dec
-0002a660: 696d 616c 5f70 6c61 6365 7320 6973 206e  imal_places is n
-0002a670: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0002a680: 2020 2020 2066 6f72 206d 6574 7269 632c       for metric,
-0002a690: 2076 616c 2069 6e20 636f 6d70 5f6e 616d   val in comp_nam
-0002a6a0: 6564 2e69 7465 6d73 2829 3a0a 2020 2020  ed.items():.    
-0002a6b0: 2020 2020 2020 2020 2020 2020 666d 7420              fmt 
-0002a6c0: 3d20 6622 7b7b 7661 6c3a 2e7b 6465 6369  = f"{{val:.{deci
-0002a6d0: 6d61 6c5f 706c 6163 6573 7d66 7d7d 220a  mal_places}f}}".
-0002a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a6f0: 6966 2063 6f6d 705f 6e61 6d65 645b 6d65  if comp_named[me
-0002a700: 7472 6963 5d20 6973 206e 6f74 204e 6f6e  tric] is not Non
-0002a710: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002a720: 2020 2020 2020 2063 6f6d 705f 6e61 6d65         comp_name
-0002a730: 645b 6d65 7472 6963 5d20 3d20 666c 6f61  d[metric] = floa
-0002a740: 7428 666d 742e 666f 726d 6174 2876 616c  t(fmt.format(val
-0002a750: 3d76 616c 2929 0a0a 2020 2020 2020 2020  =val))..        
-0002a760: 2320 436f 6e76 6572 7420 746f 2070 616e  # Convert to pan
-0002a770: 6461 7320 4461 7461 4672 616d 650a 2020  das DataFrame.  
-0002a780: 2020 2020 2020 6466 203d 2070 642e 4461        df = pd.Da
-0002a790: 7461 4672 616d 6528 636f 6d70 5f6e 616d  taFrame(comp_nam
-0002a7a0: 6564 2c20 696e 6465 783d 5b72 6f69 302e  ed, index=[roi0.
-0002a7b0: 6e61 6d65 5d29 0a0a 2020 2020 2020 2020  name])..        
-0002a7c0: 2320 4361 7069 7461 6c69 7a65 2063 6f6c  # Capitalize col
-0002a7d0: 756d 6e20 6e61 6d65 7320 616e 6420 7265  umn names and re
-0002a7e0: 6d6f 7665 2075 6e64 6572 7363 6f72 6573  move underscores
-0002a7f0: 2069 6620 7265 7175 6573 7465 640a 2020   if requested.  
-0002a800: 2020 2020 2020 6966 206e 6963 655f 636f        if nice_co
-0002a810: 6c75 6d6e 7320 616e 6420 6e6f 7420 676c  lumns and not gl
-0002a820: 6f62 616c 5f76 735f 736c 6963 655f 6865  obal_vs_slice_he
-0002a830: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-0002a840: 2020 6466 2e63 6f6c 756d 6e73 203d 205b    df.columns = [
-0002a850: 636f 6c2e 6361 7069 7461 6c69 7a65 2829  col.capitalize()
-0002a860: 2e72 6570 6c61 6365 2822 5f22 2c20 2220  .replace("_", " 
-0002a870: 2229 2e72 6570 6c61 6365 2822 726d 7322  ").replace("rms"
-0002a880: 2c20 2252 4d53 2229 0a20 2020 2020 2020  , "RMS").       
-0002a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a8a0: 2020 2066 6f72 2063 6f6c 2069 6e20 6466     for col in df
-0002a8b0: 2e63 6f6c 756d 6e73 5d0a 0a20 2020 2020  .columns]..     
-0002a8c0: 2020 2023 2054 7572 6e20 6e61 6d65 2069     # Turn name i
-0002a8d0: 6e74 6f20 6120 7265 6775 6c61 7220 636f  nto a regular co
-0002a8e0: 6c75 6d6e 2069 6620 7265 7175 6573 7465  lumn if requeste
-0002a8f0: 640a 2020 2020 2020 2020 6966 206e 6f74  d.        if not
-0002a900: 206e 616d 655f 6173 5f69 6e64 6578 3a0a   name_as_index:.
-0002a910: 2020 2020 2020 2020 2020 2020 6466 203d              df =
-0002a920: 2064 662e 7265 7365 745f 696e 6465 7828   df.reset_index(
-0002a930: 292e 7265 6e61 6d65 287b 2269 6e64 6578  ).rename({"index
-0002a940: 223a 2022 524f 4922 7d2c 2061 7869 733d  ": "ROI"}, axis=
-0002a950: 3129 0a0a 2020 2020 2020 2020 2320 4164  1)..        # Ad
-0002a960: 6420 676c 6f62 616c 2f73 6c69 6365 2068  d global/slice h
-0002a970: 6561 6465 7273 0a20 2020 2020 2020 2069  eaders.        i
-0002a980: 6620 676c 6f62 616c 5f76 735f 736c 6963  f global_vs_slic
-0002a990: 655f 6865 6164 6572 3a0a 0a20 2020 2020  e_header:..     
-0002a9a0: 2020 2020 2020 2023 2053 6f72 7420 636f         # Sort co
-0002a9b0: 6c75 6d6e 7320 696e 746f 2067 6c6f 6261  lumns into globa
-0002a9c0: 6c20 6f72 2073 6c69 6365 0a20 2020 2020  l or slice.     
-0002a9d0: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
-0002a9e0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0002a9f0: 736c 6963 655f 636f 6c73 203d 205b 5d0a  slice_cols = [].
-0002aa00: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
-0002aa10: 616c 5f63 6f6c 7320 3d20 5b5d 0a20 2020  al_cols = [].   
-0002aa20: 2020 2020 2020 2020 2073 6c69 6365 5f6e           slice_n
-0002aa30: 616d 6520 3d20 2273 6c69 6365 2220 6966  ame = "slice" if
-0002aa40: 206e 6f74 206e 6963 655f 636f 6c75 6d6e   not nice_column
-0002aa50: 7320 656c 7365 2022 536c 6963 6522 0a20  s else "Slice". 
-0002aa60: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
-0002aa70: 6c5f 6e61 6d65 203d 2022 676c 6f62 616c  l_name = "global
-0002aa80: 2220 6966 206e 6f74 206e 6963 655f 636f  " if not nice_co
-0002aa90: 6c75 6d6e 7320 656c 7365 2022 476c 6f62  lumns else "Glob
-0002aaa0: 616c 220a 2020 2020 2020 2020 2020 2020  al".            
-0002aab0: 666f 7220 6d65 7472 6963 2069 6e20 636f  for metric in co
-0002aac0: 6d70 5f6e 616d 6564 3a0a 2020 2020 2020  mp_named:.      
-0002aad0: 2020 2020 2020 2020 2020 6966 2022 736c            if "sl
-0002aae0: 6963 6522 2069 6e20 6d65 7472 6963 206f  ice" in metric o
-0002aaf0: 7220 5c0a 2020 2020 2020 2020 2020 2020  r \.            
-0002ab00: 2020 2020 2020 2028 2261 7265 6122 2069         ("area" i
-0002ab10: 6e20 6d65 7472 6963 2061 6e64 2022 666c  n metric and "fl
-0002ab20: 6174 2220 6e6f 7420 696e 206d 6574 7269  at" not in metri
-0002ab30: 6329 3a0a 2020 2020 2020 2020 2020 2020  c):.            
-0002ab40: 2020 2020 2020 2020 6865 6164 6572 732e          headers.
-0002ab50: 6170 7065 6e64 2828 736c 6963 655f 6e61  append((slice_na
-0002ab60: 6d65 2c20 6d65 7472 6963 2929 0a20 2020  me, metric)).   
-0002ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ab80: 2073 6c69 6365 5f63 6f6c 732e 6170 7065   slice_cols.appe
-0002ab90: 6e64 286d 6574 7269 6329 0a20 2020 2020  nd(metric).     
-0002aba0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002abb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002abc0: 2020 2020 2068 6561 6465 7273 2e61 7070       headers.app
-0002abd0: 656e 6428 2867 6c6f 6261 6c5f 6e61 6d65  end((global_name
-0002abe0: 2c20 6d65 7472 6963 2929 0a20 2020 2020  , metric)).     
-0002abf0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0002ac00: 6c6f 6261 6c5f 636f 6c73 2e61 7070 656e  lobal_cols.appen
-0002ac10: 6428 6d65 7472 6963 290a 0a20 2020 2020  d(metric)..     
-0002ac20: 2020 2020 2020 2023 2052 656f 7264 6572         # Reorder
-0002ac30: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
-0002ac40: 2020 2020 2064 6673 5f6f 7264 6572 6564       dfs_ordered
-0002ac50: 203d 205b 6466 5b67 6c6f 6261 6c5f 636f   = [df[global_co
-0002ac60: 6c73 5d2c 2064 665b 736c 6963 655f 636f  ls], df[slice_co
-0002ac70: 6c73 5d5d 0a20 2020 2020 2020 2020 2020  ls]].           
-0002ac80: 2069 6620 6e6f 7420 6e61 6d65 5f61 735f   if not name_as_
-0002ac90: 696e 6465 783a 0a20 2020 2020 2020 2020  index:.         
-0002aca0: 2020 2020 2020 2064 6673 5f6f 7264 6572         dfs_order
-0002acb0: 6564 2e69 6e73 6572 7428 302c 2064 665b  ed.insert(0, df[
-0002acc0: 2252 4f49 225d 290a 2020 2020 2020 2020  "ROI"]).        
-0002acd0: 2020 2020 6466 203d 2070 642e 636f 6e63      df = pd.conc
-0002ace0: 6174 2864 6673 5f6f 7264 6572 6564 2c20  at(dfs_ordered, 
-0002acf0: 6178 6973 3d31 290a 0a20 2020 2020 2020  axis=1)..       
-0002ad00: 2020 2020 2023 2053 6f72 7420 6865 6164       # Sort head
-0002ad10: 6572 7320 6279 2067 6c6f 6261 6c2f 736c  ers by global/sl
-0002ad20: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
-0002ad30: 6865 6164 6572 7320 3d20 5b68 2066 6f72  headers = [h for
-0002ad40: 2068 2069 6e20 6865 6164 6572 7320 6966   h in headers if
-0002ad50: 2068 5b30 5d20 3d3d 2067 6c6f 6261 6c5f   h[0] == global_
-0002ad60: 6e61 6d65 5d20 5c0a 2020 2020 2020 2020  name] \.        
-0002ad70: 2020 2020 2020 2020 2020 2020 2b20 5b68              + [h
-0002ad80: 2066 6f72 2068 2069 6e20 6865 6164 6572   for h in header
-0002ad90: 7320 6966 2068 5b30 5d20 3d3d 2073 6c69  s if h[0] == sli
-0002ada0: 6365 5f6e 616d 655d 0a20 2020 2020 2020  ce_name].       
-0002adb0: 2020 2020 2069 6620 6e6f 7420 6e61 6d65       if not name
-0002adc0: 5f61 735f 696e 6465 783a 0a20 2020 2020  _as_index:.     
-0002add0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0002ade0: 7273 2e69 6e73 6572 7428 302c 2028 2222  rs.insert(0, (""
-0002adf0: 2c20 2252 4f49 2229 290a 0a20 2020 2020  , "ROI"))..     
-0002ae00: 2020 2020 2020 2023 2041 6464 204d 756c         # Add Mul
-0002ae10: 7469 496e 6465 780a 2020 2020 2020 2020  tiIndex.        
-0002ae20: 2020 2020 6466 2e63 6f6c 756d 6e73 203d      df.columns =
-0002ae30: 2070 642e 4d75 6c74 6949 6e64 6578 2e66   pd.MultiIndex.f
-0002ae40: 726f 6d5f 7475 706c 6573 2868 6561 6465  rom_tuples(heade
-0002ae50: 7273 290a 0a20 2020 2020 2020 2072 6574  rs)..        ret
-0002ae60: 7572 6e20 6466 0a0a 2020 2020 6465 6620  urn df..    def 
-0002ae70: 6765 745f 636f 6d70 6172 6973 6f6e 5f6e  get_comparison_n
-0002ae80: 616d 6528 7365 6c66 2c20 726f 692c 2063  ame(self, roi, c
-0002ae90: 616d 656c 6361 7365 3d46 616c 7365 2c20  amelcase=False, 
-0002aea0: 636f 6c6f 7265 643d 4661 6c73 652c 0a20  colored=False,. 
-0002aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aec0: 2020 2020 2020 2020 2020 2067 7265 793d             grey=
-0002aed0: 4661 6c73 652c 2072 6f69 5f6b 7761 7267  False, roi_kwarg
-0002aee0: 733d 7b7d 293a 0a20 2020 2020 2020 2022  s={}):.        "
-0002aef0: 2222 4765 7420 6e61 6d65 206f 6620 636f  ""Get name of co
-0002af00: 6d70 6172 6973 6f6e 2062 6574 7765 656e  mparison between
-0002af10: 2074 6869 7320 524f 4920 616e 6420 616e   this ROI and an
-0002af20: 6f74 6865 722e 2222 220a 0a20 2020 2020  other."""..     
-0002af30: 2020 206f 776e 5f6e 616d 6520 3d20 7365     own_name = se
-0002af40: 6c66 2e6e 616d 650a 2020 2020 2020 2020  lf.name.        
-0002af50: 6f74 6865 725f 6e61 6d65 203d 2072 6f69  other_name = roi
-0002af60: 2e6e 616d 650a 0a20 2020 2020 2020 2069  .name..        i
-0002af70: 6620 636f 6c6f 7265 643a 0a20 2020 2020  f colored:.     
-0002af80: 2020 2020 2020 206f 776e 5f63 6f6c 6f72         own_color
-0002af90: 203d 2073 656c 662e 6765 745f 636f 6c6f   = self.get_colo
-0002afa0: 725f 6672 6f6d 5f6b 7761 7267 7328 726f  r_from_kwargs(ro
-0002afb0: 695f 6b77 6172 6773 290a 2020 2020 2020  i_kwargs).      
-0002afc0: 2020 2020 2020 6f77 6e5f 6e61 6d65 203d        own_name =
-0002afd0: 2067 6574 5f63 6f6c 6f72 6564 5f72 6f69   get_colored_roi
-0002afe0: 5f73 7472 696e 6728 7365 6c66 2c20 6772  _string(self, gr
-0002aff0: 6579 2c20 6f77 6e5f 636f 6c6f 7229 0a20  ey, own_color). 
-0002b000: 2020 2020 2020 2020 2020 206f 7468 6572             other
-0002b010: 5f63 6f6c 6f72 203d 2072 6f69 2e67 6574  _color = roi.get
-0002b020: 5f63 6f6c 6f72 5f66 726f 6d5f 6b77 6172  _color_from_kwar
-0002b030: 6773 2872 6f69 5f6b 7761 7267 7329 0a20  gs(roi_kwargs). 
-0002b040: 2020 2020 2020 2020 2020 206f 7468 6572             other
-0002b050: 5f6e 616d 6520 3d20 6765 745f 636f 6c6f  _name = get_colo
-0002b060: 7265 645f 726f 695f 7374 7269 6e67 2872  red_roi_string(r
-0002b070: 6f69 2c20 6772 6579 2c20 6f74 6865 725f  oi, grey, other_
-0002b080: 636f 6c6f 7229 0a0a 2020 2020 2020 2020  color)..        
-0002b090: 6966 2073 656c 662e 6e61 6d65 203d 3d20  if self.name == 
-0002b0a0: 726f 692e 6e61 6d65 3a0a 2020 2020 2020  roi.name:.      
-0002b0b0: 2020 2020 2020 6966 2063 616d 656c 6361        if camelca
-0002b0c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002b0d0: 2020 2020 7265 7475 726e 206f 776e 5f6e      return own_n
-0002b0e0: 616d 652e 7265 706c 6163 6528 2220 222c  ame.replace(" ",
-0002b0f0: 2022 5f22 290a 2020 2020 2020 2020 2020   "_").          
-0002b100: 2020 7265 7475 726e 206f 776e 5f6e 616d    return own_nam
-0002b110: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-0002b120: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0002b130: 6f74 2063 6f6c 6f72 6564 3a0a 2020 2020  ot colored:.    
-0002b140: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0002b150: 616d 656c 6361 7365 3a0a 2020 2020 2020  amelcase:.      
-0002b160: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0002b170: 7475 726e 2066 227b 6f77 6e5f 6e61 6d65  turn f"{own_name
-0002b180: 7d5f 7673 5f7b 6f74 6865 725f 6e61 6d65  }_vs_{other_name
-0002b190: 7d22 2e72 6570 6c61 6365 2822 2022 2c20  }".replace(" ", 
-0002b1a0: 225f 2229 0a20 2020 2020 2020 2020 2020  "_").           
-0002b1b0: 2020 2020 2072 6574 7572 6e20 6622 7b6f       return f"{o
-0002b1c0: 776e 5f6e 616d 657d 2076 732e 207b 6f74  wn_name} vs. {ot
-0002b1d0: 6865 725f 6e61 6d65 7d22 0a20 2020 2020  her_name}".     
-0002b1e0: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
-0002b1f0: 7b6f 776e 5f6e 616d 657d 7b6f 7468 6572  {own_name}{other
-0002b200: 5f6e 616d 657d 220a 0a20 2020 2064 6566  _name}"..    def
-0002b210: 2073 6574 5f61 6c70 6861 5f6f 7665 725f   set_alpha_over_
-0002b220: 6265 7461 2873 656c 662c 2061 6c70 6861  beta(self, alpha
-0002b230: 5f6f 7665 725f 6265 7461 3d4e 6f6e 6529  _over_beta=None)
-0002b240: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0002b250: 2020 2020 2020 5365 7420 7261 7469 6f20        Set ratio 
-0002b260: 666f 7220 524f 4920 7469 7373 7565 206f  for ROI tissue o
-0002b270: 6620 636f 6566 6669 6369 656e 7473 206f  f coefficients o
-0002b280: 6620 6c69 6e65 6172 2d71 7561 6472 6174  f linear-quadrat
-0002b290: 6963 2065 7175 6174 696f 6e2e 0a0a 2020  ic equation...  
-0002b2a0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0002b2b0: 723a 2a2a 0a0a 2020 2020 2020 2020 616c  r:**..        al
-0002b2c0: 7068 615f 6f76 6572 5f62 6574 6120 3a20  pha_over_beta : 
-0002b2d0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-0002b2e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0002b2f0: 5261 7469 6f20 666f 7220 524f 4920 7469  Ratio for ROI ti
-0002b300: 7373 7565 206f 6620 636f 6566 6669 6369  ssue of coeffici
-0002b310: 656e 7473 2c20 616c 7068 612c 2062 6574  ents, alpha, bet
-0002b320: 612c 0a20 2020 2020 2020 2020 2020 206f  a,.            o
-0002b330: 6620 6c69 6e65 6172 2d71 7561 6472 6174  f linear-quadrat
-0002b340: 6963 2065 7175 6174 696f 6e2e 2020 5468  ic equation.  Th
-0002b350: 6973 2072 6174 696f 2069 7320 7573 6564  is ratio is used
-0002b360: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-0002b370: 6361 6c63 756c 6174 696e 6720 6269 6f6c  calculating biol
-0002b380: 6f67 6963 616c 6c79 2065 6666 6563 7469  ogically effecti
-0002b390: 7665 2064 6f73 652c 2042 4544 2c20 6672  ve dose, BED, fr
-0002b3a0: 6f6d 0a20 2020 2020 2020 2020 2020 2070  om.            p
-0002b3b0: 6879 7369 6361 6c20 646f 7365 2c20 442c  hysical dose, D,
-0002b3c0: 2064 656c 6976 6572 6564 206f 7665 7220   delivered over 
-0002b3d0: 6e20 6571 7561 6c20 6672 6163 7469 6f6e  n equal fraction
-0002b3e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0002b3f0: 2020 2042 4544 203d 2044 202a 2028 3120     BED = D * (1 
-0002b400: 2b20 2844 2f6e 2920 2f20 2861 6c70 6861  + (D/n) / (alpha
-0002b410: 2f62 6574 6129 292e 0a20 2020 2020 2020  /beta))..       
-0002b420: 2020 2020 2049 6620 4e6f 6e65 2c20 7468       If None, th
-0002b430: 6520 6269 6f6c 6f67 6963 616c 6c79 2065  e biologically e
-0002b440: 6666 6563 7469 7665 2064 6f73 6520 6973  ffective dose is
-0002b450: 2074 616b 656e 2074 6f20 6265 0a20 2020   taken to be.   
-0002b460: 2020 2020 2020 2020 2065 7175 616c 2074           equal t
-0002b470: 6f20 7468 6520 7068 7973 6963 616c 2064  o the physical d
-0002b480: 6f73 6520 2862 6574 6120 3e3e 2061 6c70  ose (beta >> alp
-0002b490: 6861 292e 0a20 2020 2020 2020 2022 2222  ha)..        """
-0002b4a0: 0a20 2020 2020 2020 2073 656c 662e 616c  .        self.al
-0002b4b0: 7068 615f 6f76 6572 5f62 6574 6120 3d20  pha_over_beta = 
-0002b4c0: 616c 7068 615f 6f76 6572 5f62 6574 610a  alpha_over_beta.
-0002b4d0: 0a20 2020 2064 6566 2067 6574 5f61 6c70  .    def get_alp
-0002b4e0: 6861 5f6f 7665 725f 6265 7461 2873 656c  ha_over_beta(sel
-0002b4f0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0002b500: 2020 2020 2020 2020 4765 7420 7261 7469          Get rati
-0002b510: 6f20 666f 7220 524f 4920 7469 7373 7565  o for ROI tissue
-0002b520: 206f 6620 636f 6566 6669 6369 656e 7473   of coefficients
-0002b530: 206f 6620 6c69 6e65 6172 2d71 7561 6472   of linear-quadr
-0002b540: 6174 6963 2065 7175 6174 696f 6e2e 0a20  atic equation.. 
-0002b550: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0002b560: 2020 2072 6574 7572 6e20 7365 6c66 2e61     return self.a
-0002b570: 6c70 6861 5f6f 7665 725f 6265 7461 0a0a  lpha_over_beta..
-0002b580: 2020 2020 6465 6620 7365 745f 636f 6c6f      def set_colo
-0002b590: 7228 7365 6c66 2c20 636f 6c6f 7229 3a0a  r(self, color):.
-0002b5a0: 2020 2020 2020 2020 2222 2253 6574 2070          """Set p
-0002b5b0: 6c6f 7474 696e 6720 636f 6c6f 722e 2222  lotting color.""
-0002b5c0: 220a 0a20 2020 2020 2020 2069 6620 636f  "..        if co
-0002b5d0: 6c6f 7220 6973 206e 6f74 204e 6f6e 6520  lor is not None 
-0002b5e0: 616e 6420 6e6f 7420 6d61 7470 6c6f 746c  and not matplotl
-0002b5f0: 6962 2e63 6f6c 6f72 732e 6973 5f63 6f6c  ib.colors.is_col
-0002b600: 6f72 5f6c 696b 6528 636f 6c6f 7229 3a0a  or_like(color):.
-0002b610: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0002b620: 7428 6622 5761 726e 696e 673a 207b 636f  t(f"Warning: {co
-0002b630: 6c6f 727d 206e 6f74 2061 2076 616c 6964  lor} not a valid
-0002b640: 2063 6f6c 6f72 2122 290a 2020 2020 2020   color!").      
-0002b650: 2020 2020 2020 636f 6c6f 7220 3d20 4e6f        color = No
-0002b660: 6e65 0a20 2020 2020 2020 2069 6620 636f  ne.        if co
-0002b670: 6c6f 7220 6973 204e 6f6e 653a 0a20 2020  lor is None:.   
-0002b680: 2020 2020 2020 2020 2063 6f6c 6f72 203d           color =
-0002b690: 2052 4f49 4465 6661 756c 7473 2829 2e67   ROIDefaults().g
-0002b6a0: 6574 5f64 6566 6175 6c74 5f72 6f69 5f63  et_default_roi_c
-0002b6b0: 6f6c 6f72 2829 0a20 2020 2020 2020 2073  olor().        s
-0002b6c0: 656c 662e 636f 6c6f 7220 3d20 6d61 7470  elf.color = matp
-0002b6d0: 6c6f 746c 6962 2e63 6f6c 6f72 732e 746f  lotlib.colors.to
-0002b6e0: 5f72 6762 6128 636f 6c6f 7229 0a0a 2020  _rgba(color)..  
-0002b6f0: 2020 6465 6620 706c 6f74 280a 2020 2020    def plot(.    
-0002b700: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0002b710: 2020 7669 6577 3d22 782d 7922 2c0a 2020    view="x-y",.  
-0002b720: 2020 2020 2020 706c 6f74 5f74 7970 653d        plot_type=
-0002b730: 2263 6f6e 746f 7572 222c 0a20 2020 2020  "contour",.     
-0002b740: 2020 2073 6c3d 4e6f 6e65 2c0a 2020 2020     sl=None,.    
-0002b750: 2020 2020 6964 783d 4e6f 6e65 2c0a 2020      idx=None,.  
-0002b760: 2020 2020 2020 706f 733d 4e6f 6e65 2c0a        pos=None,.
-0002b770: 2020 2020 2020 2020 6178 3d4e 6f6e 652c          ax=None,
-0002b780: 0a20 2020 2020 2020 2067 733d 4e6f 6e65  .        gs=None
-0002b790: 2c0a 2020 2020 2020 2020 6669 6773 697a  ,.        figsiz
-0002b7a0: 653d 736b 7274 2e69 6d61 6765 2e5f 6465  e=skrt.image._de
-0002b7b0: 6661 756c 745f 6669 6773 697a 652c 0a20  fault_figsize,. 
-0002b7c0: 2020 2020 2020 206f 7061 6369 7479 3d4e         opacity=N
-0002b7d0: 6f6e 652c 0a20 2020 2020 2020 206c 696e  one,.        lin
-0002b7e0: 6577 6964 7468 3d4e 6f6e 652c 0a20 2020  ewidth=None,.   
-0002b7f0: 2020 2020 2063 6f6e 746f 7572 5f6b 7761       contour_kwa
-0002b800: 7267 733d 4e6f 6e65 2c0a 2020 2020 2020  rgs=None,.      
-0002b810: 2020 6d61 736b 5f6b 7761 7267 733d 4e6f    mask_kwargs=No
-0002b820: 6e65 2c0a 2020 2020 2020 2020 7a6f 6f6d  ne,.        zoom
-0002b830: 3d4e 6f6e 652c 0a20 2020 2020 2020 207a  =None,.        z
-0002b840: 6f6f 6d5f 6365 6e74 7265 3d4e 6f6e 652c  oom_centre=None,
-0002b850: 0a20 2020 2020 2020 2063 6f6c 6f72 3d4e  .        color=N
-0002b860: 6f6e 652c 0a20 2020 2020 2020 2073 686f  one,.        sho
-0002b870: 773d 5472 7565 2c0a 2020 2020 2020 2020  w=True,.        
-0002b880: 7361 7665 5f61 733d 4e6f 6e65 2c0a 2020  save_as=None,.  
-0002b890: 2020 2020 2020 696e 636c 7564 655f 696d        include_im
-0002b8a0: 6167 653d 4661 6c73 652c 0a20 2020 2020  age=False,.     
-0002b8b0: 2020 206e 6f5f 696e 7665 7274 3d46 616c     no_invert=Fal
-0002b8c0: 7365 2c0a 2020 2020 2020 2020 2a2a 6b77  se,.        **kw
-0002b8d0: 6172 6773 2c0a 2020 2020 293a 0a20 2020  args,.    ):.   
-0002b8e0: 2020 2020 2022 2222 506c 6f74 2074 6869       """Plot thi
-0002b8f0: 7320 524f 4920 6173 2065 6974 6865 7220  s ROI as either 
-0002b900: 6120 6d61 736b 206f 7220 6120 636f 6e74  a mask or a cont
-0002b910: 6f75 722e 0a0a 2020 2020 2020 2020 2a2a  our...        **
-0002b920: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-0002b930: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-0002b940: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-0002b950: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-0002b960: 656e 7461 7469 6f6e 2069 6e20 7768 6963  entation in whic
-0002b970: 6820 746f 2070 6c6f 742e 2043 616e 2062  h to plot. Can b
-0002b980: 6520 2278 2d79 222c 2022 792d 7a22 2c20  e "x-y", "y-z", 
-0002b990: 6f72 2022 782d 7a22 2e0a 0a20 2020 2020  or "x-z"...     
-0002b9a0: 2020 2070 6c6f 745f 7479 7065 203a 2073     plot_type : s
-0002b9b0: 7472 2c20 6465 6661 756c 743d 2263 6f6e  tr, default="con
-0002b9c0: 746f 7572 220a 2020 2020 2020 2020 2020  tour".          
-0002b9d0: 2020 506c 6f74 7469 6e67 2074 7970 652e    Plotting type.
-0002b9e0: 2049 6620 4e6f 6e65 2c20 7769 6c6c 2062   If None, will b
-0002b9f0: 6520 6569 7468 6572 2022 636f 6e74 6f75  e either "contou
-0002ba00: 7222 206f 7220 226d 6173 6b22 200a 2020  r" or "mask" .  
-0002ba10: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
-0002ba20: 696e 6720 6f6e 2074 6865 2069 6e70 7574  ing on the input
-0002ba30: 2074 7970 6520 6f66 2074 6865 2052 4f49   type of the ROI
-0002ba40: 2e20 4f70 7469 6f6e 733a 0a0a 2020 2020  . Options:..    
-0002ba50: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
-0002ba60: 6f6e 746f 7572 220a 2020 2020 2020 2020  ontour".        
-0002ba70: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-0002ba80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ba90: 202d 2022 6365 6e74 726f 6964 2220 2863   - "centroid" (c
-0002baa0: 6f6e 746f 7572 2077 6974 6820 6d61 726b  ontour with mark
-0002bab0: 6572 2061 7420 6365 6e74 726f 6964 290a  er at centroid).
-0002bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bad0: 2d20 2266 696c 6c65 6422 2028 7472 616e  - "filled" (tran
-0002bae0: 7370 6172 656e 7420 6d61 736b 202b 2063  sparent mask + c
-0002baf0: 6f6e 746f 7572 290a 2020 2020 2020 2020  ontour).        
-0002bb00: 2020 2020 2020 2020 2d20 2266 696c 6c65          - "fille
-0002bb10: 6420 6365 6e74 726f 6964 2220 2866 696c  d centroid" (fil
-0002bb20: 6c65 6420 7769 7468 206d 6172 6b65 7220  led with marker 
-0002bb30: 6174 2063 656e 7472 6f69 6429 0a0a 2020  at centroid)..  
-0002bb40: 2020 2020 2020 736c 203a 2069 6e74 2c20        sl : int, 
-0002bb50: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0002bb60: 2020 2020 2020 2020 2053 6c69 6365 206e           Slice n
-0002bb70: 756d 6265 7220 746f 2070 6c6f 742e 2049  umber to plot. I
-0002bb80: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
-0002bb90: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
-0002bba0: 7265 2073 7570 706c 6965 642c 200a 2020  re supplied, .  
-0002bbb0: 2020 2020 2020 2020 2020 7468 6520 6365            the ce
-0002bbc0: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
-0002bbd0: 6865 2052 4f49 2077 696c 6c20 6265 200a  he ROI will be .
-0002bbe0: 2020 2020 2020 2020 2020 2020 7573 6564              used
-0002bbf0: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
-0002bc00: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-0002bc10: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
-0002bc20: 7272 6179 2069 6e64 6578 206f 6620 736c  rray index of sl
-0002bc30: 6963 6520 746f 2070 6c6f 742e 2049 6620  ice to plot. If 
-0002bc40: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
-0002bc50: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
-0002bc60: 200a 2020 2020 2020 2020 2020 2020 7375   .            su
-0002bc70: 7070 6c69 6564 2c20 7468 6520 6365 6e74  pplied, the cent
-0002bc80: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
-0002bc90: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
-0002bca0: 642e 0a0a 2020 2020 2020 2020 706f 7320  d...        pos 
-0002bcb0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-0002bcc0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0002bcd0: 2020 506f 7369 7469 6f6e 2069 6e20 6d6d    Position in mm
-0002bce0: 206f 6620 736c 6963 6520 746f 2070 6c6f   of slice to plo
-0002bcf0: 742e 2049 6620 6e6f 6e65 206f 6620 3c73  t. If none of <s
-0002bd00: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-0002bd10: 733e 200a 2020 2020 2020 2020 2020 2020  s> .            
-0002bd20: 6172 6520 7375 7070 6c69 6564 2c20 7468  are supplied, th
-0002bd30: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
-0002bd40: 6f66 2074 6865 2052 4f49 2077 696c 6c20  of the ROI will 
-0002bd50: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-0002bd60: 2020 6178 203a 206d 6174 706c 6f74 6c69    ax : matplotli
-0002bd70: 622e 7079 706c 6f74 2e41 7865 732c 2064  b.pyplot.Axes, d
-0002bd80: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0002bd90: 2020 2020 2020 2020 4178 6573 206f 6e20          Axes on 
-0002bda0: 7768 6963 6820 746f 2070 6c6f 742e 2049  which to plot. I
-0002bdb0: 6620 4e6f 6e65 2c20 6e65 7720 6178 6573  f None, new axes
-0002bdc0: 2077 696c 6c20 6265 2063 7265 6174 6564   will be created
-0002bdd0: 2e0a 0a20 2020 2020 2020 2067 7320 3a20  ...        gs : 
-0002bde0: 6d61 7470 6c6f 746c 6962 2e67 7269 6473  matplotlib.grids
-0002bdf0: 7065 632e 4772 6964 5370 6563 2c20 6465  pec.GridSpec, de
-0002be00: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0002be10: 2020 2020 2020 2049 6620 6e6f 7420 4e6f         If not No
-0002be20: 6e65 2061 6e64 203c 6178 3e20 6973 204e  ne and <ax> is N
-0002be30: 6f6e 652c 206e 6577 2061 7865 7320 7769  one, new axes wi
-0002be40: 6c6c 2062 6520 6372 6561 7465 6420 6f6e  ll be created on
-0002be50: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0002be60: 2063 7572 7265 6e74 206d 6174 706c 6f74   current matplot
-0002be70: 6c69 6220 6669 6775 7265 2077 6974 6820  lib figure with 
-0002be80: 7468 6973 2067 7269 6473 7065 632e 0a0a  this gridspec...
-0002be90: 2020 2020 2020 2020 6669 6773 697a 6520          figsize 
-0002bea0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-0002beb0: 3d73 6b72 742e 696d 6167 652e 5f64 6566  =skrt.image._def
-0002bec0: 6175 6c74 5f66 6967 7369 7a65 0a20 2020  ault_figsize.   
-0002bed0: 2020 2020 2020 2020 2046 6967 7572 6520           Figure 
-0002bee0: 6865 6967 6874 2069 6e20 696e 6368 6573  height in inches
-0002bef0: 3b20 6f6e 6c79 2075 7365 6420 6966 203c  ; only used if <
-0002bf00: 6178 3e20 616e 6420 3c67 733e 2061 7265  ax> and <gs> are
-0002bf10: 204e 6f6e 652e 0a0a 2020 2020 2020 2020   None...        
-0002bf20: 6f70 6163 6974 7920 3a20 666c 6f61 742c  opacity : float,
-0002bf30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0002bf40: 2020 2020 2020 2020 2020 4f70 6163 6974            Opacit
-0002bf50: 7920 746f 2075 7365 2069 6620 706c 6f74  y to use if plot
-0002bf60: 7469 6e67 206d 6173 6b20 2869 2e65 2e20  ting mask (i.e. 
-0002bf70: 706c 6f74 2074 7970 6573 2022 6d61 736b  plot types "mask
-0002bf80: 222c 2022 6669 6c6c 6564 222c 200a 2020  ", "filled", .  
-0002bf90: 2020 2020 2020 2020 2020 6f72 2022 6669            or "fi
-0002bfa0: 6c6c 6564 2063 656e 7472 6f69 6422 292e  lled centroid").
-0002bfb0: 2049 6620 4e6f 6e65 2c20 6f70 6163 6974   If None, opacit
-0002bfc0: 7920 7769 6c6c 2062 6520 3120 6279 2064  y will be 1 by d
-0002bfd0: 6566 6175 6c74 2066 6f72 200a 2020 2020  efault for .    
-0002bfe0: 2020 2020 2020 2020 736f 6c69 6420 6d61          solid ma
-0002bff0: 736b 2070 6c6f 7473 2061 6e64 2030 2e33  sk plots and 0.3
-0002c000: 2062 7920 6465 6661 756c 7420 666f 7220   by default for 
-0002c010: 6669 6c6c 6564 2070 6c6f 7473 2e0a 0a20  filled plots... 
-0002c020: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
-0002c030: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
-0002c040: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0002c050: 2020 2057 6964 7468 206f 6620 636f 6e74     Width of cont
-0002c060: 6f75 7220 6c69 6e65 732e 2049 6620 4e6f  our lines. If No
-0002c070: 6e65 2c20 7468 6520 6d61 7470 6c6f 746c  ne, the matplotl
-0002c080: 6962 2064 6566 6175 6c74 2073 6574 7469  ib default setti
-0002c090: 6e67 200a 2020 2020 2020 2020 2020 2020  ng .            
-0002c0a0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-0002c0b0: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
-0002c0c0: 7761 7267 7320 3a20 6469 6374 2c20 6465  wargs : dict, de
-0002c0d0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0002c0e0: 2020 2020 2020 2045 7874 7261 206b 6579         Extra key
-0002c0f0: 776f 7264 2061 7267 756d 656e 7473 2074  word arguments t
-0002c100: 6f20 7061 7373 2074 6f20 6d61 7470 6c6f  o pass to matplo
-0002c110: 746c 6962 2063 6f6e 746f 7572 2070 6c6f  tlib contour plo
-0002c120: 7474 696e 672e 0a0a 2020 2020 2020 2020  tting...        
-0002c130: 6d61 736b 5f6b 7761 7267 7320 3a20 6469  mask_kwargs : di
-0002c140: 6374 2c20 6465 6661 756c 743d 4e6f 6e65  ct, default=None
-0002c150: 0a20 2020 2020 2020 2020 2020 2045 7874  .            Ext
-0002c160: 7261 206b 6579 776f 7264 2061 7267 756d  ra keyword argum
-0002c170: 656e 7473 2074 6f20 7061 7373 2074 6f20  ents to pass to 
-0002c180: 6d61 7470 6c6f 746c 6962 206d 6173 6b20  matplotlib mask 
-0002c190: 706c 6f74 7469 6e67 2e0a 0a20 2020 2020  plotting...     
-0002c1a0: 2020 207a 6f6f 6d20 3a20 696e 742f 666c     zoom : int/fl
-0002c1b0: 6f61 742f 7475 706c 652c 2064 6566 6175  oat/tuple, defau
-0002c1c0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0002c1d0: 2020 2020 4661 6374 6f72 2062 7920 7768      Factor by wh
-0002c1e0: 6963 6820 746f 207a 6f6f 6d20 696e 2e20  ich to zoom in. 
-0002c1f0: 4966 2061 2073 696e 676c 6520 696e 7420  If a single int 
-0002c200: 6f72 2066 6c6f 6174 2069 7320 6769 7665  or float is give
-0002c210: 6e2c 0a20 2020 2020 2020 2020 2020 2074  n,.            t
-0002c220: 6865 2073 616d 6520 7a6f 6f6d 2066 6163  he same zoom fac
-0002c230: 746f 7220 7769 6c6c 2062 6520 6170 706c  tor will be appl
-0002c240: 6965 6420 696e 2061 6c6c 2064 6972 6563  ied in all direc
-0002c250: 7469 6f6e 732e 2049 6620 6120 7475 706c  tions. If a tupl
-0002c260: 650a 2020 2020 2020 2020 2020 2020 6f66  e.            of
-0002c270: 2074 6872 6565 2076 616c 7565 7320 6973   three values is
-0002c280: 2067 6976 656e 2c20 7468 6573 6520 7769   given, these wi
-0002c290: 6c6c 2062 6520 7573 6564 2061 7320 7468  ll be used as th
-0002c2a0: 6520 7a6f 6f6d 2066 6163 746f 7273 0a20  e zoom factors. 
-0002c2b0: 2020 2020 2020 2020 2020 2069 6e20 6561             in ea
-0002c2c0: 6368 2064 6972 6563 7469 6f6e 2069 6e20  ch direction in 
-0002c2d0: 7468 6520 6f72 6465 7220 2878 2c20 792c  the order (x, y,
-0002c2e0: 207a 292e 2049 6620 4e6f 6e65 2c20 7468   z). If None, th
-0002c2f0: 6520 696d 6167 6520 7769 6c6c 0a20 2020  e image will.   
-0002c300: 2020 2020 2020 2020 206e 6f74 2062 6520           not be 
-0002c310: 7a6f 6f6d 6564 2069 6e2e 0a0a 2020 2020  zoomed in...    
-0002c320: 2020 2020 7a6f 6f6d 5f63 656e 7472 6520      zoom_centre 
-0002c330: 3a20 7475 706c 652c 2064 6566 6175 6c74  : tuple, default
-0002c340: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0002c350: 2020 506f 7369 7469 6f6e 2061 726f 756e    Position aroun
-0002c360: 6420 7768 6963 6820 7a6f 6f6d 696e 6720  d which zooming 
-0002c370: 6973 2061 7070 6c69 6564 2e20 4966 204e  is applied. If N
-0002c380: 6f6e 652c 2074 6865 2063 656e 7472 6520  one, the centre 
-0002c390: 6f66 0a20 2020 2020 2020 2020 2020 2074  of.            t
-0002c3a0: 6865 2069 6d61 6765 2077 696c 6c20 6265  he image will be
-0002c3b0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-0002c3c0: 636f 6c6f 7220 3a20 6d61 7470 6c6f 746c  color : matplotl
-0002c3d0: 6962 2063 6f6c 6f72 2c20 6465 6661 756c  ib color, defaul
-0002c3e0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0002c3f0: 2020 2043 6f6c 6f72 2077 6974 6820 7768     Color with wh
-0002c400: 6963 6820 746f 2070 6c6f 7420 7468 6520  ich to plot the 
-0002c410: 524f 493b 206f 7665 7272 6964 6573 2074  ROI; overrides t
-0002c420: 6865 2052 4f49 2773 206f 776e 2063 6f6c  he ROI's own col
-0002c430: 6f72 2e20 4966 200a 2020 2020 2020 2020  or. If .        
-0002c440: 2020 2020 4e6f 6e65 2c20 7365 6c66 2e63      None, self.c
-0002c450: 6f6c 6f72 2077 696c 6c20 6265 2075 7365  olor will be use
-0002c460: 642e 0a0a 2020 2020 2020 2020 7368 6f77  d...        show
-0002c470: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-0002c480: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
-0002c490: 2020 4966 2054 7275 652c 2074 6865 2070    If True, the p
-0002c4a0: 6c6f 7420 7769 6c6c 2062 6520 6469 7370  lot will be disp
-0002c4b0: 6c61 7965 6420 696d 6d65 6469 6174 656c  layed immediatel
-0002c4c0: 792e 0a0a 2020 2020 2020 2020 7361 7665  y...        save
-0002c4d0: 5f61 7320 3a20 7374 722c 2064 6566 6175  _as : str, defau
-0002c4e0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0002c4f0: 2020 2020 4966 2073 6574 2074 6f20 6120      If set to a 
-0002c500: 7374 7269 6e67 2c20 7468 6520 706c 6f74  string, the plot
-0002c510: 2077 696c 6c20 6265 2073 6176 6564 2074   will be saved t
-0002c520: 6f20 7468 6520 6669 6c65 6e61 6d65 2069  o the filename i
-0002c530: 6e20 7468 6520 0a20 2020 2020 2020 2020  n the .         
-0002c540: 2020 2073 7472 696e 672e 0a0a 2020 2020     string...    
-0002c550: 2020 2020 696e 636c 7564 655f 696d 6167      include_imag
-0002c560: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
-0002c570: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-0002c580: 2020 2020 4966 2054 7275 6520 616e 6420      If True and 
-0002c590: 7365 6c66 2e69 6d61 6765 2069 7320 6e6f  self.image is no
-0002c5a0: 7420 4e6f 6e65 2c20 7468 6520 524f 4927  t None, the ROI'
-0002c5b0: 7320 696d 6167 6520 7769 6c6c 2062 6520  s image will be 
-0002c5c0: 706c 6f74 7465 640a 2020 2020 2020 2020  plotted.        
-0002c5d0: 2020 2020 696e 2074 6865 2062 6163 6b67      in the backg
-0002c5e0: 726f 756e 642e 0a0a 2020 2020 2020 2020  round...        
-0002c5f0: 6e6f 5f69 6e76 6572 7420 3a20 626f 6f6c  no_invert : bool
-0002c600: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-0002c610: 2020 2020 2020 2020 2020 2020 4966 2046              If F
-0002c620: 616c 7365 2c20 636f 6e74 6f75 7220 706c  alse, contour pl
-0002c630: 6f74 7320 7769 6c6c 2062 6520 6175 746f  ots will be auto
-0002c640: 6d61 7469 6361 6c6c 7920 696e 7665 7274  matically invert
-0002c650: 6564 2077 6865 6e20 706c 6f74 7469 6e67  ed when plotting
-0002c660: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0002c670: 686f 7574 2061 6e20 756e 6465 726c 7969  hout an underlyi
-0002c680: 6e67 2069 6d61 6765 2074 6f20 6163 636f  ng image to acco
-0002c690: 756e 7420 666f 7220 7468 6520 7920 6178  unt for the y ax
-0002c6a0: 6973 2069 6e63 7265 6173 696e 6720 0a20  is increasing . 
-0002c6b0: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
-0002c6c0: 6520 6f70 706f 7369 7465 2064 6972 6563  e opposite direc
-0002c6d0: 7469 6f6e 2e20 4f74 6865 7277 6973 652c  tion. Otherwise,
-0002c6e0: 2074 6865 2070 6c6f 7420 7769 6c6c 2062   the plot will b
-0002c6f0: 6520 6c65 6674 2061 730a 2020 2020 2020  e left as.      
-0002c700: 2020 2020 2020 6974 2061 7070 6561 7265        it appeare
-0002c710: 6420 7768 656e 2064 7261 776e 2062 7920  d when drawn by 
-0002c720: 6d61 7470 6c6f 746c 6962 2e0a 0a20 2020  matplotlib...   
-0002c730: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
-0002c740: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
-0002c750: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
-0002c760: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
-0002c770: 2074 6865 2072 656c 6576 616e 7420 706c   the relevant pl
-0002c780: 6f74 2066 756e 6374 696f 6e2e 0a20 2020  ot function..   
-0002c790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0002c7a0: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
-0002c7b0: 2020 2020 2069 6620 7365 6c66 2e65 6d70       if self.emp
-0002c7c0: 7479 3a0a 2020 2020 2020 2020 2020 2020  ty:.            
-0002c7d0: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-0002c7e0: 6966 2070 6c6f 745f 7479 7065 2069 7320  if plot_type is 
-0002c7f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002c800: 2020 706c 6f74 5f74 7970 6520 3d20 6b77    plot_type = kw
-0002c810: 6172 6773 2e67 6574 2822 726f 695f 706c  args.get("roi_pl
-0002c820: 6f74 5f74 7970 6522 2c20 7365 6c66 2e64  ot_type", self.d
-0002c830: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-0002c840: 6f64 290a 0a20 2020 2020 2020 2069 6620  od)..        if 
-0002c850: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
-0002c860: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
-0002c870: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
-0002c880: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
-0002c890: 6c66 2e67 6574 5f6d 6964 5f69 6478 2876  lf.get_mid_idx(v
-0002c8a0: 6965 7729 0a20 2020 2020 2020 2065 6c73  iew).        els
-0002c8b0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0002c8c0: 6478 203d 2073 656c 662e 6765 745f 6964  dx = self.get_id
-0002c8d0: 7828 7669 6577 2c20 736c 2c20 6964 782c  x(view, sl, idx,
-0002c8e0: 2070 6f73 290a 0a20 2020 2020 2020 2073   pos)..        s
-0002c8f0: 686f 775f 6365 6e74 726f 6964 203d 2022  how_centroid = "
-0002c900: 6365 6e74 726f 6964 2220 696e 2070 6c6f  centroid" in plo
-0002c910: 745f 7479 7065 0a20 2020 2020 2020 2069  t_type.        i
-0002c920: 6620 7a6f 6f6d 2061 6e64 207a 6f6f 6d5f  f zoom and zoom_
-0002c930: 6365 6e74 7265 2069 7320 4e6f 6e65 3a0a  centre is None:.
-0002c940: 2020 2020 2020 2020 2020 2020 7a6f 6f6d              zoom
-0002c950: 5f63 656e 7472 6520 3d20 7365 6c66 2e67  _centre = self.g
-0002c960: 6574 5f7a 6f6f 6d5f 6365 6e74 7265 2876  et_zoom_centre(v
-0002c970: 6965 7729 0a20 2020 2020 2020 2069 6620  iew).        if 
-0002c980: 636f 6c6f 7220 6973 204e 6f6e 653a 0a20  color is None:. 
-0002c990: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
-0002c9a0: 203d 2073 656c 662e 636f 6c6f 720a 2020   = self.color.  
-0002c9b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002c9c0: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
-0002c9d0: 6d61 7470 6c6f 746c 6962 2e63 6f6c 6f72  matplotlib.color
-0002c9e0: 732e 746f 5f72 6762 6128 636f 6c6f 7229  s.to_rgba(color)
-0002c9f0: 0a0a 2020 2020 2020 2020 6966 206f 7061  ..        if opa
-0002ca00: 6369 7479 2069 7320 4e6f 6e65 3a0a 2020  city is None:.  
-0002ca10: 2020 2020 2020 2020 2020 6f70 6163 6974            opacit
-0002ca20: 7920 3d20 6b77 6172 6773 2e67 6574 280a  y = kwargs.get(.
-0002ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca40: 2020 2020 2272 6f69 5f6f 7061 6369 7479      "roi_opacity
-0002ca50: 222c 2030 2e33 2069 6620 2266 696c 6c65  ", 0.3 if "fille
-0002ca60: 6422 2069 6e20 706c 6f74 5f74 7970 6520  d" in plot_type 
-0002ca70: 656c 7365 2031 290a 0a20 2020 2020 2020  else 1)..       
-0002ca80: 2023 2053 6574 2075 7020 6178 6573 0a20   # Set up axes. 
-0002ca90: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-0002caa0: 6178 2870 6c6f 745f 7479 7065 2c20 696e  ax(plot_type, in
-0002cab0: 636c 7564 655f 696d 6167 652c 2076 6965  clude_image, vie
-0002cac0: 772c 2061 782c 2067 732c 2066 6967 7369  w, ax, gs, figsi
-0002cad0: 7a65 290a 0a20 2020 2020 2020 2023 2041  ze)..        # A
-0002cae0: 646a 7573 7420 6365 6e74 726f 6964 206d  djust centroid m
-0002caf0: 6172 6b65 7220 7369 7a65 0a20 2020 2020  arker size.     
-0002cb00: 2020 2069 6620 636f 6e74 6f75 725f 6b77     if contour_kw
-0002cb10: 6172 6773 2069 7320 4e6f 6e65 3a0a 2020  args is None:.  
-0002cb20: 2020 2020 2020 2020 2020 636f 6e74 6f75            contou
-0002cb30: 725f 6b77 6172 6773 203d 207b 7d0a 2020  r_kwargs = {}.  
-0002cb40: 2020 2020 2020 6966 2022 6365 6e74 726f        if "centro
-0002cb50: 6964 2220 696e 2070 6c6f 745f 7479 7065  id" in plot_type
-0002cb60: 206f 7220 2263 6f6e 746f 7572 2220 3d3d   or "contour" ==
-0002cb70: 2070 6c6f 745f 7479 7065 3a0a 2020 2020   plot_type:.    
-0002cb80: 2020 2020 2020 2020 6966 206c 696e 6577          if linew
-0002cb90: 6964 7468 2069 7320 4e6f 6e65 3a0a 2020  idth is None:.  
-0002cba0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0002cbb0: 6e65 7769 6474 6820 3d20 6b77 6172 6773  newidth = kwargs
-0002cbc0: 2e67 6574 2822 726f 695f 6c69 6e65 7769  .get("roi_linewi
-0002cbd0: 6474 6822 2c0a 2020 2020 2020 2020 2020  dth",.          
-0002cbe0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0002cbf0: 6661 756c 7450 6172 616d 735b 226c 696e  faultParams["lin
-0002cc00: 6573 2e6c 696e 6577 6964 7468 225d 5b30  es.linewidth"][0
-0002cc10: 5d29 0a20 2020 2020 2020 2069 6620 2263  ]).        if "c
-0002cc20: 656e 7472 6f69 6422 2069 6e20 706c 6f74  entroid" in plot
-0002cc30: 5f74 7970 653a 0a20 2020 2020 2020 2020  _type:.         
-0002cc40: 2020 2063 6f6e 746f 7572 5f6b 7761 7267     contour_kwarg
-0002cc50: 732e 7365 7464 6566 6175 6c74 2822 6d61  s.setdefault("ma
-0002cc60: 726b 6572 7369 7a65 222c 2037 202a 206e  rkersize", 7 * n
-0002cc70: 702e 7371 7274 286c 696e 6577 6964 7468  p.sqrt(linewidth
-0002cc80: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
-0002cc90: 6f6e 746f 7572 5f6b 7761 7267 732e 7365  ontour_kwargs.se
-0002cca0: 7464 6566 6175 6c74 2822 6d61 726b 6572  tdefault("marker
-0002ccb0: 6564 6765 7769 6474 6822 2c20 6e70 2e73  edgewidth", np.s
-0002ccc0: 7172 7428 6c69 6e65 7769 6474 6829 290a  qrt(linewidth)).
-0002ccd0: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
-0002cce0: 6120 6d61 736b 0a20 2020 2020 2020 2069  a mask.        i
-0002ccf0: 6620 706c 6f74 5f74 7970 6520 3d3d 2022  f plot_type == "
-0002cd00: 6d61 736b 223a 0a20 2020 2020 2020 2020  mask":.         
-0002cd10: 2020 2073 656c 662e 5f70 6c6f 745f 6d61     self._plot_ma
-0002cd20: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
-0002cd30: 2020 2020 7669 6577 2c0a 2020 2020 2020      view,.      
-0002cd40: 2020 2020 2020 2020 2020 6964 782c 0a20            idx,. 
-0002cd50: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0002cd60: 6173 6b5f 6b77 6172 6773 2c0a 2020 2020  ask_kwargs,.    
-0002cd70: 2020 2020 2020 2020 2020 2020 6f70 6163              opac
-0002cd80: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
-0002cd90: 2020 2020 207a 6f6f 6d3d 7a6f 6f6d 2c0a       zoom=zoom,.
-0002cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cdb0: 7a6f 6f6d 5f63 656e 7472 653d 7a6f 6f6d  zoom_centre=zoom
-0002cdc0: 5f63 656e 7472 652c 0a20 2020 2020 2020  _centre,.       
-0002cdd0: 2020 2020 2020 2020 2073 686f 773d 4661           show=Fa
-0002cde0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-0002cdf0: 2020 2020 2069 6e63 6c75 6465 5f69 6d61       include_ima
-0002ce00: 6765 3d69 6e63 6c75 6465 5f69 6d61 6765  ge=include_image
-0002ce10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002ce20: 2020 636f 6c6f 723d 636f 6c6f 722c 0a20    color=color,. 
-0002ce30: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0002ce40: 2a6b 7761 7267 732c 0a20 2020 2020 2020  *kwargs,.       
-0002ce50: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0002ce60: 2320 506c 6f74 2061 2063 6f6e 746f 7572  # Plot a contour
-0002ce70: 0a20 2020 2020 2020 2065 6c69 6620 706c  .        elif pl
-0002ce80: 6f74 5f74 7970 6520 696e 205b 2263 6f6e  ot_type in ["con
-0002ce90: 746f 7572 222c 2022 6365 6e74 726f 6964  tour", "centroid
-0002cea0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-0002ceb0: 7365 6c66 2e5f 706c 6f74 5f63 6f6e 746f  self._plot_conto
-0002cec0: 7572 280a 2020 2020 2020 2020 2020 2020  ur(.            
-0002ced0: 2020 2020 7669 6577 2c0a 2020 2020 2020      view,.      
-0002cee0: 2020 2020 2020 2020 2020 6964 782c 0a20            idx,. 
-0002cef0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002cf00: 6f6e 746f 7572 5f6b 7761 7267 732c 0a20  ontour_kwargs,. 
-0002cf10: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0002cf20: 696e 6577 6964 7468 2c0a 2020 2020 2020  inewidth,.      
-0002cf30: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
-0002cf40: 6964 3d73 686f 775f 6365 6e74 726f 6964  id=show_centroid
-0002cf50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002cf60: 2020 7a6f 6f6d 3d7a 6f6f 6d2c 0a20 2020    zoom=zoom,.   
-0002cf70: 2020 2020 2020 2020 2020 2020 207a 6f6f               zoo
-0002cf80: 6d5f 6365 6e74 7265 3d7a 6f6f 6d5f 6365  m_centre=zoom_ce
-0002cf90: 6e74 7265 2c0a 2020 2020 2020 2020 2020  ntre,.          
-0002cfa0: 2020 2020 2020 636f 6c6f 723d 636f 6c6f        color=colo
-0002cfb0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0002cfc0: 2020 2073 686f 773d 4661 6c73 652c 0a20     show=False,. 
-0002cfd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002cfe0: 6e63 6c75 6465 5f69 6d61 6765 3d69 6e63  nclude_image=inc
-0002cff0: 6c75 6465 5f69 6d61 6765 2c0a 2020 2020  lude_image,.    
-0002d000: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-0002d010: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-0002d020: 2020 290a 0a20 2020 2020 2020 2023 2050    )..        # P
-0002d030: 6c6f 7420 7472 616e 7370 6172 656e 7420  lot transparent 
-0002d040: 6d61 736b 202b 2063 6f6e 746f 7572 0a20  mask + contour. 
-0002d050: 2020 2020 2020 2065 6c69 6620 2266 696c         elif "fil
-0002d060: 6c65 6422 2069 6e20 706c 6f74 5f74 7970  led" in plot_typ
-0002d070: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0002d080: 6620 6f70 6163 6974 7920 6973 204e 6f6e  f opacity is Non
-0002d090: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002d0a0: 2020 206f 7061 6369 7479 203d 2030 2e33     opacity = 0.3
-0002d0b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002d0c0: 662e 5f70 6c6f 745f 6d61 736b 2876 6965  f._plot_mask(vie
-0002d0d0: 772c 2069 6478 2c20 6d61 736b 5f6b 7761  w, idx, mask_kwa
-0002d0e0: 7267 732c 206f 7061 6369 7479 2c20 636f  rgs, opacity, co
-0002d0f0: 6c6f 723d 636f 6c6f 722c 0a20 2020 2020  lor=color,.     
-0002d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d110: 2020 2020 2020 7368 6f77 3d46 616c 7365        show=False
-0002d120: 2c20 696e 636c 7564 655f 696d 6167 653d  , include_image=
-0002d130: 696e 636c 7564 655f 696d 6167 652c 202a  include_image, *
-0002d140: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0002d150: 2020 2020 206b 7761 7267 735b 2261 7822       kwargs["ax"
-0002d160: 5d20 3d20 7365 6c66 2e61 780a 2020 2020  ] = self.ax.    
-0002d170: 2020 2020 2020 2020 7365 6c66 2e5f 706c          self._pl
-0002d180: 6f74 5f63 6f6e 746f 7572 280a 2020 2020  ot_contour(.    
-0002d190: 2020 2020 2020 2020 2020 2020 7669 6577              view
+0002a1c0: 2020 2020 2020 2020 2072 6f69 2c0a 2020           roi,.  
+0002a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1e0: 2020 2020 2020 2020 2020 756e 6974 733d            units=
+0002a1f0: 6365 6e74 726f 6964 5f75 6e69 7473 2c0a  centroid_units,.
+0002a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a210: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0002a220: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
+0002a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a240: 2020 2020 2020 2066 6f72 6365 3d66 6f72         force=for
+0002a250: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+0002a260: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0002a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a280: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
+0002a290: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+0002a2a0: 2020 2069 6620 6e6f 7420 666f 756e 643a     if not found:
+0002a2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a2c0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+0002a2d0: 6d65 4572 726f 7228 6622 4d65 7472 6963  meError(f"Metric
+0002a2e0: 207b 6d7d 206e 6f74 2072 6563 6f67 6e69   {m} not recogni
+0002a2f0: 7365 6420 6279 2022 0a20 2020 2020 2020  sed by ".       
+0002a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a320: 2252 4f49 2e67 6574 5f63 6f6d 7061 7269  "ROI.get_compari
+0002a330: 736f 6e28 2922 290a 0a20 2020 2020 2020  son()")..       
+0002a340: 2023 2041 6464 2075 6e69 7473 2074 6f20   # Add units to 
+0002a350: 6d65 7472 6963 206e 616d 6573 2069 6620  metric names if 
+0002a360: 7265 7175 6573 7465 640a 2020 2020 2020  requested.      
+0002a370: 2020 636f 6d70 5f6e 616d 6564 203d 207b    comp_named = {
+0002a380: 7d0a 2020 2020 2020 2020 6966 206e 6f74  }.        if not
+0002a390: 2075 6e69 7473 5f69 6e5f 6865 6164 6572   units_in_header
+0002a3a0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0002a3b0: 6d70 5f6e 616d 6564 203d 2063 6f6d 700a  mp_named = comp.
+0002a3c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002a3d0: 2020 2020 2020 2020 2020 666f 7220 6d65            for me
+0002a3e0: 7472 6963 2c20 7661 6c20 696e 2063 6f6d  tric, val in com
+0002a3f0: 702e 6974 656d 7328 293a 0a20 2020 2020  p.items():.     
+0002a400: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0002a410: 3d20 6d65 7472 6963 0a20 2020 2020 2020  = metric.       
+0002a420: 2020 2020 2020 2020 2069 6620 6d65 7472           if metr
+0002a430: 6963 203d 3d20 2276 6f6c 756d 655f 6469  ic == "volume_di
+0002a440: 6666 223a 0a20 2020 2020 2020 2020 2020  ff":.           
+0002a450: 2020 2020 2020 2020 2069 6620 766f 6c5f           if vol_
+0002a460: 756e 6974 7320 3d3d 2022 6d6d 223a 0a20  units == "mm":. 
+0002a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a480: 2020 2020 2020 206e 616d 6520 2b3d 2022         name += "
+0002a490: 2028 6d6d 5e33 2922 0a20 2020 2020 2020   (mm^3)".       
+0002a4a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0002a4b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a4c0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0002a4d0: 2b3d 2022 2028 2220 2b20 766f 6c5f 756e  += " (" + vol_un
+0002a4e0: 6974 7320 2b20 2229 220a 2020 2020 2020  its + ")".      
+0002a4f0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+0002a500: 6574 7269 6320 3d3d 2022 6172 6561 5f64  etric == "area_d
+0002a510: 6966 6622 3a0a 2020 2020 2020 2020 2020  iff":.          
+0002a520: 2020 2020 2020 2020 2020 6966 2061 7265            if are
+0002a530: 615f 756e 6974 7320 3d3d 2022 6d6d 223a  a_units == "mm":
+0002a540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a550: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
+0002a560: 2022 2028 6d6d 5e32 2922 0a20 2020 2020   " (mm^2)".     
+0002a570: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002a580: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002a590: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+0002a5a0: 6520 2b3d 2022 2028 2220 2b20 6172 6561  e += " (" + area
+0002a5b0: 5f75 6e69 7473 202b 2022 2922 0a20 2020  _units + ")".   
+0002a5c0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0002a5d0: 6620 2263 656e 7472 6f69 6422 2069 6e20  f "centroid" in 
+0002a5e0: 6d65 7472 6963 3a0a 2020 2020 2020 2020  metric:.        
+0002a5f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0002a600: 202b 3d20 2220 2822 202b 2063 656e 7472   += " (" + centr
+0002a610: 6f69 645f 756e 6974 7320 2b20 2229 220a  oid_units + ")".
+0002a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a630: 636f 6d70 5f6e 616d 6564 5b6e 616d 655d  comp_named[name]
+0002a640: 203d 2076 616c 0a0a 2020 2020 2020 2020   = val..        
+0002a650: 2320 4164 6a75 7374 206e 756d 6265 7220  # Adjust number 
+0002a660: 6f66 2064 6563 696d 616c 2070 6c61 6365  of decimal place
+0002a670: 730a 2020 2020 2020 2020 6966 2064 6563  s.        if dec
+0002a680: 696d 616c 5f70 6c61 6365 7320 6973 206e  imal_places is n
+0002a690: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0002a6a0: 2020 2020 2066 6f72 206d 6574 7269 632c       for metric,
+0002a6b0: 2076 616c 2069 6e20 636f 6d70 5f6e 616d   val in comp_nam
+0002a6c0: 6564 2e69 7465 6d73 2829 3a0a 2020 2020  ed.items():.    
+0002a6d0: 2020 2020 2020 2020 2020 2020 666d 7420              fmt 
+0002a6e0: 3d20 6622 7b7b 7661 6c3a 2e7b 6465 6369  = f"{{val:.{deci
+0002a6f0: 6d61 6c5f 706c 6163 6573 7d66 7d7d 220a  mal_places}f}}".
+0002a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a710: 6966 2063 6f6d 705f 6e61 6d65 645b 6d65  if comp_named[me
+0002a720: 7472 6963 5d20 6973 206e 6f74 204e 6f6e  tric] is not Non
+0002a730: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a740: 2020 2020 2020 2063 6f6d 705f 6e61 6d65         comp_name
+0002a750: 645b 6d65 7472 6963 5d20 3d20 666c 6f61  d[metric] = floa
+0002a760: 7428 666d 742e 666f 726d 6174 2876 616c  t(fmt.format(val
+0002a770: 3d76 616c 2929 0a0a 2020 2020 2020 2020  =val))..        
+0002a780: 2320 436f 6e76 6572 7420 746f 2070 616e  # Convert to pan
+0002a790: 6461 7320 4461 7461 4672 616d 650a 2020  das DataFrame.  
+0002a7a0: 2020 2020 2020 6466 203d 2070 642e 4461        df = pd.Da
+0002a7b0: 7461 4672 616d 6528 636f 6d70 5f6e 616d  taFrame(comp_nam
+0002a7c0: 6564 2c20 696e 6465 783d 5b72 6f69 302e  ed, index=[roi0.
+0002a7d0: 6e61 6d65 5d29 0a0a 2020 2020 2020 2020  name])..        
+0002a7e0: 2320 4361 7069 7461 6c69 7a65 2063 6f6c  # Capitalize col
+0002a7f0: 756d 6e20 6e61 6d65 7320 616e 6420 7265  umn names and re
+0002a800: 6d6f 7665 2075 6e64 6572 7363 6f72 6573  move underscores
+0002a810: 2069 6620 7265 7175 6573 7465 640a 2020   if requested.  
+0002a820: 2020 2020 2020 6966 206e 6963 655f 636f        if nice_co
+0002a830: 6c75 6d6e 7320 616e 6420 6e6f 7420 676c  lumns and not gl
+0002a840: 6f62 616c 5f76 735f 736c 6963 655f 6865  obal_vs_slice_he
+0002a850: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+0002a860: 2020 6466 2e63 6f6c 756d 6e73 203d 205b    df.columns = [
+0002a870: 636f 6c2e 6361 7069 7461 6c69 7a65 2829  col.capitalize()
+0002a880: 2e72 6570 6c61 6365 2822 5f22 2c20 2220  .replace("_", " 
+0002a890: 2229 2e72 6570 6c61 6365 2822 726d 7322  ").replace("rms"
+0002a8a0: 2c20 2252 4d53 2229 0a20 2020 2020 2020  , "RMS").       
+0002a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8c0: 2020 2066 6f72 2063 6f6c 2069 6e20 6466     for col in df
+0002a8d0: 2e63 6f6c 756d 6e73 5d0a 0a20 2020 2020  .columns]..     
+0002a8e0: 2020 2023 2054 7572 6e20 6e61 6d65 2069     # Turn name i
+0002a8f0: 6e74 6f20 6120 7265 6775 6c61 7220 636f  nto a regular co
+0002a900: 6c75 6d6e 2069 6620 7265 7175 6573 7465  lumn if requeste
+0002a910: 640a 2020 2020 2020 2020 6966 206e 6f74  d.        if not
+0002a920: 206e 616d 655f 6173 5f69 6e64 6578 3a0a   name_as_index:.
+0002a930: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+0002a940: 2064 662e 7265 7365 745f 696e 6465 7828   df.reset_index(
+0002a950: 292e 7265 6e61 6d65 287b 2269 6e64 6578  ).rename({"index
+0002a960: 223a 2022 524f 4922 7d2c 2061 7869 733d  ": "ROI"}, axis=
+0002a970: 3129 0a0a 2020 2020 2020 2020 2320 4164  1)..        # Ad
+0002a980: 6420 676c 6f62 616c 2f73 6c69 6365 2068  d global/slice h
+0002a990: 6561 6465 7273 0a20 2020 2020 2020 2069  eaders.        i
+0002a9a0: 6620 676c 6f62 616c 5f76 735f 736c 6963  f global_vs_slic
+0002a9b0: 655f 6865 6164 6572 3a0a 0a20 2020 2020  e_header:..     
+0002a9c0: 2020 2020 2020 2023 2053 6f72 7420 636f         # Sort co
+0002a9d0: 6c75 6d6e 7320 696e 746f 2067 6c6f 6261  lumns into globa
+0002a9e0: 6c20 6f72 2073 6c69 6365 0a20 2020 2020  l or slice.     
+0002a9f0: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
+0002aa00: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0002aa10: 736c 6963 655f 636f 6c73 203d 205b 5d0a  slice_cols = [].
+0002aa20: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
+0002aa30: 616c 5f63 6f6c 7320 3d20 5b5d 0a20 2020  al_cols = [].   
+0002aa40: 2020 2020 2020 2020 2073 6c69 6365 5f6e           slice_n
+0002aa50: 616d 6520 3d20 2273 6c69 6365 2220 6966  ame = "slice" if
+0002aa60: 206e 6f74 206e 6963 655f 636f 6c75 6d6e   not nice_column
+0002aa70: 7320 656c 7365 2022 536c 6963 6522 0a20  s else "Slice". 
+0002aa80: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
+0002aa90: 6c5f 6e61 6d65 203d 2022 676c 6f62 616c  l_name = "global
+0002aaa0: 2220 6966 206e 6f74 206e 6963 655f 636f  " if not nice_co
+0002aab0: 6c75 6d6e 7320 656c 7365 2022 476c 6f62  lumns else "Glob
+0002aac0: 616c 220a 2020 2020 2020 2020 2020 2020  al".            
+0002aad0: 666f 7220 6d65 7472 6963 2069 6e20 636f  for metric in co
+0002aae0: 6d70 5f6e 616d 6564 3a0a 2020 2020 2020  mp_named:.      
+0002aaf0: 2020 2020 2020 2020 2020 6966 2022 736c            if "sl
+0002ab00: 6963 6522 2069 6e20 6d65 7472 6963 206f  ice" in metric o
+0002ab10: 7220 5c0a 2020 2020 2020 2020 2020 2020  r \.            
+0002ab20: 2020 2020 2020 2028 2261 7265 6122 2069         ("area" i
+0002ab30: 6e20 6d65 7472 6963 2061 6e64 2022 666c  n metric and "fl
+0002ab40: 6174 2220 6e6f 7420 696e 206d 6574 7269  at" not in metri
+0002ab50: 6329 3a0a 2020 2020 2020 2020 2020 2020  c):.            
+0002ab60: 2020 2020 2020 2020 6865 6164 6572 732e          headers.
+0002ab70: 6170 7065 6e64 2828 736c 6963 655f 6e61  append((slice_na
+0002ab80: 6d65 2c20 6d65 7472 6963 2929 0a20 2020  me, metric)).   
+0002ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aba0: 2073 6c69 6365 5f63 6f6c 732e 6170 7065   slice_cols.appe
+0002abb0: 6e64 286d 6574 7269 6329 0a20 2020 2020  nd(metric).     
+0002abc0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002abd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002abe0: 2020 2020 2068 6561 6465 7273 2e61 7070       headers.app
+0002abf0: 656e 6428 2867 6c6f 6261 6c5f 6e61 6d65  end((global_name
+0002ac00: 2c20 6d65 7472 6963 2929 0a20 2020 2020  , metric)).     
+0002ac10: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0002ac20: 6c6f 6261 6c5f 636f 6c73 2e61 7070 656e  lobal_cols.appen
+0002ac30: 6428 6d65 7472 6963 290a 0a20 2020 2020  d(metric)..     
+0002ac40: 2020 2020 2020 2023 2052 656f 7264 6572         # Reorder
+0002ac50: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
+0002ac60: 2020 2020 2064 6673 5f6f 7264 6572 6564       dfs_ordered
+0002ac70: 203d 205b 6466 5b67 6c6f 6261 6c5f 636f   = [df[global_co
+0002ac80: 6c73 5d2c 2064 665b 736c 6963 655f 636f  ls], df[slice_co
+0002ac90: 6c73 5d5d 0a20 2020 2020 2020 2020 2020  ls]].           
+0002aca0: 2069 6620 6e6f 7420 6e61 6d65 5f61 735f   if not name_as_
+0002acb0: 696e 6465 783a 0a20 2020 2020 2020 2020  index:.         
+0002acc0: 2020 2020 2020 2064 6673 5f6f 7264 6572         dfs_order
+0002acd0: 6564 2e69 6e73 6572 7428 302c 2064 665b  ed.insert(0, df[
+0002ace0: 2252 4f49 225d 290a 2020 2020 2020 2020  "ROI"]).        
+0002acf0: 2020 2020 6466 203d 2070 642e 636f 6e63      df = pd.conc
+0002ad00: 6174 2864 6673 5f6f 7264 6572 6564 2c20  at(dfs_ordered, 
+0002ad10: 6178 6973 3d31 290a 0a20 2020 2020 2020  axis=1)..       
+0002ad20: 2020 2020 2023 2053 6f72 7420 6865 6164       # Sort head
+0002ad30: 6572 7320 6279 2067 6c6f 6261 6c2f 736c  ers by global/sl
+0002ad40: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+0002ad50: 6865 6164 6572 7320 3d20 5b68 2066 6f72  headers = [h for
+0002ad60: 2068 2069 6e20 6865 6164 6572 7320 6966   h in headers if
+0002ad70: 2068 5b30 5d20 3d3d 2067 6c6f 6261 6c5f   h[0] == global_
+0002ad80: 6e61 6d65 5d20 5c0a 2020 2020 2020 2020  name] \.        
+0002ad90: 2020 2020 2020 2020 2020 2020 2b20 5b68              + [h
+0002ada0: 2066 6f72 2068 2069 6e20 6865 6164 6572   for h in header
+0002adb0: 7320 6966 2068 5b30 5d20 3d3d 2073 6c69  s if h[0] == sli
+0002adc0: 6365 5f6e 616d 655d 0a20 2020 2020 2020  ce_name].       
+0002add0: 2020 2020 2069 6620 6e6f 7420 6e61 6d65       if not name
+0002ade0: 5f61 735f 696e 6465 783a 0a20 2020 2020  _as_index:.     
+0002adf0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+0002ae00: 7273 2e69 6e73 6572 7428 302c 2028 2222  rs.insert(0, (""
+0002ae10: 2c20 2252 4f49 2229 290a 0a20 2020 2020  , "ROI"))..     
+0002ae20: 2020 2020 2020 2023 2041 6464 204d 756c         # Add Mul
+0002ae30: 7469 496e 6465 780a 2020 2020 2020 2020  tiIndex.        
+0002ae40: 2020 2020 6466 2e63 6f6c 756d 6e73 203d      df.columns =
+0002ae50: 2070 642e 4d75 6c74 6949 6e64 6578 2e66   pd.MultiIndex.f
+0002ae60: 726f 6d5f 7475 706c 6573 2868 6561 6465  rom_tuples(heade
+0002ae70: 7273 290a 0a20 2020 2020 2020 2072 6574  rs)..        ret
+0002ae80: 7572 6e20 6466 0a0a 2020 2020 6465 6620  urn df..    def 
+0002ae90: 6765 745f 636f 6d70 6172 6973 6f6e 5f6e  get_comparison_n
+0002aea0: 616d 6528 7365 6c66 2c20 726f 692c 2063  ame(self, roi, c
+0002aeb0: 616d 656c 6361 7365 3d46 616c 7365 2c20  amelcase=False, 
+0002aec0: 636f 6c6f 7265 643d 4661 6c73 652c 0a20  colored=False,. 
+0002aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aee0: 2020 2020 2020 2020 2020 2067 7265 793d             grey=
+0002aef0: 4661 6c73 652c 2072 6f69 5f6b 7761 7267  False, roi_kwarg
+0002af00: 733d 7b7d 293a 0a20 2020 2020 2020 2022  s={}):.        "
+0002af10: 2222 4765 7420 6e61 6d65 206f 6620 636f  ""Get name of co
+0002af20: 6d70 6172 6973 6f6e 2062 6574 7765 656e  mparison between
+0002af30: 2074 6869 7320 524f 4920 616e 6420 616e   this ROI and an
+0002af40: 6f74 6865 722e 2222 220a 0a20 2020 2020  other."""..     
+0002af50: 2020 206f 776e 5f6e 616d 6520 3d20 7365     own_name = se
+0002af60: 6c66 2e6e 616d 650a 2020 2020 2020 2020  lf.name.        
+0002af70: 6f74 6865 725f 6e61 6d65 203d 2072 6f69  other_name = roi
+0002af80: 2e6e 616d 650a 0a20 2020 2020 2020 2069  .name..        i
+0002af90: 6620 636f 6c6f 7265 643a 0a20 2020 2020  f colored:.     
+0002afa0: 2020 2020 2020 206f 776e 5f63 6f6c 6f72         own_color
+0002afb0: 203d 2073 656c 662e 6765 745f 636f 6c6f   = self.get_colo
+0002afc0: 725f 6672 6f6d 5f6b 7761 7267 7328 726f  r_from_kwargs(ro
+0002afd0: 695f 6b77 6172 6773 290a 2020 2020 2020  i_kwargs).      
+0002afe0: 2020 2020 2020 6f77 6e5f 6e61 6d65 203d        own_name =
+0002aff0: 2067 6574 5f63 6f6c 6f72 6564 5f72 6f69   get_colored_roi
+0002b000: 5f73 7472 696e 6728 7365 6c66 2c20 6772  _string(self, gr
+0002b010: 6579 2c20 6f77 6e5f 636f 6c6f 7229 0a20  ey, own_color). 
+0002b020: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0002b030: 5f63 6f6c 6f72 203d 2072 6f69 2e67 6574  _color = roi.get
+0002b040: 5f63 6f6c 6f72 5f66 726f 6d5f 6b77 6172  _color_from_kwar
+0002b050: 6773 2872 6f69 5f6b 7761 7267 7329 0a20  gs(roi_kwargs). 
+0002b060: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0002b070: 5f6e 616d 6520 3d20 6765 745f 636f 6c6f  _name = get_colo
+0002b080: 7265 645f 726f 695f 7374 7269 6e67 2872  red_roi_string(r
+0002b090: 6f69 2c20 6772 6579 2c20 6f74 6865 725f  oi, grey, other_
+0002b0a0: 636f 6c6f 7229 0a0a 2020 2020 2020 2020  color)..        
+0002b0b0: 6966 2073 656c 662e 6e61 6d65 203d 3d20  if self.name == 
+0002b0c0: 726f 692e 6e61 6d65 3a0a 2020 2020 2020  roi.name:.      
+0002b0d0: 2020 2020 2020 6966 2063 616d 656c 6361        if camelca
+0002b0e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002b0f0: 2020 2020 7265 7475 726e 206f 776e 5f6e      return own_n
+0002b100: 616d 652e 7265 706c 6163 6528 2220 222c  ame.replace(" ",
+0002b110: 2022 5f22 290a 2020 2020 2020 2020 2020   "_").          
+0002b120: 2020 7265 7475 726e 206f 776e 5f6e 616d    return own_nam
+0002b130: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+0002b140: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0002b150: 6f74 2063 6f6c 6f72 6564 3a0a 2020 2020  ot colored:.    
+0002b160: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0002b170: 616d 656c 6361 7365 3a0a 2020 2020 2020  amelcase:.      
+0002b180: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0002b190: 7475 726e 2066 227b 6f77 6e5f 6e61 6d65  turn f"{own_name
+0002b1a0: 7d5f 7673 5f7b 6f74 6865 725f 6e61 6d65  }_vs_{other_name
+0002b1b0: 7d22 2e72 6570 6c61 6365 2822 2022 2c20  }".replace(" ", 
+0002b1c0: 225f 2229 0a20 2020 2020 2020 2020 2020  "_").           
+0002b1d0: 2020 2020 2072 6574 7572 6e20 6622 7b6f       return f"{o
+0002b1e0: 776e 5f6e 616d 657d 2076 732e 207b 6f74  wn_name} vs. {ot
+0002b1f0: 6865 725f 6e61 6d65 7d22 0a20 2020 2020  her_name}".     
+0002b200: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
+0002b210: 7b6f 776e 5f6e 616d 657d 7b6f 7468 6572  {own_name}{other
+0002b220: 5f6e 616d 657d 220a 0a20 2020 2064 6566  _name}"..    def
+0002b230: 2073 6574 5f61 6c70 6861 5f6f 7665 725f   set_alpha_over_
+0002b240: 6265 7461 2873 656c 662c 2061 6c70 6861  beta(self, alpha
+0002b250: 5f6f 7665 725f 6265 7461 3d4e 6f6e 6529  _over_beta=None)
+0002b260: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0002b270: 2020 2020 2020 5365 7420 7261 7469 6f20        Set ratio 
+0002b280: 666f 7220 524f 4920 7469 7373 7565 206f  for ROI tissue o
+0002b290: 6620 636f 6566 6669 6369 656e 7473 206f  f coefficients o
+0002b2a0: 6620 6c69 6e65 6172 2d71 7561 6472 6174  f linear-quadrat
+0002b2b0: 6963 2065 7175 6174 696f 6e2e 0a0a 2020  ic equation...  
+0002b2c0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0002b2d0: 723a 2a2a 0a0a 2020 2020 2020 2020 616c  r:**..        al
+0002b2e0: 7068 615f 6f76 6572 5f62 6574 6120 3a20  pha_over_beta : 
+0002b2f0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+0002b300: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0002b310: 5261 7469 6f20 666f 7220 524f 4920 7469  Ratio for ROI ti
+0002b320: 7373 7565 206f 6620 636f 6566 6669 6369  ssue of coeffici
+0002b330: 656e 7473 2c20 616c 7068 612c 2062 6574  ents, alpha, bet
+0002b340: 612c 0a20 2020 2020 2020 2020 2020 206f  a,.            o
+0002b350: 6620 6c69 6e65 6172 2d71 7561 6472 6174  f linear-quadrat
+0002b360: 6963 2065 7175 6174 696f 6e2e 2020 5468  ic equation.  Th
+0002b370: 6973 2072 6174 696f 2069 7320 7573 6564  is ratio is used
+0002b380: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
+0002b390: 6361 6c63 756c 6174 696e 6720 6269 6f6c  calculating biol
+0002b3a0: 6f67 6963 616c 6c79 2065 6666 6563 7469  ogically effecti
+0002b3b0: 7665 2064 6f73 652c 2042 4544 2c20 6672  ve dose, BED, fr
+0002b3c0: 6f6d 0a20 2020 2020 2020 2020 2020 2070  om.            p
+0002b3d0: 6879 7369 6361 6c20 646f 7365 2c20 442c  hysical dose, D,
+0002b3e0: 2064 656c 6976 6572 6564 206f 7665 7220   delivered over 
+0002b3f0: 6e20 6571 7561 6c20 6672 6163 7469 6f6e  n equal fraction
+0002b400: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0002b410: 2020 2042 4544 203d 2044 202a 2028 3120     BED = D * (1 
+0002b420: 2b20 2844 2f6e 2920 2f20 2861 6c70 6861  + (D/n) / (alpha
+0002b430: 2f62 6574 6129 292e 0a20 2020 2020 2020  /beta))..       
+0002b440: 2020 2020 2049 6620 4e6f 6e65 2c20 7468       If None, th
+0002b450: 6520 6269 6f6c 6f67 6963 616c 6c79 2065  e biologically e
+0002b460: 6666 6563 7469 7665 2064 6f73 6520 6973  ffective dose is
+0002b470: 2074 616b 656e 2074 6f20 6265 0a20 2020   taken to be.   
+0002b480: 2020 2020 2020 2020 2065 7175 616c 2074           equal t
+0002b490: 6f20 7468 6520 7068 7973 6963 616c 2064  o the physical d
+0002b4a0: 6f73 6520 2862 6574 6120 3e3e 2061 6c70  ose (beta >> alp
+0002b4b0: 6861 292e 0a20 2020 2020 2020 2022 2222  ha)..        """
+0002b4c0: 0a20 2020 2020 2020 2073 656c 662e 616c  .        self.al
+0002b4d0: 7068 615f 6f76 6572 5f62 6574 6120 3d20  pha_over_beta = 
+0002b4e0: 616c 7068 615f 6f76 6572 5f62 6574 610a  alpha_over_beta.
+0002b4f0: 0a20 2020 2064 6566 2067 6574 5f61 6c70  .    def get_alp
+0002b500: 6861 5f6f 7665 725f 6265 7461 2873 656c  ha_over_beta(sel
+0002b510: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0002b520: 2020 2020 2020 2020 4765 7420 7261 7469          Get rati
+0002b530: 6f20 666f 7220 524f 4920 7469 7373 7565  o for ROI tissue
+0002b540: 206f 6620 636f 6566 6669 6369 656e 7473   of coefficients
+0002b550: 206f 6620 6c69 6e65 6172 2d71 7561 6472   of linear-quadr
+0002b560: 6174 6963 2065 7175 6174 696f 6e2e 0a20  atic equation.. 
+0002b570: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0002b580: 2020 2072 6574 7572 6e20 7365 6c66 2e61     return self.a
+0002b590: 6c70 6861 5f6f 7665 725f 6265 7461 0a0a  lpha_over_beta..
+0002b5a0: 2020 2020 6465 6620 7365 745f 636f 6c6f      def set_colo
+0002b5b0: 7228 7365 6c66 2c20 636f 6c6f 7229 3a0a  r(self, color):.
+0002b5c0: 2020 2020 2020 2020 2222 2253 6574 2070          """Set p
+0002b5d0: 6c6f 7474 696e 6720 636f 6c6f 722e 2222  lotting color.""
+0002b5e0: 220a 0a20 2020 2020 2020 2069 6620 636f  "..        if co
+0002b5f0: 6c6f 7220 6973 206e 6f74 204e 6f6e 6520  lor is not None 
+0002b600: 616e 6420 6e6f 7420 6d61 7470 6c6f 746c  and not matplotl
+0002b610: 6962 2e63 6f6c 6f72 732e 6973 5f63 6f6c  ib.colors.is_col
+0002b620: 6f72 5f6c 696b 6528 636f 6c6f 7229 3a0a  or_like(color):.
+0002b630: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0002b640: 7428 6622 5761 726e 696e 673a 207b 636f  t(f"Warning: {co
+0002b650: 6c6f 727d 206e 6f74 2061 2076 616c 6964  lor} not a valid
+0002b660: 2063 6f6c 6f72 2122 290a 2020 2020 2020   color!").      
+0002b670: 2020 2020 2020 636f 6c6f 7220 3d20 4e6f        color = No
+0002b680: 6e65 0a20 2020 2020 2020 2069 6620 636f  ne.        if co
+0002b690: 6c6f 7220 6973 204e 6f6e 653a 0a20 2020  lor is None:.   
+0002b6a0: 2020 2020 2020 2020 2063 6f6c 6f72 203d           color =
+0002b6b0: 2052 4f49 4465 6661 756c 7473 2829 2e67   ROIDefaults().g
+0002b6c0: 6574 5f64 6566 6175 6c74 5f72 6f69 5f63  et_default_roi_c
+0002b6d0: 6f6c 6f72 2829 0a20 2020 2020 2020 2073  olor().        s
+0002b6e0: 656c 662e 636f 6c6f 7220 3d20 6d61 7470  elf.color = matp
+0002b6f0: 6c6f 746c 6962 2e63 6f6c 6f72 732e 746f  lotlib.colors.to
+0002b700: 5f72 6762 6128 636f 6c6f 7229 0a0a 2020  _rgba(color)..  
+0002b710: 2020 6465 6620 706c 6f74 280a 2020 2020    def plot(.    
+0002b720: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0002b730: 2020 7669 6577 3d22 782d 7922 2c0a 2020    view="x-y",.  
+0002b740: 2020 2020 2020 706c 6f74 5f74 7970 653d        plot_type=
+0002b750: 4e6f 6e65 2c0a 2020 2020 2020 2020 736c  None,.        sl
+0002b760: 3d4e 6f6e 652c 0a20 2020 2020 2020 2069  =None,.        i
+0002b770: 6478 3d4e 6f6e 652c 0a20 2020 2020 2020  dx=None,.       
+0002b780: 2070 6f73 3d4e 6f6e 652c 0a20 2020 2020   pos=None,.     
+0002b790: 2020 2061 783d 4e6f 6e65 2c0a 2020 2020     ax=None,.    
+0002b7a0: 2020 2020 6773 3d4e 6f6e 652c 0a20 2020      gs=None,.   
+0002b7b0: 2020 2020 2066 6967 7369 7a65 3d73 6b72       figsize=skr
+0002b7c0: 742e 696d 6167 652e 5f64 6566 6175 6c74  t.image._default
+0002b7d0: 5f66 6967 7369 7a65 2c0a 2020 2020 2020  _figsize,.      
+0002b7e0: 2020 6f70 6163 6974 793d 4e6f 6e65 2c0a    opacity=None,.
+0002b7f0: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
+0002b800: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
+0002b810: 636f 6e74 6f75 725f 6b77 6172 6773 3d4e  contour_kwargs=N
+0002b820: 6f6e 652c 0a20 2020 2020 2020 206d 6173  one,.        mas
+0002b830: 6b5f 6b77 6172 6773 3d4e 6f6e 652c 0a20  k_kwargs=None,. 
+0002b840: 2020 2020 2020 207a 6f6f 6d3d 4e6f 6e65         zoom=None
+0002b850: 2c0a 2020 2020 2020 2020 7a6f 6f6d 5f63  ,.        zoom_c
+0002b860: 656e 7472 653d 4e6f 6e65 2c0a 2020 2020  entre=None,.    
+0002b870: 2020 2020 636f 6c6f 723d 4e6f 6e65 2c0a      color=None,.
+0002b880: 2020 2020 2020 2020 7368 6f77 3d54 7275          show=Tru
+0002b890: 652c 0a20 2020 2020 2020 2073 6176 655f  e,.        save_
+0002b8a0: 6173 3d4e 6f6e 652c 0a20 2020 2020 2020  as=None,.       
+0002b8b0: 2069 6e63 6c75 6465 5f69 6d61 6765 3d46   include_image=F
+0002b8c0: 616c 7365 2c0a 2020 2020 2020 2020 6e6f  alse,.        no
+0002b8d0: 5f69 6e76 6572 743d 4661 6c73 652c 0a20  _invert=False,. 
+0002b8e0: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
+0002b8f0: 653d 5b31 2c20 315d 2c0a 2020 2020 2020  e=[1, 1],.      
+0002b900: 2020 6275 6666 6572 3d35 2c0a 2020 2020    buffer=5,.    
+0002b910: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+0002b920: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0002b930: 506c 6f74 2074 6869 7320 524f 4920 6173  Plot this ROI as
+0002b940: 2065 6974 6865 7220 6120 6d61 736b 206f   either a mask o
+0002b950: 7220 6120 636f 6e74 6f75 722e 0a0a 2020  r a contour...  
+0002b960: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0002b970: 7273 3a2a 2a0a 0a20 2020 2020 2020 2076  rs:**..        v
+0002b980: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
+0002b990: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
+0002b9a0: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
+0002b9b0: 2069 6e20 7768 6963 6820 746f 2070 6c6f   in which to plo
+0002b9c0: 742e 2043 616e 2062 6520 2278 2d79 222c  t. Can be "x-y",
+0002b9d0: 2022 782d 7a22 2c20 2279 2d78 222c 2022   "x-z", "y-x", "
+0002b9e0: 792d 7a22 2c0a 2020 2020 2020 2020 2020  y-z",.          
+0002b9f0: 2020 227a 2d78 222c 206f 7220 227a 2d79    "z-x", or "z-y
+0002ba00: 222e 0a0a 2020 2020 2020 2020 706c 6f74  "...        plot
+0002ba10: 5f74 7970 6520 3a20 7374 722c 2064 6566  _type : str, def
+0002ba20: 6175 6c74 3d22 636f 6e74 6f75 7222 0a20  ault="contour". 
+0002ba30: 2020 2020 2020 2020 2020 2050 6c6f 7474             Plott
+0002ba40: 696e 6720 7479 7065 2e20 4966 204e 6f6e  ing type. If Non
+0002ba50: 652c 2077 696c 6c20 6265 2065 6974 6865  e, will be eithe
+0002ba60: 7220 2263 6f6e 746f 7572 2220 6f72 2022  r "contour" or "
+0002ba70: 6d61 736b 2220 0a20 2020 2020 2020 2020  mask" .         
+0002ba80: 2020 2064 6570 656e 6469 6e67 206f 6e20     depending on 
+0002ba90: 7468 6520 696e 7075 7420 7479 7065 206f  the input type o
+0002baa0: 6620 7468 6520 524f 492e 204f 7074 696f  f the ROI. Optio
+0002bab0: 6e73 3a0a 0a20 2020 2020 2020 2020 2020  ns:..           
+0002bac0: 2020 2020 202d 2022 636f 6e74 6f75 7222       - "contour"
+0002bad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bae0: 202d 2022 6d61 736b 220a 2020 2020 2020   - "mask".      
+0002baf0: 2020 2020 2020 2020 2020 2d20 2263 656e            - "cen
+0002bb00: 7472 6f69 6422 2028 636f 6e74 6f75 7220  troid" (contour 
+0002bb10: 7769 7468 206d 6172 6b65 7220 6174 2063  with marker at c
+0002bb20: 656e 7472 6f69 6429 0a20 2020 2020 2020  entroid).       
+0002bb30: 2020 2020 2020 2020 202d 2022 6669 6c6c           - "fill
+0002bb40: 6564 2220 2874 7261 6e73 7061 7265 6e74  ed" (transparent
+0002bb50: 206d 6173 6b20 2b20 636f 6e74 6f75 7229   mask + contour)
+0002bb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bb70: 202d 2022 6669 6c6c 6564 2063 656e 7472   - "filled centr
+0002bb80: 6f69 6422 2028 6669 6c6c 6564 2077 6974  oid" (filled wit
+0002bb90: 6820 6d61 726b 6572 2061 7420 6365 6e74  h marker at cent
+0002bba0: 726f 6964 290a 0a20 2020 2020 2020 2073  roid)..        s
+0002bbb0: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
+0002bbc0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0002bbd0: 2020 536c 6963 6520 6e75 6d62 6572 2074    Slice number t
+0002bbe0: 6f20 706c 6f74 2e20 4966 206e 6f6e 6520  o plot. If none 
+0002bbf0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0002bc00: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0002bc10: 6c69 6564 2c20 0a20 2020 2020 2020 2020  lied, .         
+0002bc20: 2020 2074 6865 2063 656e 7472 616c 2073     the central s
+0002bc30: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
+0002bc40: 7769 6c6c 2062 6520 0a20 2020 2020 2020  will be .       
+0002bc50: 2020 2020 2075 7365 642e 0a0a 2020 2020       used...    
+0002bc60: 2020 2020 6964 7820 3a20 696e 742c 2064      idx : int, d
+0002bc70: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0002bc80: 2020 2020 2020 2020 4172 7261 7920 696e          Array in
+0002bc90: 6465 7820 6f66 2073 6c69 6365 2074 6f20  dex of slice to 
+0002bca0: 706c 6f74 2e20 4966 206e 6f6e 6520 6f66  plot. If none of
+0002bcb0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+0002bcc0: 3c70 6f73 3e20 6172 6520 0a20 2020 2020  <pos> are .     
+0002bcd0: 2020 2020 2020 2073 7570 706c 6965 642c         supplied,
+0002bce0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+0002bcf0: 6365 206f 6620 7468 6520 524f 4920 7769  ce of the ROI wi
+0002bd00: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
+0002bd10: 2020 2020 2070 6f73 203a 2066 6c6f 6174       pos : float
+0002bd20: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0002bd30: 2020 2020 2020 2020 2020 2050 6f73 6974             Posit
+0002bd40: 696f 6e20 696e 206d 6d20 6f66 2073 6c69  ion in mm of sli
+0002bd50: 6365 2074 6f20 706c 6f74 2e20 4966 206e  ce to plot. If n
+0002bd60: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+0002bd70: 783e 206f 7220 3c70 6f73 3e20 0a20 2020  x> or <pos> .   
+0002bd80: 2020 2020 2020 2020 2061 7265 2073 7570           are sup
+0002bd90: 706c 6965 642c 2074 6865 2063 656e 7472  plied, the centr
+0002bda0: 616c 2073 6c69 6365 206f 6620 7468 6520  al slice of the 
+0002bdb0: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
+0002bdc0: 2e0a 0a20 2020 2020 2020 2061 7820 3a20  ...        ax : 
+0002bdd0: 6d61 7470 6c6f 746c 6962 2e70 7970 6c6f  matplotlib.pyplo
+0002bde0: 742e 4178 6573 2c20 6465 6661 756c 743d  t.Axes, default=
+0002bdf0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0002be00: 2041 7865 7320 6f6e 2077 6869 6368 2074   Axes on which t
+0002be10: 6f20 706c 6f74 2e20 4966 204e 6f6e 652c  o plot. If None,
+0002be20: 206e 6577 2061 7865 7320 7769 6c6c 2062   new axes will b
+0002be30: 6520 6372 6561 7465 642e 0a0a 2020 2020  e created...    
+0002be40: 2020 2020 6773 203a 206d 6174 706c 6f74      gs : matplot
+0002be50: 6c69 622e 6772 6964 7370 6563 2e47 7269  lib.gridspec.Gri
+0002be60: 6453 7065 632c 2064 6566 6175 6c74 3d4e  dSpec, default=N
+0002be70: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0002be80: 4966 206e 6f74 204e 6f6e 6520 616e 6420  If not None and 
+0002be90: 3c61 783e 2069 7320 4e6f 6e65 2c20 6e65  <ax> is None, ne
+0002bea0: 7720 6178 6573 2077 696c 6c20 6265 2063  w axes will be c
+0002beb0: 7265 6174 6564 206f 6e20 7468 650a 2020  reated on the.  
+0002bec0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+0002bed0: 7420 6d61 7470 6c6f 746c 6962 2066 6967  t matplotlib fig
+0002bee0: 7572 6520 7769 7468 2074 6869 7320 6772  ure with this gr
+0002bef0: 6964 7370 6563 2e0a 0a20 2020 2020 2020  idspec...       
+0002bf00: 2066 6967 7369 7a65 203a 2066 6c6f 6174   figsize : float
+0002bf10: 2c20 6465 6661 756c 743d 736b 7274 2e69  , default=skrt.i
+0002bf20: 6d61 6765 2e5f 6465 6661 756c 745f 6669  mage._default_fi
+0002bf30: 6773 697a 650a 2020 2020 2020 2020 2020  gsize.          
+0002bf40: 2020 4669 6775 7265 2068 6569 6768 7420    Figure height 
+0002bf50: 696e 2069 6e63 6865 733b 206f 6e6c 7920  in inches; only 
+0002bf60: 7573 6564 2069 6620 3c61 783e 2061 6e64  used if <ax> and
+0002bf70: 203c 6773 3e20 6172 6520 4e6f 6e65 2e0a   <gs> are None..
+0002bf80: 0a20 2020 2020 2020 206f 7061 6369 7479  .        opacity
+0002bf90: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+0002bfa0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0002bfb0: 2020 204f 7061 6369 7479 2074 6f20 7573     Opacity to us
+0002bfc0: 6520 6966 2070 6c6f 7474 696e 6720 6d61  e if plotting ma
+0002bfd0: 736b 2028 692e 652e 2070 6c6f 7420 7479  sk (i.e. plot ty
+0002bfe0: 7065 7320 226d 6173 6b22 2c20 2266 696c  pes "mask", "fil
+0002bff0: 6c65 6422 2c20 0a20 2020 2020 2020 2020  led", .         
+0002c000: 2020 206f 7220 2266 696c 6c65 6420 6365     or "filled ce
+0002c010: 6e74 726f 6964 2229 2e20 4966 204e 6f6e  ntroid"). If Non
+0002c020: 652c 206f 7061 6369 7479 2077 696c 6c20  e, opacity will 
+0002c030: 6265 2031 2062 7920 6465 6661 756c 7420  be 1 by default 
+0002c040: 666f 7220 0a20 2020 2020 2020 2020 2020  for .           
+0002c050: 2073 6f6c 6964 206d 6173 6b20 706c 6f74   solid mask plot
+0002c060: 7320 616e 6420 302e 3320 6279 2064 6566  s and 0.3 by def
+0002c070: 6175 6c74 2066 6f72 2066 696c 6c65 6420  ault for filled 
+0002c080: 706c 6f74 732e 0a0a 2020 2020 2020 2020  plots...        
+0002c090: 6c69 6e65 7769 6474 6820 3a20 666c 6f61  linewidth : floa
+0002c0a0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+0002c0b0: 2020 2020 2020 2020 2020 2020 5769 6474              Widt
+0002c0c0: 6820 6f66 2063 6f6e 746f 7572 206c 696e  h of contour lin
+0002c0d0: 6573 2e20 4966 204e 6f6e 652c 2074 6865  es. If None, the
+0002c0e0: 206d 6174 706c 6f74 6c69 6220 6465 6661   matplotlib defa
+0002c0f0: 756c 7420 7365 7474 696e 6720 0a20 2020  ult setting .   
+0002c100: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
+0002c110: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+0002c120: 636f 6e74 6f75 725f 6b77 6172 6773 203a  contour_kwargs :
+0002c130: 2064 6963 742c 2064 6566 6175 6c74 3d4e   dict, default=N
+0002c140: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0002c150: 4578 7472 6120 6b65 7977 6f72 6420 6172  Extra keyword ar
+0002c160: 6775 6d65 6e74 7320 746f 2070 6173 7320  guments to pass 
+0002c170: 746f 206d 6174 706c 6f74 6c69 6220 636f  to matplotlib co
+0002c180: 6e74 6f75 7220 706c 6f74 7469 6e67 2e0a  ntour plotting..
+0002c190: 0a20 2020 2020 2020 206d 6173 6b5f 6b77  .        mask_kw
+0002c1a0: 6172 6773 203a 2064 6963 742c 2064 6566  args : dict, def
+0002c1b0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0002c1c0: 2020 2020 2020 4578 7472 6120 6b65 7977        Extra keyw
+0002c1d0: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
+0002c1e0: 2070 6173 7320 746f 206d 6174 706c 6f74   pass to matplot
+0002c1f0: 6c69 6220 6d61 736b 2070 6c6f 7474 696e  lib mask plottin
+0002c200: 672e 0a0a 2020 2020 2020 2020 7a6f 6f6d  g...        zoom
+0002c210: 203a 2069 6e74 2f66 6c6f 6174 2f74 7570   : int/float/tup
+0002c220: 6c65 2c20 6465 6661 756c 743d 4e6f 6e65  le, default=None
+0002c230: 0a20 2020 2020 2020 2020 2020 2046 6163  .            Fac
+0002c240: 746f 7220 6279 2077 6869 6368 2074 6f20  tor by which to 
+0002c250: 7a6f 6f6d 2069 6e2e 2049 6620 6120 7369  zoom in. If a si
+0002c260: 6e67 6c65 2069 6e74 206f 7220 666c 6f61  ngle int or floa
+0002c270: 7420 6973 2067 6976 656e 2c0a 2020 2020  t is given,.    
+0002c280: 2020 2020 2020 2020 7468 6520 7361 6d65          the same
+0002c290: 207a 6f6f 6d20 6661 6374 6f72 2077 696c   zoom factor wil
+0002c2a0: 6c20 6265 2061 7070 6c69 6564 2069 6e20  l be applied in 
+0002c2b0: 616c 6c20 6469 7265 6374 696f 6e73 2e20  all directions. 
+0002c2c0: 4966 2061 2074 7570 6c65 0a20 2020 2020  If a tuple.     
+0002c2d0: 2020 2020 2020 206f 6620 7468 7265 6520         of three 
+0002c2e0: 7661 6c75 6573 2069 7320 6769 7665 6e2c  values is given,
+0002c2f0: 2074 6865 7365 2077 696c 6c20 6265 2075   these will be u
+0002c300: 7365 6420 6173 2074 6865 207a 6f6f 6d20  sed as the zoom 
+0002c310: 6661 6374 6f72 730a 2020 2020 2020 2020  factors.        
+0002c320: 2020 2020 696e 2065 6163 6820 6469 7265      in each dire
+0002c330: 6374 696f 6e20 696e 2074 6865 206f 7264  ction in the ord
+0002c340: 6572 2028 782c 2079 2c20 7a29 2e20 4966  er (x, y, z). If
+0002c350: 204e 6f6e 652c 2074 6865 2069 6d61 6765   None, the image
+0002c360: 2077 696c 6c0a 2020 2020 2020 2020 2020   will.          
+0002c370: 2020 6e6f 7420 6265 207a 6f6f 6d65 6420    not be zoomed 
+0002c380: 696e 2e0a 0a20 2020 2020 2020 207a 6f6f  in...        zoo
+0002c390: 6d5f 6365 6e74 7265 203a 2074 7570 6c65  m_centre : tuple
+0002c3a0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0002c3b0: 2020 2020 2020 2020 2020 2050 6f73 6974             Posit
+0002c3c0: 696f 6e20 6172 6f75 6e64 2077 6869 6368  ion around which
+0002c3d0: 207a 6f6f 6d69 6e67 2069 7320 6170 706c   zooming is appl
+0002c3e0: 6965 642e 2049 6620 4e6f 6e65 2c20 7468  ied. If None, th
+0002c3f0: 6520 6365 6e74 7265 206f 660a 2020 2020  e centre of.    
+0002c400: 2020 2020 2020 2020 7468 6520 696d 6167          the imag
+0002c410: 6520 7769 6c6c 2062 6520 7573 6564 2e0a  e will be used..
+0002c420: 0a20 2020 2020 2020 2063 6f6c 6f72 203a  .        color :
+0002c430: 206d 6174 706c 6f74 6c69 6220 636f 6c6f   matplotlib colo
+0002c440: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0002c450: 2020 2020 2020 2020 2020 2020 436f 6c6f              Colo
+0002c460: 7220 7769 7468 2077 6869 6368 2074 6f20  r with which to 
+0002c470: 706c 6f74 2074 6865 2052 4f49 3b20 6f76  plot the ROI; ov
+0002c480: 6572 7269 6465 7320 7468 6520 524f 4927  errides the ROI'
+0002c490: 7320 6f77 6e20 636f 6c6f 722e 2049 6620  s own color. If 
+0002c4a0: 0a20 2020 2020 2020 2020 2020 204e 6f6e  .            Non
+0002c4b0: 652c 2073 656c 662e 636f 6c6f 7220 7769  e, self.color wi
+0002c4c0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
+0002c4d0: 2020 2020 2073 686f 7720 3a20 626f 6f6c       show : bool
+0002c4e0: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
+0002c4f0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+0002c500: 7565 2c20 7468 6520 706c 6f74 2077 696c  ue, the plot wil
+0002c510: 6c20 6265 2064 6973 706c 6179 6564 2069  l be displayed i
+0002c520: 6d6d 6564 6961 7465 6c79 2e0a 0a20 2020  mmediately...   
+0002c530: 2020 2020 2073 6176 655f 6173 203a 2073       save_as : s
+0002c540: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
+0002c550: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002c560: 7365 7420 746f 2061 2073 7472 696e 672c  set to a string,
+0002c570: 2074 6865 2070 6c6f 7420 7769 6c6c 2062   the plot will b
+0002c580: 6520 7361 7665 6420 746f 2074 6865 2066  e saved to the f
+0002c590: 696c 656e 616d 6520 696e 2074 6865 200a  ilename in the .
+0002c5a0: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+0002c5b0: 6e67 2e0a 0a20 2020 2020 2020 2069 6e63  ng...        inc
+0002c5c0: 6c75 6465 5f69 6d61 6765 203a 2062 6f6f  lude_image : boo
+0002c5d0: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
+0002c5e0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002c5f0: 5472 7565 2061 6e64 2073 656c 662e 696d  True and self.im
+0002c600: 6167 6520 6973 206e 6f74 204e 6f6e 652c  age is not None,
+0002c610: 2074 6865 2052 4f49 2773 2069 6d61 6765   the ROI's image
+0002c620: 2077 696c 6c20 6265 2070 6c6f 7474 6564   will be plotted
+0002c630: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+0002c640: 7468 6520 6261 636b 6772 6f75 6e64 2e0a  the background..
+0002c650: 0a20 2020 2020 2020 206e 6f5f 696e 7665  .        no_inve
+0002c660: 7274 203a 2062 6f6f 6c2c 2064 6566 6175  rt : bool, defau
+0002c670: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+0002c680: 2020 2020 2049 6620 4661 6c73 652c 2063       If False, c
+0002c690: 6f6e 746f 7572 2070 6c6f 7473 2077 696c  ontour plots wil
+0002c6a0: 6c20 6265 2061 7574 6f6d 6174 6963 616c  l be automatical
+0002c6b0: 6c79 2069 6e76 6572 7465 6420 7768 656e  ly inverted when
+0002c6c0: 2070 6c6f 7474 696e 670a 2020 2020 2020   plotting.      
+0002c6d0: 2020 2020 2020 7769 7468 6f75 7420 616e        without an
+0002c6e0: 2075 6e64 6572 6c79 696e 6720 696d 6167   underlying imag
+0002c6f0: 6520 746f 2061 6363 6f75 6e74 2066 6f72  e to account for
+0002c700: 2074 6865 2079 2061 7869 7320 696e 6372   the y axis incr
+0002c710: 6561 7369 6e67 200a 2020 2020 2020 2020  easing .        
+0002c720: 2020 2020 696e 2074 6865 206f 7070 6f73      in the oppos
+0002c730: 6974 6520 6469 7265 6374 696f 6e2e 204f  ite direction. O
+0002c740: 7468 6572 7769 7365 2c20 7468 6520 706c  therwise, the pl
+0002c750: 6f74 2077 696c 6c20 6265 206c 6566 7420  ot will be left 
+0002c760: 6173 0a20 2020 2020 2020 2020 2020 2069  as.            i
+0002c770: 7420 6170 7065 6172 6564 2077 6865 6e20  t appeared when 
+0002c780: 6472 6177 6e20 6279 206d 6174 706c 6f74  drawn by matplot
+0002c790: 6c69 622e 0a0a 2020 2020 2020 2020 766f  lib...        vo
+0002c7a0: 7865 6c5f 7369 7a65 203a 206c 6973 742c  xel_size : list,
+0002c7b0: 2064 6566 6175 6c74 3d5b 312c 2031 5d0a   default=[1, 1].
+0002c7c0: 2020 2020 2020 2020 2020 2020 4966 2074              If t
+0002c7d0: 6865 2052 4f49 2064 6f65 7320 6e6f 7420  he ROI does not 
+0002c7e0: 6861 7665 2061 6e20 6173 736f 6369 6174  have an associat
+0002c7f0: 6564 2069 6d61 6765 2061 6e64 2069 7320  ed image and is 
+0002c800: 6465 7363 7269 6265 6420 6f6e 6c79 0a20  described only. 
+0002c810: 2020 2020 2020 2020 2020 2062 7920 636f             by co
+0002c820: 6e74 6f75 7273 2c20 7468 6973 2077 696c  ntours, this wil
+0002c830: 6c20 6265 2074 6865 2076 6f78 656c 2073  l be the voxel s
+0002c840: 697a 6573 2075 7365 6420 696e 2074 6865  izes used in the
+0002c850: 2078 2d79 2064 6972 6563 7469 6f6e 0a20   x-y direction. 
+0002c860: 2020 2020 2020 2020 2020 2077 6865 6e20             when 
+0002c870: 636f 6e76 6572 7469 6e67 2074 6865 2052  converting the R
+0002c880: 4f49 2074 6f20 6120 6d61 736b 2069 6620  OI to a mask if 
+0002c890: 6120 6d61 736b 2070 6c6f 7420 7479 7065  a mask plot type
+0002c8a0: 2069 7320 7365 6c65 6374 6564 2e0a 0a20   is selected... 
+0002c8b0: 2020 2020 2020 2062 7566 6665 7220 3a20         buffer : 
+0002c8c0: 696e 742c 2064 6566 6175 6c74 3d35 0a20  int, default=5. 
+0002c8d0: 2020 2020 2020 2020 2020 2049 6620 7468             If th
+0002c8e0: 6520 524f 4920 646f 6573 206e 6f74 2068  e ROI does not h
+0002c8f0: 6176 6520 616e 2061 7373 6f63 6961 7465  ave an associate
+0002c900: 6420 696d 6167 6520 616e 6420 6973 2064  d image and is d
+0002c910: 6573 6372 6962 6564 206f 6e6c 790a 2020  escribed only.  
+0002c920: 2020 2020 2020 2020 2020 6279 2063 6f6e            by con
+0002c930: 746f 7572 732c 2074 6869 7320 7769 6c6c  tours, this will
+0002c940: 2062 6520 7468 6520 6e75 6d62 6572 206f   be the number o
+0002c950: 6620 6275 6666 6572 2076 6f78 656c 7320  f buffer voxels 
+0002c960: 0a20 2020 2020 2020 2020 2020 2028 692e  .            (i.
+0002c970: 652e 2077 6869 7465 7370 6163 6529 2064  e. whitespace) d
+0002c980: 6973 706c 6179 6564 2061 726f 756e 6420  isplayed around 
+0002c990: 7468 6520 524f 492e 0a0a 2020 2020 2020  the ROI...      
+0002c9a0: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
+0002c9b0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
+0002c9c0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0002c9d0: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
+0002c9e0: 6520 7265 6c65 7661 6e74 2070 6c6f 7420  e relevant plot 
+0002c9f0: 6675 6e63 7469 6f6e 2e0a 2020 2020 2020  function..      
+0002ca00: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+0002ca10: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
+0002ca20: 2020 6966 2073 656c 662e 656d 7074 793a    if self.empty:
+0002ca30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002ca40: 7572 6e0a 0a20 2020 2020 2020 2069 6d61  urn..        ima
+0002ca50: 6765 5f72 6561 6479 203d 206b 7761 7267  ge_ready = kwarg
+0002ca60: 732e 706f 7028 2269 6d61 6765 5f72 6561  s.pop("image_rea
+0002ca70: 6479 222c 2046 616c 7365 290a 2020 2020  dy", False).    
+0002ca80: 2020 2020 6966 2069 6d61 6765 5f72 6561      if image_rea
+0002ca90: 6479 206f 7220 2869 6e63 6c75 6465 5f69  dy or (include_i
+0002caa0: 6d61 6765 2061 6e64 2073 656c 662e 696d  mage and self.im
+0002cab0: 6167 6529 3a0a 2020 2020 2020 2020 2020  age):.          
+0002cac0: 2020 726f 6920 3d20 7365 6c66 0a20 2020    roi = self.   
+0002cad0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002cae0: 2020 2020 2020 2072 6f69 203d 2073 656c         roi = sel
+0002caf0: 662e 636c 6f6e 6528 636f 7079 5f64 6174  f.clone(copy_dat
+0002cb00: 613d 4661 6c73 6529 0a20 2020 2020 2020  a=False).       
+0002cb10: 2020 2020 2069 6d20 3d20 726f 692e 6765       im = roi.ge
+0002cb20: 745f 6475 6d6d 795f 696d 6167 6528 0a20  t_dummy_image(. 
+0002cb30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0002cb40: 6f78 656c 5f73 697a 653d 766f 7865 6c5f  oxel_size=voxel_
+0002cb50: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+0002cb60: 2020 2020 2020 6275 6666 6572 3d62 7566        buffer=buf
+0002cb70: 6665 720a 2020 2020 2020 2020 2020 2020  fer.            
+0002cb80: 290a 2020 2020 2020 2020 2020 2020 696d  ).            im
+0002cb90: 2e74 6974 6c65 203d 2072 6f69 2e6e 616d  .title = roi.nam
+0002cba0: 650a 2020 2020 2020 2020 2020 2020 726f  e.            ro
+0002cbb0: 692e 7365 745f 696d 6167 6528 696d 290a  i.set_image(im).
+0002cbc0: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
+0002cbd0: 7265 7365 745f 636f 6e74 6f75 7273 2829  reset_contours()
+0002cbe0: 0a20 2020 2020 2020 2072 6f69 2e63 7265  .        roi.cre
+0002cbf0: 6174 655f 6d61 736b 2829 0a0a 2020 2020  ate_mask()..    
+0002cc00: 2020 2020 6966 2070 6c6f 745f 7479 7065      if plot_type
+0002cc10: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0002cc20: 2020 2020 2020 706c 6f74 5f74 7970 6520        plot_type 
+0002cc30: 3d20 6b77 6172 6773 2e67 6574 2822 726f  = kwargs.get("ro
+0002cc40: 695f 706c 6f74 5f74 7970 6522 2c20 726f  i_plot_type", ro
+0002cc50: 692e 6465 6661 756c 745f 6765 6f6d 5f6d  i.default_geom_m
+0002cc60: 6574 686f 6429 0a0a 2020 2020 2020 2020  ethod)..        
+0002cc70: 6966 2073 6c20 6973 204e 6f6e 6520 616e  if sl is None an
+0002cc80: 6420 6964 7820 6973 204e 6f6e 6520 616e  d idx is None an
+0002cc90: 6420 706f 7320 6973 204e 6f6e 653a 0a20  d pos is None:. 
+0002cca0: 2020 2020 2020 2020 2020 2069 6478 203d             idx =
+0002ccb0: 2072 6f69 2e67 6574 5f6d 6964 5f69 6478   roi.get_mid_idx
+0002ccc0: 2876 6965 7729 0a20 2020 2020 2020 2065  (view).        e
+0002ccd0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002cce0: 2069 6478 203d 2072 6f69 2e67 6574 5f69   idx = roi.get_i
+0002ccf0: 6478 2876 6965 772c 2073 6c2c 2069 6478  dx(view, sl, idx
+0002cd00: 2c20 706f 7329 0a0a 2020 2020 2020 2020  , pos)..        
+0002cd10: 7368 6f77 5f63 656e 7472 6f69 6420 3d20  show_centroid = 
+0002cd20: 2263 656e 7472 6f69 6422 2069 6e20 706c  "centroid" in pl
+0002cd30: 6f74 5f74 7970 650a 2020 2020 2020 2020  ot_type.        
+0002cd40: 6966 207a 6f6f 6d20 616e 6420 7a6f 6f6d  if zoom and zoom
+0002cd50: 5f63 656e 7472 6520 6973 204e 6f6e 653a  _centre is None:
+0002cd60: 0a20 2020 2020 2020 2020 2020 207a 6f6f  .            zoo
+0002cd70: 6d5f 6365 6e74 7265 203d 2072 6f69 2e67  m_centre = roi.g
+0002cd80: 6574 5f7a 6f6f 6d5f 6365 6e74 7265 2876  et_zoom_centre(v
+0002cd90: 6965 7729 0a20 2020 2020 2020 2069 6620  iew).        if 
+0002cda0: 636f 6c6f 7220 6973 204e 6f6e 653a 0a20  color is None:. 
+0002cdb0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+0002cdc0: 203d 2072 6f69 2e63 6f6c 6f72 0a20 2020   = roi.color.   
+0002cdd0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002cde0: 2020 2020 2020 2063 6f6c 6f72 203d 206d         color = m
+0002cdf0: 6174 706c 6f74 6c69 622e 636f 6c6f 7273  atplotlib.colors
+0002ce00: 2e74 6f5f 7267 6261 2863 6f6c 6f72 290a  .to_rgba(color).
+0002ce10: 0a20 2020 2020 2020 2069 6620 6f70 6163  .        if opac
+0002ce20: 6974 7920 6973 204e 6f6e 653a 0a20 2020  ity is None:.   
+0002ce30: 2020 2020 2020 2020 206f 7061 6369 7479           opacity
+0002ce40: 203d 206b 7761 7267 732e 6765 7428 0a20   = kwargs.get(. 
+0002ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce60: 2020 2022 726f 695f 6f70 6163 6974 7922     "roi_opacity"
+0002ce70: 2c20 302e 3320 6966 2022 6669 6c6c 6564  , 0.3 if "filled
+0002ce80: 2220 696e 2070 6c6f 745f 7479 7065 2065  " in plot_type e
+0002ce90: 6c73 6520 3129 0a0a 2020 2020 2020 2020  lse 1)..        
+0002cea0: 2320 5365 7420 7570 2061 7865 730a 2020  # Set up axes.  
+0002ceb0: 2020 2020 2020 726f 692e 7365 745f 6178        roi.set_ax
+0002cec0: 2870 6c6f 745f 7479 7065 2c20 696e 636c  (plot_type, incl
+0002ced0: 7564 655f 696d 6167 652c 2076 6965 772c  ude_image, view,
+0002cee0: 2061 782c 2067 732c 2066 6967 7369 7a65   ax, gs, figsize
+0002cef0: 290a 0a20 2020 2020 2020 2023 2041 646a  )..        # Adj
+0002cf00: 7573 7420 6365 6e74 726f 6964 206d 6172  ust centroid mar
+0002cf10: 6b65 7220 7369 7a65 0a20 2020 2020 2020  ker size.       
+0002cf20: 2069 6620 636f 6e74 6f75 725f 6b77 6172   if contour_kwar
+0002cf30: 6773 2069 7320 4e6f 6e65 3a0a 2020 2020  gs is None:.    
+0002cf40: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
+0002cf50: 6b77 6172 6773 203d 207b 7d0a 2020 2020  kwargs = {}.    
+0002cf60: 2020 2020 6966 2022 6365 6e74 726f 6964      if "centroid
+0002cf70: 2220 696e 2070 6c6f 745f 7479 7065 206f  " in plot_type o
+0002cf80: 7220 2263 6f6e 746f 7572 2220 3d3d 2070  r "contour" == p
+0002cf90: 6c6f 745f 7479 7065 3a0a 2020 2020 2020  lot_type:.      
+0002cfa0: 2020 2020 2020 6966 206c 696e 6577 6964        if linewid
+0002cfb0: 7468 2069 7320 4e6f 6e65 3a0a 2020 2020  th is None:.    
+0002cfc0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0002cfd0: 7769 6474 6820 3d20 6b77 6172 6773 2e67  width = kwargs.g
+0002cfe0: 6574 2822 726f 695f 6c69 6e65 7769 6474  et("roi_linewidt
+0002cff0: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
+0002d000: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+0002d010: 756c 7450 6172 616d 735b 226c 696e 6573  ultParams["lines
+0002d020: 2e6c 696e 6577 6964 7468 225d 5b30 5d29  .linewidth"][0])
+0002d030: 0a20 2020 2020 2020 2069 6620 2263 656e  .        if "cen
+0002d040: 7472 6f69 6422 2069 6e20 706c 6f74 5f74  troid" in plot_t
+0002d050: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
+0002d060: 2063 6f6e 746f 7572 5f6b 7761 7267 732e   contour_kwargs.
+0002d070: 7365 7464 6566 6175 6c74 2822 6d61 726b  setdefault("mark
+0002d080: 6572 7369 7a65 222c 2037 202a 206e 702e  ersize", 7 * np.
+0002d090: 7371 7274 286c 696e 6577 6964 7468 2929  sqrt(linewidth))
+0002d0a0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0002d0b0: 746f 7572 5f6b 7761 7267 732e 7365 7464  tour_kwargs.setd
+0002d0c0: 6566 6175 6c74 2822 6d61 726b 6572 6564  efault("markered
+0002d0d0: 6765 7769 6474 6822 2c20 6e70 2e73 7172  gewidth", np.sqr
+0002d0e0: 7428 6c69 6e65 7769 6474 6829 290a 0a20  t(linewidth)).. 
+0002d0f0: 2020 2020 2020 2023 2050 6c6f 7420 6120         # Plot a 
+0002d100: 6d61 736b 0a20 2020 2020 2020 2069 6620  mask.        if 
+0002d110: 706c 6f74 5f74 7970 6520 3d3d 2022 6d61  plot_type == "ma
+0002d120: 736b 223a 0a20 2020 2020 2020 2020 2020  sk":.           
+0002d130: 2072 6f69 2e5f 706c 6f74 5f6d 6173 6b28   roi._plot_mask(
+0002d140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d150: 2076 6965 772c 0a20 2020 2020 2020 2020   view,.         
+0002d160: 2020 2020 2020 2069 6478 2c0a 2020 2020         idx,.    
+0002d170: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+0002d180: 5f6b 7761 7267 732c 0a20 2020 2020 2020  _kwargs,.       
+0002d190: 2020 2020 2020 2020 206f 7061 6369 7479           opacity
 0002d1a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002d1b0: 2020 6964 782c 0a20 2020 2020 2020 2020    idx,.         
-0002d1c0: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
-0002d1d0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
-0002d1e0: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
-0002d1f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002d200: 2020 6365 6e74 726f 6964 3d73 686f 775f    centroid=show_
-0002d210: 6365 6e74 726f 6964 2c0a 2020 2020 2020  centroid,.      
-0002d220: 2020 2020 2020 2020 2020 7a6f 6f6d 3d7a            zoom=z
-0002d230: 6f6f 6d2c 0a20 2020 2020 2020 2020 2020  oom,.           
-0002d240: 2020 2020 207a 6f6f 6d5f 6365 6e74 7265       zoom_centre
-0002d250: 3d7a 6f6f 6d5f 6365 6e74 7265 2c0a 2020  =zoom_centre,.  
-0002d260: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0002d270: 6c6f 723d 636f 6c6f 722c 0a20 2020 2020  lor=color,.     
-0002d280: 2020 2020 2020 2020 2020 2073 686f 773d             show=
-0002d290: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-0002d2a0: 2020 2020 2020 2069 6e63 6c75 6465 5f69         include_i
-0002d2b0: 6d61 6765 3d46 616c 7365 2c0a 2020 2020  mage=False,.    
-0002d2c0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-0002d2d0: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-0002d2e0: 2020 290a 0a20 2020 2020 2020 2023 2043    )..        # C
-0002d2f0: 6865 636b 2077 6865 7468 6572 2079 2061  heck whether y a
-0002d300: 7869 7320 6e65 6564 7320 746f 2062 6520  xis needs to be 
-0002d310: 696e 7665 7274 6564 0a20 2020 2020 2020  inverted.       
-0002d320: 2069 6620 7669 6577 203d 3d20 2278 2d79   if view == "x-y
-0002d330: 2220 616e 6420 7365 6c66 2e61 782e 6765  " and self.ax.ge
-0002d340: 745f 796c 696d 2829 5b31 5d20 3e20 7365  t_ylim()[1] > se
-0002d350: 6c66 2e61 782e 6765 745f 796c 696d 2829  lf.ax.get_ylim()
-0002d360: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
-0002d370: 2073 656c 662e 6178 2e69 6e76 6572 745f   self.ax.invert_
-0002d380: 7961 7869 7328 290a 0a20 2020 2020 2020  yaxis()..       
-0002d390: 2023 2044 7261 7720 6c65 6765 6e64 0a20   # Draw legend. 
-0002d3a0: 2020 2020 2020 206c 6567 656e 6420 3d20         legend = 
-0002d3b0: 6b77 6172 6773 2e67 6574 2822 6c65 6765  kwargs.get("lege
-0002d3c0: 6e64 222c 2046 616c 7365 290a 2020 2020  nd", False).    
-0002d3d0: 2020 2020 6966 206c 6567 656e 643a 0a20      if legend:. 
-0002d3e0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-0002d3f0: 3d20 6b77 6172 6773 2e67 6574 2822 6e61  = kwargs.get("na
-0002d400: 6d65 222c 2073 656c 662e 6e61 6d65 290a  me", self.name).
-0002d410: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-0002d420: 6861 6e64 6c65 203d 2073 656c 662e 6765  handle = self.ge
-0002d430: 745f 7061 7463 6828 0a20 2020 2020 2020  t_patch(.       
-0002d440: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
-0002d450: 745f 7479 7065 2c20 636f 6c6f 722c 206f  t_type, color, o
-0002d460: 7061 6369 7479 2c20 6c69 6e65 7769 6474  pacity, linewidt
-0002d470: 682c 206e 616d 6529 0a20 2020 2020 2020  h, name).       
-0002d480: 2020 2020 2069 6620 726f 695f 6861 6e64       if roi_hand
-0002d490: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0002d4a0: 2020 2020 6262 6f78 5f74 6f5f 616e 6368      bbox_to_anch
-0002d4b0: 6f72 203d 206b 7761 7267 732e 6765 7428  or = kwargs.get(
-0002d4c0: 226c 6567 656e 645f 6262 6f78 5f74 6f5f  "legend_bbox_to_
-0002d4d0: 616e 6368 6f72 222c 204e 6f6e 6529 0a20  anchor", None). 
-0002d4e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0002d4f0: 6f63 203d 206b 7761 7267 732e 6765 7428  oc = kwargs.get(
-0002d500: 226c 6567 656e 645f 6c6f 6322 2c20 226c  "legend_loc", "l
-0002d510: 6f77 6572 206c 6566 7422 290a 0a20 2020  ower left")..   
-0002d520: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0002d530: 662e 6178 2e6c 6567 656e 6428 6861 6e64  f.ax.legend(hand
-0002d540: 6c65 733d 5b72 6f69 5f68 616e 646c 655d  les=[roi_handle]
-0002d550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002d560: 2020 2020 2020 2020 2020 6262 6f78 5f74            bbox_t
-0002d570: 6f5f 616e 6368 6f72 3d62 626f 785f 746f  o_anchor=bbox_to
-0002d580: 5f61 6e63 686f 722c 206c 6f63 3d6c 6f63  _anchor, loc=loc
-0002d590: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002d5a0: 2020 2020 2020 2020 2020 6661 6365 636f            faceco
-0002d5b0: 6c6f 723d 2277 6869 7465 222c 2066 7261  lor="white", fra
-0002d5c0: 6d65 616c 7068 613d 310a 2020 2020 2020  mealpha=1.      
+0002d1b0: 2020 7a6f 6f6d 3d7a 6f6f 6d2c 0a20 2020    zoom=zoom,.   
+0002d1c0: 2020 2020 2020 2020 2020 2020 207a 6f6f               zoo
+0002d1d0: 6d5f 6365 6e74 7265 3d7a 6f6f 6d5f 6365  m_centre=zoom_ce
+0002d1e0: 6e74 7265 2c0a 2020 2020 2020 2020 2020  ntre,.          
+0002d1f0: 2020 2020 2020 7368 6f77 3d46 616c 7365        show=False
+0002d200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d210: 2020 696e 636c 7564 655f 696d 6167 653d    include_image=
+0002d220: 696e 636c 7564 655f 696d 6167 652c 0a20  include_image,. 
+0002d230: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002d240: 6f6c 6f72 3d63 6f6c 6f72 2c0a 2020 2020  olor=color,.    
+0002d250: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+0002d260: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
+0002d270: 2020 290a 0a20 2020 2020 2020 2023 2050    )..        # P
+0002d280: 6c6f 7420 6120 636f 6e74 6f75 720a 2020  lot a contour.  
+0002d290: 2020 2020 2020 656c 6966 2070 6c6f 745f        elif plot_
+0002d2a0: 7479 7065 2069 6e20 5b22 636f 6e74 6f75  type in ["contou
+0002d2b0: 7222 2c20 2263 656e 7472 6f69 6422 5d3a  r", "centroid"]:
+0002d2c0: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+0002d2d0: 2e5f 706c 6f74 5f63 6f6e 746f 7572 280a  ._plot_contour(.
+0002d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d2f0: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
+0002d300: 2020 2020 2020 6964 782c 0a20 2020 2020        idx,.     
+0002d310: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
+0002d320: 7572 5f6b 7761 7267 732c 0a20 2020 2020  ur_kwargs,.     
+0002d330: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+0002d340: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
+0002d350: 2020 2020 2020 6365 6e74 726f 6964 3d73        centroid=s
+0002d360: 686f 775f 6365 6e74 726f 6964 2c0a 2020  how_centroid,.  
+0002d370: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
+0002d380: 6f6d 3d7a 6f6f 6d2c 0a20 2020 2020 2020  om=zoom,.       
+0002d390: 2020 2020 2020 2020 207a 6f6f 6d5f 6365           zoom_ce
+0002d3a0: 6e74 7265 3d7a 6f6f 6d5f 6365 6e74 7265  ntre=zoom_centre
+0002d3b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d3c0: 2020 636f 6c6f 723d 636f 6c6f 722c 0a20    color=color,. 
+0002d3d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002d3e0: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
+0002d3f0: 2020 2020 2020 2020 2020 2069 6e63 6c75             inclu
+0002d400: 6465 5f69 6d61 6765 3d69 6e63 6c75 6465  de_image=include
+0002d410: 5f69 6d61 6765 2c0a 2020 2020 2020 2020  _image,.        
+0002d420: 2020 2020 2020 2020 696d 6167 655f 7265          image_re
+0002d430: 6164 793d 696d 6167 655f 7265 6164 792c  ady=image_ready,
+0002d440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d450: 202a 2a6b 7761 7267 732c 0a20 2020 2020   **kwargs,.     
+0002d460: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0002d470: 2020 2320 506c 6f74 2074 7261 6e73 7061    # Plot transpa
+0002d480: 7265 6e74 206d 6173 6b20 2b20 636f 6e74  rent mask + cont
+0002d490: 6f75 720a 2020 2020 2020 2020 656c 6966  our.        elif
+0002d4a0: 2022 6669 6c6c 6564 2220 696e 2070 6c6f   "filled" in plo
+0002d4b0: 745f 7479 7065 3a0a 2020 2020 2020 2020  t_type:.        
+0002d4c0: 2020 2020 6966 206f 7061 6369 7479 2069      if opacity i
+0002d4d0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002d4e0: 2020 2020 2020 2020 6f70 6163 6974 7920          opacity 
+0002d4f0: 3d20 302e 330a 2020 2020 2020 2020 2020  = 0.3.          
+0002d500: 2020 726f 692e 5f70 6c6f 745f 6d61 736b    roi._plot_mask
+0002d510: 2876 6965 772c 2069 6478 2c20 6d61 736b  (view, idx, mask
+0002d520: 5f6b 7761 7267 732c 206f 7061 6369 7479  _kwargs, opacity
+0002d530: 2c20 636f 6c6f 723d 636f 6c6f 722c 0a20  , color=color,. 
+0002d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d550: 2020 2020 2020 2020 2020 7368 6f77 3d46            show=F
+0002d560: 616c 7365 2c20 696e 636c 7564 655f 696d  alse, include_im
+0002d570: 6167 653d 696e 636c 7564 655f 696d 6167  age=include_imag
+0002d580: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
+0002d590: 2020 2020 2020 2020 2023 6b77 6172 6773           #kwargs
+0002d5a0: 5b22 6178 225d 203d 2073 656c 662e 6178  ["ax"] = self.ax
+0002d5b0: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+0002d5c0: 2e5f 706c 6f74 5f63 6f6e 746f 7572 280a  ._plot_contour(.
 0002d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d5e0: 2020 290a 0a20 2020 2020 2020 2023 2044    )..        # D
-0002d5f0: 6973 706c 6179 2069 6d61 6765 0a0a 2020  isplay image..  
-0002d600: 2020 2020 2020 706c 742e 7469 6768 745f        plt.tight_
-0002d610: 6c61 796f 7574 2829 0a20 2020 2020 2020  layout().       
-0002d620: 2069 6620 7368 6f77 3a0a 2020 2020 2020   if show:.      
-0002d630: 2020 2020 2020 706c 742e 7368 6f77 2829        plt.show()
-0002d640: 0a0a 2020 2020 2020 2020 2320 5361 7665  ..        # Save
-0002d650: 2074 6f20 6669 6c65 0a20 2020 2020 2020   to file.       
-0002d660: 2069 6620 7361 7665 5f61 733a 0a20 2020   if save_as:.   
-0002d670: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
-0002d680: 672e 7361 7665 6669 6728 7361 7665 5f61  g.savefig(save_a
-0002d690: 7329 0a20 2020 2020 2020 2020 2020 2070  s).            p
-0002d6a0: 6c74 2e63 6c6f 7365 2829 0a0a 2020 2020  lt.close()..    
-0002d6b0: 6465 6620 6765 745f 6475 6d6d 795f 696d  def get_dummy_im
-0002d6c0: 6167 6528 7365 6c66 2c20 2a2a 6b77 6172  age(self, **kwar
-0002d6d0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-0002d6e0: 4d61 6b65 2061 2064 756d 6d79 2069 6d61  Make a dummy ima
-0002d6f0: 6765 2074 6861 7420 636f 7665 7273 2074  ge that covers t
-0002d700: 6865 2061 7265 6120 7370 616e 6e65 6420  he area spanned 
-0002d710: 6279 2074 6869 7320 524f 492e 200a 2020  by this ROI. .  
-0002d720: 2020 2020 2020 5265 7475 726e 7320 616e        Returns an
-0002d730: 2049 6d61 6765 206f 626a 6563 742e 0a0a   Image object...
-0002d740: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0002d750: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
-0002d760: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
-0002d770: 697a 6520 3a20 6c69 7374 2c20 6465 6661  ize : list, defa
-0002d780: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0002d790: 2020 2020 2056 6f78 656c 2073 697a 6520       Voxel size 
-0002d7a0: 696e 206d 6d20 696e 2074 6865 2064 756d  in mm in the dum
-0002d7b0: 6d79 2069 6d61 6765 2069 6e20 7468 6520  my image in the 
-0002d7c0: 782d 7920 706c 616e 652c 2067 6976 656e  x-y plane, given
-0002d7d0: 2061 7320 0a20 2020 2020 2020 2020 2020   as .           
-0002d7e0: 205b 7678 2c20 7679 5d2e 2049 6620 3c73   [vx, vy]. If <s
-0002d7f0: 6861 7065 3e20 616e 6420 3c76 6f78 656c  hape> and <voxel
-0002d800: 5f73 697a 653e 2061 7265 2062 6f74 6820  _size> are both 
-0002d810: 4e6f 6e65 2c20 766f 7865 6c20 7369 7a65  None, voxel size
-0002d820: 7320 6f66 0a20 2020 2020 2020 2020 2020  s of.           
-0002d830: 205b 312c 2031 5d20 7769 6c6c 2062 6520   [1, 1] will be 
-0002d840: 7573 6564 2062 7920 6465 6661 756c 742e  used by default.
-0002d850: 2054 6865 2076 6f78 656c 2073 697a 6520   The voxel size 
-0002d860: 696e 2074 6865 207a 2064 6972 6563 7469  in the z directi
-0002d870: 6f6e 200a 2020 2020 2020 2020 2020 2020  on .            
-0002d880: 6973 2064 6566 696e 6564 2062 7920 3c73  is defined by <s
-0002d890: 6c69 6365 5f74 6869 636b 6e65 7373 3e2e  lice_thickness>.
-0002d8a0: 0a0a 2020 2020 2020 2020 7368 6170 6520  ..        shape 
-0002d8b0: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
-0002d8c0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0002d8d0: 204e 756d 6265 7220 6f66 2076 6f78 656c   Number of voxel
-0002d8e0: 7320 696e 2074 6865 2064 756d 6d79 2069  s in the dummy i
-0002d8f0: 6d61 6765 2069 6e20 7468 6520 782d 7920  mage in the x-y 
-0002d900: 706c 616e 652c 2067 6976 656e 2061 730a  plane, given as.
-0002d910: 2020 2020 2020 2020 2020 2020 5b6e 782c              [nx,
-0002d920: 206e 795d 2e20 4f6e 6c79 2075 7365 6420   ny]. Only used 
-0002d930: 6966 203c 766f 7865 6c5f 7369 7a65 3e20  if <voxel_size> 
-0002d940: 6973 204e 6f6e 652e 200a 2020 2020 2020  is None. .      
-0002d950: 2020 2020 2020 5468 6520 6e75 6d62 6572        The number
-0002d960: 206f 6620 766f 7865 6c73 2069 6e20 7468   of voxels in th
-0002d970: 6520 7a20 6469 7265 6374 696f 6e20 7769  e z direction wi
-0002d980: 6c6c 2062 6520 7461 6b65 6e20 6672 6f6d  ll be taken from
-0002d990: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
-0002d9a0: 2020 6e75 6d62 6572 206f 6620 736c 6963    number of slic
-0002d9b0: 6573 2069 6e20 7468 6520 782d 7920 636f  es in the x-y co
-0002d9c0: 6e74 6f75 7273 2064 6963 7469 6f6e 6172  ntours dictionar
-0002d9d0: 792e 0a0a 2020 2020 2020 2020 6669 6c6c  y...        fill
-0002d9e0: 5f76 616c 203a 2069 6e74 2f66 6c6f 6174  _val : int/float
-0002d9f0: 2c20 6465 6661 756c 743d 3165 340a 2020  , default=1e4.  
-0002da00: 2020 2020 2020 2020 2020 5661 6c75 6520            Value 
-0002da10: 7769 7468 2077 6869 6368 2074 6865 2076  with which the v
-0002da20: 6f78 656c 7320 696e 2074 6865 2064 756d  oxels in the dum
-0002da30: 6d79 2069 6d61 6765 2073 686f 756c 6420  my image should 
-0002da40: 6265 2066 696c 6c65 642e 200a 0a20 2020  be filled. ..   
-0002da50: 2020 2020 2062 7566 6665 7220 3a20 696e       buffer : in
-0002da60: 742c 2064 6566 6175 6c74 3d31 0a20 2020  t, default=1.   
-0002da70: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-0002da80: 6f66 2065 6d70 7479 2062 7566 6665 7220  of empty buffer 
-0002da90: 766f 7865 6c73 2074 6f20 6164 6420 6f75  voxels to add ou
-0002daa0: 7473 6964 6520 7468 6520 524f 4920 696e  tside the ROI in
-0002dab0: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
-0002dac0: 2020 6469 7265 6374 696f 6e2e 0a0a 2020    direction...  
-0002dad0: 2020 2020 2020 736c 6963 655f 7468 6963        slice_thic
-0002dae0: 6b6e 6573 7320 3a20 666c 6f61 742c 2064  kness : float, d
-0002daf0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0002db00: 2020 2020 2020 2020 566f 7865 6c20 7369          Voxel si
-0002db10: 7a65 2069 6e20 6d6d 2069 6e20 7468 6520  ze in mm in the 
-0002db20: 6475 6d6d 7920 696d 6167 6520 696e 2074  dummy image in t
-0002db30: 6865 207a 2064 6972 6563 7469 6f6e 2e20  he z direction. 
-0002db40: 2049 6620 4e6f 6e65 2c0a 2020 2020 2020   If None,.      
-0002db50: 2020 2020 2020 7468 6520 7661 6c75 6520        the value 
-0002db60: 7573 6564 2069 7320 7468 6520 6d69 6e69  used is the mini
-0002db70: 6d75 6d20 6469 7374 616e 6365 2062 6574  mum distance bet
-0002db80: 7765 656e 2073 6c69 6365 2070 6f73 6974  ween slice posit
-0002db90: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-0002dba0: 2069 6e20 7468 6520 782d 7920 636f 6e74   in the x-y cont
-0002dbb0: 6f75 7273 2064 6963 7469 6f6e 6172 792e  ours dictionary.
-0002dbc0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0002dbd0: 2020 2020 2020 6578 7465 6e74 7320 3d20        extents = 
-0002dbe0: 5b73 656c 662e 6765 745f 6578 7465 6e74  [self.get_extent
-0002dbf0: 2861 783d 6178 2920 666f 7220 6178 2069  (ax=ax) for ax i
-0002dc00: 6e20 736b 7274 2e69 6d61 6765 2e5f 6178  n skrt.image._ax
-0002dc10: 6573 5d0a 2020 2020 2020 2020 736c 6963  es].        slic
-0002dc20: 655f 7468 6963 6b6e 6573 7320 3d20 6b77  e_thickness = kw
-0002dc30: 6172 6773 2e70 6f70 2822 736c 6963 655f  args.pop("slice_
-0002dc40: 7468 6963 6b6e 6573 7322 2c20 4e6f 6e65  thickness", None
-0002dc50: 290a 2020 2020 2020 2020 736c 6963 655f  ).        slice_
-0002dc60: 7468 6963 6b6e 6573 7320 3d20 2873 6c69  thickness = (sli
-0002dc70: 6365 5f74 6869 636b 6e65 7373 206f 720a  ce_thickness or.
-0002dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dc90: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
-0002dca0: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
-0002dcb0: 7328 2929 0a20 2020 2020 2020 2072 6574  s()).        ret
-0002dcc0: 7572 6e20 6372 6561 7465 5f64 756d 6d79  urn create_dummy
-0002dcd0: 5f69 6d61 6765 2865 7874 656e 7473 2c20  _image(extents, 
-0002dce0: 736c 6963 655f 7468 6963 6b6e 6573 732c  slice_thickness,
-0002dcf0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-0002dd00: 6465 6620 7365 745f 696d 6167 655f 746f  def set_image_to
-0002dd10: 5f64 756d 6d79 2873 656c 662c 202a 2a6b  _dummy(self, **k
-0002dd20: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0002dd30: 2222 2241 7373 6967 6e20 7365 6c66 2e69  """Assign self.i
-0002dd40: 6d61 6765 2070 726f 7065 7274 7920 746f  mage property to
-0002dd50: 2061 2064 756d 6d79 2069 6d61 6765 2063   a dummy image c
-0002dd60: 6f76 6572 696e 6720 7468 6520 6172 6561  overing the area
-0002dd70: 200a 2020 2020 2020 2020 7370 616e 6e65   .        spanne
-0002dd80: 6420 6279 2074 6869 7320 524f 492e 2054  d by this ROI. T
-0002dd90: 6865 2052 4f49 2773 206d 6173 6b20 616e  he ROI's mask an
-0002dda0: 6420 782d 7a2f 792d 7a20 636f 6e74 6f75  d x-z/y-z contou
-0002ddb0: 7273 2077 696c 6c20 6265 200a 2020 2020  rs will be .    
-0002ddc0: 2020 2020 636c 6561 7265 6420 736f 2074      cleared so t
-0002ddd0: 6861 7420 7468 6579 2077 696c 6c20 6265  hat they will be
-0002dde0: 2072 6563 7265 6174 6564 2077 6865 6e20   recreated when 
-0002ddf0: 6765 745f 6d61 736b 2829 206f 7220 6765  get_mask() or ge
-0002de00: 745f 636f 6e74 6f75 7273 2829 0a20 2020  t_contours().   
-0002de10: 2020 2020 2061 7265 206e 6578 7420 6361       are next ca
-0002de20: 6c6c 6564 2e0a 0a20 2020 2020 2020 202a  lled...        *
-0002de30: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
-0002de40: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0002de50: 6b77 6172 6773 203a 200a 2020 2020 2020  kwargs : .      
-0002de60: 2020 2020 2020 4b65 7977 6f72 6420 6172        Keyword ar
-0002de70: 6775 6d65 6e74 7320 746f 2070 6173 7320  guments to pass 
-0002de80: 746f 2073 656c 662e 6765 745f 6475 6d6d  to self.get_dumm
-0002de90: 795f 696d 6167 6528 2920 7768 656e 2063  y_image() when c
-0002dea0: 7265 6174 696e 670a 2020 2020 2020 2020  reating.        
-0002deb0: 2020 2020 7468 6520 6475 6d6d 7920 696d      the dummy im
-0002dec0: 6167 652e 2053 6565 2064 6f63 756d 656e  age. See documen
-0002ded0: 7461 7469 6f6e 206f 6620 524f 492e 6765  tation of ROI.ge
-0002dee0: 745f 6475 6d6d 795f 696d 6167 6528 292e  t_dummy_image().
-0002def0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0002df00: 2020 2020 2020 2320 4d61 6b65 2069 6d61        # Make ima
-0002df10: 6765 0a20 2020 2020 2020 2069 6d20 3d20  ge.        im = 
-0002df20: 7365 6c66 2e67 6574 5f64 756d 6d79 5f69  self.get_dummy_i
-0002df30: 6d61 6765 282a 2a6b 7761 7267 7329 0a0a  mage(**kwargs)..
-0002df40: 2020 2020 2020 2020 2320 436c 6561 7220          # Clear 
-0002df50: 6d61 736b 2061 6e64 2063 6f6e 746f 7572  mask and contour
-0002df60: 730a 2020 2020 2020 2020 7365 6c66 2e69  s.        self.i
-0002df70: 6e70 7574 5f63 6f6e 746f 7572 7320 3d20  nput_contours = 
-0002df80: 7365 6c66 2e63 6f6e 746f 7572 735b 2278  self.contours["x
-0002df90: 2d79 225d 0a20 2020 2020 2020 2073 656c  -y"].        sel
-0002dfa0: 662e 636f 6e74 6f75 7273 203d 207b 2278  f.contours = {"x
-0002dfb0: 2d79 223a 2073 656c 662e 696e 7075 745f  -y": self.input_
-0002dfc0: 636f 6e74 6f75 7273 7d0a 2020 2020 2020  contours}.      
-0002dfd0: 2020 7365 6c66 2e6c 6f61 6465 645f 6d61    self.loaded_ma
-0002dfe0: 736b 203d 2046 616c 7365 0a20 2020 2020  sk = False.     
-0002dff0: 2020 2073 656c 662e 6d61 736b 203d 204e     self.mask = N
-0002e000: 6f6e 650a 0a20 2020 2020 2020 2023 2041  one..        # A
-0002e010: 7373 6967 6e20 696d 6167 650a 2020 2020  ssign image.    
-0002e020: 2020 2020 7365 6c66 2e73 6574 5f69 6d61      self.set_ima
-0002e030: 6765 2869 6d29 0a0a 2020 2020 6465 6620  ge(im)..    def 
-0002e040: 7365 745f 696d 6167 6528 7365 6c66 2c20  set_image(self, 
-0002e050: 696d 293a 0a20 2020 2020 2020 2022 2222  im):.        """
-0002e060: 5365 7420 7365 6c66 2e69 6d61 6765 2074  Set self.image t
-0002e070: 6f20 6120 6769 7665 6e20 696d 6167 6520  o a given image 
-0002e080: 616e 6420 6164 6a75 7374 2067 656f 6d65  and adjust geome
-0002e090: 7472 6963 2070 726f 7065 7274 6965 730a  tric properties.
-0002e0a0: 2020 2020 2020 2020 6163 636f 7264 696e          accordin
-0002e0b0: 676c 792e 204e 6f74 6520 7468 6174 2073  gly. Note that s
-0002e0c0: 656c 662e 6d61 736b 2077 696c 6c20 6265  elf.mask will be
-0002e0d0: 2072 656d 6f76 6564 2069 6620 7468 6520   removed if the 
-0002e0e0: 6375 7272 656e 7420 6d61 736b 2773 200a  current mask's .
-0002e0f0: 2020 2020 2020 2020 7368 6170 6520 646f          shape do
-0002e100: 6573 6e27 7420 6d61 7463 6820 7468 6520  esn't match the 
-0002e110: 696d 6167 652e 200a 2020 2020 2020 2020  image. .        
-0002e120: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-0002e130: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-0002e140: 2073 656c 662e 696d 6167 6520 3d20 696d   self.image = im
-0002e150: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0002e160: 6e74 6f75 7273 5f6f 6e6c 7920 3d20 4661  ntours_only = Fa
-0002e170: 6c73 650a 2020 2020 2020 2020 6966 2069  lse.        if i
-0002e180: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
-0002e190: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-0002e1a0: 2020 2020 2020 2023 2053 6574 2052 4f49         # Set ROI
-0002e1b0: 2076 6f78 656c 2073 697a 6520 746f 2074   voxel size to t
-0002e1c0: 6861 7420 6f66 206e 6577 2069 6d61 6765  hat of new image
-0002e1d0: 2e0a 2020 2020 2020 2020 2320 4974 2077  ..        # It w
-0002e1e0: 696c 6c20 6265 206e 6565 6465 6420 746f  ill be needed to
-0002e1f0: 2064 6566 696e 6520 736c 6963 6520 7468   define slice th
-0002e200: 6963 6b6e 6573 730a 2020 2020 2020 2020  ickness.        
-0002e210: 2320 696e 2074 6865 2063 6173 6520 6f66  # in the case of
-0002e220: 2061 6e20 524f 4920 7769 7468 2063 6f6e   an ROI with con
-0002e230: 746f 7572 2873 2920 6174 2061 2073 696e  tour(s) at a sin
-0002e240: 676c 6520 7a2d 706f 7369 7469 6f6e 2e0a  gle z-position..
-0002e250: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
-0002e260: 656c 5f73 697a 6520 3d20 696d 2e67 6574  el_size = im.get
-0002e270: 5f76 6f78 656c 5f73 697a 6528 290a 0a20  _voxel_size().. 
-0002e280: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-0002e290: 7a2d 6469 7374 616e 6365 2062 6574 7765  z-distance betwe
-0002e2a0: 656e 2063 6f6e 746f 7572 7320 6973 2067  en contours is g
-0002e2b0: 7265 6174 6572 2074 6861 6e20 7468 6520  reater than the 
-0002e2c0: 766f 7865 6c0a 2020 2020 2020 2020 2320  voxel.        # 
-0002e2d0: 7a2d 6469 6d65 6e73 696f 6e20 666f 7220  z-dimension for 
-0002e2e0: 7468 6520 6e65 7720 696d 6167 652c 2066  the new image, f
-0002e2f0: 6972 7374 2065 6e73 7572 6520 7468 6174  irst ensure that
-0002e300: 2074 6865 2052 4f49 0a20 2020 2020 2020   the ROI.       
-0002e310: 2023 206d 6173 6b20 6973 2063 7265 6174   # mask is creat
-0002e320: 6564 2077 6974 6820 7468 6520 696e 7465  ed with the inte
-0002e330: 722d 636f 6e74 6f75 7220 7a2d 6469 7374  r-contour z-dist
-0002e340: 616e 6365 2c20 7468 656e 2072 6573 697a  ance, then resiz
-0002e350: 650a 2020 2020 2020 2020 2320 746f 2074  e.        # to t
-0002e360: 6865 2069 6d61 6765 2076 6f78 656c 2073  he image voxel s
-0002e370: 697a 652e 0a20 2020 2020 2020 2069 6620  ize..        if 
-0002e380: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
-0002e390: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
-0002e3a0: 7328 2920 3e20 7365 6c66 2e69 6d61 6765  s() > self.image
-0002e3b0: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
-0002e3c0: 295b 325d 3a0a 2020 2020 2020 2020 2020  )[2]:.          
-0002e3d0: 2020 6966 206e 6f74 2028 7365 6c66 2e6d    if not (self.m
-0002e3e0: 6173 6b20 616e 6420 2873 656c 662e 766f  ask and (self.vo
-0002e3f0: 7865 6c5f 7369 7a65 203d 3d20 7365 6c66  xel_size == self
-0002e400: 2e6d 6173 6b2e 766f 7865 6c5f 7369 7a65  .mask.voxel_size
-0002e410: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0002e420: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-0002e430: 6d61 736b 2876 6f78 656c 5f73 697a 653d  mask(voxel_size=
-0002e440: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
-0002e450: 303a 325d 2c20 666f 7263 653d 5472 7565  0:2], force=True
-0002e460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002e470: 2020 2320 5468 6520 6d61 736b 2063 7265    # The mask cre
-0002e480: 6174 696f 6e20 7769 6c6c 2068 6176 6520  ation will have 
-0002e490: 7265 6465 6669 6e65 6420 7468 6520 696d  redefined the im
-0002e4a0: 6167 6520 6173 736f 6369 6174 696f 6e2c  age association,
-0002e4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e4c0: 2023 2073 6f20 7265 6173 7369 676e 2074   # so reassign t
-0002e4d0: 6865 206e 6577 2069 6d61 6765 2e0a 2020  he new image..  
-0002e4e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0002e4f0: 6c66 2e69 6d61 6765 203d 2069 6d0a 2020  lf.image = im.  
-0002e500: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0002e510: 6173 6b2e 6d61 7463 685f 7369 7a65 2873  ask.match_size(s
-0002e520: 656c 662e 696d 6167 652c 206d 6574 686f  elf.image, metho
-0002e530: 643d 226e 6561 7265 7374 2229 0a20 2020  d="nearest").   
-0002e540: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-0002e550: 7474 7228 7365 6c66 2e6d 6173 6b2c 2022  ttr(self.mask, "
-0002e560: 6461 7461 2229 3a0a 2020 2020 2020 2020  data"):.        
-0002e570: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0002e580: 656c 662e 6d61 736b 2e64 6174 612e 6474  elf.mask.data.dt
-0002e590: 7970 6520 3d3d 2062 6f6f 6c3a 0a20 2020  ype == bool:.   
-0002e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e5b0: 2073 656c 662e 6d61 736b 2e64 6174 6120   self.mask.data 
-0002e5c0: 3d20 7365 6c66 2e6d 6173 6b2e 6461 7461  = self.mask.data
-0002e5d0: 2e61 7374 7970 6528 626f 6f6c 290a 0a20  .astype(bool).. 
-0002e5e0: 2020 2020 2020 2023 2049 6620 6120 6d61         # If a ma
-0002e5f0: 736b 2068 6173 2062 6565 6e20 6c6f 6164  sk has been load
-0002e600: 6564 2c20 6275 7420 646f 6573 6e27 7420  ed, but doesn't 
-0002e610: 6d61 7463 6820 7468 6520 696d 6167 6520  match the image 
-0002e620: 6765 6f6d 6574 7279 2c0a 2020 2020 2020  geometry,.      
-0002e630: 2020 2320 6465 6c65 7465 2074 6865 206d    # delete the m
-0002e640: 6173 6b20 6461 7461 2e20 2028 5468 6973  ask data.  (This
-0002e650: 2073 686f 756c 6420 6d65 616e 2074 6861   should mean tha
-0002e660: 7420 7468 6520 7a2d 6469 7374 616e 6365  t the z-distance
-0002e670: 0a20 2020 2020 2020 2023 2062 6574 7765  .        # betwe
-0002e680: 656e 2063 6f6e 746f 7572 7320 6973 206c  en contours is l
-0002e690: 6573 7320 7468 6174 2074 6865 2076 6f78  ess that the vox
-0002e6a0: 656c 207a 2d64 696d 656e 7369 6f6e 2066  el z-dimension f
-0002e6b0: 6f72 2074 6865 0a20 2020 2020 2020 2023  or the.        #
-0002e6c0: 206e 6577 2069 6d61 6765 2e29 2020 4120   new image.)  A 
-0002e6d0: 6e65 7720 6d61 736b 2077 696c 6c20 6265  new mask will be
-0002e6e0: 2063 7265 6174 6564 2061 7420 7468 6520   created at the 
-0002e6f0: 6e65 7874 2063 616c 6c0a 2020 2020 2020  next call.      
-0002e700: 2020 2320 746f 2061 6363 6573 7320 7468    # to access th
-0002e710: 6520 6d61 736b 2064 6174 612e 0a20 2020  e mask data..   
-0002e720: 2020 2020 2069 6620 7365 6c66 2e6d 6173       if self.mas
-0002e730: 6b20 616e 6420 6e6f 7420 696d 2e68 6173  k and not im.has
-0002e740: 5f73 616d 655f 6765 6f6d 6574 7279 2873  _same_geometry(s
-0002e750: 656c 662e 6d61 736b 293a 0a20 2020 2020  elf.mask):.     
-0002e760: 2020 2020 2020 2069 6620 6765 7461 7474         if getatt
-0002e770: 7228 7365 6c66 2c20 2269 6e70 7574 5f63  r(self, "input_c
-0002e780: 6f6e 746f 7572 7322 2c20 4e6f 6e65 2920  ontours", None) 
-0002e790: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0002e7a0: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
-0002e7b0: 7075 745f 636f 6e74 6f75 7273 203d 2073  put_contours = s
-0002e7c0: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
-0002e7d0: 2822 782d 7922 290a 2020 2020 2020 2020  ("x-y").        
-0002e7e0: 2020 2020 7365 6c66 2e6d 6173 6b20 3d20      self.mask = 
-0002e7f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0002e800: 2073 656c 662e 6c6f 6164 6564 5f6d 6173   self.loaded_mas
-0002e810: 6b20 3d20 4661 6c73 650a 0a20 2020 2020  k = False..     
-0002e820: 2020 2023 2053 6574 2067 656f 656d 7472     # Set geoemtr
-0002e830: 6963 2069 6e66 6f0a 2020 2020 2020 2020  ic info.        
-0002e840: 6461 7461 5f73 6861 7065 203d 2069 6d2e  data_shape = im.
-0002e850: 6765 745f 6461 7461 2829 2e73 6861 7065  get_data().shape
-0002e860: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
-0002e870: 6170 6520 3d20 5b64 6174 615f 7368 6170  ape = [data_shap
-0002e880: 655b 315d 2c20 6461 7461 5f73 6861 7065  e[1], data_shape
-0002e890: 5b30 5d2c 2064 6174 615f 7368 6170 655b  [0], data_shape[
-0002e8a0: 325d 5d0a 2020 2020 2020 2020 7365 6c66  2]].        self
-0002e8b0: 2e76 6f78 656c 5f73 697a 6520 3d20 696d  .voxel_size = im
-0002e8c0: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
-0002e8d0: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
-0002e8e0: 7269 6769 6e20 3d20 696d 2e67 6574 5f6f  rigin = im.get_o
-0002e8f0: 7269 6769 6e28 290a 2020 2020 2020 2020  rigin().        
-0002e900: 7365 6c66 2e61 6666 696e 6520 3d20 696d  self.affine = im
-0002e910: 2e67 6574 5f61 6666 696e 6528 290a 0a20  .get_affine().. 
-0002e920: 2020 2064 6566 2067 6574 5f69 6d61 6765     def get_image
-0002e930: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0002e940: 2222 2252 6574 7572 6e20 496d 6167 6520  """Return Image 
-0002e950: 6f62 6a65 6374 2061 7373 6f63 6961 7465  object associate
-0002e960: 6420 7769 7468 2074 6869 7320 524f 492e  d with this ROI.
-0002e970: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0002e980: 726e 2073 656c 662e 696d 6167 650a 0a20  rn self.image.. 
-0002e990: 2020 2064 6566 2076 6965 7728 7365 6c66     def view(self
-0002e9a0: 2c20 696e 636c 7564 655f 696d 6167 653d  , include_image=
-0002e9b0: 4661 6c73 652c 2076 6f78 656c 5f73 697a  False, voxel_siz
-0002e9c0: 653d 5b31 2c20 315d 2c20 6275 6666 6572  e=[1, 1], buffer
-0002e9d0: 3d35 2c20 2a2a 6b77 6172 6773 293a 0a20  =5, **kwargs):. 
-0002e9e0: 2020 2020 2020 2022 2222 5669 6577 2074         """View t
-0002e9f0: 6865 2052 4f49 2e0a 0a20 2020 2020 2020  he ROI...       
-0002ea00: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0002ea10: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0002ea20: 2020 696e 636c 7564 655f 696d 6167 6520    include_image 
-0002ea30: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-0002ea40: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0002ea50: 2049 6620 5472 7565 2061 6e64 2074 6869   If True and thi
-0002ea60: 7320 524f 4920 6861 7320 616e 2061 7373  s ROI has an ass
-0002ea70: 6f63 6961 7465 6420 696d 6167 6520 2869  ociated image (i
-0002ea80: 6e20 7365 6c66 2e69 6d61 6765 292c 0a20  n self.image),. 
-0002ea90: 2020 2020 2020 2020 2020 2074 6865 2069             the i
-0002eaa0: 6d61 6765 2077 696c 6c20 6265 2064 6973  mage will be dis
-0002eab0: 706c 6179 6564 2062 6568 696e 6420 7468  played behind th
-0002eac0: 6520 524f 492e 0a0a 2020 2020 2020 2020  e ROI...        
-0002ead0: 766f 7865 6c5f 7369 7a65 203a 206c 6973  voxel_size : lis
-0002eae0: 742c 2064 6566 6175 6c74 3d5b 312c 2031  t, default=[1, 1
-0002eaf0: 5d0a 2020 2020 2020 2020 2020 2020 4966  ].            If
-0002eb00: 2074 6865 2052 4f49 2064 6f65 7320 6e6f   the ROI does no
-0002eb10: 7420 6861 7665 2061 6e20 6173 736f 6369  t have an associ
-0002eb20: 6174 6564 2069 6d61 6765 2061 6e64 2069  ated image and i
-0002eb30: 7320 6465 7363 7269 6265 6420 6f6e 6c79  s described only
-0002eb40: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
-0002eb50: 636f 6e74 6f75 7273 2c20 7468 6973 2077  contours, this w
-0002eb60: 696c 6c20 6265 2074 6865 2076 6f78 656c  ill be the voxel
-0002eb70: 2073 697a 6573 2075 7365 6420 696e 2074   sizes used in t
-0002eb80: 6865 2078 2d79 2064 6972 6563 7469 6f6e  he x-y direction
-0002eb90: 0a20 2020 2020 2020 2020 2020 2077 6865  .            whe
-0002eba0: 6e20 636f 6e76 6572 7469 6e67 2074 6865  n converting the
-0002ebb0: 2052 4f49 2074 6f20 6120 6d61 736b 2069   ROI to a mask i
-0002ebc0: 6620 6120 6d61 736b 2070 6c6f 7420 7479  f a mask plot ty
-0002ebd0: 7065 2069 7320 7365 6c65 6374 6564 2e0a  pe is selected..
-0002ebe0: 0a20 2020 2020 2020 2062 7566 6665 7220  .        buffer 
-0002ebf0: 3a20 696e 742c 2064 6566 6175 6c74 3d35  : int, default=5
-0002ec00: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0002ec10: 7468 6520 524f 4920 646f 6573 206e 6f74  the ROI does not
-0002ec20: 2068 6176 6520 616e 2061 7373 6f63 6961   have an associa
-0002ec30: 7465 6420 696d 6167 6520 616e 6420 6973  ted image and is
-0002ec40: 2064 6573 6372 6962 6564 206f 6e6c 790a   described only.
-0002ec50: 2020 2020 2020 2020 2020 2020 6279 2063              by c
-0002ec60: 6f6e 746f 7572 732c 2074 6869 7320 7769  ontours, this wi
-0002ec70: 6c6c 2062 6520 7468 6520 6e75 6d62 6572  ll be the number
-0002ec80: 206f 6620 6275 6666 6572 2076 6f78 656c   of buffer voxel
-0002ec90: 7320 0a20 2020 2020 2020 2020 2020 2028  s .            (
-0002eca0: 692e 652e 2077 6869 7465 7370 6163 6529  i.e. whitespace)
-0002ecb0: 2064 6973 706c 6179 6564 2061 726f 756e   displayed aroun
-0002ecc0: 6420 7468 6520 524f 492e 0a20 2020 2020  d the ROI..     
-0002ecd0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0002ece0: 6672 6f6d 2073 6b72 742e 6265 7474 6572  from skrt.better
-0002ecf0: 5f76 6965 7765 7220 696d 706f 7274 2042  _viewer import B
-0002ed00: 6574 7465 7256 6965 7765 720a 2020 2020  etterViewer.    
-0002ed10: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-0002ed20: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0002ed30: 2023 2053 6574 2069 6e69 7469 616c 207a   # Set initial z
-0002ed40: 6f6f 6d20 616d 6f75 6e74 2061 6e64 2063  oom amount and c
-0002ed50: 656e 7472 650a 2020 2020 2020 2020 6966  entre.        if
-0002ed60: 2073 656c 662e 696d 6167 6520 6973 206e   self.image is n
-0002ed70: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
-0002ed80: 7365 6c66 2e63 6f6e 746f 7572 735f 6f6e  self.contours_on
-0002ed90: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0002eda0: 7669 6577 203d 206b 7761 7267 732e 6765  view = kwargs.ge
-0002edb0: 7428 2269 6e69 745f 7669 6577 222c 2022  t("init_view", "
-0002edc0: 782d 7922 290a 2020 2020 2020 2020 2020  x-y").          
-0002edd0: 2020 6178 6573 203d 2073 6b72 742e 696d    axes = skrt.im
-0002ede0: 6167 652e 5f70 6c6f 745f 6178 6573 5b76  age._plot_axes[v
-0002edf0: 6965 775d 0a20 2020 2020 2020 2020 2020  iew].           
-0002ee00: 2065 7874 656e 7473 203d 205b 7365 6c66   extents = [self
-0002ee10: 2e67 6574 5f6c 656e 6774 6828 6178 3d61  .get_length(ax=a
-0002ee20: 7829 2066 6f72 2061 7820 696e 2061 7865  x) for ax in axe
-0002ee30: 735d 0a20 2020 2020 2020 2020 2020 2069  s].            i
-0002ee40: 6d5f 6c69 6d73 203d 205b 7365 6c66 2e69  m_lims = [self.i
-0002ee50: 6d61 6765 2e67 6574 5f6c 656e 6774 6828  mage.get_length(
-0002ee60: 6178 3d61 7829 2066 6f72 2061 7820 696e  ax=ax) for ax in
-0002ee70: 2061 7865 735d 0a20 2020 2020 2020 2020   axes].         
-0002ee80: 2020 207a 6f6f 6d20 3d20 6d69 6e28 5b69     zoom = min([i
-0002ee90: 6d5f 6c69 6d73 5b69 5d20 2f20 6578 7465  m_lims[i] / exte
-0002eea0: 6e74 735b 695d 2066 6f72 2069 2069 6e20  nts[i] for i in 
-0002eeb0: 7261 6e67 6528 3229 5d29 202a 2030 2e38  range(2)]) * 0.8
-0002eec0: 0a20 2020 2020 2020 2020 2020 207a 6f6f  .            zoo
-0002eed0: 6d5f 6365 6e74 7265 203d 2073 656c 662e  m_centre = self.
-0002eee0: 6765 745f 6365 6e74 7265 2829 0a20 2020  get_centre().   
-0002eef0: 2020 2020 2020 2020 2069 6620 7a6f 6f6d           if zoom
-0002ef00: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
-0002ef10: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
-0002ef20: 6465 6661 756c 7428 227a 6f6f 6d22 2c20  default("zoom", 
-0002ef30: 7a6f 6f6d 290a 2020 2020 2020 2020 2020  zoom).          
-0002ef40: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
-0002ef50: 6465 6661 756c 7428 227a 6f6f 6d5f 6365  default("zoom_ce
-0002ef60: 6e74 7265 222c 207a 6f6f 6d5f 6365 6e74  ntre", zoom_cent
-0002ef70: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
-0002ef80: 6966 2022 696e 6974 5f70 6f73 2220 6e6f  if "init_pos" no
-0002ef90: 7420 696e 206b 7761 7267 7320 616e 6420  t in kwargs and 
-0002efa0: 2269 6e69 745f 736c 6963 6522 206e 6f74  "init_slice" not
-0002efb0: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
-0002efc0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-0002efd0: 6773 5b22 696e 6974 5f70 6f73 225d 203d  gs["init_pos"] =
-0002efe0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0002eff0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002f000: 6765 745f 6365 6e74 7265 2829 5b73 6b72  get_centre()[skr
-0002f010: 742e 696d 6167 652e 5f73 6c69 6365 5f61  t.image._slice_a
-0002f020: 7865 735b 7669 6577 5d5d 0a0a 2020 2020  xes[view]]..    
-0002f030: 2020 2020 6b77 6172 6773 5b22 7368 6f77      kwargs["show
-0002f040: 225d 203d 2046 616c 7365 0a20 2020 2020  "] = False.     
-0002f050: 2020 2069 6620 2270 6c6f 745f 7479 7065     if "plot_type
-0002f060: 2220 696e 206b 7761 7267 733a 0a20 2020  " in kwargs:.   
-0002f070: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-0002f080: 2272 6f69 5f70 6c6f 745f 7479 7065 225d  "roi_plot_type"]
-0002f090: 203d 206b 7761 7267 732e 706f 7028 2270   = kwargs.pop("p
-0002f0a0: 6c6f 745f 7479 7065 2229 0a0a 2020 2020  lot_type")..    
-0002f0b0: 2020 2020 2320 5669 6577 2077 6974 6820      # View with 
-0002f0c0: 696d 6167 650a 2020 2020 2020 2020 6966  image.        if
-0002f0d0: 2069 6e63 6c75 6465 5f69 6d61 6765 2061   include_image a
-0002f0e0: 6e64 2073 656c 662e 696d 6167 6520 6973  nd self.image is
-0002f0f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0002f100: 2020 2020 2020 2062 7620 3d20 4265 7474         bv = Bett
-0002f110: 6572 5669 6577 6572 2873 656c 662e 696d  erViewer(self.im
-0002f120: 6167 652c 2072 6f69 733d 7365 6c66 2c20  age, rois=self, 
-0002f130: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
-0002f140: 2020 2023 2056 6965 7720 7769 7468 6f75     # View withou
-0002f150: 7420 696d 6167 650a 2020 2020 2020 2020  t image.        
-0002f160: 656c 7365 3a0a 0a20 2020 2020 2020 2020  else:..         
-0002f170: 2020 2023 204d 616b 6520 6475 6d6d 7920     # Make dummy 
-0002f180: 696d 6167 6520 666f 7220 6261 636b 6772  image for backgr
-0002f190: 6f75 6e64 0a20 2020 2020 2020 2020 2020  ound.           
-0002f1a0: 2072 6f69 5f74 6d70 203d 2073 656c 662e   roi_tmp = self.
-0002f1b0: 636c 6f6e 6528 636f 7079 5f64 6174 613d  clone(copy_data=
-0002f1c0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-0002f1d0: 2020 2069 6d20 3d20 7365 6c66 2e67 6574     im = self.get
-0002f1e0: 5f64 756d 6d79 5f69 6d61 6765 280a 2020  _dummy_image(.  
-0002f1f0: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-0002f200: 7865 6c5f 7369 7a65 3d76 6f78 656c 5f73  xel_size=voxel_s
-0002f210: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-0002f220: 2020 2020 2062 7566 6665 723d 6275 6666       buffer=buff
-0002f230: 6572 0a20 2020 2020 2020 2020 2020 2029  er.            )
-0002f240: 0a20 2020 2020 2020 2020 2020 2069 6d2e  .            im.
-0002f250: 7469 746c 6520 3d20 7365 6c66 2e6e 616d  title = self.nam
-0002f260: 650a 2020 2020 2020 2020 2020 2020 726f  e.            ro
-0002f270: 695f 746d 702e 7365 745f 696d 6167 6528  i_tmp.set_image(
-0002f280: 696d 290a 0a20 2020 2020 2020 2020 2020  im)..           
-0002f290: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
-0002f2a0: 2072 6f69 5f74 6d70 203d 2073 656c 660a   roi_tmp = self.
-0002f2b0: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
-0002f2c0: 616b 6520 6475 6d6d 7920 696d 6167 6520  ake dummy image 
-0002f2d0: 666f 7220 6261 636b 6772 6f75 6e64 0a20  for background. 
-0002f2e0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0002f2f0: 6c66 2e63 6f6e 746f 7572 735f 6f6e 6c79  lf.contours_only
-0002f300: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002f310: 2020 696d 203d 2073 656c 662e 6765 745f    im = self.get_
-0002f320: 6475 6d6d 795f 696d 6167 6528 0a20 2020  dummy_image(.   
-0002f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f340: 2076 6f78 656c 5f73 697a 653d 766f 7865   voxel_size=voxe
-0002f350: 6c5f 7369 7a65 2c0a 2020 2020 2020 2020  l_size,.        
-0002f360: 2020 2020 2020 2020 2020 2020 6275 6666              buff
-0002f370: 6572 3d62 7566 6665 720a 2020 2020 2020  er=buffer.      
-0002f380: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0002f390: 2020 2020 2020 2020 2020 2020 696d 2e74              im.t
-0002f3a0: 6974 6c65 203d 2073 656c 662e 6e61 6d65  itle = self.name
-0002f3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f3c0: 2072 6f69 5f74 6d70 203d 2073 656c 662e   roi_tmp = self.
-0002f3d0: 636c 6f6e 6528 636f 7079 5f64 6174 613d  clone(copy_data=
-0002f3e0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-0002f3f0: 2020 2020 2020 2072 6f69 5f74 6d70 2e73         roi_tmp.s
-0002f400: 6574 5f69 6d61 6765 2869 6d29 0a20 2020  et_image(im).   
-0002f410: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0002f420: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002f430: 6d20 3d20 736b 7274 2e69 6d61 6765 2e49  m = skrt.image.I
-0002f440: 6d61 6765 280a 2020 2020 2020 2020 2020  mage(.          
-0002f450: 2020 2020 2020 2020 2020 6e70 2e6f 6e65            np.one
-0002f460: 7328 7365 6c66 2e73 6861 7065 2920 2a20  s(self.shape) * 
-0002f470: 3165 342c 0a20 2020 2020 2020 2020 2020  1e4,.           
-0002f480: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
-0002f490: 7365 6c66 2e61 6666 696e 652c 0a20 2020  self.affine,.   
-0002f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f4b0: 2074 6974 6c65 3d73 656c 662e 6e61 6d65   title=self.name
-0002f4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f4d0: 2029 0a20 2020 2020 2020 2020 2020 2022   ).            "
-0002f4e0: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-0002f4f0: 2320 4372 6561 7465 2076 6965 7765 720a  # Create viewer.
-0002f500: 2020 2020 2020 2020 2020 2020 6276 203d              bv =
-0002f510: 2042 6574 7465 7256 6965 7765 7228 696d   BetterViewer(im
-0002f520: 2c20 726f 6973 3d72 6f69 5f74 6d70 2c20  , rois=roi_tmp, 
-0002f530: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
-0002f540: 2020 2020 2020 2023 2041 646a 7573 7420         # Adjust 
-0002f550: 5549 0a20 2020 2020 2020 2020 2020 206e  UI.            n
-0002f560: 6f5f 7569 203d 206b 7761 7267 732e 6765  o_ui = kwargs.ge
-0002f570: 7428 226e 6f5f 7569 222c 2073 6b72 742e  t("no_ui", skrt.
-0002f580: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
-0002f590: 6e6f 5f75 6929 0a20 2020 2020 2020 2020  no_ui).         
-0002f5a0: 2020 2069 6620 6e6f 7420 6e6f 5f75 693a     if not no_ui:
-0002f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f5c0: 2062 762e 6d61 6b65 5f75 6928 6e6f 5f72   bv.make_ui(no_r
-0002f5d0: 6f69 3d54 7275 652c 206e 6f5f 696e 7465  oi=True, no_inte
-0002f5e0: 6e73 6974 793d 5472 7565 290a 2020 2020  nsity=True).    
-0002f5f0: 2020 2020 2020 2020 2020 2020 6276 2e73              bv.s
-0002f600: 686f 7728 290a 2020 2020 2020 2020 7265  how().        re
-0002f610: 7475 726e 2062 760a 0a20 2020 2064 6566  turn bv..    def
-0002f620: 205f 706c 6f74 5f6d 6173 6b28 0a20 2020   _plot_mask(.   
-0002f630: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0002f640: 2020 2076 6965 772c 0a20 2020 2020 2020     view,.       
-0002f650: 2069 6478 2c0a 2020 2020 2020 2020 6d61   idx,.        ma
-0002f660: 736b 5f6b 7761 7267 733d 4e6f 6e65 2c0a  sk_kwargs=None,.
-0002f670: 2020 2020 2020 2020 6f70 6163 6974 793d          opacity=
-0002f680: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
-0002f690: 636c 7564 655f 696d 6167 653d 4661 6c73  clude_image=Fals
-0002f6a0: 652c 0a20 2020 2020 2020 207a 6f6f 6d3d  e,.        zoom=
-0002f6b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7a6f  None,.        zo
-0002f6c0: 6f6d 5f63 656e 7472 653d 4e6f 6e65 2c0a  om_centre=None,.
-0002f6d0: 2020 2020 2020 2020 636f 6c6f 723d 4e6f          color=No
-0002f6e0: 6e65 2c0a 2020 2020 2020 2020 666c 6174  ne,.        flat
-0002f6f0: 7465 6e3d 4661 6c73 652c 0a20 2020 2020  ten=False,.     
-0002f700: 2020 2073 686f 773d 5472 7565 2c0a 2020     show=True,.  
-0002f710: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-0002f720: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0002f730: 2222 506c 6f74 2074 6865 2052 4f49 2061  ""Plot the ROI a
-0002f740: 7320 6120 6d61 736b 2e22 2222 0a0a 2020  s a mask."""..  
-0002f750: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-0002f760: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
-0002f770: 2069 6620 7365 6c66 2e65 6d70 7479 3a0a   if self.empty:.
-0002f780: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002f790: 726e 0a20 2020 2020 2020 206d 6173 6b5f  rn.        mask_
-0002f7a0: 736c 6963 6520 3d20 7365 6c66 2e67 6574  slice = self.get
-0002f7b0: 5f73 6c69 6365 2876 6965 772c 2069 6478  _slice(view, idx
-0002f7c0: 3d69 6478 2c20 666c 6174 7465 6e3d 666c  =idx, flatten=fl
-0002f7d0: 6174 7465 6e29 0a0a 2020 2020 2020 2020  atten)..        
-0002f7e0: 2320 4d61 6b65 2063 6f6c 6f72 6d61 700a  # Make colormap.
-0002f7f0: 2020 2020 2020 2020 6e6f 726d 203d 206d          norm = m
-0002f800: 6174 706c 6f74 6c69 622e 636f 6c6f 7273  atplotlib.colors
-0002f810: 2e4e 6f72 6d61 6c69 7a65 2829 0a20 2020  .Normalize().   
-0002f820: 2020 2020 2063 6d61 7020 3d20 6d61 7470       cmap = matp
-0002f830: 6c6f 746c 6962 2e63 6d2e 6873 760a 2020  lotlib.cm.hsv.  
-0002f840: 2020 2020 2020 735f 636f 6c6f 7273 203d        s_colors =
-0002f850: 2063 6d61 7028 6e6f 726d 286d 6173 6b5f   cmap(norm(mask_
-0002f860: 736c 6963 6529 290a 2020 2020 2020 2020  slice)).        
-0002f870: 6966 2063 6f6c 6f72 2069 7320 4e6f 6e65  if color is None
-0002f880: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0002f890: 6c6f 7220 3d20 7365 6c66 2e63 6f6c 6f72  lor = self.color
-0002f8a0: 0a20 2020 2020 2020 2073 5f63 6f6c 6f72  .        s_color
-0002f8b0: 735b 6d61 736b 5f73 6c69 6365 203e 2030  s[mask_slice > 0
-0002f8c0: 2c20 3a5d 203d 2063 6f6c 6f72 0a20 2020  , :] = color.   
-0002f8d0: 2020 2020 2073 5f63 6f6c 6f72 735b 6d61       s_colors[ma
-0002f8e0: 736b 5f73 6c69 6365 203d 3d20 302c 203a  sk_slice == 0, :
-0002f8f0: 5d20 3d20 2830 2c20 302c 2030 2c20 3029  ] = (0, 0, 0, 0)
-0002f900: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-0002f910: 706c 6f74 7469 6e67 2061 7267 756d 656e  plotting argumen
-0002f920: 7473 0a20 2020 2020 2020 2069 6620 6d61  ts.        if ma
-0002f930: 736b 5f6b 7761 7267 7320 6973 204e 6f6e  sk_kwargs is Non
-0002f940: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
-0002f950: 6173 6b5f 6b77 6172 6773 203d 207b 7d0a  ask_kwargs = {}.
-0002f960: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
-0002f970: 7267 732e 7365 7464 6566 6175 6c74 2822  rgs.setdefault("
-0002f980: 616c 7068 6122 2c20 6f70 6163 6974 7929  alpha", opacity)
-0002f990: 0a20 2020 2020 2020 206d 6173 6b5f 6b77  .        mask_kw
-0002f9a0: 6172 6773 2e73 6574 6465 6661 756c 7428  args.setdefault(
-0002f9b0: 2269 6e74 6572 706f 6c61 7469 6f6e 222c  "interpolation",
-0002f9c0: 2022 6e6f 6e65 2229 0a0a 2020 2020 2020   "none")..      
-0002f9d0: 2020 2320 4d61 6b65 2070 6c6f 740a 2020    # Make plot.  
-0002f9e0: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
-0002f9f0: 5f69 6d61 6765 2061 6e64 2073 656c 662e  _image and self.
-0002fa00: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
-0002fa10: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0002fa20: 6d5f 6d61 736b 203d 206b 7761 7267 732e  m_mask = kwargs.
-0002fa30: 6765 7428 226d 6173 6b22 2c20 4e6f 6e65  get("mask", None
-0002fa40: 290a 2020 2020 2020 2020 2020 2020 696d  ).            im
-0002fa50: 5f6d 6173 6b65 6420 3d20 6b77 6172 6773  _masked = kwargs
-0002fa60: 2e67 6574 2822 6d61 736b 6564 222c 2054  .get("masked", T
-0002fa70: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0002fa80: 2069 6d5f 696e 7665 7274 5f6d 6173 6b20   im_invert_mask 
-0002fa90: 3d20 6b77 6172 6773 2e67 6574 2822 696e  = kwargs.get("in
-0002faa0: 7665 7274 5f6d 6173 6b22 2c20 4661 6c73  vert_mask", Fals
-0002fab0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-0002fac0: 6d5f 6d61 736b 5f63 6f6c 6f72 203d 206b  m_mask_color = k
-0002fad0: 7761 7267 732e 6765 7428 226d 6173 6b5f  wargs.get("mask_
-0002fae0: 636f 6c6f 7222 2c20 2262 6c61 636b 2229  color", "black")
-0002faf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002fb00: 662e 696d 6167 652e 706c 6f74 2876 6965  f.image.plot(vie
-0002fb10: 772c 2069 6478 3d69 6478 2c20 6178 3d73  w, idx=idx, ax=s
-0002fb20: 656c 662e 6178 2c20 7368 6f77 3d46 616c  elf.ax, show=Fal
-0002fb30: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-0002fb40: 2020 2020 2020 2020 6d61 736b 3d69 6d5f          mask=im_
-0002fb50: 6d61 736b 2c20 6d61 736b 6564 3d69 6d5f  mask, masked=im_
-0002fb60: 6d61 736b 6564 2c20 696e 7665 7274 5f6d  masked, invert_m
-0002fb70: 6173 6b3d 696d 5f69 6e76 6572 745f 6d61  ask=im_invert_ma
-0002fb80: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
-0002fb90: 2020 2020 2020 2020 6d61 736b 5f63 6f6c          mask_col
-0002fba0: 6f72 3d69 6d5f 6d61 736b 5f63 6f6c 6f72  or=im_mask_color
-0002fbb0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0002fbc0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-0002fbd0: 7761 7267 732e 6765 7428 2274 6974 6c65  wargs.get("title
-0002fbe0: 222c 204e 6f6e 6529 2069 7320 4e6f 6e65  ", None) is None
-0002fbf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002fc00: 2020 6b77 6172 6773 5b22 7469 746c 6522    kwargs["title"
-0002fc10: 5d20 3d20 7365 6c66 2e6e 616d 650a 0a20  ] = self.name.. 
-0002fc20: 2020 2020 2020 2073 656c 662e 6178 2e69         self.ax.i
-0002fc30: 6d73 686f 7728 735f 636f 6c6f 7273 2c20  mshow(s_colors, 
-0002fc40: 6578 7465 6e74 3d73 656c 662e 6d61 736b  extent=self.mask
-0002fc50: 2e70 6c6f 745f 6578 7465 6e74 5b76 6965  .plot_extent[vie
-0002fc60: 775d 2c20 0a20 2020 2020 2020 2020 2020  w], .           
-0002fc70: 2020 2020 2020 2020 2020 2020 2a2a 6d61              **ma
-0002fc80: 736b 5f6b 7761 7267 7329 0a0a 2020 2020  sk_kwargs)..    
-0002fc90: 2020 2020 2320 4164 6a75 7374 2061 7865      # Adjust axe
-0002fca0: 730a 2020 2020 2020 2020 736b 7274 2e69  s.        skrt.i
-0002fcb0: 6d61 6765 2e49 6d61 6765 2e6c 6162 656c  mage.Image.label
-0002fcc0: 5f61 7828 7365 6c66 2c20 7669 6577 2c20  _ax(self, view, 
-0002fcd0: 6964 782c 202a 2a6b 7761 7267 7329 0a20  idx, **kwargs). 
-0002fce0: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
-0002fcf0: 652e 496d 6167 652e 7a6f 6f6d 5f61 7828  e.Image.zoom_ax(
-0002fd00: 7365 6c66 2c20 7669 6577 2c20 7a6f 6f6d  self, view, zoom
-0002fd10: 2c20 7a6f 6f6d 5f63 656e 7472 6529 0a20  , zoom_centre). 
-0002fd20: 2020 2020 2020 2069 6620 7368 6f77 3a0a         if show:.
-0002fd30: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
-0002fd40: 7368 6f77 2829 0a0a 2020 2020 6465 6620  show()..    def 
-0002fd50: 5f70 6c6f 745f 636f 6e74 6f75 7228 0a20  _plot_contour(. 
-0002fd60: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0002fd70: 2020 2020 2076 6965 772c 0a20 2020 2020       view,.     
-0002fd80: 2020 2069 6478 2c0a 2020 2020 2020 2020     idx,.        
-0002fd90: 636f 6e74 6f75 725f 6b77 6172 6773 3d4e  contour_kwargs=N
-0002fda0: 6f6e 652c 0a20 2020 2020 2020 206c 696e  one,.        lin
-0002fdb0: 6577 6964 7468 3d4e 6f6e 652c 0a20 2020  ewidth=None,.   
-0002fdc0: 2020 2020 2063 656e 7472 6f69 643d 4661       centroid=Fa
-0002fdd0: 6c73 652c 0a20 2020 2020 2020 2069 6e63  lse,.        inc
-0002fde0: 6c75 6465 5f69 6d61 6765 3d46 616c 7365  lude_image=False
-0002fdf0: 2c0a 2020 2020 2020 2020 7a6f 6f6d 3d4e  ,.        zoom=N
-0002fe00: 6f6e 652c 0a20 2020 2020 2020 207a 6f6f  one,.        zoo
-0002fe10: 6d5f 6365 6e74 7265 3d4e 6f6e 652c 0a20  m_centre=None,. 
-0002fe20: 2020 2020 2020 2063 6f6c 6f72 3d4e 6f6e         color=Non
-0002fe30: 652c 0a20 2020 2020 2020 2066 6c61 7474  e,.        flatt
-0002fe40: 656e 3d46 616c 7365 2c0a 2020 2020 2020  en=False,.      
-0002fe50: 2020 7368 6f77 3d54 7275 652c 0a20 2020    show=True,.   
-0002fe60: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-0002fe70: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0002fe80: 2250 6c6f 7420 7468 6520 524f 4920 6173  "Plot the ROI as
-0002fe90: 2061 2063 6f6e 746f 7572 2e22 2222 0a0a   a contour."""..
-0002fea0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-0002feb0: 6428 290a 2020 2020 2020 2020 6966 2028  d().        if (
-0002fec0: 6e6f 7420 7365 6c66 2e6f 6e5f 736c 6963  not self.on_slic
-0002fed0: 6528 7669 6577 2c20 6964 783d 6964 7829  e(view, idx=idx)
-0002fee0: 2061 6e64 206e 6f74 2066 6c61 7474 656e   and not flatten
-0002fef0: 2920 6f72 2073 656c 662e 656d 7074 793a  ) or self.empty:
-0002ff00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0002ff10: 7572 6e0a 0a20 2020 2020 2020 2063 6f6e  urn..        con
-0002ff20: 746f 7572 5f6b 7761 7267 7320 3d20 7b7d  tour_kwargs = {}
-0002ff30: 2069 6620 636f 6e74 6f75 725f 6b77 6172   if contour_kwar
-0002ff40: 6773 2069 7320 4e6f 6e65 2065 6c73 6520  gs is None else 
-0002ff50: 636f 6e74 6f75 725f 6b77 6172 6773 0a20  contour_kwargs. 
-0002ff60: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
-0002ff70: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-0002ff80: 2822 636f 6c6f 7222 2c20 636f 6c6f 7229  ("color", color)
-0002ff90: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
-0002ffa0: 5f6b 7761 7267 732e 7365 7464 6566 6175  _kwargs.setdefau
-0002ffb0: 6c74 2822 6c69 6e65 7769 6474 6822 2c20  lt("linewidth", 
-0002ffc0: 6c69 6e65 7769 6474 6829 0a0a 2020 2020  linewidth)..    
-0002ffd0: 2020 2020 2320 506c 6f74 2075 6e64 6572      # Plot under
-0002ffe0: 6c79 696e 6720 696d 6167 650a 2020 2020  lying image.    
-0002fff0: 2020 2020 6966 2069 6e63 6c75 6465 5f69      if include_i
-00030000: 6d61 6765 2061 6e64 2073 656c 662e 696d  mage and self.im
-00030010: 6167 6520 6973 206e 6f74 204e 6f6e 653a  age is not None:
-00030020: 0a20 2020 2020 2020 2020 2020 2069 6d5f  .            im_
-00030030: 6d61 736b 203d 206b 7761 7267 732e 6765  mask = kwargs.ge
-00030040: 7428 226d 6173 6b22 2c20 4e6f 6e65 290a  t("mask", None).
-00030050: 2020 2020 2020 2020 2020 2020 696d 5f6d              im_m
-00030060: 6173 6b65 6420 3d20 6b77 6172 6773 2e67  asked = kwargs.g
-00030070: 6574 2822 6d61 736b 6564 222c 2054 7275  et("masked", Tru
-00030080: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-00030090: 6d5f 696e 7665 7274 5f6d 6173 6b20 3d20  m_invert_mask = 
-000300a0: 6b77 6172 6773 2e67 6574 2822 696e 7665  kwargs.get("inve
-000300b0: 7274 5f6d 6173 6b22 2c20 4661 6c73 6529  rt_mask", False)
-000300c0: 0a20 2020 2020 2020 2020 2020 2069 6d5f  .            im_
-000300d0: 6d61 736b 5f63 6f6c 6f72 203d 206b 7761  mask_color = kwa
-000300e0: 7267 732e 6765 7428 226d 6173 6b5f 636f  rgs.get("mask_co
-000300f0: 6c6f 7222 2c20 2262 6c61 636b 2229 0a20  lor", "black"). 
-00030100: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00030110: 696d 6167 652e 706c 6f74 2876 6965 772c  image.plot(view,
-00030120: 2069 6478 3d69 6478 2c20 6178 3d73 656c   idx=idx, ax=sel
-00030130: 662e 6178 2c20 7368 6f77 3d46 616c 7365  f.ax, show=False
-00030140: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00030150: 2020 2020 2020 6d61 736b 3d69 6d5f 6d61        mask=im_ma
-00030160: 736b 2c20 6d61 736b 6564 3d69 6d5f 6d61  sk, masked=im_ma
-00030170: 736b 6564 2c20 696e 7665 7274 5f6d 6173  sked, invert_mas
-00030180: 6b3d 696d 5f69 6e76 6572 745f 6d61 736b  k=im_invert_mask
-00030190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000301a0: 2020 2020 2020 6d61 736b 5f63 6f6c 6f72        mask_color
-000301b0: 3d69 6d5f 6d61 736b 5f63 6f6c 6f72 290a  =im_mask_color).
-000301c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000301d0: 2020 2020 2020 2020 2020 6966 206b 7761            if kwa
-000301e0: 7267 732e 6765 7428 2274 6974 6c65 222c  rgs.get("title",
-000301f0: 204e 6f6e 6529 2069 7320 4e6f 6e65 3a0a   None) is None:.
-00030200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030210: 6b77 6172 6773 5b22 7469 746c 6522 5d20  kwargs["title"] 
-00030220: 3d20 7365 6c66 2e6e 616d 650a 0a20 2020  = self.name..   
-00030230: 2020 2020 2023 2047 6574 2063 6f6e 746f       # Get conto
-00030240: 7572 2070 6f69 6e74 730a 2020 2020 2020  ur points.      
-00030250: 2020 6966 2066 6c61 7474 656e 3a0a 2020    if flatten:.  
-00030260: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
-00030270: 2073 656c 662e 6765 745f 736c 6963 6528   self.get_slice(
-00030280: 7669 6577 2c20 6964 783d 6964 782c 2066  view, idx=idx, f
-00030290: 6c61 7474 656e 3d54 7275 6529 0a20 2020  latten=True).   
-000302a0: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
-000302b0: 7320 3d20 7365 6c66 2e6d 6173 6b5f 746f  s = self.mask_to
-000302c0: 5f63 6f6e 746f 7572 7328 6d61 736b 2c20  _contours(mask, 
-000302d0: 7669 6577 2c20 696e 7665 7274 3d54 7275  view, invert=Tru
-000302e0: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
-000302f0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00030300: 746f 7572 7320 3d20 7365 6c66 2e67 6574  tours = self.get
-00030310: 5f63 6f6e 746f 7572 7328 7669 6577 2c20  _contours(view, 
-00030320: 6964 785f 6173 5f6b 6579 3d54 7275 6529  idx_as_key=True)
-00030330: 5b69 6478 5d0a 0a20 2020 2020 2020 2023  [idx]..        #
-00030340: 2050 6c6f 7420 636f 6e74 6f75 720a 2020   Plot contour.  
-00030350: 2020 2020 2020 666f 7220 706f 696e 7473        for points
-00030360: 2069 6e20 636f 6e74 6f75 7273 3a0a 2020   in contours:.  
-00030370: 2020 2020 2020 2020 2020 706f 696e 7473            points
-00030380: 5f78 203d 205b 705b 305d 2066 6f72 2070  _x = [p[0] for p
-00030390: 2069 6e20 706f 696e 7473 5d0a 2020 2020   in points].    
-000303a0: 2020 2020 2020 2020 706f 696e 7473 5f79          points_y
-000303b0: 203d 205b 705b 315d 2066 6f72 2070 2069   = [p[1] for p i
-000303c0: 6e20 706f 696e 7473 5d0a 2020 2020 2020  n points].      
-000303d0: 2020 2020 2020 706f 696e 7473 5f78 2e61        points_x.a
-000303e0: 7070 656e 6428 706f 696e 7473 5f78 5b30  ppend(points_x[0
-000303f0: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
-00030400: 6f69 6e74 735f 792e 6170 7065 6e64 2870  oints_y.append(p
-00030410: 6f69 6e74 735f 795b 305d 290a 2020 2020  oints_y[0]).    
-00030420: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
-00030430: 706c 6f74 2870 6f69 6e74 735f 782c 2070  plot(points_x, p
-00030440: 6f69 6e74 735f 792c 202a 2a63 6f6e 746f  oints_y, **conto
-00030450: 7572 5f6b 7761 7267 7329 0a0a 2020 2020  ur_kwargs)..    
-00030460: 2020 2020 2320 506c 6f74 2063 656e 7472      # Plot centr
-00030470: 6f69 6420 706f 696e 740a 2020 2020 2020  oid point.      
-00030480: 2020 6966 2063 656e 7472 6f69 643a 0a20    if centroid:. 
-00030490: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000304a0: 7420 666c 6174 7465 6e3a 0a20 2020 2020  t flatten:.     
-000304b0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-000304c0: 6f69 645f 706f 696e 7473 203d 2073 656c  oid_points = sel
-000304d0: 662e 6765 745f 6365 6e74 726f 6964 280a  f.get_centroid(.
-000304e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000304f0: 2020 2020 7669 6577 2c20 7369 6e67 6c65      view, single
-00030500: 5f73 6c69 6365 3d54 7275 652c 2069 6478  _slice=True, idx
-00030510: 3d69 6478 290a 2020 2020 2020 2020 2020  =idx).          
-00030520: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00030530: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-00030540: 5f33 6420 3d20 7365 6c66 2e67 6574 5f63  _3d = self.get_c
-00030550: 656e 7472 6f69 6428 290a 2020 2020 2020  entroid().      
-00030560: 2020 2020 2020 2020 2020 785f 6178 2c20            x_ax, 
-00030570: 795f 6178 203d 2073 6b72 742e 696d 6167  y_ax = skrt.imag
-00030580: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
-00030590: 775d 0a20 2020 2020 2020 2020 2020 2020  w].             
-000305a0: 2020 2063 656e 7472 6f69 645f 706f 696e     centroid_poin
-000305b0: 7473 203d 205b 6365 6e74 726f 6964 5f33  ts = [centroid_3
-000305c0: 645b 785f 6178 5d2c 2063 656e 7472 6f69  d[x_ax], centroi
-000305d0: 645f 3364 5b79 5f61 785d 5d0a 2020 2020  d_3d[y_ax]].    
-000305e0: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
-000305f0: 706c 6f74 280a 2020 2020 2020 2020 2020  plot(.          
-00030600: 2020 2020 2020 2a63 656e 7472 6f69 645f        *centroid_
-00030610: 706f 696e 7473 2c0a 2020 2020 2020 2020  points,.        
-00030620: 2020 2020 2020 2020 222b 222c 0a20 2020          "+",.   
-00030630: 2020 2020 2020 2020 2020 2020 202a 2a63               **c
-00030640: 6f6e 746f 7572 5f6b 7761 7267 732c 0a20  ontour_kwargs,. 
-00030650: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00030660: 2020 2020 2020 2320 4164 6a75 7374 2061        # Adjust a
-00030670: 7865 730a 2020 2020 2020 2020 7365 6c66  xes.        self
-00030680: 2e61 782e 7365 745f 6173 7065 6374 2822  .ax.set_aspect("
-00030690: 6571 7561 6c22 290a 2020 2020 2020 2020  equal").        
-000306a0: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-000306b0: 2e6c 6162 656c 5f61 7828 7365 6c66 2c20  .label_ax(self, 
-000306c0: 7669 6577 2c20 6964 782c 202a 2a6b 7761  view, idx, **kwa
-000306d0: 7267 7329 0a20 2020 2020 2020 2073 6b72  rgs).        skr
-000306e0: 742e 696d 6167 652e 496d 6167 652e 7a6f  t.image.Image.zo
-000306f0: 6f6d 5f61 7828 7365 6c66 2c20 7669 6577  om_ax(self, view
-00030700: 2c20 7a6f 6f6d 2c20 7a6f 6f6d 5f63 656e  , zoom, zoom_cen
-00030710: 7472 6529 0a20 2020 2020 2020 2069 6620  tre).        if 
-00030720: 7368 6f77 3a0a 2020 2020 2020 2020 2020  show:.          
-00030730: 2020 706c 742e 7368 6f77 2829 0a0a 2020    plt.show()..  
-00030740: 2020 6465 6620 706c 6f74 5f63 6f6d 7061    def plot_compa
-00030750: 7269 736f 6e28 0a20 2020 2020 2020 2073  rison(.        s
-00030760: 656c 662c 200a 2020 2020 2020 2020 6f74  elf, .        ot
-00030770: 6865 722c 200a 2020 2020 2020 2020 7669  her, .        vi
-00030780: 6577 3d22 782d 7922 2c0a 2020 2020 2020  ew="x-y",.      
-00030790: 2020 736c 3d4e 6f6e 652c 0a20 2020 2020    sl=None,.     
-000307a0: 2020 2069 6478 3d4e 6f6e 652c 0a20 2020     idx=None,.   
-000307b0: 2020 2020 2070 6f73 3d4e 6f6e 652c 0a20       pos=None,. 
-000307c0: 2020 2020 2020 206d 6964 5f73 6c69 6365         mid_slice
-000307d0: 5f66 6f72 5f62 6f74 683d 4661 6c73 652c  _for_both=False,
-000307e0: 0a20 2020 2020 2020 206c 6567 656e 643d  .        legend=
-000307f0: 5472 7565 2c20 0a20 2020 2020 2020 2073  True, .        s
-00030800: 6176 655f 6173 3d4e 6f6e 652c 200a 2020  ave_as=None, .  
-00030810: 2020 2020 2020 6e61 6d65 733d 4e6f 6e65        names=None
-00030820: 2c20 0a20 2020 2020 2020 2073 686f 773d  , .        show=
-00030830: 5472 7565 2c20 0a20 2020 2020 2020 2069  True, .        i
-00030840: 6e63 6c75 6465 5f69 6d61 6765 3d46 616c  nclude_image=Fal
-00030850: 7365 2c0a 2020 2020 2020 2020 6c65 6765  se,.        lege
-00030860: 6e64 5f62 626f 785f 746f 5f61 6e63 686f  nd_bbox_to_ancho
-00030870: 723d 4e6f 6e65 2c0a 2020 2020 2020 2020  r=None,.        
-00030880: 6c65 6765 6e64 5f6c 6f63 3d22 6c6f 7765  legend_loc="lowe
-00030890: 7220 6c65 6674 222c 0a20 2020 2020 2020  r left",.       
-000308a0: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
-000308b0: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
-000308c0: 2063 6f6d 7061 7269 736f 6e20 7769 7468   comparison with
-000308d0: 2061 6e6f 7468 6572 2052 4f49 2e20 4966   another ROI. If
-000308e0: 206e 6f20 736c 2f69 6478 2f70 6f73 2061   no sl/idx/pos a
-000308f0: 7265 2067 6976 656e 2c0a 2020 2020 2020  re given,.      
-00030900: 2020 7468 6520 6365 6e74 7261 6c20 736c    the central sl
-00030910: 6963 6520 6f66 2074 6869 7320 524f 4920  ice of this ROI 
-00030920: 7769 6c6c 2062 6520 706c 6f74 7465 642c  will be plotted,
-00030930: 2075 6e6c 6573 7320 0a20 2020 2020 2020   unless .       
-00030940: 206d 6964 5f73 6c69 6365 5f66 6f72 5f62   mid_slice_for_b
-00030950: 6f74 683d 5472 7565 2c20 696e 2077 6869  oth=True, in whi
-00030960: 6368 2063 6173 6520 7468 6520 6365 6e74  ch case the cent
-00030970: 7261 6c20 736c 6963 6520 6f66 2062 6f74  ral slice of bot
-00030980: 6820 524f 4973 0a20 2020 2020 2020 2077  h ROIs.        w
-00030990: 696c 6c20 6265 2070 6c6f 7474 6564 2028  ill be plotted (
-000309a0: 6576 656e 2074 686f 7567 6820 7468 6973  even though this
-000309b0: 206d 6179 206e 6f74 2063 6f72 7265 7370   may not corresp
-000309c0: 6f6e 6420 746f 2074 6865 2073 616d 6520  ond to the same 
-000309d0: 0a20 2020 2020 2020 2070 6f69 6e74 2069  .        point i
-000309e0: 6e20 7370 6163 6529 2e0a 0a20 2020 2020  n space)...     
-000309f0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00030a00: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-00030a10: 2020 2020 6f74 6865 7220 3a20 524f 490a      other : ROI.
-00030a20: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
-00030a30: 7220 524f 4920 7769 7468 2077 6869 6368  r ROI with which
-00030a40: 2074 6f20 706c 6f74 2063 6f6d 7061 7269   to plot compari
-00030a50: 736f 6e2e 0a0a 2020 2020 2020 2020 7669  son...        vi
-00030a60: 6577 203a 2073 7472 2c20 6465 6661 756c  ew : str, defaul
-00030a70: 743d 2278 2d79 220a 2020 2020 2020 2020  t="x-y".        
-00030a80: 2020 2020 4f72 6965 6e74 6174 696f 6e20      Orientation 
-00030a90: 696e 2077 6869 6368 2074 6f20 706c 6f74  in which to plot
-00030aa0: 2052 4f49 732e 200a 0a20 2020 2020 2020   ROIs. ..       
-00030ab0: 2073 6c20 3a20 696e 742c 2064 6566 6175   sl : int, defau
-00030ac0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00030ad0: 2020 2020 536c 6963 6520 6e75 6d62 6572      Slice number
-00030ae0: 2e20 4966 206e 6f6e 6520 6f66 203c 736c  . If none of <sl
-00030af0: 3e2c 203c 6964 783e 206f 7220 3c70 6f73  >, <idx> or <pos
-00030b00: 3e20 6172 6520 7375 7070 6c69 6564 2062  > are supplied b
-00030b10: 7574 0a20 2020 2020 2020 2020 2020 203c  ut.            <
-00030b20: 7369 6e67 6c65 5f73 6c69 6365 3e20 6973  single_slice> is
-00030b30: 2054 7275 652c 2074 6865 2063 656e 7472   True, the centr
-00030b40: 616c 2073 6c69 6365 206f 6620 7468 6520  al slice of the 
-00030b50: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
-00030b60: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
-00030b70: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-00030b80: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
-00030b90: 7272 6179 2069 6e64 6578 206f 6620 736c  rray index of sl
-00030ba0: 6963 652e 2049 6620 6e6f 6e65 206f 6620  ice. If none of 
-00030bb0: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
-00030bc0: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
-00030bd0: 6420 6275 740a 2020 2020 2020 2020 2020  d but.          
-00030be0: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
-00030bf0: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
-00030c00: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
-00030c10: 6865 2052 4f49 2077 696c 6c20 6265 2075  he ROI will be u
-00030c20: 7365 642e 0a0a 2020 2020 2020 2020 706f  sed...        po
-00030c30: 7320 3a20 666c 6f61 742c 2064 6566 6175  s : float, defau
-00030c40: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00030c50: 2020 2020 536c 6963 6520 706f 7369 7469      Slice positi
-00030c60: 6f6e 2069 6e20 6d6d 2e20 4966 206e 6f6e  on in mm. If non
-00030c70: 6520 6f66 203c 736c 3e2c 203c 6964 783e  e of <sl>, <idx>
-00030c80: 206f 7220 3c70 6f73 3e20 6172 6520 7375   or <pos> are su
-00030c90: 7070 6c69 6564 2062 7574 0a20 2020 2020  pplied but.     
-00030ca0: 2020 2020 2020 203c 7369 6e67 6c65 5f73         <single_s
-00030cb0: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
-00030cc0: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
-00030cd0: 206f 6620 7468 6520 524f 4920 7769 6c6c   of the ROI will
-00030ce0: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
-00030cf0: 2020 206d 6964 5f73 6c69 6365 5f66 6f72     mid_slice_for
-00030d00: 5f62 6f74 6820 3a20 626f 6f6c 2c20 6465  _both : bool, de
-00030d10: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00030d20: 2020 2020 2020 2020 4966 2054 7275 6520          If True 
-00030d30: 616e 6420 6e6f 2073 6c2f 6964 782f 706f  and no sl/idx/po
-00030d40: 7320 6172 6520 6769 7665 6e2c 2074 6865  s are given, the
-00030d50: 2063 656e 7472 616c 2073 6c69 6365 7320   central slices 
-00030d60: 6f66 2062 6f74 680a 2020 2020 2020 2020  of both.        
-00030d70: 2020 2020 524f 4973 2077 696c 6c20 6265      ROIs will be
-00030d80: 2070 6c6f 7474 6564 2c20 6576 656e 2069   plotted, even i
-00030d90: 6620 7468 6973 2064 6f65 7320 6e6f 7420  f this does not 
-00030da0: 636f 7272 6573 706f 6e64 2074 6f20 7468  correspond to th
-00030db0: 6520 7361 6d65 0a20 2020 2020 2020 2020  e same.         
-00030dc0: 2020 2070 6f69 6e74 2069 6e20 7370 6163     point in spac
-00030dd0: 653b 206f 7468 6572 7769 7365 2c20 7468  e; otherwise, th
-00030de0: 6520 706f 7369 7469 6f6e 206f 6620 7468  e position of th
-00030df0: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
-00030e00: 6f66 0a20 2020 2020 2020 2020 2020 2074  of.            t
-00030e10: 6869 7320 524f 4920 7769 6c6c 2062 6520  his ROI will be 
-00030e20: 706c 6f74 7465 6420 666f 7220 626f 7468  plotted for both
-00030e30: 2e0a 0a20 2020 2020 2020 206c 6567 656e  ...        legen
-00030e40: 6420 3a20 626f 6f6c 2c20 6465 6661 756c  d : bool, defaul
-00030e50: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
-00030e60: 2020 2049 6620 5472 7565 2c20 6120 6c65     If True, a le
-00030e70: 6765 6e64 2077 696c 6c20 6265 2061 6464  gend will be add
-00030e80: 6564 2074 6f20 7468 6520 706c 6f74 2063  ed to the plot c
-00030e90: 6f6e 7461 696e 696e 6720 7468 6520 6e61  ontaining the na
-00030ea0: 6d65 7320 0a20 2020 2020 2020 2020 2020  mes .           
-00030eb0: 206f 6620 7468 6520 7477 6f20 524f 4973   of the two ROIs
-00030ec0: 2e0a 0a20 2020 2020 2020 2073 6176 655f  ...        save_
-00030ed0: 6173 203a 2073 7472 2c20 6465 6661 756c  as : str, defaul
-00030ee0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00030ef0: 2020 2050 6174 6820 746f 2061 2066 696c     Path to a fil
-00030f00: 6520 6174 2077 6869 6368 2074 6865 2070  e at which the p
-00030f10: 6c6f 7420 7769 6c6c 2062 6520 7361 7665  lot will be save
-00030f20: 642e 2049 6620 4e6f 6e65 2c20 7468 6520  d. If None, the 
-00030f30: 706c 6f74 0a20 2020 2020 2020 2020 2020  plot.           
-00030f40: 2077 696c 6c20 6e6f 7420 6265 2073 6176   will not be sav
-00030f50: 6564 2e0a 0a20 2020 2020 2020 206e 616d  ed...        nam
-00030f60: 6573 203a 206c 6973 742c 2064 6566 6175  es : list, defau
-00030f70: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00030f80: 2020 2020 4375 7374 6f6d 206e 616d 6573      Custom names
-00030f90: 2074 6f20 7573 6520 666f 7220 7468 6520   to use for the 
-00030fa0: 524f 4920 6c65 6765 6e64 2069 6e20 6f72  ROI legend in or
-00030fb0: 6465 7220 5b74 6869 7320 524f 492c 206f  der [this ROI, o
-00030fc0: 7468 6572 2052 4f49 5d2e 0a20 2020 2020  ther ROI]..     
-00030fd0: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
-00030fe0: 7468 6520 6e61 6d65 7320 696e 2073 656c  the names in sel
-00030ff0: 662e 6e61 6d65 2061 6e64 2072 6f69 2e6e  f.name and roi.n
-00031000: 616d 6520 7769 6c6c 2062 6520 7573 6564  ame will be used
-00031010: 2e0a 0a20 2020 2020 2020 2073 686f 7720  ...        show 
-00031020: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00031030: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00031040: 2049 6620 5472 7565 2c20 7468 6520 706c   If True, the pl
-00031050: 6f74 2077 696c 6c20 6265 2064 6973 706c  ot will be displ
-00031060: 6179 6564 2e0a 2020 2020 2020 2020 2222  ayed..        ""
-00031070: 220a 0a20 2020 2020 2020 2023 2045 6e73  "..        # Ens
-00031080: 7572 6520 524f 4973 2061 7265 2070 6c6f  ure ROIs are plo
-00031090: 7474 6564 2069 6e20 6469 6666 6572 656e  tted in differen
-000310a0: 7420 636f 6c6f 7572 730a 2020 2020 2020  t colours.      
-000310b0: 2020 6966 2073 656c 662e 636f 6c6f 7220    if self.color 
-000310c0: 3d3d 206f 7468 6572 2e63 6f6c 6f72 3a0a  == other.color:.
-000310d0: 2020 2020 2020 2020 2020 2020 726f 6932              roi2
-000310e0: 5f63 6f6c 6f72 203d 2052 4f49 4465 6661  _color = ROIDefa
-000310f0: 756c 7473 2829 2e67 6574 5f64 6566 6175  ults().get_defau
-00031100: 6c74 5f72 6f69 5f63 6f6c 6f72 2829 0a20  lt_roi_color(). 
-00031110: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00031120: 2020 2020 2020 2020 2072 6f69 325f 636f           roi2_co
-00031130: 6c6f 7220 3d20 6f74 6865 722e 636f 6c6f  lor = other.colo
-00031140: 720a 0a20 2020 2020 2020 2023 2047 6574  r..        # Get
-00031150: 2069 6e64 6578 2074 6f20 706c 6f74 0a20   index to plot. 
-00031160: 2020 2020 2020 207a 5f61 7820 3d20 736b         z_ax = sk
-00031170: 7274 2e69 6d61 6765 2e5f 736c 6963 655f  rt.image._slice_
-00031180: 6178 6573 5b76 6965 775d 0a0a 2020 2020  axes[view]..    
-00031190: 2020 2020 2320 436f 6d70 7574 6520 706f      # Compute po
-000311a0: 7369 7469 6f6e 2069 6e20 6d6d 2074 6f20  sition in mm to 
-000311b0: 706c 6f74 0a20 2020 2020 2020 2069 6620  plot.        if 
-000311c0: 736c 2069 7320 4e6f 6e65 2061 6e64 2070  sl is None and p
-000311d0: 6f73 2069 7320 4e6f 6e65 2061 6e64 2069  os is None and i
-000311e0: 6478 2069 7320 4e6f 6e65 3a0a 2020 2020  dx is None:.    
-000311f0: 2020 2020 2020 2020 706f 7331 203d 2073          pos1 = s
-00031200: 656c 662e 6964 785f 746f 5f70 6f73 2873  elf.idx_to_pos(s
-00031210: 656c 662e 6765 745f 6d69 645f 6964 7828  elf.get_mid_idx(
-00031220: 7669 6577 292c 207a 5f61 7829 0a20 2020  view), z_ax).   
-00031230: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00031240: 2020 2020 2020 2070 6f73 3120 3d20 7365         pos1 = se
-00031250: 6c66 2e69 6478 5f74 6f5f 706f 7328 0a20  lf.idx_to_pos(. 
-00031260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00031270: 656c 662e 6765 745f 6964 7828 7669 6577  elf.get_idx(view
-00031280: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
-00031290: 2c20 706f 733d 706f 7329 2c20 0a20 2020  , pos=pos), .   
-000312a0: 2020 2020 2020 2020 2020 2020 207a 5f61               z_a
-000312b0: 780a 2020 2020 2020 2020 2020 2020 290a  x.            ).
-000312c0: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
-000312d0: 7468 6520 7361 6d65 2070 6f73 6974 696f  the same positio
-000312e0: 6e20 666f 7220 6f74 6865 7220 524f 492c  n for other ROI,
-000312f0: 2075 6e6c 6573 7320 6d69 645f 736c 6963   unless mid_slic
-00031300: 655f 666f 725f 626f 7468 3d54 7275 650a  e_for_both=True.
-00031310: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
-00031320: 6964 5f73 6c69 6365 5f66 6f72 5f62 6f74  id_slice_for_bot
-00031330: 683a 0a20 2020 2020 2020 2020 2020 2070  h:.            p
-00031340: 6f73 3220 3d20 706f 7331 0a20 2020 2020  os2 = pos1.     
-00031350: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00031360: 2020 2020 2070 6f73 3220 3d20 6f74 6865       pos2 = othe
-00031370: 722e 6964 785f 746f 5f70 6f73 286f 7468  r.idx_to_pos(oth
-00031380: 6572 2e67 6574 5f6d 6964 5f69 6478 2876  er.get_mid_idx(v
-00031390: 6965 7729 2c20 7a5f 6178 290a 0a20 2020  iew), z_ax)..   
-000313a0: 2020 2020 2023 2050 6c6f 7420 7365 6c66       # Plot self
-000313b0: 0a20 2020 2020 2020 2073 656c 662e 706c  .        self.pl
-000313c0: 6f74 2873 686f 773d 4661 6c73 652c 2076  ot(show=False, v
-000313d0: 6965 773d 7669 6577 2c20 706f 733d 706f  iew=view, pos=po
-000313e0: 7331 2c20 696e 636c 7564 655f 696d 6167  s1, include_imag
-000313f0: 653d 696e 636c 7564 655f 696d 6167 652c  e=include_image,
-00031400: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00031410: 2020 2020 2a2a 6b77 6172 6773 290a 0a20      **kwargs).. 
-00031420: 2020 2020 2020 2023 2041 646a 7573 7420         # Adjust 
-00031430: 6b77 6172 6773 2066 6f72 2070 6c6f 7474  kwargs for plott
-00031440: 696e 6720 7365 636f 6e64 2052 4f49 0a20  ing second ROI. 
-00031450: 2020 2020 2020 206b 7761 7267 735b 2261         kwargs["a
-00031460: 7822 5d20 3d20 7365 6c66 2e61 780a 2020  x"] = self.ax.  
-00031470: 2020 2020 2020 6b77 6172 6773 5b22 636f        kwargs["co
-00031480: 6c6f 7222 5d20 3d20 726f 6932 5f63 6f6c  lor"] = roi2_col
-00031490: 6f72 0a20 2020 2020 2020 206f 7468 6572  or.        other
-000314a0: 2e70 6c6f 7428 7368 6f77 3d46 616c 7365  .plot(show=False
-000314b0: 2c20 7669 6577 3d76 6965 772c 2070 6f73  , view=view, pos
-000314c0: 3d70 6f73 322c 2069 6e63 6c75 6465 5f69  =pos2, include_i
-000314d0: 6d61 6765 3d46 616c 7365 2c20 0a20 2020  mage=False, .   
-000314e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000314f0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-00031500: 2020 7365 6c66 2e61 782e 7365 745f 7469    self.ax.set_ti
-00031510: 746c 6528 7365 6c66 2e67 6574 5f63 6f6d  tle(self.get_com
-00031520: 7061 7269 736f 6e5f 6e61 6d65 286f 7468  parison_name(oth
-00031530: 6572 2929 0a0a 2020 2020 2020 2020 2320  er))..        # 
-00031540: 4372 6561 7465 206c 6567 656e 640a 2020  Create legend.  
-00031550: 2020 2020 2020 6966 206c 6567 656e 643a        if legend:
-00031560: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
-00031570: 745f 7479 7065 203d 206b 7761 7267 732e  t_type = kwargs.
-00031580: 6765 7428 2270 6c6f 745f 7479 7065 222c  get("plot_type",
-00031590: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-000315a0: 2020 2069 6620 706c 6f74 5f74 7970 6520     if plot_type 
-000315b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000315c0: 2020 2020 2020 2020 2070 6c6f 745f 7479           plot_ty
-000315d0: 7065 203d 206b 7761 7267 732e 6765 7428  pe = kwargs.get(
-000315e0: 2272 6f69 5f70 6c6f 745f 7479 7065 222c  "roi_plot_type",
-000315f0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-00031600: 2020 206c 696e 6577 6964 7468 203d 206b     linewidth = k
-00031610: 7761 7267 732e 6765 7428 226c 696e 6577  wargs.get("linew
-00031620: 6964 7468 222c 204e 6f6e 6529 0a20 2020  idth", None).   
-00031630: 2020 2020 2020 2020 206f 7061 6369 7479           opacity
-00031640: 203d 206b 7761 7267 732e 6765 7428 226f   = kwargs.get("o
-00031650: 7061 6369 7479 222c 204e 6f6e 6529 0a20  pacity", None). 
-00031660: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-00031670: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
-00031680: 2020 2020 2072 6f69 315f 6e61 6d65 203d       roi1_name =
-00031690: 206e 616d 6573 5b30 5d0a 2020 2020 2020   names[0].      
-000316a0: 2020 2020 2020 2020 2020 726f 6932 5f6e            roi2_n
-000316b0: 616d 6520 3d20 6e61 6d65 735b 315d 0a20  ame = names[1]. 
-000316c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000316d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000316e0: 2072 6f69 315f 6e61 6d65 203d 2073 656c   roi1_name = sel
-000316f0: 662e 6e61 6d65 0a20 2020 2020 2020 2020  f.name.         
-00031700: 2020 2020 2020 2072 6f69 325f 6e61 6d65         roi2_name
-00031710: 203d 206f 7468 6572 2e6e 616d 650a 2020   = other.name.  
-00031720: 2020 2020 2020 2020 2020 6861 6e64 6c65            handle
-00031730: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-00031740: 2020 2020 2020 7365 6c66 2e67 6574 5f70        self.get_p
-00031750: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
-00031760: 2020 2020 2020 2020 2020 706c 6f74 5f74            plot_t
-00031770: 7970 652c 2073 656c 662e 636f 6c6f 722c  ype, self.color,
-00031780: 206f 7061 6369 7479 2c20 6c69 6e65 7769   opacity, linewi
-00031790: 6474 682c 2072 6f69 315f 6e61 6d65 292c  dth, roi1_name),
-000317a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000317b0: 2073 656c 662e 6765 745f 7061 7463 6828   self.get_patch(
-000317c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000317d0: 2020 2020 2070 6c6f 745f 7479 7065 2c20       plot_type, 
-000317e0: 726f 6932 5f63 6f6c 6f72 2c20 6f70 6163  roi2_color, opac
-000317f0: 6974 792c 206c 696e 6577 6964 7468 2c20  ity, linewidth, 
-00031800: 726f 6932 5f6e 616d 6529 2c0a 2020 2020  roi2_name),.    
-00031810: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00031820: 2020 2020 2020 7365 6c66 2e61 782e 6c65        self.ax.le
-00031830: 6765 6e64 280a 2020 2020 2020 2020 2020  gend(.          
-00031840: 2020 2020 2020 6861 6e64 6c65 733d 6861        handles=ha
-00031850: 6e64 6c65 732c 2066 7261 6d65 616c 7068  ndles, framealph
-00031860: 613d 312c 2066 6163 6563 6f6c 6f72 3d22  a=1, facecolor="
-00031870: 7768 6974 6522 2c20 0a20 2020 2020 2020  white", .       
-00031880: 2020 2020 2020 2020 2062 626f 785f 746f           bbox_to
-00031890: 5f61 6e63 686f 723d 6c65 6765 6e64 5f62  _anchor=legend_b
-000318a0: 626f 785f 746f 5f61 6e63 686f 722c 206c  box_to_anchor, l
-000318b0: 6f63 3d6c 6567 656e 645f 6c6f 630a 2020  oc=legend_loc.  
-000318c0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000318d0: 2020 2020 2023 2053 686f 772f 7361 7665       # Show/save
-000318e0: 0a20 2020 2020 2020 2069 6620 7368 6f77  .        if show
-000318f0: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
-00031900: 742e 7368 6f77 2829 0a20 2020 2020 2020  t.show().       
-00031910: 2069 6620 7361 7665 5f61 733a 0a20 2020   if save_as:.   
-00031920: 2020 2020 2020 2020 2070 6c74 2e74 6967           plt.tig
-00031930: 6874 5f6c 6179 6f75 7428 290a 2020 2020  ht_layout().    
-00031940: 2020 2020 2020 2020 7365 6c66 2e66 6967          self.fig
-00031950: 2e73 6176 6566 6967 2873 6176 655f 6173  .savefig(save_as
-00031960: 290a 0a20 2020 2064 6566 2067 6574 5f61  )..    def get_a
-00031970: 7370 6563 745f 7261 7469 6f28 0a20 2020  spect_ratio(.   
-00031980: 2020 2020 2073 656c 662c 2076 6965 772c       self, view,
-00031990: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-000319a0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-000319b0: 2222 2247 6574 2061 7370 6563 7420 7261  """Get aspect ra
-000319c0: 7469 6f20 666f 7220 7468 6973 2073 7472  tio for this str
-000319d0: 7563 7475 7265 2069 6e20 6120 6769 7665  ucture in a give
-000319e0: 6e20 6f72 6965 6e74 6174 696f 6e2e 2222  n orientation.""
-000319f0: 220a 0a20 2020 2020 2020 2078 5f61 782c  "..        x_ax,
-00031a00: 2079 5f61 7820 3d20 736b 7274 2e69 6d61   y_ax = skrt.ima
-00031a10: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
-00031a20: 6577 5d0a 2020 2020 2020 2020 7265 7475  ew].        retu
-00031a30: 726e 2073 656c 662e 6765 745f 6c65 6e67  rn self.get_leng
-00031a40: 7468 2861 783d 736b 7274 2e69 6d61 6765  th(ax=skrt.image
-00031a50: 2e5f 6178 6573 5b78 5f61 785d 2920 5c0a  ._axes[x_ax]) \.
-00031a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031a70: 2f20 7365 6c66 2e67 6574 5f6c 656e 6774  / self.get_lengt
-00031a80: 6828 6178 3d73 6b72 742e 696d 6167 652e  h(ax=skrt.image.
-00031a90: 5f61 7865 735b 795f 6178 5d29 0a0a 2020  _axes[y_ax])..  
-00031aa0: 2020 6465 6620 7365 745f 6178 2873 656c    def set_ax(sel
-00031ab0: 662c 2070 6c6f 745f 7479 7065 2c20 696e  f, plot_type, in
-00031ac0: 636c 7564 655f 696d 6167 652c 202a 6172  clude_image, *ar
-00031ad0: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
-00031ae0: 2020 2020 2020 2022 2222 5365 7420 7570         """Set up
-00031af0: 2061 7865 732e 2222 220a 0a20 2020 2020   axes."""..     
-00031b00: 2020 2069 6620 706c 6f74 5f74 7970 6520     if plot_type 
-00031b10: 696e 205b 2263 6f6e 746f 7572 222c 2022  in ["contour", "
-00031b20: 6365 6e74 726f 6964 225d 2061 6e64 206e  centroid"] and n
-00031b30: 6f74 2069 6e63 6c75 6465 5f69 6d61 6765  ot include_image
-00031b40: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-00031b50: 7065 6374 5f67 6574 7465 7220 3d20 7365  pect_getter = se
-00031b60: 6c66 2e67 6574 5f61 7370 6563 745f 7261  lf.get_aspect_ra
-00031b70: 7469 6f0a 2020 2020 2020 2020 656c 7365  tio.        else
-00031b80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00031b90: 2073 656c 662e 696d 6167 6520 6973 206e   self.image is n
-00031ba0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00031bb0: 2020 2020 2020 2020 2061 7370 6563 745f           aspect_
-00031bc0: 6765 7474 6572 203d 2073 656c 662e 696d  getter = self.im
-00031bd0: 6167 652e 6765 745f 706c 6f74 5f61 7370  age.get_plot_asp
-00031be0: 6563 745f 7261 7469 6f0a 2020 2020 2020  ect_ratio.      
-00031bf0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00031c00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00031c10: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
-00031c20: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00031c30: 7370 6563 745f 6765 7474 6572 203d 2073  spect_getter = s
-00031c40: 656c 662e 6d61 736b 2e67 6574 5f70 6c6f  elf.mask.get_plo
-00031c50: 745f 6173 7065 6374 5f72 6174 696f 0a20  t_aspect_ratio. 
-00031c60: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
-00031c70: 652e 7365 745f 6178 2873 656c 662c 202a  e.set_ax(self, *
-00031c80: 6172 6773 2c20 6173 7065 6374 5f67 6574  args, aspect_get
-00031c90: 7465 723d 6173 7065 6374 5f67 6574 7465  ter=aspect_gette
-00031ca0: 722c 202a 2a6b 7761 7267 7329 0a0a 2020  r, **kwargs)..  
-00031cb0: 2020 6465 6620 6765 745f 7a6f 6f6d 5f63    def get_zoom_c
-00031cc0: 656e 7472 6528 7365 6c66 2c20 7669 6577  entre(self, view
-00031cd0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00031ce0: 7420 636f 6f72 6469 6e61 7465 7320 746f  t coordinates to
-00031cf0: 207a 6f6f 6d20 696e 206f 6e20 7468 6973   zoom in on this
-00031d00: 2052 4f49 2e22 2222 0a0a 2020 2020 2020   ROI."""..      
-00031d10: 2020 7a6f 6f6d 5f63 656e 7472 6520 3d20    zoom_centre = 
-00031d20: 5b4e 6f6e 652c 204e 6f6e 652c 204e 6f6e  [None, None, Non
-00031d30: 655d 0a20 2020 2020 2020 2078 5f61 782c  e].        x_ax,
-00031d40: 2079 5f61 7820 3d20 736b 7274 2e69 6d61   y_ax = skrt.ima
-00031d50: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
-00031d60: 6577 5d0a 2020 2020 2020 2020 782c 2079  ew].        x, y
-00031d70: 203d 2073 656c 662e 6765 745f 6365 6e74   = self.get_cent
-00031d80: 7265 2876 6965 773d 7669 6577 2c20 7369  re(view=view, si
-00031d90: 6e67 6c65 5f73 6c69 6365 3d54 7275 6529  ngle_slice=True)
-00031da0: 0a20 2020 2020 2020 207a 6f6f 6d5f 6365  .        zoom_ce
-00031db0: 6e74 7265 5b78 5f61 785d 203d 2078 0a20  ntre[x_ax] = x. 
-00031dc0: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
-00031dd0: 7265 5b79 5f61 785d 203d 2079 0a20 2020  re[y_ax] = y.   
-00031de0: 2020 2020 2072 6574 7572 6e20 7a6f 6f6d       return zoom
-00031df0: 5f63 656e 7472 650a 0a20 2020 2064 6566  _centre..    def
-00031e00: 2077 7269 7465 2873 656c 662c 206f 7574   write(self, out
-00031e10: 6e61 6d65 3d4e 6f6e 652c 206f 7574 6469  name=None, outdi
-00031e20: 723d 222e 222c 2065 7874 3d4e 6f6e 652c  r=".", ext=None,
-00031e30: 206f 7665 7277 7269 7465 3d46 616c 7365   overwrite=False
-00031e40: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
-00031e50: 6164 6572 5f73 6f75 7263 653d 4e6f 6e65  ader_source=None
-00031e60: 2c20 7061 7469 656e 745f 6964 3d4e 6f6e  , patient_id=Non
-00031e70: 652c 2072 6f6f 745f 7569 643d 4e6f 6e65  e, root_uid=None
-00031e80: 2c0a 2020 2020 2020 2020 2020 2020 7665  ,.            ve
-00031e90: 7262 6f73 653d 5472 7565 2c20 6865 6164  rbose=True, head
-00031ea0: 6572 5f65 7874 7261 733d 7b7d 2c20 6b65  er_extras={}, ke
-00031eb0: 6570 5f73 6f75 7263 655f 726f 6973 3d54  ep_source_rois=T
-00031ec0: 7275 652c 202a 2a6b 7761 7267 7329 3a0a  rue, **kwargs):.
-00031ed0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00031ee0: 6164 2829 0a0a 2020 2020 2020 2020 2320  ad()..        # 
-00031ef0: 4765 6e65 7261 7465 206f 7574 7075 7420  Generate output 
-00031f00: 6e61 6d65 2069 6620 6e6f 7420 6769 7665  name if not give
-00031f10: 6e0a 2020 2020 2020 2020 706f 7373 6962  n.        possib
-00031f20: 6c65 5f65 7874 203d 205b 222e 6463 6d22  le_ext = [".dcm"
-00031f30: 2c20 222e 6e69 692e 677a 222c 2022 2e6e  , ".nii.gz", ".n
-00031f40: 6969 222c 2022 2e6e 7079 222c 2022 2e74  ii", ".npy", ".t
-00031f50: 7874 225d 0a20 2020 2020 2020 2069 6620  xt"].        if 
-00031f60: 6578 7420 6973 206e 6f74 204e 6f6e 6520  ext is not None 
-00031f70: 616e 6420 6e6f 7420 6578 742e 7374 6172  and not ext.star
-00031f80: 7473 7769 7468 2822 2e22 293a 0a20 2020  tswith("."):.   
-00031f90: 2020 2020 2020 2020 2065 7874 203d 2066           ext = f
-00031fa0: 222e 7b65 7874 7d22 0a20 2020 2020 2020  ".{ext}".       
-00031fb0: 2069 6620 6f75 746e 616d 6520 6973 204e   if outname is N
-00031fc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00031fd0: 2069 6620 6578 7420 6973 204e 6f6e 653a   if ext is None:
-00031fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031ff0: 2065 7874 203d 2022 2e6e 6969 220a 2020   ext = ".nii".  
-00032000: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00032010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032020: 6966 2065 7874 206e 6f74 2069 6e20 706f  if ext not in po
-00032030: 7373 6962 6c65 5f65 7874 3a0a 2020 2020  ssible_ext:.    
-00032040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032050: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-00032060: 6f72 2866 2255 6e72 6563 6f67 6e69 7365  or(f"Unrecognise
-00032070: 6420 6669 6c65 2065 7874 656e 7369 6f6e  d file extension
-00032080: 3a20 7b65 7874 7d22 290a 2020 2020 2020  : {ext}").      
-00032090: 2020 2020 2020 6966 206e 6f74 2065 7874        if not ext
-000320a0: 2e73 7461 7274 7377 6974 6828 222e 2229  .startswith(".")
-000320b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000320c0: 2020 6578 7420 3d20 6622 2e7b 6578 747d    ext = f".{ext}
-000320d0: 220a 2020 2020 2020 2020 2020 2020 6f75  ".            ou
-000320e0: 746e 616d 6520 3d20 6622 7b6f 7574 6469  tname = f"{outdi
-000320f0: 727d 2f7b 7365 6c66 2e6e 616d 657d 7b65  r}/{self.name}{e
-00032100: 7874 7d22 0a0a 2020 2020 2020 2020 2320  xt}"..        # 
-00032110: 4f74 6865 7277 6973 652c 2069 6e66 6572  Otherwise, infer
-00032120: 2065 7874 656e 7369 6f6e 2066 726f 6d20   extension from 
-00032130: 6669 6c65 6e61 6d65 0a20 2020 2020 2020  filename.       
-00032140: 2065 6c73 653a 0a0a 2020 2020 2020 2020   else:..        
-00032150: 2020 2020 2320 4669 6e64 2061 6e79 206f      # Find any o
-00032160: 6620 7468 6520 7661 6c69 6420 6669 6c65  f the valid file
-00032170: 2065 7874 656e 7369 6f6e 730a 2020 2020   extensions.    
-00032180: 2020 2020 2020 2020 666f 7220 706f 7320          for pos 
-00032190: 696e 2070 6f73 7369 626c 655f 6578 743a  in possible_ext:
-000321a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000321b0: 2069 6620 6f75 746e 616d 652e 656e 6473   if outname.ends
-000321c0: 7769 7468 2870 6f73 293a 0a20 2020 2020  with(pos):.     
-000321d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000321e0: 7874 203d 2070 6f73 0a20 2020 2020 2020  xt = pos.       
-000321f0: 2020 2020 2069 6620 6578 7420 6e6f 7420       if ext not 
-00032200: 696e 2070 6f73 7369 626c 655f 6578 743a  in possible_ext:
-00032210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032220: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
-00032230: 726f 7228 6622 556e 7265 636f 676e 6973  ror(f"Unrecognis
-00032240: 6564 206f 7574 7075 7420 6669 6c65 2074  ed output file t
-00032250: 7970 653a 207b 6f75 746e 616d 657d 2229  ype: {outname}")
-00032260: 0a0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-00032270: 746e 616d 6520 3d20 6f73 2e70 6174 682e  tname = os.path.
-00032280: 6a6f 696e 286f 7574 6469 722c 206f 7574  join(outdir, out
-00032290: 6e61 6d65 290a 0a20 2020 2020 2020 2023  name)..        #
-000322a0: 2057 7269 7465 2070 6f69 6e74 7320 746f   Write points to
-000322b0: 2074 6578 7420 6669 6c65 2c20 696e 2066   text file, in f
-000322c0: 6f72 6d61 7420 7468 6174 2063 616e 2062  ormat that can b
-000322d0: 6520 7265 6164 2062 7920 7472 616e 7366  e read by transf
-000322e0: 6f72 6d69 780a 2020 2020 2020 2020 6966  ormix.        if
-000322f0: 2065 7874 203d 3d20 222e 7478 7422 3a0a   ext == ".txt":.
-00032300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00032310: 2e67 6574 5f63 6f6e 746f 7572 7328 290a  .get_contours().
-00032320: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
-00032330: 6e74 7320 3d20 5b5d 0a20 2020 2020 2020  nts = [].       
-00032340: 2020 2020 2066 6f72 207a 2c20 636f 6e74       for z, cont
-00032350: 6f75 7273 2069 6e20 7365 6c66 2e63 6f6e  ours in self.con
-00032360: 746f 7572 735b 2278 2d79 225d 2e69 7465  tours["x-y"].ite
-00032370: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00032380: 2020 2020 2020 666f 7220 6964 782c 2063        for idx, c
-00032390: 6f6e 746f 7572 2069 6e20 656e 756d 6572  ontour in enumer
-000323a0: 6174 6528 636f 6e74 6f75 7273 293a 0a20  ate(contours):. 
-000323b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000323c0: 2020 2066 6f72 2070 6f69 6e74 2069 6e20     for point in 
-000323d0: 636f 6e74 6f75 723a 0a20 2020 2020 2020  contour:.       
-000323e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000323f0: 2023 2041 6464 2074 6872 6565 2064 6967   # Add three dig
-00032400: 6974 7320 746f 2073 746f 7265 2074 6865  its to store the
-00032410: 2063 6f6e 746f 7572 2069 6e64 6578 2c0a   contour index,.
-00032420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032430: 2020 2020 2020 2020 2320 7768 6963 6820          # which 
-00032440: 6973 2075 6e6c 696b 656c 7920 746f 206e  is unlikely to n
-00032450: 6565 6420 6d6f 7265 2074 6861 6e20 6120  eed more than a 
-00032460: 7369 6e67 6c65 2064 6967 6974 2e0a 2020  single digit..  
-00032470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032480: 2020 2020 2020 2320 5468 6973 2068 6173        # This has
-00032490: 206e 6567 6c69 6769 626c 6520 6566 6665   negligible effe
-000324a0: 6374 206f 6e20 7072 6563 6973 696f 6e2c  ct on precision,
-000324b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000324c0: 2020 2020 2020 2020 2023 2061 6e64 2061           # and a
-000324d0: 6c6c 6f77 7320 636f 6e74 6f75 722d 706f  llows contour-po
-000324e0: 696e 7420 6173 736f 6369 6174 696f 6e73  int associations
-000324f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032500: 2020 2020 2020 2020 2023 2074 6f20 6265           # to be
-00032510: 2069 6465 6e74 6966 6965 6420 696e 2054   identified in T
-00032520: 7261 6e73 666f 726d 6978 206f 7574 7075  ransformix outpu
-00032530: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
-00032540: 2020 2020 2020 2020 2020 207a 5f6f 7574             z_out
-00032550: 203d 2066 227b 7a3a 2e33 667d 7b69 6478   = f"{z:.3f}{idx
-00032560: 3a30 337d 220a 2020 2020 2020 2020 2020  :03}".          
-00032570: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00032580: 696e 7473 2e61 7070 656e 6428 6622 7b70  ints.append(f"{p
-00032590: 6f69 6e74 5b30 5d3a 2e33 667d 207b 706f  oint[0]:.3f} {po
-000325a0: 696e 745b 315d 3a2e 3366 7d20 7b7a 5f6f  int[1]:.3f} {z_o
-000325b0: 7574 7d22 290a 0a20 2020 2020 2020 2020  ut}")..         
-000325c0: 2020 2077 6974 6820 6f70 656e 286f 7574     with open(out
-000325d0: 6e61 6d65 2c20 2277 2229 2061 7320 6669  name, "w") as fi
-000325e0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-000325f0: 2020 2020 6669 6c65 2e77 7269 7465 2822      file.write("
-00032600: 706f 696e 745c 6e22 290a 2020 2020 2020  point\n").      
-00032610: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
-00032620: 7269 7465 2866 227b 6c65 6e28 706f 696e  rite(f"{len(poin
-00032630: 7473 297d 5c6e 2229 0a20 2020 2020 2020  ts)}\n").       
-00032640: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-00032650: 6974 6528 225c 6e22 2e6a 6f69 6e28 706f  ite("\n".join(po
-00032660: 696e 7473 2929 0a0a 2020 2020 2020 2020  ints))..        
-00032670: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00032680: 2020 2020 2320 5772 6974 6520 6172 7261      # Write arra
-00032690: 7920 746f 206e 6966 7469 206f 7220 6e70  y to nifti or np
-000326a0: 790a 2020 2020 2020 2020 656c 6966 2065  y.        elif e
-000326b0: 7874 2021 3d20 222e 6463 6d22 3a0a 2020  xt != ".dcm":.  
-000326c0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-000326d0: 7265 6174 655f 6d61 736b 2829 0a20 2020  reate_mask().   
-000326e0: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
-000326f0: 736b 2e77 7269 7465 286f 7574 6e61 6d65  sk.write(outname
-00032700: 2c20 7665 7262 6f73 653d 7665 7262 6f73  , verbose=verbos
-00032710: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
-00032720: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00032730: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-00032740: 5f73 6f75 7263 6520 616e 6420 6b65 6570  _source and keep
-00032750: 5f73 6f75 7263 655f 726f 6973 3a0a 2020  _source_rois:.  
-00032760: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00032770: 7275 6374 7572 655f 7365 7420 3d20 5374  ructure_set = St
-00032780: 7275 6374 7572 6553 6574 2868 6561 6465  ructureSet(heade
-00032790: 725f 736f 7572 6365 290a 2020 2020 2020  r_source).      
-000327a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000327b0: 2020 2020 2020 2020 2020 2020 7374 7275              stru
-000327c0: 6374 7572 655f 7365 7420 3d20 5374 7275  cture_set = Stru
-000327d0: 6374 7572 6553 6574 2829 0a20 2020 2020  ctureSet().     
-000327e0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
-000327f0: 5f73 6574 2e61 6464 5f72 6f69 2873 656c  _set.add_roi(sel
-00032800: 6629 0a20 2020 2020 2020 2020 2020 2073  f).            s
-00032810: 7472 7563 7475 7265 5f73 6574 2e77 7269  tructure_set.wri
-00032820: 7465 286f 7574 6469 723d 6f75 7464 6972  te(outdir=outdir
-00032830: 2c20 6578 743d 6578 742c 206f 7665 7277  , ext=ext, overw
-00032840: 7269 7465 3d6f 7665 7277 7269 7465 2c0a  rite=overwrite,.
-00032850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032860: 2020 2020 6865 6164 6572 5f73 6f75 7263      header_sourc
-00032870: 653d 6865 6164 6572 5f73 6f75 7263 652c  e=header_source,
-00032880: 2070 6174 6965 6e74 5f69 643d 7061 7469   patient_id=pati
-00032890: 656e 745f 6964 2c0a 2020 2020 2020 2020  ent_id,.        
-000328a0: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-000328b0: 5f75 6964 3d72 6f6f 745f 7569 642c 2076  _uid=root_uid, v
-000328c0: 6572 626f 7365 3d76 6572 626f 7365 2c0a  erbose=verbose,.
-000328d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000328e0: 2020 2020 6865 6164 6572 5f65 7874 7261      header_extra
-000328f0: 733d 6865 6164 6572 5f65 7874 7261 7329  s=header_extras)
-00032900: 0a0a 2020 2020 6465 6620 7472 616e 7366  ..    def transf
-00032910: 6f72 6d28 7365 6c66 2c20 7363 616c 653d  orm(self, scale=
-00032920: 312c 2074 7261 6e73 6c61 7469 6f6e 3d5b  1, translation=[
-00032930: 302c 2030 2c20 305d 2c20 726f 7461 7469  0, 0, 0], rotati
-00032940: 6f6e 3d5b 302c 2030 2c20 305d 2c0a 2020  on=[0, 0, 0],.  
-00032950: 2020 2020 2020 2020 2020 6365 6e74 7265            centre
-00032960: 3d5b 302c 2030 2c20 305d 2c20 7265 7361  =[0, 0, 0], resa
-00032970: 6d70 6c65 3d22 6669 6e65 222c 2072 6573  mple="fine", res
-00032980: 746f 7265 3d54 7275 652c 200a 2020 2020  tore=True, .    
-00032990: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-000329a0: 7565 3d4e 6f6e 652c 2066 6f72 6365 5f63  ue=None, force_c
-000329b0: 6f6e 746f 7572 733d 4661 6c73 6529 3a0a  ontours=False):.
-000329c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000329d0: 2020 2020 4170 706c 7920 7468 7265 652d      Apply three-
-000329e0: 6469 6d65 6e73 696f 6e61 6c20 7369 6d69  dimensional simi
-000329f0: 6c61 7269 7479 2074 7261 6e73 666f 726d  larity transform
-00032a00: 2074 6f20 524f 492e 0a0a 2020 2020 2020   to ROI...      
-00032a10: 2020 4966 2074 6865 2074 7261 6e73 666f    If the transfo
-00032a20: 726d 2063 6f72 7265 7370 6f6e 6473 2074  rm corresponds t
-00032a30: 6f20 6120 7472 616e 736c 6174 696f 6e20  o a translation 
-00032a40: 616e 642f 6f72 2072 6f74 6174 696f 6e0a  and/or rotation.
-00032a50: 2020 2020 2020 2020 6162 6f75 7420 7468          about th
-00032a60: 6520 7a2d 6178 6973 2c20 616e 6420 6569  e z-axis, and ei
-00032a70: 7468 6572 2074 6865 2072 6f69 2073 6f75  ther the roi sou
-00032a80: 7263 6520 7479 7065 2069 7320 2264 6963  rce type is "dic
-00032a90: 6f6d 220a 2020 2020 2020 2020 6f72 2066  om".        or f
-00032aa0: 6f72 6365 2d63 6f6e 746f 7572 7320 6973  orce-contours is
-00032ab0: 2054 7275 652c 2074 6865 2074 7261 6e73   True, the trans
-00032ac0: 666f 726d 2069 7320 6170 706c 6965 6420  form is applied 
-00032ad0: 746f 2063 6f6e 746f 7572 0a20 2020 2020  to contour.     
-00032ae0: 2020 2070 6f69 6e74 7320 616e 6420 7468     points and th
-00032af0: 6520 726f 6920 6d61 736b 2069 7320 7365  e roi mask is se
-00032b00: 7420 6173 2075 6e6c 6f61 6465 642e 2020  t as unloaded.  
-00032b10: 4f74 6865 7277 6973 6520 7468 6520 7472  Otherwise the tr
-00032b20: 616e 7366 6f72 6d0a 2020 2020 2020 2020  ansform.        
-00032b30: 6973 2061 7070 6c69 6564 2074 6f20 7468  is applied to th
-00032b40: 6520 6d61 736b 2061 6e64 2063 6f6e 746f  e mask and conto
-00032b50: 7572 7320 6172 6520 7365 7420 6173 2075  urs are set as u
-00032b60: 6e6c 6f61 6465 642e 0a0a 2020 2020 2020  nloaded...      
-00032b70: 2020 5468 6520 7472 616e 7366 6f72 6d20    The transform 
-00032b80: 6973 2061 7070 6c69 6564 2069 6e20 7468  is applied in th
-00032b90: 6520 6f72 6465 723a 2074 7261 6e73 6c61  e order: transla
-00032ba0: 7469 6f6e 2c20 7363 616c 696e 672c 0a20  tion, scaling,. 
-00032bb0: 2020 2020 2020 2072 6f74 6174 696f 6e2e         rotation.
-00032bc0: 2020 5468 6520 6c61 7474 6572 2074 776f    The latter two
-00032bd0: 2061 7265 2061 626f 7574 2074 6865 2063   are about the c
-00032be0: 656e 7472 6520 636f 6f72 6469 6e61 7465  entre coordinate
-00032bf0: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
-00032c00: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-00032c10: 2020 2020 0a20 2020 2020 2020 2066 6f72      .        for
-00032c20: 6365 5f63 6f6e 746f 7572 7320 3a20 626f  ce_contours : bo
-00032c30: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-00032c40: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-00032c50: 2054 7275 652c 2061 6e64 2074 6865 2074   True, and the t
-00032c60: 7261 6e73 666f 726d 2063 6f72 7265 7370  ransform corresp
-00032c70: 6f6e 6473 2074 6f20 6120 7472 616e 736c  onds to a transl
-00032c80: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00032c90: 2020 616e 642f 6f72 2072 6f74 6174 696f    and/or rotatio
-00032ca0: 6e20 6162 6f75 7420 7468 6520 7a2d 6178  n about the z-ax
-00032cb0: 6973 2c20 6170 706c 7920 7472 616e 7366  is, apply transf
-00032cc0: 6f72 6d20 746f 2063 6f6e 746f 7572 0a20  orm to contour. 
-00032cd0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00032ce0: 7320 696e 6465 7065 6e64 656e 746c 7920  s independently 
-00032cf0: 6f66 2074 6865 206f 7269 6769 6e61 6c20  of the original 
-00032d00: 6461 7461 2073 6f75 7263 652e 0a0a 2020  data source...  
-00032d10: 2020 2020 2020 466f 7220 6f74 6865 7220        For other 
-00032d20: 7061 7261 6d65 7465 7273 2c20 7365 6520  parameters, see 
-00032d30: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
-00032d40: 720a 2020 2020 2020 2020 736b 7274 2e69  r.        skrt.i
-00032d50: 6d61 6765 2e49 6d61 6765 2e74 7261 6e73  mage.Image.trans
-00032d60: 666f 726d 2829 2e20 204e 6f74 6520 7468  form().  Note th
-00032d70: 6174 2074 6865 2060 606f 7264 6572 6060  at the ``order``
-00032d80: 0a20 2020 2020 2020 2070 6172 616d 6574  .        paramet
-00032d90: 6572 2069 736e 2774 2061 7661 696c 6162  er isn't availab
-00032da0: 6c65 2066 6f72 2072 6f69 2074 7261 6e73  le for roi trans
-00032db0: 666f 726d 7320 2d20 6120 7661 6c75 6520  forms - a value 
-00032dc0: 6f66 2030 0a20 2020 2020 2020 2069 7320  of 0.        is 
-00032dd0: 7573 6564 2061 6c77 6179 732e 0a20 2020  used always..   
-00032de0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00032df0: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
-00032e00: 7220 7472 616e 7366 6f72 6d20 6973 2074  r transform is t
-00032e10: 6f20 6265 2061 7070 6c69 6564 2074 6f20  o be applied to 
-00032e20: 636f 6e74 6f75 7273 0a20 2020 2020 2020  contours.       
-00032e30: 2073 6d61 6c6c 5f6e 756d 6265 7220 3d20   small_number = 
-00032e40: 312e 652d 360a 2020 2020 2020 2020 7472  1.e-6.        tr
-00032e50: 616e 7366 6f72 6d5f 636f 6e74 6f75 7273  ansform_contours
-00032e60: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00032e70: 2069 6620 7365 6c66 2e73 6f75 7263 655f   if self.source_
-00032e80: 7479 7065 203d 3d20 2763 6f6e 746f 7572  type == 'contour
-00032e90: 2720 6f72 2066 6f72 6365 5f63 6f6e 746f  ' or force_conto
-00032ea0: 7572 733a 0a20 2020 2020 2020 2020 2020  urs:.           
-00032eb0: 2069 6620 6162 7328 7363 616c 6520 2d20   if abs(scale - 
-00032ec0: 3129 203c 2073 6d61 6c6c 5f6e 756d 6265  1) < small_numbe
-00032ed0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00032ee0: 2020 2069 6620 6162 7328 726f 7461 7469     if abs(rotati
-00032ef0: 6f6e 5b30 5d29 203c 2073 6d61 6c6c 5f6e  on[0]) < small_n
-00032f00: 756d 6265 7220 5c0a 2020 2020 2020 2020  umber \.        
-00032f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032f20: 616e 6420 6162 7328 726f 7461 7469 6f6e  and abs(rotation
-00032f30: 5b31 5d29 203c 2073 6d61 6c6c 5f6e 756d  [1]) < small_num
-00032f40: 6265 723a 0a20 2020 2020 2020 2020 2020  ber:.           
-00032f50: 2020 2020 2020 2020 2074 7261 6e73 666f           transfo
-00032f60: 726d 5f63 6f6e 746f 7572 7320 3d20 5472  rm_contours = Tr
-00032f70: 7565 0a0a 2020 2020 2020 2020 6966 2074  ue..        if t
-00032f80: 7261 6e73 666f 726d 5f63 6f6e 746f 7572  ransform_contour
-00032f90: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
-00032fa0: 2320 4170 706c 7920 7472 616e 7366 6f72  # Apply transfor
-00032fb0: 6d20 746f 2072 6f69 2063 6f6e 746f 7572  m to roi contour
-00032fc0: 730a 2020 2020 2020 2020 2020 2020 7472  s.            tr
-00032fd0: 616e 736c 6174 696f 6e5f 3264 203d 2028  anslation_2d = (
-00032fe0: 7472 616e 736c 6174 696f 6e5b 305d 2c20  translation[0], 
-00032ff0: 7472 616e 736c 6174 696f 6e5b 315d 290a  translation[1]).
-00033000: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-00033010: 7265 5f32 6420 3d20 2863 656e 7472 655b  re_2d = (centre[
-00033020: 305d 2c20 6365 6e74 7265 5b31 5d29 0a20  0], centre[1]). 
-00033030: 2020 2020 2020 2020 2020 2061 6e67 6c65             angle
-00033040: 203d 2072 6f74 6174 696f 6e5b 325d 0a20   = rotation[2]. 
-00033050: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
-00033060: 6f6e 746f 7572 7320 3d20 7b7d 0a20 2020  ontours = {}.   
-00033070: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
-00033080: 2c20 636f 6e74 6f75 7273 2069 6e20 7365  , contours in se
-00033090: 6c66 2e67 6574 5f63 6f6e 746f 7572 7328  lf.get_contours(
-000330a0: 292e 6974 656d 7328 293a 0a20 2020 2020  ).items():.     
-000330b0: 2020 2020 2020 2020 2020 206e 6577 5f6b             new_k
-000330c0: 6579 203d 206b 6579 202b 2074 7261 6e73  ey = key + trans
-000330d0: 6c61 7469 6f6e 5b32 5d0a 2020 2020 2020  lation[2].      
-000330e0: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
-000330f0: 6e74 6f75 7273 5b6e 6577 5f6b 6579 5d20  ntours[new_key] 
-00033100: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00033110: 2020 2020 2066 6f72 2063 6f6e 746f 7572       for contour
-00033120: 2069 6e20 636f 6e74 6f75 7273 3a0a 2020   in contours:.  
-00033130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033140: 2020 6966 206c 656e 2863 6f6e 746f 7572    if len(contour
-00033150: 2920 3c20 333a 0a20 2020 2020 2020 2020  ) < 3:.         
-00033160: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00033170: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00033180: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-00033190: 676f 6e20 3d20 636f 6e74 6f75 725f 746f  gon = contour_to
-000331a0: 5f70 6f6c 7967 6f6e 2863 6f6e 746f 7572  _polygon(contour
-000331b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000331c0: 2020 2020 2020 706f 6c79 676f 6e20 3d20        polygon = 
-000331d0: 6166 6669 6e69 7479 2e74 7261 6e73 6c61  affinity.transla
-000331e0: 7465 2870 6f6c 7967 6f6e 2c20 2a74 7261  te(polygon, *tra
-000331f0: 6e73 6c61 7469 6f6e 5f32 6429 0a20 2020  nslation_2d).   
-00033200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033210: 2070 6f6c 7967 6f6e 203d 2061 6666 696e   polygon = affin
-00033220: 6974 792e 726f 7461 7465 2870 6f6c 7967  ity.rotate(polyg
-00033230: 6f6e 2c20 616e 676c 652c 2063 656e 7472  on, angle, centr
-00033240: 655f 3264 290a 2020 2020 2020 2020 2020  e_2d).          
-00033250: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
-00033260: 6e20 3d20 6166 6669 6e69 7479 2e73 6361  n = affinity.sca
-00033270: 6c65 2870 6f6c 7967 6f6e 2c20 7363 616c  le(polygon, scal
-00033280: 652c 2073 6361 6c65 2c20 7363 616c 652c  e, scale, scale,
-00033290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000332a0: 2020 2020 2020 2020 2020 2020 2063 656e               cen
-000332b0: 7472 655f 3264 290a 2020 2020 2020 2020  tre_2d).        
-000332c0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000332d0: 636f 6e74 6f75 7273 5b6e 6577 5f6b 6579  contours[new_key
-000332e0: 5d2e 6170 7065 6e64 2870 6f6c 7967 6f6e  ].append(polygon
-000332f0: 5f74 6f5f 636f 6e74 6f75 7228 706f 6c79  _to_contour(poly
-00033300: 676f 6e29 290a 2020 2020 2020 2020 2020  gon)).          
-00033310: 2020 2020 2020 6966 206e 6f74 206e 6577        if not new
-00033320: 5f63 6f6e 746f 7572 735b 6e65 775f 6b65  _contours[new_ke
-00033330: 795d 3a0a 2020 2020 2020 2020 2020 2020  y]:.            
-00033340: 2020 2020 2020 2020 6e65 775f 636f 6e74          new_cont
-00033350: 6f75 7273 2e70 6f70 286e 6577 5f6b 6579  ours.pop(new_key
-00033360: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00033370: 656c 662e 7265 7365 745f 636f 6e74 6f75  elf.reset_contou
-00033380: 7273 286e 6577 5f63 6f6e 746f 7572 7329  rs(new_contours)
-00033390: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
-000333a0: 2020 2020 2020 2020 2020 2020 2320 4170              # Ap
-000333b0: 706c 7920 7472 616e 7366 6f72 6d20 746f  ply transform to
-000333c0: 2072 6f69 206d 6173 6b0a 2020 2020 2020   roi mask.      
-000333d0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-000333e0: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
-000333f0: 2020 2020 2073 656c 662e 6d61 736b 2e74       self.mask.t
-00033400: 7261 6e73 666f 726d 2873 6361 6c65 2c20  ransform(scale, 
-00033410: 7472 616e 736c 6174 696f 6e2c 2072 6f74  translation, rot
-00033420: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-00033430: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-00033440: 652c 2072 6573 616d 706c 652c 2072 6573  e, resample, res
-00033450: 746f 7265 2c20 302c 2066 696c 6c5f 7661  tore, 0, fill_va
-00033460: 6c75 6529 0a20 2020 2020 2020 2020 2020  lue).           
-00033470: 2073 656c 662e 7265 7365 745f 6d61 736b   self.reset_mask
-00033480: 2829 0a0a 2020 2020 6465 6620 6372 6f70  ()..    def crop
-00033490: 2873 656c 662c 2078 6c69 6d3d 4e6f 6e65  (self, xlim=None
-000334a0: 2c20 796c 696d 3d4e 6f6e 652c 207a 6c69  , ylim=None, zli
-000334b0: 6d3d 4e6f 6e65 293a 0a20 2020 2020 2020  m=None):.       
-000334c0: 2022 2222 0a20 2020 2020 2020 2043 726f   """.        Cro
-000334d0: 7020 524f 4920 746f 2073 7065 6369 6669  p ROI to specifi
-000334e0: 6564 2072 616e 6765 2069 6e20 782c 2079  ed range in x, y
-000334f0: 2c20 7a2e 0a0a 2020 2020 2020 2020 2a2a  , z...        **
-00033500: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-00033510: 2020 2020 2020 2078 6c69 6d20 3a20 7475         xlim : tu
-00033520: 706c 652c 2064 6566 6175 6c74 3d4e 6f6e  ple, default=Non
-00033530: 650a 2020 2020 2020 2020 2020 2020 4c6f  e.            Lo
-00033540: 7765 7220 616e 6420 7570 7065 7220 626f  wer and upper bo
-00033550: 756e 6473 2069 6e20 6d6d 2066 6f72 2063  unds in mm for c
-00033560: 726f 7070 696e 6720 616c 6f6e 6720 782d  ropping along x-
-00033570: 6178 6973 2e0a 2020 2020 2020 2020 2020  axis..          
-00033580: 2020 4966 2073 6574 2074 6f20 4e6f 6e65    If set to None
-00033590: 2c20 6e6f 2063 726f 7070 696e 6720 6973  , no cropping is
-000335a0: 2070 6572 666f 726d 6564 2e20 2049 6620   performed.  If 
-000335b0: 6120 626f 756e 640a 2020 2020 2020 2020  a bound.        
-000335c0: 2020 2020 6973 2073 6574 2074 6f20 4e6f      is set to No
-000335d0: 6e65 2c20 7468 6174 2062 6f75 6e64 2069  ne, that bound i
-000335e0: 7320 6469 7372 6567 6172 6465 642e 0a0a  s disregarded...
-000335f0: 2020 2020 2020 2020 796c 696d 203a 2074          ylim : t
-00033600: 7570 6c65 2c20 6465 6661 756c 743d 4e6f  uple, default=No
-00033610: 6e65 0a20 2020 2020 2020 2020 2020 204c  ne.            L
-00033620: 6f77 6572 2061 6e64 2075 7070 6572 2062  ower and upper b
-00033630: 6f75 6e64 7320 696e 206d 6d20 666f 7220  ounds in mm for 
-00033640: 6372 6f70 7069 6e67 2061 6c6f 6e67 2079  cropping along y
-00033650: 2d61 7869 732e 0a20 2020 2020 2020 2020  -axis..         
-00033660: 2020 2049 6620 7365 7420 746f 204e 6f6e     If set to Non
-00033670: 652c 206e 6f20 6372 6f70 7069 6e67 2069  e, no cropping i
-00033680: 7320 7065 7266 6f72 6d65 642e 2020 4966  s performed.  If
-00033690: 2061 2062 6f75 6e64 0a20 2020 2020 2020   a bound.       
-000336a0: 2020 2020 2069 7320 7365 7420 746f 204e       is set to N
-000336b0: 6f6e 652c 2074 6861 7420 626f 756e 6420  one, that bound 
-000336c0: 6973 2064 6973 7265 6761 7264 6564 2e0a  is disregarded..
-000336d0: 0a20 2020 2020 2020 207a 6c69 6d20 3a20  .        zlim : 
-000336e0: 7475 706c 652c 2064 6566 6175 6c74 3d4e  tuple, default=N
-000336f0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00033700: 4c6f 7765 7220 616e 6420 7570 7065 7220  Lower and upper 
-00033710: 626f 756e 6473 2069 6e20 6d6d 2066 6f72  bounds in mm for
-00033720: 2063 726f 7070 696e 6720 616c 6f6e 6720   cropping along 
-00033730: 7a2d 6178 6973 2e0a 2020 2020 2020 2020  z-axis..        
-00033740: 2020 2020 4966 2073 6574 2074 6f20 4e6f      If set to No
-00033750: 6e65 2c20 6e6f 2063 726f 7070 696e 6720  ne, no cropping 
-00033760: 6973 2070 6572 666f 726d 6564 2e20 2049  is performed.  I
-00033770: 6620 6120 626f 756e 640a 2020 2020 2020  f a bound.      
-00033780: 2020 2020 2020 6973 2073 6574 2074 6f20        is set to 
-00033790: 4e6f 6e65 2c20 7468 6174 2062 6f75 6e64  None, that bound
-000337a0: 2069 7320 6469 7372 6567 6172 6465 642e   is disregarded.
-000337b0: 0a0a 2020 2020 2020 2020 4966 206f 6e6c  ..        If onl
-000337c0: 7920 7a6c 696d 2069 7320 6e6f 7420 7365  y zlim is not se
-000337d0: 7420 746f 204e 6f6e 6520 616e 6420 7468  t to None and th
-000337e0: 6520 524f 4920 736f 7572 6365 2074 7970  e ROI source typ
-000337f0: 6520 6973 2022 636f 6e74 6f75 7222 2c0a  e is "contour",.
-00033800: 2020 2020 2020 2020 6372 6f70 7069 6e67          cropping
-00033810: 2069 7320 7065 7266 6f72 6d65 6420 6279   is performed by
-00033820: 2064 6973 6361 7264 696e 6720 636f 6e74   discarding cont
-00033830: 6f75 7273 206f 7574 7369 6465 2074 6865  ours outside the
-00033840: 2072 6571 7569 7265 640a 2020 2020 2020   required.      
-00033850: 2020 7261 6e67 652e 2020 4f74 6877 6973    range.  Othwis
-00033860: 6520 6372 6f70 7069 6e67 2069 7320 7065  e cropping is pe
-00033870: 7266 6f72 6d65 6420 6f6e 2074 6865 2052  rformed on the R
-00033880: 4f49 206d 6173 6b2e 0a20 2020 2020 2020  OI mask..       
-00033890: 2022 2222 0a20 2020 2020 2020 2023 2046   """.        # F
-000338a0: 6f72 2063 726f 7070 696e 6720 616c 6f6e  or cropping alon
-000338b0: 6720 7a2c 2061 6e64 2077 6865 7265 2052  g z, and where R
-000338c0: 4f49 2069 7320 6465 6669 6e65 6420 6672  OI is defined fr
-000338d0: 6f6d 2063 6f6e 746f 7572 732c 0a20 2020  om contours,.   
-000338e0: 2020 2020 2023 2064 6973 6361 7264 2063       # discard c
-000338f0: 6f6e 746f 7572 7320 6f75 7473 6964 6520  ontours outside 
-00033900: 6372 6f70 2072 616e 6765 2e0a 2020 2020  crop range..    
-00033910: 2020 2020 6966 2073 656c 662e 736f 7572      if self.sour
-00033920: 6365 5f74 7970 6520 3d3d 2022 636f 6e74  ce_type == "cont
-00033930: 6f75 7222 2061 6e64 207a 6c69 6d20 616e  our" and zlim an
-00033940: 6420 6e6f 7420 786c 696d 2061 6e64 206e  d not xlim and n
-00033950: 6f74 2079 6c69 6d3a 0a20 2020 2020 2020  ot ylim:.       
-00033960: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
-00033970: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
-00033980: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00033990: 6966 207a 6c69 6d5b 305d 2069 7320 4e6f  if zlim[0] is No
-000339a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000339b0: 2020 2020 7a6c 696d 5b30 5d20 3d20 6d69      zlim[0] = mi
-000339c0: 6e28 636f 6e74 6f75 7273 2920 2d20 310a  n(contours) - 1.
-000339d0: 2020 2020 2020 2020 2020 2020 6966 207a              if z
-000339e0: 6c69 6d5b 315d 2069 7320 4e6f 6e65 3a0a  lim[1] is None:.
-000339f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033a00: 7a6c 696d 5b31 5d20 3d20 6d61 7828 636f  zlim[1] = max(co
-00033a10: 6e74 6f75 7273 2920 2b20 310a 2020 2020  ntours) + 1.    
-00033a20: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
-00033a30: 203d 207b 7a3a 207a 5f63 6f6e 746f 7572   = {z: z_contour
-00033a40: 7320 666f 7220 7a2c 207a 5f63 6f6e 746f  s for z, z_conto
-00033a50: 7572 7320 696e 2063 6f6e 746f 7572 732e  urs in contours.
-00033a60: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
-00033a70: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00033a80: 7a20 3e20 7a6c 696d 5b30 5d20 616e 6420  z > zlim[0] and 
-00033a90: 7a20 3c20 7a6c 696d 5b31 5d29 7d0a 0a20  z < zlim[1])}.. 
-00033aa0: 2020 2020 2020 2020 2020 2023 2052 6573             # Res
-00033ab0: 6574 2063 6f6e 746f 7572 732e 0a20 2020  et contours..   
-00033ac0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-00033ad0: 7365 745f 636f 6e74 6f75 7273 2863 6f6e  set_contours(con
-00033ae0: 746f 7572 7329 0a0a 2020 2020 2020 2020  tours)..        
-00033af0: 2320 466f 7220 616c 6c20 6f74 6865 7220  # For all other 
-00033b00: 6361 7365 732c 2066 726f 7020 524f 4920  cases, frop ROI 
-00033b10: 6d61 736b 2e0a 2020 2020 2020 2020 656c  mask..        el
-00033b20: 6966 2078 6c69 6d20 6f72 2079 6c69 6d20  if xlim or ylim 
-00033b30: 6f72 207a 6c69 6d3a 0a20 2020 2020 2020  or zlim:.       
-00033b40: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
-00033b50: 5f6d 6173 6b28 290a 2020 2020 2020 2020  _mask().        
-00033b60: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00033b70: 2023 2045 6e73 7572 6520 7468 6174 2063   # Ensure that c
-00033b80: 726f 7020 7261 6e67 6520 616c 6f6e 6720  rop range along 
-00033b90: 6561 6368 2061 7869 7320 6973 204e 6f6e  each axis is Non
-00033ba0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-00033bb0: 6f72 2061 2074 776f 2d65 6c65 6d65 6e74  or a two-element
-00033bc0: 2074 7570 6c65 206f 6620 666c 6f61 7473   tuple of floats
-00033bd0: 2e0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
-00033be0: 6d73 203d 205b 786c 696d 2c20 796c 696d  ms = [xlim, ylim
-00033bf0: 2c20 7a6c 696d 5d0a 2020 2020 2020 2020  , zlim].        
-00033c00: 2020 2020 6d61 736b 5f65 7874 656e 7473      mask_extents
-00033c10: 203d 2073 656c 662e 6d61 736b 2e67 6574   = self.mask.get
-00033c20: 5f65 7874 656e 7473 2829 0a20 2020 2020  _extents().     
-00033c30: 2020 2020 2020 2066 6f72 2069 5f61 782c         for i_ax,
-00033c40: 206c 696d 2069 6e20 656e 756d 6572 6174   lim in enumerat
-00033c50: 6528 6c69 6d73 293a 0a20 2020 2020 2020  e(lims):.       
-00033c60: 2020 2020 2020 2020 2069 6620 6c69 6d3a           if lim:
-00033c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033c80: 2020 2020 2066 6f72 2069 6478 2069 6e20       for idx in 
-00033c90: 5b30 2c20 315d 3a0a 2020 2020 2020 2020  [0, 1]:.        
-00033ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033cb0: 6966 206c 696d 5b69 6478 5d20 6973 204e  if lim[idx] is N
-00033cc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00033cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033ce0: 206c 696d 735b 695f 6178 5d5b 6964 785d   lims[i_ax][idx]
-00033cf0: 203d 206d 6173 6b5f 6578 7465 6e74 735b   = mask_extents[
-00033d00: 695f 6178 5d5b 6964 785d 0a20 2020 2020  i_ax][idx].     
-00033d10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00033d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033d30: 2020 2020 206c 696d 735b 695f 6178 5d20       lims[i_ax] 
-00033d40: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
-00033d50: 2020 2020 2320 4c6f 6f70 206f 7665 7220      # Loop over 
-00033d60: 6178 6573 2e0a 2020 2020 2020 2020 2020  axes..          
-00033d70: 2020 666f 7220 695f 6178 2c20 6c69 6d20    for i_ax, lim 
-00033d80: 696e 2065 6e75 6d65 7261 7465 286c 696d  in enumerate(lim
-00033d90: 7329 3a0a 0a20 2020 2020 2020 2020 2020  s):..           
-00033da0: 2020 2020 2069 6620 6c69 6d20 6973 204e       if lim is N
-00033db0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00033dc0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00033dd0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00033de0: 2020 2023 2046 696e 6420 6172 7261 7920     # Find array 
-00033df0: 696e 6469 6365 7320 6174 2077 6869 6368  indices at which
-00033e00: 2074 6f20 6372 6f70 2e0a 2020 2020 2020   to crop..      
-00033e10: 2020 2020 2020 2020 2020 6931 203d 2073            i1 = s
-00033e20: 656c 662e 6d61 736b 2e70 6f73 5f74 6f5f  elf.mask.pos_to_
-00033e30: 6964 7828 0a20 2020 2020 2020 2020 2020  idx(.           
-00033e40: 2020 2020 2020 2020 2020 2020 206c 696d               lim
-00033e50: 735b 695f 6178 5d5b 305d 2c20 6178 3d69  s[i_ax][0], ax=i
-00033e60: 5f61 782c 2072 6574 7572 6e5f 696e 743d  _ax, return_int=
-00033e70: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00033e80: 2020 2020 2020 2069 3220 3d20 7365 6c66         i2 = self
-00033e90: 2e6d 6173 6b2e 706f 735f 746f 5f69 6478  .mask.pos_to_idx
-00033ea0: 286c 696d 735b 695f 6178 5d5b 315d 2c20  (lims[i_ax][1], 
-00033eb0: 6178 3d69 5f61 782c 0a20 2020 2020 2020  ax=i_ax,.       
-00033ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033ed0: 2072 6574 7572 6e5f 696e 743d 4661 6c73   return_int=Fals
-00033ee0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00033ef0: 2020 2069 5f62 6967 2c20 695f 736d 616c     i_big, i_smal
-00033f00: 6c20 3d20 6932 2c20 6931 0a20 2020 2020  l = i2, i1.     
-00033f10: 2020 2020 2020 2020 2020 2069 6620 6931             if i1
-00033f20: 203e 2069 323a 0a20 2020 2020 2020 2020   > i2:.         
-00033f30: 2020 2020 2020 2020 2020 2069 5f62 6967             i_big
-00033f40: 2c20 695f 736d 616c 6c20 3d20 695f 736d  , i_small = i_sm
-00033f50: 616c 6c2c 2069 5f62 6967 0a20 2020 2020  all, i_big.     
-00033f60: 2020 2020 2020 2020 2020 2069 5f73 6d61             i_sma
-00033f70: 6c6c 203d 2069 6e74 286e 702e 666c 6f6f  ll = int(np.floo
-00033f80: 7228 695f 736d 616c 6c20 2b20 302e 3529  r(i_small + 0.5)
-00033f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00033fa0: 2020 695f 6269 6720 3d20 696e 7428 6e70    i_big = int(np
-00033fb0: 2e66 6c6f 6f72 2869 5f62 6967 202b 2030  .floor(i_big + 0
-00033fc0: 2e35 2929 0a0a 2020 2020 2020 2020 2020  .5))..          
-00033fd0: 2020 2020 2020 2320 4372 6f70 2074 6865        # Crop the
-00033fe0: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
-00033ff0: 2020 2020 2020 2061 785f 746f 5f73 6c69         ax_to_sli
-00034000: 6365 203d 2073 656c 662e 6d61 736b 2e67  ce = self.mask.g
-00034010: 6574 5f61 7865 7328 292e 696e 6465 7828  et_axes().index(
-00034020: 695f 6178 290a 2020 2020 2020 2020 2020  i_ax).          
-00034030: 2020 2020 2020 6966 2069 5f73 6d61 6c6c        if i_small
-00034040: 203e 2030 2061 6e64 2069 5f73 6d61 6c6c   > 0 and i_small
-00034050: 203c 2073 656c 662e 6d61 736b 2e6e 5f76   < self.mask.n_v
-00034060: 6f78 656c 735b 695f 6178 5d3a 0a20 2020  oxels[i_ax]:.   
-00034070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034080: 2073 656c 662e 6d61 736b 2e64 6174 612e   self.mask.data.
-00034090: 7377 6170 6178 6573 2830 2c20 6178 5f74  swapaxes(0, ax_t
-000340a0: 6f5f 736c 6963 6529 5b3a 695f 736d 616c  o_slice)[:i_smal
-000340b0: 6c2c 203a 2c20 3a5d 203d 2030 0a20 2020  l, :, :] = 0.   
-000340c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000340d0: 695f 6269 6720 3e20 3020 616e 6420 695f  i_big > 0 and i_
-000340e0: 6269 6720 3c20 7365 6c66 2e6d 6173 6b2e  big < self.mask.
-000340f0: 6e5f 766f 7865 6c73 5b69 5f61 785d 3a0a  n_voxels[i_ax]:.
-00034100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034110: 2020 2020 7365 6c66 2e6d 6173 6b2e 6461      self.mask.da
-00034120: 7461 2e73 7761 7061 7865 7328 302c 2061  ta.swapaxes(0, a
-00034130: 785f 746f 5f73 6c69 6365 295b 695f 6269  x_to_slice)[i_bi
-00034140: 673a 2c20 3a2c 203a 5d20 3d20 300a 0a20  g:, :, :] = 0.. 
-00034150: 2020 2020 2020 2020 2020 2023 2052 6573             # Res
-00034160: 6574 206d 6173 6b2e 0a20 2020 2020 2020  et mask..       
-00034170: 2020 2020 2073 656c 662e 7265 7365 745f       self.reset_
-00034180: 6d61 736b 2873 656c 662e 6d61 736b 290a  mask(self.mask).
-00034190: 0a20 2020 2064 6566 2063 726f 705f 6279  .    def crop_by
-000341a0: 5f61 6d6f 756e 7473 2873 656c 662c 2064  _amounts(self, d
-000341b0: 783d 4e6f 6e65 2c20 6479 3d4e 6f6e 652c  x=None, dy=None,
-000341c0: 2064 7a3d 4e6f 6e65 293a 0a20 2020 2020   dz=None):.     
-000341d0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-000341e0: 726f 7020 524f 4920 6279 2074 6865 2061  rop ROI by the a
-000341f0: 6d6f 756e 7473 2064 782c 2064 792c 2064  mounts dx, dy, d
-00034200: 7a20 696e 206d 6d2e 0a0a 2020 2020 2020  z in mm...      
-00034210: 2020 5468 6973 206d 6574 686f 6420 6361    This method ca
-00034220: 6c6c 7320 7468 6520 6675 6e63 7469 6f6e  lls the function
-00034230: 2073 6b72 742e 696d 6167 652e 6372 6f70   skrt.image.crop
-00034240: 5f62 795f 616d 6f75 6e74 7328 292c 2077  _by_amounts(), w
-00034250: 6974 680a 2020 2020 2020 2020 7365 6c66  ith.        self
-00034260: 2070 6173 7365 6420 6173 206f 626a 6563   passed as objec
-00034270: 7420 666f 7220 6372 6f70 7069 6e67 2e0a  t for cropping..
-00034280: 0a20 2020 2020 2020 2054 6865 2061 6d6f  .        The amo
-00034290: 756e 7420 6f66 2063 726f 7070 696e 6720  unt of cropping 
-000342a0: 616c 6f6e 6720 6561 6368 2064 6972 6563  along each direc
-000342b0: 7469 6f6e 2073 686f 756c 6420 6265 206f  tion should be o
-000342c0: 6e65 206f 663a 0a20 2020 2020 2020 202d  ne of:.        -
-000342d0: 2066 6c6f 6174 203a 2074 6865 2052 4f49   float : the ROI
-000342e0: 2069 7320 6372 6f70 7065 6420 6279 2074   is cropped by t
-000342f0: 6869 7320 616d 6f75 6e74 206f 6e20 626f  his amount on bo
-00034300: 7468 2073 6964 6573 3b0a 2020 2020 2020  th sides;.      
-00034310: 2020 2d20 7477 6f2d 656c 656d 656e 7420    - two-element 
-00034320: 7475 706c 653a 2074 6865 2052 4f49 2069  tuple: the ROI i
-00034330: 7320 6372 6f70 7065 6420 6f6e 2074 6865  s cropped on the
-00034340: 2073 6964 6573 206f 6620 6c6f 7765 720a   sides of lower.
-00034350: 2020 2020 2020 2020 2020 616e 6420 6869            and hi
-00034360: 6768 6572 2076 616c 7565 7320 6279 2074  gher values by t
-00034370: 6865 2061 6d6f 756e 7473 2073 7065 6369  he amounts speci
-00034380: 6669 6564 3b0a 2020 2020 2020 2020 2d20  fied;.        - 
-00034390: 4e6f 6e65 203a 206e 6f20 6372 6f70 7069  None : no croppi
-000343a0: 6e67 2069 7320 7065 7266 6f72 6d65 642e  ng is performed.
-000343b0: 0a0a 2020 2020 2020 2020 466f 7220 6d6f  ..        For mo
-000343c0: 7265 2064 6574 6169 6c73 2c20 7365 6520  re details, see 
-000343d0: 646f 6375 6d65 6e74 6174 696f 6e20 6f66  documentation of
-000343e0: 2073 6b72 742e 696d 6167 652e 6372 6f70   skrt.image.crop
-000343f0: 5f62 795f 616d 6f75 6e74 7328 292e 0a20  _by_amounts().. 
-00034400: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00034410: 2020 2073 6b72 742e 696d 6167 652e 6372     skrt.image.cr
-00034420: 6f70 5f62 795f 616d 6f75 6e74 7328 7365  op_by_amounts(se
-00034430: 6c66 2c20 6478 2c20 6479 2c20 647a 290a  lf, dx, dy, dz).
-00034440: 0a20 2020 2064 6566 2063 726f 705f 746f  .    def crop_to
-00034450: 5f72 6f69 5f6c 656e 6774 6828 7365 6c66  _roi_length(self
-00034460: 2c20 6f74 6865 722c 2061 783d 227a 2229  , other, ax="z")
-00034470: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00034480: 2020 2020 2020 4372 6f70 2074 6f20 6c65        Crop to le
-00034490: 6e67 7468 206f 6620 6f74 6865 7220 524f  ngth of other RO
-000344a0: 4920 616c 6f6e 6720 6120 6769 7665 6e20  I along a given 
-000344b0: 6178 6973 2e0a 0a20 2020 2020 2020 202a  axis...        *
-000344c0: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
-000344d0: 2020 2020 2020 206f 7468 6572 203a 2073         other : s
-000344e0: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
-000344f0: 4f49 0a20 2020 2020 2020 2020 2020 2052  OI.            R
-00034500: 4f49 206f 626a 6563 7420 746f 2077 6869  OI object to whi
-00034510: 6368 2074 6f20 6372 6f70 2e0a 2020 2020  ch to crop..    
-00034520: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00034530: 6178 203a 2073 7472 2f69 6e74 2c20 6465  ax : str/int, de
-00034540: 6661 756c 743d 227a 220a 2020 2020 2020  fault="z".      
-00034550: 2020 2020 2020 4178 6973 2061 6c6f 6e67        Axis along
-00034560: 2077 6869 6368 2074 6f20 7065 7266 6f72   which to perfor
-00034570: 6d20 6372 6f70 7069 6e67 2e20 5368 6f75  m cropping. Shou
-00034580: 6c64 2062 6520 6f6e 6520 6f66 0a20 2020  ld be one of.   
-00034590: 2020 2020 2020 2020 205b 2278 222c 2022           ["x", "
-000345a0: 7922 2c20 227a 225d 206f 7220 5b30 2c20  y", "z"] or [0, 
-000345b0: 312c 2032 5d2e 0a20 2020 2020 2020 2022  1, 2]..        "
-000345c0: 2222 0a20 2020 2020 2020 2023 2044 6574  "".        # Det
-000345d0: 6572 6d69 6e65 2063 726f 7020 7261 6e67  ermine crop rang
-000345e0: 652e 0a20 2020 2020 2020 206c 696d 7320  e..        lims 
-000345f0: 3d20 3320 2a20 5b4e 6f6e 655d 0a20 2020  = 3 * [None].   
-00034600: 2020 2020 2069 5f61 7820 3d20 736b 7274       i_ax = skrt
-00034610: 2e69 6d61 6765 2e5f 6178 6573 2e69 6e64  .image._axes.ind
-00034620: 6578 2861 7829 2069 6620 6973 696e 7374  ex(ax) if isinst
-00034630: 616e 6365 2861 782c 2073 7472 2920 656c  ance(ax, str) el
-00034640: 7365 2061 780a 2020 2020 2020 2020 6c69  se ax.        li
-00034650: 6d73 5b69 5f61 785d 203d 206f 7468 6572  ms[i_ax] = other
-00034660: 2e67 6574 5f65 7874 656e 7428 6178 3d61  .get_extent(ax=a
-00034670: 7829 0a0a 2020 2020 2020 2020 2320 5065  x)..        # Pe
-00034680: 7266 6f72 6d20 6372 6f70 7069 6e67 2e0a  rform cropping..
-00034690: 2020 2020 2020 2020 7365 6c66 2e63 726f          self.cro
-000346a0: 7028 2a6c 696d 7329 0a0a 2020 2020 6465  p(*lims)..    de
-000346b0: 6620 6372 6f70 5f74 6f5f 726f 6928 7365  f crop_to_roi(se
-000346c0: 6c66 2c20 726f 692c 202a 2a6b 7761 7267  lf, roi, **kwarg
-000346d0: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-000346e0: 2020 2020 2020 2020 4372 6f70 2052 4f49          Crop ROI
-000346f0: 206d 6173 6b20 746f 2072 6567 696f 6e20   mask to region 
-00034700: 636f 7665 7265 6420 6279 2061 6e20 524f  covered by an RO
-00034710: 492e 0a20 2020 2020 2020 2022 2222 0a20  I..        """. 
-00034720: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
-00034730: 7465 5f6d 6173 6b28 290a 2020 2020 2020  te_mask().      
-00034740: 2020 7365 6c66 2e6d 6173 6b2e 6372 6f70    self.mask.crop
-00034750: 5f74 6f5f 726f 6928 726f 692c 202a 2a6b  _to_roi(roi, **k
-00034760: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
-00034770: 656c 662e 7368 6170 6520 3d20 7365 6c66  elf.shape = self
-00034780: 2e67 6574 5f6d 6173 6b28 292e 7368 6170  .get_mask().shap
-00034790: 650a 0a20 2020 2064 6566 2061 6464 5f70  e..    def add_p
-000347a0: 6c61 6e28 7365 6c66 2c20 706c 616e 293a  lan(self, plan):
-000347b0: 0a20 2020 2020 2020 2022 2222 4164 6420  .        """Add 
-000347c0: 6120 506c 616e 206f 626a 6563 7420 746f  a Plan object to
-000347d0: 2062 6520 6173 736f 6369 6174 6564 2077   be associated w
-000347e0: 6974 6820 7468 6973 2052 4f49 2e20 5468  ith this ROI. Th
-000347f0: 6973 0a20 2020 2020 2020 2064 6f65 7320  is.        does 
-00034800: 6e6f 7420 6166 6665 6374 2074 6865 2073  not affect the s
-00034810: 7472 7563 7475 7265 2073 6574 2061 7373  tructure set ass
-00034820: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
-00034830: 2050 6c61 6e20 6f62 6a65 6374 2e0a 0a20   Plan object... 
-00034840: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-00034850: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
-00034860: 706c 616e 203a 2073 6b72 742e 646f 7365  plan : skrt.dose
-00034870: 2e50 6c61 6e0a 2020 2020 2020 2020 2020  .Plan.          
-00034880: 2020 4120 506c 616e 206f 626a 6563 7420    A Plan object 
-00034890: 746f 2061 7373 6967 6e20 746f 2074 6869  to assign to thi
-000348a0: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
-000348b0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-000348c0: 2020 2020 2020 6966 206e 6f74 2070 6c61        if not pla
-000348d0: 6e20 696e 2073 656c 662e 706c 616e 733a  n in self.plans:
-000348e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000348f0: 662e 706c 616e 732e 6170 7065 6e64 2870  f.plans.append(p
-00034900: 6c61 6e29 0a20 2020 2020 2020 2020 2020  lan).           
-00034910: 2073 656c 662e 706c 616e 732e 736f 7274   self.plans.sort
-00034920: 2829 0a0a 2020 2020 6465 6620 636c 6561  ()..    def clea
-00034930: 725f 706c 616e 7328 7365 6c66 293a 0a20  r_plans(self):. 
-00034940: 2020 2020 2020 2022 2222 436c 6561 7220         """Clear 
-00034950: 616c 6c20 706c 616e 206d 6170 7320 6173  all plan maps as
-00034960: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
-00034970: 6973 2052 4f49 2e22 2222 0a0a 2020 2020  is ROI."""..    
-00034980: 2020 2020 7365 6c66 2e70 6c61 6e73 203d      self.plans =
-00034990: 205b 5d0a 0a20 2020 2064 6566 2067 6574   []..    def get
-000349a0: 5f70 6c61 6e73 2873 656c 6629 3a0a 2020  _plans(self):.  
-000349b0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-000349c0: 6c69 7374 206f 6620 506c 616e 206f 626a  list of Plan obj
-000349d0: 6563 7473 2061 7373 6f63 6961 7465 6420  ects associated 
-000349e0: 7769 7468 2074 6869 7320 524f 492e 2222  with this ROI.""
-000349f0: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-00034a00: 6e20 7365 6c66 2e70 6c61 6e73 0a0a 2020  n self.plans..  
-00034a10: 2020 6465 6620 6765 745f 636f 6c6f 725f    def get_color_
-00034a20: 6672 6f6d 5f6b 7761 7267 7328 7365 6c66  from_kwargs(self
-00034a30: 2c20 6b77 6172 6773 3d7b 7d2c 206b 6579  , kwargs={}, key
-00034a40: 3d27 726f 695f 636f 6c6f 7273 2729 3a0a  ='roi_colors'):.
-00034a50: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-00034a60: 2020 2020 5265 7475 726e 2052 4f49 2063      Return ROI c
-00034a70: 6f6c 6f75 7220 7061 7373 6564 2076 6961  olour passed via
-00034a80: 2064 6963 7469 6f6e 6172 7920 6f66 206b   dictionary of k
-00034a90: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-00034aa0: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-00034ab0: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
-00034ac0: 2020 2020 6b77 6172 6773 203a 2064 6963      kwargs : dic
-00034ad0: 742c 2064 6566 6175 6c74 3d7b 7d0a 2020  t, default={}.  
-00034ae0: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
-00034af0: 6e61 7279 206f 6620 6b65 7977 6f72 6420  nary of keyword 
-00034b00: 6172 6775 6d65 6e74 732c 2077 6869 6368  arguments, which
-00034b10: 206d 6179 2069 6e63 6c75 6465 0a20 2020   may include.   
-00034b20: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
-00034b30: 6572 2070 726f 7669 6469 6e67 2064 6963  er providing dic
-00034b40: 7469 6f6e 6172 7920 6f66 2052 4f49 2063  tionary of ROI c
-00034b50: 6f6c 6f75 7273 2066 6f72 2070 6c6f 7474  olours for plott
-00034b60: 696e 672e 0a0a 2020 2020 2020 2020 6b65  ing...        ke
-00034b70: 7920 3a20 7374 722c 2064 6566 6175 6c74  y : str, default
-00034b80: 3d27 726f 695f 636f 6c6f 7273 270a 2020  ='roi_colors'.  
-00034b90: 2020 2020 2020 2020 2020 4b65 7920 696e            Key in
-00034ba0: 206b 7761 7267 7320 6469 6374 696f 6e61   kwargs dictiona
-00034bb0: 7279 2073 7065 6369 6679 696e 6720 7061  ry specifying pa
-00034bc0: 7261 6d65 7465 7220 7468 6174 2c20 6966  rameter that, if
-00034bd0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00034be0: 7365 6e74 2c20 7072 6f76 6964 6573 2064  sent, provides d
-00034bf0: 6963 7469 6f6e 6172 7920 6f66 2052 4f49  ictionary of ROI
-00034c00: 2063 6f6c 6f75 7273 2e0a 2020 2020 2020   colours..      
-00034c10: 2020 2727 270a 2020 2020 2020 2020 726f    '''.        ro
-00034c20: 695f 636f 6c6f 7273 203d 206b 7761 7267  i_colors = kwarg
-00034c30: 732e 6765 7428 6b65 792c 207b 7d29 0a20  s.get(key, {}). 
-00034c40: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
-00034c50: 695f 636f 6c6f 7273 2e67 6574 2873 656c  i_colors.get(sel
-00034c60: 662e 6e61 6d65 2c20 7365 6c66 2e63 6f6c  f.name, self.col
-00034c70: 6f72 290a 0a20 2020 2064 6566 2073 706c  or)..    def spl
-00034c80: 6974 2873 656c 662c 2076 6f78 656c 5f73  it(self, voxel_s
-00034c90: 697a 653d 4e6f 6e65 2c20 6e61 6d65 733d  ize=None, names=
-00034ca0: 4e6f 6e65 2c20 6f72 6465 723d 2778 2b27  None, order='x+'
-00034cb0: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
-00034cc0: 2020 2020 2020 2053 706c 6974 2061 2063         Split a c
-00034cd0: 6f6d 706f 7369 7465 2052 4f49 2069 6e74  omposite ROI int
-00034ce0: 6f20 6974 7320 636f 6d70 6f6e 656e 7473  o its components
-00034cf0: 2e0a 0a20 2020 2020 2020 2041 2063 6f6d  ...        A com
-00034d00: 706f 7369 7465 2052 4f49 206d 6179 2072  posite ROI may r
-00034d10: 6573 756c 7420 6265 6361 7573 6520 7068  esult because ph
-00034d20: 7969 6361 6c6c 7920 7365 7061 7261 7465  yically separate
-00034d30: 2052 4f49 7320 6172 650a 2020 2020 2020   ROIs are.      
-00034d40: 2020 6769 7665 6e20 7468 6520 7361 6d65    given the same
-00034d50: 206c 6162 656c 2064 7572 696e 6720 6d61   label during ma
-00034d60: 6e75 616c 2063 6f6e 746f 7572 696e 672c  nual contouring,
-00034d70: 206f 7220 6265 6361 7573 650a 2020 2020   or because.    
-00034d80: 2020 2020 6d75 6c74 6970 6c65 2052 4f49      multiple ROI
-00034d90: 7320 6172 6520 7265 7475 726e 6564 2062  s are returned b
-00034da0: 7920 616e 2061 7574 6f2d 7365 676d 656e  y an auto-segmen
-00034db0: 7461 7469 6f6e 2061 6c67 6f72 6974 686d  tation algorithm
-00034dc0: 2e0a 0a20 2020 2020 2020 2054 6865 2063  ...        The c
-00034dd0: 6f6d 706f 6e65 6e74 2052 4f49 7320 6172  omponent ROIs ar
-00034de0: 6520 6964 656e 7469 6669 6564 2062 7920  e identified by 
-00034df0: 6c61 6265 6c6c 696e 6720 6120 6d61 736b  labelling a mask
-00034e00: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00034e10: 636f 6d70 6f73 6974 652c 2075 7369 6e67  composite, using
-00034e20: 2073 6369 7079 2e6e 6469 6d61 6765 2e6c   scipy.ndimage.l
-00034e30: 6162 656c 2829 2e0a 0a20 2020 2020 2020  abel()...       
-00034e40: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-00034e50: 0a0a 2020 2020 2020 2020 766f 7865 6c5f  ..        voxel_
-00034e60: 7369 7a65 203a 2074 7570 6c65 2c20 6465  size : tuple, de
-00034e70: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00034e80: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
-00034e90: 6520 2878 2c20 7929 2064 696d 656e 7369  e (x, y) dimensi
-00034ea0: 6f6e 7320 746f 2075 7365 2069 6e20 6372  ons to use in cr
-00034eb0: 6561 7469 6e67 206d 6173 6b20 666f 720a  eating mask for.
-00034ec0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-00034ed0: 6c6c 696e 672e 2020 5468 6973 2063 616e  lling.  This can
-00034ee0: 2062 6520 7573 6566 756c 2069 6620 7468   be useful if th
-00034ef0: 6520 524f 4920 736f 7572 6365 2069 7320  e ROI source is 
-00034f00: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
-00034f10: 2020 2020 706f 696e 7473 2c20 616e 6420      points, and 
-00034f20: 7468 6520 7265 736f 6c75 7469 6f6e 2077  the resolution w
-00034f30: 616e 7465 6420 6973 2067 7265 6174 6572  anted is greater
-00034f40: 2074 6861 6e20 6973 2061 6c6c 6f77 6564   than is allowed
-00034f50: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
-00034f60: 7468 6520 766f 7865 6c20 7369 7a65 206f  the voxel size o
-00034f70: 6620 7468 6520 524f 4920 696d 6167 652e  f the ROI image.
-00034f80: 0a0a 2020 2020 2020 2020 6e61 6d65 733a  ..        names:
-00034f90: 206c 6973 742c 2064 6566 6175 6c74 3d4e   list, default=N
-00034fa0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00034fb0: 4c69 7374 206f 6620 6e61 6d65 7320 746f  List of names to
-00034fc0: 2062 6520 6170 706c 6965 6420 746f 2074   be applied to t
-00034fd0: 6865 2063 6f6d 706f 6e65 6e74 2052 4f49  he component ROI
-00034fe0: 732e 2020 4e61 6d65 730a 2020 2020 2020  s.  Names.      
-00034ff0: 2020 2020 2020 6172 6520 6170 706c 6965        are applie
-00035000: 6420 6166 7465 7220 616e 7920 524f 4920  d after any ROI 
-00035010: 6f72 6465 7269 6e67 2e0a 0a20 2020 2020  ordering...     
-00035020: 2020 206f 7264 6572 203a 2073 7472 2c20     order : str, 
-00035030: 6465 6661 756c 743d 2778 2b27 0a20 2020  default='x+'.   
-00035040: 2020 2020 2020 2020 2053 7065 6369 6669           Specifi
-00035050: 6361 7469 6f6e 206f 6620 7761 7920 6974  cation of way it
-00035060: 2077 6869 6368 2052 4f49 7320 6172 6520   which ROIs are 
-00035070: 746f 2062 6520 6f72 6465 7264 3a0a 2020  to be orderd:.  
-00035080: 2020 2020 2020 2020 2020 2d20 2778 2b27            - 'x+'
-00035090: 203a 2069 6e20 6f72 6465 7220 6f66 2069   : in order of i
-000350a0: 6e63 7265 6173 696e 6720 7820 7661 6c75  ncreasing x valu
-000350b0: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
-000350c0: 2027 782d 2720 3a20 696e 206f 7264 6572   'x-' : in order
-000350d0: 206f 6620 6465 6372 6561 7369 6e67 2078   of decreasing x
-000350e0: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
-000350f0: 2020 2020 2d20 2779 2b27 203a 2069 6e20      - 'y+' : in 
-00035100: 6f72 6465 7220 6f66 2069 6e63 7265 6173  order of increas
-00035110: 696e 6720 7920 7661 6c75 652e 0a20 2020  ing y value..   
-00035120: 2020 2020 2020 2020 202d 2027 792d 2720           - 'y-' 
-00035130: 3a20 696e 206f 7264 6572 206f 6620 6465  : in order of de
-00035140: 6372 6561 7369 6e67 2079 2076 616c 7565  creasing y value
-00035150: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-00035160: 277a 2b27 203a 2069 6e20 6f72 6465 7220  'z+' : in order 
-00035170: 6f66 2069 6e63 7265 6173 696e 6720 7a20  of increasing z 
-00035180: 7661 6c75 652e 0a20 2020 2020 2020 2020  value..         
-00035190: 2020 202d 2027 7a2d 2720 3a20 696e 206f     - 'z-' : in o
-000351a0: 7264 6572 206f 6620 6465 6372 6561 7369  rder of decreasi
-000351b0: 6e67 207a 2076 616c 7565 2e0a 2020 2020  ng z value..    
-000351c0: 2020 2020 2020 2020 4966 2061 6e79 206f          If any o
-000351d0: 7468 6572 2076 616c 7565 7320 6973 2067  ther values is g
-000351e0: 6976 656e 2c20 6e6f 206f 7264 6572 696e  iven, no orderin
-000351f0: 6720 6973 2070 6572 666f 726d 6564 2e0a  g is performed..
-00035200: 2020 2020 2020 2020 2727 270a 0a20 2020          '''..   
-00035210: 2020 2020 2023 2049 6620 6e61 6d65 7320       # If names 
-00035220: 6e6f 7420 7370 6563 6966 6965 642c 206d  not specified, m
-00035230: 616b 6520 6974 2061 6e20 656d 7074 7920  ake it an empty 
-00035240: 6c69 7374 2e0a 2020 2020 2020 2020 6966  list..        if
-00035250: 206e 616d 6573 2069 7320 4e6f 6e65 3a0a   names is None:.
-00035260: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00035270: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
-00035280: 2320 5265 7369 7a65 2052 4f49 206d 6173  # Resize ROI mas
-00035290: 6b20 6966 2076 6f78 656c 2073 697a 6520  k if voxel size 
-000352a0: 6973 2074 6f20 6265 2063 6861 6e67 6564  is to be changed
-000352b0: 2e0a 2020 2020 2020 2020 6966 2076 6f78  ..        if vox
-000352c0: 656c 5f73 697a 653a 0a20 2020 2020 2020  el_size:.       
-000352d0: 2020 2020 2072 6f69 203d 2052 4f49 2873       roi = ROI(s
-000352e0: 656c 6629 0a20 2020 2020 2020 2020 2020  elf).           
-000352f0: 2076 6f78 656c 5f73 697a 655f 3364 203d   voxel_size_3d =
-00035300: 2028 766f 7865 6c5f 7369 7a65 5b30 5d2c   (voxel_size[0],
-00035310: 2076 6f78 656c 5f73 697a 655b 315d 2c20   voxel_size[1], 
-00035320: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00035330: 2020 726f 692e 6372 6561 7465 5f6d 6173    roi.create_mas
-00035340: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-00035350: 726f 692e 6d61 736b 2e72 6573 697a 6528  roi.mask.resize(
-00035360: 766f 7865 6c5f 7369 7a65 3d76 6f78 656c  voxel_size=voxel
-00035370: 5f73 697a 655f 3364 2c20 6d65 7468 6f64  _size_3d, method
-00035380: 3d27 6e65 6172 6573 7427 2c0a 2020 2020  ='nearest',.    
-00035390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000353a0: 696d 6167 655f 7369 7a65 5f75 6e69 743d  image_size_unit=
-000353b0: 276d 6d27 290a 2020 2020 2020 2020 2020  'mm').          
-000353c0: 2020 726f 692e 7365 745f 696d 6167 6528    roi.set_image(
-000353d0: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-000353e0: 2872 6f69 2e6d 6173 6b29 290a 2020 2020  (roi.mask)).    
-000353f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00035400: 2020 2020 2020 726f 6920 3d20 7365 6c66        roi = self
-00035410: 0a20 0a20 2020 2020 2020 2023 204c 6162  . .        # Lab
-00035420: 656c 2052 4f49 2063 6f6d 706f 6e65 6e74  el ROI component
-00035430: 732e 0a20 2020 2020 2020 206c 6162 656c  s..        label
-00035440: 5f6d 6173 6b2c 206e 5f6c 6162 656c 203d  _mask, n_label =
-00035450: 206e 6469 6d61 6765 2e6c 6162 656c 2872   ndimage.label(r
-00035460: 6f69 2e67 6574 5f6d 6173 6b28 2929 0a0a  oi.get_mask())..
-00035470: 2020 2020 2020 2020 6966 2076 6f78 656c          if voxel
-00035480: 5f73 697a 6520 616e 6420 2763 6f6e 746f  _size and 'conto
-00035490: 7572 2720 3d3d 2073 656c 662e 736f 7572  ur' == self.sour
-000354a0: 6365 5f74 7970 653a 0a20 2020 2020 2020  ce_type:.       
-000354b0: 2020 2020 2023 2048 616e 646c 6520 6361       # Handle ca
-000354c0: 7365 7320 7768 6572 6520 636f 6d70 6f73  ses where compos
-000354d0: 6974 6520 524f 4920 6973 2066 726f 6d20  ite ROI is from 
-000354e0: 636f 6e74 6f75 7220 706f 696e 7473 2c0a  contour points,.
-000354f0: 2020 2020 2020 2020 2020 2020 2320 616e              # an
-00035500: 6420 6d61 736b 2076 6f78 656c 2073 697a  d mask voxel siz
-00035510: 6520 6861 7320 6265 656e 2070 6173 7365  e has been passe
-00035520: 6420 6173 2061 6e20 6172 6775 6d65 6e74  d as an argument
-00035530: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00035540: 496e 2074 6869 7320 6361 7365 2063 6f6d  In this case com
-00035550: 706f 6e65 6e74 2052 4f49 7320 6172 6520  ponent ROIs are 
-00035560: 696e 6974 6961 6c69 7365 6420 6672 6f6d  initialised from
-00035570: 2063 6f6e 746f 7572 730a 2020 2020 2020   contours.      
-00035580: 2020 2020 2020 2320 7265 6372 6561 7465        # recreate
-00035590: 6420 6672 6f6d 2074 6865 206d 6173 6b2c  d from the mask,
-000355a0: 2077 6869 6368 206d 6179 2062 6520 6869   which may be hi
-000355b0: 6768 6572 2d72 6573 6f6c 7574 696f 6e0a  gher-resolution.
-000355c0: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-000355d0: 616e 2074 6865 2064 6566 6175 6c74 2e0a  an the default..
-000355e0: 2020 2020 2020 2020 2020 2020 7373 3020              ss0 
-000355f0: 3d20 5374 7275 6374 7572 6553 6574 286c  = StructureSet(l
-00035600: 6162 656c 5f6d 6173 6b2c 206d 756c 7469  abel_mask, multi
-00035610: 5f6c 6162 656c 3d54 7275 652c 2069 6d61  _label=True, ima
-00035620: 6765 3d72 6f69 2e6d 6173 6b29 0a20 2020  ge=roi.mask).   
-00035630: 2020 2020 2020 2020 2073 7320 3d20 5374           ss = St
-00035640: 7275 6374 7572 6553 6574 2829 0a20 2020  ructureSet().   
-00035650: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
-00035660: 2069 6e20 7373 302e 6765 745f 726f 6973   in ss0.get_rois
-00035670: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00035680: 2020 2020 7373 2e61 6464 5f72 6f69 2852      ss.add_roi(R
-00035690: 4f49 2873 6f75 7263 653d 726f 692e 6765  OI(source=roi.ge
-000356a0: 745f 636f 6e74 6f75 7273 2829 2c20 6e61  t_contours(), na
-000356b0: 6d65 3d72 6f69 2e6e 616d 6529 290a 2020  me=roi.name)).  
-000356c0: 2020 2020 2020 2020 2020 7373 2e73 6574            ss.set
-000356d0: 5f69 6d61 6765 2873 656c 662e 696d 6167  _image(self.imag
-000356e0: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
-000356f0: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
-00035700: 616e 646c 6520 6361 7365 7320 7768 6572  andle cases wher
-00035710: 6520 636f 6d70 6f6e 656e 7420 524f 4973  e component ROIs
-00035720: 2061 7265 2069 6e69 7469 616c 6973 6564   are initialised
-00035730: 2066 726f 6d20 6d61 736b 2e0a 2020 2020   from mask..    
-00035740: 2020 2020 2020 2020 6966 2076 6f78 656c          if voxel
-00035750: 5f73 697a 653a 0a20 2020 2020 2020 2020  _size:.         
-00035760: 2020 2020 2020 2023 2049 6620 766f 7865         # If voxe
-00035770: 6c20 7369 7a65 2063 6861 6e67 6564 2066  l size changed f
-00035780: 6f72 206c 6162 656c 6c69 6e67 2c0a 2020  or labelling,.  
-00035790: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000357a0: 7265 6372 6561 7465 206c 6162 656c 206d  recreate label m
-000357b0: 6173 6b20 7769 7468 206f 7269 6769 6e61  ask with origina
-000357c0: 6c20 766f 7865 6c20 7369 7a65 2e0a 2020  l voxel size..  
-000357d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000357e0: 692e 6d61 736b 2e64 6174 6120 3d20 6c61  i.mask.data = la
-000357f0: 6265 6c5f 6d61 736b 0a20 2020 2020 2020  bel_mask.       
-00035800: 2020 2020 2020 2020 2072 6f69 2e6d 6173           roi.mas
-00035810: 6b2e 6d61 7463 685f 7369 7a65 2873 656c  k.match_size(sel
-00035820: 662e 696d 6167 652c 206d 6574 686f 643d  f.image, method=
-00035830: 276e 6561 7265 7374 2729 0a20 2020 2020  'nearest').     
-00035840: 2020 2020 2020 2020 2020 206c 6162 656c             label
-00035850: 5f6d 6173 6b20 3d20 726f 692e 6d61 736b  _mask = roi.mask
-00035860: 2e64 6174 610a 0a20 2020 2020 2020 2020  .data..         
-00035870: 2020 2023 2043 7265 6174 6520 7374 7275     # Create stru
-00035880: 6374 7572 6520 7365 7420 6672 6f6d 206c  cture set from l
-00035890: 6162 656c 206d 6173 6b2e 0a20 2020 2020  abel mask..     
-000358a0: 2020 2020 2020 2073 7320 3d20 5374 7275         ss = Stru
-000358b0: 6374 7572 6553 6574 286c 6162 656c 5f6d  ctureSet(label_m
-000358c0: 6173 6b2c 206d 756c 7469 5f6c 6162 656c  ask, multi_label
-000358d0: 3d54 7275 652c 2069 6d61 6765 3d73 656c  =True, image=sel
-000358e0: 662e 696d 6167 6529 0a0a 2020 2020 2020  f.image)..      
-000358f0: 2020 2320 5374 6f72 6520 524f 4973 2069    # Store ROIs i
-00035900: 6e20 7370 6563 6966 6965 6420 6f72 6465  n specified orde
-00035910: 722e 0a20 2020 2020 2020 2073 732e 6f72  r..        ss.or
-00035920: 6465 725f 726f 6973 286f 7264 6572 290a  der_rois(order).
-00035930: 0a20 2020 2020 2020 2023 2041 7070 6c79  .        # Apply
-00035940: 206e 616d 6573 2e0a 2020 2020 2020 2020   names..        
-00035950: 666f 7220 6920 696e 2072 616e 6765 286d  for i in range(m
-00035960: 696e 286c 656e 286e 616d 6573 292c 206c  in(len(names), l
-00035970: 656e 2873 732e 726f 6973 2929 293a 0a20  en(ss.rois))):. 
-00035980: 2020 2020 2020 2020 2020 2073 732e 726f             ss.ro
-00035990: 6973 5b69 5d2e 6e61 6d65 203d 206e 616d  is[i].name = nam
-000359a0: 6573 5b69 5d0a 0a20 2020 2020 2020 2072  es[i]..        r
-000359b0: 6574 7572 6e20 7373 0a0a 2020 2020 6465  eturn ss..    de
-000359c0: 6620 7370 6c69 745f 696e 5f74 776f 2873  f split_in_two(s
-000359d0: 656c 662c 2061 7869 733d 2778 272c 2076  elf, axis='x', v
-000359e0: 303d 302c 206e 616d 6573 3d4e 6f6e 652c  0=0, names=None,
-000359f0: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
-00035a00: 2020 2020 2020 2053 706c 6974 2061 2063         Split a c
-00035a10: 6f6d 706f 7369 7465 2052 4f49 2069 6e74  omposite ROI int
-00035a20: 6f20 7477 6f20 636f 6d70 6f6e 656e 7420  o two component 
-00035a30: 7061 7274 732e 0a0a 2020 2020 2020 2020  parts...        
-00035a40: 5370 6c69 7420 616e 2052 4f49 2069 6e74  Split an ROI int
-00035a50: 6f20 7477 6f20 636f 6d70 6f6e 656e 7473  o two components
-00035a60: 2c20 6569 7468 6572 2073 6964 6520 6f66  , either side of
-00035a70: 2061 2073 7065 6369 6669 6564 0a20 2020   a specified.   
-00035a80: 2020 2020 2070 6c61 6e65 2e20 2054 6869       plane.  Thi
-00035a90: 7320 6d61 7920 6265 2075 7365 6675 6c2c  s may be useful,
-00035aa0: 2066 6f72 2065 7861 6d70 6c65 2c20 7768   for example, wh
-00035ab0: 656e 206c 6566 7420 616e 6420 7269 6768  en left and righ
-00035ac0: 740a 2020 2020 2020 2020 524f 4973 2068  t.        ROIs h
-00035ad0: 6176 6520 6265 656e 2061 7373 6967 6e65  ave been assigne
-00035ae0: 6420 6120 636f 6d6d 6f6e 206c 6162 656c  d a common label
-00035af0: 2e0a 0a20 2020 2020 2020 2046 6f72 206d  ...        For m
-00035b00: 6f72 6520 6765 6e65 7261 6c20 524f 4920  ore general ROI 
-00035b10: 7370 6c69 7474 696e 672c 2073 6565 2073  splitting, see s
-00035b20: 6b72 742e 7374 7275 6374 7572 652e 524f  krt.structure.RO
-00035b30: 492e 7370 6c69 7428 292e 0a20 2020 2020  I.split()..     
-00035b40: 2020 204e 6f74 6520 7468 6174 2073 706c     Note that spl
-00035b50: 6974 2829 2061 6374 7320 6f6e 2062 696e  it() acts on bin
-00035b60: 6172 7920 6d61 736b 732c 2077 6865 7265  ary masks, where
-00035b70: 6173 2073 706c 6974 5f69 6e5f 7477 6f28  as split_in_two(
-00035b80: 290a 2020 2020 2020 2020 6163 7473 206f  ).        acts o
-00035b90: 6e20 636f 6e74 6f75 7273 2e0a 0a20 2020  n contours...   
-00035ba0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-00035bb0: 733a 2a2a 0a0a 2020 2020 2020 2020 6178  s:**..        ax
-00035bc0: 6973 203a 2027 7374 7227 2c20 6465 6661  is : 'str', defa
-00035bd0: 756c 743d 2778 270a 2020 2020 2020 2020  ult='x'.        
-00035be0: 2020 2020 4178 6973 2028 2778 272c 2027      Axis ('x', '
-00035bf0: 7927 206f 7220 277a 2729 2070 6572 7065  y' or 'z') perpe
-00035c00: 6e64 6963 756c 6172 2074 6f20 706c 616e  ndicular to plan
-00035c10: 6520 6162 6f75 7420 7768 6963 680a 2020  e about which.  
-00035c20: 2020 2020 2020 2020 2020 524f 4920 6973            ROI is
-00035c30: 2074 6f20 6265 2073 706c 6974 2e0a 0a20   to be split... 
-00035c40: 2020 2020 2020 2076 3020 3a20 666c 6f61         v0 : floa
-00035c50: 742c 2064 6566 6175 6c74 3d30 0a20 2020  t, default=0.   
-00035c60: 2020 2020 2020 2020 2043 6f6f 7264 696e           Coordin
-00035c70: 6174 6520 616c 6f6e 6720 7365 6c65 6374  ate along select
-00035c80: 6564 2061 7869 732c 2073 7065 6369 6679  ed axis, specify
-00035c90: 696e 6720 706c 616e 6520 6162 6f75 7420  ing plane about 
-00035ca0: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
-00035cb0: 2020 524f 4920 6973 2074 6f20 6265 2073    ROI is to be s
-00035cc0: 706c 6974 2e0a 0a20 2020 2020 2020 206e  plit...        n
-00035cd0: 616d 6573 3a20 6c69 7374 2c20 6465 6661  ames: list, defa
-00035ce0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00035cf0: 2020 2020 204c 6973 7420 6f66 206e 616d       List of nam
-00035d00: 6573 2074 6f20 6265 2061 7070 6c69 6564  es to be applied
-00035d10: 2074 6f20 7468 6520 636f 6d70 6f6e 656e   to the componen
-00035d20: 7420 524f 4973 2e0a 2020 2020 2020 2020  t ROIs..        
-00035d30: 2727 270a 0a20 2020 2020 2020 2023 2049  '''..        # I
-00035d40: 6620 6e61 6d65 7320 6e6f 7420 7370 6563  f names not spec
-00035d50: 6966 6965 642c 2069 6e69 7469 616c 6973  ified, initialis
-00035d60: 6520 746f 2065 6d70 7479 206c 6973 742e  e to empty list.
-00035d70: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
-00035d80: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00035d90: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
-00035da0: 5d0a 0a20 2020 2020 2020 2023 2042 6173  ]..        # Bas
-00035db0: 6564 206f 6e20 7365 6c65 6374 6564 2061  ed on selected a
-00035dc0: 7869 732c 2064 6566 696e 6520 7669 6577  xis, define view
-00035dd0: 2061 6e64 2064 6566 6175 6c74 206e 616d   and default nam
-00035de0: 6520 7375 6666 6978 6573 2e0a 2020 2020  e suffixes..    
-00035df0: 2020 2020 6966 2027 7827 203d 3d20 6178      if 'x' == ax
-00035e00: 6973 2e6c 6f77 6572 2829 3a0a 2020 2020  is.lower():.    
-00035e10: 2020 2020 2020 2020 7669 6577 203d 2027          view = '
-00035e20: 782d 7927 0a20 2020 2020 2020 2020 2020  x-y'.           
-00035e30: 2073 7566 6669 7865 7320 3d20 2827 7269   suffixes = ('ri
-00035e40: 6768 7427 2c20 276c 6566 7427 290a 2020  ght', 'left').  
-00035e50: 2020 2020 2020 656c 6966 2027 7927 203d        elif 'y' =
-00035e60: 3d20 6178 6973 2e6c 6f77 6572 2829 3a0a  = axis.lower():.
-00035e70: 2020 2020 2020 2020 2020 2020 7669 6577              view
-00035e80: 203d 2027 782d 7927 0a20 2020 2020 2020   = 'x-y'.       
-00035e90: 2020 2020 2073 7566 6669 7865 7320 3d20       suffixes = 
-00035ea0: 2827 616e 7465 7269 6f72 272c 2027 706f  ('anterior', 'po
-00035eb0: 7374 6572 696f 7227 290a 2020 2020 2020  sterior').      
-00035ec0: 2020 656c 6966 2027 7a27 203d 3d20 6178    elif 'z' == ax
-00035ed0: 6973 2e6c 6f77 6572 2829 3a0a 2020 2020  is.lower():.    
-00035ee0: 2020 2020 2020 2020 7669 6577 203d 2027          view = '
-00035ef0: 792d 7a27 0a20 2020 2020 2020 2020 2020  y-z'.           
-00035f00: 2073 7566 6669 7865 7320 3d20 2827 696e   suffixes = ('in
-00035f10: 6665 7269 6f72 272c 2027 7375 7065 7269  ferior', 'superi
-00035f20: 6f72 2729 0a20 2020 2020 2020 2020 2020  or').           
-00035f30: 2023 2049 6e20 7468 6520 2779 2d7a 2720   # In the 'y-z' 
-00035f40: 7669 6577 2c20 7920 616e 6420 7a20 6178  view, y and z ax
-00035f50: 6573 206d 6170 2074 6f20 7368 6170 656c  es map to shapel
-00035f60: 7920 7820 616e 6420 7920 6178 6573 2e0a  y x and y axes..
-00035f70: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00035f80: 203d 2027 7927 0a0a 2020 2020 2020 2020   = 'y'..        
-00035f90: 2320 4465 6669 6e65 2070 6f6c 7967 6f6e  # Define polygon
-00035fa0: 2072 6570 7265 7365 6e74 696e 6720 524f   representing RO
-00035fb0: 4920 636f 6e74 6f75 7220 6173 206c 6f77  I contour as low
-00035fc0: 206f 7220 6869 6768 2c0a 2020 2020 2020   or high,.      
-00035fd0: 2020 2320 6465 7065 6e64 696e 6720 6f6e    # depending on
-00035fe0: 2077 6865 7468 6572 2074 6865 2070 6f6c   whether the pol
-00035ff0: 7967 6f6e 2063 656e 7472 6f69 6420 6973  ygon centroid is
-00036000: 206c 6f77 6572 206f 7220 6869 6768 6572   lower or higher
-00036010: 0a20 2020 2020 2020 2023 2074 6861 6e20  .        # than 
-00036020: 7468 6520 636f 6f72 6469 6e61 7465 206f  the coordinate o
-00036030: 6620 7468 6520 7370 6c69 7474 696e 6720  f the splitting 
-00036040: 706c 616e 652e 0a20 2020 2020 2020 2070  plane..        p
-00036050: 6f6c 7967 6f6e 735f 6c6f 7720 3d20 7b7d  olygons_low = {}
-00036060: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
-00036070: 735f 6869 6768 203d 207b 7d0a 2020 2020  s_high = {}.    
-00036080: 2020 2020 666f 7220 7a2c 2070 6f6c 7967      for z, polyg
-00036090: 6f6e 7320 696e 2073 656c 662e 6765 745f  ons in self.get_
-000360a0: 706f 6c79 676f 6e73 2876 6965 7729 2e69  polygons(view).i
-000360b0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-000360c0: 2020 2020 666f 7220 706f 6c79 676f 6e20      for polygon 
-000360d0: 696e 2070 6f6c 7967 6f6e 733a 0a20 2020  in polygons:.   
-000360e0: 2020 2020 2020 2020 2020 2020 2076 203d               v =
-000360f0: 2067 6574 6174 7472 2870 6f6c 7967 6f6e   getattr(polygon
-00036100: 2e63 656e 7472 6f69 642c 2061 7869 7329  .centroid, axis)
-00036110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036120: 2069 6620 7620 3c20 7630 3a0a 2020 2020   if v < v0:.    
-00036130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036140: 6966 206e 6f74 207a 2069 6e20 706f 6c79  if not z in poly
-00036150: 676f 6e73 5f6c 6f77 3a0a 2020 2020 2020  gons_low:.      
-00036160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036170: 2020 706f 6c79 676f 6e73 5f6c 6f77 5b7a    polygons_low[z
-00036180: 5d20 3d20 5b5d 0a20 2020 2020 2020 2020  ] = [].         
-00036190: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-000361a0: 6f6e 735f 6c6f 775b 7a5d 2e61 7070 656e  ons_low[z].appen
-000361b0: 6428 706f 6c79 676f 6e29 0a20 2020 2020  d(polygon).     
-000361c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000361d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000361e0: 2020 2020 2069 6620 6e6f 7420 7a20 696e       if not z in
-000361f0: 2070 6f6c 7967 6f6e 735f 6869 6768 3a0a   polygons_high:.
-00036200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036210: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
-00036220: 5f68 6967 685b 7a5d 203d 205b 5d0a 2020  _high[z] = [].  
-00036230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036240: 2020 706f 6c79 676f 6e73 5f68 6967 685b    polygons_high[
-00036250: 7a5d 2e61 7070 656e 6428 706f 6c79 676f  z].append(polygo
-00036260: 6e29 0a0a 0a20 2020 2020 2020 2023 2043  n)...        # C
-00036270: 7265 6174 6520 524f 4920 6672 6f6d 2070  reate ROI from p
-00036280: 6f6c 7967 6f6e 7320 6265 6c6f 7720 7468  olygons below th
-00036290: 6520 7370 6c69 7474 696e 6720 706c 616e  e splitting plan
-000362a0: 652e 0a20 2020 2020 2020 2069 6620 706f  e..        if po
-000362b0: 6c79 676f 6e73 5f6c 6f77 3a0a 2020 2020  lygons_low:.    
-000362c0: 2020 2020 2020 2020 726f 695f 6c6f 7720          roi_low 
-000362d0: 3d20 524f 4928 736f 7572 6365 3d70 6f6c  = ROI(source=pol
-000362e0: 7967 6f6e 735f 6c6f 772c 2069 6d61 6765  ygons_low, image
-000362f0: 3d73 656c 662e 696d 6167 6529 0a20 2020  =self.image).   
-00036300: 2020 2020 2020 2020 2072 6f69 5f6c 6f77           roi_low
-00036310: 2e6e 616d 6520 3d20 286e 616d 6573 5b30  .name = (names[0
-00036320: 5d20 6966 206c 656e 286e 616d 6573 2920  ] if len(names) 
-00036330: 3e20 300a 2020 2020 2020 2020 2020 2020  > 0.            
-00036340: 2020 2020 2020 2020 656c 7365 2066 277b          else f'{
-00036350: 7365 6c66 2e6e 616d 657d 5f7b 7375 6666  self.name}_{suff
-00036360: 6978 6573 5b30 5d7d 2729 0a20 2020 2020  ixes[0]}').     
-00036370: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00036380: 2020 2020 2072 6f69 5f6c 6f77 203d 204e       roi_low = N
-00036390: 6f6e 650a 0a20 2020 2020 2020 2023 2043  one..        # C
-000363a0: 7265 6174 6520 524f 4920 6672 6f6d 2070  reate ROI from p
-000363b0: 6f6c 7967 6f6e 7320 6162 6f76 6520 7468  olygons above th
-000363c0: 6520 7370 6c69 7474 696e 6720 706c 616e  e splitting plan
-000363d0: 652e 0a20 2020 2020 2020 2069 6620 706f  e..        if po
-000363e0: 6c79 676f 6e73 5f68 6967 683a 0a20 2020  lygons_high:.   
-000363f0: 2020 2020 2020 2020 2072 6f69 5f68 6967           roi_hig
-00036400: 6820 3d20 524f 4928 736f 7572 6365 3d70  h = ROI(source=p
-00036410: 6f6c 7967 6f6e 735f 6869 6768 2c20 696d  olygons_high, im
-00036420: 6167 653d 7365 6c66 2e69 6d61 6765 290a  age=self.image).
-00036430: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-00036440: 6869 6768 2e6e 616d 6520 3d20 286e 616d  high.name = (nam
-00036450: 6573 5b31 5d20 6966 206c 656e 286e 616d  es[1] if len(nam
-00036460: 6573 2920 3e20 310a 2020 2020 2020 2020  es) > 1.        
-00036470: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00036480: 2066 277b 7365 6c66 2e6e 616d 657d 5f7b   f'{self.name}_{
-00036490: 7375 6666 6978 6573 5b31 5d7d 2729 0a20  suffixes[1]}'). 
-000364a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000364b0: 2020 2020 2020 2020 2072 6f69 5f68 6967           roi_hig
-000364c0: 6820 3d20 4e6f 6e65 0a0a 2020 2020 2020  h = None..      
-000364d0: 2020 2320 4372 6561 7465 2073 7472 7563    # Create struc
-000364e0: 7475 7265 2073 6574 2066 6f72 2063 6f6d  ture set for com
-000364f0: 706f 6e65 6e74 2052 4f49 2873 292e 0a20  ponent ROI(s).. 
-00036500: 2020 2020 2020 2072 6f69 7320 3d20 6c69         rois = li
-00036510: 7374 2866 696c 7465 7228 4e6f 6e65 2c20  st(filter(None, 
-00036520: 5b72 6f69 5f6c 6f77 2c20 726f 695f 6869  [roi_low, roi_hi
-00036530: 6768 5d29 290a 2020 2020 2020 2020 6966  gh])).        if
-00036540: 2072 6f69 733a 0a20 2020 2020 2020 2020   rois:.         
-00036550: 2020 2073 7320 3d20 5374 7275 6374 7572     ss = Structur
-00036560: 6553 6574 2870 6174 683d 726f 6973 2c20  eSet(path=rois, 
-00036570: 6e61 6d65 3d73 656c 662e 6e61 6d65 2c20  name=self.name, 
-00036580: 696d 6167 653d 7365 6c66 2e69 6d61 6765  image=self.image
-00036590: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-000365a0: 2020 2020 2020 2020 2020 2020 7373 203d              ss =
-000365b0: 204e 6f6e 650a 0a20 2020 2020 2020 2072   None..        r
-000365c0: 6574 7572 6e20 7373 0a0a 2020 2020 6465  eturn ss..    de
-000365d0: 6620 6765 745f 7061 7463 6828 7365 6c66  f get_patch(self
-000365e0: 2c20 706c 6f74 5f74 7970 653d 4e6f 6e65  , plot_type=None
-000365f0: 2c20 636f 6c6f 723d 4e6f 6e65 2c20 6f70  , color=None, op
-00036600: 6163 6974 793d 4e6f 6e65 2c0a 2020 2020  acity=None,.    
-00036610: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
-00036620: 683d 4e6f 6e65 2c20 6e61 6d65 3d4e 6f6e  h=None, name=Non
-00036630: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00036640: 2020 2020 2020 2020 4f62 7461 696e 2070          Obtain p
-00036650: 6174 6368 2072 6566 6c65 6374 696e 6720  atch reflecting 
-00036660: 524f 4920 6368 6172 6163 7465 7269 7374  ROI characterist
-00036670: 6963 7320 666f 7220 706c 6f74 7469 6e67  ics for plotting
-00036680: 2e0a 0a20 2020 2020 2020 2054 6865 2070  ...        The p
-00036690: 6174 6368 206f 6274 6169 6e65 6420 6361  atch obtained ca
-000366a0: 6e20 6265 2075 7365 6420 6173 2061 2068  n be used as a h
-000366b0: 616e 646c 6520 696e 206c 6567 656e 6420  andle in legend 
-000366c0: 6372 6561 7469 6f6e 2e0a 0a20 2020 2020  creation...     
-000366d0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-000366e0: 2a2a 0a0a 2020 2020 2020 2020 706c 6f74  **..        plot
-000366f0: 5f74 7970 6520 3a20 7374 722c 2064 6566  _type : str, def
-00036700: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00036710: 2020 2020 2020 506c 6f74 7469 6e67 2074        Plotting t
-00036720: 7970 652e 2049 6620 4e6f 6e65 2c20 7769  ype. If None, wi
-00036730: 6c6c 2062 6520 6569 7468 6572 2022 636f  ll be either "co
-00036740: 6e74 6f75 7222 206f 7220 226d 6173 6b22  ntour" or "mask"
-00036750: 200a 2020 2020 2020 2020 2020 2020 6465   .            de
-00036760: 7065 6e64 696e 6720 6f6e 2074 6865 2069  pending on the i
-00036770: 6e70 7574 2074 7970 6520 6f66 2074 6865  nput type of the
-00036780: 2052 4f49 2e20 4f70 7469 6f6e 733a 0a0a   ROI. Options:..
-00036790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000367a0: 2d20 2263 6f6e 746f 7572 220a 2020 2020  - "contour".    
-000367b0: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
-000367c0: 6173 6b22 0a20 2020 2020 2020 2020 2020  ask".           
-000367d0: 2020 2020 202d 2022 6365 6e74 726f 6964       - "centroid
-000367e0: 2220 2863 6f6e 746f 7572 2077 6974 6820  " (contour with 
-000367f0: 6d61 726b 6572 2061 7420 6365 6e74 726f  marker at centro
-00036800: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
-00036810: 2020 2020 2d20 2266 696c 6c65 6422 2028      - "filled" (
-00036820: 7472 616e 7370 6172 656e 7420 6d61 736b  transparent mask
-00036830: 202b 2063 6f6e 746f 7572 290a 2020 2020   + contour).    
-00036840: 2020 2020 2020 2020 2020 2020 2d20 2266              - "f
-00036850: 696c 6c65 6420 6365 6e74 726f 6964 2220  illed centroid" 
-00036860: 2866 696c 6c65 6420 7769 7468 206d 6172  (filled with mar
-00036870: 6b65 7220 6174 2063 656e 7472 6f69 6429  ker at centroid)
-00036880: 0a0a 2020 2020 2020 2020 636f 6c6f 7220  ..        color 
-00036890: 3a20 6d61 7470 6c6f 746c 6962 2063 6f6c  : matplotlib col
-000368a0: 6f72 2c20 6465 6661 756c 743d 4e6f 6e65  or, default=None
-000368b0: 0a20 2020 2020 2020 2020 2020 2043 6f6c  .            Col
-000368c0: 6f72 2077 6974 6820 7768 6963 6820 746f  or with which to
-000368d0: 2070 6c6f 7420 7468 6520 524f 493b 206f   plot the ROI; o
-000368e0: 7665 7272 6964 6573 2074 6865 2052 4f49  verrides the ROI
-000368f0: 2773 206f 776e 2063 6f6c 6f72 2e20 4966  's own color. If
-00036900: 200a 2020 2020 2020 2020 2020 2020 4e6f   .            No
-00036910: 6e65 2c20 7365 6c66 2e63 6f6c 6f72 2077  ne, self.color w
-00036920: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-00036930: 2020 2020 2020 6f70 6163 6974 7920 3a20        opacity : 
-00036940: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-00036950: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00036960: 4f70 6163 6974 7920 746f 2075 7365 2069  Opacity to use i
-00036970: 6620 706c 6f74 7469 6e67 206d 6173 6b20  f plotting mask 
-00036980: 2869 2e65 2e20 706c 6f74 2074 7970 6573  (i.e. plot types
-00036990: 2022 6d61 736b 222c 2022 6669 6c6c 6564   "mask", "filled
-000369a0: 222c 200a 2020 2020 2020 2020 2020 2020  ", .            
-000369b0: 6f72 2022 6669 6c6c 6564 2063 656e 7472  or "filled centr
-000369c0: 6f69 6422 292e 2049 6620 4e6f 6e65 2c20  oid"). If None, 
-000369d0: 6f70 6163 6974 7920 7769 6c6c 2062 6520  opacity will be 
-000369e0: 3120 6279 2064 6566 6175 6c74 2066 6f72  1 by default for
-000369f0: 200a 2020 2020 2020 2020 2020 2020 736f   .            so
-00036a00: 6c69 6420 6d61 736b 2070 6c6f 7473 2061  lid mask plots a
-00036a10: 6e64 2030 2e33 2062 7920 6465 6661 756c  nd 0.3 by defaul
-00036a20: 7420 666f 7220 6669 6c6c 6564 2070 6c6f  t for filled plo
-00036a30: 7473 2e0a 0a20 2020 2020 2020 206c 696e  ts...        lin
-00036a40: 6577 6964 7468 203a 2066 6c6f 6174 2c20  ewidth : float, 
-00036a50: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00036a60: 2020 2020 2020 2020 2057 6964 7468 206f           Width o
-00036a70: 6620 636f 6e74 6f75 7220 6c69 6e65 732e  f contour lines.
-00036a80: 2049 6620 4e6f 6e65 2c20 7468 6520 6d61   If None, the ma
-00036a90: 7470 6c6f 746c 6962 2064 6566 6175 6c74  tplotlib default
-00036aa0: 2073 6574 7469 6e67 200a 2020 2020 2020   setting .      
-00036ab0: 2020 2020 2020 7769 6c6c 2062 6520 7573        will be us
-00036ac0: 6564 2e0a 0a20 2020 2020 2020 206e 616d  ed...        nam
-00036ad0: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
-00036ae0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00036af0: 2020 4e61 6d65 2069 6465 6e74 6966 7969    Name identifyi
-00036b00: 6e67 2052 4f49 2e20 2049 6620 4e6f 6e65  ng ROI.  If None
-00036b10: 2c20 7365 6c66 2e6e 616d 6520 7769 6c6c  , self.name will
-00036b20: 2062 6520 7573 6564 2e0a 2020 2020 2020   be used..      
-00036b30: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
-00036b40: 2045 6e73 7572 6520 7468 6174 2070 6c6f   Ensure that plo
-00036b50: 7474 696e 6720 6368 6172 6163 7465 7269  tting characteri
-00036b60: 7374 6963 7320 6172 6520 6465 6669 6e65  stics are define
-00036b70: 642e 0a20 2020 2020 2020 2069 6620 706c  d..        if pl
-00036b80: 6f74 5f74 7970 6520 6973 204e 6f6e 653a  ot_type is None:
-00036b90: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
-00036ba0: 745f 7479 7065 203d 2073 656c 662e 6465  t_type = self.de
-00036bb0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-00036bc0: 640a 0a20 2020 2020 2020 2069 6620 636f  d..        if co
-00036bd0: 6c6f 7220 6973 204e 6f6e 653a 0a20 2020  lor is None:.   
-00036be0: 2020 2020 2020 2020 2063 6f6c 6f72 203d           color =
-00036bf0: 2073 656c 662e 636f 6c6f 720a 0a20 2020   self.color..   
-00036c00: 2020 2020 2069 6620 6f70 6163 6974 7920       if opacity 
-00036c10: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00036c20: 2020 2020 206f 7061 6369 7479 203d 2030       opacity = 0
-00036c30: 2e33 2069 6620 2266 696c 6c65 6422 2069  .3 if "filled" i
-00036c40: 6e20 706c 6f74 5f74 7970 6520 656c 7365  n plot_type else
-00036c50: 2031 0a0a 2020 2020 2020 2020 6966 206c   1..        if l
-00036c60: 696e 6577 6964 7468 2069 7320 4e6f 6e65  inewidth is None
-00036c70: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-00036c80: 6e65 7769 6474 6820 3d20 6465 6661 756c  newidth = defaul
-00036c90: 7450 6172 616d 735b 226c 696e 6573 2e6c  tParams["lines.l
-00036ca0: 696e 6577 6964 7468 225d 5b30 5d0a 0a20  inewidth"][0].. 
-00036cb0: 2020 2020 2020 2069 6620 6e61 6d65 2069         if name i
-00036cc0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00036cd0: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
-00036ce0: 6e61 6d65 0a0a 2020 2020 2020 2020 2320  name..        # 
-00036cf0: 5365 7420 706f 7465 6e74 6961 6c6c 7920  Set potentially 
-00036d00: 6469 6666 6572 656e 7420 6f70 6163 6974  different opacit
-00036d10: 6965 7320 666f 7220 6661 6365 636f 6c6f  ies for facecolo
-00036d20: 7220 616e 6420 6564 6765 636f 6c6f 720a  r and edgecolor.
-00036d30: 2020 2020 2020 2020 6661 6365 636f 6c6f          facecolo
-00036d40: 7220 3d20 6d61 7470 6c6f 746c 6962 2e63  r = matplotlib.c
-00036d50: 6f6c 6f72 732e 746f 5f72 6762 6128 636f  olors.to_rgba(co
-00036d60: 6c6f 722c 2061 6c70 6861 3d6f 7061 6369  lor, alpha=opaci
-00036d70: 7479 290a 2020 2020 2020 2020 6564 6765  ty).        edge
-00036d80: 636f 6c6f 7220 3d20 6d61 7470 6c6f 746c  color = matplotl
-00036d90: 6962 2e63 6f6c 6f72 732e 746f 5f72 6762  ib.colors.to_rgb
-00036da0: 6128 636f 6c6f 722c 2061 6c70 6861 3d31  a(color, alpha=1
-00036db0: 290a 0a20 2020 2020 2020 2023 2044 6566  )..        # Def
-00036dc0: 696e 6520 7061 7463 6820 6163 636f 7264  ine patch accord
-00036dd0: 696e 6720 746f 2070 6c6f 745f 7479 7065  ing to plot_type
-00036de0: 2e0a 2020 2020 2020 2020 7061 7463 6820  ..        patch 
-00036df0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
-00036e00: 6620 706c 6f74 5f74 7970 6520 696e 205b  f plot_type in [
-00036e10: 2263 6f6e 746f 7572 222c 2022 6365 6e74  "contour", "cent
-00036e20: 726f 6964 225d 3a0a 2020 2020 2020 2020  roid"]:.        
-00036e30: 2020 2020 7061 7463 6820 3d20 6d70 6174      patch = mpat
-00036e40: 6368 6573 2e50 6174 6368 2865 6467 6563  ches.Patch(edgec
-00036e50: 6f6c 6f72 3d65 6467 6563 6f6c 6f72 2c0a  olor=edgecolor,.
-00036e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036e70: 2020 2020 6c69 6e65 7769 6474 683d 6c69      linewidth=li
-00036e80: 6e65 7769 6474 682c 2066 696c 6c3d 4661  newidth, fill=Fa
-00036e90: 6c73 652c 206c 6162 656c 3d6e 616d 6529  lse, label=name)
-00036ea0: 0a20 2020 2020 2020 2065 6c69 6620 706c  .        elif pl
-00036eb0: 6f74 5f74 7970 6520 696e 205b 2266 696c  ot_type in ["fil
-00036ec0: 6c65 6422 2c20 2266 696c 6c65 6420 6365  led", "filled ce
-00036ed0: 6e74 726f 6964 225d 3a0a 2020 2020 2020  ntroid"]:.      
-00036ee0: 2020 2020 2020 7061 7463 6820 3d20 6d70        patch = mp
-00036ef0: 6174 6368 6573 2e50 6174 6368 2865 6467  atches.Patch(edg
-00036f00: 6563 6f6c 6f72 3d65 6467 6563 6f6c 6f72  ecolor=edgecolor
-00036f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00036f20: 2020 2020 2020 6661 6365 636f 6c6f 723d        facecolor=
-00036f30: 6661 6365 636f 6c6f 722c 206c 696e 6577  facecolor, linew
-00036f40: 6964 7468 3d6c 696e 6577 6964 7468 2c20  idth=linewidth, 
-00036f50: 6c61 6265 6c3d 6e61 6d65 290a 2020 2020  label=name).    
-00036f60: 2020 2020 656c 6966 2070 6c6f 745f 7479      elif plot_ty
-00036f70: 7065 2069 6e20 5b22 6d61 736b 225d 3a0a  pe in ["mask"]:.
-00036f80: 2020 2020 2020 2020 2020 2020 7061 7463              patc
-00036f90: 6820 3d20 6d70 6174 6368 6573 2e50 6174  h = mpatches.Pat
-00036fa0: 6368 2866 6163 6563 6f6c 6f72 3d66 6163  ch(facecolor=fac
-00036fb0: 6563 6f6c 6f72 2c20 6c61 6265 6c3d 6e61  ecolor, label=na
-00036fc0: 6d65 290a 0a20 2020 2020 2020 2069 6620  me)..        if 
-00036fd0: 7061 7463 683a 0a20 2020 2020 2020 2020  patch:.         
-00036fe0: 2020 2070 6174 6368 2e73 6574 5f61 6c70     patch.set_alp
-00036ff0: 6861 284e 6f6e 6529 0a0a 2020 2020 2020  ha(None)..      
-00037000: 2020 7265 7475 726e 2070 6174 6368 0a0a    return patch..
-00037010: 2020 2020 6465 6620 6765 745f 696e 7465      def get_inte
-00037020: 6e73 6974 6965 735f 3364 2873 656c 662c  nsities_3d(self,
-00037030: 2069 6d61 6765 3d4e 6f6e 652c 2073 7461   image=None, sta
-00037040: 6e64 6172 6469 7365 3d54 7275 6529 3a0a  ndardise=True):.
-00037050: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00037060: 2020 2020 5265 7475 726e 2063 6f70 7920      Return copy 
-00037070: 6f66 2061 6e20 696d 6167 6520 6172 7261  of an image arra
-00037080: 7920 7468 6174 2068 6173 2076 616c 7565  y that has value
-00037090: 7320 7265 7461 696e 6564 0a20 2020 2020  s retained.     
-000370a0: 2020 2069 6e73 6964 6520 7365 6c66 2c20     inside self, 
-000370b0: 616e 6420 6973 2073 6574 2074 6f20 7a65  and is set to ze
-000370c0: 726f 2065 6c73 6577 6865 7265 2e0a 0a20  ro elsewhere... 
-000370d0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-000370e0: 6572 3a2a 2a0a 0a20 2020 2020 2020 2069  er:**..        i
-000370f0: 6d61 6765 203a 2073 6b72 742e 696d 6167  mage : skrt.imag
-00037100: 652e 496d 6167 652c 2064 6566 6175 6c74  e.Image, default
-00037110: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00037120: 2020 496d 6167 6520 6f62 6a65 6374 2066    Image object f
-00037130: 6f72 2077 6869 6368 2033 4420 6172 7261  or which 3D arra
-00037140: 7920 7769 7468 2069 6e74 656e 7369 7479  y with intensity
-00037150: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
-00037160: 2020 2020 7265 7461 696e 6564 2069 6e73      retained ins
-00037170: 6964 6520 524f 492c 2061 6e64 204e 614e  ide ROI, and NaN
-00037180: 2065 6c73 6577 6865 7265 2c20 6973 2074   elsewhere, is t
-00037190: 6f20 6265 206f 6274 6169 6e65 642e 0a20  o be obtained.. 
-000371a0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
-000371b0: 6e65 2c20 7468 6520 696d 6167 6520 6173  ne, the image as
-000371c0: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
-000371d0: 6520 524f 4920 6973 2075 7365 642e 0a0a  e ROI is used...
-000371e0: 2020 2020 2020 2020 7374 616e 6461 7264          standard
-000371f0: 6973 6520 3a20 626f 6f6c 2c20 6465 6661  ise : bool, defa
-00037200: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-00037210: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-00037220: 7468 6520 6461 7461 2061 7272 6179 2077  the data array w
-00037230: 696c 6c20 6265 2072 6574 7572 6e65 6420  ill be returned 
-00037240: 696e 2074 6865 206f 7269 656e 7461 7469  in the orientati
-00037250: 6f6e 2069 6e20 0a20 2020 2020 2020 2020  on in .         
-00037260: 2020 2077 6869 6368 2069 7420 7761 7320     which it was 
-00037270: 6c6f 6164 6564 3b20 6f74 6865 7277 6973  loaded; otherwis
-00037280: 652c 2069 7420 7769 6c6c 2062 6520 7265  e, it will be re
-00037290: 7475 726e 6564 2069 6e20 7374 616e 6461  turned in standa
-000372a0: 7264 0a20 2020 2020 2020 2020 2020 2064  rd.            d
-000372b0: 6963 6f6d 2d73 7479 6c65 206f 7269 656e  icom-style orien
-000372c0: 7461 7469 6f6e 2073 7563 6820 7468 6174  tation such that
-000372d0: 205b 636f 6c75 6d6e 2c20 726f 772c 2073   [column, row, s
-000372e0: 6c69 6365 5d20 636f 7272 6573 706f 6e64  lice] correspond
-000372f0: 730a 2020 2020 2020 2020 2020 2020 746f  s.            to
-00037300: 2074 6865 205b 782c 2079 2c20 7a5d 2061   the [x, y, z] a
-00037310: 7865 732e 0a20 2020 2020 2020 2022 2222  xes..        """
-00037320: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
-00037330: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00037340: 2020 2020 2020 2023 2043 6f6e 7369 6465         # Conside
-00037350: 7220 696d 6167 6520 6173 736f 6369 6174  r image associat
-00037360: 6564 2077 6974 6820 7365 6c66 2e0a 2020  ed with self..  
-00037370: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00037380: 7265 6174 655f 6d61 736b 2829 0a20 2020  reate_mask().   
-00037390: 2020 2020 2020 2020 2069 6d61 6765 203d           image =
-000373a0: 2073 656c 662e 696d 6167 650a 2020 2020   self.image.    
-000373b0: 2020 2020 2020 2020 726f 6920 3d20 7365          roi = se
-000373c0: 6c66 0a20 2020 2020 2020 2065 6c73 653a  lf.        else:
-000373d0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-000373e0: 6c6f 6e65 2073 656c 662c 2061 6e64 2061  lone self, and a
-000373f0: 7373 6f63 6961 7465 2077 6974 6820 636c  ssociate with cl
-00037400: 6f6e 6520 7468 6520 696d 6167 6520 7370  one the image sp
-00037410: 6563 6966 6965 6420 696e 2069 6e70 7574  ecified in input
-00037420: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-00037430: 6920 3d20 7365 6c66 2e63 6c6f 6e65 2829  i = self.clone()
-00037440: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
-00037450: 2e73 6574 5f69 6d61 6765 2869 6d61 6765  .set_image(image
-00037460: 290a 0a20 2020 2020 2020 2023 204f 6274  )..        # Obt
-00037470: 6169 6e20 696e 7465 6e73 6974 7920 7661  ain intensity va
-00037480: 6c75 6573 2e0a 2020 2020 2020 2020 696d  lues..        im
-00037490: 5f64 6174 6120 3d20 696d 6167 652e 6765  _data = image.ge
-000374a0: 745f 6461 7461 2873 7461 6e64 6172 6469  t_data(standardi
-000374b0: 7365 3d73 7461 6e64 6172 6469 7365 290a  se=standardise).
-000374c0: 2020 2020 2020 2020 6d61 736b 203d 2072          mask = r
-000374d0: 6f69 2e67 6574 5f6d 6173 6b28 7374 616e  oi.get_mask(stan
-000374e0: 6461 7264 6973 653d 7374 616e 6461 7264  dardise=standard
-000374f0: 6973 6529 0a20 2020 2020 2020 2069 6e74  ise).        int
-00037500: 656e 7369 7469 6573 5f69 6e5f 726f 6920  ensities_in_roi 
-00037510: 3d20 6e70 2e66 756c 6c28 696d 5f64 6174  = np.full(im_dat
-00037520: 612e 7368 6170 652c 206e 702e 6e61 6e29  a.shape, np.nan)
-00037530: 0a20 2020 2020 2020 2069 6e74 656e 7369  .        intensi
-00037540: 7469 6573 5f69 6e5f 726f 695b 6d61 736b  ties_in_roi[mask
-00037550: 203e 2030 5d20 3d20 696d 5f64 6174 615b   > 0] = im_data[
-00037560: 6d61 736b 203e 2030 5d0a 2020 2020 2020  mask > 0].      
-00037570: 2020 7265 7475 726e 2069 6e74 656e 7369    return intensi
-00037580: 7469 6573 5f69 6e5f 726f 690a 0a20 2020  ties_in_roi..   
-00037590: 2064 6566 2067 6574 5f69 6e74 656e 7369   def get_intensi
-000375a0: 7469 6573 2873 656c 662c 2069 6d61 6765  ties(self, image
-000375b0: 3d4e 6f6e 652c 2073 7461 6e64 6172 6469  =None, standardi
-000375c0: 7365 3d54 7275 6529 3a0a 2020 2020 2020  se=True):.      
-000375d0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-000375e0: 7475 726e 2031 4420 6e75 6d70 7920 6172  turn 1D numpy ar
-000375f0: 7261 7920 636f 6e74 6169 6e69 6e67 2061  ray containing a
-00037600: 6c6c 206f 6620 7468 6520 696e 7465 6e73  ll of the intens
-00037610: 6974 7920 7661 6c75 6573 2066 6f72 2074  ity values for t
-00037620: 6865 200a 2020 2020 2020 2020 766f 7865  he .        voxe
-00037630: 6c73 2069 6e73 6964 6520 7365 6c66 2e0a  ls inside self..
-00037640: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-00037650: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
-00037660: 2020 696d 6167 6520 3a20 736b 7274 2e69    image : skrt.i
-00037670: 6d61 6765 2e49 6d61 6765 2c20 6465 6661  mage.Image, defa
-00037680: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00037690: 2020 2020 2049 6d61 6765 206f 626a 6563       Image objec
-000376a0: 7420 666f 7220 7768 6963 6820 3144 2061  t for which 1D a
-000376b0: 7272 6179 206f 6620 696e 7465 6e73 6974  rray of intensit
-000376c0: 7920 7661 6c75 6573 2069 730a 2020 2020  y values is.    
-000376d0: 2020 2020 2020 2020 746f 2062 6520 6f62          to be ob
-000376e0: 7461 696e 6564 2e20 2049 6620 4e6f 6e65  tained.  If None
-000376f0: 2c20 7468 6520 696d 6167 6520 6173 736f  , the image asso
-00037700: 6369 6174 6564 2077 6974 6820 7468 650a  ciated with the.
-00037710: 2020 2020 2020 2020 2020 2020 524f 4920              ROI 
-00037720: 6973 2075 7365 642e 0a0a 2020 2020 2020  is used...      
-00037730: 2020 7374 616e 6461 7264 6973 6520 3a20    standardise : 
-00037740: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00037750: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00037760: 4966 2046 616c 7365 2c20 7468 6520 696d  If False, the im
-00037770: 6167 6527 7320 6461 7461 2061 7272 6179  age's data array
-00037780: 2077 696c 6c20 6265 2075 7365 6420 696e   will be used in
-00037790: 2074 6865 206f 7269 656e 7461 7469 6f6e   the orientation
-000377a0: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
-000377b0: 7768 6963 6820 6974 2077 6173 206c 6f61  which it was loa
-000377c0: 6465 643b 206f 7468 6572 7769 7365 2c20  ded; otherwise, 
-000377d0: 6974 2077 696c 6c20 6265 2075 7365 6420  it will be used 
-000377e0: 696e 2073 7461 6e64 6172 640a 2020 2020  in standard.    
-000377f0: 2020 2020 2020 2020 6469 636f 6d2d 7374          dicom-st
-00037800: 796c 6520 6f72 6965 6e74 6174 696f 6e20  yle orientation 
-00037810: 7375 6368 2074 6861 7420 5b63 6f6c 756d  such that [colum
-00037820: 6e2c 2072 6f77 2c20 736c 6963 655d 2063  n, row, slice] c
-00037830: 6f72 7265 7370 6f6e 6473 0a20 2020 2020  orresponds.     
-00037840: 2020 2020 2020 2074 6f20 7468 6520 5b78         to the [x
-00037850: 2c20 792c 207a 5d20 6178 6573 2e0a 2020  , y, z] axes..  
-00037860: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00037870: 2020 696e 7465 6e73 6974 6965 7320 3d20    intensities = 
-00037880: 7365 6c66 2e67 6574 5f69 6e74 656e 7369  self.get_intensi
-00037890: 7469 6573 5f33 6428 696d 6167 652c 2073  ties_3d(image, s
-000378a0: 7461 6e64 6172 6469 7365 290a 2020 2020  tandardise).    
-000378b0: 2020 2020 7265 7475 726e 2069 6e74 656e      return inten
-000378c0: 7369 7469 6573 5b7e 6e70 2e69 736e 616e  sities[~np.isnan
-000378d0: 2869 6e74 656e 7369 7469 6573 295d 0a20  (intensities)]. 
-000378e0: 2020 2020 2020 200a 636c 6173 7320 5374         .class St
-000378f0: 7275 6374 7572 6553 6574 2873 6b72 742e  ructureSet(skrt.
-00037900: 636f 7265 2e41 7263 6869 7665 293a 0a20  core.Archive):. 
-00037910: 2020 2022 2222 0a20 2020 2043 6c61 7373     """.    Class
-00037920: 2072 6570 7265 7365 6e74 696e 6720 6120   representing a 
-00037930: 7261 6469 6f74 6865 7261 7079 2073 7472  radiotherapy str
-00037940: 7563 7475 7265 2073 6574 0a20 2020 2061  ucture set.    a
-00037950: 7320 6120 636f 6c6c 6563 7469 6f6e 206f  s a collection o
-00037960: 6620 7265 6769 6f6e 7320 6f66 2069 6e74  f regions of int
-00037970: 6572 6573 7420 2852 4f49 7329 2e0a 0a20  erest (ROIs)... 
-00037980: 2020 2041 7474 7269 6275 7465 7320 6f66     Attributes of
-00037990: 2061 2053 7472 7563 7475 7265 5365 7420   a StructureSet 
-000379a0: 6f62 6a65 6374 2073 686f 756c 6420 7573  object should us
-000379b0: 7561 6c6c 7920 6265 2061 6363 6573 7365  ually be accesse
-000379c0: 6420 7669 610a 2020 2020 7468 6569 7220  d via.    their 
-000379d0: 6765 7474 6572 206d 6574 686f 6473 2c20  getter methods, 
-000379e0: 7261 7468 6572 2074 6861 6e20 6469 7265  rather than dire
-000379f0: 6374 6c79 2c20 746f 2065 6e73 7572 6520  ctly, to ensure 
-00037a00: 7468 6174 0a20 2020 2061 7474 7269 6275  that.    attribu
-00037a10: 7465 2076 616c 7565 7320 6861 7665 2062  te values have b
-00037a20: 6565 6e20 6c6f 6164 6564 2e0a 2020 2020  een loaded..    
-00037a30: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-00037a40: 6e69 745f 5f28 0a20 2020 2020 2020 2073  nit__(.        s
-00037a50: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
-00037a60: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
-00037a70: 6e61 6d65 3d4e 6f6e 652c 0a20 2020 2020  name=None,.     
-00037a80: 2020 2069 6d61 6765 3d4e 6f6e 652c 0a20     image=None,. 
-00037a90: 2020 2020 2020 206c 6f61 643d 5472 7565         load=True
-00037aa0: 2c0a 2020 2020 2020 2020 6e61 6d65 733d  ,.        names=
-00037ab0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6b65  None,.        ke
-00037ac0: 6570 5f72 656e 616d 6564 5f6f 6e6c 793d  ep_renamed_only=
-00037ad0: 4661 6c73 652c 0a20 2020 2020 2020 2074  False,.        t
-00037ae0: 6f5f 6b65 6570 3d4e 6f6e 652c 0a20 2020  o_keep=None,.   
-00037af0: 2020 2020 2074 6f5f 7265 6d6f 7665 3d4e       to_remove=N
-00037b00: 6f6e 652c 0a20 2020 2020 2020 206d 756c  one,.        mul
-00037b10: 7469 5f6c 6162 656c 3d46 616c 7365 2c0a  ti_label=False,.
-00037b20: 2020 2020 2020 2020 636f 6c6f 7273 3d4e          colors=N
-00037b30: 6f6e 652c 0a20 2020 2020 2020 2069 676e  one,.        ign
-00037b40: 6f72 655f 6469 636f 6d5f 636f 6c6f 7273  ore_dicom_colors
-00037b50: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00037b60: 6175 746f 5f74 696d 6573 7461 6d70 3d46  auto_timestamp=F
-00037b70: 616c 7365 2c0a 2020 2020 2020 2020 616c  alse,.        al
-00037b80: 7068 615f 6265 7461 5f72 6174 696f 733d  pha_beta_ratios=
-00037b90: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
-00037ba0: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
-00037bb0: 2020 2020 2020 2222 224c 6f61 6420 7374        """Load st
-00037bc0: 7275 6374 7572 6520 7365 7420 6672 6f6d  ructure set from
-00037bd0: 2074 6865 2073 6f75 7263 6528 7329 2067   the source(s) g
-00037be0: 6976 656e 2069 6e20 3c70 6174 683e 2e0a  iven in <path>..
-00037bf0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-00037c00: 6574 6572 732a 2a3a 0a0a 2020 2020 2020  eters**:..      
-00037c10: 2020 7061 7468 203a 2073 7472 2f6c 6973    path : str/lis
-00037c20: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00037c30: 2020 2020 2020 2020 2020 2020 536f 7572              Sour
-00037c40: 6365 2873 2920 6f66 2052 4f49 7320 746f  ce(s) of ROIs to
-00037c50: 206c 6f61 6420 696e 746f 2074 6869 7320   load into this 
-00037c60: 7374 7275 6374 7572 6520 7365 742e 2043  structure set. C
-00037c70: 616e 2062 653a 0a0a 2020 2020 2020 2020  an be:..        
-00037c80: 2020 2020 2d20 5468 6520 7061 7468 2074      - The path t
-00037c90: 6f20 6120 7369 6e67 6c65 2064 6963 6f6d  o a single dicom
-00037ca0: 2073 7472 7563 7475 7265 2073 6574 2066   structure set f
-00037cb0: 696c 653b 0a20 2020 2020 2020 2020 2020  ile;.           
-00037cc0: 202d 2054 6865 2070 6174 6820 746f 2061   - The path to a
-00037cd0: 2073 696e 676c 6520 6e69 6674 6920 6669   single nifti fi
-00037ce0: 6c65 2063 6f6e 7461 696e 696e 6720 616e  le containing an
-00037cf0: 2052 4f49 206d 6173 6b3b 0a20 2020 2020   ROI mask;.     
-00037d00: 2020 2020 2020 202d 2041 206c 6973 7420         - A list 
-00037d10: 6f66 2070 6174 6873 2074 6f20 6e69 6674  of paths to nift
-00037d20: 6920 6669 6c65 7320 636f 6e74 6169 6e69  i files containi
-00037d30: 6e67 2052 4f49 206d 6173 6b73 3b0a 2020  ng ROI masks;.  
-00037d40: 2020 2020 2020 2020 2020 2d20 5468 6520            - The 
-00037d50: 7061 7468 2074 6f20 6120 6469 7265 6374  path to a direct
-00037d60: 6f72 7920 636f 6e74 6169 6e69 6e67 206d  ory containing m
-00037d70: 756c 7469 706c 6520 6e69 6674 6920 6669  ultiple nifti fi
-00037d80: 6c65 7320 0a20 2020 2020 2020 2020 2020  les .           
-00037d90: 2063 6f6e 7461 696e 696e 6720 524f 4920   containing ROI 
-00037da0: 6d61 736b 733b 0a20 2020 2020 2020 2020  masks;.         
-00037db0: 2020 202d 2041 206c 6973 7420 6f66 2052     - A list of R
-00037dc0: 4f49 206f 626a 6563 7473 3b0a 2020 2020  OI objects;.    
-00037dd0: 2020 2020 2020 2020 2d20 4120 6c69 7374          - A list
-00037de0: 206f 6620 6f62 6a65 6374 7320 7468 6174   of objects that
-00037df0: 2063 6f75 6c64 2062 6520 7573 6564 2074   could be used t
-00037e00: 6f20 696e 6974 6961 6c69 7365 2061 6e20  o initialise an 
-00037e10: 524f 4920 6f62 6a65 6374 0a20 2020 2020  ROI object.     
-00037e20: 2020 2020 2020 2028 652e 672e 2061 206e         (e.g. a n
-00037e30: 756d 7079 2061 7272 6179 292e 0a0a 2020  umpy array)...  
-00037e40: 2020 2020 2020 6e61 6d65 203a 2073 7472        name : str
-00037e50: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00037e60: 2020 2020 2020 2020 2020 204f 7074 696f             Optio
-00037e70: 6e61 6c20 6e61 6d65 2074 6f20 6173 7369  nal name to assi
-00037e80: 676e 2074 6f20 7468 6973 2073 7472 7563  gn to this struc
-00037e90: 7475 7265 2073 6574 2e20 4966 204e 6f6e  ture set. If Non
-00037ea0: 652c 2077 696c 6c20 0a20 2020 2020 2020  e, will .       
-00037eb0: 2020 2020 2061 7474 656d 7074 2074 6f20       attempt to 
-00037ec0: 696e 6665 7220 6672 6f6d 2069 6e70 7574  infer from input
-00037ed0: 2066 696c 656e 616d 652e 0a0a 2020 2020   filename...    
-00037ee0: 2020 2020 696d 6167 6520 3a20 736b 7274      image : skrt
-00037ef0: 2e69 6d61 6765 2e49 6d61 6765 2c20 6465  .image.Image, de
-00037f00: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00037f10: 2020 2020 2020 2049 6d61 6765 2061 7373         Image ass
-00037f20: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
-00037f30: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
-00037f40: 2049 6620 7468 6520 696e 7075 7420 736f   If the input so
-00037f50: 7572 6365 2069 7320 610a 2020 2020 2020  urce is a.      
-00037f60: 2020 2020 2020 6469 636f 6d20 6669 6c65        dicom file
-00037f70: 2063 6f6e 7461 696e 696e 6720 524f 4920   containing ROI 
-00037f80: 636f 6e74 6f75 7273 2c20 7468 6973 2069  contours, this i
-00037f90: 6d61 6765 2077 696c 6c20 6265 2075 7365  mage will be use
-00037fa0: 6420 7768 656e 0a20 2020 2020 2020 2020  d when.         
-00037fb0: 2020 2063 7265 6174 696e 6720 524f 4920     creating ROI 
-00037fc0: 6269 6e61 7279 206d 6173 6b73 2e0a 0a20  binary masks... 
-00037fd0: 2020 2020 2020 206c 6f61 6420 3a20 626f         load : bo
-00037fe0: 6f6c 2c20 6465 6661 756c 743d 5472 7565  ol, default=True
-00037ff0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00038000: 5472 7565 2c20 524f 4973 2077 696c 6c20  True, ROIs will 
-00038010: 696d 6d65 6469 6174 656c 7920 6265 206c  immediately be l
-00038020: 6f61 6465 6420 6672 6f6d 2073 6f75 7263  oaded from sourc
-00038030: 6573 2e20 4f74 6865 7277 6973 652c 0a20  es. Otherwise,. 
-00038040: 2020 2020 2020 2020 2020 206c 6f61 6469             loadi
-00038050: 6e67 2077 696c 6c20 6e6f 7420 6f63 6375  ng will not occu
-00038060: 7220 756e 7469 6c20 5374 7275 6374 7572  r until Structur
-00038070: 6553 6574 2e6c 6f61 6428 2920 6973 2063  eSet.load() is c
-00038080: 616c 6c65 642e 0a20 2020 2020 2020 200a  alled..        .
-00038090: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
-000380a0: 6469 6374 2f6c 6973 742c 2064 6566 6175  dict/list, defau
-000380b0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-000380c0: 2020 2020 4f70 7469 6f6e 616c 2064 6963      Optional dic
-000380d0: 7420 6f66 2052 4f49 206e 616d 6573 2074  t of ROI names t
-000380e0: 6f20 7573 6520 7768 656e 2072 656e 616d  o use when renam
-000380f0: 696e 6720 6c6f 6164 6564 2052 4f49 732e  ing loaded ROIs.
-00038100: 204b 6579 7320 0a20 2020 2020 2020 2020   Keys .         
-00038110: 2020 2073 686f 756c 6420 6265 2064 6573     should be des
-00038120: 6972 6564 206e 616d 6573 2c20 616e 6420  ired names, and 
-00038130: 7661 6c75 6573 2073 686f 756c 6420 6265  values should be
-00038140: 206c 6973 7473 206f 6620 706f 7373 6962   lists of possib
-00038150: 6c65 0a20 2020 2020 2020 2020 2020 2069  le.            i
-00038160: 6e70 7574 206e 616d 6573 206f 7220 7769  nput names or wi
-00038170: 6c64 6361 7264 7320 6d61 7463 6869 6e67  ldcards matching
-00038180: 2069 6e70 7574 206e 616d 6573 2e0a 0a20   input names... 
-00038190: 2020 2020 2020 2020 2020 2049 6620 6d75             If mu
-000381a0: 6c74 695f 6c61 6265 6c3d 5472 7565 2c20  lti_label=True, 
-000381b0: 6e61 6d65 7320 6361 6e20 616c 736f 2062  names can also b
-000381c0: 6520 6120 6c69 7374 206f 6620 6e61 6d65  e a list of name
-000381d0: 7320 746f 2061 7373 6967 6e0a 2020 2020  s to assign.    
-000381e0: 2020 2020 2020 2020 746f 2065 6163 6820          to each 
-000381f0: 6c61 6265 6c20 666f 756e 6420 696e 206f  label found in o
-00038200: 7264 6572 2c20 6672 6f6d 2073 6d61 6c6c  rder, from small
-00038210: 6573 7420 746f 206c 6172 6765 7374 2e0a  est to largest..
-00038220: 0a20 2020 2020 2020 2074 6f5f 6b65 6570  .        to_keep
-00038230: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
-00038240: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00038250: 2020 4f70 7469 6f6e 616c 206c 6973 7420    Optional list 
-00038260: 6f66 2052 4f49 206e 616d 6573 206f 7220  of ROI names or 
-00038270: 7769 6c64 6361 7264 7320 6d61 7463 6869  wildcards matchi
-00038280: 6e67 2052 4f49 206e 616d 6573 206f 6620  ng ROI names of 
-00038290: 524f 4973 0a20 2020 2020 2020 2020 2020  ROIs.           
-000382a0: 2074 6f20 6b65 6570 2069 6e20 7468 6973   to keep in this
-000382b0: 2053 7472 7563 7475 7265 5365 7420 6475   StructureSet du
-000382c0: 7269 6e67 206c 6f61 6469 6e67 2e20 524f  ring loading. RO
-000382d0: 4973 206e 6f74 206d 6174 6368 696e 6720  Is not matching 
-000382e0: 7769 6c6c 0a20 2020 2020 2020 2020 2020  will.           
-000382f0: 2062 6520 6469 7363 6172 6465 642e 204e   be discarded. N
-00038300: 6f74 6520 7468 6174 2074 6865 206e 616d  ote that the nam
-00038310: 6573 2073 686f 756c 6420 7265 666c 6563  es should reflec
-00038320: 7420 7468 6f73 6520 6166 7465 7220 0a20  t those after . 
-00038330: 2020 2020 2020 2020 2020 2072 656e 616d             renam
-00038340: 696e 6720 7669 6120 7468 6520 3c6e 616d  ing via the <nam
-00038350: 6573 3e20 6469 6374 2e20 4966 204e 6f6e  es> dict. If Non
-00038360: 652c 2061 6c6c 2052 4f49 7320 7769 6c6c  e, all ROIs will
-00038370: 2062 6520 6b65 7074 2e0a 0a20 2020 2020   be kept...     
-00038380: 2020 2074 6f5f 7265 6d6f 7665 203a 206c     to_remove : l
-00038390: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
-000383a0: 650a 2020 2020 2020 2020 2020 2020 4f70  e.            Op
-000383b0: 7469 6f6e 616c 206c 6973 7420 6f66 2052  tional list of R
-000383c0: 4f49 206e 616d 6573 206f 7220 7769 6c64  OI names or wild
-000383d0: 6361 7264 7320 6d61 7463 6869 6e67 2052  cards matching R
-000383e0: 4f49 206e 616d 6573 206f 6620 524f 4973  OI names of ROIs
-000383f0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-00038400: 7265 6d6f 7665 2066 726f 6d20 7468 6973  remove from this
-00038410: 2053 7472 7563 7475 7265 5365 7420 6475   StructureSet du
-00038420: 7269 6e67 206c 6f61 6469 6e67 2e20 524f  ring loading. RO
-00038430: 4973 206d 6174 6368 696e 6720 7769 6c6c  Is matching will
-00038440: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
-00038450: 6469 7363 6172 6465 642e 204e 6f74 6520  discarded. Note 
-00038460: 7468 6174 2074 6865 206e 616d 6573 2073  that the names s
-00038470: 686f 756c 6420 7265 666c 6563 7420 7468  hould reflect th
-00038480: 6f73 6520 6166 7465 7220 0a20 2020 2020  ose after .     
-00038490: 2020 2020 2020 2072 656e 616d 696e 6720         renaming 
-000384a0: 7669 6120 7468 6520 3c6e 616d 6573 3e20  via the <names> 
-000384b0: 6469 6374 2c20 616e 6420 7265 6d6f 7661  dict, and remova
-000384c0: 6c20 6f63 6375 7273 2061 6674 6572 2066  l occurs after f
-000384d0: 696c 7465 7269 6e67 0a20 2020 2020 2020  iltering.       
-000384e0: 2020 2020 2077 6974 6820 7468 6520 3c74       with the <t
-000384f0: 6f5f 6b65 6570 3e20 6c69 7374 2e20 4966  o_keep> list. If
-00038500: 204e 6f6e 652c 206e 6f20 524f 4973 2077   None, no ROIs w
-00038510: 696c 6c20 6265 2072 656d 6f76 6564 2e0a  ill be removed..
-00038520: 0a20 2020 2020 2020 206d 756c 7469 5f6c  .        multi_l
-00038530: 6162 656c 203a 2062 6f6f 6c2c 2064 6566  abel : bool, def
-00038540: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
-00038550: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00038560: 7769 6c6c 206c 6f6f 6b20 666f 7220 6d75  will look for mu
-00038570: 6c74 6970 6c65 2052 4f49 206d 6173 6b73  ltiple ROI masks
-00038580: 2077 6974 6820 6469 6666 6572 656e 7420   with different 
-00038590: 6c61 6265 6c73 200a 2020 2020 2020 2020  labels .        
-000385a0: 2020 2020 696e 7369 6465 2074 6865 2061      inside the a
-000385b0: 7272 6179 2061 6e64 2063 7265 6174 6520  rray and create 
-000385c0: 6120 7365 7061 7261 7465 2052 4f49 2066  a separate ROI f
-000385d0: 726f 6d20 6561 6368 2e0a 0a20 2020 2020  rom each...     
-000385e0: 2020 2063 6f6c 6f72 7320 3a20 6c69 7374     colors : list
-000385f0: 2f64 6963 740a 2020 2020 2020 2020 2020  /dict.          
-00038600: 2020 4c69 7374 206f 7220 6469 6374 206f    List or dict o
-00038610: 6620 636f 6c6f 7273 2e20 4966 2061 2064  f colors. If a d
-00038620: 6963 742c 2074 6865 206b 6579 7320 7368  ict, the keys sh
-00038630: 6f75 6c64 2062 6520 524f 4920 6e61 6d65  ould be ROI name
-00038640: 7320 6f72 0a20 2020 2020 2020 2020 2020  s or.           
-00038650: 2077 696c 6463 6172 6473 206d 6174 6368   wildcards match
-00038660: 696e 6720 524f 4920 6e61 6d65 732c 2061  ing ROI names, a
-00038670: 6e64 2074 6865 2076 616c 7565 7320 7368  nd the values sh
-00038680: 6f75 6c64 2062 6520 6465 7369 7265 6420  ould be desired 
-00038690: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-000386a0: 6f72 7320 666f 7220 524f 4973 206d 6174  ors for ROIs mat
-000386b0: 6368 696e 6720 7468 6174 206e 616d 652e  ching that name.
-000386c0: 2049 6620 6120 6c69 7374 2c20 7368 6f75   If a list, shou
-000386d0: 6c64 2063 6f6e 7461 696e 0a20 2020 2020  ld contain.     
-000386e0: 2020 2020 2020 2063 6f6c 6f72 7320 7768         colors wh
-000386f0: 6963 6820 7769 6c6c 2062 6520 6170 706c  ich will be appl
-00038700: 6965 6420 746f 206c 6f61 6465 6420 524f  ied to loaded RO
-00038710: 4973 2069 6e20 6f72 6465 722e 0a0a 2020  Is in order...  
-00038720: 2020 2020 2020 6175 746f 5f74 696d 6573        auto_times
-00038730: 7461 6d70 203a 2062 6f6f 6c20 6465 6661  tamp : bool defa
-00038740: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-00038750: 2020 2020 2020 4966 2074 7275 6520 616e        If true an
-00038760: 6420 6e6f 2076 616c 6964 2074 696d 6573  d no valid times
-00038770: 7461 6d70 2069 7320 666f 756e 6420 7769  tamp is found wi
-00038780: 7468 696e 2074 6865 2070 6174 6820 7374  thin the path st
-00038790: 7269 6e67 2c0a 2020 2020 2020 2020 2020  ring,.          
-000387a0: 2020 7469 6d65 7374 616d 7020 6765 6e65    timestamp gene
-000387b0: 7261 7465 6420 6672 6f6d 2063 7572 7265  rated from curre
-000387c0: 6e74 2064 6174 6520 616e 6420 7469 6d65  nt date and time
-000387d0: 2e0a 0a20 2020 2020 2020 2061 6c70 6861  ...        alpha
-000387e0: 5f62 6574 615f 7261 7469 6f73 203a 2064  _beta_ratios : d
-000387f0: 6963 742c 2064 6566 6175 6c74 3d4e 6f6e  ict, default=Non
-00038800: 650a 2020 2020 2020 2020 2020 2020 4469  e.            Di
-00038810: 6374 696f 6e61 7279 2077 6865 7265 206b  ctionary where k
-00038820: 6579 7320 6172 6520 524f 4920 6e61 6d65  eys are ROI name
-00038830: 7320 616e 6420 7661 6c75 6573 2061 7265  s and values are
-00038840: 0a20 2020 2020 2020 2020 2020 2072 6174  .            rat
-00038850: 696f 7320 666f 7220 524f 4920 7469 7373  ios for ROI tiss
-00038860: 7565 7320 6f66 2063 6f65 6666 6963 6965  ues of coefficie
-00038870: 6e74 732c 2061 6c70 6861 2c20 6265 7461  nts, alpha, beta
-00038880: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-00038890: 2074 6865 206c 696e 6561 722d 7175 6164   the linear-quad
-000388a0: 7261 7469 6320 6571 7561 7469 6f6e 2e20  ratic equation. 
-000388b0: 2054 6865 7365 2072 6174 696f 7320 6172   These ratios ar
-000388c0: 650a 2020 2020 2020 2020 2020 2020 7573  e.            us
-000388d0: 6564 2069 6e20 6361 6c63 756c 6174 696e  ed in calculatin
-000388e0: 6720 6269 6f6c 6f67 6963 616c 6c79 2065  g biologically e
-000388f0: 6666 6563 7469 7665 2064 6f73 652c 2042  ffective dose, B
-00038900: 4544 2c20 6672 6f6d 0a20 2020 2020 2020  ED, from.       
-00038910: 2020 2020 2070 6879 7369 6361 6c20 646f       physical do
-00038920: 7365 2c20 442c 2064 656c 6976 6572 6564  se, D, delivered
-00038930: 206f 7665 7220 6e20 6571 7561 6c20 6672   over n equal fr
-00038940: 6163 7469 6f6e 733a 0a20 2020 2020 2020  actions:.       
-00038950: 2020 2020 2020 2020 2042 4544 203d 2044           BED = D
-00038960: 202a 2028 3120 2b20 2844 2f6e 2920 2f20   * (1 + (D/n) / 
-00038970: 2861 6c70 6861 2f62 6574 6129 292e 0a20  (alpha/beta)).. 
-00038980: 2020 2020 2020 2020 2020 2054 6865 2061             The a
-00038990: 7474 7269 6275 7465 2061 6c70 6861 5f6f  ttribute alpha_o
-000389a0: 7665 725f 7661 6c75 6520 6973 2073 6574  ver_value is set
-000389b0: 2074 6f20 7468 6520 6469 6374 696f 6e61   to the dictiona
-000389c0: 7279 2076 616c 7565 0a20 2020 2020 2020  ry value.       
-000389d0: 2020 2020 2066 6f72 2061 6e20 524f 4920       for an ROI 
-000389e0: 6964 656e 7469 6669 6564 2062 7920 6120  identified by a 
-000389f0: 6b65 792c 206f 7220 6973 2073 6574 2074  key, or is set t
-00038a00: 6f20 4e6f 6e65 2066 6f72 2061 6e79 0a20  o None for any. 
-00038a10: 2020 2020 2020 2020 2020 206f 7468 6572             other
-00038a20: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
-00038a30: 602a 2a60 6b77 6172 6773 203a 0a20 2020  `**`kwargs :.   
-00038a40: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
-00038a50: 6e61 6c20 6b65 7977 6f72 6420 6172 6773  nal keyword args
-00038a60: 2074 6f20 7573 6520 7768 656e 2069 6e69   to use when ini
-00038a70: 7469 616c 6973 696e 6720 6e65 7720 524f  tialising new RO
-00038a80: 4920 6f62 6a65 6374 732e 0a20 2020 2020  I objects..     
-00038a90: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00038aa0: 2320 436c 6f6e 6520 6672 6f6d 2061 6e6f  # Clone from ano
-00038ab0: 7468 6572 2053 7472 7563 7475 7265 5365  ther StructureSe
-00038ac0: 7420 6f62 6a65 6374 0a20 2020 2020 2020  t object.       
-00038ad0: 2069 6620 6973 7375 6263 6c61 7373 2874   if issubclass(t
-00038ae0: 7970 6528 7061 7468 292c 2053 7472 7563  ype(path), Struc
-00038af0: 7475 7265 5365 7429 3a0a 2020 2020 2020  tureSet):.      
-00038b00: 2020 2020 2020 7061 7468 2e63 6c6f 6e65        path.clone
-00038b10: 5f61 7474 7273 2873 656c 6629 0a20 2020  _attrs(self).   
-00038b20: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00038b30: 0a20 2020 2020 2020 2073 656c 662e 6e61  .        self.na
-00038b40: 6d65 203d 206e 616d 650a 2020 2020 2020  me = name.      
-00038b50: 2020 7061 7468 203d 2028 736b 7274 2e63    path = (skrt.c
-00038b60: 6f72 652e 6675 6c6c 7061 7468 2870 6174  ore.fullpath(pat
-00038b70: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-00038b80: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00038b90: 2870 6174 682c 2028 7374 722c 2050 6174  (path, (str, Pat
-00038ba0: 6829 2920 656c 7365 2070 6174 6829 0a20  h)) else path). 
-00038bb0: 2020 2020 2020 2073 656c 662e 736f 7572         self.sour
-00038bc0: 6365 7320 3d20 7061 7468 0a20 2020 2020  ces = path.     
-00038bd0: 2020 2069 6620 7365 6c66 2e73 6f75 7263     if self.sourc
-00038be0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00038bf0: 2020 2020 2020 2020 7365 6c66 2e73 6f75          self.sou
-00038c00: 7263 6573 203d 205b 5d0a 2020 2020 2020  rces = [].      
-00038c10: 2020 656c 6966 206e 6f74 2073 6b72 742e    elif not skrt.
-00038c20: 636f 7265 2e69 735f 6c69 7374 2870 6174  core.is_list(pat
-00038c30: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-00038c40: 7365 6c66 2e73 6f75 7263 6573 203d 205b  self.sources = [
-00038c50: 7061 7468 5d0a 2020 2020 2020 2020 7365  path].        se
-00038c60: 6c66 2e72 6f69 7320 3d20 5b5d 0a20 2020  lf.rois = [].   
-00038c70: 2020 2020 2073 656c 662e 7365 745f 696d       self.set_im
-00038c80: 6167 6528 696d 6167 6529 0a20 2020 2020  age(image).     
-00038c90: 2020 2073 656c 662e 746f 5f6b 6565 7020     self.to_keep 
-00038ca0: 3d20 746f 5f6b 6565 700a 2020 2020 2020  = to_keep.      
-00038cb0: 2020 7365 6c66 2e74 6f5f 7265 6d6f 7665    self.to_remove
-00038cc0: 203d 2074 6f5f 7265 6d6f 7665 0a20 2020   = to_remove.   
-00038cd0: 2020 2020 2073 656c 662e 6e61 6d65 7320       self.names 
-00038ce0: 3d20 6e61 6d65 730a 2020 2020 2020 2020  = names.        
-00038cf0: 7365 6c66 2e6b 6565 705f 7265 6e61 6d65  self.keep_rename
-00038d00: 645f 6f6e 6c79 203d 206b 6565 705f 7265  d_only = keep_re
-00038d10: 6e61 6d65 645f 6f6e 6c79 0a20 2020 2020  named_only.     
-00038d20: 2020 2073 656c 662e 6d75 6c74 695f 6c61     self.multi_la
-00038d30: 6265 6c20 3d20 6d75 6c74 695f 6c61 6265  bel = multi_labe
-00038d40: 6c0a 2020 2020 2020 2020 7365 6c66 2e63  l.        self.c
-00038d50: 6f6c 6f72 7320 3d20 636f 6c6f 7273 0a20  olors = colors. 
-00038d60: 2020 2020 2020 2073 656c 662e 6967 6e6f         self.igno
-00038d70: 7265 5f64 6963 6f6d 5f63 6f6c 6f72 7320  re_dicom_colors 
-00038d80: 3d20 6967 6e6f 7265 5f64 6963 6f6d 5f63  = ignore_dicom_c
-00038d90: 6f6c 6f72 730a 2020 2020 2020 2020 7365  olors.        se
-00038da0: 6c66 2e64 6963 6f6d 5f64 6174 6173 6574  lf.dicom_dataset
-00038db0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00038dc0: 7365 6c66 2e61 6c70 6861 5f62 6574 615f  self.alpha_beta_
-00038dd0: 7261 7469 6f73 203d 2061 6c70 6861 5f62  ratios = alpha_b
-00038de0: 6574 615f 7261 7469 6f73 206f 7220 7b7d  eta_ratios or {}
-00038df0: 0a20 2020 2020 2020 2073 656c 662e 726f  .        self.ro
-00038e00: 695f 6b77 6172 6773 203d 206b 7761 7267  i_kwargs = kwarg
-00038e10: 730a 2020 2020 2020 2020 7365 6c66 2e70  s.        self.p
-00038e20: 6c61 6e73 203d 205b 5d0a 2020 2020 2020  lans = [].      
-00038e30: 2020 7061 7468 203d 2070 6174 6820 6966    path = path if
-00038e40: 2069 7369 6e73 7461 6e63 6528 7061 7468   isinstance(path
-00038e50: 2c20 7374 7229 2065 6c73 6520 2222 0a20  , str) else "". 
-00038e60: 2020 2020 2020 2073 6b72 742e 636f 7265         skrt.core
-00038e70: 2e41 7263 6869 7665 2e5f 5f69 6e69 745f  .Archive.__init_
-00038e80: 5f28 7365 6c66 2c20 7061 7468 2c20 6175  _(self, path, au
-00038e90: 746f 5f74 696d 6573 7461 6d70 290a 2020  to_timestamp).  
-00038ea0: 2020 2020 2020 6966 2073 656c 662e 7061        if self.pa
-00038eb0: 7468 2061 6e64 206e 6f74 2073 656c 662e  th and not self.
-00038ec0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-00038ed0: 2020 6e61 6d65 203d 2050 6174 6828 7365    name = Path(se
-00038ee0: 6c66 2e70 6174 6829 2e6e 616d 652e 7370  lf.path).name.sp
-00038ef0: 6c69 7428 275f 2729 5b30 5d2e 6c6f 7765  lit('_')[0].lowe
-00038f00: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-00038f10: 6966 206e 616d 655b 305d 2e69 7361 6c70  if name[0].isalp
-00038f20: 6861 2829 3a0a 2020 2020 2020 2020 2020  ha():.          
-00038f30: 2020 2020 2020 7365 6c66 2e6e 616d 6520        self.name 
-00038f40: 3d20 6e61 6d65 0a20 2020 2020 2020 2073  = name.        s
-00038f50: 656c 662e 7375 6d6d 6564 5f6e 616d 6573  elf.summed_names
-00038f60: 203d 205b 5d0a 0a20 2020 2020 2020 2073   = []..        s
-00038f70: 656c 662e 6c6f 6164 6564 203d 2046 616c  elf.loaded = Fal
-00038f80: 7365 0a20 2020 2020 2020 2069 6620 6c6f  se.        if lo
-00038f90: 6164 3a0a 2020 2020 2020 2020 2020 2020  ad:.            
-00038fa0: 7365 6c66 2e6c 6f61 6428 290a 0a20 2020  self.load()..   
-00038fb0: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
-00038fc0: 2873 656c 662c 2072 6f69 293a 0a20 2020  (self, roi):.   
-00038fd0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00038fe0: 6365 2872 6f69 2c20 696e 7429 3a0a 2020  ce(roi, int):.  
-00038ff0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00039000: 2073 656c 662e 6765 745f 726f 6973 2829   self.get_rois()
-00039010: 5b72 6f69 5d20 0a20 2020 2020 2020 2065  [roi] .        e
-00039020: 6c69 6620 6973 696e 7374 616e 6365 2872  lif isinstance(r
-00039030: 6f69 2c20 7374 7229 3a0a 2020 2020 2020  oi, str):.      
-00039040: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00039050: 662e 6765 745f 726f 695f 6469 6374 2829  f.get_roi_dict()
-00039060: 5b72 6f69 5d0a 0a20 2020 2064 6566 205f  [roi]..    def _
-00039070: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
-00039080: 2020 2020 2020 2072 6574 7572 6e20 5374         return St
-00039090: 7275 6374 7572 6553 6574 4974 6572 6174  ructureSetIterat
-000390a0: 6f72 2873 656c 6629 0a0a 2020 2020 6465  or(self)..    de
-000390b0: 6620 5f5f 6164 645f 5f28 7365 6c66 2c20  f __add__(self, 
-000390c0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-000390d0: 2727 270a 2020 2020 2020 2020 4465 6669  '''.        Defi
-000390e0: 6e65 2061 6464 6974 696f 6e20 6f66 2053  ne addition of S
-000390f0: 7472 7563 7475 7265 5365 7420 696e 7374  tructureSet inst
-00039100: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
-00039110: 5468 6520 7265 7375 6c74 206f 6620 7468  The result of th
-00039120: 6520 6164 6469 7469 6f6e 206f 6620 7365  e addition of se
-00039130: 6c66 2061 6e64 206f 7468 6572 2069 7320  lf and other is 
-00039140: 6120 5374 7275 6374 7572 6553 6574 0a20  a StructureSet. 
-00039150: 2020 2020 2020 206f 626a 6563 7420 7468         object th
-00039160: 6174 2063 6f6e 7461 696e 7320 7468 6520  at contains the 
-00039170: 2863 6c6f 6e65 6429 2052 4f49 7320 6f66  (cloned) ROIs of
-00039180: 2062 6f74 682e 2020 4120 7265 7375 6c74   both.  A result
-00039190: 2052 4f49 0a20 2020 2020 2020 2077 696c   ROI.        wil
-000391a0: 6c20 6265 2070 7265 6669 7865 6420 6279  l be prefixed by
-000391b0: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-000391c0: 2053 7472 7563 7475 7265 5365 7420 6672   StructureSet fr
-000391d0: 6f6d 2077 6869 6368 2069 740a 2020 2020  om which it.    
-000391e0: 2020 2020 6f72 6967 696e 6174 6573 2e20      originates. 
-000391f0: 2049 6620 7468 6520 524f 4920 6e61 6d65   If the ROI name
-00039200: 2062 6566 6f72 6520 7468 6520 6164 6469   before the addi
-00039210: 7469 6f6e 2068 6173 2074 6865 2053 7472  tion has the Str
-00039220: 7563 7475 7265 5365 740a 2020 2020 2020  uctureSet.      
-00039230: 2020 6e61 6d65 2061 7320 7072 6566 6978    name as prefix
-00039240: 2c20 6e6f 206e 6577 2070 7265 6669 7820  , no new prefix 
-00039250: 6973 2061 6464 6564 2e20 2054 6865 7265  is added.  There
-00039260: 2069 7320 6e6f 2072 6571 7569 7265 6d65   is no requireme
-00039270: 6e74 0a20 2020 2020 2020 2074 6861 7420  nt.        that 
-00039280: 524f 4973 206f 7220 7468 6569 7220 6e61  ROIs or their na
-00039290: 6d65 7320 6265 2075 6e69 7175 6520 7769  mes be unique wi
-000392a0: 7468 696e 2061 2053 7472 7563 7475 7265  thin a Structure
-000392b0: 5365 742e 2020 4164 6469 6e67 0a20 2020  Set.  Adding.   
-000392c0: 2020 2020 2061 2053 7472 7563 7475 7265       a Structure
-000392d0: 5365 7420 746f 2069 7473 656c 6620 7769  Set to itself wi
-000392e0: 6c6c 2067 6976 6520 6120 7265 7375 6c74  ll give a result
-000392f0: 2069 6e63 6c75 6469 6e67 2064 7570 6c69   including dupli
-00039300: 6361 7465 0a20 2020 2020 2020 2052 4f49  cate.        ROI
-00039310: 7320 7769 7468 2064 7570 6c69 6361 7465  s with duplicate
-00039320: 206e 616d 6573 2e0a 2020 2020 2020 2020   names..        
-00039330: 2727 270a 2020 2020 2020 2020 2320 456e  '''.        # En
-00039340: 7375 7265 2074 6861 7420 5374 7275 6374  sure that Struct
-00039350: 7572 6553 6574 2064 6174 6120 6172 6520  ureSet data are 
-00039360: 6c6f 6164 6564 2e0a 2020 2020 2020 2020  loaded..        
-00039370: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
-00039380: 2020 2020 6f74 6865 722e 6c6f 6164 2829      other.load()
-00039390: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
-000393a0: 7465 206e 6577 2053 7472 7563 7475 7265  te new Structure
-000393b0: 5365 7420 696e 7374 616e 6365 2066 6f72  Set instance for
-000393c0: 2073 756d 2c0a 2020 2020 2020 2020 2320   sum,.        # 
-000393d0: 616e 6420 7374 6f72 6520 6e61 6d65 7320  and store names 
-000393e0: 6f66 2063 6f6e 7472 6962 7574 6f72 732e  of contributors.
-000393f0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00039400: 3d20 5374 7275 6374 7572 6553 6574 2829  = StructureSet()
-00039410: 0a20 2020 2020 2020 2072 6573 756c 742e  .        result.
-00039420: 7375 6d6d 6564 5f6e 616d 6573 203d 205b  summed_names = [
-00039430: 5d0a 2020 2020 2020 2020 666f 7220 6e61  ].        for na
-00039440: 6d65 7320 696e 205b 7365 6c66 2e73 756d  mes in [self.sum
-00039450: 6d65 645f 6e61 6d65 732c 206f 7468 6572  med_names, other
-00039460: 2e73 756d 6d65 645f 6e61 6d65 732c 0a20  .summed_names,. 
-00039470: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00039480: 7365 6c66 2e6e 616d 655d 2c20 5b6f 7468  self.name], [oth
-00039490: 6572 2e6e 616d 655d 5d3a 0a20 2020 2020  er.name]]:.     
-000394a0: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
-000394b0: 696e 206e 616d 6573 3a0a 2020 2020 2020  in names:.      
-000394c0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-000394d0: 6e73 7461 6e63 6528 6e61 6d65 2c20 7374  nstance(name, st
-000394e0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000394f0: 2020 2020 2020 2020 666f 7220 7375 625f          for sub_
-00039500: 6e61 6d65 2069 6e20 6e61 6d65 2e73 706c  name in name.spl
-00039510: 6974 2822 5f22 293a 0a20 2020 2020 2020  it("_"):.       
-00039520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039530: 2069 6620 7375 625f 6e61 6d65 206e 6f74   if sub_name not
-00039540: 2069 6e20 7265 7375 6c74 2e73 756d 6d65   in result.summe
-00039550: 645f 6e61 6d65 733a 0a20 2020 2020 2020  d_names:.       
-00039560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039570: 2020 2020 2072 6573 756c 742e 7375 6d6d       result.summ
-00039580: 6564 5f6e 616d 6573 2e61 7070 656e 6428  ed_names.append(
-00039590: 7375 625f 6e61 6d65 290a 2020 2020 2020  sub_name).      
-000395a0: 2020 7265 7375 6c74 2e73 756d 6d65 645f    result.summed_
-000395b0: 6e61 6d65 732e 736f 7274 2829 0a0a 2020  names.sort()..  
-000395c0: 2020 2020 2020 2320 4c6f 6f70 206f 7665        # Loop ove
-000395d0: 7220 5374 7275 6374 7572 6553 6574 7320  r StructureSets 
-000395e0: 616e 6420 7468 6569 7220 524f 4973 2e0a  and their ROIs..
-000395f0: 2020 2020 2020 2020 666f 7220 7373 2069          for ss i
-00039600: 6e20 5b73 656c 662c 206f 7468 6572 5d3a  n [self, other]:
-00039610: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00039620: 2072 6f69 2069 6e20 7373 2e67 6574 5f72   roi in ss.get_r
-00039630: 6f69 7328 293a 0a20 2020 2020 2020 2020  ois():.         
-00039640: 2020 2020 2020 2072 6f69 5f63 6c6f 6e65         roi_clone
-00039650: 203d 2072 6f69 2e63 6c6f 6e65 2829 0a20   = roi.clone(). 
-00039660: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00039670: 2054 7279 2074 6f20 7072 6566 6978 2052   Try to prefix R
-00039680: 4f49 206e 616d 6520 7769 7468 2074 6865  OI name with the
-00039690: 206e 616d 6520 6f66 2074 6865 2053 7472   name of the Str
-000396a0: 7563 7475 7265 5365 740a 2020 2020 2020  uctureSet.      
-000396b0: 2020 2020 2020 2020 2020 2320 6672 6f6d            # from
-000396c0: 2077 6869 6368 2069 7420 6f72 6967 696e   which it origin
-000396d0: 6174 6573 2e0a 2020 2020 2020 2020 2020  ates..          
-000396e0: 2020 2020 2020 6966 2028 726f 692e 6e61        if (roi.na
-000396f0: 6d65 2e73 706c 6974 2822 5f22 295b 305d  me.split("_")[0]
-00039700: 2069 6e20 7265 7375 6c74 2e73 756d 6d65   in result.summe
-00039710: 645f 6e61 6d65 730a 2020 2020 2020 2020  d_names.        
-00039720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039730: 6f72 2073 732e 6e61 6d65 2069 7320 4e6f  or ss.name is No
-00039740: 6e65 293a 0a20 2020 2020 2020 2020 2020  ne):.           
-00039750: 2020 2020 2020 2020 2072 6f69 5f63 6c6f           roi_clo
-00039760: 6e65 2e6e 616d 6520 3d20 726f 692e 6e61  ne.name = roi.na
-00039770: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-00039780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00039790: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-000397a0: 5f63 6c6f 6e65 2e6e 616d 6520 3d20 225f  _clone.name = "_
-000397b0: 222e 6a6f 696e 285b 7373 2e6e 616d 652c  ".join([ss.name,
-000397c0: 2072 6f69 2e6e 616d 655d 290a 2020 2020   roi.name]).    
-000397d0: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
-000397e0: 6420 524f 4920 746f 2074 6865 2072 6573  d ROI to the res
-000397f0: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
-00039800: 2020 2020 2072 6573 756c 742e 6164 645f       result.add_
-00039810: 726f 6928 726f 695f 636c 6f6e 6529 0a0a  roi(roi_clone)..
-00039820: 2020 2020 2020 2020 2320 4173 2072 6573          # As res
-00039830: 756c 7420 696d 6167 6520 7365 7420 7468  ult image set th
-00039840: 6520 696d 6167 6520 6f66 2073 656c 6620  e image of self 
-00039850: 6966 206e 6f6e 2d6e 756c 6c2c 0a20 2020  if non-null,.   
-00039860: 2020 2020 2023 206f 7220 6f74 6877 6973       # or othwis
-00039870: 6520 7468 6520 696d 6167 6520 6f66 206f  e the image of o
-00039880: 7468 6572 2e0a 2020 2020 2020 2020 696d  ther..        im
-00039890: 6167 6520 3d20 7365 6c66 2e69 6d61 6765  age = self.image
-000398a0: 2069 6620 7365 6c66 2e69 6d61 6765 2065   if self.image e
-000398b0: 6c73 6520 6f74 6865 722e 696d 6167 650a  lse other.image.
-000398c0: 2020 2020 2020 2020 7265 7375 6c74 2e73          result.s
-000398d0: 6574 5f69 6d61 6765 2869 6d61 6765 290a  et_image(image).
-000398e0: 0a20 2020 2020 2020 2023 2053 6574 2074  .        # Set t
-000398f0: 6865 2072 6573 756c 7420 6e61 6d65 2074  he result name t
-00039900: 6f20 6265 2074 6865 2063 6f6e 6361 7465  o be the concate
-00039910: 6e61 7469 6f6e 206f 6620 7468 6520 6e61  nation of the na
-00039920: 6d65 730a 2020 2020 2020 2020 2320 6f66  mes.        # of
-00039930: 2074 6865 2063 6f6e 7472 6962 7574 6f72   the contributor
-00039940: 732e 0a20 2020 2020 2020 2069 6620 7265  s..        if re
-00039950: 7375 6c74 2e73 756d 6d65 645f 6e61 6d65  sult.summed_name
-00039960: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-00039970: 6573 756c 742e 6e61 6d65 203d 2022 5f22  esult.name = "_"
-00039980: 2e6a 6f69 6e28 7265 7375 6c74 2e73 756d  .join(result.sum
-00039990: 6d65 645f 6e61 6d65 7329 0a0a 2020 2020  med_names)..    
-000399a0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000399b0: 740a 0a20 2020 2064 6566 205f 5f69 6164  t..    def __iad
-000399c0: 645f 5f28 7365 6c66 2c20 6f74 6865 7229  d__(self, other)
-000399d0: 3a0a 2020 2020 2020 2020 2727 270a 2020  :.        '''.  
-000399e0: 2020 2020 2020 4465 6669 6e65 2069 6e2d        Define in-
-000399f0: 706c 6163 6520 6f66 2053 7472 7563 7475  place of Structu
-00039a00: 7265 5365 7420 696e 7374 616e 6365 732e  reSet instances.
-00039a10: 0a0a 2020 2020 2020 2020 5468 6520 7265  ..        The re
-00039a20: 7375 6c74 206f 6620 7468 6520 6164 6469  sult of the addi
-00039a30: 7469 6f6e 206f 6620 7365 6c66 2061 6e64  tion of self and
-00039a40: 206f 7468 6572 2069 7320 6120 5374 7275   other is a Stru
-00039a50: 6374 7572 6553 6574 0a20 2020 2020 2020  ctureSet.       
-00039a60: 206f 626a 6563 7420 7468 6174 2063 6f6e   object that con
-00039a70: 7461 696e 7320 7468 6520 2863 6c6f 6e65  tains the (clone
-00039a80: 6429 2052 4f49 7320 6f66 2062 6f74 682e  d) ROIs of both.
-00039a90: 2020 4120 7265 7375 6c74 2052 4f49 0a20    A result ROI. 
-00039aa0: 2020 2020 2020 2077 696c 6c20 6265 2070         will be p
-00039ab0: 7265 6669 7865 6420 6279 2074 6865 206e  refixed by the n
-00039ac0: 616d 6520 6f66 2074 6865 2053 7472 7563  ame of the Struc
-00039ad0: 7475 7265 5365 7420 6672 6f6d 2077 6869  tureSet from whi
-00039ae0: 6368 2069 740a 2020 2020 2020 2020 6f72  ch it.        or
-00039af0: 6967 696e 6174 6573 2e20 2049 6620 7468  iginates.  If th
-00039b00: 6520 524f 4920 6e61 6d65 2062 6566 6f72  e ROI name befor
-00039b10: 6520 7468 6520 6164 6469 7469 6f6e 2068  e the addition h
-00039b20: 6173 2074 6865 2053 7472 7563 7475 7265  as the Structure
-00039b30: 5365 740a 2020 2020 2020 2020 6e61 6d65  Set.        name
-00039b40: 2061 7320 7072 6566 6978 2c20 6e6f 206e   as prefix, no n
-00039b50: 6577 2070 7265 6669 7820 6973 2061 6464  ew prefix is add
-00039b60: 6564 2e20 2054 6865 7265 2069 7320 6e6f  ed.  There is no
-00039b70: 2072 6571 7569 7265 6d65 6e74 0a20 2020   requirement.   
-00039b80: 2020 2020 2074 6861 7420 524f 4973 206f       that ROIs o
-00039b90: 7220 7468 6569 7220 6e61 6d65 7320 6265  r their names be
-00039ba0: 2075 6e69 7175 6520 7769 7468 696e 2061   unique within a
-00039bb0: 2053 7472 7563 7475 7265 5365 742e 2020   StructureSet.  
-00039bc0: 4164 6469 6e67 0a20 2020 2020 2020 2061  Adding.        a
-00039bd0: 2053 7472 7563 7475 7265 5365 7420 746f   StructureSet to
-00039be0: 2069 7473 656c 6620 7769 6c6c 2067 6976   itself will giv
-00039bf0: 6520 6120 7265 7375 6c74 2069 6e63 6c75  e a result inclu
-00039c00: 6469 6e67 2064 7570 6c69 6361 7465 0a20  ding duplicate. 
-00039c10: 2020 2020 2020 2052 4f49 7320 7769 7468         ROIs with
-00039c20: 2064 7570 6c69 6361 7465 206e 616d 6573   duplicate names
-00039c30: 2e0a 2020 2020 2020 2020 2727 270a 2020  ..        '''.  
-00039c40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00039c50: 6620 2b20 6f74 6865 720a 0a20 2020 2064  f + other..    d
-00039c60: 6566 206c 6f61 6428 7365 6c66 2c20 736f  ef load(self, so
-00039c70: 7572 6365 733d 4e6f 6e65 2c20 666f 7263  urces=None, forc
-00039c80: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
-00039c90: 2020 2222 224c 6f61 6420 7374 7275 6374    """Load struct
-00039ca0: 7572 6520 7365 7420 6672 6f6d 2073 6f75  ure set from sou
-00039cb0: 7263 6528 7329 2e20 4966 204e 6f6e 652c  rce(s). If None,
-00039cc0: 2077 696c 6c20 6c6f 6164 2066 726f 6d20   will load from 
-00039cd0: 6f77 6e0a 2020 2020 2020 2020 7365 6c66  own.        self
-00039ce0: 2e73 6f75 7263 6573 2e22 2222 0a0a 2020  .sources."""..  
-00039cf0: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
-00039d00: 6164 6564 2061 6e64 206e 6f74 2066 6f72  aded and not for
-00039d10: 6365 2061 6e64 2073 6f75 7263 6573 2069  ce and sources i
-00039d20: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00039d30: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00039d40: 2020 2020 6966 2073 6f75 7263 6573 2069      if sources i
-00039d50: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00039d60: 2020 2020 736f 7572 6365 7320 3d20 7365      sources = se
-00039d70: 6c66 2e73 6f75 7263 6573 0a0a 2020 2020  lf.sources..    
-00039d80: 2020 2020 2320 4c61 6f64 2066 726f 6d20      # Laod from 
-00039d90: 6d75 6c74 692d 6c61 6265 6c20 6172 7261  multi-label arra
-00039da0: 790a 2020 2020 2020 2020 6966 2073 656c  y.        if sel
-00039db0: 662e 6d75 6c74 695f 6c61 6265 6c3a 0a0a  f.multi_label:..
-00039dc0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00039dd0: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
-00039de0: 732c 206c 6973 7429 2061 6e64 206c 656e  s, list) and len
-00039df0: 2873 6f75 7263 6573 2920 3d3d 2031 3a0a  (sources) == 1:.
-00039e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039e10: 736f 7572 6365 7320 3d20 736f 7572 6365  sources = source
-00039e20: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
-00039e30: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00039e40: 6365 2873 6f75 7263 6573 2c20 7374 7229  ce(sources, str)
-00039e50: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
-00039e60: 6e63 6528 736f 7572 6365 732c 206e 702e  nce(sources, np.
-00039e70: 6e64 6172 7261 7929 3a0a 2020 2020 2020  ndarray):.      
-00039e80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00039e90: 5479 7065 4572 726f 7228 2249 6e70 7574  TypeError("Input
-00039ea0: 2066 6f72 2061 206d 756c 7469 2d6c 6162   for a multi-lab
-00039eb0: 656c 2069 6d61 6765 206d 7573 7420 6265  el image must be
-00039ec0: 2066 696c 6570 6174 6820 220a 2020 2020   filepath ".    
-00039ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039ee0: 2020 2020 2020 2020 2020 2020 6622 6f72              f"or
-00039ef0: 206e 756d 7079 2061 7272 6179 2e20 5479   numpy array. Ty
-00039f00: 7065 2066 6f75 6e64 3a20 7b74 7970 6528  pe found: {type(
-00039f10: 736f 7572 6365 7329 7d2e 2229 0a20 2020  sources)}.").   
-00039f20: 2020 2020 2020 2020 2073 696e 676c 655f           single_
-00039f30: 736f 7572 6365 203d 2054 7275 650a 0a20  source = True.. 
-00039f40: 2020 2020 2020 2020 2020 2023 204c 6f61             # Loa
-00039f50: 6420 696e 7075 7420 6172 7261 7920 696e  d input array in
-00039f60: 746f 2069 6d61 6765 0a20 2020 2020 2020  to image.       
-00039f70: 2020 2020 2061 7272 6179 203d 2073 6b72       array = skr
-00039f80: 742e 696d 6167 652e 496d 6167 6528 736f  t.image.Image(so
-00039f90: 7572 6365 7329 2e67 6574 5f64 6174 6128  urces).get_data(
-00039fa0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
-00039fb0: 292e 6173 7479 7065 2869 6e74 290a 2020  ).astype(int).  
-00039fc0: 2020 2020 2020 2020 2020 6e20 3d20 6172            n = ar
-00039fd0: 7261 792e 6d61 7828 290a 0a20 2020 2020  ray.max()..     
-00039fe0: 2020 2020 2020 2023 2045 6e66 6f72 6365         # Enforce
-00039ff0: 2044 6963 6f6d 2063 6f6e 7665 6e74 696f   Dicom conventio
-0003a000: 6e20 666f 7220 6461 7461 2061 7272 6179  n for data array
-0003a010: 206f 6620 696d 6167 6520 6f62 6a65 6374   of image object
-0003a020: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
-0003a030: 736f 2074 6861 7420 6166 6669 6e65 206d  so that affine m
-0003a040: 6174 7269 7820 7769 6c6c 2062 6520 636f  atrix will be co
-0003a050: 7272 6563 746c 7920 6465 6669 6e65 6420  rrectly defined 
-0003a060: 666f 7220 6d61 736b 2063 7265 6174 696f  for mask creatio
-0003a070: 6e2e 0a20 2020 2020 2020 2020 2020 2069  n..            i
-0003a080: 6d20 3d20 736b 7274 2e69 6d61 6765 2e49  m = skrt.image.I
-0003a090: 6d61 6765 2873 6f75 7263 6573 290a 2020  mage(sources).  
-0003a0a0: 2020 2020 2020 2020 2020 6966 2027 6e69            if 'ni
-0003a0b0: 6674 6927 2069 6e20 696d 2e73 6f75 7263  fti' in im.sourc
-0003a0c0: 655f 7479 7065 3a0a 2020 2020 2020 2020  e_type:.        
-0003a0d0: 2020 2020 2020 2020 696d 203d 2069 6d2e          im = im.
-0003a0e0: 6173 7479 7065 2827 6463 6d27 290a 2020  astype('dcm').  
-0003a0f0: 2020 2020 2020 2020 2020 695f 6e61 6d65            i_name
-0003a100: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0003a110: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0003a120: 302c 206e 293a 0a20 2020 2020 2020 2020  0, n):.         
-0003a130: 2020 2020 2020 2069 6620 7365 6c66 2e6e         if self.n
-0003a140: 616d 6573 2069 7320 6e6f 7420 4e6f 6e65  ames is not None
-0003a150: 2061 6e64 2069 5f6e 616d 6520 3c20 6c65   and i_name < le
-0003a160: 6e28 7365 6c66 2e6e 616d 6573 293a 0a20  n(self.names):. 
-0003a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a180: 2020 206e 616d 6520 3d20 7365 6c66 2e6e     name = self.n
-0003a190: 616d 6573 5b69 5f6e 616d 655d 0a20 2020  ames[i_name].   
-0003a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a1b0: 2069 5f6e 616d 6520 2b3d 2031 0a20 2020   i_name += 1.   
-0003a1c0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0003a1d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0003a1e0: 2020 2020 2020 206e 616d 6520 3d20 6622         name = f"
-0003a1f0: 524f 4920 7b69 7d22 0a0a 2020 2020 2020  ROI {i}"..      
-0003a200: 2020 2020 2020 2020 2020 2369 6d32 2e64            #im2.d
-0003a210: 6174 6120 3d20 2869 6d31 2e64 6174 6120  ata = (im1.data 
-0003a220: 3d3d 2069 202b 2031 290a 2020 2020 2020  == i + 1).      
-0003a230: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-0003a240: 6f69 732e 6170 7065 6e64 2852 4f49 280a  ois.append(ROI(.
-0003a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a260: 2020 2020 6172 7261 7920 3d3d 2069 202b      array == i +
-0003a270: 2031 2c20 0a20 2020 2020 2020 2020 2020   1, .           
-0003a280: 2020 2020 2020 2020 2061 6666 696e 6520           affine 
-0003a290: 3d20 696d 2e67 6574 5f61 6666 696e 6528  = im.get_affine(
-0003a2a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0003a2b0: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-0003a2c0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-0003a2d0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0003a2e0: 6967 696e 203d 204e 6f6e 652c 0a20 2020  igin = None,.   
-0003a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a300: 2069 6d61 6765 3d73 656c 662e 696d 6167   image=self.imag
-0003a310: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0003a320: 2020 2020 2020 206e 616d 653d 6e61 6d65         name=name
-0003a330: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0003a340: 2020 2020 2020 2a2a 7365 6c66 2e72 6f69        **self.roi
-0003a350: 5f6b 7761 7267 730a 2020 2020 2020 2020  _kwargs.        
-0003a360: 2020 2020 2020 2020 2929 0a20 2020 2020          )).     
-0003a370: 2020 2020 2020 2073 6f75 7263 6573 203d         sources =
-0003a380: 205b 5d0a 0a20 2020 2020 2020 2020 2020   []..           
-0003a390: 2023 2046 6f72 204e 4966 5449 2073 6f75   # For NIfTI sou
-0003a3a0: 7263 652c 2072 6576 6572 7420 746f 204e  rce, revert to N
-0003a3b0: 4966 5449 2063 6f6e 7665 6e74 696f 6e20  IfTI convention 
-0003a3c0: 666f 7220 6461 7461 2061 7272 6179 0a20  for data array. 
-0003a3d0: 2020 2020 2020 2020 2020 2023 206f 6620             # of 
-0003a3e0: 6d61 736b 2c20 736f 2074 6861 7420 6974  mask, so that it
-0003a3f0: 2063 616e 2062 6520 7772 6974 7465 6e20   can be written 
-0003a400: 636f 7272 6563 746c 7920 746f 2066 696c  correctly to fil
-0003a410: 652e 0a20 2020 2020 2020 2020 2020 2069  e..            i
-0003a420: 6620 276e 6966 7469 2720 696e 2069 6d2e  f 'nifti' in im.
-0003a430: 736f 7572 6365 5f74 7970 653a 0a20 2020  source_type:.   
-0003a440: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0003a450: 2069 6478 2069 6e20 7261 6e67 6528 6c65   idx in range(le
-0003a460: 6e28 7365 6c66 2e72 6f69 7329 293a 0a20  n(self.rois)):. 
-0003a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a480: 2020 2073 656c 662e 726f 6973 5b69 6478     self.rois[idx
-0003a490: 5d2e 6d61 736b 203d 2073 656c 662e 726f  ].mask = self.ro
-0003a4a0: 6973 5b69 6478 5d2e 6d61 736b 2e61 7374  is[idx].mask.ast
-0003a4b0: 7970 6528 276e 6969 2729 0a0a 2020 2020  ype('nii')..    
-0003a4c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0003a4d0: 2020 2020 2020 6966 206e 6f74 2073 6b72        if not skr
-0003a4e0: 742e 636f 7265 2e69 735f 6c69 7374 2873  t.core.is_list(s
-0003a4f0: 6f75 7263 6573 2920 6f72 2069 7369 6e73  ources) or isins
-0003a500: 7461 6e63 6528 736f 7572 6365 732c 206e  tance(sources, n
-0003a510: 702e 6e64 6172 7261 7929 3a0a 2020 2020  p.ndarray):.    
-0003a520: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-0003a530: 6365 7320 3d20 5b73 6f75 7263 6573 5d0a  ces = [sources].
-0003a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a550: 7369 6e67 6c65 5f73 6f75 7263 6520 3d20  single_source = 
-0003a560: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0003a570: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0003a580: 2020 2020 2020 2073 696e 676c 655f 736f         single_so
-0003a590: 7572 6365 203d 2046 616c 7365 0a0a 2020  urce = False..  
-0003a5a0: 2020 2020 2020 2320 4578 7061 6e64 2061        # Expand a
-0003a5b0: 6e79 2064 6972 6563 746f 7269 6573 0a20  ny directories. 
-0003a5c0: 2020 2020 2020 2073 6f75 7263 6573 5f65         sources_e
-0003a5d0: 7870 616e 6465 6420 3d20 5b5d 0a20 2020  xpanded = [].   
-0003a5e0: 2020 2020 2066 6f72 2073 6f75 7263 6520       for source 
-0003a5f0: 696e 2073 6f75 7263 6573 3a0a 2020 2020  in sources:.    
-0003a600: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0003a610: 7461 6e63 6528 736f 7572 6365 2c20 7374  tance(source, st
-0003a620: 7229 2061 6e64 206f 732e 7061 7468 2e69  r) and os.path.i
-0003a630: 7364 6972 2873 6f75 7263 6529 3a0a 0a20  sdir(source):.. 
-0003a640: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003a650: 6f75 7263 6573 5f65 7870 616e 6465 642e  ources_expanded.
-0003a660: 6578 7465 6e64 280a 2020 2020 2020 2020  extend(.        
-0003a670: 2020 2020 2020 2020 2020 2020 5b6f 732e              [os.
-0003a680: 7061 7468 2e6a 6f69 6e28 736f 7572 6365  path.join(source
-0003a690: 2c20 6669 6c65 2920 666f 7220 6669 6c65  , file) for file
-0003a6a0: 2069 6e20 6f73 2e6c 6973 7464 6972 2873   in os.listdir(s
-0003a6b0: 6f75 7263 6529 5d0a 2020 2020 2020 2020  ource)].        
-0003a6c0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0003a6d0: 2020 2020 2020 2020 2020 2023 2041 7574             # Aut
-0003a6e0: 6f2d 6173 7369 676e 206e 616d 6520 746f  o-assign name to
-0003a6f0: 2064 6972 6563 746f 7279 206e 616d 650a   directory name.
-0003a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a710: 6966 2073 696e 676c 655f 736f 7572 6365  if single_source
-0003a720: 2061 6e64 2073 656c 662e 6e61 6d65 2069   and self.name i
-0003a730: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0003a740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003a750: 2e6e 616d 6520 3d20 736f 7572 6365 0a0a  .name = source..
-0003a760: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0003a770: 206e 6f74 2073 656c 662e 6c6f 6164 6564   not self.loaded
-0003a780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a790: 2020 736f 7572 6365 735f 6578 7061 6e64    sources_expand
-0003a7a0: 6564 2e61 7070 656e 6428 736f 7572 6365  ed.append(source
-0003a7b0: 290a 0a20 2020 2020 2020 2066 6f72 2073  )..        for s
-0003a7c0: 6f75 7263 6520 696e 2073 6f72 7465 6428  ource in sorted(
-0003a7d0: 736f 7572 6365 735f 6578 7061 6e64 6564  sources_expanded
-0003a7e0: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
-0003a7f0: 6966 2069 7369 6e73 7461 6e63 6528 736f  if isinstance(so
-0003a800: 7572 6365 2c20 524f 4929 3a0a 2020 2020  urce, ROI):.    
-0003a810: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003a820: 2e72 6f69 732e 6170 7065 6e64 2873 6f75  .rois.append(sou
-0003a830: 7263 6529 0a20 2020 2020 2020 2020 2020  rce).           
-0003a840: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
-0003a850: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0003a860: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
-0003a870: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-0003a880: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-0003a890: 682e 6261 7365 6e61 6d65 2873 6f75 7263  h.basename(sourc
-0003a8a0: 6529 2e73 7461 7274 7377 6974 6828 222e  e).startswith(".
-0003a8b0: 2229 206f 7220 736f 7572 6365 2e65 6e64  ") or source.end
-0003a8c0: 7377 6974 6828 222e 7478 7422 293a 0a20  swith(".txt"):. 
-0003a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a8e0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0003a8f0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0003a900: 732e 7061 7468 2e69 7364 6972 2873 6f75  s.path.isdir(sou
-0003a910: 7263 6529 3a0a 2020 2020 2020 2020 2020  rce):.          
-0003a920: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0003a930: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-0003a940: 2320 4174 7465 6d70 7420 746f 206c 6f61  # Attempt to loa
-0003a950: 6420 6672 6f6d 2064 6963 6f6d 0a20 2020  d from dicom.   
-0003a960: 2020 2020 2020 2020 2072 6f69 7320 3d20           rois = 
-0003a970: 5b5d 0a20 2020 2020 2020 2020 2020 2069  [].            i
-0003a980: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
-0003a990: 7263 652c 2073 7472 293a 0a20 2020 2020  rce, str):.     
-0003a9a0: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-0003a9b0: 2e70 6174 682e 7370 6c69 7465 7874 2873  .path.splitext(s
-0003a9c0: 6f75 7263 6529 5b31 5d20 213d 2027 2e6e  ource)[1] != '.n
-0003a9d0: 6969 273a 0a20 2020 2020 2020 2020 2020  ii':.           
-0003a9e0: 2020 2020 2020 2020 2072 6f69 732c 2064           rois, d
-0003a9f0: 7320 3d20 6c6f 6164 5f72 6f69 735f 6469  s = load_rois_di
-0003aa00: 636f 6d28 736f 7572 6365 290a 2020 2020  com(source).    
-0003aa10: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
-0003aa20: 6f69 7329 3a0a 2020 2020 2020 2020 2020  ois):.          
-0003aa30: 2020 2020 2020 666f 7220 6e75 6d62 6572        for number
-0003aa40: 2c20 726f 6920 696e 2072 6f69 732e 6974  , roi in rois.it
-0003aa50: 656d 7328 293a 0a0a 2020 2020 2020 2020  ems():..        
-0003aa60: 2020 2020 2020 2020 2020 2020 2320 4967              # Ig
-0003aa70: 6e6f 7265 2065 6e74 7269 6573 2077 6974  nore entries wit
-0003aa80: 6820 6e6f 2063 6f6e 746f 7572 730a 2020  h no contours.  
-0003aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aaa0: 2020 6966 2022 636f 6e74 6f75 7273 2220    if "contours" 
-0003aab0: 6e6f 7420 696e 2072 6f69 3a0a 2020 2020  not in roi:.    
-0003aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aad0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-0003aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aaf0: 2020 2320 4967 6e6f 7265 2065 6e74 7269    # Ignore entri
-0003ab00: 6573 2063 6f6e 7461 696e 696e 6720 6f6e  es containing on
-0003ab10: 6c79 2061 2073 696e 676c 6520 706f 696e  ly a single poin
-0003ab20: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0003ab30: 2020 2020 2020 636f 6e74 6f75 7273 203d        contours =
-0003ab40: 2072 6f69 5b22 636f 6e74 6f75 7273 225d   roi["contours"]
-0003ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003ab60: 2020 2020 2069 6620 6c65 6e28 636f 6e74       if len(cont
-0003ab70: 6f75 7273 2920 3d3d 2031 3a0a 2020 2020  ours) == 1:.    
-0003ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ab90: 2020 2020 7369 6e67 6c65 5f63 6f6e 746f      single_conto
-0003aba0: 7572 203d 2063 6f6e 746f 7572 735b 6c69  ur = contours[li
-0003abb0: 7374 2863 6f6e 746f 7572 732e 6b65 7973  st(contours.keys
-0003abc0: 2829 295b 305d 5d5b 305d 0a20 2020 2020  ())[0]][0].     
-0003abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abe0: 2020 2069 6620 7369 6e67 6c65 5f63 6f6e     if single_con
-0003abf0: 746f 7572 2e73 6861 7065 5b30 5d20 3d3d  tour.shape[0] ==
-0003ac00: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0003ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ac20: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-0003ac30: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0003ac40: 6c6f 7220 3d20 726f 695b 2263 6f6c 6f72  lor = roi["color
-0003ac50: 225d 2069 6620 6e6f 7420 7365 6c66 2e69  "] if not self.i
-0003ac60: 676e 6f72 655f 6469 636f 6d5f 636f 6c6f  gnore_dicom_colo
-0003ac70: 7273 2065 6c73 6520 4e6f 6e65 0a20 2020  rs else None.   
-0003ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ac90: 2073 656c 662e 726f 6973 2e61 7070 656e   self.rois.appen
-0003aca0: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-0003acb0: 2020 2020 2020 2020 2020 2052 4f49 280a             ROI(.
-0003acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003acd0: 2020 2020 2020 2020 2020 2020 726f 695b              roi[
-0003ace0: 2263 6f6e 746f 7572 7322 5d2c 0a20 2020  "contours"],.   
-0003acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ad00: 2020 2020 2020 2020 206e 616d 653d 726f           name=ro
-0003ad10: 695b 226e 616d 6522 5d2c 0a20 2020 2020  i["name"],.     
-0003ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ad30: 2020 2020 2020 2063 6f6c 6f72 3d63 6f6c         color=col
-0003ad40: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0002d5e0: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
+0002d5f0: 2020 2020 2020 6964 782c 0a20 2020 2020        idx,.     
+0002d600: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
+0002d610: 7572 5f6b 7761 7267 732c 0a20 2020 2020  ur_kwargs,.     
+0002d620: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+0002d630: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
+0002d640: 2020 2020 2020 6365 6e74 726f 6964 3d73        centroid=s
+0002d650: 686f 775f 6365 6e74 726f 6964 2c0a 2020  how_centroid,.  
+0002d660: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
+0002d670: 6f6d 3d7a 6f6f 6d2c 0a20 2020 2020 2020  om=zoom,.       
+0002d680: 2020 2020 2020 2020 207a 6f6f 6d5f 6365           zoom_ce
+0002d690: 6e74 7265 3d7a 6f6f 6d5f 6365 6e74 7265  ntre=zoom_centre
+0002d6a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d6b0: 2020 636f 6c6f 723d 636f 6c6f 722c 0a20    color=color,. 
+0002d6c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002d6d0: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
+0002d6e0: 2020 2020 2020 2020 2020 2069 6e63 6c75             inclu
+0002d6f0: 6465 5f69 6d61 6765 3d46 616c 7365 2c0a  de_image=False,.
+0002d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d710: 696d 6167 655f 7265 6164 793d 696d 6167  image_ready=imag
+0002d720: 655f 7265 6164 792c 0a20 2020 2020 2020  e_ready,.       
+0002d730: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+0002d740: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
+0002d750: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+0002d760: 6b20 7768 6574 6865 7220 7920 6178 6973  k whether y axis
+0002d770: 206e 6565 6473 2074 6f20 6265 2069 6e76   needs to be inv
+0002d780: 6572 7465 640a 2020 2020 2020 2020 2369  erted.        #i
+0002d790: 6620 7669 6577 203d 3d20 2278 2d79 2220  f view == "x-y" 
+0002d7a0: 616e 6420 7365 6c66 2e61 782e 6765 745f  and self.ax.get_
+0002d7b0: 796c 696d 2829 5b31 5d20 3e20 7365 6c66  ylim()[1] > self
+0002d7c0: 2e61 782e 6765 745f 796c 696d 2829 5b30  .ax.get_ylim()[0
+0002d7d0: 5d3a 0a20 2020 2020 2020 2023 2020 2020  ]:.        #    
+0002d7e0: 7365 6c66 2e61 782e 696e 7665 7274 5f79  self.ax.invert_y
+0002d7f0: 6178 6973 2829 0a0a 2020 2020 2020 2020  axis()..        
+0002d800: 2320 4472 6177 206c 6567 656e 640a 2020  # Draw legend.  
+0002d810: 2020 2020 2020 6c65 6765 6e64 203d 206b        legend = k
+0002d820: 7761 7267 732e 6765 7428 226c 6567 656e  wargs.get("legen
+0002d830: 6422 2c20 4661 6c73 6529 0a20 2020 2020  d", False).     
+0002d840: 2020 2069 6620 6c65 6765 6e64 3a0a 2020     if legend:.  
+0002d850: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+0002d860: 206b 7761 7267 732e 6765 7428 226e 616d   kwargs.get("nam
+0002d870: 6522 2c20 7365 6c66 2e6e 616d 6529 0a20  e", self.name). 
+0002d880: 2020 2020 2020 2020 2020 2072 6f69 5f68             roi_h
+0002d890: 616e 646c 6520 3d20 726f 692e 6765 745f  andle = roi.get_
+0002d8a0: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
+0002d8b0: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
+0002d8c0: 7479 7065 2c20 636f 6c6f 722c 206f 7061  type, color, opa
+0002d8d0: 6369 7479 2c20 6c69 6e65 7769 6474 682c  city, linewidth,
+0002d8e0: 206e 616d 6529 0a20 2020 2020 2020 2020   name).         
+0002d8f0: 2020 2069 6620 726f 695f 6861 6e64 6c65     if roi_handle
+0002d900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d910: 2020 6262 6f78 5f74 6f5f 616e 6368 6f72    bbox_to_anchor
+0002d920: 203d 206b 7761 7267 732e 6765 7428 226c   = kwargs.get("l
+0002d930: 6567 656e 645f 6262 6f78 5f74 6f5f 616e  egend_bbox_to_an
+0002d940: 6368 6f72 222c 204e 6f6e 6529 0a20 2020  chor", None).   
+0002d950: 2020 2020 2020 2020 2020 2020 206c 6f63               loc
+0002d960: 203d 206b 7761 7267 732e 6765 7428 226c   = kwargs.get("l
+0002d970: 6567 656e 645f 6c6f 6322 2c20 226c 6f77  egend_loc", "low
+0002d980: 6572 206c 6566 7422 290a 0a20 2020 2020  er left")..     
+0002d990: 2020 2020 2020 2020 2020 2072 6f69 2e61             roi.a
+0002d9a0: 782e 6c65 6765 6e64 2868 616e 646c 6573  x.legend(handles
+0002d9b0: 3d5b 726f 695f 6861 6e64 6c65 5d2c 0a20  =[roi_handle],. 
+0002d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d9d0: 2020 2020 2020 2062 626f 785f 746f 5f61         bbox_to_a
+0002d9e0: 6e63 686f 723d 6262 6f78 5f74 6f5f 616e  nchor=bbox_to_an
+0002d9f0: 6368 6f72 2c20 6c6f 633d 6c6f 632c 0a20  chor, loc=loc,. 
+0002da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002da10: 2020 2020 2020 2066 6163 6563 6f6c 6f72         facecolor
+0002da20: 3d22 7768 6974 6522 2c20 6672 616d 6561  ="white", framea
+0002da30: 6c70 6861 3d31 0a20 2020 2020 2020 2020  lpha=1.         
+0002da40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0002da50: 0a0a 2020 2020 2020 2020 2320 4469 7370  ..        # Disp
+0002da60: 6c61 7920 696d 6167 650a 0a20 2020 2020  lay image..     
+0002da70: 2020 2070 6c74 2e74 6967 6874 5f6c 6179     plt.tight_lay
+0002da80: 6f75 7428 290a 2020 2020 2020 2020 6966  out().        if
+0002da90: 2073 686f 773a 0a20 2020 2020 2020 2020   show:.         
+0002daa0: 2020 2070 6c74 2e73 686f 7728 290a 0a20     plt.show().. 
+0002dab0: 2020 2020 2020 2023 2053 6176 6520 746f         # Save to
+0002dac0: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
+0002dad0: 2073 6176 655f 6173 3a0a 2020 2020 2020   save_as:.      
+0002dae0: 2020 2020 2020 726f 692e 6669 672e 7361        roi.fig.sa
+0002daf0: 7665 6669 6728 7361 7665 5f61 7329 0a20  vefig(save_as). 
+0002db00: 2020 2020 2020 2020 2020 2070 6c74 2e63             plt.c
+0002db10: 6c6f 7365 2829 0a0a 2020 2020 6465 6620  lose()..    def 
+0002db20: 6765 745f 6475 6d6d 795f 696d 6167 6528  get_dummy_image(
+0002db30: 7365 6c66 2c20 2a2a 6b77 6172 6773 293a  self, **kwargs):
+0002db40: 0a20 2020 2020 2020 2022 2222 4d61 6b65  .        """Make
+0002db50: 2061 2064 756d 6d79 2069 6d61 6765 2074   a dummy image t
+0002db60: 6861 7420 636f 7665 7273 2074 6865 2061  hat covers the a
+0002db70: 7265 6120 7370 616e 6e65 6420 6279 2074  rea spanned by t
+0002db80: 6869 7320 524f 492e 200a 2020 2020 2020  his ROI. .      
+0002db90: 2020 5265 7475 726e 7320 616e 2049 6d61    Returns an Ima
+0002dba0: 6765 206f 626a 6563 742e 0a0a 2020 2020  ge object...    
+0002dbb0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+0002dbc0: 3a2a 2a0a 2020 2020 2020 2020 0a20 2020  :**.        .   
+0002dbd0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
+0002dbe0: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
+0002dbf0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0002dc00: 2056 6f78 656c 2073 697a 6520 696e 206d   Voxel size in m
+0002dc10: 6d20 696e 2074 6865 2064 756d 6d79 2069  m in the dummy i
+0002dc20: 6d61 6765 2069 6e20 7468 6520 782d 7920  mage in the x-y 
+0002dc30: 706c 616e 652c 2067 6976 656e 2061 7320  plane, given as 
+0002dc40: 0a20 2020 2020 2020 2020 2020 205b 7678  .            [vx
+0002dc50: 2c20 7679 5d2e 2049 6620 3c73 6861 7065  , vy]. If <shape
+0002dc60: 3e20 616e 6420 3c76 6f78 656c 5f73 697a  > and <voxel_siz
+0002dc70: 653e 2061 7265 2062 6f74 6820 4e6f 6e65  e> are both None
+0002dc80: 2c20 766f 7865 6c20 7369 7a65 7320 6f66  , voxel sizes of
+0002dc90: 0a20 2020 2020 2020 2020 2020 205b 312c  .            [1,
+0002dca0: 2031 5d20 7769 6c6c 2062 6520 7573 6564   1] will be used
+0002dcb0: 2062 7920 6465 6661 756c 742e 2054 6865   by default. The
+0002dcc0: 2076 6f78 656c 2073 697a 6520 696e 2074   voxel size in t
+0002dcd0: 6865 207a 2064 6972 6563 7469 6f6e 200a  he z direction .
+0002dce0: 2020 2020 2020 2020 2020 2020 6973 2064              is d
+0002dcf0: 6566 696e 6564 2062 7920 3c73 6c69 6365  efined by <slice
+0002dd00: 5f74 6869 636b 6e65 7373 3e2e 0a0a 2020  _thickness>...  
+0002dd10: 2020 2020 2020 7368 6170 6520 3a20 6c69        shape : li
+0002dd20: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+0002dd30: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
+0002dd40: 6265 7220 6f66 2076 6f78 656c 7320 696e  ber of voxels in
+0002dd50: 2074 6865 2064 756d 6d79 2069 6d61 6765   the dummy image
+0002dd60: 2069 6e20 7468 6520 782d 7920 706c 616e   in the x-y plan
+0002dd70: 652c 2067 6976 656e 2061 730a 2020 2020  e, given as.    
+0002dd80: 2020 2020 2020 2020 5b6e 782c 206e 795d          [nx, ny]
+0002dd90: 2e20 4f6e 6c79 2075 7365 6420 6966 203c  . Only used if <
+0002dda0: 766f 7865 6c5f 7369 7a65 3e20 6973 204e  voxel_size> is N
+0002ddb0: 6f6e 652e 200a 2020 2020 2020 2020 2020  one. .          
+0002ddc0: 2020 5468 6520 6e75 6d62 6572 206f 6620    The number of 
+0002ddd0: 766f 7865 6c73 2069 6e20 7468 6520 7a20  voxels in the z 
+0002dde0: 6469 7265 6374 696f 6e20 7769 6c6c 2062  direction will b
+0002ddf0: 6520 7461 6b65 6e20 6672 6f6d 2074 6865  e taken from the
+0002de00: 200a 2020 2020 2020 2020 2020 2020 6e75   .            nu
+0002de10: 6d62 6572 206f 6620 736c 6963 6573 2069  mber of slices i
+0002de20: 6e20 7468 6520 782d 7920 636f 6e74 6f75  n the x-y contou
+0002de30: 7273 2064 6963 7469 6f6e 6172 792e 0a0a  rs dictionary...
+0002de40: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
+0002de50: 203a 2069 6e74 2f66 6c6f 6174 2c20 6465   : int/float, de
+0002de60: 6661 756c 743d 3165 340a 2020 2020 2020  fault=1e4.      
+0002de70: 2020 2020 2020 5661 6c75 6520 7769 7468        Value with
+0002de80: 2077 6869 6368 2074 6865 2076 6f78 656c   which the voxel
+0002de90: 7320 696e 2074 6865 2064 756d 6d79 2069  s in the dummy i
+0002dea0: 6d61 6765 2073 686f 756c 6420 6265 2066  mage should be f
+0002deb0: 696c 6c65 642e 200a 0a20 2020 2020 2020  illed. ..       
+0002dec0: 2062 7566 6665 7220 3a20 696e 742c 2064   buffer : int, d
+0002ded0: 6566 6175 6c74 3d31 0a20 2020 2020 2020  efault=1.       
+0002dee0: 2020 2020 204e 756d 6265 7220 6f66 2065       Number of e
+0002def0: 6d70 7479 2062 7566 6665 7220 766f 7865  mpty buffer voxe
+0002df00: 6c73 2074 6f20 6164 6420 6f75 7473 6964  ls to add outsid
+0002df10: 6520 7468 6520 524f 4920 696e 2065 6163  e the ROI in eac
+0002df20: 680a 2020 2020 2020 2020 2020 2020 6469  h.            di
+0002df30: 7265 6374 696f 6e2e 0a0a 2020 2020 2020  rection...      
+0002df40: 2020 736c 6963 655f 7468 6963 6b6e 6573    slice_thicknes
+0002df50: 7320 3a20 666c 6f61 742c 2064 6566 6175  s : float, defau
+0002df60: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0002df70: 2020 2020 566f 7865 6c20 7369 7a65 2069      Voxel size i
+0002df80: 6e20 6d6d 2069 6e20 7468 6520 6475 6d6d  n mm in the dumm
+0002df90: 7920 696d 6167 6520 696e 2074 6865 207a  y image in the z
+0002dfa0: 2064 6972 6563 7469 6f6e 2e20 2049 6620   direction.  If 
+0002dfb0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+0002dfc0: 2020 7468 6520 7661 6c75 6520 7573 6564    the value used
+0002dfd0: 2069 7320 7468 6520 6d69 6e69 6d75 6d20   is the minimum 
+0002dfe0: 6469 7374 616e 6365 2062 6574 7765 656e  distance between
+0002dff0: 2073 6c69 6365 2070 6f73 6974 696f 6e73   slice positions
+0002e000: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+0002e010: 7468 6520 782d 7920 636f 6e74 6f75 7273  the x-y contours
+0002e020: 2064 6963 7469 6f6e 6172 792e 0a20 2020   dictionary..   
+0002e030: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0002e040: 2020 6578 7465 6e74 7320 3d20 5b73 656c    extents = [sel
+0002e050: 662e 6765 745f 6578 7465 6e74 2861 783d  f.get_extent(ax=
+0002e060: 6178 2920 666f 7220 6178 2069 6e20 736b  ax) for ax in sk
+0002e070: 7274 2e69 6d61 6765 2e5f 6178 6573 5d0a  rt.image._axes].
+0002e080: 2020 2020 2020 2020 736c 6963 655f 7468          slice_th
+0002e090: 6963 6b6e 6573 7320 3d20 6b77 6172 6773  ickness = kwargs
+0002e0a0: 2e70 6f70 2822 736c 6963 655f 7468 6963  .pop("slice_thic
+0002e0b0: 6b6e 6573 7322 2c20 4e6f 6e65 290a 2020  kness", None).  
+0002e0c0: 2020 2020 2020 736c 6963 655f 7468 6963        slice_thic
+0002e0d0: 6b6e 6573 7320 3d20 2873 6c69 6365 5f74  kness = (slice_t
+0002e0e0: 6869 636b 6e65 7373 206f 720a 2020 2020  hickness or.    
+0002e0f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002e100: 2e67 6574 5f73 6c69 6365 5f74 6869 636b  .get_slice_thick
+0002e110: 6e65 7373 5f63 6f6e 746f 7572 7328 2929  ness_contours())
+0002e120: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002e130: 6372 6561 7465 5f64 756d 6d79 5f69 6d61  create_dummy_ima
+0002e140: 6765 2865 7874 656e 7473 2c20 736c 6963  ge(extents, slic
+0002e150: 655f 7468 6963 6b6e 6573 732c 202a 2a6b  e_thickness, **k
+0002e160: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+0002e170: 7365 745f 696d 6167 655f 746f 5f64 756d  set_image_to_dum
+0002e180: 6d79 2873 656c 662c 202a 2a6b 7761 7267  my(self, **kwarg
+0002e190: 7329 3a0a 2020 2020 2020 2020 2222 2241  s):.        """A
+0002e1a0: 7373 6967 6e20 7365 6c66 2e69 6d61 6765  ssign self.image
+0002e1b0: 2070 726f 7065 7274 7920 746f 2061 2064   property to a d
+0002e1c0: 756d 6d79 2069 6d61 6765 2063 6f76 6572  ummy image cover
+0002e1d0: 696e 6720 7468 6520 6172 6561 200a 2020  ing the area .  
+0002e1e0: 2020 2020 2020 7370 616e 6e65 6420 6279        spanned by
+0002e1f0: 2074 6869 7320 524f 492e 2054 6865 2052   this ROI. The R
+0002e200: 4f49 2773 206d 6173 6b20 616e 6420 782d  OI's mask and x-
+0002e210: 7a2f 792d 7a20 636f 6e74 6f75 7273 2077  z/y-z contours w
+0002e220: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
+0002e230: 636c 6561 7265 6420 736f 2074 6861 7420  cleared so that 
+0002e240: 7468 6579 2077 696c 6c20 6265 2072 6563  they will be rec
+0002e250: 7265 6174 6564 2077 6865 6e20 6765 745f  reated when get_
+0002e260: 6d61 736b 2829 206f 7220 6765 745f 636f  mask() or get_co
+0002e270: 6e74 6f75 7273 2829 0a20 2020 2020 2020  ntours().       
+0002e280: 2061 7265 206e 6578 7420 6361 6c6c 6564   are next called
+0002e290: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0002e2a0: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
+0002e2b0: 2020 200a 2020 2020 2020 2020 6b77 6172     .        kwar
+0002e2c0: 6773 203a 200a 2020 2020 2020 2020 2020  gs : .          
+0002e2d0: 2020 4b65 7977 6f72 6420 6172 6775 6d65    Keyword argume
+0002e2e0: 6e74 7320 746f 2070 6173 7320 746f 2073  nts to pass to s
+0002e2f0: 656c 662e 6765 745f 6475 6d6d 795f 696d  elf.get_dummy_im
+0002e300: 6167 6528 2920 7768 656e 2063 7265 6174  age() when creat
+0002e310: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0002e320: 7468 6520 6475 6d6d 7920 696d 6167 652e  the dummy image.
+0002e330: 2053 6565 2064 6f63 756d 656e 7461 7469   See documentati
+0002e340: 6f6e 206f 6620 524f 492e 6765 745f 6475  on of ROI.get_du
+0002e350: 6d6d 795f 696d 6167 6528 292e 0a20 2020  mmy_image()..   
+0002e360: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0002e370: 2020 2320 4d61 6b65 2069 6d61 6765 0a20    # Make image. 
+0002e380: 2020 2020 2020 2069 6d20 3d20 7365 6c66         im = self
+0002e390: 2e67 6574 5f64 756d 6d79 5f69 6d61 6765  .get_dummy_image
+0002e3a0: 282a 2a6b 7761 7267 7329 0a0a 2020 2020  (**kwargs)..    
+0002e3b0: 2020 2020 2320 436c 6561 7220 6d61 736b      # Clear mask
+0002e3c0: 2061 6e64 2063 6f6e 746f 7572 730a 2020   and contours.  
+0002e3d0: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
+0002e3e0: 5f63 6f6e 746f 7572 7320 3d20 7365 6c66  _contours = self
+0002e3f0: 2e63 6f6e 746f 7572 735b 2278 2d79 225d  .contours["x-y"]
+0002e400: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0002e410: 6e74 6f75 7273 203d 207b 2278 2d79 223a  ntours = {"x-y":
+0002e420: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
+0002e430: 6f75 7273 7d0a 2020 2020 2020 2020 7365  ours}.        se
+0002e440: 6c66 2e6c 6f61 6465 645f 6d61 736b 203d  lf.loaded_mask =
+0002e450: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+0002e460: 656c 662e 6d61 736b 203d 204e 6f6e 650a  elf.mask = None.
+0002e470: 0a20 2020 2020 2020 2023 2041 7373 6967  .        # Assig
+0002e480: 6e20 696d 6167 650a 2020 2020 2020 2020  n image.        
+0002e490: 7365 6c66 2e73 6574 5f69 6d61 6765 2869  self.set_image(i
+0002e4a0: 6d29 0a0a 2020 2020 6465 6620 7365 745f  m)..    def set_
+0002e4b0: 696d 6167 6528 7365 6c66 2c20 696d 293a  image(self, im):
+0002e4c0: 0a20 2020 2020 2020 2022 2222 5365 7420  .        """Set 
+0002e4d0: 7365 6c66 2e69 6d61 6765 2074 6f20 6120  self.image to a 
+0002e4e0: 6769 7665 6e20 696d 6167 6520 616e 6420  given image and 
+0002e4f0: 6164 6a75 7374 2067 656f 6d65 7472 6963  adjust geometric
+0002e500: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
+0002e510: 2020 2020 6163 636f 7264 696e 676c 792e      accordingly.
+0002e520: 204e 6f74 6520 7468 6174 2073 656c 662e   Note that self.
+0002e530: 6d61 736b 2077 696c 6c20 6265 2072 656d  mask will be rem
+0002e540: 6f76 6564 2069 6620 7468 6520 6375 7272  oved if the curr
+0002e550: 656e 7420 6d61 736b 2773 200a 2020 2020  ent mask's .    
+0002e560: 2020 2020 7368 6170 6520 646f 6573 6e27      shape doesn'
+0002e570: 7420 6d61 7463 6820 7468 6520 696d 6167  t match the imag
+0002e580: 652e 200a 2020 2020 2020 2020 2222 220a  e. .        """.
+0002e590: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+0002e5a0: 6164 2829 0a20 2020 2020 2020 2073 656c  ad().        sel
+0002e5b0: 662e 696d 6167 6520 3d20 696d 0a20 2020  f.image = im.   
+0002e5c0: 2020 2020 2073 656c 662e 636f 6e74 6f75       self.contou
+0002e5d0: 7273 5f6f 6e6c 7920 3d20 4661 6c73 650a  rs_only = False.
+0002e5e0: 2020 2020 2020 2020 6966 2069 6d20 6973          if im is
+0002e5f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002e600: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0002e610: 2020 2023 2053 6574 2052 4f49 2076 6f78     # Set ROI vox
+0002e620: 656c 2073 697a 6520 746f 2074 6861 7420  el size to that 
+0002e630: 6f66 206e 6577 2069 6d61 6765 2e0a 2020  of new image..  
+0002e640: 2020 2020 2020 2320 4974 2077 696c 6c20        # It will 
+0002e650: 6265 206e 6565 6465 6420 746f 2064 6566  be needed to def
+0002e660: 696e 6520 736c 6963 6520 7468 6963 6b6e  ine slice thickn
+0002e670: 6573 730a 2020 2020 2020 2020 2320 696e  ess.        # in
+0002e680: 2074 6865 2063 6173 6520 6f66 2061 6e20   the case of an 
+0002e690: 524f 4920 7769 7468 2063 6f6e 746f 7572  ROI with contour
+0002e6a0: 2873 2920 6174 2061 2073 696e 676c 6520  (s) at a single 
+0002e6b0: 7a2d 706f 7369 7469 6f6e 2e0a 2020 2020  z-position..    
+0002e6c0: 2020 2020 7365 6c66 2e76 6f78 656c 5f73      self.voxel_s
+0002e6d0: 697a 6520 3d20 696d 2e67 6574 5f76 6f78  ize = im.get_vox
+0002e6e0: 656c 5f73 697a 6528 290a 0a20 2020 2020  el_size()..     
+0002e6f0: 2020 2023 2049 6620 7468 6520 7a2d 6469     # If the z-di
+0002e700: 7374 616e 6365 2062 6574 7765 656e 2063  stance between c
+0002e710: 6f6e 746f 7572 7320 6973 2067 7265 6174  ontours is great
+0002e720: 6572 2074 6861 6e20 7468 6520 766f 7865  er than the voxe
+0002e730: 6c0a 2020 2020 2020 2020 2320 7a2d 6469  l.        # z-di
+0002e740: 6d65 6e73 696f 6e20 666f 7220 7468 6520  mension for the 
+0002e750: 6e65 7720 696d 6167 652c 2066 6972 7374  new image, first
+0002e760: 2065 6e73 7572 6520 7468 6174 2074 6865   ensure that the
+0002e770: 2052 4f49 0a20 2020 2020 2020 2023 206d   ROI.        # m
+0002e780: 6173 6b20 6973 2063 7265 6174 6564 2077  ask is created w
+0002e790: 6974 6820 7468 6520 696e 7465 722d 636f  ith the inter-co
+0002e7a0: 6e74 6f75 7220 7a2d 6469 7374 616e 6365  ntour z-distance
+0002e7b0: 2c20 7468 656e 2072 6573 697a 650a 2020  , then resize.  
+0002e7c0: 2020 2020 2020 2320 746f 2074 6865 2069        # to the i
+0002e7d0: 6d61 6765 2076 6f78 656c 2073 697a 652e  mage voxel size.
+0002e7e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0002e7f0: 2e67 6574 5f73 6c69 6365 5f74 6869 636b  .get_slice_thick
+0002e800: 6e65 7373 5f63 6f6e 746f 7572 7328 2920  ness_contours() 
+0002e810: 3e20 7365 6c66 2e69 6d61 6765 2e67 6574  > self.image.get
+0002e820: 5f76 6f78 656c 5f73 697a 6528 295b 325d  _voxel_size()[2]
+0002e830: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0002e840: 206e 6f74 2028 7365 6c66 2e6d 6173 6b20   not (self.mask 
+0002e850: 616e 6420 2873 656c 662e 766f 7865 6c5f  and (self.voxel_
+0002e860: 7369 7a65 203d 3d20 7365 6c66 2e6d 6173  size == self.mas
+0002e870: 6b2e 766f 7865 6c5f 7369 7a65 2929 3a0a  k.voxel_size)):.
+0002e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e890: 7365 6c66 2e63 7265 6174 655f 6d61 736b  self.create_mask
+0002e8a0: 2876 6f78 656c 5f73 697a 653d 7365 6c66  (voxel_size=self
+0002e8b0: 2e76 6f78 656c 5f73 697a 655b 303a 325d  .voxel_size[0:2]
+0002e8c0: 2c20 666f 7263 653d 5472 7565 290a 2020  , force=True).  
+0002e8d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0002e8e0: 5468 6520 6d61 736b 2063 7265 6174 696f  The mask creatio
+0002e8f0: 6e20 7769 6c6c 2068 6176 6520 7265 6465  n will have rede
+0002e900: 6669 6e65 6420 7468 6520 696d 6167 6520  fined the image 
+0002e910: 6173 736f 6369 6174 696f 6e2c 0a20 2020  association,.   
+0002e920: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+0002e930: 6f20 7265 6173 7369 676e 2074 6865 206e  o reassign the n
+0002e940: 6577 2069 6d61 6765 2e0a 2020 2020 2020  ew image..      
+0002e950: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0002e960: 6d61 6765 203d 2069 6d0a 2020 2020 2020  mage = im.      
+0002e970: 2020 2020 2020 7365 6c66 2e6d 6173 6b2e        self.mask.
+0002e980: 6d61 7463 685f 7369 7a65 2873 656c 662e  match_size(self.
+0002e990: 696d 6167 652c 206d 6574 686f 643d 226e  image, method="n
+0002e9a0: 6561 7265 7374 2229 0a20 2020 2020 2020  earest").       
+0002e9b0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+0002e9c0: 7365 6c66 2e6d 6173 6b2c 2022 6461 7461  self.mask, "data
+0002e9d0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0002e9e0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0002e9f0: 6d61 736b 2e64 6174 612e 6474 7970 6520  mask.data.dtype 
+0002ea00: 3d3d 2062 6f6f 6c3a 0a20 2020 2020 2020  == bool:.       
+0002ea10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002ea20: 662e 6d61 736b 2e64 6174 6120 3d20 7365  f.mask.data = se
+0002ea30: 6c66 2e6d 6173 6b2e 6461 7461 2e61 7374  lf.mask.data.ast
+0002ea40: 7970 6528 626f 6f6c 290a 0a20 2020 2020  ype(bool)..     
+0002ea50: 2020 2023 2049 6620 6120 6d61 736b 2068     # If a mask h
+0002ea60: 6173 2062 6565 6e20 6c6f 6164 6564 2c20  as been loaded, 
+0002ea70: 6275 7420 646f 6573 6e27 7420 6d61 7463  but doesn't matc
+0002ea80: 6820 7468 6520 696d 6167 6520 6765 6f6d  h the image geom
+0002ea90: 6574 7279 2c0a 2020 2020 2020 2020 2320  etry,.        # 
+0002eaa0: 6465 6c65 7465 2074 6865 206d 6173 6b20  delete the mask 
+0002eab0: 6461 7461 2e20 2028 5468 6973 2073 686f  data.  (This sho
+0002eac0: 756c 6420 6d65 616e 2074 6861 7420 7468  uld mean that th
+0002ead0: 6520 7a2d 6469 7374 616e 6365 0a20 2020  e z-distance.   
+0002eae0: 2020 2020 2023 2062 6574 7765 656e 2063       # between c
+0002eaf0: 6f6e 746f 7572 7320 6973 206c 6573 7320  ontours is less 
+0002eb00: 7468 6174 2074 6865 2076 6f78 656c 207a  that the voxel z
+0002eb10: 2d64 696d 656e 7369 6f6e 2066 6f72 2074  -dimension for t
+0002eb20: 6865 0a20 2020 2020 2020 2023 206e 6577  he.        # new
+0002eb30: 2069 6d61 6765 2e29 2020 4120 6e65 7720   image.)  A new 
+0002eb40: 6d61 736b 2077 696c 6c20 6265 2063 7265  mask will be cre
+0002eb50: 6174 6564 2061 7420 7468 6520 6e65 7874  ated at the next
+0002eb60: 2063 616c 6c0a 2020 2020 2020 2020 2320   call.        # 
+0002eb70: 746f 2061 6363 6573 7320 7468 6520 6d61  to access the ma
+0002eb80: 736b 2064 6174 612e 0a20 2020 2020 2020  sk data..       
+0002eb90: 2069 6620 7365 6c66 2e6d 6173 6b20 616e   if self.mask an
+0002eba0: 6420 6e6f 7420 696d 2e68 6173 5f73 616d  d not im.has_sam
+0002ebb0: 655f 6765 6f6d 6574 7279 2873 656c 662e  e_geometry(self.
+0002ebc0: 6d61 736b 293a 0a20 2020 2020 2020 2020  mask):.         
+0002ebd0: 2020 2069 6620 6765 7461 7474 7228 7365     if getattr(se
+0002ebe0: 6c66 2c20 2269 6e70 7574 5f63 6f6e 746f  lf, "input_conto
+0002ebf0: 7572 7322 2c20 4e6f 6e65 2920 6973 204e  urs", None) is N
+0002ec00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002ec10: 2020 2020 2073 656c 662e 696e 7075 745f       self.input_
+0002ec20: 636f 6e74 6f75 7273 203d 2073 656c 662e  contours = self.
+0002ec30: 6765 745f 636f 6e74 6f75 7273 2822 782d  get_contours("x-
+0002ec40: 7922 290a 2020 2020 2020 2020 2020 2020  y").            
+0002ec50: 7365 6c66 2e6d 6173 6b20 3d20 4e6f 6e65  self.mask = None
+0002ec60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002ec70: 662e 6c6f 6164 6564 5f6d 6173 6b20 3d20  f.loaded_mask = 
+0002ec80: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
+0002ec90: 2053 6574 2067 656f 656d 7472 6963 2069   Set geoemtric i
+0002eca0: 6e66 6f0a 2020 2020 2020 2020 6461 7461  nfo.        data
+0002ecb0: 5f73 6861 7065 203d 2069 6d2e 6765 745f  _shape = im.get_
+0002ecc0: 6461 7461 2829 2e73 6861 7065 0a20 2020  data().shape.   
+0002ecd0: 2020 2020 2073 656c 662e 7368 6170 6520       self.shape 
+0002ece0: 3d20 5b64 6174 615f 7368 6170 655b 315d  = [data_shape[1]
+0002ecf0: 2c20 6461 7461 5f73 6861 7065 5b30 5d2c  , data_shape[0],
+0002ed00: 2064 6174 615f 7368 6170 655b 325d 5d0a   data_shape[2]].
+0002ed10: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
+0002ed20: 656c 5f73 697a 6520 3d20 696d 2e67 6574  el_size = im.get
+0002ed30: 5f76 6f78 656c 5f73 697a 6528 290a 2020  _voxel_size().  
+0002ed40: 2020 2020 2020 7365 6c66 2e6f 7269 6769        self.origi
+0002ed50: 6e20 3d20 696d 2e67 6574 5f6f 7269 6769  n = im.get_origi
+0002ed60: 6e28 290a 2020 2020 2020 2020 7365 6c66  n().        self
+0002ed70: 2e61 6666 696e 6520 3d20 696d 2e67 6574  .affine = im.get
+0002ed80: 5f61 6666 696e 6528 290a 0a20 2020 2064  _affine()..    d
+0002ed90: 6566 2067 6574 5f69 6d61 6765 2873 656c  ef get_image(sel
+0002eda0: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
+0002edb0: 6574 7572 6e20 496d 6167 6520 6f62 6a65  eturn Image obje
+0002edc0: 6374 2061 7373 6f63 6961 7465 6420 7769  ct associated wi
+0002edd0: 7468 2074 6869 7320 524f 492e 2222 220a  th this ROI.""".
+0002ede0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0002edf0: 656c 662e 696d 6167 650a 0a20 2020 2064  elf.image..    d
+0002ee00: 6566 2076 6965 7728 7365 6c66 2c20 696e  ef view(self, in
+0002ee10: 636c 7564 655f 696d 6167 653d 4661 6c73  clude_image=Fals
+0002ee20: 652c 2076 6f78 656c 5f73 697a 653d 5b31  e, voxel_size=[1
+0002ee30: 2c20 315d 2c20 6275 6666 6572 3d35 2c20  , 1], buffer=5, 
+0002ee40: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0002ee50: 2020 2022 2222 5669 6577 2074 6865 2052     """View the R
+0002ee60: 4f49 2e0a 0a20 2020 2020 2020 202a 2a50  OI...        **P
+0002ee70: 6172 616d 6574 6572 733a 2a2a 0a20 2020  arameters:**.   
+0002ee80: 2020 2020 200a 2020 2020 2020 2020 696e       .        in
+0002ee90: 636c 7564 655f 696d 6167 6520 3a20 626f  clude_image : bo
+0002eea0: 6f6c 2c20 6465 6661 756c 743d 5472 7565  ol, default=True
+0002eeb0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002eec0: 5472 7565 2061 6e64 2074 6869 7320 524f  True and this RO
+0002eed0: 4920 6861 7320 616e 2061 7373 6f63 6961  I has an associa
+0002eee0: 7465 6420 696d 6167 6520 2869 6e20 7365  ted image (in se
+0002eef0: 6c66 2e69 6d61 6765 292c 0a20 2020 2020  lf.image),.     
+0002ef00: 2020 2020 2020 2074 6865 2069 6d61 6765         the image
+0002ef10: 2077 696c 6c20 6265 2064 6973 706c 6179   will be display
+0002ef20: 6564 2062 6568 696e 6420 7468 6520 524f  ed behind the RO
+0002ef30: 492e 0a0a 2020 2020 2020 2020 766f 7865  I...        voxe
+0002ef40: 6c5f 7369 7a65 203a 206c 6973 742c 2064  l_size : list, d
+0002ef50: 6566 6175 6c74 3d5b 312c 2031 5d0a 2020  efault=[1, 1].  
+0002ef60: 2020 2020 2020 2020 2020 4966 2074 6865            If the
+0002ef70: 2052 4f49 2064 6f65 7320 6e6f 7420 6861   ROI does not ha
+0002ef80: 7665 2061 6e20 6173 736f 6369 6174 6564  ve an associated
+0002ef90: 2069 6d61 6765 2061 6e64 2069 7320 6465   image and is de
+0002efa0: 7363 7269 6265 6420 6f6e 6c79 0a20 2020  scribed only.   
+0002efb0: 2020 2020 2020 2020 2062 7920 636f 6e74           by cont
+0002efc0: 6f75 7273 2c20 7468 6973 2077 696c 6c20  ours, this will 
+0002efd0: 6265 2074 6865 2076 6f78 656c 2073 697a  be the voxel siz
+0002efe0: 6573 2075 7365 6420 696e 2074 6865 2078  es used in the x
+0002eff0: 2d79 2064 6972 6563 7469 6f6e 0a20 2020  -y direction.   
+0002f000: 2020 2020 2020 2020 2077 6865 6e20 636f           when co
+0002f010: 6e76 6572 7469 6e67 2074 6865 2052 4f49  nverting the ROI
+0002f020: 2074 6f20 6120 6d61 736b 2069 6620 6120   to a mask if a 
+0002f030: 6d61 736b 2070 6c6f 7420 7479 7065 2069  mask plot type i
+0002f040: 7320 7365 6c65 6374 6564 2e0a 0a20 2020  s selected...   
+0002f050: 2020 2020 2062 7566 6665 7220 3a20 696e       buffer : in
+0002f060: 742c 2064 6566 6175 6c74 3d35 0a20 2020  t, default=5.   
+0002f070: 2020 2020 2020 2020 2049 6620 7468 6520           If the 
+0002f080: 524f 4920 646f 6573 206e 6f74 2068 6176  ROI does not hav
+0002f090: 6520 616e 2061 7373 6f63 6961 7465 6420  e an associated 
+0002f0a0: 696d 6167 6520 616e 6420 6973 2064 6573  image and is des
+0002f0b0: 6372 6962 6564 206f 6e6c 790a 2020 2020  cribed only.    
+0002f0c0: 2020 2020 2020 2020 6279 2063 6f6e 746f          by conto
+0002f0d0: 7572 732c 2074 6869 7320 7769 6c6c 2062  urs, this will b
+0002f0e0: 6520 7468 6520 6e75 6d62 6572 206f 6620  e the number of 
+0002f0f0: 6275 6666 6572 2076 6f78 656c 7320 0a20  buffer voxels . 
+0002f100: 2020 2020 2020 2020 2020 2028 692e 652e             (i.e.
+0002f110: 2077 6869 7465 7370 6163 6529 2064 6973   whitespace) dis
+0002f120: 706c 6179 6564 2061 726f 756e 6420 7468  played around th
+0002f130: 6520 524f 492e 0a20 2020 2020 2020 2022  e ROI..        "
+0002f140: 2222 0a0a 2020 2020 2020 2020 6672 6f6d  ""..        from
+0002f150: 2073 6b72 742e 6265 7474 6572 5f76 6965   skrt.better_vie
+0002f160: 7765 7220 696d 706f 7274 2042 6574 7465  wer import Bette
+0002f170: 7256 6965 7765 720a 2020 2020 2020 2020  rViewer.        
+0002f180: 7365 6c66 2e6c 6f61 6428 290a 0a20 2020  self.load()..   
+0002f190: 2020 2020 2076 6965 7720 3d20 6b77 6172       view = kwar
+0002f1a0: 6773 2e70 6f70 2822 696e 6974 5f76 6965  gs.pop("init_vie
+0002f1b0: 7722 2c20 4e6f 6e65 2920 6f72 206b 7761  w", None) or kwa
+0002f1c0: 7267 732e 6765 7428 2276 6965 7722 2c20  rgs.get("view", 
+0002f1d0: 2278 2d79 2229 0a20 2020 2020 2020 2073  "x-y").        s
+0002f1e0: 6c20 3d20 6b77 6172 6773 2e70 6f70 2822  l = kwargs.pop("
+0002f1f0: 696e 6974 5f73 6c69 6365 222c 204e 6f6e  init_slice", Non
+0002f200: 6529 206f 7220 6b77 6172 6773 2e67 6574  e) or kwargs.get
+0002f210: 2822 736c 222c 204e 6f6e 6529 0a20 2020  ("sl", None).   
+0002f220: 2020 2020 2069 6478 203d 206b 7761 7267       idx = kwarg
+0002f230: 732e 706f 7028 2269 6e69 745f 6964 7822  s.pop("init_idx"
+0002f240: 2c20 4e6f 6e65 2920 6f72 206b 7761 7267  , None) or kwarg
+0002f250: 732e 6765 7428 2269 6478 222c 204e 6f6e  s.get("idx", Non
+0002f260: 6529 0a20 2020 2020 2020 2070 6f73 203d  e).        pos =
+0002f270: 206b 7761 7267 732e 706f 7028 2269 6e69   kwargs.pop("ini
+0002f280: 745f 706f 7322 2c20 4e6f 6e65 2920 6f72  t_pos", None) or
+0002f290: 206b 7761 7267 732e 6765 7428 2270 6f73   kwargs.get("pos
+0002f2a0: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+0002f2b0: 2066 6f72 206b 6579 2069 6e20 5b22 736c   for key in ["sl
+0002f2c0: 222c 2022 6964 7822 2c20 2270 6f73 222c  ", "idx", "pos",
+0002f2d0: 2022 7669 6577 225d 3a0a 2020 2020 2020   "view"]:.      
+0002f2e0: 2020 2020 2020 6b77 6172 6773 2e70 6f70        kwargs.pop
+0002f2f0: 286b 6579 2c20 4e6f 6e65 290a 2020 2020  (key, None).    
+0002f300: 2020 2020 6b77 6172 6773 5b22 726f 695f      kwargs["roi_
+0002f310: 706c 6f74 5f74 7970 6522 5d20 3d20 6b77  plot_type"] = kw
+0002f320: 6172 6773 2e70 6f70 2822 706c 6f74 5f74  args.pop("plot_t
+0002f330: 7970 6522 2c20 2263 6f6e 746f 7572 2229  ype", "contour")
+0002f340: 0a0a 2020 2020 2020 2020 2320 5669 6577  ..        # View
+0002f350: 2077 6974 6820 696d 6167 650a 2020 2020   with image.    
+0002f360: 2020 2020 6966 2069 6e63 6c75 6465 5f69      if include_i
+0002f370: 6d61 6765 2061 6e64 2073 656c 662e 696d  mage and self.im
+0002f380: 6167 6520 6973 206e 6f74 204e 6f6e 653a  age is not None:
+0002f390: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002f3a0: 736c 2069 7320 4e6f 6e65 2061 6e64 2069  sl is None and i
+0002f3b0: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
+0002f3c0: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
+0002f3d0: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
+0002f3e0: 3d20 7365 6c66 2e67 6574 5f6d 6964 5f69  = self.get_mid_i
+0002f3f0: 6478 2876 6965 7729 0a20 2020 2020 2020  dx(view).       
+0002f400: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002f410: 2020 2020 2020 2020 2020 2069 6478 203d             idx =
+0002f420: 2073 656c 662e 6765 745f 6964 7828 7669   self.get_idx(vi
+0002f430: 6577 2c20 736c 2c20 6964 782c 2070 6f73  ew, sl, idx, pos
+0002f440: 290a 2020 2020 2020 2020 2020 2020 6b77  ).            kw
+0002f450: 6172 6773 5b22 696e 6974 5f69 6478 225d  args["init_idx"]
+0002f460: 203d 2069 6478 0a20 2020 2020 2020 2020   = idx.         
+0002f470: 2020 2062 7620 3d20 4265 7474 6572 5669     bv = BetterVi
+0002f480: 6577 6572 2873 656c 662e 696d 6167 652c  ewer(self.image,
+0002f490: 2072 6f69 733d 7365 6c66 2c20 2a2a 6b77   rois=self, **kw
+0002f4a0: 6172 6773 290a 0a20 2020 2020 2020 2023  args)..        #
+0002f4b0: 2056 6965 7720 7769 7468 6f75 7420 696d   View without im
+0002f4c0: 6167 650a 2020 2020 2020 2020 656c 7365  age.        else
+0002f4d0: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0002f4e0: 204d 616b 6520 6475 6d6d 7920 696d 6167   Make dummy imag
+0002f4f0: 6520 666f 7220 6261 636b 6772 6f75 6e64  e for background
+0002f500: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+0002f510: 5f74 6d70 203d 2073 656c 662e 636c 6f6e  _tmp = self.clon
+0002f520: 6528 636f 7079 5f64 6174 613d 4661 6c73  e(copy_data=Fals
+0002f530: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+0002f540: 6d20 3d20 7365 6c66 2e67 6574 5f64 756d  m = self.get_dum
+0002f550: 6d79 5f69 6d61 6765 280a 2020 2020 2020  my_image(.      
+0002f560: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
+0002f570: 7369 7a65 3d76 6f78 656c 5f73 697a 652c  size=voxel_size,
+0002f580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f590: 2062 7566 6665 723d 6275 6666 6572 0a20   buffer=buffer. 
+0002f5a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0002f5b0: 2020 2020 2020 2020 2069 6d2e 7469 746c           im.titl
+0002f5c0: 6520 3d20 7365 6c66 2e6e 616d 650a 2020  e = self.name.  
+0002f5d0: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
+0002f5e0: 702e 7365 745f 696d 6167 6528 696d 290a  p.set_image(im).
+0002f5f0: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+0002f600: 746d 702e 7265 7365 745f 636f 6e74 6f75  tmp.reset_contou
+0002f610: 7273 2829 0a20 2020 2020 2020 2020 2020  rs().           
+0002f620: 2069 6620 736c 2069 7320 4e6f 6e65 2061   if sl is None a
+0002f630: 6e64 2069 6478 2069 7320 4e6f 6e65 2061  nd idx is None a
+0002f640: 6e64 2070 6f73 2069 7320 4e6f 6e65 3a0a  nd pos is None:.
+0002f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f660: 6964 7820 3d20 726f 695f 746d 702e 6765  idx = roi_tmp.ge
+0002f670: 745f 6d69 645f 6964 7828 7669 6577 290a  t_mid_idx(view).
+0002f680: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002f690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002f6a0: 2020 6964 7820 3d20 726f 695f 746d 702e    idx = roi_tmp.
+0002f6b0: 6765 745f 6964 7828 7669 6577 2c20 736c  get_idx(view, sl
+0002f6c0: 2c20 6964 782c 2070 6f73 290a 2020 2020  , idx, pos).    
+0002f6d0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
+0002f6e0: 696e 6974 5f69 6478 225d 203d 2069 6478  init_idx"] = idx
+0002f6f0: 0a0a 2020 2020 2020 2020 2020 2020 6b77  ..            kw
+0002f700: 6172 6773 2e73 6574 6465 6661 756c 7428  args.setdefault(
+0002f710: 2273 686f 7722 2c20 4661 6c73 6529 0a20  "show", False). 
+0002f720: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002f730: 7420 2272 6f69 5f6b 7761 7267 7322 2069  t "roi_kwargs" i
+0002f740: 6e20 6b77 6172 6773 3a0a 2020 2020 2020  n kwargs:.      
+0002f750: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+0002f760: 5b22 726f 695f 6b77 6172 6773 225d 203d  ["roi_kwargs"] =
+0002f770: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+0002f780: 6b77 6172 6773 5b22 726f 695f 6b77 6172  kwargs["roi_kwar
+0002f790: 6773 225d 5b22 696d 6167 655f 7265 6164  gs"]["image_read
+0002f7a0: 7922 5d20 3d20 5472 7565 0a20 2020 2020  y"] = True.     
+0002f7b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0002f7c0: 2020 2020 2020 2072 6f69 5f74 6d70 203d         roi_tmp =
+0002f7d0: 2073 656c 660a 0a20 2020 2020 2020 2020   self..         
+0002f7e0: 2020 2023 204d 616b 6520 6475 6d6d 7920     # Make dummy 
+0002f7f0: 696d 6167 6520 666f 7220 6261 636b 6772  image for backgr
+0002f800: 6f75 6e64 0a20 2020 2020 2020 2020 2020  ound.           
+0002f810: 2069 6620 7365 6c66 2e63 6f6e 746f 7572   if self.contour
+0002f820: 735f 6f6e 6c79 3a0a 2020 2020 2020 2020  s_only:.        
+0002f830: 2020 2020 2020 2020 696d 203d 2073 656c          im = sel
+0002f840: 662e 6765 745f 6475 6d6d 795f 696d 6167  f.get_dummy_imag
+0002f850: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0002f860: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
+0002f870: 653d 766f 7865 6c5f 7369 7a65 2c0a 2020  e=voxel_size,.  
+0002f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f890: 2020 6275 6666 6572 3d62 7566 6665 720a    buffer=buffer.
+0002f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f8b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002f8c0: 2020 696d 2e74 6974 6c65 203d 2073 656c    im.title = sel
+0002f8d0: 662e 6e61 6d65 0a20 2020 2020 2020 2020  f.name.         
+0002f8e0: 2020 2020 2020 2072 6f69 5f74 6d70 203d         roi_tmp =
+0002f8f0: 2073 656c 662e 636c 6f6e 6528 636f 7079   self.clone(copy
+0002f900: 5f64 6174 613d 4661 6c73 6529 0a20 2020  _data=False).   
+0002f910: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+0002f920: 5f74 6d70 2e73 6574 5f69 6d61 6765 2869  _tmp.set_image(i
+0002f930: 6d29 0a20 2020 2020 2020 2020 2020 2065  m).            e
+0002f940: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002f950: 2020 2020 2069 6d20 3d20 736b 7274 2e69       im = skrt.i
+0002f960: 6d61 6765 2e49 6d61 6765 280a 2020 2020  mage.Image(.    
+0002f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f980: 6e70 2e6f 6e65 7328 7365 6c66 2e73 6861  np.ones(self.sha
+0002f990: 7065 2920 2a20 3165 342c 0a20 2020 2020  pe) * 1e4,.     
+0002f9a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0002f9b0: 6666 696e 653d 7365 6c66 2e61 6666 696e  ffine=self.affin
+0002f9c0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0002f9d0: 2020 2020 2020 2074 6974 6c65 3d73 656c         title=sel
+0002f9e0: 662e 6e61 6d65 0a20 2020 2020 2020 2020  f.name.         
+0002f9f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002fa00: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0002fa10: 2020 2020 2020 2320 4372 6561 7465 2076        # Create v
+0002fa20: 6965 7765 720a 2020 2020 2020 2020 2020  iewer.          
+0002fa30: 2020 6276 203d 2042 6574 7465 7256 6965    bv = BetterVie
+0002fa40: 7765 7228 696d 2c20 726f 6973 3d72 6f69  wer(im, rois=roi
+0002fa50: 5f74 6d70 2c20 2a2a 6b77 6172 6773 290a  _tmp, **kwargs).
+0002fa60: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+0002fa70: 646a 7573 7420 5549 0a20 2020 2020 2020  djust UI.       
+0002fa80: 2020 2020 206e 6f5f 7569 203d 206b 7761       no_ui = kwa
+0002fa90: 7267 732e 6765 7428 226e 6f5f 7569 222c  rgs.get("no_ui",
+0002faa0: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
+0002fab0: 6c74 7328 292e 6e6f 5f75 6929 0a20 2020  lts().no_ui).   
+0002fac0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0002fad0: 6e6f 5f75 693a 0a20 2020 2020 2020 2020  no_ui:.         
+0002fae0: 2020 2020 2020 2062 762e 6d61 6b65 5f75         bv.make_u
+0002faf0: 6928 6e6f 5f72 6f69 3d54 7275 652c 206e  i(no_roi=True, n
+0002fb00: 6f5f 696e 7465 6e73 6974 793d 5472 7565  o_intensity=True
+0002fb10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002fb20: 2020 6276 2e73 686f 7728 290a 2020 2020    bv.show().    
+0002fb30: 2020 2020 7265 7475 726e 2062 760a 0a20      return bv.. 
+0002fb40: 2020 2064 6566 205f 706c 6f74 5f6d 6173     def _plot_mas
+0002fb50: 6b28 0a20 2020 2020 2020 2073 656c 662c  k(.        self,
+0002fb60: 0a20 2020 2020 2020 2076 6965 772c 0a20  .        view,. 
+0002fb70: 2020 2020 2020 2069 6478 2c0a 2020 2020         idx,.    
+0002fb80: 2020 2020 6d61 736b 5f6b 7761 7267 733d      mask_kwargs=
+0002fb90: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f70  None,.        op
+0002fba0: 6163 6974 793d 4e6f 6e65 2c0a 2020 2020  acity=None,.    
+0002fbb0: 2020 2020 696e 636c 7564 655f 696d 6167      include_imag
+0002fbc0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+0002fbd0: 207a 6f6f 6d3d 4e6f 6e65 2c0a 2020 2020   zoom=None,.    
+0002fbe0: 2020 2020 7a6f 6f6d 5f63 656e 7472 653d      zoom_centre=
+0002fbf0: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
+0002fc00: 6c6f 723d 4e6f 6e65 2c0a 2020 2020 2020  lor=None,.      
+0002fc10: 2020 666c 6174 7465 6e3d 4661 6c73 652c    flatten=False,
+0002fc20: 0a20 2020 2020 2020 2073 686f 773d 5472  .        show=Tr
+0002fc30: 7565 2c0a 2020 2020 2020 2020 2a2a 6b77  ue,.        **kw
+0002fc40: 6172 6773 2c0a 2020 2020 293a 0a20 2020  args,.    ):.   
+0002fc50: 2020 2020 2022 2222 506c 6f74 2074 6865       """Plot the
+0002fc60: 2052 4f49 2061 7320 6120 6d61 736b 2e22   ROI as a mask."
+0002fc70: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
+0002fc80: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
+0002fc90: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
+0002fca0: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
+0002fcb0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+0002fcc0: 206d 6173 6b5f 736c 6963 6520 3d20 7365   mask_slice = se
+0002fcd0: 6c66 2e67 6574 5f73 6c69 6365 2876 6965  lf.get_slice(vie
+0002fce0: 772c 2069 6478 3d69 6478 2c20 666c 6174  w, idx=idx, flat
+0002fcf0: 7465 6e3d 666c 6174 7465 6e29 0a0a 2020  ten=flatten)..  
+0002fd00: 2020 2020 2020 2320 4d61 6b65 2063 6f6c        # Make col
+0002fd10: 6f72 6d61 700a 2020 2020 2020 2020 6e6f  ormap.        no
+0002fd20: 726d 203d 206d 6174 706c 6f74 6c69 622e  rm = matplotlib.
+0002fd30: 636f 6c6f 7273 2e4e 6f72 6d61 6c69 7a65  colors.Normalize
+0002fd40: 2829 0a20 2020 2020 2020 2063 6d61 7020  ().        cmap 
+0002fd50: 3d20 6d61 7470 6c6f 746c 6962 2e63 6d2e  = matplotlib.cm.
+0002fd60: 6873 760a 2020 2020 2020 2020 735f 636f  hsv.        s_co
+0002fd70: 6c6f 7273 203d 2063 6d61 7028 6e6f 726d  lors = cmap(norm
+0002fd80: 286d 6173 6b5f 736c 6963 6529 290a 2020  (mask_slice)).  
+0002fd90: 2020 2020 2020 6966 2063 6f6c 6f72 2069        if color i
+0002fda0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002fdb0: 2020 2020 636f 6c6f 7220 3d20 7365 6c66      color = self
+0002fdc0: 2e63 6f6c 6f72 0a20 2020 2020 2020 2073  .color.        s
+0002fdd0: 5f63 6f6c 6f72 735b 6d61 736b 5f73 6c69  _colors[mask_sli
+0002fde0: 6365 203e 2030 2c20 3a5d 203d 2063 6f6c  ce > 0, :] = col
+0002fdf0: 6f72 0a20 2020 2020 2020 2073 5f63 6f6c  or.        s_col
+0002fe00: 6f72 735b 6d61 736b 5f73 6c69 6365 203d  ors[mask_slice =
+0002fe10: 3d20 302c 203a 5d20 3d20 2830 2c20 302c  = 0, :] = (0, 0,
+0002fe20: 2030 2c20 3029 0a0a 2020 2020 2020 2020   0, 0)..        
+0002fe30: 2320 4765 7420 706c 6f74 7469 6e67 2061  # Get plotting a
+0002fe40: 7267 756d 656e 7473 0a20 2020 2020 2020  rguments.       
+0002fe50: 2069 6620 6d61 736b 5f6b 7761 7267 7320   if mask_kwargs 
+0002fe60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002fe70: 2020 2020 206d 6173 6b5f 6b77 6172 6773       mask_kwargs
+0002fe80: 203d 207b 7d0a 2020 2020 2020 2020 6d61   = {}.        ma
+0002fe90: 736b 5f6b 7761 7267 732e 7365 7464 6566  sk_kwargs.setdef
+0002fea0: 6175 6c74 2822 616c 7068 6122 2c20 6f70  ault("alpha", op
+0002feb0: 6163 6974 7929 0a20 2020 2020 2020 206d  acity).        m
+0002fec0: 6173 6b5f 6b77 6172 6773 2e73 6574 6465  ask_kwargs.setde
+0002fed0: 6661 756c 7428 2269 6e74 6572 706f 6c61  fault("interpola
+0002fee0: 7469 6f6e 222c 2022 6e6f 6e65 2229 0a0a  tion", "none")..
+0002fef0: 2020 2020 2020 2020 2320 4d61 6b65 2070          # Make p
+0002ff00: 6c6f 740a 2020 2020 2020 2020 6966 2069  lot.        if i
+0002ff10: 6e63 6c75 6465 5f69 6d61 6765 2061 6e64  nclude_image and
+0002ff20: 2073 656c 662e 696d 6167 6520 6973 206e   self.image is n
+0002ff30: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0002ff40: 2020 2020 2069 6d5f 6d61 736b 203d 206b       im_mask = k
+0002ff50: 7761 7267 732e 6765 7428 226d 6173 6b22  wargs.get("mask"
+0002ff60: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+0002ff70: 2020 2020 696d 5f6d 6173 6b65 6420 3d20      im_masked = 
+0002ff80: 6b77 6172 6773 2e67 6574 2822 6d61 736b  kwargs.get("mask
+0002ff90: 6564 222c 2054 7275 6529 0a20 2020 2020  ed", True).     
+0002ffa0: 2020 2020 2020 2069 6d5f 696e 7665 7274         im_invert
+0002ffb0: 5f6d 6173 6b20 3d20 6b77 6172 6773 2e67  _mask = kwargs.g
+0002ffc0: 6574 2822 696e 7665 7274 5f6d 6173 6b22  et("invert_mask"
+0002ffd0: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
+0002ffe0: 2020 2020 2069 6d5f 6d61 736b 5f63 6f6c       im_mask_col
+0002fff0: 6f72 203d 206b 7761 7267 732e 6765 7428  or = kwargs.get(
+00030000: 226d 6173 6b5f 636f 6c6f 7222 2c20 2262  "mask_color", "b
+00030010: 6c61 636b 2229 0a20 2020 2020 2020 2020  lack").         
+00030020: 2020 2073 656c 662e 696d 6167 652e 706c     self.image.pl
+00030030: 6f74 2876 6965 772c 2069 6478 3d69 6478  ot(view, idx=idx
+00030040: 2c20 6178 3d73 656c 662e 6178 2c20 7368  , ax=self.ax, sh
+00030050: 6f77 3d46 616c 7365 2c0a 2020 2020 2020  ow=False,.      
+00030060: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00030070: 736b 3d69 6d5f 6d61 736b 2c20 6d61 736b  sk=im_mask, mask
+00030080: 6564 3d69 6d5f 6d61 736b 6564 2c20 696e  ed=im_masked, in
+00030090: 7665 7274 5f6d 6173 6b3d 696d 5f69 6e76  vert_mask=im_inv
+000300a0: 6572 745f 6d61 736b 2c0a 2020 2020 2020  ert_mask,.      
+000300b0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+000300c0: 736b 5f63 6f6c 6f72 3d69 6d5f 6d61 736b  sk_color=im_mask
+000300d0: 5f63 6f6c 6f72 290a 2020 2020 2020 2020  _color).        
+000300e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000300f0: 2020 6966 206b 7761 7267 732e 6765 7428    if kwargs.get(
+00030100: 2274 6974 6c65 222c 204e 6f6e 6529 2069  "title", None) i
+00030110: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00030120: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
+00030130: 7469 746c 6522 5d20 3d20 7365 6c66 2e6e  title"] = self.n
+00030140: 616d 650a 0a20 2020 2020 2020 2073 656c  ame..        sel
+00030150: 662e 6178 2e69 6d73 686f 7728 735f 636f  f.ax.imshow(s_co
+00030160: 6c6f 7273 2c20 6578 7465 6e74 3d73 656c  lors, extent=sel
+00030170: 662e 6d61 736b 2e70 6c6f 745f 6578 7465  f.mask.plot_exte
+00030180: 6e74 5b76 6965 775d 2c20 0a20 2020 2020  nt[view], .     
+00030190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000301a0: 2020 2a2a 6d61 736b 5f6b 7761 7267 7329    **mask_kwargs)
+000301b0: 0a0a 2020 2020 2020 2020 2320 4164 6a75  ..        # Adju
+000301c0: 7374 2061 7865 730a 2020 2020 2020 2020  st axes.        
+000301d0: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+000301e0: 2e6c 6162 656c 5f61 7828 7365 6c66 2c20  .label_ax(self, 
+000301f0: 7669 6577 2c20 6964 782c 202a 2a6b 7761  view, idx, **kwa
+00030200: 7267 7329 0a20 2020 2020 2020 2073 6b72  rgs).        skr
+00030210: 742e 696d 6167 652e 496d 6167 652e 7a6f  t.image.Image.zo
+00030220: 6f6d 5f61 7828 7365 6c66 2c20 7669 6577  om_ax(self, view
+00030230: 2c20 7a6f 6f6d 2c20 7a6f 6f6d 5f63 656e  , zoom, zoom_cen
+00030240: 7472 6529 0a0a 2020 2020 2020 2020 6966  tre)..        if
+00030250: 2073 686f 773a 0a20 2020 2020 2020 2020   show:.         
+00030260: 2020 2070 6c74 2e73 686f 7728 290a 0a20     plt.show().. 
+00030270: 2020 2064 6566 205f 706c 6f74 5f63 6f6e     def _plot_con
+00030280: 746f 7572 280a 2020 2020 2020 2020 7365  tour(.        se
+00030290: 6c66 2c0a 2020 2020 2020 2020 7669 6577  lf,.        view
+000302a0: 2c0a 2020 2020 2020 2020 6964 782c 0a20  ,.        idx,. 
+000302b0: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
+000302c0: 7761 7267 733d 4e6f 6e65 2c0a 2020 2020  wargs=None,.    
+000302d0: 2020 2020 6c69 6e65 7769 6474 683d 4e6f      linewidth=No
+000302e0: 6e65 2c0a 2020 2020 2020 2020 6365 6e74  ne,.        cent
+000302f0: 726f 6964 3d46 616c 7365 2c0a 2020 2020  roid=False,.    
+00030300: 2020 2020 696e 636c 7564 655f 696d 6167      include_imag
+00030310: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+00030320: 207a 6f6f 6d3d 4e6f 6e65 2c0a 2020 2020   zoom=None,.    
+00030330: 2020 2020 7a6f 6f6d 5f63 656e 7472 653d      zoom_centre=
+00030340: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
+00030350: 6c6f 723d 4e6f 6e65 2c0a 2020 2020 2020  lor=None,.      
+00030360: 2020 666c 6174 7465 6e3d 4661 6c73 652c    flatten=False,
+00030370: 0a20 2020 2020 2020 2073 686f 773d 5472  .        show=Tr
+00030380: 7565 2c0a 2020 2020 2020 2020 696d 6167  ue,.        imag
+00030390: 655f 7265 6164 793d 4661 6c73 652c 0a20  e_ready=False,. 
+000303a0: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
+000303b0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+000303c0: 2222 2250 6c6f 7420 7468 6520 524f 4920  """Plot the ROI 
+000303d0: 6173 2061 2063 6f6e 746f 7572 2e22 2222  as a contour."""
+000303e0: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+000303f0: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
+00030400: 2028 6e6f 7420 7365 6c66 2e6f 6e5f 736c   (not self.on_sl
+00030410: 6963 6528 7669 6577 2c20 6964 783d 6964  ice(view, idx=id
+00030420: 7829 2061 6e64 206e 6f74 2066 6c61 7474  x) and not flatt
+00030430: 656e 2920 6f72 2073 656c 662e 656d 7074  en) or self.empt
+00030440: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+00030450: 6574 7572 6e0a 0a20 2020 2020 2020 2063  eturn..        c
+00030460: 6f6e 746f 7572 5f6b 7761 7267 7320 3d20  ontour_kwargs = 
+00030470: 7b7d 2069 6620 636f 6e74 6f75 725f 6b77  {} if contour_kw
+00030480: 6172 6773 2069 7320 4e6f 6e65 2065 6c73  args is None els
+00030490: 6520 636f 6e74 6f75 725f 6b77 6172 6773  e contour_kwargs
+000304a0: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
+000304b0: 5f6b 7761 7267 732e 7365 7464 6566 6175  _kwargs.setdefau
+000304c0: 6c74 2822 636f 6c6f 7222 2c20 636f 6c6f  lt("color", colo
+000304d0: 7229 0a20 2020 2020 2020 2063 6f6e 746f  r).        conto
+000304e0: 7572 5f6b 7761 7267 732e 7365 7464 6566  ur_kwargs.setdef
+000304f0: 6175 6c74 2822 6c69 6e65 7769 6474 6822  ault("linewidth"
+00030500: 2c20 6c69 6e65 7769 6474 6829 0a0a 2020  , linewidth)..  
+00030510: 2020 2020 2020 2320 506c 6f74 2075 6e64        # Plot und
+00030520: 6572 6c79 696e 6720 696d 6167 650a 2020  erlying image.  
+00030530: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
+00030540: 5f69 6d61 6765 2061 6e64 2073 656c 662e  _image and self.
+00030550: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+00030560: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00030570: 6d5f 6d61 736b 203d 206b 7761 7267 732e  m_mask = kwargs.
+00030580: 6765 7428 226d 6173 6b22 2c20 4e6f 6e65  get("mask", None
+00030590: 290a 2020 2020 2020 2020 2020 2020 696d  ).            im
+000305a0: 5f6d 6173 6b65 6420 3d20 6b77 6172 6773  _masked = kwargs
+000305b0: 2e67 6574 2822 6d61 736b 6564 222c 2054  .get("masked", T
+000305c0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000305d0: 2069 6d5f 696e 7665 7274 5f6d 6173 6b20   im_invert_mask 
+000305e0: 3d20 6b77 6172 6773 2e67 6574 2822 696e  = kwargs.get("in
+000305f0: 7665 7274 5f6d 6173 6b22 2c20 4661 6c73  vert_mask", Fals
+00030600: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00030610: 6d5f 6d61 736b 5f63 6f6c 6f72 203d 206b  m_mask_color = k
+00030620: 7761 7267 732e 6765 7428 226d 6173 6b5f  wargs.get("mask_
+00030630: 636f 6c6f 7222 2c20 2262 6c61 636b 2229  color", "black")
+00030640: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00030650: 662e 696d 6167 652e 706c 6f74 2876 6965  f.image.plot(vie
+00030660: 772c 2069 6478 3d69 6478 2c20 6178 3d73  w, idx=idx, ax=s
+00030670: 656c 662e 6178 2c20 7368 6f77 3d46 616c  elf.ax, show=Fal
+00030680: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00030690: 2020 2020 2020 2020 6d61 736b 3d69 6d5f          mask=im_
+000306a0: 6d61 736b 2c20 6d61 736b 6564 3d69 6d5f  mask, masked=im_
+000306b0: 6d61 736b 6564 2c20 696e 7665 7274 5f6d  masked, invert_m
+000306c0: 6173 6b3d 696d 5f69 6e76 6572 745f 6d61  ask=im_invert_ma
+000306d0: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
+000306e0: 2020 2020 2020 2020 6d61 736b 5f63 6f6c          mask_col
+000306f0: 6f72 3d69 6d5f 6d61 736b 5f63 6f6c 6f72  or=im_mask_color
+00030700: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00030710: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00030720: 7761 7267 732e 6765 7428 2274 6974 6c65  wargs.get("title
+00030730: 222c 204e 6f6e 6529 2069 7320 4e6f 6e65  ", None) is None
+00030740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00030750: 2020 6b77 6172 6773 5b22 7469 746c 6522    kwargs["title"
+00030760: 5d20 3d20 7365 6c66 2e6e 616d 650a 0a20  ] = self.name.. 
+00030770: 2020 2020 2020 2023 2047 6574 2063 6f6e         # Get con
+00030780: 746f 7572 2070 6f69 6e74 730a 2020 2020  tour points.    
+00030790: 2020 2020 6966 2066 6c61 7474 656e 3a0a      if flatten:.
+000307a0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+000307b0: 203d 2073 656c 662e 6765 745f 736c 6963   = self.get_slic
+000307c0: 6528 7669 6577 2c20 6964 783d 6964 782c  e(view, idx=idx,
+000307d0: 2066 6c61 7474 656e 3d54 7275 6529 0a20   flatten=True). 
+000307e0: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
+000307f0: 7572 7320 3d20 7365 6c66 2e6d 6173 6b5f  urs = self.mask_
+00030800: 746f 5f63 6f6e 746f 7572 7328 6d61 736b  to_contours(mask
+00030810: 2c20 7669 6577 2c20 696e 7665 7274 3d54  , view, invert=T
+00030820: 7275 6529 0a20 2020 2020 2020 2065 6c73  rue).        els
+00030830: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00030840: 6f6e 746f 7572 7320 3d20 7365 6c66 2e67  ontours = self.g
+00030850: 6574 5f63 6f6e 746f 7572 7328 7669 6577  et_contours(view
+00030860: 2c20 6964 785f 6173 5f6b 6579 3d54 7275  , idx_as_key=Tru
+00030870: 6529 5b69 6478 5d0a 0a20 2020 2020 2020  e)[idx]..       
+00030880: 2023 2050 6c6f 7420 636f 6e74 6f75 720a   # Plot contour.
+00030890: 2020 2020 2020 2020 785f 6178 2c20 795f          x_ax, y_
+000308a0: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
+000308b0: 5f70 6c6f 745f 6178 6573 5b76 6965 775d  _plot_axes[view]
+000308c0: 0a20 2020 2020 2020 2079 6c69 6d73 203d  .        ylims =
+000308d0: 2073 6f72 7465 6428 7365 6c66 2e69 6d61   sorted(self.ima
+000308e0: 6765 2e67 6574 5f65 7874 656e 7473 2829  ge.get_extents()
+000308f0: 5b79 5f61 785d 290a 2020 2020 2020 2020  [y_ax]).        
+00030900: 2222 220a 2020 2020 2020 2020 6966 2079  """.        if y
+00030910: 6c69 6d73 5b31 5d20 3e20 796c 696d 735b  lims[1] > ylims[
+00030920: 305d 2061 6e64 2073 656c 662e 696d 6167  0] and self.imag
+00030930: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00030940: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00030950: 636c 7564 655f 696d 6167 653a 0a20 2020  clude_image:.   
+00030960: 2020 2020 2020 2020 2020 2020 2079 6c69               yli
+00030970: 6d73 203d 2073 656c 662e 696d 6167 652e  ms = self.image.
+00030980: 6765 745f 6578 7465 6e74 7328 295b 795f  get_extents()[y_
+00030990: 6178 5d0a 2020 2020 2020 2020 2020 2020  ax].            
+000309a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000309b0: 2020 2020 2020 796c 696d 7320 3d20 7365        ylims = se
+000309c0: 6c66 2e69 6d61 6765 2e70 6c6f 745f 6578  lf.image.plot_ex
+000309d0: 7465 6e74 5b76 6965 775d 5b32 3a5d 0a20  tent[view][2:]. 
+000309e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000309f0: 2020 2023 6966 2079 6c69 6d73 5b31 5d20     #if ylims[1] 
+00030a00: 3e20 796c 696d 735b 305d 2061 6e64 2073  > ylims[0] and s
+00030a10: 656c 662e 696d 6167 6520 6973 206e 6f74  elf.image is not
+00030a20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00030a30: 2020 2023 6966 2064 756d 6d79 5f69 6d61     #if dummy_ima
+00030a40: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
+00030a50: 2320 2020 2073 656c 662e 6372 6561 7465  #    self.create
+00030a60: 5f6d 6173 6b28 290a 2020 2020 2020 2020  _mask().        
+00030a70: 2020 2020 2379 6c69 6d73 203d 2073 656c      #ylims = sel
+00030a80: 662e 6d61 736b 2e70 6c6f 745f 6578 7465  f.mask.plot_exte
+00030a90: 6e74 5b76 6965 775d 5b32 3a5d 0a20 2020  nt[view][2:].   
+00030aa0: 2020 2020 2020 2020 2023 656c 7365 3a0a           #else:.
+00030ab0: 2020 2020 2020 2020 2320 2020 2079 6c69          #    yli
+00030ac0: 6d73 203d 2073 656c 662e 696d 6167 652e  ms = self.image.
+00030ad0: 6765 745f 6578 7465 6e74 7328 295b 795f  get_extents()[y_
+00030ae0: 6178 5d0a 0a20 2020 2020 2020 2066 6f72  ax]..        for
+00030af0: 2070 6f69 6e74 7320 696e 2063 6f6e 746f   points in conto
+00030b00: 7572 733a 0a20 2020 2020 2020 2020 2020  urs:.           
+00030b10: 2070 6f69 6e74 735f 7820 3d20 5b70 5b30   points_x = [p[0
+00030b20: 5d20 666f 7220 7020 696e 2070 6f69 6e74  ] for p in point
+00030b30: 735d 0a20 2020 2020 2020 2020 2020 2070  s].            p
+00030b40: 6f69 6e74 735f 7920 3d20 5b28 705b 315d  oints_y = [(p[1]
+00030b50: 2069 6620 3120 3d3d 2079 5f61 7820 656c   if 1 == y_ax el
+00030b60: 7365 2079 6c69 6d73 5b30 5d20 2b20 2879  se ylims[0] + (y
+00030b70: 6c69 6d73 5b31 5d20 2d20 705b 315d 2929  lims[1] - p[1]))
+00030b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030b90: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
+00030ba0: 6e20 706f 696e 7473 5d0a 2020 2020 2020  n points].      
+00030bb0: 2020 2020 2020 706f 696e 7473 5f78 2e61        points_x.a
+00030bc0: 7070 656e 6428 706f 696e 7473 5f78 5b30  ppend(points_x[0
+00030bd0: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
+00030be0: 6f69 6e74 735f 792e 6170 7065 6e64 2870  oints_y.append(p
+00030bf0: 6f69 6e74 735f 795b 305d 290a 2020 2020  oints_y[0]).    
+00030c00: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
+00030c10: 706c 6f74 2870 6f69 6e74 735f 782c 2070  plot(points_x, p
+00030c20: 6f69 6e74 735f 792c 202a 2a63 6f6e 746f  oints_y, **conto
+00030c30: 7572 5f6b 7761 7267 7329 0a0a 2020 2020  ur_kwargs)..    
+00030c40: 2020 2020 2320 506c 6f74 2063 656e 7472      # Plot centr
+00030c50: 6f69 6420 706f 696e 740a 2020 2020 2020  oid point.      
+00030c60: 2020 6966 2063 656e 7472 6f69 643a 0a20    if centroid:. 
+00030c70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00030c80: 7420 666c 6174 7465 6e3a 0a20 2020 2020  t flatten:.     
+00030c90: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+00030ca0: 6f69 645f 706f 696e 7473 203d 2073 656c  oid_points = sel
+00030cb0: 662e 6765 745f 6365 6e74 726f 6964 280a  f.get_centroid(.
+00030cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030cd0: 2020 2020 7669 6577 2c20 7369 6e67 6c65      view, single
+00030ce0: 5f73 6c69 6365 3d54 7275 652c 2069 6478  _slice=True, idx
+00030cf0: 3d69 6478 290a 2020 2020 2020 2020 2020  =idx).          
+00030d00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00030d10: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00030d20: 5f33 6420 3d20 7365 6c66 2e67 6574 5f63  _3d = self.get_c
+00030d30: 656e 7472 6f69 6428 290a 2020 2020 2020  entroid().      
+00030d40: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+00030d50: 6964 5f70 6f69 6e74 7320 3d20 5b63 656e  id_points = [cen
+00030d60: 7472 6f69 645f 3364 5b78 5f61 785d 2c20  troid_3d[x_ax], 
+00030d70: 6365 6e74 726f 6964 5f79 5d0a 2020 2020  centroid_y].    
+00030d80: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00030d90: 5f70 6f69 6e74 735b 315d 203d 2028 0a20  _points[1] = (. 
+00030da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030db0: 2020 2063 656e 7472 6f69 645f 706f 696e     centroid_poin
+00030dc0: 7473 5b31 5d20 6966 2031 203d 3d20 795f  ts[1] if 1 == y_
+00030dd0: 6178 0a20 2020 2020 2020 2020 2020 2020  ax.             
+00030de0: 2020 2020 2020 2065 6c73 6520 796c 696d         else ylim
+00030df0: 735b 305d 202b 2028 796c 696d 735b 315d  s[0] + (ylims[1]
+00030e00: 202d 2063 656e 7472 6f69 645f 706f 696e   - centroid_poin
+00030e10: 7473 5b31 5d29 290a 2020 2020 2020 2020  ts[1])).        
+00030e20: 2020 2020 7365 6c66 2e61 782e 706c 6f74      self.ax.plot
+00030e30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00030e40: 2020 2a63 656e 7472 6f69 645f 706f 696e    *centroid_poin
+00030e50: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00030e60: 2020 2020 222b 222c 0a20 2020 2020 2020      "+",.       
+00030e70: 2020 2020 2020 2020 202a 2a63 6f6e 746f           **conto
+00030e80: 7572 5f6b 7761 7267 732c 0a20 2020 2020  ur_kwargs,.     
+00030e90: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00030ea0: 2020 2320 4164 6a75 7374 2061 7865 730a    # Adjust axes.
+00030eb0: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
+00030ec0: 7365 745f 6173 7065 6374 2822 6571 7561  set_aspect("equa
+00030ed0: 6c22 290a 2020 2020 2020 2020 736b 7274  l").        skrt
+00030ee0: 2e69 6d61 6765 2e49 6d61 6765 2e6c 6162  .image.Image.lab
+00030ef0: 656c 5f61 7828 7365 6c66 2c20 7669 6577  el_ax(self, view
+00030f00: 2c20 6964 782c 202a 2a6b 7761 7267 7329  , idx, **kwargs)
+00030f10: 0a20 2020 2020 2020 2073 6b72 742e 696d  .        skrt.im
+00030f20: 6167 652e 496d 6167 652e 7a6f 6f6d 5f61  age.Image.zoom_a
+00030f30: 7828 7365 6c66 2c20 7669 6577 2c20 7a6f  x(self, view, zo
+00030f40: 6f6d 2c20 7a6f 6f6d 5f63 656e 7472 6529  om, zoom_centre)
+00030f50: 0a20 2020 2020 2020 2069 6620 7368 6f77  .        if show
+00030f60: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
+00030f70: 742e 7368 6f77 2829 0a0a 2020 2020 6465  t.show()..    de
+00030f80: 6620 706c 6f74 5f63 6f6d 7061 7269 736f  f plot_compariso
+00030f90: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
+00030fa0: 200a 2020 2020 2020 2020 6f74 6865 722c   .        other,
+00030fb0: 200a 2020 2020 2020 2020 7669 6577 3d22   .        view="
+00030fc0: 782d 7922 2c0a 2020 2020 2020 2020 736c  x-y",.        sl
+00030fd0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2069  =None,.        i
+00030fe0: 6478 3d4e 6f6e 652c 0a20 2020 2020 2020  dx=None,.       
+00030ff0: 2070 6f73 3d4e 6f6e 652c 0a20 2020 2020   pos=None,.     
+00031000: 2020 206d 6964 5f73 6c69 6365 5f66 6f72     mid_slice_for
+00031010: 5f62 6f74 683d 4661 6c73 652c 0a20 2020  _both=False,.   
+00031020: 2020 2020 206c 6567 656e 643d 5472 7565       legend=True
+00031030: 2c20 0a20 2020 2020 2020 2073 6176 655f  , .        save_
+00031040: 6173 3d4e 6f6e 652c 200a 2020 2020 2020  as=None, .      
+00031050: 2020 6e61 6d65 733d 4e6f 6e65 2c20 0a20    names=None, . 
+00031060: 2020 2020 2020 2073 686f 773d 5472 7565         show=True
+00031070: 2c20 0a20 2020 2020 2020 2069 6e63 6c75  , .        inclu
+00031080: 6465 5f69 6d61 6765 3d46 616c 7365 2c0a  de_image=False,.
+00031090: 2020 2020 2020 2020 6c65 6765 6e64 5f62          legend_b
+000310a0: 626f 785f 746f 5f61 6e63 686f 723d 4e6f  box_to_anchor=No
+000310b0: 6e65 2c0a 2020 2020 2020 2020 6c65 6765  ne,.        lege
+000310c0: 6e64 5f6c 6f63 3d22 6c6f 7765 7220 6c65  nd_loc="lower le
+000310d0: 6674 222c 0a20 2020 2020 2020 2076 6f78  ft",.        vox
+000310e0: 656c 5f73 697a 653d 5b31 2c20 315d 2c0a  el_size=[1, 1],.
+000310f0: 2020 2020 2020 2020 6275 6666 6572 3d35          buffer=5
+00031100: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+00031110: 6773 0a20 2020 2029 3a0a 2020 2020 2020  gs.    ):.      
+00031120: 2020 2222 2250 6c6f 7420 636f 6d70 6172    """Plot compar
+00031130: 6973 6f6e 2077 6974 6820 616e 6f74 6865  ison with anothe
+00031140: 7220 524f 492e 2049 6620 6e6f 2073 6c2f  r ROI. If no sl/
+00031150: 6964 782f 706f 7320 6172 6520 6769 7665  idx/pos are give
+00031160: 6e2c 0a20 2020 2020 2020 2074 6865 2063  n,.        the c
+00031170: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00031180: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
+00031190: 2070 6c6f 7474 6564 2c20 756e 6c65 7373   plotted, unless
+000311a0: 200a 2020 2020 2020 2020 6d69 645f 736c   .        mid_sl
+000311b0: 6963 655f 666f 725f 626f 7468 3d54 7275  ice_for_both=Tru
+000311c0: 652c 2069 6e20 7768 6963 6820 6361 7365  e, in which case
+000311d0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+000311e0: 6365 206f 6620 626f 7468 2052 4f49 730a  ce of both ROIs.
+000311f0: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
+00031200: 706c 6f74 7465 6420 2865 7665 6e20 7468  plotted (even th
+00031210: 6f75 6768 2074 6869 7320 6d61 7920 6e6f  ough this may no
+00031220: 7420 636f 7272 6573 706f 6e64 2074 6f20  t correspond to 
+00031230: 7468 6520 7361 6d65 200a 2020 2020 2020  the same .      
+00031240: 2020 706f 696e 7420 696e 2073 7061 6365    point in space
+00031250: 292e 0a0a 2020 2020 2020 2020 2a2a 5061  )...        **Pa
+00031260: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
+00031270: 2020 2020 0a20 2020 2020 2020 206f 7468      .        oth
+00031280: 6572 203a 2052 4f49 0a20 2020 2020 2020  er : ROI.       
+00031290: 2020 2020 204f 7468 6572 2052 4f49 2077       Other ROI w
+000312a0: 6974 6820 7768 6963 6820 746f 2070 6c6f  ith which to plo
+000312b0: 7420 636f 6d70 6172 6973 6f6e 2e0a 0a20  t comparison... 
+000312c0: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
+000312d0: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
+000312e0: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
+000312f0: 656e 7461 7469 6f6e 2069 6e20 7768 6963  entation in whic
+00031300: 6820 746f 2070 6c6f 7420 524f 4973 2e20  h to plot ROIs. 
+00031310: 0a0a 2020 2020 2020 2020 736c 203a 2069  ..        sl : i
+00031320: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+00031330: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
+00031340: 6365 206e 756d 6265 722e 2049 6620 6e6f  ce number. If no
+00031350: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
+00031360: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
+00031370: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
+00031380: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
+00031390: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+000313a0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+000313b0: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
+000313c0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+000313d0: 2020 2020 6964 7820 3a20 696e 742c 2064      idx : int, d
+000313e0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+000313f0: 2020 2020 2020 2020 4172 7261 7920 696e          Array in
+00031400: 6465 7820 6f66 2073 6c69 6365 2e20 4966  dex of slice. If
+00031410: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00031420: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00031430: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+00031440: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+00031450: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+00031460: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+00031470: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
+00031480: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+00031490: 2020 2020 2020 2070 6f73 203a 2066 6c6f         pos : flo
+000314a0: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
+000314b0: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
+000314c0: 6365 2070 6f73 6974 696f 6e20 696e 206d  ce position in m
+000314d0: 6d2e 2049 6620 6e6f 6e65 206f 6620 3c73  m. If none of <s
+000314e0: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+000314f0: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
+00031500: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
+00031510: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+00031520: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+00031530: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+00031540: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+00031550: 642e 0a0a 2020 2020 2020 2020 6d69 645f  d...        mid_
+00031560: 736c 6963 655f 666f 725f 626f 7468 203a  slice_for_both :
+00031570: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+00031580: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00031590: 2049 6620 5472 7565 2061 6e64 206e 6f20   If True and no 
+000315a0: 736c 2f69 6478 2f70 6f73 2061 7265 2067  sl/idx/pos are g
+000315b0: 6976 656e 2c20 7468 6520 6365 6e74 7261  iven, the centra
+000315c0: 6c20 736c 6963 6573 206f 6620 626f 7468  l slices of both
+000315d0: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
+000315e0: 7320 7769 6c6c 2062 6520 706c 6f74 7465  s will be plotte
+000315f0: 642c 2065 7665 6e20 6966 2074 6869 7320  d, even if this 
+00031600: 646f 6573 206e 6f74 2063 6f72 7265 7370  does not corresp
+00031610: 6f6e 6420 746f 2074 6865 2073 616d 650a  ond to the same.
+00031620: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00031630: 7420 696e 2073 7061 6365 3b20 6f74 6865  t in space; othe
+00031640: 7277 6973 652c 2074 6865 2070 6f73 6974  rwise, the posit
+00031650: 696f 6e20 6f66 2074 6865 2063 656e 7472  ion of the centr
+00031660: 616c 2073 6c69 6365 206f 660a 2020 2020  al slice of.    
+00031670: 2020 2020 2020 2020 7468 6973 2052 4f49          this ROI
+00031680: 2077 696c 6c20 6265 2070 6c6f 7474 6564   will be plotted
+00031690: 2066 6f72 2062 6f74 682e 0a0a 2020 2020   for both...    
+000316a0: 2020 2020 6c65 6765 6e64 203a 2062 6f6f      legend : boo
+000316b0: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
+000316c0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+000316d0: 7275 652c 2061 206c 6567 656e 6420 7769  rue, a legend wi
+000316e0: 6c6c 2062 6520 6164 6465 6420 746f 2074  ll be added to t
+000316f0: 6865 2070 6c6f 7420 636f 6e74 6169 6e69  he plot containi
+00031700: 6e67 2074 6865 206e 616d 6573 200a 2020  ng the names .  
+00031710: 2020 2020 2020 2020 2020 6f66 2074 6865            of the
+00031720: 2074 776f 2052 4f49 732e 0a0a 2020 2020   two ROIs...    
+00031730: 2020 2020 7361 7665 5f61 7320 3a20 7374      save_as : st
+00031740: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+00031750: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+00031760: 2074 6f20 6120 6669 6c65 2061 7420 7768   to a file at wh
+00031770: 6963 6820 7468 6520 706c 6f74 2077 696c  ich the plot wil
+00031780: 6c20 6265 2073 6176 6564 2e20 4966 204e  l be saved. If N
+00031790: 6f6e 652c 2074 6865 2070 6c6f 740a 2020  one, the plot.  
+000317a0: 2020 2020 2020 2020 2020 7769 6c6c 206e            will n
+000317b0: 6f74 2062 6520 7361 7665 642e 0a0a 2020  ot be saved...  
+000317c0: 2020 2020 2020 6e61 6d65 7320 3a20 6c69        names : li
+000317d0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+000317e0: 0a20 2020 2020 2020 2020 2020 2043 7573  .            Cus
+000317f0: 746f 6d20 6e61 6d65 7320 746f 2075 7365  tom names to use
+00031800: 2066 6f72 2074 6865 2052 4f49 206c 6567   for the ROI leg
+00031810: 656e 6420 696e 206f 7264 6572 205b 7468  end in order [th
+00031820: 6973 2052 4f49 2c20 6f74 6865 7220 524f  is ROI, other RO
+00031830: 495d 2e0a 2020 2020 2020 2020 2020 2020  I]..            
+00031840: 4966 204e 6f6e 652c 2074 6865 206e 616d  If None, the nam
+00031850: 6573 2069 6e20 7365 6c66 2e6e 616d 6520  es in self.name 
+00031860: 616e 6420 726f 692e 6e61 6d65 2077 696c  and roi.name wil
+00031870: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+00031880: 2020 2020 7368 6f77 203a 2062 6f6f 6c2c      show : bool,
+00031890: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+000318a0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+000318b0: 652c 2074 6865 2070 6c6f 7420 7769 6c6c  e, the plot will
+000318c0: 2062 6520 6469 7370 6c61 7965 642e 0a0a   be displayed...
+000318d0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+000318e0: 7a65 203a 206c 6973 742c 2064 6566 6175  ze : list, defau
+000318f0: 6c74 3d5b 312c 2031 5d0a 2020 2020 2020  lt=[1, 1].      
+00031900: 2020 2020 2020 4966 2074 6865 2052 4f49        If the ROI
+00031910: 2064 6f65 7320 6e6f 7420 6861 7665 2061   does not have a
+00031920: 6e20 6173 736f 6369 6174 6564 2069 6d61  n associated ima
+00031930: 6765 2061 6e64 2069 7320 6465 7363 7269  ge and is descri
+00031940: 6265 6420 6f6e 6c79 0a20 2020 2020 2020  bed only.       
+00031950: 2020 2020 2062 7920 636f 6e74 6f75 7273       by contours
+00031960: 2c20 7468 6973 2077 696c 6c20 6265 2074  , this will be t
+00031970: 6865 2076 6f78 656c 2073 697a 6573 2075  he voxel sizes u
+00031980: 7365 6420 696e 2074 6865 2078 2d79 2064  sed in the x-y d
+00031990: 6972 6563 7469 6f6e 0a20 2020 2020 2020  irection.       
+000319a0: 2020 2020 2077 6865 6e20 636f 6e76 6572       when conver
+000319b0: 7469 6e67 2074 6865 2052 4f49 2074 6f20  ting the ROI to 
+000319c0: 6120 6d61 736b 2069 6620 6120 6d61 736b  a mask if a mask
+000319d0: 2070 6c6f 7420 7479 7065 2069 7320 7365   plot type is se
+000319e0: 6c65 6374 6564 2e0a 0a20 2020 2020 2020  lected...       
+000319f0: 2062 7566 6665 7220 3a20 696e 742c 2064   buffer : int, d
+00031a00: 6566 6175 6c74 3d35 0a20 2020 2020 2020  efault=5.       
+00031a10: 2020 2020 2049 6620 7468 6520 524f 4920       If the ROI 
+00031a20: 646f 6573 206e 6f74 2068 6176 6520 616e  does not have an
+00031a30: 2061 7373 6f63 6961 7465 6420 696d 6167   associated imag
+00031a40: 6520 616e 6420 6973 2064 6573 6372 6962  e and is describ
+00031a50: 6564 206f 6e6c 790a 2020 2020 2020 2020  ed only.        
+00031a60: 2020 2020 6279 2063 6f6e 746f 7572 732c      by contours,
+00031a70: 2074 6869 7320 7769 6c6c 2062 6520 7468   this will be th
+00031a80: 6520 6e75 6d62 6572 206f 6620 6275 6666  e number of buff
+00031a90: 6572 2076 6f78 656c 7320 0a20 2020 2020  er voxels .     
+00031aa0: 2020 2020 2020 2028 692e 652e 2077 6869         (i.e. whi
+00031ab0: 7465 7370 6163 6529 2064 6973 706c 6179  tespace) display
+00031ac0: 6564 2061 726f 756e 6420 7468 6520 524f  ed around the RO
+00031ad0: 492e 0a20 2020 2020 2020 2022 2222 0a20  I..        """. 
+00031ae0: 2020 2020 2020 2069 6d61 6765 5f72 6561         image_rea
+00031af0: 6479 203d 206b 7761 7267 732e 6765 7428  dy = kwargs.get(
+00031b00: 2269 6d61 6765 5f72 6561 6479 222c 2046  "image_ready", F
+00031b10: 616c 7365 290a 2020 2020 2020 2020 6966  alse).        if
+00031b20: 2069 6d61 6765 5f72 6561 6479 206f 7220   image_ready or 
+00031b30: 2869 6e63 6c75 6465 5f69 6d61 6765 2061  (include_image a
+00031b40: 6e64 2073 656c 662e 696d 6167 6520 616e  nd self.image an
+00031b50: 6420 6f74 6865 722e 696d 6167 6529 3a0a  d other.image):.
+00031b60: 2020 2020 2020 2020 2020 2020 726f 6931              roi1
+00031b70: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
+00031b80: 2020 2020 726f 6932 203d 206f 7468 6572      roi2 = other
+00031b90: 200a 2020 2020 2020 2020 656c 7365 3a0a   .        else:.
+00031ba0: 2020 2020 2020 2020 2020 2020 726f 6931              roi1
+00031bb0: 203d 2073 656c 662e 636c 6f6e 6528 636f   = self.clone(co
+00031bc0: 7079 5f64 6174 613d 4661 6c73 6529 0a20  py_data=False). 
+00031bd0: 2020 2020 2020 2020 2020 2072 6f69 3220             roi2 
+00031be0: 3d20 6f74 6865 722e 636c 6f6e 6528 636f  = other.clone(co
+00031bf0: 7079 5f64 6174 613d 4661 6c73 6529 0a20  py_data=False). 
+00031c00: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00031c10: 636c 7564 655f 696d 6167 6520 616e 6420  clude_image and 
+00031c20: 2873 656c 662e 696d 6167 6520 6f72 206f  (self.image or o
+00031c30: 7468 6572 2e69 6d61 6765 293a 0a20 2020  ther.image):.   
+00031c40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00031c50: 7365 6c66 2e69 6d61 6765 3a0a 2020 2020  self.image:.    
+00031c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031c70: 726f 6932 2e73 6574 5f69 6d61 6765 2873  roi2.set_image(s
+00031c80: 656c 662e 696d 6167 6529 0a20 2020 2020  elf.image).     
+00031c90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00031ca0: 6f69 322e 7265 7365 745f 636f 6e74 6f75  oi2.reset_contou
+00031cb0: 7273 2829 0a20 2020 2020 2020 2020 2020  rs().           
+00031cc0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00031cd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00031ce0: 6f69 312e 7365 745f 696d 6167 6528 6f74  oi1.set_image(ot
+00031cf0: 6865 722e 696d 6167 6529 0a20 2020 2020  her.image).     
+00031d00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00031d10: 6f69 312e 7265 7365 745f 636f 6e74 6f75  oi1.reset_contou
+00031d20: 7273 2829 0a20 2020 2020 2020 2020 2020  rs().           
+00031d30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00031d40: 2020 2020 2020 2069 6d20 3d20 5374 7275         im = Stru
+00031d50: 6374 7572 6553 6574 285b 726f 6931 2c20  ctureSet([roi1, 
+00031d60: 726f 6932 5d29 2e63 6f6d 6269 6e65 5f72  roi2]).combine_r
+00031d70: 6f69 7328 292e 6765 745f 6475 6d6d 795f  ois().get_dummy_
+00031d80: 696d 6167 6528 0a20 2020 2020 2020 2020  image(.         
+00031d90: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00031da0: 6f78 656c 5f73 697a 653d 766f 7865 6c5f  oxel_size=voxel_
+00031db0: 7369 7a65 2c20 6275 6666 6572 3d62 7566  size, buffer=buf
+00031dc0: 6665 7229 0a20 2020 2020 2020 2020 2020  fer).           
+00031dd0: 2020 2020 2069 6d2e 7469 746c 6520 3d20       im.title = 
+00031de0: 6622 7b72 6f69 312e 6e61 6d65 7d20 7673  f"{roi1.name} vs
+00031df0: 207b 726f 6932 2e6e 616d 657d 220a 2020   {roi2.name}".  
+00031e00: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00031e10: 7220 726f 6920 696e 205b 726f 6931 2c20  r roi in [roi1, 
+00031e20: 726f 6932 5d3a 0a20 2020 2020 2020 2020  roi2]:.         
+00031e30: 2020 2020 2020 2020 2020 2072 6f69 2e73             roi.s
+00031e40: 6574 5f69 6d61 6765 2869 6d29 0a20 2020  et_image(im).   
+00031e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031e60: 2072 6f69 2e63 7265 6174 655f 6d61 736b   roi.create_mask
+00031e70: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00031e80: 2020 2020 2020 2072 6f69 2e72 6573 6574         roi.reset
+00031e90: 5f63 6f6e 746f 7572 7328 290a 2020 2020  _contours().    
+00031ea0: 2020 2020 2020 2020 2020 2020 7a5f 6178              z_ax
+00031eb0: 203d 2073 6b72 742e 696d 6167 652e 5f73   = skrt.image._s
+00031ec0: 6c69 6365 5f61 7865 735b 7669 6577 5d0a  lice_axes[view].
+00031ed0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
+00031ee0: 696d 6167 655f 7265 6164 7922 5d20 3d20  image_ready"] = 
+00031ef0: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
+00031f00: 456e 7375 7265 2052 4f49 7320 6172 6520  Ensure ROIs are 
+00031f10: 706c 6f74 7465 6420 696e 2064 6966 6665  plotted in diffe
+00031f20: 7265 6e74 2063 6f6c 6f75 7273 0a20 2020  rent colours.   
+00031f30: 2020 2020 2069 6620 726f 6931 2e63 6f6c       if roi1.col
+00031f40: 6f72 203d 3d20 726f 6932 2e63 6f6c 6f72  or == roi2.color
+00031f50: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+00031f60: 6932 5f63 6f6c 6f72 203d 2052 4f49 4465  i2_color = ROIDe
+00031f70: 6661 756c 7473 2829 2e67 6574 5f64 6566  faults().get_def
+00031f80: 6175 6c74 5f72 6f69 5f63 6f6c 6f72 2829  ault_roi_color()
+00031f90: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00031fa0: 2020 2020 2020 2020 2020 2072 6f69 325f             roi2_
+00031fb0: 636f 6c6f 7220 3d20 726f 6932 2e63 6f6c  color = roi2.col
+00031fc0: 6f72 0a0a 2020 2020 2020 2020 2320 4765  or..        # Ge
+00031fd0: 7420 696e 6465 7820 746f 2070 6c6f 740a  t index to plot.
+00031fe0: 2020 2020 2020 2020 7a5f 6178 203d 2073          z_ax = s
+00031ff0: 6b72 742e 696d 6167 652e 5f73 6c69 6365  krt.image._slice
+00032000: 5f61 7865 735b 7669 6577 5d0a 0a20 2020  _axes[view]..   
+00032010: 2020 2020 2023 2043 6f6d 7075 7465 2070       # Compute p
+00032020: 6f73 6974 696f 6e20 696e 206d 6d20 746f  osition in mm to
+00032030: 2070 6c6f 740a 2020 2020 2020 2020 6966   plot.        if
+00032040: 2073 6c20 6973 204e 6f6e 6520 616e 6420   sl is None and 
+00032050: 706f 7320 6973 204e 6f6e 6520 616e 6420  pos is None and 
+00032060: 6964 7820 6973 204e 6f6e 653a 0a20 2020  idx is None:.   
+00032070: 2020 2020 2020 2020 2070 6f73 3120 3d20           pos1 = 
+00032080: 726f 6931 2e69 6478 5f74 6f5f 706f 7328  roi1.idx_to_pos(
+00032090: 726f 6931 2e67 6574 5f6d 6964 5f69 6478  roi1.get_mid_idx
+000320a0: 2876 6965 7729 2c20 7a5f 6178 290a 2020  (view), z_ax).  
+000320b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000320c0: 2020 2020 2020 2020 706f 7331 203d 2072          pos1 = r
+000320d0: 6f69 322e 6964 785f 746f 5f70 6f73 280a  oi2.idx_to_pos(.
+000320e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000320f0: 726f 6931 2e67 6574 5f69 6478 2876 6965  roi1.get_idx(vie
+00032100: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
+00032110: 782c 2070 6f73 3d70 6f73 292c 200a 2020  x, pos=pos), .  
+00032120: 2020 2020 2020 2020 2020 2020 2020 7a5f                z_
+00032130: 6178 0a20 2020 2020 2020 2020 2020 2029  ax.            )
+00032140: 0a0a 2020 2020 2020 2020 2320 506c 6f74  ..        # Plot
+00032150: 2074 6865 2073 616d 6520 706f 7369 7469   the same positi
+00032160: 6f6e 2066 6f72 206f 7468 6572 2052 4f49  on for other ROI
+00032170: 2c20 756e 6c65 7373 206d 6964 5f73 6c69  , unless mid_sli
+00032180: 6365 5f66 6f72 5f62 6f74 683d 5472 7565  ce_for_both=True
+00032190: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000321a0: 6d69 645f 736c 6963 655f 666f 725f 626f  mid_slice_for_bo
+000321b0: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+000321c0: 706f 7332 203d 2070 6f73 310a 2020 2020  pos2 = pos1.    
+000321d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000321e0: 2020 2020 2020 706f 7332 203d 2072 6f69        pos2 = roi
+000321f0: 322e 6964 785f 746f 5f70 6f73 286f 7468  2.idx_to_pos(oth
+00032200: 6572 2e67 6574 5f6d 6964 5f69 6478 2876  er.get_mid_idx(v
+00032210: 6965 7729 2c20 7a5f 6178 290a 0a20 2020  iew), z_ax)..   
+00032220: 2020 2020 2023 2050 6c6f 7420 7365 6c66       # Plot self
+00032230: 0a20 2020 2020 2020 2072 6f69 312e 706c  .        roi1.pl
+00032240: 6f74 2873 686f 773d 4661 6c73 652c 2076  ot(show=False, v
+00032250: 6965 773d 7669 6577 2c20 706f 733d 706f  iew=view, pos=po
+00032260: 7331 2c20 696e 636c 7564 655f 696d 6167  s1, include_imag
+00032270: 653d 696e 636c 7564 655f 696d 6167 652c  e=include_image,
+00032280: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00032290: 2020 2020 2a2a 6b77 6172 6773 290a 0a20      **kwargs).. 
+000322a0: 2020 2020 2020 2023 2041 646a 7573 7420         # Adjust 
+000322b0: 6b77 6172 6773 2066 6f72 2070 6c6f 7474  kwargs for plott
+000322c0: 696e 6720 7365 636f 6e64 2052 4f49 0a20  ing second ROI. 
+000322d0: 2020 2020 2020 206b 7761 7267 735b 2261         kwargs["a
+000322e0: 7822 5d20 3d20 726f 6931 2e61 780a 2020  x"] = roi1.ax.  
+000322f0: 2020 2020 2020 6b77 6172 6773 5b22 636f        kwargs["co
+00032300: 6c6f 7222 5d20 3d20 726f 6932 5f63 6f6c  lor"] = roi2_col
+00032310: 6f72 0a20 2020 2020 2020 2072 6f69 322e  or.        roi2.
+00032320: 706c 6f74 2873 686f 773d 4661 6c73 652c  plot(show=False,
+00032330: 2076 6965 773d 7669 6577 2c20 706f 733d   view=view, pos=
+00032340: 706f 7332 2c20 696e 636c 7564 655f 696d  pos2, include_im
+00032350: 6167 653d 4661 6c73 652c 200a 2020 2020  age=False, .    
+00032360: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00032370: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+00032380: 2072 6f69 312e 6178 2e73 6574 5f74 6974   roi1.ax.set_tit
+00032390: 6c65 2872 6f69 312e 6765 745f 636f 6d70  le(roi1.get_comp
+000323a0: 6172 6973 6f6e 5f6e 616d 6528 726f 6932  arison_name(roi2
+000323b0: 2929 0a0a 2020 2020 2020 2020 2320 4372  ))..        # Cr
+000323c0: 6561 7465 206c 6567 656e 640a 2020 2020  eate legend.    
+000323d0: 2020 2020 6966 206c 6567 656e 643a 0a20      if legend:. 
+000323e0: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
+000323f0: 7479 7065 203d 206b 7761 7267 732e 6765  type = kwargs.ge
+00032400: 7428 2270 6c6f 745f 7479 7065 222c 204e  t("plot_type", N
+00032410: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+00032420: 2069 6620 706c 6f74 5f74 7970 6520 6973   if plot_type is
+00032430: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00032440: 2020 2020 2020 2070 6c6f 745f 7479 7065         plot_type
+00032450: 203d 206b 7761 7267 732e 6765 7428 2272   = kwargs.get("r
+00032460: 6f69 5f70 6c6f 745f 7479 7065 222c 204e  oi_plot_type", N
+00032470: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+00032480: 206c 696e 6577 6964 7468 203d 206b 7761   linewidth = kwa
+00032490: 7267 732e 6765 7428 226c 696e 6577 6964  rgs.get("linewid
+000324a0: 7468 222c 204e 6f6e 6529 0a20 2020 2020  th", None).     
+000324b0: 2020 2020 2020 206f 7061 6369 7479 203d         opacity =
+000324c0: 206b 7761 7267 732e 6765 7428 226f 7061   kwargs.get("opa
+000324d0: 6369 7479 222c 204e 6f6e 6529 0a20 2020  city", None).   
+000324e0: 2020 2020 2020 2020 2069 6620 6e61 6d65           if name
+000324f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00032500: 2020 2072 6f69 315f 6e61 6d65 203d 206e     roi1_name = n
+00032510: 616d 6573 5b30 5d0a 2020 2020 2020 2020  ames[0].        
+00032520: 2020 2020 2020 2020 726f 6932 5f6e 616d          roi2_nam
+00032530: 6520 3d20 6e61 6d65 735b 315d 0a20 2020  e = names[1].   
+00032540: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00032550: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00032560: 6f69 315f 6e61 6d65 203d 2072 6f69 312e  oi1_name = roi1.
+00032570: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+00032580: 2020 2020 2072 6f69 325f 6e61 6d65 203d       roi2_name =
+00032590: 2072 6f69 322e 6e61 6d65 0a20 2020 2020   roi2.name.     
+000325a0: 2020 2020 2020 2068 616e 646c 6573 203d         handles =
+000325b0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+000325c0: 2020 2072 6f69 312e 6765 745f 7061 7463     roi1.get_patc
+000325d0: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
+000325e0: 2020 2020 2020 2070 6c6f 745f 7479 7065         plot_type
+000325f0: 2c20 726f 6931 2e63 6f6c 6f72 2c20 6f70  , roi1.color, op
+00032600: 6163 6974 792c 206c 696e 6577 6964 7468  acity, linewidth
+00032610: 2c20 726f 6931 5f6e 616d 6529 2c0a 2020  , roi1_name),.  
+00032620: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00032630: 6931 2e67 6574 5f70 6174 6368 280a 2020  i1.get_patch(.  
+00032640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032650: 2020 706c 6f74 5f74 7970 652c 2072 6f69    plot_type, roi
+00032660: 325f 636f 6c6f 722c 206f 7061 6369 7479  2_color, opacity
+00032670: 2c20 6c69 6e65 7769 6474 682c 2072 6f69  , linewidth, roi
+00032680: 325f 6e61 6d65 292c 0a20 2020 2020 2020  2_name),.       
+00032690: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+000326a0: 2020 2072 6f69 312e 6178 2e6c 6567 656e     roi1.ax.legen
+000326b0: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+000326c0: 2020 2068 616e 646c 6573 3d68 616e 646c     handles=handl
+000326d0: 6573 2c20 6672 616d 6561 6c70 6861 3d31  es, framealpha=1
+000326e0: 2c20 6661 6365 636f 6c6f 723d 2277 6869  , facecolor="whi
+000326f0: 7465 222c 200a 2020 2020 2020 2020 2020  te", .          
+00032700: 2020 2020 2020 6262 6f78 5f74 6f5f 616e        bbox_to_an
+00032710: 6368 6f72 3d6c 6567 656e 645f 6262 6f78  chor=legend_bbox
+00032720: 5f74 6f5f 616e 6368 6f72 2c20 6c6f 633d  _to_anchor, loc=
+00032730: 6c65 6765 6e64 5f6c 6f63 0a20 2020 2020  legend_loc.     
+00032740: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00032750: 2020 2320 5368 6f77 2f73 6176 650a 2020    # Show/save.  
+00032760: 2020 2020 2020 6966 2073 686f 773a 0a20        if show:. 
+00032770: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
+00032780: 686f 7728 290a 2020 2020 2020 2020 6966  how().        if
+00032790: 2073 6176 655f 6173 3a0a 2020 2020 2020   save_as:.      
+000327a0: 2020 2020 2020 706c 742e 7469 6768 745f        plt.tight_
+000327b0: 6c61 796f 7574 2829 0a20 2020 2020 2020  layout().       
+000327c0: 2020 2020 2072 6f69 312e 6669 672e 7361       roi1.fig.sa
+000327d0: 7665 6669 6728 7361 7665 5f61 7329 0a0a  vefig(save_as)..
+000327e0: 2020 2020 6465 6620 6765 745f 6173 7065      def get_aspe
+000327f0: 6374 5f72 6174 696f 280a 2020 2020 2020  ct_ratio(.      
+00032800: 2020 7365 6c66 2c20 7669 6577 2c20 2a61    self, view, *a
+00032810: 7267 732c 202a 2a6b 7761 7267 730a 2020  rgs, **kwargs.  
+00032820: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00032830: 4765 7420 6173 7065 6374 2072 6174 696f  Get aspect ratio
+00032840: 2066 6f72 2074 6869 7320 7374 7275 6374   for this struct
+00032850: 7572 6520 696e 2061 2067 6976 656e 206f  ure in a given o
+00032860: 7269 656e 7461 7469 6f6e 2e22 2222 0a0a  rientation."""..
+00032870: 2020 2020 2020 2020 785f 6178 2c20 795f          x_ax, y_
+00032880: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
+00032890: 5f70 6c6f 745f 6178 6573 5b76 6965 775d  _plot_axes[view]
+000328a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000328b0: 7365 6c66 2e67 6574 5f6c 656e 6774 6828  self.get_length(
+000328c0: 6178 3d73 6b72 742e 696d 6167 652e 5f61  ax=skrt.image._a
+000328d0: 7865 735b 785f 6178 5d29 205c 0a20 2020  xes[x_ax]) \.   
+000328e0: 2020 2020 2020 2020 2020 2020 202f 2073               / s
+000328f0: 656c 662e 6765 745f 6c65 6e67 7468 2861  elf.get_length(a
+00032900: 783d 736b 7274 2e69 6d61 6765 2e5f 6178  x=skrt.image._ax
+00032910: 6573 5b79 5f61 785d 290a 0a20 2020 2064  es[y_ax])..    d
+00032920: 6566 2073 6574 5f61 7828 7365 6c66 2c20  ef set_ax(self, 
+00032930: 706c 6f74 5f74 7970 652c 2069 6e63 6c75  plot_type, inclu
+00032940: 6465 5f69 6d61 6765 2c20 2a61 7267 732c  de_image, *args,
+00032950: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00032960: 2020 2020 2222 2253 6574 2075 7020 6178      """Set up ax
+00032970: 6573 2e22 2222 0a0a 2020 2020 2020 2020  es."""..        
+00032980: 6966 2070 6c6f 745f 7479 7065 2069 6e20  if plot_type in 
+00032990: 5b22 636f 6e74 6f75 7222 2c20 2263 656e  ["contour", "cen
+000329a0: 7472 6f69 6422 5d20 616e 6420 6e6f 7420  troid"] and not 
+000329b0: 696e 636c 7564 655f 696d 6167 653a 0a20  include_image:. 
+000329c0: 2020 2020 2020 2020 2020 2061 7370 6563             aspec
+000329d0: 745f 6765 7474 6572 203d 2073 656c 662e  t_getter = self.
+000329e0: 6765 745f 6173 7065 6374 5f72 6174 696f  get_aspect_ratio
+000329f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00032a00: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00032a10: 6c66 2e69 6d61 6765 2069 7320 6e6f 7420  lf.image is not 
+00032a20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00032a30: 2020 2020 2020 6173 7065 6374 5f67 6574        aspect_get
+00032a40: 7465 7220 3d20 7365 6c66 2e69 6d61 6765  ter = self.image
+00032a50: 2e67 6574 5f70 6c6f 745f 6173 7065 6374  .get_plot_aspect
+00032a60: 5f72 6174 696f 0a20 2020 2020 2020 2020  _ratio.         
+00032a70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00032a80: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
+00032a90: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
+00032aa0: 2020 2020 2020 2020 2020 2020 6173 7065              aspe
+00032ab0: 6374 5f67 6574 7465 7220 3d20 7365 6c66  ct_getter = self
+00032ac0: 2e6d 6173 6b2e 6765 745f 706c 6f74 5f61  .mask.get_plot_a
+00032ad0: 7370 6563 745f 7261 7469 6f0a 2020 2020  spect_ratio.    
+00032ae0: 2020 2020 736b 7274 2e69 6d61 6765 2e73      skrt.image.s
+00032af0: 6574 5f61 7828 7365 6c66 2c20 2a61 7267  et_ax(self, *arg
+00032b00: 732c 2061 7370 6563 745f 6765 7474 6572  s, aspect_getter
+00032b10: 3d61 7370 6563 745f 6765 7474 6572 2c20  =aspect_getter, 
+00032b20: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
+00032b30: 6566 2067 6574 5f7a 6f6f 6d5f 6365 6e74  ef get_zoom_cent
+00032b40: 7265 2873 656c 662c 2076 6965 7729 3a0a  re(self, view):.
+00032b50: 2020 2020 2020 2020 2222 2247 6574 2063          """Get c
+00032b60: 6f6f 7264 696e 6174 6573 2074 6f20 7a6f  oordinates to zo
+00032b70: 6f6d 2069 6e20 6f6e 2074 6869 7320 524f  om in on this RO
+00032b80: 492e 2222 220a 0a20 2020 2020 2020 207a  I."""..        z
+00032b90: 6f6f 6d5f 6365 6e74 7265 203d 205b 4e6f  oom_centre = [No
+00032ba0: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 5d0a  ne, None, None].
+00032bb0: 2020 2020 2020 2020 785f 6178 2c20 795f          x_ax, y_
+00032bc0: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
+00032bd0: 5f70 6c6f 745f 6178 6573 5b76 6965 775d  _plot_axes[view]
+00032be0: 0a20 2020 2020 2020 2078 2c20 7920 3d20  .        x, y = 
+00032bf0: 7365 6c66 2e67 6574 5f63 656e 7472 6528  self.get_centre(
+00032c00: 7669 6577 3d76 6965 772c 2073 696e 676c  view=view, singl
+00032c10: 655f 736c 6963 653d 5472 7565 290a 2020  e_slice=True).  
+00032c20: 2020 2020 2020 7a6f 6f6d 5f63 656e 7472        zoom_centr
+00032c30: 655b 785f 6178 5d20 3d20 780a 2020 2020  e[x_ax] = x.    
+00032c40: 2020 2020 7a6f 6f6d 5f63 656e 7472 655b      zoom_centre[
+00032c50: 795f 6178 5d20 3d20 790a 2020 2020 2020  y_ax] = y.      
+00032c60: 2020 7265 7475 726e 207a 6f6f 6d5f 6365    return zoom_ce
+00032c70: 6e74 7265 0a0a 2020 2020 6465 6620 7772  ntre..    def wr
+00032c80: 6974 6528 7365 6c66 2c20 6f75 746e 616d  ite(self, outnam
+00032c90: 653d 4e6f 6e65 2c20 6f75 7464 6972 3d22  e=None, outdir="
+00032ca0: 2e22 2c20 6578 743d 4e6f 6e65 2c20 6f76  .", ext=None, ov
+00032cb0: 6572 7772 6974 653d 4661 6c73 652c 0a20  erwrite=False,. 
+00032cc0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00032cd0: 725f 736f 7572 6365 3d4e 6f6e 652c 2070  r_source=None, p
+00032ce0: 6174 6965 6e74 5f69 643d 4e6f 6e65 2c20  atient_id=None, 
+00032cf0: 726f 6f74 5f75 6964 3d4e 6f6e 652c 0a20  root_uid=None,. 
+00032d00: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
+00032d10: 7365 3d54 7275 652c 2068 6561 6465 725f  se=True, header_
+00032d20: 6578 7472 6173 3d7b 7d2c 206b 6565 705f  extras={}, keep_
+00032d30: 736f 7572 6365 5f72 6f69 733d 5472 7565  source_rois=True
+00032d40: 2c20 2a2a 6b77 6172 6773 293a 0a0a 2020  , **kwargs):..  
+00032d50: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
+00032d60: 290a 0a20 2020 2020 2020 2023 2047 656e  )..        # Gen
+00032d70: 6572 6174 6520 6f75 7470 7574 206e 616d  erate output nam
+00032d80: 6520 6966 206e 6f74 2067 6976 656e 0a20  e if not given. 
+00032d90: 2020 2020 2020 2070 6f73 7369 626c 655f         possible_
+00032da0: 6578 7420 3d20 5b22 2e64 636d 222c 2022  ext = [".dcm", "
+00032db0: 2e6e 6969 2e67 7a22 2c20 222e 6e69 6922  .nii.gz", ".nii"
+00032dc0: 2c20 222e 6e70 7922 2c20 222e 7478 7422  , ".npy", ".txt"
+00032dd0: 5d0a 2020 2020 2020 2020 6966 2065 7874  ].        if ext
+00032de0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00032df0: 206e 6f74 2065 7874 2e73 7461 7274 7377   not ext.startsw
+00032e00: 6974 6828 222e 2229 3a0a 2020 2020 2020  ith("."):.      
+00032e10: 2020 2020 2020 6578 7420 3d20 6622 2e7b        ext = f".{
+00032e20: 6578 747d 220a 2020 2020 2020 2020 6966  ext}".        if
+00032e30: 206f 7574 6e61 6d65 2069 7320 4e6f 6e65   outname is None
+00032e40: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00032e50: 2065 7874 2069 7320 4e6f 6e65 3a0a 2020   ext is None:.  
+00032e60: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00032e70: 7420 3d20 222e 6e69 6922 0a20 2020 2020  t = ".nii".     
+00032e80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00032e90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00032ea0: 6578 7420 6e6f 7420 696e 2070 6f73 7369  ext not in possi
+00032eb0: 626c 655f 6578 743a 0a20 2020 2020 2020  ble_ext:.       
+00032ec0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00032ed0: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
+00032ee0: 6622 556e 7265 636f 676e 6973 6564 2066  f"Unrecognised f
+00032ef0: 696c 6520 6578 7465 6e73 696f 6e3a 207b  ile extension: {
+00032f00: 6578 747d 2229 0a20 2020 2020 2020 2020  ext}").         
+00032f10: 2020 2069 6620 6e6f 7420 6578 742e 7374     if not ext.st
+00032f20: 6172 7473 7769 7468 2822 2e22 293a 0a20  artswith("."):. 
+00032f30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00032f40: 7874 203d 2066 222e 7b65 7874 7d22 0a20  xt = f".{ext}". 
+00032f50: 2020 2020 2020 2020 2020 206f 7574 6e61             outna
+00032f60: 6d65 203d 2066 227b 6f75 7464 6972 7d2f  me = f"{outdir}/
+00032f70: 7b73 656c 662e 6e61 6d65 7d7b 6578 747d  {self.name}{ext}
+00032f80: 220a 0a20 2020 2020 2020 2023 204f 7468  "..        # Oth
+00032f90: 6572 7769 7365 2c20 696e 6665 7220 6578  erwise, infer ex
+00032fa0: 7465 6e73 696f 6e20 6672 6f6d 2066 696c  tension from fil
+00032fb0: 656e 616d 650a 2020 2020 2020 2020 656c  ename.        el
+00032fc0: 7365 3a0a 0a20 2020 2020 2020 2020 2020  se:..           
+00032fd0: 2023 2046 696e 6420 616e 7920 6f66 2074   # Find any of t
+00032fe0: 6865 2076 616c 6964 2066 696c 6520 6578  he valid file ex
+00032ff0: 7465 6e73 696f 6e73 0a20 2020 2020 2020  tensions.       
+00033000: 2020 2020 2066 6f72 2070 6f73 2069 6e20       for pos in 
+00033010: 706f 7373 6962 6c65 5f65 7874 3a0a 2020  possible_ext:.  
+00033020: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00033030: 206f 7574 6e61 6d65 2e65 6e64 7377 6974   outname.endswit
+00033040: 6828 706f 7329 3a0a 2020 2020 2020 2020  h(pos):.        
+00033050: 2020 2020 2020 2020 2020 2020 6578 7420              ext 
+00033060: 3d20 706f 730a 2020 2020 2020 2020 2020  = pos.          
+00033070: 2020 6966 2065 7874 206e 6f74 2069 6e20    if ext not in 
+00033080: 706f 7373 6962 6c65 5f65 7874 3a0a 2020  possible_ext:.  
+00033090: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000330a0: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
+000330b0: 2866 2255 6e72 6563 6f67 6e69 7365 6420  (f"Unrecognised 
+000330c0: 6f75 7470 7574 2066 696c 6520 7479 7065  output file type
+000330d0: 3a20 7b6f 7574 6e61 6d65 7d22 290a 0a20  : {outname}").. 
+000330e0: 2020 2020 2020 2020 2020 206f 7574 6e61             outna
+000330f0: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
+00033100: 6e28 6f75 7464 6972 2c20 6f75 746e 616d  n(outdir, outnam
+00033110: 6529 0a0a 2020 2020 2020 2020 2320 5772  e)..        # Wr
+00033120: 6974 6520 706f 696e 7473 2074 6f20 7465  ite points to te
+00033130: 7874 2066 696c 652c 2069 6e20 666f 726d  xt file, in form
+00033140: 6174 2074 6861 7420 6361 6e20 6265 2072  at that can be r
+00033150: 6561 6420 6279 2074 7261 6e73 666f 726d  ead by transform
+00033160: 6978 0a20 2020 2020 2020 2069 6620 6578  ix.        if ex
+00033170: 7420 3d3d 2022 2e74 7874 223a 0a20 2020  t == ".txt":.   
+00033180: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
+00033190: 745f 636f 6e74 6f75 7273 2829 0a0a 2020  t_contours()..  
+000331a0: 2020 2020 2020 2020 2020 706f 696e 7473            points
+000331b0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+000331c0: 2020 666f 7220 7a2c 2063 6f6e 746f 7572    for z, contour
+000331d0: 7320 696e 2073 656c 662e 636f 6e74 6f75  s in self.contou
+000331e0: 7273 5b22 782d 7922 5d2e 6974 656d 7328  rs["x-y"].items(
+000331f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00033200: 2020 2066 6f72 2069 6478 2c20 636f 6e74     for idx, cont
+00033210: 6f75 7220 696e 2065 6e75 6d65 7261 7465  our in enumerate
+00033220: 2863 6f6e 746f 7572 7329 3a0a 2020 2020  (contours):.    
+00033230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033240: 666f 7220 706f 696e 7420 696e 2063 6f6e  for point in con
+00033250: 746f 7572 3a0a 2020 2020 2020 2020 2020  tour:.          
+00033260: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00033270: 4164 6420 7468 7265 6520 6469 6769 7473  Add three digits
+00033280: 2074 6f20 7374 6f72 6520 7468 6520 636f   to store the co
+00033290: 6e74 6f75 7220 696e 6465 782c 0a20 2020  ntour index,.   
+000332a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000332b0: 2020 2020 2023 2077 6869 6368 2069 7320       # which is 
+000332c0: 756e 6c69 6b65 6c79 2074 6f20 6e65 6564  unlikely to need
+000332d0: 206d 6f72 6520 7468 616e 2061 2073 696e   more than a sin
+000332e0: 676c 6520 6469 6769 742e 0a20 2020 2020  gle digit..     
+000332f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033300: 2020 2023 2054 6869 7320 6861 7320 6e65     # This has ne
+00033310: 676c 6967 6962 6c65 2065 6666 6563 7420  gligible effect 
+00033320: 6f6e 2070 7265 6369 7369 6f6e 2c0a 2020  on precision,.  
+00033330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033340: 2020 2020 2020 2320 616e 6420 616c 6c6f        # and allo
+00033350: 7773 2063 6f6e 746f 7572 2d70 6f69 6e74  ws contour-point
+00033360: 2061 7373 6f63 6961 7469 6f6e 730a 2020   associations.  
+00033370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033380: 2020 2020 2020 2320 746f 2062 6520 6964        # to be id
+00033390: 656e 7469 6669 6564 2069 6e20 5472 616e  entified in Tran
+000333a0: 7366 6f72 6d69 7820 6f75 7470 7574 2e0a  sformix output..
+000333b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000333c0: 2020 2020 2020 2020 7a5f 6f75 7420 3d20          z_out = 
+000333d0: 6622 7b7a 3a2e 3366 7d7b 6964 783a 3033  f"{z:.3f}{idx:03
+000333e0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+000333f0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+00033400: 732e 6170 7065 6e64 2866 227b 706f 696e  s.append(f"{poin
+00033410: 745b 305d 3a2e 3366 7d20 7b70 6f69 6e74  t[0]:.3f} {point
+00033420: 5b31 5d3a 2e33 667d 207b 7a5f 6f75 747d  [1]:.3f} {z_out}
+00033430: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00033440: 7769 7468 206f 7065 6e28 6f75 746e 616d  with open(outnam
+00033450: 652c 2022 7722 2920 6173 2066 696c 653a  e, "w") as file:
+00033460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033470: 2066 696c 652e 7772 6974 6528 2270 6f69   file.write("poi
+00033480: 6e74 5c6e 2229 0a20 2020 2020 2020 2020  nt\n").         
+00033490: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+000334a0: 6528 6622 7b6c 656e 2870 6f69 6e74 7329  e(f"{len(points)
+000334b0: 7d5c 6e22 290a 2020 2020 2020 2020 2020  }\n").          
+000334c0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
+000334d0: 2822 5c6e 222e 6a6f 696e 2870 6f69 6e74  ("\n".join(point
+000334e0: 7329 290a 0a20 2020 2020 2020 2020 2020  s))..           
+000334f0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+00033500: 2023 2057 7269 7465 2061 7272 6179 2074   # Write array t
+00033510: 6f20 6e69 6674 6920 6f72 206e 7079 0a20  o nifti or npy. 
+00033520: 2020 2020 2020 2065 6c69 6620 6578 7420         elif ext 
+00033530: 213d 2022 2e64 636d 223a 0a20 2020 2020  != ".dcm":.     
+00033540: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+00033550: 7465 5f6d 6173 6b28 290a 2020 2020 2020  te_mask().      
+00033560: 2020 2020 2020 7365 6c66 2e6d 6173 6b2e        self.mask.
+00033570: 7772 6974 6528 6f75 746e 616d 652c 2076  write(outname, v
+00033580: 6572 626f 7365 3d76 6572 626f 7365 2c20  erbose=verbose, 
+00033590: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+000335a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000335b0: 2020 2020 6966 2068 6561 6465 725f 736f      if header_so
+000335c0: 7572 6365 2061 6e64 206b 6565 705f 736f  urce and keep_so
+000335d0: 7572 6365 5f72 6f69 733a 0a20 2020 2020  urce_rois:.     
+000335e0: 2020 2020 2020 2020 2020 2073 7472 7563             struc
+000335f0: 7475 7265 5f73 6574 203d 2053 7472 7563  ture_set = Struc
+00033600: 7475 7265 5365 7428 6865 6164 6572 5f73  tureSet(header_s
+00033610: 6f75 7263 6529 0a20 2020 2020 2020 2020  ource).         
+00033620: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00033630: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+00033640: 7265 5f73 6574 203d 2053 7472 7563 7475  re_set = Structu
+00033650: 7265 5365 7428 290a 2020 2020 2020 2020  reSet().        
+00033660: 2020 2020 7374 7275 6374 7572 655f 7365      structure_se
+00033670: 742e 6164 645f 726f 6928 7365 6c66 290a  t.add_roi(self).
+00033680: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+00033690: 6374 7572 655f 7365 742e 7772 6974 6528  cture_set.write(
+000336a0: 6f75 7464 6972 3d6f 7574 6469 722c 2065  outdir=outdir, e
+000336b0: 7874 3d65 7874 2c20 6f76 6572 7772 6974  xt=ext, overwrit
+000336c0: 653d 6f76 6572 7772 6974 652c 0a20 2020  e=overwrite,.   
+000336d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000336e0: 2068 6561 6465 725f 736f 7572 6365 3d68   header_source=h
+000336f0: 6561 6465 725f 736f 7572 6365 2c20 7061  eader_source, pa
+00033700: 7469 656e 745f 6964 3d70 6174 6965 6e74  tient_id=patient
+00033710: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+00033720: 2020 2020 2020 2020 2072 6f6f 745f 7569           root_ui
+00033730: 643d 726f 6f74 5f75 6964 2c20 7665 7262  d=root_uid, verb
+00033740: 6f73 653d 7665 7262 6f73 652c 0a20 2020  ose=verbose,.   
+00033750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033760: 2068 6561 6465 725f 6578 7472 6173 3d68   header_extras=h
+00033770: 6561 6465 725f 6578 7472 6173 290a 0a20  eader_extras).. 
+00033780: 2020 2064 6566 2074 7261 6e73 666f 726d     def transform
+00033790: 2873 656c 662c 2073 6361 6c65 3d31 2c20  (self, scale=1, 
+000337a0: 7472 616e 736c 6174 696f 6e3d 5b30 2c20  translation=[0, 
+000337b0: 302c 2030 5d2c 2072 6f74 6174 696f 6e3d  0, 0], rotation=
+000337c0: 5b30 2c20 302c 2030 5d2c 0a20 2020 2020  [0, 0, 0],.     
+000337d0: 2020 2020 2020 2063 656e 7472 653d 5b30         centre=[0
+000337e0: 2c20 302c 2030 5d2c 2072 6573 616d 706c  , 0, 0], resampl
+000337f0: 653d 2266 696e 6522 2c20 7265 7374 6f72  e="fine", restor
+00033800: 653d 5472 7565 2c20 0a20 2020 2020 2020  e=True, .       
+00033810: 2020 2020 2066 696c 6c5f 7661 6c75 653d       fill_value=
+00033820: 4e6f 6e65 2c20 666f 7263 655f 636f 6e74  None, force_cont
+00033830: 6f75 7273 3d46 616c 7365 293a 0a20 2020  ours=False):.   
+00033840: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00033850: 2041 7070 6c79 2074 6872 6565 2d64 696d   Apply three-dim
+00033860: 656e 7369 6f6e 616c 2073 696d 696c 6172  ensional similar
+00033870: 6974 7920 7472 616e 7366 6f72 6d20 746f  ity transform to
+00033880: 2052 4f49 2e0a 0a20 2020 2020 2020 2049   ROI...        I
+00033890: 6620 7468 6520 7472 616e 7366 6f72 6d20  f the transform 
+000338a0: 636f 7272 6573 706f 6e64 7320 746f 2061  corresponds to a
+000338b0: 2074 7261 6e73 6c61 7469 6f6e 2061 6e64   translation and
+000338c0: 2f6f 7220 726f 7461 7469 6f6e 0a20 2020  /or rotation.   
+000338d0: 2020 2020 2061 626f 7574 2074 6865 207a       about the z
+000338e0: 2d61 7869 732c 2061 6e64 2065 6974 6865  -axis, and eithe
+000338f0: 7220 7468 6520 726f 6920 736f 7572 6365  r the roi source
+00033900: 2074 7970 6520 6973 2022 6469 636f 6d22   type is "dicom"
+00033910: 0a20 2020 2020 2020 206f 7220 666f 7263  .        or forc
+00033920: 652d 636f 6e74 6f75 7273 2069 7320 5472  e-contours is Tr
+00033930: 7565 2c20 7468 6520 7472 616e 7366 6f72  ue, the transfor
+00033940: 6d20 6973 2061 7070 6c69 6564 2074 6f20  m is applied to 
+00033950: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
+00033960: 706f 696e 7473 2061 6e64 2074 6865 2072  points and the r
+00033970: 6f69 206d 6173 6b20 6973 2073 6574 2061  oi mask is set a
+00033980: 7320 756e 6c6f 6164 6564 2e20 204f 7468  s unloaded.  Oth
+00033990: 6572 7769 7365 2074 6865 2074 7261 6e73  erwise the trans
+000339a0: 666f 726d 0a20 2020 2020 2020 2069 7320  form.        is 
+000339b0: 6170 706c 6965 6420 746f 2074 6865 206d  applied to the m
+000339c0: 6173 6b20 616e 6420 636f 6e74 6f75 7273  ask and contours
+000339d0: 2061 7265 2073 6574 2061 7320 756e 6c6f   are set as unlo
+000339e0: 6164 6564 2e0a 0a20 2020 2020 2020 2054  aded...        T
+000339f0: 6865 2074 7261 6e73 666f 726d 2069 7320  he transform is 
+00033a00: 6170 706c 6965 6420 696e 2074 6865 206f  applied in the o
+00033a10: 7264 6572 3a20 7472 616e 736c 6174 696f  rder: translatio
+00033a20: 6e2c 2073 6361 6c69 6e67 2c0a 2020 2020  n, scaling,.    
+00033a30: 2020 2020 726f 7461 7469 6f6e 2e20 2054      rotation.  T
+00033a40: 6865 206c 6174 7465 7220 7477 6f20 6172  he latter two ar
+00033a50: 6520 6162 6f75 7420 7468 6520 6365 6e74  e about the cent
+00033a60: 7265 2063 6f6f 7264 696e 6174 6573 2e0a  re coordinates..
+00033a70: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+00033a80: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+00033a90: 200a 2020 2020 2020 2020 666f 7263 655f   .        force_
+00033aa0: 636f 6e74 6f75 7273 203a 2062 6f6f 6c2c  contours : bool,
+00033ab0: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+00033ac0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00033ad0: 7565 2c20 616e 6420 7468 6520 7472 616e  ue, and the tran
+00033ae0: 7366 6f72 6d20 636f 7272 6573 706f 6e64  sform correspond
+00033af0: 7320 746f 2061 2074 7261 6e73 6c61 7469  s to a translati
+00033b00: 6f6e 0a20 2020 2020 2020 2020 2020 2061  on.            a
+00033b10: 6e64 2f6f 7220 726f 7461 7469 6f6e 2061  nd/or rotation a
+00033b20: 626f 7574 2074 6865 207a 2d61 7869 732c  bout the z-axis,
+00033b30: 2061 7070 6c79 2074 7261 6e73 666f 726d   apply transform
+00033b40: 2074 6f20 636f 6e74 6f75 720a 2020 2020   to contour.    
+00033b50: 2020 2020 2020 2020 706f 696e 7473 2069          points i
+00033b60: 6e64 6570 656e 6465 6e74 6c79 206f 6620  ndependently of 
+00033b70: 7468 6520 6f72 6967 696e 616c 2064 6174  the original dat
+00033b80: 6120 736f 7572 6365 2e0a 0a20 2020 2020  a source...     
+00033b90: 2020 2046 6f72 206f 7468 6572 2070 6172     For other par
+00033ba0: 616d 6574 6572 732c 2073 6565 2064 6f63  ameters, see doc
+00033bb0: 756d 656e 7461 7469 6f6e 2066 6f72 0a20  umentation for. 
+00033bc0: 2020 2020 2020 2073 6b72 742e 696d 6167         skrt.imag
+00033bd0: 652e 496d 6167 652e 7472 616e 7366 6f72  e.Image.transfor
+00033be0: 6d28 292e 2020 4e6f 7465 2074 6861 7420  m().  Note that 
+00033bf0: 7468 6520 6060 6f72 6465 7260 600a 2020  the ``order``.  
+00033c00: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
+00033c10: 6973 6e27 7420 6176 6169 6c61 626c 6520  isn't available 
+00033c20: 666f 7220 726f 6920 7472 616e 7366 6f72  for roi transfor
+00033c30: 6d73 202d 2061 2076 616c 7565 206f 6620  ms - a value of 
+00033c40: 300a 2020 2020 2020 2020 6973 2075 7365  0.        is use
+00033c50: 6420 616c 7761 7973 2e0a 2020 2020 2020  d always..      
+00033c60: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+00033c70: 2043 6865 636b 2077 6865 7468 6572 2074   Check whether t
+00033c80: 7261 6e73 666f 726d 2069 7320 746f 2062  ransform is to b
+00033c90: 6520 6170 706c 6965 6420 746f 2063 6f6e  e applied to con
+00033ca0: 746f 7572 730a 2020 2020 2020 2020 736d  tours.        sm
+00033cb0: 616c 6c5f 6e75 6d62 6572 203d 2031 2e65  all_number = 1.e
+00033cc0: 2d36 0a20 2020 2020 2020 2074 7261 6e73  -6.        trans
+00033cd0: 666f 726d 5f63 6f6e 746f 7572 7320 3d20  form_contours = 
+00033ce0: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+00033cf0: 2073 656c 662e 736f 7572 6365 5f74 7970   self.source_typ
+00033d00: 6520 3d3d 2027 636f 6e74 6f75 7227 206f  e == 'contour' o
+00033d10: 7220 666f 7263 655f 636f 6e74 6f75 7273  r force_contours
+00033d20: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00033d30: 2061 6273 2873 6361 6c65 202d 2031 2920   abs(scale - 1) 
+00033d40: 3c20 736d 616c 6c5f 6e75 6d62 6572 3a0a  < small_number:.
+00033d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033d60: 6966 2061 6273 2872 6f74 6174 696f 6e5b  if abs(rotation[
+00033d70: 305d 2920 3c20 736d 616c 6c5f 6e75 6d62  0]) < small_numb
+00033d80: 6572 205c 0a20 2020 2020 2020 2020 2020  er \.           
+00033d90: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00033da0: 2061 6273 2872 6f74 6174 696f 6e5b 315d   abs(rotation[1]
+00033db0: 2920 3c20 736d 616c 6c5f 6e75 6d62 6572  ) < small_number
+00033dc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00033dd0: 2020 2020 2020 7472 616e 7366 6f72 6d5f        transform_
+00033de0: 636f 6e74 6f75 7273 203d 2054 7275 650a  contours = True.
+00033df0: 0a20 2020 2020 2020 2069 6620 7472 616e  .        if tran
+00033e00: 7366 6f72 6d5f 636f 6e74 6f75 7273 3a0a  sform_contours:.
+00033e10: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+00033e20: 7070 6c79 2074 7261 6e73 666f 726d 2074  pply transform t
+00033e30: 6f20 726f 6920 636f 6e74 6f75 7273 0a20  o roi contours. 
+00033e40: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+00033e50: 6c61 7469 6f6e 5f32 6420 3d20 2874 7261  lation_2d = (tra
+00033e60: 6e73 6c61 7469 6f6e 5b30 5d2c 2074 7261  nslation[0], tra
+00033e70: 6e73 6c61 7469 6f6e 5b31 5d29 0a20 2020  nslation[1]).   
+00033e80: 2020 2020 2020 2020 2063 656e 7472 655f           centre_
+00033e90: 3264 203d 2028 6365 6e74 7265 5b30 5d2c  2d = (centre[0],
+00033ea0: 2063 656e 7472 655b 315d 290a 2020 2020   centre[1]).    
+00033eb0: 2020 2020 2020 2020 616e 676c 6520 3d20          angle = 
+00033ec0: 726f 7461 7469 6f6e 5b32 5d0a 2020 2020  rotation[2].    
+00033ed0: 2020 2020 2020 2020 6e65 775f 636f 6e74          new_cont
+00033ee0: 6f75 7273 203d 207b 7d0a 2020 2020 2020  ours = {}.      
+00033ef0: 2020 2020 2020 666f 7220 6b65 792c 2063        for key, c
+00033f00: 6f6e 746f 7572 7320 696e 2073 656c 662e  ontours in self.
+00033f10: 6765 745f 636f 6e74 6f75 7273 2829 2e69  get_contours().i
+00033f20: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00033f30: 2020 2020 2020 2020 6e65 775f 6b65 7920          new_key 
+00033f40: 3d20 6b65 7920 2b20 7472 616e 736c 6174  = key + translat
+00033f50: 696f 6e5b 325d 0a20 2020 2020 2020 2020  ion[2].         
+00033f60: 2020 2020 2020 206e 6577 5f63 6f6e 746f         new_conto
+00033f70: 7572 735b 6e65 775f 6b65 795d 203d 205b  urs[new_key] = [
+00033f80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00033f90: 2020 666f 7220 636f 6e74 6f75 7220 696e    for contour in
+00033fa0: 2063 6f6e 746f 7572 733a 0a20 2020 2020   contours:.     
+00033fb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00033fc0: 6620 6c65 6e28 636f 6e74 6f75 7229 203c  f len(contour) <
+00033fd0: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+00033fe0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00033ff0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00034000: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00034010: 203d 2063 6f6e 746f 7572 5f74 6f5f 706f   = contour_to_po
+00034020: 6c79 676f 6e28 636f 6e74 6f75 7229 0a20  lygon(contour). 
+00034030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034040: 2020 2070 6f6c 7967 6f6e 203d 2061 6666     polygon = aff
+00034050: 696e 6974 792e 7472 616e 736c 6174 6528  inity.translate(
+00034060: 706f 6c79 676f 6e2c 202a 7472 616e 736c  polygon, *transl
+00034070: 6174 696f 6e5f 3264 290a 2020 2020 2020  ation_2d).      
+00034080: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00034090: 6c79 676f 6e20 3d20 6166 6669 6e69 7479  lygon = affinity
+000340a0: 2e72 6f74 6174 6528 706f 6c79 676f 6e2c  .rotate(polygon,
+000340b0: 2061 6e67 6c65 2c20 6365 6e74 7265 5f32   angle, centre_2
+000340c0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+000340d0: 2020 2020 2020 2070 6f6c 7967 6f6e 203d         polygon =
+000340e0: 2061 6666 696e 6974 792e 7363 616c 6528   affinity.scale(
+000340f0: 706f 6c79 676f 6e2c 2073 6361 6c65 2c20  polygon, scale, 
+00034100: 7363 616c 652c 2073 6361 6c65 2c0a 2020  scale, scale,.  
+00034110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034120: 2020 2020 2020 2020 2020 6365 6e74 7265            centre
+00034130: 5f32 6429 0a20 2020 2020 2020 2020 2020  _2d).           
+00034140: 2020 2020 2020 2020 206e 6577 5f63 6f6e           new_con
+00034150: 746f 7572 735b 6e65 775f 6b65 795d 2e61  tours[new_key].a
+00034160: 7070 656e 6428 706f 6c79 676f 6e5f 746f  ppend(polygon_to
+00034170: 5f63 6f6e 746f 7572 2870 6f6c 7967 6f6e  _contour(polygon
+00034180: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00034190: 2020 2069 6620 6e6f 7420 6e65 775f 636f     if not new_co
+000341a0: 6e74 6f75 7273 5b6e 6577 5f6b 6579 5d3a  ntours[new_key]:
+000341b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000341c0: 2020 2020 206e 6577 5f63 6f6e 746f 7572       new_contour
+000341d0: 732e 706f 7028 6e65 775f 6b65 7929 0a0a  s.pop(new_key)..
+000341e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000341f0: 2e72 6573 6574 5f63 6f6e 746f 7572 7328  .reset_contours(
+00034200: 6e65 775f 636f 6e74 6f75 7273 290a 0a20  new_contours).. 
+00034210: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00034220: 2020 2020 2020 2020 2023 2041 7070 6c79           # Apply
+00034230: 2074 7261 6e73 666f 726d 2074 6f20 726f   transform to ro
+00034240: 6920 6d61 736b 0a20 2020 2020 2020 2020  i mask.         
+00034250: 2020 2073 656c 662e 6372 6561 7465 5f6d     self.create_m
+00034260: 6173 6b28 290a 2020 2020 2020 2020 2020  ask().          
+00034270: 2020 7365 6c66 2e6d 6173 6b2e 7472 616e    self.mask.tran
+00034280: 7366 6f72 6d28 7363 616c 652c 2074 7261  sform(scale, tra
+00034290: 6e73 6c61 7469 6f6e 2c20 726f 7461 7469  nslation, rotati
+000342a0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+000342b0: 2020 2020 2020 2020 6365 6e74 7265 2c20          centre, 
+000342c0: 7265 7361 6d70 6c65 2c20 7265 7374 6f72  resample, restor
+000342d0: 652c 2030 2c20 6669 6c6c 5f76 616c 7565  e, 0, fill_value
+000342e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000342f0: 6c66 2e72 6573 6574 5f6d 6173 6b28 290a  lf.reset_mask().
+00034300: 0a20 2020 2064 6566 2063 726f 7028 7365  .    def crop(se
+00034310: 6c66 2c20 786c 696d 3d4e 6f6e 652c 2079  lf, xlim=None, y
+00034320: 6c69 6d3d 4e6f 6e65 2c20 7a6c 696d 3d4e  lim=None, zlim=N
+00034330: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00034340: 220a 2020 2020 2020 2020 4372 6f70 2052  ".        Crop R
+00034350: 4f49 2074 6f20 7370 6563 6966 6965 6420  OI to specified 
+00034360: 7261 6e67 6520 696e 2078 2c20 792c 207a  range in x, y, z
+00034370: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+00034380: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+00034390: 2020 2020 786c 696d 203a 2074 7570 6c65      xlim : tuple
+000343a0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+000343b0: 2020 2020 2020 2020 2020 204c 6f77 6572             Lower
+000343c0: 2061 6e64 2075 7070 6572 2062 6f75 6e64   and upper bound
+000343d0: 7320 696e 206d 6d20 666f 7220 6372 6f70  s in mm for crop
+000343e0: 7069 6e67 2061 6c6f 6e67 2078 2d61 7869  ping along x-axi
+000343f0: 732e 0a20 2020 2020 2020 2020 2020 2049  s..            I
+00034400: 6620 7365 7420 746f 204e 6f6e 652c 206e  f set to None, n
+00034410: 6f20 6372 6f70 7069 6e67 2069 7320 7065  o cropping is pe
+00034420: 7266 6f72 6d65 642e 2020 4966 2061 2062  rformed.  If a b
+00034430: 6f75 6e64 0a20 2020 2020 2020 2020 2020  ound.           
+00034440: 2069 7320 7365 7420 746f 204e 6f6e 652c   is set to None,
+00034450: 2074 6861 7420 626f 756e 6420 6973 2064   that bound is d
+00034460: 6973 7265 6761 7264 6564 2e0a 0a20 2020  isregarded...   
+00034470: 2020 2020 2079 6c69 6d20 3a20 7475 706c       ylim : tupl
+00034480: 652c 2064 6566 6175 6c74 3d4e 6f6e 650a  e, default=None.
+00034490: 2020 2020 2020 2020 2020 2020 4c6f 7765              Lowe
+000344a0: 7220 616e 6420 7570 7065 7220 626f 756e  r and upper boun
+000344b0: 6473 2069 6e20 6d6d 2066 6f72 2063 726f  ds in mm for cro
+000344c0: 7070 696e 6720 616c 6f6e 6720 792d 6178  pping along y-ax
+000344d0: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
+000344e0: 4966 2073 6574 2074 6f20 4e6f 6e65 2c20  If set to None, 
+000344f0: 6e6f 2063 726f 7070 696e 6720 6973 2070  no cropping is p
+00034500: 6572 666f 726d 6564 2e20 2049 6620 6120  erformed.  If a 
+00034510: 626f 756e 640a 2020 2020 2020 2020 2020  bound.          
+00034520: 2020 6973 2073 6574 2074 6f20 4e6f 6e65    is set to None
+00034530: 2c20 7468 6174 2062 6f75 6e64 2069 7320  , that bound is 
+00034540: 6469 7372 6567 6172 6465 642e 0a0a 2020  disregarded...  
+00034550: 2020 2020 2020 7a6c 696d 203a 2074 7570        zlim : tup
+00034560: 6c65 2c20 6465 6661 756c 743d 4e6f 6e65  le, default=None
+00034570: 0a20 2020 2020 2020 2020 2020 204c 6f77  .            Low
+00034580: 6572 2061 6e64 2075 7070 6572 2062 6f75  er and upper bou
+00034590: 6e64 7320 696e 206d 6d20 666f 7220 6372  nds in mm for cr
+000345a0: 6f70 7069 6e67 2061 6c6f 6e67 207a 2d61  opping along z-a
+000345b0: 7869 732e 0a20 2020 2020 2020 2020 2020  xis..           
+000345c0: 2049 6620 7365 7420 746f 204e 6f6e 652c   If set to None,
+000345d0: 206e 6f20 6372 6f70 7069 6e67 2069 7320   no cropping is 
+000345e0: 7065 7266 6f72 6d65 642e 2020 4966 2061  performed.  If a
+000345f0: 2062 6f75 6e64 0a20 2020 2020 2020 2020   bound.         
+00034600: 2020 2069 7320 7365 7420 746f 204e 6f6e     is set to Non
+00034610: 652c 2074 6861 7420 626f 756e 6420 6973  e, that bound is
+00034620: 2064 6973 7265 6761 7264 6564 2e0a 0a20   disregarded... 
+00034630: 2020 2020 2020 2049 6620 6f6e 6c79 207a         If only z
+00034640: 6c69 6d20 6973 206e 6f74 2073 6574 2074  lim is not set t
+00034650: 6f20 4e6f 6e65 2061 6e64 2074 6865 2052  o None and the R
+00034660: 4f49 2073 6f75 7263 6520 7479 7065 2069  OI source type i
+00034670: 7320 2263 6f6e 746f 7572 222c 0a20 2020  s "contour",.   
+00034680: 2020 2020 2063 726f 7070 696e 6720 6973       cropping is
+00034690: 2070 6572 666f 726d 6564 2062 7920 6469   performed by di
+000346a0: 7363 6172 6469 6e67 2063 6f6e 746f 7572  scarding contour
+000346b0: 7320 6f75 7473 6964 6520 7468 6520 7265  s outside the re
+000346c0: 7175 6972 6564 0a20 2020 2020 2020 2072  quired.        r
+000346d0: 616e 6765 2e20 204f 7468 7769 7365 2063  ange.  Othwise c
+000346e0: 726f 7070 696e 6720 6973 2070 6572 666f  ropping is perfo
+000346f0: 726d 6564 206f 6e20 7468 6520 524f 4920  rmed on the ROI 
+00034700: 6d61 736b 2e0a 2020 2020 2020 2020 2222  mask..        ""
+00034710: 220a 2020 2020 2020 2020 2320 466f 7220  ".        # For 
+00034720: 6372 6f70 7069 6e67 2061 6c6f 6e67 207a  cropping along z
+00034730: 2c20 616e 6420 7768 6572 6520 524f 4920  , and where ROI 
+00034740: 6973 2064 6566 696e 6564 2066 726f 6d20  is defined from 
+00034750: 636f 6e74 6f75 7273 2c0a 2020 2020 2020  contours,.      
+00034760: 2020 2320 6469 7363 6172 6420 636f 6e74    # discard cont
+00034770: 6f75 7273 206f 7574 7369 6465 2063 726f  ours outside cro
+00034780: 7020 7261 6e67 652e 0a20 2020 2020 2020  p range..       
+00034790: 2069 6620 7365 6c66 2e73 6f75 7263 655f   if self.source_
+000347a0: 7479 7065 203d 3d20 2263 6f6e 746f 7572  type == "contour
+000347b0: 2220 616e 6420 7a6c 696d 2061 6e64 206e  " and zlim and n
+000347c0: 6f74 2078 6c69 6d20 616e 6420 6e6f 7420  ot xlim and not 
+000347d0: 796c 696d 3a0a 2020 2020 2020 2020 2020  ylim:.          
+000347e0: 2020 636f 6e74 6f75 7273 203d 2073 656c    contours = sel
+000347f0: 662e 6765 745f 636f 6e74 6f75 7273 2829  f.get_contours()
+00034800: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00034810: 7a6c 696d 5b30 5d20 6973 204e 6f6e 653a  zlim[0] is None:
+00034820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034830: 207a 6c69 6d5b 305d 203d 206d 696e 2863   zlim[0] = min(c
+00034840: 6f6e 746f 7572 7329 202d 2031 0a20 2020  ontours) - 1.   
+00034850: 2020 2020 2020 2020 2069 6620 7a6c 696d           if zlim
+00034860: 5b31 5d20 6973 204e 6f6e 653a 0a20 2020  [1] is None:.   
+00034870: 2020 2020 2020 2020 2020 2020 207a 6c69               zli
+00034880: 6d5b 315d 203d 206d 6178 2863 6f6e 746f  m[1] = max(conto
+00034890: 7572 7329 202b 2031 0a20 2020 2020 2020  urs) + 1.       
+000348a0: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
+000348b0: 7b7a 3a20 7a5f 636f 6e74 6f75 7273 2066  {z: z_contours f
+000348c0: 6f72 207a 2c20 7a5f 636f 6e74 6f75 7273  or z, z_contours
+000348d0: 2069 6e20 636f 6e74 6f75 7273 2e69 7465   in contours.ite
+000348e0: 6d73 2829 0a20 2020 2020 2020 2020 2020  ms().           
+000348f0: 2020 2020 2020 2020 2069 6620 287a 203e           if (z >
+00034900: 207a 6c69 6d5b 305d 2061 6e64 207a 203c   zlim[0] and z <
+00034910: 207a 6c69 6d5b 315d 297d 0a0a 2020 2020   zlim[1])}..    
+00034920: 2020 2020 2020 2020 2320 5265 7365 7420          # Reset 
+00034930: 636f 6e74 6f75 7273 2e0a 2020 2020 2020  contours..      
+00034940: 2020 2020 2020 7365 6c66 2e72 6573 6574        self.reset
+00034950: 5f63 6f6e 746f 7572 7328 636f 6e74 6f75  _contours(contou
+00034960: 7273 290a 0a20 2020 2020 2020 2023 2046  rs)..        # F
+00034970: 6f72 2061 6c6c 206f 7468 6572 2063 6173  or all other cas
+00034980: 6573 2c20 6672 6f70 2052 4f49 206d 6173  es, frop ROI mas
+00034990: 6b2e 0a20 2020 2020 2020 2065 6c69 6620  k..        elif 
+000349a0: 786c 696d 206f 7220 796c 696d 206f 7220  xlim or ylim or 
+000349b0: 7a6c 696d 3a0a 2020 2020 2020 2020 2020  zlim:.          
+000349c0: 2020 7365 6c66 2e63 7265 6174 655f 6d61    self.create_ma
+000349d0: 736b 2829 0a20 2020 2020 2020 2020 2020  sk().           
+000349e0: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
+000349f0: 456e 7375 7265 2074 6861 7420 6372 6f70  Ensure that crop
+00034a00: 2072 616e 6765 2061 6c6f 6e67 2065 6163   range along eac
+00034a10: 6820 6178 6973 2069 7320 4e6f 6e65 0a20  h axis is None. 
+00034a20: 2020 2020 2020 2020 2020 2023 206f 7220             # or 
+00034a30: 6120 7477 6f2d 656c 656d 656e 7420 7475  a two-element tu
+00034a40: 706c 6520 6f66 2066 6c6f 6174 732e 0a20  ple of floats.. 
+00034a50: 2020 2020 2020 2020 2020 206c 696d 7320             lims 
+00034a60: 3d20 5b78 6c69 6d2c 2079 6c69 6d2c 207a  = [xlim, ylim, z
+00034a70: 6c69 6d5d 0a20 2020 2020 2020 2020 2020  lim].           
+00034a80: 206d 6173 6b5f 6578 7465 6e74 7320 3d20   mask_extents = 
+00034a90: 7365 6c66 2e6d 6173 6b2e 6765 745f 6578  self.mask.get_ex
+00034aa0: 7465 6e74 7328 290a 2020 2020 2020 2020  tents().        
+00034ab0: 2020 2020 666f 7220 695f 6178 2c20 6c69      for i_ax, li
+00034ac0: 6d20 696e 2065 6e75 6d65 7261 7465 286c  m in enumerate(l
+00034ad0: 696d 7329 3a0a 2020 2020 2020 2020 2020  ims):.          
+00034ae0: 2020 2020 2020 6966 206c 696d 3a0a 2020        if lim:.  
+00034af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034b00: 2020 666f 7220 6964 7820 696e 205b 302c    for idx in [0,
+00034b10: 2031 5d3a 0a20 2020 2020 2020 2020 2020   1]:.           
+00034b20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00034b30: 6c69 6d5b 6964 785d 2069 7320 4e6f 6e65  lim[idx] is None
+00034b40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00034b50: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00034b60: 6d73 5b69 5f61 785d 5b69 6478 5d20 3d20  ms[i_ax][idx] = 
+00034b70: 6d61 736b 5f65 7874 656e 7473 5b69 5f61  mask_extents[i_a
+00034b80: 785d 5b69 6478 5d0a 2020 2020 2020 2020  x][idx].        
+00034b90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00034ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034bb0: 2020 6c69 6d73 5b69 5f61 785d 203d 204e    lims[i_ax] = N
+00034bc0: 6f6e 650a 0a20 2020 2020 2020 2020 2020  one..           
+00034bd0: 2023 204c 6f6f 7020 6f76 6572 2061 7865   # Loop over axe
+00034be0: 732e 0a20 2020 2020 2020 2020 2020 2066  s..            f
+00034bf0: 6f72 2069 5f61 782c 206c 696d 2069 6e20  or i_ax, lim in 
+00034c00: 656e 756d 6572 6174 6528 6c69 6d73 293a  enumerate(lims):
+00034c10: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034c20: 2020 6966 206c 696d 2069 7320 4e6f 6e65    if lim is None
+00034c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00034c40: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+00034c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034c60: 2320 4669 6e64 2061 7272 6179 2069 6e64  # Find array ind
+00034c70: 6963 6573 2061 7420 7768 6963 6820 746f  ices at which to
+00034c80: 2063 726f 702e 0a20 2020 2020 2020 2020   crop..         
+00034c90: 2020 2020 2020 2069 3120 3d20 7365 6c66         i1 = self
+00034ca0: 2e6d 6173 6b2e 706f 735f 746f 5f69 6478  .mask.pos_to_idx
+00034cb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00034cc0: 2020 2020 2020 2020 2020 6c69 6d73 5b69            lims[i
+00034cd0: 5f61 785d 5b30 5d2c 2061 783d 695f 6178  _ax][0], ax=i_ax
+00034ce0: 2c20 7265 7475 726e 5f69 6e74 3d46 616c  , return_int=Fal
+00034cf0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00034d00: 2020 2020 6932 203d 2073 656c 662e 6d61      i2 = self.ma
+00034d10: 736b 2e70 6f73 5f74 6f5f 6964 7828 6c69  sk.pos_to_idx(li
+00034d20: 6d73 5b69 5f61 785d 5b31 5d2c 2061 783d  ms[i_ax][1], ax=
+00034d30: 695f 6178 2c0a 2020 2020 2020 2020 2020  i_ax,.          
+00034d40: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00034d50: 7475 726e 5f69 6e74 3d46 616c 7365 290a  turn_int=False).
+00034d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034d70: 695f 6269 672c 2069 5f73 6d61 6c6c 203d  i_big, i_small =
+00034d80: 2069 322c 2069 310a 2020 2020 2020 2020   i2, i1.        
+00034d90: 2020 2020 2020 2020 6966 2069 3120 3e20          if i1 > 
+00034da0: 6932 3a0a 2020 2020 2020 2020 2020 2020  i2:.            
+00034db0: 2020 2020 2020 2020 695f 6269 672c 2069          i_big, i
+00034dc0: 5f73 6d61 6c6c 203d 2069 5f73 6d61 6c6c  _small = i_small
+00034dd0: 2c20 695f 6269 670a 2020 2020 2020 2020  , i_big.        
+00034de0: 2020 2020 2020 2020 695f 736d 616c 6c20          i_small 
+00034df0: 3d20 696e 7428 6e70 2e66 6c6f 6f72 2869  = int(np.floor(i
+00034e00: 5f73 6d61 6c6c 202b 2030 2e35 2929 0a20  _small + 0.5)). 
+00034e10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00034e20: 5f62 6967 203d 2069 6e74 286e 702e 666c  _big = int(np.fl
+00034e30: 6f6f 7228 695f 6269 6720 2b20 302e 3529  oor(i_big + 0.5)
+00034e40: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00034e50: 2020 2023 2043 726f 7020 7468 6520 6d61     # Crop the ma
+00034e60: 736b 2e0a 2020 2020 2020 2020 2020 2020  sk..            
+00034e70: 2020 2020 6178 5f74 6f5f 736c 6963 6520      ax_to_slice 
+00034e80: 3d20 7365 6c66 2e6d 6173 6b2e 6765 745f  = self.mask.get_
+00034e90: 6178 6573 2829 2e69 6e64 6578 2869 5f61  axes().index(i_a
+00034ea0: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
+00034eb0: 2020 2069 6620 695f 736d 616c 6c20 3e20     if i_small > 
+00034ec0: 3020 616e 6420 695f 736d 616c 6c20 3c20  0 and i_small < 
+00034ed0: 7365 6c66 2e6d 6173 6b2e 6e5f 766f 7865  self.mask.n_voxe
+00034ee0: 6c73 5b69 5f61 785d 3a0a 2020 2020 2020  ls[i_ax]:.      
+00034ef0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00034f00: 6c66 2e6d 6173 6b2e 6461 7461 2e73 7761  lf.mask.data.swa
+00034f10: 7061 7865 7328 302c 2061 785f 746f 5f73  paxes(0, ax_to_s
+00034f20: 6c69 6365 295b 3a69 5f73 6d61 6c6c 2c20  lice)[:i_small, 
+00034f30: 3a2c 203a 5d20 3d20 300a 2020 2020 2020  :, :] = 0.      
+00034f40: 2020 2020 2020 2020 2020 6966 2069 5f62            if i_b
+00034f50: 6967 203e 2030 2061 6e64 2069 5f62 6967  ig > 0 and i_big
+00034f60: 203c 2073 656c 662e 6d61 736b 2e6e 5f76   < self.mask.n_v
+00034f70: 6f78 656c 735b 695f 6178 5d3a 0a20 2020  oxels[i_ax]:.   
+00034f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034f90: 2073 656c 662e 6d61 736b 2e64 6174 612e   self.mask.data.
+00034fa0: 7377 6170 6178 6573 2830 2c20 6178 5f74  swapaxes(0, ax_t
+00034fb0: 6f5f 736c 6963 6529 5b69 5f62 6967 3a2c  o_slice)[i_big:,
+00034fc0: 203a 2c20 3a5d 203d 2030 0a0a 2020 2020   :, :] = 0..    
+00034fd0: 2020 2020 2020 2020 2320 5265 7365 7420          # Reset 
+00034fe0: 6d61 736b 2e0a 2020 2020 2020 2020 2020  mask..          
+00034ff0: 2020 7365 6c66 2e72 6573 6574 5f6d 6173    self.reset_mas
+00035000: 6b28 7365 6c66 2e6d 6173 6b29 0a0a 2020  k(self.mask)..  
+00035010: 2020 6465 6620 6372 6f70 5f62 795f 616d    def crop_by_am
+00035020: 6f75 6e74 7328 7365 6c66 2c20 6478 3d4e  ounts(self, dx=N
+00035030: 6f6e 652c 2064 793d 4e6f 6e65 2c20 647a  one, dy=None, dz
+00035040: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00035050: 2222 220a 2020 2020 2020 2020 4372 6f70  """.        Crop
+00035060: 2052 4f49 2062 7920 7468 6520 616d 6f75   ROI by the amou
+00035070: 6e74 7320 6478 2c20 6479 2c20 647a 2069  nts dx, dy, dz i
+00035080: 6e20 6d6d 2e0a 0a20 2020 2020 2020 2054  n mm...        T
+00035090: 6869 7320 6d65 7468 6f64 2063 616c 6c73  his method calls
+000350a0: 2074 6865 2066 756e 6374 696f 6e20 736b   the function sk
+000350b0: 7274 2e69 6d61 6765 2e63 726f 705f 6279  rt.image.crop_by
+000350c0: 5f61 6d6f 756e 7473 2829 2c20 7769 7468  _amounts(), with
+000350d0: 0a20 2020 2020 2020 2073 656c 6620 7061  .        self pa
+000350e0: 7373 6564 2061 7320 6f62 6a65 6374 2066  ssed as object f
+000350f0: 6f72 2063 726f 7070 696e 672e 0a0a 2020  or cropping...  
+00035100: 2020 2020 2020 5468 6520 616d 6f75 6e74        The amount
+00035110: 206f 6620 6372 6f70 7069 6e67 2061 6c6f   of cropping alo
+00035120: 6e67 2065 6163 6820 6469 7265 6374 696f  ng each directio
+00035130: 6e20 7368 6f75 6c64 2062 6520 6f6e 6520  n should be one 
+00035140: 6f66 3a0a 2020 2020 2020 2020 2d20 666c  of:.        - fl
+00035150: 6f61 7420 3a20 7468 6520 524f 4920 6973  oat : the ROI is
+00035160: 2063 726f 7070 6564 2062 7920 7468 6973   cropped by this
+00035170: 2061 6d6f 756e 7420 6f6e 2062 6f74 6820   amount on both 
+00035180: 7369 6465 733b 0a20 2020 2020 2020 202d  sides;.        -
+00035190: 2074 776f 2d65 6c65 6d65 6e74 2074 7570   two-element tup
+000351a0: 6c65 3a20 7468 6520 524f 4920 6973 2063  le: the ROI is c
+000351b0: 726f 7070 6564 206f 6e20 7468 6520 7369  ropped on the si
+000351c0: 6465 7320 6f66 206c 6f77 6572 0a20 2020  des of lower.   
+000351d0: 2020 2020 2020 2061 6e64 2068 6967 6865         and highe
+000351e0: 7220 7661 6c75 6573 2062 7920 7468 6520  r values by the 
+000351f0: 616d 6f75 6e74 7320 7370 6563 6966 6965  amounts specifie
+00035200: 643b 0a20 2020 2020 2020 202d 204e 6f6e  d;.        - Non
+00035210: 6520 3a20 6e6f 2063 726f 7070 696e 6720  e : no cropping 
+00035220: 6973 2070 6572 666f 726d 6564 2e0a 0a20  is performed... 
+00035230: 2020 2020 2020 2046 6f72 206d 6f72 6520         For more 
+00035240: 6465 7461 696c 732c 2073 6565 2064 6f63  details, see doc
+00035250: 756d 656e 7461 7469 6f6e 206f 6620 736b  umentation of sk
+00035260: 7274 2e69 6d61 6765 2e63 726f 705f 6279  rt.image.crop_by
+00035270: 5f61 6d6f 756e 7473 2829 2e0a 2020 2020  _amounts()..    
+00035280: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00035290: 736b 7274 2e69 6d61 6765 2e63 726f 705f  skrt.image.crop_
+000352a0: 6279 5f61 6d6f 756e 7473 2873 656c 662c  by_amounts(self,
+000352b0: 2064 782c 2064 792c 2064 7a29 0a0a 2020   dx, dy, dz)..  
+000352c0: 2020 6465 6620 6372 6f70 5f74 6f5f 726f    def crop_to_ro
+000352d0: 695f 6c65 6e67 7468 2873 656c 662c 206f  i_length(self, o
+000352e0: 7468 6572 2c20 6178 3d22 7a22 293a 0a20  ther, ax="z"):. 
+000352f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00035300: 2020 2043 726f 7020 746f 206c 656e 6774     Crop to lengt
+00035310: 6820 6f66 206f 7468 6572 2052 4f49 2061  h of other ROI a
+00035320: 6c6f 6e67 2061 2067 6976 656e 2061 7869  long a given axi
+00035330: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
+00035340: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
+00035350: 2020 2020 6f74 6865 7220 3a20 736b 7274      other : skrt
+00035360: 2e73 7472 7563 7475 7265 732e 524f 490a  .structures.ROI.
+00035370: 2020 2020 2020 2020 2020 2020 524f 4920              ROI 
+00035380: 6f62 6a65 6374 2074 6f20 7768 6963 6820  object to which 
+00035390: 746f 2063 726f 702e 0a20 2020 2020 2020  to crop..       
+000353a0: 2020 2020 0a20 2020 2020 2020 2061 7820      .        ax 
+000353b0: 3a20 7374 722f 696e 742c 2064 6566 6175  : str/int, defau
+000353c0: 6c74 3d22 7a22 0a20 2020 2020 2020 2020  lt="z".         
+000353d0: 2020 2041 7869 7320 616c 6f6e 6720 7768     Axis along wh
+000353e0: 6963 6820 746f 2070 6572 666f 726d 2063  ich to perform c
+000353f0: 726f 7070 696e 672e 2053 686f 756c 6420  ropping. Should 
+00035400: 6265 206f 6e65 206f 660a 2020 2020 2020  be one of.      
+00035410: 2020 2020 2020 5b22 7822 2c20 2279 222c        ["x", "y",
+00035420: 2022 7a22 5d20 6f72 205b 302c 2031 2c20   "z"] or [0, 1, 
+00035430: 325d 2e0a 2020 2020 2020 2020 2222 220a  2]..        """.
+00035440: 2020 2020 2020 2020 2320 4465 7465 726d          # Determ
+00035450: 696e 6520 6372 6f70 2072 616e 6765 2e0a  ine crop range..
+00035460: 2020 2020 2020 2020 6c69 6d73 203d 2033          lims = 3
+00035470: 202a 205b 4e6f 6e65 5d0a 2020 2020 2020   * [None].      
+00035480: 2020 695f 6178 203d 2073 6b72 742e 696d    i_ax = skrt.im
+00035490: 6167 652e 5f61 7865 732e 696e 6465 7828  age._axes.index(
+000354a0: 6178 2920 6966 2069 7369 6e73 7461 6e63  ax) if isinstanc
+000354b0: 6528 6178 2c20 7374 7229 2065 6c73 6520  e(ax, str) else 
+000354c0: 6178 0a20 2020 2020 2020 206c 696d 735b  ax.        lims[
+000354d0: 695f 6178 5d20 3d20 6f74 6865 722e 6765  i_ax] = other.ge
+000354e0: 745f 6578 7465 6e74 2861 783d 6178 290a  t_extent(ax=ax).
+000354f0: 0a20 2020 2020 2020 2023 2050 6572 666f  .        # Perfo
+00035500: 726d 2063 726f 7070 696e 672e 0a20 2020  rm cropping..   
+00035510: 2020 2020 2073 656c 662e 6372 6f70 282a       self.crop(*
+00035520: 6c69 6d73 290a 0a20 2020 2064 6566 2063  lims)..    def c
+00035530: 726f 705f 746f 5f72 6f69 2873 656c 662c  rop_to_roi(self,
+00035540: 2072 6f69 2c20 2a2a 6b77 6172 6773 293a   roi, **kwargs):
+00035550: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00035560: 2020 2020 2043 726f 7020 524f 4920 6d61       Crop ROI ma
+00035570: 736b 2074 6f20 7265 6769 6f6e 2063 6f76  sk to region cov
+00035580: 6572 6564 2062 7920 616e 2052 4f49 2e0a  ered by an ROI..
+00035590: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000355a0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+000355b0: 6d61 736b 2829 0a20 2020 2020 2020 2073  mask().        s
+000355c0: 656c 662e 6d61 736b 2e63 726f 705f 746f  elf.mask.crop_to
+000355d0: 5f72 6f69 2872 6f69 2c20 2a2a 6b77 6172  _roi(roi, **kwar
+000355e0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
+000355f0: 2e73 6861 7065 203d 2073 656c 662e 6765  .shape = self.ge
+00035600: 745f 6d61 736b 2829 2e73 6861 7065 0a0a  t_mask().shape..
+00035610: 2020 2020 6465 6620 6164 645f 706c 616e      def add_plan
+00035620: 2873 656c 662c 2070 6c61 6e29 3a0a 2020  (self, plan):.  
+00035630: 2020 2020 2020 2222 2241 6464 2061 2050        """Add a P
+00035640: 6c61 6e20 6f62 6a65 6374 2074 6f20 6265  lan object to be
+00035650: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+00035660: 2074 6869 7320 524f 492e 2054 6869 730a   this ROI. This.
+00035670: 2020 2020 2020 2020 646f 6573 206e 6f74          does not
+00035680: 2061 6666 6563 7420 7468 6520 7374 7275   affect the stru
+00035690: 6374 7572 6520 7365 7420 6173 736f 6369  cture set associ
+000356a0: 6174 6564 2077 6974 6820 7468 6520 506c  ated with the Pl
+000356b0: 616e 206f 626a 6563 742e 0a0a 2020 2020  an object...    
+000356c0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+000356d0: 3a2a 2a0a 0a20 2020 2020 2020 2070 6c61  :**..        pla
+000356e0: 6e20 3a20 736b 7274 2e64 6f73 652e 506c  n : skrt.dose.Pl
+000356f0: 616e 0a20 2020 2020 2020 2020 2020 2041  an.            A
+00035700: 2050 6c61 6e20 6f62 6a65 6374 2074 6f20   Plan object to 
+00035710: 6173 7369 676e 2074 6f20 7468 6973 2073  assign to this s
+00035720: 7472 7563 7475 7265 2073 6574 2e0a 2020  tructure set..  
+00035730: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00035740: 2020 2069 6620 6e6f 7420 706c 616e 2069     if not plan i
+00035750: 6e20 7365 6c66 2e70 6c61 6e73 3a0a 2020  n self.plans:.  
+00035760: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00035770: 6c61 6e73 2e61 7070 656e 6428 706c 616e  lans.append(plan
+00035780: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00035790: 6c66 2e70 6c61 6e73 2e73 6f72 7428 290a  lf.plans.sort().
+000357a0: 0a20 2020 2064 6566 2063 6c65 6172 5f70  .    def clear_p
+000357b0: 6c61 6e73 2873 656c 6629 3a0a 2020 2020  lans(self):.    
+000357c0: 2020 2020 2222 2243 6c65 6172 2061 6c6c      """Clear all
+000357d0: 2070 6c61 6e20 6d61 7073 2061 7373 6f63   plan maps assoc
+000357e0: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
+000357f0: 524f 492e 2222 220a 0a20 2020 2020 2020  ROI."""..       
+00035800: 2073 656c 662e 706c 616e 7320 3d20 5b5d   self.plans = []
+00035810: 0a0a 2020 2020 6465 6620 6765 745f 706c  ..    def get_pl
+00035820: 616e 7328 7365 6c66 293a 0a20 2020 2020  ans(self):.     
+00035830: 2020 2022 2222 5265 7475 726e 206c 6973     """Return lis
+00035840: 7420 6f66 2050 6c61 6e20 6f62 6a65 6374  t of Plan object
+00035850: 7320 6173 736f 6369 6174 6564 2077 6974  s associated wit
+00035860: 6820 7468 6973 2052 4f49 2e22 2222 0a0a  h this ROI."""..
+00035870: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00035880: 656c 662e 706c 616e 730a 0a20 2020 2064  elf.plans..    d
+00035890: 6566 2067 6574 5f63 6f6c 6f72 5f66 726f  ef get_color_fro
+000358a0: 6d5f 6b77 6172 6773 2873 656c 662c 206b  m_kwargs(self, k
+000358b0: 7761 7267 733d 7b7d 2c20 6b65 793d 2772  wargs={}, key='r
+000358c0: 6f69 5f63 6f6c 6f72 7327 293a 0a20 2020  oi_colors'):.   
+000358d0: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
+000358e0: 2052 6574 7572 6e20 524f 4920 636f 6c6f   Return ROI colo
+000358f0: 7572 2070 6173 7365 6420 7669 6120 6469  ur passed via di
+00035900: 6374 696f 6e61 7279 206f 6620 6b65 7977  ctionary of keyw
+00035910: 6f72 6420 6172 6775 6d65 6e74 732e 0a0a  ord arguments...
+00035920: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+00035930: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+00035940: 206b 7761 7267 7320 3a20 6469 6374 2c20   kwargs : dict, 
+00035950: 6465 6661 756c 743d 7b7d 0a20 2020 2020  default={}.     
+00035960: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
+00035970: 7920 6f66 206b 6579 776f 7264 2061 7267  y of keyword arg
+00035980: 756d 656e 7473 2c20 7768 6963 6820 6d61  uments, which ma
+00035990: 7920 696e 636c 7564 650a 2020 2020 2020  y include.      
+000359a0: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
+000359b0: 7072 6f76 6964 696e 6720 6469 6374 696f  providing dictio
+000359c0: 6e61 7279 206f 6620 524f 4920 636f 6c6f  nary of ROI colo
+000359d0: 7572 7320 666f 7220 706c 6f74 7469 6e67  urs for plotting
+000359e0: 2e0a 0a20 2020 2020 2020 206b 6579 203a  ...        key :
+000359f0: 2073 7472 2c20 6465 6661 756c 743d 2772   str, default='r
+00035a00: 6f69 5f63 6f6c 6f72 7327 0a20 2020 2020  oi_colors'.     
+00035a10: 2020 2020 2020 204b 6579 2069 6e20 6b77         Key in kw
+00035a20: 6172 6773 2064 6963 7469 6f6e 6172 7920  args dictionary 
+00035a30: 7370 6563 6966 7969 6e67 2070 6172 616d  specifying param
+00035a40: 6574 6572 2074 6861 742c 2069 660a 2020  eter that, if.  
+00035a50: 2020 2020 2020 2020 2020 7072 6573 656e            presen
+00035a60: 742c 2070 726f 7669 6465 7320 6469 6374  t, provides dict
+00035a70: 696f 6e61 7279 206f 6620 524f 4920 636f  ionary of ROI co
+00035a80: 6c6f 7572 732e 0a20 2020 2020 2020 2027  lours..        '
+00035a90: 2727 0a20 2020 2020 2020 2072 6f69 5f63  ''.        roi_c
+00035aa0: 6f6c 6f72 7320 3d20 6b77 6172 6773 2e67  olors = kwargs.g
+00035ab0: 6574 286b 6579 2c20 7b7d 290a 2020 2020  et(key, {}).    
+00035ac0: 2020 2020 7265 7475 726e 2072 6f69 5f63      return roi_c
+00035ad0: 6f6c 6f72 732e 6765 7428 7365 6c66 2e6e  olors.get(self.n
+00035ae0: 616d 652c 2073 656c 662e 636f 6c6f 7229  ame, self.color)
+00035af0: 0a0a 2020 2020 6465 6620 7370 6c69 7428  ..    def split(
+00035b00: 7365 6c66 2c20 766f 7865 6c5f 7369 7a65  self, voxel_size
+00035b10: 3d4e 6f6e 652c 206e 616d 6573 3d4e 6f6e  =None, names=Non
+00035b20: 652c 206f 7264 6572 3d27 782b 2729 3a0a  e, order='x+'):.
+00035b30: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
+00035b40: 2020 2020 5370 6c69 7420 6120 636f 6d70      Split a comp
+00035b50: 6f73 6974 6520 524f 4920 696e 746f 2069  osite ROI into i
+00035b60: 7473 2063 6f6d 706f 6e65 6e74 732e 0a0a  ts components...
+00035b70: 2020 2020 2020 2020 4120 636f 6d70 6f73          A compos
+00035b80: 6974 6520 524f 4920 6d61 7920 7265 7375  ite ROI may resu
+00035b90: 6c74 2062 6563 6175 7365 2070 6879 6963  lt because phyic
+00035ba0: 616c 6c79 2073 6570 6172 6174 6520 524f  ally separate RO
+00035bb0: 4973 2061 7265 0a20 2020 2020 2020 2067  Is are.        g
+00035bc0: 6976 656e 2074 6865 2073 616d 6520 6c61  iven the same la
+00035bd0: 6265 6c20 6475 7269 6e67 206d 616e 7561  bel during manua
+00035be0: 6c20 636f 6e74 6f75 7269 6e67 2c20 6f72  l contouring, or
+00035bf0: 2062 6563 6175 7365 0a20 2020 2020 2020   because.       
+00035c00: 206d 756c 7469 706c 6520 524f 4973 2061   multiple ROIs a
+00035c10: 7265 2072 6574 7572 6e65 6420 6279 2061  re returned by a
+00035c20: 6e20 6175 746f 2d73 6567 6d65 6e74 6174  n auto-segmentat
+00035c30: 696f 6e20 616c 676f 7269 7468 6d2e 0a0a  ion algorithm...
+00035c40: 2020 2020 2020 2020 5468 6520 636f 6d70          The comp
+00035c50: 6f6e 656e 7420 524f 4973 2061 7265 2069  onent ROIs are i
+00035c60: 6465 6e74 6966 6965 6420 6279 206c 6162  dentified by lab
+00035c70: 656c 6c69 6e67 2061 206d 6173 6b20 6f66  elling a mask of
+00035c80: 2074 6865 0a20 2020 2020 2020 2063 6f6d   the.        com
+00035c90: 706f 7369 7465 2c20 7573 696e 6720 7363  posite, using sc
+00035ca0: 6970 792e 6e64 696d 6167 652e 6c61 6265  ipy.ndimage.labe
+00035cb0: 6c28 292e 0a0a 2020 2020 2020 2020 2a2a  l()...        **
+00035cc0: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
+00035cd0: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
+00035ce0: 6520 3a20 7475 706c 652c 2064 6566 6175  e : tuple, defau
+00035cf0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00035d00: 2020 2020 566f 7865 6c20 7369 7a65 2028      Voxel size (
+00035d10: 782c 2079 2920 6469 6d65 6e73 696f 6e73  x, y) dimensions
+00035d20: 2074 6f20 7573 6520 696e 2063 7265 6174   to use in creat
+00035d30: 696e 6720 6d61 736b 2066 6f72 0a20 2020  ing mask for.   
+00035d40: 2020 2020 2020 2020 206c 6162 656c 6c69           labelli
+00035d50: 6e67 2e20 2054 6869 7320 6361 6e20 6265  ng.  This can be
+00035d60: 2075 7365 6675 6c20 6966 2074 6865 2052   useful if the R
+00035d70: 4f49 2073 6f75 7263 6520 6973 2063 6f6e  OI source is con
+00035d80: 746f 7572 0a20 2020 2020 2020 2020 2020  tour.           
+00035d90: 2070 6f69 6e74 732c 2061 6e64 2074 6865   points, and the
+00035da0: 2072 6573 6f6c 7574 696f 6e20 7761 6e74   resolution want
+00035db0: 6564 2069 7320 6772 6561 7465 7220 7468  ed is greater th
+00035dc0: 616e 2069 7320 616c 6c6f 7765 640a 2020  an is allowed.  
+00035dd0: 2020 2020 2020 2020 2020 6279 2074 6865            by the
+00035de0: 2076 6f78 656c 2073 697a 6520 6f66 2074   voxel size of t
+00035df0: 6865 2052 4f49 2069 6d61 6765 2e0a 0a20  he ROI image... 
+00035e00: 2020 2020 2020 206e 616d 6573 3a20 6c69         names: li
+00035e10: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+00035e20: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
+00035e30: 7420 6f66 206e 616d 6573 2074 6f20 6265  t of names to be
+00035e40: 2061 7070 6c69 6564 2074 6f20 7468 6520   applied to the 
+00035e50: 636f 6d70 6f6e 656e 7420 524f 4973 2e20  component ROIs. 
+00035e60: 204e 616d 6573 0a20 2020 2020 2020 2020   Names.         
+00035e70: 2020 2061 7265 2061 7070 6c69 6564 2061     are applied a
+00035e80: 6674 6572 2061 6e79 2052 4f49 206f 7264  fter any ROI ord
+00035e90: 6572 696e 672e 0a0a 2020 2020 2020 2020  ering...        
+00035ea0: 6f72 6465 7220 3a20 7374 722c 2064 6566  order : str, def
+00035eb0: 6175 6c74 3d27 782b 270a 2020 2020 2020  ault='x+'.      
+00035ec0: 2020 2020 2020 5370 6563 6966 6963 6174        Specificat
+00035ed0: 696f 6e20 6f66 2077 6179 2069 7420 7768  ion of way it wh
+00035ee0: 6963 6820 524f 4973 2061 7265 2074 6f20  ich ROIs are to 
+00035ef0: 6265 206f 7264 6572 643a 0a20 2020 2020  be orderd:.     
+00035f00: 2020 2020 2020 202d 2027 782b 2720 3a20         - 'x+' : 
+00035f10: 696e 206f 7264 6572 206f 6620 696e 6372  in order of incr
+00035f20: 6561 7369 6e67 2078 2076 616c 7565 2e0a  easing x value..
+00035f30: 2020 2020 2020 2020 2020 2020 2d20 2778              - 'x
+00035f40: 2d27 203a 2069 6e20 6f72 6465 7220 6f66  -' : in order of
+00035f50: 2064 6563 7265 6173 696e 6720 7820 7661   decreasing x va
+00035f60: 6c75 652e 0a20 2020 2020 2020 2020 2020  lue..           
+00035f70: 202d 2027 792b 2720 3a20 696e 206f 7264   - 'y+' : in ord
+00035f80: 6572 206f 6620 696e 6372 6561 7369 6e67  er of increasing
+00035f90: 2079 2076 616c 7565 2e0a 2020 2020 2020   y value..      
+00035fa0: 2020 2020 2020 2d20 2779 2d27 203a 2069        - 'y-' : i
+00035fb0: 6e20 6f72 6465 7220 6f66 2064 6563 7265  n order of decre
+00035fc0: 6173 696e 6720 7920 7661 6c75 652e 0a20  asing y value.. 
+00035fd0: 2020 2020 2020 2020 2020 202d 2027 7a2b             - 'z+
+00035fe0: 2720 3a20 696e 206f 7264 6572 206f 6620  ' : in order of 
+00035ff0: 696e 6372 6561 7369 6e67 207a 2076 616c  increasing z val
+00036000: 7565 2e0a 2020 2020 2020 2020 2020 2020  ue..            
+00036010: 2d20 277a 2d27 203a 2069 6e20 6f72 6465  - 'z-' : in orde
+00036020: 7220 6f66 2064 6563 7265 6173 696e 6720  r of decreasing 
+00036030: 7a20 7661 6c75 652e 0a20 2020 2020 2020  z value..       
+00036040: 2020 2020 2049 6620 616e 7920 6f74 6865       If any othe
+00036050: 7220 7661 6c75 6573 2069 7320 6769 7665  r values is give
+00036060: 6e2c 206e 6f20 6f72 6465 7269 6e67 2069  n, no ordering i
+00036070: 7320 7065 7266 6f72 6d65 642e 0a20 2020  s performed..   
+00036080: 2020 2020 2027 2727 0a0a 2020 2020 2020       '''..      
+00036090: 2020 2320 4966 206e 616d 6573 206e 6f74    # If names not
+000360a0: 2073 7065 6369 6669 6564 2c20 6d61 6b65   specified, make
+000360b0: 2069 7420 616e 2065 6d70 7479 206c 6973   it an empty lis
+000360c0: 742e 0a20 2020 2020 2020 2069 6620 6e61  t..        if na
+000360d0: 6d65 7320 6973 204e 6f6e 653a 0a20 2020  mes is None:.   
+000360e0: 2020 2020 2020 2020 206e 616d 6573 203d           names =
+000360f0: 205b 5d0a 0a20 2020 2020 2020 2023 2052   []..        # R
+00036100: 6573 697a 6520 524f 4920 6d61 736b 2069  esize ROI mask i
+00036110: 6620 766f 7865 6c20 7369 7a65 2069 7320  f voxel size is 
+00036120: 746f 2062 6520 6368 616e 6765 642e 0a20  to be changed.. 
+00036130: 2020 2020 2020 2069 6620 766f 7865 6c5f         if voxel_
+00036140: 7369 7a65 3a0a 2020 2020 2020 2020 2020  size:.          
+00036150: 2020 726f 6920 3d20 524f 4928 7365 6c66    roi = ROI(self
+00036160: 290a 2020 2020 2020 2020 2020 2020 766f  ).            vo
+00036170: 7865 6c5f 7369 7a65 5f33 6420 3d20 2876  xel_size_3d = (v
+00036180: 6f78 656c 5f73 697a 655b 305d 2c20 766f  oxel_size[0], vo
+00036190: 7865 6c5f 7369 7a65 5b31 5d2c 204e 6f6e  xel_size[1], Non
+000361a0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+000361b0: 6f69 2e63 7265 6174 655f 6d61 736b 2829  oi.create_mask()
+000361c0: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+000361d0: 2e6d 6173 6b2e 7265 7369 7a65 2876 6f78  .mask.resize(vox
+000361e0: 656c 5f73 697a 653d 766f 7865 6c5f 7369  el_size=voxel_si
+000361f0: 7a65 5f33 642c 206d 6574 686f 643d 276e  ze_3d, method='n
+00036200: 6561 7265 7374 272c 0a20 2020 2020 2020  earest',.       
+00036210: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+00036220: 6765 5f73 697a 655f 756e 6974 3d27 6d6d  ge_size_unit='mm
+00036230: 2729 0a20 2020 2020 2020 2020 2020 2072  ').            r
+00036240: 6f69 2e73 6574 5f69 6d61 6765 2873 6b72  oi.set_image(skr
+00036250: 742e 696d 6167 652e 496d 6167 6528 726f  t.image.Image(ro
+00036260: 692e 6d61 736b 2929 0a20 2020 2020 2020  i.mask)).       
+00036270: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00036280: 2020 2072 6f69 203d 2073 656c 660a 200a     roi = self. .
+00036290: 2020 2020 2020 2020 2320 4c61 6265 6c20          # Label 
+000362a0: 524f 4920 636f 6d70 6f6e 656e 7473 2e0a  ROI components..
+000362b0: 2020 2020 2020 2020 6c61 6265 6c5f 6d61          label_ma
+000362c0: 736b 2c20 6e5f 6c61 6265 6c20 3d20 6e64  sk, n_label = nd
+000362d0: 696d 6167 652e 6c61 6265 6c28 726f 692e  image.label(roi.
+000362e0: 6765 745f 6d61 736b 2829 290a 0a20 2020  get_mask())..   
+000362f0: 2020 2020 2069 6620 766f 7865 6c5f 7369       if voxel_si
+00036300: 7a65 2061 6e64 2027 636f 6e74 6f75 7227  ze and 'contour'
+00036310: 203d 3d20 7365 6c66 2e73 6f75 7263 655f   == self.source_
+00036320: 7479 7065 3a0a 2020 2020 2020 2020 2020  type:.          
+00036330: 2020 2320 4861 6e64 6c65 2063 6173 6573    # Handle cases
+00036340: 2077 6865 7265 2063 6f6d 706f 7369 7465   where composite
+00036350: 2052 4f49 2069 7320 6672 6f6d 2063 6f6e   ROI is from con
+00036360: 746f 7572 2070 6f69 6e74 732c 0a20 2020  tour points,.   
+00036370: 2020 2020 2020 2020 2023 2061 6e64 206d           # and m
+00036380: 6173 6b20 766f 7865 6c20 7369 7a65 2068  ask voxel size h
+00036390: 6173 2062 6565 6e20 7061 7373 6564 2061  as been passed a
+000363a0: 7320 616e 2061 7267 756d 656e 742e 0a20  s an argument.. 
+000363b0: 2020 2020 2020 2020 2020 2023 2049 6e20             # In 
+000363c0: 7468 6973 2063 6173 6520 636f 6d70 6f6e  this case compon
+000363d0: 656e 7420 524f 4973 2061 7265 2069 6e69  ent ROIs are ini
+000363e0: 7469 616c 6973 6564 2066 726f 6d20 636f  tialised from co
+000363f0: 6e74 6f75 7273 0a20 2020 2020 2020 2020  ntours.         
+00036400: 2020 2023 2072 6563 7265 6174 6564 2066     # recreated f
+00036410: 726f 6d20 7468 6520 6d61 736b 2c20 7768  rom the mask, wh
+00036420: 6963 6820 6d61 7920 6265 2068 6967 6865  ich may be highe
+00036430: 722d 7265 736f 6c75 7469 6f6e 0a20 2020  r-resolution.   
+00036440: 2020 2020 2020 2020 2023 2074 6861 6e20           # than 
+00036450: 7468 6520 6465 6661 756c 742e 0a20 2020  the default..   
+00036460: 2020 2020 2020 2020 2073 7330 203d 2053           ss0 = S
+00036470: 7472 7563 7475 7265 5365 7428 6c61 6265  tructureSet(labe
+00036480: 6c5f 6d61 736b 2c20 6d75 6c74 695f 6c61  l_mask, multi_la
+00036490: 6265 6c3d 5472 7565 2c20 696d 6167 653d  bel=True, image=
+000364a0: 726f 692e 6d61 736b 290a 2020 2020 2020  roi.mask).      
+000364b0: 2020 2020 2020 7373 203d 2053 7472 7563        ss = Struc
+000364c0: 7475 7265 5365 7428 290a 2020 2020 2020  tureSet().      
+000364d0: 2020 2020 2020 666f 7220 726f 6920 696e        for roi in
+000364e0: 2073 7330 2e67 6574 5f72 6f69 7328 293a   ss0.get_rois():
+000364f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036500: 2073 732e 6164 645f 726f 6928 524f 4928   ss.add_roi(ROI(
+00036510: 736f 7572 6365 3d72 6f69 2e67 6574 5f63  source=roi.get_c
+00036520: 6f6e 746f 7572 7328 292c 206e 616d 653d  ontours(), name=
+00036530: 726f 692e 6e61 6d65 2929 0a20 2020 2020  roi.name)).     
+00036540: 2020 2020 2020 2073 732e 7365 745f 696d         ss.set_im
+00036550: 6167 6528 7365 6c66 2e69 6d61 6765 290a  age(self.image).
+00036560: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00036570: 2020 2020 2020 2020 2020 2320 4861 6e64            # Hand
+00036580: 6c65 2063 6173 6573 2077 6865 7265 2063  le cases where c
+00036590: 6f6d 706f 6e65 6e74 2052 4f49 7320 6172  omponent ROIs ar
+000365a0: 6520 696e 6974 6961 6c69 7365 6420 6672  e initialised fr
+000365b0: 6f6d 206d 6173 6b2e 0a20 2020 2020 2020  om mask..       
+000365c0: 2020 2020 2069 6620 766f 7865 6c5f 7369       if voxel_si
+000365d0: 7a65 3a0a 2020 2020 2020 2020 2020 2020  ze:.            
+000365e0: 2020 2020 2320 4966 2076 6f78 656c 2073      # If voxel s
+000365f0: 697a 6520 6368 616e 6765 6420 666f 7220  ize changed for 
+00036600: 6c61 6265 6c6c 696e 672c 0a20 2020 2020  labelling,.     
+00036610: 2020 2020 2020 2020 2020 2023 2072 6563             # rec
+00036620: 7265 6174 6520 6c61 6265 6c20 6d61 736b  reate label mask
+00036630: 2077 6974 6820 6f72 6967 696e 616c 2076   with original v
+00036640: 6f78 656c 2073 697a 652e 0a20 2020 2020  oxel size..     
+00036650: 2020 2020 2020 2020 2020 2072 6f69 2e6d             roi.m
+00036660: 6173 6b2e 6461 7461 203d 206c 6162 656c  ask.data = label
+00036670: 5f6d 6173 6b0a 2020 2020 2020 2020 2020  _mask.          
+00036680: 2020 2020 2020 726f 692e 6d61 736b 2e6d        roi.mask.m
+00036690: 6174 6368 5f73 697a 6528 7365 6c66 2e69  atch_size(self.i
+000366a0: 6d61 6765 2c20 6d65 7468 6f64 3d27 6e65  mage, method='ne
+000366b0: 6172 6573 7427 290a 2020 2020 2020 2020  arest').        
+000366c0: 2020 2020 2020 2020 6c61 6265 6c5f 6d61          label_ma
+000366d0: 736b 203d 2072 6f69 2e6d 6173 6b2e 6461  sk = roi.mask.da
+000366e0: 7461 0a0a 2020 2020 2020 2020 2020 2020  ta..            
+000366f0: 2320 4372 6561 7465 2073 7472 7563 7475  # Create structu
+00036700: 7265 2073 6574 2066 726f 6d20 6c61 6265  re set from labe
+00036710: 6c20 6d61 736b 2e0a 2020 2020 2020 2020  l mask..        
+00036720: 2020 2020 7373 203d 2053 7472 7563 7475      ss = Structu
+00036730: 7265 5365 7428 6c61 6265 6c5f 6d61 736b  reSet(label_mask
+00036740: 2c20 6d75 6c74 695f 6c61 6265 6c3d 5472  , multi_label=Tr
+00036750: 7565 2c20 696d 6167 653d 7365 6c66 2e69  ue, image=self.i
+00036760: 6d61 6765 290a 0a20 2020 2020 2020 2023  mage)..        #
+00036770: 2053 746f 7265 2052 4f49 7320 696e 2073   Store ROIs in s
+00036780: 7065 6369 6669 6564 206f 7264 6572 2e0a  pecified order..
+00036790: 2020 2020 2020 2020 7373 2e6f 7264 6572          ss.order
+000367a0: 5f72 6f69 7328 6f72 6465 7229 0a0a 2020  _rois(order)..  
+000367b0: 2020 2020 2020 2320 4170 706c 7920 6e61        # Apply na
+000367c0: 6d65 732e 0a20 2020 2020 2020 2066 6f72  mes..        for
+000367d0: 2069 2069 6e20 7261 6e67 6528 6d69 6e28   i in range(min(
+000367e0: 6c65 6e28 6e61 6d65 7329 2c20 6c65 6e28  len(names), len(
+000367f0: 7373 2e72 6f69 7329 2929 3a0a 2020 2020  ss.rois))):.    
+00036800: 2020 2020 2020 2020 7373 2e72 6f69 735b          ss.rois[
+00036810: 695d 2e6e 616d 6520 3d20 6e61 6d65 735b  i].name = names[
+00036820: 695d 0a0a 2020 2020 2020 2020 7265 7475  i]..        retu
+00036830: 726e 2073 730a 0a20 2020 2064 6566 2073  rn ss..    def s
+00036840: 706c 6974 5f69 6e5f 7477 6f28 7365 6c66  plit_in_two(self
+00036850: 2c20 6178 6973 3d27 7827 2c20 7630 3d30  , axis='x', v0=0
+00036860: 2c20 6e61 6d65 733d 4e6f 6e65 2c29 3a0a  , names=None,):.
+00036870: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
+00036880: 2020 2020 5370 6c69 7420 6120 636f 6d70      Split a comp
+00036890: 6f73 6974 6520 524f 4920 696e 746f 2074  osite ROI into t
+000368a0: 776f 2063 6f6d 706f 6e65 6e74 2070 6172  wo component par
+000368b0: 7473 2e0a 0a20 2020 2020 2020 2053 706c  ts...        Spl
+000368c0: 6974 2061 6e20 524f 4920 696e 746f 2074  it an ROI into t
+000368d0: 776f 2063 6f6d 706f 6e65 6e74 732c 2065  wo components, e
+000368e0: 6974 6865 7220 7369 6465 206f 6620 6120  ither side of a 
+000368f0: 7370 6563 6966 6965 640a 2020 2020 2020  specified.      
+00036900: 2020 706c 616e 652e 2020 5468 6973 206d    plane.  This m
+00036910: 6179 2062 6520 7573 6566 756c 2c20 666f  ay be useful, fo
+00036920: 7220 6578 616d 706c 652c 2077 6865 6e20  r example, when 
+00036930: 6c65 6674 2061 6e64 2072 6967 6874 0a20  left and right. 
+00036940: 2020 2020 2020 2052 4f49 7320 6861 7665         ROIs have
+00036950: 2062 6565 6e20 6173 7369 676e 6564 2061   been assigned a
+00036960: 2063 6f6d 6d6f 6e20 6c61 6265 6c2e 0a0a   common label...
+00036970: 2020 2020 2020 2020 466f 7220 6d6f 7265          For more
+00036980: 2067 656e 6572 616c 2052 4f49 2073 706c   general ROI spl
+00036990: 6974 7469 6e67 2c20 7365 6520 736b 7274  itting, see skrt
+000369a0: 2e73 7472 7563 7475 7265 2e52 4f49 2e73  .structure.ROI.s
+000369b0: 706c 6974 2829 2e0a 2020 2020 2020 2020  plit()..        
+000369c0: 4e6f 7465 2074 6861 7420 7370 6c69 7428  Note that split(
+000369d0: 2920 6163 7473 206f 6e20 6269 6e61 7279  ) acts on binary
+000369e0: 206d 6173 6b73 2c20 7768 6572 6561 7320   masks, whereas 
+000369f0: 7370 6c69 745f 696e 5f74 776f 2829 0a20  split_in_two(). 
+00036a00: 2020 2020 2020 2061 6374 7320 6f6e 2063         acts on c
+00036a10: 6f6e 746f 7572 732e 0a0a 2020 2020 2020  ontours...      
+00036a20: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
+00036a30: 2a0a 0a20 2020 2020 2020 2061 7869 7320  *..        axis 
+00036a40: 3a20 2773 7472 272c 2064 6566 6175 6c74  : 'str', default
+00036a50: 3d27 7827 0a20 2020 2020 2020 2020 2020  ='x'.           
+00036a60: 2041 7869 7320 2827 7827 2c20 2779 2720   Axis ('x', 'y' 
+00036a70: 6f72 2027 7a27 2920 7065 7270 656e 6469  or 'z') perpendi
+00036a80: 6375 6c61 7220 746f 2070 6c61 6e65 2061  cular to plane a
+00036a90: 626f 7574 2077 6869 6368 0a20 2020 2020  bout which.     
+00036aa0: 2020 2020 2020 2052 4f49 2069 7320 746f         ROI is to
+00036ab0: 2062 6520 7370 6c69 742e 0a0a 2020 2020   be split...    
+00036ac0: 2020 2020 7630 203a 2066 6c6f 6174 2c20      v0 : float, 
+00036ad0: 6465 6661 756c 743d 300a 2020 2020 2020  default=0.      
+00036ae0: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+00036af0: 2061 6c6f 6e67 2073 656c 6563 7465 6420   along selected 
+00036b00: 6178 6973 2c20 7370 6563 6966 7969 6e67  axis, specifying
+00036b10: 2070 6c61 6e65 2061 626f 7574 2077 6869   plane about whi
+00036b20: 6368 0a20 2020 2020 2020 2020 2020 2052  ch.            R
+00036b30: 4f49 2069 7320 746f 2062 6520 7370 6c69  OI is to be spli
+00036b40: 742e 0a0a 2020 2020 2020 2020 6e61 6d65  t...        name
+00036b50: 733a 206c 6973 742c 2064 6566 6175 6c74  s: list, default
+00036b60: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00036b70: 2020 4c69 7374 206f 6620 6e61 6d65 7320    List of names 
+00036b80: 746f 2062 6520 6170 706c 6965 6420 746f  to be applied to
+00036b90: 2074 6865 2063 6f6d 706f 6e65 6e74 2052   the component R
+00036ba0: 4f49 732e 0a20 2020 2020 2020 2027 2727  OIs..        '''
+00036bb0: 0a0a 2020 2020 2020 2020 2320 4966 206e  ..        # If n
+00036bc0: 616d 6573 206e 6f74 2073 7065 6369 6669  ames not specifi
+00036bd0: 6564 2c20 696e 6974 6961 6c69 7365 2074  ed, initialise t
+00036be0: 6f20 656d 7074 7920 6c69 7374 2e0a 2020  o empty list..  
+00036bf0: 2020 2020 2020 6966 206e 616d 6573 2069        if names i
+00036c00: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00036c10: 2020 2020 6e61 6d65 7320 3d20 5b5d 0a0a      names = []..
+00036c20: 2020 2020 2020 2020 2320 4261 7365 6420          # Based 
+00036c30: 6f6e 2073 656c 6563 7465 6420 6178 6973  on selected axis
+00036c40: 2c20 6465 6669 6e65 2076 6965 7720 616e  , define view an
+00036c50: 6420 6465 6661 756c 7420 6e61 6d65 2073  d default name s
+00036c60: 7566 6669 7865 732e 0a20 2020 2020 2020  uffixes..       
+00036c70: 2069 6620 2778 2720 3d3d 2061 7869 732e   if 'x' == axis.
+00036c80: 6c6f 7765 7228 293a 0a20 2020 2020 2020  lower():.       
+00036c90: 2020 2020 2076 6965 7720 3d20 2778 2d79       view = 'x-y
+00036ca0: 270a 2020 2020 2020 2020 2020 2020 7375  '.            su
+00036cb0: 6666 6978 6573 203d 2028 2772 6967 6874  ffixes = ('right
+00036cc0: 272c 2027 6c65 6674 2729 0a20 2020 2020  ', 'left').     
+00036cd0: 2020 2065 6c69 6620 2779 2720 3d3d 2061     elif 'y' == a
+00036ce0: 7869 732e 6c6f 7765 7228 293a 0a20 2020  xis.lower():.   
+00036cf0: 2020 2020 2020 2020 2076 6965 7720 3d20           view = 
+00036d00: 2778 2d79 270a 2020 2020 2020 2020 2020  'x-y'.          
+00036d10: 2020 7375 6666 6978 6573 203d 2028 2761    suffixes = ('a
+00036d20: 6e74 6572 696f 7227 2c20 2770 6f73 7465  nterior', 'poste
+00036d30: 7269 6f72 2729 0a20 2020 2020 2020 2065  rior').        e
+00036d40: 6c69 6620 277a 2720 3d3d 2061 7869 732e  lif 'z' == axis.
+00036d50: 6c6f 7765 7228 293a 0a20 2020 2020 2020  lower():.       
+00036d60: 2020 2020 2076 6965 7720 3d20 277a 2d79       view = 'z-y
+00036d70: 270a 2020 2020 2020 2020 2020 2020 7375  '.            su
+00036d80: 6666 6978 6573 203d 2028 2769 6e66 6572  ffixes = ('infer
+00036d90: 696f 7227 2c20 2773 7570 6572 696f 7227  ior', 'superior'
+00036da0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00036db0: 496e 2074 6865 2027 7a2d 7927 2076 6965  In the 'z-y' vie
+00036dc0: 772c 2079 2061 6e64 207a 2061 7865 7320  w, y and z axes 
+00036dd0: 6d61 7020 746f 2073 6861 7065 6c79 2078  map to shapely x
+00036de0: 2061 6e64 2079 2061 7865 732e 0a20 2020   and y axes..   
+00036df0: 2020 2020 2020 2020 2061 7869 7320 3d20           axis = 
+00036e00: 2779 270a 0a20 2020 2020 2020 2023 2044  'y'..        # D
+00036e10: 6566 696e 6520 706f 6c79 676f 6e20 7265  efine polygon re
+00036e20: 7072 6573 656e 7469 6e67 2052 4f49 2063  presenting ROI c
+00036e30: 6f6e 746f 7572 2061 7320 6c6f 7720 6f72  ontour as low or
+00036e40: 2068 6967 682c 0a20 2020 2020 2020 2023   high,.        #
+00036e50: 2064 6570 656e 6469 6e67 206f 6e20 7768   depending on wh
+00036e60: 6574 6865 7220 7468 6520 706f 6c79 676f  ether the polygo
+00036e70: 6e20 6365 6e74 726f 6964 2069 7320 6c6f  n centroid is lo
+00036e80: 7765 7220 6f72 2068 6967 6865 720a 2020  wer or higher.  
+00036e90: 2020 2020 2020 2320 7468 616e 2074 6865        # than the
+00036ea0: 2063 6f6f 7264 696e 6174 6520 6f66 2074   coordinate of t
+00036eb0: 6865 2073 706c 6974 7469 6e67 2070 6c61  he splitting pla
+00036ec0: 6e65 2e0a 2020 2020 2020 2020 706f 6c79  ne..        poly
+00036ed0: 676f 6e73 5f6c 6f77 203d 207b 7d0a 2020  gons_low = {}.  
+00036ee0: 2020 2020 2020 706f 6c79 676f 6e73 5f68        polygons_h
+00036ef0: 6967 6820 3d20 7b7d 0a20 2020 2020 2020  igh = {}.       
+00036f00: 2066 6f72 207a 2c20 706f 6c79 676f 6e73   for z, polygons
+00036f10: 2069 6e20 7365 6c66 2e67 6574 5f70 6f6c   in self.get_pol
+00036f20: 7967 6f6e 7328 7669 6577 292e 6974 656d  ygons(view).item
+00036f30: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00036f40: 2066 6f72 2070 6f6c 7967 6f6e 2069 6e20   for polygon in 
+00036f50: 706f 6c79 676f 6e73 3a0a 2020 2020 2020  polygons:.      
+00036f60: 2020 2020 2020 2020 2020 7620 3d20 6765            v = ge
+00036f70: 7461 7474 7228 706f 6c79 676f 6e2e 6365  tattr(polygon.ce
+00036f80: 6e74 726f 6964 2c20 6178 6973 290a 2020  ntroid, axis).  
+00036f90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00036fa0: 2076 203c 2076 303a 0a20 2020 2020 2020   v < v0:.       
+00036fb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00036fc0: 6e6f 7420 7a20 696e 2070 6f6c 7967 6f6e  not z in polygon
+00036fd0: 735f 6c6f 773a 0a20 2020 2020 2020 2020  s_low:.         
+00036fe0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00036ff0: 6f6c 7967 6f6e 735f 6c6f 775b 7a5d 203d  olygons_low[z] =
+00037000: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00037010: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00037020: 5f6c 6f77 5b7a 5d2e 6170 7065 6e64 2870  _low[z].append(p
+00037030: 6f6c 7967 6f6e 290a 2020 2020 2020 2020  olygon).        
+00037040: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00037050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037060: 2020 6966 206e 6f74 207a 2069 6e20 706f    if not z in po
+00037070: 6c79 676f 6e73 5f68 6967 683a 0a20 2020  lygons_high:.   
+00037080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037090: 2020 2020 2070 6f6c 7967 6f6e 735f 6869       polygons_hi
+000370a0: 6768 5b7a 5d20 3d20 5b5d 0a20 2020 2020  gh[z] = [].     
+000370b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000370c0: 6f6c 7967 6f6e 735f 6869 6768 5b7a 5d2e  olygons_high[z].
+000370d0: 6170 7065 6e64 2870 6f6c 7967 6f6e 290a  append(polygon).
+000370e0: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
+000370f0: 7465 2052 4f49 2066 726f 6d20 706f 6c79  te ROI from poly
+00037100: 676f 6e73 2062 656c 6f77 2074 6865 2073  gons below the s
+00037110: 706c 6974 7469 6e67 2070 6c61 6e65 2e0a  plitting plane..
+00037120: 2020 2020 2020 2020 6966 2070 6f6c 7967          if polyg
+00037130: 6f6e 735f 6c6f 773a 0a20 2020 2020 2020  ons_low:.       
+00037140: 2020 2020 2072 6f69 5f6c 6f77 203d 2052       roi_low = R
+00037150: 4f49 2873 6f75 7263 653d 706f 6c79 676f  OI(source=polygo
+00037160: 6e73 5f6c 6f77 2c20 696d 6167 653d 7365  ns_low, image=se
+00037170: 6c66 2e69 6d61 6765 290a 2020 2020 2020  lf.image).      
+00037180: 2020 2020 2020 726f 695f 6c6f 772e 6e61        roi_low.na
+00037190: 6d65 203d 2028 6e61 6d65 735b 305d 2069  me = (names[0] i
+000371a0: 6620 6c65 6e28 6e61 6d65 7329 203e 2030  f len(names) > 0
+000371b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000371c0: 2020 2020 2065 6c73 6520 6627 7b73 656c       else f'{sel
+000371d0: 662e 6e61 6d65 7d5f 7b73 7566 6669 7865  f.name}_{suffixe
+000371e0: 735b 305d 7d27 290a 2020 2020 2020 2020  s[0]}').        
+000371f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00037200: 2020 726f 695f 6c6f 7720 3d20 4e6f 6e65    roi_low = None
+00037210: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
+00037220: 7465 2052 4f49 2066 726f 6d20 706f 6c79  te ROI from poly
+00037230: 676f 6e73 2061 626f 7665 2074 6865 2073  gons above the s
+00037240: 706c 6974 7469 6e67 2070 6c61 6e65 2e0a  plitting plane..
+00037250: 2020 2020 2020 2020 6966 2070 6f6c 7967          if polyg
+00037260: 6f6e 735f 6869 6768 3a0a 2020 2020 2020  ons_high:.      
+00037270: 2020 2020 2020 726f 695f 6869 6768 203d        roi_high =
+00037280: 2052 4f49 2873 6f75 7263 653d 706f 6c79   ROI(source=poly
+00037290: 676f 6e73 5f68 6967 682c 2069 6d61 6765  gons_high, image
+000372a0: 3d73 656c 662e 696d 6167 6529 0a20 2020  =self.image).   
+000372b0: 2020 2020 2020 2020 2072 6f69 5f68 6967           roi_hig
+000372c0: 682e 6e61 6d65 203d 2028 6e61 6d65 735b  h.name = (names[
+000372d0: 315d 2069 6620 6c65 6e28 6e61 6d65 7329  1] if len(names)
+000372e0: 203e 2031 0a20 2020 2020 2020 2020 2020   > 1.           
+000372f0: 2020 2020 2020 2020 2065 6c73 6520 6627           else f'
+00037300: 7b73 656c 662e 6e61 6d65 7d5f 7b73 7566  {self.name}_{suf
+00037310: 6669 7865 735b 315d 7d27 290a 2020 2020  fixes[1]}').    
+00037320: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00037330: 2020 2020 2020 726f 695f 6869 6768 203d        roi_high =
+00037340: 204e 6f6e 650a 0a20 2020 2020 2020 2023   None..        #
+00037350: 2043 7265 6174 6520 7374 7275 6374 7572   Create structur
+00037360: 6520 7365 7420 666f 7220 636f 6d70 6f6e  e set for compon
+00037370: 656e 7420 524f 4928 7329 2e0a 2020 2020  ent ROI(s)..    
+00037380: 2020 2020 726f 6973 203d 206c 6973 7428      rois = list(
+00037390: 6669 6c74 6572 284e 6f6e 652c 205b 726f  filter(None, [ro
+000373a0: 695f 6c6f 772c 2072 6f69 5f68 6967 685d  i_low, roi_high]
+000373b0: 2929 0a20 2020 2020 2020 2069 6620 726f  )).        if ro
+000373c0: 6973 3a0a 2020 2020 2020 2020 2020 2020  is:.            
+000373d0: 7373 203d 2053 7472 7563 7475 7265 5365  ss = StructureSe
+000373e0: 7428 7061 7468 3d72 6f69 732c 206e 616d  t(path=rois, nam
+000373f0: 653d 7365 6c66 2e6e 616d 652c 2069 6d61  e=self.name, ima
+00037400: 6765 3d73 656c 662e 696d 6167 6529 0a20  ge=self.image). 
+00037410: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00037420: 2020 2020 2020 2020 2073 7320 3d20 4e6f           ss = No
+00037430: 6e65 0a0a 2020 2020 2020 2020 7265 7475  ne..        retu
+00037440: 726e 2073 730a 0a20 2020 2064 6566 2067  rn ss..    def g
+00037450: 6574 5f70 6174 6368 2873 656c 662c 2070  et_patch(self, p
+00037460: 6c6f 745f 7479 7065 3d4e 6f6e 652c 2063  lot_type=None, c
+00037470: 6f6c 6f72 3d4e 6f6e 652c 206f 7061 6369  olor=None, opaci
+00037480: 7479 3d4e 6f6e 652c 0a20 2020 2020 2020  ty=None,.       
+00037490: 2020 2020 206c 696e 6577 6964 7468 3d4e       linewidth=N
+000374a0: 6f6e 652c 206e 616d 653d 4e6f 6e65 293a  one, name=None):
+000374b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000374c0: 2020 2020 204f 6274 6169 6e20 7061 7463       Obtain patc
+000374d0: 6820 7265 666c 6563 7469 6e67 2052 4f49  h reflecting ROI
+000374e0: 2063 6861 7261 6374 6572 6973 7469 6373   characteristics
+000374f0: 2066 6f72 2070 6c6f 7474 696e 672e 0a0a   for plotting...
+00037500: 2020 2020 2020 2020 5468 6520 7061 7463          The patc
+00037510: 6820 6f62 7461 696e 6564 2063 616e 2062  h obtained can b
+00037520: 6520 7573 6564 2061 7320 6120 6861 6e64  e used as a hand
+00037530: 6c65 2069 6e20 6c65 6765 6e64 2063 7265  le in legend cre
+00037540: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
+00037550: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+00037560: 0a20 2020 2020 2020 2070 6c6f 745f 7479  .        plot_ty
+00037570: 7065 203a 2073 7472 2c20 6465 6661 756c  pe : str, defaul
+00037580: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00037590: 2020 2050 6c6f 7474 696e 6720 7479 7065     Plotting type
+000375a0: 2e20 4966 204e 6f6e 652c 2077 696c 6c20  . If None, will 
+000375b0: 6265 2065 6974 6865 7220 2263 6f6e 746f  be either "conto
+000375c0: 7572 2220 6f72 2022 6d61 736b 2220 0a20  ur" or "mask" . 
+000375d0: 2020 2020 2020 2020 2020 2064 6570 656e             depen
+000375e0: 6469 6e67 206f 6e20 7468 6520 696e 7075  ding on the inpu
+000375f0: 7420 7479 7065 206f 6620 7468 6520 524f  t type of the RO
+00037600: 492e 204f 7074 696f 6e73 3a0a 0a20 2020  I. Options:..   
+00037610: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+00037620: 636f 6e74 6f75 7222 0a20 2020 2020 2020  contour".       
+00037630: 2020 2020 2020 2020 202d 2022 6d61 736b           - "mask
+00037640: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00037650: 2020 2d20 2263 656e 7472 6f69 6422 2028    - "centroid" (
+00037660: 636f 6e74 6f75 7220 7769 7468 206d 6172  contour with mar
+00037670: 6b65 7220 6174 2063 656e 7472 6f69 6429  ker at centroid)
+00037680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037690: 202d 2022 6669 6c6c 6564 2220 2874 7261   - "filled" (tra
+000376a0: 6e73 7061 7265 6e74 206d 6173 6b20 2b20  nsparent mask + 
+000376b0: 636f 6e74 6f75 7229 0a20 2020 2020 2020  contour).       
+000376c0: 2020 2020 2020 2020 202d 2022 6669 6c6c           - "fill
+000376d0: 6564 2063 656e 7472 6f69 6422 2028 6669  ed centroid" (fi
+000376e0: 6c6c 6564 2077 6974 6820 6d61 726b 6572  lled with marker
+000376f0: 2061 7420 6365 6e74 726f 6964 290a 0a20   at centroid).. 
+00037700: 2020 2020 2020 2063 6f6c 6f72 203a 206d         color : m
+00037710: 6174 706c 6f74 6c69 6220 636f 6c6f 722c  atplotlib color,
+00037720: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00037730: 2020 2020 2020 2020 2020 436f 6c6f 7220            Color 
+00037740: 7769 7468 2077 6869 6368 2074 6f20 706c  with which to pl
+00037750: 6f74 2074 6865 2052 4f49 3b20 6f76 6572  ot the ROI; over
+00037760: 7269 6465 7320 7468 6520 524f 4927 7320  rides the ROI's 
+00037770: 6f77 6e20 636f 6c6f 722e 2049 6620 0a20  own color. If . 
+00037780: 2020 2020 2020 2020 2020 204e 6f6e 652c             None,
+00037790: 2073 656c 662e 636f 6c6f 7220 7769 6c6c   self.color will
+000377a0: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+000377b0: 2020 206f 7061 6369 7479 203a 2066 6c6f     opacity : flo
+000377c0: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
+000377d0: 0a20 2020 2020 2020 2020 2020 204f 7061  .            Opa
+000377e0: 6369 7479 2074 6f20 7573 6520 6966 2070  city to use if p
+000377f0: 6c6f 7474 696e 6720 6d61 736b 2028 692e  lotting mask (i.
+00037800: 652e 2070 6c6f 7420 7479 7065 7320 226d  e. plot types "m
+00037810: 6173 6b22 2c20 2266 696c 6c65 6422 2c20  ask", "filled", 
+00037820: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00037830: 2266 696c 6c65 6420 6365 6e74 726f 6964  "filled centroid
+00037840: 2229 2e20 4966 204e 6f6e 652c 206f 7061  "). If None, opa
+00037850: 6369 7479 2077 696c 6c20 6265 2031 2062  city will be 1 b
+00037860: 7920 6465 6661 756c 7420 666f 7220 0a20  y default for . 
+00037870: 2020 2020 2020 2020 2020 2073 6f6c 6964             solid
+00037880: 206d 6173 6b20 706c 6f74 7320 616e 6420   mask plots and 
+00037890: 302e 3320 6279 2064 6566 6175 6c74 2066  0.3 by default f
+000378a0: 6f72 2066 696c 6c65 6420 706c 6f74 732e  or filled plots.
+000378b0: 0a0a 2020 2020 2020 2020 6c69 6e65 7769  ..        linewi
+000378c0: 6474 6820 3a20 666c 6f61 742c 2064 6566  dth : float, def
+000378d0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+000378e0: 2020 2020 2020 5769 6474 6820 6f66 2063        Width of c
+000378f0: 6f6e 746f 7572 206c 696e 6573 2e20 4966  ontour lines. If
+00037900: 204e 6f6e 652c 2074 6865 206d 6174 706c   None, the matpl
+00037910: 6f74 6c69 6220 6465 6661 756c 7420 7365  otlib default se
+00037920: 7474 696e 6720 0a20 2020 2020 2020 2020  tting .         
+00037930: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
+00037940: 0a0a 2020 2020 2020 2020 6e61 6d65 203a  ..        name :
+00037950: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+00037960: 6e65 0a20 2020 2020 2020 2020 2020 204e  ne.            N
+00037970: 616d 6520 6964 656e 7469 6679 696e 6720  ame identifying 
+00037980: 524f 492e 2020 4966 204e 6f6e 652c 2073  ROI.  If None, s
+00037990: 656c 662e 6e61 6d65 2077 696c 6c20 6265  elf.name will be
+000379a0: 2075 7365 642e 0a20 2020 2020 2020 2022   used..        "
+000379b0: 2222 0a0a 2020 2020 2020 2020 2320 456e  ""..        # En
+000379c0: 7375 7265 2074 6861 7420 706c 6f74 7469  sure that plotti
+000379d0: 6e67 2063 6861 7261 6374 6572 6973 7469  ng characteristi
+000379e0: 6373 2061 7265 2064 6566 696e 6564 2e0a  cs are defined..
+000379f0: 2020 2020 2020 2020 6966 2070 6c6f 745f          if plot_
+00037a00: 7479 7065 2069 7320 4e6f 6e65 3a0a 2020  type is None:.  
+00037a10: 2020 2020 2020 2020 2020 706c 6f74 5f74            plot_t
+00037a20: 7970 6520 3d20 7365 6c66 2e64 6566 6175  ype = self.defau
+00037a30: 6c74 5f67 656f 6d5f 6d65 7468 6f64 0a0a  lt_geom_method..
+00037a40: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
+00037a50: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00037a60: 2020 2020 2020 636f 6c6f 7220 3d20 7365        color = se
+00037a70: 6c66 2e63 6f6c 6f72 0a0a 2020 2020 2020  lf.color..      
+00037a80: 2020 6966 206f 7061 6369 7479 2069 7320    if opacity is 
+00037a90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00037aa0: 2020 6f70 6163 6974 7920 3d20 302e 3320    opacity = 0.3 
+00037ab0: 6966 2022 6669 6c6c 6564 2220 696e 2070  if "filled" in p
+00037ac0: 6c6f 745f 7479 7065 2065 6c73 6520 310a  lot_type else 1.
+00037ad0: 0a20 2020 2020 2020 2069 6620 6c69 6e65  .        if line
+00037ae0: 7769 6474 6820 6973 204e 6f6e 653a 0a20  width is None:. 
+00037af0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+00037b00: 6964 7468 203d 2064 6566 6175 6c74 5061  idth = defaultPa
+00037b10: 7261 6d73 5b22 6c69 6e65 732e 6c69 6e65  rams["lines.line
+00037b20: 7769 6474 6822 5d5b 305d 0a0a 2020 2020  width"][0]..    
+00037b30: 2020 2020 6966 206e 616d 6520 6973 204e      if name is N
+00037b40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00037b50: 206e 616d 6520 3d20 7365 6c66 2e6e 616d   name = self.nam
+00037b60: 650a 0a20 2020 2020 2020 2023 2053 6574  e..        # Set
+00037b70: 2070 6f74 656e 7469 616c 6c79 2064 6966   potentially dif
+00037b80: 6665 7265 6e74 206f 7061 6369 7469 6573  ferent opacities
+00037b90: 2066 6f72 2066 6163 6563 6f6c 6f72 2061   for facecolor a
+00037ba0: 6e64 2065 6467 6563 6f6c 6f72 0a20 2020  nd edgecolor.   
+00037bb0: 2020 2020 2066 6163 6563 6f6c 6f72 203d       facecolor =
+00037bc0: 206d 6174 706c 6f74 6c69 622e 636f 6c6f   matplotlib.colo
+00037bd0: 7273 2e74 6f5f 7267 6261 2863 6f6c 6f72  rs.to_rgba(color
+00037be0: 2c20 616c 7068 613d 6f70 6163 6974 7929  , alpha=opacity)
+00037bf0: 0a20 2020 2020 2020 2065 6467 6563 6f6c  .        edgecol
+00037c00: 6f72 203d 206d 6174 706c 6f74 6c69 622e  or = matplotlib.
+00037c10: 636f 6c6f 7273 2e74 6f5f 7267 6261 2863  colors.to_rgba(c
+00037c20: 6f6c 6f72 2c20 616c 7068 613d 3129 0a0a  olor, alpha=1)..
+00037c30: 2020 2020 2020 2020 2320 4465 6669 6e65          # Define
+00037c40: 2070 6174 6368 2061 6363 6f72 6469 6e67   patch according
+00037c50: 2074 6f20 706c 6f74 5f74 7970 652e 0a20   to plot_type.. 
+00037c60: 2020 2020 2020 2070 6174 6368 203d 204e         patch = N
+00037c70: 6f6e 650a 2020 2020 2020 2020 6966 2070  one.        if p
+00037c80: 6c6f 745f 7479 7065 2069 6e20 5b22 636f  lot_type in ["co
+00037c90: 6e74 6f75 7222 2c20 2263 656e 7472 6f69  ntour", "centroi
+00037ca0: 6422 5d3a 0a20 2020 2020 2020 2020 2020  d"]:.           
+00037cb0: 2070 6174 6368 203d 206d 7061 7463 6865   patch = mpatche
+00037cc0: 732e 5061 7463 6828 6564 6765 636f 6c6f  s.Patch(edgecolo
+00037cd0: 723d 6564 6765 636f 6c6f 722c 0a20 2020  r=edgecolor,.   
+00037ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037cf0: 206c 696e 6577 6964 7468 3d6c 696e 6577   linewidth=linew
+00037d00: 6964 7468 2c20 6669 6c6c 3d46 616c 7365  idth, fill=False
+00037d10: 2c20 6c61 6265 6c3d 6e61 6d65 290a 2020  , label=name).  
+00037d20: 2020 2020 2020 656c 6966 2070 6c6f 745f        elif plot_
+00037d30: 7479 7065 2069 6e20 5b22 6669 6c6c 6564  type in ["filled
+00037d40: 222c 2022 6669 6c6c 6564 2063 656e 7472  ", "filled centr
+00037d50: 6f69 6422 5d3a 0a20 2020 2020 2020 2020  oid"]:.         
+00037d60: 2020 2070 6174 6368 203d 206d 7061 7463     patch = mpatc
+00037d70: 6865 732e 5061 7463 6828 6564 6765 636f  hes.Patch(edgeco
+00037d80: 6c6f 723d 6564 6765 636f 6c6f 722c 0a20  lor=edgecolor,. 
+00037d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037da0: 2020 2066 6163 6563 6f6c 6f72 3d66 6163     facecolor=fac
+00037db0: 6563 6f6c 6f72 2c20 6c69 6e65 7769 6474  ecolor, linewidt
+00037dc0: 683d 6c69 6e65 7769 6474 682c 206c 6162  h=linewidth, lab
+00037dd0: 656c 3d6e 616d 6529 0a20 2020 2020 2020  el=name).       
+00037de0: 2065 6c69 6620 706c 6f74 5f74 7970 6520   elif plot_type 
+00037df0: 696e 205b 226d 6173 6b22 5d3a 0a20 2020  in ["mask"]:.   
+00037e00: 2020 2020 2020 2020 2070 6174 6368 203d           patch =
+00037e10: 206d 7061 7463 6865 732e 5061 7463 6828   mpatches.Patch(
+00037e20: 6661 6365 636f 6c6f 723d 6661 6365 636f  facecolor=faceco
+00037e30: 6c6f 722c 206c 6162 656c 3d6e 616d 6529  lor, label=name)
+00037e40: 0a0a 2020 2020 2020 2020 6966 2070 6174  ..        if pat
+00037e50: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+00037e60: 7061 7463 682e 7365 745f 616c 7068 6128  patch.set_alpha(
+00037e70: 4e6f 6e65 290a 0a20 2020 2020 2020 2072  None)..        r
+00037e80: 6574 7572 6e20 7061 7463 680a 0a20 2020  eturn patch..   
+00037e90: 2064 6566 2067 6574 5f69 6e74 656e 7369   def get_intensi
+00037ea0: 7469 6573 5f33 6428 7365 6c66 2c20 696d  ties_3d(self, im
+00037eb0: 6167 653d 4e6f 6e65 2c20 7374 616e 6461  age=None, standa
+00037ec0: 7264 6973 653d 5472 7565 293a 0a20 2020  rdise=True):.   
+00037ed0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00037ee0: 2052 6574 7572 6e20 636f 7079 206f 6620   Return copy of 
+00037ef0: 616e 2069 6d61 6765 2061 7272 6179 2074  an image array t
+00037f00: 6861 7420 6861 7320 7661 6c75 6573 2072  hat has values r
+00037f10: 6574 6169 6e65 640a 2020 2020 2020 2020  etained.        
+00037f20: 696e 7369 6465 2073 656c 662c 2061 6e64  inside self, and
+00037f30: 2069 7320 7365 7420 746f 207a 6572 6f20   is set to zero 
+00037f40: 656c 7365 7768 6572 652e 0a0a 2020 2020  elsewhere...    
+00037f50: 2020 2020 2a2a 5061 7261 6d65 7465 723a      **Parameter:
+00037f60: 2a2a 0a0a 2020 2020 2020 2020 696d 6167  **..        imag
+00037f70: 6520 3a20 736b 7274 2e69 6d61 6765 2e49  e : skrt.image.I
+00037f80: 6d61 6765 2c20 6465 6661 756c 743d 4e6f  mage, default=No
+00037f90: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
+00037fa0: 6d61 6765 206f 626a 6563 7420 666f 7220  mage object for 
+00037fb0: 7768 6963 6820 3344 2061 7272 6179 2077  which 3D array w
+00037fc0: 6974 6820 696e 7465 6e73 6974 7920 7661  ith intensity va
+00037fd0: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
+00037fe0: 2072 6574 6169 6e65 6420 696e 7369 6465   retained inside
+00037ff0: 2052 4f49 2c20 616e 6420 4e61 4e20 656c   ROI, and NaN el
+00038000: 7365 7768 6572 652c 2069 7320 746f 2062  sewhere, is to b
+00038010: 6520 6f62 7461 696e 6564 2e0a 2020 2020  e obtained..    
+00038020: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
+00038030: 2074 6865 2069 6d61 6765 2061 7373 6f63   the image assoc
+00038040: 6961 7465 6420 7769 7468 2074 6865 2052  iated with the R
+00038050: 4f49 2069 7320 7573 6564 2e0a 0a20 2020  OI is used...   
+00038060: 2020 2020 2073 7461 6e64 6172 6469 7365       standardise
+00038070: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00038080: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+00038090: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
+000380a0: 2064 6174 6120 6172 7261 7920 7769 6c6c   data array will
+000380b0: 2062 6520 7265 7475 726e 6564 2069 6e20   be returned in 
+000380c0: 7468 6520 6f72 6965 6e74 6174 696f 6e20  the orientation 
+000380d0: 696e 200a 2020 2020 2020 2020 2020 2020  in .            
+000380e0: 7768 6963 6820 6974 2077 6173 206c 6f61  which it was loa
+000380f0: 6465 643b 206f 7468 6572 7769 7365 2c20  ded; otherwise, 
+00038100: 6974 2077 696c 6c20 6265 2072 6574 7572  it will be retur
+00038110: 6e65 6420 696e 2073 7461 6e64 6172 640a  ned in standard.
+00038120: 2020 2020 2020 2020 2020 2020 6469 636f              dico
+00038130: 6d2d 7374 796c 6520 6f72 6965 6e74 6174  m-style orientat
+00038140: 696f 6e20 7375 6368 2074 6861 7420 5b63  ion such that [c
+00038150: 6f6c 756d 6e2c 2072 6f77 2c20 736c 6963  olumn, row, slic
+00038160: 655d 2063 6f72 7265 7370 6f6e 6473 0a20  e] corresponds. 
+00038170: 2020 2020 2020 2020 2020 2074 6f20 7468             to th
+00038180: 6520 5b78 2c20 792c 207a 5d20 6178 6573  e [x, y, z] axes
+00038190: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000381a0: 2020 2020 2020 6966 2069 6d61 6765 2069        if image i
+000381b0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000381c0: 2020 2020 2320 436f 6e73 6964 6572 2069      # Consider i
+000381d0: 6d61 6765 2061 7373 6f63 6961 7465 6420  mage associated 
+000381e0: 7769 7468 2073 656c 662e 0a20 2020 2020  with self..     
+000381f0: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+00038200: 7465 5f6d 6173 6b28 290a 2020 2020 2020  te_mask().      
+00038210: 2020 2020 2020 696d 6167 6520 3d20 7365        image = se
+00038220: 6c66 2e69 6d61 6765 0a20 2020 2020 2020  lf.image.       
+00038230: 2020 2020 2072 6f69 203d 2073 656c 660a       roi = self.
+00038240: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00038250: 2020 2020 2020 2020 2020 2320 436c 6f6e            # Clon
+00038260: 6520 7365 6c66 2c20 616e 6420 6173 736f  e self, and asso
+00038270: 6369 6174 6520 7769 7468 2063 6c6f 6e65  ciate with clone
+00038280: 2074 6865 2069 6d61 6765 2073 7065 6369   the image speci
+00038290: 6669 6564 2069 6e20 696e 7075 742e 0a20  fied in input.. 
+000382a0: 2020 2020 2020 2020 2020 2072 6f69 203d             roi =
+000382b0: 2073 656c 662e 636c 6f6e 6528 290a 2020   self.clone().  
+000382c0: 2020 2020 2020 2020 2020 726f 692e 7365            roi.se
+000382d0: 745f 696d 6167 6528 696d 6167 6529 0a0a  t_image(image)..
+000382e0: 2020 2020 2020 2020 2320 4f62 7461 696e          # Obtain
+000382f0: 2069 6e74 656e 7369 7479 2076 616c 7565   intensity value
+00038300: 732e 0a20 2020 2020 2020 2069 6d5f 6461  s..        im_da
+00038310: 7461 203d 2069 6d61 6765 2e67 6574 5f64  ta = image.get_d
+00038320: 6174 6128 7374 616e 6461 7264 6973 653d  ata(standardise=
+00038330: 7374 616e 6461 7264 6973 6529 0a20 2020  standardise).   
+00038340: 2020 2020 206d 6173 6b20 3d20 726f 692e       mask = roi.
+00038350: 6765 745f 6d61 736b 2873 7461 6e64 6172  get_mask(standar
+00038360: 6469 7365 3d73 7461 6e64 6172 6469 7365  dise=standardise
+00038370: 290a 2020 2020 2020 2020 696e 7465 6e73  ).        intens
+00038380: 6974 6965 735f 696e 5f72 6f69 203d 206e  ities_in_roi = n
+00038390: 702e 6675 6c6c 2869 6d5f 6461 7461 2e73  p.full(im_data.s
+000383a0: 6861 7065 2c20 6e70 2e6e 616e 290a 2020  hape, np.nan).  
+000383b0: 2020 2020 2020 696e 7465 6e73 6974 6965        intensitie
+000383c0: 735f 696e 5f72 6f69 5b6d 6173 6b20 3e20  s_in_roi[mask > 
+000383d0: 305d 203d 2069 6d5f 6461 7461 5b6d 6173  0] = im_data[mas
+000383e0: 6b20 3e20 305d 0a20 2020 2020 2020 2072  k > 0].        r
+000383f0: 6574 7572 6e20 696e 7465 6e73 6974 6965  eturn intensitie
+00038400: 735f 696e 5f72 6f69 0a0a 2020 2020 6465  s_in_roi..    de
+00038410: 6620 6765 745f 696e 7465 6e73 6974 6965  f get_intensitie
+00038420: 7328 7365 6c66 2c20 696d 6167 653d 4e6f  s(self, image=No
+00038430: 6e65 2c20 7374 616e 6461 7264 6973 653d  ne, standardise=
+00038440: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
+00038450: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00038460: 6e20 3144 206e 756d 7079 2061 7272 6179  n 1D numpy array
+00038470: 2063 6f6e 7461 696e 696e 6720 616c 6c20   containing all 
+00038480: 6f66 2074 6865 2069 6e74 656e 7369 7479  of the intensity
+00038490: 2076 616c 7565 7320 666f 7220 7468 6520   values for the 
+000384a0: 0a20 2020 2020 2020 2076 6f78 656c 7320  .        voxels 
+000384b0: 696e 7369 6465 2073 656c 662e 0a0a 2020  inside self...  
+000384c0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+000384d0: 7273 3a2a 2a0a 0a20 2020 2020 2020 2069  rs:**..        i
+000384e0: 6d61 6765 203a 2073 6b72 742e 696d 6167  mage : skrt.imag
+000384f0: 652e 496d 6167 652c 2064 6566 6175 6c74  e.Image, default
+00038500: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00038510: 2020 496d 6167 6520 6f62 6a65 6374 2066    Image object f
+00038520: 6f72 2077 6869 6368 2031 4420 6172 7261  or which 1D arra
+00038530: 7920 6f66 2069 6e74 656e 7369 7479 2076  y of intensity v
+00038540: 616c 7565 7320 6973 0a20 2020 2020 2020  alues is.       
+00038550: 2020 2020 2074 6f20 6265 206f 6274 6169       to be obtai
+00038560: 6e65 642e 2020 4966 204e 6f6e 652c 2074  ned.  If None, t
+00038570: 6865 2069 6d61 6765 2061 7373 6f63 6961  he image associa
+00038580: 7465 6420 7769 7468 2074 6865 0a20 2020  ted with the.   
+00038590: 2020 2020 2020 2020 2052 4f49 2069 7320           ROI is 
+000385a0: 7573 6564 2e0a 0a20 2020 2020 2020 2073  used...        s
+000385b0: 7461 6e64 6172 6469 7365 203a 2062 6f6f  tandardise : boo
+000385c0: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
+000385d0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+000385e0: 4661 6c73 652c 2074 6865 2069 6d61 6765  False, the image
+000385f0: 2773 2064 6174 6120 6172 7261 7920 7769  's data array wi
+00038600: 6c6c 2062 6520 7573 6564 2069 6e20 7468  ll be used in th
+00038610: 6520 6f72 6965 6e74 6174 696f 6e0a 2020  e orientation.  
+00038620: 2020 2020 2020 2020 2020 696e 2077 6869            in whi
+00038630: 6368 2069 7420 7761 7320 6c6f 6164 6564  ch it was loaded
+00038640: 3b20 6f74 6865 7277 6973 652c 2069 7420  ; otherwise, it 
+00038650: 7769 6c6c 2062 6520 7573 6564 2069 6e20  will be used in 
+00038660: 7374 616e 6461 7264 0a20 2020 2020 2020  standard.       
+00038670: 2020 2020 2064 6963 6f6d 2d73 7479 6c65       dicom-style
+00038680: 206f 7269 656e 7461 7469 6f6e 2073 7563   orientation suc
+00038690: 6820 7468 6174 205b 636f 6c75 6d6e 2c20  h that [column, 
+000386a0: 726f 772c 2073 6c69 6365 5d20 636f 7272  row, slice] corr
+000386b0: 6573 706f 6e64 730a 2020 2020 2020 2020  esponds.        
+000386c0: 2020 2020 746f 2074 6865 205b 782c 2079      to the [x, y
+000386d0: 2c20 7a5d 2061 7865 732e 0a20 2020 2020  , z] axes..     
+000386e0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+000386f0: 6e74 656e 7369 7469 6573 203d 2073 656c  ntensities = sel
+00038700: 662e 6765 745f 696e 7465 6e73 6974 6965  f.get_intensitie
+00038710: 735f 3364 2869 6d61 6765 2c20 7374 616e  s_3d(image, stan
+00038720: 6461 7264 6973 6529 0a20 2020 2020 2020  dardise).       
+00038730: 2072 6574 7572 6e20 696e 7465 6e73 6974   return intensit
+00038740: 6965 735b 7e6e 702e 6973 6e61 6e28 696e  ies[~np.isnan(in
+00038750: 7465 6e73 6974 6965 7329 5d0a 2020 2020  tensities)].    
+00038760: 2020 2020 0a63 6c61 7373 2053 7472 7563      .class Struc
+00038770: 7475 7265 5365 7428 736b 7274 2e63 6f72  tureSet(skrt.cor
+00038780: 652e 4172 6368 6976 6529 3a0a 2020 2020  e.Archive):.    
+00038790: 2222 220a 2020 2020 436c 6173 7320 7265  """.    Class re
+000387a0: 7072 6573 656e 7469 6e67 2061 2072 6164  presenting a rad
+000387b0: 696f 7468 6572 6170 7920 7374 7275 6374  iotherapy struct
+000387c0: 7572 6520 7365 740a 2020 2020 6173 2061  ure set.    as a
+000387d0: 2063 6f6c 6c65 6374 696f 6e20 6f66 2072   collection of r
+000387e0: 6567 696f 6e73 206f 6620 696e 7465 7265  egions of intere
+000387f0: 7374 2028 524f 4973 292e 0a0a 2020 2020  st (ROIs)...    
+00038800: 4174 7472 6962 7574 6573 206f 6620 6120  Attributes of a 
+00038810: 5374 7275 6374 7572 6553 6574 206f 626a  StructureSet obj
+00038820: 6563 7420 7368 6f75 6c64 2075 7375 616c  ect should usual
+00038830: 6c79 2062 6520 6163 6365 7373 6564 2076  ly be accessed v
+00038840: 6961 0a20 2020 2074 6865 6972 2067 6574  ia.    their get
+00038850: 7465 7220 6d65 7468 6f64 732c 2072 6174  ter methods, rat
+00038860: 6865 7220 7468 616e 2064 6972 6563 746c  her than directl
+00038870: 792c 2074 6f20 656e 7375 7265 2074 6861  y, to ensure tha
+00038880: 740a 2020 2020 6174 7472 6962 7574 6520  t.    attribute 
+00038890: 7661 6c75 6573 2068 6176 6520 6265 656e  values have been
+000388a0: 206c 6f61 6465 642e 0a20 2020 2022 2222   loaded..    """
+000388b0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+000388c0: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
+000388d0: 2c0a 2020 2020 2020 2020 7061 7468 3d4e  ,.        path=N
+000388e0: 6f6e 652c 0a20 2020 2020 2020 206e 616d  one,.        nam
+000388f0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00038900: 696d 6167 653d 4e6f 6e65 2c0a 2020 2020  image=None,.    
+00038910: 2020 2020 6c6f 6164 3d54 7275 652c 0a20      load=True,. 
+00038920: 2020 2020 2020 206e 616d 6573 3d4e 6f6e         names=Non
+00038930: 652c 0a20 2020 2020 2020 206b 6565 705f  e,.        keep_
+00038940: 7265 6e61 6d65 645f 6f6e 6c79 3d46 616c  renamed_only=Fal
+00038950: 7365 2c0a 2020 2020 2020 2020 746f 5f6b  se,.        to_k
+00038960: 6565 703d 4e6f 6e65 2c0a 2020 2020 2020  eep=None,.      
+00038970: 2020 746f 5f72 656d 6f76 653d 4e6f 6e65    to_remove=None
+00038980: 2c0a 2020 2020 2020 2020 6d75 6c74 695f  ,.        multi_
+00038990: 6c61 6265 6c3d 4661 6c73 652c 0a20 2020  label=False,.   
+000389a0: 2020 2020 2063 6f6c 6f72 733d 4e6f 6e65       colors=None
+000389b0: 2c0a 2020 2020 2020 2020 6967 6e6f 7265  ,.        ignore
+000389c0: 5f64 6963 6f6d 5f63 6f6c 6f72 733d 4661  _dicom_colors=Fa
+000389d0: 6c73 652c 0a20 2020 2020 2020 2061 7574  lse,.        aut
+000389e0: 6f5f 7469 6d65 7374 616d 703d 4661 6c73  o_timestamp=Fals
+000389f0: 652c 0a20 2020 2020 2020 2061 6c70 6861  e,.        alpha
+00038a00: 5f62 6574 615f 7261 7469 6f73 3d4e 6f6e  _beta_ratios=Non
+00038a10: 652c 0a20 2020 2020 2020 202a 2a6b 7761  e,.        **kwa
+00038a20: 7267 730a 2020 2020 293a 0a20 2020 2020  rgs.    ):.     
+00038a30: 2020 2022 2222 4c6f 6164 2073 7472 7563     """Load struc
+00038a40: 7475 7265 2073 6574 2066 726f 6d20 7468  ture set from th
+00038a50: 6520 736f 7572 6365 2873 2920 6769 7665  e source(s) give
+00038a60: 6e20 696e 203c 7061 7468 3e2e 0a0a 2020  n in <path>...  
+00038a70: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+00038a80: 7273 2a2a 3a0a 0a20 2020 2020 2020 2070  rs**:..        p
+00038a90: 6174 6820 3a20 7374 722f 6c69 7374 2c20  ath : str/list, 
+00038aa0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00038ab0: 2020 2020 2020 2020 2053 6f75 7263 6528           Source(
+00038ac0: 7329 206f 6620 524f 4973 2074 6f20 6c6f  s) of ROIs to lo
+00038ad0: 6164 2069 6e74 6f20 7468 6973 2073 7472  ad into this str
+00038ae0: 7563 7475 7265 2073 6574 2e20 4361 6e20  ucture set. Can 
+00038af0: 6265 3a0a 0a20 2020 2020 2020 2020 2020  be:..           
+00038b00: 202d 2054 6865 2070 6174 6820 746f 2061   - The path to a
+00038b10: 2073 696e 676c 6520 6469 636f 6d20 7374   single dicom st
+00038b20: 7275 6374 7572 6520 7365 7420 6669 6c65  ructure set file
+00038b30: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
+00038b40: 5468 6520 7061 7468 2074 6f20 6120 7369  The path to a si
+00038b50: 6e67 6c65 206e 6966 7469 2066 696c 6520  ngle nifti file 
+00038b60: 636f 6e74 6169 6e69 6e67 2061 6e20 524f  containing an RO
+00038b70: 4920 6d61 736b 3b0a 2020 2020 2020 2020  I mask;.        
+00038b80: 2020 2020 2d20 4120 6c69 7374 206f 6620      - A list of 
+00038b90: 7061 7468 7320 746f 206e 6966 7469 2066  paths to nifti f
+00038ba0: 696c 6573 2063 6f6e 7461 696e 696e 6720  iles containing 
+00038bb0: 524f 4920 6d61 736b 733b 0a20 2020 2020  ROI masks;.     
+00038bc0: 2020 2020 2020 202d 2054 6865 2070 6174         - The pat
+00038bd0: 6820 746f 2061 2064 6972 6563 746f 7279  h to a directory
+00038be0: 2063 6f6e 7461 696e 696e 6720 6d75 6c74   containing mult
+00038bf0: 6970 6c65 206e 6966 7469 2066 696c 6573  iple nifti files
+00038c00: 200a 2020 2020 2020 2020 2020 2020 636f   .            co
+00038c10: 6e74 6169 6e69 6e67 2052 4f49 206d 6173  ntaining ROI mas
+00038c20: 6b73 3b0a 2020 2020 2020 2020 2020 2020  ks;.            
+00038c30: 2d20 4120 6c69 7374 206f 6620 524f 4920  - A list of ROI 
+00038c40: 6f62 6a65 6374 733b 0a20 2020 2020 2020  objects;.       
+00038c50: 2020 2020 202d 2041 206c 6973 7420 6f66       - A list of
+00038c60: 206f 626a 6563 7473 2074 6861 7420 636f   objects that co
+00038c70: 756c 6420 6265 2075 7365 6420 746f 2069  uld be used to i
+00038c80: 6e69 7469 616c 6973 6520 616e 2052 4f49  nitialise an ROI
+00038c90: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
+00038ca0: 2020 2020 2865 2e67 2e20 6120 6e75 6d70      (e.g. a nump
+00038cb0: 7920 6172 7261 7929 2e0a 0a20 2020 2020  y array)...     
+00038cc0: 2020 206e 616d 6520 3a20 7374 722c 2064     name : str, d
+00038cd0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00038ce0: 2020 2020 2020 2020 4f70 7469 6f6e 616c          Optional
+00038cf0: 206e 616d 6520 746f 2061 7373 6967 6e20   name to assign 
+00038d00: 746f 2074 6869 7320 7374 7275 6374 7572  to this structur
+00038d10: 6520 7365 742e 2049 6620 4e6f 6e65 2c20  e set. If None, 
+00038d20: 7769 6c6c 200a 2020 2020 2020 2020 2020  will .          
+00038d30: 2020 6174 7465 6d70 7420 746f 2069 6e66    attempt to inf
+00038d40: 6572 2066 726f 6d20 696e 7075 7420 6669  er from input fi
+00038d50: 6c65 6e61 6d65 2e0a 0a20 2020 2020 2020  lename...       
+00038d60: 2069 6d61 6765 203a 2073 6b72 742e 696d   image : skrt.im
+00038d70: 6167 652e 496d 6167 652c 2064 6566 6175  age.Image, defau
+00038d80: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00038d90: 2020 2020 496d 6167 6520 6173 736f 6369      Image associ
+00038da0: 6174 6564 2077 6974 6820 7468 6973 2073  ated with this s
+00038db0: 7472 7563 7475 7265 2073 6574 2e20 4966  tructure set. If
+00038dc0: 2074 6865 2069 6e70 7574 2073 6f75 7263   the input sourc
+00038dd0: 6520 6973 2061 0a20 2020 2020 2020 2020  e is a.         
+00038de0: 2020 2064 6963 6f6d 2066 696c 6520 636f     dicom file co
+00038df0: 6e74 6169 6e69 6e67 2052 4f49 2063 6f6e  ntaining ROI con
+00038e00: 746f 7572 732c 2074 6869 7320 696d 6167  tours, this imag
+00038e10: 6520 7769 6c6c 2062 6520 7573 6564 2077  e will be used w
+00038e20: 6865 6e0a 2020 2020 2020 2020 2020 2020  hen.            
+00038e30: 6372 6561 7469 6e67 2052 4f49 2062 696e  creating ROI bin
+00038e40: 6172 7920 6d61 736b 732e 0a0a 2020 2020  ary masks...    
+00038e50: 2020 2020 6c6f 6164 203a 2062 6f6f 6c2c      load : bool,
+00038e60: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+00038e70: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00038e80: 652c 2052 4f49 7320 7769 6c6c 2069 6d6d  e, ROIs will imm
+00038e90: 6564 6961 7465 6c79 2062 6520 6c6f 6164  ediately be load
+00038ea0: 6564 2066 726f 6d20 736f 7572 6365 732e  ed from sources.
+00038eb0: 204f 7468 6572 7769 7365 2c0a 2020 2020   Otherwise,.    
+00038ec0: 2020 2020 2020 2020 6c6f 6164 696e 6720          loading 
+00038ed0: 7769 6c6c 206e 6f74 206f 6363 7572 2075  will not occur u
+00038ee0: 6e74 696c 2053 7472 7563 7475 7265 5365  ntil StructureSe
+00038ef0: 742e 6c6f 6164 2829 2069 7320 6361 6c6c  t.load() is call
+00038f00: 6564 2e0a 2020 2020 2020 2020 0a20 2020  ed..        .   
+00038f10: 2020 2020 206e 616d 6573 203a 2064 6963       names : dic
+00038f20: 742f 6c69 7374 2c20 6465 6661 756c 743d  t/list, default=
+00038f30: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00038f40: 204f 7074 696f 6e61 6c20 6469 6374 206f   Optional dict o
+00038f50: 6620 524f 4920 6e61 6d65 7320 746f 2075  f ROI names to u
+00038f60: 7365 2077 6865 6e20 7265 6e61 6d69 6e67  se when renaming
+00038f70: 206c 6f61 6465 6420 524f 4973 2e20 4b65   loaded ROIs. Ke
+00038f80: 7973 200a 2020 2020 2020 2020 2020 2020  ys .            
+00038f90: 7368 6f75 6c64 2062 6520 6465 7369 7265  should be desire
+00038fa0: 6420 6e61 6d65 732c 2061 6e64 2076 616c  d names, and val
+00038fb0: 7565 7320 7368 6f75 6c64 2062 6520 6c69  ues should be li
+00038fc0: 7374 7320 6f66 2070 6f73 7369 626c 650a  sts of possible.
+00038fd0: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+00038fe0: 7420 6e61 6d65 7320 6f72 2077 696c 6463  t names or wildc
+00038ff0: 6172 6473 206d 6174 6368 696e 6720 696e  ards matching in
+00039000: 7075 7420 6e61 6d65 732e 0a0a 2020 2020  put names...    
+00039010: 2020 2020 2020 2020 4966 206d 756c 7469          If multi
+00039020: 5f6c 6162 656c 3d54 7275 652c 206e 616d  _label=True, nam
+00039030: 6573 2063 616e 2061 6c73 6f20 6265 2061  es can also be a
+00039040: 206c 6973 7420 6f66 206e 616d 6573 2074   list of names t
+00039050: 6f20 6173 7369 676e 0a20 2020 2020 2020  o assign.       
+00039060: 2020 2020 2074 6f20 6561 6368 206c 6162       to each lab
+00039070: 656c 2066 6f75 6e64 2069 6e20 6f72 6465  el found in orde
+00039080: 722c 2066 726f 6d20 736d 616c 6c65 7374  r, from smallest
+00039090: 2074 6f20 6c61 7267 6573 742e 0a0a 2020   to largest...  
+000390a0: 2020 2020 2020 746f 5f6b 6565 7020 3a20        to_keep : 
+000390b0: 6c69 7374 2c20 6465 6661 756c 743d 4e6f  list, default=No
+000390c0: 6e65 0a20 2020 2020 2020 2020 2020 204f  ne.            O
+000390d0: 7074 696f 6e61 6c20 6c69 7374 206f 6620  ptional list of 
+000390e0: 524f 4920 6e61 6d65 7320 6f72 2077 696c  ROI names or wil
+000390f0: 6463 6172 6473 206d 6174 6368 696e 6720  dcards matching 
+00039100: 524f 4920 6e61 6d65 7320 6f66 2052 4f49  ROI names of ROI
+00039110: 730a 2020 2020 2020 2020 2020 2020 746f  s.            to
+00039120: 206b 6565 7020 696e 2074 6869 7320 5374   keep in this St
+00039130: 7275 6374 7572 6553 6574 2064 7572 696e  ructureSet durin
+00039140: 6720 6c6f 6164 696e 672e 2052 4f49 7320  g loading. ROIs 
+00039150: 6e6f 7420 6d61 7463 6869 6e67 2077 696c  not matching wil
+00039160: 6c0a 2020 2020 2020 2020 2020 2020 6265  l.            be
+00039170: 2064 6973 6361 7264 6564 2e20 4e6f 7465   discarded. Note
+00039180: 2074 6861 7420 7468 6520 6e61 6d65 7320   that the names 
+00039190: 7368 6f75 6c64 2072 6566 6c65 6374 2074  should reflect t
+000391a0: 686f 7365 2061 6674 6572 200a 2020 2020  hose after .    
+000391b0: 2020 2020 2020 2020 7265 6e61 6d69 6e67          renaming
+000391c0: 2076 6961 2074 6865 203c 6e61 6d65 733e   via the <names>
+000391d0: 2064 6963 742e 2049 6620 4e6f 6e65 2c20   dict. If None, 
+000391e0: 616c 6c20 524f 4973 2077 696c 6c20 6265  all ROIs will be
+000391f0: 206b 6570 742e 0a0a 2020 2020 2020 2020   kept...        
+00039200: 746f 5f72 656d 6f76 6520 3a20 6c69 7374  to_remove : list
+00039210: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00039220: 2020 2020 2020 2020 2020 204f 7074 696f             Optio
+00039230: 6e61 6c20 6c69 7374 206f 6620 524f 4920  nal list of ROI 
+00039240: 6e61 6d65 7320 6f72 2077 696c 6463 6172  names or wildcar
+00039250: 6473 206d 6174 6368 696e 6720 524f 4920  ds matching ROI 
+00039260: 6e61 6d65 7320 6f66 2052 4f49 730a 2020  names of ROIs.  
+00039270: 2020 2020 2020 2020 2020 746f 2072 656d            to rem
+00039280: 6f76 6520 6672 6f6d 2074 6869 7320 5374  ove from this St
+00039290: 7275 6374 7572 6553 6574 2064 7572 696e  ructureSet durin
+000392a0: 6720 6c6f 6164 696e 672e 2052 4f49 7320  g loading. ROIs 
+000392b0: 6d61 7463 6869 6e67 2077 696c 6c0a 2020  matching will.  
+000392c0: 2020 2020 2020 2020 2020 6265 2064 6973            be dis
+000392d0: 6361 7264 6564 2e20 4e6f 7465 2074 6861  carded. Note tha
+000392e0: 7420 7468 6520 6e61 6d65 7320 7368 6f75  t the names shou
+000392f0: 6c64 2072 6566 6c65 6374 2074 686f 7365  ld reflect those
+00039300: 2061 6674 6572 200a 2020 2020 2020 2020   after .        
+00039310: 2020 2020 7265 6e61 6d69 6e67 2076 6961      renaming via
+00039320: 2074 6865 203c 6e61 6d65 733e 2064 6963   the <names> dic
+00039330: 742c 2061 6e64 2072 656d 6f76 616c 206f  t, and removal o
+00039340: 6363 7572 7320 6166 7465 7220 6669 6c74  ccurs after filt
+00039350: 6572 696e 670a 2020 2020 2020 2020 2020  ering.          
+00039360: 2020 7769 7468 2074 6865 203c 746f 5f6b    with the <to_k
+00039370: 6565 703e 206c 6973 742e 2049 6620 4e6f  eep> list. If No
+00039380: 6e65 2c20 6e6f 2052 4f49 7320 7769 6c6c  ne, no ROIs will
+00039390: 2062 6520 7265 6d6f 7665 642e 0a0a 2020   be removed...  
+000393a0: 2020 2020 2020 6d75 6c74 695f 6c61 6265        multi_labe
+000393b0: 6c20 3a20 626f 6f6c 2c20 6465 6661 756c  l : bool, defaul
+000393c0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+000393d0: 2020 2020 4966 2054 7275 652c 2077 696c      If True, wil
+000393e0: 6c20 6c6f 6f6b 2066 6f72 206d 756c 7469  l look for multi
+000393f0: 706c 6520 524f 4920 6d61 736b 7320 7769  ple ROI masks wi
+00039400: 7468 2064 6966 6665 7265 6e74 206c 6162  th different lab
+00039410: 656c 7320 0a20 2020 2020 2020 2020 2020  els .           
+00039420: 2069 6e73 6964 6520 7468 6520 6172 7261   inside the arra
+00039430: 7920 616e 6420 6372 6561 7465 2061 2073  y and create a s
+00039440: 6570 6172 6174 6520 524f 4920 6672 6f6d  eparate ROI from
+00039450: 2065 6163 682e 0a0a 2020 2020 2020 2020   each...        
+00039460: 636f 6c6f 7273 203a 206c 6973 742f 6469  colors : list/di
+00039470: 6374 0a20 2020 2020 2020 2020 2020 204c  ct.            L
+00039480: 6973 7420 6f72 2064 6963 7420 6f66 2063  ist or dict of c
+00039490: 6f6c 6f72 732e 2049 6620 6120 6469 6374  olors. If a dict
+000394a0: 2c20 7468 6520 6b65 7973 2073 686f 756c  , the keys shoul
+000394b0: 6420 6265 2052 4f49 206e 616d 6573 206f  d be ROI names o
+000394c0: 720a 2020 2020 2020 2020 2020 2020 7769  r.            wi
+000394d0: 6c64 6361 7264 7320 6d61 7463 6869 6e67  ldcards matching
+000394e0: 2052 4f49 206e 616d 6573 2c20 616e 6420   ROI names, and 
+000394f0: 7468 6520 7661 6c75 6573 2073 686f 756c  the values shoul
+00039500: 6420 6265 2064 6573 6972 6564 200a 2020  d be desired .  
+00039510: 2020 2020 2020 2020 2020 636f 6c6f 7273            colors
+00039520: 2066 6f72 2052 4f49 7320 6d61 7463 6869   for ROIs matchi
+00039530: 6e67 2074 6861 7420 6e61 6d65 2e20 4966  ng that name. If
+00039540: 2061 206c 6973 742c 2073 686f 756c 6420   a list, should 
+00039550: 636f 6e74 6169 6e0a 2020 2020 2020 2020  contain.        
+00039560: 2020 2020 636f 6c6f 7273 2077 6869 6368      colors which
+00039570: 2077 696c 6c20 6265 2061 7070 6c69 6564   will be applied
+00039580: 2074 6f20 6c6f 6164 6564 2052 4f49 7320   to loaded ROIs 
+00039590: 696e 206f 7264 6572 2e0a 0a20 2020 2020  in order...     
+000395a0: 2020 2061 7574 6f5f 7469 6d65 7374 616d     auto_timestam
+000395b0: 7020 3a20 626f 6f6c 2064 6566 6175 6c74  p : bool default
+000395c0: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+000395d0: 2020 2049 6620 7472 7565 2061 6e64 206e     If true and n
+000395e0: 6f20 7661 6c69 6420 7469 6d65 7374 616d  o valid timestam
+000395f0: 7020 6973 2066 6f75 6e64 2077 6974 6869  p is found withi
+00039600: 6e20 7468 6520 7061 7468 2073 7472 696e  n the path strin
+00039610: 672c 0a20 2020 2020 2020 2020 2020 2074  g,.            t
+00039620: 696d 6573 7461 6d70 2067 656e 6572 6174  imestamp generat
+00039630: 6564 2066 726f 6d20 6375 7272 656e 7420  ed from current 
+00039640: 6461 7465 2061 6e64 2074 696d 652e 0a0a  date and time...
+00039650: 2020 2020 2020 2020 616c 7068 615f 6265          alpha_be
+00039660: 7461 5f72 6174 696f 7320 3a20 6469 6374  ta_ratios : dict
+00039670: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00039680: 2020 2020 2020 2020 2020 2044 6963 7469             Dicti
+00039690: 6f6e 6172 7920 7768 6572 6520 6b65 7973  onary where keys
+000396a0: 2061 7265 2052 4f49 206e 616d 6573 2061   are ROI names a
+000396b0: 6e64 2076 616c 7565 7320 6172 650a 2020  nd values are.  
+000396c0: 2020 2020 2020 2020 2020 7261 7469 6f73            ratios
+000396d0: 2066 6f72 2052 4f49 2074 6973 7375 6573   for ROI tissues
+000396e0: 206f 6620 636f 6566 6669 6369 656e 7473   of coefficients
+000396f0: 2c20 616c 7068 612c 2062 6574 612c 0a20  , alpha, beta,. 
+00039700: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
+00039710: 6520 6c69 6e65 6172 2d71 7561 6472 6174  e linear-quadrat
+00039720: 6963 2065 7175 6174 696f 6e2e 2020 5468  ic equation.  Th
+00039730: 6573 6520 7261 7469 6f73 2061 7265 0a20  ese ratios are. 
+00039740: 2020 2020 2020 2020 2020 2075 7365 6420             used 
+00039750: 696e 2063 616c 6375 6c61 7469 6e67 2062  in calculating b
+00039760: 696f 6c6f 6769 6361 6c6c 7920 6566 6665  iologically effe
+00039770: 6374 6976 6520 646f 7365 2c20 4245 442c  ctive dose, BED,
+00039780: 2066 726f 6d0a 2020 2020 2020 2020 2020   from.          
+00039790: 2020 7068 7973 6963 616c 2064 6f73 652c    physical dose,
+000397a0: 2044 2c20 6465 6c69 7665 7265 6420 6f76   D, delivered ov
+000397b0: 6572 206e 2065 7175 616c 2066 7261 6374  er n equal fract
+000397c0: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
+000397d0: 2020 2020 2020 4245 4420 3d20 4420 2a20        BED = D * 
+000397e0: 2831 202b 2028 442f 6e29 202f 2028 616c  (1 + (D/n) / (al
+000397f0: 7068 612f 6265 7461 2929 2e0a 2020 2020  pha/beta))..    
+00039800: 2020 2020 2020 2020 5468 6520 6174 7472          The attr
+00039810: 6962 7574 6520 616c 7068 615f 6f76 6572  ibute alpha_over
+00039820: 5f76 616c 7565 2069 7320 7365 7420 746f  _value is set to
+00039830: 2074 6865 2064 6963 7469 6f6e 6172 7920   the dictionary 
+00039840: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
+00039850: 2020 666f 7220 616e 2052 4f49 2069 6465    for an ROI ide
+00039860: 6e74 6966 6965 6420 6279 2061 206b 6579  ntified by a key
+00039870: 2c20 6f72 2069 7320 7365 7420 746f 204e  , or is set to N
+00039880: 6f6e 6520 666f 7220 616e 790a 2020 2020  one for any.    
+00039890: 2020 2020 2020 2020 6f74 6865 7220 524f          other RO
+000398a0: 4973 2e0a 0a20 2020 2020 2020 2060 2a2a  Is...        `**
+000398b0: 606b 7761 7267 7320 3a0a 2020 2020 2020  `kwargs :.      
+000398c0: 2020 2020 2020 4164 6469 7469 6f6e 616c        Additional
+000398d0: 206b 6579 776f 7264 2061 7267 7320 746f   keyword args to
+000398e0: 2075 7365 2077 6865 6e20 696e 6974 6961   use when initia
+000398f0: 6c69 7369 6e67 206e 6577 2052 4f49 206f  lising new ROI o
+00039900: 626a 6563 7473 2e0a 2020 2020 2020 2020  bjects..        
+00039910: 2222 220a 0a20 2020 2020 2020 2023 2043  """..        # C
+00039920: 6c6f 6e65 2066 726f 6d20 616e 6f74 6865  lone from anothe
+00039930: 7220 5374 7275 6374 7572 6553 6574 206f  r StructureSet o
+00039940: 626a 6563 740a 2020 2020 2020 2020 6966  bject.        if
+00039950: 2069 7373 7562 636c 6173 7328 7479 7065   issubclass(type
+00039960: 2870 6174 6829 2c20 5374 7275 6374 7572  (path), Structur
+00039970: 6553 6574 293a 0a20 2020 2020 2020 2020  eSet):.         
+00039980: 2020 2070 6174 682e 636c 6f6e 655f 6174     path.clone_at
+00039990: 7472 7328 7365 6c66 290a 2020 2020 2020  trs(self).      
+000399a0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+000399b0: 2020 2020 2020 7365 6c66 2e6e 616d 6520        self.name 
+000399c0: 3d20 6e61 6d65 0a20 2020 2020 2020 2070  = name.        p
+000399d0: 6174 6820 3d20 2873 6b72 742e 636f 7265  ath = (skrt.core
+000399e0: 2e66 756c 6c70 6174 6828 7061 7468 290a  .fullpath(path).
+000399f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039a00: 6966 2069 7369 6e73 7461 6e63 6528 7061  if isinstance(pa
+00039a10: 7468 2c20 2873 7472 2c20 5061 7468 2929  th, (str, Path))
+00039a20: 2065 6c73 6520 7061 7468 290a 2020 2020   else path).    
+00039a30: 2020 2020 7365 6c66 2e73 6f75 7263 6573      self.sources
+00039a40: 203d 2070 6174 680a 2020 2020 2020 2020   = path.        
+00039a50: 6966 2073 656c 662e 736f 7572 6365 7320  if self.sources 
+00039a60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00039a70: 2020 2020 2073 656c 662e 736f 7572 6365       self.source
+00039a80: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
+00039a90: 6c69 6620 6e6f 7420 736b 7274 2e63 6f72  lif not skrt.cor
+00039aa0: 652e 6973 5f6c 6973 7428 7061 7468 293a  e.is_list(path):
+00039ab0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00039ac0: 662e 736f 7572 6365 7320 3d20 5b70 6174  f.sources = [pat
+00039ad0: 685d 0a20 2020 2020 2020 2073 656c 662e  h].        self.
+00039ae0: 726f 6973 203d 205b 5d0a 2020 2020 2020  rois = [].      
+00039af0: 2020 7365 6c66 2e73 6574 5f69 6d61 6765    self.set_image
+00039b00: 2869 6d61 6765 290a 2020 2020 2020 2020  (image).        
+00039b10: 7365 6c66 2e74 6f5f 6b65 6570 203d 2074  self.to_keep = t
+00039b20: 6f5f 6b65 6570 0a20 2020 2020 2020 2073  o_keep.        s
+00039b30: 656c 662e 746f 5f72 656d 6f76 6520 3d20  elf.to_remove = 
+00039b40: 746f 5f72 656d 6f76 650a 2020 2020 2020  to_remove.      
+00039b50: 2020 7365 6c66 2e6e 616d 6573 203d 206e    self.names = n
+00039b60: 616d 6573 0a20 2020 2020 2020 2073 656c  ames.        sel
+00039b70: 662e 6b65 6570 5f72 656e 616d 6564 5f6f  f.keep_renamed_o
+00039b80: 6e6c 7920 3d20 6b65 6570 5f72 656e 616d  nly = keep_renam
+00039b90: 6564 5f6f 6e6c 790a 2020 2020 2020 2020  ed_only.        
+00039ba0: 7365 6c66 2e6d 756c 7469 5f6c 6162 656c  self.multi_label
+00039bb0: 203d 206d 756c 7469 5f6c 6162 656c 0a20   = multi_label. 
+00039bc0: 2020 2020 2020 2073 656c 662e 636f 6c6f         self.colo
+00039bd0: 7273 203d 2063 6f6c 6f72 730a 2020 2020  rs = colors.    
+00039be0: 2020 2020 7365 6c66 2e69 676e 6f72 655f      self.ignore_
+00039bf0: 6469 636f 6d5f 636f 6c6f 7273 203d 2069  dicom_colors = i
+00039c00: 676e 6f72 655f 6469 636f 6d5f 636f 6c6f  gnore_dicom_colo
+00039c10: 7273 0a20 2020 2020 2020 2073 656c 662e  rs.        self.
+00039c20: 6469 636f 6d5f 6461 7461 7365 7420 3d20  dicom_dataset = 
+00039c30: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
+00039c40: 662e 616c 7068 615f 6265 7461 5f72 6174  f.alpha_beta_rat
+00039c50: 696f 7320 3d20 616c 7068 615f 6265 7461  ios = alpha_beta
+00039c60: 5f72 6174 696f 7320 6f72 207b 7d0a 2020  _ratios or {}.  
+00039c70: 2020 2020 2020 7365 6c66 2e72 6f69 5f6b        self.roi_k
+00039c80: 7761 7267 7320 3d20 6b77 6172 6773 0a20  wargs = kwargs. 
+00039c90: 2020 2020 2020 2073 656c 662e 706c 616e         self.plan
+00039ca0: 7320 3d20 5b5d 0a20 2020 2020 2020 2070  s = [].        p
+00039cb0: 6174 6820 3d20 7061 7468 2069 6620 6973  ath = path if is
+00039cc0: 696e 7374 616e 6365 2870 6174 682c 2073  instance(path, s
+00039cd0: 7472 2920 656c 7365 2022 220a 2020 2020  tr) else "".    
+00039ce0: 2020 2020 736b 7274 2e63 6f72 652e 4172      skrt.core.Ar
+00039cf0: 6368 6976 652e 5f5f 696e 6974 5f5f 2873  chive.__init__(s
+00039d00: 656c 662c 2070 6174 682c 2061 7574 6f5f  elf, path, auto_
+00039d10: 7469 6d65 7374 616d 7029 0a20 2020 2020  timestamp).     
+00039d20: 2020 2069 6620 7365 6c66 2e70 6174 6820     if self.path 
+00039d30: 616e 6420 6e6f 7420 7365 6c66 2e6e 616d  and not self.nam
+00039d40: 653a 0a20 2020 2020 2020 2020 2020 206e  e:.            n
+00039d50: 616d 6520 3d20 5061 7468 2873 656c 662e  ame = Path(self.
+00039d60: 7061 7468 292e 6e61 6d65 2e73 706c 6974  path).name.split
+00039d70: 2827 5f27 295b 305d 2e6c 6f77 6572 2829  ('_')[0].lower()
+00039d80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00039d90: 6e61 6d65 5b30 5d2e 6973 616c 7068 6128  name[0].isalpha(
+00039da0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00039db0: 2020 2073 656c 662e 6e61 6d65 203d 206e     self.name = n
+00039dc0: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
+00039dd0: 2e73 756d 6d65 645f 6e61 6d65 7320 3d20  .summed_names = 
+00039de0: 5b5d 0a0a 2020 2020 2020 2020 7365 6c66  []..        self
+00039df0: 2e6c 6f61 6465 6420 3d20 4661 6c73 650a  .loaded = False.
+00039e00: 2020 2020 2020 2020 6966 206c 6f61 643a          if load:
+00039e10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00039e20: 662e 6c6f 6164 2829 0a0a 2020 2020 6465  f.load()..    de
+00039e30: 6620 5f5f 6765 7469 7465 6d5f 5f28 7365  f __getitem__(se
+00039e40: 6c66 2c20 726f 6929 3a0a 2020 2020 2020  lf, roi):.      
+00039e50: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00039e60: 726f 692c 2069 6e74 293a 0a20 2020 2020  roi, int):.     
+00039e70: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00039e80: 6c66 2e67 6574 5f72 6f69 7328 295b 726f  lf.get_rois()[ro
+00039e90: 695d 200a 2020 2020 2020 2020 656c 6966  i] .        elif
+00039ea0: 2069 7369 6e73 7461 6e63 6528 726f 692c   isinstance(roi,
+00039eb0: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+00039ec0: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
+00039ed0: 6574 5f72 6f69 5f64 6963 7428 295b 726f  et_roi_dict()[ro
+00039ee0: 695d 0a0a 2020 2020 6465 6620 5f5f 6974  i]..    def __it
+00039ef0: 6572 5f5f 2873 656c 6629 3a0a 2020 2020  er__(self):.    
+00039f00: 2020 2020 7265 7475 726e 2053 7472 7563      return Struc
+00039f10: 7475 7265 5365 7449 7465 7261 746f 7228  tureSetIterator(
+00039f20: 7365 6c66 290a 0a20 2020 2064 6566 205f  self)..    def _
+00039f30: 5f61 6464 5f5f 2873 656c 662c 206f 7468  _add__(self, oth
+00039f40: 6572 293a 0a20 2020 2020 2020 2027 2727  er):.        '''
+00039f50: 0a20 2020 2020 2020 2044 6566 696e 6520  .        Define 
+00039f60: 6164 6469 7469 6f6e 206f 6620 5374 7275  addition of Stru
+00039f70: 6374 7572 6553 6574 2069 6e73 7461 6e63  ctureSet instanc
+00039f80: 6573 2e0a 0a20 2020 2020 2020 2054 6865  es...        The
+00039f90: 2072 6573 756c 7420 6f66 2074 6865 2061   result of the a
+00039fa0: 6464 6974 696f 6e20 6f66 2073 656c 6620  ddition of self 
+00039fb0: 616e 6420 6f74 6865 7220 6973 2061 2053  and other is a S
+00039fc0: 7472 7563 7475 7265 5365 740a 2020 2020  tructureSet.    
+00039fd0: 2020 2020 6f62 6a65 6374 2074 6861 7420      object that 
+00039fe0: 636f 6e74 6169 6e73 2074 6865 2028 636c  contains the (cl
+00039ff0: 6f6e 6564 2920 524f 4973 206f 6620 626f  oned) ROIs of bo
+0003a000: 7468 2e20 2041 2072 6573 756c 7420 524f  th.  A result RO
+0003a010: 490a 2020 2020 2020 2020 7769 6c6c 2062  I.        will b
+0003a020: 6520 7072 6566 6978 6564 2062 7920 7468  e prefixed by th
+0003a030: 6520 6e61 6d65 206f 6620 7468 6520 5374  e name of the St
+0003a040: 7275 6374 7572 6553 6574 2066 726f 6d20  ructureSet from 
+0003a050: 7768 6963 6820 6974 0a20 2020 2020 2020  which it.       
+0003a060: 206f 7269 6769 6e61 7465 732e 2020 4966   originates.  If
+0003a070: 2074 6865 2052 4f49 206e 616d 6520 6265   the ROI name be
+0003a080: 666f 7265 2074 6865 2061 6464 6974 696f  fore the additio
+0003a090: 6e20 6861 7320 7468 6520 5374 7275 6374  n has the Struct
+0003a0a0: 7572 6553 6574 0a20 2020 2020 2020 206e  ureSet.        n
+0003a0b0: 616d 6520 6173 2070 7265 6669 782c 206e  ame as prefix, n
+0003a0c0: 6f20 6e65 7720 7072 6566 6978 2069 7320  o new prefix is 
+0003a0d0: 6164 6465 642e 2020 5468 6572 6520 6973  added.  There is
+0003a0e0: 206e 6f20 7265 7175 6972 656d 656e 740a   no requirement.
+0003a0f0: 2020 2020 2020 2020 7468 6174 2052 4f49          that ROI
+0003a100: 7320 6f72 2074 6865 6972 206e 616d 6573  s or their names
+0003a110: 2062 6520 756e 6971 7565 2077 6974 6869   be unique withi
+0003a120: 6e20 6120 5374 7275 6374 7572 6553 6574  n a StructureSet
+0003a130: 2e20 2041 6464 696e 670a 2020 2020 2020  .  Adding.      
+0003a140: 2020 6120 5374 7275 6374 7572 6553 6574    a StructureSet
+0003a150: 2074 6f20 6974 7365 6c66 2077 696c 6c20   to itself will 
+0003a160: 6769 7665 2061 2072 6573 756c 7420 696e  give a result in
+0003a170: 636c 7564 696e 6720 6475 706c 6963 6174  cluding duplicat
+0003a180: 650a 2020 2020 2020 2020 524f 4973 2077  e.        ROIs w
+0003a190: 6974 6820 6475 706c 6963 6174 6520 6e61  ith duplicate na
+0003a1a0: 6d65 732e 0a20 2020 2020 2020 2027 2727  mes..        '''
+0003a1b0: 0a20 2020 2020 2020 2023 2045 6e73 7572  .        # Ensur
+0003a1c0: 6520 7468 6174 2053 7472 7563 7475 7265  e that Structure
+0003a1d0: 5365 7420 6461 7461 2061 7265 206c 6f61  Set data are loa
+0003a1e0: 6465 642e 0a20 2020 2020 2020 2073 656c  ded..        sel
+0003a1f0: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+0003a200: 206f 7468 6572 2e6c 6f61 6428 290a 0a20   other.load().. 
+0003a210: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0003a220: 6e65 7720 5374 7275 6374 7572 6553 6574  new StructureSet
+0003a230: 2069 6e73 7461 6e63 6520 666f 7220 7375   instance for su
+0003a240: 6d2c 0a20 2020 2020 2020 2023 2061 6e64  m,.        # and
+0003a250: 2073 746f 7265 206e 616d 6573 206f 6620   store names of 
+0003a260: 636f 6e74 7269 6275 746f 7273 2e0a 2020  contributors..  
+0003a270: 2020 2020 2020 7265 7375 6c74 203d 2053        result = S
+0003a280: 7472 7563 7475 7265 5365 7428 290a 2020  tructureSet().  
+0003a290: 2020 2020 2020 7265 7375 6c74 2e73 756d        result.sum
+0003a2a0: 6d65 645f 6e61 6d65 7320 3d20 5b5d 0a20  med_names = []. 
+0003a2b0: 2020 2020 2020 2066 6f72 206e 616d 6573         for names
+0003a2c0: 2069 6e20 5b73 656c 662e 7375 6d6d 6564   in [self.summed
+0003a2d0: 5f6e 616d 6573 2c20 6f74 6865 722e 7375  _names, other.su
+0003a2e0: 6d6d 6564 5f6e 616d 6573 2c0a 2020 2020  mmed_names,.    
+0003a2f0: 2020 2020 2020 2020 2020 2020 5b73 656c              [sel
+0003a300: 662e 6e61 6d65 5d2c 205b 6f74 6865 722e  f.name], [other.
+0003a310: 6e61 6d65 5d5d 3a0a 2020 2020 2020 2020  name]]:.        
+0003a320: 2020 2020 666f 7220 6e61 6d65 2069 6e20      for name in 
+0003a330: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+0003a340: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0003a350: 616e 6365 286e 616d 652c 2073 7472 293a  ance(name, str):
+0003a360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a370: 2020 2020 2066 6f72 2073 7562 5f6e 616d       for sub_nam
+0003a380: 6520 696e 206e 616d 652e 7370 6c69 7428  e in name.split(
+0003a390: 225f 2229 3a0a 2020 2020 2020 2020 2020  "_"):.          
+0003a3a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003a3b0: 2073 7562 5f6e 616d 6520 6e6f 7420 696e   sub_name not in
+0003a3c0: 2072 6573 756c 742e 7375 6d6d 6564 5f6e   result.summed_n
+0003a3d0: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+0003a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a3f0: 2020 7265 7375 6c74 2e73 756d 6d65 645f    result.summed_
+0003a400: 6e61 6d65 732e 6170 7065 6e64 2873 7562  names.append(sub
+0003a410: 5f6e 616d 6529 0a20 2020 2020 2020 2072  _name).        r
+0003a420: 6573 756c 742e 7375 6d6d 6564 5f6e 616d  esult.summed_nam
+0003a430: 6573 2e73 6f72 7428 290a 0a20 2020 2020  es.sort()..     
+0003a440: 2020 2023 204c 6f6f 7020 6f76 6572 2053     # Loop over S
+0003a450: 7472 7563 7475 7265 5365 7473 2061 6e64  tructureSets and
+0003a460: 2074 6865 6972 2052 4f49 732e 0a20 2020   their ROIs..   
+0003a470: 2020 2020 2066 6f72 2073 7320 696e 205b       for ss in [
+0003a480: 7365 6c66 2c20 6f74 6865 725d 3a0a 2020  self, other]:.  
+0003a490: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
+0003a4a0: 6920 696e 2073 732e 6765 745f 726f 6973  i in ss.get_rois
+0003a4b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0003a4c0: 2020 2020 726f 695f 636c 6f6e 6520 3d20      roi_clone = 
+0003a4d0: 726f 692e 636c 6f6e 6528 290a 2020 2020  roi.clone().    
+0003a4e0: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
+0003a4f0: 7920 746f 2070 7265 6669 7820 524f 4920  y to prefix ROI 
+0003a500: 6e61 6d65 2077 6974 6820 7468 6520 6e61  name with the na
+0003a510: 6d65 206f 6620 7468 6520 5374 7275 6374  me of the Struct
+0003a520: 7572 6553 6574 0a20 2020 2020 2020 2020  ureSet.         
+0003a530: 2020 2020 2020 2023 2066 726f 6d20 7768         # from wh
+0003a540: 6963 6820 6974 206f 7269 6769 6e61 7465  ich it originate
+0003a550: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+0003a560: 2020 2069 6620 2872 6f69 2e6e 616d 652e     if (roi.name.
+0003a570: 7370 6c69 7428 225f 2229 5b30 5d20 696e  split("_")[0] in
+0003a580: 2072 6573 756c 742e 7375 6d6d 6564 5f6e   result.summed_n
+0003a590: 616d 6573 0a20 2020 2020 2020 2020 2020  ames.           
+0003a5a0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+0003a5b0: 7373 2e6e 616d 6520 6973 204e 6f6e 6529  ss.name is None)
+0003a5c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a5d0: 2020 2020 2020 726f 695f 636c 6f6e 652e        roi_clone.
+0003a5e0: 6e61 6d65 203d 2072 6f69 2e6e 616d 650a  name = roi.name.
+0003a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a600: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0003a610: 2020 2020 2020 2020 2020 726f 695f 636c            roi_cl
+0003a620: 6f6e 652e 6e61 6d65 203d 2022 5f22 2e6a  one.name = "_".j
+0003a630: 6f69 6e28 5b73 732e 6e61 6d65 2c20 726f  oin([ss.name, ro
+0003a640: 692e 6e61 6d65 5d29 0a20 2020 2020 2020  i.name]).       
+0003a650: 2020 2020 2020 2020 2023 2041 6464 2052           # Add R
+0003a660: 4f49 2074 6f20 7468 6520 7265 7375 6c74  OI to the result
+0003a670: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003a680: 2020 7265 7375 6c74 2e61 6464 5f72 6f69    result.add_roi
+0003a690: 2872 6f69 5f63 6c6f 6e65 290a 0a20 2020  (roi_clone)..   
+0003a6a0: 2020 2020 2023 2041 7320 7265 7375 6c74       # As result
+0003a6b0: 2069 6d61 6765 2073 6574 2074 6865 2069   image set the i
+0003a6c0: 6d61 6765 206f 6620 7365 6c66 2069 6620  mage of self if 
+0003a6d0: 6e6f 6e2d 6e75 6c6c 2c0a 2020 2020 2020  non-null,.      
+0003a6e0: 2020 2320 6f72 206f 7468 7769 7365 2074    # or othwise t
+0003a6f0: 6865 2069 6d61 6765 206f 6620 6f74 6865  he image of othe
+0003a700: 722e 0a20 2020 2020 2020 2069 6d61 6765  r..        image
+0003a710: 203d 2073 656c 662e 696d 6167 6520 6966   = self.image if
+0003a720: 2073 656c 662e 696d 6167 6520 656c 7365   self.image else
+0003a730: 206f 7468 6572 2e69 6d61 6765 0a20 2020   other.image.   
+0003a740: 2020 2020 2072 6573 756c 742e 7365 745f       result.set_
+0003a750: 696d 6167 6528 696d 6167 6529 0a0a 2020  image(image)..  
+0003a760: 2020 2020 2020 2320 5365 7420 7468 6520        # Set the 
+0003a770: 7265 7375 6c74 206e 616d 6520 746f 2062  result name to b
+0003a780: 6520 7468 6520 636f 6e63 6174 656e 6174  e the concatenat
+0003a790: 696f 6e20 6f66 2074 6865 206e 616d 6573  ion of the names
+0003a7a0: 0a20 2020 2020 2020 2023 206f 6620 7468  .        # of th
+0003a7b0: 6520 636f 6e74 7269 6275 746f 7273 2e0a  e contributors..
+0003a7c0: 2020 2020 2020 2020 6966 2072 6573 756c          if resul
+0003a7d0: 742e 7375 6d6d 6564 5f6e 616d 6573 3a0a  t.summed_names:.
+0003a7e0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0003a7f0: 6c74 2e6e 616d 6520 3d20 225f 222e 6a6f  lt.name = "_".jo
+0003a800: 696e 2872 6573 756c 742e 7375 6d6d 6564  in(result.summed
+0003a810: 5f6e 616d 6573 290a 0a20 2020 2020 2020  _names)..       
+0003a820: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+0003a830: 2020 2020 6465 6620 5f5f 6961 6464 5f5f      def __iadd__
+0003a840: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+0003a850: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+0003a860: 2020 2044 6566 696e 6520 696e 2d70 6c61     Define in-pla
+0003a870: 6365 206f 6620 5374 7275 6374 7572 6553  ce of StructureS
+0003a880: 6574 2069 6e73 7461 6e63 6573 2e0a 0a20  et instances... 
+0003a890: 2020 2020 2020 2054 6865 2072 6573 756c         The resul
+0003a8a0: 7420 6f66 2074 6865 2061 6464 6974 696f  t of the additio
+0003a8b0: 6e20 6f66 2073 656c 6620 616e 6420 6f74  n of self and ot
+0003a8c0: 6865 7220 6973 2061 2053 7472 7563 7475  her is a Structu
+0003a8d0: 7265 5365 740a 2020 2020 2020 2020 6f62  reSet.        ob
+0003a8e0: 6a65 6374 2074 6861 7420 636f 6e74 6169  ject that contai
+0003a8f0: 6e73 2074 6865 2028 636c 6f6e 6564 2920  ns the (cloned) 
+0003a900: 524f 4973 206f 6620 626f 7468 2e20 2041  ROIs of both.  A
+0003a910: 2072 6573 756c 7420 524f 490a 2020 2020   result ROI.    
+0003a920: 2020 2020 7769 6c6c 2062 6520 7072 6566      will be pref
+0003a930: 6978 6564 2062 7920 7468 6520 6e61 6d65  ixed by the name
+0003a940: 206f 6620 7468 6520 5374 7275 6374 7572   of the Structur
+0003a950: 6553 6574 2066 726f 6d20 7768 6963 6820  eSet from which 
+0003a960: 6974 0a20 2020 2020 2020 206f 7269 6769  it.        origi
+0003a970: 6e61 7465 732e 2020 4966 2074 6865 2052  nates.  If the R
+0003a980: 4f49 206e 616d 6520 6265 666f 7265 2074  OI name before t
+0003a990: 6865 2061 6464 6974 696f 6e20 6861 7320  he addition has 
+0003a9a0: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
+0003a9b0: 0a20 2020 2020 2020 206e 616d 6520 6173  .        name as
+0003a9c0: 2070 7265 6669 782c 206e 6f20 6e65 7720   prefix, no new 
+0003a9d0: 7072 6566 6978 2069 7320 6164 6465 642e  prefix is added.
+0003a9e0: 2020 5468 6572 6520 6973 206e 6f20 7265    There is no re
+0003a9f0: 7175 6972 656d 656e 740a 2020 2020 2020  quirement.      
+0003aa00: 2020 7468 6174 2052 4f49 7320 6f72 2074    that ROIs or t
+0003aa10: 6865 6972 206e 616d 6573 2062 6520 756e  heir names be un
+0003aa20: 6971 7565 2077 6974 6869 6e20 6120 5374  ique within a St
+0003aa30: 7275 6374 7572 6553 6574 2e20 2041 6464  ructureSet.  Add
+0003aa40: 696e 670a 2020 2020 2020 2020 6120 5374  ing.        a St
+0003aa50: 7275 6374 7572 6553 6574 2074 6f20 6974  ructureSet to it
+0003aa60: 7365 6c66 2077 696c 6c20 6769 7665 2061  self will give a
+0003aa70: 2072 6573 756c 7420 696e 636c 7564 696e   result includin
+0003aa80: 6720 6475 706c 6963 6174 650a 2020 2020  g duplicate.    
+0003aa90: 2020 2020 524f 4973 2077 6974 6820 6475      ROIs with du
+0003aaa0: 706c 6963 6174 6520 6e61 6d65 732e 0a20  plicate names.. 
+0003aab0: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+0003aac0: 2020 2072 6574 7572 6e20 7365 6c66 202b     return self +
+0003aad0: 206f 7468 6572 0a0a 2020 2020 6465 6620   other..    def 
+0003aae0: 6c6f 6164 2873 656c 662c 2073 6f75 7263  load(self, sourc
+0003aaf0: 6573 3d4e 6f6e 652c 2066 6f72 6365 3d46  es=None, force=F
+0003ab00: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+0003ab10: 2222 4c6f 6164 2073 7472 7563 7475 7265  ""Load structure
+0003ab20: 2073 6574 2066 726f 6d20 736f 7572 6365   set from source
+0003ab30: 2873 292e 2049 6620 4e6f 6e65 2c20 7769  (s). If None, wi
+0003ab40: 6c6c 206c 6f61 6420 6672 6f6d 206f 776e  ll load from own
+0003ab50: 0a20 2020 2020 2020 2073 656c 662e 736f  .        self.so
+0003ab60: 7572 6365 732e 2222 220a 0a20 2020 2020  urces."""..     
+0003ab70: 2020 2069 6620 7365 6c66 2e6c 6f61 6465     if self.loade
+0003ab80: 6420 616e 6420 6e6f 7420 666f 7263 6520  d and not force 
+0003ab90: 616e 6420 736f 7572 6365 7320 6973 204e  and sources is N
+0003aba0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0003abb0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+0003abc0: 2069 6620 736f 7572 6365 7320 6973 204e   if sources is N
+0003abd0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0003abe0: 2073 6f75 7263 6573 203d 2073 656c 662e   sources = self.
+0003abf0: 736f 7572 6365 730a 0a20 2020 2020 2020  sources..       
+0003ac00: 2023 204c 616f 6420 6672 6f6d 206d 756c   # Laod from mul
+0003ac10: 7469 2d6c 6162 656c 2061 7272 6179 0a20  ti-label array. 
+0003ac20: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
+0003ac30: 756c 7469 5f6c 6162 656c 3a0a 0a20 2020  ulti_label:..   
+0003ac40: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0003ac50: 7374 616e 6365 2873 6f75 7263 6573 2c20  stance(sources, 
+0003ac60: 6c69 7374 2920 616e 6420 6c65 6e28 736f  list) and len(so
+0003ac70: 7572 6365 7329 203d 3d20 313a 0a20 2020  urces) == 1:.   
+0003ac80: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
+0003ac90: 7263 6573 203d 2073 6f75 7263 6573 5b30  rces = sources[0
+0003aca0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+0003acb0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0003acc0: 736f 7572 6365 732c 2073 7472 2920 616e  sources, str) an
+0003acd0: 6420 6e6f 7420 6973 696e 7374 616e 6365  d not isinstance
+0003ace0: 2873 6f75 7263 6573 2c20 6e70 2e6e 6461  (sources, np.nda
+0003acf0: 7272 6179 293a 0a20 2020 2020 2020 2020  rray):.         
+0003ad00: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0003ad10: 6545 7272 6f72 2822 496e 7075 7420 666f  eError("Input fo
+0003ad20: 7220 6120 6d75 6c74 692d 6c61 6265 6c20  r a multi-label 
+0003ad30: 696d 6167 6520 6d75 7374 2062 6520 6669  image must be fi
+0003ad40: 6c65 7061 7468 2022 0a20 2020 2020 2020  lepath ".       
 0003ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ad60: 696d 6167 653d 7365 6c66 2e69 6d61 6765  image=self.image
-0003ad70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0003ad80: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0003ad90: 7365 6c66 2e72 6f69 5f6b 7761 7267 730a  self.roi_kwargs.
-0003ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003adb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0003adc0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0003add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ade0: 2020 2020 7365 6c66 2e72 6f69 735b 2d31      self.rois[-1
-0003adf0: 5d2e 6469 636f 6d5f 6461 7461 7365 7420  ].dicom_dataset 
-0003ae00: 3d20 6473 0a20 2020 2020 2020 2020 2020  = ds.           
-0003ae10: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
-0003ae20: 6973 5b2d 315d 2e6e 756d 6265 7220 3d20  is[-1].number = 
-0003ae30: 6e75 6d62 6572 0a20 2020 2020 2020 2020  number.         
-0003ae40: 2020 2020 2020 2073 656c 662e 6469 636f         self.dico
-0003ae50: 6d5f 6461 7461 7365 7420 3d20 6473 0a0a  m_dataset = ds..
-0003ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ae70: 2320 4175 746f 2d61 7373 6967 6e20 6e61  # Auto-assign na
-0003ae80: 6d65 2066 726f 6d20 6469 636f 6d20 6669  me from dicom fi
-0003ae90: 6c65 6e61 6d65 0a20 2020 2020 2020 2020  lename.         
-0003aea0: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
-0003aeb0: 5f73 6f75 7263 6520 616e 6420 7365 6c66  _source and self
-0003aec0: 2e6e 616d 6520 6973 204e 6f6e 653a 0a20  .name is None:. 
-0003aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aee0: 2020 2073 656c 662e 6e61 6d65 203d 206f     self.name = o
-0003aef0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0003af00: 736f 7572 6365 292e 7265 706c 6163 6528  source).replace(
-0003af10: 222e 6463 6d22 2c20 2222 290a 0a20 2020  ".dcm", "")..   
-0003af20: 2020 2020 2020 2020 2023 204c 6f61 6420           # Load 
-0003af30: 6672 6f6d 2052 4f49 206d 6173 6b0a 2020  from ROI mask.  
-0003af40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0003af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003af60: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0003af70: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
-0003af80: 6973 2e61 7070 656e 6428 524f 4928 0a20  is.append(ROI(. 
-0003af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003afa0: 2020 2020 2020 2073 6f75 7263 652c 200a         source, .
-0003afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003afc0: 2020 2020 2020 2020 696d 6167 653d 7365          image=se
-0003afd0: 6c66 2e69 6d61 6765 2c0a 2020 2020 2020  lf.image,.      
-0003afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aff0: 2020 2a2a 7365 6c66 2e72 6f69 5f6b 7761    **self.roi_kwa
-0003b000: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-0003b010: 2020 2020 2020 2020 2929 0a20 2020 2020          )).     
-0003b020: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0003b030: 7420 5275 6e74 696d 6545 7272 6f72 3a0a  t RuntimeError:.
-0003b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b050: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-0003b060: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
-0003b070: 6420 3d20 5472 7565 0a0a 2020 2020 2020  d = True..      
-0003b080: 2020 7365 6c66 2e72 656e 616d 655f 726f    self.rename_ro
-0003b090: 6973 286b 6565 705f 7265 6e61 6d65 645f  is(keep_renamed_
-0003b0a0: 6f6e 6c79 3d73 656c 662e 6b65 6570 5f72  only=self.keep_r
-0003b0b0: 656e 616d 6564 5f6f 6e6c 7929 0a20 2020  enamed_only).   
-0003b0c0: 2020 2020 2073 656c 662e 6669 6c74 6572       self.filter
-0003b0d0: 5f72 6f69 7328 290a 2020 2020 2020 2020  _rois().        
-0003b0e0: 7365 6c66 2e72 6563 6f6c 6f72 5f72 6f69  self.recolor_roi
-0003b0f0: 7328 7365 6c66 2e63 6f6c 6f72 7329 0a20  s(self.colors). 
-0003b100: 2020 2020 2020 2073 6c69 6365 5f74 6869         slice_thi
-0003b110: 636b 6e65 7373 6573 203d 205b 5d0a 2020  cknesses = [].  
-0003b120: 2020 2020 2020 726f 6973 203d 205b 5d0a        rois = [].
-0003b130: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
-0003b140: 696e 2073 656c 662e 726f 6973 3a0a 2020  in self.rois:.  
-0003b150: 2020 2020 2020 2020 2020 726f 692e 7374            roi.st
-0003b160: 7275 6374 7572 655f 7365 7420 3d20 7365  ructure_set = se
-0003b170: 6c66 0a20 2020 2020 2020 2020 2020 2072  lf.            r
-0003b180: 6f69 2e73 6574 5f61 6c70 6861 5f6f 7665  oi.set_alpha_ove
-0003b190: 725f 6265 7461 2873 656c 662e 616c 7068  r_beta(self.alph
-0003b1a0: 615f 6265 7461 5f72 6174 696f 732e 6765  a_beta_ratios.ge
-0003b1b0: 7428 726f 692e 6e61 6d65 2c20 4e6f 6e65  t(roi.name, None
-0003b1c0: 2929 0a20 2020 2020 2020 2020 2020 2066  )).            f
-0003b1d0: 6f72 2070 6c61 6e20 696e 2073 656c 662e  or plan in self.
-0003b1e0: 706c 616e 733a 0a20 2020 2020 2020 2020  plans:.         
-0003b1f0: 2020 2020 2020 2072 6f69 2e61 6464 5f70         roi.add_p
-0003b200: 6c61 6e28 706c 616e 290a 0a20 2020 2020  lan(plan)..     
-0003b210: 2020 2020 2020 2069 6620 726f 692e 736f         if roi.so
-0003b220: 7572 6365 5f74 7970 6520 3d3d 2022 636f  urce_type == "co
-0003b230: 6e74 6f75 7222 3a0a 2020 2020 2020 2020  ntour":.        
-0003b240: 2020 2020 2020 2020 6966 2072 6f69 2e73          if roi.s
-0003b250: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
-0003b260: 6f6e 746f 7572 7320 6973 206e 6f74 204e  ontours is not N
-0003b270: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0003b280: 2020 2020 2020 2020 2073 6c69 6365 5f74           slice_t
-0003b290: 6869 636b 6e65 7373 6573 2e61 7070 656e  hicknesses.appen
-0003b2a0: 6428 726f 692e 736c 6963 655f 7468 6963  d(roi.slice_thic
-0003b2b0: 6b6e 6573 735f 636f 6e74 6f75 7273 290a  kness_contours).
-0003b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b2d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003b2e0: 2020 2020 2020 2020 2020 726f 6973 2e61            rois.a
-0003b2f0: 7070 656e 6428 726f 6929 0a0a 2020 2020  ppend(roi)..    
-0003b300: 2020 2020 2320 4966 2073 6c69 6365 2074      # If slice t
-0003b310: 6869 636b 6e65 7373 2069 736e 2774 2073  hickness isn't s
-0003b320: 6574 2066 6f72 2061 6e20 524f 4920 6672  et for an ROI fr
-0003b330: 6f6d 2063 6f6e 746f 7572 732c 0a20 2020  om contours,.   
-0003b340: 2020 2020 2023 2073 6574 2069 7473 2074       # set its t
-0003b350: 6869 636b 6e65 7373 2074 6f20 7468 6520  hickness to the 
-0003b360: 6d69 6e69 6d75 6d20 666f 7220 616c 6c20  minimum for all 
-0003b370: 6f74 6865 7220 524f 4973 0a20 2020 2020  other ROIs.     
-0003b380: 2020 2023 2069 6e20 7468 6520 7374 7275     # in the stru
-0003b390: 6374 7572 6520 7365 742e 0a20 2020 2020  cture set..     
-0003b3a0: 2020 2069 6620 726f 6973 2061 6e64 2073     if rois and s
-0003b3b0: 6c69 6365 5f74 6869 636b 6e65 7373 6573  lice_thicknesses
-0003b3c0: 3a0a 2020 2020 2020 2020 2020 2020 736c  :.            sl
-0003b3d0: 6963 655f 7468 6963 6b6e 6573 7320 3d20  ice_thickness = 
-0003b3e0: 6d69 6e28 736c 6963 655f 7468 6963 6b6e  min(slice_thickn
-0003b3f0: 6573 7365 7329 0a20 2020 2020 2020 2020  esses).         
-0003b400: 2020 2066 6f72 2072 6f69 2069 6e20 726f     for roi in ro
-0003b410: 6973 3a0a 2020 2020 2020 2020 2020 2020  is:.            
-0003b420: 2020 2020 726f 692e 736c 6963 655f 7468      roi.slice_th
-0003b430: 6963 6b6e 6573 735f 636f 6e74 6f75 7273  ickness_contours
-0003b440: 203d 2073 6c69 6365 5f74 6869 636b 6e65   = slice_thickne
-0003b450: 7373 0a0a 2020 2020 6465 6620 6765 745f  ss..    def get_
-0003b460: 6469 636f 6d5f 6461 7461 7365 7428 7365  dicom_dataset(se
-0003b470: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0003b480: 5265 7475 726e 2070 7964 6963 6f6d 2e64  Return pydicom.d
-0003b490: 6174 6173 6574 2e46 696c 6544 6174 6173  ataset.FileDatas
-0003b4a0: 6574 206f 626a 6563 7420 6173 736f 6369  et object associ
-0003b4b0: 6174 6564 2077 6974 6820 7468 6973 2049  ated with this I
-0003b4c0: 6d61 6765 2c0a 2020 2020 2020 2020 6966  mage,.        if
-0003b4d0: 206c 6f61 6465 6420 6672 6f6d 2064 6963   loaded from dic
-0003b4e0: 6f6d 3b20 6f74 6865 7277 6973 652c 2072  om; otherwise, r
-0003b4f0: 6574 7572 6e20 4e6f 6e65 2e22 2222 0a0a  eturn None."""..
-0003b500: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-0003b510: 6428 290a 2020 2020 2020 2020 7265 7475  d().        retu
-0003b520: 726e 2073 656c 662e 6469 636f 6d5f 6461  rn self.dicom_da
-0003b530: 7461 7365 740a 0a20 2020 2064 6566 2072  taset..    def r
-0003b540: 6573 6574 2873 656c 6629 3a0a 2020 2020  eset(self):.    
-0003b550: 2020 2020 2222 2252 656c 6f61 6420 7374      """Reload st
-0003b560: 7275 6374 7572 6520 7365 7420 6672 6f6d  ructure set from
-0003b570: 206f 7269 6769 6e61 6c20 736f 7572 6365   original source
-0003b580: 2873 292e 2222 220a 0a20 2020 2020 2020  (s)."""..       
-0003b590: 2073 656c 662e 726f 6973 203d 205b 5d0a   self.rois = [].
-0003b5a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-0003b5b0: 6465 6420 3d20 4661 6c73 650a 2020 2020  ded = False.    
-0003b5c0: 2020 2020 7365 6c66 2e6c 6f61 6428 666f      self.load(fo
-0003b5d0: 7263 653d 5472 7565 290a 0a20 2020 2064  rce=True)..    d
-0003b5e0: 6566 2072 6573 6574 5f63 6f6e 746f 7572  ef reset_contour
-0003b5f0: 7328 7365 6c66 2c20 636f 6e74 6f75 7273  s(self, contours
-0003b600: 3d4e 6f6e 652c 206d 6f73 745f 706f 696e  =None, most_poin
-0003b610: 7473 3d46 616c 7365 293a 0a20 2020 2020  ts=False):.     
-0003b620: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-0003b630: 6573 6574 2078 2d79 2063 6f6e 746f 7572  eset x-y contour
-0003b640: 7320 666f 7220 524f 4973 206f 6620 7374  s for ROIs of st
-0003b650: 7275 6374 7572 6520 7365 742e 0a0a 2020  ructure set...  
-0003b660: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0003b670: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
-0003b680: 2020 2020 2020 2063 6f6e 746f 7572 7320         contours 
-0003b690: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
-0003b6a0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0003b6b0: 2044 6963 7469 6f6e 6172 7920 7768 6572   Dictionary wher
-0003b6c0: 6520 6b65 7973 2061 7265 2052 4f49 206e  e keys are ROI n
-0003b6d0: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
-0003b6e0: 6172 6520 6469 6374 696f 6e61 7269 6573  are dictionaries
-0003b6f0: 0a20 2020 2020 2020 2020 2020 206f 6620  .            of 
-0003b700: 736c 6963 6520 616e 6420 636f 6e74 6f75  slice and contou
-0003b710: 7220 6c69 7374 732e 2020 4966 204e 6f6e  r lists.  If Non
-0003b720: 652c 2061 6e20 656d 7074 7920 6469 6374  e, an empty dict
-0003b730: 696f 6e61 7279 2069 730a 2020 2020 2020  ionary is.      
-0003b740: 2020 2020 2020 7573 6564 2e20 2049 6620        used.  If 
-0003b750: 616e 2052 4f49 2068 6173 2061 206e 616d  an ROI has a nam
-0003b760: 6520 6e6f 7420 696e 636c 7564 6564 2069  e not included i
-0003b770: 6e20 7468 6520 746f 702d 6c65 7665 6c0a  n the top-level.
-0003b780: 2020 2020 2020 2020 2020 2020 6469 6374              dict
-0003b790: 696f 6e61 7279 2c20 6f72 2068 6173 2061  ionary, or has a
-0003b7a0: 206e 616d 6520 7769 7468 2061 7373 6f63   name with assoc
-0003b7b0: 6961 7465 6420 7661 6c75 6520 4e6f 6e65  iated value None
-0003b7c0: 2c20 7468 650a 2020 2020 2020 2020 2020  , the.          
-0003b7d0: 2020 524f 4920 636f 6e74 6f75 7273 2077    ROI contours w
-0003b7e0: 696c 6c20 6265 2072 6573 6574 2075 7369  ill be reset usi
-0003b7f0: 6e67 2074 6865 2052 4f49 2773 206f 776e  ng the ROI's own
-0003b800: 2078 2d79 2063 6f6e 746f 7572 732e 0a0a   x-y contours...
-0003b810: 2020 2020 2020 2020 6d6f 7374 5f70 6f69          most_poi
-0003b820: 6e74 7320 3a20 626f 6f6c 2c20 6465 6661  nts : bool, defa
-0003b830: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-0003b840: 2020 2020 2020 4966 2054 7275 652c 206f        If True, o
-0003b850: 6e6c 7920 7468 6520 636f 6e74 6f75 7220  nly the contour 
-0003b860: 7769 7468 206d 6f73 7420 706f 696e 7473  with most points
-0003b870: 2066 6f72 2065 6163 6820 736c 6963 650a   for each slice.
-0003b880: 2020 2020 2020 2020 2020 2020 6973 2072              is r
-0003b890: 6574 6169 6e65 6420 6166 7465 7220 7265  etained after re
-0003b8a0: 7365 7474 696e 672e 2020 4966 2046 616c  setting.  If Fal
-0003b8b0: 7365 2c20 616c 6c20 636f 6e74 6f75 7273  se, all contours
-0003b8c0: 2066 6f72 2065 6163 680a 2020 2020 2020   for each.      
-0003b8d0: 2020 2020 2020 736c 6963 6520 6172 6520        slice are 
-0003b8e0: 7265 7461 696e 6564 2e0a 2020 2020 2020  retained..      
-0003b8f0: 2020 2222 220a 2020 2020 2020 2020 636f    """.        co
-0003b900: 6e74 6f75 7273 203d 2063 6f6e 746f 7572  ntours = contour
-0003b910: 7320 6f72 207b 7d0a 2020 2020 2020 2020  s or {}.        
-0003b920: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
-0003b930: 6765 745f 726f 6973 2829 3a0a 2020 2020  get_rois():.    
-0003b940: 2020 2020 2020 2020 726f 692e 7265 7365          roi.rese
-0003b950: 745f 636f 6e74 6f75 7273 2863 6f6e 746f  t_contours(conto
-0003b960: 7572 732e 6765 7428 726f 692e 6e61 6d65  urs.get(roi.name
-0003b970: 2c20 4e6f 6e65 292c 206d 6f73 745f 706f  , None), most_po
-0003b980: 696e 7473 290a 0a20 2020 2064 6566 2073  ints)..    def s
-0003b990: 6574 5f69 6d61 6765 5f74 6f5f 6475 6d6d  et_image_to_dumm
-0003b9a0: 7928 7365 6c66 2c20 2a2a 6b77 6172 6773  y(self, **kwargs
-0003b9b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0003b9c0: 2020 2020 2020 2053 6574 2069 6d61 6765         Set image
-0003b9d0: 2066 6f72 2073 656c 6620 616e 6420 616c   for self and al
-0003b9e0: 6c20 524f 4973 2074 6f20 6265 2061 2064  l ROIs to be a d
-0003b9f0: 756d 6d79 2069 6d61 6765 2063 6f76 6572  ummy image cover
-0003ba00: 696e 670a 2020 2020 2020 2020 7468 6520  ing.        the 
-0003ba10: 7265 6769 6f6e 2063 6f6e 7461 696e 696e  region containin
-0003ba20: 6720 616c 6c20 524f 4973 2069 6e20 7468  g all ROIs in th
-0003ba30: 6520 7374 7275 6374 7572 6520 7365 742e  e structure set.
-0003ba40: 2020 5468 6520 6d61 736b 0a20 2020 2020    The mask.     
-0003ba50: 2020 2061 6e64 2078 2d7a 2f79 2d7a 2063     and x-z/y-z c
-0003ba60: 6f6e 746f 7572 7320 6f66 2065 6163 6820  ontours of each 
-0003ba70: 524f 4920 7769 6c6c 2062 6520 636c 6561  ROI will be clea
-0003ba80: 7265 642c 2073 6f20 7468 6174 2074 6865  red, so that the
-0003ba90: 790a 2020 2020 2020 2020 7769 6c6c 2062  y.        will b
-0003baa0: 6520 7265 6372 6561 7465 6420 7768 656e  e recreated when
-0003bab0: 2067 6574 5f6d 6173 6b28 2920 6f72 2067   get_mask() or g
-0003bac0: 6574 5f63 6f6e 746f 7572 7328 2920 6172  et_contours() ar
-0003bad0: 6520 6e65 7874 2063 616c 6c65 642e 0a0a  e next called...
-0003bae0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0003baf0: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
-0003bb00: 0a20 2020 2020 2020 206b 7761 7267 7320  .        kwargs 
-0003bb10: 3a20 0a20 2020 2020 2020 2020 2020 204b  : .            K
-0003bb20: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-0003bb30: 2074 6f20 7061 7373 2074 6f20 7365 6c66   to pass to self
-0003bb40: 2e67 6574 5f64 756d 6d79 5f69 6d61 6765  .get_dummy_image
-0003bb50: 2829 2077 6865 6e0a 2020 2020 2020 2020  () when.        
-0003bb60: 2020 2020 6372 6561 7469 6e67 2074 6865      creating the
-0003bb70: 2064 756d 6d79 2069 6d61 6765 2e20 5365   dummy image. Se
-0003bb80: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-0003bb90: 6f66 0a20 2020 2020 2020 2020 2020 2053  of.            S
-0003bba0: 7472 7563 7475 7265 5365 742e 6765 745f  tructureSet.get_
-0003bbb0: 6475 6d6d 795f 696d 6167 6528 292e 0a20  dummy_image().. 
-0003bbc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0003bbd0: 2320 4d61 6b65 2069 6d61 6765 0a20 2020  # Make image.   
-0003bbe0: 2020 2020 2069 6d20 3d20 7365 6c66 2e67       im = self.g
-0003bbf0: 6574 5f64 756d 6d79 5f69 6d61 6765 282a  et_dummy_image(*
-0003bc00: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
-0003bc10: 2020 2320 436c 6561 7220 6d61 736b 2061    # Clear mask a
-0003bc20: 6e64 2063 6f6e 746f 7572 730a 2020 2020  nd contours.    
-0003bc30: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
-0003bc40: 656c 662e 726f 6973 3a0a 2020 2020 2020  elf.rois:.      
-0003bc50: 2020 2020 2020 726f 692e 696e 7075 745f        roi.input_
-0003bc60: 636f 6e74 6f75 7273 203d 2072 6f69 2e67  contours = roi.g
-0003bc70: 6574 5f63 6f6e 746f 7572 7328 2278 2d79  et_contours("x-y
-0003bc80: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-0003bc90: 6f69 2e63 6f6e 746f 7572 7320 3d20 7b22  oi.contours = {"
-0003bca0: 782d 7922 3a20 726f 692e 696e 7075 745f  x-y": roi.input_
-0003bcb0: 636f 6e74 6f75 7273 7d0a 2020 2020 2020  contours}.      
-0003bcc0: 2020 2020 2020 726f 692e 6c6f 6164 6564        roi.loaded
-0003bcd0: 5f6d 6173 6b20 3d20 4661 6c73 650a 2020  _mask = False.  
-0003bce0: 2020 2020 2020 2020 2020 726f 692e 6d61            roi.ma
-0003bcf0: 736b 203d 204e 6f6e 650a 0a20 2020 2020  sk = None..     
-0003bd00: 2020 2023 2041 7373 6967 6e20 696d 6167     # Assign imag
-0003bd10: 650a 2020 2020 2020 2020 7365 6c66 2e73  e.        self.s
-0003bd20: 6574 5f69 6d61 6765 2869 6d29 0a0a 2020  et_image(im)..  
-0003bd30: 2020 6465 6620 7365 745f 696d 6167 6528    def set_image(
-0003bd40: 7365 6c66 2c20 696d 6167 652c 2061 6464  self, image, add
-0003bd50: 5f74 6f5f 696d 6167 653d 5472 7565 293a  _to_image=True):
-0003bd60: 0a20 2020 2020 2020 2022 2222 5365 7420  .        """Set 
-0003bd70: 696d 6167 6520 666f 7220 7365 6c66 2061  image for self a
-0003bd80: 6e64 2061 6c6c 2052 4f49 732e 0a20 2020  nd all ROIs..   
-0003bd90: 2020 2020 2049 6620 6164 645f 746f 5f69       If add_to_i
-0003bda0: 6d61 6765 2069 7320 5472 7565 2c20 696d  mage is True, im
-0003bdb0: 6167 652e 6164 645f 7374 7275 6374 7572  age.add_structur
-0003bdc0: 655f 7365 7428 7365 6c66 290a 2020 2020  e_set(self).    
-0003bdd0: 2020 2020 7769 6c6c 2061 6c73 6f20 6265      will also be
-0003bde0: 2063 616c 6c65 642e 2222 220a 0a20 2020   called."""..   
-0003bdf0: 2020 2020 2023 2043 6f6e 7665 7274 2074       # Convert t
-0003be00: 6f20 496d 6167 6520 6f62 6a65 6374 2069  o Image object i
-0003be10: 6620 6e65 6564 6564 0a20 2020 2020 2020  f needed.       
-0003be20: 2069 6620 696d 6167 6520 616e 6420 6e6f   if image and no
-0003be30: 7420 6973 696e 7374 616e 6365 2869 6d61  t isinstance(ima
-0003be40: 6765 2c20 736b 7274 2e69 6d61 6765 2e49  ge, skrt.image.I
-0003be50: 6d61 6765 293a 0a20 2020 2020 2020 2020  mage):.         
-0003be60: 2020 2069 6d61 6765 203d 2073 6b72 742e     image = skrt.
-0003be70: 696d 6167 652e 496d 6167 6528 696d 6167  image.Image(imag
-0003be80: 6529 0a0a 2020 2020 2020 2020 2320 4173  e)..        # As
-0003be90: 7369 676e 2074 6f20 7365 6c66 2061 6e64  sign to self and
-0003bea0: 2061 6c6c 2052 4f49 730a 2020 2020 2020   all ROIs.      
-0003beb0: 2020 7365 6c66 2e69 6d61 6765 203d 2069    self.image = i
-0003bec0: 6d61 6765 0a20 2020 2020 2020 2066 6f72  mage.        for
-0003bed0: 2072 6f69 2069 6e20 7365 6c66 2e72 6f69   roi in self.roi
-0003bee0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0003bef0: 6f69 2e73 6574 5f69 6d61 6765 2869 6d61  oi.set_image(ima
-0003bf00: 6765 290a 0a20 2020 2020 2020 2023 2041  ge)..        # A
-0003bf10: 7373 6967 6e20 7365 6c66 2074 6f20 7468  ssign self to th
-0003bf20: 6520 696d 6167 650a 2020 2020 2020 2020  e image.        
-0003bf30: 6966 2069 6d61 6765 2069 7320 6e6f 7420  if image is not 
-0003bf40: 4e6f 6e65 2061 6e64 2061 6464 5f74 6f5f  None and add_to_
-0003bf50: 696d 6167 653a 0a20 2020 2020 2020 2020  image:.         
-0003bf60: 2020 2069 6d61 6765 2e61 6464 5f73 7472     image.add_str
-0003bf70: 7563 7475 7265 5f73 6574 2873 656c 6629  ucture_set(self)
-0003bf80: 0a0a 2020 2020 6465 6620 6765 745f 696d  ..    def get_im
-0003bf90: 6167 6528 7365 6c66 293a 0a20 2020 2020  age(self):.     
-0003bfa0: 2020 2022 2222 5265 7475 726e 2049 6d61     """Return Ima
-0003bfb0: 6765 206f 626a 6563 7420 6173 736f 6369  ge object associ
-0003bfc0: 6174 6564 2077 6974 6820 7468 6973 2053  ated with this S
-0003bfd0: 7472 7563 7475 7265 5365 742e 2222 220a  tructureSet.""".
-0003bfe0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0003bff0: 656c 662e 696d 6167 650a 0a20 2020 2064  elf.image..    d
-0003c000: 6566 2063 6f6e 7461 696e 7328 7365 6c66  ef contains(self
-0003c010: 2c20 726f 695f 6e61 6d65 732c 2069 6e5f  , roi_names, in_
-0003c020: 696d 6167 653d 4661 6c73 6529 3a0a 2020  image=False):.  
-0003c030: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0003c040: 2020 5265 7475 726e 2077 6865 7468 6572    Return whether
-0003c050: 2073 7472 7563 7475 7265 2073 6574 2063   structure set c
-0003c060: 6f6e 7461 696e 7320 6e61 6d65 6420 524f  ontains named RO
-0003c070: 4973 2c0a 2020 2020 2020 2020 6f70 7469  Is,.        opti
-0003c080: 6f6e 616c 6c79 2074 6573 7469 6e67 2077  onally testing w
-0003c090: 6865 7468 6572 2074 6865 2052 4f49 7320  hether the ROIs 
-0003c0a0: 6265 2066 756c 6c79 2063 6f6e 7461 696e  be fully contain
-0003c0b0: 6564 2069 6e20 616e 2069 6d61 6765 2e0a  ed in an image..
-0003c0c0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-0003c0d0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
-0003c0e0: 2020 726f 695f 6e61 6d65 7320 3a20 6c69    roi_names : li
-0003c0f0: 7374 2f73 7472 0a20 2020 2020 2020 2020  st/str.         
-0003c100: 2020 2053 696e 676c 6520 7374 7269 6e67     Single string
-0003c110: 2c20 6f72 206c 6973 7420 6f66 2073 7472  , or list of str
-0003c120: 696e 6773 2c20 696e 6469 6361 7469 6e67  ings, indicating
-0003c130: 206e 616d 6528 7329 206f 6620 524f 4928   name(s) of ROI(
-0003c140: 7329 0a20 2020 2020 2020 2020 2020 2074  s).            t
-0003c150: 6f20 6265 2063 6f6e 7369 6465 7265 642e  o be considered.
-0003c160: 0a0a 2020 2020 2020 2020 696e 5f69 6d61  ..        in_ima
-0003c170: 6765 203a 2062 6f6f 6c2f 736b 7274 2e69  ge : bool/skrt.i
-0003c180: 6d61 6765 2e49 6d61 6765 2c20 6465 6661  mage.Image, defa
-0003c190: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-0003c1a0: 2020 2020 2020 5370 6563 6966 6963 6174        Specificat
-0003c1b0: 696f 6e20 6f66 2077 6865 7468 6572 2074  ion of whether t
-0003c1c0: 6f20 7465 7374 2074 6861 7420 524f 4973  o test that ROIs
-0003c1d0: 2061 7265 2066 756c 6c79 2063 6f6e 7461   are fully conta
-0003c1e0: 696e 6564 0a20 2020 2020 2020 2020 2020  ined.           
-0003c1f0: 2069 6e20 616e 2069 6d61 6765 2e20 2049   in an image.  I
-0003c200: 6620 696e 5f69 6d61 6765 2069 7320 696e  f in_image is in
-0003c210: 2049 6d61 6765 206f 626a 6563 742c 2074   Image object, t
-0003c220: 6865 2062 6f6f 6c65 616e 2072 6574 7572  he boolean retur
-0003c230: 6e65 640a 2020 2020 2020 2020 2020 2020  ned.            
-0003c240: 696e 6469 6361 7465 7320 7768 6574 6865  indicates whethe
-0003c250: 7220 616c 6c20 6e61 6d65 6420 524f 4973  r all named ROIs
-0003c260: 2061 7265 2063 6f6e 7461 696e 6564 2077   are contained w
-0003c270: 6974 6869 6e20 7468 6973 2069 6d61 6765  ithin this image
-0003c280: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-0003c290: 2069 6e5f 696d 6167 6520 6973 2054 7275   in_image is Tru
-0003c2a0: 652c 2074 6865 2062 6f6f 6c65 616e 2072  e, the boolean r
-0003c2b0: 6574 7572 6e65 6420 696e 6469 6361 7465  eturned indicate
-0003c2c0: 7320 7768 6574 6865 720a 2020 2020 2020  s whether.      
-0003c2d0: 2020 2020 2020 616c 6c20 6e61 6d65 6420        all named 
-0003c2e0: 524f 4973 2061 7265 2063 6f6e 7461 696e  ROIs are contain
-0003c2f0: 6564 2077 6974 6869 6e20 7468 6520 696d  ed within the im
-0003c300: 6167 6520 6173 736f 6369 6174 6564 2077  age associated w
-0003c310: 6974 680a 2020 2020 2020 2020 2020 2020  ith.            
-0003c320: 7365 6c66 2e0a 2020 2020 2020 2020 2222  self..        ""
-0003c330: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
-0003c340: 6e73 7461 6e63 6528 726f 695f 6e61 6d65  nstance(roi_name
-0003c350: 732c 2073 7472 293a 0a20 2020 2020 2020  s, str):.       
-0003c360: 2020 2020 2072 6f69 5f6e 616d 6573 203d       roi_names =
-0003c370: 205b 726f 695f 6e61 6d65 735d 0a0a 2020   [roi_names]..  
-0003c380: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
-0003c390: 6574 6865 7220 7374 7275 6374 7572 6520  ether structure 
-0003c3a0: 7365 7420 636f 6e74 6169 6e73 2061 6c6c  set contains all
-0003c3b0: 206e 616d 6564 2052 4f49 732e 0a20 2020   named ROIs..   
-0003c3c0: 2020 2020 2073 735f 726f 695f 6e61 6d65       ss_roi_name
-0003c3d0: 7320 3d20 7365 6c66 2e67 6574 5f72 6f69  s = self.get_roi
-0003c3e0: 5f6e 616d 6573 2829 0a20 2020 2020 2020  _names().       
-0003c3f0: 2066 6f72 2072 6f69 5f6e 616d 6520 696e   for roi_name in
-0003c400: 2072 6f69 5f6e 616d 6573 3a0a 2020 2020   roi_names:.    
-0003c410: 2020 2020 2020 2020 6966 2072 6f69 5f6e          if roi_n
-0003c420: 616d 6520 6e6f 7420 696e 2073 735f 726f  ame not in ss_ro
-0003c430: 695f 6e61 6d65 733a 0a20 2020 2020 2020  i_names:.       
-0003c440: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0003c450: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
-0003c460: 2044 6574 6572 6d69 6e65 2077 6865 7468   Determine wheth
-0003c470: 6572 2074 6f20 6368 6563 6b20 7468 6174  er to check that
-0003c480: 206e 616d 6564 2052 4f49 7320 6172 6520   named ROIs are 
-0003c490: 636f 6e74 6169 6e65 6420 696e 2061 6e20  contained in an 
-0003c4a0: 696d 6167 652e 0a20 2020 2020 2020 2069  image..        i
-0003c4b0: 6620 6e6f 7420 696e 5f69 6d61 6765 3a0a  f not in_image:.
-0003c4c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003c4d0: 726e 2054 7275 650a 0a20 2020 2020 2020  rn True..       
-0003c4e0: 2023 2043 6865 636b 2074 6861 7420 696d   # Check that im
-0003c4f0: 6167 6520 6973 2073 7065 6369 6669 6564  age is specified
-0003c500: 2e0a 2020 2020 2020 2020 2320 4966 2079  ..        # If y
-0003c510: 6573 2c20 2065 6e73 7572 6520 7468 6174  es,  ensure that
-0003c520: 2052 4f49 206d 6173 6b73 2068 6176 6520   ROI masks have 
-0003c530: 7468 6520 7361 6d65 2076 6f78 656c 2073  the same voxel s
-0003c540: 697a 6520 6173 2074 6869 7320 696d 6167  ize as this imag
-0003c550: 652e 0a20 2020 2020 2020 2069 6620 6973  e..        if is
-0003c560: 696e 7374 616e 6365 2869 6e5f 696d 6167  instance(in_imag
-0003c570: 652c 2073 6b72 742e 696d 6167 652e 496d  e, skrt.image.Im
-0003c580: 6167 6529 3a0a 2020 2020 2020 2020 2020  age):.          
-0003c590: 2020 696d 203d 2069 6e5f 696d 6167 650a    im = in_image.
-0003c5a0: 2020 2020 2020 2020 2020 2020 7373 203d              ss =
-0003c5b0: 2073 656c 662e 636c 6f6e 6528 290a 2020   self.clone().  
-0003c5c0: 2020 2020 2020 2020 2020 7373 2e73 6574            ss.set
-0003c5d0: 5f69 6d61 6765 2869 6d2c 2061 6464 5f74  _image(im, add_t
-0003c5e0: 6f5f 696d 6167 653d 4661 6c73 6529 0a20  o_image=False). 
-0003c5f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0003c600: 2020 2020 2020 2020 2069 6d20 3d20 7365           im = se
-0003c610: 6c66 2e69 6d61 6765 0a20 2020 2020 2020  lf.image.       
-0003c620: 2020 2020 2073 7320 3d20 7365 6c66 0a20       ss = self. 
-0003c630: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0003c640: 696e 7374 616e 6365 2869 6d2c 2073 6b72  instance(im, skr
-0003c650: 742e 696d 6167 652e 496d 6167 6529 3a0a  t.image.Image):.
-0003c660: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003c670: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
-0003c680: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
-0003c690: 7220 524f 4973 2061 7265 2063 6f6e 7461  r ROIs are conta
-0003c6a0: 696e 6564 2069 6e20 696d 6167 652e 0a20  ined in image.. 
-0003c6b0: 2020 2020 2020 2069 6d5f 6578 7465 6e74         im_extent
-0003c6c0: 7320 3d20 696d 2e67 6574 5f65 7874 656e  s = im.get_exten
-0003c6d0: 7473 2829 0a20 2020 2020 2020 2066 6f72  ts().        for
-0003c6e0: 2072 6f69 5f6e 616d 6520 696e 2072 6f69   roi_name in roi
-0003c6f0: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-0003c700: 2020 2020 726f 695f 6578 7465 6e74 7320      roi_extents 
-0003c710: 3d20 7373 5b72 6f69 5f6e 616d 655d 2e67  = ss[roi_name].g
-0003c720: 6574 5f65 7874 656e 7473 2830 2e35 2c20  et_extents(0.5, 
-0003c730: 2276 6f78 656c 7322 290a 2020 2020 2020  "voxels").      
-0003c740: 2020 2020 2020 666f 7220 6964 7820 696e        for idx in
-0003c750: 2072 616e 6765 2833 293a 0a20 2020 2020   range(3):.     
-0003c760: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
-0003c770: 695f 6578 7465 6e74 735b 6964 785d 5b30  i_extents[idx][0
-0003c780: 5d20 3c20 696d 5f65 7874 656e 7473 5b69  ] < im_extents[i
-0003c790: 6478 5d5b 305d 3a0a 2020 2020 2020 2020  dx][0]:.        
-0003c7a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003c7b0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0003c7c0: 2020 2020 2020 2020 2069 6620 726f 695f           if roi_
-0003c7d0: 6578 7465 6e74 735b 6964 785d 5b31 5d20  extents[idx][1] 
-0003c7e0: 3e20 696d 5f65 7874 656e 7473 5b69 6478  > im_extents[idx
-0003c7f0: 5d5b 315d 3a0a 2020 2020 2020 2020 2020  ][1]:.          
-0003c800: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0003c810: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-0003c820: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
-0003c830: 2064 6566 206d 6973 7369 6e67 2873 656c   def missing(sel
-0003c840: 662c 2072 6f69 5f6e 616d 6573 2c20 696e  f, roi_names, in
-0003c850: 5f69 6d61 6765 3d46 616c 7365 293a 0a20  _image=False):. 
-0003c860: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0003c870: 2020 2049 6465 6e74 6966 7920 616d 6f6e     Identify amon
-0003c880: 6720 6e61 6d65 6420 524f 4973 2074 686f  g named ROIs tho
-0003c890: 7365 2074 6861 7420 6172 6520 6d69 7373  se that are miss
-0003c8a0: 696e 6720 6672 6f6d 2073 7472 7563 7475  ing from structu
-0003c8b0: 7265 2073 6574 2c0a 2020 2020 2020 2020  re set,.        
-0003c8c0: 6f72 2061 7265 206e 6f74 2066 756c 6c79  or are not fully
-0003c8d0: 2063 6f6e 7461 696e 6564 2069 6e20 616e   contained in an
-0003c8e0: 2069 6d61 6765 2e0a 0a20 2020 2020 2020   image...       
-0003c8f0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0003c900: 0a0a 2020 2020 2020 2020 726f 695f 6e61  ..        roi_na
-0003c910: 6d65 7320 3a20 6c69 7374 2f73 7472 0a20  mes : list/str. 
-0003c920: 2020 2020 2020 2020 2020 2053 696e 676c             Singl
-0003c930: 6520 7374 7269 6e67 2c20 6f72 206c 6973  e string, or lis
-0003c940: 7420 6f66 2073 7472 696e 6773 2c20 696e  t of strings, in
-0003c950: 6469 6361 7469 6e67 206e 616d 6528 7329  dicating name(s)
-0003c960: 206f 6620 524f 4928 7329 0a20 2020 2020   of ROI(s).     
-0003c970: 2020 2020 2020 2074 6f20 6265 2063 6f6e         to be con
-0003c980: 7369 6465 7265 642e 0a0a 2020 2020 2020  sidered...      
-0003c990: 2020 696e 5f69 6d61 6765 203a 2062 6f6f    in_image : boo
-0003c9a0: 6c2f 736b 7274 2e69 6d61 6765 2e49 6d61  l/skrt.image.Ima
-0003c9b0: 6765 2c20 6465 6661 756c 743d 4661 6c73  ge, default=Fals
-0003c9c0: 650a 2020 2020 2020 2020 2020 2020 5370  e.            Sp
-0003c9d0: 6563 6966 6963 6174 696f 6e20 6f66 2077  ecification of w
-0003c9e0: 6865 7468 6572 2074 6f20 7465 7374 2074  hether to test t
-0003c9f0: 6861 7420 524f 4973 2061 7265 2066 756c  hat ROIs are ful
-0003ca00: 6c79 2063 6f6e 7461 696e 6564 0a20 2020  ly contained.   
-0003ca10: 2020 2020 2020 2020 2069 6e20 616e 2069           in an i
-0003ca20: 6d61 6765 2e20 2049 6620 696e 5f69 6d61  mage.  If in_ima
-0003ca30: 6765 2069 7320 696e 2049 6d61 6765 206f  ge is in Image o
-0003ca40: 626a 6563 742c 2061 6e20 524f 4920 6973  bject, an ROI is
-0003ca50: 0a20 2020 2020 2020 2020 2020 2069 6465  .            ide
-0003ca60: 6e74 6966 6965 6420 6173 206d 6973 7369  ntified as missi
-0003ca70: 6e67 2069 6620 6e6f 7420 636f 6e74 6169  ng if not contai
-0003ca80: 6e65 6420 7769 7468 696e 2074 6869 7320  ned within this 
-0003ca90: 696d 6167 652e 0a20 2020 2020 2020 2020  image..         
-0003caa0: 2020 2049 6620 696e 5f69 6d61 6765 2069     If in_image i
-0003cab0: 7320 5472 7565 2c20 616e 2052 4f49 2069  s True, an ROI i
-0003cac0: 7320 6964 656e 7469 6669 6564 2061 7320  s identified as 
-0003cad0: 6d69 7373 696e 6720 6966 206e 6f74 0a20  missing if not. 
-0003cae0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-0003caf0: 696e 6564 2077 6974 6869 6e20 7468 6520  ined within the 
-0003cb00: 696d 6167 6520 6173 736f 6369 6174 6564  image associated
-0003cb10: 2077 6974 6820 7365 6c66 2e0a 2020 2020   with self..    
-0003cb20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0003cb30: 6966 2069 7369 6e73 7461 6e63 6528 726f  if isinstance(ro
-0003cb40: 695f 6e61 6d65 732c 2073 7472 293a 0a20  i_names, str):. 
-0003cb50: 2020 2020 2020 2020 2020 2072 6f69 5f6e             roi_n
-0003cb60: 616d 6573 203d 205b 726f 695f 6e61 6d65  ames = [roi_name
-0003cb70: 735d 0a20 2020 2020 2020 206d 6973 7369  s].        missi
-0003cb80: 6e67 5f72 6f69 7320 3d20 7365 7428 290a  ng_rois = set().
-0003cb90: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-0003cba0: 2066 6f72 2052 4f49 7320 6e6f 7420 636f   for ROIs not co
-0003cbb0: 6e74 6169 6e65 6420 696e 2073 7472 7563  ntained in struc
-0003cbc0: 7475 7265 2073 6574 2e0a 2020 2020 2020  ture set..      
-0003cbd0: 2020 7373 5f72 6f69 5f6e 616d 6573 203d    ss_roi_names =
-0003cbe0: 2073 656c 662e 6765 745f 726f 695f 6e61   self.get_roi_na
-0003cbf0: 6d65 7328 290a 2020 2020 2020 2020 666f  mes().        fo
-0003cc00: 7220 726f 695f 6e61 6d65 2069 6e20 726f  r roi_name in ro
-0003cc10: 695f 6e61 6d65 733a 0a20 2020 2020 2020  i_names:.       
-0003cc20: 2020 2020 2069 6620 726f 695f 6e61 6d65       if roi_name
-0003cc30: 206e 6f74 2069 6e20 7373 5f72 6f69 5f6e   not in ss_roi_n
-0003cc40: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-0003cc50: 2020 2020 2020 6d69 7373 696e 675f 726f        missing_ro
-0003cc60: 6973 2e61 6464 2872 6f69 5f6e 616d 6529  is.add(roi_name)
-0003cc70: 0a0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
-0003cc80: 726d 696e 6520 7768 6574 6865 7220 746f  rmine whether to
-0003cc90: 2063 6865 636b 2074 6861 7420 6e61 6d65   check that name
-0003cca0: 6420 524f 4973 2061 7265 2063 6f6e 7461  d ROIs are conta
-0003ccb0: 696e 6564 2069 6e20 616e 2069 6d61 6765  ined in an image
-0003ccc0: 2e0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0003ccd0: 2069 6e5f 696d 6167 653a 0a20 2020 2020   in_image:.     
-0003cce0: 2020 2020 2020 2072 6574 7572 6e20 736f         return so
-0003ccf0: 7274 6564 286c 6973 7428 6d69 7373 696e  rted(list(missin
-0003cd00: 675f 726f 6973 2929 0a0a 2020 2020 2020  g_rois))..      
-0003cd10: 2020 2320 4368 6563 6b20 7468 6174 2069    # Check that i
-0003cd20: 6d61 6765 2069 7320 7370 6563 6966 6965  mage is specifie
-0003cd30: 642e 0a20 2020 2020 2020 2023 2049 6620  d..        # If 
-0003cd40: 7965 732c 2020 656e 7375 7265 2074 6861  yes,  ensure tha
-0003cd50: 7420 524f 4920 6d61 736b 7320 6861 7665  t ROI masks have
-0003cd60: 2074 6865 2073 616d 6520 766f 7865 6c20   the same voxel 
-0003cd70: 7369 7a65 2061 7320 7468 6973 2069 6d61  size as this ima
-0003cd80: 6765 2e0a 2020 2020 2020 2020 6966 2069  ge..        if i
-0003cd90: 7369 6e73 7461 6e63 6528 696e 5f69 6d61  sinstance(in_ima
-0003cda0: 6765 2c20 736b 7274 2e69 6d61 6765 2e49  ge, skrt.image.I
-0003cdb0: 6d61 6765 293a 0a20 2020 2020 2020 2020  mage):.         
-0003cdc0: 2020 2069 6d20 3d20 696e 5f69 6d61 6765     im = in_image
-0003cdd0: 0a20 2020 2020 2020 2020 2020 2073 7320  .            ss 
-0003cde0: 3d20 7365 6c66 2e63 6c6f 6e65 2829 0a20  = self.clone(). 
-0003cdf0: 2020 2020 2020 2020 2020 2073 732e 7365             ss.se
-0003ce00: 745f 696d 6167 6528 696d 2c20 6164 645f  t_image(im, add_
-0003ce10: 746f 5f69 6d61 6765 3d46 616c 7365 290a  to_image=False).
-0003ce20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0003ce30: 2020 2020 2020 2020 2020 696d 203d 2073            im = s
-0003ce40: 656c 662e 696d 6167 650a 2020 2020 2020  elf.image.      
-0003ce50: 2020 2020 2020 7373 203d 2073 656c 660a        ss = self.
-0003ce60: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0003ce70: 7369 6e73 7461 6e63 6528 696d 2c20 736b  sinstance(im, sk
-0003ce80: 7274 2e69 6d61 6765 2e49 6d61 6765 293a  rt.image.Image):
-0003ce90: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0003cea0: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-0003ceb0: 6622 496e 7661 6c69 6420 696d 6167 6520  f"Invalid image 
-0003cec0: 7370 6563 6966 6963 6174 696f 6e22 290a  specification").
-0003ced0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-0003cee0: 2077 6865 7468 6572 2052 4f49 7320 6172   whether ROIs ar
-0003cef0: 6520 636f 6e74 6169 6e65 6420 696e 2069  e contained in i
-0003cf00: 6d61 6765 2e0a 2020 2020 2020 2020 696d  mage..        im
-0003cf10: 5f65 7874 656e 7473 203d 2069 6d2e 6765  _extents = im.ge
-0003cf20: 745f 6578 7465 6e74 7328 290a 2020 2020  t_extents().    
-0003cf30: 2020 2020 6163 7469 7665 5f72 6f69 7320      active_rois 
-0003cf40: 3d20 7365 7428 726f 695f 6e61 6d65 7329  = set(roi_names)
-0003cf50: 202d 206d 6973 7369 6e67 5f72 6f69 730a   - missing_rois.
-0003cf60: 2020 2020 2020 2020 666f 7220 726f 695f          for roi_
-0003cf70: 6e61 6d65 2069 6e20 6163 7469 7665 5f72  name in active_r
-0003cf80: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
-0003cf90: 2072 6f69 5f65 7874 656e 7473 203d 2073   roi_extents = s
-0003cfa0: 735b 726f 695f 6e61 6d65 5d2e 6765 745f  s[roi_name].get_
-0003cfb0: 6578 7465 6e74 7328 302e 352c 2022 766f  extents(0.5, "vo
-0003cfc0: 7865 6c73 2229 0a20 2020 2020 2020 2020  xels").         
-0003cfd0: 2020 2066 6f72 2069 6478 2069 6e20 7261     for idx in ra
-0003cfe0: 6e67 6528 3329 3a0a 2020 2020 2020 2020  nge(3):.        
-0003cff0: 2020 2020 2020 2020 6966 2028 726f 695f          if (roi_
-0003d000: 6578 7465 6e74 735b 6964 785d 5b30 5d20  extents[idx][0] 
-0003d010: 3c20 696d 5f65 7874 656e 7473 5b69 6478  < im_extents[idx
-0003d020: 5d5b 305d 0a20 2020 2020 2020 2020 2020  ][0].           
-0003d030: 2020 2020 2020 2020 206f 7220 726f 695f           or roi_
-0003d040: 6578 7465 6e74 735b 6964 785d 5b31 5d20  extents[idx][1] 
-0003d050: 3e20 696d 5f65 7874 656e 7473 5b69 6478  > im_extents[idx
-0003d060: 5d5b 315d 293a 0a20 2020 2020 2020 2020  ][1]):.         
-0003d070: 2020 2020 2020 2020 2020 206d 6973 7369             missi
-0003d080: 6e67 5f72 6f69 732e 6164 6428 726f 695f  ng_rois.add(roi_
-0003d090: 6e61 6d65 290a 0a20 2020 2020 2020 2072  name)..        r
-0003d0a0: 6574 7572 6e20 736f 7274 6564 286c 6973  eturn sorted(lis
-0003d0b0: 7428 6d69 7373 696e 675f 726f 6973 2929  t(missing_rois))
-0003d0c0: 0a0a 2020 2020 6465 6620 6861 735f 726f  ..    def has_ro
-0003d0d0: 6973 2873 656c 662c 206e 616d 6573 3d4e  is(self, names=N
-0003d0e0: 6f6e 652c 2069 6e63 6c75 6465 5f6b 6579  one, include_key
-0003d0f0: 733d 4661 6c73 6529 3a0a 2020 2020 2020  s=False):.      
-0003d100: 2020 2222 220a 2020 2020 2020 2020 4465    """.        De
-0003d110: 7465 726d 696e 6520 7768 6574 6865 7220  termine whether 
-0003d120: 7374 7275 6374 7572 6520 7365 7420 636f  structure set co
-0003d130: 6e74 6169 6e73 2073 7065 6369 6669 6564  ntains specified
-0003d140: 2052 4f49 732c 0a20 2020 2020 2020 2069   ROIs,.        i
-0003d150: 6465 6e74 6966 6965 6420 6279 2061 206e  dentified by a n
-0003d160: 6f6d 696e 616c 206e 616d 6520 6f72 2062  ominal name or b
-0003d170: 7920 616e 2061 6c69 6173 2e0a 0a20 2020  y an alias...   
-0003d180: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
-0003d190: 2072 6574 7572 6e73 2054 7275 6520 6966   returns True if
-0003d1a0: 2061 6c6c 2073 7065 6369 6669 6564 2052   all specified R
-0003d1b0: 4f49 206e 616d 6573 2061 7265 206d 6174  OI names are mat
-0003d1c0: 6368 6564 0a20 2020 2020 2020 2077 6974  ched.        wit
-0003d1d0: 6820 7468 6520 6e61 6d65 206f 6620 616e  h the name of an
-0003d1e0: 2052 4f49 2069 6e20 7468 6520 7374 7275   ROI in the stru
-0003d1f0: 6374 7572 6520 7365 742c 2061 6e64 2072  cture set, and r
-0003d200: 6574 7572 6e73 2046 616c 7365 0a20 2020  eturns False.   
-0003d210: 2020 2020 206f 7468 6572 7769 7365 2e20       otherwise. 
-0003d220: 204d 6174 6368 696e 6720 6973 2063 6173   Matching is cas
-0003d230: 6520 696e 7365 6e73 6974 6976 652e 0a0a  e insensitive...
-0003d240: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
-0003d250: 7374 722f 6c69 7374 2f64 6963 740a 2020  str/list/dict.  
-0003d260: 2020 2020 2020 2020 2020 5370 6563 6966            Specif
-0003d270: 6963 6174 696f 6e20 6f66 2052 4f49 733a  ication of ROIs:
-0003d280: 0a20 2020 2020 2020 2020 2020 202d 2061  .            - a
-0003d290: 2073 696e 676c 6520 524f 4920 6e61 6d65   single ROI name
-0003d2a0: 2c20 6f70 7469 6f6e 616c 6c79 2069 6e63  , optionally inc
-0003d2b0: 6c75 6469 6e67 2077 696c 6463 6172 6473  luding wildcards
-0003d2c0: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
-0003d2d0: 6120 6c69 7374 206f 6620 524f 4920 6e61  a list of ROI na
-0003d2e0: 6d65 732c 2065 6163 6820 6f70 7469 6f6e  mes, each option
-0003d2f0: 616c 6c79 2069 6e63 6c75 6469 6e67 2077  ally including w
-0003d300: 696c 6463 6172 6473 3b0a 2020 2020 2020  ildcards;.      
-0003d310: 2020 2020 2020 2d20 6120 6469 6374 696f        - a dictio
-0003d320: 6e61 7279 2c20 7768 6572 6520 6b65 7973  nary, where keys
-0003d330: 2061 7265 206e 6f6d 696e 616c 2052 4f49   are nominal ROI
-0003d340: 206e 616d 6573 2c0a 2020 2020 2020 2020   names,.        
-0003d350: 2020 2020 616e 6420 7661 6c75 6573 2061      and values a
-0003d360: 7265 206c 6973 7473 206f 6620 706f 7373  re lists of poss
-0003d370: 6962 6c65 206e 616d 6573 2c20 6f70 7469  ible names, opti
-0003d380: 6f6e 616c 6c79 2069 6e63 6c75 6469 6e67  onally including
-0003d390: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-0003d3a0: 6463 6172 6473 2e0a 0a20 2020 2020 2020  dcards...       
-0003d3b0: 2069 6e63 6c75 6465 5f6b 6579 7320 3a20   include_keys : 
-0003d3c0: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
-0003d3d0: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
-0003d3e0: 6620 5472 7565 2c20 636f 6e73 6964 6572  f True, consider
-0003d3f0: 2062 6f74 6820 6b65 7973 2061 6e64 2076   both keys and v
-0003d400: 616c 7565 7320 666f 7220 6d61 7463 6869  alues for matchi
-0003d410: 6e67 2069 6620 524f 4920 6e61 6d65 730a  ng if ROI names.
-0003d420: 2020 2020 2020 2020 2020 2020 6172 6520              are 
-0003d430: 7370 6563 6966 6965 6420 6173 2061 2064  specified as a d
-0003d440: 6963 7469 6f6e 6172 792e 2020 4966 2046  ictionary.  If F
-0003d450: 616c 7365 2c20 636f 6e73 6964 6572 2076  alse, consider v
-0003d460: 616c 7565 7320 6f6e 6c79 2e0a 2020 2020  alues only..    
-0003d470: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0003d480: 2320 436f 6e76 6572 7420 6e61 6d65 7320  # Convert names 
-0003d490: 746f 2061 2064 6963 7469 6f6e 6172 792c  to a dictionary,
-0003d4a0: 2077 6865 7265 2065 6163 6820 7661 6c75   where each valu
-0003d4b0: 6520 6973 2061 206c 6973 742e 0a20 2020  e is a list..   
-0003d4c0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0003d4d0: 6365 286e 616d 6573 2c20 7374 7229 3a0a  ce(names, str):.
-0003d4e0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0003d4f0: 7320 3d20 7b6e 616d 6573 3a20 5b6e 616d  s = {names: [nam
-0003d500: 6573 5d7d 0a20 2020 2020 2020 2065 6c69  es]}.        eli
-0003d510: 6620 736b 7274 2e63 6f72 652e 6973 5f6c  f skrt.core.is_l
-0003d520: 6973 7428 6e61 6d65 7329 3a0a 2020 2020  ist(names):.    
-0003d530: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
-0003d540: 7b6e 616d 653a 205b 6e61 6d65 5d20 666f  {name: [name] fo
-0003d550: 7220 6e61 6d65 2069 6e20 6e61 6d65 737d  r name in names}
-0003d560: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0003d570: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
-0003d580: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-0003d590: 2020 2066 6f72 206e 616d 6520 696e 206e     for name in n
-0003d5a0: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-0003d5b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0003d5c0: 6e63 6528 6e61 6d65 735b 6e61 6d65 5d2c  nce(names[name],
-0003d5d0: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-0003d5e0: 2020 2020 2020 2020 2020 206e 616d 6573             names
-0003d5f0: 5b6e 616d 655d 203d 205b 6e61 6d65 735b  [name] = [names[
-0003d600: 6e61 6d65 5d5d 0a0a 2020 2020 2020 2020  name]]..        
-0003d610: 2320 4578 6974 2069 7320 6e61 6d65 7320  # Exit is names 
-0003d620: 6973 6e27 7420 6120 6469 6374 696f 6e61  isn't a dictiona
-0003d630: 7279 2e0a 2020 2020 2020 2020 6966 206e  ry..        if n
-0003d640: 6f74 2069 7369 6e73 7461 6e63 6528 6e61  ot isinstance(na
-0003d650: 6d65 732c 2064 6963 7429 3a0a 2020 2020  mes, dict):.    
-0003d660: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0003d670: 616c 7365 0a0a 2020 2020 2020 2020 2320  alse..        # 
-0003d680: 5472 7920 746f 206d 6174 6368 2065 6163  Try to match eac
-0003d690: 6820 524f 4920 6e61 6d65 2077 6974 6820  h ROI name with 
-0003d6a0: 6e6f 6d69 6e61 6c20 6e61 6d65 206f 7220  nominal name or 
-0003d6b0: 616e 7920 616c 6961 7365 732e 0a20 2020  any aliases..   
-0003d6c0: 2020 2020 2066 6f72 206e 616d 652c 2061       for name, a
-0003d6d0: 6c69 6173 6573 2069 6e20 6e61 6d65 732e  liases in names.
-0003d6e0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0003d6f0: 2020 2020 2069 6620 696e 636c 7564 655f       if include_
-0003d700: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
-0003d710: 2020 2020 2020 6e61 6d65 735f 746f 5f6d        names_to_m
-0003d720: 6174 6368 203d 205b 6e61 6d65 5d20 2b20  atch = [name] + 
-0003d730: 616c 6961 7365 730a 2020 2020 2020 2020  aliases.        
-0003d740: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0003d750: 2020 2020 2020 2020 2020 6e61 6d65 735f            names_
-0003d760: 746f 5f6d 6174 6368 203d 2061 6c69 6173  to_match = alias
-0003d770: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
-0003d780: 6f72 206e 616d 655f 746f 5f6d 6174 6368  or name_to_match
-0003d790: 2069 6e20 6e61 6d65 735f 746f 5f6d 6174   in names_to_mat
-0003d7a0: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-0003d7b0: 2020 2020 666f 7220 726f 695f 6e61 6d65      for roi_name
-0003d7c0: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
-0003d7d0: 5f6e 616d 6573 2829 3a0a 2020 2020 2020  _names():.      
-0003d7e0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0003d7f0: 7463 6820 3d20 666e 6d61 7463 682e 666e  tch = fnmatch.fn
-0003d800: 6d61 7463 6828 0a20 2020 2020 2020 2020  match(.         
-0003d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d820: 2020 2072 6f69 5f6e 616d 652e 6c6f 7765     roi_name.lowe
-0003d830: 7228 292c 206e 616d 655f 746f 5f6d 6174  r(), name_to_mat
-0003d840: 6368 2e6c 6f77 6572 2829 290a 2020 2020  ch.lower()).    
-0003d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d860: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
-0003d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d880: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0003d890: 2020 2020 2020 2020 6966 206d 6174 6368          if match
-0003d8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003d8b0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-0003d8c0: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
-0003d8d0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-0003d8e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0003d8f0: 7365 0a0a 2020 2020 2020 2020 7265 7475  se..        retu
-0003d900: 726e 2054 7275 650a 0a20 2020 2064 6566  rn True..    def
-0003d910: 2072 656e 616d 655f 726f 6973 280a 2020   rename_rois(.  
-0003d920: 2020 2020 2020 7365 6c66 2c20 6e61 6d65        self, name
-0003d930: 733d 4e6f 6e65 2c20 6669 7273 745f 6d61  s=None, first_ma
-0003d940: 7463 685f 6f6e 6c79 3d54 7275 652c 206b  tch_only=True, k
-0003d950: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
-0003d960: 3d46 616c 7365 0a20 2020 2029 3a0a 2020  =False.    ):.  
-0003d970: 2020 2020 2020 2222 2252 656e 616d 6520        """Rename 
-0003d980: 524f 4973 2069 6e20 7468 6973 2053 7472  ROIs in this Str
-0003d990: 7563 7475 7265 5365 742e 0a20 2020 2020  uctureSet..     
-0003d9a0: 2020 203c 6669 7273 745f 6d61 7463 685f     <first_match_
-0003d9b0: 6f6e 6c79 3e20 6973 2054 7275 652c 206f  only> is True, o
-0003d9c0: 6e6c 7920 7468 6520 6669 7273 7420 524f  nly the first RO
-0003d9d0: 4920 6d61 7463 6869 6e67 2074 6865 0a20  I matching the. 
-0003d9e0: 2020 2020 2020 2070 6f73 7369 626c 6520         possible 
-0003d9f0: 6d61 7463 6865 7320 7769 6c6c 2062 6520  matches will be 
-0003da00: 7265 6e61 6d65 642e 0a0a 2020 2020 2020  renamed...      
-0003da10: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-0003da20: 2a0a 2020 2020 2020 2020 0a20 2020 2020  *.        .     
-0003da30: 2020 206e 616d 6573 203a 2064 6963 742c     names : dict,
-0003da40: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0003da50: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
-0003da60: 6e61 7279 206f 6620 6e61 6d65 7320 666f  nary of names fo
-0003da70: 7220 7265 6e61 6d69 6e67 2052 4f49 732c  r renaming ROIs,
-0003da80: 2077 6865 7265 2074 6865 206b 6579 7320   where the keys 
-0003da90: 6172 6520 6e65 7720 0a20 2020 2020 2020  are new .       
-0003daa0: 2020 2020 206e 616d 6573 2061 6e64 2076       names and v
-0003dab0: 616c 7565 7320 6172 6520 6c69 7374 7320  alues are lists 
-0003dac0: 6f66 2070 6f73 7369 626c 6520 6e61 6d65  of possible name
-0003dad0: 7320 6f66 2052 4f49 7320 7468 6174 2073  s of ROIs that s
-0003dae0: 686f 756c 640a 2020 2020 2020 2020 2020  hould.          
-0003daf0: 2020 6265 2061 7373 6967 6e65 6420 7468    be assigned th
-0003db00: 6520 6e65 7720 6e61 6d65 2e20 5468 6573  e new name. Thes
-0003db10: 6520 6e61 6d65 7320 6361 6e20 616c 736f  e names can also
-0003db20: 2063 6f6e 7461 696e 2077 696c 6463 6172   contain wildcar
-0003db30: 6473 0a20 2020 2020 2020 2020 2020 2077  ds.            w
-0003db40: 6974 6820 7468 6520 272a 2720 7379 6d62  ith the '*' symb
-0003db50: 6f6c 2e0a 0a20 2020 2020 2020 2066 6972  ol...        fir
-0003db60: 7374 5f6d 6174 6368 5f6f 6e6c 7920 3a20  st_match_only : 
-0003db70: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
-0003db80: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
-0003db90: 6620 5472 7565 2c20 6f6e 6c79 2074 6865  f True, only the
-0003dba0: 2066 6972 7374 2052 4f49 206d 6174 6368   first ROI match
-0003dbb0: 696e 6720 7468 6520 706f 7373 6962 6c65  ing the possible
-0003dbc0: 206e 616d 6573 2069 6e20 7468 6520 0a20   names in the . 
-0003dbd0: 2020 2020 2020 2020 2020 2076 616c 7565             value
-0003dbe0: 7320 6f66 203c 6e61 6d65 733e 2077 696c  s of <names> wil
-0003dbf0: 6c20 6265 2072 656e 616d 6564 3b20 7468  l be renamed; th
-0003dc00: 6973 2070 7265 7665 6e74 7320 6e61 6d65  is prevents name
-0003dc10: 2064 7570 6c69 6361 7469 6f6e 0a20 2020   duplication.   
-0003dc20: 2020 2020 2020 2020 2069 6620 6d75 6c74           if mult
-0003dc30: 6970 6c65 2052 4f49 7320 696e 2074 6865  iple ROIs in the
-0003dc40: 2053 7472 7563 7475 7265 5365 7420 6172   StructureSet ar
-0003dc50: 6520 6120 6d61 7463 682e 0a0a 2020 2020  e a match...    
-0003dc60: 2020 2020 6b65 6570 5f72 656e 616d 6564      keep_renamed
-0003dc70: 5f6f 6e6c 7920 3a20 626f 6f6c 2c20 6465  _only : bool, de
-0003dc80: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-0003dc90: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0003dca0: 2061 6e79 2052 4f49 7320 7468 6174 2064   any ROIs that d
-0003dcb0: 6f20 6e6f 7420 6765 7420 7265 6e61 6d65  o not get rename
-0003dcc0: 6420 7769 6c6c 2062 6520 7265 6d6f 7665  d will be remove
-0003dcd0: 6420 6672 6f6d 0a20 2020 2020 2020 2020  d from.         
-0003dce0: 2020 2074 6865 2053 7472 7563 7475 7265     the Structure
-0003dcf0: 5365 742e 0a20 2020 2020 2020 2022 2222  Set..        """
-0003dd00: 0a0a 2020 2020 2020 2020 6966 206e 616d  ..        if nam
-0003dd10: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-0003dd20: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
-0003dd30: 7365 6c66 2e6e 616d 6573 0a20 2020 2020  self.names.     
-0003dd40: 2020 2069 6620 6e6f 7420 6e61 6d65 7320     if not names 
-0003dd50: 6f72 206e 6f74 2069 7369 6e73 7461 6e63  or not isinstanc
-0003dd60: 6528 6e61 6d65 732c 2064 6963 7429 3a0a  e(names, dict):.
-0003dd70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003dd80: 726e 0a0a 2020 2020 2020 2020 2320 4c6f  rn..        # Lo
-0003dd90: 6f70 2074 6872 6f75 6768 2065 6163 6820  op through each 
-0003dda0: 6e65 7720 6e61 6d65 0a20 2020 2020 2020  new name.       
-0003ddb0: 2061 6c72 6561 6479 5f72 656e 616d 6564   already_renamed
-0003ddc0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-0003ddd0: 7220 6e61 6d65 2c20 6d61 7463 6865 7320  r name, matches 
-0003dde0: 696e 206e 616d 6573 2e69 7465 6d73 2829  in names.items()
-0003ddf0: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0003de00: 6620 6e6f 7420 736b 7274 2e63 6f72 652e  f not skrt.core.
-0003de10: 6973 5f6c 6973 7428 6d61 7463 6865 7329  is_list(matches)
-0003de20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003de30: 2020 6d61 7463 6865 7320 3d20 5b6d 6174    matches = [mat
-0003de40: 6368 6573 5d0a 0a20 2020 2020 2020 2020  ches]..         
-0003de50: 2020 2023 204c 6f6f 7020 7468 726f 7567     # Loop throug
-0003de60: 6820 616c 6c20 706f 7373 6962 6c65 206f  h all possible o
-0003de70: 7269 6769 6e61 6c20 6e61 6d65 730a 2020  riginal names.  
-0003de80: 2020 2020 2020 2020 2020 6e61 6d65 5f6d            name_m
-0003de90: 6174 6368 6564 203d 2046 616c 7365 0a20  atched = False. 
-0003dea0: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-0003deb0: 2069 6e20 6d61 7463 6865 733a 0a0a 2020   in matches:..  
-0003dec0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0003ded0: 4c6f 6f70 2074 6872 6f75 6768 2052 4f49  Loop through ROI
-0003dee0: 7320 616e 6420 7365 6520 6966 2074 6865  s and see if the
-0003def0: 7265 2773 2061 206d 6174 6368 0a20 2020  re's a match.   
-0003df00: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0003df10: 2069 2c20 7320 696e 2065 6e75 6d65 7261   i, s in enumera
-0003df20: 7465 2873 656c 662e 6765 745f 726f 6973  te(self.get_rois
-0003df30: 2829 293a 0a0a 2020 2020 2020 2020 2020  ()):..          
-0003df40: 2020 2020 2020 2020 2020 2320 446f 6e27            # Don'
-0003df50: 7420 7265 6e61 6d65 2061 6e20 524f 4920  t rename an ROI 
-0003df60: 6d6f 7265 2074 6861 6e20 6f6e 6365 0a20  more than once. 
-0003df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003df80: 2020 2069 6620 6920 696e 2061 6c72 6561     if i in alrea
-0003df90: 6479 5f72 656e 616d 6564 3a0a 2020 2020  dy_renamed:.    
-0003dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dfb0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-0003dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dfd0: 2020 6966 2066 6e6d 6174 6368 2e66 6e6d    if fnmatch.fnm
-0003dfe0: 6174 6368 2873 2e6e 616d 652e 6c6f 7765  atch(s.name.lowe
-0003dff0: 7228 292c 206d 2e6c 6f77 6572 2829 293a  r(), m.lower()):
-0003e000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e010: 2020 2020 2020 2020 2073 2e6e 616d 6520           s.name 
-0003e020: 3d20 6e61 6d65 0a20 2020 2020 2020 2020  = name.         
-0003e030: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0003e040: 616d 655f 6d61 7463 6865 6420 3d20 5472  ame_matched = Tr
-0003e050: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0003e060: 2020 2020 2020 2020 2020 2061 6c72 6561             alrea
-0003e070: 6479 5f72 656e 616d 6564 2e61 7070 656e  dy_renamed.appen
-0003e080: 6428 6929 0a20 2020 2020 2020 2020 2020  d(i).           
-0003e090: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0003e0a0: 6669 7273 745f 6d61 7463 685f 6f6e 6c79  first_match_only
-0003e0b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003e0c0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0003e0d0: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
-0003e0e0: 2020 2020 2023 2049 6620 6669 7273 745f       # If first_
-0003e0f0: 6d61 7463 685f 6f6e 6c79 2c20 646f 6e27  match_only, don'
-0003e100: 7420 7265 6e61 6d65 206d 6f72 6520 7468  t rename more th
-0003e110: 616e 206f 6e65 2052 4f49 0a20 2020 2020  an one ROI.     
-0003e120: 2020 2020 2020 2020 2020 2023 2077 6974             # wit
-0003e130: 6820 7468 6973 206e 6577 206e 616d 650a  h this new name.
-0003e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e150: 6966 206e 616d 655f 6d61 7463 6865 6420  if name_matched 
-0003e160: 616e 6420 6669 7273 745f 6d61 7463 685f  and first_match_
-0003e170: 6f6e 6c79 3a0a 2020 2020 2020 2020 2020  only:.          
-0003e180: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0003e190: 0a20 2020 2020 2020 2023 204b 6565 7020  .        # Keep 
-0003e1a0: 6f6e 6c79 2074 6865 2072 656e 616d 6564  only the renamed
-0003e1b0: 2052 4f49 7320 6966 2072 6571 7565 7374   ROIs if request
-0003e1c0: 6564 0a20 2020 2020 2020 2069 6620 6b65  ed.        if ke
-0003e1d0: 6570 5f72 656e 616d 6564 5f6f 6e6c 793a  ep_renamed_only:
-0003e1e0: 0a20 2020 2020 2020 2020 2020 2072 656e  .            ren
-0003e1f0: 616d 6564 5f72 6f69 7320 3d20 5b73 656c  amed_rois = [sel
-0003e200: 662e 726f 6973 5b69 5d20 666f 7220 6920  f.rois[i] for i 
-0003e210: 696e 2061 6c72 6561 6479 5f72 656e 616d  in already_renam
-0003e220: 6564 5d0a 2020 2020 2020 2020 2020 2020  ed].            
-0003e230: 7365 6c66 2e72 6f69 7320 3d20 7265 6e61  self.rois = rena
-0003e240: 6d65 645f 726f 6973 0a0a 2020 2020 6465  med_rois..    de
-0003e250: 6620 6669 6c74 6572 5f72 6f69 7328 7365  f filter_rois(se
-0003e260: 6c66 2c20 746f 5f6b 6565 703d 4e6f 6e65  lf, to_keep=None
-0003e270: 2c20 746f 5f72 656d 6f76 653d 4e6f 6e65  , to_remove=None
-0003e280: 293a 0a20 2020 2020 2020 2022 2222 4b65  ):.        """Ke
-0003e290: 6570 206f 6e6c 7920 7468 6520 524f 4973  ep only the ROIs
-0003e2a0: 2069 6e20 7468 6520 746f 5f6b 6565 7020   in the to_keep 
-0003e2b0: 6c69 7374 2061 6e64 2072 656d 6f76 6520  list and remove 
-0003e2c0: 616e 7920 696e 2074 6865 0a20 2020 2020  any in the.     
-0003e2d0: 2020 2074 6f5f 7265 6d6f 7665 206c 6973     to_remove lis
-0003e2e0: 742e 0a0a 2020 2020 2020 2020 2a2a 5061  t...        **Pa
-0003e2f0: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-0003e300: 2020 2020 0a0a 2020 2020 2020 2020 746f      ..        to
-0003e310: 5f6b 6565 7020 3a20 6c69 7374 2c20 6465  _keep : list, de
-0003e320: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0003e330: 2020 2020 2020 204c 6973 7420 6f66 206e         List of n
-0003e340: 616d 6573 206f 6620 524f 4973 2074 6f20  ames of ROIs to 
-0003e350: 6b65 6570 2069 6e20 7468 6520 636f 7069  keep in the copi
-0003e360: 6564 2053 7472 7563 7475 7265 5365 743b  ed StructureSet;
-0003e370: 2061 6c6c 200a 2020 2020 2020 2020 2020   all .          
-0003e380: 2020 6f74 6865 7273 2077 696c 6c20 6265    others will be
-0003e390: 2072 656d 6f76 6564 2e20 5468 6573 6520   removed. These 
-0003e3a0: 6e61 6d65 7320 6361 6e20 616c 736f 2063  names can also c
-0003e3b0: 6f6e 7461 696e 2077 696c 6463 6172 6473  ontain wildcards
-0003e3c0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0003e3d0: 6820 7468 6520 272a 2720 7379 6d62 6f6c  h the '*' symbol
-0003e3e0: 2e20 0a0a 2020 2020 2020 2020 746f 5f72  . ..        to_r
-0003e3f0: 656d 6f76 6520 3a20 6c69 7374 2c20 6465  emove : list, de
-0003e400: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0003e410: 2020 2020 2020 204c 6973 7420 6f66 206e         List of n
-0003e420: 616d 6573 206f 6620 524f 4973 2074 6f20  ames of ROIs to 
-0003e430: 7265 6d6f 7665 2066 726f 6d20 7468 6520  remove from the 
-0003e440: 636f 7069 6564 2053 7472 7563 7475 7265  copied Structure
-0003e450: 5365 743b 2061 6c6c 200a 2020 2020 2020  Set; all .      
-0003e460: 2020 2020 2020 6f74 6865 7273 2077 696c        others wil
-0003e470: 6c20 6265 2072 656d 6f76 6564 2e20 5468  l be removed. Th
-0003e480: 6573 6520 6e61 6d65 7320 6361 6e20 616c  ese names can al
-0003e490: 736f 2063 6f6e 7461 696e 2077 696c 6463  so contain wildc
-0003e4a0: 6172 6473 0a20 2020 2020 2020 2020 2020  ards.           
-0003e4b0: 2077 6974 6820 7468 6520 272a 2720 7379   with the '*' sy
-0003e4c0: 6d62 6f6c 2e20 4170 706c 6965 6420 6166  mbol. Applied af
-0003e4d0: 7465 7220 6669 6c74 6572 696e 6720 7769  ter filtering wi
-0003e4e0: 7468 203c 746f 5f6b 6565 703e 2e0a 2020  th <to_keep>..  
-0003e4f0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0003e500: 2020 2023 2045 6e73 7572 6520 746f 5f6b     # Ensure to_k
-0003e510: 6565 7020 616e 6420 746f 5f72 656d 6f76  eep and to_remov
-0003e520: 6520 6172 6520 6c69 7374 730a 2020 2020  e are lists.    
-0003e530: 2020 2020 6966 2074 6f5f 6b65 6570 2069      if to_keep i
-0003e540: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0003e550: 2020 2020 746f 5f6b 6565 7020 3d20 7365      to_keep = se
-0003e560: 6c66 2e74 6f5f 6b65 6570 0a20 2020 2020  lf.to_keep.     
-0003e570: 2020 2065 6c69 6620 6e6f 7420 736b 7274     elif not skrt
-0003e580: 2e63 6f72 652e 6973 5f6c 6973 7428 746f  .core.is_list(to
-0003e590: 5f6b 6565 7029 3a0a 2020 2020 2020 2020  _keep):.        
-0003e5a0: 2020 2020 746f 5f6b 6565 7020 3d20 5b74      to_keep = [t
-0003e5b0: 6f5f 6b65 6570 5d0a 2020 2020 2020 2020  o_keep].        
-0003e5c0: 6966 2074 6f5f 7265 6d6f 7665 2069 7320  if to_remove is 
-0003e5d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0003e5e0: 2020 746f 5f72 656d 6f76 6520 3d20 7365    to_remove = se
-0003e5f0: 6c66 2e74 6f5f 7265 6d6f 7665 0a20 2020  lf.to_remove.   
-0003e600: 2020 2020 2065 6c69 6620 6e6f 7420 736b       elif not sk
-0003e610: 7274 2e63 6f72 652e 6973 5f6c 6973 7428  rt.core.is_list(
-0003e620: 746f 5f72 656d 6f76 6529 3a0a 2020 2020  to_remove):.    
-0003e630: 2020 2020 2020 2020 746f 5f72 656d 6f76          to_remov
-0003e640: 6520 3d20 5b74 6f5f 7265 6d6f 7665 5d0a  e = [to_remove].
-0003e650: 0a20 2020 2020 2020 2023 204b 6565 7020  .        # Keep 
-0003e660: 6f6e 6c79 2074 6865 2052 4f49 7320 696e  only the ROIs in
-0003e670: 2074 6f5f 6b65 6570 0a20 2020 2020 2020   to_keep.       
-0003e680: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
-0003e690: 2020 2020 2069 6620 746f 5f6b 6565 7020       if to_keep 
-0003e6a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0003e6b0: 2020 2020 2020 2020 206b 6565 7020 3d20           keep = 
-0003e6c0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
-0003e6d0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
-0003e6e0: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
-0003e6f0: 2020 2020 2069 6620 616e 7928 5b66 6e6d       if any([fnm
-0003e700: 6174 6368 2e66 6e6d 6174 6368 2872 6f69  atch.fnmatch(roi
-0003e710: 2e6e 616d 652e 6c6f 7765 7228 292c 206b  .name.lower(), k
-0003e720: 2e6c 6f77 6572 2829 2920 0a20 2020 2020  .lower()) .     
-0003e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e740: 2020 2066 6f72 206b 2069 6e20 746f 5f6b     for k in to_k
-0003e750: 6565 705d 293a 0a20 2020 2020 2020 2020  eep]):.         
-0003e760: 2020 2020 2020 2020 2020 206b 6565 702e             keep.
-0003e770: 6170 7065 6e64 2872 6f69 290a 2020 2020  append(roi).    
-0003e780: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
-0003e790: 7320 3d20 6b65 6570 0a0a 2020 2020 2020  s = keep..      
-0003e7a0: 2020 2320 5265 6d6f 7665 2074 6865 2052    # Remove the R
-0003e7b0: 4f49 7320 696e 2074 6f5f 7265 6d6f 7665  OIs in to_remove
-0003e7c0: 0a20 2020 2020 2020 2069 6620 746f 5f72  .        if to_r
-0003e7d0: 656d 6f76 6520 6973 206e 6f74 204e 6f6e  emove is not Non
-0003e7e0: 653a 0a20 2020 2020 2020 2020 2020 206b  e:.            k
-0003e7f0: 6565 7020 3d20 5b5d 0a20 2020 2020 2020  eep = [].       
-0003e800: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
-0003e810: 7365 6c66 2e72 6f69 733a 0a20 2020 2020  self.rois:.     
-0003e820: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0003e830: 7420 616e 7928 0a20 2020 2020 2020 2020  t any(.         
-0003e840: 2020 2020 2020 2020 2020 205b 666e 6d61             [fnma
-0003e850: 7463 682e 666e 6d61 7463 6828 726f 692e  tch.fnmatch(roi.
-0003e860: 6e61 6d65 2e6c 6f77 6572 2829 2c20 722e  name.lower(), r.
-0003e870: 6c6f 7765 7228 2929 200a 2020 2020 2020  lower()) .      
-0003e880: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0003e890: 6f72 2072 2069 6e20 746f 5f72 656d 6f76  or r in to_remov
-0003e8a0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-0003e8b0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-0003e8c0: 2020 2020 2020 2020 2020 6b65 6570 2e61            keep.a
-0003e8d0: 7070 656e 6428 726f 6929 0a20 2020 2020  ppend(roi).     
-0003e8e0: 2020 2020 2020 2073 656c 662e 726f 6973         self.rois
-0003e8f0: 203d 206b 6565 700a 0a20 2020 2064 6566   = keep..    def
-0003e900: 2073 6574 5f61 6c70 6861 5f62 6574 615f   set_alpha_beta_
-0003e910: 7261 7469 6f73 280a 2020 2020 2020 2020  ratios(.        
-0003e920: 2020 2020 7365 6c66 2c20 616c 7068 615f      self, alpha_
-0003e930: 6265 7461 5f72 6174 696f 733d 4e6f 6e65  beta_ratios=None
-0003e940: 2c20 7365 745f 6173 5f64 6566 6175 6c74  , set_as_default
-0003e950: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-0003e960: 2222 220a 2020 2020 2020 2020 5365 7420  """.        Set 
-0003e970: 7261 7469 6f73 2066 6f72 2052 4f49 2074  ratios for ROI t
-0003e980: 6973 7375 6573 206f 6620 636f 6566 6669  issues of coeffi
-0003e990: 6369 656e 7473 206f 6620 6c69 6e65 6172  cients of linear
-0003e9a0: 2d71 7561 6472 6174 6963 2065 7175 6174  -quadratic equat
-0003e9b0: 696f 6e2e 0a0a 2020 2020 2020 2020 4f70  ion...        Op
-0003e9c0: 7469 6f6e 616c 6c79 2069 6e70 7574 2076  tionally input v
-0003e9d0: 616c 7565 7320 666f 7220 7261 7469 6f73  alues for ratios
-0003e9e0: 2061 7320 7374 7275 6374 7572 652d 7365   as structure-se
-0003e9f0: 7420 6465 6661 756c 742e 0a0a 2020 2020  t default...    
-0003ea00: 2020 2020 2a2a 5061 7261 6d65 7465 723a      **Parameter:
-0003ea10: 2a2a 0a0a 2020 2020 2020 2020 616c 7068  **..        alph
-0003ea20: 615f 6265 7461 5f72 6174 696f 7320 3a20  a_beta_ratios : 
-0003ea30: 6469 6374 2c20 6465 6661 756c 743d 4e6f  dict, default=No
-0003ea40: 6e65 0a20 2020 2020 2020 2020 2020 2044  ne.            D
-0003ea50: 6963 7469 6f6e 6172 7920 7768 6572 6520  ictionary where 
-0003ea60: 6b65 7973 2061 7265 2052 4f49 206e 616d  keys are ROI nam
-0003ea70: 6573 2061 6e64 2076 616c 7565 7320 6172  es and values ar
-0003ea80: 650a 2020 2020 2020 2020 2020 2020 7261  e.            ra
-0003ea90: 7469 6f73 2066 6f72 2052 4f49 2074 6973  tios for ROI tis
-0003eaa0: 7375 6573 206f 6620 636f 6566 6669 6369  sues of coeffici
-0003eab0: 656e 7473 2c20 616c 7068 612c 2062 6574  ents, alpha, bet
-0003eac0: 612c 0a20 2020 2020 2020 2020 2020 2069  a,.            i
-0003ead0: 6e20 7468 6520 6c69 6e65 6172 2d71 7561  n the linear-qua
-0003eae0: 6472 6174 6963 2065 7175 6174 696f 6e2e  dratic equation.
-0003eaf0: 2020 5468 6573 6520 7261 7469 6f73 2061    These ratios a
-0003eb00: 7265 0a20 2020 2020 2020 2020 2020 2075  re.            u
-0003eb10: 7365 6420 696e 2063 616c 6375 6c61 7469  sed in calculati
-0003eb20: 6e67 2062 696f 6c6f 6769 6361 6c6c 7920  ng biologically 
-0003eb30: 6566 6665 6374 6976 6520 646f 7365 2c20  effective dose, 
-0003eb40: 4245 442c 2066 726f 6d0a 2020 2020 2020  BED, from.      
-0003eb50: 2020 2020 2020 7068 7973 6963 616c 2064        physical d
-0003eb60: 6f73 652c 2044 2c20 6465 6c69 7665 7265  ose, D, delivere
-0003eb70: 6420 6f76 6572 206e 2065 7175 616c 2066  d over n equal f
-0003eb80: 7261 6374 696f 6e73 3a0a 2020 2020 2020  ractions:.      
-0003eb90: 2020 2020 2020 2020 2020 4245 4420 3d20            BED = 
-0003eba0: 4420 2a20 2831 202b 2028 442f 6e29 202f  D * (1 + (D/n) /
-0003ebb0: 2028 616c 7068 612f 6265 7461 2929 2e0a   (alpha/beta))..
-0003ebc0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0003ebd0: 6174 7472 6962 7574 6520 616c 7068 615f  attribute alpha_
-0003ebe0: 6f76 6572 5f76 616c 7565 2069 7320 7365  over_value is se
-0003ebf0: 7420 746f 2074 6865 2064 6963 7469 6f6e  t to the diction
-0003ec00: 6172 7920 7661 6c75 650a 2020 2020 2020  ary value.      
-0003ec10: 2020 2020 2020 666f 7220 616e 2052 4f49        for an ROI
-0003ec20: 2069 6465 6e74 6966 6965 6420 6279 2061   identified by a
-0003ec30: 206b 6579 2c20 6f72 2069 7320 7365 7420   key, or is set 
-0003ec40: 746f 204e 6f6e 6520 666f 7220 616e 790a  to None for any.
-0003ec50: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-0003ec60: 7220 524f 4973 2e20 2049 6620 7468 6973  r ROIs.  If this
-0003ec70: 2070 6172 616d 6574 6572 2069 7320 7365   parameter is se
-0003ec80: 7420 746f 204e 6f6e 652c 2076 616c 7565  t to None, value
-0003ec90: 7320 6172 6520 7365 740a 2020 2020 2020  s are set.      
-0003eca0: 2020 2020 2020 6672 6f6d 2073 656c 662e        from self.
-0003ecb0: 616c 7068 615f 6265 7461 5f72 6174 696f  alpha_beta_ratio
-0003ecc0: 732e 0a0a 2020 2020 2020 2020 7365 745f  s...        set_
-0003ecd0: 6173 5f64 6566 6175 6c74 203a 2062 6f6f  as_default : boo
-0003ece0: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
-0003ecf0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-0003ed00: 7275 652c 2061 6e64 2061 6c70 6861 5f62  rue, and alpha_b
-0003ed10: 6574 615f 7261 7469 6f73 2069 736e 2774  eta_ratios isn't
-0003ed20: 204e 6f6e 652c 2073 6574 0a20 2020 2020   None, set.     
-0003ed30: 2020 2020 2020 2073 656c 662e 616c 7068         self.alph
-0003ed40: 615f 6265 7461 5f72 6174 696f 7320 746f  a_beta_ratios to
-0003ed50: 2074 6865 2076 616c 7565 206f 6620 616c   the value of al
-0003ed60: 7068 615f 6265 7461 5f72 6174 696f 732e  pha_beta_ratios.
-0003ed70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003ed80: 2020 2020 2069 6620 616c 7068 615f 6265       if alpha_be
-0003ed90: 7461 5f72 6174 696f 7320 6973 204e 6f6e  ta_ratios is Non
-0003eda0: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
-0003edb0: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
-0003edc0: 203d 2073 656c 662e 616c 7068 615f 6265   = self.alpha_be
-0003edd0: 7461 5f72 6174 696f 730a 2020 2020 2020  ta_ratios.      
-0003ede0: 2020 656c 6966 2073 6574 5f61 735f 6465    elif set_as_de
-0003edf0: 6661 756c 743a 0a20 2020 2020 2020 2020  fault:.         
-0003ee00: 2020 2073 656c 662e 616c 7068 615f 6265     self.alpha_be
-0003ee10: 7461 5f72 6174 696f 7320 3d20 616c 7068  ta_ratios = alph
-0003ee20: 615f 6265 7461 5f72 6174 696f 730a 0a20  a_beta_ratios.. 
-0003ee30: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
-0003ee40: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
-0003ee50: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0003ee60: 6f69 2e73 6574 5f61 6c70 6861 5f6f 7665  oi.set_alpha_ove
-0003ee70: 725f 6265 7461 2861 6c70 6861 5f62 6574  r_beta(alpha_bet
-0003ee80: 615f 7261 7469 6f73 2e67 6574 2872 6f69  a_ratios.get(roi
-0003ee90: 2e6e 616d 652c 204e 6f6e 6529 290a 0a20  .name, None)).. 
-0003eea0: 2020 2064 6566 2067 6574 5f61 6c70 6861     def get_alpha
-0003eeb0: 5f62 6574 615f 7261 7469 6f73 2873 656c  _beta_ratios(sel
-0003eec0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0003eed0: 2020 2020 2020 2020 4765 7420 6469 6374          Get dict
-0003eee0: 696f 6e61 7279 206f 6620 7261 7469 6f20  ionary of ratio 
-0003eef0: 6f66 2063 6f65 6666 6963 6965 6e74 7320  of coefficients 
-0003ef00: 6f66 206c 696e 6561 722d 7175 6164 7261  of linear-quadra
-0003ef10: 7469 6320 6571 7561 7469 6f6e 2e0a 2020  tic equation..  
-0003ef20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0003ef30: 2020 7265 7475 726e 207b 726f 695f 6e61    return {roi_na
-0003ef40: 6d65 203a 2073 656c 665b 726f 695f 6e61  me : self[roi_na
-0003ef50: 6d65 5d2e 6765 745f 616c 7068 615f 6f76  me].get_alpha_ov
-0003ef60: 6572 5f62 6574 6128 290a 2020 2020 2020  er_beta().      
-0003ef70: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
-0003ef80: 695f 6e61 6d65 2069 6e20 736f 7274 6564  i_name in sorted
-0003ef90: 2873 656c 662e 6765 745f 726f 695f 6e61  (self.get_roi_na
-0003efa0: 6d65 7328 2929 7d0a 0a20 2020 2064 6566  mes())}..    def
-0003efb0: 2067 6574 5f63 6f6c 6f72 7328 7365 6c66   get_colors(self
-0003efc0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-0003efd0: 7420 6469 6374 206f 6620 524f 4920 636f  t dict of ROI co
-0003efe0: 6c6f 7273 2066 6f72 2065 6163 6820 6e61  lors for each na
-0003eff0: 6d65 2e22 2222 0a0a 2020 2020 2020 2020  me."""..        
-0003f000: 7265 7475 726e 207b 726f 692e 6e61 6d65  return {roi.name
-0003f010: 3a20 726f 692e 636f 6c6f 7220 666f 7220  : roi.color for 
-0003f020: 726f 6920 696e 2073 656c 662e 6765 745f  roi in self.get_
-0003f030: 726f 6973 2829 7d0a 0a20 2020 2064 6566  rois()}..    def
-0003f040: 2072 6563 6f6c 6f72 5f72 6f69 7328 7365   recolor_rois(se
-0003f050: 6c66 2c20 636f 6c6f 7273 293a 0a20 2020  lf, colors):.   
-0003f060: 2020 2020 2022 2222 5365 7420 636f 6c6f       """Set colo
-0003f070: 7273 206f 6620 524f 4973 2075 7369 6e67  rs of ROIs using
-0003f080: 2061 206c 6973 7420 6f72 2064 6963 7420   a list or dict 
-0003f090: 6769 7665 6e20 696e 203c 636f 6c6f 7273  given in <colors
-0003f0a0: 3e2e 0a0a 2020 2020 2020 2020 2a2a 5061  >...        **Pa
-0003f0b0: 7261 6d65 7465 7273 2a2a 3a0a 0a20 2020  rameters**:..   
-0003f0c0: 2020 2020 2063 6f6c 6f72 7320 3a20 6c69       colors : li
-0003f0d0: 7374 2f64 6963 740a 2020 2020 2020 2020  st/dict.        
-0003f0e0: 2020 2020 4c69 7374 206f 7220 6469 6374      List or dict
-0003f0f0: 206f 6620 636f 6c6f 7273 2e20 4966 2061   of colors. If a
-0003f100: 2064 6963 742c 2074 6865 206b 6579 7320   dict, the keys 
-0003f110: 7368 6f75 6c64 2062 6520 524f 4920 6e61  should be ROI na
-0003f120: 6d65 7320 6f72 0a20 2020 2020 2020 2020  mes or.         
-0003f130: 2020 2077 696c 6463 6172 6473 206d 6174     wildcards mat
-0003f140: 6368 696e 6720 524f 4920 6e61 6d65 732c  ching ROI names,
-0003f150: 2061 6e64 2074 6865 2076 616c 7565 7320   and the values 
-0003f160: 7368 6f75 6c64 2062 6520 6465 7369 7265  should be desire
-0003f170: 6420 0a20 2020 2020 2020 2020 2020 2063  d .            c
-0003f180: 6f6c 6f72 7320 666f 7220 524f 4973 206d  olors for ROIs m
-0003f190: 6174 6368 696e 6720 7468 6174 206e 616d  atching that nam
-0003f1a0: 652e 2049 6620 6120 6c69 7374 2c20 7368  e. If a list, sh
-0003f1b0: 6f75 6c64 2063 6f6e 7461 696e 0a20 2020  ould contain.   
-0003f1c0: 2020 2020 2020 2020 2063 6f6c 6f72 7320           colors 
-0003f1d0: 7768 6963 6820 7769 6c6c 2062 6520 6170  which will be ap
-0003f1e0: 706c 6965 6420 746f 206c 6f61 6465 6420  plied to loaded 
-0003f1f0: 524f 4973 2069 6e20 6f72 6465 722e 0a20  ROIs in order.. 
-0003f200: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0003f210: 2020 2020 6966 2063 6f6c 6f72 7320 6973      if colors is
-0003f220: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0003f230: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
-0003f240: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0003f250: 2863 6f6c 6f72 732c 2064 6963 7429 3a0a  (colors, dict):.
-0003f260: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0003f270: 6e61 6d65 2c20 636f 6c6f 7220 696e 2063  name, color in c
-0003f280: 6f6c 6f72 732e 6974 656d 7328 293a 0a20  olors.items():. 
-0003f290: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0003f2a0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
-0003f2b0: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
-0003f2c0: 2020 2020 2020 2020 2069 6620 666e 6d61           if fnma
-0003f2d0: 7463 682e 666e 6d61 7463 6828 726f 692e  tch.fnmatch(roi.
-0003f2e0: 6e61 6d65 2e6c 6f77 6572 2829 2c20 6e61  name.lower(), na
-0003f2f0: 6d65 2e6c 6f77 6572 2829 293a 0a20 2020  me.lower()):.   
-0003f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f310: 2020 2020 2072 6f69 2e73 6574 5f63 6f6c       roi.set_col
-0003f320: 6f72 2863 6f6c 6f72 290a 2020 2020 2020  or(color).      
-0003f330: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0003f340: 6528 636f 6c6f 7273 2c20 6c69 7374 293a  e(colors, list):
-0003f350: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0003f360: 2069 2c20 636f 6c6f 7220 696e 2065 6e75   i, color in enu
-0003f370: 6d65 7261 7465 2863 6f6c 6f72 7329 3a0a  merate(colors):.
-0003f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f390: 6966 2069 203e 3d20 6c65 6e28 7365 6c66  if i >= len(self
-0003f3a0: 2e72 6f69 7329 3a0a 2020 2020 2020 2020  .rois):.        
-0003f3b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003f3c0: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
-0003f3d0: 2020 2073 656c 662e 726f 6973 5b69 5d2e     self.rois[i].
-0003f3e0: 7365 745f 636f 6c6f 7228 636f 6c6f 7229  set_color(color)
-0003f3f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0003f400: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0003f410: 2054 7970 6545 7272 6f72 2822 3c63 6f6c   TypeError("<col
-0003f420: 6f72 733e 206d 7573 7420 6265 206c 6973  ors> must be lis
-0003f430: 7420 6f72 2064 6963 742e 2229 0a0a 2020  t or dict.")..  
-0003f440: 2020 6465 6620 6164 645f 726f 6973 2873    def add_rois(s
-0003f450: 656c 662c 2073 6f75 7263 6573 293a 0a20  elf, sources):. 
-0003f460: 2020 2020 2020 2022 2222 4164 6420 6164         """Add ad
-0003f470: 6469 7469 6f6e 616c 2052 4f49 7320 6672  ditional ROIs fr
-0003f480: 6f6d 2073 6f75 7263 6528 7329 2e22 2222  om source(s)."""
-0003f490: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0003f4a0: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
-0003f4b0: 7374 2873 6f75 7263 6573 293a 0a20 2020  st(sources):.   
-0003f4c0: 2020 2020 2020 2020 2073 6f75 7263 6573           sources
-0003f4d0: 203d 205b 736f 7572 6365 735d 0a20 2020   = [sources].   
-0003f4e0: 2020 2020 2073 656c 662e 736f 7572 6365       self.source
-0003f4f0: 732e 6578 7465 6e64 2873 6f75 7263 6573  s.extend(sources
-0003f500: 290a 2020 2020 2020 2020 7365 6c66 2e6c  ).        self.l
-0003f510: 6f61 6428 736f 7572 6365 7329 0a0a 2020  oad(sources)..  
-0003f520: 2020 6465 6620 6164 645f 726f 6928 7365    def add_roi(se
-0003f530: 6c66 2c20 736f 7572 6365 2c20 2a2a 6b77  lf, source, **kw
-0003f540: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-0003f550: 2222 4164 6420 6120 7369 6e67 6c65 2052  ""Add a single R
-0003f560: 4f49 2077 6974 6820 206f 7074 696f 6e61  OI with  optiona
-0003f570: 6c20 6b77 6172 6773 2e22 2222 0a0a 2020  l kwargs."""..  
-0003f580: 2020 2020 2020 7365 6c66 2e73 6f75 7263        self.sourc
-0003f590: 6573 2e61 7070 656e 6428 736f 7572 6365  es.append(source
-0003f5a0: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
-0003f5b0: 6e73 7461 6e63 6528 736f 7572 6365 2c20  nstance(source, 
-0003f5c0: 524f 4929 3a0a 2020 2020 2020 2020 2020  ROI):.          
-0003f5d0: 2020 726f 6920 3d20 736f 7572 6365 0a20    roi = source. 
-0003f5e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0003f5f0: 2020 2020 2020 2020 2072 6f69 5f6b 7761           roi_kwa
-0003f600: 7267 7320 3d20 7365 6c66 2e72 6f69 5f6b  rgs = self.roi_k
-0003f610: 7761 7267 732e 636f 7079 2829 0a20 2020  wargs.copy().   
-0003f620: 2020 2020 2020 2020 2072 6f69 5f6b 7761           roi_kwa
-0003f630: 7267 732e 7570 6461 7465 286b 7761 7267  rgs.update(kwarg
-0003f640: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-0003f650: 6f69 203d 2052 4f49 2873 6f75 7263 652c  oi = ROI(source,
-0003f660: 202a 2a72 6f69 5f6b 7761 7267 7329 0a20   **roi_kwargs). 
-0003f670: 2020 2020 2020 2072 6f69 2e73 7472 7563         roi.struc
-0003f680: 7475 7265 5f73 6574 203d 2073 656c 660a  ture_set = self.
-0003f690: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
-0003f6a0: 732e 6170 7065 6e64 2872 6f69 290a 0a20  s.append(roi).. 
-0003f6b0: 2020 2064 6566 2063 6c6f 6e65 5f61 7474     def clone_att
-0003f6c0: 7273 2873 656c 662c 206f 626a 2c20 636f  rs(self, obj, co
-0003f6d0: 7079 5f72 6f69 733d 5472 7565 2c20 636f  py_rois=True, co
-0003f6e0: 7079 5f72 6f69 5f64 6174 613d 5472 7565  py_roi_data=True
-0003f6f0: 293a 0a20 2020 2020 2020 2022 2222 4173  ):.        """As
-0003f700: 7369 676e 2061 6c6c 2061 7474 7269 6275  sign all attribu
-0003f710: 7465 7320 6f66 203c 7365 6c66 3e20 746f  tes of <self> to
-0003f720: 2061 6e6f 7468 6572 206f 626a 6563 742c   another object,
-0003f730: 203c 6f62 6a3e 2c20 656e 7375 7269 6e67   <obj>, ensuring
-0003f740: 0a20 2020 2020 2020 2074 6861 7420 524f  .        that RO
-0003f750: 4973 2061 7265 2063 6f70 6965 6420 6966  Is are copied if
-0003f760: 2063 6f70 795f 726f 6973 3d54 7275 652e   copy_rois=True.
-0003f770: 2222 220a 0a20 2020 2020 2020 2073 6b72  """..        skr
-0003f780: 742e 636f 7265 2e44 6174 612e 636c 6f6e  t.core.Data.clon
-0003f790: 655f 6174 7472 7328 7365 6c66 2c20 6f62  e_attrs(self, ob
-0003f7a0: 6a29 0a20 2020 2020 2020 2069 6620 636f  j).        if co
-0003f7b0: 7079 5f72 6f69 733a 0a20 2020 2020 2020  py_rois:.       
-0003f7c0: 2020 2020 206f 626a 2e72 6f69 7320 3d20       obj.rois = 
-0003f7d0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
-0003f7e0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
-0003f7f0: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
-0003f800: 2020 2020 206f 626a 2e72 6f69 732e 6170       obj.rois.ap
-0003f810: 7065 6e64 2872 6f69 2e63 6c6f 6e65 2863  pend(roi.clone(c
-0003f820: 6f70 795f 6461 7461 3d63 6f70 795f 726f  opy_data=copy_ro
-0003f830: 695f 6461 7461 2929 0a0a 2020 2020 6465  i_data))..    de
-0003f840: 6620 6669 6c74 6572 6564 5f63 6f70 7928  f filtered_copy(
-0003f850: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0003f860: 2020 2020 2020 206e 616d 6573 3d4e 6f6e         names=Non
-0003f870: 652c 0a20 2020 2020 2020 206e 616d 653d  e,.        name=
-0003f880: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
-0003f890: 5f6b 6565 703d 4e6f 6e65 2c0a 2020 2020  _keep=None,.    
-0003f8a0: 2020 2020 746f 5f72 656d 6f76 653d 4e6f      to_remove=No
-0003f8b0: 6e65 2c0a 2020 2020 2020 2020 6b65 6570  ne,.        keep
-0003f8c0: 5f72 656e 616d 6564 5f6f 6e6c 793d 4661  _renamed_only=Fa
-0003f8d0: 6c73 652c 0a20 2020 2020 2020 2063 6f70  lse,.        cop
-0003f8e0: 795f 726f 695f 6461 7461 3d54 7275 650a  y_roi_data=True.
-0003f8f0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0003f900: 2222 4372 6561 7465 2061 2063 6f70 7920  ""Create a copy 
-0003f910: 6f66 2074 6869 7320 7374 7275 6374 7572  of this structur
-0003f920: 6520 7365 7420 7769 7468 2052 4f49 7320  e set with ROIs 
-0003f930: 6f70 7469 6f6e 616c 6c79 0a20 2020 2020  optionally.     
-0003f940: 2020 2072 656e 616d 6564 206f 7220 6669     renamed or fi
-0003f950: 6c74 6572 6564 2e20 5265 7475 726e 7320  ltered. Returns 
-0003f960: 6120 6e65 7720 5374 7275 6374 7572 6553  a new StructureS
-0003f970: 6574 206f 626a 6563 742e 0a0a 2020 2020  et object...    
-0003f980: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-0003f990: 3a2a 2a0a 2020 2020 2020 2020 0a20 2020  :**.        .   
-0003f9a0: 2020 2020 206e 616d 6573 203a 2064 6963       names : dic
-0003f9b0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-0003f9c0: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
-0003f9d0: 696f 6e61 7279 206f 6620 6e61 6d65 7320  ionary of names 
-0003f9e0: 666f 7220 7265 6e61 6d69 6e67 2052 4f49  for renaming ROI
-0003f9f0: 732c 2077 6865 7265 2074 6865 206b 6579  s, where the key
-0003fa00: 7320 6172 6520 6e65 7720 0a20 2020 2020  s are new .     
-0003fa10: 2020 2020 2020 206e 616d 6573 2061 6e64         names and
-0003fa20: 2076 616c 7565 7320 6172 6520 6c69 7374   values are list
-0003fa30: 7320 6f66 2070 6f73 7369 626c 6520 6e61  s of possible na
-0003fa40: 6d65 7320 6f66 2052 4f49 7320 7468 6174  mes of ROIs that
-0003fa50: 2073 686f 756c 640a 2020 2020 2020 2020   should.        
-0003fa60: 2020 2020 6265 2061 7373 6967 6e65 6420      be assigned 
-0003fa70: 7468 6520 6e65 7720 6e61 6d65 2e20 5468  the new name. Th
-0003fa80: 6573 6520 6e61 6d65 7320 6361 6e20 616c  ese names can al
-0003fa90: 736f 2063 6f6e 7461 696e 2077 696c 6463  so contain wildc
-0003faa0: 6172 6473 0a20 2020 2020 2020 2020 2020  ards.           
-0003fab0: 2077 6974 6820 7468 6520 272a 2720 7379   with the '*' sy
-0003fac0: 6d62 6f6c 2e0a 0a20 2020 2020 2020 206e  mbol...        n
-0003fad0: 616d 6520 3a20 7374 722c 2064 6566 6175  ame : str, defau
-0003fae0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0003faf0: 2020 2020 4e61 6d65 2066 6f72 2074 6865      Name for the
-0003fb00: 2072 6574 7572 6e65 6420 5374 7275 6374   returned Struct
-0003fb10: 7572 6553 6574 2e0a 0a20 2020 2020 2020  ureSet...       
-0003fb20: 2074 6f5f 6b65 6570 203a 206c 6973 742c   to_keep : list,
-0003fb30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0003fb40: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-0003fb50: 6620 6e61 6d65 7320 6f66 2052 4f49 7320  f names of ROIs 
-0003fb60: 746f 206b 6565 7020 696e 2074 6865 2063  to keep in the c
-0003fb70: 6f70 6965 6420 5374 7275 6374 7572 6553  opied StructureS
-0003fb80: 6574 3b20 616c 6c20 0a20 2020 2020 2020  et; all .       
-0003fb90: 2020 2020 206f 7468 6572 7320 7769 6c6c       others will
-0003fba0: 2062 6520 7265 6d6f 7665 642e 2054 6865   be removed. The
-0003fbb0: 7365 206e 616d 6573 2063 616e 2061 6c73  se names can als
-0003fbc0: 6f20 636f 6e74 6169 6e20 7769 6c64 6361  o contain wildca
-0003fbd0: 7264 730a 2020 2020 2020 2020 2020 2020  rds.            
-0003fbe0: 7769 7468 2074 6865 2027 2a27 2073 796d  with the '*' sym
-0003fbf0: 626f 6c2e 2041 7070 6c69 6564 2061 6674  bol. Applied aft
-0003fc00: 6572 2072 656e 616d 696e 6720 7769 7468  er renaming with
-0003fc10: 203c 6e61 6d65 733e 2e0a 0a20 2020 2020   <names>...     
-0003fc20: 2020 2074 6f5f 7265 6d6f 7665 203a 206c     to_remove : l
-0003fc30: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
-0003fc40: 650a 2020 2020 2020 2020 2020 2020 4c69  e.            Li
-0003fc50: 7374 206f 6620 6e61 6d65 7320 6f66 2052  st of names of R
-0003fc60: 4f49 7320 746f 2072 656d 6f76 6520 6672  OIs to remove fr
-0003fc70: 6f6d 2074 6865 2063 6f70 6965 6420 5374  om the copied St
-0003fc80: 7275 6374 7572 6553 6574 3b20 616c 6c20  ructureSet; all 
-0003fc90: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-0003fca0: 6572 7320 7769 6c6c 2062 6520 7265 6d6f  ers will be remo
-0003fcb0: 7665 642e 2054 6865 7365 206e 616d 6573  ved. These names
-0003fcc0: 2063 616e 2061 6c73 6f20 636f 6e74 6169   can also contai
-0003fcd0: 6e20 7769 6c64 6361 7264 730a 2020 2020  n wildcards.    
-0003fce0: 2020 2020 2020 2020 7769 7468 2074 6865          with the
-0003fcf0: 2027 2a27 2073 796d 626f 6c2e 2041 7070   '*' symbol. App
-0003fd00: 6c69 6564 2061 6674 6572 2072 656e 616d  lied after renam
-0003fd10: 696e 6720 7769 7468 203c 6e61 6d65 733e  ing with <names>
-0003fd20: 2061 6e64 200a 2020 2020 2020 2020 2020   and .          
-0003fd30: 2020 6669 6c74 6572 696e 6720 7769 7468    filtering with
-0003fd40: 203c 746f 5f6b 6565 703e 2e0a 0a20 2020   <to_keep>...   
-0003fd50: 2020 2020 206b 6565 705f 7265 6e61 6d65       keep_rename
-0003fd60: 645f 6f6e 6c79 203a 2062 6f6f 6c2c 2064  d_only : bool, d
-0003fd70: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-0003fd80: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-0003fd90: 2c20 616e 7920 524f 4973 2074 6861 7420  , any ROIs that 
-0003fda0: 646f 206e 6f74 2067 6574 2072 656e 616d  do not get renam
-0003fdb0: 6564 2077 696c 6c20 6265 2072 656d 6f76  ed will be remov
-0003fdc0: 6564 2066 726f 6d0a 2020 2020 2020 2020  ed from.        
-0003fdd0: 2020 2020 7468 6520 5374 7275 6374 7572      the Structur
-0003fde0: 6553 6574 2e0a 0a20 2020 2020 2020 2063  eSet...        c
-0003fdf0: 6f70 795f 726f 695f 6461 7461 203a 2062  opy_roi_data : b
-0003fe00: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
-0003fe10: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-0003fe20: 2054 7275 652c 2074 6865 2052 4f49 7320   True, the ROIs 
-0003fe30: 696e 2074 6865 2072 6574 7572 6e65 6420  in the returned 
-0003fe40: 5374 7275 6374 7572 6553 6574 2077 696c  StructureSet wil
-0003fe50: 6c20 636f 6e74 6169 6e0a 2020 2020 2020  l contain.      
-0003fe60: 2020 2020 2020 636f 7069 6573 206f 6620        copies of 
-0003fe70: 7468 6520 6461 7461 2066 726f 6d20 7468  the data from th
-0003fe80: 6520 6f72 6967 696e 616c 2053 7472 7563  e original Struc
-0003fe90: 7475 7265 5365 742e 204f 7468 6572 7769  tureSet. Otherwi
-0003fea0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-0003feb0: 7468 6520 6e65 7720 524f 4973 2077 696c  the new ROIs wil
-0003fec0: 6c20 636f 6e74 6169 6e20 7265 6665 7265  l contain refere
-0003fed0: 6e63 6573 2074 6f20 7468 6520 7361 6d65  nces to the same
-0003fee0: 2064 6174 612c 2065 2e67 2e20 7468 6520   data, e.g. the 
-0003fef0: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-0003ff00: 6520 6e75 6d70 7920 6e64 6172 7261 7920  e numpy ndarray 
-0003ff10: 6f62 6a65 6374 2066 6f72 2074 6865 206d  object for the m
-0003ff20: 6173 6b2f 7361 6d65 2064 6963 7420 666f  ask/same dict fo
-0003ff30: 7220 7468 6520 636f 6e74 6f75 7273 2e0a  r the contours..
-0003ff40: 2020 2020 2020 2020 2020 2020 4f6e 6c79              Only
-0003ff50: 2075 7365 6420 6966 203c 636f 7079 5f72   used if <copy_r
-0003ff60: 6f69 733e 2069 7320 5472 7565 0a20 2020  ois> is True.   
-0003ff70: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0003ff80: 2020 2320 4c6f 6164 2053 7472 7563 7475    # Load Structu
-0003ff90: 7265 5365 742c 2062 7574 2070 7265 7665  reSet, but preve
-0003ffa0: 6e74 206c 6f61 6469 6e67 206f 6620 524f  nt loading of RO
-0003ffb0: 4973 2e0a 2020 2020 2020 2020 2320 4c6f  Is..        # Lo
-0003ffc0: 6164 696e 6720 524f 4973 2068 6572 6520  ading ROIs here 
-0003ffd0: 636f 6e73 756d 6573 2074 696d 6520 616e  consumes time an
-0003ffe0: 6420 6d65 6d6f 7279 2063 7265 6174 696e  d memory creatin
-0003fff0: 6720 6d61 736b 730a 2020 2020 2020 2020  g masks.        
-00040000: 2320 666f 7220 524f 4973 2074 6861 7420  # for ROIs that 
-00040010: 6d61 7920 6265 2064 6973 6361 7264 6564  may be discarded
-00040020: 2061 6674 6572 2066 696c 7465 7269 6e67   after filtering
-00040030: 2e0a 2020 2020 2020 2020 726f 695f 6c6f  ..        roi_lo
-00040040: 6164 203d 2073 656c 662e 726f 695f 6b77  ad = self.roi_kw
-00040050: 6172 6773 2e67 6574 2822 6c6f 6164 222c  args.get("load",
-00040060: 204e 6f6e 6529 0a20 2020 2020 2020 2073   None).        s
-00040070: 656c 662e 726f 695f 6b77 6172 6773 5b22  elf.roi_kwargs["
-00040080: 6c6f 6164 225d 203d 2046 616c 7365 0a20  load"] = False. 
-00040090: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-000400a0: 2829 0a0a 2020 2020 2020 2020 7373 203d  ()..        ss =
-000400b0: 2073 656c 662e 636c 6f6e 6528 636f 7079   self.clone(copy
-000400c0: 5f72 6f69 5f64 6174 613d 636f 7079 5f72  _roi_data=copy_r
-000400d0: 6f69 5f64 6174 6129 0a20 2020 2020 2020  oi_data).       
-000400e0: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
-000400f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00040100: 2020 7373 2e6e 616d 6520 3d20 6e61 6d65    ss.name = name
-00040110: 0a20 2020 2020 2020 2073 732e 7265 6e61  .        ss.rena
-00040120: 6d65 5f72 6f69 7328 6e61 6d65 732c 206b  me_rois(names, k
-00040130: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
-00040140: 3d6b 6565 705f 7265 6e61 6d65 645f 6f6e  =keep_renamed_on
-00040150: 6c79 290a 2020 2020 2020 2020 7373 2e66  ly).        ss.f
-00040160: 696c 7465 725f 726f 6973 2874 6f5f 6b65  ilter_rois(to_ke
-00040170: 6570 2c20 746f 5f72 656d 6f76 6529 0a0a  ep, to_remove)..
-00040180: 2020 2020 2020 2020 2320 456e 7375 7265          # Ensure
-00040190: 2074 6861 7420 7365 6c66 2e72 6f69 5f6b   that self.roi_k
-000401a0: 7761 7267 7320 6973 2074 6865 2073 616d  wargs is the sam
-000401b0: 6520 6173 2061 7420 696e 7075 742e 0a20  e as at input.. 
-000401c0: 2020 2020 2020 2069 6620 726f 695f 6c6f         if roi_lo
-000401d0: 6164 2069 7320 4e6f 6e65 3a0a 2020 2020  ad is None:.    
-000401e0: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
-000401f0: 5f6b 7761 7267 732e 706f 7028 226c 6f61  _kwargs.pop("loa
-00040200: 6422 290a 2020 2020 2020 2020 656c 7365  d").        else
-00040210: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00040220: 6c66 2e72 6f69 5f6b 7761 7267 735b 226c  lf.roi_kwargs["l
-00040230: 6f61 6422 5d20 3d20 726f 695f 6c6f 6164  oad"] = roi_load
-00040240: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00040250: 2073 730a 0a20 2020 2064 6566 2067 6574   ss..    def get
-00040260: 5f72 6f69 7328 7365 6c66 2c20 6e61 6d65  _rois(self, name
-00040270: 733d 4e6f 6e65 2c20 6967 6e6f 7265 5f65  s=None, ignore_e
-00040280: 6d70 7479 3d46 616c 7365 293a 0a20 2020  mpty=False):.   
-00040290: 2020 2020 2022 2222 4765 7420 6c69 7374       """Get list
-000402a0: 206f 6620 524f 4920 6f62 6a65 6374 7320   of ROI objects 
-000402b0: 4966 203c 6e61 6d65 733e 2069 7320 6769  If <names> is gi
-000402c0: 7665 6e2c 206f 6e6c 7920 7468 6520 524f  ven, only the RO
-000402d0: 4973 2077 6974 680a 2020 2020 2020 2020  Is with.        
-000402e0: 7468 6f73 6520 6e61 6d65 7320 7769 6c6c  those names will
-000402f0: 2062 6520 7265 7475 726e 6564 2e22 2222   be returned."""
-00040300: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-00040310: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
-00040320: 206e 616d 6573 2069 7320 4e6f 6e65 3a0a   names is None:.
-00040330: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00040340: 676e 6f72 655f 656d 7074 793a 0a20 2020  gnore_empty:.   
-00040350: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00040360: 7572 6e20 5b72 6f69 2066 6f72 2072 6f69  urn [roi for roi
-00040370: 2069 6e20 7365 6c66 2e72 6f69 7320 6966   in self.rois if
-00040380: 206e 6f74 2072 6f69 2e65 6d70 7479 5d0a   not roi.empty].
-00040390: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000403a0: 726e 2073 656c 662e 726f 6973 0a0a 2020  rn self.rois..  
-000403b0: 2020 2020 2020 726f 6973 203d 205b 5d0a        rois = [].
-000403c0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-000403d0: 2069 6e20 6e61 6d65 733a 0a20 2020 2020   in names:.     
-000403e0: 2020 2020 2020 2072 6f69 203d 2073 656c         roi = sel
-000403f0: 662e 6765 745f 726f 6928 6e61 6d65 290a  f.get_roi(name).
-00040400: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00040410: 6f69 2069 7320 6e6f 7420 4e6f 6e65 3a0a  oi is not None:.
-00040420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040430: 6966 206e 6f74 2069 676e 6f72 655f 656d  if not ignore_em
-00040440: 7074 7920 6f72 206e 6f74 2072 6f69 2e65  pty or not roi.e
-00040450: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
-00040460: 2020 2020 2020 2020 2020 726f 6973 2e61            rois.a
-00040470: 7070 656e 6428 726f 6929 0a20 2020 2020  ppend(roi).     
-00040480: 2020 2072 6574 7572 6e20 726f 6973 0a0a     return rois..
-00040490: 2020 2020 6465 6620 6765 745f 726f 6973      def get_rois
-000404a0: 5f77 696c 6463 6172 6428 7365 6c66 2c20  _wildcard(self, 
-000404b0: 7769 6c64 6361 7264 293a 0a20 2020 2020  wildcard):.     
-000404c0: 2020 2022 2222 5265 7475 726e 206c 6973     """Return lis
-000404d0: 7420 6f66 2052 4f49 7320 6d61 7463 6869  t of ROIs matchi
-000404e0: 6e67 2061 2077 696c 6463 6172 6420 6578  ng a wildcard ex
-000404f0: 7072 6573 7369 6f6e 2e22 2222 0a0a 2020  pression."""..  
-00040500: 2020 2020 2020 726f 6973 203d 205b 5d0a        rois = [].
-00040510: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
-00040520: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
-00040530: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00040540: 6966 2066 6e6d 6174 6368 2e66 6e6d 6174  if fnmatch.fnmat
-00040550: 6368 2872 6f69 2e6e 616d 652e 6c6f 7765  ch(roi.name.lowe
-00040560: 7228 292c 2077 696c 6463 6172 642e 6c6f  r(), wildcard.lo
-00040570: 7765 7228 2929 3a0a 2020 2020 2020 2020  wer()):.        
-00040580: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
-00040590: 656e 6428 726f 6929 0a20 2020 2020 2020  end(roi).       
-000405a0: 2072 6574 7572 6e20 726f 6973 0a0a 2020   return rois..  
-000405b0: 2020 6465 6620 6765 745f 726f 695f 6e61    def get_roi_na
-000405c0: 6d65 7328 7365 6c66 2c20 6f72 6967 696e  mes(self, origin
-000405d0: 616c 3d46 616c 7365 2c20 6967 6e6f 7265  al=False, ignore
-000405e0: 5f65 6d70 7479 3d46 616c 7365 293a 0a20  _empty=False):. 
-000405f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00040600: 2020 2047 6574 206c 6973 7420 6f66 206e     Get list of n
-00040610: 616d 6573 206f 6620 524f 4973 2069 6e20  ames of ROIs in 
-00040620: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
-00040630: 6574 2e20 4966 203c 6f72 6967 696e 616c  et. If <original
-00040640: 3e20 6973 2054 7275 652c 0a20 2020 2020  > is True,.     
-00040650: 2020 2067 6574 2074 6865 206f 7269 6769     get the origi
-00040660: 6e61 6c20 6e61 6d65 7320 6f66 2074 6865  nal names of the
-00040670: 2052 4f49 732e 2020 4966 203c 6967 6e6f   ROIs.  If <igno
-00040680: 7265 5f65 6d70 7479 3e20 6973 2054 7275  re_empty> is Tru
-00040690: 652c 0a20 2020 2020 2020 206f 6d69 7420  e,.        omit 
-000406a0: 6e61 6d65 7320 6f66 2065 6d70 7479 2052  names of empty R
-000406b0: 4f49 732e 0a20 2020 2020 2020 2022 2222  OIs..        """
-000406c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000406d0: 205b 732e 6765 745f 6e61 6d65 286f 7269   [s.get_name(ori
-000406e0: 6769 6e61 6c29 2066 6f72 2073 2069 6e20  ginal) for s in 
-000406f0: 7365 6c66 2e67 6574 5f72 6f69 7328 290a  self.get_rois().
-00040700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040710: 6966 206e 6f74 2028 6967 6e6f 7265 5f65  if not (ignore_e
-00040720: 6d70 7479 2061 6e64 2073 2e65 6d70 7479  mpty and s.empty
-00040730: 295d 0a0a 0a20 2020 2064 6566 2067 6574  )]...    def get
-00040740: 5f72 6f69 5f64 6963 7428 7365 6c66 293a  _roi_dict(self):
-00040750: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00040760: 6469 6374 206f 6620 524f 4920 6e61 6d65  dict of ROI name
-00040770: 7320 616e 6420 6f62 6a65 6374 732e 2222  s and objects.""
-00040780: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-00040790: 6e20 7b73 2e6e 616d 653a 2073 2066 6f72  n {s.name: s for
-000407a0: 2073 2069 6e20 7365 6c66 2e67 6574 5f72   s in self.get_r
-000407b0: 6f69 7328 297d 0a0a 2020 2020 6465 6620  ois()}..    def 
-000407c0: 6765 745f 726f 6928 7365 6c66 2c20 6e61  get_roi(self, na
-000407d0: 6d65 293a 0a20 2020 2020 2020 2022 2222  me):.        """
-000407e0: 4765 7420 616e 2052 4f49 2077 6974 6820  Get an ROI with 
-000407f0: 6120 7370 6563 6966 6963 206e 616d 652e  a specific name.
-00040800: 2222 220a 0a20 2020 2020 2020 2072 6f69  """..        roi
-00040810: 7320 3d20 7365 6c66 2e67 6574 5f72 6f69  s = self.get_roi
-00040820: 5f64 6963 7428 290a 2020 2020 2020 2020  _dict().        
-00040830: 6966 206e 616d 6520 6e6f 7420 696e 2072  if name not in r
-00040840: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
-00040850: 2070 7269 6e74 2866 2252 4f49 207b 6e61   print(f"ROI {na
-00040860: 6d65 7d20 6e6f 7420 666f 756e 6421 2229  me} not found!")
-00040870: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00040880: 7572 6e0a 2020 2020 2020 2020 7265 7475  urn.        retu
-00040890: 726e 2072 6f69 735b 6e61 6d65 5d0a 0a20  rn rois[name].. 
-000408a0: 2020 2064 6566 2070 7269 6e74 5f72 6f69     def print_roi
-000408b0: 7328 7365 6c66 293a 0a0a 2020 2020 2020  s(self):..      
-000408c0: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
-000408d0: 2020 2020 2020 7072 696e 7428 225c 6e22        print("\n"
-000408e0: 2e6a 6f69 6e28 7365 6c66 2e67 6574 5f72  .join(self.get_r
-000408f0: 6f69 5f6e 616d 6573 2829 2929 0a0a 2020  oi_names()))..  
-00040900: 2020 6465 6620 6765 745f 6e61 6d65 2873    def get_name(s
-00040910: 656c 6629 3a0a 2020 2020 2020 2020 2727  elf):.        ''
-00040920: 270a 2020 2020 2020 2020 4c6f 6164 2073  '.        Load s
-00040930: 656c 6620 616e 6420 6765 7420 6e61 6d65  elf and get name
-00040940: 2e0a 2020 2020 2020 2020 2727 270a 0a20  ..        '''.. 
-00040950: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00040960: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00040970: 6e20 2873 656c 662e 6e61 6d65 290a 0a20  n (self.name).. 
-00040980: 2020 2064 6566 2067 6574 5f74 7261 6e73     def get_trans
-00040990: 6c61 7469 6f6e 5f74 6f5f 616c 6967 6e28  lation_to_align(
-000409a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000409b0: 662c 206f 7468 6572 2c20 7a5f 6672 6163  f, other, z_frac
-000409c0: 7469 6f6e 313d 4e6f 6e65 2c20 7a5f 6672  tion1=None, z_fr
-000409d0: 6163 7469 6f6e 323d 4e6f 6e65 293a 0a20  action2=None):. 
-000409e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000409f0: 2020 2044 6574 6572 6d69 6e65 2074 7261     Determine tra
-00040a00: 6e73 6c61 7469 6f6e 2066 6f72 2061 6c69  nslation for ali
-00040a10: 676e 696e 6720 3c73 656c 663e 2074 6f20  gning <self> to 
-00040a20: 3c6f 7468 6572 3e2e 0a0a 2020 2020 2020  <other>...      
-00040a30: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-00040a40: 2a0a 0a20 2020 2020 2020 206f 7468 6572  *..        other
-00040a50: 203a 2052 4f49 2f53 7472 7563 7475 7265   : ROI/Structure
-00040a60: 5365 742f 6c69 7374 0a20 2020 2020 2020  Set/list.       
-00040a70: 2020 2020 2052 4f49 2077 6974 6820 7768       ROI with wh
-00040a80: 6963 6820 616c 6967 6e6d 656e 7420 6973  ich alignment is
-00040a90: 2074 6f20 6265 2070 6572 666f 726d 6564   to be performed
-00040aa0: 2e20 2054 6869 7320 6361 6e20 6265 0a20  .  This can be. 
-00040ab0: 2020 2020 2020 2020 2020 2073 7065 6369             speci
-00040ac0: 6669 6564 2064 6972 6563 746c 7920 6173  fied directly as
-00040ad0: 2061 2073 696e 676c 6520 524f 492e 2020   a single ROI.  
-00040ae0: 416c 7465 726e 6174 6976 656c 792c 2069  Alternatively, i
-00040af0: 7420 6361 6e0a 2020 2020 2020 2020 2020  t can.          
-00040b00: 2020 6265 2061 2053 7472 7563 7475 7265    be a Structure
-00040b10: 5365 742c 206f 7220 6120 6c69 7374 206f  Set, or a list o
-00040b20: 7220 524f 492f 5374 7275 6374 7572 6553  r ROI/StructureS
-00040b30: 6574 206f 626a 6563 7473 2c0a 2020 2020  et objects,.    
-00040b40: 2020 2020 2020 2020 696e 2077 6869 6368          in which
-00040b50: 2063 6173 6520 7468 6520 696e 6469 7669   case the indivi
-00040b60: 6475 616c 2052 4f49 7320 7769 6c6c 2062  dual ROIs will b
-00040b70: 6520 636f 6d62 696e 6564 2e0a 0a20 2020  e combined...   
-00040b80: 2020 2020 207a 5f66 7261 6374 696f 6e31       z_fraction1
-00040b90: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
-00040ba0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00040bb0: 2020 2050 6f73 6974 696f 6e20 616c 6f6e     Position alon
-00040bc0: 6720 7a20 6178 6973 206f 6620 736c 6963  g z axis of slic
-00040bd0: 6520 7468 726f 7567 6820 3c73 656c 663e  e through <self>
-00040be0: 206f 6e20 7768 6963 680a 2020 2020 2020   on which.      
-00040bf0: 2020 2020 2020 746f 2061 6c69 676e 2e20        to align. 
-00040c00: 2049 6620 4e6f 6e65 2c20 616c 6967 6e6d   If None, alignm
-00040c10: 656e 7420 6973 2074 6f20 7468 6520 6365  ent is to the ce
-00040c20: 6e74 726f 6964 206f 6620 7468 650a 2020  ntroid of the.  
-00040c30: 2020 2020 2020 2020 2020 7768 6f6c 6520            whole 
-00040c40: 524f 4920 766f 6c75 6d65 2e20 204f 7468  ROI volume.  Oth
-00040c50: 6572 7769 7365 2c20 616c 6967 6e6d 656e  erwise, alignmen
-00040c60: 7420 6973 2074 6f20 7468 650a 2020 2020  t is to the.    
-00040c70: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-00040c80: 206f 6620 7468 6520 736c 6963 6520 6174   of the slice at
-00040c90: 2074 6865 2073 7065 6369 6669 6564 2064   the specified d
-00040ca0: 6973 7461 6e63 650a 2020 2020 2020 2020  istance.        
-00040cb0: 2020 2020 6672 6f6d 2074 6865 2052 4f49      from the ROI
-00040cc0: 2773 206d 6f73 742d 696e 6665 7269 6f72  's most-inferior
-00040cd0: 2070 6f69 6e74 3a20 3020 636f 7272 6573   point: 0 corres
-00040ce0: 706f 6e64 7320 746f 0a20 2020 2020 2020  ponds to.       
-00040cf0: 2020 2020 2074 6865 206d 6f73 742d 696e       the most-in
-00040d00: 6665 7269 6f72 2070 6f69 6e74 2028 6c6f  ferior point (lo
-00040d10: 7765 7374 207a 293b 2031 2063 6f72 7265  west z); 1 corre
-00040d20: 7370 6f6e 6473 2074 6f20 7468 650a 2020  sponds to the.  
-00040d30: 2020 2020 2020 2020 2020 6d6f 7374 2d73            most-s
-00040d40: 7570 6572 696f 7220 706f 696e 7420 2868  uperior point (h
-00040d50: 6967 6865 7374 207a 292e 2020 5661 6c75  ighest z).  Valu
-00040d60: 6573 2066 6f72 207a 5f66 7261 6374 696f  es for z_fractio
-00040d70: 6e0a 2020 2020 2020 2020 2020 2020 6f75  n.            ou
-00040d80: 7473 6964 6520 7468 6520 696e 7465 7276  tside the interv
-00040d90: 616c 205b 302c 2031 5d20 7265 7375 6c74  al [0, 1] result
-00040da0: 2069 6e20 6120 5275 6e74 696d 6545 7272   in a RuntimeErr
-00040db0: 6f72 2e0a 0a20 2020 2020 2020 207a 5f66  or...        z_f
-00040dc0: 7261 6374 696f 6e32 203a 2066 6c6f 6174  raction2 : float
-00040dd0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00040de0: 2020 2020 2020 2020 2020 2050 6f73 6974             Posit
-00040df0: 696f 6e20 616c 6f6e 6720 7a20 6178 6973  ion along z axis
-00040e00: 206f 6620 736c 6963 6520 7468 726f 7567   of slice throug
-00040e10: 6820 3c6f 7468 6572 3e20 6f6e 2077 6869  h <other> on whi
-00040e20: 6368 0a20 2020 2020 2020 2020 2020 2074  ch.            t
-00040e30: 6f20 616c 6967 6e2e 2020 4966 204e 6f6e  o align.  If Non
-00040e40: 652c 2061 6c69 676e 6d65 6e74 2069 7320  e, alignment is 
-00040e50: 746f 2074 6865 2063 656e 7472 6f69 6420  to the centroid 
-00040e60: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
-00040e70: 2020 2077 686f 6c65 2052 4f49 2076 6f6c     whole ROI vol
-00040e80: 756d 652e 2020 4f74 6865 7277 6973 652c  ume.  Otherwise,
-00040e90: 2061 6c69 676e 6d65 6e74 2069 7320 746f   alignment is to
-00040ea0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00040eb0: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
-00040ec0: 2073 6c69 6365 2061 7420 7468 6520 7370   slice at the sp
-00040ed0: 6563 6966 6965 6420 6469 7374 616e 6365  ecified distance
-00040ee0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
-00040ef0: 6d20 7468 6520 524f 4927 7320 6d6f 7374  m the ROI's most
-00040f00: 2d69 6e66 6572 696f 7220 706f 696e 743a  -inferior point:
-00040f10: 2030 2063 6f72 7265 7370 6f6e 6473 2074   0 corresponds t
-00040f20: 6f0a 2020 2020 2020 2020 2020 2020 7468  o.            th
-00040f30: 6520 6d6f 7374 2d69 6e66 6572 696f 7220  e most-inferior 
-00040f40: 706f 696e 7420 286c 6f77 6573 7420 7a29  point (lowest z)
-00040f50: 3b20 3120 636f 7272 6573 706f 6e64 7320  ; 1 corresponds 
-00040f60: 746f 2074 6865 0a20 2020 2020 2020 2020  to the.         
-00040f70: 2020 206d 6f73 742d 7375 7065 7269 6f72     most-superior
-00040f80: 2070 6f69 6e74 2028 6869 6768 6573 7420   point (highest 
-00040f90: 7a29 2e20 2056 616c 7565 7320 666f 7220  z).  Values for 
-00040fa0: 7a5f 6672 6163 7469 6f6e 0a20 2020 2020  z_fraction.     
-00040fb0: 2020 2020 2020 206f 7574 7369 6465 2074         outside t
-00040fc0: 6865 2069 6e74 6572 7661 6c20 5b30 2c20  he interval [0, 
-00040fd0: 315d 2072 6573 756c 7420 696e 2061 2052  1] result in a R
-00040fe0: 756e 7469 6d65 4572 726f 722e 0a20 2020  untimeError..   
-00040ff0: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
-00041000: 2020 2020 2072 6574 7572 6e20 6765 745f       return get_
-00041010: 7472 616e 736c 6174 696f 6e5f 746f 5f61  translation_to_a
-00041020: 6c69 676e 280a 2020 2020 2020 2020 2020  lign(.          
-00041030: 2020 2020 2020 7365 6c66 2c20 6f74 6865        self, othe
-00041040: 722c 207a 5f66 7261 6374 696f 6e31 2c20  r, z_fraction1, 
-00041050: 7a5f 6672 6163 7469 6f6e 3229 0a0a 2020  z_fraction2)..  
-00041060: 2020 6465 6620 6765 745f 636f 6e66 6f72    def get_confor
-00041070: 6d69 7479 5f69 6e64 6578 2873 656c 662c  mity_index(self,
-00041080: 206e 616d 6573 3d4e 6f6e 652c 202a 2a6b   names=None, **k
-00041090: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-000410a0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-000410b0: 636f 6e66 6f72 6d69 7479 2069 6e64 6578  conformity index
-000410c0: 2066 6f72 2052 4f49 7320 6f66 2074 6865   for ROIs of the
-000410d0: 2053 7472 7563 7475 7265 5365 742e 0a0a   StructureSet...
-000410e0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-000410f0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
-00041100: 206e 616d 6573 203a 206c 6973 742c 2064   names : list, d
-00041110: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00041120: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-00041130: 7374 7269 6e67 7320 636f 7272 6573 706f  strings correspo
-00041140: 6e64 696e 6720 746f 2052 4f49 206e 616d  nding to ROI nam
-00041150: 6573 2e20 2049 6620 6e6f 6e2d 6e75 6c6c  es.  If non-null
-00041160: 2c0a 2020 2020 2020 2020 2020 2020 5468  ,.            Th
-00041170: 6520 636f 6e66 6f72 6d69 7479 2069 6e64  e conformity ind
-00041180: 6578 2069 7320 6361 6c63 756c 6174 6564  ex is calculated
-00041190: 2072 656c 6174 6976 6520 666f 7220 7468   relative for th
-000411a0: 6520 524f 4973 0a20 2020 2020 2020 2020  e ROIs.         
-000411b0: 2020 2077 6974 6820 7468 6520 6c69 7374     with the list
-000411c0: 6564 206e 616d 6573 206f 6e6c 792e 2020  ed names only.  
-000411d0: 4f74 6865 7277 6973 652c 2074 6865 2063  Otherwise, the c
-000411e0: 6f6e 666f 726d 6974 790a 2020 2020 2020  onformity.      
-000411f0: 2020 2020 2020 696e 6465 7820 6973 2063        index is c
-00041200: 616c 6375 6c61 7465 6420 7265 6c61 7469  alculated relati
-00041210: 7665 2074 6f20 616c 6c20 524f 4973 2069  ve to all ROIs i
-00041220: 6e20 7468 6520 7374 7275 6374 7572 650a  n the structure.
-00041230: 2020 2020 2020 2020 2020 2020 7365 742e              set.
-00041240: 0a0a 2020 2020 2020 2020 6b77 6172 6773  ..        kwargs
-00041250: 0a20 2020 2020 2020 2020 2020 204b 6579  .            Key
-00041260: 776f 7264 2061 7267 756d 656e 7473 2061  word arguments a
-00041270: 7265 2070 6173 7365 6420 746f 0a20 2020  re passed to.   
-00041280: 2020 2020 2020 2020 2073 6b72 742e 7374           skrt.st
-00041290: 7275 6374 7572 6573 2e67 6574 5f63 6f6e  ructures.get_con
-000412a0: 666f 726d 6974 795f 696e 6465 7828 292e  formity_index().
-000412b0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
-000412c0: 7461 6e63 6573 2829 2e0a 2020 2020 2020  tances()..      
-000412d0: 2020 2020 2020 5365 6520 646f 6375 6d65        See docume
-000412e0: 6e74 6174 696f 6e20 6f66 2074 6869 7320  ntation of this 
-000412f0: 6675 6e63 7469 6f6e 2066 6f72 2070 6172  function for par
-00041300: 616d 6574 6572 2064 6574 6169 6c73 2e0a  ameter details..
-00041310: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00041320: 2020 2020 7265 7475 726e 2067 6574 5f63      return get_c
-00041330: 6f6e 666f 726d 6974 795f 696e 6465 7828  onformity_index(
-00041340: 7365 6c66 2e67 6574 5f72 6f69 7328 6e61  self.get_rois(na
-00041350: 6d65 7329 2c20 2a2a 6b77 6172 6773 290a  mes), **kwargs).
-00041360: 0a20 2020 2064 6566 2067 6574 5f67 656f  .    def get_geo
-00041370: 6d65 7472 7928 0a20 2020 2020 2020 2073  metry(.        s
-00041380: 656c 662c 200a 2020 2020 2020 2020 6e61  elf, .        na
-00041390: 6d65 5f61 735f 696e 6465 783d 5472 7565  me_as_index=True
-000413a0: 2c20 0a20 2020 2020 2020 2068 746d 6c3d  , .        html=
-000413b0: 4661 6c73 652c 200a 2020 2020 2020 2020  False, .        
-000413c0: 636f 6c6f 7265 643d 4661 6c73 652c 0a20  colored=False,. 
-000413d0: 2020 2020 2020 2067 7265 7965 645f 6f75         greyed_ou
-000413e0: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
-000413f0: 726f 695f 6b77 6172 6773 3d7b 7d2c 0a20  roi_kwargs={},. 
-00041400: 2020 2020 2020 202a 2a6b 7761 7267 7329         **kwargs)
-00041410: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-00041420: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-00041430: 6520 6f66 2067 656f 6d65 7472 6963 2070  e of geometric p
-00041440: 726f 7065 7274 6965 7320 666f 7220 616c  roperties for al
-00041450: 6c20 524f 4973 2e0a 2020 2020 2020 2020  l ROIs..        
-00041460: 4966 206e 6f20 736c 2f69 6478 2f70 6f73  If no sl/idx/pos
-00041470: 2069 7320 6769 7665 6e2c 2074 6865 2063   is given, the c
-00041480: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-00041490: 6561 6368 2052 4f49 2077 696c 6c20 6265  each ROI will be
-000414a0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-000414b0: 2a2a 5061 7261 6d65 7465 7273 2a2a 3a0a  **Parameters**:.
-000414c0: 0a20 2020 2020 2020 206e 616d 655f 6173  .        name_as
-000414d0: 5f69 6e64 6578 203a 2062 6f6f 6c2c 2064  _index : bool, d
-000414e0: 6566 6175 6c74 3d54 7275 650a 2020 2020  efault=True.    
-000414f0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00041500: 2074 6865 2052 4f49 206e 616d 6573 2077   the ROI names w
-00041510: 696c 6c20 6265 2075 7365 6420 6173 2072  ill be used as r
-00041520: 6f77 2069 6e64 6963 6573 3b20 6f74 6865  ow indices; othe
-00041530: 7277 6973 652c 2074 6865 790a 2020 2020  rwise, they.    
-00041540: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-00041550: 6769 7665 6e20 7468 6569 7220 6f77 6e20  given their own 
-00041560: 636f 6c75 6d6e 2e0a 0a20 2020 2020 2020  column...       
-00041570: 2068 746d 6c20 3a20 626f 6f6c 2c20 6465   html : bool, de
-00041580: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00041590: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-000415a0: 2074 6865 2074 6162 6c65 2077 696c 6c20   the table will 
-000415b0: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
-000415c0: 4854 4d4c 2074 6578 7420 636f 6c6f 722d  HTML text color-
-000415d0: 636f 6465 6420 6261 7365 640a 2020 2020  coded based.    
-000415e0: 2020 2020 2020 2020 6f6e 2052 4f49 2063          on ROI c
-000415f0: 6f6c 6f72 732e 0a20 2020 2020 2020 2022  olors..        "
-00041600: 2222 0a0a 2020 2020 2020 2020 6966 2068  ""..        if h
-00041610: 746d 6c3a 0a20 2020 2020 2020 2020 2020  tml:.           
-00041620: 206e 616d 655f 6173 5f69 6e64 6578 203d   name_as_index =
-00041630: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
-00041640: 6620 6772 6579 6564 5f6f 7574 2069 7320  f greyed_out is 
-00041650: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00041660: 2020 6772 6579 6564 5f6f 7574 203d 205b    greyed_out = [
-00041670: 5d0a 0a20 2020 2020 2020 2072 6f77 7320  ]..        rows 
-00041680: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-00041690: 2072 6f69 2069 6e20 7365 6c66 2e67 6574   roi in self.get
-000416a0: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
-000416b0: 7479 3d54 7275 6529 3a0a 0a20 2020 2020  ty=True):..     
-000416c0: 2020 2020 2020 2023 2047 6574 2044 6174         # Get Dat
-000416d0: 6146 7261 6d65 2066 6f72 2074 6869 7320  aFrame for this 
-000416e0: 524f 490a 2020 2020 2020 2020 2020 2020  ROI.            
-000416f0: 6466 5f72 6f77 203d 2072 6f69 2e67 6574  df_row = roi.get
-00041700: 5f67 656f 6d65 7472 7928 6e61 6d65 5f61  _geometry(name_a
-00041710: 735f 696e 6465 783d 6e61 6d65 5f61 735f  s_index=name_as_
-00041720: 696e 6465 782c 202a 2a6b 7761 7267 7329  index, **kwargs)
-00041730: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00041740: 5265 706c 6163 6520 616c 6c20 7661 6c75  Replace all valu
-00041750: 6573 2077 6974 6820 222d 2d22 2069 6620  es with "--" if 
-00041760: 6772 6579 696e 6720 6f75 7420 7468 6973  greying out this
-00041770: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
-00041780: 2069 6620 726f 6920 696e 2067 7265 7965   if roi in greye
-00041790: 645f 6f75 743a 0a20 2020 2020 2020 2020  d_out:.         
-000417a0: 2020 2020 2020 2066 6f72 2063 6f6c 2069         for col i
-000417b0: 6e20 6466 5f72 6f77 2e63 6f6c 756d 6e73  n df_row.columns
-000417c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000417d0: 2020 2020 2020 6966 2063 6f6c 203d 3d20        if col == 
-000417e0: 2252 4f49 223a 200a 2020 2020 2020 2020  "ROI": .        
-000417f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041800: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00041810: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00041820: 726f 775b 636f 6c5d 203d 2022 2d2d 220a  row[col] = "--".
-00041830: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-00041840: 6574 2052 4f49 206e 616d 6520 746f 2068  et ROI name to h
-00041850: 6176 6520 636f 6c6f 7265 6420 6261 636b  ave colored back
-00041860: 6772 6f75 6e64 2069 6620 7265 7175 6573  ground if reques
-00041870: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
-00041880: 6966 2063 6f6c 6f72 6564 3a0a 2020 2020  if colored:.    
-00041890: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-000418a0: 7220 3d20 726f 692e 6765 745f 636f 6c6f  r = roi.get_colo
-000418b0: 725f 6672 6f6d 5f6b 7761 7267 7328 726f  r_from_kwargs(ro
-000418c0: 695f 6b77 6172 6773 290a 2020 2020 2020  i_kwargs).      
-000418d0: 2020 2020 2020 2020 2020 636f 6c5f 7374            col_st
-000418e0: 7220 3d20 6765 745f 636f 6c6f 7265 645f  r = get_colored_
-000418f0: 726f 695f 7374 7269 6e67 280a 2020 2020  roi_string(.    
-00041900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041910: 2020 2020 726f 692c 2067 7265 793d 2872      roi, grey=(r
-00041920: 6f69 2069 6e20 6772 6579 6564 5f6f 7574  oi in greyed_out
-00041930: 292c 2063 6f6c 6f72 3d63 6f6c 6f72 290a  ), color=color).
-00041940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041950: 6966 206e 616d 655f 6173 5f69 6e64 6578  if name_as_index
-00041960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00041970: 2020 2020 2020 6466 5f72 6f77 2e72 656e        df_row.ren
-00041980: 616d 6528 7b64 665f 726f 772e 696e 6465  ame({df_row.inde
-00041990: 785b 305d 3a20 636f 6c5f 7374 727d 2c20  x[0]: col_str}, 
-000419a0: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
-000419b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000419c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000419d0: 2020 2020 2020 2020 6466 5f72 6f77 2e69          df_row.i
-000419e0: 6c6f 635b 302c 2030 5d20 3d20 636f 6c5f  loc[0, 0] = col_
-000419f0: 7374 720a 0a20 2020 2020 2020 2020 2020  str..           
-00041a00: 2072 6f77 732e 6170 7065 6e64 2864 665f   rows.append(df_
-00041a10: 726f 7729 0a0a 2020 2020 2020 2020 6466  row)..        df
-00041a20: 203d 2070 642e 636f 6e63 6174 2872 6f77   = pd.concat(row
-00041a30: 7329 0a0a 2020 2020 2020 2020 2320 5265  s)..        # Re
-00041a40: 7365 7420 696e 6465 7820 6966 206e 6f74  set index if not
-00041a50: 2075 7369 6e67 2052 4f49 206e 616d 6573   using ROI names
-00041a60: 2061 7320 696e 6465 780a 2020 2020 2020   as index.      
-00041a70: 2020 6966 206e 6f74 206e 616d 655f 6173    if not name_as
-00041a80: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
-00041a90: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
-00041aa0: 745f 696e 6465 7828 6472 6f70 3d54 7275  t_index(drop=Tru
-00041ab0: 6529 0a0a 2020 2020 2020 2020 2320 436f  e)..        # Co
-00041ac0: 6e76 6572 7420 746f 2048 544d 4c20 6966  nvert to HTML if
-00041ad0: 206e 6565 6465 640a 2020 2020 2020 2020   needed.        
-00041ae0: 6966 2068 746d 6c3a 0a20 2020 2020 2020  if html:.       
-00041af0: 2020 2020 2072 6574 7572 6e20 6466 5f74       return df_t
-00041b00: 6f5f 6874 6d6c 2864 6629 0a20 2020 2020  o_html(df).     
-00041b10: 2020 2072 6574 7572 6e20 6466 0a0a 2020     return df..  
-00041b20: 2020 6465 6620 6765 745f 636f 6d70 6172    def get_compar
-00041b30: 6973 6f6e 280a 2020 2020 2020 2020 7365  ison(.        se
-00041b40: 6c66 2c20 0a20 2020 2020 2020 206f 7468  lf, .        oth
-00041b50: 6572 3d4e 6f6e 652c 200a 2020 2020 2020  er=None, .      
-00041b60: 2020 636f 6d70 5f74 7970 653d 2261 7574    comp_type="aut
-00041b70: 6f22 2c20 0a20 2020 2020 2020 2063 6f6e  o", .        con
-00041b80: 7365 6e73 7573 5f74 7970 653d 226d 616a  sensus_type="maj
-00041b90: 6f72 6974 7922 2c20 0a20 2020 2020 2020  ority", .       
-00041ba0: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
-00041bb0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00041bc0: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
-00041bd0: 206f 6620 636f 6d70 6172 6973 6f6e 206d   of comparison m
-00041be0: 6574 7269 6373 2076 7320 6120 7369 6e67  etrics vs a sing
-00041bf0: 6c65 2052 4f49 206f 720a 2020 2020 2020  le ROI or.      
-00041c00: 2020 616e 6f74 6865 7220 5374 7275 6374    another Struct
-00041c10: 7572 6553 6574 2e0a 0a20 2020 2020 2020  ureSet...       
-00041c20: 202a 2a50 6172 616d 6574 6572 732a 2a3a   **Parameters**:
-00041c30: 0a0a 2020 2020 2020 2020 6f74 6865 7220  ..        other 
-00041c40: 3a20 524f 492f 5374 7275 6374 7572 6553  : ROI/StructureS
-00041c50: 6574 2c20 6465 6661 756c 743d 4e6f 6e65  et, default=None
-00041c60: 0a20 2020 2020 2020 2020 2020 204f 626a  .            Obj
-00041c70: 6563 7420 746f 2063 6f6d 7061 7265 206f  ect to compare o
-00041c80: 776e 2052 4f49 7320 7769 7468 2e20 4361  wn ROIs with. Ca
-00041c90: 6e20 6569 7468 6572 2062 6520 6120 7369  n either be a si
-00041ca0: 6e67 6c65 2052 4f49 2c20 7768 6963 680a  ngle ROI, which.
-00041cb0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-00041cc0: 2062 6520 636f 6d70 6172 6564 2074 6f20   be compared to 
-00041cd0: 6576 6572 7920 524f 4920 696e 2074 6869  every ROI in thi
-00041ce0: 7320 7374 7275 6374 7572 6520 7365 742c  s structure set,
-00041cf0: 206f 7220 616e 6f74 6865 720a 2020 2020   or another.    
-00041d00: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-00041d10: 6520 7365 742e 2049 6620 4e6f 6e65 2c20  e set. If None, 
-00041d20: 6120 636f 6d70 6172 6973 6f6e 2077 696c  a comparison wil
-00041d30: 6c20 6265 2070 6572 666f 726d 6564 2062  l be performed b
-00041d40: 6574 7765 656e 2074 6865 200a 2020 2020  etween the .    
-00041d50: 2020 2020 2020 2020 524f 4973 206f 6620          ROIs of 
-00041d60: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
-00041d70: 6574 2e0a 0a20 2020 2020 2020 2063 6f6d  et...        com
-00041d80: 705f 7479 7065 203a 2073 7472 2c20 6465  p_type : str, de
-00041d90: 6661 756c 743d 2261 7574 6f22 0a20 2020  fault="auto".   
-00041da0: 2020 2020 2020 2020 204d 6574 686f 6420           Method 
-00041db0: 666f 7220 7365 6c65 6374 696e 6720 7768  for selecting wh
-00041dc0: 6963 6820 524f 4973 2073 686f 756c 6420  ich ROIs should 
-00041dd0: 6265 2063 6f6d 7061 7265 6420 6966 206f  be compared if o
-00041de0: 7468 6572 3d4e 6f6e 650a 2020 2020 2020  ther=None.      
-00041df0: 2020 2020 2020 6f72 206f 7468 6572 2069        or other i
-00041e00: 7320 6120 5374 7275 6374 7572 6553 6574  s a StructureSet
-00041e10: 2e20 4f70 7469 6f6e 7320 6172 653a 0a0a  . Options are:..
-00041e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041e30: 2d20 2261 6c6c 2220 3a20 636f 6d70 6172  - "all" : compar
-00041e40: 6520 6576 6572 7920 524f 4920 696e 206f  e every ROI in o
-00041e50: 6e65 2073 7472 7563 7475 7265 2073 6574  ne structure set
-00041e60: 2074 6f20 6576 6572 7920 524f 490a 2020   to every ROI.  
-00041e70: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00041e80: 2074 6865 206f 7468 6572 2028 7265 6d6f   the other (remo
-00041e90: 7669 6e67 2063 6f6d 7061 7269 736f 6e73  ving comparisons
-00041ea0: 206f 6620 616e 2052 4f49 2074 6f20 6974   of an ROI to it
-00041eb0: 7365 6c66 292e 0a20 2020 2020 2020 2020  self)..         
-00041ec0: 2020 2020 2020 202d 2022 6279 5f6e 616d         - "by_nam
-00041ed0: 6522 203a 2063 6f6d 7061 7265 2065 7665  e" : compare eve
-00041ee0: 7279 2052 4f49 2069 6e20 6f6e 6520 7374  ry ROI in one st
-00041ef0: 7275 6374 7572 6520 7365 740a 2020 2020  ructure set.    
-00041f00: 2020 2020 2020 2020 2020 2020 746f 2065              to e
-00041f10: 7665 7279 2052 4f49 2069 6e20 7468 6520  very ROI in the 
-00041f20: 6f74 6865 7220 7769 7468 2074 6865 2073  other with the s
-00041f30: 616d 6520 6e61 6d65 2e20 5573 6566 756c  ame name. Useful
-00041f40: 2077 6865 6e0a 2020 2020 2020 2020 2020   when.          
-00041f50: 2020 2020 2020 636f 6d70 6172 696e 6720        comparing 
-00041f60: 7477 6f20 7374 7275 6374 7572 6520 7365  two structure se
-00041f70: 7473 2063 6f6e 7461 696e 696e 6720 524f  ts containing RO
-00041f80: 4973 2077 6974 6820 7468 6520 7361 6d65  Is with the same
-00041f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041fa0: 206e 616d 6573 2e0a 2020 2020 2020 2020   names..        
-00041fb0: 2020 2020 2020 2020 2d20 2263 6f6e 7365          - "conse
-00041fc0: 6e73 7573 2220 3a20 6966 206f 7468 6572  nsus" : if other
-00041fd0: 3d4e 6f6e 652c 2063 6f6d 7061 7265 2065  =None, compare e
-00041fe0: 6163 6820 524f 4920 696e 2074 6869 7320  ach ROI in this 
-00041ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042000: 2073 7472 7563 7475 7265 2073 6574 2074   structure set t
-00042010: 6f20 7468 6520 636f 6e73 656e 7375 7320  o the consensus 
-00042020: 6f66 2061 6c6c 206f 7468 6572 2052 4f49  of all other ROI
-00042030: 733b 206f 7468 6572 7769 7365 2c0a 2020  s; otherwise,.  
-00042040: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00042050: 6d70 6172 6520 6561 6368 2052 4f49 2069  mpare each ROI i
-00042060: 6e20 7468 6973 2073 7472 7563 7475 7265  n this structure
-00042070: 2073 6574 2074 6f20 7468 6520 636f 6e73   set to the cons
-00042080: 656e 7375 7320 6f66 0a20 2020 2020 2020  ensus of.       
-00042090: 2020 2020 2020 2020 2061 6c6c 2052 4f49           all ROI
-000420a0: 7320 696e 2074 6865 206f 7468 6572 2073  s in the other s
-000420b0: 7472 7563 7475 7265 2073 6574 2e20 436f  tructure set. Co
-000420c0: 6e73 656e 7375 7320 7479 7065 2069 7320  nsensus type is 
-000420d0: 7365 7420 7669 610a 2020 2020 2020 2020  set via.        
-000420e0: 2020 2020 2020 2020 7468 6520 636f 6e73          the cons
-000420f0: 656e 7375 735f 7479 7065 2061 7267 756d  ensus_type argum
-00042100: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
-00042110: 2020 2020 202d 2022 6175 746f 2220 3a20       - "auto" : 
-00042120: 6966 206f 7468 6572 3d4e 6f6e 652c 2075  if other=None, u
-00042130: 7365 2022 616c 6c22 2063 6f6d 7061 7269  se "all" compari
-00042140: 736f 6e2e 204f 7468 6572 7769 7365 2c20  son. Otherwise, 
-00042150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042160: 2066 6972 7374 206c 6f6f 6b20 666f 7220   first look for 
-00042170: 616e 7920 524f 4973 2077 6974 6820 6d61  any ROIs with ma
-00042180: 7463 6869 6e67 206e 616d 6573 3b20 6966  tching names; if
-00042190: 2061 7420 6c65 6173 7420 6f6e 6520 0a20   at least one . 
-000421a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000421b0: 6174 6368 696e 6720 7061 6972 2069 7320  atching pair is 
-000421c0: 666f 756e 642c 2063 6f6d 7061 7265 2076  found, compare v
-000421d0: 6961 2074 6865 2022 6279 5f6e 616d 6522  ia the "by_name"
-000421e0: 2063 6f6d 7061 7269 736f 6e20 0a20 2020   comparison .   
-000421f0: 2020 2020 2020 2020 2020 2020 2074 7970               typ
-00042200: 652e 2049 6620 6e6f 206d 6174 6368 6573  e. If no matches
-00042210: 2061 7265 2066 6f75 6e64 2c20 636f 6d70   are found, comp
-00042220: 6172 6520 7669 6120 7468 6520 2261 6c6c  are via the "all
-00042230: 2220 636f 6d70 6172 6973 6f6e 200a 2020  " comparison .  
-00042240: 2020 2020 2020 2020 2020 2020 2020 7479                ty
-00042250: 7065 2e0a 0a20 2020 2020 2020 2063 6f6e  pe...        con
-00042260: 7365 6e73 7573 5f74 7970 6520 3a20 7374  sensus_type : st
-00042270: 722c 2064 6566 6175 6c74 3d22 6d61 6a6f  r, default="majo
-00042280: 7269 7479 2076 6f74 6522 0a20 2020 2020  rity vote".     
-00042290: 2020 2020 2020 204d 6574 686f 6420 666f         Method fo
-000422a0: 7220 6361 6c63 756c 6174 696e 6720 636f  r calculating co
-000422b0: 6e73 656e 7375 7320 6f66 2052 4f49 7320  nsensus of ROIs 
-000422c0: 6966 2075 7369 6e67 2074 6865 2022 636f  if using the "co
-000422d0: 6e73 656e 7375 7322 0a20 2020 2020 2020  nsensus".       
-000422e0: 2020 2020 2063 6f6d 7061 7269 736f 6e20       comparison 
-000422f0: 7479 7065 2e20 4f70 7469 6f6e 7320 6172  type. Options ar
-00042300: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-00042310: 2020 2020 2d20 226d 616a 6f72 6974 7922      - "majority"
-00042320: 203a 2075 7365 206d 616a 6f72 6974 7920   : use majority 
-00042330: 766f 7465 206f 6620 524f 4973 2028 692e  vote of ROIs (i.
-00042340: 652e 2076 6f78 656c 7320 7768 6572 650a  e. voxels where.
-00042350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042360: 6174 206c 6561 7374 2068 616c 6620 6f66  at least half of
-00042370: 2074 6865 2052 4f49 7320 6578 6973 7429   the ROIs exist)
-00042380: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00042390: 2020 2d20 226f 7665 726c 6170 2220 3a20    - "overlap" : 
-000423a0: 7573 6520 6f76 6572 6c61 7020 6f66 2052  use overlap of R
-000423b0: 4f49 732e 0a20 2020 2020 2020 2020 2020  OIs..           
-000423c0: 2020 2020 202d 2022 7375 6d22 203a 2075       - "sum" : u
-000423d0: 7365 2073 756d 206f 6620 524f 4973 2e0a  se sum of ROIs..
-000423e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000423f0: 2d20 2273 7461 706c 6522 203a 2075 7365  - "staple" : use
-00042400: 2074 6865 2053 5441 504c 4520 616c 676f   the STAPLE algo
-00042410: 7269 7468 6d20 746f 2063 616c 6375 6c61  rithm to calcula
-00042420: 7465 2063 6f6e 7365 6e73 7573 2e0a 0a20  te consensus... 
-00042430: 2020 2020 2020 2068 746d 6c20 3a20 626f         html : bo
-00042440: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-00042450: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-00042460: 2054 7275 652c 2074 6865 2074 6162 6c65   True, the table
-00042470: 2077 696c 6c20 6265 2063 6f6e 7665 7274   will be convert
-00042480: 6564 2074 6f20 4854 4d4c 2074 6578 7420  ed to HTML text 
-00042490: 636f 6c6f 722d 636f 6465 6420 6261 7365  color-coded base
-000424a0: 640a 2020 2020 2020 2020 2020 2020 6f6e  d.            on
-000424b0: 2052 4f49 2063 6f6c 6f72 732e 0a0a 2020   ROI colors...  
-000424c0: 2020 2020 2020 6772 6579 6564 5f6f 7574        greyed_out
-000424d0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-000424e0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000424f0: 2020 4c69 7374 206f 6620 524f 4973 2074    List of ROIs t
-00042500: 6861 7420 7368 6f75 6c64 2062 6520 6772  hat should be gr
-00042510: 6579 6564 206f 7574 2028 6769 7665 6e20  eyed out (given 
-00042520: 6120 6772 6579 2062 6163 6b67 726f 756e  a grey backgroun
-00042530: 640a 2020 2020 2020 2020 2020 2020 746f  d.            to
-00042540: 2074 6865 6972 2074 6578 7429 2069 6620   their text) if 
-00042550: 7265 7475 726e 696e 6720 616e 2048 544d  returning an HTM
-00042560: 4c20 7374 7269 6e67 2e0a 0a20 2020 2020  L string...     
-00042570: 2020 2060 2a2a 606b 7761 7267 7320 3a20     `**`kwargs : 
-00042580: 0a20 2020 2020 2020 2020 2020 204b 6579  .            Key
-00042590: 776f 7264 2061 7267 7320 746f 2070 6173  word args to pas
-000425a0: 7320 746f 2052 4f49 2e67 6574 5f63 6f6d  s to ROI.get_com
-000425b0: 7061 7269 736f 6e28 292e 2053 6565 200a  parison(). See .
-000425c0: 2020 2020 2020 2020 2020 2020 524f 492e              ROI.
-000425d0: 6765 745f 636f 6d70 6172 6973 6f6e 2829  get_comparison()
-000425e0: 2064 6f63 756d 656e 7461 7469 6f6e 2066   documentation f
-000425f0: 6f72 2064 6574 6169 6c73 2e0a 2020 2020  or details..    
-00042600: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00042610: 2064 6673 203d 205b 5d0a 0a20 2020 2020   dfs = []..     
-00042620: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00042630: 286f 7468 6572 2c20 524f 4929 3a0a 2020  (other, ROI):.  
-00042640: 2020 2020 2020 2020 2020 7061 6972 7320            pairs 
-00042650: 3d20 5b28 726f 692c 206f 7468 6572 2920  = [(roi, other) 
-00042660: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
-00042670: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
-00042680: 656d 7074 793d 5472 7565 295d 0a20 2020  empty=True)].   
-00042690: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-000426a0: 616e 6365 286f 7468 6572 2c20 5374 7275  ance(other, Stru
-000426b0: 6374 7572 6553 6574 2920 6f72 206f 7468  ctureSet) or oth
-000426c0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-000426d0: 2020 2020 2020 2020 7061 6972 7320 3d20          pairs = 
-000426e0: 7365 6c66 2e67 6574 5f63 6f6d 7061 7269  self.get_compari
-000426f0: 736f 6e5f 7061 6972 7328 6f74 6865 722c  son_pairs(other,
-00042700: 2063 6f6d 705f 7479 7065 2c20 636f 6e73   comp_type, cons
-00042710: 656e 7375 735f 7479 7065 290a 2020 2020  ensus_type).    
-00042720: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00042730: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-00042740: 4572 726f 7228 223c 6f74 6865 723e 206d  Error("<other> m
-00042750: 7573 7420 6265 2052 4f49 206f 7220 5374  ust be ROI or St
-00042760: 7275 6374 7572 6553 6574 2122 290a 0a20  ructureSet!").. 
-00042770: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-00042780: 6d70 6172 655f 726f 695f 7061 6972 7328  mpare_roi_pairs(
-00042790: 7061 6972 732c 202a 2a6b 7761 7267 7329  pairs, **kwargs)
-000427a0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
-000427b0: 6d70 6172 6973 6f6e 5f70 6169 7273 2873  mparison_pairs(s
-000427c0: 656c 662c 206f 7468 6572 3d4e 6f6e 652c  elf, other=None,
-000427d0: 2063 6f6d 705f 7479 7065 3d22 6175 746f   comp_type="auto
-000427e0: 222c 200a 2020 2020 2020 2020 2020 2020  ", .            
-000427f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042800: 2063 6f6e 7365 6e73 7573 5f74 7970 653d   consensus_type=
-00042810: 226d 616a 6f72 6974 7922 2c20 0a20 2020  "majority", .   
-00042820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042830: 2020 2020 2020 2020 2020 636f 6e73 656e            consen
-00042840: 7375 735f 636f 6c6f 723d 2262 6c75 6522  sus_color="blue"
-00042850: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00042860: 7420 6c69 7374 206f 6620 524f 4973 2074  t list of ROIs t
-00042870: 6f20 636f 6d70 6172 6520 7769 7468 206f  o compare with o
-00042880: 6e65 2061 6e6f 7468 6572 2e22 2222 0a0a  ne another."""..
-00042890: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-000428a0: 636f 6d70 5f74 7970 6520 6973 2076 616c  comp_type is val
-000428b0: 6964 0a20 2020 2020 2020 2076 616c 6964  id.        valid
-000428c0: 5f63 6f6d 705f 7479 7065 7320 3d20 5b22  _comp_types = ["
-000428d0: 616c 6c22 2c20 2262 795f 6e61 6d65 222c  all", "by_name",
-000428e0: 2022 636f 6e73 656e 7375 7322 2c20 2261   "consensus", "a
-000428f0: 7574 6f22 5d0a 2020 2020 2020 2020 6966  uto"].        if
-00042900: 2063 6f6d 705f 7479 7065 206e 6f74 2069   comp_type not i
-00042910: 6e20 7661 6c69 645f 636f 6d70 5f74 7970  n valid_comp_typ
-00042920: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00042930: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00042940: 2866 2255 6e72 6563 6f67 6e69 7365 6420  (f"Unrecognised 
-00042950: 636f 6d70 6172 6973 6f6e 2074 7970 6520  comparison type 
-00042960: 7b63 6f6d 705f 7479 7065 7d22 290a 0a20  {comp_type}").. 
-00042970: 2020 2020 2020 2023 2043 6f6e 7365 6e73         # Consens
-00042980: 7573 2063 6f6d 7061 7269 736f 6e0a 2020  us comparison.  
-00042990: 2020 2020 2020 6966 2063 6f6d 705f 7479        if comp_ty
-000429a0: 7065 203d 3d20 2263 6f6e 7365 6e73 7573  pe == "consensus
-000429b0: 223a 0a20 2020 2020 2020 2020 2020 200a  ":.            .
-000429c0: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-000429d0: 2063 6f6d 7061 7269 6e67 2074 6f20 616e   comparing to an
-000429e0: 6f74 6865 7220 5374 7275 6374 7572 6553  other StructureS
-000429f0: 6574 2c20 7461 6b65 2063 6f6e 7365 6e73  et, take consens
-00042a00: 7573 206f 6620 7468 6174 200a 2020 2020  us of that .    
-00042a10: 2020 2020 2020 2020 2320 656e 7469 7265          # entire
-00042a20: 2053 7472 7563 7475 7265 5365 740a 2020   StructureSet.  
-00042a30: 2020 2020 2020 2020 2020 6966 206f 7468            if oth
-00042a40: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0a  er is not None:.
-00042a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042a60: 636f 6e73 656e 7375 7320 3d20 6f74 6865  consensus = othe
-00042a70: 722e 6765 745f 636f 6e73 656e 7375 7328  r.get_consensus(
-00042a80: 636f 6e73 656e 7375 735f 7479 7065 2c20  consensus_type, 
-00042a90: 636f 6c6f 723d 636f 6e73 656e 7375 735f  color=consensus_
-00042aa0: 636f 6c6f 7229 0a20 2020 2020 2020 2020  color).         
-00042ab0: 2020 2020 2020 2072 6574 7572 6e20 5b28         return [(
-00042ac0: 726f 692c 2063 6f6e 7365 6e73 7573 2920  roi, consensus) 
-00042ad0: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
-00042ae0: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
-00042af0: 656d 7074 793d 5472 7565 295d 0a0a 2020  empty=True)]..  
-00042b00: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
-00042b10: 7277 6973 652c 2063 6f6d 7061 7265 2065  rwise, compare e
-00042b20: 6163 6820 524f 4920 746f 2063 6f6e 7365  ach ROI to conse
-00042b30: 6e73 7573 206f 6620 6f74 6865 7273 0a20  nsus of others. 
-00042b40: 2020 2020 2020 2020 2020 2070 6169 7273             pairs
-00042b50: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-00042b60: 2020 666f 7220 726f 6920 696e 2073 656c    for roi in sel
-00042b70: 662e 6765 745f 726f 6973 2869 676e 6f72  f.get_rois(ignor
-00042b80: 655f 656d 7074 793d 5472 7565 293a 0a20  e_empty=True):. 
-00042b90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00042ba0: 6169 7273 2e61 7070 656e 6428 2872 6f69  airs.append((roi
-00042bb0: 2c20 7365 6c66 2e67 6574 5f63 6f6e 7365  , self.get_conse
-00042bc0: 6e73 7573 2863 6f6e 7365 6e73 7573 5f74  nsus(consensus_t
-00042bd0: 7970 652c 200a 2020 2020 2020 2020 2020  ype, .          
-00042be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042c00: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-00042c10: 723d 636f 6e73 656e 7375 735f 636f 6c6f  r=consensus_colo
-00042c20: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00042c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042c50: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
-00042c60: 3d72 6f69 2e6e 616d 6529 2929 0a20 2020  =roi.name))).   
-00042c70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00042c80: 7061 6972 730a 0a20 2020 2020 2020 2023  pairs..        #
-00042c90: 2053 6574 2064 6566 6175 6c74 2062 6568   Set default beh
-00042ca0: 6176 696f 7572 2074 6f20 2261 6c6c 2220  aviour to "all" 
-00042cb0: 6966 206f 7468 6572 2069 7320 4e6f 6e65  if other is None
-00042cc0: 0a20 2020 2020 2020 2069 6620 6f74 6865  .        if othe
-00042cd0: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-00042ce0: 2020 2020 2020 206f 7468 6572 203d 2073         other = s
-00042cf0: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
-00042d00: 6966 2063 6f6d 705f 7479 7065 203d 3d20  if comp_type == 
-00042d10: 2261 7574 6f22 3a0a 2020 2020 2020 2020  "auto":.        
-00042d20: 2020 2020 2020 2020 636f 6d70 5f74 7970          comp_typ
-00042d30: 6520 3d20 2261 6c6c 220a 0a20 2020 2020  e = "all"..     
-00042d40: 2020 2023 2043 6865 636b 2066 6f72 2052     # Check for R
-00042d50: 4f49 7320 7769 7468 206d 6174 6368 696e  OIs with matchin
-00042d60: 6720 6e61 6d65 7320 6966 2075 7369 6e67  g names if using
-00042d70: 2022 6175 746f 2220 6f72 2022 6279 5f6e   "auto" or "by_n
-00042d80: 616d 6522 0a20 2020 2020 2020 206d 6174  ame".        mat
-00042d90: 6368 6573 203d 205b 5d0a 2020 2020 2020  ches = [].      
-00042da0: 2020 6966 2063 6f6d 705f 7479 7065 2069    if comp_type i
-00042db0: 6e20 5b22 6175 746f 222c 2022 6279 5f6e  n ["auto", "by_n
-00042dc0: 616d 6522 5d3a 0a20 2020 2020 2020 2020  ame"]:.         
-00042dd0: 2020 206d 6174 6368 6573 203d 205b 0a20     matches = [. 
-00042de0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00042df0: 2066 6f72 2073 2069 6e20 7365 6c66 2e67   for s in self.g
-00042e00: 6574 5f72 6f69 5f6e 616d 6573 2869 676e  et_roi_names(ign
-00042e10: 6f72 655f 656d 7074 793d 5472 7565 290a  ore_empty=True).
-00042e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042e30: 6966 2073 2069 6e20 6f74 6865 722e 6765  if s in other.ge
-00042e40: 745f 726f 695f 6e61 6d65 7328 6967 6e6f  t_roi_names(igno
-00042e50: 7265 5f65 6d70 7479 3d54 7275 6529 0a20  re_empty=True). 
-00042e60: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00042e70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00042e80: 6c65 6e28 6d61 7463 6865 7329 206f 7220  len(matches) or 
-00042e90: 636f 6d70 5f74 7970 6520 3d3d 2022 6279  comp_type == "by
-00042ea0: 5f6e 616d 6522 3a0a 2020 2020 2020 2020  _name":.        
-00042eb0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00042ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042ed0: 2020 2020 2028 7365 6c66 2e67 6574 5f72       (self.get_r
-00042ee0: 6f69 286e 616d 6529 2c20 6f74 6865 722e  oi(name), other.
-00042ef0: 6765 745f 726f 6928 6e61 6d65 2929 2066  get_roi(name)) f
-00042f00: 6f72 206e 616d 6520 696e 206d 6174 6368  or name in match
-00042f10: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00042f20: 2020 205d 0a0a 2020 2020 2020 2020 2320     ]..        # 
-00042f30: 4f74 6865 7277 6973 652c 2070 6169 7220  Otherwise, pair 
-00042f40: 6561 6368 2052 4f49 2077 6974 6820 6576  each ROI with ev
-00042f50: 6572 7920 6f74 6865 7220 2865 786c 6375  ery other (exlcu
-00042f60: 6469 6e67 2070 6169 7273 206f 6620 7468  ding pairs of th
-00042f70: 6520 7361 6d65 0a20 2020 2020 2020 2023  e same.        #
-00042f80: 2052 4f49 290a 2020 2020 2020 2020 7061   ROI).        pa
-00042f90: 6972 7320 3d20 5b5d 0a20 2020 2020 2020  irs = [].       
-00042fa0: 2066 6f72 2072 6f69 3120 696e 2073 656c   for roi1 in sel
-00042fb0: 662e 6765 745f 726f 6973 2869 676e 6f72  f.get_rois(ignor
-00042fc0: 655f 656d 7074 793d 5472 7565 293a 0a20  e_empty=True):. 
-00042fd0: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-00042fe0: 6f69 3220 696e 206f 7468 6572 2e67 6574  oi2 in other.get
-00042ff0: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
-00043000: 7479 3d54 7275 6529 3a0a 2020 2020 2020  ty=True):.      
-00043010: 2020 2020 2020 2020 2020 6966 2072 6f69            if roi
-00043020: 3120 6973 206e 6f74 2072 6f69 3220 616e  1 is not roi2 an
-00043030: 6420 2872 6f69 322c 2072 6f69 3129 206e  d (roi2, roi1) n
-00043040: 6f74 2069 6e20 7061 6972 733a 0a20 2020  ot in pairs:.   
-00043050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043060: 2070 6169 7273 2e61 7070 656e 6428 2872   pairs.append((r
-00043070: 6f69 312c 2072 6f69 3229 290a 0a20 2020  oi1, roi2))..   
-00043080: 2020 2020 2072 6574 7572 6e20 7061 6972       return pair
-00043090: 730a 0a20 2020 2064 6566 2067 6574 5f6d  s..    def get_m
-000430a0: 6964 5f69 6478 2873 656c 662c 2076 6965  id_idx(self, vie
-000430b0: 773d 2278 2d79 2229 3a0a 2020 2020 2020  w="x-y"):.      
-000430c0: 2020 2222 2252 6574 7572 6e20 7468 6520    """Return the 
-000430d0: 6172 7261 7920 696e 6465 7820 6f66 2074  array index of t
-000430e0: 6865 2073 6c69 6365 2074 6861 7420 636f  he slice that co
-000430f0: 6e74 6169 6e73 2074 6865 206d 6f73 7420  ntains the most 
-00043100: 524f 4973 2e22 2222 0a0a 2020 2020 2020  ROIs."""..      
-00043110: 2020 696e 6469 6365 7320 3d20 5b5d 0a20    indices = []. 
-00043120: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
-00043130: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
-00043140: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
-00043150: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00043160: 696e 6469 6365 732e 6578 7465 6e64 2872  indices.extend(r
-00043170: 6f69 2e67 6574 5f69 6e64 6963 6573 2876  oi.get_indices(v
-00043180: 6965 7729 290a 2020 2020 2020 2020 7265  iew)).        re
-00043190: 7475 726e 206e 702e 6269 6e63 6f75 6e74  turn np.bincount
-000431a0: 2869 6e64 6963 6573 292e 6172 676d 6178  (indices).argmax
-000431b0: 2829 0a0a 2020 2020 6465 6620 706c 6f74  ()..    def plot
-000431c0: 5f63 6f6d 7061 7269 736f 6e73 280a 2020  _comparisons(.  
-000431d0: 2020 2020 2020 7365 6c66 2c20 6f74 6865        self, othe
-000431e0: 723d 4e6f 6e65 2c20 636f 6d70 5f74 7970  r=None, comp_typ
-000431f0: 653d 2261 7574 6f22 2c20 6f75 7464 6972  e="auto", outdir
-00043200: 3d4e 6f6e 652c 206c 6567 656e 643d 5472  =None, legend=Tr
-00043210: 7565 2c20 0a20 2020 2020 2020 206e 616d  ue, .        nam
-00043220: 6573 3d4e 6f6e 652c 206c 6567 656e 645f  es=None, legend_
-00043230: 6262 6f78 5f74 6f5f 616e 6368 6f72 3d4e  bbox_to_anchor=N
-00043240: 6f6e 652c 206c 6567 656e 645f 6c6f 633d  one, legend_loc=
-00043250: 226c 6f77 6572 206c 6566 7422 2c0a 2020  "lower left",.  
-00043260: 2020 2020 2020 2a2a 6b77 6172 6773 0a20        **kwargs. 
-00043270: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00043280: 2250 6c6f 7420 636f 6d70 6172 6973 6f6e  "Plot comparison
-00043290: 2070 6169 7273 2e22 2222 0a0a 2020 2020   pairs."""..    
-000432a0: 2020 2020 6966 206f 7574 6469 7220 616e      if outdir an
-000432b0: 6420 6e6f 7420 6f73 2e70 6174 682e 6578  d not os.path.ex
-000432c0: 6973 7473 286f 7574 6469 7229 3a0a 2020  ists(outdir):.  
-000432d0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
-000432e0: 6564 6972 7328 6f75 7464 6972 290a 0a20  edirs(outdir).. 
-000432f0: 2020 2020 2020 2066 6f72 2072 6f69 312c         for roi1,
-00043300: 2072 6f69 3220 696e 2073 656c 662e 6765   roi2 in self.ge
-00043310: 745f 636f 6d70 6172 6973 6f6e 5f70 6169  t_comparison_pai
-00043320: 7273 286f 7468 6572 2c20 636f 6d70 5f74  rs(other, comp_t
-00043330: 7970 6529 3a0a 0a20 2020 2020 2020 2020  ype):..         
-00043340: 2020 206f 7574 6e61 6d65 203d 204e 6f6e     outname = Non
-00043350: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00043360: 206f 7574 6469 723a 0a20 2020 2020 2020   outdir:.       
-00043370: 2020 2020 2020 2020 2063 6f6d 705f 6e61           comp_na
-00043380: 6d65 203d 2072 6f69 312e 6765 745f 636f  me = roi1.get_co
-00043390: 6d70 6172 6973 6f6e 5f6e 616d 6528 726f  mparison_name(ro
-000433a0: 6932 2c20 5472 7565 290a 2020 2020 2020  i2, True).      
-000433b0: 2020 2020 2020 2020 2020 6f75 746e 616d            outnam
-000433c0: 6520 3d20 6f73 2e70 6174 682e 6a6f 696e  e = os.path.join
-000433d0: 286f 7574 6469 722c 2066 227b 636f 6d70  (outdir, f"{comp
-000433e0: 5f6e 616d 657d 2e70 6e67 2229 0a0a 2020  _name}.png")..  
-000433f0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00043400: 6573 2069 7320 4e6f 6e65 2061 6e64 2072  es is None and r
-00043410: 6f69 312e 6e61 6d65 203d 3d20 726f 6932  oi1.name == roi2
-00043420: 2e6e 616d 653a 0a20 2020 2020 2020 2020  .name:.         
-00043430: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
-00043440: 7365 6c66 2e6e 616d 652c 206f 7468 6572  self.name, other
-00043450: 2e6e 616d 655d 0a0a 2020 2020 2020 2020  .name]..        
-00043460: 2020 2020 726f 6931 2e70 6c6f 745f 636f      roi1.plot_co
-00043470: 6d70 6172 6973 6f6e 280a 2020 2020 2020  mparison(.      
-00043480: 2020 2020 2020 2020 2020 726f 6932 2c20            roi2, 
-00043490: 6c65 6765 6e64 3d6c 6567 656e 642c 2073  legend=legend, s
-000434a0: 6176 655f 6173 3d6f 7574 6e61 6d65 2c20  ave_as=outname, 
-000434b0: 6e61 6d65 733d 6e61 6d65 732c 0a20 2020  names=names,.   
-000434c0: 2020 2020 2020 2020 2020 2020 206c 6567               leg
-000434d0: 656e 645f 6262 6f78 5f74 6f5f 616e 6368  end_bbox_to_anch
-000434e0: 6f72 3d6c 6567 656e 645f 6262 6f78 5f74  or=legend_bbox_t
-000434f0: 6f5f 616e 6368 6f72 2c0a 2020 2020 2020  o_anchor,.      
-00043500: 2020 2020 2020 2020 2020 6c65 6765 6e64            legend
-00043510: 5f6c 6f63 3d6c 6567 656e 645f 6c6f 632c  _loc=legend_loc,
-00043520: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
-00043530: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00043540: 2070 6c6f 745f 7375 7266 6163 655f 6469   plot_surface_di
-00043550: 7374 616e 6365 7328 0a20 2020 2020 2020  stances(.       
-00043560: 2073 656c 662c 206f 7468 6572 2c20 6f75   self, other, ou
-00043570: 7464 6972 3d4e 6f6e 652c 2073 6967 6e65  tdir=None, signe
-00043580: 643d 4661 6c73 652c 2063 6f6d 705f 7479  d=False, comp_ty
-00043590: 7065 3d22 6175 746f 222c 202a 2a6b 7761  pe="auto", **kwa
-000435a0: 7267 730a 2020 2020 293a 0a20 2020 2020  rgs.    ):.     
-000435b0: 2020 2022 2222 506c 6f74 2073 7572 6661     """Plot surfa
-000435c0: 6365 2064 6973 7461 6e63 6573 2066 6f72  ce distances for
-000435d0: 2061 6c6c 2052 4f49 2070 6169 7273 2e22   all ROI pairs."
-000435e0: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
-000435f0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-00043600: 7328 6f75 7464 6972 293a 0a20 2020 2020  s(outdir):.     
-00043610: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-00043620: 7273 286f 7574 6469 7229 0a0a 2020 2020  rs(outdir)..    
-00043630: 2020 2020 666f 7220 726f 6931 2c20 726f      for roi1, ro
-00043640: 6932 2069 6e20 7365 6c66 2e67 6574 5f63  i2 in self.get_c
-00043650: 6f6d 7061 7269 736f 6e5f 7061 6972 7328  omparison_pairs(
-00043660: 6f74 6865 722c 2063 6f6d 705f 7479 7065  other, comp_type
-00043670: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
-00043680: 6f6d 705f 6e61 6d65 203d 2072 6f69 312e  omp_name = roi1.
-00043690: 6765 745f 636f 6d70 6172 6973 6f6e 5f6e  get_comparison_n
-000436a0: 616d 6528 726f 6932 2c20 5472 7565 290a  ame(roi2, True).
-000436b0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-000436c0: 7574 6469 723a 0a20 2020 2020 2020 2020  utdir:.         
-000436d0: 2020 2020 2020 206f 7574 6e61 6d65 203d         outname =
-000436e0: 206f 732e 7061 7468 2e6a 6f69 6e28 6f75   os.path.join(ou
-000436f0: 7464 6972 2c20 6622 7b63 6f6d 705f 6e61  tdir, f"{comp_na
-00043700: 6d65 7d2e 706e 6722 290a 2020 2020 2020  me}.png").      
-00043710: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00043720: 2020 2020 2020 2020 2020 2020 6f75 746e              outn
-00043730: 616d 6520 3d20 4e6f 6e65 0a20 2020 2020  ame = None.     
-00043740: 2020 2020 2020 2072 6f69 312e 706c 6f74         roi1.plot
-00043750: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00043760: 6573 2872 6f69 322c 2073 6967 6e65 643d  es(roi2, signed=
-00043770: 7369 676e 6564 2c20 7361 7665 5f61 733d  signed, save_as=
-00043780: 6f75 746e 616d 652c 202a 2a6b 7761 7267  outname, **kwarg
-00043790: 7329 0a0a 2020 2020 6465 6620 7772 6974  s)..    def writ
-000437a0: 6528 7365 6c66 2c20 6f75 746e 616d 653d  e(self, outname=
-000437b0: 4e6f 6e65 2c20 6f75 7464 6972 3d22 2e22  None, outdir="."
-000437c0: 2c20 6578 743d 4e6f 6e65 2c20 6f76 6572  , ext=None, over
-000437d0: 7772 6974 653d 4661 6c73 652c 0a20 2020  write=False,.   
-000437e0: 2020 2020 2020 2020 2068 6561 6465 725f           header_
-000437f0: 736f 7572 6365 3d4e 6f6e 652c 2070 6174  source=None, pat
-00043800: 6965 6e74 5f69 643d 4e6f 6e65 2c20 6d6f  ient_id=None, mo
-00043810: 6461 6c69 7479 3d4e 6f6e 652c 0a20 2020  dality=None,.   
-00043820: 2020 2020 2020 2020 2072 6f6f 745f 7569           root_ui
-00043830: 643d 4e6f 6e65 2c20 7665 7262 6f73 653d  d=None, verbose=
-00043840: 5472 7565 2c20 6865 6164 6572 5f65 7874  True, header_ext
-00043850: 7261 733d 7b7d 2c20 2a2a 6b77 6172 6773  ras={}, **kwargs
-00043860: 293a 0a20 2020 2020 2020 2022 2222 5772  ):.        """Wr
-00043870: 6974 6520 746f 2061 2064 6963 6f6d 2053  ite to a dicom S
-00043880: 7472 7563 7475 7265 5365 7420 6669 6c65  tructureSet file
-00043890: 206f 7220 6469 7265 6374 6f72 7920 6f66   or directory of
-000438a0: 206e 6966 7469 2066 696c 6573 2e22 2222   nifti files."""
-000438b0: 0a0a 2020 2020 2020 2020 6966 2065 7874  ..        if ext
-000438c0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000438d0: 206e 6f74 2065 7874 2e73 7461 7274 7377   not ext.startsw
-000438e0: 6974 6828 222e 2229 3a0a 2020 2020 2020  ith("."):.      
-000438f0: 2020 2020 2020 6578 7420 3d20 6622 2e7b        ext = f".{
-00043900: 6578 747d 220a 0a20 2020 2020 2020 2023  ext}"..        #
-00043910: 2043 6865 636b 2077 6865 7468 6572 2074   Check whether t
-00043920: 6f20 7772 6974 6520 746f 2064 6963 6f6d  o write to dicom
-00043930: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
-00043940: 2069 7369 6e73 7461 6e63 6528 6f75 746e   isinstance(outn
-00043950: 616d 652c 2073 7472 2920 616e 6420 6f75  ame, str) and ou
-00043960: 746e 616d 652e 656e 6473 7769 7468 2822  tname.endswith("
-00043970: 2e64 636d 2229 3a0a 2020 2020 2020 2020  .dcm"):.        
-00043980: 2020 2020 6578 7420 3d20 222e 6463 6d22      ext = ".dcm"
-00043990: 0a0a 2020 2020 2020 2020 6966 2065 7874  ..        if ext
-000439a0: 203d 3d20 222e 6463 6d22 3a0a 2020 2020   == ".dcm":.    
-000439b0: 2020 2020 2020 2020 6469 636f 6d5f 7772          dicom_wr
-000439c0: 6974 6572 203d 2044 6963 6f6d 5772 6974  iter = DicomWrit
-000439d0: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-000439e0: 2020 2020 6f75 7464 6972 3d6f 7574 6469      outdir=outdi
-000439f0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00043a00: 2020 2064 6174 613d 7365 6c66 2c0a 2020     data=self,.  
-00043a10: 2020 2020 2020 2020 2020 2020 2020 6166                af
-00043a20: 6669 6e65 3d4e 6f6e 652c 0a20 2020 2020  fine=None,.     
-00043a30: 2020 2020 2020 2020 2020 206f 7665 7277             overw
-00043a40: 7269 7465 3d6f 7665 7277 7269 7465 2c0a  rite=overwrite,.
-00043a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043a60: 6865 6164 6572 5f73 6f75 7263 653d 6865  header_source=he
-00043a70: 6164 6572 5f73 6f75 7263 652c 0a20 2020  ader_source,.   
-00043a80: 2020 2020 2020 2020 2020 2020 206f 7269               ori
-00043a90: 656e 7461 7469 6f6e 3d4e 6f6e 652c 0a20  entation=None,. 
-00043aa0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00043ab0: 6174 6965 6e74 5f69 643d 7061 7469 656e  atient_id=patien
-00043ac0: 745f 6964 2c0a 2020 2020 2020 2020 2020  t_id,.          
-00043ad0: 2020 2020 2020 6d6f 6461 6c69 7479 3d27        modality='
-00043ae0: 5254 5354 5255 4354 272c 0a20 2020 2020  RTSTRUCT',.     
-00043af0: 2020 2020 2020 2020 2020 2072 6f6f 745f             root_
-00043b00: 7569 643d 726f 6f74 5f75 6964 2c0a 2020  uid=root_uid,.  
-00043b10: 2020 2020 2020 2020 2020 2020 2020 6865                he
-00043b20: 6164 6572 5f65 7874 7261 733d 6865 6164  ader_extras=head
-00043b30: 6572 5f65 7874 7261 732c 0a20 2020 2020  er_extras,.     
-00043b40: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-00043b50: 655f 7479 7065 3d74 7970 6528 7365 6c66  e_type=type(self
-00043b60: 292e 5f5f 6e61 6d65 5f5f 2c0a 2020 2020  ).__name__,.    
-00043b70: 2020 2020 2020 2020 2020 2020 6f75 746e              outn
-00043b80: 616d 6520 3d20 6f75 746e 616d 652c 0a20  ame = outname,. 
-00043b90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00043ba0: 2020 2020 2020 2020 2073 656c 662e 6469           self.di
-00043bb0: 636f 6d5f 6461 7461 7365 7420 3d20 6469  com_dataset = di
-00043bc0: 636f 6d5f 7772 6974 6572 2e77 7269 7465  com_writer.write
-00043bd0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00043be0: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
-00043bf0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00043c00: 7428 2257 726f 7465 2064 6963 6f6d 2066  t("Wrote dicom f
-00043c10: 696c 6520 746f 2064 6972 6563 746f 7279  ile to directory
-00043c20: 3a22 2c20 6f75 7464 6972 290a 2020 2020  :", outdir).    
-00043c30: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00043c40: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
-00043c50: 6973 652c 2077 7269 7465 2074 6f20 696e  ise, write to in
-00043c60: 6469 7669 6475 616c 2052 4f49 2066 696c  dividual ROI fil
-00043c70: 6573 0a20 2020 2020 2020 2069 6620 6e6f  es.        if no
-00043c80: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00043c90: 286f 7574 6469 7229 3a0a 2020 2020 2020  (outdir):.      
-00043ca0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
-00043cb0: 7328 6f75 7464 6972 290a 2020 2020 2020  s(outdir).      
-00043cc0: 2020 656c 6966 206f 7665 7277 7269 7465    elif overwrite
-00043cd0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
-00043ce0: 7574 696c 2e72 6d74 7265 6528 6f75 7464  util.rmtree(outd
-00043cf0: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
-00043d00: 6f73 2e6d 6b64 6972 286f 7574 6469 7229  os.mkdir(outdir)
-00043d10: 0a20 2020 2020 2020 2066 6f72 2073 2069  .        for s i
-00043d20: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
-00043d30: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00043d40: 2e77 7269 7465 286f 7574 6469 723d 6f75  .write(outdir=ou
-00043d50: 7464 6972 2c20 6578 743d 6578 742c 2076  tdir, ext=ext, v
-00043d60: 6572 626f 7365 3d76 6572 626f 7365 2c20  erbose=verbose, 
-00043d70: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-00043d80: 2020 2020 2020 0a20 2020 2064 6566 2070        .    def p
-00043d90: 6c6f 7428 0a20 2020 2020 2020 2073 656c  lot(.        sel
-00043da0: 662c 0a20 2020 2020 2020 2076 6965 773d  f,.        view=
-00043db0: 2278 2d79 222c 0a20 2020 2020 2020 2070  "x-y",.        p
-00043dc0: 6c6f 745f 7479 7065 3d22 636f 6e74 6f75  lot_type="contou
-00043dd0: 7222 2c0a 2020 2020 2020 2020 736c 3d4e  r",.        sl=N
-00043de0: 6f6e 652c 0a20 2020 2020 2020 2069 6478  one,.        idx
-00043df0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2070  =None,.        p
-00043e00: 6f73 3d4e 6f6e 652c 0a20 2020 2020 2020  os=None,.       
-00043e10: 2061 783d 4e6f 6e65 2c0a 2020 2020 2020   ax=None,.      
-00043e20: 2020 6f70 6163 6974 793d 4e6f 6e65 2c0a    opacity=None,.
-00043e30: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
-00043e40: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
-00043e50: 696e 636c 7564 655f 696d 6167 653d 5472  include_image=Tr
-00043e60: 7565 2c0a 2020 2020 2020 2020 6365 6e74  ue,.        cent
-00043e70: 7265 5f6f 6e5f 726f 693d 4e6f 6e65 2c0a  re_on_roi=None,.
-00043e80: 2020 2020 2020 2020 7368 6f77 3d54 7275          show=Tru
-00043e90: 652c 0a20 2020 2020 2020 2073 6176 655f  e,.        save_
-00043ea0: 6173 3d4e 6f6e 652c 0a20 2020 2020 2020  as=None,.       
-00043eb0: 206c 6567 656e 643d 4661 6c73 652c 0a20   legend=False,. 
-00043ec0: 2020 2020 2020 206c 6567 656e 645f 6262         legend_bb
-00043ed0: 6f78 5f74 6f5f 616e 6368 6f72 3d4e 6f6e  ox_to_anchor=Non
-00043ee0: 652c 0a20 2020 2020 2020 206c 6567 656e  e,.        legen
-00043ef0: 645f 6c6f 633d 226c 6f77 6572 206c 6566  d_loc="lower lef
-00043f00: 7422 2c0a 2020 2020 2020 2020 636f 6e73  t",.        cons
-00043f10: 656e 7375 735f 7479 7065 3d4e 6f6e 652c  ensus_type=None,
-00043f20: 0a20 2020 2020 2020 2065 7863 6c75 6465  .        exclude
-00043f30: 5f66 726f 6d5f 636f 6e73 656e 7375 733d  _from_consensus=
-00043f40: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
-00043f50: 6e73 656e 7375 735f 636f 6c6f 723d 2262  nsensus_color="b
-00043f60: 6c75 6522 2c0a 2020 2020 2020 2020 636f  lue",.        co
-00043f70: 6e73 656e 7375 735f 6c69 6e65 7769 6474  nsensus_linewidt
-00043f80: 683d 4e6f 6e65 2c0a 2020 2020 2020 2020  h=None,.        
-00043f90: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
-00043fa0: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
-00043fb0: 2074 6865 2052 4f49 7320 696e 2074 6869   the ROIs in thi
-00043fc0: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
-00043fd0: 0a20 2020 2020 2020 0a20 2020 2020 2020  .       .       
-00043fe0: 2049 6620 636f 6e73 656e 7375 735f 7479   If consensus_ty
-00043ff0: 7065 2069 7320 7365 7420 746f 2061 6e79  pe is set to any
-00044000: 206f 6620 276d 616a 6f72 6974 7927 2c20   of 'majority', 
-00044010: 2773 756d 272c 2027 6f76 6572 6c61 7027  'sum', 'overlap'
-00044020: 2c20 6f72 2027 7374 6170 6c65 272c 0a20  , or 'staple',. 
-00044030: 2020 2020 2020 2074 6865 2063 6f6e 656e         the conen
-00044040: 7375 7320 636f 6e74 6f75 7220 7769 6c6c  sus contour will
-00044050: 2062 6520 706c 6f74 7465 6420 7261 7468   be plotted rath
-00044060: 6572 2074 6861 6e20 696e 6469 7669 6475  er than individu
-00044070: 616c 2052 4f49 732e 2049 660a 2020 2020  al ROIs. If.    
-00044080: 2020 2020 2765 7863 6c75 6465 5f66 726f      'exclude_fro
-00044090: 6d5f 636f 6e73 656e 7375 7327 2069 7320  m_consensus' is 
-000440a0: 7365 7420 746f 2074 6865 206e 616d 6520  set to the name 
-000440b0: 6f66 2061 6e20 524f 492c 2074 6861 7420  of an ROI, that 
-000440c0: 524f 4920 7769 6c6c 0a20 2020 2020 2020  ROI will.       
-000440d0: 2062 6520 6578 636c 7564 6564 2066 726f   be excluded fro
-000440e0: 6d20 7468 6520 636f 6e73 656e 7375 7320  m the consensus 
-000440f0: 6361 6c63 756c 6174 696f 6e20 616e 6420  calculation and 
-00044100: 706c 6f74 7465 6420 696e 6469 7669 6475  plotted individu
-00044110: 616c 6c79 2e0a 2020 2020 2020 2020 2222  ally..        ""
-00044120: 220a 0a20 2020 2020 2020 2023 2049 6620  "..        # If 
-00044130: 6e6f 2073 6c2f 6964 782f 706f 7320 6769  no sl/idx/pos gi
-00044140: 7665 6e2c 2075 7365 2074 6865 2073 6c69  ven, use the sli
-00044150: 6365 2077 6974 6820 7468 6520 6d6f 7374  ce with the most
-00044160: 2052 4f49 730a 2020 2020 2020 2020 6966   ROIs.        if
-00044170: 2073 6c20 6973 204e 6f6e 6520 616e 6420   sl is None and 
-00044180: 6964 7820 6973 204e 6f6e 6520 616e 6420  idx is None and 
-00044190: 706f 7320 6973 204e 6f6e 653a 0a20 2020  pos is None:.   
-000441a0: 2020 2020 2020 2020 2069 6478 203d 2073           idx = s
-000441b0: 656c 662e 6765 745f 6d69 645f 6964 7828  elf.get_mid_idx(
-000441c0: 7669 6577 290a 0a20 2020 2020 2020 2069  view)..        i
-000441d0: 6620 706c 6f74 5f74 7970 6520 6973 204e  f plot_type is N
-000441e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000441f0: 2070 6c6f 745f 7479 7065 203d 206b 7761   plot_type = kwa
-00044200: 7267 732e 6765 7428 2272 6f69 5f70 6c6f  rgs.get("roi_plo
-00044210: 745f 7479 7065 222c 2073 656c 662e 6465  t_type", self.de
-00044220: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-00044230: 6429 0a20 2020 2020 2020 206b 7761 7267  d).        kwarg
-00044240: 735b 2272 6f69 5f70 6c6f 745f 7479 7065  s["roi_plot_type
-00044250: 225d 203d 2070 6c6f 745f 7479 7065 0a0a  "] = plot_type..
-00044260: 2020 2020 2020 2020 2320 456e 7375 7265          # Ensure
-00044270: 2074 6861 7420 6c69 6e65 7769 6474 6820   that linewidth 
-00044280: 616e 6420 6f70 6163 6974 7920 666f 7220  and opacity for 
-00044290: 524f 4920 706c 6f74 7469 6e67 2061 7265  ROI plotting are
-000442a0: 2064 6566 696e 6564 2e0a 2020 2020 2020   defined..      
-000442b0: 2020 726f 695f 6b77 6172 6773 203d 207b    roi_kwargs = {
-000442c0: 7d0a 2020 2020 2020 2020 6966 206f 7061  }.        if opa
-000442d0: 6369 7479 2069 7320 4e6f 6e65 3a0a 2020  city is None:.  
-000442e0: 2020 2020 2020 2020 2020 6f70 6163 6974            opacit
-000442f0: 7920 3d20 302e 3320 6966 2022 6669 6c6c  y = 0.3 if "fill
-00044300: 6564 2220 696e 2070 6c6f 745f 7479 7065  ed" in plot_type
-00044310: 2065 6c73 6520 310a 2020 2020 2020 2020   else 1.        
-00044320: 726f 695f 6b77 6172 6773 5b22 6f70 6163  roi_kwargs["opac
-00044330: 6974 7922 5d20 3d20 6f70 6163 6974 790a  ity"] = opacity.
-00044340: 2020 2020 2020 2020 6966 206c 696e 6577          if linew
-00044350: 6964 7468 2069 7320 4e6f 6e65 3a0a 2020  idth is None:.  
-00044360: 2020 2020 2020 2020 2020 6c69 6e65 7769            linewi
-00044370: 6474 6820 3d20 6465 6661 756c 7450 6172  dth = defaultPar
-00044380: 616d 735b 226c 696e 6573 2e6c 696e 6577  ams["lines.linew
-00044390: 6964 7468 225d 5b30 5d0a 2020 2020 2020  idth"][0].      
-000443a0: 2020 726f 695f 6b77 6172 6773 5b22 6c69    roi_kwargs["li
-000443b0: 6e65 7769 6474 6822 5d20 3d20 6c69 6e65  newidth"] = line
-000443c0: 7769 6474 680a 0a20 2020 2020 2020 2023  width..        #
-000443d0: 2045 6e73 7572 6520 7468 6174 2074 6974   Ensure that tit
-000443e0: 6c65 2069 7320 7365 7420 746f 2062 6520  le is set to be 
-000443f0: 6120 7374 7269 6e67 2e0a 2020 2020 2020  a string..      
-00044400: 2020 6966 206b 7761 7267 732e 6765 7428    if kwargs.get(
-00044410: 2274 6974 6c65 222c 204e 6f6e 6529 2069  "title", None) i
-00044420: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00044430: 2020 2020 6b77 6172 6773 5b22 7469 746c      kwargs["titl
-00044440: 6522 5d20 3d20 7365 6c66 2e6e 616d 6520  e"] = self.name 
-00044450: 6f72 2022 220a 0a20 2020 2020 2020 2023  or ""..        #
-00044460: 2050 6c6f 7420 7769 7468 2069 6d61 6765   Plot with image
-00044470: 0a20 2020 2020 2020 2069 6620 696e 636c  .        if incl
-00044480: 7564 655f 696d 6167 6520 616e 6420 7365  ude_image and se
-00044490: 6c66 2e69 6d61 6765 2069 7320 6e6f 7420  lf.image is not 
-000444a0: 4e6f 6e65 3a0a 0a20 2020 2020 2020 2020  None:..         
-000444b0: 2020 2073 656c 662e 696d 6167 652e 706c     self.image.pl
-000444c0: 6f74 280a 2020 2020 2020 2020 2020 2020  ot(.            
-000444d0: 2020 2020 7669 6577 2c0a 2020 2020 2020      view,.      
-000444e0: 2020 2020 2020 2020 2020 736c 3d73 6c2c            sl=sl,
-000444f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00044500: 2020 6964 783d 6964 782c 0a20 2020 2020    idx=idx,.     
-00044510: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
-00044520: 6f73 2c0a 2020 2020 2020 2020 2020 2020  os,.            
-00044530: 2020 2020 726f 6973 3d73 656c 662c 0a20      rois=self,. 
-00044540: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00044550: 6f69 5f6b 7761 7267 733d 726f 695f 6b77  oi_kwargs=roi_kw
-00044560: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-00044570: 2020 2020 2020 6365 6e74 7265 5f6f 6e5f        centre_on_
-00044580: 726f 693d 6365 6e74 7265 5f6f 6e5f 726f  roi=centre_on_ro
-00044590: 692c 0a20 2020 2020 2020 2020 2020 2020  i,.             
-000445a0: 2020 2073 686f 773d 7368 6f77 2c0a 2020     show=show,.  
-000445b0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-000445c0: 7665 5f61 733d 7361 7665 5f61 732c 0a20  ve_as=save_as,. 
-000445d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000445e0: 6567 656e 643d 6c65 6765 6e64 2c0a 2020  egend=legend,.  
-000445f0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-00044600: 6765 6e64 5f62 626f 785f 746f 5f61 6e63  gend_bbox_to_anc
-00044610: 686f 723d 6c65 6765 6e64 5f62 626f 785f  hor=legend_bbox_
-00044620: 746f 5f61 6e63 686f 722c 0a20 2020 2020  to_anchor,.     
-00044630: 2020 2020 2020 2020 2020 206c 6567 656e             legen
-00044640: 645f 6c6f 633d 6c65 6765 6e64 5f6c 6f63  d_loc=legend_loc
-00044650: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00044660: 2020 636f 6e73 656e 7375 735f 7479 7065    consensus_type
-00044670: 3d63 6f6e 7365 6e73 7573 5f74 7970 652c  =consensus_type,
-00044680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044690: 2065 7863 6c75 6465 5f66 726f 6d5f 636f   exclude_from_co
-000446a0: 6e73 656e 7375 733d 6578 636c 7564 655f  nsensus=exclude_
-000446b0: 6672 6f6d 5f63 6f6e 7365 6e73 7573 2c0a  from_consensus,.
-000446c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000446d0: 6178 3d61 782c 0a20 2020 2020 2020 2020  ax=ax,.         
-000446e0: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
-000446f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00044700: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00044710: 0a0a 2020 2020 2020 2020 2320 506c 6f74  ..        # Plot
-00044720: 2063 6f6e 7365 6e73 7573 0a20 2020 2020   consensus.     
-00044730: 2020 2072 6f69 5f68 616e 646c 6573 203d     roi_handles =
-00044740: 205b 5d0a 2020 2020 2020 2020 6966 2063   [].        if c
-00044750: 6f6e 7365 6e73 7573 5f74 7970 6520 6973  onsensus_type is
-00044760: 206e 6f74 204e 6f6e 653a 0a0a 2020 2020   not None:..    
-00044770: 2020 2020 2020 2020 2320 506c 6f74 2063          # Plot c
-00044780: 6f6e 7365 6e73 7573 2063 6f6e 746f 7572  onsensus contour
-00044790: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-000447a0: 7365 6e73 7573 203d 2073 656c 662e 6765  sensus = self.ge
-000447b0: 745f 636f 6e73 656e 7375 7328 636f 6e73  t_consensus(cons
-000447c0: 656e 7375 735f 7479 7065 2c20 0a20 2020  ensus_type, .   
-000447d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000447e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000447f0: 2020 2020 2020 2020 636f 6c6f 723d 636f          color=co
-00044800: 6e73 656e 7375 735f 636f 6c6f 722c 0a20  nsensus_color,. 
-00044810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044830: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00044840: 653d 6578 636c 7564 655f 6672 6f6d 5f63  e=exclude_from_c
-00044850: 6f6e 7365 6e73 7573 290a 2020 2020 2020  onsensus).      
-00044860: 2020 2020 2020 636f 6e73 656e 7375 735f        consensus_
-00044870: 6b77 6172 6773 203d 207b 7d20 6966 2065  kwargs = {} if e
-00044880: 7863 6c75 6465 5f66 726f 6d5f 636f 6e73  xclude_from_cons
-00044890: 656e 7375 7320 6973 206e 6f74 204e 6f6e  ensus is not Non
-000448a0: 6520 5c0a 2020 2020 2020 2020 2020 2020  e \.            
-000448b0: 2020 2020 2020 2020 656c 7365 206b 7761          else kwa
-000448c0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-000448d0: 6966 2063 6f6e 7365 6e73 7573 5f6c 696e  if consensus_lin
-000448e0: 6577 6964 7468 2069 7320 4e6f 6e65 3a0a  ewidth is None:.
-000448f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044900: 636f 6e73 656e 7375 735f 6c69 6e65 7769  consensus_linewi
-00044910: 6474 6820 3d20 6465 6661 756c 7450 6172  dth = defaultPar
-00044920: 616d 735b 226c 696e 6573 2e6c 696e 6577  ams["lines.linew
-00044930: 6964 7468 225d 5b30 5d20 2b20 310a 0a20  idth"][0] + 1.. 
-00044940: 2020 2020 2020 2020 2020 2063 6f6e 7365             conse
-00044950: 6e73 7573 2e70 6c6f 7428 0a20 2020 2020  nsus.plot(.     
-00044960: 2020 2020 2020 2020 2020 2076 6965 772c             view,
-00044970: 2073 6c3d 736c 2c20 6964 783d 6964 782c   sl=sl, idx=idx,
-00044980: 2070 6f73 3d70 6f73 2c20 706c 6f74 5f74   pos=pos, plot_t
-00044990: 7970 653d 706c 6f74 5f74 7970 652c 200a  ype=plot_type, .
-000449a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000449b0: 636f 6c6f 723d 636f 6e73 656e 7375 735f  color=consensus_
-000449c0: 636f 6c6f 722c 206c 696e 6577 6964 7468  color, linewidth
-000449d0: 3d63 6f6e 7365 6e73 7573 5f6c 696e 6577  =consensus_linew
-000449e0: 6964 7468 2c20 0a20 2020 2020 2020 2020  idth, .         
-000449f0: 2020 2020 2020 206f 7061 6369 7479 3d6f         opacity=o
-00044a00: 7061 6369 7479 2c20 7368 6f77 3d46 616c  pacity, show=Fal
-00044a10: 7365 2c20 6178 3d61 782c 202a 2a63 6f6e  se, ax=ax, **con
-00044a20: 7365 6e73 7573 5f6b 7761 7267 7329 0a0a  sensus_kwargs)..
-00044a30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00044a40: 2e61 7820 3d20 636f 6e73 656e 7375 732e  .ax = consensus.
-00044a50: 6178 0a20 2020 2020 2020 2020 2020 2073  ax.            s
-00044a60: 656c 662e 6669 6720 3d20 636f 6e73 656e  elf.fig = consen
-00044a70: 7375 732e 6669 670a 0a20 2020 2020 2020  sus.fig..       
-00044a80: 2020 2020 2069 6620 6c65 6765 6e64 3a0a       if legend:.
-00044a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044aa0: 726f 695f 6861 6e64 6c65 732e 6170 7065  roi_handles.appe
-00044ab0: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00044ac0: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
-00044ad0: 656e 7375 732e 6765 745f 7061 7463 6828  ensus.get_patch(
-00044ae0: 706c 6f74 5f74 7970 652c 2063 6f6e 7365  plot_type, conse
-00044af0: 6e73 7573 5f63 6f6c 6f72 2c20 6f70 6163  nsus_color, opac
-00044b00: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
-00044b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044b20: 206c 696e 6577 6964 7468 2c20 636f 6e73   linewidth, cons
-00044b30: 656e 7375 732e 6e61 6d65 2929 0a0a 2020  ensus.name))..  
-00044b40: 2020 2020 2020 2020 2020 2320 506c 6f74            # Plot
-00044b50: 2065 7863 6c75 6465 6420 524f 4920 6f6e   excluded ROI on
-00044b60: 2074 6f70 0a20 2020 2020 2020 2020 2020   top.           
-00044b70: 2069 6620 6578 636c 7564 655f 6672 6f6d   if exclude_from
-00044b80: 5f63 6f6e 7365 6e73 7573 2069 7320 6e6f  _consensus is no
-00044b90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00044ba0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
-00044bb0: 696e 636c 7564 655f 696d 6167 6522 5d20  include_image"] 
-00044bc0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00044bd0: 2020 2020 2020 2020 6578 636c 7564 6564          excluded
-00044be0: 203d 2073 656c 662e 6765 745f 726f 6928   = self.get_roi(
-00044bf0: 6578 636c 7564 655f 6672 6f6d 5f63 6f6e  exclude_from_con
-00044c00: 7365 6e73 7573 290a 2020 2020 2020 2020  sensus).        
-00044c10: 2020 2020 2020 2020 6578 636c 7564 6564          excluded
-00044c20: 2e70 6c6f 7428 7669 6577 2c20 736c 3d73  .plot(view, sl=s
-00044c30: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
-00044c40: 706f 732c 2070 6c6f 745f 7479 7065 3d70  pos, plot_type=p
-00044c50: 6c6f 745f 7479 7065 2c0a 2020 2020 2020  lot_type,.      
-00044c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044c70: 2020 2020 2020 2020 6f70 6163 6974 793d          opacity=
-00044c80: 6f70 6163 6974 792c 206c 696e 6577 6964  opacity, linewid
-00044c90: 7468 3d6c 696e 6577 6964 7468 2c20 7368  th=linewidth, sh
-00044ca0: 6f77 3d46 616c 7365 2c0a 2020 2020 2020  ow=False,.      
-00044cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044cc0: 2020 2020 2020 2020 6178 3d73 656c 662e          ax=self.
-00044cd0: 6178 2c20 2a2a 6b77 6172 6773 290a 2020  ax, **kwargs).  
-00044ce0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00044cf0: 206c 6567 656e 643a 0a20 2020 2020 2020   legend:.       
-00044d00: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00044d10: 5f68 616e 646c 6573 2e61 7070 656e 6428  _handles.append(
-00044d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044d30: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
-00044d40: 642e 6765 745f 7061 7463 6828 706c 6f74  d.get_patch(plot
-00044d50: 5f74 7970 652c 2065 7863 6c75 6465 642e  _type, excluded.
-00044d60: 636f 6c6f 722c 206f 7061 6369 7479 2c0a  color, opacity,.
-00044d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044d80: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-00044d90: 7769 6474 682c 2065 7863 6c75 6465 642e  width, excluded.
-00044da0: 6e61 6d65 2929 0a0a 2020 2020 2020 2020  name))..        
-00044db0: 2320 4f74 6865 7277 6973 652c 2070 6c6f  # Otherwise, plo
-00044dc0: 7420 6669 7273 7420 524f 4920 616e 6420  t first ROI and 
-00044dd0: 6765 7420 6178 6573 0a20 2020 2020 2020  get axes.       
-00044de0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00044df0: 2020 2069 6620 6365 6e74 7265 5f6f 6e5f     if centre_on_
-00044e00: 726f 6920 6973 206e 6f74 204e 6f6e 653a  roi is not None:
-00044e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044e20: 2063 656e 7472 616c 203d 2073 656c 662e   central = self.
-00044e30: 6765 745f 726f 6928 6365 6e74 7265 5f6f  get_roi(centre_o
-00044e40: 6e5f 726f 6929 0a20 2020 2020 2020 2020  n_roi).         
-00044e50: 2020 2020 2020 2069 6478 203d 2063 656e         idx = cen
-00044e60: 7472 616c 2e67 6574 5f6d 6964 5f69 6478  tral.get_mid_idx
-00044e70: 2876 6965 7729 0a20 2020 2020 2020 2020  (view).         
-00044e80: 2020 2020 2020 2073 6c20 3d20 4e6f 6e65         sl = None
-00044e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044ea0: 2070 6f73 203d 204e 6f6e 650a 2020 2020   pos = None.    
-00044eb0: 2020 2020 2020 2020 2020 2020 6669 7273              firs
-00044ec0: 745f 726f 6920 3d20 6365 6e74 7261 6c0a  t_roi = central.
-00044ed0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00044ee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00044ef0: 2020 6365 6e74 7261 6c20 3d20 7365 6c66    central = self
-00044f00: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
-00044f10: 5f65 6d70 7479 3d54 7275 6529 5b30 5d0a  _empty=True)[0].
-00044f20: 0a20 2020 2020 2020 2020 2020 2063 656e  .            cen
-00044f30: 7472 616c 2e70 6c6f 7428 7669 6577 2c20  tral.plot(view, 
-00044f40: 736c 3d73 6c2c 2069 6478 3d69 6478 2c20  sl=sl, idx=idx, 
-00044f50: 706f 733d 706f 732c 2070 6c6f 745f 7479  pos=pos, plot_ty
-00044f60: 7065 3d70 6c6f 745f 7479 7065 2c0a 2020  pe=plot_type,.  
-00044f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044f80: 2020 2020 2020 206f 7061 6369 7479 3d6f         opacity=o
-00044f90: 7061 6369 7479 2c20 6c69 6e65 7769 6474  pacity, linewidt
-00044fa0: 683d 6c69 6e65 7769 6474 682c 2073 686f  h=linewidth, sho
-00044fb0: 773d 4661 6c73 652c 0a20 2020 2020 2020  w=False,.       
-00044fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044fd0: 2020 6178 3d61 782c 202a 2a6b 7761 7267    ax=ax, **kwarg
-00044fe0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-00044ff0: 7365 6c66 2e66 6967 203d 2063 656e 7472  self.fig = centr
-00045000: 616c 2e66 6967 0a20 2020 2020 2020 2020  al.fig.         
-00045010: 2020 2073 656c 662e 6178 203d 2063 656e     self.ax = cen
-00045020: 7472 616c 2e61 780a 0a20 2020 2020 2020  tral.ax..       
-00045030: 2020 2020 2069 6620 6c65 6765 6e64 3a0a       if legend:.
-00045040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045050: 726f 695f 6861 6e64 6c65 732e 6170 7065  roi_handles.appe
-00045060: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00045070: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-00045080: 7261 6c2e 6765 745f 7061 7463 6828 706c  ral.get_patch(pl
-00045090: 6f74 5f74 7970 652c 2063 656e 7472 616c  ot_type, central
-000450a0: 2e63 6f6c 6f72 2c20 6f70 6163 6974 792c  .color, opacity,
-000450b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000450c0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-000450d0: 6577 6964 7468 2c20 6365 6e74 7261 6c2e  ewidth, central.
-000450e0: 6e61 6d65 2929 0a0a 2020 2020 2020 2020  name))..        
-000450f0: 2020 2020 2320 506c 6f74 206f 7468 6572      # Plot other
-00045100: 2052 4f49 730a 2020 2020 2020 2020 2020   ROIs.          
-00045110: 2020 666f 7220 692c 2072 6f69 2069 6e20    for i, roi in 
-00045120: 656e 756d 6572 6174 6528 7365 6c66 2e67  enumerate(self.g
-00045130: 6574 5f72 6f69 7328 6967 6e6f 7265 5f65  et_rois(ignore_e
-00045140: 6d70 7479 3d54 7275 6529 293a 0a0a 2020  mpty=True)):..  
-00045150: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00045160: 2072 6f69 2069 7320 6365 6e74 7261 6c3a   roi is central:
-00045170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045180: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
-00045190: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000451a0: 6c6f 745f 6b77 6172 6773 203d 207b 7d20  lot_kwargs = {} 
-000451b0: 6966 2069 203c 206c 656e 2873 656c 662e  if i < len(self.
-000451c0: 726f 6973 2920 2d20 3120 656c 7365 206b  rois) - 1 else k
-000451d0: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
-000451e0: 2020 2020 2020 726f 692e 706c 6f74 2876        roi.plot(v
-000451f0: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
-00045200: 6964 782c 2070 6f73 3d70 6f73 2c20 706c  idx, pos=pos, pl
-00045210: 6f74 5f74 7970 653d 706c 6f74 5f74 7970  ot_type=plot_typ
-00045220: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00045230: 2020 2020 2020 2020 2020 2020 6f70 6163              opac
-00045240: 6974 793d 6f70 6163 6974 792c 206c 696e  ity=opacity, lin
-00045250: 6577 6964 7468 3d6c 696e 6577 6964 7468  ewidth=linewidth
-00045260: 2c20 7368 6f77 3d46 616c 7365 2c0a 2020  , show=False,.  
-00045270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045280: 2020 2020 2020 2061 783d 7365 6c66 2e61         ax=self.a
-00045290: 782c 202a 2a6b 7761 7267 7329 0a0a 2020  x, **kwargs)..  
-000452a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000452b0: 206c 6567 656e 643a 0a20 2020 2020 2020   legend:.       
-000452c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000452d0: 2869 6478 2069 7320 4e6f 6e65 2061 6e64  (idx is None and
-000452e0: 2070 6f73 2069 7320 4e6f 6e65 2061 6e64   pos is None and
-000452f0: 2073 6c20 6973 204e 6f6e 6529 206f 7220   sl is None) or 
-00045300: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00045310: 2020 2020 2020 2020 2072 6f69 2e6f 6e5f           roi.on_
-00045320: 736c 6963 6528 7669 6577 2c20 736c 3d73  slice(view, sl=s
-00045330: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
-00045340: 706f 7329 3a0a 2020 2020 2020 2020 2020  pos):.          
-00045350: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00045360: 695f 6861 6e64 6c65 732e 6170 7065 6e64  i_handles.append
-00045370: 2872 6f69 2e67 6574 5f70 6174 6368 2870  (roi.get_patch(p
-00045380: 6c6f 745f 7479 7065 2c20 726f 692e 636f  lot_type, roi.co
-00045390: 6c6f 722c 0a20 2020 2020 2020 2020 2020  lor,.           
-000453a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000453b0: 206f 7061 6369 7479 2c20 6c69 6e65 7769   opacity, linewi
-000453c0: 6474 682c 2072 6f69 2e6e 616d 6529 290a  dth, roi.name)).
-000453d0: 0a20 2020 2020 2020 2023 2044 7261 7720  .        # Draw 
-000453e0: 6c65 6765 6e64 0a20 2020 2020 2020 2069  legend.        i
-000453f0: 6620 6c65 6765 6e64 2061 6e64 206c 656e  f legend and len
-00045400: 2872 6f69 5f68 616e 646c 6573 293a 0a20  (roi_handles):. 
-00045410: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00045420: 6178 2e6c 6567 656e 6428 6861 6e64 6c65  ax.legend(handle
-00045430: 733d 726f 695f 6861 6e64 6c65 732c 0a20  s=roi_handles,. 
-00045440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045450: 2020 2062 626f 785f 746f 5f61 6e63 686f     bbox_to_ancho
-00045460: 723d 6c65 6765 6e64 5f62 626f 785f 746f  r=legend_bbox_to
-00045470: 5f61 6e63 686f 722c 206c 6f63 3d6c 6567  _anchor, loc=leg
-00045480: 656e 645f 6c6f 632c 0a20 2020 2020 2020  end_loc,.       
-00045490: 2020 2020 2020 2020 2020 2020 2066 6163               fac
-000454a0: 6563 6f6c 6f72 3d22 7768 6974 6522 2c20  ecolor="white", 
-000454b0: 6672 616d 6561 6c70 6861 3d31 0a20 2020  framealpha=1.   
-000454c0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000454d0: 2020 2020 2320 4469 7370 6c61 7920 696d      # Display im
-000454e0: 6167 650a 2020 2020 2020 2020 706c 742e  age.        plt.
-000454f0: 7469 6768 745f 6c61 796f 7574 2829 0a20  tight_layout(). 
-00045500: 2020 2020 2020 2069 6620 7368 6f77 3a0a         if show:.
-00045510: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
-00045520: 7368 6f77 2829 0a0a 2020 2020 2020 2020  show()..        
-00045530: 2320 5361 7665 2074 6f20 6669 6c65 0a20  # Save to file. 
-00045540: 2020 2020 2020 2069 6620 7361 7665 5f61         if save_a
-00045550: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00045560: 656c 662e 6669 672e 7361 7665 6669 6728  elf.fig.savefig(
-00045570: 7361 7665 5f61 7329 0a20 2020 2020 2020  save_as).       
-00045580: 2020 2020 2070 6c74 2e63 6c6f 7365 2829       plt.close()
-00045590: 0a0a 2020 2020 6465 6620 706c 6f74 5f63  ..    def plot_c
-000455a0: 6f6e 7365 6e73 7573 2873 656c 662c 2063  onsensus(self, c
-000455b0: 6f6e 7365 6e73 7573 5f74 7970 652c 2076  onsensus_type, v
-000455c0: 6965 773d 2278 2d79 222c 2073 6c3d 4e6f  iew="x-y", sl=No
-000455d0: 6e65 2c20 6964 783d 4e6f 6e65 2c0a 2020  ne, idx=None,.  
-000455e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000455f0: 2020 2020 2070 6f73 3d4e 6f6e 652c 2072       pos=None, r
-00045600: 6f69 735f 696e 5f62 6163 6b67 726f 756e  ois_in_backgroun
-00045610: 643d 4661 6c73 652c 2063 6f6c 6f72 3d4e  d=False, color=N
-00045620: 6f6e 652c 200a 2020 2020 2020 2020 2020  one, .          
-00045630: 2020 2020 2020 2020 2020 2020 2073 686f               sho
-00045640: 773d 5472 7565 2c20 2a2a 6b77 6172 6773  w=True, **kwargs
-00045650: 293a 0a20 2020 2020 2020 2022 2222 506c  ):.        """Pl
-00045660: 6f74 2074 6865 2063 6f6e 7365 6e73 7573  ot the consensus
-00045670: 2063 6f6e 746f 7572 2c20 7769 7468 2061   contour, with a
-00045680: 6c6c 2052 4f49 7320 696e 2067 7265 7920  ll ROIs in grey 
-00045690: 6265 6869 6e64 2069 7420 6966 0a20 2020  behind it if.   
-000456a0: 2020 2020 2072 6f69 735f 696e 5f62 6163       rois_in_bac
-000456b0: 6b67 726f 756e 643d 5472 7565 2e22 2222  kground=True."""
-000456c0: 0a0a 2020 2020 2020 2020 636f 6e73 656e  ..        consen
-000456d0: 7375 7320 3d20 7365 6c66 2e67 6574 5f63  sus = self.get_c
-000456e0: 6f6e 7365 6e73 7573 2863 6f6e 7365 6e73  onsensus(consens
-000456f0: 7573 5f74 7970 6529 0a0a 2020 2020 2020  us_type)..      
-00045700: 2020 6966 2069 6478 2069 7320 4e6f 6e65    if idx is None
-00045710: 2061 6e64 2073 6c20 6973 204e 6f6e 6520   and sl is None 
-00045720: 616e 6420 706f 7320 6973 204e 6f6e 653a  and pos is None:
-00045730: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-00045740: 203d 2073 656c 662e 6765 745f 6d69 645f   = self.get_mid_
-00045750: 6964 7828 7669 6577 290a 2020 2020 2020  idx(view).      
-00045760: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00045770: 2020 2020 6964 7820 3d20 636f 6e73 656e      idx = consen
-00045780: 7375 732e 6765 745f 6964 7828 7669 6577  sus.get_idx(view
-00045790: 2c20 736c 2c20 6964 782c 2070 6f73 290a  , sl, idx, pos).
-000457a0: 2020 2020 2020 2020 6178 203d 2073 6b72          ax = skr
-000457b0: 742e 696d 6167 652e 5f73 6c69 6365 5f61  t.image._slice_a
-000457c0: 7865 735b 7669 6577 5d0a 2020 2020 2020  xes[view].      
-000457d0: 2020 706f 7320 3d20 636f 6e73 656e 7375    pos = consensu
-000457e0: 732e 6964 785f 746f 5f70 6f73 2869 6478  s.idx_to_pos(idx
-000457f0: 2c20 6178 290a 0a20 2020 2020 2020 2069  , ax)..        i
-00045800: 6620 636f 6e73 656e 7375 732e 656d 7074  f consensus.empt
-00045810: 793a 0a20 2020 2020 2020 2020 2020 2070  y:.            p
-00045820: 7269 6e74 2866 227b 636f 6e73 656e 7375  rint(f"{consensu
-00045830: 735f 7479 7065 7d20 636f 6e74 6f75 7220  s_type} contour 
-00045840: 6973 2065 6d70 7479 2229 0a20 2020 2020  is empty").     
-00045850: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-00045860: 2020 2020 2020 636f 6e73 656e 7375 732e        consensus.
-00045870: 706c 6f74 2863 6f6c 6f72 3d63 6f6c 6f72  plot(color=color
-00045880: 2c20 706f 733d 706f 732c 2076 6965 773d  , pos=pos, view=
-00045890: 7669 6577 2c20 7368 6f77 3d46 616c 7365  view, show=False
-000458a0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-000458b0: 2020 2020 2069 6620 726f 6973 5f69 6e5f       if rois_in_
-000458c0: 6261 636b 6772 6f75 6e64 3a0a 2020 2020  background:.    
-000458d0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
-000458e0: 6178 225d 203d 2063 6f6e 7365 6e73 7573  ax"] = consensus
-000458f0: 2e61 780a 2020 2020 2020 2020 2020 2020  .ax.            
-00045900: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
-00045910: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
-00045920: 656d 7074 793d 5472 7565 293a 0a20 2020  empty=True):.   
-00045930: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00045940: 2e70 6c6f 7428 636f 6c6f 723d 226c 6967  .plot(color="lig
-00045950: 6874 6772 6579 222c 2076 6965 773d 7669  htgrey", view=vi
-00045960: 6577 2c20 706f 733d 706f 732c 2073 686f  ew, pos=pos, sho
-00045970: 773d 4661 6c73 652c 202a 2a6b 7761 7267  w=False, **kwarg
-00045980: 7329 0a20 2020 2020 2020 2020 2020 2063  s).            c
-00045990: 6f6e 7365 6e73 7573 2e70 6c6f 7428 636f  onsensus.plot(co
-000459a0: 6c6f 723d 636f 6c6f 722c 2076 6965 773d  lor=color, view=
-000459b0: 7669 6577 2c20 706f 733d 706f 732c 2073  view, pos=pos, s
-000459c0: 686f 773d 4661 6c73 652c 202a 2a6b 7761  how=False, **kwa
-000459d0: 7267 7329 0a0a 2020 2020 2020 2020 636f  rgs)..        co
-000459e0: 6e73 656e 7375 732e 6178 2e73 6574 5f61  nsensus.ax.set_a
-000459f0: 7370 6563 7428 2265 7175 616c 2229 0a0a  spect("equal")..
-00045a00: 2020 2020 2020 2020 6966 2073 686f 773a          if show:
-00045a10: 0a20 2020 2020 2020 2020 2020 2070 6c74  .            plt
-00045a20: 2e73 686f 7728 290a 0a20 2020 2064 6566  .show()..    def
-00045a30: 2067 6574 5f6c 656e 6774 6828 7365 6c66   get_length(self
-00045a40: 2c20 6178 293a 0a20 2020 2020 2020 2022  , ax):.        "
-00045a50: 2222 4765 7420 6c65 6e67 7468 2063 6f76  ""Get length cov
-00045a60: 6572 6564 2062 7920 524f 4973 2061 6c6f  ered by ROIs alo
-00045a70: 6e67 2061 6e20 6178 6973 2e22 2222 0a0a  ng an axis."""..
-00045a80: 2020 2020 2020 2020 6578 7465 6e74 203d          extent =
-00045a90: 2073 656c 662e 6765 745f 6578 7465 6e74   self.get_extent
-00045aa0: 2861 783d 6178 290a 2020 2020 2020 2020  (ax=ax).        
-00045ab0: 7265 7475 726e 2061 6273 2865 7874 656e  return abs(exten
-00045ac0: 745b 315d 202d 2065 7874 656e 745b 305d  t[1] - extent[0]
-00045ad0: 290a 0a20 2020 2064 6566 2067 6574 5f63  )..    def get_c
-00045ae0: 656e 7472 6528 7365 6c66 2c20 2a2a 6b77  entre(self, **kw
-00045af0: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-00045b00: 2222 4765 7420 3344 2063 656e 7472 6520  ""Get 3D centre 
-00045b10: 6f66 2074 6865 2061 7265 6120 636f 7665  of the area cove
-00045b20: 7265 6420 6279 2052 4f49 732e 2222 220a  red by ROIs.""".
-00045b30: 0a20 2020 2020 2020 206b 7761 7267 732e  .        kwargs.
-00045b40: 706f 7028 2261 7822 2c20 4e6f 6e65 290a  pop("ax", None).
-00045b50: 2020 2020 2020 2020 6578 7465 6e74 7320          extents 
-00045b60: 3d20 5b73 656c 662e 6765 745f 6578 7465  = [self.get_exte
-00045b70: 6e74 2861 783d 6178 2c20 2a2a 6b77 6172  nt(ax=ax, **kwar
-00045b80: 6773 2920 666f 7220 6178 2069 6e20 736b  gs) for ax in sk
-00045b90: 7274 2e69 6d61 6765 2e5f 6178 6573 5d0a  rt.image._axes].
-00045ba0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00045bb0: 6e70 2e6d 6561 6e28 6578 2920 666f 7220  np.mean(ex) for 
-00045bc0: 6578 2069 6e20 6578 7465 6e74 735d 0a0a  ex in extents]..
-00045bd0: 2020 2020 6465 6620 6669 6e64 5f6d 6f73      def find_mos
-00045be0: 745f 706f 7075 6c61 7465 645f 736c 6963  t_populated_slic
-00045bf0: 6528 7365 6c66 2c20 7669 6577 3d22 782d  e(self, view="x-
-00045c00: 7922 293a 0a20 2020 2020 2020 2022 2222  y"):.        """
-00045c10: 4669 6e64 2074 6865 2069 6e64 6578 206f  Find the index o
-00045c20: 6620 7468 6520 736c 6963 6520 7769 7468  f the slice with
-00045c30: 2074 6865 206d 6f73 7420 524f 4973 206f   the most ROIs o
-00045c40: 6e20 6974 2e22 2222 0a0a 2020 2020 2020  n it."""..      
-00045c50: 2020 696e 6469 6365 7320 3d20 5b5d 0a20    indices = []. 
-00045c60: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
-00045c70: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
-00045c80: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
-00045c90: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00045ca0: 696e 6469 6365 732e 6578 7465 6e64 2872  indices.extend(r
-00045cb0: 6f69 2e67 6574 5f69 6e64 6963 6573 2876  oi.get_indices(v
-00045cc0: 6965 7729 290a 2020 2020 2020 2020 7661  iew)).        va
-00045cd0: 6c73 2c20 636f 756e 7473 203d 206e 702e  ls, counts = np.
-00045ce0: 756e 6971 7565 2869 6e64 6963 6573 2c20  unique(indices, 
-00045cf0: 7265 7475 726e 5f63 6f75 6e74 733d 5472  return_counts=Tr
-00045d00: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
-00045d10: 726e 2076 616c 735b 6e70 2e61 7267 6d61  rn vals[np.argma
-00045d20: 7828 636f 756e 7473 295d 0a0a 2020 2020  x(counts)]..    
-00045d30: 6465 6620 7669 6577 2873 656c 662c 2069  def view(self, i
-00045d40: 6e63 6c75 6465 5f69 6d61 6765 3d54 7275  nclude_image=Tru
-00045d50: 652c 2072 6f69 733d 4e6f 6e65 2c20 766f  e, rois=None, vo
-00045d60: 7865 6c5f 7369 7a65 3d5b 312c 2031 5d2c  xel_size=[1, 1],
-00045d70: 2062 7566 6665 723d 352c 202a 2a6b 7761   buffer=5, **kwa
-00045d80: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-00045d90: 2256 6965 7720 7468 6520 5374 7275 6374  "View the Struct
-00045da0: 7572 6553 6574 2e0a 0a20 2020 2020 2020  ureSet...       
-00045db0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-00045dc0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00045dd0: 2020 696e 636c 7564 655f 696d 6167 6520    include_image 
-00045de0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00045df0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00045e00: 2049 6620 5472 7565 2061 6e64 2074 6869   If True and thi
-00045e10: 7320 5374 7275 6374 7572 6553 6574 2068  s StructureSet h
-00045e20: 6173 2061 6e20 6173 736f 6369 6174 6564  as an associated
-00045e30: 2069 6d61 6765 200a 2020 2020 2020 2020   image .        
-00045e40: 2020 2020 2869 6e20 7365 6c66 2e69 6d61      (in self.ima
-00045e50: 6765 292c 2074 6865 2069 6d61 6765 2077  ge), the image w
-00045e60: 696c 6c20 6265 2064 6973 706c 6179 6564  ill be displayed
-00045e70: 2062 6568 696e 6420 7468 6520 524f 4973   behind the ROIs
-00045e80: 2e0a 0a20 2020 2020 2020 2072 6f69 7320  ...        rois 
-00045e90: 3a20 5374 7275 6374 7572 6553 6574 2f6c  : StructureSet/l
-00045ea0: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
-00045eb0: 650a 2020 2020 2020 2020 2020 2020 416e  e.            An
-00045ec0: 7920 6f74 6865 7220 524f 4973 206f 7220  y other ROIs or 
-00045ed0: 5374 7275 6374 7572 6553 6574 7320 746f  StructureSets to
-00045ee0: 2069 6e63 6c75 6465 2069 6e20 7468 6520   include in the 
-00045ef0: 706c 6f74 2e0a 0a20 2020 2020 2020 2076  plot...        v
-00045f00: 6f78 656c 5f73 697a 6520 3a20 6c69 7374  oxel_size : list
-00045f10: 2c20 6465 6661 756c 743d 5b31 2c20 315d  , default=[1, 1]
-00045f20: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00045f30: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
-00045f40: 2064 6f65 7320 6e6f 7420 6861 7665 2061   does not have a
-00045f50: 6e20 6173 736f 6369 6174 6564 2069 6d61  n associated ima
-00045f60: 6765 2061 6e64 2068 6173 2052 4f49 7320  ge and has ROIs 
-00045f70: 0a20 2020 2020 2020 2020 2020 2064 6573  .            des
-00045f80: 6372 6962 6564 206f 6e6c 7920 6279 2063  cribed only by c
-00045f90: 6f6e 746f 7572 732c 2074 6869 7320 7769  ontours, this wi
-00045fa0: 6c6c 2062 6520 7468 6520 766f 7865 6c20  ll be the voxel 
-00045fb0: 7369 7a65 7320 7573 6564 2069 6e20 0a20  sizes used in . 
-00045fc0: 2020 2020 2020 2020 2020 2074 6865 2078             the x
-00045fd0: 2d79 2064 6972 6563 7469 6f6e 2077 6865  -y direction whe
-00045fe0: 6e20 636f 6e76 6572 7469 6e67 2052 4f49  n converting ROI
-00045ff0: 7320 746f 206d 6173 6b73 2069 6620 6120  s to masks if a 
-00046000: 6d61 736b 2070 6c6f 7420 0a20 2020 2020  mask plot .     
-00046010: 2020 2020 2020 2074 7970 6520 6973 2073         type is s
-00046020: 656c 6563 7465 642e 0a0a 2020 2020 2020  elected...      
-00046030: 2020 6275 6666 6572 203a 2069 6e74 2c20    buffer : int, 
-00046040: 6465 6661 756c 743d 350a 2020 2020 2020  default=5.      
-00046050: 2020 2020 2020 4966 2074 6865 2053 7472        If the Str
-00046060: 7563 7475 7265 5365 7420 646f 6573 206e  uctureSet does n
-00046070: 6f74 2068 6176 6520 616e 2061 7373 6f63  ot have an assoc
-00046080: 6961 7465 6420 696d 6167 6520 616e 6420  iated image and 
-00046090: 6861 7320 524f 4973 0a20 2020 2020 2020  has ROIs.       
-000460a0: 2020 2020 2064 6573 6372 6962 6564 206f       described o
-000460b0: 6e6c 7920 6279 2063 6f6e 746f 7572 732c  nly by contours,
-000460c0: 2074 6869 7320 7769 6c6c 2062 6520 7468   this will be th
-000460d0: 6520 6e75 6d62 6572 206f 6620 6275 6666  e number of buff
-000460e0: 6572 2076 6f78 656c 7320 0a20 2020 2020  er voxels .     
-000460f0: 2020 2020 2020 2028 692e 652e 2077 6869         (i.e. whi
-00046100: 7465 7370 6163 6529 2064 6973 706c 6179  tespace) display
-00046110: 6564 2061 726f 756e 6420 7468 6520 6578  ed around the ex
-00046120: 7465 6e74 206f 6620 7468 6520 524f 4973  tent of the ROIs
-00046130: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00046140: 2020 2020 2020 2066 726f 6d20 736b 7274         from skrt
-00046150: 2e62 6574 7465 725f 7669 6577 6572 2069  .better_viewer i
-00046160: 6d70 6f72 7420 4265 7474 6572 5669 6577  mport BetterView
-00046170: 6572 0a20 2020 2020 2020 2073 656c 662e  er.        self.
-00046180: 6c6f 6164 2829 0a0a 2020 2020 2020 2020  load()..        
-00046190: 2320 5365 7420 696e 6974 6961 6c20 7a6f  # Set initial zo
-000461a0: 6f6d 2061 6d6f 756e 7420 616e 6420 6365  om amount and ce
-000461b0: 6e74 7265 0a20 2020 2020 2020 2073 656c  ntre.        sel
-000461c0: 662e 726f 6973 5b30 5d2e 6c6f 6164 2829  f.rois[0].load()
-000461d0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000461e0: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
-000461f0: 6e65 2061 6e64 206e 6f74 2073 656c 662e  ne and not self.
-00046200: 6765 745f 726f 6973 2869 676e 6f72 655f  get_rois(ignore_
-00046210: 656d 7074 793d 5472 7565 295b 305d 2e63  empty=True)[0].c
-00046220: 6f6e 746f 7572 735f 6f6e 6c79 3a0a 2020  ontours_only:.  
-00046230: 2020 2020 2020 2020 2020 7669 6577 203d            view =
-00046240: 206b 7761 7267 732e 6765 7428 2269 6e69   kwargs.get("ini
-00046250: 745f 7669 6577 222c 2022 782d 7922 290a  t_view", "x-y").
-00046260: 2020 2020 2020 2020 2020 2020 6178 6573              axes
-00046270: 203d 2073 6b72 742e 696d 6167 652e 5f70   = skrt.image._p
-00046280: 6c6f 745f 6178 6573 5b76 6965 775d 0a20  lot_axes[view]. 
-00046290: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-000462a0: 7473 203d 205b 7365 6c66 2e67 6574 5f6c  ts = [self.get_l
-000462b0: 656e 6774 6828 6178 3d61 7829 2066 6f72  ength(ax=ax) for
-000462c0: 2061 7820 696e 2061 7865 735d 0a20 2020   ax in axes].   
-000462d0: 2020 2020 2020 2020 2069 6d5f 6c69 6d73           im_lims
-000462e0: 203d 205b 7365 6c66 2e69 6d61 6765 2e67   = [self.image.g
-000462f0: 6574 5f6c 656e 6774 6828 6178 3d61 7829  et_length(ax=ax)
-00046300: 2066 6f72 2061 7820 696e 2061 7865 735d   for ax in axes]
-00046310: 0a20 2020 2020 2020 2020 2020 207a 6f6f  .            zoo
-00046320: 6d20 3d20 6d69 6e28 5b69 6d5f 6c69 6d73  m = min([im_lims
-00046330: 5b69 5d20 2f20 6578 7465 6e74 735b 695d  [i] / extents[i]
-00046340: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00046350: 3229 5d29 202a 2030 2e38 0a20 2020 2020  2)]) * 0.8.     
-00046360: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
-00046370: 7265 203d 2073 656c 662e 6765 745f 6365  re = self.get_ce
-00046380: 6e74 7265 2829 0a20 2020 2020 2020 2020  ntre().         
-00046390: 2020 2069 6620 7a6f 6f6d 203e 2031 3a0a     if zoom > 1:.
-000463a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000463b0: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
-000463c0: 7428 227a 6f6f 6d22 2c20 7a6f 6f6d 290a  t("zoom", zoom).
-000463d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000463e0: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
-000463f0: 7428 227a 6f6f 6d5f 6365 6e74 7265 222c  t("zoom_centre",
-00046400: 207a 6f6f 6d5f 6365 6e74 7265 290a 0a20   zoom_centre).. 
-00046410: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
-00046420: 2069 6e69 7469 616c 2073 6c69 6365 0a20   initial slice. 
-00046430: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-00046440: 732e 7365 7464 6566 6175 6c74 280a 2020  s.setdefault(.  
-00046450: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-00046460: 6e69 745f 736c 6963 6522 2c20 0a20 2020  nit_slice", .   
-00046470: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00046480: 662e 696d 6167 652e 6964 785f 746f 5f73  f.image.idx_to_s
-00046490: 6c69 6365 2873 656c 662e 6669 6e64 5f6d  lice(self.find_m
-000464a0: 6f73 745f 706f 7075 6c61 7465 645f 736c  ost_populated_sl
-000464b0: 6963 6528 7669 6577 292c 0a20 2020 2020  ice(view),.     
-000464c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000464d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000464e0: 2020 2073 6b72 742e 696d 6167 652e 5f73     skrt.image._s
-000464f0: 6c69 6365 5f61 7865 735b 7669 6577 5d29  lice_axes[view])
-00046500: 290a 0a20 2020 2020 2020 2069 6620 2270  )..        if "p
-00046510: 6c6f 745f 7479 7065 2220 696e 206b 7761  lot_type" in kwa
-00046520: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00046530: 206b 7761 7267 735b 2272 6f69 5f70 6c6f   kwargs["roi_plo
-00046540: 745f 7479 7065 225d 203d 206b 7761 7267  t_type"] = kwarg
-00046550: 732e 706f 7028 2270 6c6f 745f 7479 7065  s.pop("plot_type
-00046560: 2229 0a0a 2020 2020 2020 2020 2320 456e  ")..        # En
-00046570: 7375 7265 2074 6861 7420 7469 746c 6520  sure that title 
-00046580: 6973 2073 6574 2074 6f20 6265 2061 2073  is set to be a s
-00046590: 7472 696e 672e 0a20 2020 2020 2020 2069  tring..        i
-000465a0: 6620 6b77 6172 6773 2e67 6574 2822 7469  f kwargs.get("ti
-000465b0: 746c 6522 2c20 4e6f 6e65 2920 6973 204e  tle", None) is N
-000465c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000465d0: 206b 7761 7267 735b 2274 6974 6c65 225d   kwargs["title"]
-000465e0: 203d 2073 656c 662e 6e61 6d65 206f 7220   = self.name or 
-000465f0: 2222 0a0a 2020 2020 2020 2020 2320 5669  ""..        # Vi
-00046600: 6577 2077 6974 6820 696d 6167 650a 2020  ew with image.  
-00046610: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
-00046620: 5f69 6d61 6765 2061 6e64 2073 656c 662e  _image and self.
-00046630: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
-00046640: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00046650: 6620 726f 6973 2069 7320 4e6f 6e65 3a0a  f rois is None:.
-00046660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046670: 726f 6973 203d 2073 656c 660a 2020 2020  rois = self.    
-00046680: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00046690: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000466a0: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
-000466b0: 7374 2872 6f69 7329 3a0a 2020 2020 2020  st(rois):.      
-000466c0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000466d0: 6973 203d 205b 7365 6c66 5d20 2b20 726f  is = [self] + ro
-000466e0: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
-000466f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00046700: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00046710: 7320 3d20 5b73 656c 662c 2072 6f69 735d  s = [self, rois]
-00046720: 0a20 2020 2020 2020 2020 2020 2062 7620  .            bv 
-00046730: 3d20 4265 7474 6572 5669 6577 6572 2873  = BetterViewer(s
-00046740: 656c 662e 696d 6167 652c 2072 6f69 733d  elf.image, rois=
-00046750: 726f 6973 2c20 2a2a 6b77 6172 6773 290a  rois, **kwargs).
-00046760: 0a20 2020 2020 2020 2023 2056 6965 7720  .        # View 
-00046770: 7769 7468 6f75 7420 696d 6167 650a 2020  without image.  
-00046780: 2020 2020 2020 656c 7365 3a0a 0a20 2020        else:..   
-00046790: 2020 2020 2020 2020 2073 7472 7563 7475           structu
-000467a0: 7265 5f73 6574 5f74 6d70 203d 2073 656c  re_set_tmp = sel
-000467b0: 660a 0a20 2020 2020 2020 2020 2020 2023  f..            #
-000467c0: 204d 616b 6520 6475 6d6d 7920 696d 6167   Make dummy imag
-000467d0: 650a 2020 2020 2020 2020 2020 2020 696d  e.            im
-000467e0: 203d 2073 656c 662e 6765 745f 6475 6d6d   = self.get_dumm
-000467f0: 795f 696d 6167 6528 6275 6666 6572 3d62  y_image(buffer=b
-00046800: 7566 6665 722c 200a 2020 2020 2020 2020  uffer, .        
-00046810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046820: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-00046830: 7865 6c5f 7369 7a65 3d76 6f78 656c 5f73  xel_size=voxel_s
-00046840: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-00046850: 2073 7472 7563 7475 7265 5f73 6574 5f74   structure_set_t
-00046860: 6d70 203d 2073 656c 662e 636c 6f6e 6528  mp = self.clone(
-00046870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046880: 2063 6f70 795f 726f 6973 3d54 7275 652c   copy_rois=True,
-00046890: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000468a0: 2020 636f 7079 5f72 6f69 5f64 6174 613d    copy_roi_data=
-000468b0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-000468c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000468d0: 2073 7472 7563 7475 7265 5f73 6574 5f74   structure_set_t
-000468e0: 6d70 2e73 6574 5f69 6d61 6765 2869 6d29  mp.set_image(im)
-000468f0: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-00046900: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00046910: 7365 6c66 2e72 6f69 735b 305d 2e63 6f6e  self.rois[0].con
-00046920: 746f 7572 735f 6f6e 6c79 206f 7220 5472  tours_only or Tr
-00046930: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00046940: 2020 2020 696d 203d 2073 656c 662e 6765      im = self.ge
-00046950: 745f 6475 6d6d 795f 696d 6167 6528 6275  t_dummy_image(bu
-00046960: 6666 6572 3d62 7566 6665 722c 200a 2020  ffer=buffer, .  
-00046970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046990: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-000469a0: 7a65 3d76 6f78 656c 5f73 697a 6529 0a20  ze=voxel_size). 
-000469b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000469c0: 7472 7563 7475 7265 5f73 6574 5f74 6d70  tructure_set_tmp
-000469d0: 203d 2073 656c 662e 636c 6f6e 6528 0a20   = self.clone(. 
-000469e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000469f0: 2020 2063 6f70 795f 726f 6973 3d54 7275     copy_rois=Tru
-00046a00: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00046a10: 2020 2020 2020 2020 636f 7079 5f72 6f69          copy_roi
-00046a20: 5f64 6174 613d 4661 6c73 650a 2020 2020  _data=False.    
-00046a30: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00046a40: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00046a50: 7220 726f 6920 696e 2073 7472 7563 7475  r roi in structu
-00046a60: 7265 5f73 6574 5f74 6d70 2e72 6f69 733a  re_set_tmp.rois:
-00046a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046a80: 2020 2020 2069 6620 726f 692e 636f 6e74       if roi.cont
-00046a90: 6f75 7273 5f6f 6e6c 793a 0a20 2020 2020  ours_only:.     
-00046aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046ab0: 2020 2072 6f69 2e73 6574 5f69 6d61 6765     roi.set_image
-00046ac0: 2869 6d29 0a20 2020 2020 2020 2020 2020  (im).           
-00046ad0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00046ae0: 2020 2020 2020 2069 6d20 3d20 736b 7274         im = skrt
-00046af0: 2e69 6d61 6765 2e49 6d61 6765 280a 2020  .image.Image(.  
-00046b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046b10: 2020 6e70 2e6f 6e65 7328 7365 6c66 2e72    np.ones(self.r
-00046b20: 6f69 735b 305d 2e73 6861 7065 2920 2a20  ois[0].shape) * 
-00046b30: 3165 342c 0a20 2020 2020 2020 2020 2020  1e4,.           
-00046b40: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
-00046b50: 7365 6c66 2e72 6f69 735b 305d 2e61 6666  self.rois[0].aff
-00046b60: 696e 652c 0a20 2020 2020 2020 2020 2020  ine,.           
-00046b70: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00046b80: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00046b90: 2020 2020 6966 2072 6f69 7320 6973 204e      if rois is N
-00046ba0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00046bb0: 2020 2020 2072 6f69 7320 3d20 7374 7275       rois = stru
-00046bc0: 6374 7572 655f 7365 745f 746d 700a 2020  cture_set_tmp.  
-00046bd0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00046be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046bf0: 6966 2073 6b72 742e 636f 7265 2e69 735f  if skrt.core.is_
-00046c00: 6c69 7374 2872 6f69 7329 3a0a 2020 2020  list(rois):.    
-00046c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c20: 726f 6973 203d 205b 7374 7275 6374 7572  rois = [structur
-00046c30: 655f 7365 745f 746d 705d 202b 2072 6f69  e_set_tmp] + roi
-00046c40: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00046c50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00046c60: 2020 2020 2020 2020 2020 2020 726f 6973              rois
-00046c70: 203d 205b 7374 7275 6374 7572 655f 7365   = [structure_se
-00046c80: 745f 746d 702c 2072 6f69 735d 0a20 2020  t_tmp, rois].   
-00046c90: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-00046ca0: 2273 686f 7722 5d20 3d20 4661 6c73 650a  "show"] = False.
-00046cb0: 2020 2020 2020 2020 2020 2020 6276 203d              bv =
-00046cc0: 2042 6574 7465 7256 6965 7765 7228 696d   BetterViewer(im
-00046cd0: 2c20 726f 6973 3d72 6f69 732c 202a 2a6b  , rois=rois, **k
-00046ce0: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
-00046cf0: 2020 2020 2320 4164 6a75 7374 2055 490a      # Adjust UI.
-00046d00: 2020 2020 2020 2020 2020 2020 6e6f 5f75              no_u
-00046d10: 6920 3d20 6b77 6172 6773 2e67 6574 2822  i = kwargs.get("
-00046d20: 6e6f 5f75 6922 2c20 736b 7274 2e63 6f72  no_ui", skrt.cor
-00046d30: 652e 4465 6661 756c 7473 2829 2e6e 6f5f  e.Defaults().no_
-00046d40: 7569 290a 2020 2020 2020 2020 2020 2020  ui).            
-00046d50: 6966 206e 6f74 206e 6f5f 7569 3a0a 2020  if not no_ui:.  
-00046d60: 2020 2020 2020 2020 2020 2020 2020 6276                bv
-00046d70: 2e6d 616b 655f 7569 286e 6f5f 696e 7465  .make_ui(no_inte
-00046d80: 6e73 6974 793d 5472 7565 290a 2020 2020  nsity=True).    
-00046d90: 2020 2020 2020 2020 2020 2020 6276 2e73              bv.s
-00046da0: 686f 7728 290a 0a20 2020 2020 2020 2072  how()..        r
-00046db0: 6574 7572 6e20 6276 0a0a 2020 2020 6465  eturn bv..    de
-00046dc0: 6620 6765 745f 6578 7465 6e74 2873 656c  f get_extent(sel
-00046dd0: 662c 202a 2a6b 7761 7267 7329 3a0a 2020  f, **kwargs):.  
-00046de0: 2020 2020 2020 2222 2247 6574 206d 696e        """Get min
-00046df0: 2061 6e64 206d 6178 2065 7874 656e 7420   and max extent 
-00046e00: 6f66 2061 6c6c 2052 4f49 7320 696e 2074  of all ROIs in t
-00046e10: 6865 2053 7472 7563 7475 7265 5365 742e  he StructureSet.
-00046e20: 2222 220a 0a20 2020 2020 2020 2061 6c6c  """..        all
-00046e30: 5f65 7874 656e 7473 203d 205b 5d0a 2020  _extents = [].  
-00046e40: 2020 2020 2020 666f 7220 726f 6920 696e        for roi in
-00046e50: 2073 656c 662e 6765 745f 726f 6973 2869   self.get_rois(i
-00046e60: 676e 6f72 655f 656d 7074 793d 5472 7565  gnore_empty=True
-00046e70: 293a 0a20 2020 2020 2020 2020 2020 2061  ):.            a
-00046e80: 6c6c 5f65 7874 656e 7473 2e65 7874 656e  ll_extents.exten
-00046e90: 6428 726f 692e 6765 745f 6578 7465 6e74  d(roi.get_extent
-00046ea0: 282a 2a6b 7761 7267 7329 290a 2020 2020  (**kwargs)).    
-00046eb0: 2020 2020 7265 7475 726e 206d 696e 2861      return min(a
-00046ec0: 6c6c 5f65 7874 656e 7473 292c 206d 6178  ll_extents), max
-00046ed0: 2861 6c6c 5f65 7874 656e 7473 290a 0a20  (all_extents).. 
-00046ee0: 2020 2064 6566 2067 6574 5f65 7874 656e     def get_exten
-00046ef0: 7473 2873 656c 662c 2072 6f69 5f6e 616d  ts(self, roi_nam
-00046f00: 6573 3d4e 6f6e 652c 2062 7566 6665 723d  es=None, buffer=
-00046f10: 4e6f 6e65 2c20 6275 6666 6572 5f75 6e69  None, buffer_uni
-00046f20: 7473 3d22 6d6d 222c 0a20 2020 2020 2020  ts="mm",.       
-00046f30: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
-00046f40: 2c20 6f72 6967 696e 3d4e 6f6e 6529 3a0a  , origin=None):.
-00046f50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00046f60: 2020 2020 4765 7420 6d69 6e69 6d75 6d20      Get minimum 
-00046f70: 616e 6420 6d61 7869 6d75 6d20 6578 7465  and maximum exte
-00046f80: 6e74 206f 6620 5374 7275 6374 7572 6553  nt of StructureS
-00046f90: 6574 2052 4f49 732c 0a20 2020 2020 2020  et ROIs,.       
-00046fa0: 2069 6e20 6d6d 2061 6c6f 6e67 2061 6c6c   in mm along all
-00046fb0: 2074 6872 6565 2061 7865 732c 2072 6574   three axes, ret
-00046fc0: 7572 6e65 6420 696e 206f 7264 6572 205b  urned in order [
-00046fd0: 782c 2079 2c20 7a5d 2e0a 2020 2020 2020  x, y, z]..      
-00046fe0: 2020 4f70 7469 6f6e 616c 6c79 2061 7070    Optionally app
-00046ff0: 6c79 2061 2062 7566 6665 7220 746f 2074  ly a buffer to t
-00047000: 6865 2065 7874 656e 7473 2073 7563 6820  he extents such 
-00047010: 7468 6174 2074 6865 7920 636f 7665 720a  that they cover.
-00047020: 2020 2020 2020 2020 6d6f 7265 2074 6861          more tha
-00047030: 6e20 7468 6520 7265 6769 6f6e 206f 6620  n the region of 
-00047040: 7468 6520 524f 4973 2e0a 0a20 2020 2020  the ROIs...     
-00047050: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00047060: 2a2a 0a0a 2020 2020 2020 2020 726f 695f  **..        roi_
-00047070: 6e61 6d65 7320 3a20 6c69 7374 2c20 6465  names : list, de
-00047080: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00047090: 2020 2020 2020 204c 6973 7420 6f66 206e         List of n
-000470a0: 616d 6573 206f 6620 524f 4973 2074 6f20  ames of ROIs to 
-000470b0: 6265 2063 6f6e 7369 6465 7265 642e 2020  be considered.  
-000470c0: 4966 204e 6f6e 652c 2061 6c6c 206f 6620  If None, all of 
-000470d0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-000470e0: 7374 7275 6374 7572 6520 7365 7427 7320  structure set's 
-000470f0: 524f 4973 2061 7265 2063 6f6e 7369 6465  ROIs are conside
-00047100: 7265 642e 0a0a 2020 2020 2020 2020 6275  red...        bu
-00047110: 6666 6572 203a 2066 6c6f 6174 2c20 6465  ffer : float, de
-00047120: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00047130: 2020 2020 2020 204f 7074 696f 6e61 6c20         Optional 
-00047140: 6275 6666 6572 2074 6f20 6164 6420 746f  buffer to add to
-00047150: 2074 6865 2065 7874 656e 7473 2e20 556e   the extents. Un
-00047160: 6974 7320 7365 7420 6279 2060 6275 6666  its set by `buff
-00047170: 6572 5f75 6e69 7473 602e 0a0a 2020 2020  er_units`...    
-00047180: 2020 2020 6275 6666 6572 5f75 6e69 7473      buffer_units
-00047190: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-000471a0: 226d 6d22 0a20 2020 2020 2020 2020 2020  "mm".           
-000471b0: 2055 6e69 7473 2066 6f72 2062 7566 6665   Units for buffe
-000471c0: 722c 2069 6620 7573 696e 672e 2043 616e  r, if using. Can
-000471d0: 2062 6520 226d 6d22 2c20 2276 6f78 656c   be "mm", "voxel
-000471e0: 7322 2c20 6f72 2022 6672 6163 2220 2877  s", or "frac" (w
-000471f0: 6869 6368 0a20 2020 2020 2020 2020 2020  hich.           
-00047200: 2061 7070 6c69 6573 2062 7566 6665 7220   applies buffer 
-00047210: 6173 2061 2066 7261 6374 696f 6e20 6f66  as a fraction of
-00047220: 2074 6f74 616c 206c 656e 6774 6820 696e   total length in
-00047230: 2065 6163 6820 6469 6d65 6e73 696f 6e29   each dimension)
-00047240: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
-00047250: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
-00047260: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00047270: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
-00047280: 666f 7220 6578 7465 6e74 2063 616c 6375  for extent calcu
-00047290: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
-000472a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000472b0: 2020 2a20 2263 6f6e 746f 7572 223a 2067    * "contour": g
-000472c0: 6574 2065 7874 656e 7420 6672 6f6d 206d  et extent from m
-000472d0: 696e 2f6d 6178 2070 6f73 6974 696f 6e73  in/max positions
-000472e0: 206f 6620 636f 6e74 6f75 7228 7329 2e0a   of contour(s)..
-000472f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047300: 2a20 226d 6173 6b22 3a20 6765 7420 6578  * "mask": get ex
-00047310: 7465 6e74 2066 726f 6d20 6d69 6e2f 6d61  tent from min/ma
-00047320: 7820 706f 7369 7469 6f6e 7320 6f66 2076  x positions of v
-00047330: 6f78 656c 7320 696e 2074 6865 200a 2020  oxels in the .  
-00047340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047350: 6269 6e61 7279 206d 6173 6b2e 0a20 2020  binary mask..   
-00047360: 2020 2020 2020 2020 2020 2020 202a 204e               * N
-00047370: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
-00047380: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
-00047390: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
-000473a0: 686f 642e 0a0a 2020 2020 2020 2020 6f72  hod...        or
-000473b0: 6967 696e 203a 2074 7570 6c65 2c20 6465  igin : tuple, de
-000473c0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-000473d0: 2020 2020 2020 2054 7570 6c65 2073 7065         Tuple spe
-000473e0: 6369 6679 696e 6720 7468 6520 2878 2c20  cifying the (x, 
-000473f0: 792c 207a 2920 636f 6f72 6469 6e61 7465  y, z) coordinate
-00047400: 7320 6f66 2074 6865 2070 6f69 6e74 0a20  s of the point. 
-00047410: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00047420: 7265 7370 6563 7420 746f 2077 6869 6368  respect to which
-00047430: 2065 7874 656e 7473 2061 7265 2074 6f20   extents are to 
-00047440: 6265 2064 6574 6572 6d69 6e65 642e 0a20  be determined.. 
-00047450: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
-00047460: 6e65 2c20 7468 656e 2028 302c 2030 2c20  ne, then (0, 0, 
-00047470: 3029 2069 7320 7573 6564 2e0a 2020 2020  0) is used..    
-00047480: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00047490: 7265 7475 726e 2073 656c 662e 636f 6d62  return self.comb
-000474a0: 696e 655f 726f 6973 2872 6f69 5f6e 616d  ine_rois(roi_nam
-000474b0: 6573 292e 6765 745f 6578 7465 6e74 7328  es).get_extents(
-000474c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000474d0: 2062 7566 6665 722c 2062 7566 6665 725f   buffer, buffer_
-000474e0: 756e 6974 732c 206d 6574 686f 642c 206f  units, method, o
-000474f0: 7269 6769 6e29 0a0a 2020 2020 6465 6620  rigin)..    def 
-00047500: 6765 745f 6372 6f70 5f6c 696d 6974 7328  get_crop_limits(
-00047510: 7365 6c66 2c20 726f 695f 6e61 6d65 733d  self, roi_names=
-00047520: 4e6f 6e65 2c20 6372 6f70 5f6d 6172 6769  None, crop_margi
-00047530: 6e73 3d4e 6f6e 652c 206d 6574 686f 643d  ns=None, method=
-00047540: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-00047550: 2222 0a20 2020 2020 2020 2047 6574 2063  "".        Get c
-00047560: 726f 7020 6c69 6d69 7473 2063 6f72 7265  rop limits corre
-00047570: 7370 6f6e 6469 6e67 2074 6f20 5374 7275  sponding to Stru
-00047580: 6374 7572 6553 6574 2052 4f49 2065 7874  ctureSet ROI ext
-00047590: 656e 7473 2070 6c75 7320 6d61 7267 696e  ents plus margin
-000475a0: 732e 0a0a 2020 2020 2020 2020 5468 6520  s...        The 
-000475b0: 7475 706c 6573 206f 6620 6c69 6d69 7473  tuples of limits
-000475c0: 2072 6574 7572 6e65 642c 2069 6e20 7468   returned, in th
-000475d0: 6520 6f72 6465 7220 2878 2c20 792c 207a  e order (x, y, z
-000475e0: 2920 6361 6e0a 2020 2020 2020 2020 6265  ) can.        be
-000475f0: 2075 7365 642c 2066 6f72 2065 7861 6d70   used, for examp
-00047600: 6c65 2c20 6173 2069 6e70 7574 7320 746f  le, as inputs to
-00047610: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
-00047620: 652e 6372 6f70 2829 2e0a 0a20 2020 2020  e.crop()...     
-00047630: 2020 2054 6869 7320 6d65 7468 6f64 2069     This method i
-00047640: 7320 7369 6d69 6c61 7220 746f 2074 6865  s similar to the
-00047650: 206d 6574 686f 6420 6765 745f 6578 7465   method get_exte
-00047660: 6e74 7328 292c 2062 7574 2061 6c6c 6f77  nts(), but allow
-00047670: 730a 2020 2020 2020 2020 6469 6666 6572  s.        differ
-00047680: 656e 7420 6d61 7267 696e 7320 6f6e 2065  ent margins on e
-00047690: 6163 6820 7369 6465 206f 6620 7468 6520  ach side of the 
-000476a0: 5374 7275 6374 7572 6553 6574 2e0a 0a20  StructureSet... 
-000476b0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-000476c0: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
-000476d0: 726f 695f 6e61 6d65 7320 3a20 6c69 7374  roi_names : list
-000476e0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000476f0: 2020 2020 2020 2020 2020 204c 6973 7420             List 
-00047700: 6f66 206e 616d 6573 206f 6620 524f 4973  of names of ROIs
-00047710: 2074 6f20 6265 2063 6f6e 7369 6465 7265   to be considere
-00047720: 642e 2020 4966 204e 6f6e 652c 2061 6c6c  d.  If None, all
-00047730: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00047740: 2020 2020 7374 7275 6374 7572 6520 7365      structure se
-00047750: 7427 7320 524f 4973 2061 7265 2063 6f6e  t's ROIs are con
-00047760: 7369 6465 7265 642e 0a0a 2020 2020 2020  sidered...      
-00047770: 2020 6372 6f70 5f6d 6172 6769 6e73 203a    crop_margins :
-00047780: 2066 6c6f 6174 2f74 7570 6c65 2c20 6465   float/tuple, de
-00047790: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-000477a0: 2020 2020 2020 2046 6c6f 6174 206f 7220         Float or 
-000477b0: 7468 7265 652d 656c 656d 656e 7420 7475  three-element tu
-000477c0: 706c 6520 7370 6563 6966 7969 6e67 2074  ple specifying t
-000477d0: 6865 206d 6172 6769 6e73 2c20 696e 206d  he margins, in m
-000477e0: 6d2c 0a20 2020 2020 2020 2020 2020 2074  m,.            t
-000477f0: 6f20 6265 2061 6464 6564 2074 6f20 5374  o be added to St
-00047800: 7275 6374 7572 6553 6574 2065 7874 656e  ructureSet exten
-00047810: 7473 2e20 2049 6620 6120 666c 6f61 742c  ts.  If a float,
-00047820: 206d 696e 7573 2061 6e64 2070 6c75 7320   minus and plus 
-00047830: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00047840: 7661 6c75 6520 7370 6563 6966 6965 6420  value specified 
-00047850: 6172 6520 6164 6465 6420 746f 206c 6f77  are added to low
-00047860: 6572 2061 6e64 2075 7070 6572 2065 7874  er and upper ext
-00047870: 656e 7473 2072 6573 7065 6374 6976 656c  ents respectivel
-00047880: 790a 2020 2020 2020 2020 2020 2020 616c  y.            al
-00047890: 6f6e 6720 6561 6368 2061 7869 732e 2020  ong each axis.  
-000478a0: 4966 2061 2074 6872 6565 2d65 6c65 6d65  If a three-eleme
-000478b0: 6e74 2074 7570 6c65 2c20 656c 656d 656e  nt tuple, elemen
-000478c0: 7473 2061 7265 0a20 2020 2020 2020 2020  ts are.         
-000478d0: 2020 2074 616b 656e 2074 6f20 7370 6563     taken to spec
-000478e0: 6966 7920 6d61 7267 696e 7320 696e 2074  ify margins in t
-000478f0: 6865 206f 7264 6572 2028 782c 2079 2c20  he order (x, y, 
-00047900: 7a29 2e20 2045 6c65 6d65 6e74 730a 2020  z).  Elements.  
-00047910: 2020 2020 2020 2020 2020 6361 6e20 6265            can be
-00047920: 2065 6974 6865 7220 666c 6f61 7473 2028   either floats (
-00047930: 6d69 6e75 7320 616e 6420 706c 7573 2074  minus and plus t
-00047940: 6865 2076 616c 7565 2061 6464 6564 2072  he value added r
-00047950: 6573 7065 6374 6976 656c 790a 2020 2020  espectively.    
-00047960: 2020 2020 2020 2020 746f 206c 6f77 6572          to lower
-00047970: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
-00047980: 7473 2920 6f72 2074 776f 2d65 6c65 6d65  ts) or two-eleme
-00047990: 6e74 2074 7570 6c65 7320 2865 6c65 6d65  nt tuples (eleme
-000479a0: 6e74 7320 3020 616e 6420 310a 2020 2020  nts 0 and 1.    
-000479b0: 2020 2020 2020 2020 6164 6465 6420 7265          added re
-000479c0: 7370 6563 7469 7665 6c79 2074 6f20 6c6f  spectively to lo
-000479d0: 7765 7220 616e 6420 7570 7065 7220 6578  wer and upper ex
-000479e0: 7465 6e74 7329 2e0a 0a20 2020 2020 2020  tents)...       
-000479f0: 206d 6574 686f 6420 3a20 7374 722c 2064   method : str, d
-00047a00: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00047a10: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
-00047a20: 6f20 7573 6520 666f 7220 6578 7465 6e74  o use for extent
-00047a30: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
-00047a40: 6e20 6265 3a0a 0a20 2020 2020 2020 2020  n be:..         
-00047a50: 2020 2020 2020 202a 2022 636f 6e74 6f75         * "contou
-00047a60: 7222 3a20 6765 7420 6578 7465 6e74 2066  r": get extent f
-00047a70: 726f 6d20 6d69 6e2f 6d61 7820 706f 7369  rom min/max posi
-00047a80: 7469 6f6e 7320 6f66 2063 6f6e 746f 7572  tions of contour
-00047a90: 2873 292e 0a20 2020 2020 2020 2020 2020  (s)..           
-00047aa0: 2020 2020 202a 2022 6d61 736b 223a 2067       * "mask": g
-00047ab0: 6574 2065 7874 656e 7420 6672 6f6d 206d  et extent from m
-00047ac0: 696e 2f6d 6178 2070 6f73 6974 696f 6e73  in/max positions
-00047ad0: 206f 6620 766f 7865 6c73 2069 6e20 7468   of voxels in th
-00047ae0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00047af0: 2020 2020 6269 6e61 7279 206d 6173 6b2e      binary mask.
-00047b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00047b10: 202a 204e 6f6e 653a 2075 7365 2074 6865   * None: use the
-00047b20: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
-00047b30: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-00047b40: 5f6d 6574 686f 642e 0a20 2020 2020 2020  _method..       
-00047b50: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00047b60: 7572 6e20 7365 6c66 2e63 6f6d 6269 6e65  urn self.combine
-00047b70: 5f72 6f69 7328 726f 695f 6e61 6d65 7329  _rois(roi_names)
-00047b80: 2e67 6574 5f63 726f 705f 6c69 6d69 7473  .get_crop_limits
-00047b90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00047ba0: 2020 6372 6f70 5f6d 6172 6769 6e73 2c20    crop_margins, 
-00047bb0: 6d65 7468 6f64 290a 0a20 2020 2064 6566  method)..    def
-00047bc0: 2067 6574 5f62 626f 785f 6365 6e74 7265   get_bbox_centre
-00047bd0: 5f61 6e64 5f77 6964 7468 7328 7365 6c66  _and_widths(self
-00047be0: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
-00047bf0: 695f 6e61 6d65 733d 4e6f 6e65 2c20 6275  i_names=None, bu
-00047c00: 6666 6572 3d4e 6f6e 652c 2062 7566 6665  ffer=None, buffe
-00047c10: 725f 756e 6974 733d 226d 6d22 2c20 6d65  r_units="mm", me
-00047c20: 7468 6f64 3d4e 6f6e 6529 3a0a 2020 2020  thod=None):.    
-00047c30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00047c40: 4765 7420 6365 6e74 7265 2061 6e64 2077  Get centre and w
-00047c50: 6964 7468 7320 696e 206d 6d20 616c 6f6e  idths in mm alon
-00047c60: 6720 616c 6c20 7468 7265 6520 6178 6573  g all three axes
-00047c70: 206f 6620 6120 626f 756e 6469 6e67 2062   of a bounding b
-00047c80: 6f78 0a20 2020 2020 2020 2065 6e63 6c6f  ox.        enclo
-00047c90: 7369 6e67 2053 7472 7563 7475 7265 5365  sing StructureSe
-00047ca0: 7420 524f 4973 2061 6e64 206f 7074 696f  t ROIs and optio
-00047cb0: 6e61 6c20 6275 6666 6572 2e20 2043 656e  nal buffer.  Cen
-00047cc0: 7472 650a 2020 2020 2020 2020 616e 6420  tre.        and 
-00047cd0: 7769 6474 6873 2061 7265 2072 6574 7572  widths are retur
-00047ce0: 6e65 6420 6173 2061 2074 7570 6c65 2028  ned as a tuple (
-00047cf0: 5b78 2c20 792c 207a 5d2c 205b 6478 2c20  [x, y, z], [dx, 
-00047d00: 6479 2c20 647a 5d29 2e0a 0a20 2020 2020  dy, dz])...     
-00047d10: 2020 204d 6574 686f 6420 7061 7261 6d65     Method parame
-00047d20: 7465 7273 2061 7265 2070 6173 7365 6420  ters are passed 
-00047d30: 746f 0a20 2020 2020 2020 2073 6b72 742e  to.        skrt.
-00047d40: 7374 7275 6374 7572 6573 2e53 7472 7563  structures.Struc
-00047d50: 7475 7265 5365 742e 6765 745f 6578 7465  tureSet.get_exte
-00047d60: 6e74 7328 2920 746f 206f 6274 6169 6e20  nts() to obtain 
-00047d70: 5374 7275 6374 7572 6553 6574 0a20 2020  StructureSet.   
-00047d80: 2020 2020 2065 7874 656e 7473 2e20 2046       extents.  F
-00047d90: 6f72 2070 6172 616d 6574 6572 2065 7870  or parameter exp
-00047da0: 6c61 6e61 7469 6f6e 732c 2073 6565 0a20  lanations, see. 
-00047db0: 2020 2020 2020 2073 6b72 742e 7374 7275         skrt.stru
-00047dc0: 6374 7572 6573 2e53 7472 7563 7475 7265  ctures.Structure
-00047dd0: 5365 742e 6765 745f 6578 7465 6e74 7328  Set.get_extents(
-00047de0: 2920 646f 6375 6d65 6e74 6174 696f 6e2e  ) documentation.
-00047df0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00047e00: 2020 2020 2065 7874 656e 7473 203d 2073       extents = s
-00047e10: 656c 662e 6765 745f 6578 7465 6e74 7328  elf.get_extents(
-00047e20: 726f 695f 6e61 6d65 732c 2062 7566 6665  roi_names, buffe
-00047e30: 722c 2062 7566 6665 725f 756e 6974 732c  r, buffer_units,
-00047e40: 206d 6574 686f 6429 200a 2020 2020 2020   method) .      
-00047e50: 2020 6365 6e74 7265 203d 205b 302e 3520    centre = [0.5 
-00047e60: 2a20 2865 7874 656e 745b 305d 202b 2065  * (extent[0] + e
-00047e70: 7874 656e 745b 315d 2920 666f 7220 6578  xtent[1]) for ex
-00047e80: 7465 6e74 2069 6e20 6578 7465 6e74 735d  tent in extents]
-00047e90: 0a20 2020 2020 2020 2077 6964 7468 7320  .        widths 
-00047ea0: 3d20 5b28 6578 7465 6e74 5b31 5d20 2d20  = [(extent[1] - 
-00047eb0: 6578 7465 6e74 5b30 5d29 2066 6f72 2065  extent[0]) for e
-00047ec0: 7874 656e 7420 696e 2065 7874 656e 7473  xtent in extents
-00047ed0: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00047ee0: 2028 6365 6e74 7265 2c20 7769 6474 6873   (centre, widths
-00047ef0: 290a 0a20 2020 2064 6566 2067 6574 5f64  )..    def get_d
-00047f00: 756d 6d79 5f69 6d61 6765 2873 656c 662c  ummy_image(self,
-00047f10: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00047f20: 2020 2020 2222 224d 616b 6520 6120 6475      """Make a du
-00047f30: 6d6d 7920 696d 6167 6520 7468 6174 2063  mmy image that c
-00047f40: 6f76 6572 7320 7468 6520 6172 6561 2073  overs the area s
-00047f50: 7061 6e6e 6564 2062 7920 616c 6c20 524f  panned by all RO
-00047f60: 4973 2069 6e20 7468 6973 0a20 2020 2020  Is in this.     
-00047f70: 2020 2053 7472 7563 7475 7265 5365 742e     StructureSet.
-00047f80: 2052 6574 7572 6e73 2061 6e20 496d 6167   Returns an Imag
-00047f90: 6520 6f62 6a65 6374 2e0a 0a20 2020 2020  e object...     
-00047fa0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00047fb0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-00047fc0: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
-00047fd0: 206c 6973 742c 2064 6566 6175 6c74 3d4e   list, default=N
-00047fe0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00047ff0: 566f 7865 6c20 7369 7a65 2069 6e20 6d6d  Voxel size in mm
-00048000: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
-00048010: 6167 6520 696e 2074 6865 2078 2d79 2070  age in the x-y p
-00048020: 6c61 6e65 2c20 6769 7665 6e20 6173 200a  lane, given as .
-00048030: 2020 2020 2020 2020 2020 2020 5b76 782c              [vx,
-00048040: 2076 795d 2e20 4966 203c 7368 6170 653e   vy]. If <shape>
-00048050: 2061 6e64 203c 766f 7865 6c5f 7369 7a65   and <voxel_size
-00048060: 3e20 6172 6520 626f 7468 204e 6f6e 652c  > are both None,
-00048070: 2076 6f78 656c 2073 697a 6573 206f 660a   voxel sizes of.
-00048080: 2020 2020 2020 2020 2020 2020 5b31 2c20              [1, 
-00048090: 315d 2077 696c 6c20 6265 2075 7365 6420  1] will be used 
-000480a0: 6279 2064 6566 6175 6c74 2e20 5468 6520  by default. The 
-000480b0: 766f 7865 6c20 7369 7a65 2069 6e20 7468  voxel size in th
-000480c0: 6520 7a20 6469 7265 6374 696f 6e20 0a20  e z direction . 
-000480d0: 2020 2020 2020 2020 2020 2069 7320 6465             is de
-000480e0: 6669 6e65 6420 6279 203c 736c 6963 655f  fined by <slice_
-000480f0: 7468 6963 6b6e 6573 733e 2e0a 0a20 2020  thickness>...   
-00048100: 2020 2020 2073 6861 7065 203a 206c 6973       shape : lis
-00048110: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00048120: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
-00048130: 6572 206f 6620 766f 7865 6c73 2069 6e20  er of voxels in 
-00048140: 7468 6520 6475 6d6d 7920 696d 6167 6520  the dummy image 
-00048150: 696e 2074 6865 2078 2d79 2070 6c61 6e65  in the x-y plane
-00048160: 2c20 6769 7665 6e20 6173 0a20 2020 2020  , given as.     
-00048170: 2020 2020 2020 205b 6e78 2c20 6e79 5d2e         [nx, ny].
-00048180: 204f 6e6c 7920 7573 6564 2069 6620 3c76   Only used if <v
-00048190: 6f78 656c 5f73 697a 653e 2069 7320 4e6f  oxel_size> is No
-000481a0: 6e65 2e20 0a20 2020 2020 2020 2020 2020  ne. .           
-000481b0: 2054 6865 206e 756d 6265 7220 6f66 2076   The number of v
-000481c0: 6f78 656c 7320 696e 2074 6865 207a 2064  oxels in the z d
-000481d0: 6972 6563 7469 6f6e 2077 696c 6c20 6265  irection will be
-000481e0: 2074 616b 656e 2066 726f 6d20 7468 6520   taken from the 
-000481f0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-00048200: 6265 7220 6f66 2073 6c69 6365 7320 696e  ber of slices in
-00048210: 2074 6865 2078 2d79 2063 6f6e 746f 7572   the x-y contour
-00048220: 7320 6469 6374 696f 6e61 7279 2e0a 0a20  s dictionary... 
-00048230: 2020 2020 2020 2066 696c 6c5f 7661 6c20         fill_val 
-00048240: 3a20 696e 742f 666c 6f61 742c 2064 6566  : int/float, def
-00048250: 6175 6c74 3d31 6534 0a20 2020 2020 2020  ault=1e4.       
-00048260: 2020 2020 2056 616c 7565 2077 6974 6820       Value with 
-00048270: 7768 6963 6820 7468 6520 766f 7865 6c73  which the voxels
-00048280: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
-00048290: 6167 6520 7368 6f75 6c64 2062 6520 6669  age should be fi
-000482a0: 6c6c 6564 2e20 0a0a 2020 2020 2020 2020  lled. ..        
-000482b0: 6275 6666 6572 203a 2069 6e74 2c20 6465  buffer : int, de
-000482c0: 6661 756c 743d 310a 2020 2020 2020 2020  fault=1.        
-000482d0: 2020 2020 4e75 6d62 6572 206f 6620 656d      Number of em
-000482e0: 7074 7920 6275 6666 6572 2076 6f78 656c  pty buffer voxel
-000482f0: 7320 746f 2061 6464 206f 7574 7369 6465  s to add outside
-00048300: 2074 6865 2052 4f49 2069 6e20 6561 6368   the ROI in each
-00048310: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
-00048320: 6563 7469 6f6e 2e0a 0a20 2020 2020 2020  ection...       
-00048330: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
-00048340: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
-00048350: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00048360: 2020 2056 6f78 656c 2073 697a 6520 696e     Voxel size in
-00048370: 206d 6d20 696e 2074 6865 2064 756d 6d79   mm in the dummy
-00048380: 2069 6d61 6765 2069 6e20 7468 6520 7a20   image in the z 
-00048390: 6469 7265 6374 696f 6e2e 2020 4966 204e  direction.  If N
-000483a0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000483b0: 2074 6865 2076 616c 7565 2075 7365 6420   the value used 
-000483c0: 6973 2074 6865 206d 696e 696d 756d 2064  is the minimum d
-000483d0: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
-000483e0: 736c 6963 6520 706f 7369 7469 6f6e 730a  slice positions.
-000483f0: 2020 2020 2020 2020 2020 2020 696e 2074              in t
-00048400: 6865 2078 2d79 2063 6f6e 746f 7572 7320  he x-y contours 
-00048410: 6469 6374 696f 6e61 7279 2e0a 2020 2020  dictionary..    
-00048420: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00048430: 6578 7465 6e74 7320 3d20 5b73 656c 662e  extents = [self.
-00048440: 6765 745f 6578 7465 6e74 2861 783d 6178  get_extent(ax=ax
-00048450: 2920 666f 7220 6178 2069 6e20 736b 7274  ) for ax in skrt
-00048460: 2e69 6d61 6765 2e5f 6178 6573 5d0a 2020  .image._axes].  
-00048470: 2020 2020 2020 736c 6963 655f 7468 6963        slice_thic
-00048480: 6b6e 6573 7320 3d20 6b77 6172 6773 2e70  kness = kwargs.p
-00048490: 6f70 2822 736c 6963 655f 7468 6963 6b6e  op("slice_thickn
-000484a0: 6573 7322 2c20 4e6f 6e65 290a 2020 2020  ess", None).    
-000484b0: 2020 2020 736c 6963 655f 7468 6963 6b6e      slice_thickn
-000484c0: 6573 7320 3d20 2873 6c69 6365 5f74 6869  ess = (slice_thi
-000484d0: 636b 6e65 7373 206f 720a 2020 2020 2020  ckness or.      
-000484e0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
-000484f0: 6574 5f72 6f69 7328 6967 6e6f 7265 5f65  et_rois(ignore_e
-00048500: 6d70 7479 3d54 7275 6529 5b30 5d5c 0a20  mpty=True)[0]\. 
-00048510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048520: 2020 2020 2020 202e 6765 745f 736c 6963         .get_slic
-00048530: 655f 7468 6963 6b6e 6573 735f 636f 6e74  e_thickness_cont
-00048540: 6f75 7273 2829 290a 2020 2020 2020 2020  ours()).        
-00048550: 7265 7475 726e 2063 7265 6174 655f 6475  return create_du
-00048560: 6d6d 795f 696d 6167 6528 6578 7465 6e74  mmy_image(extent
-00048570: 732c 2073 6c69 6365 5f74 6869 636b 6e65  s, slice_thickne
-00048580: 7373 2c20 2a2a 6b77 6172 6773 290a 0a20  ss, **kwargs).. 
-00048590: 2020 2064 6566 205f 6765 745f 636f 6d62     def _get_comb
-000485a0: 696e 6174 696f 6e28 7365 6c66 2c20 6e61  ination(self, na
-000485b0: 6d65 2c20 666f 7263 652c 2065 7863 6c75  me, force, exclu
-000485c0: 6465 2c20 636f 6d62 6f5f 6d61 6b65 722c  de, combo_maker,
-000485d0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-000485e0: 2020 2020 2222 2245 6974 6865 7220 6765      """Either ge
-000485f0: 7420 616e 2061 6c72 6561 6479 2063 616c  t an already cal
-00048600: 6375 6c61 7465 6420 636f 6d62 696e 6174  culated combinat
-00048610: 696f 6e20 6672 6f6d 2074 6865 2063 6163  ion from the cac
-00048620: 6865 0a20 2020 2020 2020 206f 7220 6372  he.        or cr
-00048630: 6561 7465 2069 742c 2063 6163 6865 2069  eate it, cache i
-00048640: 742c 2061 6e64 2072 6574 7572 6e20 6974  t, and return it
-00048650: 2e22 2222 0a0a 2020 2020 2020 2020 2320  ."""..        # 
-00048660: 5265 7475 726e 2063 6163 6865 6420 7265  Return cached re
-00048670: 7375 6c74 2069 6620 6974 2065 7869 7374  sult if it exist
-00048680: 7320 616e 6420 6e6f 7420 666f 7263 696e  s and not forcin
-00048690: 670a 2020 2020 2020 2020 6174 7472 203d  g.        attr =
-000486a0: 2066 225f 7b6e 616d 657d 220a 2020 2020   f"_{name}".    
-000486b0: 2020 2020 6966 2065 7863 6c75 6465 3a0a      if exclude:.
-000486c0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
-000486d0: 202b 3d20 6622 5f65 7863 6c75 6465 6422   += f"_excluded"
-000486e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000486f0: 666f 7263 653a 0a20 2020 2020 2020 2020  force:.         
-00048700: 2020 2069 6620 6578 636c 7564 6520 6973     if exclude is
-00048710: 204e 6f6e 6520 616e 6420 6861 7361 7474   None and hasatt
-00048720: 7228 7365 6c66 2c20 6174 7472 293a 0a20  r(self, attr):. 
-00048730: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00048740: 6574 7572 6e20 6765 7461 7474 7228 7365  eturn getattr(se
-00048750: 6c66 2c20 6174 7472 290a 2020 2020 2020  lf, attr).      
-00048760: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00048770: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-00048780: 6173 6174 7472 2873 656c 662c 2061 7474  asattr(self, att
-00048790: 7229 2061 6e64 2065 7863 6c75 6465 2069  r) and exclude i
-000487a0: 6e20 6765 7461 7474 7228 7365 6c66 2c20  n getattr(self, 
-000487b0: 6174 7472 293a 0a20 2020 2020 2020 2020  attr):.         
-000487c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000487d0: 6e20 6765 7461 7474 7228 7365 6c66 2c20  n getattr(self, 
-000487e0: 6174 7472 295b 6578 636c 7564 655d 0a0a  attr)[exclude]..
-000487f0: 2020 2020 2020 2020 2320 4765 7420 6c69          # Get li
-00048800: 7374 206f 6620 524f 4973 2074 6f20 696e  st of ROIs to in
-00048810: 636c 7564 6520 696e 2074 6869 7320 636f  clude in this co
-00048820: 6d62 696e 6174 696f 6e20 524f 490a 2020  mbination ROI.  
-00048830: 2020 2020 2020 6966 2065 7863 6c75 6465        if exclude
-00048840: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 0a20   is not None:.. 
-00048850: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
-00048860: 636c 7564 6520 6e6f 7420 696e 2073 656c  clude not in sel
-00048870: 662e 6765 745f 726f 695f 6e61 6d65 7328  f.get_roi_names(
-00048880: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00048890: 2020 2070 7269 6e74 2866 2252 4f49 2074     print(f"ROI t
-000488a0: 6f20 6578 636c 7564 6520 7b65 7863 6c75  o exclude {exclu
-000488b0: 6465 7d20 6e6f 7420 666f 756e 642e 2229  de} not found.")
-000488c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000488d0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-000488e0: 2020 2020 2072 6f69 735f 746f 5f69 6e63       rois_to_inc
-000488f0: 6c75 6465 203d 205b 726f 6920 666f 7220  lude = [roi for 
-00048900: 726f 6920 696e 2073 656c 662e 726f 6973  roi in self.rois
-00048910: 2069 6620 726f 692e 6e61 6d65 2021 3d20   if roi.name != 
-00048920: 6578 636c 7564 655d 0a0a 2020 2020 2020  exclude]..      
-00048930: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-00048940: 6174 7472 2873 656c 662c 2061 7474 7229  attr(self, attr)
-00048950: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00048960: 2020 7365 7461 7474 7228 7365 6c66 2c20    setattr(self, 
-00048970: 6174 7472 2c20 7b7d 290a 2020 2020 2020  attr, {}).      
-00048980: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00048990: 2020 2020 726f 6973 5f74 6f5f 696e 636c      rois_to_incl
-000489a0: 7564 6520 3d20 7365 6c66 2e72 6f69 730a  ude = self.rois.
-000489b0: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
-000489c0: 6b77 6172 6773 2066 6f72 2052 4f49 2063  kwargs for ROI c
-000489d0: 7265 6174 696f 6e0a 2020 2020 2020 2020  reation.        
-000489e0: 726f 695f 6b77 6172 6773 203d 2073 656c  roi_kwargs = sel
-000489f0: 662e 726f 695f 6b77 6172 6773 2e63 6f70  f.roi_kwargs.cop
-00048a00: 7928 290a 2020 2020 2020 2020 726f 695f  y().        roi_
-00048a10: 6b77 6172 6773 2e75 7064 6174 6528 6b77  kwargs.update(kw
-00048a20: 6172 6773 290a 2020 2020 2020 2020 726f  args).        ro
-00048a30: 695f 6b77 6172 6773 5b22 6e61 6d65 225d  i_kwargs["name"]
-00048a40: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
-00048a50: 726f 695f 6b77 6172 6773 5b22 696d 6167  roi_kwargs["imag
-00048a60: 6522 5d20 3d20 7365 6c66 2e69 6d61 6765  e"] = self.image
-00048a70: 0a20 2020 2020 2020 2072 6f69 5f6b 7761  .        roi_kwa
-00048a80: 7267 735b 2261 6666 696e 6522 5d20 3d20  rgs["affine"] = 
-00048a90: 726f 6973 5f74 6f5f 696e 636c 7564 655b  rois_to_include[
-00048aa0: 305d 2e67 6574 5f61 6666 696e 6528 7374  0].get_affine(st
-00048ab0: 616e 6461 7264 6973 653d 5472 7565 290a  andardise=True).
-00048ac0: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-00048ad0: 6520 7468 6520 524f 490a 2020 2020 2020  e the ROI.      
-00048ae0: 2020 726f 6920 3d20 636f 6d62 6f5f 6d61    roi = combo_ma
-00048af0: 6b65 7228 726f 6973 5f74 6f5f 696e 636c  ker(rois_to_incl
-00048b00: 7564 652c 202a 2a72 6f69 5f6b 7761 7267  ude, **roi_kwarg
-00048b10: 7329 0a0a 2020 2020 2020 2020 2320 4164  s)..        # Ad
-00048b20: 6420 6974 2074 6f20 7468 6520 6361 6368  d it to the cach
-00048b30: 6520 616e 6420 7265 7475 726e 0a20 2020  e and return.   
-00048b40: 2020 2020 2069 6620 6578 636c 7564 6520       if exclude 
-00048b50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00048b60: 2020 2020 2073 6574 6174 7472 2873 656c       setattr(sel
-00048b70: 662c 2061 7474 722c 2072 6f69 290a 2020  f, attr, roi).  
-00048b80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00048b90: 2020 2020 2020 2020 6765 7461 7474 7228          getattr(
-00048ba0: 7365 6c66 2c20 6174 7472 295b 6578 636c  self, attr)[excl
-00048bb0: 7564 655d 203d 2072 6f69 0a20 2020 2020  ude] = roi.     
-00048bc0: 2020 2072 6574 7572 6e20 726f 690a 0a20     return roi.. 
-00048bd0: 2020 2064 6566 2067 6574 5f63 6f6e 7365     def get_conse
-00048be0: 6e73 7573 2873 656c 662c 2063 6f6e 7365  nsus(self, conse
-00048bf0: 6e73 7573 5f74 7970 652c 2063 6f6c 6f72  nsus_type, color
-00048c00: 3d22 626c 7565 222c 202a 2a6b 7761 7267  ="blue", **kwarg
-00048c10: 7329 3a0a 0a20 2020 2020 2020 2023 2047  s):..        # G
-00048c20: 6574 2063 6f6e 7365 6e73 7573 2063 616c  et consensus cal
-00048c30: 6375 6c61 7469 6f6e 2066 756e 6374 696f  culation functio
-00048c40: 6e0a 2020 2020 2020 2020 6966 2063 6f6e  n.        if con
-00048c50: 7365 6e73 7573 5f74 7970 6520 3d3d 2022  sensus_type == "
-00048c60: 6d61 6a6f 7269 7479 223a 0a20 2020 2020  majority":.     
-00048c70: 2020 2020 2020 2063 6f6e 7365 6e73 7573         consensus
-00048c80: 5f66 756e 6320 3d20 5374 7275 6374 7572  _func = Structur
-00048c90: 6553 6574 2e67 6574 5f6d 616a 6f72 6974  eSet.get_majorit
-00048ca0: 795f 766f 7465 0a20 2020 2020 2020 2065  y_vote.        e
-00048cb0: 6c69 6620 636f 6e73 656e 7375 735f 7479  lif consensus_ty
-00048cc0: 7065 203d 3d20 2273 756d 223a 0a20 2020  pe == "sum":.   
-00048cd0: 2020 2020 2020 2020 2063 6f6e 7365 6e73           consens
-00048ce0: 7573 5f66 756e 6320 3d20 5374 7275 6374  us_func = Struct
-00048cf0: 7572 6553 6574 2e67 6574 5f73 756d 0a20  ureSet.get_sum. 
-00048d00: 2020 2020 2020 2065 6c69 6620 636f 6e73         elif cons
-00048d10: 656e 7375 735f 7479 7065 203d 3d20 226f  ensus_type == "o
-00048d20: 7665 726c 6170 223a 0a20 2020 2020 2020  verlap":.       
-00048d30: 2020 2020 2063 6f6e 7365 6e73 7573 5f66       consensus_f
-00048d40: 756e 6320 3d20 5374 7275 6374 7572 6553  unc = StructureS
-00048d50: 6574 2e67 6574 5f6f 7665 726c 6170 0a20  et.get_overlap. 
-00048d60: 2020 2020 2020 2065 6c69 6620 636f 6e73         elif cons
-00048d70: 656e 7375 735f 7479 7065 203d 3d20 2273  ensus_type == "s
-00048d80: 7461 706c 6522 3a0a 2020 2020 2020 2020  taple":.        
-00048d90: 2020 2020 636f 6e73 656e 7375 735f 6675      consensus_fu
-00048da0: 6e63 203d 2053 7472 7563 7475 7265 5365  nc = StructureSe
-00048db0: 742e 6765 745f 7374 6170 6c65 0a20 2020  t.get_staple.   
-00048dc0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00048dd0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00048de0: 7565 4572 726f 7228 6622 556e 7265 636f  ueError(f"Unreco
-00048df0: 676e 6973 6564 2063 6f6e 7365 6e73 7573  gnised consensus
-00048e00: 2074 7970 653a 207b 636f 6e73 656e 7375   type: {consensu
-00048e10: 735f 7479 7065 7d22 290a 0a20 2020 2020  s_type}")..     
-00048e20: 2020 2072 6574 7572 6e20 636f 6e73 656e     return consen
-00048e30: 7375 735f 6675 6e63 2873 656c 662c 2063  sus_func(self, c
-00048e40: 6f6c 6f72 3d63 6f6c 6f72 2c20 2a2a 6b77  olor=color, **kw
-00048e50: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
-00048e60: 6574 5f73 7461 706c 6528 7365 6c66 2c20  et_staple(self, 
-00048e70: 666f 7263 653d 4661 6c73 652c 2065 7863  force=False, exc
-00048e80: 6c75 6465 3d4e 6f6e 652c 202a 2a6b 7761  lude=None, **kwa
-00048e90: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-00048ea0: 2247 6574 2052 4f49 206f 626a 6563 7420  "Get ROI object 
-00048eb0: 7265 7072 6573 656e 7469 6e67 2074 6865  representing the
-00048ec0: 2053 5441 504c 4520 636f 6d62 696e 6174   STAPLE combinat
-00048ed0: 696f 6e20 6f66 2052 4f49 7320 696e 2074  ion of ROIs in t
-00048ee0: 6869 7320 0a20 2020 2020 2020 2073 7472  his .        str
-00048ef0: 7563 7475 7265 2073 6574 2e20 4966 203c  ucture set. If <
-00048f00: 6578 636c 7564 653e 2069 7320 7365 7420  exclude> is set 
-00048f10: 746f 2061 2073 7472 696e 672c 2074 6865  to a string, the
-00048f20: 2052 4f49 2077 6974 6820 7468 6174 206e   ROI with that n
-00048f30: 616d 6520 0a20 2020 2020 2020 2077 696c  ame .        wil
-00048f40: 6c20 6265 2065 7863 6c75 6465 6420 6672  l be excluded fr
-00048f50: 6f6d 2074 6865 2063 616c 6375 6c61 7469  om the calculati
-00048f60: 6f6e 2e0a 0a20 2020 2020 2020 202a 2a50  on...        **P
-00048f70: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-00048f80: 2020 2020 2020 666f 7263 6520 3a20 626f        force : bo
-00048f90: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-00048fa0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-00048fb0: 2046 616c 7365 2061 6e64 2053 5441 504c   False and STAPL
-00048fc0: 4520 524f 4920 6861 7320 616c 7265 6164  E ROI has alread
-00048fd0: 7920 6265 656e 2063 7265 6174 6564 2c20  y been created, 
-00048fe0: 7468 6520 0a20 2020 2020 2020 2020 2020  the .           
-00048ff0: 2070 7265 7669 6f75 736c 7920 636f 6d70   previously comp
-00049000: 7574 6564 2052 4f49 2077 696c 6c20 6265  uted ROI will be
-00049010: 2072 6574 7572 6e65 642e 2049 6620 466f   returned. If Fo
-00049020: 7263 653d 5472 7565 2c20 7468 6520 0a20  rce=True, the . 
-00049030: 2020 2020 2020 2020 2020 2053 5441 504c             STAPL
-00049040: 4520 524f 4920 7769 6c6c 2062 6520 7265  E ROI will be re
-00049050: 6372 6561 7465 642e 0a0a 2020 2020 2020  created...      
-00049060: 2020 6578 636c 7564 6520 3a20 7374 722c    exclude : str,
-00049070: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00049080: 2020 2020 2020 2020 2020 4966 2073 6574            If set
-00049090: 2074 6f20 6120 7374 7269 6e67 2c20 7468   to a string, th
-000490a0: 6520 6669 7273 7420 524f 4920 696e 2073  e first ROI in s
-000490b0: 656c 662e 726f 6973 2077 6974 6820 7468  elf.rois with th
-000490c0: 6174 206e 616d 6520 7769 6c6c 200a 2020  at name will .  
-000490d0: 2020 2020 2020 2020 2020 6265 2065 7863            be exc
-000490e0: 6c75 6465 6420 6672 6f6d 2074 6865 2063  luded from the c
-000490f0: 6f6d 6269 6e61 7469 6f6e 2e20 5468 6973  ombination. This
-00049100: 206d 6179 2062 6520 7573 6566 756c 2069   may be useful i
-00049110: 6620 636f 6d70 6172 6973 6f6e 200a 2020  f comparison .  
-00049120: 2020 2020 2020 2020 2020 6f66 2061 2073            of a s
-00049130: 696e 676c 6520 524f 4920 7769 7468 2074  ingle ROI with t
-00049140: 6865 2063 6f6e 7365 6e73 7573 206f 6620  he consensus of 
-00049150: 616c 6c20 6f74 6865 7273 2069 7320 6465  all others is de
-00049160: 7369 7265 642e 0a0a 2020 2020 2020 2020  sired...        
-00049170: 602a 2a60 6b77 6172 6773 203a 0a20 2020  `**`kwargs :.   
-00049180: 2020 2020 2020 2020 2045 7874 7261 206b           Extra k
-00049190: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-000491a0: 2074 6f20 7061 7373 2074 6f20 7468 6520   to pass to the 
-000491b0: 6372 6561 7469 6f6e 206f 6620 7468 6520  creation of the 
-000491c0: 524f 4920 6f62 6a65 6374 0a20 2020 2020  ROI object.     
-000491d0: 2020 2020 2020 2072 6570 7265 7365 6e74         represent
-000491e0: 696e 6720 7468 6520 636f 6d62 696e 6174  ing the combinat
-000491f0: 696f 6e2e 0a20 2020 2020 2020 2022 2222  ion..        """
-00049200: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00049210: 2073 656c 662e 5f67 6574 5f63 6f6d 6269   self._get_combi
-00049220: 6e61 7469 6f6e 2822 7374 6170 6c65 222c  nation("staple",
-00049230: 2066 6f72 6365 2c20 6578 636c 7564 652c   force, exclude,
-00049240: 2063 7265 6174 655f 7374 6170 6c65 2c0a   create_staple,.
-00049250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049270: 2020 2020 202a 2a6b 7761 7267 7329 0a0a       **kwargs)..
-00049280: 2020 2020 6465 6620 6765 745f 6d61 6a6f      def get_majo
-00049290: 7269 7479 5f76 6f74 6528 7365 6c66 2c20  rity_vote(self, 
-000492a0: 666f 7263 653d 4661 6c73 652c 2065 7863  force=False, exc
-000492b0: 6c75 6465 3d4e 6f6e 652c 202a 2a6b 7761  lude=None, **kwa
-000492c0: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-000492d0: 2247 6574 2052 4f49 206f 626a 6563 7420  "Get ROI object 
-000492e0: 7265 7072 6573 656e 7469 6e67 2074 6865  representing the
-000492f0: 206d 616a 6f72 6974 7920 766f 7465 2063   majority vote c
-00049300: 6f6d 6269 6e61 7469 6f6e 206f 6620 524f  ombination of RO
-00049310: 4973 2069 6e20 0a20 2020 2020 2020 2074  Is in .        t
-00049320: 6869 7320 7374 7275 6374 7572 6520 7365  his structure se
-00049330: 742e 2049 6620 3c65 7863 6c75 6465 3e20  t. If <exclude> 
-00049340: 6973 2073 6574 2074 6f20 6120 7374 7269  is set to a stri
-00049350: 6e67 2c20 7468 6520 524f 4920 7769 7468  ng, the ROI with
-00049360: 2074 6861 7420 0a20 2020 2020 2020 206e   that .        n
-00049370: 616d 6520 7769 6c6c 2062 6520 6578 636c  ame will be excl
-00049380: 7564 6564 2066 726f 6d20 7468 6520 6361  uded from the ca
-00049390: 6c63 756c 6174 696f 6e2e 0a0a 2020 2020  lculation...    
-000493a0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-000493b0: 3a2a 2a0a 0a20 2020 2020 2020 2066 6f72  :**..        for
-000493c0: 6365 203a 2062 6f6f 6c2c 2064 6566 6175  ce : bool, defau
-000493d0: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-000493e0: 2020 2020 2049 6620 4661 6c73 6520 616e       If False an
-000493f0: 6420 6d61 6a6f 7269 7479 2076 6f74 6520  d majority vote 
-00049400: 524f 4920 6861 7320 616c 7265 6164 7920  ROI has already 
-00049410: 6265 656e 2063 7265 6174 6564 2c20 7468  been created, th
-00049420: 6520 0a20 2020 2020 2020 2020 2020 2070  e .            p
-00049430: 7265 7669 6f75 736c 7920 636f 6d70 7574  reviously comput
-00049440: 6564 2052 4f49 2077 696c 6c20 6265 2072  ed ROI will be r
-00049450: 6574 7572 6e65 642e 2049 6620 466f 7263  eturned. If Forc
-00049460: 653d 5472 7565 2c20 7468 6520 0a20 2020  e=True, the .   
-00049470: 2020 2020 2020 2020 206d 616a 6f72 6974           majorit
-00049480: 7920 766f 7465 2052 4f49 2077 696c 6c20  y vote ROI will 
-00049490: 6265 2072 6563 7265 6174 6564 2e0a 0a20  be recreated... 
-000494a0: 2020 2020 2020 2065 7863 6c75 6465 203a         exclude :
-000494b0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-000494c0: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
-000494d0: 6620 7365 7420 746f 2061 2073 7472 696e  f set to a strin
-000494e0: 672c 2074 6865 2066 6972 7374 2052 4f49  g, the first ROI
-000494f0: 2069 6e20 7365 6c66 2e72 6f69 7320 7769   in self.rois wi
-00049500: 7468 2074 6861 7420 6e61 6d65 2077 696c  th that name wil
-00049510: 6c20 0a20 2020 2020 2020 2020 2020 2062  l .            b
-00049520: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
-00049530: 7468 6520 636f 6d62 696e 6174 696f 6e2e  the combination.
-00049540: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
-00049550: 6675 6c20 6966 2063 6f6d 7061 7269 736f  ful if compariso
-00049560: 6e20 0a20 2020 2020 2020 2020 2020 206f  n .            o
-00049570: 6620 6120 7369 6e67 6c65 2052 4f49 2077  f a single ROI w
-00049580: 6974 6820 7468 6520 636f 6e73 656e 7375  ith the consensu
-00049590: 7320 6f66 2061 6c6c 206f 7468 6572 7320  s of all others 
-000495a0: 6973 2064 6573 6972 6564 2e0a 0a20 2020  is desired...   
-000495b0: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
-000495c0: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
-000495d0: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
-000495e0: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
-000495f0: 2074 6865 2063 7265 6174 696f 6e20 6f66   the creation of
-00049600: 2074 6865 2052 4f49 206f 626a 6563 740a   the ROI object.
-00049610: 2020 2020 2020 2020 2020 2020 7265 7072              repr
-00049620: 6573 656e 7469 6e67 2074 6865 2063 6f6d  esenting the com
-00049630: 6269 6e61 7469 6f6e 2e0a 2020 2020 2020  bination..      
-00049640: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
-00049650: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
-00049660: 636f 6d62 696e 6174 696f 6e28 226d 616a  combination("maj
-00049670: 6f72 6974 795f 766f 7465 222c 2066 6f72  ority_vote", for
-00049680: 6365 2c20 6578 636c 7564 652c 200a 2020  ce, exclude, .  
-00049690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000496a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000496b0: 2020 2063 7265 6174 655f 6d61 6a6f 7269     create_majori
-000496c0: 7479 5f76 6f74 652c 202a 2a6b 7761 7267  ty_vote, **kwarg
-000496d0: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
-000496e0: 7375 6d28 7365 6c66 2c20 666f 7263 653d  sum(self, force=
-000496f0: 4661 6c73 652c 2065 7863 6c75 6465 3d4e  False, exclude=N
-00049700: 6f6e 652c 202a 2a6b 7761 7267 7329 3a0a  one, **kwargs):.
-00049710: 2020 2020 2020 2020 2222 2247 6574 2052          """Get R
-00049720: 4f49 206f 626a 6563 7420 7265 7072 6573  OI object repres
-00049730: 656e 7469 6e67 2074 6865 2073 756d 206f  enting the sum o
-00049740: 6620 524f 4973 2069 6e20 7468 6973 2073  f ROIs in this s
-00049750: 7472 7563 7475 7265 2073 6574 2e20 0a20  tructure set. . 
-00049760: 2020 2020 2020 2049 6620 3c65 7863 6c75         If <exclu
-00049770: 6465 3e20 6973 2073 6574 2074 6f20 6120  de> is set to a 
-00049780: 7374 7269 6e67 2c20 7468 6520 524f 4920  string, the ROI 
-00049790: 7769 7468 2074 6861 7420 6e61 6d65 2077  with that name w
-000497a0: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
-000497b0: 6578 636c 7564 6564 2066 726f 6d20 7468  excluded from th
-000497c0: 6520 6361 6c63 756c 6174 696f 6e2e 0a0a  e calculation...
-000497d0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-000497e0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
-000497f0: 2066 6f72 6365 203a 2062 6f6f 6c2c 2064   force : bool, d
-00049800: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-00049810: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
-00049820: 6520 616e 6420 7375 6d20 524f 4920 6861  e and sum ROI ha
-00049830: 7320 616c 7265 6164 7920 6265 656e 2063  s already been c
-00049840: 7265 6174 6564 2c20 7468 6520 0a20 2020  reated, the .   
-00049850: 2020 2020 2020 2020 2070 7265 7669 6f75           previou
-00049860: 736c 7920 636f 6d70 7574 6564 2052 4f49  sly computed ROI
-00049870: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
-00049880: 642e 2049 6620 466f 7263 653d 5472 7565  d. If Force=True
-00049890: 2c20 7468 6520 0a20 2020 2020 2020 2020  , the .         
-000498a0: 2020 2073 756d 2052 4f49 2077 696c 6c20     sum ROI will 
-000498b0: 6265 2072 6563 7265 6174 6564 2e0a 0a20  be recreated... 
-000498c0: 2020 2020 2020 2065 7863 6c75 6465 203a         exclude :
-000498d0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-000498e0: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
-000498f0: 6620 7365 7420 746f 2061 2073 7472 696e  f set to a strin
-00049900: 672c 2074 6865 2066 6972 7374 2052 4f49  g, the first ROI
-00049910: 2069 6e20 7365 6c66 2e72 6f69 7320 7769   in self.rois wi
-00049920: 7468 2074 6861 7420 6e61 6d65 2077 696c  th that name wil
-00049930: 6c20 0a20 2020 2020 2020 2020 2020 2062  l .            b
-00049940: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
-00049950: 7468 6520 636f 6d62 696e 6174 696f 6e2e  the combination.
-00049960: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
-00049970: 6675 6c20 6966 2063 6f6d 7061 7269 736f  ful if compariso
-00049980: 6e20 0a20 2020 2020 2020 2020 2020 206f  n .            o
-00049990: 6620 6120 7369 6e67 6c65 2052 4f49 2077  f a single ROI w
-000499a0: 6974 6820 7468 6520 636f 6e73 656e 7375  ith the consensu
-000499b0: 7320 6f66 2061 6c6c 206f 7468 6572 7320  s of all others 
-000499c0: 6973 2064 6573 6972 6564 2e0a 0a20 2020  is desired...   
-000499d0: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
-000499e0: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
-000499f0: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
-00049a00: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
-00049a10: 2074 6865 2063 7265 6174 696f 6e20 6f66   the creation of
-00049a20: 2074 6865 2052 4f49 206f 626a 6563 740a   the ROI object.
-00049a30: 2020 2020 2020 2020 2020 2020 7265 7072              repr
-00049a40: 6573 656e 7469 6e67 2074 6865 2063 6f6d  esenting the com
-00049a50: 6269 6e61 7469 6f6e 2e0a 2020 2020 2020  bination..      
-00049a60: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
-00049a70: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
-00049a80: 636f 6d62 696e 6174 696f 6e28 2273 756d  combination("sum
-00049a90: 222c 2066 6f72 6365 2c20 6578 636c 7564  ", force, exclud
-00049aa0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00049ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ac0: 2020 2020 2020 2020 2063 7265 6174 655f           create_
-00049ad0: 726f 695f 7375 6d2c 202a 2a6b 7761 7267  roi_sum, **kwarg
-00049ae0: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
-00049af0: 6f76 6572 6c61 7028 7365 6c66 2c20 666f  overlap(self, fo
-00049b00: 7263 653d 4661 6c73 652c 2065 7863 6c75  rce=False, exclu
-00049b10: 6465 3d4e 6f6e 652c 202a 2a6b 7761 7267  de=None, **kwarg
-00049b20: 7329 3a0a 2020 2020 2020 2020 2222 2247  s):.        """G
-00049b30: 6574 2052 4f49 206f 626a 6563 7420 7265  et ROI object re
-00049b40: 7072 6573 656e 7469 6e67 2074 6865 206f  presenting the o
-00049b50: 7665 726c 6170 206f 6620 524f 4973 2069  verlap of ROIs i
-00049b60: 6e20 7468 6973 200a 2020 2020 2020 2020  n this .        
-00049b70: 7374 7275 6374 7572 6520 7365 742e 2049  structure set. I
-00049b80: 6620 3c65 7863 6c75 6465 3e20 6973 2073  f <exclude> is s
-00049b90: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
-00049ba0: 7468 6520 524f 4920 7769 7468 2074 6861  the ROI with tha
-00049bb0: 7420 6e61 6d65 200a 2020 2020 2020 2020  t name .        
-00049bc0: 7769 6c6c 2062 6520 6578 636c 7564 6564  will be excluded
-00049bd0: 2066 726f 6d20 7468 6520 6361 6c63 756c   from the calcul
-00049be0: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00049bf0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-00049c00: 0a20 2020 2020 2020 2066 6f72 6365 203a  .        force :
-00049c10: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-00049c20: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00049c30: 2049 6620 4661 6c73 6520 616e 6420 6f76   If False and ov
-00049c40: 6572 6c61 7020 524f 4920 6861 7320 616c  erlap ROI has al
-00049c50: 7265 6164 7920 6265 656e 2063 7265 6174  ready been creat
-00049c60: 6564 2c20 7468 6520 0a20 2020 2020 2020  ed, the .       
-00049c70: 2020 2020 2070 7265 7669 6f75 736c 7920       previously 
-00049c80: 636f 6d70 7574 6564 2052 4f49 2077 696c  computed ROI wil
-00049c90: 6c20 6265 2072 6574 7572 6e65 642e 2049  l be returned. I
-00049ca0: 6620 466f 7263 653d 5472 7565 2c20 7468  f Force=True, th
-00049cb0: 6520 0a20 2020 2020 2020 2020 2020 206f  e .            o
-00049cc0: 7665 726c 6170 2052 4f49 2077 696c 6c20  verlap ROI will 
-00049cd0: 6265 2072 6563 7265 6174 6564 2e0a 0a20  be recreated... 
-00049ce0: 2020 2020 2020 2065 7863 6c75 6465 203a         exclude :
-00049cf0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-00049d00: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
-00049d10: 6620 7365 7420 746f 2061 2073 7472 696e  f set to a strin
-00049d20: 672c 2074 6865 2066 6972 7374 2052 4f49  g, the first ROI
-00049d30: 2069 6e20 7365 6c66 2e72 6f69 7320 7769   in self.rois wi
-00049d40: 7468 2074 6861 7420 6e61 6d65 2077 696c  th that name wil
-00049d50: 6c20 0a20 2020 2020 2020 2020 2020 2062  l .            b
-00049d60: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
-00049d70: 7468 6520 636f 6d62 696e 6174 696f 6e2e  the combination.
-00049d80: 2054 6869 7320 6d61 7920 6265 2075 7365   This may be use
-00049d90: 6675 6c20 6966 2063 6f6d 7061 7269 736f  ful if compariso
-00049da0: 6e20 0a20 2020 2020 2020 2020 2020 206f  n .            o
-00049db0: 6620 6120 7369 6e67 6c65 2052 4f49 2077  f a single ROI w
-00049dc0: 6974 6820 7468 6520 636f 6e73 656e 7375  ith the consensu
-00049dd0: 7320 6f66 2061 6c6c 206f 7468 6572 7320  s of all others 
-00049de0: 6973 2064 6573 6972 6564 2e0a 0a20 2020  is desired...   
-00049df0: 2020 2020 2060 2a2a 606b 7761 7267 7320       `**`kwargs 
-00049e00: 3a0a 2020 2020 2020 2020 2020 2020 4578  :.            Ex
-00049e10: 7472 6120 6b65 7977 6f72 6420 6172 6775  tra keyword argu
-00049e20: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
-00049e30: 2074 6865 2063 7265 6174 696f 6e20 6f66   the creation of
-00049e40: 2074 6865 2052 4f49 206f 626a 6563 740a   the ROI object.
-00049e50: 2020 2020 2020 2020 2020 2020 7265 7072              repr
-00049e60: 6573 656e 7469 6e67 2074 6865 2063 6f6d  esenting the com
-00049e70: 6269 6e61 7469 6f6e 2e0a 2020 2020 2020  bination..      
-00049e80: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
-00049e90: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
-00049ea0: 636f 6d62 696e 6174 696f 6e28 226f 7665  combination("ove
-00049eb0: 726c 6170 222c 2066 6f72 6365 2c20 6578  rlap", force, ex
-00049ec0: 636c 7564 652c 200a 2020 2020 2020 2020  clude, .        
-00049ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ee0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-00049ef0: 6174 655f 726f 695f 6f76 6572 6c61 702c  ate_roi_overlap,
-00049f00: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00049f10: 6465 6620 7472 616e 7366 6f72 6d28 7365  def transform(se
-00049f20: 6c66 2c20 7363 616c 653d 312c 2074 7261  lf, scale=1, tra
-00049f30: 6e73 6c61 7469 6f6e 3d5b 302c 2030 2c20  nslation=[0, 0, 
-00049f40: 305d 2c20 726f 7461 7469 6f6e 3d5b 302c  0], rotation=[0,
-00049f50: 2030 2c20 305d 2c0a 2020 2020 2020 2020   0, 0],.        
-00049f60: 2020 2020 6365 6e74 7265 3d5b 302c 2030      centre=[0, 0
-00049f70: 2c20 305d 2c20 7265 7361 6d70 6c65 3d22  , 0], resample="
-00049f80: 6669 6e65 222c 2072 6573 746f 7265 3d54  fine", restore=T
-00049f90: 7275 652c 200a 2020 2020 2020 2020 2020  rue, .          
-00049fa0: 2020 6669 6c6c 5f76 616c 7565 3d4e 6f6e    fill_value=Non
-00049fb0: 652c 2066 6f72 6365 5f63 6f6e 746f 7572  e, force_contour
-00049fc0: 733d 4661 6c73 652c 206e 616d 6573 3d4e  s=False, names=N
-00049fd0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00049fe0: 220a 2020 2020 2020 2020 4170 706c 7920  ".        Apply 
-00049ff0: 7468 7265 652d 6469 6d65 6e73 696f 6e61  three-dimensiona
-0004a000: 6c20 7369 6d69 6c61 7269 7479 2074 7261  l similarity tra
-0004a010: 6e73 666f 726d 2074 6f20 7374 7275 6374  nsform to struct
-0004a020: 7572 652d 7365 7420 524f 4973 2e0a 0a20  ure-set ROIs... 
-0004a030: 2020 2020 2020 2049 6620 7468 6520 7472         If the tr
-0004a040: 616e 7366 6f72 6d20 636f 7272 6573 706f  ansform correspo
-0004a050: 6e64 7320 746f 2061 2074 7261 6e73 6c61  nds to a transla
-0004a060: 7469 6f6e 2061 6e64 2f6f 7220 726f 7461  tion and/or rota
-0004a070: 7469 6f6e 0a20 2020 2020 2020 2061 626f  tion.        abo
-0004a080: 7574 2074 6865 207a 2d61 7869 732c 2061  ut the z-axis, a
-0004a090: 6e64 2065 6974 6865 7220 7468 6520 726f  nd either the ro
-0004a0a0: 6920 736f 7572 6365 2074 7970 6520 6973  i source type is
-0004a0b0: 2022 6469 636f 6d22 0a20 2020 2020 2020   "dicom".       
-0004a0c0: 206f 7220 666f 7263 652d 636f 6e74 6f75   or force-contou
-0004a0d0: 7273 2069 7320 5472 7565 2c20 7468 6520  rs is True, the 
-0004a0e0: 7472 616e 7366 6f72 6d20 6973 2061 7070  transform is app
-0004a0f0: 6c69 6564 2074 6f20 636f 6e74 6f75 720a  lied to contour.
-0004a100: 2020 2020 2020 2020 706f 696e 7473 2061          points a
-0004a110: 6e64 2074 6865 2072 6f69 206d 6173 6b20  nd the roi mask 
-0004a120: 6973 2073 6574 2061 7320 756e 6c6f 6164  is set as unload
-0004a130: 6564 2e20 204f 7468 6572 7769 7365 2074  ed.  Otherwise t
-0004a140: 6865 2074 7261 6e73 666f 726d 0a20 2020  he transform.   
-0004a150: 2020 2020 2069 7320 6170 706c 6965 6420       is applied 
-0004a160: 746f 2074 6865 206d 6173 6b20 616e 6420  to the mask and 
-0004a170: 636f 6e74 6f75 7273 2061 7265 2073 6574  contours are set
-0004a180: 2061 7320 756e 6c6f 6164 6564 2e0a 0a20   as unloaded... 
-0004a190: 2020 2020 2020 2054 6865 2074 7261 6e73         The trans
-0004a1a0: 666f 726d 2069 7320 6170 706c 6965 6420  form is applied 
-0004a1b0: 696e 2074 6865 206f 7264 6572 3a20 7472  in the order: tr
-0004a1c0: 616e 736c 6174 696f 6e2c 2073 6361 6c69  anslation, scali
-0004a1d0: 6e67 2c0a 2020 2020 2020 2020 726f 7461  ng,.        rota
-0004a1e0: 7469 6f6e 2e20 2054 6865 206c 6174 7465  tion.  The latte
-0004a1f0: 7220 7477 6f20 6172 6520 6162 6f75 7420  r two are about 
-0004a200: 7468 6520 6365 6e74 7265 2063 6f6f 7264  the centre coord
-0004a210: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
-0004a220: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0004a230: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0004a240: 2020 666f 7263 655f 636f 6e74 6f75 7273    force_contours
-0004a250: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-0004a260: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-0004a270: 2020 2049 6620 5472 7565 2c20 616e 6420     If True, and 
-0004a280: 7468 6520 7472 616e 7366 6f72 6d20 636f  the transform co
-0004a290: 7272 6573 706f 6e64 7320 746f 2061 2074  rresponds to a t
-0004a2a0: 7261 6e73 6c61 7469 6f6e 0a20 2020 2020  ranslation.     
-0004a2b0: 2020 2020 2020 2061 6e64 2f6f 7220 726f         and/or ro
-0004a2c0: 7461 7469 6f6e 2061 626f 7574 2074 6865  tation about the
-0004a2d0: 207a 2d61 7869 732c 2061 7070 6c79 2074   z-axis, apply t
-0004a2e0: 7261 6e73 666f 726d 2074 6f20 636f 6e74  ransform to cont
-0004a2f0: 6f75 720a 2020 2020 2020 2020 2020 2020  our.            
-0004a300: 706f 696e 7473 2069 6e64 6570 656e 6465  points independe
-0004a310: 6e74 6c79 206f 6620 7468 6520 6f72 6967  ntly of the orig
-0004a320: 696e 616c 2064 6174 6120 736f 7572 6365  inal data source
-0004a330: 2e0a 0a20 2020 2020 2020 206e 616d 6573  ...        names
-0004a340: 203a 206c 6973 742f 4e6f 6e65 2c20 6465   : list/None, de
-0004a350: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-0004a360: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-0004a370: 524f 4973 2074 6f20 7768 6963 6820 7472  ROIs to which tr
-0004a380: 616e 7366 6f72 6d20 6973 2074 6f20 6265  ansform is to be
-0004a390: 2061 7070 6c69 6564 2e20 2049 6620 4e6f   applied.  If No
-0004a3a0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0004a3b0: 7472 616e 7366 6f72 6d20 6973 2061 7070  transform is app
-0004a3c0: 6c69 6564 2074 6f20 616c 6c20 524f 4973  lied to all ROIs
-0004a3d0: 2e0a 0a20 2020 2020 2020 2046 6f72 206f  ...        For o
-0004a3e0: 7468 6572 2070 6172 616d 6574 6572 732c  ther parameters,
-0004a3f0: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
-0004a400: 6f6e 2066 6f72 0a20 2020 2020 2020 2073  on for.        s
-0004a410: 6b72 742e 696d 6167 652e 496d 6167 652e  krt.image.Image.
-0004a420: 7472 616e 7366 6f72 6d28 292e 2020 4e6f  transform().  No
-0004a430: 7465 2074 6861 7420 7468 6520 6060 6f72  te that the ``or
-0004a440: 6465 7260 600a 2020 2020 2020 2020 7061  der``.        pa
-0004a450: 7261 6d65 7465 7220 6973 6e27 7420 6176  rameter isn't av
-0004a460: 6169 6c61 626c 6520 666f 7220 7374 7275  ailable for stru
-0004a470: 6374 7572 652d 7365 7420 7472 616e 7366  cture-set transf
-0004a480: 6f72 6d73 202d 2061 2076 616c 7565 206f  orms - a value o
-0004a490: 6620 300a 2020 2020 2020 2020 6973 2075  f 0.        is u
-0004a4a0: 7365 6420 616c 7761 7973 2e0a 2020 2020  sed always..    
-0004a4b0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0004a4c0: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
-0004a4d0: 2e67 6574 5f72 6f69 7328 6e61 6d65 7329  .get_rois(names)
-0004a4e0: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
-0004a4f0: 692e 7472 616e 7366 6f72 6d28 7363 616c  i.transform(scal
-0004a500: 652c 2074 7261 6e73 6c61 7469 6f6e 2c20  e, translation, 
-0004a510: 726f 7461 7469 6f6e 2c20 6365 6e74 7265  rotation, centre
-0004a520: 2c20 7265 7361 6d70 6c65 2c0a 2020 2020  , resample,.    
-0004a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a540: 7265 7374 6f72 652c 2066 696c 6c5f 7661  restore, fill_va
-0004a550: 6c75 652c 2066 6f72 6365 5f63 6f6e 746f  lue, force_conto
-0004a560: 7572 7329 0a0a 2020 2020 2020 2020 7265  urs)..        re
-0004a570: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
-0004a580: 6566 2061 6464 5f70 6c61 6e28 7365 6c66  ef add_plan(self
-0004a590: 2c20 706c 616e 293a 0a20 2020 2020 2020  , plan):.       
-0004a5a0: 2022 2222 4164 6420 6120 506c 616e 206f   """Add a Plan o
-0004a5b0: 626a 6563 7420 746f 2062 6520 6173 736f  bject to be asso
-0004a5c0: 6369 6174 6564 2077 6974 6820 7468 6973  ciated with this
-0004a5d0: 2073 7472 7563 7475 7265 2073 6574 2061   structure set a
-0004a5e0: 6e64 0a20 2020 2020 2020 2069 7473 2052  nd.        its R
-0004a5f0: 4f49 732e 2054 6869 7320 646f 6573 206e  OIs. This does n
-0004a600: 6f74 2061 6666 6563 7420 7468 6520 7374  ot affect the st
-0004a610: 7275 6374 7572 6520 7365 7420 6173 736f  ructure set asso
-0004a620: 6369 6174 6564 2077 6974 680a 2020 2020  ciated with.    
-0004a630: 2020 2020 7468 6520 506c 616e 206f 626a      the Plan obj
-0004a640: 6563 742e 0a0a 2020 2020 2020 2020 2a2a  ect...        **
-0004a650: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-0004a660: 2020 2020 2020 2070 6c61 6e20 3a20 736b         plan : sk
-0004a670: 7274 2e64 6f73 652e 506c 616e 0a20 2020  rt.dose.Plan.   
-0004a680: 2020 2020 2020 2020 2041 2050 6c61 6e20           A Plan 
-0004a690: 6f62 6a65 6374 2074 6f20 6173 7369 676e  object to assign
-0004a6a0: 2074 6f20 7468 6973 2073 7472 7563 7475   to this structu
-0004a6b0: 7265 2073 6574 2e0a 2020 2020 2020 2020  re set..        
-0004a6c0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-0004a6d0: 6e6f 7420 706c 616e 2069 6e20 7365 6c66  not plan in self
-0004a6e0: 2e70 6c61 6e73 3a0a 2020 2020 2020 2020  .plans:.        
-0004a6f0: 2020 2020 7365 6c66 2e70 6c61 6e73 2e61      self.plans.a
-0004a700: 7070 656e 6428 706c 616e 290a 2020 2020  ppend(plan).    
-0004a710: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
-0004a720: 6e73 2e73 6f72 7428 290a 0a20 2020 2020  ns.sort()..     
-0004a730: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
-0004a740: 6e20 7365 6c66 2e72 6f69 733a 0a20 2020  n self.rois:.   
-0004a750: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-0004a760: 2e61 6464 5f70 6c61 6e28 706c 616e 290a  .add_plan(plan).
-0004a770: 0a20 2020 2064 6566 2063 6c65 6172 5f70  .    def clear_p
-0004a780: 6c61 6e73 2873 656c 6629 3a0a 2020 2020  lans(self):.    
-0004a790: 2020 2020 2222 2243 6c65 6172 2061 6c6c      """Clear all
-0004a7a0: 2070 6c61 6e20 6d61 7073 2061 7373 6f63   plan maps assoc
-0004a7b0: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
-0004a7c0: 7374 7275 6374 7572 6520 7365 742e 2222  structure set.""
-0004a7d0: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-0004a7e0: 706c 616e 7320 3d20 5b5d 0a0a 2020 2020  plans = []..    
-0004a7f0: 6465 6620 6765 745f 706c 616e 7328 7365  def get_plans(se
-0004a800: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0004a810: 5265 7475 726e 206c 6973 7420 6f66 2050  Return list of P
-0004a820: 6c61 6e20 6f62 6a65 6374 7320 6173 736f  lan objects asso
-0004a830: 6369 6174 6564 2077 6974 6820 7468 6973  ciated with this
-0004a840: 2073 7472 7563 7475 7265 2073 6574 2e22   structure set."
-0004a850: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-0004a860: 726e 2073 656c 662e 706c 616e 730a 0a20  rn self.plans.. 
-0004a870: 2020 2064 6566 2069 6e74 6572 706f 6c61     def interpola
-0004a880: 7465 5f70 6f69 6e74 7328 7365 6c66 2c20  te_points(self, 
-0004a890: 6e5f 706f 696e 743d 4e6f 6e65 2c20 6478  n_point=None, dx
-0004a8a0: 793d 4e6f 6e65 2c0a 2020 2020 2020 2020  y=None,.        
-0004a8b0: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
-0004a8c0: 6f69 6e74 3d30 293a 0a20 2020 2020 2020  oint=0):.       
-0004a8d0: 2027 2727 0a20 2020 2020 2020 2052 6574   '''.        Ret
-0004a8e0: 7572 6e20 6e65 7720 5374 7275 6374 7572  urn new Structur
-0004a8f0: 6553 6574 206f 626a 6563 742c 2077 6974  eSet object, wit
-0004a900: 6820 696e 7465 7270 6f6c 6174 6564 2063  h interpolated c
-0004a910: 6f6e 746f 7572 2070 6f69 6e74 732e 0a0a  ontour points...
-0004a920: 2020 2020 2020 2020 506f 696e 7473 2061          Points a
-0004a930: 7265 2069 6e74 6572 706f 6c61 7465 6420  re interpolated 
-0004a940: 666f 7220 6561 6368 2063 6f6e 746f 7572  for each contour
-0004a950: 206f 6620 6561 6368 2052 4f49 2e0a 0a20   of each ROI... 
-0004a960: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-0004a970: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
-0004a980: 6e5f 706f 696e 7420 3a20 696e 742c 2064  n_point : int, d
-0004a990: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0004a9a0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-0004a9b0: 6620 706f 696e 7473 2070 6572 2063 6f6e  f points per con
-0004a9c0: 746f 7572 2c20 6166 7465 7220 696e 7465  tour, after inte
-0004a9d0: 7270 6f6c 6174 696f 6e2e 2020 5468 6973  rpolation.  This
-0004a9e0: 206d 7573 740a 2020 2020 2020 2020 2020   must.          
-0004a9f0: 2020 6265 2073 6574 2074 6f20 4e6f 6e65    be set to None
-0004aa00: 2066 6f72 2064 7879 2074 6f20 6265 2063   for dxy to be c
-0004aa10: 6f6e 7369 6465 7265 642e 0a0a 2020 2020  onsidered...    
-0004aa20: 2020 2020 6478 7920 3a20 666c 6f61 742c      dxy : float,
-0004aa30: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0004aa40: 2020 2020 2020 2020 2020 4170 7072 6f78            Approx
-0004aa50: 696d 6174 6520 6469 7374 616e 6365 2072  imate distance r
-0004aa60: 6571 7569 7265 6420 6265 7477 6565 6e20  equired between 
-0004aa70: 636f 6e74 6f75 7220 706f 696e 7473 2e20  contour points. 
-0004aa80: 2054 6869 7320 6973 2074 616b 656e 0a20   This is taken. 
-0004aa90: 2020 2020 2020 2020 2020 2069 6e74 6f20             into 
-0004aaa0: 6163 636f 756e 7420 6f6e 6c79 2069 6620  account only if 
-0004aab0: 6e5f 706f 696e 7420 6973 2073 6574 2074  n_point is set t
-0004aac0: 6f20 4e6f 6e65 2e20 2046 6f72 2061 2063  o None.  For a c
-0004aad0: 6f6e 746f 7572 206f 660a 2020 2020 2020  ontour of.      
-0004aae0: 2020 2020 2020 6c65 6e67 7468 2063 6f6e        length con
-0004aaf0: 746f 7572 5f6c 656e 6774 682c 2074 6865  tour_length, the
-0004ab00: 206e 756d 6265 7220 6f66 2063 6f6e 746f   number of conto
-0004ab10: 7572 2070 6f69 6e74 7320 6973 2074 6865  ur points is the
-0004ab20: 6e20 7461 6b65 6e0a 2020 2020 2020 2020  n taken.        
-0004ab30: 2020 2020 746f 2062 6520 6d61 7828 696e      to be max(in
-0004ab40: 7428 636f 6e74 6f75 725f 6c65 6e67 7468  t(contour_length
-0004ab50: 202f 2064 7879 292c 2033 292e 2020 0a0a   / dxy), 3).  ..
-0004ab60: 2020 2020 2020 2020 736d 6f6f 7468 6e65          smoothne
-0004ab70: 7373 5f70 6572 5f70 6f69 6e74 203a 2066  ss_per_point : f
-0004ab80: 6c6f 6174 2c20 6465 6661 756c 743d 300a  loat, default=0.
-0004ab90: 2020 2020 2020 2020 2020 2020 5061 7261              Para
-0004aba0: 6d65 7465 7220 6465 7465 726d 696e 696e  meter determinin
-0004abb0: 6720 7468 6520 736d 6f6f 7468 6e65 7373  g the smoothness
-0004abc0: 206f 6620 7468 6520 422d 7370 6c69 6e65   of the B-spline
-0004abd0: 2063 7572 7665 2075 7365 640a 2020 2020   curve used.    
-0004abe0: 2020 2020 2020 2020 696e 2063 6f6e 746f          in conto
-0004abf0: 7572 2061 7070 726f 7869 6d61 7469 6f6e  ur approximation
-0004ac00: 2066 6f72 2069 6e74 6572 706f 6c61 7469   for interpolati
-0004ac10: 6f6e 2e20 2054 6865 2070 726f 6475 6374  on.  The product
-0004ac20: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-0004ac30: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
-0004ac40: 6f69 6e74 2061 6e64 2074 6865 206e 756d  oint and the num
-0004ac50: 6265 7220 6f66 2063 6f6e 746f 7572 2070  ber of contour p
-0004ac60: 6f69 6e74 7320 2873 7065 6369 6669 6564  oints (specified
-0004ac70: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
-0004ac80: 6563 746c 7920 7669 6120 6e5f 706f 696e  ectly via n_poin
-0004ac90: 742c 206f 7220 696e 6469 7265 6374 6c79  t, or indirectly
-0004aca0: 2076 6961 2064 7879 2920 636f 7272 6573   via dxy) corres
-0004acb0: 706f 6e64 7320 746f 2074 6865 0a20 2020  ponds to the.   
-0004acc0: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
-0004acd0: 6572 2073 206f 6620 7363 6970 792e 696e  er s of scipy.in
-0004ace0: 7465 7270 6f6c 6174 652e 7370 6c70 7265  terpolate.splpre
-0004acf0: 7020 2d20 7365 6520 646f 6375 6d65 6e74  p - see document
-0004ad00: 6174 696f 6e20 6174 3a0a 2020 2020 2020  ation at:.      
-0004ad10: 2020 0a20 2020 2020 2020 2020 2020 2068    .            h
-0004ad20: 7474 7073 3a2f 2f73 6369 7079 2e67 6974  ttps://scipy.git
-0004ad30: 6875 622e 696f 2f64 6576 646f 6373 2f72  hub.io/devdocs/r
-0004ad40: 6566 6572 656e 6365 2f67 656e 6572 6174  eference/generat
-0004ad50: 6564 2f73 6369 7079 2e69 6e74 6572 706f  ed/scipy.interpo
-0004ad60: 6c61 7465 2e73 706c 7072 6570 2e68 746d  late.splprep.htm
-0004ad70: 6c23 7363 6970 792e 696e 7465 7270 6f6c  l#scipy.interpol
-0004ad80: 6174 652e 7370 6c70 7265 700a 0a20 2020  ate.splprep..   
-0004ad90: 2020 2020 2020 2020 2041 2073 6d6f 6f74           A smoot
-0004ada0: 686e 6573 735f 7065 725f 706f 696e 7420  hness_per_point 
-0004adb0: 6f66 2030 2066 6f72 6365 7320 7468 6520  of 0 forces the 
-0004adc0: 422d 7370 6c69 6e65 2074 6f20 7061 7373  B-spline to pass
-0004add0: 2074 6872 6f75 6768 0a20 2020 2020 2020   through.       
-0004ade0: 2020 2020 2061 6c6c 206f 6620 7468 6520       all of the 
-0004adf0: 7072 652d 696e 7465 7270 6f6c 6174 696f  pre-interpolatio
-0004ae00: 6e20 636f 6e74 6f75 7220 706f 696e 7473  n contour points
-0004ae10: 2e0a 2020 2020 2020 2020 2727 270a 0a20  ..        '''.. 
-0004ae20: 2020 2020 2020 2023 2049 6e74 6572 706f         # Interpo
-0004ae30: 6c61 7465 2070 6f69 6e74 7320 666f 7220  late points for 
-0004ae40: 7468 6520 726f 6973 0a20 2020 2020 2020  the rois.       
-0004ae50: 2072 6f69 7320 3d20 5b5d 0a20 2020 2020   rois = [].     
-0004ae60: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
-0004ae70: 6c66 2e67 6574 5f72 6f69 7328 293a 0a20  lf.get_rois():. 
-0004ae80: 2020 2020 2020 2020 2020 2072 6f69 732e             rois.
-0004ae90: 6170 7065 6e64 2872 6f69 2e69 6e74 6572  append(roi.inter
-0004aea0: 706f 6c61 7465 5f70 6f69 6e74 7328 0a20  polate_points(. 
-0004aeb0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0004aec0: 5f70 6f69 6e74 2c20 6478 792c 2073 6d6f  _point, dxy, smo
-0004aed0: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
-0004aee0: 7429 290a 0a20 2020 2020 2020 2023 2043  t))..        # C
-0004aef0: 6c6f 6e65 2073 656c 662c 2074 6865 6e20  lone self, then 
-0004af00: 7265 7365 7420 736f 7572 6365 2061 6e64  reset source and
-0004af10: 2072 6f69 730a 2020 2020 2020 2020 7373   rois.        ss
-0004af20: 203d 2053 7472 7563 7475 7265 5365 7428   = StructureSet(
-0004af30: 7365 6c66 290a 2020 2020 2020 2020 7373  self).        ss
-0004af40: 2e73 6f75 7263 6573 203d 2072 6f69 730a  .sources = rois.
-0004af50: 2020 2020 2020 2020 7373 2e72 6f69 7320          ss.rois 
-0004af60: 3d20 726f 6973 0a0a 2020 2020 2020 2020  = rois..        
-0004af70: 7265 7475 726e 2073 730a 0a20 2020 2064  return ss..    d
-0004af80: 6566 206f 7264 6572 5f72 6f69 7328 7365  ef order_rois(se
-0004af90: 6c66 2c20 6f72 6465 723d 2778 2b27 293a  lf, order='x+'):
-0004afa0: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
-0004afb0: 2020 2020 204f 7264 6572 2052 4f49 7320       Order ROIs 
-0004afc0: 6279 206f 6e65 206f 6620 7468 6569 7220  by one of their 
-0004afd0: 6365 6e74 726f 6964 2063 6f6f 7264 696e  centroid coordin
-0004afe0: 6174 6573 2e0a 0a20 2020 2020 2020 202a  ates...        *
-0004aff0: 2a50 6172 616d 6574 6572 3a2a 2a0a 0a20  *Parameter:**.. 
-0004b000: 2020 2020 2020 206f 7264 6572 203a 2073         order : s
-0004b010: 7472 2c20 6465 6661 756c 743d 2778 2b27  tr, default='x+'
-0004b020: 0a20 2020 2020 2020 2020 2020 2053 7065  .            Spe
-0004b030: 6369 6669 6361 7469 6f6e 206f 6620 7761  cification of wa
-0004b040: 7920 6974 2077 6869 6368 2052 4f49 7320  y it which ROIs 
-0004b050: 6172 6520 746f 2062 6520 6f72 6465 7264  are to be orderd
-0004b060: 3a0a 2020 2020 2020 2020 2020 2020 2d20  :.            - 
-0004b070: 2778 2b27 203a 2069 6e20 6f72 6465 7220  'x+' : in order 
-0004b080: 6f66 2069 6e63 7265 6173 696e 6720 7820  of increasing x 
-0004b090: 7661 6c75 652e 0a20 2020 2020 2020 2020  value..         
-0004b0a0: 2020 202d 2027 782d 2720 3a20 696e 206f     - 'x-' : in o
-0004b0b0: 7264 6572 206f 6620 6465 6372 6561 7369  rder of decreasi
-0004b0c0: 6e67 2078 2076 616c 7565 2e0a 2020 2020  ng x value..    
-0004b0d0: 2020 2020 2020 2020 2d20 2779 2b27 203a          - 'y+' :
-0004b0e0: 2069 6e20 6f72 6465 7220 6f66 2069 6e63   in order of inc
-0004b0f0: 7265 6173 696e 6720 7920 7661 6c75 652e  reasing y value.
-0004b100: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-0004b110: 792d 2720 3a20 696e 206f 7264 6572 206f  y-' : in order o
-0004b120: 6620 6465 6372 6561 7369 6e67 2079 2076  f decreasing y v
-0004b130: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
-0004b140: 2020 2d20 277a 2b27 203a 2069 6e20 6f72    - 'z+' : in or
-0004b150: 6465 7220 6f66 2069 6e63 7265 6173 696e  der of increasin
-0004b160: 6720 7a20 7661 6c75 652e 0a20 2020 2020  g z value..     
-0004b170: 2020 2020 2020 202d 2027 7a2d 2720 3a20         - 'z-' : 
-0004b180: 696e 206f 7264 6572 206f 6620 6465 6372  in order of decr
-0004b190: 6561 7369 6e67 207a 2076 616c 7565 2e0a  easing z value..
-0004b1a0: 2020 2020 2020 2020 2727 270a 0a20 2020          '''..   
-0004b1b0: 2020 2020 2069 6620 6f72 6465 7220 6e6f       if order no
-0004b1c0: 7420 696e 205b 2778 2b27 2c20 2778 2d27  t in ['x+', 'x-'
-0004b1d0: 2c20 2779 2b27 2c20 2779 2d27 2c20 277a  , 'y+', 'y-', 'z
-0004b1e0: 2b27 2c20 277a 2d27 5d3a 0a20 2020 2020  +', 'z-']:.     
-0004b1f0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-0004b200: 2020 2020 2020 2023 2044 6574 6572 6d69         # Determi
-0004b210: 6e65 2061 7869 7320 666f 7220 6f72 6465  ne axis for orde
-0004b220: 7269 6e67 2c20 616e 6420 6469 7265 6374  ring, and direct
-0004b230: 696f 6e2e 0a20 2020 2020 2020 2061 7869  ion..        axi
-0004b240: 7320 3d20 2778 797a 272e 6669 6e64 286f  s = 'xyz'.find(o
-0004b250: 7264 6572 5b30 5d29 0a20 2020 2020 2020  rder[0]).       
-0004b260: 2072 6576 6572 7365 203d 2028 272d 2720   reverse = ('-' 
-0004b270: 696e 206f 7264 6572 290a 0a20 2020 2020  in order)..     
-0004b280: 2020 2023 2043 7265 6174 6520 6469 6374     # Create dict
-0004b290: 696f 6e61 7279 2077 6865 7265 206b 6579  ionary where key
-0004b2a0: 7320 6172 6520 6365 6e74 726f 6964 2063  s are centroid c
-0004b2b0: 6f6f 7264 696e 6174 6573 0a20 2020 2020  oordinates.     
-0004b2c0: 2020 2023 2061 6e64 2076 616c 7565 7320     # and values 
-0004b2d0: 6172 6520 6c69 7374 7320 6f66 2052 4f49  are lists of ROI
-0004b2e0: 2069 6e64 6963 6965 7320 6174 2074 6865   indicies at the
-0004b2f0: 7365 2063 6f6f 7264 696e 6174 6573 2e0a  se coordinates..
-0004b300: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0004b310: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-0004b320: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
-0004b330: 6e28 7365 6c66 2e72 6f69 7329 293a 0a20  n(self.rois)):. 
-0004b340: 2020 2020 2020 2020 2020 2078 797a 203d             xyz =
-0004b350: 2073 656c 662e 726f 6973 5b69 5d2e 6765   self.rois[i].ge
-0004b360: 745f 6365 6e74 726f 6964 2829 5b61 7869  t_centroid()[axi
-0004b370: 735d 0a20 2020 2020 2020 2020 2020 2069  s].            i
-0004b380: 6620 7879 7a20 6e6f 7420 696e 2063 656e  f xyz not in cen
-0004b390: 7472 6f69 6473 3a0a 2020 2020 2020 2020  troids:.        
-0004b3a0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0004b3b0: 735b 7879 7a5d 203d 205b 5d0a 2020 2020  s[xyz] = [].    
-0004b3c0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0004b3d0: 735b 7879 7a5d 2e61 7070 656e 6428 6929  s[xyz].append(i)
-0004b3e0: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
-0004b3f0: 7465 206c 6973 7420 6f66 2052 4f49 7320  te list of ROIs 
-0004b400: 6f72 6465 7265 6420 6279 2063 656e 7472  ordered by centr
-0004b410: 6f69 6420 636f 6f72 6469 6e61 7465 2e0a  oid coordinate..
-0004b420: 2020 2020 2020 2020 726f 6973 203d 205b          rois = [
-0004b430: 5d0a 2020 2020 2020 2020 666f 7220 6365  ].        for ce
-0004b440: 6e74 726f 6964 2069 6e20 736f 7274 6564  ntroid in sorted
-0004b450: 2863 656e 7472 6f69 6473 2c20 7265 7665  (centroids, reve
-0004b460: 7273 653d 7265 7665 7273 6529 3a0a 2020  rse=reverse):.  
-0004b470: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-0004b480: 696e 2063 656e 7472 6f69 6473 5b63 656e  in centroids[cen
-0004b490: 7472 6f69 645d 3a0a 2020 2020 2020 2020  troid]:.        
-0004b4a0: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
-0004b4b0: 656e 6428 7365 6c66 2e72 6f69 735b 695d  end(self.rois[i]
-0004b4c0: 290a 0a20 2020 2020 2020 2023 2053 746f  )..        # Sto
-0004b4d0: 7265 2074 6865 206e 6577 206f 7264 6572  re the new order
-0004b4e0: 206f 6620 524f 4973 2e0a 2020 2020 2020   of ROIs..      
-0004b4f0: 2020 7365 6c66 2e72 6f69 7320 3d20 726f    self.rois = ro
-0004b500: 6973 0a0a 2020 2020 6465 6620 636f 6d62  is..    def comb
-0004b510: 696e 655f 726f 6973 2873 656c 662c 206e  ine_rois(self, n
-0004b520: 616d 653d 4e6f 6e65 2c20 726f 695f 6e61  ame=None, roi_na
-0004b530: 6d65 733d 4e6f 6e65 2c20 696d 6167 653d  mes=None, image=
-0004b540: 4e6f 6e65 2c20 6d65 7468 6f64 3d4e 6f6e  None, method=Non
-0004b550: 6529 3a0a 2020 2020 2020 2020 2727 270a  e):.        '''.
-0004b560: 2020 2020 2020 2020 436f 6d62 696e 6520          Combine 
-0004b570: 7477 6f20 6f72 206d 6f72 6520 524f 4973  two or more ROIs
-0004b580: 2061 7320 6120 7369 6e67 6c65 2052 4f49   as a single ROI
-0004b590: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-0004b5a0: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
-0004b5b0: 2020 2020 6e61 6d65 203a 2073 7472 2c20      name : str, 
-0004b5c0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0004b5d0: 2020 2020 2020 2020 204e 616d 6520 746f           Name to
-0004b5e0: 2062 6520 6769 7665 6e20 746f 2074 6865   be given to the
-0004b5f0: 2063 6f6d 706f 7369 7465 2052 4f49 2e20   composite ROI. 
-0004b600: 2049 6620 4e6f 6e65 2c20 7468 650a 2020   If None, the.  
-0004b610: 2020 2020 2020 2020 2020 6e61 6d65 2061            name a
-0004b620: 7373 6967 6e65 6420 6973 2066 6f72 6d65  ssigned is forme
-0004b630: 6420 6279 206a 6f69 6e69 6e67 2074 6f67  d by joining tog
-0004b640: 6574 6865 7220 7468 6520 6e61 6d65 730a  ether the names.
-0004b650: 2020 2020 2020 2020 2020 2020 6f66 2074              of t
-0004b660: 6865 206f 7269 6769 6e61 6c20 524f 4973  he original ROIs
-0004b670: 2e0a 0a20 2020 2020 2020 2072 6f69 5f6e  ...        roi_n
-0004b680: 616d 6573 203a 206c 6973 742c 2064 6566  ames : list, def
-0004b690: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0004b6a0: 2020 2020 2020 4c69 7374 206f 6620 6e61        List of na
-0004b6b0: 6d65 7320 6f66 2052 4f49 7320 746f 2062  mes of ROIs to b
-0004b6c0: 6520 636f 6d62 696e 6564 2e20 2049 6620  e combined.  If 
-0004b6d0: 4e6f 6e65 2c20 616c 6c20 6f66 2074 6865  None, all of the
-0004b6e0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-0004b6f0: 7563 7475 7265 2073 6574 2773 2052 4f49  ucture set's ROI
-0004b700: 7320 6172 6520 636f 6d62 696e 6564 2e0a  s are combined..
-0004b710: 0a20 2020 2020 2020 2069 6d61 6765 203a  .        image :
-0004b720: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
-0004b730: 652c 2064 6566 6175 6c74 3d4e 6f6e 650a  e, default=None.
-0004b740: 2020 2020 2020 2020 2020 2020 496d 6167              Imag
-0004b750: 6520 746f 2073 6574 2066 6f72 2074 6865  e to set for the
-0004b760: 2063 6f6d 706f 7369 7465 2052 4f49 2e20   composite ROI. 
-0004b770: 2049 6620 4e6f 6e65 2c20 7573 6520 7468   If None, use th
-0004b780: 6520 696d 6167 650a 2020 2020 2020 2020  e image.        
-0004b790: 2020 2020 6f66 2074 6865 2052 4f49 2077      of the ROI w
-0004b7a0: 6974 6820 7468 6520 6669 7273 7420 6e61  ith the first na
-0004b7b0: 6d65 2069 6e20 3c72 6f69 5f6e 616d 6573  me in <roi_names
-0004b7c0: 3e2e 0a0a 2020 2020 2020 2020 6d65 7468  >...        meth
-0004b7d0: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
-0004b7e0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0004b7f0: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
-0004b800: 2066 6f72 2063 6f6d 6269 6e69 6e67 2052   for combining R
-0004b810: 4f49 732e 2020 4361 6e20 6265 3a20 0a0a  OIs.  Can be: ..
-0004b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b830: 2d20 2263 6f6e 746f 7572 223a 2074 616b  - "contour": tak
-0004b840: 6520 756e 6172 7920 756e 696f 6e20 6f66  e unary union of
-0004b850: 2073 6861 7065 6c79 2070 6f6c 7967 6f6e   shapely polygon
-0004b860: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
-0004b870: 2020 202d 2022 6d61 736b 223a 2073 756d     - "mask": sum
-0004b880: 2062 696e 6172 7920 6d61 736b 732e 0a20   binary masks.. 
-0004b890: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-0004b8a0: 2022 6175 746f 223a 2075 7365 2074 6865   "auto": use the
-0004b8b0: 2064 6566 6175 6c74 5f67 656f 6d5f 6d65   default_geom_me
-0004b8c0: 7468 6f64 206f 6620 7468 6520 524f 4920  thod of the ROI 
-0004b8d0: 7769 7468 2074 6865 0a20 2020 2020 2020  with the.       
-0004b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b8f0: 2020 2066 6972 7374 206e 616d 6520 696e     first name in
-0004b900: 203c 726f 695f 6e61 6d65 733e 2e0a 0a20   <roi_names>... 
-0004b910: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
-0004b920: 6e65 2c20 2261 7574 6f22 2069 7320 7573  ne, "auto" is us
-0004b930: 6564 2e0a 2020 2020 2020 2020 2727 270a  ed..        '''.
-0004b940: 0a20 2020 2020 2020 2023 2049 6620 4e6f  .        # If No
-0004b950: 6e65 2076 616c 7565 7320 7061 7373 6564  ne values passed
-0004b960: 2c20 7365 7420 6465 6661 756c 7420 6265  , set default be
-0004b970: 6861 7669 6f75 722e 0a20 2020 2020 2020  haviour..       
-0004b980: 2069 6620 726f 695f 6e61 6d65 7320 6973   if roi_names is
-0004b990: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0004b9a0: 2020 2072 6f69 5f6e 616d 6573 203d 2073     roi_names = s
-0004b9b0: 656c 662e 6765 745f 726f 695f 6e61 6d65  elf.get_roi_name
-0004b9c0: 7328 290a 2020 2020 2020 2020 6966 206e  s().        if n
-0004b9d0: 616d 6520 6973 204e 6f6e 653a 0a20 2020  ame is None:.   
-0004b9e0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-0004b9f0: 272b 272e 6a6f 696e 2872 6f69 5f6e 616d  '+'.join(roi_nam
-0004ba00: 6573 290a 2020 2020 2020 2020 6966 206d  es).        if m
-0004ba10: 6574 686f 6420 696e 205b 4e6f 6e65 2c20  ethod in [None, 
-0004ba20: 2261 7574 6f22 5d3a 0a20 2020 2020 2020  "auto"]:.       
-0004ba30: 2020 2020 206d 6574 686f 6420 3d20 7365       method = se
-0004ba40: 6c66 5b72 6f69 5f6e 616d 6573 5b30 5d5d  lf[roi_names[0]]
-0004ba50: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-0004ba60: 7468 6f64 0a20 2020 2020 2020 2069 6620  thod.        if 
-0004ba70: 696d 6167 6520 6973 204e 6f6e 653a 0a20  image is None:. 
-0004ba80: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0004ba90: 203d 2073 656c 665b 726f 695f 6e61 6d65   = self[roi_name
-0004baa0: 735b 305d 5d2e 696d 6167 650a 0a20 2020  s[0]].image..   
-0004bab0: 2020 2020 2069 6620 2263 6f6e 746f 7572       if "contour
-0004bac0: 2220 3d3d 206d 6574 686f 643a 0a20 2020  " == method:.   
-0004bad0: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
-0004bae0: 6520 6120 6469 6374 696f 6e61 7279 2063  e a dictionary c
-0004baf0: 6f6e 7461 696e 696e 6720 706f 6c79 676f  ontaining polygo
-0004bb00: 6e73 2066 6f72 2061 6c6c 2052 4f49 732e  ns for all ROIs.
-0004bb10: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
-0004bb20: 5f70 6f6c 7967 6f6e 7320 3d20 7b7d 0a20  _polygons = {}. 
-0004bb30: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-0004bb40: 6f69 2069 6e20 7365 6c66 2e67 6574 5f72  oi in self.get_r
-0004bb50: 6f69 7328 726f 695f 6e61 6d65 7329 3a0a  ois(roi_names):.
-0004bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb70: 666f 7220 6b65 792c 2070 6f6c 7967 6f6e  for key, polygon
-0004bb80: 7320 696e 2072 6f69 2e67 6574 5f70 6f6c  s in roi.get_pol
-0004bb90: 7967 6f6e 7328 292e 6974 656d 7328 293a  ygons().items():
-0004bba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bbb0: 2020 2020 2069 6620 6e6f 7420 6b65 7920       if not key 
-0004bbc0: 696e 2061 6c6c 5f70 6f6c 7967 6f6e 733a  in all_polygons:
-0004bbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bbe0: 2020 2020 2020 2020 2061 6c6c 5f70 6f6c           all_pol
-0004bbf0: 7967 6f6e 735b 6b65 795d 203d 205b 5d0a  ygons[key] = [].
-0004bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc10: 2020 2020 616c 6c5f 706f 6c79 676f 6e73      all_polygons
-0004bc20: 5b6b 6579 5d2e 6578 7465 6e64 2870 6f6c  [key].extend(pol
-0004bc30: 7967 6f6e 7329 0a0a 2020 2020 2020 2020  ygons)..        
-0004bc40: 2020 2020 2320 4576 616c 7561 7465 2074      # Evaluate t
-0004bc50: 6865 2075 6e61 7279 2075 6e69 6f6e 206f  he unary union o
-0004bc60: 6620 706f 6c79 676f 6e73 2066 6f72 2065  f polygons for e
-0004bc70: 6163 6820 736c 6963 652e 0a20 2020 2020  ach slice..     
-0004bc80: 2020 2020 2020 2061 6c6c 5f70 6f6c 7967         all_polyg
-0004bc90: 6f6e 7320 3d20 7b6b 6579 3a20 5b6f 7073  ons = {key: [ops
-0004bca0: 2e75 6e61 7279 5f75 6e69 6f6e 2861 6c6c  .unary_union(all
-0004bcb0: 5f70 6f6c 7967 6f6e 735b 6b65 795d 295d  _polygons[key])]
-0004bcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bcd0: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
-0004bce0: 2061 6c6c 5f70 6f6c 7967 6f6e 737d 0a0a   all_polygons}..
-0004bcf0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-0004bd00: 6561 7465 2074 6865 2063 6f6d 706f 7369  eate the composi
-0004bd10: 7465 2052 4f49 2e0a 2020 2020 2020 2020  te ROI..        
-0004bd20: 2020 2020 726f 695f 6e65 7720 3d20 524f      roi_new = RO
-0004bd30: 4928 736f 7572 6365 3d61 6c6c 5f70 6f6c  I(source=all_pol
-0004bd40: 7967 6f6e 732c 2069 6d61 6765 3d69 6d61  ygons, image=ima
-0004bd50: 6765 2c20 6e61 6d65 3d6e 616d 6529 0a0a  ge, name=name)..
-0004bd60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0004bd70: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
-0004bd80: 6461 7461 2066 726f 6d20 6f6e 6520 6f66  data from one of
-0004bd90: 2074 6865 2052 4f49 7320 6173 2061 2073   the ROIs as a s
-0004bda0: 7461 7274 696e 6720 706f 696e 742e 0a20  tarting point.. 
-0004bdb0: 2020 2020 2020 2020 2020 2072 6f69 3020             roi0 
-0004bdc0: 3d20 7365 6c66 2e67 6574 5f72 6f69 2872  = self.get_roi(r
-0004bdd0: 6f69 5f6e 616d 6573 5b30 5d29 0a20 2020  oi_names[0]).   
-0004bde0: 2020 2020 2020 2020 2072 6f69 5f6e 6577           roi_new
-0004bdf0: 203d 2052 4f49 2873 6f75 7263 653d 726f   = ROI(source=ro
-0004be00: 6930 2e67 6574 5f6d 6173 6b28 292e 636f  i0.get_mask().co
-0004be10: 7079 2829 2c20 6166 6669 6e65 3d72 6f69  py(), affine=roi
-0004be20: 302e 6166 6669 6e65 2c0a 2020 2020 2020  0.affine,.      
-0004be30: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0004be40: 6d65 3d6e 616d 652c 2069 6d61 6765 3d69  me=name, image=i
-0004be50: 6d61 6765 290a 0a20 2020 2020 2020 2020  mage)..         
-0004be60: 2020 2023 2043 6f6d 6269 6e65 2077 6974     # Combine wit
-0004be70: 6820 6461 7461 2066 726f 6d20 7468 6520  h data from the 
-0004be80: 6f74 6865 7220 524f 4973 2e0a 2020 2020  other ROIs..    
-0004be90: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0004bea0: 2072 616e 6765 2831 2c20 6c65 6e28 726f   range(1, len(ro
-0004beb0: 695f 6e61 6d65 7329 293a 0a20 2020 2020  i_names)):.     
-0004bec0: 2020 2020 2020 2020 2020 2072 6f69 5f6e             roi_n
-0004bed0: 6577 2e6d 6173 6b2e 6461 7461 207c 3d20  ew.mask.data |= 
-0004bee0: 7365 6c66 2e67 6574 5f72 6f69 2872 6f69  self.get_roi(roi
-0004bef0: 5f6e 616d 6573 5b69 5d29 2e67 6574 5f6d  _names[i]).get_m
-0004bf00: 6173 6b28 290a 0a20 2020 2020 2020 2072  ask()..        r
-0004bf10: 6574 7572 6e20 726f 695f 6e65 770a 0a20  eturn roi_new.. 
-0004bf20: 2020 2064 6566 2067 6574 5f6d 6173 6b5f     def get_mask_
-0004bf30: 696d 6167 6528 7365 6c66 2c20 6e61 6d65  image(self, name
-0004bf40: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0004bf50: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-0004bf60: 696d 6167 6520 6f62 6a65 6374 2072 6570  image object rep
-0004bf70: 7265 7365 6e74 696e 6720 6d61 736b 2066  resenting mask f
-0004bf80: 6f72 2061 6c6c 2052 4f49 7320 6f66 2073  or all ROIs of s
-0004bf90: 7472 7563 7475 7265 2073 6574 2e0a 0a20  tructure set... 
-0004bfa0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-0004bfb0: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
-0004bfc0: 6e61 6d65 203a 2073 7472 2c20 6465 6661  name : str, defa
-0004bfd0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0004bfe0: 2020 2020 204e 616d 6520 746f 2062 6520       Name to be 
-0004bff0: 6769 7665 6e20 746f 2074 6865 206d 6173  given to the mas
-0004c000: 6b20 696d 6167 652e 2020 4966 204e 6f6e  k image.  If Non
-0004c010: 652c 2074 6865 0a20 2020 2020 2020 2020  e, the.         
-0004c020: 2020 206e 616d 6520 6173 7369 676e 6564     name assigned
-0004c030: 2069 7320 7468 6520 6e61 6d65 206f 6620   is the name of 
-0004c040: 7468 6520 7374 7275 6374 7572 6520 7365  the structure se
-0004c050: 742c 2077 6974 6820 7375 6666 6978 0a20  t, with suffix. 
-0004c060: 2020 2020 2020 2020 2020 2022 5f6d 6173             "_mas
-0004c070: 6b22 2061 7070 656e 6465 642e 0a20 2020  k" appended..   
-0004c080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0004c090: 206e 616d 6520 3d20 6e61 6d65 206f 7220   name = name or 
-0004c0a0: 6622 7b73 656c 662e 6e61 6d65 7d5f 6d61  f"{self.name}_ma
-0004c0b0: 736b 220a 2020 2020 2020 2020 726f 695f  sk".        roi_
-0004c0c0: 636f 6d62 696e 6564 203d 2073 656c 662e  combined = self.
-0004c0d0: 636f 6d62 696e 655f 726f 6973 286e 616d  combine_rois(nam
-0004c0e0: 653d 6e61 6d65 290a 2020 2020 2020 2020  e=name).        
-0004c0f0: 6d61 736b 5f69 6d61 6765 203d 2072 6f69  mask_image = roi
-0004c100: 5f63 6f6d 6269 6e65 642e 6765 745f 6d61  _combined.get_ma
-0004c110: 736b 5f69 6d61 6765 2829 0a20 2020 2020  sk_image().     
-0004c120: 2020 2072 6574 7572 6e20 6d61 736b 5f69     return mask_i
-0004c130: 6d61 6765 0a0a 2020 2020 6465 6620 6372  mage..    def cr
-0004c140: 6f70 2873 656c 662c 2078 6c69 6d3d 4e6f  op(self, xlim=No
-0004c150: 6e65 2c20 796c 696d 3d4e 6f6e 652c 207a  ne, ylim=None, z
-0004c160: 6c69 6d3d 4e6f 6e65 293a 0a20 2020 2020  lim=None):.     
-0004c170: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-0004c180: 726f 7020 616c 6c20 524f 4973 206f 6620  rop all ROIs of 
-0004c190: 5374 7275 6374 7572 6553 6574 2074 6f20  StructureSet to 
-0004c1a0: 7370 6563 6966 6965 6420 7261 6e67 6520  specified range 
-0004c1b0: 696e 2078 2c20 792c 207a 2e0a 0a20 2020  in x, y, z...   
-0004c1c0: 2020 2020 2054 6865 2070 6172 616d 6574       The paramet
-0004c1d0: 6572 7320 786c 696d 2c20 796c 696d 2c20  ers xlim, ylim, 
-0004c1e0: 7a6c 696d 2061 7265 2070 6173 7365 6420  zlim are passed 
-0004c1f0: 746f 2065 6163 6820 524f 4927 7320 6372  to each ROI's cr
-0004c200: 6f70 2829 206d 6574 686f 642e 0a20 2020  op() method..   
-0004c210: 2020 2020 2046 6f72 2065 7870 6c61 6e61       For explana
-0004c220: 7469 6f6e 206f 6620 7468 6573 6520 7061  tion of these pa
-0004c230: 7261 6d65 7465 7273 2c20 7365 6520 646f  rameters, see do
-0004c240: 6375 6d65 6e74 6174 696f 6e20 666f 720a  cumentation for.
-0004c250: 2020 2020 2020 2020 736b 7274 2e73 7472          skrt.str
-0004c260: 7563 7475 7265 732e 524f 492e 6372 6f70  uctures.ROI.crop
-0004c270: 2829 2e0a 2020 2020 2020 2020 2222 220a  ()..        """.
-0004c280: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
-0004c290: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
-0004c2a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0004c2b0: 726f 692e 6372 6f70 2878 6c69 6d2c 2079  roi.crop(xlim, y
-0004c2c0: 6c69 6d2c 207a 6c69 6d29 0a0a 636c 6173  lim, zlim)..clas
-0004c2d0: 7320 5374 7275 6374 7572 6553 6574 4974  s StructureSetIt
-0004c2e0: 6572 6174 6f72 3a0a 0a20 2020 2064 6566  erator:..    def
-0004c2f0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0004c300: 7374 7275 6374 7572 655f 7365 7429 3a0a  structure_set):.
-0004c310: 2020 2020 2020 2020 7365 6c66 2e69 6478          self.idx
-0004c320: 203d 202d 310a 2020 2020 2020 2020 7365   = -1.        se
-0004c330: 6c66 2e73 7472 7563 7475 7265 5f73 6574  lf.structure_set
-0004c340: 203d 2073 7472 7563 7475 7265 5f73 6574   = structure_set
-0004c350: 0a0a 2020 2020 6465 6620 5f5f 6e65 7874  ..    def __next
-0004c360: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-0004c370: 2020 7365 6c66 2e69 6478 202b 3d20 310a    self.idx += 1.
-0004c380: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0004c390: 6964 7820 3c20 6c65 6e28 7365 6c66 2e73  idx < len(self.s
-0004c3a0: 7472 7563 7475 7265 5f73 6574 2e67 6574  tructure_set.get
-0004c3b0: 5f72 6f69 7328 2929 3a0a 2020 2020 2020  _rois()):.      
-0004c3c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0004c3d0: 662e 7374 7275 6374 7572 655f 7365 742e  f.structure_set.
-0004c3e0: 6765 745f 726f 6973 2829 5b73 656c 662e  get_rois()[self.
-0004c3f0: 6964 785d 0a20 2020 2020 2020 2072 6169  idx].        rai
-0004c400: 7365 2053 746f 7049 7465 7261 7469 6f6e  se StopIteration
-0004c410: 0a0a 0a64 6566 206c 6f61 645f 726f 6973  ...def load_rois
-0004c420: 5f64 6963 6f6d 2870 6174 682c 206e 616d  _dicom(path, nam
-0004c430: 6573 3d4e 6f6e 6529 3a0a 2020 2020 2222  es=None):.    ""
-0004c440: 224c 6f61 6420 524f 4928 7329 2066 726f  "Load ROI(s) fro
-0004c450: 6d20 6120 6469 636f 6d20 7374 7275 6374  m a dicom struct
-0004c460: 7572 6520 7365 7420 6669 6c65 2e20 3c6e  ure set file. <n
-0004c470: 616d 653e 2063 616e 2062 6520 6120 7369  ame> can be a si
-0004c480: 6e67 6c65 0a20 2020 206e 616d 6520 6f72  ngle.    name or
-0004c490: 206c 6973 7420 6f66 206e 616d 6573 206f   list of names o
-0004c4a0: 6620 524f 4973 2074 6f20 6c6f 6164 2e22  f ROIs to load."
-0004c4b0: 2222 0a0a 2020 2020 2320 4c6f 6164 2064  ""..    # Load d
-0004c4c0: 6963 6f6d 206f 626a 6563 740a 2020 2020  icom object.    
-0004c4d0: 7472 793a 0a20 2020 2020 2020 2064 7320  try:.        ds 
-0004c4e0: 3d20 7079 6469 636f 6d2e 6463 6d72 6561  = pydicom.dcmrea
-0004c4f0: 6428 7061 7468 2c20 666f 7263 653d 5472  d(path, force=Tr
-0004c500: 7565 290a 2020 2020 6578 6365 7074 2070  ue).    except p
-0004c510: 7964 6963 6f6d 2e65 7272 6f72 732e 496e  ydicom.errors.In
-0004c520: 7661 6c69 6444 6963 6f6d 4572 726f 723a  validDicomError:
-0004c530: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0004c540: 5b5d 2c20 4e6f 6e65 0a20 2020 2069 6620  [], None.    if 
-0004c550: 6e6f 7420 6861 7361 7474 7228 6473 2c20  not hasattr(ds, 
-0004c560: 2253 4f50 436c 6173 7355 4944 2229 3a0a  "SOPClassUID"):.
-0004c570: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-0004c580: 5d2c 204e 6f6e 650a 2020 2020 6966 206e  ], None.    if n
-0004c590: 6f74 2028 6473 2e53 4f50 436c 6173 7355  ot (ds.SOPClassU
-0004c5a0: 4944 203d 3d20 2231 2e32 2e38 3430 2e31  ID == "1.2.840.1
-0004c5b0: 3030 3038 2e35 2e31 2e34 2e31 2e31 2e34  0008.5.1.4.1.1.4
-0004c5c0: 3831 2e33 2229 3a0a 2020 2020 2020 2020  81.3"):.        
-0004c5d0: 7072 696e 7428 6622 5761 726e 696e 673a  print(f"Warning:
-0004c5e0: 207b 7061 7468 7d20 6973 206e 6f74 2061   {path} is not a
-0004c5f0: 2044 4943 4f4d 2073 7472 7563 7475 7265   DICOM structure
-0004c600: 2073 6574 2066 696c 6521 2229 0a20 2020   set file!").   
-0004c610: 2020 2020 2072 6574 7572 6e20 5b5d 2c20       return [], 
-0004c620: 4e6f 6e65 0a0a 2020 2020 2320 4765 7420  None..    # Get 
-0004c630: 524f 4920 6e61 6d65 730a 2020 2020 7365  ROI names.    se
-0004c640: 7120 3d20 6765 745f 6469 636f 6d5f 7365  q = get_dicom_se
-0004c650: 7175 656e 6365 2864 732c 2022 5374 7275  quence(ds, "Stru
-0004c660: 6374 7572 6553 6574 524f 4922 290a 2020  ctureSetROI").  
-0004c670: 2020 726f 6973 203d 207b 7d0a 2020 2020    rois = {}.    
-0004c680: 666f 7220 726f 6920 696e 2073 6571 3a0a  for roi in seq:.
-0004c690: 2020 2020 2020 2020 726f 6973 5b69 6e74          rois[int
-0004c6a0: 2872 6f69 2e52 4f49 4e75 6d62 6572 295d  (roi.ROINumber)]
-0004c6b0: 203d 207b 226e 616d 6522 3a20 726f 692e   = {"name": roi.
-0004c6c0: 524f 494e 616d 657d 0a0a 2020 2020 2320  ROIName}..    # 
-0004c6d0: 4669 6e64 2052 4f49 7320 6d61 7463 6869  Find ROIs matchi
-0004c6e0: 6e67 2072 6571 7565 7374 6564 206e 616d  ng requested nam
-0004c6f0: 6573 0a20 2020 206e 616d 6573 5f74 6f5f  es.    names_to_
-0004c700: 6c6f 6164 203d 204e 6f6e 650a 2020 2020  load = None.    
-0004c710: 6966 2069 7369 6e73 7461 6e63 6528 6e61  if isinstance(na
-0004c720: 6d65 732c 2073 7472 293a 0a20 2020 2020  mes, str):.     
-0004c730: 2020 206e 616d 6573 5f74 6f5f 6c6f 6164     names_to_load
-0004c740: 203d 205b 6e61 6d65 735d 0a20 2020 2065   = [names].    e
-0004c750: 6c69 6620 736b 7274 2e63 6f72 652e 6973  lif skrt.core.is
-0004c760: 5f6c 6973 7428 6e61 6d65 7329 3a0a 2020  _list(names):.  
-0004c770: 2020 2020 2020 6e61 6d65 735f 746f 5f6c        names_to_l
-0004c780: 6f61 6420 3d20 6e61 6d65 730a 2020 2020  oad = names.    
-0004c790: 6966 206e 616d 6573 5f74 6f5f 6c6f 6164  if names_to_load
-0004c7a0: 3a0a 2020 2020 2020 2020 726f 6973 203d  :.        rois =
-0004c7b0: 207b 0a20 2020 2020 2020 2020 2020 2069   {.            i
-0004c7c0: 3a20 730a 2020 2020 2020 2020 2020 2020  : s.            
-0004c7d0: 666f 7220 692c 2073 2069 6e20 726f 6973  for i, s in rois
-0004c7e0: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
-0004c7f0: 2020 2020 2069 6620 616e 7928 0a20 2020       if any(.   
-0004c800: 2020 2020 2020 2020 2020 2020 205b 666e               [fn
-0004c810: 6d61 7463 682e 666e 6d61 7463 6828 735b  match.fnmatch(s[
-0004c820: 226e 616d 6522 5d2e 6c6f 7765 7228 292c  "name"].lower(),
-0004c830: 206e 2e6c 6f77 6572 2829 2920 666f 7220   n.lower()) for 
-0004c840: 6e20 696e 206e 616d 6573 5f74 6f5f 6c6f  n in names_to_lo
-0004c850: 6164 5d0a 2020 2020 2020 2020 2020 2020  ad].            
-0004c860: 290a 2020 2020 2020 2020 7d0a 2020 2020  ).        }.    
-0004c870: 2020 2020 6966 206e 6f74 206c 656e 2872      if not len(r
-0004c880: 6f69 7329 3a0a 2020 2020 2020 2020 2020  ois):.          
-0004c890: 2020 7072 696e 7428 6622 5761 726e 696e    print(f"Warnin
-0004c8a0: 673a 206e 6f20 524f 4973 2066 6f75 6e64  g: no ROIs found
-0004c8b0: 206d 6174 6368 696e 6720 6e61 6d65 2873   matching name(s
-0004c8c0: 293a 207b 6e61 6d65 737d 2229 0a20 2020  ): {names}").   
-0004c8d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0004c8e0: 5b5d 2c20 4e6f 6e65 0a0a 2020 2020 2320  [], None..    # 
-0004c8f0: 4765 7420 524f 4920 6465 7461 696c 730a  Get ROI details.
-0004c900: 2020 2020 726f 695f 7365 7120 3d20 6765      roi_seq = ge
-0004c910: 745f 6469 636f 6d5f 7365 7175 656e 6365  t_dicom_sequence
-0004c920: 2864 732c 2022 524f 4943 6f6e 746f 7572  (ds, "ROIContour
-0004c930: 2229 0a20 2020 2066 6f72 2072 6f69 2069  ").    for roi i
-0004c940: 6e20 726f 695f 7365 713a 0a0a 2020 2020  n roi_seq:..    
-0004c950: 2020 2020 6e75 6d62 6572 203d 2072 6f69      number = roi
-0004c960: 2e52 6566 6572 656e 6365 6452 4f49 4e75  .ReferencedROINu
-0004c970: 6d62 6572 0a20 2020 2020 2020 2069 6620  mber.        if 
-0004c980: 6e75 6d62 6572 206e 6f74 2069 6e20 726f  number not in ro
-0004c990: 6973 3a0a 2020 2020 2020 2020 2020 2020  is:.            
-0004c9a0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0004c9b0: 2064 6174 6120 3d20 7b22 636f 6e74 6f75   data = {"contou
-0004c9c0: 7273 223a 207b 7d7d 0a0a 2020 2020 2020  rs": {}}..      
-0004c9d0: 2020 2320 4765 7420 524f 4920 636f 6c6f    # Get ROI colo
-0004c9e0: 7572 0a20 2020 2020 2020 2069 6620 2252  ur.        if "R
-0004c9f0: 4f49 4469 7370 6c61 7943 6f6c 6f72 2220  OIDisplayColor" 
-0004ca00: 696e 2072 6f69 3a0a 2020 2020 2020 2020  in roi:.        
-0004ca10: 2020 2020 6461 7461 5b22 636f 6c6f 7222      data["color"
-0004ca20: 5d20 3d20 5b69 6e74 2863 2920 2f20 3235  ] = [int(c) / 25
-0004ca30: 3520 666f 7220 6320 696e 206c 6973 7428  5 for c in list(
-0004ca40: 726f 692e 524f 4944 6973 706c 6179 436f  roi.ROIDisplayCo
-0004ca50: 6c6f 7229 5d0a 2020 2020 2020 2020 656c  lor)].        el
-0004ca60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0004ca70: 6461 7461 5b22 636f 6c6f 7222 5d20 3d20  data["color"] = 
-0004ca80: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
-0004ca90: 4765 7420 636f 6e74 6f75 7273 0a20 2020  Get contours.   
-0004caa0: 2020 2020 2063 6f6e 746f 7572 5f73 6571       contour_seq
-0004cab0: 203d 2067 6574 5f64 6963 6f6d 5f73 6571   = get_dicom_seq
-0004cac0: 7565 6e63 6528 726f 692c 2022 436f 6e74  uence(roi, "Cont
-0004cad0: 6f75 7222 290a 2020 2020 2020 2020 6966  our").        if
-0004cae0: 2063 6f6e 746f 7572 5f73 6571 3a0a 2020   contour_seq:.  
-0004caf0: 2020 2020 2020 2020 2020 666f 7220 6320            for c 
-0004cb00: 696e 2063 6f6e 746f 7572 5f73 6571 3a0a  in contour_seq:.
-0004cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb20: 706c 616e 655f 6461 7461 203d 205b 0a20  plane_data = [. 
-0004cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb40: 2020 205b 666c 6f61 7428 7029 2066 6f72     [float(p) for
-0004cb50: 2070 2069 6e20 632e 436f 6e74 6f75 7244   p in c.ContourD
-0004cb60: 6174 615b 6920 2a20 3320 3a20 6920 2a20  ata[i * 3 : i * 
-0004cb70: 3320 2b20 335d 5d0a 2020 2020 2020 2020  3 + 3]].        
-0004cb80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0004cb90: 6920 696e 2072 616e 6765 2863 2e4e 756d  i in range(c.Num
-0004cba0: 6265 724f 6643 6f6e 746f 7572 506f 696e  berOfContourPoin
-0004cbb0: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-0004cbc0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-0004cbd0: 2020 2020 2020 7a20 3d20 666c 6f61 7428        z = float(
-0004cbe0: 632e 436f 6e74 6f75 7244 6174 615b 325d  c.ContourData[2]
-0004cbf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004cc00: 2020 6966 207a 206e 6f74 2069 6e20 6461    if z not in da
-0004cc10: 7461 5b22 636f 6e74 6f75 7273 225d 3a0a  ta["contours"]:.
-0004cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cc30: 2020 2020 6461 7461 5b22 636f 6e74 6f75      data["contou
-0004cc40: 7273 225d 5b7a 5d20 3d20 5b5d 0a20 2020  rs"][z] = [].   
-0004cc50: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0004cc60: 615b 2263 6f6e 746f 7572 7322 5d5b 7a5d  a["contours"][z]
-0004cc70: 2e61 7070 656e 6428 6e70 2e61 7272 6179  .append(np.array
-0004cc80: 2870 6c61 6e65 5f64 6174 6129 290a 0a20  (plane_data)).. 
-0004cc90: 2020 2020 2020 2072 6f69 735b 6e75 6d62         rois[numb
-0004cca0: 6572 5d2e 7570 6461 7465 2864 6174 6129  er].update(data)
-0004ccb0: 0a0a 2020 2020 7265 7475 726e 2072 6f69  ..    return roi
-0004ccc0: 732c 2064 730a 0a0a 6465 6620 6765 745f  s, ds...def get_
-0004ccd0: 6469 636f 6d5f 7365 7175 656e 6365 2864  dicom_sequence(d
-0004cce0: 733d 4e6f 6e65 2c20 6261 7365 6e61 6d65  s=None, basename
-0004ccf0: 3d22 2229 3a0a 0a20 2020 2073 6571 7565  =""):..    seque
-0004cd00: 6e63 6520 3d20 5b5d 0a20 2020 2066 6f72  nce = [].    for
-0004cd10: 2073 7566 6669 7820 696e 205b 2253 6571   suffix in ["Seq
-0004cd20: 7565 6e63 6522 2c20 2273 225d 3a0a 2020  uence", "s"]:.  
-0004cd30: 2020 2020 2020 6174 7472 6962 7574 6520        attribute 
-0004cd40: 3d20 6622 7b62 6173 656e 616d 657d 7b73  = f"{basename}{s
-0004cd50: 7566 6669 787d 220a 2020 2020 2020 2020  uffix}".        
-0004cd60: 6966 2068 6173 6174 7472 2864 732c 2061  if hasattr(ds, a
-0004cd70: 7474 7269 6275 7465 293a 0a20 2020 2020  ttribute):.     
-0004cd80: 2020 2020 2020 2073 6571 7565 6e63 6520         sequence 
-0004cd90: 3d20 6765 7461 7474 7228 6473 2c20 6174  = getattr(ds, at
-0004cda0: 7472 6962 7574 6529 0a20 2020 2020 2020  tribute).       
-0004cdb0: 2020 2020 2062 7265 616b 0a20 2020 2072       break.    r
-0004cdc0: 6574 7572 6e20 7365 7175 656e 6365 0a0a  eturn sequence..
-0004cdd0: 6465 6620 636f 6e74 6f75 725f 746f 5f70  def contour_to_p
-0004cde0: 6f6c 7967 6f6e 2863 6f6e 746f 7572 293a  olygon(contour):
-0004cdf0: 0a20 2020 2022 2222 436f 6e76 6572 7420  .    """Convert 
-0004ce00: 6120 6c69 7374 206f 6620 636f 6e74 6f75  a list of contou
-0004ce10: 7220 706f 696e 7473 2074 6f20 6120 5368  r points to a Sh
-0004ce20: 6170 656c 7920 706f 6c79 676f 6e2c 2065  apely polygon, e
-0004ce30: 6e73 7572 696e 6720 7468 6174 200a 2020  nsuring that .  
-0004ce40: 2020 7468 6520 706f 6c79 676f 6e20 6973    the polygon is
-0004ce50: 2076 616c 6964 2e22 2222 0a0a 2020 2020   valid."""..    
-0004ce60: 2320 4469 7361 626c 6520 7368 6170 656c  # Disable shapel
-0004ce70: 7920 494e 464f 206d 6573 7361 6765 7320  y INFO messages 
-0004ce80: 6973 7375 6564 2077 6865 6e20 6120 706f  issued when a po
-0004ce90: 6c79 676f 6e20 6973 6e27 7420 7661 6c69  lygon isn't vali
-0004cea0: 643a 0a20 2020 2023 2022 6361 6c6c 6261  d:.    # "callba
-0004ceb0: 636b 202d 2049 4e46 4f20 2d20 5269 6e67  ck - INFO - Ring
-0004cec0: 2053 656c 662d 696e 7465 7273 6563 7469   Self-intersecti
-0004ced0: 6f6e 2061 7420 6f72 206e 6561 7220 706f  on at or near po
-0004cee0: 696e 7422 0a20 2020 206c 6f67 6769 6e67  int".    logging
-0004cef0: 2e67 6574 4c6f 6767 6572 2827 7368 6170  .getLogger('shap
-0004cf00: 656c 792e 6765 6f73 2729 2e73 6574 4c65  ely.geos').setLe
-0004cf10: 7665 6c28 0a20 2020 2020 2020 2020 2020  vel(.           
-0004cf20: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
-0004cf30: 6c74 7328 292e 7368 6170 656c 795f 6c6f  lts().shapely_lo
-0004cf40: 675f 6c65 7665 6c29 0a0a 2020 2020 706f  g_level)..    po
-0004cf50: 6c79 676f 6e20 3d20 6765 6f6d 6574 7279  lygon = geometry
-0004cf60: 2e50 6f6c 7967 6f6e 2863 6f6e 746f 7572  .Polygon(contour
-0004cf70: 290a 0a20 2020 2064 656c 7461 203d 2030  )..    delta = 0
-0004cf80: 2e30 3035 0a20 2020 2069 6620 6e6f 7420  .005.    if not 
-0004cf90: 706f 6c79 676f 6e2e 6973 5f76 616c 6964  polygon.is_valid
-0004cfa0: 3a0a 2020 2020 2020 2020 746d 7020 3d20  :.        tmp = 
-0004cfb0: 6765 6f6d 6574 7279 2e50 6f6c 7967 6f6e  geometry.Polygon
-0004cfc0: 2870 6f6c 7967 6f6e 290a 2020 2020 2020  (polygon).      
-0004cfd0: 2020 6275 6666 6572 203d 2030 2e0a 2020    buffer = 0..  
-0004cfe0: 2020 2020 2020 2320 5468 6520 6964 6561        # The idea
-0004cff0: 2068 6572 6520 6973 2074 6f20 696e 6372   here is to incr
-0004d000: 6561 7365 2074 6865 2062 7566 6665 7220  ease the buffer 
-0004d010: 6469 7374 616e 6365 2075 6e74 696c 0a20  distance until. 
-0004d020: 2020 2020 2020 2023 2061 2076 616c 6964         # a valid
-0004d030: 2070 6f6c 7967 6f6e 2069 7320 6f62 7461   polygon is obta
-0004d040: 696e 6564 2e20 2054 6869 7320 6765 6e65  ined.  This gene
-0004d050: 7261 6c6c 7920 7365 656d 7320 746f 2077  rally seems to w
-0004d060: 6f72 6b2e 2e2e 0a20 2020 2020 2020 2077  ork....        w
-0004d070: 6869 6c65 2028 6973 696e 7374 616e 6365  hile (isinstance
-0004d080: 2870 6f6c 7967 6f6e 2c20 6765 6f6d 6574  (polygon, geomet
-0004d090: 7279 2e4d 756c 7469 506f 6c79 676f 6e29  ry.MultiPolygon)
-0004d0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d0b0: 206f 7220 6e6f 7420 706f 6c79 676f 6e2e   or not polygon.
-0004d0c0: 6973 5f76 616c 6964 293a 0a20 2020 2020  is_valid):.     
-0004d0d0: 2020 2020 2020 2062 7566 6665 7220 2b3d         buffer +=
-0004d0e0: 2064 656c 7461 0a20 2020 2020 2020 2020   delta.         
-0004d0f0: 2020 2070 6f6c 7967 6f6e 203d 2074 6d70     polygon = tmp
-0004d100: 2e62 7566 6665 7228 6275 6666 6572 290a  .buffer(buffer).
-0004d110: 2020 2020 2020 2020 706f 696e 7473 203d          points =
-0004d120: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-0004d130: 782c 2079 2069 6e20 706f 6c79 676f 6e2e  x, y in polygon.
-0004d140: 6578 7465 7269 6f72 2e63 6f6f 7264 733a  exterior.coords:
-0004d150: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
-0004d160: 6e74 732e 6170 7065 6e64 2828 782c 2079  nts.append((x, y
-0004d170: 2929 0a20 2020 2020 2020 2070 6f6c 7967  )).        polyg
-0004d180: 6f6e 203d 2067 656f 6d65 7472 792e 506f  on = geometry.Po
-0004d190: 6c79 676f 6e28 706f 696e 7473 290a 0a20  lygon(points).. 
-0004d1a0: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
-0004d1b0: 6e0a 0a64 6566 2070 6f6c 7967 6f6e 5f74  n..def polygon_t
-0004d1c0: 6f5f 636f 6e74 6f75 7228 706f 6c79 676f  o_contour(polygo
-0004d1d0: 6e29 3a0a 2020 2020 2727 270a 2020 2020  n):.    '''.    
-0004d1e0: 436f 6e76 6572 7420 6120 5368 6170 656c  Convert a Shapel
-0004d1f0: 7920 706f 6c79 676f 6e20 746f 2061 206c  y polygon to a l
-0004d200: 6973 7420 6f66 2063 6f6e 746f 7572 2070  ist of contour p
-0004d210: 6f69 6e74 732e 0a0a 2020 2020 2a2a 5061  oints...    **Pa
-0004d220: 7261 6d65 7465 723a 2a2a 0a0a 2020 2020  rameter:**..    
-0004d230: 706f 6c79 676f 6e3a 2073 6861 7065 6c79  polygon: shapely
-0004d240: 2e67 656f 6d65 7472 792e 706f 6c79 676f  .geometry.polygo
-0004d250: 6e0a 2020 2020 2020 2020 5368 6170 656c  n.        Shapel
-0004d260: 7920 706f 6c79 676f 6e2e 0a0a 2020 2020  y polygon...    
-0004d270: 7a5f 706f 6c79 676f 6e3a 207a 2063 6f6f  z_polygon: z coo
-0004d280: 7264 696e 6174 6520 6174 2077 6869 6368  rdinate at which
-0004d290: 2070 6f6c 7967 6f6e 2069 7320 6465 6669   polygon is defi
-0004d2a0: 6e65 642e 0a20 2020 2027 2727 0a20 2020  ned..    '''.   
-0004d2b0: 2063 6f6e 746f 7572 5f70 6f69 6e74 7320   contour_points 
-0004d2c0: 3d20 5b5d 0a20 2020 2066 6f72 2078 2c20  = [].    for x, 
-0004d2d0: 7920 696e 206c 6973 7428 706f 6c79 676f  y in list(polygo
-0004d2e0: 6e2e 6578 7465 7269 6f72 2e63 6f6f 7264  n.exterior.coord
-0004d2f0: 7329 3a0a 2020 2020 2020 2020 636f 6e74  s):.        cont
-0004d300: 6f75 725f 706f 696e 7473 2e61 7070 656e  our_points.appen
-0004d310: 6428 5b78 2c20 795d 290a 2020 2020 636f  d([x, y]).    co
-0004d320: 6e74 6f75 7220 3d20 6e70 2e61 7272 6179  ntour = np.array
-0004d330: 2863 6f6e 746f 7572 5f70 6f69 6e74 7329  (contour_points)
-0004d340: 0a0a 2020 2020 7265 7475 726e 2063 6f6e  ..    return con
-0004d350: 746f 7572 0a0a 6465 6620 696e 7465 7270  tour..def interp
-0004d360: 6f6c 6174 655f 706f 696e 7473 5f73 696e  olate_points_sin
-0004d370: 676c 655f 636f 6e74 6f75 7228 736f 7572  gle_contour(sour
-0004d380: 6365 3d4e 6f6e 652c 206e 5f70 6f69 6e74  ce=None, n_point
-0004d390: 3d4e 6f6e 652c 2064 7879 3d4e 6f6e 652c  =None, dxy=None,
-0004d3a0: 0a20 2020 2020 2020 2073 6d6f 6f74 686e  .        smoothn
-0004d3b0: 6573 735f 7065 725f 706f 696e 743d 3029  ess_per_point=0)
-0004d3c0: 3a0a 2020 2020 2727 270a 2020 2020 496e  :.    '''.    In
-0004d3d0: 7465 7270 6f6c 6174 6520 706f 696e 7473  terpolate points
-0004d3e0: 2066 6f72 2061 2073 696e 676c 6520 636f   for a single co
-0004d3f0: 6e74 6f75 722e 0a0a 2020 2020 2a2a 5061  ntour...    **Pa
-0004d400: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
-0004d410: 2073 6f75 7263 6520 3a20 7368 6170 656c   source : shapel
-0004d420: 792e 706f 6c79 676f 6e2e 506f 6c79 676f  y.polygon.Polygo
-0004d430: 6e2f 6e70 2e6e 6461 7272 6179 2f6c 6973  n/np.ndarray/lis
-0004d440: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-0004d450: 2020 2020 2020 2020 436f 6e74 6f75 7220          Contour 
-0004d460: 7265 7072 6573 656e 7461 7469 6f6e 2061  representation a
-0004d470: 7320 6569 7468 6572 2061 2073 6861 7065  s either a shape
-0004d480: 6c79 2050 6f6c 7967 6f6e 2c20 6120 6e75  ly Polygon, a nu
-0004d490: 6d70 790a 2020 2020 2020 2020 6172 7261  mpy.        arra
-0004d4a0: 7920 6f66 205b 782c 2079 5d20 7061 6972  y of [x, y] pair
-0004d4b0: 7320 6f72 2061 206c 6973 7420 6f66 205b  s or a list of [
-0004d4c0: 782c 2079 5d20 7061 6972 732e 2020 5468  x, y] pairs.  Th
-0004d4d0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-0004d4e0: 6564 2063 6f6e 746f 7572 2068 6173 2074  ed contour has t
-0004d4f0: 6865 2073 616d 6520 7265 7072 6573 656e  he same represen
-0004d500: 7461 7469 6f6e 2e0a 0a20 2020 206e 5f70  tation...    n_p
-0004d510: 6f69 6e74 203a 2069 6e74 2c20 6465 6661  oint : int, defa
-0004d520: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0004d530: 204e 756d 6265 7220 6f66 2070 6f69 6e74   Number of point
-0004d540: 7320 746f 2064 6566 696e 6520 636f 6e74  s to define cont
-0004d550: 6f75 722c 2061 6674 6572 2069 6e74 6572  our, after inter
-0004d560: 706f 6c61 7469 6f6e 2e20 2054 6869 7320  polation.  This 
-0004d570: 6d75 7374 0a20 2020 2020 2020 2062 6520  must.        be 
-0004d580: 7365 7420 746f 204e 6f6e 6520 666f 7220  set to None for 
-0004d590: 6478 7920 746f 2062 6520 636f 6e73 6964  dxy to be consid
-0004d5a0: 6572 6564 2e0a 0a20 2020 2064 7879 203a  ered...    dxy :
-0004d5b0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
-0004d5c0: 4e6f 6e65 0a20 2020 2020 2020 2041 7070  None.        App
-0004d5d0: 726f 7869 6d61 7465 2064 6973 7461 6e63  roximate distanc
-0004d5e0: 6520 7265 7175 6972 6564 2062 6574 7765  e required betwe
-0004d5f0: 656e 2063 6f6e 746f 7572 2070 6f69 6e74  en contour point
-0004d600: 732e 2020 5468 6973 2069 7320 7461 6b65  s.  This is take
-0004d610: 6e0a 2020 2020 2020 2020 696e 746f 2061  n.        into a
-0004d620: 6363 6f75 6e74 206f 6e6c 7920 6966 206e  ccount only if n
-0004d630: 5f70 6f69 6e74 2069 7320 7365 7420 746f  _point is set to
-0004d640: 204e 6f6e 652e 2020 466f 7220 6120 636f   None.  For a co
-0004d650: 6e74 6f75 7220 6f66 0a20 2020 2020 2020  ntour of.       
-0004d660: 206c 656e 6774 6820 636f 6e74 6f75 725f   length contour_
-0004d670: 6c65 6e67 7468 2c20 7468 6520 6e75 6d62  length, the numb
-0004d680: 6572 206f 6620 636f 6e74 6f75 7220 706f  er of contour po
-0004d690: 696e 7473 2069 7320 7468 656e 2074 616b  ints is then tak
-0004d6a0: 656e 0a20 2020 2020 2020 2074 6f20 6265  en.        to be
-0004d6b0: 206d 6178 2869 6e74 2863 6f6e 746f 7572   max(int(contour
-0004d6c0: 5f6c 656e 6774 6820 2f20 6478 7929 2c20  _length / dxy), 
-0004d6d0: 3329 2e20 200a 0a20 2020 2073 6d6f 6f74  3).  ..    smoot
-0004d6e0: 686e 6573 735f 7065 725f 706f 696e 7420  hness_per_point 
-0004d6f0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-0004d700: 3d30 0a20 2020 2020 2020 2050 6172 616d  =0.        Param
-0004d710: 6574 6572 2064 6574 6572 6d69 6e69 6e67  eter determining
-0004d720: 2074 6865 2073 6d6f 6f74 686e 6573 7320   the smoothness 
-0004d730: 6f66 2074 6865 2042 2d73 706c 696e 6520  of the B-spline 
-0004d740: 6375 7276 6520 7573 6564 0a20 2020 2020  curve used.     
-0004d750: 2020 2069 6e20 636f 6e74 6f75 7220 6170     in contour ap
-0004d760: 7072 6f78 696d 6174 696f 6e20 666f 7220  proximation for 
-0004d770: 696e 7465 7270 6f6c 6174 696f 6e2e 2020  interpolation.  
-0004d780: 5468 6520 7072 6f64 7563 7420 6f66 0a20  The product of. 
-0004d790: 2020 2020 2020 2073 6d6f 6f74 686e 6573         smoothnes
-0004d7a0: 735f 7065 725f 706f 696e 7420 616e 6420  s_per_point and 
-0004d7b0: 7468 6520 6e75 6d62 6572 206f 6620 636f  the number of co
-0004d7c0: 6e74 6f75 7220 706f 696e 7473 2028 7370  ntour points (sp
-0004d7d0: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
-0004d7e0: 6469 7265 6374 6c79 2076 6961 206e 5f70  directly via n_p
-0004d7f0: 6f69 6e74 2c20 6f72 2069 6e64 6972 6563  oint, or indirec
-0004d800: 746c 7920 7669 6120 6478 7929 2063 6f72  tly via dxy) cor
-0004d810: 7265 7370 6f6e 6473 2074 6f20 7468 650a  responds to the.
-0004d820: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
-0004d830: 7220 7320 6f66 2073 6369 7079 2e69 6e74  r s of scipy.int
-0004d840: 6572 706f 6c61 7465 2e73 706c 7072 6570  erpolate.splprep
-0004d850: 202d 2073 6565 2064 6f63 756d 656e 7461   - see documenta
-0004d860: 7469 6f6e 2061 743a 0a20 2020 2020 2020  tion at:.       
-0004d870: 200a 2020 2020 2020 2020 6874 7470 733a   .        https:
-0004d880: 2f2f 7363 6970 792e 6769 7468 7562 2e69  //scipy.github.i
-0004d890: 6f2f 6465 7664 6f63 732f 7265 6665 7265  o/devdocs/refere
-0004d8a0: 6e63 652f 6765 6e65 7261 7465 642f 7363  nce/generated/sc
-0004d8b0: 6970 792e 696e 7465 7270 6f6c 6174 652e  ipy.interpolate.
-0004d8c0: 7370 6c70 7265 702e 6874 6d6c 2373 6369  splprep.html#sci
-0004d8d0: 7079 2e69 6e74 6572 706f 6c61 7465 2e73  py.interpolate.s
-0004d8e0: 706c 7072 6570 0a0a 2020 2020 2020 2020  plprep..        
-0004d8f0: 4120 736d 6f6f 7468 6e65 7373 5f70 6572  A smoothness_per
-0004d900: 5f70 6f69 6e74 206f 6620 3020 666f 7263  _point of 0 forc
-0004d910: 6573 2074 6865 2042 2d73 706c 696e 6520  es the B-spline 
-0004d920: 746f 2070 6173 7320 7468 726f 7567 680a  to pass through.
-0004d930: 2020 2020 2020 2020 616c 6c20 6f66 2074          all of t
-0004d940: 6865 2070 7265 2d69 6e74 6572 706f 6c61  he pre-interpola
-0004d950: 7469 6f6e 2063 6f6e 746f 7572 2070 6f69  tion contour poi
-0004d960: 6e74 732e 0a20 2020 2027 2727 0a0a 2020  nts..    '''..  
-0004d970: 2020 2320 4578 7472 6163 7420 6c69 7374    # Extract list
-0004d980: 206f 6620 636f 6e74 6f75 7220 706f 696e   of contour poin
-0004d990: 7473 2066 726f 6d20 736f 7572 6365 2e0a  ts from source..
-0004d9a0: 2020 2020 636f 6e74 6f75 725f 6c65 6e67      contour_leng
-0004d9b0: 7468 203d 204e 6f6e 650a 2020 2020 6966  th = None.    if
-0004d9c0: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
-0004d9d0: 6365 2c20 6765 6f6d 6574 7279 2e70 6f6c  ce, geometry.pol
-0004d9e0: 7967 6f6e 2e50 6f6c 7967 6f6e 293a 0a20  ygon.Polygon):. 
-0004d9f0: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
-0004da00: 6c69 7374 2870 6f6c 7967 6f6e 5f74 6f5f  list(polygon_to_
-0004da10: 636f 6e74 6f75 7228 736f 7572 6365 2929  contour(source))
-0004da20: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
-0004da30: 5f6c 656e 6774 6820 3d20 736f 7572 6365  _length = source
-0004da40: 2e6c 656e 6774 680a 2020 2020 656c 6966  .length.    elif
-0004da50: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
-0004da60: 6365 2c20 6e70 2e6e 6461 7272 6179 2920  ce, np.ndarray) 
-0004da70: 6f72 2069 7369 6e73 7461 6e63 6528 736f  or isinstance(so
-0004da80: 7572 6365 2c20 6c69 7374 293a 0a20 2020  urce, list):.   
-0004da90: 2020 2020 2070 6f69 6e74 7320 3d20 6c69       points = li
-0004daa0: 7374 2873 6f75 7263 6529 0a20 2020 2065  st(source).    e
-0004dab0: 6c73 653a 0a20 2020 2020 2020 2070 6f69  lse:.        poi
-0004dac0: 6e74 7320 3d20 4e6f 6e65 0a0a 2020 2020  nts = None..    
-0004dad0: 6966 2070 6f69 6e74 7320 6973 204e 6f6e  if points is Non
-0004dae0: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
-0004daf0: 2827 556e 7265 636f 676e 6973 6564 2073  ('Unrecognised s
-0004db00: 6f75 7263 6520 7061 7373 6564 2074 6f20  ource passed to 
-0004db10: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0004db20: 2020 275c 2769 6e74 6572 706f 6c61 7465    '\'interpolate
-0004db30: 5f70 6f69 6e74 735f 7369 6e67 6c65 5f63  _points_single_c
-0004db40: 6f6e 746f 7572 2829 5c27 2729 0a20 2020  ontour()\'').   
-0004db50: 2020 2020 2070 7269 6e74 2827 536f 7572       print('Sour
-0004db60: 6365 206d 7573 7420 6265 2073 6861 7065  ce must be shape
-0004db70: 6c79 2050 6f6c 7967 6f6e 206f 7220 636f  ly Polygon or co
-0004db80: 6e74 6f75 7227 290a 2020 2020 2020 2020  ntour').        
-0004db90: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-0004dba0: 2023 2049 6620 6e75 6d62 6572 206f 6620   # If number of 
-0004dbb0: 636f 6e74 6f75 7220 706f 696e 7473 206e  contour points n
-0004dbc0: 6f74 2070 6173 7365 6420 6469 7265 6374  ot passed direct
-0004dbd0: 6c79 2c0a 2020 2020 2320 7472 7920 746f  ly,.    # try to
-0004dbe0: 2064 6574 6572 6d69 6e65 2069 7473 2076   determine its v
-0004dbf0: 616c 7565 2066 726f 6d20 7468 6520 6469  alue from the di
-0004dc00: 7374 616e 6365 2062 6574 7765 656e 2063  stance between c
-0004dc10: 6f6e 746f 7572 2070 6f69 6e74 732e 0a20  ontour points.. 
-0004dc20: 2020 2069 6620 6e5f 706f 696e 7420 6973     if n_point is
-0004dc30: 204e 6f6e 6520 616e 6420 6478 793a 0a20   None and dxy:. 
-0004dc40: 2020 2020 2020 2069 6620 636f 6e74 6f75         if contou
-0004dc50: 725f 6c65 6e67 7468 2069 7320 4e6f 6e65  r_length is None
-0004dc60: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0004dc70: 6e74 6f75 725f 6c65 6e67 7468 203d 2063  ntour_length = c
-0004dc80: 6f6e 746f 7572 5f74 6f5f 706f 6c79 676f  ontour_to_polygo
-0004dc90: 6e28 736f 7572 6365 292e 6c65 6e67 7468  n(source).length
-0004dca0: 0a20 2020 2020 2020 206e 5f70 6f69 6e74  .        n_point
-0004dcb0: 203d 206d 6178 2869 6e74 2863 6f6e 746f   = max(int(conto
-0004dcc0: 7572 5f6c 656e 6774 6820 2f20 6478 7929  ur_length / dxy)
-0004dcd0: 2c20 3329 0a20 2020 2069 6620 6e5f 706f  , 3).    if n_po
-0004dce0: 696e 7420 6973 204e 6f6e 653a 0a20 2020  int is None:.   
-0004dcf0: 2020 2020 2070 7269 6e74 2827 4e6f 2069       print('No i
-0004dd00: 6e74 6572 706f 6c61 7469 6f6e 2070 6572  nterpolation per
-0004dd10: 666f 726d 6564 2729 0a20 2020 2020 2020  formed').       
-0004dd20: 2070 7269 6e74 2827 4e75 6d62 6572 206f   print('Number o
-0004dd30: 6620 636f 6e74 6f75 7220 706f 696e 7473  f contour points
-0004dd40: 2028 6e5f 706f 696e 7429 206f 7220 6469   (n_point) or di
-0004dd50: 7374 616e 6365 2062 6574 7765 656e 2070  stance between p
-0004dd60: 6f69 6e74 7327 0a20 2020 2020 2020 2020  oints'.         
-0004dd70: 2020 2020 2020 2027 6d75 7374 2062 6520         'must be 
-0004dd80: 7370 6563 6966 6965 642e 2729 0a20 2020  specified.').   
-0004dd90: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0004dda0: 0a0a 2020 2020 2320 4d61 6b65 206c 6173  ..    # Make las
-0004ddb0: 7420 706f 696e 7420 7468 6520 7361 6d65  t point the same
-0004ddc0: 2061 7320 7468 6520 6669 7273 742c 2074   as the first, t
-0004ddd0: 6f20 656e 7375 7265 2063 6c6f 7365 6420  o ensure closed 
-0004dde0: 6375 7276 652e 0a20 2020 2070 6f69 6e74  curve..    point
-0004ddf0: 732e 6170 7065 6e64 2870 6f69 6e74 735b  s.append(points[
-0004de00: 305d 290a 0a20 2020 2023 2044 6973 6361  0])..    # Disca
-0004de10: 7264 2070 6f69 6e74 7320 7468 6174 2061  rd points that a
-0004de20: 7265 6e27 7420 7365 7061 7261 7465 6420  ren't separated 
-0004de30: 6672 6f6d 2074 6865 2070 7265 6365 6564  from the preceed
-0004de40: 696e 6720 706f 696e 740a 2020 2020 2320  ing point.    # 
-0004de50: 6279 2061 7420 6c65 6173 7420 736f 6d65  by at least some
-0004de60: 206d 696e 696d 756d 2064 6973 7461 6e63   minimum distanc
-0004de70: 652e 0a20 2020 2064 7879 5f6d 696e 203d  e..    dxy_min =
-0004de80: 2030 2e30 3031 0a20 2020 2078 5f6c 6173   0.001.    x_las
-0004de90: 742c 2079 5f6c 6173 7420 3d20 706f 696e  t, y_last = poin
-0004dea0: 7473 5b30 5d0a 2020 2020 785f 7661 6c75  ts[0].    x_valu
-0004deb0: 6573 2c20 795f 7661 6c75 6573 203d 2028  es, y_values = (
-0004dec0: 5b78 5f6c 6173 745d 2c20 5b79 5f6c 6173  [x_last], [y_las
-0004ded0: 745d 290a 2020 2020 666f 7220 6920 696e  t]).    for i in
-0004dee0: 2072 616e 6765 2831 2c20 6c65 6e28 706f   range(1, len(po
-0004def0: 696e 7473 2929 3a0a 2020 2020 2020 2020  ints)):.        
-0004df00: 782c 2079 203d 2070 6f69 6e74 735b 695d  x, y = points[i]
-0004df10: 0a20 2020 2020 2020 2069 6620 2861 6273  .        if (abs
-0004df20: 2878 202d 2078 5f6c 6173 7429 203e 2064  (x - x_last) > d
-0004df30: 7879 5f6d 696e 2920 6f72 2028 6162 7328  xy_min) or (abs(
-0004df40: 7920 2d20 795f 6c61 7374 2920 3e20 6478  y - y_last) > dx
-0004df50: 795f 6d69 6e29 3a0a 2020 2020 2020 2020  y_min):.        
-0004df60: 2020 2020 785f 7661 6c75 6573 2e61 7070      x_values.app
-0004df70: 656e 6428 706f 696e 7473 5b69 5d5b 305d  end(points[i][0]
-0004df80: 290a 2020 2020 2020 2020 2020 2020 795f  ).            y_
-0004df90: 7661 6c75 6573 2e61 7070 656e 6428 706f  values.append(po
-0004dfa0: 696e 7473 5b69 5d5b 315d 290a 2020 2020  ints[i][1]).    
-0004dfb0: 2020 2020 785f 6c61 7374 2c20 795f 6c61      x_last, y_la
-0004dfc0: 7374 203d 2070 6f69 6e74 735b 695d 0a0a  st = points[i]..
-0004dfd0: 2020 2020 785f 7661 6c75 6573 203d 206e      x_values = n
-0004dfe0: 702e 6172 7261 7928 785f 7661 6c75 6573  p.array(x_values
-0004dff0: 290a 2020 2020 795f 7661 6c75 6573 203d  ).    y_values =
-0004e000: 206e 702e 6172 7261 7928 795f 7661 6c75   np.array(y_valu
-0004e010: 6573 290a 0a20 2020 2023 2049 6e74 6572  es)..    # Inter
-0004e020: 706f 6c61 7465 2063 6f6e 746f 7572 2070  polate contour p
-0004e030: 6f69 6e74 732e 0a20 2020 2073 6d6f 6f74  oints..    smoot
-0004e040: 686e 6573 7320 3d20 736d 6f6f 7468 6e65  hness = smoothne
-0004e050: 7373 5f70 6572 5f70 6f69 6e74 202a 206c  ss_per_point * l
-0004e060: 656e 2878 5f76 616c 7565 7329 0a20 2020  en(x_values).   
-0004e070: 2074 7279 3a0a 2320 2020 2020 2020 2077   try:.#        w
-0004e080: 6974 6820 7761 726e 696e 6773 2e63 6174  ith warnings.cat
-0004e090: 6368 5f77 6172 6e69 6e67 7328 293a 0a23  ch_warnings():.#
-0004e0a0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0004e0b0: 696e 6773 2e66 696c 7465 7277 6172 6e69  ings.filterwarni
-0004e0c0: 6e67 7328 2269 676e 6f72 6522 2c20 6d65  ngs("ignore", me
-0004e0d0: 7373 6167 653d 2253 6574 7469 6e67 2078  ssage="Setting x
-0004e0e0: 2229 0a20 2020 2020 2020 2020 2020 2074  ").            t
-0004e0f0: 636b 2c20 7520 3d20 696e 7465 7270 6f6c  ck, u = interpol
-0004e100: 6174 652e 7370 6c70 7265 7028 0a20 2020  ate.splprep(.   
-0004e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e120: 205b 785f 7661 6c75 6573 2c20 795f 7661   [x_values, y_va
-0004e130: 6c75 6573 5d2c 2073 3d73 6d6f 6f74 686e  lues], s=smoothn
-0004e140: 6573 732c 2070 6572 3d54 7275 6529 0a20  ess, per=True). 
-0004e150: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
-0004e160: 726f 7220 6173 2070 726f 626c 656d 3a0a  ror as problem:.
-0004e170: 2020 2020 2020 2020 7072 696e 7428 2257          print("W
-0004e180: 4152 4e49 4e47 3a20 5072 6f62 6c65 6d20  ARNING: Problem 
-0004e190: 696e 2069 6e74 6572 706f 6c61 7465 5f63  in interpolate_c
-0004e1a0: 6f6e 746f 7572 5f70 6f69 6e74 7328 293a  ontour_points():
-0004e1b0: 222c 2070 726f 626c 656d 290a 2020 2020  ", problem).    
-0004e1c0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0004e1d0: 0a20 2020 2078 695f 7661 6c75 6573 2c20  .    xi_values, 
-0004e1e0: 7969 5f76 616c 7565 7320 3d20 696e 7465  yi_values = inte
-0004e1f0: 7270 6f6c 6174 652e 7370 6c65 7628 0a20  rpolate.splev(. 
-0004e200: 2020 2020 2020 206e 702e 6c69 6e73 7061         np.linspa
-0004e210: 6365 2830 2e2c 2031 2e2c 206e 5f70 6f69  ce(0., 1., n_poi
-0004e220: 6e74 202b 2031 292c 2074 636b 290a 0a20  nt + 1), tck).. 
-0004e230: 2020 2023 2053 746f 7265 2070 6f69 6e74     # Store point
-0004e240: 7320 696e 2061 2066 6f72 6d20 7468 6174  s in a form that
-0004e250: 206d 6179 2062 6520 636f 6e76 6572 7465   may be converte
-0004e260: 6420 746f 2061 206e 756d 7079 2061 7272  d to a numpy arr
-0004e270: 6179 2e0a 2020 2020 706f 696e 7473 5f69  ay..    points_i
-0004e280: 6e74 6572 706f 6c61 7465 6420 3d20 6c69  nterpolated = li
-0004e290: 7374 287a 6970 2878 695f 7661 6c75 6573  st(zip(xi_values
-0004e2a0: 2c20 7969 5f76 616c 7565 7329 290a 2020  , yi_values)).  
-0004e2b0: 2020 706f 696e 7473 5f69 6e74 6572 706f    points_interpo
-0004e2c0: 6c61 7465 6420 3d20 5b78 7920 666f 7220  lated = [xy for 
-0004e2d0: 7879 2069 6e20 706f 696e 7473 5f69 6e74  xy in points_int
-0004e2e0: 6572 706f 6c61 7465 645d 0a0a 2020 2020  erpolated]..    
-0004e2f0: 2320 5265 7475 726e 2069 6e74 6572 706f  # Return interpo
-0004e300: 6c61 7465 6420 636f 6e74 6f75 7220 696e  lated contour in
-0004e310: 2074 6865 2073 616d 6520 7265 7072 6573   the same repres
-0004e320: 656e 7461 7469 6f6e 2061 7320 7468 6520  entation as the 
-0004e330: 736f 7572 6365 2e0a 2020 2020 6966 2069  source..    if i
-0004e340: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
-0004e350: 2c20 6765 6f6d 6574 7279 2e70 6f6c 7967  , geometry.polyg
-0004e360: 6f6e 2e50 6f6c 7967 6f6e 293a 0a20 2020  on.Polygon):.   
-0004e370: 2020 2020 206f 7574 5f6f 626a 6563 7420       out_object 
-0004e380: 3d20 6765 6f6d 6574 7279 2e70 6f6c 7967  = geometry.polyg
-0004e390: 6f6e 2e50 6f6c 7967 6f6e 2870 6f69 6e74  on.Polygon(point
-0004e3a0: 735f 696e 7465 7270 6f6c 6174 6564 290a  s_interpolated).
-0004e3b0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-0004e3c0: 6e63 6528 736f 7572 6365 2c20 6e70 2e6e  nce(source, np.n
-0004e3d0: 6461 7272 6179 293a 0a20 2020 2020 2020  darray):.       
-0004e3e0: 206f 7574 5f6f 626a 6563 7420 3d20 6e70   out_object = np
-0004e3f0: 2e61 7272 6179 2870 6f69 6e74 735f 696e  .array(points_in
-0004e400: 7465 7270 6f6c 6174 6564 290a 2020 2020  terpolated).    
-0004e410: 656c 7365 3a0a 2020 2020 2020 2020 6f75  else:.        ou
-0004e420: 745f 6f62 6a65 6374 203d 2070 6f69 6e74  t_object = point
-0004e430: 735f 696e 7465 7270 6f6c 6174 6564 0a0a  s_interpolated..
-0004e440: 2020 2020 7265 7475 726e 206f 7574 5f6f      return out_o
-0004e450: 626a 6563 740a 0a64 6566 2077 7269 7465  bject..def write
-0004e460: 5f73 7472 7563 7475 7265 5f73 6574 5f64  _structure_set_d
-0004e470: 6963 6f6d 280a 2020 2020 6f75 746e 616d  icom(.    outnam
-0004e480: 652c 200a 2020 2020 726f 6973 2c20 0a20  e, .    rois, . 
-0004e490: 2020 2069 6d61 6765 3d4e 6f6e 652c 200a     image=None, .
-0004e4a0: 2020 2020 6166 6669 6e65 3d4e 6f6e 652c      affine=None,
-0004e4b0: 200a 2020 2020 7368 6170 653d 4e6f 6e65   .    shape=None
-0004e4c0: 2c0a 2020 2020 6f72 6965 6e74 6174 696f  ,.    orientatio
-0004e4d0: 6e3d 4e6f 6e65 2c20 0a20 2020 2068 6561  n=None, .    hea
-0004e4e0: 6465 725f 736f 7572 6365 3d4e 6f6e 652c  der_source=None,
-0004e4f0: 200a 2020 2020 7061 7469 656e 745f 6964   .    patient_id
-0004e500: 3d4e 6f6e 652c 0a20 2020 206d 6f64 616c  =None,.    modal
-0004e510: 6974 793d 4e6f 6e65 2c20 0a20 2020 2072  ity=None, .    r
-0004e520: 6f6f 745f 7569 643d 4e6f 6e65 0a29 3a0a  oot_uid=None.):.
-0004e530: 0a20 2020 2023 2043 6865 636b 2077 6520  .    # Check we 
-0004e540: 6861 7665 2074 6865 2072 656c 6576 616e  have the relevan
-0004e550: 7420 696e 666f 0a20 2020 2069 6620 6e6f  t info.    if no
-0004e560: 7420 696d 6167 6520 616e 6420 286e 6f74  t image and (not
-0004e570: 2061 6666 696e 6520 6f72 206e 6f74 2073   affine or not s
-0004e580: 6861 7065 293a 0a20 2020 2020 2020 2072  hape):.        r
-0004e590: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
-0004e5a0: 7228 224d 7573 7420 7072 6f76 6964 6520  r("Must provide 
-0004e5b0: 6569 7468 6572 2061 6e20 696d 6167 6520  either an image 
-0004e5c0: 6f72 2061 6e20 6166 6669 6e65 206d 6174  or an affine mat
-0004e5d0: 7269 7820 220a 2020 2020 2020 2020 2020  rix ".          
-0004e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e5f0: 2022 616e 6420 7368 6170 6521 2229 0a0a   "and shape!")..
-0004e600: 2020 2020 2320 5472 7920 6765 7474 696e      # Try gettin
-0004e610: 6720 6469 636f 6d20 6461 7461 7365 7420  g dicom dataset 
-0004e620: 6672 6f6d 2069 6d61 6765 0a20 2020 2064  from image.    d
-0004e630: 7320 3d20 4e6f 6e65 0a20 2020 2069 6620  s = None.    if 
-0004e640: 696d 6167 653a 0a20 2020 2020 2020 2069  image:.        i
-0004e650: 6620 6861 7361 7474 7228 696d 6167 652c  f hasattr(image,
-0004e660: 2022 6469 636f 6d5f 6461 7461 7365 7422   "dicom_dataset"
-0004e670: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-0004e680: 7320 3d20 696d 6167 652e 6469 636f 6d5f  s = image.dicom_
-0004e690: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
-0004e6a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0004e6b0: 2020 6473 203d 2073 6b72 742e 696d 6167    ds = skrt.imag
-0004e6c0: 652e 6372 6561 7465 5f64 6963 6f6d 2829  e.create_dicom()
-0004e6d0: 0a20 2020 2020 2020 2020 2020 2064 732e  .            ds.
-0004e6e0: 7365 745f 6765 6f6d 6574 7279 280a 2020  set_geometry(.  
-0004e6f0: 2020 2020 2020 2020 2020 2020 2020 696d                im
-0004e700: 6167 652e 6765 745f 6166 6669 6e65 2829  age.get_affine()
-0004e710: 2c20 696d 6167 652e 6765 745f 6461 7461  , image.get_data
-0004e720: 2829 2e73 6861 7065 2c0a 2020 2020 2020  ().shape,.      
-0004e730: 2020 2020 2020 2020 2020 696d 6167 652e            image.
-0004e740: 6765 745f 6f72 6965 6e74 6174 696f 6e5f  get_orientation_
-0004e750: 7665 6374 6f72 2869 6d61 6765 2e67 6574  vector(image.get
-0004e760: 5f61 6666 696e 652c 2022 6469 636f 6d22  _affine, "dicom"
-0004e770: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0004e780: 0a20 2020 2023 204f 7468 6572 7769 7365  .    # Otherwise
-0004e790: 2c20 6372 6561 7465 2066 7265 7368 2064  , create fresh d
-0004e7a0: 6963 6f6d 2064 6174 6173 6574 0a20 2020  icom dataset.   
-0004e7b0: 2065 6c73 653a 0a20 2020 2020 2020 2064   else:.        d
-0004e7c0: 7320 3d20 736b 7274 2e69 6d61 6765 2e63  s = skrt.image.c
-0004e7d0: 7265 6174 655f 6469 636f 6d28 7061 7469  reate_dicom(pati
-0004e7e0: 656e 745f 6964 2c20 6d6f 6461 6c69 7479  ent_id, modality
-0004e7f0: 2c20 726f 6f74 5f75 6964 290a 2020 2020  , root_uid).    
-0004e800: 2020 2020 6473 2e73 6574 5f67 656f 6d65      ds.set_geome
-0004e810: 7472 7928 6166 6669 6e65 2c20 7368 6170  try(affine, shap
-0004e820: 652c 206f 7269 656e 7461 7469 6f6e 290a  e, orientation).
-0004e830: 0a20 2020 2023 2041 646a 7573 7420 6461  .    # Adjust da
-0004e840: 7461 7365 7420 746f 2062 6520 666f 7220  taset to be for 
-0004e850: 5374 7275 6374 7572 6553 6574 2069 6e73  StructureSet ins
-0004e860: 7465 6164 206f 6620 696d 6167 650a 0a0a  tead of image...
-0004e870: 6465 6620 6469 636f 6d5f 6461 7461 7365  def dicom_datase
-0004e880: 745f 746f 5f73 7472 7563 7475 7265 5f73  t_to_structure_s
-0004e890: 6574 2864 7329 3a0a 2020 2020 2727 2743  et(ds):.    '''C
-0004e8a0: 6f6e 7665 7274 2061 6e20 6578 6973 7469  onvert an existi
-0004e8b0: 6e67 2069 6d61 6765 2064 6963 6f6d 2064  ng image dicom d
-0004e8c0: 6174 6173 6574 2074 6f20 6120 5374 7275  ataset to a Stru
-0004e8d0: 6374 7572 6553 6574 2064 6174 6173 6574  ctureSet dataset
-0004e8e0: 2e27 2727 0a0a 2020 2020 2320 4164 6a75  .'''..    # Adju
-0004e8f0: 7374 2063 6c61 7373 2055 4944 730a 2020  st class UIDs.  
-0004e900: 2020 6473 2e66 696c 655f 6d65 7461 2e49    ds.file_meta.I
-0004e910: 6d70 6c65 6d65 6e74 6174 696f 6e43 6c61  mplementationCla
-0004e920: 7373 5549 4420 3d20 2239 2e39 2e39 2e31  ssUID = "9.9.9.1
-0004e930: 3030 2e30 2e30 2e31 2e30 2e39 2e36 2e30  00.0.0.1.0.9.6.0
-0004e940: 2e30 2e31 220a 2020 2020 6473 2e66 696c  .0.1".    ds.fil
-0004e950: 655f 6d65 7461 2e4d 6564 6961 5374 6f72  e_meta.MediaStor
-0004e960: 6167 6553 4f50 436c 6173 7355 4944 203d  ageSOPClassUID =
-0004e970: 2022 312e 322e 3834 302e 3130 3030 382e   "1.2.840.10008.
-0004e980: 352e 312e 342e 312e 312e 3438 312e 3322  5.1.4.1.1.481.3"
-0004e990: 0a0a 2020 2020 2320 4173 7369 676e 2065  ..    # Assign e
-0004e9a0: 6d70 7479 2073 6571 7565 6e63 6573 0a20  mpty sequences. 
-0004e9b0: 2020 2064 732e 5265 6665 7265 6e63 6564     ds.Referenced
-0004e9c0: 4672 616d 656f 6652 6566 6572 656e 6365  FrameofReference
-0004e9d0: 5365 7175 656e 6365 203d 2053 6571 7565  Sequence = Seque
-0004e9e0: 6e63 6528 290a 2020 2020 6473 2e53 7472  nce().    ds.Str
-0004e9f0: 7563 7475 7265 5365 7452 4f49 5365 7175  uctureSetROISequ
-0004ea00: 656e 6365 203d 2053 6571 7565 6e63 6528  ence = Sequence(
-0004ea10: 290a 2020 2020 6473 2e52 5452 4f49 4f62  ).    ds.RTROIOb
-0004ea20: 7365 7276 6174 696f 6e73 5365 7175 656e  servationsSequen
-0004ea30: 6365 203d 2053 6571 7565 6e63 6528 290a  ce = Sequence().
-0004ea40: 2020 2020 6473 2e52 4f49 436f 6e74 6f75      ds.ROIContou
-0004ea50: 7253 6571 7565 6e63 6520 3d20 5365 7175  rSequence = Sequ
-0004ea60: 656e 6365 2829 0a0a 2020 2020 2320 4173  ence()..    # As
-0004ea70: 7369 676e 2073 7472 7563 7475 7265 2073  sign structure s
-0004ea80: 6574 2070 726f 7065 7274 6965 730a 2020  et properties.  
-0004ea90: 2020 6473 2e53 7472 7563 7475 7265 5365    ds.StructureSe
-0004eaa0: 744c 6162 656c 203d 2022 220a 2020 2020  tLabel = "".    
-0004eab0: 6473 2e53 7472 7563 7475 7265 5365 7444  ds.StructureSetD
-0004eac0: 6174 6520 3d20 6473 2e49 6e73 7461 6e63  ate = ds.Instanc
-0004ead0: 6543 7265 6174 696f 6e44 6174 650a 2020  eCreationDate.  
-0004eae0: 2020 6473 2e53 7472 7563 7475 7265 5365    ds.StructureSe
-0004eaf0: 7454 696d 6520 3d20 6473 2e49 6e73 7461  tTime = ds.Insta
-0004eb00: 6e63 6543 7265 6174 696f 6e54 696d 650a  nceCreationTime.
-0004eb10: 0a20 2020 2023 2041 7373 6967 6e20 6672  .    # Assign fr
-0004eb20: 616d 6520 6f66 2072 6566 6572 656e 6365  ame of reference
-0004eb30: 0a0a 0a64 6566 2063 7265 6174 655f 6475  ...def create_du
-0004eb40: 6d6d 795f 696d 6167 6528 0a20 2020 2065  mmy_image(.    e
-0004eb50: 7874 656e 7473 2c20 0a20 2020 2073 6c69  xtents, .    sli
-0004eb60: 6365 5f74 6869 636b 6e65 7373 2c0a 2020  ce_thickness,.  
-0004eb70: 2020 7368 6170 653d 4e6f 6e65 2c20 0a20    shape=None, . 
-0004eb80: 2020 2076 6f78 656c 5f73 697a 653d 4e6f     voxel_size=No
-0004eb90: 6e65 2c0a 2020 2020 6669 6c6c 5f76 616c  ne,.    fill_val
-0004eba0: 3d31 6534 2c0a 2020 2020 6275 6666 6572  =1e4,.    buffer
-0004ebb0: 3d32 0a29 3a0a 2020 2020 2222 224d 616b  =2.):.    """Mak
-0004ebc0: 6520 6120 6475 6d6d 7920 696d 6167 6520  e a dummy image 
-0004ebd0: 7468 6174 2063 6f76 6572 7320 7468 6520  that covers the 
-0004ebe0: 6172 6561 2073 7061 6e6e 6564 2062 7920  area spanned by 
-0004ebf0: 3c65 7874 656e 7473 3e20 706c 7573 2061  <extents> plus a
-0004ec00: 200a 2020 2020 6275 6666 6572 2e0a 0a20   .    buffer... 
-0004ec10: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-0004ec20: 2a2a 0a20 2020 200a 2020 2020 6578 7465  **.    .    exte
-0004ec30: 6e74 7320 3a20 6c69 7374 0a20 2020 2020  nts : list.     
-0004ec40: 2020 204c 6973 7420 6f66 205b 6d69 6e2c     List of [min,
-0004ec50: 206d 6178 5d20 6578 7465 6e74 7320 696e   max] extents in
-0004ec60: 206d 6d20 616c 6f6e 6720 6561 6368 206f   mm along each o
-0004ec70: 6620 7468 6520 7468 7265 6520 6178 6573  f the three axes
-0004ec80: 2069 6e20 0a20 2020 2020 2020 206f 7264   in .        ord
-0004ec90: 6572 205b 782c 2079 2c20 7a5d 2e0a 0a20  er [x, y, z]... 
-0004eca0: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
-0004ecb0: 7373 203a 2066 6c6f 6174 0a20 2020 2020  ss : float.     
-0004ecc0: 2020 2053 6c69 6365 2074 6869 636b 6e65     Slice thickne
-0004ecd0: 7373 2069 6e20 6d6d 2e0a 0a20 2020 2076  ss in mm...    v
-0004ece0: 6f78 656c 5f73 697a 6520 3a20 6c69 7374  oxel_size : list
-0004ecf0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0004ed00: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
-0004ed10: 6520 696e 206d 6d20 696e 2074 6865 2064  e in mm in the d
-0004ed20: 756d 6d79 2069 6d61 6765 2069 6e20 7468  ummy image in th
-0004ed30: 6520 782d 7920 706c 616e 652c 2067 6976  e x-y plane, giv
-0004ed40: 656e 2061 7320 0a20 2020 2020 2020 205b  en as .        [
-0004ed50: 7678 2c20 7679 5d2e 2049 6620 3c73 6861  vx, vy]. If <sha
-0004ed60: 7065 3e20 616e 6420 3c76 6f78 656c 5f73  pe> and <voxel_s
-0004ed70: 697a 653e 2061 7265 2062 6f74 6820 4e6f  ize> are both No
-0004ed80: 6e65 2c20 766f 7865 6c20 7369 7a65 7320  ne, voxel sizes 
-0004ed90: 6f66 0a20 2020 2020 2020 205b 312c 2031  of.        [1, 1
-0004eda0: 5d20 7769 6c6c 2062 6520 7573 6564 2062  ] will be used b
-0004edb0: 7920 6465 6661 756c 742e 2054 6865 2076  y default. The v
-0004edc0: 6f78 656c 2073 697a 6520 696e 2074 6865  oxel size in the
-0004edd0: 207a 2064 6972 6563 7469 6f6e 200a 2020   z direction .  
-0004ede0: 2020 2020 2020 7769 6c6c 2062 6520 7461        will be ta
-0004edf0: 6b65 6e20 6672 6f6d 2074 6865 206d 696e  ken from the min
-0004ee00: 696d 756d 2064 6973 7461 6e63 6520 6265  imum distance be
-0004ee10: 7477 6565 6e20 736c 6963 6520 706f 7369  tween slice posi
-0004ee20: 7469 6f6e 7320 696e 200a 2020 2020 2020  tions in .      
-0004ee30: 2020 7468 6520 782d 7920 636f 6e74 6f75    the x-y contou
-0004ee40: 7273 2064 6963 7469 6f6e 6172 792e 0a0a  rs dictionary...
-0004ee50: 2020 2020 7368 6170 6520 3a20 6c69 7374      shape : list
-0004ee60: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0004ee70: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-0004ee80: 2076 6f78 656c 7320 696e 2074 6865 2064   voxels in the d
-0004ee90: 756d 6d79 2069 6d61 6765 2069 6e20 7468  ummy image in th
-0004eea0: 6520 782d 7920 706c 616e 652c 2067 6976  e x-y plane, giv
-0004eeb0: 656e 2061 730a 2020 2020 2020 2020 5b6e  en as.        [n
-0004eec0: 782c 206e 795d 2e20 4f6e 6c79 2075 7365  x, ny]. Only use
-0004eed0: 6420 6966 203c 766f 7865 6c5f 7369 7a65  d if <voxel_size
-0004eee0: 3e20 6973 204e 6f6e 652e 200a 2020 2020  > is None. .    
-0004eef0: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
-0004ef00: 6620 766f 7865 6c73 2069 6e20 7468 6520  f voxels in the 
-0004ef10: 7a20 6469 7265 6374 696f 6e20 7769 6c6c  z direction will
-0004ef20: 2062 6520 7461 6b65 6e20 6672 6f6d 2074   be taken from t
-0004ef30: 6865 200a 2020 2020 2020 2020 6e75 6d62  he .        numb
-0004ef40: 6572 206f 6620 736c 6963 6573 2069 6e20  er of slices in 
-0004ef50: 7468 6520 782d 7920 636f 6e74 6f75 7273  the x-y contours
-0004ef60: 2064 6963 7469 6f6e 6172 792e 0a0a 2020   dictionary...  
-0004ef70: 2020 6669 6c6c 5f76 616c 203a 2069 6e74    fill_val : int
-0004ef80: 2f66 6c6f 6174 2c20 6465 6661 756c 743d  /float, default=
-0004ef90: 3165 340a 2020 2020 2020 2020 5661 6c75  1e4.        Valu
-0004efa0: 6520 7769 7468 2077 6869 6368 2074 6865  e with which the
-0004efb0: 2076 6f78 656c 7320 696e 2074 6865 2064   voxels in the d
-0004efc0: 756d 6d79 2069 6d61 6765 2073 686f 756c  ummy image shoul
-0004efd0: 6420 6265 2066 696c 6c65 642e 200a 0a20  d be filled. .. 
-0004efe0: 2020 2062 7566 6665 7220 3a20 666c 6f61     buffer : floa
-0004eff0: 742c 2064 6566 6175 6c74 3d32 0a20 2020  t, default=2.   
-0004f000: 2020 2020 2042 7566 6665 7220 616d 6f75       Buffer amou
-0004f010: 6e74 206f 6620 7768 6974 6573 7061 6365  nt of whitespace
-0004f020: 2069 6e20 6d6d 2074 6f20 6164 6420 6f75   in mm to add ou
-0004f030: 7473 6964 6520 7468 6520 524f 4920 696e  tside the ROI in
-0004f040: 2065 6163 6820 0a20 2020 2020 2020 2064   each .        d
-0004f050: 6972 6563 7469 6f6e 2e0a 2020 2020 2222  irection..    ""
-0004f060: 220a 0a20 2020 2023 2041 7373 6967 6e20  "..    # Assign 
-0004f070: 6465 6661 756c 7420 766f 7865 6c20 7369  default voxel si
-0004f080: 7a65 0a20 2020 2069 6620 7368 6170 6520  ze.    if shape 
-0004f090: 6973 204e 6f6e 6520 616e 6420 766f 7865  is None and voxe
-0004f0a0: 6c5f 7369 7a65 2069 7320 4e6f 6e65 3a0a  l_size is None:.
-0004f0b0: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-0004f0c0: 7a65 203d 205b 312c 2031 5d0a 2020 2020  ze = [1, 1].    
-0004f0d0: 6966 206e 6f74 2073 6b72 742e 636f 7265  if not skrt.core
-0004f0e0: 2e69 735f 6c69 7374 2876 6f78 656c 5f73  .is_list(voxel_s
-0004f0f0: 697a 6529 3a0a 2020 2020 2020 2020 766f  ize):.        vo
-0004f100: 7865 6c5f 7369 7a65 203d 205b 766f 7865  xel_size = [voxe
-0004f110: 6c5f 7369 7a65 5d20 2a20 320a 0a20 2020  l_size] * 2..   
-0004f120: 2023 2043 616c 6375 6c61 7465 2076 6f78   # Calculate vox
-0004f130: 656c 2073 697a 6573 2066 726f 6d20 7368  el sizes from sh
-0004f140: 6170 650a 2020 2020 6966 2073 6861 7065  ape.    if shape
-0004f150: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0004f160: 2020 2020 2020 7368 6170 6520 3d20 6c69        shape = li
-0004f170: 7374 2873 6861 7065 290a 2020 2020 2020  st(shape).      
-0004f180: 2020 6966 206c 656e 2873 6861 7065 2920    if len(shape) 
-0004f190: 213d 2032 3a0a 2020 2020 2020 2020 2020  != 2:.          
-0004f1a0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-0004f1b0: 7228 2253 6861 7065 2073 686f 756c 6420  r("Shape should 
-0004f1c0: 6265 2061 206c 6973 7420 6f66 2074 776f  be a list of two
-0004f1d0: 2076 616c 7565 7320 220a 2020 2020 2020   values ".      
-0004f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f1f0: 2020 2020 2020 2273 7065 6369 6679 696e        "specifyin
-0004f200: 6720 6475 6d6d 7920 696d 6167 6520 7368  g dummy image sh
-0004f210: 6170 6520 696e 2074 6865 205b 782c 2079  ape in the [x, y
-0004f220: 5d20 220a 2020 2020 2020 2020 2020 2020  ] ".            
-0004f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f240: 2264 6972 6563 7469 6f6e 732e 2229 0a0a  "directions.")..
-0004f250: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-0004f260: 6174 6520 766f 7865 6c20 7369 7a65 2069  ate voxel size i
-0004f270: 6620 524f 4920 6578 7465 6e74 2070 6c75  f ROI extent plu
-0004f280: 7320 6275 6666 6572 2069 7320 6469 7669  s buffer is divi
-0004f290: 6465 6420 6279 2073 6861 7065 0a20 2020  ded by shape.   
-0004f2a0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
-0004f2b0: 3d20 5b28 6d61 7828 6578 2920 2d20 6d69  = [(max(ex) - mi
-0004f2c0: 6e28 6578 2920 2b20 3220 2a20 6275 6666  n(ex) + 2 * buff
-0004f2d0: 6572 2920 2f20 7368 6170 655b 695d 0a20  er) / shape[i]. 
-0004f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f2f0: 2020 2020 2066 6f72 2069 2c20 6578 2069       for i, ex i
-0004f300: 6e20 656e 756d 6572 6174 6528 6578 7465  n enumerate(exte
-0004f310: 6e74 735b 3a32 5d29 5d0a 0a20 2020 2023  nts[:2])]..    #
-0004f320: 204f 7468 6572 7769 7365 2c20 6361 6c63   Otherwise, calc
-0004f330: 756c 6174 6520 7368 6170 6520 6672 6f6d  ulate shape from
-0004f340: 2076 6f78 656c 2073 697a 6573 0a20 2020   voxel sizes.   
-0004f350: 2065 6c73 653a 0a20 2020 2020 2020 2076   else:.        v
-0004f360: 6f78 656c 5f73 697a 6520 3d20 6c69 7374  oxel_size = list
-0004f370: 2876 6f78 656c 5f73 697a 6529 0a20 2020  (voxel_size).   
-0004f380: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
-0004f390: 4361 6c63 756c 6174 6520 6e75 6d62 6572  Calculate number
-0004f3a0: 206f 6620 766f 7865 6c73 206e 6565 6465   of voxels neede
-0004f3b0: 6420 746f 2063 6f76 6572 2052 4f49 2070  d to cover ROI p
-0004f3c0: 6c75 7320 6275 6666 6572 2065 6163 6820  lus buffer each 
-0004f3d0: 7369 6465 0a20 2020 2020 2020 2073 6861  side.        sha
-0004f3e0: 7065 203d 205b 286e 702e 6365 696c 2828  pe = [(np.ceil((
-0004f3f0: 6d61 7828 6578 2920 2d20 6d69 6e28 6578  max(ex) - min(ex
-0004f400: 2929 202b 2032 202a 2062 7566 6665 7229  )) + 2 * buffer)
-0004f410: 202f 2076 6f78 656c 5f73 697a 655b 695d   / voxel_size[i]
-0004f420: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
-0004f430: 2020 2020 666f 7220 692c 2065 7820 696e      for i, ex in
-0004f440: 2065 6e75 6d65 7261 7465 2865 7874 656e   enumerate(exten
-0004f450: 7473 5b3a 325d 295d 0a0a 2020 2020 2320  ts[:2])]..    # 
-0004f460: 4765 7420 7a20 766f 7865 6c20 7369 7a65  Get z voxel size
-0004f470: 2061 6e64 2073 6861 7065 0a20 2020 2076   and shape.    v
-0004f480: 6f78 656c 5f73 697a 652e 6170 7065 6e64  oxel_size.append
-0004f490: 2873 6c69 6365 5f74 6869 636b 6e65 7373  (slice_thickness
-0004f4a0: 290a 2020 2020 7368 6170 655f 7a20 3d20  ).    shape_z = 
-0004f4b0: 286d 6178 2865 7874 656e 7473 5b32 5d29  (max(extents[2])
-0004f4c0: 202d 206d 696e 2865 7874 656e 7473 5b32   - min(extents[2
-0004f4d0: 5d29 2920 2f20 736c 6963 655f 7468 6963  ])) / slice_thic
-0004f4e0: 6b6e 6573 730a 0a20 2020 2023 2041 6464  kness..    # Add
-0004f4f0: 206e 6561 7265 7374 2069 6e74 6567 6572   nearest integer
-0004f500: 206e 756d 6265 7220 6f66 2062 7566 6665   number of buffe
-0004f510: 7220 766f 7865 6c73 0a20 2020 206e 5f62  r voxels.    n_b
-0004f520: 7566 665f 7a20 3d20 6e70 2e63 6569 6c28  uff_z = np.ceil(
-0004f530: 6275 6666 6572 202f 2073 6c69 6365 5f74  buffer / slice_t
-0004f540: 6869 636b 6e65 7373 290a 2020 2020 7368  hickness).    sh
-0004f550: 6170 652e 6170 7065 6e64 2873 6861 7065  ape.append(shape
-0004f560: 5f7a 202b 2032 202a 206e 5f62 7566 665f  _z + 2 * n_buff_
-0004f570: 7a29 0a20 2020 2073 6861 7065 203d 205b  z).    shape = [
-0004f580: 696e 7428 7329 2066 6f72 2073 2069 6e20  int(s) for s in 
-0004f590: 7368 6170 655d 0a0a 2020 2020 2320 4765  shape]..    # Ge
-0004f5a0: 7420 6f72 6967 696e 2070 6f73 6974 696f  t origin positio
-0004f5b0: 6e3b 2065 6e73 7572 6520 7468 6174 206f  n; ensure that o
-0004f5c0: 7269 6769 6e20 706f 696e 7473 2074 6f20  rigin points to 
-0004f5d0: 6365 6e74 7265 206f 6620 6275 6666 6572  centre of buffer
-0004f5e0: 2076 6f78 656c 200a 2020 2020 2320 6f75   voxel .    # ou
-0004f5f0: 7473 6964 6520 524f 490a 2020 2020 6f72  tside ROI.    or
-0004f600: 6967 696e 203d 205b 6d69 6e28 6578 2920  igin = [min(ex) 
-0004f610: 2b20 6162 7328 766f 7865 6c5f 7369 7a65  + abs(voxel_size
-0004f620: 5b69 5d29 202a 2030 2e35 202d 2062 7566  [i]) * 0.5 - buf
-0004f630: 6665 720a 2020 2020 2020 2020 2020 2020  fer.            
-0004f640: 2020 666f 7220 692c 2065 7820 696e 2065    for i, ex in e
-0004f650: 6e75 6d65 7261 7465 2865 7874 656e 7473  numerate(extents
-0004f660: 5b3a 325d 295d 0a20 2020 206f 7269 6769  [:2])].    origi
-0004f670: 6e2e 6170 7065 6e64 286d 696e 2865 7874  n.append(min(ext
-0004f680: 656e 7473 5b32 5d29 202d 2061 6273 2873  ents[2]) - abs(s
-0004f690: 6c69 6365 5f74 6869 636b 6e65 7373 2920  lice_thickness) 
-0004f6a0: 2a20 286e 5f62 7566 665f 7a20 2d20 302e  * (n_buff_z - 0.
-0004f6b0: 3529 290a 0a20 2020 2023 2043 7265 6174  5))..    # Creat
-0004f6c0: 6520 696d 6167 650a 2020 2020 7265 7475  e image.    retu
-0004f6d0: 726e 2073 6b72 742e 696d 6167 652e 496d  rn skrt.image.Im
-0004f6e0: 6167 6528 0a20 2020 2020 2020 206e 702e  age(.        np.
-0004f6f0: 6f6e 6573 2828 7368 6170 655b 315d 2c20  ones((shape[1], 
-0004f700: 7368 6170 655b 305d 2c20 7368 6170 655b  shape[0], shape[
-0004f710: 325d 2929 202a 2066 696c 6c5f 7661 6c2c  2])) * fill_val,
-0004f720: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
-0004f730: 697a 653d 766f 7865 6c5f 7369 7a65 2c0a  ize=voxel_size,.
-0004f740: 2020 2020 2020 2020 6f72 6967 696e 3d6f          origin=o
-0004f750: 7269 6769 6e0a 2020 2020 290a 0a0a 6465  rigin.    )...de
-0004f760: 6620 6372 6561 7465 5f73 7461 706c 6528  f create_staple(
-0004f770: 726f 6973 2c20 2a2a 6b77 6172 6773 293a  rois, **kwargs):
-0004f780: 0a20 2020 2022 2222 4372 6561 7465 2053  .    """Create S
-0004f790: 5441 504c 4520 524f 4920 6672 6f6d 206c  TAPLE ROI from l
-0004f7a0: 6973 7420 6f66 2052 4f49 732e 2222 220a  ist of ROIs.""".
-0004f7b0: 0a20 2020 2023 2054 7279 2069 6d70 6f72  .    # Try impor
-0004f7c0: 7420 5369 6d70 6c65 4954 4b0a 2020 2020  t SimpleITK.    
-0004f7d0: 7472 793a 0a20 2020 2020 2020 2069 6d70  try:.        imp
-0004f7e0: 6f72 7420 5369 6d70 6c65 4954 4b20 6173  ort SimpleITK as
-0004f7f0: 2073 6974 6b0a 2020 2020 6578 6365 7074   sitk.    except
-0004f800: 204d 6f64 756c 654e 6f74 466f 756e 6445   ModuleNotFoundE
-0004f810: 7272 6f72 3a0a 2020 2020 2020 2020 7261  rror:.        ra
-0004f820: 6973 6520 4d6f 6475 6c65 4e6f 7446 6f75  ise ModuleNotFou
-0004f830: 6e64 4572 726f 7228 2253 696d 706c 6549  ndError("SimpleI
-0004f840: 544b 2069 7320 7265 7175 6972 6564 2074  TK is required t
-0004f850: 6f20 6361 6c63 756c 6174 6520 5354 4150  o calculate STAP
-0004f860: 4c45 2063 6f6e 746f 7572 2e20 220a 2020  LE contour. ".  
-0004f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f890: 2254 7279 2069 6e73 7461 6c6c 696e 6720  "Try installing 
-0004f8a0: 7669 613a 2070 6970 2069 6e73 7461 6c6c  via: pip install
-0004f8b0: 2073 696d 706c 6569 746b 2229 0a0a 2020   simpleitk")..  
-0004f8c0: 2020 2320 4765 7420 5354 4150 4c45 206d    # Get STAPLE m
-0004f8d0: 6173 6b0a 2020 2020 726f 695f 6172 7261  ask.    roi_arra
-0004f8e0: 7973 203d 205b 5d0a 2020 2020 666f 7220  ys = [].    for 
-0004f8f0: 726f 6920 696e 2072 6f69 733a 0a20 2020  roi in rois:.   
-0004f900: 2020 2020 2072 6f69 5f61 7272 6179 732e       roi_arrays.
-0004f910: 6170 7065 6e64 2873 6974 6b2e 4765 7449  append(sitk.GetI
-0004f920: 6d61 6765 4672 6f6d 4172 7261 7928 726f  mageFromArray(ro
-0004f930: 692e 6765 745f 6d61 736b 280a 2020 2020  i.get_mask(.    
-0004f940: 2020 2020 2020 2020 7374 616e 6461 7264          standard
-0004f950: 6973 653d 5472 7565 292e 6173 7479 7065  ise=True).astype
-0004f960: 2869 6e74 2929 290a 2020 2020 7072 6f62  (int))).    prob
-0004f970: 7320 3d20 7369 746b 2e47 6574 4172 7261  s = sitk.GetArra
-0004f980: 7946 726f 6d49 6d61 6765 2873 6974 6b2e  yFromImage(sitk.
-0004f990: 5354 4150 4c45 2872 6f69 5f61 7272 6179  STAPLE(roi_array
-0004f9a0: 732c 2031 2929 0a20 2020 206d 6173 6b20  s, 1)).    mask 
-0004f9b0: 3d20 7072 6f62 7320 3e20 302e 3935 0a0a  = probs > 0.95..
-0004f9c0: 2020 2020 2320 4372 6561 7465 2053 5441      # Create STA
-0004f9d0: 504c 4520 524f 4920 6f62 6a65 6374 0a20  PLE ROI object. 
-0004f9e0: 2020 2072 6574 7572 6e20 524f 4928 6d61     return ROI(ma
-0004f9f0: 736b 2c20 2a2a 6b77 6172 6773 290a 0a0a  sk, **kwargs)...
-0004fa00: 6465 6620 6372 6561 7465 5f6d 616a 6f72  def create_major
-0004fa10: 6974 795f 766f 7465 2872 6f69 732c 202a  ity_vote(rois, *
-0004fa20: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
-0004fa30: 2243 7265 6174 6520 6d61 6a6f 7269 7479  "Create majority
-0004fa40: 2076 6f74 6520 524f 4920 6672 6f6d 206c   vote ROI from l
-0004fa50: 6973 7420 6f66 2052 4f49 732e 2222 220a  ist of ROIs.""".
-0004fa60: 0a20 2020 206d 6173 6b20 3d20 726f 6973  .    mask = rois
-0004fa70: 5b30 5d2e 6765 745f 6d61 736b 2873 7461  [0].get_mask(sta
-0004fa80: 6e64 6172 6469 7365 3d54 7275 6529 2e61  ndardise=True).a
-0004fa90: 7374 7970 6528 696e 7429 0a20 2020 2066  stype(int).    f
-0004faa0: 6f72 2072 6f69 2069 6e20 726f 6973 5b31  or roi in rois[1
-0004fab0: 3a5d 3a0a 2020 2020 2020 2020 6d61 736b  :]:.        mask
-0004fac0: 202b 3d20 726f 692e 6765 745f 6d61 736b   += roi.get_mask
-0004fad0: 2873 7461 6e64 6172 6469 7365 3d54 7275  (standardise=Tru
-0004fae0: 6529 2e61 7374 7970 6528 696e 7429 0a20  e).astype(int). 
-0004faf0: 2020 206d 6173 6b20 3d20 6d61 736b 203e     mask = mask >
-0004fb00: 3d20 6c65 6e28 726f 6973 2920 2f20 320a  = len(rois) / 2.
-0004fb10: 2020 2020 7265 7475 726e 2052 4f49 286d      return ROI(m
-0004fb20: 6173 6b2c 202a 2a6b 7761 7267 7329 0a0a  ask, **kwargs)..
-0004fb30: 0a64 6566 2063 7265 6174 655f 726f 695f  .def create_roi_
-0004fb40: 7375 6d28 726f 6973 2c20 2a2a 6b77 6172  sum(rois, **kwar
-0004fb50: 6773 293a 0a20 2020 2022 2222 4372 6561  gs):.    """Crea
-0004fb60: 7465 2052 4f49 2066 726f 6d20 7375 6d20  te ROI from sum 
-0004fb70: 6f66 206c 6973 7420 6f66 2052 4f49 732e  of list of ROIs.
-0004fb80: 2222 220a 0a20 2020 206d 6173 6b20 3d20  """..    mask = 
-0004fb90: 726f 6973 5b30 5d2e 6765 745f 6d61 736b  rois[0].get_mask
-0004fba0: 2873 7461 6e64 6172 6469 7365 3d54 7275  (standardise=Tru
-0004fbb0: 6529 2e63 6f70 7928 290a 2020 2020 666f  e).copy().    fo
-0004fbc0: 7220 726f 6920 696e 2072 6f69 735b 313a  r roi in rois[1:
-0004fbd0: 5d3a 0a20 2020 2020 2020 206d 6173 6b20  ]:.        mask 
-0004fbe0: 2b3d 2072 6f69 2e67 6574 5f6d 6173 6b28  += roi.get_mask(
-0004fbf0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
-0004fc00: 290a 2020 2020 7265 7475 726e 2052 4f49  ).    return ROI
-0004fc10: 286d 6173 6b2c 202a 2a6b 7761 7267 7329  (mask, **kwargs)
-0004fc20: 0a0a 0a64 6566 2063 7265 6174 655f 726f  ...def create_ro
-0004fc30: 695f 6f76 6572 6c61 7028 726f 6973 2c20  i_overlap(rois, 
-0004fc40: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-0004fc50: 2222 4372 6561 7465 2052 4f49 2066 726f  ""Create ROI fro
-0004fc60: 6d20 6f76 6572 6c61 7020 6f66 206c 6973  m overlap of lis
-0004fc70: 7420 6f66 2052 4f49 732e 2222 220a 0a20  t of ROIs.""".. 
-0004fc80: 2020 206d 6173 6b20 3d20 726f 6973 5b30     mask = rois[0
-0004fc90: 5d2e 6765 745f 6d61 736b 2873 7461 6e64  ].get_mask(stand
-0004fca0: 6172 6469 7365 3d54 7275 6529 2e63 6f70  ardise=True).cop
-0004fcb0: 7928 290a 2020 2020 666f 7220 726f 6920  y().    for roi 
-0004fcc0: 696e 2072 6f69 735b 313a 5d3a 0a20 2020  in rois[1:]:.   
-0004fcd0: 2020 2020 206d 6173 6b20 2a3d 2072 6f69       mask *= roi
-0004fce0: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
-0004fcf0: 7264 6973 653d 5472 7565 290a 2020 2020  rdise=True).    
-0004fd00: 7265 7475 726e 2052 4f49 286d 6173 6b2c  return ROI(mask,
-0004fd10: 202a 2a6b 7761 7267 7329 0a0a 0a64 6566   **kwargs)...def
-0004fd20: 2064 665f 746f 5f68 746d 6c28 6466 293a   df_to_html(df):
-0004fd30: 0a20 2020 2022 2222 436f 6e76 6572 7420  .    """Convert 
-0004fd40: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
-0004fd50: 6d65 2074 6f20 6874 6d6c 2e22 2222 0a0a  me to html."""..
-0004fd60: 2020 2020 2320 436f 6e76 6572 7420 6461      # Convert da
-0004fd70: 7461 6672 616d 6520 746f 2048 544d 4c0a  taframe to HTML.
-0004fd80: 2020 2020 6874 6d6c 203d 2064 662e 6669      html = df.fi
-0004fd90: 6c6c 6e61 2827 e280 9427 292e 746f 5f68  llna('...').to_h
-0004fda0: 746d 6c28 696e 6465 783d 4661 6c73 6529  tml(index=False)
-0004fdb0: 0a20 2020 2068 746d 6c20 3d20 6874 6d6c  .    html = html
-0004fdc0: 2e72 6570 6c61 6365 2822 5e33 222c 2022  .replace("^3", "
-0004fdd0: 3c73 7570 3e33 3c2f 7375 703e 2229 2e72  <sup>3</sup>").r
-0004fde0: 6570 6c61 6365 2822 5e32 222c 2022 3c73  eplace("^2", "<s
-0004fdf0: 7570 3e32 3c2f 7375 703e 2229 0a0a 2020  up>2</sup>")..  
-0004fe00: 2020 2320 4164 6420 6865 6164 6572 2077    # Add header w
-0004fe10: 6974 6820 7374 796c 6520 6465 7461 696c  ith style detail
-0004fe20: 730a 2020 2020 6865 6164 6572 203d 2022  s.    header = "
-0004fe30: 2222 0a20 2020 2020 2020 203c 6865 6164  "".        <head
-0004fe40: 3e0a 2020 2020 2020 2020 2020 2020 3c73  >.            <s
-0004fe50: 7479 6c65 3e0a 2020 2020 2020 2020 2020  tyle>.          
-0004fe60: 2020 2020 2020 7468 2c20 7464 207b 0a20        th, td {. 
-0004fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fe80: 2020 2070 6164 6469 6e67 3a20 3270 7820     padding: 2px 
-0004fe90: 3270 783b 0a20 2020 2020 2020 2020 2020  2px;.           
-0004fea0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-0004feb0: 2020 2020 2020 2074 6820 7b0a 2020 2020         th {.    
-0004fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fed0: 6261 636b 6772 6f75 6e64 2d63 6f6c 6f72  background-color
-0004fee0: 3a20 7472 616e 7370 6172 656e 743b 0a20  : transparent;. 
-0004fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ff00: 2020 2074 6578 742d 616c 6967 6e3a 2063     text-align: c
-0004ff10: 656e 7465 723b 0a20 2020 2020 2020 2020  enter;.         
-0004ff20: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0004ff30: 2020 2020 203c 2f73 7479 6c65 3e0a 2020       </style>.  
-0004ff40: 2020 2020 2020 3c2f 6865 6164 3e0a 2020        </head>.  
-0004ff50: 2020 2222 220a 2020 2020 7461 626c 655f    """.    table_
-0004ff60: 6874 6d6c 203d 2028 0a20 2020 2020 2020  html = (.       
-0004ff70: 2028 6865 6164 6572 202b 2068 746d 6c29   (header + html)
-0004ff80: 0a20 2020 2020 2020 202e 7265 706c 6163  .        .replac
-0004ff90: 6528 2226 6774 3b22 2c20 223e 2229 0a20  e("&gt;", ">"). 
-0004ffa0: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
-0004ffb0: 2226 6c74 3b22 2c20 223c 2229 0a20 2020  "&lt;", "<").   
-0004ffc0: 2020 2020 202e 7265 706c 6163 6528 2226       .replace("&
-0004ffd0: 616d 703b 222c 2022 2622 290a 2020 2020  amp;", "&").    
-0004ffe0: 290a 2020 2020 7265 7475 726e 2074 6162  ).    return tab
-0004fff0: 6c65 5f68 746d 6c0a 0a0a 6465 6620 6265  le_html...def be
-00050000: 7374 5f74 6578 745f 636f 6c6f 7228 7265  st_text_color(re
-00050010: 642c 2067 7265 656e 2c20 626c 7565 293a  d, green, blue):
-00050020: 0a20 2020 2069 6620 2872 6564 202a 2030  .    if (red * 0
-00050030: 2e32 3939 202b 2067 7265 656e 202a 2030  .299 + green * 0
-00050040: 2e35 3837 202b 2062 6c75 6520 2a20 302e  .587 + blue * 0.
-00050050: 3131 3429 203e 2031 3836 3a0a 2020 2020  114) > 186:.    
-00050060: 2020 2020 7265 7475 726e 2022 626c 6163      return "blac
-00050070: 6b22 0a20 2020 2072 6574 7572 6e20 2277  k".    return "w
-00050080: 6869 7465 220a 0a0a 6465 6620 6765 745f  hite"...def get_
-00050090: 636f 6c6f 7265 645f 726f 695f 7374 7269  colored_roi_stri
-000500a0: 6e67 2872 6f69 2c20 6772 6579 3d46 616c  ng(roi, grey=Fal
-000500b0: 7365 2c20 636f 6c6f 723d 4e6f 6e65 293a  se, color=None):
-000500c0: 0a20 2020 2022 2222 4765 7420 524f 4920  .    """Get ROI 
-000500d0: 6e61 6d65 2069 6e20 4854 4d4c 2077 6974  name in HTML wit
-000500e0: 6820 6261 636b 6772 6f75 6e64 2063 6f6c  h background col
-000500f0: 6f72 2066 726f 6d20 726f 692e 636f 6c6f  or from roi.colo
-00050100: 722e 2049 6620 6772 6579 3d54 7275 652c  r. If grey=True,
-00050110: 0a20 2020 2074 6865 2062 6163 6b67 726f  .    the backgro
-00050120: 756e 6420 636f 6c6f 7220 7769 6c6c 2062  und color will b
-00050130: 6520 6772 6579 2e22 2222 0a0a 2020 2020  e grey."""..    
-00050140: 6966 2063 6f6c 6f72 2069 7320 4e6f 6e65  if color is None
-00050150: 3a0a 2020 2020 2020 2020 636f 6c6f 7220  :.        color 
-00050160: 3d20 726f 692e 636f 6c6f 720a 2020 2020  = roi.color.    
-00050170: 6966 2067 7265 793a 0a20 2020 2020 2020  if grey:.       
-00050180: 2072 6564 2c20 6772 6565 6e2c 2062 6c75   red, green, blu
-00050190: 6520 3d20 3235 352c 2032 3535 2c20 3235  e = 255, 255, 25
-000501a0: 350a 2020 2020 2020 2020 7265 642c 2067  5.        red, g
-000501b0: 7265 656e 2c20 626c 7565 203d 2031 3238  reen, blue = 128
-000501c0: 2c20 3132 382c 2031 3238 0a20 2020 2020  , 128, 128.     
-000501d0: 2020 2074 6578 745f 636f 6c20 3d20 3230     text_col = 20
-000501e0: 302c 2032 3030 2c20 3230 300a 2020 2020  0, 200, 200.    
-000501f0: 2020 2020 2320 4176 6f69 6420 7365 7474      # Avoid sett
-00050200: 696e 6720 636f 6c6f 7572 2066 6f72 2067  ing colour for g
-00050210: 7265 7965 6420 6f75 7420 524f 4973 2e0a  reyed out ROIs..
-00050220: 2020 2020 2020 2020 2320 5468 6973 2067          # This g
-00050230: 6976 6573 2067 6f6f 6420 7265 6164 6162  ives good readab
-00050240: 696c 6974 7920 666f 7220 626f 7468 2064  ility for both d
-00050250: 6172 6b20 616e 6420 6c69 6768 7420 7468  ark and light th
-00050260: 656d 6573 2e0a 2020 2020 2020 2020 7265  emes..        re
-00050270: 7475 726e 2028 273c 703e 266e 6273 703b  turn ('<p>&nbsp;
-00050280: 7b7d 266e 6273 703b 3c2f 703e 2729 2e66  {}&nbsp;</p>').f
-00050290: 6f72 6d61 7428 726f 692e 6e61 6d65 290a  ormat(roi.name).
-000502a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000502b0: 2020 7265 642c 2067 7265 656e 2c20 626c    red, green, bl
-000502c0: 7565 203d 205b 6320 2a20 3235 3520 666f  ue = [c * 255 fo
-000502d0: 7220 6320 696e 2063 6f6c 6f72 5b3a 335d  r c in color[:3]
-000502e0: 5d0a 2020 2020 2020 2020 7465 7874 5f63  ].        text_c
-000502f0: 6f6c 203d 2062 6573 745f 7465 7874 5f63  ol = best_text_c
-00050300: 6f6c 6f72 2872 6564 2c20 6772 6565 6e2c  olor(red, green,
-00050310: 2062 6c75 6529 0a20 2020 2072 6574 7572   blue).    retur
-00050320: 6e20 280a 2020 2020 2020 2020 273c 7020  n (.        '<p 
-00050330: 7374 796c 653d 2262 6163 6b67 726f 756e  style="backgroun
-00050340: 642d 636f 6c6f 723a 2072 6762 287b 7d2c  d-color: rgb({},
-00050350: 207b 7d2c 207b 7d29 3b20 270a 2020 2020   {}, {}); '.    
-00050360: 2020 2020 2763 6f6c 6f72 3a20 7b7d 3b22      'color: {};"
-00050370: 3e26 6e62 7370 3b7b 7d26 6e62 7370 3b3c  >&nbsp;{}&nbsp;<
-00050380: 2f70 3e27 0a20 2020 2029 2e66 6f72 6d61  /p>'.    ).forma
-00050390: 7428 7265 642c 2067 7265 656e 2c20 626c  t(red, green, bl
-000503a0: 7565 2c20 7465 7874 5f63 6f6c 2c20 726f  ue, text_col, ro
-000503b0: 692e 6e61 6d65 290a 0a64 6566 2063 6f6d  i.name)..def com
-000503c0: 7061 7265 5f72 6f69 5f70 6169 7273 280a  pare_roi_pairs(.
-000503d0: 2020 2020 7061 6972 732c 200a 2020 2020      pairs, .    
-000503e0: 6874 6d6c 3d46 616c 7365 2c0a 2020 2020  html=False,.    
-000503f0: 6e61 6d65 5f61 735f 696e 6465 783d 5472  name_as_index=Tr
-00050400: 7565 2c0a 2020 2020 6772 6579 6564 5f6f  ue,.    greyed_o
-00050410: 7574 3d4e 6f6e 652c 0a20 2020 2063 6f6c  ut=None,.    col
-00050420: 6f72 6564 3d46 616c 7365 2c0a 2020 2020  ored=False,.    
-00050430: 726f 695f 6b77 6172 6773 3d7b 7d2c 0a20  roi_kwargs={},. 
-00050440: 2020 202a 2a6b 7761 7267 730a 293a 0a20     **kwargs.):. 
-00050450: 2020 2069 6620 6874 6d6c 3a0a 2020 2020     if html:.    
-00050460: 2020 2020 6e61 6d65 5f61 735f 696e 6465      name_as_inde
-00050470: 7820 3d20 4661 6c73 650a 2020 2020 6966  x = False.    if
-00050480: 2067 7265 7965 645f 6f75 7420 6973 204e   greyed_out is N
-00050490: 6f6e 653a 0a20 2020 2020 2020 2067 7265  one:.        gre
-000504a0: 7965 645f 6f75 7420 3d20 5b5d 0a20 2020  yed_out = [].   
-000504b0: 2064 6673 203d 205b 5d0a 2020 2020 666f   dfs = [].    fo
-000504c0: 7220 726f 6931 2c20 726f 6932 2069 6e20  r roi1, roi2 in 
-000504d0: 7061 6972 733a 0a0a 2020 2020 2020 2020  pairs:..        
-000504e0: 2320 4765 7420 4461 7461 4672 616d 6520  # Get DataFrame 
-000504f0: 666f 7220 7468 6973 2070 6169 720a 2020  for this pair.  
-00050500: 2020 2020 2020 6466 5f72 6f77 203d 2072        df_row = r
-00050510: 6f69 312e 6765 745f 636f 6d70 6172 6973  oi1.get_comparis
-00050520: 6f6e 2872 6f69 322c 206e 616d 655f 6173  on(roi2, name_as
-00050530: 5f69 6e64 6578 3d6e 616d 655f 6173 5f69  _index=name_as_i
-00050540: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-00050550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050560: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
-00050570: 7267 7329 0a0a 2020 2020 2020 2020 2320  rgs)..        # 
-00050580: 5265 706c 6163 6520 7661 6c75 6573 2077  Replace values w
-00050590: 6974 6820 222d 2d22 2069 6620 6569 7468  ith "--" if eith
-000505a0: 6572 2052 4f49 2069 7320 6772 6579 6564  er ROI is greyed
-000505b0: 206f 7574 0a20 2020 2020 2020 2067 7265   out.        gre
-000505c0: 7920 3d20 726f 6931 2069 6e20 6772 6579  y = roi1 in grey
-000505d0: 6564 5f6f 7574 206f 7220 726f 6932 2069  ed_out or roi2 i
-000505e0: 6e20 6772 6579 6564 5f6f 7574 0a20 2020  n greyed_out.   
-000505f0: 2020 2020 2069 6620 6772 6579 3a0a 2020       if grey:.  
-00050600: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00050610: 6c20 696e 2064 665f 726f 772e 636f 6c75  l in df_row.colu
-00050620: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
-00050630: 2020 2020 2069 6620 636f 6c20 3d3d 2022       if col == "
-00050640: 524f 4922 3a20 0a20 2020 2020 2020 2020  ROI": .         
-00050650: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00050660: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00050670: 2020 2020 6466 5f72 6f77 5b63 6f6c 5d20      df_row[col] 
-00050680: 3d20 222d 2d22 0a0a 2020 2020 2020 2020  = "--"..        
-00050690: 2320 4164 6a75 7374 2063 6f6d 7061 7269  # Adjust compari
-000506a0: 736f 6e20 6e61 6d65 0a20 2020 2020 2020  son name.       
-000506b0: 2063 6f6d 705f 6e61 6d65 203d 2072 6f69   comp_name = roi
-000506c0: 312e 6765 745f 636f 6d70 6172 6973 6f6e  1.get_comparison
-000506d0: 5f6e 616d 6528 726f 6932 2c20 636f 6c6f  _name(roi2, colo
-000506e0: 7265 643d 636f 6c6f 7265 642c 2067 7265  red=colored, gre
-000506f0: 793d 6772 6579 2c0a 2020 2020 2020 2020  y=grey,.        
-00050700: 2020 2020 2020 2020 726f 695f 6b77 6172          roi_kwar
-00050710: 6773 3d72 6f69 5f6b 7761 7267 7329 0a20  gs=roi_kwargs). 
-00050720: 2020 2020 2020 2069 6620 6e61 6d65 5f61         if name_a
-00050730: 735f 696e 6465 783a 0a20 2020 2020 2020  s_index:.       
-00050740: 2020 2020 2064 665f 726f 772e 7265 6e61       df_row.rena
-00050750: 6d65 287b 6466 5f72 6f77 2e69 6e64 6578  me({df_row.index
-00050760: 5b30 5d3a 2063 6f6d 705f 6e61 6d65 7d2c  [0]: comp_name},
-00050770: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
-00050780: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00050790: 2020 2020 2020 2020 2064 665f 726f 772e           df_row.
-000507a0: 696c 6f63 5b30 2c20 305d 203d 2063 6f6d  iloc[0, 0] = com
-000507b0: 705f 6e61 6d65 0a0a 2020 2020 2020 2020  p_name..        
-000507c0: 6466 732e 6170 7065 6e64 2864 665f 726f  dfs.append(df_ro
-000507d0: 7729 0a0a 2020 2020 6967 6e6f 7265 5f69  w)..    ignore_i
-000507e0: 6e64 6578 203d 2046 616c 7365 2069 6620  ndex = False if 
-000507f0: 6e61 6d65 5f61 735f 696e 6465 7820 656c  name_as_index el
-00050800: 7365 2054 7275 650a 2020 2020 6466 203d  se True.    df =
-00050810: 2070 642e 636f 6e63 6174 2864 6673 2c20   pd.concat(dfs, 
-00050820: 6967 6e6f 7265 5f69 6e64 6578 3d69 676e  ignore_index=ign
-00050830: 6f72 655f 696e 6465 7829 2069 6620 6466  ore_index) if df
-00050840: 7320 656c 7365 204e 6f6e 650a 2020 2020  s else None.    
-00050850: 6966 2068 746d 6c3a 0a20 2020 2020 2020  if html:.       
-00050860: 2072 6574 7572 6e20 6466 5f74 6f5f 6874   return df_to_ht
-00050870: 6d6c 2864 6629 0a20 2020 2072 6574 7572  ml(df).    retur
-00050880: 6e20 6466 0a0a 6465 6620 6765 745f 636f  n df..def get_co
-00050890: 6e66 6f72 6d69 7479 5f69 6e64 6578 280a  nformity_index(.
-000508a0: 2020 2020 726f 6973 2c0a 2020 2020 6369      rois,.    ci
-000508b0: 5f74 7970 653d 2267 656e 222c 0a20 2020  _type="gen",.   
-000508c0: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
-000508d0: 6c73 652c 0a20 2020 2076 6965 773d 2278  lse,.    view="x
-000508e0: 2d79 222c 200a 2020 2020 736c 3d4e 6f6e  -y", .    sl=Non
-000508f0: 652c 200a 2020 2020 6964 783d 4e6f 6e65  e, .    idx=None
-00050900: 2c20 0a20 2020 2070 6f73 3d4e 6f6e 652c  , .    pos=None,
-00050910: 200a 2020 2020 6d65 7468 6f64 3d4e 6f6e   .    method=Non
-00050920: 652c 0a20 2020 2066 6c61 7474 656e 3d46  e,.    flatten=F
-00050930: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
-00050940: 2022 2222 0a20 2020 2047 6574 2063 6f6e   """.    Get con
-00050950: 666f 726d 6974 7920 696e 6465 7820 666f  formity index fo
-00050960: 7220 7477 6f20 6f72 206d 6f72 6520 524f  r two or more RO
-00050970: 4973 2e0a 0a20 2020 2054 6865 2063 6f6e  Is...    The con
-00050980: 666f 726d 6974 7920 696e 6465 7820 6d61  formity index ma
-00050990: 7920 6265 2063 616c 6375 6c61 7465 6420  y be calculated 
-000509a0: 676c 6f62 616c 6c79 206f 7220 666f 7220  globally or for 
-000509b0: 6120 7369 6e67 6c65 2073 6c69 6365 2e0a  a single slice..
-000509c0: 0a20 2020 2054 6869 7320 6675 6e63 7469  .    This functi
-000509d0: 6f6e 2072 6574 7572 6e73 2065 6974 6865  on returns eithe
-000509e0: 7220 7468 6520 7661 6c75 6520 6f66 206f  r the value of o
-000509f0: 6e65 206f 6620 7468 6520 7468 7265 6520  ne of the three 
-00050a00: 7479 7065 730a 2020 2020 6f66 2063 6f6e  types.    of con
-00050a10: 666f 726d 6974 7920 696e 6465 7820 2822  formity index ("
-00050a20: 6765 6e22 2028 666f 7220 6765 6e65 7261  gen" (for genera
-00050a30: 6c69 7365 6429 2c20 2270 6169 7273 222c  lised), "pairs",
-00050a40: 2022 636f 6d6d 6f6e 2229 0a20 2020 2072   "common").    r
-00050a50: 6566 6572 7265 6420 746f 2069 6e3a 0a20  eferred to in:. 
-00050a60: 2020 2068 7474 7073 3a2f 2f64 6f69 2e6f     https://doi.o
-00050a70: 7267 2f31 302e 3130 3838 2f30 3033 312d  rg/10.1088/0031-
-00050a80: 3931 3535 2f35 342f 392f 3031 380a 2020  9155/54/9/018.  
-00050a90: 2020 6f72 2061 2073 6b72 742e 636f 7265    or a skrt.core
-00050aa0: 2e44 6174 6120 6f62 6a65 6374 2077 6974  .Data object wit
-00050ab0: 6820 7468 6520 7661 6c75 6573 206f 6620  h the values of 
-00050ac0: 616c 6c20 7468 7265 652e 0a20 2020 2046  all three..    F
-00050ad0: 6f72 2074 6865 2063 6173 6520 6f66 2074  or the case of t
-00050ae0: 776f 2052 4f49 732c 2074 6865 2074 6872  wo ROIs, the thr
-00050af0: 6565 206d 6574 7269 6373 2061 7265 2061  ee metrics are a
-00050b00: 6c6c 2065 7175 6976 616c 656e 740a 2020  ll equivalent.  
-00050b10: 2020 746f 2074 6865 204a 6163 6361 7264    to the Jaccard
-00050b20: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
-00050b30: 782e 0a0a 2020 2020 2a2a 5061 7261 6d65  x...    **Parame
-00050b40: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
-00050b50: 0a20 2020 2072 6f69 7320 3a20 6c69 7374  .    rois : list
-00050b60: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
-00050b70: 2074 776f 206f 7220 6d6f 7265 2073 6b72   two or more skr
-00050b80: 742e 7374 7275 6374 7572 6573 2e52 4f49  t.structures.ROI
-00050b90: 206f 626a 6563 7473 2066 6f72 2077 6869   objects for whi
-00050ba0: 6368 2063 6f6e 666f 726d 6974 790a 2020  ch conformity.  
-00050bb0: 2020 2020 2020 696e 6465 7820 6973 2074        index is t
-00050bc0: 6f20 6265 2063 616c 6375 6c61 7465 642e  o be calculated.
-00050bd0: 0a0a 2020 2020 6369 5f74 7970 653a 2073  ..    ci_type: s
-00050be0: 7472 2c20 6465 6661 756c 743d 2267 656e  tr, default="gen
-00050bf0: 220a 2020 2020 2020 2020 5479 7065 206f  ".        Type o
-00050c00: 6620 636f 6e66 6f72 6d69 7479 2069 6e64  f conformity ind
-00050c10: 6578 2074 6f20 6265 2072 6574 7572 6e65  ex to be returne
-00050c20: 642c 2066 726f 6d20 2267 656e 2220 2866  d, from "gen" (f
-00050c30: 6f72 2067 656e 6572 616c 6973 6564 292c  or generalised),
-00050c40: 0a20 2020 2020 2020 2022 7061 6972 7322  .        "pairs"
-00050c50: 2c20 2263 6f6d 6d6f 6e22 2e20 2049 6620  , "common".  If 
-00050c60: 7365 7420 746f 2022 616c 6c22 2c20 6120  set to "all", a 
-00050c70: 736b 7274 2e63 6f72 652e 4461 7461 206f  skrt.core.Data o
-00050c80: 626a 6563 7420 7769 7468 0a20 2020 2020  bject with.     
-00050c90: 2020 2076 616c 7565 7320 666f 7220 7468     values for th
-00050ca0: 6520 7468 7265 6520 7479 7065 7320 6f66  e three types of
-00050cb0: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
-00050cc0: 7820 6973 2072 6574 7572 6e65 642e 0a0a  x is returned...
-00050cd0: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
-00050ce0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00050cf0: 3d46 616c 7365 0a20 2020 2020 2020 2049  =False.        I
-00050d00: 6620 4661 6c73 652c 2074 6865 2067 6c6f  f False, the glo
-00050d10: 6261 6c20 3344 2044 6963 6520 7363 6f72  bal 3D Dice scor
-00050d20: 6520 6f66 2074 6865 2066 756c 6c20 524f  e of the full RO
-00050d30: 4973 2077 696c 6c20 6265 2072 6574 7572  Is will be retur
-00050d40: 6e65 643b 0a20 2020 2020 2020 206f 7468  ned;.        oth
-00050d50: 6572 7769 7365 2c20 7468 6520 3244 2044  erwise, the 2D D
-00050d60: 6963 6520 7363 6f72 6520 6f6e 2061 2073  ice score on a s
-00050d70: 696e 676c 6520 736c 6963 6520 7769 6c6c  ingle slice will
-00050d80: 2062 6520 7265 7475 726e 6564 2e0a 0a20   be returned... 
-00050d90: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
-00050da0: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
-00050db0: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
-00050dc0: 206f 6620 736c 6963 6520 6f6e 2077 6869   of slice on whi
-00050dd0: 6368 2074 6f20 6765 7420 4469 6365 2073  ch to get Dice s
-00050de0: 636f 7265 2e20 4f6e 6c79 2075 7365 6420  core. Only used 
-00050df0: 6966 200a 2020 2020 2020 2020 7369 6e67  if .        sing
-00050e00: 6c65 5f73 6c69 6365 3d54 7275 652e 2049  le_slice=True. I
-00050e10: 6620 7573 696e 672c 203c 6178 3e20 6d75  f using, <ax> mu
-00050e20: 7374 2062 6520 616e 2061 7869 7320 7468  st be an axis th
-00050e30: 6174 206c 6965 7320 616c 6f6e 670a 2020  at lies along.  
-00050e40: 2020 2020 2020 7468 6520 736c 6963 6520        the slice 
-00050e50: 696e 2074 6869 7320 6f72 6965 6e74 6174  in this orientat
-00050e60: 696f 6e2e 0a0a 2020 2020 736c 203a 2069  ion...    sl : i
-00050e70: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-00050e80: 0a20 2020 2020 2020 2053 6c69 6365 206e  .        Slice n
-00050e90: 756d 6265 722e 2049 6620 6e6f 6e65 206f  umber. If none o
-00050ea0: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
-00050eb0: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
-00050ec0: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
-00050ed0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-00050ee0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-00050ef0: 7261 6c20 736c 6963 6520 6f66 2074 6869  ral slice of thi
-00050f00: 7320 524f 4920 7769 6c6c 2062 6520 7573  s ROI will be us
-00050f10: 6564 2e0a 0a20 2020 2069 6478 203a 2069  ed...    idx : i
-00050f20: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-00050f30: 0a20 2020 2020 2020 2041 7272 6179 2069  .        Array i
-00050f40: 6e64 6578 206f 6620 736c 6963 652e 2049  ndex of slice. I
-00050f50: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
-00050f60: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
-00050f70: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
-00050f80: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
-00050f90: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-00050fa0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-00050fb0: 6520 6f66 2074 6869 7320 524f 4920 7769  e of this ROI wi
-00050fc0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
-00050fd0: 2070 6f73 203a 2066 6c6f 6174 2c20 6465   pos : float, de
-00050fe0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00050ff0: 2020 2053 6c69 6365 2070 6f73 6974 696f     Slice positio
-00051000: 6e20 696e 206d 6d2e 2049 6620 6e6f 6e65  n in mm. If none
-00051010: 206f 6620 3c73 6c3e 2c20 3c69 6478 3e20   of <sl>, <idx> 
-00051020: 6f72 203c 706f 733e 2061 7265 2073 7570  or <pos> are sup
-00051030: 706c 6965 6420 6275 740a 2020 2020 2020  plied but.      
-00051040: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
-00051050: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
-00051060: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
-00051070: 6869 7320 524f 4920 7769 6c6c 2062 6520  his ROI will be 
-00051080: 7573 6564 2e0a 0a20 2020 206d 6574 686f  used...    metho
-00051090: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
-000510a0: 3d4e 6f6e 650a 2020 2020 2020 2020 4d65  =None.        Me
-000510b0: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
-000510c0: 4469 6365 2073 636f 7265 2063 616c 6375  Dice score calcu
-000510d0: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
-000510e0: 0a20 2020 2020 2020 202d 2022 636f 6e74  .        - "cont
-000510f0: 6f75 7222 3a20 6765 7420 696e 7465 7273  our": get inters
-00051100: 6563 7469 6f6e 7320 616e 6420 6172 6561  ections and area
-00051110: 7320 6f66 2073 6861 7065 6c79 2063 6f6e  s of shapely con
-00051120: 746f 7572 732e 0a20 2020 2020 2020 202d  tours..        -
-00051130: 2022 6d61 736b 223a 2063 6f75 6e74 2069   "mask": count i
-00051140: 6e74 6572 7365 6374 696e 6720 766f 7865  ntersecting voxe
-00051150: 6c73 2069 6e20 6269 6e61 7279 206d 6173  ls in binary mas
-00051160: 6b73 2e0a 2020 2020 2020 2020 2d20 4e6f  ks..        - No
-00051170: 6e65 3a20 7573 6520 7468 6520 6d65 7468  ne: use the meth
-00051180: 6f64 2073 6574 2069 6e20 7365 6c66 2e64  od set in self.d
-00051190: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-000511a0: 6f64 2e0a 2020 2020 2020 2020 466f 7220  od..        For 
-000511b0: 6d6f 7265 2074 6861 6e20 7477 6f20 524f  more than two RO
-000511c0: 4973 2061 6e64 203c 6369 5f74 7970 653e  Is and <ci_type>
-000511d0: 2022 636f 6d6d 6f6e 222c 206f 6e6c 7920   "common", only 
-000511e0: 7468 6520 226d 6173 6b22 0a20 2020 2020  the "mask".     
-000511f0: 2020 206d 6574 686f 6420 6973 2069 6d70     method is imp
-00051200: 6c65 6d65 6e74 6564 2e0a 0a20 2020 2066  lemented...    f
-00051210: 6c61 7474 656e 203a 2062 6f6f 6c2c 2064  latten : bool, d
-00051220: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-00051230: 2020 2020 2049 6620 5472 7565 2c20 616c       If True, al
-00051240: 6c20 736c 6963 6573 2077 696c 6c20 6265  l slices will be
-00051250: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
-00051260: 6520 6769 7665 6e20 6f72 6965 6e74 6174  e given orientat
-00051270: 696f 6e20 616e 640a 2020 2020 2020 2020  ion and.        
-00051280: 7468 6520 4469 6365 2073 636f 7265 206f  the Dice score o
-00051290: 6620 7468 6520 666c 6174 7465 6e65 6420  f the flattened 
-000512a0: 736c 6963 6573 2077 696c 6c20 6265 2072  slices will be r
-000512b0: 6574 7572 6e65 642e 204f 6e6c 7920 0a20  eturned. Only . 
-000512c0: 2020 2020 2020 2061 7661 696c 6162 6c65         available
-000512d0: 2069 6620 6d65 7468 6f64 3d22 6d61 736b   if method="mask
-000512e0: 222e 0a20 2020 2022 2222 0a0a 2020 2020  "..    """..    
-000512f0: 2320 5265 7175 6972 6520 7661 6c69 6420  # Require valid 
-00051300: 696e 7075 7473 2e0a 2020 2020 6966 206c  inputs..    if l
-00051310: 656e 2872 6f69 7329 203c 2032 206f 7220  en(rois) < 2 or 
-00051320: 6369 5f74 7970 6520 6e6f 7420 696e 205b  ci_type not in [
-00051330: 2263 6f6d 6d6f 6e22 2c20 2267 656e 222c  "common", "gen",
-00051340: 2022 7061 6972 7322 2c20 2261 6c6c 225d   "pairs", "all"]
-00051350: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00051360: 0a0a 2020 2020 2320 496e 6974 6961 6c69  ..    # Initiali
-00051370: 7365 2044 6174 6120 6f62 6a65 6374 2066  se Data object f
-00051380: 6f72 2063 6f6e 666f 726d 6974 7920 696e  or conformity in
-00051390: 6469 6365 732e 0a20 2020 2063 6920 3d20  dices..    ci = 
-000513a0: 736b 7274 2e63 6f72 652e 4461 7461 287b  skrt.core.Data({
-000513b0: 2263 6f6d 6d6f 6e22 3a20 302c 2022 6765  "common": 0, "ge
-000513c0: 6e22 3a30 2c20 2270 6169 7273 223a 307d  n":0, "pairs":0}
-000513d0: 290a 0a20 2020 2023 2044 6561 6c20 7769  )..    # Deal wi
-000513e0: 7468 2063 6173 6573 2022 6765 6e22 2061  th cases "gen" a
-000513f0: 6e64 2022 7061 6972 7322 2e0a 2020 2020  nd "pairs"..    
-00051400: 230a 2020 2020 2320 466f 7220 2267 656e  #.    # For "gen
-00051410: 222c 2074 6865 2063 6f6e 666f 726d 6974  ", the conformit
-00051420: 7920 696e 6465 7820 6973 2063 616c 6375  y index is calcu
-00051430: 6c61 7465 6420 6173 2074 6865 2072 6174  lated as the rat
-00051440: 696f 206f 660a 2020 2020 2320 2831 2920  io of.    # (1) 
-00051450: 7468 6520 7375 6d20 6f66 2074 6865 2069  the sum of the i
-00051460: 6e74 6572 7365 6374 696f 6e73 2066 6f72  ntersections for
-00051470: 2061 6c6c 2070 6169 7273 2074 6f20 2832   all pairs to (2
-00051480: 2920 7468 6520 7375 6d20 6f66 0a20 2020  ) the sum of.   
-00051490: 2023 2074 6865 2075 6e69 6f6e 7320 666f   # the unions fo
-000514a0: 7220 616c 6c20 7061 6972 732e 0a20 2020  r all pairs..   
-000514b0: 2023 0a20 2020 2023 2046 6f72 2022 7061   #.    # For "pa
-000514c0: 6972 732c 2074 6865 2063 6f6e 666f 726d  irs, the conform
-000514d0: 6974 7920 696e 6465 7820 6973 2063 616c  ity index is cal
-000514e0: 6375 616c 7465 6420 6173 2074 6865 206d  cualted as the m
-000514f0: 6561 6e20 6f66 2074 6865 0a20 2020 2023  ean of the.    #
-00051500: 204a 6163 6361 7264 2063 6f6e 666f 726d   Jaccard conform
-00051510: 6974 7920 696e 6469 6365 7320 666f 7220  ity indices for 
-00051520: 616c 6c20 7061 6972 732e 0a0a 2020 2020  all pairs...    
-00051530: 6e75 6d65 7261 746f 7220 3d20 300a 2020  numerator = 0.  
-00051540: 2020 6465 6e6f 6d69 6e61 746f 7220 3d20    denominator = 
-00051550: 300a 2020 2020 6e5f 7061 6972 203d 2030  0.    n_pair = 0
-00051560: 0a20 2020 2066 6f72 2069 6478 3120 696e  .    for idx1 in
-00051570: 2072 616e 6765 286c 656e 2872 6f69 7329   range(len(rois)
-00051580: 202d 2031 293a 0a20 2020 2020 2020 2066   - 1):.        f
-00051590: 6f72 2069 6478 3220 696e 2072 616e 6765  or idx2 in range
-000515a0: 2869 6478 3120 2b20 312c 206c 656e 2872  (idx1 + 1, len(r
-000515b0: 6f69 7329 293a 0a20 2020 2020 2020 2020  ois)):.         
-000515c0: 2020 2072 6f69 3120 3d20 726f 6973 5b69     roi1 = rois[i
-000515d0: 6478 315d 0a20 2020 2020 2020 2020 2020  dx1].           
-000515e0: 2072 6f69 3220 3d20 726f 6973 5b69 6478   roi2 = rois[idx
-000515f0: 325d 0a20 2020 2020 2020 2020 2020 2069  2].            i
-00051600: 6e74 6572 7365 6374 696f 6e2c 2075 6e69  ntersection, uni
-00051610: 6f6e 2c20 6d65 616e 5f73 697a 6520 3d20  on, mean_size = 
-00051620: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00051630: 2020 2020 2020 726f 6931 2e67 6574 5f69        roi1.get_i
-00051640: 6e74 6572 7365 6374 696f 6e5f 756e 696f  ntersection_unio
-00051650: 6e5f 7369 7a65 2872 6f69 322c 2073 696e  n_size(roi2, sin
-00051660: 676c 655f 736c 6963 652c 0a20 2020 2020  gle_slice,.     
-00051670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051680: 2020 2076 6965 772c 2073 6c2c 2069 6478     view, sl, idx
-00051690: 2c20 706f 732c 206d 6574 686f 642c 2066  , pos, method, f
-000516a0: 6c61 7474 656e 2929 0a20 2020 2020 2020  latten)).       
-000516b0: 2020 2020 206e 756d 6572 6174 6f72 202b       numerator +
-000516c0: 3d20 696e 7465 7273 6563 7469 6f6e 0a20  = intersection. 
-000516d0: 2020 2020 2020 2020 2020 2064 656e 6f6d             denom
-000516e0: 696e 6174 6f72 202b 3d20 756e 696f 6e0a  inator += union.
-000516f0: 2020 2020 2020 2020 2020 2020 6369 2e70              ci.p
-00051700: 6169 7273 202b 3d20 696e 7465 7273 6563  airs += intersec
-00051710: 7469 6f6e 202f 2075 6e69 6f6e 0a20 2020  tion / union.   
-00051720: 2020 2020 2020 2020 206e 5f70 6169 7220           n_pair 
-00051730: 2b3d 2031 0a0a 2020 2020 6369 2e67 656e  += 1..    ci.gen
-00051740: 203d 206e 756d 6572 6174 6f72 202f 2064   = numerator / d
-00051750: 656e 6f6d 696e 6174 6f72 0a20 2020 2063  enominator.    c
-00051760: 692e 7061 6972 7320 2f3d 206e 5f70 6169  i.pairs /= n_pai
-00051770: 720a 0a20 2020 2023 2044 6561 6c20 7769  r..    # Deal wi
-00051780: 7468 2063 6173 6520 2263 6f6d 6d6f 6e22  th case "common"
-00051790: 2e0a 2020 2020 230a 2020 2020 2320 5468  ..    #.    # Th
-000517a0: 6520 636f 6e66 6f72 6d69 7479 2069 6e64  e conformity ind
-000517b0: 6578 2069 7320 6361 6c63 756c 6174 6564  ex is calculated
-000517c0: 2061 7320 7468 6520 7261 7469 6f20 6f66   as the ratio of
-000517d0: 0a20 2020 2023 2028 3129 2074 6865 2063  .    # (1) the c
-000517e0: 6f6d 6d6f 6e20 696e 7465 7273 6563 7469  ommon intersecti
-000517f0: 6f6e 206f 6620 616c 6c20 524f 4973 2074  on of all ROIs t
-00051800: 6f20 2832 2920 7468 6520 636f 6d62 696e  o (2) the combin
-00051810: 6564 2075 6e69 6f6e 0a20 2020 2023 206f  ed union.    # o
-00051820: 6620 616c 6c20 524f 4973 2e0a 2020 2020  f all ROIs..    
-00051830: 6966 2032 203d 3d20 6c65 6e28 726f 6973  if 2 == len(rois
-00051840: 293a 0a20 2020 2020 2020 2069 6e74 6572  ):.        inter
-00051850: 7365 6374 696f 6e2c 2075 6e69 6f6e 2c20  section, union, 
-00051860: 6d65 616e 5f73 697a 6520 3d20 280a 2020  mean_size = (.  
-00051870: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00051880: 6973 5b30 5d2e 6765 745f 696e 7465 7273  is[0].get_inters
-00051890: 6563 7469 6f6e 5f75 6e69 6f6e 5f73 697a  ection_union_siz
-000518a0: 6528 726f 6973 5b31 5d2c 2073 696e 676c  e(rois[1], singl
-000518b0: 655f 736c 6963 652c 0a20 2020 2020 2020  e_slice,.       
-000518c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000518d0: 2076 6965 772c 2073 6c2c 2069 6478 2c20   view, sl, idx, 
-000518e0: 706f 732c 206d 6574 686f 642c 2066 6c61  pos, method, fla
-000518f0: 7474 656e 2929 0a20 2020 2020 2020 2063  tten)).        c
-00051900: 692e 636f 6d6d 6f6e 203d 2069 6e74 6572  i.common = inter
-00051910: 7365 6374 696f 6e20 2f20 756e 696f 6e0a  section / union.
-00051920: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00051930: 2020 6966 206e 6f74 2073 696e 676c 655f    if not single_
-00051940: 736c 6963 653a 0a20 2020 2020 2020 2020  slice:.         
-00051950: 2020 206d 6173 6b5f 696e 7465 7273 6563     mask_intersec
-00051960: 7469 6f6e 203d 2072 6f69 735b 305d 2e63  tion = rois[0].c
-00051970: 6c6f 6e65 2829 2e67 6574 5f6d 6173 6b28  lone().get_mask(
-00051980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051990: 2020 2020 2076 6965 772c 2066 6c61 7474       view, flatt
-000519a0: 656e 2c20 7374 616e 6461 7264 6973 653d  en, standardise=
-000519b0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000519c0: 2020 6d61 736b 5f75 6e69 6f6e 203d 2072    mask_union = r
-000519d0: 6f69 735b 305d 2e63 6c6f 6e65 2829 2e67  ois[0].clone().g
-000519e0: 6574 5f6d 6173 6b28 0a20 2020 2020 2020  et_mask(.       
-000519f0: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-00051a00: 772c 2066 6c61 7474 656e 2c20 7374 616e  w, flatten, stan
-00051a10: 6461 7264 6973 653d 5472 7565 290a 2020  dardise=True).  
-00051a20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00051a30: 2020 2020 2020 2020 6d61 736b 5f69 6e74          mask_int
-00051a40: 6572 7365 6374 696f 6e20 3d20 726f 6973  ersection = rois
-00051a50: 5b30 5d2e 636c 6f6e 6528 292e 6765 745f  [0].clone().get_
-00051a60: 736c 6963 6528 0a20 2020 2020 2020 2020  slice(.         
-00051a70: 2020 2020 2020 2020 2020 2076 6965 772c             view,
-00051a80: 2073 6c2c 2069 6478 2c20 706f 7329 0a20   sl, idx, pos). 
-00051a90: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
-00051aa0: 756e 696f 6e20 3d20 726f 6973 5b30 5d2e  union = rois[0].
-00051ab0: 636c 6f6e 6528 292e 6765 745f 736c 6963  clone().get_slic
-00051ac0: 6528 7669 6577 2c20 736c 2c20 6964 782c  e(view, sl, idx,
-00051ad0: 2070 6f73 290a 0a20 2020 2020 2020 2066   pos)..        f
-00051ae0: 6f72 2072 6f69 2069 6e20 726f 6973 5b31  or roi in rois[1
-00051af0: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
-00051b00: 6966 206e 6f74 2073 696e 676c 655f 736c  if not single_sl
-00051b10: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
-00051b20: 2020 2020 206d 6173 6b20 3d20 726f 692e       mask = roi.
-00051b30: 6765 745f 6d61 736b 2876 6965 772c 2066  get_mask(view, f
-00051b40: 6c61 7474 656e 2c20 7374 616e 6461 7264  latten, standard
-00051b50: 6973 653d 5472 7565 290a 2020 2020 2020  ise=True).      
-00051b60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00051b70: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00051b80: 203d 2072 6f69 2e67 6574 5f73 6c69 6365   = roi.get_slice
-00051b90: 2876 6965 772c 2073 6c2c 2069 6478 2c20  (view, sl, idx, 
-00051ba0: 706f 7329 0a0a 2020 2020 2020 2020 2020  pos)..          
-00051bb0: 2020 6d61 736b 5f69 6e74 6572 7365 6374    mask_intersect
-00051bc0: 696f 6e20 3d20 286d 6173 6b5f 696e 7465  ion = (mask_inte
-00051bd0: 7273 6563 7469 6f6e 2026 206d 6173 6b29  rsection & mask)
-00051be0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-00051bf0: 6b5f 756e 696f 6e20 3d20 286d 6173 6b5f  k_union = (mask_
-00051c00: 756e 696f 6e20 7c20 6d61 736b 290a 0a20  union | mask).. 
-00051c10: 2020 2020 2020 2063 692e 636f 6d6d 6f6e         ci.common
-00051c20: 203d 206d 6173 6b5f 696e 7465 7273 6563   = mask_intersec
-00051c30: 7469 6f6e 2e73 756d 2829 202f 206d 6173  tion.sum() / mas
-00051c40: 6b5f 756e 696f 6e2e 7375 6d28 290a 0a20  k_union.sum().. 
-00051c50: 2020 2072 6574 7572 6e20 6765 7461 7474     return getatt
-00051c60: 7228 6369 2c20 6369 5f74 7970 652c 2063  r(ci, ci_type, c
-00051c70: 6929 0a0a 6465 6620 6765 745f 726f 695f  i)..def get_roi_
-00051c80: 736c 6963 6528 726f 692c 207a 5f66 7261  slice(roi, z_fra
-00051c90: 6374 696f 6e3d 312c 2073 7566 6669 783d  ction=1, suffix=
-00051ca0: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
-00051cb0: 2020 2047 6574 2052 4f49 206f 626a 6563     Get ROI objec
-00051cc0: 7420 636f 7272 6573 706f 6e64 696e 6720  t corresponding 
-00051cd0: 746f 2078 2d79 2073 6c69 6365 2074 6872  to x-y slice thr
-00051ce0: 6f75 6768 2069 6e70 7574 2052 4f49 2e0a  ough input ROI..
-00051cf0: 0a20 2020 202a 2a50 6172 616d 6574 6572  .    **Parameter
-00051d00: 733a 2a2a 0a0a 2020 2020 726f 6920 3a20  s:**..    roi : 
-00051d10: 736b 7274 2e73 7472 7563 7475 7265 732e  skrt.structures.
-00051d20: 524f 490a 2020 2020 2020 2020 524f 4920  ROI.        ROI 
-00051d30: 6f62 6a65 6374 2066 6f72 2077 6869 6368  object for which
-00051d40: 2073 6c69 6365 2069 7320 746f 2062 6520   slice is to be 
-00051d50: 6f62 7461 696e 6564 2e0a 0a20 2020 207a  obtained...    z
-00051d60: 5f66 7261 6374 696f 6e20 3a20 666c 6f61  _fraction : floa
-00051d70: 742c 2064 6566 6175 6c74 3d31 0a20 2020  t, default=1.   
-00051d80: 2020 2020 2050 6f73 6974 696f 6e20 616c       Position al
-00051d90: 6f6e 6720 7a20 6178 6973 2061 7420 7768  ong z axis at wh
-00051da0: 6963 6820 746f 2074 616b 6520 736c 6963  ich to take slic
-00051db0: 6520 7468 726f 7567 6820 524f 492e 0a20  e through ROI.. 
-00051dc0: 2020 2020 2020 2054 6865 2070 6f73 6974         The posit
-00051dd0: 696f 6e20 6973 2073 7065 6369 6669 6564  ion is specified
-00051de0: 2061 7320 7468 6520 6672 6163 7469 6f6e   as the fraction
-00051df0: 616c 2064 6973 7461 6e63 650a 2020 2020  al distance.    
-00051e00: 2020 2020 6672 6f6d 2074 6865 2052 4f49      from the ROI
-00051e10: 2773 206d 6f73 742d 696e 6665 7269 6f72  's most-inferior
-00051e20: 2070 6f69 6e74 3a20 3020 636f 7272 6573   point: 0 corres
-00051e30: 706f 6e64 7320 746f 0a20 2020 2020 2020  ponds to.       
-00051e40: 2074 6865 206d 6f73 742d 696e 6665 7269   the most-inferi
-00051e50: 6f72 2070 6f69 6e74 2028 6c6f 7765 7374  or point (lowest
-00051e60: 207a 293b 2031 2063 6f72 7265 7370 6f6e   z); 1 correspon
-00051e70: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
-00051e80: 2020 6d6f 7374 2d73 7570 6572 696f 7220    most-superior 
-00051e90: 706f 696e 7420 2868 6967 6865 7374 207a  point (highest z
-00051ea0: 292e 2020 5661 6c75 6573 2066 6f72 207a  ).  Values for z
-00051eb0: 5f66 7261 6374 696f 6e0a 2020 2020 2020  _fraction.      
-00051ec0: 2020 6f75 7473 6964 6520 7468 6520 696e    outside the in
-00051ed0: 7465 7276 616c 205b 302c 2031 5d20 7265  terval [0, 1] re
-00051ee0: 7375 6c74 2069 6e20 6120 5275 6e74 696d  sult in a Runtim
-00051ef0: 6545 7272 6f72 2e0a 0a20 2020 2073 7566  eError...    suf
-00051f00: 6669 7820 3a20 7374 722c 2064 6566 6175  fix : str, defau
-00051f10: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00051f20: 5375 6666 6978 2074 6f20 6170 7065 6e64  Suffix to append
-00051f30: 2074 6f20 6e61 6d65 206f 6620 696e 7075   to name of inpu
-00051f40: 7420 524f 492c 2074 6f20 666f 726d 206e  t ROI, to form n
-00051f50: 616d 650a 2020 2020 2020 2020 6f66 206f  ame.        of o
-00051f60: 7574 7075 7420 524f 492e 2020 4966 204e  utput ROI.  If N
-00051f70: 6f6e 652c 2061 7070 656e 6420 7a5f 6672  one, append z_fr
-00051f80: 6163 7469 6f6e 2c20 7769 7468 2076 616c  action, with val
-00051f90: 7565 0a20 2020 2020 2020 2067 6976 656e  ue.        given
-00051fa0: 2074 6f20 7477 6f20 6465 6369 6d61 6c20   to two decimal 
-00051fb0: 706c 6163 6573 2e0a 2020 2020 2222 220a  places..    """.
-00051fc0: 2020 2020 2320 4368 6563 6b20 7468 6174      # Check that
-00051fd0: 207a 5f66 7261 6374 696f 6e20 6973 2069   z_fraction is i
-00051fe0: 6e20 616c 6c6f 7765 6420 696e 7465 7276  n allowed interv
-00051ff0: 616c 2e0a 2020 2020 6966 207a 5f66 7261  al..    if z_fra
-00052000: 6374 696f 6e20 3c20 3020 6f72 207a 5f66  ction < 0 or z_f
-00052010: 7261 6374 696f 6e20 3e20 313a 0a20 2020  raction > 1:.   
-00052020: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-00052030: 6d65 4572 726f 7228 6622 7a5f 6672 6163  meError(f"z_frac
-00052040: 7469 6f6e 3d7b 7a5f 6672 6163 7469 6f6e  tion={z_fraction
-00052050: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-00052060: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00052070: 206f 7574 7369 6465 2061 6c6c 6f77 6564   outside allowed
-00052080: 2069 6e74 6572 7661 6c20 5b30 2c20 315d   interval [0, 1]
-00052090: 2229 0a0a 2020 2020 2320 4465 7465 726d  ")..    # Determ
-000520a0: 696e 6520 7468 6520 696e 6465 7820 6f66  ine the index of
-000520b0: 2074 6865 2069 6d61 6765 2073 6c69 6365   the image slice
-000520c0: 2061 7420 7768 6963 6820 746f 2074 616b   at which to tak
-000520d0: 6520 524f 4920 736c 6963 652e 0a20 2020  e ROI slice..   
-000520e0: 2070 6f73 312c 2070 6f73 3220 3d20 726f   pos1, pos2 = ro
-000520f0: 692e 6765 745f 6578 7465 6e74 2829 0a20  i.get_extent(). 
-00052100: 2020 2070 6f73 203d 2070 6f73 3120 2b20     pos = pos1 + 
-00052110: 7a5f 6672 6163 7469 6f6e 202a 2028 706f  z_fraction * (po
-00052120: 7332 202d 2070 6f73 3129 0a20 2020 2069  s2 - pos1).    i
-00052130: 6478 203d 2072 6f69 2e70 6f73 5f74 6f5f  dx = roi.pos_to_
-00052140: 6964 7828 706f 732c 2022 7a22 290a 0a20  idx(pos, "z").. 
-00052150: 2020 2023 204f 6274 6169 6e20 636f 6e74     # Obtain cont
-00052160: 6f75 7273 2066 6f72 2072 6571 7569 7265  ours for require
-00052170: 6420 736c 6963 652c 2061 6e64 2063 6f6e  d slice, and con
-00052180: 7665 7274 2074 6f20 524f 4920 6f62 6a65  vert to ROI obje
-00052190: 6374 2e0a 2020 2020 636f 6e74 6f75 7273  ct..    contours
-000521a0: 203d 2072 6f69 2e67 6574 5f63 6f6e 746f   = roi.get_conto
-000521b0: 7572 7328 6964 785f 6173 5f6b 6579 3d54  urs(idx_as_key=T
-000521c0: 7275 6529 5b69 6478 5d0a 2020 2020 726f  rue)[idx].    ro
-000521d0: 695f 736c 6963 6520 3d20 524f 4928 7b72  i_slice = ROI({r
-000521e0: 6f69 2e69 6478 5f74 6f5f 706f 7328 6964  oi.idx_to_pos(id
-000521f0: 782c 2022 7a22 293a 2063 6f6e 746f 7572  x, "z"): contour
-00052200: 737d 290a 0a20 2020 2073 7566 6669 7820  s})..    suffix 
-00052210: 3d20 6622 7b7a 5f66 7261 6374 696f 6e3a  = f"{z_fraction:
-00052220: 2e32 667d 2220 6966 2073 7566 6669 7820  .2f}" if suffix 
-00052230: 6973 204e 6f6e 6520 656c 7365 2073 7566  is None else suf
-00052240: 6669 780a 2020 2020 6966 2073 7566 6669  fix.    if suffi
-00052250: 783a 0a20 2020 2020 2020 2072 6f69 5f73  x:.        roi_s
-00052260: 6c69 6365 2e6e 616d 6520 3d20 6622 7b72  lice.name = f"{r
-00052270: 6f69 2e6e 616d 657d 5f7b 7375 6666 6978  oi.name}_{suffix
-00052280: 7d22 0a20 2020 2065 6c73 653a 0a20 2020  }".    else:.   
-00052290: 2020 2020 2072 6f69 5f73 6c69 6365 2e6e       roi_slice.n
-000522a0: 616d 6520 3d20 7374 7228 726f 692e 6e61  ame = str(roi.na
-000522b0: 6d65 290a 0a20 2020 2072 6574 7572 6e20  me)..    return 
-000522c0: 726f 695f 736c 6963 650a 0a64 6566 2067  roi_slice..def g
-000522d0: 6574 5f6d 6574 7269 635f 6d65 7468 6f64  et_metric_method
-000522e0: 286d 6574 7269 6329 3a0a 2020 2020 2222  (metric):.    ""
-000522f0: 220a 2020 2020 4d61 7020 6265 7477 6565  ".    Map betwee
-00052300: 6e20 6d65 7472 6963 2069 6465 6e74 6966  n metric identif
-00052310: 6965 7220 6173 206c 6973 7465 6420 696e  ier as listed in
-00052320: 2067 6574 5f63 6f6d 7061 7269 736f 6e5f   get_comparison_
-00052330: 6d65 7472 6963 7328 290a 2020 2020 616e  metrics().    an
-00052340: 6420 6e61 6d65 206f 6620 524f 4920 6d65  d name of ROI me
-00052350: 7468 6f64 2066 6f72 2063 616c 6375 6c61  thod for calcula
-00052360: 7469 6e67 2074 6865 206d 6574 7269 632e  ting the metric.
-00052370: 0a20 2020 200a 2020 2020 5468 6973 2066  .    .    This f
-00052380: 756e 6374 696f 6e20 6973 2075 7365 6420  unction is used 
-00052390: 696e 2052 4f49 2e67 6574 5f6d 6574 7269  in ROI.get_metri
-000523a0: 635f 6279 5f73 6c69 6365 2829 2074 6f20  c_by_slice() to 
-000523b0: 6465 7465 726d 696e 650a 2020 2020 7468  determine.    th
-000523c0: 6520 6d65 7468 6f64 2074 6f20 6265 2063  e method to be c
-000523d0: 616c 6c65 6420 666f 7220 6561 6368 206d  alled for each m
-000523e0: 6574 7269 632e 0a20 2020 2022 2222 0a20  etric..    """. 
-000523f0: 2020 2023 204b 6579 7320 6172 6520 6d65     # Keys are me
-00052400: 7472 6963 2069 6465 6e74 6966 6965 7273  tric identifiers
-00052410: 3b20 7661 6c75 6573 2061 7265 206e 616d  ; values are nam
-00052420: 6573 206f 6620 524f 4920 6d65 7468 6f64  es of ROI method
-00052430: 730a 2020 2020 2320 666f 7220 6d65 7472  s.    # for metr
-00052440: 6963 2063 616c 6375 6c61 7469 6f6e 2e0a  ic calculation..
-00052450: 2020 2020 2320 4d65 7472 6963 7320 6172      # Metrics ar
-00052460: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
-00052470: 6520 6469 6374 696f 6e61 7279 206f 6e6c  e dictionary onl
-00052480: 7920 6966 2069 6465 6e74 6966 6965 7220  y if identifier 
-00052490: 616e 6420 6d65 7468 6f64 0a20 2020 2023  and method.    #
-000524a0: 206e 616d 6520 6172 6520 6469 6666 6572   name are differ
-000524b0: 656e 742e 0a20 2020 206d 6170 7069 6e67  ent..    mapping
-000524c0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-000524d0: 2020 2261 6273 5f63 656e 7472 6f69 6422    "abs_centroid"
-000524e0: 3a20 2261 6273 5f63 656e 7472 6f69 645f  : "abs_centroid_
-000524f0: 6469 7374 616e 6365 222c 0a20 2020 2020  distance",.     
-00052500: 2020 2020 2020 2022 6365 6e74 726f 6964         "centroid
-00052510: 223a 2022 6365 6e74 726f 6964 5f64 6973  ": "centroid_dis
-00052520: 7461 6e63 6522 2c0a 2020 2020 2020 2020  tance",.        
-00052530: 2020 2020 2272 656c 5f61 7265 615f 6469      "rel_area_di
-00052540: 6666 223a 2022 7265 6c61 7469 7665 5f61  ff": "relative_a
-00052550: 7265 615f 6469 6666 222c 0a20 2020 2020  rea_diff",.     
-00052560: 2020 2020 2020 207d 0a20 2020 2072 6574         }.    ret
-00052570: 7572 6e20 6d61 7070 696e 6773 2e67 6574  urn mappings.get
-00052580: 286d 6574 7269 632c 206d 6574 7269 6329  (metric, metric)
-00052590: 0a0a 6465 6620 6765 745f 636f 6d70 6172  ..def get_compar
-000525a0: 6973 6f6e 5f6d 6574 7269 6373 2863 656e  ison_metrics(cen
-000525b0: 7472 6f69 645f 636f 6d70 6f6e 656e 7473  troid_components
-000525c0: 3d46 616c 7365 2c20 736c 6963 655f 7374  =False, slice_st
-000525d0: 6174 733d 4e6f 6e65 2c0a 2020 2020 2020  ats=None,.      
-000525e0: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
-000525f0: 6365 3d4e 6f6e 652c 2076 6965 773d 2278  ce=None, view="x
-00052600: 2d79 2229 3a0a 2020 2020 2222 220a 2020  -y"):.    """.  
-00052610: 2020 4765 7420 6c69 7374 206f 6620 636f    Get list of co
-00052620: 6d70 6172 6973 6f6e 206d 6574 7269 6373  mparison metrics
-00052630: 2e0a 0a20 2020 2041 6c6c 206d 6574 7269  ...    All metri
-00052640: 6373 206c 6973 7465 6420 6865 7265 2073  cs listed here s
-00052650: 686f 756c 6420 6265 2072 6563 6f67 6e69  hould be recogni
-00052660: 7365 6420 6279 2052 4f49 2e67 6574 5f63  sed by ROI.get_c
-00052670: 6f6d 7061 7269 736f 6e28 292c 0a20 2020  omparison(),.   
-00052680: 2061 6e64 2061 6c6c 206d 6574 7269 6373   and all metrics
-00052690: 2072 6563 6f67 6e69 7365 6420 6279 2052   recognised by R
-000526a0: 4f49 2e67 6574 5f63 6f6d 7061 7269 736f  OI.get_compariso
-000526b0: 6e28 2920 7368 6f75 6c64 2062 6520 6c69  n() should be li
-000526c0: 7374 6564 2068 6572 652e 0a0a 2020 2020  sted here...    
-000526d0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-000526e0: 0a20 2020 2063 656e 7472 6f69 645f 636f  .    centroid_co
-000526f0: 6d70 6f6e 656e 7473 203a 2062 6f6f 6c2c  mponents : bool,
-00052700: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00052710: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00052720: 7265 706c 6163 6520 6d65 7472 6963 7320  replace metrics 
-00052730: 2263 656e 7472 6f69 6422 2061 6e64 2022  "centroid" and "
-00052740: 6365 6e74 726f 6964 5f73 6c69 6365 2220  centroid_slice" 
-00052750: 6279 2074 6865 0a20 2020 2020 2020 206d  by the.        m
-00052760: 6574 7269 6373 2066 6f72 2074 6865 6972  etrics for their
-00052770: 2063 6f6d 706f 6e65 6e74 732e 0a0a 2020   components...  
-00052780: 2020 736c 6963 655f 7374 6174 7320 3a20    slice_stats : 
-00052790: 7374 722f 6c69 7374 2f64 6963 742c 2064  str/list/dict, d
-000527a0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-000527b0: 2020 2020 5370 6563 6966 6963 6174 696f      Specificatio
-000527c0: 6e20 6f66 2073 7461 7469 7374 6963 7320  n of statistics 
-000527d0: 746f 2062 6520 6361 6c63 756c 6174 6564  to be calculated
-000527e0: 2072 656c 6174 6976 650a 2020 2020 2020   relative.      
-000527f0: 2020 746f 2073 6c69 6365 2d62 792d 736c    to slice-by-sl
-00052800: 6963 6520 6d65 7472 6963 2076 616c 7565  ice metric value
-00052810: 732e 0a0a 2020 2020 2020 2020 4120 7374  s...        A st
-00052820: 6174 6973 7469 6320 6973 2073 7065 6369  atistic is speci
-00052830: 6669 6564 2062 7920 7468 6520 6e61 6d65  fied by the name
-00052840: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
-00052850: 2066 6f72 0a20 2020 2020 2020 2069 7473   for.        its
-00052860: 2063 616c 6375 6c61 7469 6f6e 2069 6e20   calculation in 
-00052870: 7468 6520 5079 7468 6f6e 2073 7461 7469  the Python stati
-00052880: 7374 6963 7320 6d6f 6475 6c65 3a0a 0a20  stics module:.. 
-00052890: 2020 2020 2020 2068 7474 7073 3a2f 2f64         https://d
-000528a0: 6f63 732e 7079 7468 6f6e 2e6f 7267 2f33  ocs.python.org/3
-000528b0: 2f6c 6962 7261 7279 2f73 7461 7469 7374  /library/statist
-000528c0: 6963 732e 6874 6d6c 0a0a 2020 2020 2020  ics.html..      
-000528d0: 2020 466f 7220 6974 7320 7573 6520 6865    For its use he
-000528e0: 7265 2c20 7468 6520 7265 6c65 7661 6e74  re, the relevant
-000528f0: 2066 756e 6374 696f 6e20 6d75 7374 2072   function must r
-00052900: 6571 7569 7265 0a20 2020 2020 2020 2061  equire.        a
-00052910: 2073 696e 676c 652d 7661 7269 6162 6c65   single-variable
-00052920: 2069 6e70 7574 2c20 6d75 7374 206e 6f74   input, must not
-00052930: 2072 6571 7569 7265 2061 6e79 206b 6579   require any key
-00052940: 776f 7264 0a20 2020 2020 2020 2061 7267  word.        arg
-00052950: 756d 656e 7473 2c20 616e 6420 6d75 7374  uments, and must
-00052960: 2072 6574 7572 6e20 6120 7369 6e67 6c65   return a single
-00052970: 206e 756d 6265 722e 0a0a 2020 2020 2020   number...      
-00052980: 2020 4176 6169 6c61 626c 6520 6f70 7469    Available opti
-00052990: 6f6e 7320 696e 636c 7564 653a 2022 6d65  ons include: "me
-000529a0: 616e 222c 2022 6d65 6469 616e 222c 2022  an", "median", "
-000529b0: 6d6f 6465 222c 0a20 2020 2020 2020 2022  mode",.        "
-000529c0: 7374 6465 7622 2e0a 0a20 2020 2020 2020  stdev"...       
-000529d0: 5374 6174 6973 7469 6373 2074 6f20 6265  Statistics to be
-000529e0: 2063 616c 6375 6c61 7465 6420 6361 6e20   calculated can 
-000529f0: 6265 2073 7065 6369 6669 6564 2075 7369  be specified usi
-00052a00: 6e67 2061 6e79 206f 660a 2020 2020 2020  ng any of.      
-00052a10: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
-00052a20: 0a20 2020 2020 2020 2d20 5374 7269 6e67  .       - String
-00052a30: 2073 7065 6369 6679 696e 6720 7369 6e67   specifying sing
-00052a40: 6c65 2073 7461 7469 7374 6963 2074 6f20  le statistic to 
-00052a50: 6265 2063 616c 6375 6c61 7465 642c 0a20  be calculated,. 
-00052a60: 2020 2020 2020 2020 7769 7468 2073 6c69          with sli
-00052a70: 6365 7320 636f 6e73 6964 6572 6564 2061  ces considered a
-00052a80: 7320 6769 7665 6e20 6279 203c 6465 6661  s given by <defa
-00052a90: 756c 745f 6279 5f73 6c69 6365 3e2c 0a20  ult_by_slice>,. 
-00052aa0: 2020 2020 2020 2020 666f 7220 6578 616d          for exam
-00052ab0: 706c 653a 2022 6d65 616e 223b 0a20 2020  ple: "mean";.   
-00052ac0: 2020 2020 2d20 4c69 7374 2073 7065 6369      - List speci
-00052ad0: 6679 696e 6720 6d75 6c74 6970 6c65 2073  fying multiple s
-00052ae0: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
-00052af0: 6361 6c63 756c 6174 6564 2c0a 2020 2020  calculated,.    
-00052b00: 2020 2020 2077 6974 6820 736c 6963 6573       with slices
-00052b10: 2063 6f6e 7369 6465 7265 6420 6173 2067   considered as g
-00052b20: 6976 656e 2062 7920 3c64 6566 6175 6c74  iven by <default
-00052b30: 5f62 795f 736c 6963 653e 2c0a 2020 2020  _by_slice>,.    
-00052b40: 2020 2020 2066 6f72 2065 7861 6d70 6c65       for example
-00052b50: 3a20 5b22 6d65 616e 222c 2022 7374 6465  : ["mean", "stde
-00052b60: 7622 5d3b 0a20 2020 2020 2020 2d20 4469  v"];.       - Di
-00052b70: 6374 696f 6e61 7279 2077 6865 7265 206b  ctionary where k
-00052b80: 6579 7320 7370 6563 6966 7920 736c 6963  eys specify slic
-00052b90: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
-00052ba0: 7265 642c 0a20 2020 2020 2020 2020 616e  red,.         an
-00052bb0: 6420 7661 6c75 6573 2073 7065 6369 6679  d values specify
-00052bc0: 2073 7461 7469 7374 6963 7320 2873 7472   statistics (str
-00052bd0: 696e 6720 6f72 206c 6973 7429 2c20 666f  ing or list), fo
-00052be0: 720a 2020 2020 2020 2020 2065 7861 6d70  r.         examp
-00052bf0: 6c65 3a20 7b22 756e 696f 6e22 3a20 5b22  le: {"union": ["
-00052c00: 6d65 616e 222c 2022 7374 6465 7622 5d7d  mean", "stdev"]}
-00052c10: 2e20 2056 616c 6964 2073 6c69 6365 0a20  .  Valid slice. 
-00052c20: 2020 2020 2020 2020 7370 6563 6966 6963          specific
-00052c30: 6174 696f 6e73 2061 7265 2061 7320 6c69  ations are as li
-00052c40: 7374 6564 2066 6f72 203c 6465 6661 756c  sted for <defaul
-00052c50: 745f 6279 5f73 6c69 6365 3e2e 0a0a 2020  t_by_slice>...  
-00052c60: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
-00052c70: 6365 3a20 7374 722c 2064 6566 6175 6c74  ce: str, default
-00052c80: 3d4e 6f6e 650a 2020 2020 2020 2020 4465  =None.        De
-00052c90: 6661 756c 7420 7370 6563 6966 6963 6174  fault specificat
-00052ca0: 696f 6e20 6f66 2073 6c69 6365 7320 746f  ion of slices to
-00052cb0: 2062 6520 636f 6e73 6964 6572 6564 2077   be considered w
-00052cc0: 6865 6e0a 2020 2020 2020 2020 6361 6c63  hen.        calc
-00052cd0: 756c 6174 696e 6720 736c 6963 652d 6279  ulating slice-by
-00052ce0: 2d73 6c69 6365 2073 7461 7469 7374 6963  -slice statistic
-00052cf0: 7320 666f 7220 6120 6d65 7472 6963 2063  s for a metric c
-00052d00: 6f6d 7061 7269 6e67 0a20 2020 2020 2020  omparing.       
-00052d10: 2074 776f 2052 4f49 732c 2072 6f69 3120   two ROIs, roi1 
-00052d20: 616e 6420 726f 6932 2e20 2054 6865 2076  and roi2.  The v
-00052d30: 616c 6964 2073 7065 6369 6669 6361 7469  alid specificati
-00052d40: 6f6e 7320 6172 653a 0a0a 2020 2020 2020  ons are:..      
-00052d50: 2020 2d20 226c 6566 7422 3a20 636f 6e73    - "left": cons
-00052d60: 6964 6572 206f 6e6c 7920 736c 6963 6573  ider only slices
-00052d70: 2063 6f6e 7461 696e 696e 6720 726f 6931   containing roi1
-00052d80: 3b0a 2020 2020 2020 2020 2d20 2272 6967  ;.        - "rig
-00052d90: 6874 223a 2063 6f6e 7369 6465 7220 6f6e  ht": consider on
-00052da0: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-00052db0: 6e69 6e67 2072 6f69 323b 0a20 2020 2020  ning roi2;.     
-00052dc0: 2020 202d 2022 756e 696f 6e22 3a20 636f     - "union": co
-00052dd0: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
-00052de0: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
-00052df0: 6f66 2072 6f69 3120 616e 6420 726f 6932  of roi1 and roi2
-00052e00: 3b0a 2020 2020 2020 2020 2d20 2269 6e74  ;.        - "int
-00052e10: 6572 7365 6374 696f 6e22 3a20 636f 6e73  ersection": cons
-00052e20: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
-00052e30: 6169 6e69 6e67 2062 6f74 6820 726f 6931  aining both roi1
-00052e40: 2061 6e64 2072 6f69 322e 0a0a 2020 2020   and roi2...    
-00052e50: 2020 2020 4966 204e 6f6e 652c 2075 7365      If None, use
-00052e60: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
-00052e70: 6c74 7328 292e 6279 5f73 6c69 6365 0a0a  lts().by_slice..
-00052e80: 2020 2020 2020 2020 7669 6577 203a 2073          view : s
-00052e90: 7472 2c20 6465 6661 756c 743d 2278 2d79  tr, default="x-y
-00052ea0: 220a 2020 2020 2020 2020 2020 2020 4f72  ".            Or
-00052eb0: 6965 6e74 6174 696f 6e20 746f 2063 6f6e  ientation to con
-00052ec0: 7369 6465 7220 7768 656e 2074 616b 696e  sider when takin
-00052ed0: 6720 6365 6e74 726f 6964 2063 6f6d 706f  g centroid compo
-00052ee0: 6e65 6e74 7320 7265 6c61 7469 7665 0a20  nents relative. 
-00052ef0: 2020 2020 2020 2020 2020 2074 6f20 6120             to a 
-00052f00: 736c 6963 652e 2020 4361 6e20 6265 2022  slice.  Can be "
-00052f10: 782d 7922 2c20 2279 2d7a 222c 206f 7220  x-y", "y-z", or 
-00052f20: 2278 2d7a 222e 0a20 2020 2022 2222 0a20  "x-z"..    """. 
-00052f30: 2020 206d 6574 7269 6373 203d 205b 0a20     metrics = [. 
-00052f40: 2020 2020 2020 2020 2020 2022 6162 735f             "abs_
-00052f50: 6365 6e74 726f 6964 222c 0a20 2020 2020  centroid",.     
-00052f60: 2020 2020 2020 2022 6162 735f 6365 6e74         "abs_cent
-00052f70: 726f 6964 5f66 6c61 7422 2c0a 2020 2020  roid_flat",.    
-00052f80: 2020 2020 2020 2020 2261 6273 5f63 656e          "abs_cen
-00052f90: 7472 6f69 645f 736c 6963 6522 2c0a 2020  troid_slice",.  
-00052fa0: 2020 2020 2020 2020 2020 2261 6273 5f63            "abs_c
-00052fb0: 656e 7472 6f69 645f 736c 6963 655f 7374  entroid_slice_st
-00052fc0: 6174 7322 2c0a 2020 2020 2020 2020 2020  ats",.          
-00052fd0: 2020 2261 7265 615f 6469 6666 222c 0a20    "area_diff",. 
-00052fe0: 2020 2020 2020 2020 2020 2022 6172 6561             "area
-00052ff0: 5f64 6966 665f 666c 6174 222c 0a20 2020  _diff_flat",.   
-00053000: 2020 2020 2020 2020 2022 6172 6561 5f64           "area_d
-00053010: 6966 665f 736c 6963 655f 7374 6174 7322  iff_slice_stats"
-00053020: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
-00053030: 7265 615f 7261 7469 6f22 2c0a 2020 2020  rea_ratio",.    
-00053040: 2020 2020 2020 2020 2261 7265 615f 7261          "area_ra
-00053050: 7469 6f5f 666c 6174 222c 0a20 2020 2020  tio_flat",.     
-00053060: 2020 2020 2020 2022 6172 6561 5f72 6174         "area_rat
-00053070: 696f 5f73 6c69 6365 5f73 7461 7473 222c  io_slice_stats",
-00053080: 0a20 2020 2020 2020 2020 2020 2022 6365  .            "ce
-00053090: 6e74 726f 6964 222c 0a20 2020 2020 2020  ntroid",.       
-000530a0: 2020 2020 2022 6365 6e74 726f 6964 5f73       "centroid_s
-000530b0: 6c69 6365 222c 0a20 2020 2020 2020 2020  lice",.         
-000530c0: 2020 2022 6365 6e74 726f 6964 5f73 6c69     "centroid_sli
-000530d0: 6365 5f73 7461 7473 222c 0a20 2020 2020  ce_stats",.     
-000530e0: 2020 2020 2020 2022 6469 6365 222c 0a20         "dice",. 
-000530f0: 2020 2020 2020 2020 2020 2022 6469 6365             "dice
-00053100: 5f66 6c61 7422 2c0a 2020 2020 2020 2020  _flat",.        
-00053110: 2020 2020 2264 6963 655f 736c 6963 6522      "dice_slice"
-00053120: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
-00053130: 6963 655f 736c 6963 655f 7374 6174 7322  ice_slice_stats"
-00053140: 2c0a 2020 2020 2020 2020 2020 2020 2268  ,.            "h
-00053150: 6175 7364 6f72 6666 5f64 6973 7461 6e63  ausdorff_distanc
-00053160: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00053170: 2268 6175 7364 6f72 6666 5f64 6973 7461  "hausdorff_dista
-00053180: 6e63 655f 666c 6174 222c 0a20 2020 2020  nce_flat",.     
-00053190: 2020 2020 2020 2022 6a61 6363 6172 6422         "jaccard"
-000531a0: 2c0a 2020 2020 2020 2020 2020 2020 226a  ,.            "j
-000531b0: 6163 6361 7264 5f66 6c61 7422 2c0a 2020  accard_flat",.  
-000531c0: 2020 2020 2020 2020 2020 226a 6163 6361            "jacca
-000531d0: 7264 5f73 6c69 6365 222c 0a20 2020 2020  rd_slice",.     
-000531e0: 2020 2020 2020 2022 6a61 6363 6172 645f         "jaccard_
-000531f0: 736c 6963 655f 7374 6174 7322 2c0a 2020  slice_stats",.  
-00053200: 2020 2020 2020 2020 2020 226d 6561 6e5f            "mean_
-00053210: 6469 7374 616e 6365 5f74 6f5f 636f 6e66  distance_to_conf
-00053220: 6f72 6d69 7479 222c 0a20 2020 2020 2020  ormity",.       
-00053230: 2020 2020 2022 6d65 616e 5f64 6973 7461       "mean_dista
-00053240: 6e63 655f 746f 5f63 6f6e 666f 726d 6974  nce_to_conformit
-00053250: 795f 666c 6174 222c 0a20 2020 2020 2020  y_flat",.       
-00053260: 2020 2020 2022 6d65 616e 5f73 6967 6e65       "mean_signe
-00053270: 645f 7375 7266 6163 655f 6469 7374 616e  d_surface_distan
-00053280: 6365 222c 0a20 2020 2020 2020 2020 2020  ce",.           
-00053290: 2022 6d65 616e 5f73 6967 6e65 645f 7375   "mean_signed_su
-000532a0: 7266 6163 655f 6469 7374 616e 6365 5f66  rface_distance_f
-000532b0: 6c61 7422 2c0a 2020 2020 2020 2020 2020  lat",.          
-000532c0: 2020 226d 6561 6e5f 7375 7266 6163 655f    "mean_surface_
-000532d0: 6469 7374 616e 6365 222c 0a20 2020 2020  distance",.     
-000532e0: 2020 2020 2020 2022 6d65 616e 5f73 7572         "mean_sur
-000532f0: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
-00053300: 6174 222c 0a20 2020 2020 2020 2020 2020  at",.           
-00053310: 2022 6d65 616e 5f6f 7665 725f 636f 6e74   "mean_over_cont
-00053320: 6f75 7269 6e67 222c 0a20 2020 2020 2020  ouring",.       
-00053330: 2020 2020 2022 6d65 616e 5f6f 7665 725f       "mean_over_
-00053340: 636f 6e74 6f75 7269 6e67 5f66 6c61 7422  contouring_flat"
-00053350: 2c0a 2020 2020 2020 2020 2020 2020 226d  ,.            "m
-00053360: 6561 6e5f 756e 6465 725f 636f 6e74 6f75  ean_under_contou
-00053370: 7269 6e67 222c 0a20 2020 2020 2020 2020  ring",.         
-00053380: 2020 2022 6d65 616e 5f75 6e64 6572 5f63     "mean_under_c
-00053390: 6f6e 746f 7572 696e 675f 666c 6174 222c  ontouring_flat",
-000533a0: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
-000533b0: 6c5f 6172 6561 5f64 6966 6622 2c0a 2020  l_area_diff",.  
-000533c0: 2020 2020 2020 2020 2020 2272 656c 5f61            "rel_a
-000533d0: 7265 615f 6469 6666 5f66 6c61 7422 2c0a  rea_diff_flat",.
-000533e0: 2020 2020 2020 2020 2020 2020 2272 656c              "rel
-000533f0: 5f61 7265 615f 6469 6666 5f73 6c69 6365  _area_diff_slice
-00053400: 5f73 7461 7473 222c 0a20 2020 2020 2020  _stats",.       
-00053410: 2020 2020 2022 7265 6c5f 766f 6c75 6d65       "rel_volume
-00053420: 5f64 6966 6622 2c0a 2020 2020 2020 2020  _diff",.        
-00053430: 2020 2020 2272 6d73 5f73 6967 6e65 645f      "rms_signed_
-00053440: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00053450: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00053460: 726d 735f 7369 676e 6564 5f73 7572 6661  rms_signed_surfa
-00053470: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
-00053480: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00053490: 726d 735f 7375 7266 6163 655f 6469 7374  rms_surface_dist
-000534a0: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
-000534b0: 2020 2022 726d 735f 7375 7266 6163 655f     "rms_surface_
-000534c0: 6469 7374 616e 6365 5f66 6c61 7422 2c0a  distance_flat",.
-000534d0: 2020 2020 2020 2020 2020 2020 2276 6f6c              "vol
-000534e0: 756d 655f 6469 6666 222c 0a20 2020 2020  ume_diff",.     
-000534f0: 2020 2020 2020 2022 766f 6c75 6d65 5f72         "volume_r
-00053500: 6174 696f 222c 0a20 2020 2020 2020 2020  atio",.         
-00053510: 2020 205d 0a0a 2020 2020 2320 5265 706c     ]..    # Repl
-00053520: 6163 6520 6365 6e74 726f 6964 2076 6563  ace centroid vec
-00053530: 746f 7273 2062 7920 636f 6d70 6f6e 656e  tors by componen
-00053540: 7473 2e0a 2020 2020 6966 2063 656e 7472  ts..    if centr
-00053550: 6f69 645f 636f 6d70 6f6e 656e 7473 3a0a  oid_components:.
-00053560: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-00053570: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-00053580: 2020 2020 2020 2263 656e 7472 6f69 6422        "centroid"
-00053590: 3a20 5b22 6365 6e74 726f 6964 5f78 222c  : ["centroid_x",
-000535a0: 2022 6365 6e74 726f 6964 5f79 222c 2022   "centroid_y", "
-000535b0: 6365 6e74 726f 6964 5f7a 225d 2c0a 2020  centroid_z"],.  
-000535c0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-000535d0: 656e 7472 6f69 645f 736c 6963 6522 3a20  entroid_slice": 
-000535e0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-000535f0: 2020 207d 0a20 2020 2020 2020 2069 6620     }.        if 
-00053600: 736c 6963 655f 7374 6174 7320 6973 206e  slice_stats is n
-00053610: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00053620: 2020 2020 2063 656e 7472 6f69 6473 5b22       centroids["
-00053630: 6365 6e74 726f 6964 5f73 6c69 6365 5f73  centroid_slice_s
-00053640: 7461 7473 225d 203d 205b 5d0a 0a20 2020  tats"] = []..   
-00053650: 2020 2020 2066 6f72 2069 5f61 7820 696e       for i_ax in
-00053660: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
-00053670: 745f 6178 6573 5b76 6965 775d 3a0a 2020  t_axes[view]:.  
-00053680: 2020 2020 2020 2020 2020 6178 203d 2073            ax = s
-00053690: 6b72 742e 696d 6167 652e 5f61 7865 735b  krt.image._axes[
-000536a0: 695f 6178 5d0a 2020 2020 2020 2020 2020  i_ax].          
-000536b0: 2020 6365 6e74 726f 6964 735b 2263 656e    centroids["cen
-000536c0: 7472 6f69 645f 736c 6963 6522 5d2e 6170  troid_slice"].ap
-000536d0: 7065 6e64 2866 2263 656e 7472 6f69 645f  pend(f"centroid_
-000536e0: 736c 6963 655f 7b61 787d 2229 0a0a 2020  slice_{ax}")..  
-000536f0: 2020 2020 2020 2020 2020 6966 2073 6c69            if sli
-00053700: 6365 5f73 7461 7473 2069 7320 6e6f 7420  ce_stats is not 
-00053710: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00053720: 2020 2020 2020 6365 6e74 726f 6964 735b        centroids[
-00053730: 2263 656e 7472 6f69 645f 736c 6963 655f  "centroid_slice_
-00053740: 7374 6174 7322 5d2e 6170 7065 6e64 280a  stats"].append(.
-00053750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053760: 2020 2020 2020 2020 6622 6365 6e74 726f          f"centro
-00053770: 6964 5f7b 6178 7d5f 736c 6963 655f 7374  id_{ax}_slice_st
-00053780: 6174 7322 290a 0a20 2020 2020 2020 2066  ats")..        f
-00053790: 6f72 2076 6563 746f 722c 2063 6f6d 706f  or vector, compo
-000537a0: 6e65 6e74 7320 696e 2063 656e 7472 6f69  nents in centroi
-000537b0: 6473 2e69 7465 6d73 2829 3a0a 2020 2020  ds.items():.    
-000537c0: 2020 2020 2020 2020 6964 7820 3d20 6d65          idx = me
-000537d0: 7472 6963 732e 696e 6465 7828 7665 6374  trics.index(vect
-000537e0: 6f72 290a 2020 2020 2020 2020 2020 2020  or).            
-000537f0: 6d65 7472 6963 735b 6964 7820 3a20 6964  metrics[idx : id
-00053800: 7820 2b20 315d 203d 2063 6f6d 706f 6e65  x + 1] = compone
-00053810: 6e74 730a 0a20 2020 2023 2052 656d 6f76  nts..    # Remov
-00053820: 6520 6d65 7472 6963 7320 7769 7468 2073  e metrics with s
-00053830: 7566 6669 7820 2273 6c69 6365 5f73 7461  uffix "slice_sta
-00053840: 7473 222c 0a20 2020 2023 2061 6e64 2072  ts",.    # and r
-00053850: 6570 6c61 6365 2077 6974 6820 7370 6563  eplace with spec
-00053860: 6966 6963 206d 6574 7269 6373 2072 656c  ific metrics rel
-00053870: 6174 696e 6720 746f 2073 6c69 6365 2d62  ating to slice-b
-00053880: 792d 736c 6963 6520 7374 6174 6973 7469  y-slice statisti
-00053890: 6373 2e0a 2020 2020 6966 2073 6c69 6365  cs..    if slice
-000538a0: 5f73 7461 7473 2069 7320 6e6f 7420 4e6f  _stats is not No
-000538b0: 6e65 3a0a 2020 2020 2020 2020 736c 6963  ne:.        slic
-000538c0: 655f 7374 6174 735f 6d65 7472 6963 7320  e_stats_metrics 
-000538d0: 3d20 5b5d 0a20 2020 2020 2020 206d 6574  = [].        met
-000538e0: 7269 6373 3220 3d20 5b5d 0a20 2020 2020  rics2 = [].     
-000538f0: 2020 2066 6f72 206d 6574 7269 6320 696e     for metric in
-00053900: 206d 6574 7269 6373 3a0a 2020 2020 2020   metrics:.      
-00053910: 2020 2020 2020 6966 2022 736c 6963 655f        if "slice_
-00053920: 7374 6174 7322 2069 6e20 6d65 7472 6963  stats" in metric
-00053930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00053940: 2020 736c 6963 655f 7374 6174 735f 6d65    slice_stats_me
-00053950: 7472 6963 732e 6170 7065 6e64 286d 6574  trics.append(met
-00053960: 7269 632e 7370 6c69 7428 225f 736c 6963  ric.split("_slic
-00053970: 655f 7374 6174 7322 295b 305d 290a 2020  e_stats")[0]).  
-00053980: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00053990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000539a0: 6d65 7472 6963 7332 2e61 7070 656e 6428  metrics2.append(
-000539b0: 6d65 7472 6963 290a 0a20 2020 2020 2020  metric)..       
-000539c0: 2066 6f72 2062 795f 736c 6963 652c 2073   for by_slice, s
-000539d0: 7461 7473 2069 6e20 280a 2020 2020 2020  tats in (.      
-000539e0: 2020 2020 2020 2020 2020 6578 7061 6e64            expand
-000539f0: 5f73 6c69 6365 5f73 7461 7473 2873 6c69  _slice_stats(sli
-00053a00: 6365 5f73 7461 7473 2c20 6465 6661 756c  ce_stats, defaul
-00053a10: 745f 6279 5f73 6c69 6365 292e 6974 656d  t_by_slice).item
-00053a20: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
-00053a30: 2020 666f 7220 6d65 7472 6963 2069 6e20    for metric in 
-00053a40: 736c 6963 655f 7374 6174 735f 6d65 7472  slice_stats_metr
-00053a50: 6963 733a 0a20 2020 2020 2020 2020 2020  ics:.           
-00053a60: 2020 2020 2066 6f72 2073 7461 7420 696e       for stat in
-00053a70: 2073 7461 7473 3a0a 2020 2020 2020 2020   stats:.        
-00053a80: 2020 2020 2020 2020 2020 2020 6d65 7472              metr
-00053a90: 6963 7332 2e61 7070 656e 6428 6622 7b6d  ics2.append(f"{m
-00053aa0: 6574 7269 637d 5f73 6c69 6365 5f7b 6279  etric}_slice_{by
-00053ab0: 5f73 6c69 6365 7d5f 7b73 7461 747d 2229  _slice}_{stat}")
-00053ac0: 0a20 2020 2020 2020 206d 6574 7269 6373  .        metrics
-00053ad0: 203d 206d 6574 7269 6373 320a 0a20 2020   = metrics2..   
-00053ae0: 2072 6574 7572 6e20 736f 7274 6564 286d   return sorted(m
-00053af0: 6574 7269 6373 290a 0a64 6566 2067 6574  etrics)..def get
-00053b00: 5f63 6f6e 7365 6e73 7573 5f74 7970 6573  _consensus_types
-00053b10: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00053b20: 4765 7420 6c69 7374 206f 6620 636f 6e73  Get list of cons
-00053b30: 656e 7375 7320 7479 7065 732e 0a0a 2020  ensus types...  
-00053b40: 2020 416c 6c20 636f 6e73 656e 7375 7320    All consensus 
-00053b50: 7479 7065 7320 6c69 7374 6564 2068 6572  types listed her
-00053b60: 6520 7368 6f75 6c64 2062 6520 7265 636f  e should be reco
-00053b70: 676e 6973 6564 2062 790a 2020 2020 5374  gnised by.    St
-00053b80: 7275 6374 7572 6553 6574 2e67 6574 5f63  ructureSet.get_c
-00053b90: 6f6e 7365 6e73 7573 2829 2c20 616e 6420  onsensus(), and 
-00053ba0: 616c 6c20 636f 6e73 656e 7375 7320 7479  all consensus ty
-00053bb0: 7065 7320 7265 636f 676e 6973 6564 0a20  pes recognised. 
-00053bc0: 2020 2062 7920 5374 7275 6374 7572 6553     by StructureS
-00053bd0: 6574 2e67 6574 5f63 6f6e 7365 6e73 7573  et.get_consensus
-00053be0: 2073 686f 756c 6420 6265 206c 6973 7465   should be liste
-00053bf0: 6420 6865 7265 2e0a 2020 2020 2222 220a  d here..    """.
-00053c00: 2020 2020 7265 7475 726e 205b 0a20 2020      return [.   
-00053c10: 2020 2020 2020 2020 2022 6d61 6a6f 7269           "majori
-00053c20: 7479 222c 0a20 2020 2020 2020 2020 2020  ty",.           
-00053c30: 2022 6f76 6572 6c61 7022 2c0a 2020 2020   "overlap",.    
-00053c40: 2020 2020 2020 2020 2273 7461 706c 6522          "staple"
-00053c50: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00053c60: 756d 222c 0a20 2020 2020 2020 2020 2020  um",.           
-00053c70: 205d 0a0a 6465 6620 6765 745f 6279 5f73   ]..def get_by_s
-00053c80: 6c69 6365 5f6d 6574 686f 6473 2829 3a0a  lice_methods():.
-00053c90: 2020 2020 2222 220a 2020 2020 4765 7420      """.    Get 
-00053ca0: 6c69 7374 206f 6620 6d65 7468 6f64 7320  list of methods 
-00053cb0: 666f 7220 6465 6669 6e69 6e67 2073 6c69  for defining sli
-00053cc0: 6365 7320 746f 2062 6520 636f 6e73 6964  ces to be consid
-00053cd0: 6572 6564 0a20 2020 2066 6f72 2073 6c69  ered.    for sli
-00053ce0: 6365 2d62 792d 736c 6963 6520 524f 4920  ce-by-slice ROI 
-00053cf0: 636f 6d70 6172 6973 6f6e 732e 0a20 2020  comparisons..   
-00053d00: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
-00053d10: 5b22 6c65 6674 222c 2022 7269 6768 7422  ["left", "right"
-00053d20: 2c20 2275 6e69 6f6e 222c 2022 696e 7465  , "union", "inte
-00053d30: 7273 6563 7469 6f6e 225d 0a0a 6465 6620  rsection"]..def 
-00053d40: 6765 745f 616c 6c5f 726f 6973 286f 626a  get_all_rois(obj
-00053d50: 733d 4e6f 6e65 293a 0a20 2020 2022 2222  s=None):.    """
-00053d60: 0a20 2020 2043 7265 6174 6520 6c69 7374  .    Create list
-00053d70: 206f 6620 524f 4973 2066 726f 6d20 6172   of ROIs from ar
-00053d80: 6269 7472 6172 7920 636f 6d62 696e 6174  bitrary combinat
-00053d90: 696f 6e20 6f66 2052 4f49 7320 616e 6420  ion of ROIs and 
-00053da0: 5374 7275 6374 7572 6553 6574 732e 0a0a  StructureSets...
-00053db0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-00053dc0: 3a2a 2a0a 0a20 2020 206f 626a 7320 3a20  :**..    objs : 
-00053dd0: 524f 492f 5374 7275 6374 7572 6553 6574  ROI/StructureSet
-00053de0: 2f6c 6973 742c 2064 6566 6175 6c74 3d4e  /list, default=N
-00053df0: 6f6e 650a 2020 2020 2020 2020 4f62 6a65  one.        Obje
-00053e00: 6374 2873 2920 6672 6f6d 2077 6869 6368  ct(s) from which
-00053e10: 2061 206c 6973 7420 6f66 2052 4f49 7320   a list of ROIs 
-00053e20: 6973 2074 6f20 6265 2063 7265 6174 6564  is to be created
-00053e30: 2e20 2054 6865 0a20 2020 2020 2020 206f  .  The.        o
-00053e40: 626a 6563 7428 7329 2063 616e 2062 6520  bject(s) can be 
-00053e50: 6120 7369 6e67 6c65 2073 6b72 742e 7374  a single skrt.st
-00053e60: 7275 6374 7572 6573 2e52 4f49 206f 626a  ructures.ROI obj
-00053e70: 6563 742c 2061 2073 696e 676c 650a 2020  ect, a single.  
-00053e80: 2020 2020 2020 736b 7274 2e73 7472 7563        skrt.struc
-00053e90: 7475 7265 732e 5374 7275 6374 7572 6553  tures.StructureS
-00053ea0: 6574 206f 626a 6563 742c 206f 7220 6120  et object, or a 
-00053eb0: 6c69 7374 2063 6f6e 7461 696e 696e 6720  list containing 
-00053ec0: 616e 790a 2020 2020 2020 2020 636f 6d62  any.        comb
-00053ed0: 696e 6174 696f 6e20 6f66 2052 4f49 2061  ination of ROI a
-00053ee0: 6e64 2053 7472 7563 7475 7265 5365 7420  nd StructureSet 
-00053ef0: 6f62 6a65 6374 732e 0a20 2020 2022 2222  objects..    """
-00053f00: 0a20 2020 2023 2045 6e73 7572 6520 7468  .    # Ensure th
-00053f10: 6174 206f 626a 7320 6973 2061 206c 6973  at objs is a lis
-00053f20: 740a 2020 2020 6966 2069 7373 7562 636c  t.    if issubcl
-00053f30: 6173 7328 7479 7065 286f 626a 7329 2c20  ass(type(objs), 
-00053f40: 2852 4f49 2c20 5374 7275 6374 7572 6553  (ROI, StructureS
-00053f50: 6574 2929 3a0a 2020 2020 2020 2020 6f62  et)):.        ob
-00053f60: 6a73 203d 205b 6f62 6a73 5d0a 2020 2020  js = [objs].    
-00053f70: 656c 6966 206f 626a 7320 6973 204e 6f6e  elif objs is Non
-00053f80: 653a 0a20 2020 2020 2020 206f 626a 7320  e:.        objs 
-00053f90: 3d20 5b5d 0a0a 2020 2020 2320 4372 6561  = []..    # Crea
-00053fa0: 7465 2061 206c 6973 7420 636f 6e74 6169  te a list contai
-00053fb0: 6e69 6e67 2061 6c6c 2075 6e69 7175 6520  ning all unique 
-00053fc0: 726f 6973 2e0a 2020 2020 616c 6c5f 726f  rois..    all_ro
-00053fd0: 6973 203d 205b 5d0a 2020 2020 666f 7220  is = [].    for 
-00053fe0: 6974 656d 2069 6e20 6f62 6a73 3a0a 2020  item in objs:.  
-00053ff0: 2020 2020 2020 6966 2069 7373 7562 636c        if issubcl
-00054000: 6173 7328 7479 7065 2869 7465 6d29 2c20  ass(type(item), 
-00054010: 524f 4929 3a0a 2020 2020 2020 2020 2020  ROI):.          
-00054020: 2020 6361 6e64 6964 6174 655f 726f 6973    candidate_rois
-00054030: 203d 205b 6974 656d 5d0a 2020 2020 2020   = [item].      
-00054040: 2020 656c 6966 2069 7373 7562 636c 6173    elif issubclas
-00054050: 7328 7479 7065 2869 7465 6d29 2c20 5374  s(type(item), St
-00054060: 7275 6374 7572 6553 6574 293a 0a20 2020  ructureSet):.   
-00054070: 2020 2020 2020 2020 2063 616e 6469 6461           candida
-00054080: 7465 5f72 6f69 7320 3d20 6974 656d 2e67  te_rois = item.g
-00054090: 6574 5f72 6f69 7328 290a 2020 2020 2020  et_rois().      
-000540a0: 2020 666f 7220 726f 6920 696e 2063 616e    for roi in can
-000540b0: 6469 6461 7465 5f72 6f69 733a 0a20 2020  didate_rois:.   
-000540c0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000540d0: 726f 6920 696e 2061 6c6c 5f72 6f69 733a  roi in all_rois:
-000540e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000540f0: 2061 6c6c 5f72 6f69 732e 6170 7065 6e64   all_rois.append
-00054100: 2872 6f69 290a 0a20 2020 2072 6574 7572  (roi)..    retur
-00054110: 6e20 616c 6c5f 726f 6973 0a0a 6465 6620  n all_rois..def 
-00054120: 6765 745f 7472 616e 736c 6174 696f 6e5f  get_translation_
-00054130: 746f 5f61 6c69 676e 2872 6f69 312c 2072  to_align(roi1, r
-00054140: 6f69 322c 207a 5f66 7261 6374 696f 6e31  oi2, z_fraction1
-00054150: 3d4e 6f6e 652c 207a 5f66 7261 6374 696f  =None, z_fractio
-00054160: 6e32 3d4e 6f6e 6529 3a0a 2020 2020 2222  n2=None):.    ""
-00054170: 220a 2020 2020 4465 7465 726d 696e 6520  ".    Determine 
-00054180: 7472 616e 736c 6174 696f 6e20 666f 7220  translation for 
-00054190: 616c 6967 6e69 6e67 203c 726f 6931 3e20  aligning <roi1> 
-000541a0: 746f 203c 726f 6932 3e2e 0a0a 2020 2020  to <roi2>...    
-000541b0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-000541c0: 0a20 2020 2072 6f69 3120 3a20 524f 492f  .    roi1 : ROI/
-000541d0: 5374 7275 6374 7572 6553 6574 2f6c 6973  StructureSet/lis
-000541e0: 740a 2020 2020 2020 2020 524f 4920 7468  t.        ROI th
-000541f0: 6174 2069 7320 746f 2062 6520 7472 616e  at is to be tran
-00054200: 736c 6174 696f 6e20 746f 2061 6368 6965  slation to achie
-00054210: 7665 2074 6865 2061 6c69 676e 6d65 6e74  ve the alignment
-00054220: 2e20 2054 6869 730a 2020 2020 2020 2020  .  This.        
-00054230: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
-00054240: 2064 6972 6563 746c 7920 6173 2061 2073   directly as a s
-00054250: 696e 676c 6520 524f 492e 2020 416c 7465  ingle ROI.  Alte
-00054260: 726e 6174 6976 656c 792c 0a20 2020 2020  rnatively,.     
-00054270: 2020 2069 7420 6361 6e20 6265 2061 2053     it can be a S
-00054280: 7472 7563 7475 7265 5365 742c 206f 7220  tructureSet, or 
-00054290: 6120 6c69 7374 206f 7220 524f 492f 5374  a list or ROI/St
-000542a0: 7275 6374 7572 6553 6574 206f 626a 6563  ructureSet objec
-000542b0: 7473 2c0a 2020 2020 2020 2020 696e 2077  ts,.        in w
-000542c0: 6869 6368 2063 6173 6520 7468 6520 696e  hich case the in
-000542d0: 6469 7669 6475 616c 2052 4f49 7320 7769  dividual ROIs wi
-000542e0: 6c6c 2062 6520 636f 6d62 696e 6564 2e0a  ll be combined..
-000542f0: 0a20 2020 2072 6f69 3220 3a20 524f 492f  .    roi2 : ROI/
-00054300: 5374 7275 6374 7572 6553 6574 2f6c 6973  StructureSet/lis
-00054310: 740a 2020 2020 2020 2020 524f 4920 7769  t.        ROI wi
-00054320: 7468 2077 6869 6368 2061 6c69 676e 6d65  th which alignme
-00054330: 6e74 2069 7320 746f 2062 6520 7065 7266  nt is to be perf
-00054340: 6f72 6d65 642e 2020 5468 6973 2063 616e  ormed.  This can
-00054350: 2062 650a 2020 2020 2020 2020 7370 6563   be.        spec
-00054360: 6966 6965 6420 6469 7265 6374 6c79 2061  ified directly a
-00054370: 7320 6120 7369 6e67 6c65 2052 4f49 2e20  s a single ROI. 
-00054380: 2041 6c74 6572 6e61 7469 7665 6c79 2c20   Alternatively, 
-00054390: 6974 2063 616e 0a20 2020 2020 2020 2062  it can.        b
-000543a0: 6520 6120 5374 7275 6374 7572 6553 6574  e a StructureSet
-000543b0: 2c20 6f72 2061 206c 6973 7420 6f72 2052  , or a list or R
-000543c0: 4f49 2f53 7472 7563 7475 7265 5365 7420  OI/StructureSet 
-000543d0: 6f62 6a65 6374 732c 0a20 2020 2020 2020  objects,.       
-000543e0: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
-000543f0: 6865 2069 6e64 6976 6964 7561 6c20 524f  he individual RO
-00054400: 4973 2077 696c 6c20 6265 2063 6f6d 6269  Is will be combi
-00054410: 6e65 642e 0a0a 2020 2020 7a5f 6672 6163  ned...    z_frac
-00054420: 7469 6f6e 3120 3a20 666c 6f61 742c 2064  tion1 : float, d
-00054430: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00054440: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
-00054450: 6e67 207a 2061 7869 7320 6f66 2073 6c69  ng z axis of sli
-00054460: 6365 2074 6872 6f75 6768 203c 726f 6931  ce through <roi1
-00054470: 3e20 6f6e 2077 6869 6368 0a20 2020 2020  > on which.     
-00054480: 2020 2074 6f20 616c 6967 6e2e 2020 4966     to align.  If
-00054490: 204e 6f6e 652c 2061 6c69 676e 6d65 6e74   None, alignment
-000544a0: 2069 7320 746f 2074 6865 2063 656e 7472   is to the centr
-000544b0: 6f69 6420 6f66 2074 6865 0a20 2020 2020  oid of the.     
-000544c0: 2020 2077 686f 6c65 2052 4f49 2076 6f6c     whole ROI vol
-000544d0: 756d 652e 2020 4f74 6865 7277 6973 652c  ume.  Otherwise,
-000544e0: 2061 6c69 676e 6d65 6e74 2069 7320 746f   alignment is to
-000544f0: 2074 6865 0a20 2020 2020 2020 2063 656e   the.        cen
-00054500: 7472 6f69 6420 6f66 2074 6865 2073 6c69  troid of the sli
-00054510: 6365 2061 7420 7468 6520 7370 6563 6966  ce at the specif
-00054520: 6965 6420 6469 7374 616e 6365 0a20 2020  ied distance.   
-00054530: 2020 2020 2066 726f 6d20 7468 6520 524f       from the RO
-00054540: 4927 7320 6d6f 7374 2d69 6e66 6572 696f  I's most-inferio
-00054550: 7220 706f 696e 743a 2030 2063 6f72 7265  r point: 0 corre
-00054560: 7370 6f6e 6473 2074 6f0a 2020 2020 2020  sponds to.      
-00054570: 2020 7468 6520 6d6f 7374 2d69 6e66 6572    the most-infer
-00054580: 696f 7220 706f 696e 7420 286c 6f77 6573  ior point (lowes
-00054590: 7420 7a29 3b20 3120 636f 7272 6573 706f  t z); 1 correspo
-000545a0: 6e64 7320 746f 2074 6865 0a20 2020 2020  nds to the.     
-000545b0: 2020 206d 6f73 742d 7375 7065 7269 6f72     most-superior
-000545c0: 2070 6f69 6e74 2028 6869 6768 6573 7420   point (highest 
-000545d0: 7a29 2e20 2056 616c 7565 7320 666f 7220  z).  Values for 
-000545e0: 7a5f 6672 6163 7469 6f6e 0a20 2020 2020  z_fraction.     
-000545f0: 2020 206f 7574 7369 6465 2074 6865 2069     outside the i
-00054600: 6e74 6572 7661 6c20 5b30 2c20 315d 2072  nterval [0, 1] r
-00054610: 6573 756c 7420 696e 2061 2052 756e 7469  esult in a Runti
-00054620: 6d65 4572 726f 722e 0a0a 2020 2020 7a5f  meError...    z_
-00054630: 6672 6163 7469 6f6e 3220 3a20 666c 6f61  fraction2 : floa
-00054640: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00054650: 2020 2020 2020 2020 506f 7369 7469 6f6e          Position
-00054660: 2061 6c6f 6e67 207a 2061 7869 7320 6f66   along z axis of
-00054670: 2073 6c69 6365 2074 6872 6f75 6768 203c   slice through <
-00054680: 726f 6932 3e20 6f6e 2077 6869 6368 0a20  roi2> on which. 
-00054690: 2020 2020 2020 2074 6f20 616c 6967 6e2e         to align.
-000546a0: 2020 4966 204e 6f6e 652c 2061 6c69 676e    If None, align
-000546b0: 6d65 6e74 2069 7320 746f 2074 6865 2063  ment is to the c
-000546c0: 656e 7472 6f69 6420 6f66 2074 6865 0a20  entroid of the. 
-000546d0: 2020 2020 2020 2077 686f 6c65 2052 4f49         whole ROI
-000546e0: 2076 6f6c 756d 652e 2020 4f74 6865 7277   volume.  Otherw
-000546f0: 6973 652c 2061 6c69 676e 6d65 6e74 2069  ise, alignment i
-00054700: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
-00054710: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
-00054720: 2073 6c69 6365 2061 7420 7468 6520 7370   slice at the sp
-00054730: 6563 6966 6965 6420 6469 7374 616e 6365  ecified distance
-00054740: 0a20 2020 2020 2020 2066 726f 6d20 7468  .        from th
-00054750: 6520 524f 4927 7320 6d6f 7374 2d69 6e66  e ROI's most-inf
-00054760: 6572 696f 7220 706f 696e 743a 2030 2063  erior point: 0 c
-00054770: 6f72 7265 7370 6f6e 6473 2074 6f0a 2020  orresponds to.  
-00054780: 2020 2020 2020 7468 6520 6d6f 7374 2d69        the most-i
-00054790: 6e66 6572 696f 7220 706f 696e 7420 286c  nferior point (l
-000547a0: 6f77 6573 7420 7a29 3b20 3120 636f 7272  owest z); 1 corr
-000547b0: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
-000547c0: 2020 2020 2020 206d 6f73 742d 7375 7065         most-supe
-000547d0: 7269 6f72 2070 6f69 6e74 2028 6869 6768  rior point (high
-000547e0: 6573 7420 7a29 2e20 2056 616c 7565 7320  est z).  Values 
-000547f0: 666f 7220 7a5f 6672 6163 7469 6f6e 0a20  for z_fraction. 
-00054800: 2020 2020 2020 206f 7574 7369 6465 2074         outside t
-00054810: 6865 2069 6e74 6572 7661 6c20 5b30 2c20  he interval [0, 
-00054820: 315d 2072 6573 756c 7420 696e 2061 2052  1] result in a R
-00054830: 756e 7469 6d65 4572 726f 722e 0a20 2020  untimeError..   
-00054840: 2020 2020 2022 2222 0a20 2020 2023 2043       """.    # C
-00054850: 7265 6174 6520 6c69 7374 206f 6620 7477  reate list of tw
-00054860: 6f20 7369 6e67 6c65 2052 4f49 732e 0a20  o single ROIs.. 
-00054870: 2020 2072 6f69 7320 3d20 5b5d 0a20 2020     rois = [].   
-00054880: 2066 6f72 2072 6f69 2069 6e20 5b72 6f69   for roi in [roi
-00054890: 312c 2072 6f69 325d 3a0a 2020 2020 2020  1, roi2]:.      
-000548a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000548b0: 726f 692c 2052 4f49 293a 0a20 2020 2020  roi, ROI):.     
-000548c0: 2020 2020 2020 2023 2053 746f 7265 2073         # Store s
-000548d0: 696e 676c 6520 524f 4920 6469 7265 6374  ingle ROI direct
-000548e0: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
-000548f0: 726f 6973 2e61 7070 656e 6428 726f 6929  rois.append(roi)
-00054900: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-00054910: 696e 7374 616e 6365 2872 6f69 2c20 5374  instance(roi, St
-00054920: 7275 6374 7572 6553 6574 293a 0a20 2020  ructureSet):.   
-00054930: 2020 2020 2020 2020 2023 2043 6f6d 6269           # Combi
-00054940: 6e65 2052 4f49 7320 6f66 2053 7472 7563  ne ROIs of Struc
-00054950: 7475 7265 5365 742e 0a20 2020 2020 2020  tureSet..       
-00054960: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
-00054970: 2872 6f69 2e63 6f6d 6269 6e65 5f72 6f69  (roi.combine_roi
-00054980: 7328 2929 0a20 2020 2020 2020 2065 6c73  s()).        els
-00054990: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-000549a0: 2043 6f6d 6269 6e65 2052 4f49 7320 6672   Combine ROIs fr
-000549b0: 6f6d 206c 6973 742e 0a20 2020 2020 2020  om list..       
-000549c0: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
-000549d0: 2853 7472 7563 7475 7265 5365 7428 6765  (StructureSet(ge
-000549e0: 745f 616c 6c5f 726f 6973 2872 6f69 2929  t_all_rois(roi))
-000549f0: 2e63 6f6d 6269 6e65 5f72 6f69 7328 2929  .combine_rois())
-00054a00: 0a0a 2020 2020 2320 4361 6c63 756c 6174  ..    # Calculat
-00054a10: 6520 616c 6967 6e6d 656e 7420 706f 696e  e alignment poin
-00054a20: 7473 2e0a 2020 2020 6365 6e74 726f 6964  ts..    centroid
-00054a30: 7320 3d20 5b5d 0a20 2020 2066 6f72 2072  s = [].    for r
-00054a40: 6f69 2c20 7a5f 6672 6163 7469 6f6e 2069  oi, z_fraction i
-00054a50: 6e20 7a69 7028 726f 6973 2c20 5b7a 5f66  n zip(rois, [z_f
-00054a60: 7261 6374 696f 6e31 2c20 7a5f 6672 6163  raction1, z_frac
-00054a70: 7469 6f6e 325d 293a 0a20 2020 2020 2020  tion2]):.       
-00054a80: 2023 2043 616c 6375 6c61 7465 2063 656e   # Calculate cen
-00054a90: 7472 6f69 6420 666f 7220 7468 6520 7768  troid for the wh
-00054aa0: 6f6c 6520 524f 4920 766f 6c75 6d65 2e0a  ole ROI volume..
-00054ab0: 2020 2020 2020 2020 6966 207a 5f66 7261          if z_fra
-00054ac0: 6374 696f 6e20 6973 204e 6f6e 653a 0a20  ction is None:. 
-00054ad0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-00054ae0: 6f69 6473 2e61 7070 656e 6428 726f 692e  oids.append(roi.
-00054af0: 6765 745f 6365 6e74 726f 6964 2829 290a  get_centroid()).
-00054b00: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-00054b10: 6174 6520 6365 6e74 726f 6964 2066 6f72  ate centroid for
-00054b20: 2073 6c69 6365 2061 7420 7370 6563 6966   slice at specif
-00054b30: 6965 6420 706f 7369 7469 6f6e 2e0a 2020  ied position..  
-00054b40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00054b50: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-00054b60: 732e 6170 7065 6e64 2872 6f69 2e67 6574  s.append(roi.get
-00054b70: 5f72 6f69 5f73 6c69 6365 287a 5f66 7261  _roi_slice(z_fra
-00054b80: 6374 696f 6e29 2e67 6574 5f63 656e 7472  ction).get_centr
-00054b90: 6f69 6428 2929 0a0a 2020 2020 7265 7475  oid())..    retu
-00054ba0: 726e 2074 7570 6c65 2863 656e 7472 6f69  rn tuple(centroi
-00054bb0: 6473 5b31 5d20 2d20 6365 6e74 726f 6964  ds[1] - centroid
-00054bc0: 735b 305d 290a 0a64 6566 2067 6574 5f73  s[0])..def get_s
-00054bd0: 6c69 6365 5f70 6f73 6974 696f 6e73 2872  lice_positions(r
-00054be0: 6f69 312c 2072 6f69 323d 4e6f 6e65 2c20  oi1, roi2=None, 
-00054bf0: 7669 6577 3d22 782d 7922 2c20 706f 7369  view="x-y", posi
-00054c00: 7469 6f6e 5f61 735f 6964 783d 4661 6c73  tion_as_idx=Fals
-00054c10: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
-00054c20: 643d 4e6f 6e65 293a 0a20 2020 2022 2222  d=None):.    """
-00054c30: 0a20 2020 2047 6574 206f 7264 6572 6564  .    Get ordered
-00054c40: 206c 6973 7420 6f66 2073 6c69 6365 2070   list of slice p
-00054c50: 6f73 6974 696f 6e73 2066 6f72 2065 6974  ositions for eit
-00054c60: 6865 7220 6f72 2062 6f74 6820 6f66 2061  her or both of a
-00054c70: 2070 6169 7220 6f66 2052 4f49 732e 0a0a   pair of ROIs...
-00054c80: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-00054c90: 3a2a 2a0a 0a20 2020 2072 6f69 3120 3a20  :**..    roi1 : 
-00054ca0: 736b 7274 2e73 7472 7563 7475 7265 732e  skrt.structures.
-00054cb0: 524f 490a 2020 2020 2020 2020 524f 492c  ROI.        ROI,
-00054cc0: 206f 7220 6f6e 6520 6f66 2061 2070 6169   or one of a pai
-00054cd0: 7220 6f66 2052 4f49 732c 2066 6f72 2077  r of ROIs, for w
-00054ce0: 6869 6368 2073 6c69 6365 2069 6e66 6f72  hich slice infor
-00054cf0: 6d61 7469 6f6e 2069 7320 746f 0a20 2020  mation is to.   
-00054d00: 2020 2020 2062 6520 6f62 7461 696e 6564       be obtained
-00054d10: 2e0a 0a20 2020 2072 6f69 3220 3a20 736b  ...    roi2 : sk
-00054d20: 7274 2e73 7472 7563 7475 7265 732e 524f  rt.structures.RO
-00054d30: 492c 2064 6566 6175 6c74 3d4e 6f6e 650a  I, default=None.
-00054d40: 2020 2020 2020 2020 4966 206e 6f74 204e          If not N
-00054d50: 6f6e 652c 2073 6563 6f6e 6420 696e 2061  one, second in a
-00054d60: 2070 6169 7220 6f66 2052 4f49 7320 666f   pair of ROIs fo
-00054d70: 7220 7768 6963 6820 736c 6963 6520 696e  r which slice in
-00054d80: 666f 726d 6174 696f 6e0a 2020 2020 2020  formation.      
-00054d90: 2020 6973 2074 6f20 6265 206f 6274 6169    is to be obtai
-00054da0: 6e65 642e 0a0a 2020 2020 7669 6577 203a  ned...    view :
-00054db0: 2073 7472 2c20 6465 6661 756c 743d 2278   str, default="x
-00054dc0: 2d79 220a 2020 2020 2020 2020 5669 6577  -y".        View
-00054dd0: 2069 6e20 7768 6963 6820 746f 206f 6274   in which to obt
-00054de0: 6169 6e20 736c 6963 6573 2e0a 0a20 2020  ain slices...   
-00054df0: 2070 6f73 6974 696f 6e5f 6173 5f69 6478   position_as_idx
-00054e00: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00054e10: 3d46 616c 7365 0a20 2020 2020 2020 2049  =False.        I
-00054e20: 6620 5472 7565 2c20 7265 7475 726e 2070  f True, return p
-00054e30: 6f73 6974 696f 6e73 2061 7320 736c 6963  ositions as slic
-00054e40: 6520 696e 6469 6365 733b 2069 6620 4661  e indices; if Fa
-00054e50: 6c73 652c 0a20 2020 2020 2020 2072 6574  lse,.        ret
-00054e60: 7572 6e20 706f 7369 7469 6f6e 7320 6173  urn positions as
-00054e70: 2073 6c69 6365 207a 2d63 6f6f 7264 696e   slice z-coordin
-00054e80: 6174 6573 2028 6d6d 292e 0a0a 2020 2020  ates (mm)...    
-00054e90: 6d65 7468 6f64 3a20 7374 722c 2064 6566  method: str, def
-00054ea0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00054eb0: 2020 5374 7269 6e67 2073 7065 6369 6679    String specify
-00054ec0: 696e 6720 736c 6963 6573 2066 6f72 2077  ing slices for w
-00054ed0: 6869 6368 2070 6f73 6974 696f 6e73 2061  hich positions a
-00054ee0: 7265 2074 6f20 6265 206f 6274 6169 6e65  re to be obtaine
-00054ef0: 642c 0a20 2020 2020 2020 2066 6f72 2052  d,.        for R
-00054f00: 4f49 7320 726f 6931 2c20 726f 6932 3a0a  OIs roi1, roi2:.
-00054f10: 0a20 2020 2020 2020 202d 2022 6c65 6674  .        - "left
-00054f20: 2220 286f 7220 726f 6932 2069 7320 4e6f  " (or roi2 is No
-00054f30: 6e65 293a 2072 6574 7572 6e20 706f 7369  ne): return posi
-00054f40: 7469 6f6e 7320 6f66 2073 6c69 6365 7320  tions of slices 
-00054f50: 636f 6e74 6169 6e69 6e67 2072 6f69 313b  containing roi1;
-00054f60: 0a20 2020 2020 2020 202d 2022 7269 6768  .        - "righ
-00054f70: 7422 3a20 7265 7475 726e 2070 6f73 6974  t": return posit
-00054f80: 696f 6e73 206f 6620 736c 6963 6573 2063  ions of slices c
-00054f90: 6f6e 7461 696e 696e 6720 726f 6932 3b0a  ontaining roi2;.
-00054fa0: 2020 2020 2020 2020 2d20 2275 6e69 6f6e          - "union
-00054fb0: 223a 2072 6574 7572 6e20 706f 7369 7469  ": return positi
-00054fc0: 6f6e 7320 6f66 2073 6c69 6365 7320 636f  ons of slices co
-00054fd0: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
-00054fe0: 726f 6931 206f 7220 726f 6932 3b0a 2020  roi1 or roi2;.  
-00054ff0: 2020 2020 2020 2d20 2269 6e74 6572 7365        - "interse
-00055000: 6374 696f 6e22 3a20 7265 7475 726e 2070  ction": return p
-00055010: 6f73 6974 696f 6e73 206f 6620 736c 6963  ositions of slic
-00055020: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
-00055030: 7468 0a20 2020 2020 2020 2020 2072 6f69  th.          roi
-00055040: 3120 616e 6420 726f 6932 2e0a 0a20 2020  1 and roi2...   
-00055050: 2020 2020 2049 6620 4e6f 6e65 2c20 7661       If None, va
-00055060: 6c75 6520 6f66 2073 6b72 742e 636f 7265  lue of skrt.core
-00055070: 2e44 6566 6175 6c74 7328 292e 6279 5f73  .Defaults().by_s
-00055080: 6c69 6365 2069 7320 7573 6564 2e0a 2020  lice is used..  
-00055090: 2020 2222 220a 2020 2020 6d65 7468 6f64    """.    method
-000550a0: 203d 206d 6574 686f 6420 6f72 2073 6b72   = method or skr
-000550b0: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
-000550c0: 292e 6279 5f73 6c69 6365 0a20 2020 2069  ).by_slice.    i
-000550d0: 6620 6d65 7468 6f64 206e 6f74 2069 6e20  f method not in 
-000550e0: 6765 745f 6279 5f73 6c69 6365 5f6d 6574  get_by_slice_met
-000550f0: 686f 6473 2829 3a0a 2020 2020 2020 2020  hods():.        
-00055100: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-00055110: 6f72 2866 224d 6574 686f 6420 6d75 7374  or(f"Method must
-00055120: 2062 6520 6f6e 6520 6f66 207b 6765 745f   be one of {get_
-00055130: 6279 5f73 6c69 6365 5f6d 6574 686f 6473  by_slice_methods
-00055140: 2829 7d22 0a20 2020 2020 2020 2022 202d  ()}".        " -
-00055150: 206e 6f74 2027 7b6d 6574 686f 647d 2722   not '{method}'"
-00055160: 290a 0a20 2020 2069 6e64 6963 6573 203d  )..    indices =
-00055170: 204e 6f6e 650a 0a20 2020 2069 6e64 6963   None..    indic
-00055180: 6573 3120 3d20 726f 6931 2e67 6574 5f69  es1 = roi1.get_i
-00055190: 6e64 6963 6573 2876 6965 773d 7669 6577  ndices(view=view
-000551a0: 2c20 6d65 7468 6f64 3d22 6d61 736b 2229  , method="mask")
-000551b0: 0a20 2020 2069 6620 6e6f 7420 6973 7375  .    if not issu
-000551c0: 6263 6c61 7373 2874 7970 6528 726f 6932  bclass(type(roi2
-000551d0: 292c 2052 4f49 2920 6f72 2022 6c65 6674  ), ROI) or "left
-000551e0: 2220 3d3d 206d 6574 686f 643a 0a20 2020  " == method:.   
-000551f0: 2020 2020 2069 6e64 6963 6573 203d 2069       indices = i
-00055200: 6e64 6963 6573 310a 0a20 2020 2069 6620  ndices1..    if 
-00055210: 696e 6469 6365 7320 6973 204e 6f6e 653a  indices is None:
-00055220: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
-00055230: 3220 3d20 726f 6932 2e67 6574 5f69 6e64  2 = roi2.get_ind
-00055240: 6963 6573 2876 6965 773d 7669 6577 2c20  ices(view=view, 
-00055250: 6d65 7468 6f64 3d22 6d61 736b 2229 0a20  method="mask"). 
-00055260: 2020 2020 2020 2069 6620 2272 6967 6874         if "right
-00055270: 2220 3d3d 206d 6574 686f 643a 0a20 2020  " == method:.   
-00055280: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
-00055290: 203d 2069 6e64 6963 6573 320a 2020 2020   = indices2.    
-000552a0: 2020 2020 0a20 2020 2069 6620 696e 6469      .    if indi
-000552b0: 6365 7320 6973 204e 6f6e 653a 0a20 2020  ces is None:.   
-000552c0: 2020 2020 2069 6620 2275 6e69 6f6e 2220       if "union" 
-000552d0: 3d3d 206d 6574 686f 643a 0a20 2020 2020  == method:.     
-000552e0: 2020 2020 2020 2069 6e64 6963 6573 203d         indices =
-000552f0: 206c 6973 7428 7365 7428 696e 6469 6365   list(set(indice
-00055300: 7331 292e 756e 696f 6e28 7365 7428 696e  s1).union(set(in
-00055310: 6469 6365 7332 2929 290a 0a20 2020 2069  dices2)))..    i
-00055320: 6620 696e 6469 6365 7320 6973 204e 6f6e  f indices is Non
-00055330: 653a 0a20 2020 2020 2020 2069 6620 2269  e:.        if "i
-00055340: 6e74 6572 7365 6374 696f 6e22 203d 3d20  ntersection" == 
-00055350: 6d65 7468 6f64 3a0a 2020 2020 2020 2020  method:.        
-00055360: 2020 2020 696e 6469 6365 7320 3d20 6c69      indices = li
-00055370: 7374 2873 6574 2869 6e64 6963 6573 3129  st(set(indices1)
-00055380: 2e69 6e74 6572 7365 6374 696f 6e28 7365  .intersection(se
-00055390: 7428 696e 6469 6365 7332 2929 290a 0a20  t(indices2))).. 
-000553a0: 2020 2069 6620 696e 6469 6365 7320 6973     if indices is
-000553b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-000553c0: 2020 2069 6620 706f 7369 7469 6f6e 5f61     if position_a
-000553d0: 735f 6964 783a 0a20 2020 2020 2020 2020  s_idx:.         
-000553e0: 2020 2072 6574 7572 6e20 736f 7274 6564     return sorted
-000553f0: 2869 6e64 6963 6573 290a 2020 2020 2020  (indices).      
-00055400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00055410: 2020 2020 6178 203d 2073 6b72 742e 696d      ax = skrt.im
-00055420: 6167 652e 5f73 6c69 6365 5f61 7865 735b  age._slice_axes[
-00055430: 7669 6577 5d0a 2020 2020 2020 2020 2020  view].          
-00055440: 2020 7265 7475 726e 2073 6f72 7465 6428    return sorted(
-00055450: 5b72 6f69 312e 6964 785f 746f 5f70 6f73  [roi1.idx_to_pos
-00055460: 2869 6478 2c20 6178 2920 666f 7220 6964  (idx, ax) for id
-00055470: 7820 696e 2069 6e64 6963 6573 5d29 0a0a  x in indices])..
-00055480: 6465 6620 6578 7061 6e64 5f73 6c69 6365  def expand_slice
-00055490: 5f73 7461 7473 2873 6c69 6365 5f73 7461  _stats(slice_sta
-000554a0: 7473 3d4e 6f6e 652c 2064 6566 6175 6c74  ts=None, default
-000554b0: 5f62 795f 736c 6963 653d 4e6f 6e65 293a  _by_slice=None):
-000554c0: 0a20 2020 2022 2222 0a20 2020 2045 7870  .    """.    Exp
-000554d0: 616e 6420 7370 6563 6966 6963 6174 696f  and specificatio
-000554e0: 6e20 6f66 2073 7461 7469 7374 6963 7320  n of statistics 
-000554f0: 746f 2063 616c 6375 6c61 7465 2066 6f72  to calculate for
-00055500: 2052 4f49 2063 6f6d 7061 7269 736f 6e0a   ROI comparison.
-00055510: 2020 2020 6d65 7472 6963 7320 6576 616c      metrics eval
-00055520: 7561 7465 6420 736c 6963 6520 6279 2073  uated slice by s
-00055530: 6c69 6365 2e0a 0a20 2020 2041 2064 6963  lice...    A dic
-00055540: 7469 6f6e 6172 7920 6973 2072 6574 7572  tionary is retur
-00055550: 6e65 642c 2077 6865 7265 206b 6579 7320  ned, where keys 
-00055560: 6769 7665 2074 6865 2073 6c69 6365 7320  give the slices 
-00055570: 746f 2062 6520 636f 6e73 6964 6572 6564  to be considered
-00055580: 0a20 2020 2066 6f72 2063 616c 6375 6c61  .    for calcula
-00055590: 7469 6e67 2073 7461 7469 7374 6963 732c  ting statistics,
-000555a0: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
-000555b0: 6c69 7374 7320 6f66 206d 6574 7269 6373  lists of metrics
-000555c0: 2e0a 0a20 2020 202a 2a50 6172 616d 6574  ...    **Paramet
-000555d0: 6572 733a 2a2a 0a0a 2020 2020 736c 6963  ers:**..    slic
-000555e0: 655f 7374 6174 7320 3a20 7374 722f 6c69  e_stats : str/li
-000555f0: 7374 2f64 6963 742c 2064 6566 6175 6c74  st/dict, default
-00055600: 3d4e 6f6e 650a 2020 2020 2020 2020 5370  =None.        Sp
-00055610: 6563 6966 6963 6174 696f 6e20 6f66 2073  ecification of s
-00055620: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
-00055630: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
-00055640: 6976 650a 2020 2020 2020 2020 746f 2073  ive.        to s
-00055650: 6c69 6365 2d62 792d 736c 6963 6520 6d65  lice-by-slice me
-00055660: 7472 6963 2076 616c 7565 732e 0a0a 2020  tric values...  
-00055670: 2020 2020 2020 4120 7374 6174 6973 7469        A statisti
-00055680: 6320 6973 2073 7065 6369 6669 6564 2062  c is specified b
-00055690: 7920 7468 6520 6e61 6d65 206f 6620 7468  y the name of th
-000556a0: 6520 6675 6e63 7469 6f6e 2066 6f72 0a20  e function for. 
-000556b0: 2020 2020 2020 2069 7473 2063 616c 6375         its calcu
-000556c0: 6c61 7469 6f6e 2069 6e20 7468 6520 5079  lation in the Py
-000556d0: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
-000556e0: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
-000556f0: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
-00055700: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
-00055710: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
-00055720: 6d6c 0a0a 2020 2020 2020 2020 466f 7220  ml..        For 
-00055730: 6974 7320 7573 6520 6865 7265 2c20 7468  its use here, th
-00055740: 6520 7265 6c65 7661 6e74 2066 756e 6374  e relevant funct
-00055750: 696f 6e20 6d75 7374 2072 6571 7569 7265  ion must require
-00055760: 0a20 2020 2020 2020 2061 2073 696e 676c  .        a singl
-00055770: 652d 7661 7269 6162 6c65 2069 6e70 7574  e-variable input
-00055780: 2c20 6d75 7374 206e 6f74 2072 6571 7569  , must not requi
-00055790: 7265 2061 6e79 206b 6579 776f 7264 0a20  re any keyword. 
-000557a0: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
-000557b0: 2c20 616e 6420 6d75 7374 2072 6574 7572  , and must retur
-000557c0: 6e20 6120 7369 6e67 6c65 206e 756d 6265  n a single numbe
-000557d0: 722e 0a0a 2020 2020 2020 2020 4176 6169  r...        Avai
-000557e0: 6c61 626c 6520 6f70 7469 6f6e 7320 696e  lable options in
-000557f0: 636c 7564 653a 2022 6d65 616e 222c 2022  clude: "mean", "
-00055800: 6d65 6469 616e 222c 2022 6d6f 6465 222c  median", "mode",
-00055810: 0a20 2020 2020 2020 2022 7374 6465 7622  .        "stdev"
-00055820: 2e0a 0a20 2020 2020 2020 5374 6174 6973  ...       Statis
-00055830: 7469 6373 2074 6f20 6265 2063 616c 6375  tics to be calcu
-00055840: 6c61 7465 6420 6361 6e20 6265 2073 7065  lated can be spe
-00055850: 6369 6669 6564 2075 7369 6e67 2061 6e79  cified using any
-00055860: 206f 660a 2020 2020 2020 2074 6865 2066   of.       the f
-00055870: 6f6c 6c6f 7769 6e67 3a0a 0a20 2020 2020  ollowing:..     
-00055880: 2020 2d20 5374 7269 6e67 2073 7065 6369    - String speci
-00055890: 6679 696e 6720 7369 6e67 6c65 2073 7461  fying single sta
-000558a0: 7469 7374 6963 2074 6f20 6265 2063 616c  tistic to be cal
-000558b0: 6375 6c61 7465 642c 0a20 2020 2020 2020  culated,.       
-000558c0: 2020 7769 7468 2073 6c69 6365 7320 636f    with slices co
-000558d0: 6e73 6964 6572 6564 2061 7320 6769 7665  nsidered as give
-000558e0: 6e20 6279 203c 6465 6661 756c 745f 6279  n by <default_by
-000558f0: 5f73 6c69 6365 3e2c 0a20 2020 2020 2020  _slice>,.       
-00055900: 2020 666f 7220 6578 616d 706c 653a 2022    for example: "
-00055910: 6d65 616e 223b 0a20 2020 2020 2020 2d20  mean";.       - 
-00055920: 4c69 7374 2073 7065 6369 6679 696e 6720  List specifying 
-00055930: 6d75 6c74 6970 6c65 2073 7461 7469 7374  multiple statist
-00055940: 6963 7320 746f 2062 6520 6361 6c63 756c  ics to be calcul
-00055950: 6174 6564 2c0a 2020 2020 2020 2020 2077  ated,.         w
-00055960: 6974 6820 736c 6963 6573 2063 6f6e 7369  ith slices consi
-00055970: 6465 7265 6420 6173 2067 6976 656e 2062  dered as given b
-00055980: 7920 3c64 6566 6175 6c74 5f62 795f 736c  y <default_by_sl
-00055990: 6963 653e 2c0a 2020 2020 2020 2020 2066  ice>,.         f
-000559a0: 6f72 2065 7861 6d70 6c65 3a20 5b22 6d65  or example: ["me
-000559b0: 616e 222c 2022 7374 6465 7622 5d3b 0a20  an", "stdev"];. 
-000559c0: 2020 2020 2020 2d20 4469 6374 696f 6e61        - Dictiona
-000559d0: 7279 2077 6865 7265 206b 6579 7320 7370  ry where keys sp
-000559e0: 6563 6966 7920 736c 6963 6573 2074 6f20  ecify slices to 
-000559f0: 6265 2063 6f6e 7369 6465 7265 642c 0a20  be considered,. 
-00055a00: 2020 2020 2020 2020 616e 6420 7661 6c75          and valu
-00055a10: 6573 2073 7065 6369 6679 2073 7461 7469  es specify stati
-00055a20: 7374 6963 7320 2873 7472 696e 6720 6f72  stics (string or
-00055a30: 206c 6973 7429 2c20 666f 720a 2020 2020   list), for.    
-00055a40: 2020 2020 2065 7861 6d70 6c65 3a20 7b22       example: {"
-00055a50: 756e 696f 6e22 3a20 5b22 6d65 616e 222c  union": ["mean",
-00055a60: 2022 7374 6465 7622 5d7d 2e20 2056 616c   "stdev"]}.  Val
-00055a70: 6964 2073 6c69 6365 0a20 2020 2020 2020  id slice.       
-00055a80: 2020 7370 6563 6966 6963 6174 696f 6e73    specifications
-00055a90: 2061 7265 2061 7320 6c69 7374 6564 2066   are as listed f
-00055aa0: 6f72 203c 6465 6661 756c 745f 6279 5f73  or <default_by_s
-00055ab0: 6c69 6365 3e2e 0a0a 2020 2020 6465 6661  lice>...    defa
-00055ac0: 756c 745f 6279 5f73 6c69 6365 3a20 7374  ult_by_slice: st
-00055ad0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-00055ae0: 2020 2020 2020 2020 4465 6661 756c 7420          Default 
-00055af0: 7370 6563 6966 6963 6174 696f 6e20 6f66  specification of
-00055b00: 2073 6c69 6365 7320 746f 2062 6520 636f   slices to be co
-00055b10: 6e73 6964 6572 6564 2077 6865 6e0a 2020  nsidered when.  
-00055b20: 2020 2020 2020 6361 6c63 756c 6174 696e        calculatin
-00055b30: 6720 736c 6963 652d 6279 2d73 6c69 6365  g slice-by-slice
-00055b40: 2073 7461 7469 7374 6963 7320 666f 7220   statistics for 
-00055b50: 6120 6d65 7472 6963 2063 6f6d 7061 7269  a metric compari
-00055b60: 6e67 0a20 2020 2020 2020 2074 776f 2052  ng.        two R
-00055b70: 4f49 732c 2072 6f69 3120 616e 6420 726f  OIs, roi1 and ro
-00055b80: 6932 2e20 2054 6865 2076 616c 6964 2073  i2.  The valid s
-00055b90: 7065 6369 6669 6361 7469 6f6e 7320 6172  pecifications ar
-00055ba0: 653a 0a0a 2020 2020 2020 2020 2d20 226c  e:..        - "l
-00055bb0: 6566 7422 3a20 636f 6e73 6964 6572 206f  eft": consider o
-00055bc0: 6e6c 7920 736c 6963 6573 2063 6f6e 7461  nly slices conta
-00055bd0: 696e 696e 6720 726f 6931 3b0a 2020 2020  ining roi1;.    
-00055be0: 2020 2020 2d20 2272 6967 6874 223a 2063      - "right": c
-00055bf0: 6f6e 7369 6465 7220 6f6e 6c79 2073 6c69  onsider only sli
-00055c00: 6365 7320 636f 6e74 6169 6e69 6e67 2072  ces containing r
-00055c10: 6f69 323b 0a20 2020 2020 2020 202d 2022  oi2;.        - "
-00055c20: 756e 696f 6e22 3a20 636f 6e73 6964 6572  union": consider
-00055c30: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-00055c40: 6e67 2065 6974 6865 7220 6f66 2072 6f69  ng either of roi
-00055c50: 3120 616e 6420 726f 6932 3b0a 2020 2020  1 and roi2;.    
-00055c60: 2020 2020 2d20 2269 6e74 6572 7365 6374      - "intersect
-00055c70: 696f 6e22 3a20 636f 6e73 6964 6572 2073  ion": consider s
-00055c80: 6c69 6365 7320 636f 6e74 6169 6e69 6e67  lices containing
-00055c90: 2062 6f74 6820 726f 6931 2061 6e64 2072   both roi1 and r
-00055ca0: 6f69 322e 0a0a 2020 2020 2020 2020 4966  oi2...        If
-00055cb0: 204e 6f6e 652c 2075 7365 2073 6b72 742e   None, use skrt.
-00055cc0: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
-00055cd0: 6279 5f73 6c69 6365 0a20 2020 2022 2222  by_slice.    """
-00055ce0: 0a20 2020 2069 6620 6e6f 7420 736c 6963  .    if not slic
-00055cf0: 655f 7374 6174 733a 0a20 2020 2020 2020  e_stats:.       
-00055d00: 2072 6574 7572 6e20 7b7d 0a0a 2020 2020   return {}..    
-00055d10: 2320 5365 7420 6465 6661 756c 7420 6d65  # Set default me
-00055d20: 7468 6f64 2066 6f72 2073 6c69 6365 2073  thod for slice s
-00055d30: 656c 6563 7469 6f6e 2e0a 2020 2020 6465  election..    de
-00055d40: 6661 756c 745f 6279 5f73 6c69 6365 203d  fault_by_slice =
-00055d50: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
-00055d60: 6520 6f72 2073 6b72 742e 636f 7265 2e44  e or skrt.core.D
-00055d70: 6566 6175 6c74 7328 292e 6279 5f73 6c69  efaults().by_sli
-00055d80: 6365 0a0a 2020 2020 2320 456e 7375 7265  ce..    # Ensure
-00055d90: 2074 6861 7420 736c 6963 655f 7374 6174   that slice_stat
-00055da0: 7320 6973 2061 2064 6963 7469 6f6e 6172  s is a dictionar
-00055db0: 792e 0a20 2020 2069 6620 6973 696e 7374  y..    if isinst
-00055dc0: 616e 6365 2873 6c69 6365 5f73 7461 7473  ance(slice_stats
-00055dd0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-00055de0: 736c 6963 655f 7374 6174 7320 3d20 7b64  slice_stats = {d
-00055df0: 6566 6175 6c74 5f62 795f 736c 6963 653a  efault_by_slice:
-00055e00: 205b 736c 6963 655f 7374 6174 735d 7d0a   [slice_stats]}.
-00055e10: 0a20 2020 2065 6c69 6620 736b 7274 2e63  .    elif skrt.c
-00055e20: 6f72 652e 6973 5f6c 6973 7428 736c 6963  ore.is_list(slic
-00055e30: 655f 7374 6174 7329 3a0a 2020 2020 2020  e_stats):.      
-00055e40: 2020 736c 6963 655f 7374 6174 7320 3d20    slice_stats = 
-00055e50: 7b64 6566 6175 6c74 5f62 795f 736c 6963  {default_by_slic
-00055e60: 653a 2073 6c69 6365 5f73 7461 7473 7d0a  e: slice_stats}.
-00055e70: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
-00055e80: 616e 6365 2873 6c69 6365 5f73 7461 7473  ance(slice_stats
-00055e90: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
-00055ea0: 2063 6865 636b 6564 5f73 6c69 6365 5f73   checked_slice_s
-00055eb0: 7461 7473 203d 207b 7d0a 2020 2020 2020  tats = {}.      
-00055ec0: 2020 666f 7220 6279 5f73 6c69 6365 2c20    for by_slice, 
-00055ed0: 7374 6174 7320 696e 2073 6c69 6365 5f73  stats in slice_s
-00055ee0: 7461 7473 2e69 7465 6d73 2829 3a0a 2020  tats.items():.  
-00055ef0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00055f00: 6e73 7461 6e63 6528 7374 6174 732c 2073  nstance(stats, s
-00055f10: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-00055f20: 2020 2020 2063 6865 636b 6564 5f73 6c69       checked_sli
-00055f30: 6365 5f73 7461 7473 5b62 795f 736c 6963  ce_stats[by_slic
-00055f40: 655d 203d 205b 7374 6174 735d 0a20 2020  e] = [stats].   
-00055f50: 2020 2020 2020 2020 2065 6c69 6620 736b           elif sk
-00055f60: 7274 2e63 6f72 652e 6973 5f6c 6973 7428  rt.core.is_list(
-00055f70: 7374 6174 7329 3a0a 2020 2020 2020 2020  stats):.        
-00055f80: 2020 2020 2020 2020 6368 6563 6b65 645f          checked_
-00055f90: 736c 6963 655f 7374 6174 735b 6279 5f73  slice_stats[by_s
-00055fa0: 6c69 6365 5d20 3d20 6c69 7374 2873 7461  lice] = list(sta
-00055fb0: 7473 290a 2020 2020 2020 2020 736c 6963  ts).        slic
-00055fc0: 655f 7374 6174 7320 3d20 6368 6563 6b65  e_stats = checke
-00055fd0: 645f 736c 6963 655f 7374 6174 730a 0a20  d_slice_stats.. 
-00055fe0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00055ff0: 2873 6c69 6365 5f73 7461 7473 2c20 6469  (slice_stats, di
-00056000: 6374 293a 0a20 2020 2020 2020 2072 6574  ct):.        ret
-00056010: 7572 6e20 736c 6963 655f 7374 6174 730a  urn slice_stats.
-00056020: 0a20 2020 2072 6574 7572 6e20 7b7d 0a    .    return {}.
+0003ad60: 2020 2020 2020 2020 2066 226f 7220 6e75           f"or nu
+0003ad70: 6d70 7920 6172 7261 792e 2054 7970 6520  mpy array. Type 
+0003ad80: 666f 756e 643a 207b 7479 7065 2873 6f75  found: {type(sou
+0003ad90: 7263 6573 297d 2e22 290a 2020 2020 2020  rces)}.").      
+0003ada0: 2020 2020 2020 7369 6e67 6c65 5f73 6f75        single_sou
+0003adb0: 7263 6520 3d20 5472 7565 0a0a 2020 2020  rce = True..    
+0003adc0: 2020 2020 2020 2020 2320 4c6f 6164 2069          # Load i
+0003add0: 6e70 7574 2061 7272 6179 2069 6e74 6f20  nput array into 
+0003ade0: 696d 6167 650a 2020 2020 2020 2020 2020  image.          
+0003adf0: 2020 6172 7261 7920 3d20 736b 7274 2e69    array = skrt.i
+0003ae00: 6d61 6765 2e49 6d61 6765 2873 6f75 7263  mage.Image(sourc
+0003ae10: 6573 292e 6765 745f 6461 7461 2873 7461  es).get_data(sta
+0003ae20: 6e64 6172 6469 7365 3d54 7275 6529 2e61  ndardise=True).a
+0003ae30: 7374 7970 6528 696e 7429 0a20 2020 2020  stype(int).     
+0003ae40: 2020 2020 2020 206e 203d 2061 7272 6179         n = array
+0003ae50: 2e6d 6178 2829 0a0a 2020 2020 2020 2020  .max()..        
+0003ae60: 2020 2020 2320 456e 666f 7263 6520 4469      # Enforce Di
+0003ae70: 636f 6d20 636f 6e76 656e 7469 6f6e 2066  com convention f
+0003ae80: 6f72 2064 6174 6120 6172 7261 7920 6f66  or data array of
+0003ae90: 2069 6d61 6765 206f 626a 6563 742c 0a20   image object,. 
+0003aea0: 2020 2020 2020 2020 2020 2023 2073 6f20             # so 
+0003aeb0: 7468 6174 2061 6666 696e 6520 6d61 7472  that affine matr
+0003aec0: 6978 2077 696c 6c20 6265 2063 6f72 7265  ix will be corre
+0003aed0: 6374 6c79 2064 6566 696e 6564 2066 6f72  ctly defined for
+0003aee0: 206d 6173 6b20 6372 6561 7469 6f6e 2e0a   mask creation..
+0003aef0: 2020 2020 2020 2020 2020 2020 696d 203d              im =
+0003af00: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+0003af10: 6528 736f 7572 6365 7329 0a20 2020 2020  e(sources).     
+0003af20: 2020 2020 2020 2069 6620 276e 6966 7469         if 'nifti
+0003af30: 2720 696e 2069 6d2e 736f 7572 6365 5f74  ' in im.source_t
+0003af40: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
+0003af50: 2020 2020 2069 6d20 3d20 696d 2e61 7374       im = im.ast
+0003af60: 7970 6528 2764 636d 2729 0a20 2020 2020  ype('dcm').     
+0003af70: 2020 2020 2020 2069 5f6e 616d 6520 3d20         i_name = 
+0003af80: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
+0003af90: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+0003afa0: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
+0003afb0: 2020 2020 6966 2073 656c 662e 6e61 6d65      if self.name
+0003afc0: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
+0003afd0: 6420 695f 6e61 6d65 203c 206c 656e 2873  d i_name < len(s
+0003afe0: 656c 662e 6e61 6d65 7329 3a0a 2020 2020  elf.names):.    
+0003aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b000: 6e61 6d65 203d 2073 656c 662e 6e61 6d65  name = self.name
+0003b010: 735b 695f 6e61 6d65 5d0a 2020 2020 2020  s[i_name].      
+0003b020: 2020 2020 2020 2020 2020 2020 2020 695f                i_
+0003b030: 6e61 6d65 202b 3d20 310a 2020 2020 2020  name += 1.      
+0003b040: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0003b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b060: 2020 2020 6e61 6d65 203d 2066 2252 4f49      name = f"ROI
+0003b070: 207b 697d 220a 0a20 2020 2020 2020 2020   {i}"..         
+0003b080: 2020 2020 2020 2023 696d 322e 6461 7461         #im2.data
+0003b090: 203d 2028 696d 312e 6461 7461 203d 3d20   = (im1.data == 
+0003b0a0: 6920 2b20 3129 0a20 2020 2020 2020 2020  i + 1).         
+0003b0b0: 2020 2020 2020 2073 656c 662e 726f 6973         self.rois
+0003b0c0: 2e61 7070 656e 6428 524f 4928 0a20 2020  .append(ROI(.   
+0003b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b0e0: 2061 7272 6179 203d 3d20 6920 2b20 312c   array == i + 1,
+0003b0f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0003b100: 2020 2020 2020 6166 6669 6e65 203d 2069        affine = i
+0003b110: 6d2e 6765 745f 6166 6669 6e65 2829 2c0a  m.get_affine(),.
+0003b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b130: 2020 2020 766f 7865 6c5f 7369 7a65 203d      voxel_size =
+0003b140: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0003b150: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+0003b160: 6e20 3d20 4e6f 6e65 2c0a 2020 2020 2020  n = None,.      
+0003b170: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0003b180: 6167 653d 7365 6c66 2e69 6d61 6765 2c0a  age=self.image,.
+0003b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b1a0: 2020 2020 6e61 6d65 3d6e 616d 652c 0a20      name=name,. 
+0003b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b1c0: 2020 202a 2a73 656c 662e 726f 695f 6b77     **self.roi_kw
+0003b1d0: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
+0003b1e0: 2020 2020 2029 290a 2020 2020 2020 2020       )).        
+0003b1f0: 2020 2020 736f 7572 6365 7320 3d20 5b5d      sources = []
+0003b200: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0003b210: 466f 7220 4e49 6654 4920 736f 7572 6365  For NIfTI source
+0003b220: 2c20 7265 7665 7274 2074 6f20 4e49 6654  , revert to NIfT
+0003b230: 4920 636f 6e76 656e 7469 6f6e 2066 6f72  I convention for
+0003b240: 2064 6174 6120 6172 7261 790a 2020 2020   data array.    
+0003b250: 2020 2020 2020 2020 2320 6f66 206d 6173          # of mas
+0003b260: 6b2c 2073 6f20 7468 6174 2069 7420 6361  k, so that it ca
+0003b270: 6e20 6265 2077 7269 7474 656e 2063 6f72  n be written cor
+0003b280: 7265 6374 6c79 2074 6f20 6669 6c65 2e0a  rectly to file..
+0003b290: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0003b2a0: 6e69 6674 6927 2069 6e20 696d 2e73 6f75  nifti' in im.sou
+0003b2b0: 7263 655f 7479 7065 3a0a 2020 2020 2020  rce_type:.      
+0003b2c0: 2020 2020 2020 2020 2020 666f 7220 6964            for id
+0003b2d0: 7820 696e 2072 616e 6765 286c 656e 2873  x in range(len(s
+0003b2e0: 656c 662e 726f 6973 2929 3a0a 2020 2020  elf.rois)):.    
+0003b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b300: 7365 6c66 2e72 6f69 735b 6964 785d 2e6d  self.rois[idx].m
+0003b310: 6173 6b20 3d20 7365 6c66 2e72 6f69 735b  ask = self.rois[
+0003b320: 6964 785d 2e6d 6173 6b2e 6173 7479 7065  idx].mask.astype
+0003b330: 2827 6e69 6927 290a 0a20 2020 2020 2020  ('nii')..       
+0003b340: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003b350: 2020 2069 6620 6e6f 7420 736b 7274 2e63     if not skrt.c
+0003b360: 6f72 652e 6973 5f6c 6973 7428 736f 7572  ore.is_list(sour
+0003b370: 6365 7329 206f 7220 6973 696e 7374 616e  ces) or isinstan
+0003b380: 6365 2873 6f75 7263 6573 2c20 6e70 2e6e  ce(sources, np.n
+0003b390: 6461 7272 6179 293a 0a20 2020 2020 2020  darray):.       
+0003b3a0: 2020 2020 2020 2020 2073 6f75 7263 6573           sources
+0003b3b0: 203d 205b 736f 7572 6365 735d 0a20 2020   = [sources].   
+0003b3c0: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+0003b3d0: 676c 655f 736f 7572 6365 203d 2054 7275  gle_source = Tru
+0003b3e0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+0003b3f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0003b400: 2020 2020 7369 6e67 6c65 5f73 6f75 7263      single_sourc
+0003b410: 6520 3d20 4661 6c73 650a 0a20 2020 2020  e = False..     
+0003b420: 2020 2023 2045 7870 616e 6420 616e 7920     # Expand any 
+0003b430: 6469 7265 6374 6f72 6965 730a 2020 2020  directories.    
+0003b440: 2020 2020 736f 7572 6365 735f 6578 7061      sources_expa
+0003b450: 6e64 6564 203d 205b 5d0a 2020 2020 2020  nded = [].      
+0003b460: 2020 666f 7220 736f 7572 6365 2069 6e20    for source in 
+0003b470: 736f 7572 6365 733a 0a20 2020 2020 2020  sources:.       
+0003b480: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0003b490: 6365 2873 6f75 7263 652c 2073 7472 2920  ce(source, str) 
+0003b4a0: 616e 6420 6f73 2e70 6174 682e 6973 6469  and os.path.isdi
+0003b4b0: 7228 736f 7572 6365 293a 0a0a 2020 2020  r(source):..    
+0003b4c0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0003b4d0: 6365 735f 6578 7061 6e64 6564 2e65 7874  ces_expanded.ext
+0003b4e0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0003b4f0: 2020 2020 2020 2020 205b 6f73 2e70 6174           [os.pat
+0003b500: 682e 6a6f 696e 2873 6f75 7263 652c 2066  h.join(source, f
+0003b510: 696c 6529 2066 6f72 2066 696c 6520 696e  ile) for file in
+0003b520: 206f 732e 6c69 7374 6469 7228 736f 7572   os.listdir(sour
+0003b530: 6365 295d 0a20 2020 2020 2020 2020 2020  ce)].           
+0003b540: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0003b550: 2020 2020 2020 2020 2320 4175 746f 2d61          # Auto-a
+0003b560: 7373 6967 6e20 6e61 6d65 2074 6f20 6469  ssign name to di
+0003b570: 7265 6374 6f72 7920 6e61 6d65 0a20 2020  rectory name.   
+0003b580: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003b590: 7369 6e67 6c65 5f73 6f75 7263 6520 616e  single_source an
+0003b5a0: 6420 7365 6c66 2e6e 616d 6520 6973 204e  d self.name is N
+0003b5b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0003b5c0: 2020 2020 2020 2020 2073 656c 662e 6e61           self.na
+0003b5d0: 6d65 203d 2073 6f75 7263 650a 0a20 2020  me = source..   
+0003b5e0: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
+0003b5f0: 7420 7365 6c66 2e6c 6f61 6465 643a 0a20  t self.loaded:. 
+0003b600: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003b610: 6f75 7263 6573 5f65 7870 616e 6465 642e  ources_expanded.
+0003b620: 6170 7065 6e64 2873 6f75 7263 6529 0a0a  append(source)..
+0003b630: 2020 2020 2020 2020 666f 7220 736f 7572          for sour
+0003b640: 6365 2069 6e20 736f 7274 6564 2873 6f75  ce in sorted(sou
+0003b650: 7263 6573 5f65 7870 616e 6465 6429 3a0a  rces_expanded):.
+0003b660: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003b670: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
+0003b680: 652c 2052 4f49 293a 0a20 2020 2020 2020  e, ROI):.       
+0003b690: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
+0003b6a0: 6973 2e61 7070 656e 6428 736f 7572 6365  is.append(source
+0003b6b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003b6c0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
+0003b6d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003b6e0: 7461 6e63 6528 736f 7572 6365 2c20 7374  tance(source, st
+0003b6f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0003b700: 2020 2020 6966 206f 732e 7061 7468 2e62      if os.path.b
+0003b710: 6173 656e 616d 6528 736f 7572 6365 292e  asename(source).
+0003b720: 7374 6172 7473 7769 7468 2822 2e22 2920  startswith(".") 
+0003b730: 6f72 2073 6f75 7263 652e 656e 6473 7769  or source.endswi
+0003b740: 7468 2822 2e74 7874 2229 3a0a 2020 2020  th(".txt"):.    
+0003b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b760: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0003b770: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+0003b780: 6174 682e 6973 6469 7228 736f 7572 6365  ath.isdir(source
+0003b790: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0003b7a0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0003b7b0: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+0003b7c0: 7474 656d 7074 2074 6f20 6c6f 6164 2066  ttempt to load f
+0003b7d0: 726f 6d20 6469 636f 6d0a 2020 2020 2020  rom dicom.      
+0003b7e0: 2020 2020 2020 726f 6973 203d 205b 5d0a        rois = [].
+0003b7f0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0003b800: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
+0003b810: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+0003b820: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+0003b830: 7468 2e73 706c 6974 6578 7428 736f 7572  th.splitext(sour
+0003b840: 6365 295b 315d 2021 3d20 272e 6e69 6927  ce)[1] != '.nii'
+0003b850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003b860: 2020 2020 2020 726f 6973 2c20 6473 203d        rois, ds =
+0003b870: 206c 6f61 645f 726f 6973 5f64 6963 6f6d   load_rois_dicom
+0003b880: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
+0003b890: 2020 2020 2069 6620 6c65 6e28 726f 6973       if len(rois
+0003b8a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0003b8b0: 2020 2066 6f72 206e 756d 6265 722c 2072     for number, r
+0003b8c0: 6f69 2069 6e20 726f 6973 2e69 7465 6d73  oi in rois.items
+0003b8d0: 2829 3a0a 0a20 2020 2020 2020 2020 2020  ():..           
+0003b8e0: 2020 2020 2020 2020 2023 2049 676e 6f72           # Ignor
+0003b8f0: 6520 656e 7472 6965 7320 7769 7468 206e  e entries with n
+0003b900: 6f20 636f 6e74 6f75 7273 0a20 2020 2020  o contours.     
+0003b910: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003b920: 6620 2263 6f6e 746f 7572 7322 206e 6f74  f "contours" not
+0003b930: 2069 6e20 726f 693a 0a20 2020 2020 2020   in roi:.       
+0003b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b950: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+0003b960: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003b970: 2049 676e 6f72 6520 656e 7472 6965 7320   Ignore entries 
+0003b980: 636f 6e74 6169 6e69 6e67 206f 6e6c 7920  containing only 
+0003b990: 6120 7369 6e67 6c65 2070 6f69 6e74 0a20  a single point. 
+0003b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b9b0: 2020 2063 6f6e 746f 7572 7320 3d20 726f     contours = ro
+0003b9c0: 695b 2263 6f6e 746f 7572 7322 5d0a 2020  i["contours"].  
+0003b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b9e0: 2020 6966 206c 656e 2863 6f6e 746f 7572    if len(contour
+0003b9f0: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
+0003ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ba10: 2073 696e 676c 655f 636f 6e74 6f75 7220   single_contour 
+0003ba20: 3d20 636f 6e74 6f75 7273 5b6c 6973 7428  = contours[list(
+0003ba30: 636f 6e74 6f75 7273 2e6b 6579 7328 2929  contours.keys())
+0003ba40: 5b30 5d5d 5b30 5d0a 2020 2020 2020 2020  [0]][0].        
+0003ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ba60: 6966 2073 696e 676c 655f 636f 6e74 6f75  if single_contou
+0003ba70: 722e 7368 6170 655b 305d 203d 3d20 313a  r.shape[0] == 1:
+0003ba80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ba90: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0003baa0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+0003bab0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+0003bac0: 203d 2072 6f69 5b22 636f 6c6f 7222 5d20   = roi["color"] 
+0003bad0: 6966 206e 6f74 2073 656c 662e 6967 6e6f  if not self.igno
+0003bae0: 7265 5f64 6963 6f6d 5f63 6f6c 6f72 7320  re_dicom_colors 
+0003baf0: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
+0003bb00: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0003bb10: 6c66 2e72 6f69 732e 6170 7065 6e64 280a  lf.rois.append(.
+0003bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bb30: 2020 2020 2020 2020 524f 4928 0a20 2020          ROI(.   
+0003bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bb50: 2020 2020 2020 2020 2072 6f69 5b22 636f           roi["co
+0003bb60: 6e74 6f75 7273 225d 2c0a 2020 2020 2020  ntours"],.      
+0003bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bb80: 2020 2020 2020 6e61 6d65 3d72 6f69 5b22        name=roi["
+0003bb90: 6e61 6d65 225d 2c0a 2020 2020 2020 2020  name"],.        
+0003bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bbb0: 2020 2020 636f 6c6f 723d 636f 6c6f 722c      color=color,
+0003bbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003bbd0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+0003bbe0: 6765 3d73 656c 662e 696d 6167 652c 0a20  ge=self.image,. 
+0003bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bc00: 2020 2020 2020 2020 2020 202a 2a73 656c             **sel
+0003bc10: 662e 726f 695f 6b77 6172 6773 0a20 2020  f.roi_kwargs.   
+0003bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bc30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0003bc40: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0003bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bc60: 2073 656c 662e 726f 6973 5b2d 315d 2e64   self.rois[-1].d
+0003bc70: 6963 6f6d 5f64 6174 6173 6574 203d 2064  icom_dataset = d
+0003bc80: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0003bc90: 2020 2020 2020 7365 6c66 2e72 6f69 735b        self.rois[
+0003bca0: 2d31 5d2e 6e75 6d62 6572 203d 206e 756d  -1].number = num
+0003bcb0: 6265 720a 2020 2020 2020 2020 2020 2020  ber.            
+0003bcc0: 2020 2020 7365 6c66 2e64 6963 6f6d 5f64      self.dicom_d
+0003bcd0: 6174 6173 6574 203d 2064 730a 0a20 2020  ataset = ds..   
+0003bce0: 2020 2020 2020 2020 2020 2020 2023 2041               # A
+0003bcf0: 7574 6f2d 6173 7369 676e 206e 616d 6520  uto-assign name 
+0003bd00: 6672 6f6d 2064 6963 6f6d 2066 696c 656e  from dicom filen
+0003bd10: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0003bd20: 2020 2020 6966 2073 696e 676c 655f 736f      if single_so
+0003bd30: 7572 6365 2061 6e64 2073 656c 662e 6e61  urce and self.na
+0003bd40: 6d65 2069 7320 4e6f 6e65 3a0a 2020 2020  me is None:.    
+0003bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bd60: 7365 6c66 2e6e 616d 6520 3d20 6f73 2e70  self.name = os.p
+0003bd70: 6174 682e 6261 7365 6e61 6d65 2873 6f75  ath.basename(sou
+0003bd80: 7263 6529 2e72 6570 6c61 6365 2822 2e64  rce).replace(".d
+0003bd90: 636d 222c 2022 2229 0a0a 2020 2020 2020  cm", "")..      
+0003bda0: 2020 2020 2020 2320 4c6f 6164 2066 726f        # Load fro
+0003bdb0: 6d20 524f 4920 6d61 736b 0a20 2020 2020  m ROI mask.     
+0003bdc0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003bdd0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0003bde0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003bdf0: 2020 2020 2020 7365 6c66 2e72 6f69 732e        self.rois.
+0003be00: 6170 7065 6e64 2852 4f49 280a 2020 2020  append(ROI(.    
+0003be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003be20: 2020 2020 736f 7572 6365 2c20 0a20 2020      source, .   
+0003be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003be40: 2020 2020 2069 6d61 6765 3d73 656c 662e       image=self.
+0003be50: 696d 6167 652c 0a20 2020 2020 2020 2020  image,.         
+0003be60: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0003be70: 2a73 656c 662e 726f 695f 6b77 6172 6773  *self.roi_kwargs
+0003be80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003be90: 2020 2020 2029 290a 2020 2020 2020 2020       )).        
+0003bea0: 2020 2020 2020 2020 6578 6365 7074 2052          except R
+0003beb0: 756e 7469 6d65 4572 726f 723a 0a20 2020  untimeError:.   
+0003bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bed0: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+0003bee0: 2020 2073 656c 662e 6c6f 6164 6564 203d     self.loaded =
+0003bef0: 2054 7275 650a 0a20 2020 2020 2020 2073   True..        s
+0003bf00: 656c 662e 7265 6e61 6d65 5f72 6f69 7328  elf.rename_rois(
+0003bf10: 6b65 6570 5f72 656e 616d 6564 5f6f 6e6c  keep_renamed_onl
+0003bf20: 793d 7365 6c66 2e6b 6565 705f 7265 6e61  y=self.keep_rena
+0003bf30: 6d65 645f 6f6e 6c79 290a 2020 2020 2020  med_only).      
+0003bf40: 2020 7365 6c66 2e66 696c 7465 725f 726f    self.filter_ro
+0003bf50: 6973 2829 0a20 2020 2020 2020 2073 656c  is().        sel
+0003bf60: 662e 7265 636f 6c6f 725f 726f 6973 2873  f.recolor_rois(s
+0003bf70: 656c 662e 636f 6c6f 7273 290a 2020 2020  elf.colors).    
+0003bf80: 2020 2020 736c 6963 655f 7468 6963 6b6e      slice_thickn
+0003bf90: 6573 7365 7320 3d20 5b5d 0a20 2020 2020  esses = [].     
+0003bfa0: 2020 2072 6f69 7320 3d20 5b5d 0a20 2020     rois = [].   
+0003bfb0: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
+0003bfc0: 7365 6c66 2e72 6f69 733a 0a20 2020 2020  self.rois:.     
+0003bfd0: 2020 2020 2020 2072 6f69 2e73 7472 7563         roi.struc
+0003bfe0: 7475 7265 5f73 6574 203d 2073 656c 660a  ture_set = self.
+0003bff0: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
+0003c000: 7365 745f 616c 7068 615f 6f76 6572 5f62  set_alpha_over_b
+0003c010: 6574 6128 7365 6c66 2e61 6c70 6861 5f62  eta(self.alpha_b
+0003c020: 6574 615f 7261 7469 6f73 2e67 6574 2872  eta_ratios.get(r
+0003c030: 6f69 2e6e 616d 652c 204e 6f6e 6529 290a  oi.name, None)).
+0003c040: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003c050: 706c 616e 2069 6e20 7365 6c66 2e70 6c61  plan in self.pla
+0003c060: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0003c070: 2020 2020 726f 692e 6164 645f 706c 616e      roi.add_plan
+0003c080: 2870 6c61 6e29 0a0a 2020 2020 2020 2020  (plan)..        
+0003c090: 2020 2020 6966 2072 6f69 2e73 6f75 7263      if roi.sourc
+0003c0a0: 655f 7479 7065 203d 3d20 2263 6f6e 746f  e_type == "conto
+0003c0b0: 7572 223a 0a20 2020 2020 2020 2020 2020  ur":.           
+0003c0c0: 2020 2020 2069 6620 726f 692e 736c 6963       if roi.slic
+0003c0d0: 655f 7468 6963 6b6e 6573 735f 636f 6e74  e_thickness_cont
+0003c0e0: 6f75 7273 2069 7320 6e6f 7420 4e6f 6e65  ours is not None
+0003c0f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003c100: 2020 2020 2020 736c 6963 655f 7468 6963        slice_thic
+0003c110: 6b6e 6573 7365 732e 6170 7065 6e64 2872  knesses.append(r
+0003c120: 6f69 2e73 6c69 6365 5f74 6869 636b 6e65  oi.slice_thickne
+0003c130: 7373 5f63 6f6e 746f 7572 7329 0a20 2020  ss_contours).   
+0003c140: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0003c150: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003c160: 2020 2020 2020 2072 6f69 732e 6170 7065         rois.appe
+0003c170: 6e64 2872 6f69 290a 0a20 2020 2020 2020  nd(roi)..       
+0003c180: 2023 2049 6620 736c 6963 6520 7468 6963   # If slice thic
+0003c190: 6b6e 6573 7320 6973 6e27 7420 7365 7420  kness isn't set 
+0003c1a0: 666f 7220 616e 2052 4f49 2066 726f 6d20  for an ROI from 
+0003c1b0: 636f 6e74 6f75 7273 2c0a 2020 2020 2020  contours,.      
+0003c1c0: 2020 2320 7365 7420 6974 7320 7468 6963    # set its thic
+0003c1d0: 6b6e 6573 7320 746f 2074 6865 206d 696e  kness to the min
+0003c1e0: 696d 756d 2066 6f72 2061 6c6c 206f 7468  imum for all oth
+0003c1f0: 6572 2052 4f49 730a 2020 2020 2020 2020  er ROIs.        
+0003c200: 2320 696e 2074 6865 2073 7472 7563 7475  # in the structu
+0003c210: 7265 2073 6574 2e0a 2020 2020 2020 2020  re set..        
+0003c220: 6966 2072 6f69 7320 616e 6420 736c 6963  if rois and slic
+0003c230: 655f 7468 6963 6b6e 6573 7365 733a 0a20  e_thicknesses:. 
+0003c240: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+0003c250: 5f74 6869 636b 6e65 7373 203d 206d 696e  _thickness = min
+0003c260: 2873 6c69 6365 5f74 6869 636b 6e65 7373  (slice_thickness
+0003c270: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0003c280: 666f 7220 726f 6920 696e 2072 6f69 733a  for roi in rois:
+0003c290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c2a0: 2072 6f69 2e73 6c69 6365 5f74 6869 636b   roi.slice_thick
+0003c2b0: 6e65 7373 5f63 6f6e 746f 7572 7320 3d20  ness_contours = 
+0003c2c0: 736c 6963 655f 7468 6963 6b6e 6573 730a  slice_thickness.
+0003c2d0: 0a20 2020 2064 6566 2067 6574 5f64 6963  .    def get_dic
+0003c2e0: 6f6d 5f64 6174 6173 6574 2873 656c 6629  om_dataset(self)
+0003c2f0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0003c300: 7572 6e20 7079 6469 636f 6d2e 6461 7461  urn pydicom.data
+0003c310: 7365 742e 4669 6c65 4461 7461 7365 7420  set.FileDataset 
+0003c320: 6f62 6a65 6374 2061 7373 6f63 6961 7465  object associate
+0003c330: 6420 7769 7468 2074 6869 7320 496d 6167  d with this Imag
+0003c340: 652c 0a20 2020 2020 2020 2069 6620 6c6f  e,.        if lo
+0003c350: 6164 6564 2066 726f 6d20 6469 636f 6d3b  aded from dicom;
+0003c360: 206f 7468 6572 7769 7365 2c20 7265 7475   otherwise, retu
+0003c370: 726e 204e 6f6e 652e 2222 220a 0a20 2020  rn None."""..   
+0003c380: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
+0003c390: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003c3a0: 7365 6c66 2e64 6963 6f6d 5f64 6174 6173  self.dicom_datas
+0003c3b0: 6574 0a0a 2020 2020 6465 6620 7265 7365  et..    def rese
+0003c3c0: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+0003c3d0: 2022 2222 5265 6c6f 6164 2073 7472 7563   """Reload struc
+0003c3e0: 7475 7265 2073 6574 2066 726f 6d20 6f72  ture set from or
+0003c3f0: 6967 696e 616c 2073 6f75 7263 6528 7329  iginal source(s)
+0003c400: 2e22 2222 0a0a 2020 2020 2020 2020 7365  ."""..        se
+0003c410: 6c66 2e72 6f69 7320 3d20 5b5d 0a20 2020  lf.rois = [].   
+0003c420: 2020 2020 2073 656c 662e 6c6f 6164 6564       self.loaded
+0003c430: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0003c440: 2073 656c 662e 6c6f 6164 2866 6f72 6365   self.load(force
+0003c450: 3d54 7275 6529 0a0a 2020 2020 6465 6620  =True)..    def 
+0003c460: 7265 7365 745f 636f 6e74 6f75 7273 2873  reset_contours(s
+0003c470: 656c 662c 2063 6f6e 746f 7572 733d 4e6f  elf, contours=No
+0003c480: 6e65 2c20 6d6f 7374 5f70 6f69 6e74 733d  ne, most_points=
+0003c490: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+0003c4a0: 2222 220a 2020 2020 2020 2020 5265 7365  """.        Rese
+0003c4b0: 7420 782d 7920 636f 6e74 6f75 7273 2066  t x-y contours f
+0003c4c0: 6f72 2052 4f49 7320 6f66 2073 7472 7563  or ROIs of struc
+0003c4d0: 7475 7265 2073 6574 2e0a 0a20 2020 2020  ture set...     
+0003c4e0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+0003c4f0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+0003c500: 2020 2020 636f 6e74 6f75 7273 203a 2064      contours : d
+0003c510: 6963 742c 2064 6566 6175 6c74 3d4e 6f6e  ict, default=Non
+0003c520: 650a 2020 2020 2020 2020 2020 2020 4469  e.            Di
+0003c530: 6374 696f 6e61 7279 2077 6865 7265 206b  ctionary where k
+0003c540: 6579 7320 6172 6520 524f 4920 6e61 6d65  eys are ROI name
+0003c550: 7320 616e 6420 7661 6c75 6573 2061 7265  s and values are
+0003c560: 2064 6963 7469 6f6e 6172 6965 730a 2020   dictionaries.  
+0003c570: 2020 2020 2020 2020 2020 6f66 2073 6c69            of sli
+0003c580: 6365 2061 6e64 2063 6f6e 746f 7572 206c  ce and contour l
+0003c590: 6973 7473 2e20 2049 6620 4e6f 6e65 2c20  ists.  If None, 
+0003c5a0: 616e 2065 6d70 7479 2064 6963 7469 6f6e  an empty diction
+0003c5b0: 6172 7920 6973 0a20 2020 2020 2020 2020  ary is.         
+0003c5c0: 2020 2075 7365 642e 2020 4966 2061 6e20     used.  If an 
+0003c5d0: 524f 4920 6861 7320 6120 6e61 6d65 206e  ROI has a name n
+0003c5e0: 6f74 2069 6e63 6c75 6465 6420 696e 2074  ot included in t
+0003c5f0: 6865 2074 6f70 2d6c 6576 656c 0a20 2020  he top-level.   
+0003c600: 2020 2020 2020 2020 2064 6963 7469 6f6e           diction
+0003c610: 6172 792c 206f 7220 6861 7320 6120 6e61  ary, or has a na
+0003c620: 6d65 2077 6974 6820 6173 736f 6369 6174  me with associat
+0003c630: 6564 2076 616c 7565 204e 6f6e 652c 2074  ed value None, t
+0003c640: 6865 0a20 2020 2020 2020 2020 2020 2052  he.            R
+0003c650: 4f49 2063 6f6e 746f 7572 7320 7769 6c6c  OI contours will
+0003c660: 2062 6520 7265 7365 7420 7573 696e 6720   be reset using 
+0003c670: 7468 6520 524f 4927 7320 6f77 6e20 782d  the ROI's own x-
+0003c680: 7920 636f 6e74 6f75 7273 2e0a 0a20 2020  y contours...   
+0003c690: 2020 2020 206d 6f73 745f 706f 696e 7473       most_points
+0003c6a0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0003c6b0: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+0003c6c0: 2020 2049 6620 5472 7565 2c20 6f6e 6c79     If True, only
+0003c6d0: 2074 6865 2063 6f6e 746f 7572 2077 6974   the contour wit
+0003c6e0: 6820 6d6f 7374 2070 6f69 6e74 7320 666f  h most points fo
+0003c6f0: 7220 6561 6368 2073 6c69 6365 0a20 2020  r each slice.   
+0003c700: 2020 2020 2020 2020 2069 7320 7265 7461           is reta
+0003c710: 696e 6564 2061 6674 6572 2072 6573 6574  ined after reset
+0003c720: 7469 6e67 2e20 2049 6620 4661 6c73 652c  ting.  If False,
+0003c730: 2061 6c6c 2063 6f6e 746f 7572 7320 666f   all contours fo
+0003c740: 7220 6561 6368 0a20 2020 2020 2020 2020  r each.         
+0003c750: 2020 2073 6c69 6365 2061 7265 2072 6574     slice are ret
+0003c760: 6169 6e65 642e 0a20 2020 2020 2020 2022  ained..        "
+0003c770: 2222 0a20 2020 2020 2020 2063 6f6e 746f  "".        conto
+0003c780: 7572 7320 3d20 636f 6e74 6f75 7273 206f  urs = contours o
+0003c790: 7220 7b7d 0a20 2020 2020 2020 2066 6f72  r {}.        for
+0003c7a0: 2072 6f69 2069 6e20 7365 6c66 2e67 6574   roi in self.get
+0003c7b0: 5f72 6f69 7328 293a 0a20 2020 2020 2020  _rois():.       
+0003c7c0: 2020 2020 2072 6f69 2e72 6573 6574 5f63       roi.reset_c
+0003c7d0: 6f6e 746f 7572 7328 636f 6e74 6f75 7273  ontours(contours
+0003c7e0: 2e67 6574 2872 6f69 2e6e 616d 652c 204e  .get(roi.name, N
+0003c7f0: 6f6e 6529 2c20 6d6f 7374 5f70 6f69 6e74  one), most_point
+0003c800: 7329 0a0a 2020 2020 6465 6620 7365 745f  s)..    def set_
+0003c810: 696d 6167 655f 746f 5f64 756d 6d79 2873  image_to_dummy(s
+0003c820: 656c 662c 202a 2a6b 7761 7267 7329 3a0a  elf, **kwargs):.
+0003c830: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003c840: 2020 2020 5365 7420 696d 6167 6520 666f      Set image fo
+0003c850: 7220 7365 6c66 2061 6e64 2061 6c6c 2052  r self and all R
+0003c860: 4f49 7320 746f 2062 6520 6120 6475 6d6d  OIs to be a dumm
+0003c870: 7920 696d 6167 6520 636f 7665 7269 6e67  y image covering
+0003c880: 0a20 2020 2020 2020 2074 6865 2072 6567  .        the reg
+0003c890: 696f 6e20 636f 6e74 6169 6e69 6e67 2061  ion containing a
+0003c8a0: 6c6c 2052 4f49 7320 696e 2074 6865 2073  ll ROIs in the s
+0003c8b0: 7472 7563 7475 7265 2073 6574 2e20 2054  tructure set.  T
+0003c8c0: 6865 206d 6173 6b0a 2020 2020 2020 2020  he mask.        
+0003c8d0: 616e 6420 782d 7a2f 792d 7a20 636f 6e74  and x-z/y-z cont
+0003c8e0: 6f75 7273 206f 6620 6561 6368 2052 4f49  ours of each ROI
+0003c8f0: 2077 696c 6c20 6265 2063 6c65 6172 6564   will be cleared
+0003c900: 2c20 736f 2074 6861 7420 7468 6579 0a20  , so that they. 
+0003c910: 2020 2020 2020 2077 696c 6c20 6265 2072         will be r
+0003c920: 6563 7265 6174 6564 2077 6865 6e20 6765  ecreated when ge
+0003c930: 745f 6d61 736b 2829 206f 7220 6765 745f  t_mask() or get_
+0003c940: 636f 6e74 6f75 7273 2829 2061 7265 206e  contours() are n
+0003c950: 6578 7420 6361 6c6c 6564 2e0a 0a20 2020  ext called...   
+0003c960: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+0003c970: 733a 2a2a 0a20 2020 2020 2020 200a 2020  s:**.        .  
+0003c980: 2020 2020 2020 6b77 6172 6773 203a 200a        kwargs : .
+0003c990: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
+0003c9a0: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
+0003c9b0: 2070 6173 7320 746f 2073 656c 662e 6765   pass to self.ge
+0003c9c0: 745f 6475 6d6d 795f 696d 6167 6528 2920  t_dummy_image() 
+0003c9d0: 7768 656e 0a20 2020 2020 2020 2020 2020  when.           
+0003c9e0: 2063 7265 6174 696e 6720 7468 6520 6475   creating the du
+0003c9f0: 6d6d 7920 696d 6167 652e 2053 6565 2064  mmy image. See d
+0003ca00: 6f63 756d 656e 7461 7469 6f6e 206f 660a  ocumentation of.
+0003ca10: 2020 2020 2020 2020 2020 2020 5374 7275              Stru
+0003ca20: 6374 7572 6553 6574 2e67 6574 5f64 756d  ctureSet.get_dum
+0003ca30: 6d79 5f69 6d61 6765 2829 2e0a 2020 2020  my_image()..    
+0003ca40: 2022 2222 0a20 2020 2020 2020 2023 204d   """.        # M
+0003ca50: 616b 6520 696d 6167 650a 2020 2020 2020  ake image.      
+0003ca60: 2020 696d 203d 2073 656c 662e 6765 745f    im = self.get_
+0003ca70: 6475 6d6d 795f 696d 6167 6528 2a2a 6b77  dummy_image(**kw
+0003ca80: 6172 6773 290a 0a20 2020 2020 2020 2023  args)..        #
+0003ca90: 2043 6c65 6172 206d 6173 6b20 616e 6420   Clear mask and 
+0003caa0: 636f 6e74 6f75 7273 0a20 2020 2020 2020  contours.       
+0003cab0: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
+0003cac0: 2e72 6f69 733a 0a20 2020 2020 2020 2020  .rois:.         
+0003cad0: 2020 2072 6f69 2e69 6e70 7574 5f63 6f6e     roi.input_con
+0003cae0: 746f 7572 7320 3d20 726f 692e 6765 745f  tours = roi.get_
+0003caf0: 636f 6e74 6f75 7273 2822 782d 7922 290a  contours("x-y").
+0003cb00: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
+0003cb10: 636f 6e74 6f75 7273 203d 207b 2278 2d79  contours = {"x-y
+0003cb20: 223a 2072 6f69 2e69 6e70 7574 5f63 6f6e  ": roi.input_con
+0003cb30: 746f 7572 737d 0a20 2020 2020 2020 2020  tours}.         
+0003cb40: 2020 2072 6f69 2e6c 6f61 6465 645f 6d61     roi.loaded_ma
+0003cb50: 736b 203d 2046 616c 7365 0a20 2020 2020  sk = False.     
+0003cb60: 2020 2020 2020 2072 6f69 2e6d 6173 6b20         roi.mask 
+0003cb70: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+0003cb80: 2320 4173 7369 676e 2069 6d61 6765 0a20  # Assign image. 
+0003cb90: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+0003cba0: 696d 6167 6528 696d 290a 0a20 2020 2064  image(im)..    d
+0003cbb0: 6566 2073 6574 5f69 6d61 6765 2873 656c  ef set_image(sel
+0003cbc0: 662c 2069 6d61 6765 2c20 6164 645f 746f  f, image, add_to
+0003cbd0: 5f69 6d61 6765 3d54 7275 6529 3a0a 2020  _image=True):.  
+0003cbe0: 2020 2020 2020 2222 2253 6574 2069 6d61        """Set ima
+0003cbf0: 6765 2066 6f72 2073 656c 6620 616e 6420  ge for self and 
+0003cc00: 616c 6c20 524f 4973 2e0a 2020 2020 2020  all ROIs..      
+0003cc10: 2020 4966 2061 6464 5f74 6f5f 696d 6167    If add_to_imag
+0003cc20: 6520 6973 2054 7275 652c 2069 6d61 6765  e is True, image
+0003cc30: 2e61 6464 5f73 7472 7563 7475 7265 5f73  .add_structure_s
+0003cc40: 6574 2873 656c 6629 0a20 2020 2020 2020  et(self).       
+0003cc50: 2077 696c 6c20 616c 736f 2062 6520 6361   will also be ca
+0003cc60: 6c6c 6564 2e22 2222 0a0a 2020 2020 2020  lled."""..      
+0003cc70: 2020 2320 436f 6e76 6572 7420 746f 2049    # Convert to I
+0003cc80: 6d61 6765 206f 626a 6563 7420 6966 206e  mage object if n
+0003cc90: 6565 6465 640a 2020 2020 2020 2020 6966  eeded.        if
+0003cca0: 2069 6d61 6765 2061 6e64 206e 6f74 2069   image and not i
+0003ccb0: 7369 6e73 7461 6e63 6528 696d 6167 652c  sinstance(image,
+0003ccc0: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+0003ccd0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0003cce0: 696d 6167 6520 3d20 736b 7274 2e69 6d61  image = skrt.ima
+0003ccf0: 6765 2e49 6d61 6765 2869 6d61 6765 290a  ge.Image(image).
+0003cd00: 0a20 2020 2020 2020 2023 2041 7373 6967  .        # Assig
+0003cd10: 6e20 746f 2073 656c 6620 616e 6420 616c  n to self and al
+0003cd20: 6c20 524f 4973 0a20 2020 2020 2020 2073  l ROIs.        s
+0003cd30: 656c 662e 696d 6167 6520 3d20 696d 6167  elf.image = imag
+0003cd40: 650a 2020 2020 2020 2020 666f 7220 726f  e.        for ro
+0003cd50: 6920 696e 2073 656c 662e 726f 6973 3a0a  i in self.rois:.
+0003cd60: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
+0003cd70: 7365 745f 696d 6167 6528 696d 6167 6529  set_image(image)
+0003cd80: 0a0a 2020 2020 2020 2020 2320 4173 7369  ..        # Assi
+0003cd90: 676e 2073 656c 6620 746f 2074 6865 2069  gn self to the i
+0003cda0: 6d61 6765 0a20 2020 2020 2020 2069 6620  mage.        if 
+0003cdb0: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+0003cdc0: 6520 616e 6420 6164 645f 746f 5f69 6d61  e and add_to_ima
+0003cdd0: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
+0003cde0: 696d 6167 652e 6164 645f 7374 7275 6374  image.add_struct
+0003cdf0: 7572 655f 7365 7428 7365 6c66 290a 0a20  ure_set(self).. 
+0003ce00: 2020 2064 6566 2067 6574 5f69 6d61 6765     def get_image
+0003ce10: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0003ce20: 2222 2252 6574 7572 6e20 496d 6167 6520  """Return Image 
+0003ce30: 6f62 6a65 6374 2061 7373 6f63 6961 7465  object associate
+0003ce40: 6420 7769 7468 2074 6869 7320 5374 7275  d with this Stru
+0003ce50: 6374 7572 6553 6574 2e22 2222 0a20 2020  ctureSet.""".   
+0003ce60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0003ce70: 2e69 6d61 6765 0a0a 2020 2020 6465 6620  .image..    def 
+0003ce80: 636f 6e74 6169 6e73 2873 656c 662c 2072  contains(self, r
+0003ce90: 6f69 5f6e 616d 6573 2c20 696e 5f69 6d61  oi_names, in_ima
+0003cea0: 6765 3d46 616c 7365 293a 0a20 2020 2020  ge=False):.     
+0003ceb0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+0003cec0: 6574 7572 6e20 7768 6574 6865 7220 7374  eturn whether st
+0003ced0: 7275 6374 7572 6520 7365 7420 636f 6e74  ructure set cont
+0003cee0: 6169 6e73 206e 616d 6564 2052 4f49 732c  ains named ROIs,
+0003cef0: 0a20 2020 2020 2020 206f 7074 696f 6e61  .        optiona
+0003cf00: 6c6c 7920 7465 7374 696e 6720 7768 6574  lly testing whet
+0003cf10: 6865 7220 7468 6520 524f 4973 2062 6520  her the ROIs be 
+0003cf20: 6675 6c6c 7920 636f 6e74 6169 6e65 6420  fully contained 
+0003cf30: 696e 2061 6e20 696d 6167 652e 0a0a 2020  in an image...  
+0003cf40: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0003cf50: 7273 3a2a 2a0a 0a20 2020 2020 2020 2072  rs:**..        r
+0003cf60: 6f69 5f6e 616d 6573 203a 206c 6973 742f  oi_names : list/
+0003cf70: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+0003cf80: 5369 6e67 6c65 2073 7472 696e 672c 206f  Single string, o
+0003cf90: 7220 6c69 7374 206f 6620 7374 7269 6e67  r list of string
+0003cfa0: 732c 2069 6e64 6963 6174 696e 6720 6e61  s, indicating na
+0003cfb0: 6d65 2873 2920 6f66 2052 4f49 2873 290a  me(s) of ROI(s).
+0003cfc0: 2020 2020 2020 2020 2020 2020 746f 2062              to b
+0003cfd0: 6520 636f 6e73 6964 6572 6564 2e0a 0a20  e considered... 
+0003cfe0: 2020 2020 2020 2069 6e5f 696d 6167 6520         in_image 
+0003cff0: 3a20 626f 6f6c 2f73 6b72 742e 696d 6167  : bool/skrt.imag
+0003d000: 652e 496d 6167 652c 2064 6566 6175 6c74  e.Image, default
+0003d010: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+0003d020: 2020 2053 7065 6369 6669 6361 7469 6f6e     Specification
+0003d030: 206f 6620 7768 6574 6865 7220 746f 2074   of whether to t
+0003d040: 6573 7420 7468 6174 2052 4f49 7320 6172  est that ROIs ar
+0003d050: 6520 6675 6c6c 7920 636f 6e74 6169 6e65  e fully containe
+0003d060: 640a 2020 2020 2020 2020 2020 2020 696e  d.            in
+0003d070: 2061 6e20 696d 6167 652e 2020 4966 2069   an image.  If i
+0003d080: 6e5f 696d 6167 6520 6973 2069 6e20 496d  n_image is in Im
+0003d090: 6167 6520 6f62 6a65 6374 2c20 7468 6520  age object, the 
+0003d0a0: 626f 6f6c 6561 6e20 7265 7475 726e 6564  boolean returned
+0003d0b0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0003d0c0: 6963 6174 6573 2077 6865 7468 6572 2061  icates whether a
+0003d0d0: 6c6c 206e 616d 6564 2052 4f49 7320 6172  ll named ROIs ar
+0003d0e0: 6520 636f 6e74 6169 6e65 6420 7769 7468  e contained with
+0003d0f0: 696e 2074 6869 7320 696d 6167 652e 0a20  in this image.. 
+0003d100: 2020 2020 2020 2020 2020 2049 6620 696e             If in
+0003d110: 5f69 6d61 6765 2069 7320 5472 7565 2c20  _image is True, 
+0003d120: 7468 6520 626f 6f6c 6561 6e20 7265 7475  the boolean retu
+0003d130: 726e 6564 2069 6e64 6963 6174 6573 2077  rned indicates w
+0003d140: 6865 7468 6572 0a20 2020 2020 2020 2020  hether.         
+0003d150: 2020 2061 6c6c 206e 616d 6564 2052 4f49     all named ROI
+0003d160: 7320 6172 6520 636f 6e74 6169 6e65 6420  s are contained 
+0003d170: 7769 7468 696e 2074 6865 2069 6d61 6765  within the image
+0003d180: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+0003d190: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0003d1a0: 662e 0a20 2020 2020 2020 2022 2222 0a20  f..        """. 
+0003d1b0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0003d1c0: 616e 6365 2872 6f69 5f6e 616d 6573 2c20  ance(roi_names, 
+0003d1d0: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
+0003d1e0: 2020 726f 695f 6e61 6d65 7320 3d20 5b72    roi_names = [r
+0003d1f0: 6f69 5f6e 616d 6573 5d0a 0a20 2020 2020  oi_names]..     
+0003d200: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
+0003d210: 6572 2073 7472 7563 7475 7265 2073 6574  er structure set
+0003d220: 2063 6f6e 7461 696e 7320 616c 6c20 6e61   contains all na
+0003d230: 6d65 6420 524f 4973 2e0a 2020 2020 2020  med ROIs..      
+0003d240: 2020 7373 5f72 6f69 5f6e 616d 6573 203d    ss_roi_names =
+0003d250: 2073 656c 662e 6765 745f 726f 695f 6e61   self.get_roi_na
+0003d260: 6d65 7328 290a 2020 2020 2020 2020 666f  mes().        fo
+0003d270: 7220 726f 695f 6e61 6d65 2069 6e20 726f  r roi_name in ro
+0003d280: 695f 6e61 6d65 733a 0a20 2020 2020 2020  i_names:.       
+0003d290: 2020 2020 2069 6620 726f 695f 6e61 6d65       if roi_name
+0003d2a0: 206e 6f74 2069 6e20 7373 5f72 6f69 5f6e   not in ss_roi_n
+0003d2b0: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+0003d2c0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0003d2d0: 7365 0a0a 2020 2020 2020 2020 2320 4465  se..        # De
+0003d2e0: 7465 726d 696e 6520 7768 6574 6865 7220  termine whether 
+0003d2f0: 746f 2063 6865 636b 2074 6861 7420 6e61  to check that na
+0003d300: 6d65 6420 524f 4973 2061 7265 2063 6f6e  med ROIs are con
+0003d310: 7461 696e 6564 2069 6e20 616e 2069 6d61  tained in an ima
+0003d320: 6765 2e0a 2020 2020 2020 2020 6966 206e  ge..        if n
+0003d330: 6f74 2069 6e5f 696d 6167 653a 0a20 2020  ot in_image:.   
+0003d340: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003d350: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
+0003d360: 4368 6563 6b20 7468 6174 2069 6d61 6765  Check that image
+0003d370: 2069 7320 7370 6563 6966 6965 642e 0a20   is specified.. 
+0003d380: 2020 2020 2020 2023 2049 6620 7965 732c         # If yes,
+0003d390: 2020 656e 7375 7265 2074 6861 7420 524f    ensure that RO
+0003d3a0: 4920 6d61 736b 7320 6861 7665 2074 6865  I masks have the
+0003d3b0: 2073 616d 6520 766f 7865 6c20 7369 7a65   same voxel size
+0003d3c0: 2061 7320 7468 6973 2069 6d61 6765 2e0a   as this image..
+0003d3d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003d3e0: 7461 6e63 6528 696e 5f69 6d61 6765 2c20  tance(in_image, 
+0003d3f0: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+0003d400: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0003d410: 6d20 3d20 696e 5f69 6d61 6765 0a20 2020  m = in_image.   
+0003d420: 2020 2020 2020 2020 2073 7320 3d20 7365           ss = se
+0003d430: 6c66 2e63 6c6f 6e65 2829 0a20 2020 2020  lf.clone().     
+0003d440: 2020 2020 2020 2073 732e 7365 745f 696d         ss.set_im
+0003d450: 6167 6528 696d 2c20 6164 645f 746f 5f69  age(im, add_to_i
+0003d460: 6d61 6765 3d46 616c 7365 290a 2020 2020  mage=False).    
+0003d470: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003d480: 2020 2020 2020 696d 203d 2073 656c 662e        im = self.
+0003d490: 696d 6167 650a 2020 2020 2020 2020 2020  image.          
+0003d4a0: 2020 7373 203d 2073 656c 660a 2020 2020    ss = self.    
+0003d4b0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+0003d4c0: 7461 6e63 6528 696d 2c20 736b 7274 2e69  tance(im, skrt.i
+0003d4d0: 6d61 6765 2e49 6d61 6765 293a 0a20 2020  mage.Image):.   
+0003d4e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003d4f0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
+0003d500: 2043 6865 636b 2077 6865 7468 6572 2052   Check whether R
+0003d510: 4f49 7320 6172 6520 636f 6e74 6169 6e65  OIs are containe
+0003d520: 6420 696e 2069 6d61 6765 2e0a 2020 2020  d in image..    
+0003d530: 2020 2020 696d 5f65 7874 656e 7473 203d      im_extents =
+0003d540: 2069 6d2e 6765 745f 6578 7465 6e74 7328   im.get_extents(
+0003d550: 290a 2020 2020 2020 2020 666f 7220 726f  ).        for ro
+0003d560: 695f 6e61 6d65 2069 6e20 726f 695f 6e61  i_name in roi_na
+0003d570: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
+0003d580: 2072 6f69 5f65 7874 656e 7473 203d 2073   roi_extents = s
+0003d590: 735b 726f 695f 6e61 6d65 5d2e 6765 745f  s[roi_name].get_
+0003d5a0: 6578 7465 6e74 7328 302e 352c 2022 766f  extents(0.5, "vo
+0003d5b0: 7865 6c73 2229 0a20 2020 2020 2020 2020  xels").         
+0003d5c0: 2020 2066 6f72 2069 6478 2069 6e20 7261     for idx in ra
+0003d5d0: 6e67 6528 3329 3a0a 2020 2020 2020 2020  nge(3):.        
+0003d5e0: 2020 2020 2020 2020 6966 2072 6f69 5f65          if roi_e
+0003d5f0: 7874 656e 7473 5b69 6478 5d5b 305d 203c  xtents[idx][0] <
+0003d600: 2069 6d5f 6578 7465 6e74 735b 6964 785d   im_extents[idx]
+0003d610: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
+0003d620: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003d630: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0003d640: 2020 2020 2020 6966 2072 6f69 5f65 7874        if roi_ext
+0003d650: 656e 7473 5b69 6478 5d5b 315d 203e 2069  ents[idx][1] > i
+0003d660: 6d5f 6578 7465 6e74 735b 6964 785d 5b31  m_extents[idx][1
+0003d670: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0003d680: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0003d690: 6c73 650a 0a20 2020 2020 2020 2072 6574  lse..        ret
+0003d6a0: 7572 6e20 5472 7565 0a0a 2020 2020 6465  urn True..    de
+0003d6b0: 6620 6d69 7373 696e 6728 7365 6c66 2c20  f missing(self, 
+0003d6c0: 726f 695f 6e61 6d65 732c 2069 6e5f 696d  roi_names, in_im
+0003d6d0: 6167 653d 4661 6c73 6529 3a0a 2020 2020  age=False):.    
+0003d6e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0003d6f0: 4964 656e 7469 6679 2061 6d6f 6e67 206e  Identify among n
+0003d700: 616d 6564 2052 4f49 7320 7468 6f73 6520  amed ROIs those 
+0003d710: 7468 6174 2061 7265 206d 6973 7369 6e67  that are missing
+0003d720: 2066 726f 6d20 7374 7275 6374 7572 6520   from structure 
+0003d730: 7365 742c 0a20 2020 2020 2020 206f 7220  set,.        or 
+0003d740: 6172 6520 6e6f 7420 6675 6c6c 7920 636f  are not fully co
+0003d750: 6e74 6169 6e65 6420 696e 2061 6e20 696d  ntained in an im
+0003d760: 6167 652e 0a0a 2020 2020 2020 2020 2a2a  age...        **
+0003d770: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
+0003d780: 2020 2020 2020 2072 6f69 5f6e 616d 6573         roi_names
+0003d790: 203a 206c 6973 742f 7374 720a 2020 2020   : list/str.    
+0003d7a0: 2020 2020 2020 2020 5369 6e67 6c65 2073          Single s
+0003d7b0: 7472 696e 672c 206f 7220 6c69 7374 206f  tring, or list o
+0003d7c0: 6620 7374 7269 6e67 732c 2069 6e64 6963  f strings, indic
+0003d7d0: 6174 696e 6720 6e61 6d65 2873 2920 6f66  ating name(s) of
+0003d7e0: 2052 4f49 2873 290a 2020 2020 2020 2020   ROI(s).        
+0003d7f0: 2020 2020 746f 2062 6520 636f 6e73 6964      to be consid
+0003d800: 6572 6564 2e0a 0a20 2020 2020 2020 2069  ered...        i
+0003d810: 6e5f 696d 6167 6520 3a20 626f 6f6c 2f73  n_image : bool/s
+0003d820: 6b72 742e 696d 6167 652e 496d 6167 652c  krt.image.Image,
+0003d830: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+0003d840: 2020 2020 2020 2020 2020 2053 7065 6369             Speci
+0003d850: 6669 6361 7469 6f6e 206f 6620 7768 6574  fication of whet
+0003d860: 6865 7220 746f 2074 6573 7420 7468 6174  her to test that
+0003d870: 2052 4f49 7320 6172 6520 6675 6c6c 7920   ROIs are fully 
+0003d880: 636f 6e74 6169 6e65 640a 2020 2020 2020  contained.      
+0003d890: 2020 2020 2020 696e 2061 6e20 696d 6167        in an imag
+0003d8a0: 652e 2020 4966 2069 6e5f 696d 6167 6520  e.  If in_image 
+0003d8b0: 6973 2069 6e20 496d 6167 6520 6f62 6a65  is in Image obje
+0003d8c0: 6374 2c20 616e 2052 4f49 2069 730a 2020  ct, an ROI is.  
+0003d8d0: 2020 2020 2020 2020 2020 6964 656e 7469            identi
+0003d8e0: 6669 6564 2061 7320 6d69 7373 696e 6720  fied as missing 
+0003d8f0: 6966 206e 6f74 2063 6f6e 7461 696e 6564  if not contained
+0003d900: 2077 6974 6869 6e20 7468 6973 2069 6d61   within this ima
+0003d910: 6765 2e0a 2020 2020 2020 2020 2020 2020  ge..            
+0003d920: 4966 2069 6e5f 696d 6167 6520 6973 2054  If in_image is T
+0003d930: 7275 652c 2061 6e20 524f 4920 6973 2069  rue, an ROI is i
+0003d940: 6465 6e74 6966 6965 6420 6173 206d 6973  dentified as mis
+0003d950: 7369 6e67 2069 6620 6e6f 740a 2020 2020  sing if not.    
+0003d960: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
+0003d970: 6420 7769 7468 696e 2074 6865 2069 6d61  d within the ima
+0003d980: 6765 2061 7373 6f63 6961 7465 6420 7769  ge associated wi
+0003d990: 7468 2073 656c 662e 0a20 2020 2020 2020  th self..       
+0003d9a0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0003d9b0: 6973 696e 7374 616e 6365 2872 6f69 5f6e  isinstance(roi_n
+0003d9c0: 616d 6573 2c20 7374 7229 3a0a 2020 2020  ames, str):.    
+0003d9d0: 2020 2020 2020 2020 726f 695f 6e61 6d65          roi_name
+0003d9e0: 7320 3d20 5b72 6f69 5f6e 616d 6573 5d0a  s = [roi_names].
+0003d9f0: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
+0003da00: 726f 6973 203d 2073 6574 2829 0a0a 2020  rois = set()..  
+0003da10: 2020 2020 2020 2320 4368 6563 6b20 666f        # Check fo
+0003da20: 7220 524f 4973 206e 6f74 2063 6f6e 7461  r ROIs not conta
+0003da30: 696e 6564 2069 6e20 7374 7275 6374 7572  ined in structur
+0003da40: 6520 7365 742e 0a20 2020 2020 2020 2073  e set..        s
+0003da50: 735f 726f 695f 6e61 6d65 7320 3d20 7365  s_roi_names = se
+0003da60: 6c66 2e67 6574 5f72 6f69 5f6e 616d 6573  lf.get_roi_names
+0003da70: 2829 0a20 2020 2020 2020 2066 6f72 2072  ().        for r
+0003da80: 6f69 5f6e 616d 6520 696e 2072 6f69 5f6e  oi_name in roi_n
+0003da90: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+0003daa0: 2020 6966 2072 6f69 5f6e 616d 6520 6e6f    if roi_name no
+0003dab0: 7420 696e 2073 735f 726f 695f 6e61 6d65  t in ss_roi_name
+0003dac0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0003dad0: 2020 206d 6973 7369 6e67 5f72 6f69 732e     missing_rois.
+0003dae0: 6164 6428 726f 695f 6e61 6d65 290a 0a20  add(roi_name).. 
+0003daf0: 2020 2020 2020 2023 2044 6574 6572 6d69         # Determi
+0003db00: 6e65 2077 6865 7468 6572 2074 6f20 6368  ne whether to ch
+0003db10: 6563 6b20 7468 6174 206e 616d 6564 2052  eck that named R
+0003db20: 4f49 7320 6172 6520 636f 6e74 6169 6e65  OIs are containe
+0003db30: 6420 696e 2061 6e20 696d 6167 652e 0a20  d in an image.. 
+0003db40: 2020 2020 2020 2069 6620 6e6f 7420 696e         if not in
+0003db50: 5f69 6d61 6765 3a0a 2020 2020 2020 2020  _image:.        
+0003db60: 2020 2020 7265 7475 726e 2073 6f72 7465      return sorte
+0003db70: 6428 6c69 7374 286d 6973 7369 6e67 5f72  d(list(missing_r
+0003db80: 6f69 7329 290a 0a20 2020 2020 2020 2023  ois))..        #
+0003db90: 2043 6865 636b 2074 6861 7420 696d 6167   Check that imag
+0003dba0: 6520 6973 2073 7065 6369 6669 6564 2e0a  e is specified..
+0003dbb0: 2020 2020 2020 2020 2320 4966 2079 6573          # If yes
+0003dbc0: 2c20 2065 6e73 7572 6520 7468 6174 2052  ,  ensure that R
+0003dbd0: 4f49 206d 6173 6b73 2068 6176 6520 7468  OI masks have th
+0003dbe0: 6520 7361 6d65 2076 6f78 656c 2073 697a  e same voxel siz
+0003dbf0: 6520 6173 2074 6869 7320 696d 6167 652e  e as this image.
+0003dc00: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0003dc10: 7374 616e 6365 2869 6e5f 696d 6167 652c  stance(in_image,
+0003dc20: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+0003dc30: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0003dc40: 696d 203d 2069 6e5f 696d 6167 650a 2020  im = in_image.  
+0003dc50: 2020 2020 2020 2020 2020 7373 203d 2073            ss = s
+0003dc60: 656c 662e 636c 6f6e 6528 290a 2020 2020  elf.clone().    
+0003dc70: 2020 2020 2020 2020 7373 2e73 6574 5f69          ss.set_i
+0003dc80: 6d61 6765 2869 6d2c 2061 6464 5f74 6f5f  mage(im, add_to_
+0003dc90: 696d 6167 653d 4661 6c73 6529 0a20 2020  image=False).   
+0003dca0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003dcb0: 2020 2020 2020 2069 6d20 3d20 7365 6c66         im = self
+0003dcc0: 2e69 6d61 6765 0a20 2020 2020 2020 2020  .image.         
+0003dcd0: 2020 2073 7320 3d20 7365 6c66 0a20 2020     ss = self.   
+0003dce0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0003dcf0: 7374 616e 6365 2869 6d2c 2073 6b72 742e  stance(im, skrt.
+0003dd00: 696d 6167 652e 496d 6167 6529 3a0a 2020  image.Image):.  
+0003dd10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0003dd20: 5275 6e74 696d 6545 7272 6f72 2866 2249  RuntimeError(f"I
+0003dd30: 6e76 616c 6964 2069 6d61 6765 2073 7065  nvalid image spe
+0003dd40: 6369 6669 6361 7469 6f6e 2229 0a0a 2020  cification")..  
+0003dd50: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
+0003dd60: 6574 6865 7220 524f 4973 2061 7265 2063  ether ROIs are c
+0003dd70: 6f6e 7461 696e 6564 2069 6e20 696d 6167  ontained in imag
+0003dd80: 652e 0a20 2020 2020 2020 2069 6d5f 6578  e..        im_ex
+0003dd90: 7465 6e74 7320 3d20 696d 2e67 6574 5f65  tents = im.get_e
+0003dda0: 7874 656e 7473 2829 0a20 2020 2020 2020  xtents().       
+0003ddb0: 2061 6374 6976 655f 726f 6973 203d 2073   active_rois = s
+0003ddc0: 6574 2872 6f69 5f6e 616d 6573 2920 2d20  et(roi_names) - 
+0003ddd0: 6d69 7373 696e 675f 726f 6973 0a20 2020  missing_rois.   
+0003dde0: 2020 2020 2066 6f72 2072 6f69 5f6e 616d       for roi_nam
+0003ddf0: 6520 696e 2061 6374 6976 655f 726f 6973  e in active_rois
+0003de00: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+0003de10: 695f 6578 7465 6e74 7320 3d20 7373 5b72  i_extents = ss[r
+0003de20: 6f69 5f6e 616d 655d 2e67 6574 5f65 7874  oi_name].get_ext
+0003de30: 656e 7473 2830 2e35 2c20 2276 6f78 656c  ents(0.5, "voxel
+0003de40: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
+0003de50: 666f 7220 6964 7820 696e 2072 616e 6765  for idx in range
+0003de60: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
+0003de70: 2020 2020 2069 6620 2872 6f69 5f65 7874       if (roi_ext
+0003de80: 656e 7473 5b69 6478 5d5b 305d 203c 2069  ents[idx][0] < i
+0003de90: 6d5f 6578 7465 6e74 735b 6964 785d 5b30  m_extents[idx][0
+0003dea0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0003deb0: 2020 2020 2020 6f72 2072 6f69 5f65 7874        or roi_ext
+0003dec0: 656e 7473 5b69 6478 5d5b 315d 203e 2069  ents[idx][1] > i
+0003ded0: 6d5f 6578 7465 6e74 735b 6964 785d 5b31  m_extents[idx][1
+0003dee0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0003def0: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
+0003df00: 726f 6973 2e61 6464 2872 6f69 5f6e 616d  rois.add(roi_nam
+0003df10: 6529 0a0a 2020 2020 2020 2020 7265 7475  e)..        retu
+0003df20: 726e 2073 6f72 7465 6428 6c69 7374 286d  rn sorted(list(m
+0003df30: 6973 7369 6e67 5f72 6f69 7329 290a 0a20  issing_rois)).. 
+0003df40: 2020 2064 6566 2068 6173 5f72 6f69 7328     def has_rois(
+0003df50: 7365 6c66 2c20 6e61 6d65 733d 4e6f 6e65  self, names=None
+0003df60: 2c20 696e 636c 7564 655f 6b65 7973 3d46  , include_keys=F
+0003df70: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+0003df80: 2222 0a20 2020 2020 2020 2044 6574 6572  "".        Deter
+0003df90: 6d69 6e65 2077 6865 7468 6572 2073 7472  mine whether str
+0003dfa0: 7563 7475 7265 2073 6574 2063 6f6e 7461  ucture set conta
+0003dfb0: 696e 7320 7370 6563 6966 6965 6420 524f  ins specified RO
+0003dfc0: 4973 2c0a 2020 2020 2020 2020 6964 656e  Is,.        iden
+0003dfd0: 7469 6669 6564 2062 7920 6120 6e6f 6d69  tified by a nomi
+0003dfe0: 6e61 6c20 6e61 6d65 206f 7220 6279 2061  nal name or by a
+0003dff0: 6e20 616c 6961 732e 0a0a 2020 2020 2020  n alias...      
+0003e000: 2020 5468 6973 206d 6574 686f 6420 7265    This method re
+0003e010: 7475 726e 7320 5472 7565 2069 6620 616c  turns True if al
+0003e020: 6c20 7370 6563 6966 6965 6420 524f 4920  l specified ROI 
+0003e030: 6e61 6d65 7320 6172 6520 6d61 7463 6865  names are matche
+0003e040: 640a 2020 2020 2020 2020 7769 7468 2074  d.        with t
+0003e050: 6865 206e 616d 6520 6f66 2061 6e20 524f  he name of an RO
+0003e060: 4920 696e 2074 6865 2073 7472 7563 7475  I in the structu
+0003e070: 7265 2073 6574 2c20 616e 6420 7265 7475  re set, and retu
+0003e080: 726e 7320 4661 6c73 650a 2020 2020 2020  rns False.      
+0003e090: 2020 6f74 6865 7277 6973 652e 2020 4d61    otherwise.  Ma
+0003e0a0: 7463 6869 6e67 2069 7320 6361 7365 2069  tching is case i
+0003e0b0: 6e73 656e 7369 7469 7665 2e0a 0a20 2020  nsensitive...   
+0003e0c0: 2020 2020 206e 616d 6573 203a 2073 7472       names : str
+0003e0d0: 2f6c 6973 742f 6469 6374 0a20 2020 2020  /list/dict.     
+0003e0e0: 2020 2020 2020 2053 7065 6369 6669 6361         Specifica
+0003e0f0: 7469 6f6e 206f 6620 524f 4973 3a0a 2020  tion of ROIs:.  
+0003e100: 2020 2020 2020 2020 2020 2d20 6120 7369            - a si
+0003e110: 6e67 6c65 2052 4f49 206e 616d 652c 206f  ngle ROI name, o
+0003e120: 7074 696f 6e61 6c6c 7920 696e 636c 7564  ptionally includ
+0003e130: 696e 6720 7769 6c64 6361 7264 733b 0a20  ing wildcards;. 
+0003e140: 2020 2020 2020 2020 2020 202d 2061 206c             - a l
+0003e150: 6973 7420 6f66 2052 4f49 206e 616d 6573  ist of ROI names
+0003e160: 2c20 6561 6368 206f 7074 696f 6e61 6c6c  , each optionall
+0003e170: 7920 696e 636c 7564 696e 6720 7769 6c64  y including wild
+0003e180: 6361 7264 733b 0a20 2020 2020 2020 2020  cards;.         
+0003e190: 2020 202d 2061 2064 6963 7469 6f6e 6172     - a dictionar
+0003e1a0: 792c 2077 6865 7265 206b 6579 7320 6172  y, where keys ar
+0003e1b0: 6520 6e6f 6d69 6e61 6c20 524f 4920 6e61  e nominal ROI na
+0003e1c0: 6d65 732c 0a20 2020 2020 2020 2020 2020  mes,.           
+0003e1d0: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
+0003e1e0: 6c69 7374 7320 6f66 2070 6f73 7369 626c  lists of possibl
+0003e1f0: 6520 6e61 6d65 732c 206f 7074 696f 6e61  e names, optiona
+0003e200: 6c6c 7920 696e 636c 7564 696e 670a 2020  lly including.  
+0003e210: 2020 2020 2020 2020 2020 7769 6c64 6361            wildca
+0003e220: 7264 732e 0a0a 2020 2020 2020 2020 696e  rds...        in
+0003e230: 636c 7564 655f 6b65 7973 203a 2062 6f6f  clude_keys : boo
+0003e240: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
+0003e250: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+0003e260: 7275 652c 2063 6f6e 7369 6465 7220 626f  rue, consider bo
+0003e270: 7468 206b 6579 7320 616e 6420 7661 6c75  th keys and valu
+0003e280: 6573 2066 6f72 206d 6174 6368 696e 6720  es for matching 
+0003e290: 6966 2052 4f49 206e 616d 6573 0a20 2020  if ROI names.   
+0003e2a0: 2020 2020 2020 2020 2061 7265 2073 7065           are spe
+0003e2b0: 6369 6669 6564 2061 7320 6120 6469 6374  cified as a dict
+0003e2c0: 696f 6e61 7279 2e20 2049 6620 4661 6c73  ionary.  If Fals
+0003e2d0: 652c 2063 6f6e 7369 6465 7220 7661 6c75  e, consider valu
+0003e2e0: 6573 206f 6e6c 792e 0a20 2020 2020 2020  es only..       
+0003e2f0: 2022 2222 0a20 2020 2020 2020 2023 2043   """.        # C
+0003e300: 6f6e 7665 7274 206e 616d 6573 2074 6f20  onvert names to 
+0003e310: 6120 6469 6374 696f 6e61 7279 2c20 7768  a dictionary, wh
+0003e320: 6572 6520 6561 6368 2076 616c 7565 2069  ere each value i
+0003e330: 7320 6120 6c69 7374 2e0a 2020 2020 2020  s a list..      
+0003e340: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0003e350: 6e61 6d65 732c 2073 7472 293a 0a20 2020  names, str):.   
+0003e360: 2020 2020 2020 2020 206e 616d 6573 203d           names =
+0003e370: 207b 6e61 6d65 733a 205b 6e61 6d65 735d   {names: [names]
+0003e380: 7d0a 2020 2020 2020 2020 656c 6966 2073  }.        elif s
+0003e390: 6b72 742e 636f 7265 2e69 735f 6c69 7374  krt.core.is_list
+0003e3a0: 286e 616d 6573 293a 0a20 2020 2020 2020  (names):.       
+0003e3b0: 2020 2020 206e 616d 6573 203d 207b 6e61       names = {na
+0003e3c0: 6d65 3a20 5b6e 616d 655d 2066 6f72 206e  me: [name] for n
+0003e3d0: 616d 6520 696e 206e 616d 6573 7d0a 2020  ame in names}.  
+0003e3e0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0003e3f0: 7461 6e63 6528 6e61 6d65 732c 2064 6963  tance(names, dic
+0003e400: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0003e410: 666f 7220 6e61 6d65 2069 6e20 6e61 6d65  for name in name
+0003e420: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0003e430: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003e440: 286e 616d 6573 5b6e 616d 655d 2c20 7374  (names[name], st
+0003e450: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0003e460: 2020 2020 2020 2020 6e61 6d65 735b 6e61          names[na
+0003e470: 6d65 5d20 3d20 5b6e 616d 6573 5b6e 616d  me] = [names[nam
+0003e480: 655d 5d0a 0a20 2020 2020 2020 2023 2045  e]]..        # E
+0003e490: 7869 7420 6973 206e 616d 6573 2069 736e  xit is names isn
+0003e4a0: 2774 2061 2064 6963 7469 6f6e 6172 792e  't a dictionary.
+0003e4b0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0003e4c0: 6973 696e 7374 616e 6365 286e 616d 6573  isinstance(names
+0003e4d0: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
+0003e4e0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0003e4f0: 650a 0a20 2020 2020 2020 2023 2054 7279  e..        # Try
+0003e500: 2074 6f20 6d61 7463 6820 6561 6368 2052   to match each R
+0003e510: 4f49 206e 616d 6520 7769 7468 206e 6f6d  OI name with nom
+0003e520: 696e 616c 206e 616d 6520 6f72 2061 6e79  inal name or any
+0003e530: 2061 6c69 6173 6573 2e0a 2020 2020 2020   aliases..      
+0003e540: 2020 666f 7220 6e61 6d65 2c20 616c 6961    for name, alia
+0003e550: 7365 7320 696e 206e 616d 6573 2e69 7465  ses in names.ite
+0003e560: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0003e570: 2020 6966 2069 6e63 6c75 6465 5f6b 6579    if include_key
+0003e580: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0003e590: 2020 206e 616d 6573 5f74 6f5f 6d61 7463     names_to_matc
+0003e5a0: 6820 3d20 5b6e 616d 655d 202b 2061 6c69  h = [name] + ali
+0003e5b0: 6173 6573 0a20 2020 2020 2020 2020 2020  ases.           
+0003e5c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003e5d0: 2020 2020 2020 206e 616d 6573 5f74 6f5f         names_to_
+0003e5e0: 6d61 7463 6820 3d20 616c 6961 7365 730a  match = aliases.
+0003e5f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003e600: 6e61 6d65 5f74 6f5f 6d61 7463 6820 696e  name_to_match in
+0003e610: 206e 616d 6573 5f74 6f5f 6d61 7463 683a   names_to_match:
+0003e620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e630: 2066 6f72 2072 6f69 5f6e 616d 6520 696e   for roi_name in
+0003e640: 2073 656c 662e 6765 745f 726f 695f 6e61   self.get_roi_na
+0003e650: 6d65 7328 293a 0a20 2020 2020 2020 2020  mes():.         
+0003e660: 2020 2020 2020 2020 2020 206d 6174 6368             match
+0003e670: 203d 2066 6e6d 6174 6368 2e66 6e6d 6174   = fnmatch.fnmat
+0003e680: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
+0003e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e6a0: 726f 695f 6e61 6d65 2e6c 6f77 6572 2829  roi_name.lower()
+0003e6b0: 2c20 6e61 6d65 5f74 6f5f 6d61 7463 682e  , name_to_match.
+0003e6c0: 6c6f 7765 7228 2929 0a20 2020 2020 2020  lower()).       
+0003e6d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003e6e0: 6d61 7463 683a 0a20 2020 2020 2020 2020  match:.         
+0003e6f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0003e700: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+0003e710: 2020 2020 2069 6620 6d61 7463 683a 0a20       if match:. 
+0003e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e730: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0003e740: 2020 2020 2069 6620 6e6f 7420 6d61 7463       if not matc
+0003e750: 683a 0a20 2020 2020 2020 2020 2020 2020  h:.             
+0003e760: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0003e770: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003e780: 5472 7565 0a0a 2020 2020 6465 6620 7265  True..    def re
+0003e790: 6e61 6d65 5f72 6f69 7328 0a20 2020 2020  name_rois(.     
+0003e7a0: 2020 2073 656c 662c 206e 616d 6573 3d4e     self, names=N
+0003e7b0: 6f6e 652c 2066 6972 7374 5f6d 6174 6368  one, first_match
+0003e7c0: 5f6f 6e6c 793d 5472 7565 2c20 6b65 6570  _only=True, keep
+0003e7d0: 5f72 656e 616d 6564 5f6f 6e6c 793d 4661  _renamed_only=Fa
+0003e7e0: 6c73 650a 2020 2020 293a 0a20 2020 2020  lse.    ):.     
+0003e7f0: 2020 2022 2222 5265 6e61 6d65 2052 4f49     """Rename ROI
+0003e800: 7320 696e 2074 6869 7320 5374 7275 6374  s in this Struct
+0003e810: 7572 6553 6574 2e0a 2020 2020 2020 2020  ureSet..        
+0003e820: 3c66 6972 7374 5f6d 6174 6368 5f6f 6e6c  <first_match_onl
+0003e830: 793e 2069 7320 5472 7565 2c20 6f6e 6c79  y> is True, only
+0003e840: 2074 6865 2066 6972 7374 2052 4f49 206d   the first ROI m
+0003e850: 6174 6368 696e 6720 7468 650a 2020 2020  atching the.    
+0003e860: 2020 2020 706f 7373 6962 6c65 206d 6174      possible mat
+0003e870: 6368 6573 2077 696c 6c20 6265 2072 656e  ches will be ren
+0003e880: 616d 6564 2e0a 0a20 2020 2020 2020 202a  amed...        *
+0003e890: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
+0003e8a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0003e8b0: 6e61 6d65 7320 3a20 6469 6374 2c20 6465  names : dict, de
+0003e8c0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0003e8d0: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
+0003e8e0: 7920 6f66 206e 616d 6573 2066 6f72 2072  y of names for r
+0003e8f0: 656e 616d 696e 6720 524f 4973 2c20 7768  enaming ROIs, wh
+0003e900: 6572 6520 7468 6520 6b65 7973 2061 7265  ere the keys are
+0003e910: 206e 6577 200a 2020 2020 2020 2020 2020   new .          
+0003e920: 2020 6e61 6d65 7320 616e 6420 7661 6c75    names and valu
+0003e930: 6573 2061 7265 206c 6973 7473 206f 6620  es are lists of 
+0003e940: 706f 7373 6962 6c65 206e 616d 6573 206f  possible names o
+0003e950: 6620 524f 4973 2074 6861 7420 7368 6f75  f ROIs that shou
+0003e960: 6c64 0a20 2020 2020 2020 2020 2020 2062  ld.            b
+0003e970: 6520 6173 7369 676e 6564 2074 6865 206e  e assigned the n
+0003e980: 6577 206e 616d 652e 2054 6865 7365 206e  ew name. These n
+0003e990: 616d 6573 2063 616e 2061 6c73 6f20 636f  ames can also co
+0003e9a0: 6e74 6169 6e20 7769 6c64 6361 7264 730a  ntain wildcards.
+0003e9b0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0003e9c0: 2074 6865 2027 2a27 2073 796d 626f 6c2e   the '*' symbol.
+0003e9d0: 0a0a 2020 2020 2020 2020 6669 7273 745f  ..        first_
+0003e9e0: 6d61 7463 685f 6f6e 6c79 203a 2062 6f6f  match_only : boo
+0003e9f0: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
+0003ea00: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+0003ea10: 7275 652c 206f 6e6c 7920 7468 6520 6669  rue, only the fi
+0003ea20: 7273 7420 524f 4920 6d61 7463 6869 6e67  rst ROI matching
+0003ea30: 2074 6865 2070 6f73 7369 626c 6520 6e61   the possible na
+0003ea40: 6d65 7320 696e 2074 6865 200a 2020 2020  mes in the .    
+0003ea50: 2020 2020 2020 2020 7661 6c75 6573 206f          values o
+0003ea60: 6620 3c6e 616d 6573 3e20 7769 6c6c 2062  f <names> will b
+0003ea70: 6520 7265 6e61 6d65 643b 2074 6869 7320  e renamed; this 
+0003ea80: 7072 6576 656e 7473 206e 616d 6520 6475  prevents name du
+0003ea90: 706c 6963 6174 696f 6e0a 2020 2020 2020  plication.      
+0003eaa0: 2020 2020 2020 6966 206d 756c 7469 706c        if multipl
+0003eab0: 6520 524f 4973 2069 6e20 7468 6520 5374  e ROIs in the St
+0003eac0: 7275 6374 7572 6553 6574 2061 7265 2061  ructureSet are a
+0003ead0: 206d 6174 6368 2e0a 0a20 2020 2020 2020   match...       
+0003eae0: 206b 6565 705f 7265 6e61 6d65 645f 6f6e   keep_renamed_on
+0003eaf0: 6c79 203a 2062 6f6f 6c2c 2064 6566 6175  ly : bool, defau
+0003eb00: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+0003eb10: 2020 2020 2049 6620 5472 7565 2c20 616e       If True, an
+0003eb20: 7920 524f 4973 2074 6861 7420 646f 206e  y ROIs that do n
+0003eb30: 6f74 2067 6574 2072 656e 616d 6564 2077  ot get renamed w
+0003eb40: 696c 6c20 6265 2072 656d 6f76 6564 2066  ill be removed f
+0003eb50: 726f 6d0a 2020 2020 2020 2020 2020 2020  rom.            
+0003eb60: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
+0003eb70: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0003eb80: 2020 2020 2020 2069 6620 6e61 6d65 7320         if names 
+0003eb90: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0003eba0: 2020 2020 206e 616d 6573 203d 2073 656c       names = sel
+0003ebb0: 662e 6e61 6d65 730a 2020 2020 2020 2020  f.names.        
+0003ebc0: 6966 206e 6f74 206e 616d 6573 206f 7220  if not names or 
+0003ebd0: 6e6f 7420 6973 696e 7374 616e 6365 286e  not isinstance(n
+0003ebe0: 616d 6573 2c20 6469 6374 293a 0a20 2020  ames, dict):.   
+0003ebf0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0003ec00: 0a20 2020 2020 2020 2023 204c 6f6f 7020  .        # Loop 
+0003ec10: 7468 726f 7567 6820 6561 6368 206e 6577  through each new
+0003ec20: 206e 616d 650a 2020 2020 2020 2020 616c   name.        al
+0003ec30: 7265 6164 795f 7265 6e61 6d65 6420 3d20  ready_renamed = 
+0003ec40: 5b5d 0a20 2020 2020 2020 2066 6f72 206e  [].        for n
+0003ec50: 616d 652c 206d 6174 6368 6573 2069 6e20  ame, matches in 
+0003ec60: 6e61 6d65 732e 6974 656d 7328 293a 0a0a  names.items():..
+0003ec70: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0003ec80: 6f74 2073 6b72 742e 636f 7265 2e69 735f  ot skrt.core.is_
+0003ec90: 6c69 7374 286d 6174 6368 6573 293a 0a20  list(matches):. 
+0003eca0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0003ecb0: 6174 6368 6573 203d 205b 6d61 7463 6865  atches = [matche
+0003ecc0: 735d 0a0a 2020 2020 2020 2020 2020 2020  s]..            
+0003ecd0: 2320 4c6f 6f70 2074 6872 6f75 6768 2061  # Loop through a
+0003ece0: 6c6c 2070 6f73 7369 626c 6520 6f72 6967  ll possible orig
+0003ecf0: 696e 616c 206e 616d 6573 0a20 2020 2020  inal names.     
+0003ed00: 2020 2020 2020 206e 616d 655f 6d61 7463         name_matc
+0003ed10: 6865 6420 3d20 4661 6c73 650a 2020 2020  hed = False.    
+0003ed20: 2020 2020 2020 2020 666f 7220 6d20 696e          for m in
+0003ed30: 206d 6174 6368 6573 3a0a 0a20 2020 2020   matches:..     
+0003ed40: 2020 2020 2020 2020 2020 2023 204c 6f6f             # Loo
+0003ed50: 7020 7468 726f 7567 6820 524f 4973 2061  p through ROIs a
+0003ed60: 6e64 2073 6565 2069 6620 7468 6572 6527  nd see if there'
+0003ed70: 7320 6120 6d61 7463 680a 2020 2020 2020  s a match.      
+0003ed80: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+0003ed90: 2073 2069 6e20 656e 756d 6572 6174 6528   s in enumerate(
+0003eda0: 7365 6c66 2e67 6574 5f72 6f69 7328 2929  self.get_rois())
+0003edb0: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+0003edc0: 2020 2020 2020 2023 2044 6f6e 2774 2072         # Don't r
+0003edd0: 656e 616d 6520 616e 2052 4f49 206d 6f72  ename an ROI mor
+0003ede0: 6520 7468 616e 206f 6e63 650a 2020 2020  e than once.    
+0003edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ee00: 6966 2069 2069 6e20 616c 7265 6164 795f  if i in already_
+0003ee10: 7265 6e61 6d65 643a 0a20 2020 2020 2020  renamed:.       
+0003ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ee30: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+0003ee40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003ee50: 6620 666e 6d61 7463 682e 666e 6d61 7463  f fnmatch.fnmatc
+0003ee60: 6828 732e 6e61 6d65 2e6c 6f77 6572 2829  h(s.name.lower()
+0003ee70: 2c20 6d2e 6c6f 7765 7228 2929 3a0a 2020  , m.lower()):.  
+0003ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ee90: 2020 2020 2020 732e 6e61 6d65 203d 206e        s.name = n
+0003eea0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0003eeb0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0003eec0: 5f6d 6174 6368 6564 203d 2054 7275 650a  _matched = True.
+0003eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003eee0: 2020 2020 2020 2020 616c 7265 6164 795f          already_
+0003eef0: 7265 6e61 6d65 642e 6170 7065 6e64 2869  renamed.append(i
+0003ef00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003ef10: 2020 2020 2020 2020 2020 6966 2066 6972            if fir
+0003ef20: 7374 5f6d 6174 6368 5f6f 6e6c 793a 0a20  st_match_only:. 
+0003ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ef40: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0003ef50: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003ef60: 2020 2320 4966 2066 6972 7374 5f6d 6174    # If first_mat
+0003ef70: 6368 5f6f 6e6c 792c 2064 6f6e 2774 2072  ch_only, don't r
+0003ef80: 656e 616d 6520 6d6f 7265 2074 6861 6e20  ename more than 
+0003ef90: 6f6e 6520 524f 490a 2020 2020 2020 2020  one ROI.        
+0003efa0: 2020 2020 2020 2020 2320 7769 7468 2074          # with t
+0003efb0: 6869 7320 6e65 7720 6e61 6d65 0a20 2020  his new name.   
+0003efc0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003efd0: 6e61 6d65 5f6d 6174 6368 6564 2061 6e64  name_matched and
+0003efe0: 2066 6972 7374 5f6d 6174 6368 5f6f 6e6c   first_match_onl
+0003eff0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0003f000: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
+0003f010: 2020 2020 2020 2320 4b65 6570 206f 6e6c        # Keep onl
+0003f020: 7920 7468 6520 7265 6e61 6d65 6420 524f  y the renamed RO
+0003f030: 4973 2069 6620 7265 7175 6573 7465 640a  Is if requested.
+0003f040: 2020 2020 2020 2020 6966 206b 6565 705f          if keep_
+0003f050: 7265 6e61 6d65 645f 6f6e 6c79 3a0a 2020  renamed_only:.  
+0003f060: 2020 2020 2020 2020 2020 7265 6e61 6d65            rename
+0003f070: 645f 726f 6973 203d 205b 7365 6c66 2e72  d_rois = [self.r
+0003f080: 6f69 735b 695d 2066 6f72 2069 2069 6e20  ois[i] for i in 
+0003f090: 616c 7265 6164 795f 7265 6e61 6d65 645d  already_renamed]
+0003f0a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0003f0b0: 662e 726f 6973 203d 2072 656e 616d 6564  f.rois = renamed
+0003f0c0: 5f72 6f69 730a 0a20 2020 2064 6566 2066  _rois..    def f
+0003f0d0: 696c 7465 725f 726f 6973 2873 656c 662c  ilter_rois(self,
+0003f0e0: 2074 6f5f 6b65 6570 3d4e 6f6e 652c 2074   to_keep=None, t
+0003f0f0: 6f5f 7265 6d6f 7665 3d4e 6f6e 6529 3a0a  o_remove=None):.
+0003f100: 2020 2020 2020 2020 2222 224b 6565 7020          """Keep 
+0003f110: 6f6e 6c79 2074 6865 2052 4f49 7320 696e  only the ROIs in
+0003f120: 2074 6865 2074 6f5f 6b65 6570 206c 6973   the to_keep lis
+0003f130: 7420 616e 6420 7265 6d6f 7665 2061 6e79  t and remove any
+0003f140: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
+0003f150: 746f 5f72 656d 6f76 6520 6c69 7374 2e0a  to_remove list..
+0003f160: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0003f170: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+0003f180: 200a 0a20 2020 2020 2020 2074 6f5f 6b65   ..        to_ke
+0003f190: 6570 203a 206c 6973 742c 2064 6566 6175  ep : list, defau
+0003f1a0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0003f1b0: 2020 2020 4c69 7374 206f 6620 6e61 6d65      List of name
+0003f1c0: 7320 6f66 2052 4f49 7320 746f 206b 6565  s of ROIs to kee
+0003f1d0: 7020 696e 2074 6865 2063 6f70 6965 6420  p in the copied 
+0003f1e0: 5374 7275 6374 7572 6553 6574 3b20 616c  StructureSet; al
+0003f1f0: 6c20 0a20 2020 2020 2020 2020 2020 206f  l .            o
+0003f200: 7468 6572 7320 7769 6c6c 2062 6520 7265  thers will be re
+0003f210: 6d6f 7665 642e 2054 6865 7365 206e 616d  moved. These nam
+0003f220: 6573 2063 616e 2061 6c73 6f20 636f 6e74  es can also cont
+0003f230: 6169 6e20 7769 6c64 6361 7264 730a 2020  ain wildcards.  
+0003f240: 2020 2020 2020 2020 2020 7769 7468 2074            with t
+0003f250: 6865 2027 2a27 2073 796d 626f 6c2e 200a  he '*' symbol. .
+0003f260: 0a20 2020 2020 2020 2074 6f5f 7265 6d6f  .        to_remo
+0003f270: 7665 203a 206c 6973 742c 2064 6566 6175  ve : list, defau
+0003f280: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0003f290: 2020 2020 4c69 7374 206f 6620 6e61 6d65      List of name
+0003f2a0: 7320 6f66 2052 4f49 7320 746f 2072 656d  s of ROIs to rem
+0003f2b0: 6f76 6520 6672 6f6d 2074 6865 2063 6f70  ove from the cop
+0003f2c0: 6965 6420 5374 7275 6374 7572 6553 6574  ied StructureSet
+0003f2d0: 3b20 616c 6c20 0a20 2020 2020 2020 2020  ; all .         
+0003f2e0: 2020 206f 7468 6572 7320 7769 6c6c 2062     others will b
+0003f2f0: 6520 7265 6d6f 7665 642e 2054 6865 7365  e removed. These
+0003f300: 206e 616d 6573 2063 616e 2061 6c73 6f20   names can also 
+0003f310: 636f 6e74 6169 6e20 7769 6c64 6361 7264  contain wildcard
+0003f320: 730a 2020 2020 2020 2020 2020 2020 7769  s.            wi
+0003f330: 7468 2074 6865 2027 2a27 2073 796d 626f  th the '*' symbo
+0003f340: 6c2e 2041 7070 6c69 6564 2061 6674 6572  l. Applied after
+0003f350: 2066 696c 7465 7269 6e67 2077 6974 6820   filtering with 
+0003f360: 3c74 6f5f 6b65 6570 3e2e 0a20 2020 2020  <to_keep>..     
+0003f370: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0003f380: 2320 456e 7375 7265 2074 6f5f 6b65 6570  # Ensure to_keep
+0003f390: 2061 6e64 2074 6f5f 7265 6d6f 7665 2061   and to_remove a
+0003f3a0: 7265 206c 6973 7473 0a20 2020 2020 2020  re lists.       
+0003f3b0: 2069 6620 746f 5f6b 6565 7020 6973 204e   if to_keep is N
+0003f3c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0003f3d0: 2074 6f5f 6b65 6570 203d 2073 656c 662e   to_keep = self.
+0003f3e0: 746f 5f6b 6565 700a 2020 2020 2020 2020  to_keep.        
+0003f3f0: 656c 6966 206e 6f74 2073 6b72 742e 636f  elif not skrt.co
+0003f400: 7265 2e69 735f 6c69 7374 2874 6f5f 6b65  re.is_list(to_ke
+0003f410: 6570 293a 0a20 2020 2020 2020 2020 2020  ep):.           
+0003f420: 2074 6f5f 6b65 6570 203d 205b 746f 5f6b   to_keep = [to_k
+0003f430: 6565 705d 0a20 2020 2020 2020 2069 6620  eep].        if 
+0003f440: 746f 5f72 656d 6f76 6520 6973 204e 6f6e  to_remove is Non
+0003f450: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+0003f460: 6f5f 7265 6d6f 7665 203d 2073 656c 662e  o_remove = self.
+0003f470: 746f 5f72 656d 6f76 650a 2020 2020 2020  to_remove.      
+0003f480: 2020 656c 6966 206e 6f74 2073 6b72 742e    elif not skrt.
+0003f490: 636f 7265 2e69 735f 6c69 7374 2874 6f5f  core.is_list(to_
+0003f4a0: 7265 6d6f 7665 293a 0a20 2020 2020 2020  remove):.       
+0003f4b0: 2020 2020 2074 6f5f 7265 6d6f 7665 203d       to_remove =
+0003f4c0: 205b 746f 5f72 656d 6f76 655d 0a0a 2020   [to_remove]..  
+0003f4d0: 2020 2020 2020 2320 4b65 6570 206f 6e6c        # Keep onl
+0003f4e0: 7920 7468 6520 524f 4973 2069 6e20 746f  y the ROIs in to
+0003f4f0: 5f6b 6565 700a 2020 2020 2020 2020 7365  _keep.        se
+0003f500: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
+0003f510: 2020 6966 2074 6f5f 6b65 6570 2069 7320    if to_keep is 
+0003f520: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0003f530: 2020 2020 2020 6b65 6570 203d 205b 5d0a        keep = [].
+0003f540: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003f550: 726f 6920 696e 2073 656c 662e 726f 6973  roi in self.rois
+0003f560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003f570: 2020 6966 2061 6e79 285b 666e 6d61 7463    if any([fnmatc
+0003f580: 682e 666e 6d61 7463 6828 726f 692e 6e61  h.fnmatch(roi.na
+0003f590: 6d65 2e6c 6f77 6572 2829 2c20 6b2e 6c6f  me.lower(), k.lo
+0003f5a0: 7765 7228 2929 200a 2020 2020 2020 2020  wer()) .        
+0003f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f5c0: 666f 7220 6b20 696e 2074 6f5f 6b65 6570  for k in to_keep
+0003f5d0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0003f5e0: 2020 2020 2020 2020 6b65 6570 2e61 7070          keep.app
+0003f5f0: 656e 6428 726f 6929 0a20 2020 2020 2020  end(roi).       
+0003f600: 2020 2020 2073 656c 662e 726f 6973 203d       self.rois =
+0003f610: 206b 6565 700a 0a20 2020 2020 2020 2023   keep..        #
+0003f620: 2052 656d 6f76 6520 7468 6520 524f 4973   Remove the ROIs
+0003f630: 2069 6e20 746f 5f72 656d 6f76 650a 2020   in to_remove.  
+0003f640: 2020 2020 2020 6966 2074 6f5f 7265 6d6f        if to_remo
+0003f650: 7665 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ve is not None:.
+0003f660: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
+0003f670: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0003f680: 2020 666f 7220 726f 6920 696e 2073 656c    for roi in sel
+0003f690: 662e 726f 6973 3a0a 2020 2020 2020 2020  f.rois:.        
+0003f6a0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
+0003f6b0: 6e79 280a 2020 2020 2020 2020 2020 2020  ny(.            
+0003f6c0: 2020 2020 2020 2020 5b66 6e6d 6174 6368          [fnmatch
+0003f6d0: 2e66 6e6d 6174 6368 2872 6f69 2e6e 616d  .fnmatch(roi.nam
+0003f6e0: 652e 6c6f 7765 7228 292c 2072 2e6c 6f77  e.lower(), r.low
+0003f6f0: 6572 2829 2920 0a20 2020 2020 2020 2020  er()) .         
+0003f700: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003f710: 7220 696e 2074 6f5f 7265 6d6f 7665 5d0a  r in to_remove].
+0003f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f730: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0003f740: 2020 2020 2020 206b 6565 702e 6170 7065         keep.appe
+0003f750: 6e64 2872 6f69 290a 2020 2020 2020 2020  nd(roi).        
+0003f760: 2020 2020 7365 6c66 2e72 6f69 7320 3d20      self.rois = 
+0003f770: 6b65 6570 0a0a 2020 2020 6465 6620 7365  keep..    def se
+0003f780: 745f 616c 7068 615f 6265 7461 5f72 6174  t_alpha_beta_rat
+0003f790: 696f 7328 0a20 2020 2020 2020 2020 2020  ios(.           
+0003f7a0: 2073 656c 662c 2061 6c70 6861 5f62 6574   self, alpha_bet
+0003f7b0: 615f 7261 7469 6f73 3d4e 6f6e 652c 2073  a_ratios=None, s
+0003f7c0: 6574 5f61 735f 6465 6661 756c 743d 5472  et_as_default=Tr
+0003f7d0: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
+0003f7e0: 0a20 2020 2020 2020 2053 6574 2072 6174  .        Set rat
+0003f7f0: 696f 7320 666f 7220 524f 4920 7469 7373  ios for ROI tiss
+0003f800: 7565 7320 6f66 2063 6f65 6666 6963 6965  ues of coefficie
+0003f810: 6e74 7320 6f66 206c 696e 6561 722d 7175  nts of linear-qu
+0003f820: 6164 7261 7469 6320 6571 7561 7469 6f6e  adratic equation
+0003f830: 2e0a 0a20 2020 2020 2020 204f 7074 696f  ...        Optio
+0003f840: 6e61 6c6c 7920 696e 7075 7420 7661 6c75  nally input valu
+0003f850: 6573 2066 6f72 2072 6174 696f 7320 6173  es for ratios as
+0003f860: 2073 7472 7563 7475 7265 2d73 6574 2064   structure-set d
+0003f870: 6566 6175 6c74 2e0a 0a20 2020 2020 2020  efault...       
+0003f880: 202a 2a50 6172 616d 6574 6572 3a2a 2a0a   **Parameter:**.
+0003f890: 0a20 2020 2020 2020 2061 6c70 6861 5f62  .        alpha_b
+0003f8a0: 6574 615f 7261 7469 6f73 203a 2064 6963  eta_ratios : dic
+0003f8b0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+0003f8c0: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
+0003f8d0: 696f 6e61 7279 2077 6865 7265 206b 6579  ionary where key
+0003f8e0: 7320 6172 6520 524f 4920 6e61 6d65 7320  s are ROI names 
+0003f8f0: 616e 6420 7661 6c75 6573 2061 7265 0a20  and values are. 
+0003f900: 2020 2020 2020 2020 2020 2072 6174 696f             ratio
+0003f910: 7320 666f 7220 524f 4920 7469 7373 7565  s for ROI tissue
+0003f920: 7320 6f66 2063 6f65 6666 6963 6965 6e74  s of coefficient
+0003f930: 732c 2061 6c70 6861 2c20 6265 7461 2c0a  s, alpha, beta,.
+0003f940: 2020 2020 2020 2020 2020 2020 696e 2074              in t
+0003f950: 6865 206c 696e 6561 722d 7175 6164 7261  he linear-quadra
+0003f960: 7469 6320 6571 7561 7469 6f6e 2e20 2054  tic equation.  T
+0003f970: 6865 7365 2072 6174 696f 7320 6172 650a  hese ratios are.
+0003f980: 2020 2020 2020 2020 2020 2020 7573 6564              used
+0003f990: 2069 6e20 6361 6c63 756c 6174 696e 6720   in calculating 
+0003f9a0: 6269 6f6c 6f67 6963 616c 6c79 2065 6666  biologically eff
+0003f9b0: 6563 7469 7665 2064 6f73 652c 2042 4544  ective dose, BED
+0003f9c0: 2c20 6672 6f6d 0a20 2020 2020 2020 2020  , from.         
+0003f9d0: 2020 2070 6879 7369 6361 6c20 646f 7365     physical dose
+0003f9e0: 2c20 442c 2064 656c 6976 6572 6564 206f  , D, delivered o
+0003f9f0: 7665 7220 6e20 6571 7561 6c20 6672 6163  ver n equal frac
+0003fa00: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+0003fa10: 2020 2020 2020 2042 4544 203d 2044 202a         BED = D *
+0003fa20: 2028 3120 2b20 2844 2f6e 2920 2f20 2861   (1 + (D/n) / (a
+0003fa30: 6c70 6861 2f62 6574 6129 292e 0a20 2020  lpha/beta))..   
+0003fa40: 2020 2020 2020 2020 2054 6865 2061 7474           The att
+0003fa50: 7269 6275 7465 2061 6c70 6861 5f6f 7665  ribute alpha_ove
+0003fa60: 725f 7661 6c75 6520 6973 2073 6574 2074  r_value is set t
+0003fa70: 6f20 7468 6520 6469 6374 696f 6e61 7279  o the dictionary
+0003fa80: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
+0003fa90: 2020 2066 6f72 2061 6e20 524f 4920 6964     for an ROI id
+0003faa0: 656e 7469 6669 6564 2062 7920 6120 6b65  entified by a ke
+0003fab0: 792c 206f 7220 6973 2073 6574 2074 6f20  y, or is set to 
+0003fac0: 4e6f 6e65 2066 6f72 2061 6e79 0a20 2020  None for any.   
+0003fad0: 2020 2020 2020 2020 206f 7468 6572 2052           other R
+0003fae0: 4f49 732e 2020 4966 2074 6869 7320 7061  OIs.  If this pa
+0003faf0: 7261 6d65 7465 7220 6973 2073 6574 2074  rameter is set t
+0003fb00: 6f20 4e6f 6e65 2c20 7661 6c75 6573 2061  o None, values a
+0003fb10: 7265 2073 6574 0a20 2020 2020 2020 2020  re set.         
+0003fb20: 2020 2066 726f 6d20 7365 6c66 2e61 6c70     from self.alp
+0003fb30: 6861 5f62 6574 615f 7261 7469 6f73 2e0a  ha_beta_ratios..
+0003fb40: 0a20 2020 2020 2020 2073 6574 5f61 735f  .        set_as_
+0003fb50: 6465 6661 756c 7420 3a20 626f 6f6c 2c20  default : bool, 
+0003fb60: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
+0003fb70: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+0003fb80: 2c20 616e 6420 616c 7068 615f 6265 7461  , and alpha_beta
+0003fb90: 5f72 6174 696f 7320 6973 6e27 7420 4e6f  _ratios isn't No
+0003fba0: 6e65 2c20 7365 740a 2020 2020 2020 2020  ne, set.        
+0003fbb0: 2020 2020 7365 6c66 2e61 6c70 6861 5f62      self.alpha_b
+0003fbc0: 6574 615f 7261 7469 6f73 2074 6f20 7468  eta_ratios to th
+0003fbd0: 6520 7661 6c75 6520 6f66 2061 6c70 6861  e value of alpha
+0003fbe0: 5f62 6574 615f 7261 7469 6f73 2e0a 2020  _beta_ratios..  
+0003fbf0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0003fc00: 2020 6966 2061 6c70 6861 5f62 6574 615f    if alpha_beta_
+0003fc10: 7261 7469 6f73 2069 7320 4e6f 6e65 3a0a  ratios is None:.
+0003fc20: 2020 2020 2020 2020 2020 2020 616c 7068              alph
+0003fc30: 615f 6265 7461 5f72 6174 696f 7320 3d20  a_beta_ratios = 
+0003fc40: 7365 6c66 2e61 6c70 6861 5f62 6574 615f  self.alpha_beta_
+0003fc50: 7261 7469 6f73 0a20 2020 2020 2020 2065  ratios.        e
+0003fc60: 6c69 6620 7365 745f 6173 5f64 6566 6175  lif set_as_defau
+0003fc70: 6c74 3a0a 2020 2020 2020 2020 2020 2020  lt:.            
+0003fc80: 7365 6c66 2e61 6c70 6861 5f62 6574 615f  self.alpha_beta_
+0003fc90: 7261 7469 6f73 203d 2061 6c70 6861 5f62  ratios = alpha_b
+0003fca0: 6574 615f 7261 7469 6f73 0a0a 2020 2020  eta_ratios..    
+0003fcb0: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
+0003fcc0: 656c 662e 6765 745f 726f 6973 2829 3a0a  elf.get_rois():.
+0003fcd0: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
+0003fce0: 7365 745f 616c 7068 615f 6f76 6572 5f62  set_alpha_over_b
+0003fcf0: 6574 6128 616c 7068 615f 6265 7461 5f72  eta(alpha_beta_r
+0003fd00: 6174 696f 732e 6765 7428 726f 692e 6e61  atios.get(roi.na
+0003fd10: 6d65 2c20 4e6f 6e65 2929 0a0a 2020 2020  me, None))..    
+0003fd20: 6465 6620 6765 745f 616c 7068 615f 6265  def get_alpha_be
+0003fd30: 7461 5f72 6174 696f 7328 7365 6c66 293a  ta_ratios(self):
+0003fd40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0003fd50: 2020 2020 2047 6574 2064 6963 7469 6f6e       Get diction
+0003fd60: 6172 7920 6f66 2072 6174 696f 206f 6620  ary of ratio of 
+0003fd70: 636f 6566 6669 6369 656e 7473 206f 6620  coefficients of 
+0003fd80: 6c69 6e65 6172 2d71 7561 6472 6174 6963  linear-quadratic
+0003fd90: 2065 7175 6174 696f 6e2e 0a20 2020 2020   equation..     
+0003fda0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+0003fdb0: 6574 7572 6e20 7b72 6f69 5f6e 616d 6520  eturn {roi_name 
+0003fdc0: 3a20 7365 6c66 5b72 6f69 5f6e 616d 655d  : self[roi_name]
+0003fdd0: 2e67 6574 5f61 6c70 6861 5f6f 7665 725f  .get_alpha_over_
+0003fde0: 6265 7461 2829 0a20 2020 2020 2020 2020  beta().         
+0003fdf0: 2020 2020 2020 2066 6f72 2072 6f69 5f6e         for roi_n
+0003fe00: 616d 6520 696e 2073 6f72 7465 6428 7365  ame in sorted(se
+0003fe10: 6c66 2e67 6574 5f72 6f69 5f6e 616d 6573  lf.get_roi_names
+0003fe20: 2829 297d 0a0a 2020 2020 6465 6620 6765  ())}..    def ge
+0003fe30: 745f 636f 6c6f 7273 2873 656c 6629 3a0a  t_colors(self):.
+0003fe40: 2020 2020 2020 2020 2222 2247 6574 2064          """Get d
+0003fe50: 6963 7420 6f66 2052 4f49 2063 6f6c 6f72  ict of ROI color
+0003fe60: 7320 666f 7220 6561 6368 206e 616d 652e  s for each name.
+0003fe70: 2222 220a 0a20 2020 2020 2020 2072 6574  """..        ret
+0003fe80: 7572 6e20 7b72 6f69 2e6e 616d 653a 2072  urn {roi.name: r
+0003fe90: 6f69 2e63 6f6c 6f72 2066 6f72 2072 6f69  oi.color for roi
+0003fea0: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
+0003feb0: 7328 297d 0a0a 2020 2020 6465 6620 7265  s()}..    def re
+0003fec0: 636f 6c6f 725f 726f 6973 2873 656c 662c  color_rois(self,
+0003fed0: 2063 6f6c 6f72 7329 3a0a 2020 2020 2020   colors):.      
+0003fee0: 2020 2222 2253 6574 2063 6f6c 6f72 7320    """Set colors 
+0003fef0: 6f66 2052 4f49 7320 7573 696e 6720 6120  of ROIs using a 
+0003ff00: 6c69 7374 206f 7220 6469 6374 2067 6976  list or dict giv
+0003ff10: 656e 2069 6e20 3c63 6f6c 6f72 733e 2e0a  en in <colors>..
+0003ff20: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0003ff30: 6574 6572 732a 2a3a 0a0a 2020 2020 2020  eters**:..      
+0003ff40: 2020 636f 6c6f 7273 203a 206c 6973 742f    colors : list/
+0003ff50: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
+0003ff60: 204c 6973 7420 6f72 2064 6963 7420 6f66   List or dict of
+0003ff70: 2063 6f6c 6f72 732e 2049 6620 6120 6469   colors. If a di
+0003ff80: 6374 2c20 7468 6520 6b65 7973 2073 686f  ct, the keys sho
+0003ff90: 756c 6420 6265 2052 4f49 206e 616d 6573  uld be ROI names
+0003ffa0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
+0003ffb0: 7769 6c64 6361 7264 7320 6d61 7463 6869  wildcards matchi
+0003ffc0: 6e67 2052 4f49 206e 616d 6573 2c20 616e  ng ROI names, an
+0003ffd0: 6420 7468 6520 7661 6c75 6573 2073 686f  d the values sho
+0003ffe0: 756c 6420 6265 2064 6573 6972 6564 200a  uld be desired .
+0003fff0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+00040000: 7273 2066 6f72 2052 4f49 7320 6d61 7463  rs for ROIs matc
+00040010: 6869 6e67 2074 6861 7420 6e61 6d65 2e20  hing that name. 
+00040020: 4966 2061 206c 6973 742c 2073 686f 756c  If a list, shoul
+00040030: 6420 636f 6e74 6169 6e0a 2020 2020 2020  d contain.      
+00040040: 2020 2020 2020 636f 6c6f 7273 2077 6869        colors whi
+00040050: 6368 2077 696c 6c20 6265 2061 7070 6c69  ch will be appli
+00040060: 6564 2074 6f20 6c6f 6164 6564 2052 4f49  ed to loaded ROI
+00040070: 7320 696e 206f 7264 6572 2e0a 2020 2020  s in order..    
+00040080: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00040090: 2069 6620 636f 6c6f 7273 2069 7320 4e6f   if colors is No
+000400a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000400b0: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+000400c0: 6966 2069 7369 6e73 7461 6e63 6528 636f  if isinstance(co
+000400d0: 6c6f 7273 2c20 6469 6374 293a 0a20 2020  lors, dict):.   
+000400e0: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
+000400f0: 652c 2063 6f6c 6f72 2069 6e20 636f 6c6f  e, color in colo
+00040100: 7273 2e69 7465 6d73 2829 3a0a 2020 2020  rs.items():.    
+00040110: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00040120: 726f 6920 696e 2073 656c 662e 726f 6973  roi in self.rois
+00040130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00040140: 2020 2020 2020 6966 2066 6e6d 6174 6368        if fnmatch
+00040150: 2e66 6e6d 6174 6368 2872 6f69 2e6e 616d  .fnmatch(roi.nam
+00040160: 652e 6c6f 7765 7228 292c 206e 616d 652e  e.lower(), name.
+00040170: 6c6f 7765 7228 2929 3a0a 2020 2020 2020  lower()):.      
+00040180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040190: 2020 726f 692e 7365 745f 636f 6c6f 7228    roi.set_color(
+000401a0: 636f 6c6f 7229 0a20 2020 2020 2020 2065  color).        e
+000401b0: 6c69 6620 6973 696e 7374 616e 6365 2863  lif isinstance(c
+000401c0: 6f6c 6f72 732c 206c 6973 7429 3a0a 2020  olors, list):.  
+000401d0: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+000401e0: 2063 6f6c 6f72 2069 6e20 656e 756d 6572   color in enumer
+000401f0: 6174 6528 636f 6c6f 7273 293a 0a20 2020  ate(colors):.   
+00040200: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00040210: 6920 3e3d 206c 656e 2873 656c 662e 726f  i >= len(self.ro
+00040220: 6973 293a 0a20 2020 2020 2020 2020 2020  is):.           
+00040230: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00040240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040250: 7365 6c66 2e72 6f69 735b 695d 2e73 6574  self.rois[i].set
+00040260: 5f63 6f6c 6f72 2863 6f6c 6f72 290a 2020  _color(color).  
+00040270: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00040280: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00040290: 7065 4572 726f 7228 223c 636f 6c6f 7273  peError("<colors
+000402a0: 3e20 6d75 7374 2062 6520 6c69 7374 206f  > must be list o
+000402b0: 7220 6469 6374 2e22 290a 0a20 2020 2064  r dict.")..    d
+000402c0: 6566 2061 6464 5f72 6f69 7328 7365 6c66  ef add_rois(self
+000402d0: 2c20 736f 7572 6365 7329 3a0a 2020 2020  , sources):.    
+000402e0: 2020 2020 2222 2241 6464 2061 6464 6974      """Add addit
+000402f0: 696f 6e61 6c20 524f 4973 2066 726f 6d20  ional ROIs from 
+00040300: 736f 7572 6365 2873 292e 2222 220a 0a20  source(s).""".. 
+00040310: 2020 2020 2020 2069 6620 6e6f 7420 736b         if not sk
+00040320: 7274 2e63 6f72 652e 6973 5f6c 6973 7428  rt.core.is_list(
+00040330: 736f 7572 6365 7329 3a0a 2020 2020 2020  sources):.      
+00040340: 2020 2020 2020 736f 7572 6365 7320 3d20        sources = 
+00040350: 5b73 6f75 7263 6573 5d0a 2020 2020 2020  [sources].      
+00040360: 2020 7365 6c66 2e73 6f75 7263 6573 2e65    self.sources.e
+00040370: 7874 656e 6428 736f 7572 6365 7329 0a20  xtend(sources). 
+00040380: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00040390: 2873 6f75 7263 6573 290a 0a20 2020 2064  (sources)..    d
+000403a0: 6566 2061 6464 5f72 6f69 2873 656c 662c  ef add_roi(self,
+000403b0: 2073 6f75 7263 652c 202a 2a6b 7761 7267   source, **kwarg
+000403c0: 7329 3a0a 2020 2020 2020 2020 2222 2241  s):.        """A
+000403d0: 6464 2061 2073 696e 676c 6520 524f 4920  dd a single ROI 
+000403e0: 7769 7468 2020 6f70 7469 6f6e 616c 206b  with  optional k
+000403f0: 7761 7267 732e 2222 220a 0a20 2020 2020  wargs."""..     
+00040400: 2020 2073 656c 662e 736f 7572 6365 732e     self.sources.
+00040410: 6170 7065 6e64 2873 6f75 7263 6529 0a20  append(source). 
+00040420: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00040430: 616e 6365 2873 6f75 7263 652c 2052 4f49  ance(source, ROI
+00040440: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00040450: 6f69 203d 2073 6f75 7263 650a 2020 2020  oi = source.    
+00040460: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00040470: 2020 2020 2020 726f 695f 6b77 6172 6773        roi_kwargs
+00040480: 203d 2073 656c 662e 726f 695f 6b77 6172   = self.roi_kwar
+00040490: 6773 2e63 6f70 7928 290a 2020 2020 2020  gs.copy().      
+000404a0: 2020 2020 2020 726f 695f 6b77 6172 6773        roi_kwargs
+000404b0: 2e75 7064 6174 6528 6b77 6172 6773 290a  .update(kwargs).
+000404c0: 2020 2020 2020 2020 2020 2020 726f 6920              roi 
+000404d0: 3d20 524f 4928 736f 7572 6365 2c20 2a2a  = ROI(source, **
+000404e0: 726f 695f 6b77 6172 6773 290a 2020 2020  roi_kwargs).    
+000404f0: 2020 2020 726f 692e 7374 7275 6374 7572      roi.structur
+00040500: 655f 7365 7420 3d20 7365 6c66 0a20 2020  e_set = self.   
+00040510: 2020 2020 2073 656c 662e 726f 6973 2e61       self.rois.a
+00040520: 7070 656e 6428 726f 6929 0a0a 2020 2020  ppend(roi)..    
+00040530: 6465 6620 636c 6f6e 655f 6174 7472 7328  def clone_attrs(
+00040540: 7365 6c66 2c20 6f62 6a2c 2063 6f70 795f  self, obj, copy_
+00040550: 726f 6973 3d54 7275 652c 2063 6f70 795f  rois=True, copy_
+00040560: 726f 695f 6461 7461 3d54 7275 6529 3a0a  roi_data=True):.
+00040570: 2020 2020 2020 2020 2222 2241 7373 6967          """Assig
+00040580: 6e20 616c 6c20 6174 7472 6962 7574 6573  n all attributes
+00040590: 206f 6620 3c73 656c 663e 2074 6f20 616e   of <self> to an
+000405a0: 6f74 6865 7220 6f62 6a65 6374 2c20 3c6f  other object, <o
+000405b0: 626a 3e2c 2065 6e73 7572 696e 670a 2020  bj>, ensuring.  
+000405c0: 2020 2020 2020 7468 6174 2052 4f49 7320        that ROIs 
+000405d0: 6172 6520 636f 7069 6564 2069 6620 636f  are copied if co
+000405e0: 7079 5f72 6f69 733d 5472 7565 2e22 2222  py_rois=True."""
+000405f0: 0a0a 2020 2020 2020 2020 736b 7274 2e63  ..        skrt.c
+00040600: 6f72 652e 4461 7461 2e63 6c6f 6e65 5f61  ore.Data.clone_a
+00040610: 7474 7273 2873 656c 662c 206f 626a 290a  ttrs(self, obj).
+00040620: 2020 2020 2020 2020 6966 2063 6f70 795f          if copy_
+00040630: 726f 6973 3a0a 2020 2020 2020 2020 2020  rois:.          
+00040640: 2020 6f62 6a2e 726f 6973 203d 205b 5d0a    obj.rois = [].
+00040650: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00040660: 726f 6920 696e 2073 656c 662e 726f 6973  roi in self.rois
+00040670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00040680: 2020 6f62 6a2e 726f 6973 2e61 7070 656e    obj.rois.appen
+00040690: 6428 726f 692e 636c 6f6e 6528 636f 7079  d(roi.clone(copy
+000406a0: 5f64 6174 613d 636f 7079 5f72 6f69 5f64  _data=copy_roi_d
+000406b0: 6174 6129 290a 0a20 2020 2064 6566 2066  ata))..    def f
+000406c0: 696c 7465 7265 645f 636f 7079 280a 2020  iltered_copy(.  
+000406d0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000406e0: 2020 2020 6e61 6d65 733d 4e6f 6e65 2c0a      names=None,.
+000406f0: 2020 2020 2020 2020 6e61 6d65 3d4e 6f6e          name=Non
+00040700: 652c 0a20 2020 2020 2020 2074 6f5f 6b65  e,.        to_ke
+00040710: 6570 3d4e 6f6e 652c 0a20 2020 2020 2020  ep=None,.       
+00040720: 2074 6f5f 7265 6d6f 7665 3d4e 6f6e 652c   to_remove=None,
+00040730: 0a20 2020 2020 2020 206b 6565 705f 7265  .        keep_re
+00040740: 6e61 6d65 645f 6f6e 6c79 3d46 616c 7365  named_only=False
+00040750: 2c0a 2020 2020 2020 2020 636f 7079 5f72  ,.        copy_r
+00040760: 6f69 5f64 6174 613d 5472 7565 0a20 2020  oi_data=True.   
+00040770: 2029 3a0a 2020 2020 2020 2020 2222 2243   ):.        """C
+00040780: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
+00040790: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
+000407a0: 6574 2077 6974 6820 524f 4973 206f 7074  et with ROIs opt
+000407b0: 696f 6e61 6c6c 790a 2020 2020 2020 2020  ionally.        
+000407c0: 7265 6e61 6d65 6420 6f72 2066 696c 7465  renamed or filte
+000407d0: 7265 642e 2052 6574 7572 6e73 2061 206e  red. Returns a n
+000407e0: 6577 2053 7472 7563 7475 7265 5365 7420  ew StructureSet 
+000407f0: 6f62 6a65 6374 2e0a 0a20 2020 2020 2020  object...       
+00040800: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00040810: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00040820: 2020 6e61 6d65 7320 3a20 6469 6374 2c20    names : dict, 
+00040830: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00040840: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
+00040850: 6172 7920 6f66 206e 616d 6573 2066 6f72  ary of names for
+00040860: 2072 656e 616d 696e 6720 524f 4973 2c20   renaming ROIs, 
+00040870: 7768 6572 6520 7468 6520 6b65 7973 2061  where the keys a
+00040880: 7265 206e 6577 200a 2020 2020 2020 2020  re new .        
+00040890: 2020 2020 6e61 6d65 7320 616e 6420 7661      names and va
+000408a0: 6c75 6573 2061 7265 206c 6973 7473 206f  lues are lists o
+000408b0: 6620 706f 7373 6962 6c65 206e 616d 6573  f possible names
+000408c0: 206f 6620 524f 4973 2074 6861 7420 7368   of ROIs that sh
+000408d0: 6f75 6c64 0a20 2020 2020 2020 2020 2020  ould.           
+000408e0: 2062 6520 6173 7369 676e 6564 2074 6865   be assigned the
+000408f0: 206e 6577 206e 616d 652e 2054 6865 7365   new name. These
+00040900: 206e 616d 6573 2063 616e 2061 6c73 6f20   names can also 
+00040910: 636f 6e74 6169 6e20 7769 6c64 6361 7264  contain wildcard
+00040920: 730a 2020 2020 2020 2020 2020 2020 7769  s.            wi
+00040930: 7468 2074 6865 2027 2a27 2073 796d 626f  th the '*' symbo
+00040940: 6c2e 0a0a 2020 2020 2020 2020 6e61 6d65  l...        name
+00040950: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
+00040960: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00040970: 204e 616d 6520 666f 7220 7468 6520 7265   Name for the re
+00040980: 7475 726e 6564 2053 7472 7563 7475 7265  turned Structure
+00040990: 5365 742e 0a0a 2020 2020 2020 2020 746f  Set...        to
+000409a0: 5f6b 6565 7020 3a20 6c69 7374 2c20 6465  _keep : list, de
+000409b0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+000409c0: 2020 2020 2020 204c 6973 7420 6f66 206e         List of n
+000409d0: 616d 6573 206f 6620 524f 4973 2074 6f20  ames of ROIs to 
+000409e0: 6b65 6570 2069 6e20 7468 6520 636f 7069  keep in the copi
+000409f0: 6564 2053 7472 7563 7475 7265 5365 743b  ed StructureSet;
+00040a00: 2061 6c6c 200a 2020 2020 2020 2020 2020   all .          
+00040a10: 2020 6f74 6865 7273 2077 696c 6c20 6265    others will be
+00040a20: 2072 656d 6f76 6564 2e20 5468 6573 6520   removed. These 
+00040a30: 6e61 6d65 7320 6361 6e20 616c 736f 2063  names can also c
+00040a40: 6f6e 7461 696e 2077 696c 6463 6172 6473  ontain wildcards
+00040a50: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00040a60: 6820 7468 6520 272a 2720 7379 6d62 6f6c  h the '*' symbol
+00040a70: 2e20 4170 706c 6965 6420 6166 7465 7220  . Applied after 
+00040a80: 7265 6e61 6d69 6e67 2077 6974 6820 3c6e  renaming with <n
+00040a90: 616d 6573 3e2e 0a0a 2020 2020 2020 2020  ames>...        
+00040aa0: 746f 5f72 656d 6f76 6520 3a20 6c69 7374  to_remove : list
+00040ab0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00040ac0: 2020 2020 2020 2020 2020 204c 6973 7420             List 
+00040ad0: 6f66 206e 616d 6573 206f 6620 524f 4973  of names of ROIs
+00040ae0: 2074 6f20 7265 6d6f 7665 2066 726f 6d20   to remove from 
+00040af0: 7468 6520 636f 7069 6564 2053 7472 7563  the copied Struc
+00040b00: 7475 7265 5365 743b 2061 6c6c 200a 2020  tureSet; all .  
+00040b10: 2020 2020 2020 2020 2020 6f74 6865 7273            others
+00040b20: 2077 696c 6c20 6265 2072 656d 6f76 6564   will be removed
+00040b30: 2e20 5468 6573 6520 6e61 6d65 7320 6361  . These names ca
+00040b40: 6e20 616c 736f 2063 6f6e 7461 696e 2077  n also contain w
+00040b50: 696c 6463 6172 6473 0a20 2020 2020 2020  ildcards.       
+00040b60: 2020 2020 2077 6974 6820 7468 6520 272a       with the '*
+00040b70: 2720 7379 6d62 6f6c 2e20 4170 706c 6965  ' symbol. Applie
+00040b80: 6420 6166 7465 7220 7265 6e61 6d69 6e67  d after renaming
+00040b90: 2077 6974 6820 3c6e 616d 6573 3e20 616e   with <names> an
+00040ba0: 6420 0a20 2020 2020 2020 2020 2020 2066  d .            f
+00040bb0: 696c 7465 7269 6e67 2077 6974 6820 3c74  iltering with <t
+00040bc0: 6f5f 6b65 6570 3e2e 0a0a 2020 2020 2020  o_keep>...      
+00040bd0: 2020 6b65 6570 5f72 656e 616d 6564 5f6f    keep_renamed_o
+00040be0: 6e6c 7920 3a20 626f 6f6c 2c20 6465 6661  nly : bool, defa
+00040bf0: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+00040c00: 2020 2020 2020 4966 2054 7275 652c 2061        If True, a
+00040c10: 6e79 2052 4f49 7320 7468 6174 2064 6f20  ny ROIs that do 
+00040c20: 6e6f 7420 6765 7420 7265 6e61 6d65 6420  not get renamed 
+00040c30: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
+00040c40: 6672 6f6d 0a20 2020 2020 2020 2020 2020  from.           
+00040c50: 2074 6865 2053 7472 7563 7475 7265 5365   the StructureSe
+00040c60: 742e 0a0a 2020 2020 2020 2020 636f 7079  t...        copy
+00040c70: 5f72 6f69 5f64 6174 6120 3a20 626f 6f6c  _roi_data : bool
+00040c80: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
+00040c90: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00040ca0: 7565 2c20 7468 6520 524f 4973 2069 6e20  ue, the ROIs in 
+00040cb0: 7468 6520 7265 7475 726e 6564 2053 7472  the returned Str
+00040cc0: 7563 7475 7265 5365 7420 7769 6c6c 2063  uctureSet will c
+00040cd0: 6f6e 7461 696e 0a20 2020 2020 2020 2020  ontain.         
+00040ce0: 2020 2063 6f70 6965 7320 6f66 2074 6865     copies of the
+00040cf0: 2064 6174 6120 6672 6f6d 2074 6865 206f   data from the o
+00040d00: 7269 6769 6e61 6c20 5374 7275 6374 7572  riginal Structur
+00040d10: 6553 6574 2e20 4f74 6865 7277 6973 652c  eSet. Otherwise,
+00040d20: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00040d30: 206e 6577 2052 4f49 7320 7769 6c6c 2063   new ROIs will c
+00040d40: 6f6e 7461 696e 2072 6566 6572 656e 6365  ontain reference
+00040d50: 7320 746f 2074 6865 2073 616d 6520 6461  s to the same da
+00040d60: 7461 2c20 652e 672e 2074 6865 200a 2020  ta, e.g. the .  
+00040d70: 2020 2020 2020 2020 2020 7361 6d65 206e            same n
+00040d80: 756d 7079 206e 6461 7272 6179 206f 626a  umpy ndarray obj
+00040d90: 6563 7420 666f 7220 7468 6520 6d61 736b  ect for the mask
+00040da0: 2f73 616d 6520 6469 6374 2066 6f72 2074  /same dict for t
+00040db0: 6865 2063 6f6e 746f 7572 732e 0a20 2020  he contours..   
+00040dc0: 2020 2020 2020 2020 204f 6e6c 7920 7573           Only us
+00040dd0: 6564 2069 6620 3c63 6f70 795f 726f 6973  ed if <copy_rois
+00040de0: 3e20 6973 2054 7275 650a 2020 2020 2020  > is True.      
+00040df0: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+00040e00: 204c 6f61 6420 5374 7275 6374 7572 6553   Load StructureS
+00040e10: 6574 2c20 6275 7420 7072 6576 656e 7420  et, but prevent 
+00040e20: 6c6f 6164 696e 6720 6f66 2052 4f49 732e  loading of ROIs.
+00040e30: 0a20 2020 2020 2020 2023 204c 6f61 6469  .        # Loadi
+00040e40: 6e67 2052 4f49 7320 6865 7265 2063 6f6e  ng ROIs here con
+00040e50: 7375 6d65 7320 7469 6d65 2061 6e64 206d  sumes time and m
+00040e60: 656d 6f72 7920 6372 6561 7469 6e67 206d  emory creating m
+00040e70: 6173 6b73 0a20 2020 2020 2020 2023 2066  asks.        # f
+00040e80: 6f72 2052 4f49 7320 7468 6174 206d 6179  or ROIs that may
+00040e90: 2062 6520 6469 7363 6172 6465 6420 6166   be discarded af
+00040ea0: 7465 7220 6669 6c74 6572 696e 672e 0a20  ter filtering.. 
+00040eb0: 2020 2020 2020 2072 6f69 5f6c 6f61 6420         roi_load 
+00040ec0: 3d20 7365 6c66 2e72 6f69 5f6b 7761 7267  = self.roi_kwarg
+00040ed0: 732e 6765 7428 226c 6f61 6422 2c20 4e6f  s.get("load", No
+00040ee0: 6e65 290a 2020 2020 2020 2020 7365 6c66  ne).        self
+00040ef0: 2e72 6f69 5f6b 7761 7267 735b 226c 6f61  .roi_kwargs["loa
+00040f00: 6422 5d20 3d20 4661 6c73 650a 2020 2020  d"] = False.    
+00040f10: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
+00040f20: 0a20 2020 2020 2020 2073 7320 3d20 7365  .        ss = se
+00040f30: 6c66 2e63 6c6f 6e65 2863 6f70 795f 726f  lf.clone(copy_ro
+00040f40: 695f 6461 7461 3d63 6f70 795f 726f 695f  i_data=copy_roi_
+00040f50: 6461 7461 290a 2020 2020 2020 2020 6966  data).        if
+00040f60: 206e 616d 6520 6973 206e 6f74 204e 6f6e   name is not Non
+00040f70: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00040f80: 732e 6e61 6d65 203d 206e 616d 650a 2020  s.name = name.  
+00040f90: 2020 2020 2020 7373 2e72 656e 616d 655f        ss.rename_
+00040fa0: 726f 6973 286e 616d 6573 2c20 6b65 6570  rois(names, keep
+00040fb0: 5f72 656e 616d 6564 5f6f 6e6c 793d 6b65  _renamed_only=ke
+00040fc0: 6570 5f72 656e 616d 6564 5f6f 6e6c 7929  ep_renamed_only)
+00040fd0: 0a20 2020 2020 2020 2073 732e 6669 6c74  .        ss.filt
+00040fe0: 6572 5f72 6f69 7328 746f 5f6b 6565 702c  er_rois(to_keep,
+00040ff0: 2074 6f5f 7265 6d6f 7665 290a 0a20 2020   to_remove)..   
+00041000: 2020 2020 2023 2045 6e73 7572 6520 7468       # Ensure th
+00041010: 6174 2073 656c 662e 726f 695f 6b77 6172  at self.roi_kwar
+00041020: 6773 2069 7320 7468 6520 7361 6d65 2061  gs is the same a
+00041030: 7320 6174 2069 6e70 7574 2e0a 2020 2020  s at input..    
+00041040: 2020 2020 6966 2072 6f69 5f6c 6f61 6420      if roi_load 
+00041050: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00041060: 2020 2020 2073 656c 662e 726f 695f 6b77       self.roi_kw
+00041070: 6172 6773 2e70 6f70 2822 6c6f 6164 2229  args.pop("load")
+00041080: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00041090: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000410a0: 726f 695f 6b77 6172 6773 5b22 6c6f 6164  roi_kwargs["load
+000410b0: 225d 203d 2072 6f69 5f6c 6f61 640a 0a20  "] = roi_load.. 
+000410c0: 2020 2020 2020 2072 6574 7572 6e20 7373         return ss
+000410d0: 0a0a 2020 2020 6465 6620 6765 745f 726f  ..    def get_ro
+000410e0: 6973 2873 656c 662c 206e 616d 6573 3d4e  is(self, names=N
+000410f0: 6f6e 652c 2069 676e 6f72 655f 656d 7074  one, ignore_empt
+00041100: 793d 4661 6c73 6529 3a0a 2020 2020 2020  y=False):.      
+00041110: 2020 2222 2247 6574 206c 6973 7420 6f66    """Get list of
+00041120: 2052 4f49 206f 626a 6563 7473 2049 6620   ROI objects If 
+00041130: 3c6e 616d 6573 3e20 6973 2067 6976 656e  <names> is given
+00041140: 2c20 6f6e 6c79 2074 6865 2052 4f49 7320  , only the ROIs 
+00041150: 7769 7468 0a20 2020 2020 2020 2074 686f  with.        tho
+00041160: 7365 206e 616d 6573 2077 696c 6c20 6265  se names will be
+00041170: 2072 6574 7572 6e65 642e 2222 220a 0a20   returned.""".. 
+00041180: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00041190: 2829 0a20 2020 2020 2020 2069 6620 6e61  ().        if na
+000411a0: 6d65 7320 6973 204e 6f6e 653a 0a20 2020  mes is None:.   
+000411b0: 2020 2020 2020 2020 2069 6620 6967 6e6f           if igno
+000411c0: 7265 5f65 6d70 7479 3a0a 2020 2020 2020  re_empty:.      
+000411d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000411e0: 205b 726f 6920 666f 7220 726f 6920 696e   [roi for roi in
+000411f0: 2073 656c 662e 726f 6973 2069 6620 6e6f   self.rois if no
+00041200: 7420 726f 692e 656d 7074 795d 0a20 2020  t roi.empty].   
+00041210: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00041220: 7365 6c66 2e72 6f69 730a 0a20 2020 2020  self.rois..     
+00041230: 2020 2072 6f69 7320 3d20 5b5d 0a20 2020     rois = [].   
+00041240: 2020 2020 2066 6f72 206e 616d 6520 696e       for name in
+00041250: 206e 616d 6573 3a0a 2020 2020 2020 2020   names:.        
+00041260: 2020 2020 726f 6920 3d20 7365 6c66 2e67      roi = self.g
+00041270: 6574 5f72 6f69 286e 616d 6529 0a20 2020  et_roi(name).   
+00041280: 2020 2020 2020 2020 2069 6620 726f 6920           if roi 
+00041290: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000412a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000412b0: 6e6f 7420 6967 6e6f 7265 5f65 6d70 7479  not ignore_empty
+000412c0: 206f 7220 6e6f 7420 726f 692e 656d 7074   or not roi.empt
+000412d0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000412e0: 2020 2020 2020 2072 6f69 732e 6170 7065         rois.appe
+000412f0: 6e64 2872 6f69 290a 2020 2020 2020 2020  nd(roi).        
+00041300: 7265 7475 726e 2072 6f69 730a 0a20 2020  return rois..   
+00041310: 2064 6566 2067 6574 5f72 6f69 735f 7769   def get_rois_wi
+00041320: 6c64 6361 7264 2873 656c 662c 2077 696c  ldcard(self, wil
+00041330: 6463 6172 6429 3a0a 2020 2020 2020 2020  dcard):.        
+00041340: 2222 2252 6574 7572 6e20 6c69 7374 206f  """Return list o
+00041350: 6620 524f 4973 206d 6174 6368 696e 6720  f ROIs matching 
+00041360: 6120 7769 6c64 6361 7264 2065 7870 7265  a wildcard expre
+00041370: 7373 696f 6e2e 2222 220a 0a20 2020 2020  ssion."""..     
+00041380: 2020 2072 6f69 7320 3d20 5b5d 0a20 2020     rois = [].   
+00041390: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
+000413a0: 7365 6c66 2e67 6574 5f72 6f69 7328 293a  self.get_rois():
+000413b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000413c0: 666e 6d61 7463 682e 666e 6d61 7463 6828  fnmatch.fnmatch(
+000413d0: 726f 692e 6e61 6d65 2e6c 6f77 6572 2829  roi.name.lower()
+000413e0: 2c20 7769 6c64 6361 7264 2e6c 6f77 6572  , wildcard.lower
+000413f0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+00041400: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
+00041410: 2872 6f69 290a 2020 2020 2020 2020 7265  (roi).        re
+00041420: 7475 726e 2072 6f69 730a 0a20 2020 2064  turn rois..    d
+00041430: 6566 2067 6574 5f72 6f69 5f6e 616d 6573  ef get_roi_names
+00041440: 2873 656c 662c 206f 7269 6769 6e61 6c3d  (self, original=
+00041450: 4661 6c73 652c 2069 676e 6f72 655f 656d  False, ignore_em
+00041460: 7074 793d 4661 6c73 6529 3a0a 2020 2020  pty=False):.    
+00041470: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00041480: 4765 7420 6c69 7374 206f 6620 6e61 6d65  Get list of name
+00041490: 7320 6f66 2052 4f49 7320 696e 2074 6869  s of ROIs in thi
+000414a0: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
+000414b0: 2049 6620 3c6f 7269 6769 6e61 6c3e 2069   If <original> i
+000414c0: 7320 5472 7565 2c0a 2020 2020 2020 2020  s True,.        
+000414d0: 6765 7420 7468 6520 6f72 6967 696e 616c  get the original
+000414e0: 206e 616d 6573 206f 6620 7468 6520 524f   names of the RO
+000414f0: 4973 2e20 2049 6620 3c69 676e 6f72 655f  Is.  If <ignore_
+00041500: 656d 7074 793e 2069 7320 5472 7565 2c0a  empty> is True,.
+00041510: 2020 2020 2020 2020 6f6d 6974 206e 616d          omit nam
+00041520: 6573 206f 6620 656d 7074 7920 524f 4973  es of empty ROIs
+00041530: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00041540: 2020 2020 2020 2072 6574 7572 6e20 5b73         return [s
+00041550: 2e67 6574 5f6e 616d 6528 6f72 6967 696e  .get_name(origin
+00041560: 616c 2920 666f 7220 7320 696e 2073 656c  al) for s in sel
+00041570: 662e 6765 745f 726f 6973 2829 0a20 2020  f.get_rois().   
+00041580: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00041590: 6e6f 7420 2869 676e 6f72 655f 656d 7074  not (ignore_empt
+000415a0: 7920 616e 6420 732e 656d 7074 7929 5d0a  y and s.empty)].
+000415b0: 0a0a 2020 2020 6465 6620 6765 745f 726f  ..    def get_ro
+000415c0: 695f 6469 6374 2873 656c 6629 3a0a 2020  i_dict(self):.  
+000415d0: 2020 2020 2020 2222 2247 6574 2064 6963        """Get dic
+000415e0: 7420 6f66 2052 4f49 206e 616d 6573 2061  t of ROI names a
+000415f0: 6e64 206f 626a 6563 7473 2e22 2222 0a0a  nd objects."""..
+00041600: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00041610: 732e 6e61 6d65 3a20 7320 666f 7220 7320  s.name: s for s 
+00041620: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
+00041630: 2829 7d0a 0a20 2020 2064 6566 2067 6574  ()}..    def get
+00041640: 5f72 6f69 2873 656c 662c 206e 616d 6529  _roi(self, name)
+00041650: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+00041660: 2061 6e20 524f 4920 7769 7468 2061 2073   an ROI with a s
+00041670: 7065 6369 6669 6320 6e61 6d65 2e22 2222  pecific name."""
+00041680: 0a0a 2020 2020 2020 2020 726f 6973 203d  ..        rois =
+00041690: 2073 656c 662e 6765 745f 726f 695f 6469   self.get_roi_di
+000416a0: 6374 2829 0a20 2020 2020 2020 2069 6620  ct().        if 
+000416b0: 6e61 6d65 206e 6f74 2069 6e20 726f 6973  name not in rois
+000416c0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000416d0: 696e 7428 6622 524f 4920 7b6e 616d 657d  int(f"ROI {name}
+000416e0: 206e 6f74 2066 6f75 6e64 2122 290a 2020   not found!").  
+000416f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00041700: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00041710: 726f 6973 5b6e 616d 655d 0a0a 2020 2020  rois[name]..    
+00041720: 6465 6620 7072 696e 745f 726f 6973 2873  def print_rois(s
+00041730: 656c 6629 3a0a 0a20 2020 2020 2020 2073  elf):..        s
+00041740: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+00041750: 2020 2070 7269 6e74 2822 5c6e 222e 6a6f     print("\n".jo
+00041760: 696e 2873 656c 662e 6765 745f 726f 695f  in(self.get_roi_
+00041770: 6e61 6d65 7328 2929 290a 0a20 2020 2064  names()))..    d
+00041780: 6566 2067 6574 5f6e 616d 6528 7365 6c66  ef get_name(self
+00041790: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
+000417a0: 2020 2020 2020 204c 6f61 6420 7365 6c66         Load self
+000417b0: 2061 6e64 2067 6574 206e 616d 652e 0a20   and get name.. 
+000417c0: 2020 2020 2020 2027 2727 0a0a 2020 2020         '''..    
+000417d0: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
+000417e0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+000417f0: 7365 6c66 2e6e 616d 6529 0a0a 2020 2020  self.name)..    
+00041800: 6465 6620 6765 745f 7472 616e 736c 6174  def get_translat
+00041810: 696f 6e5f 746f 5f61 6c69 676e 280a 2020  ion_to_align(.  
+00041820: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
+00041830: 6f74 6865 722c 207a 5f66 7261 6374 696f  other, z_fractio
+00041840: 6e31 3d4e 6f6e 652c 207a 5f66 7261 6374  n1=None, z_fract
+00041850: 696f 6e32 3d4e 6f6e 6529 3a0a 2020 2020  ion2=None):.    
+00041860: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00041870: 4465 7465 726d 696e 6520 7472 616e 736c  Determine transl
+00041880: 6174 696f 6e20 666f 7220 616c 6967 6e69  ation for aligni
+00041890: 6e67 203c 7365 6c66 3e20 746f 203c 6f74  ng <self> to <ot
+000418a0: 6865 723e 2e0a 0a20 2020 2020 2020 202a  her>...        *
+000418b0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
+000418c0: 2020 2020 2020 2020 6f74 6865 7220 3a20          other : 
+000418d0: 524f 492f 5374 7275 6374 7572 6553 6574  ROI/StructureSet
+000418e0: 2f6c 6973 740a 2020 2020 2020 2020 2020  /list.          
+000418f0: 2020 524f 4920 7769 7468 2077 6869 6368    ROI with which
+00041900: 2061 6c69 676e 6d65 6e74 2069 7320 746f   alignment is to
+00041910: 2062 6520 7065 7266 6f72 6d65 642e 2020   be performed.  
+00041920: 5468 6973 2063 616e 2062 650a 2020 2020  This can be.    
+00041930: 2020 2020 2020 2020 7370 6563 6966 6965          specifie
+00041940: 6420 6469 7265 6374 6c79 2061 7320 6120  d directly as a 
+00041950: 7369 6e67 6c65 2052 4f49 2e20 2041 6c74  single ROI.  Alt
+00041960: 6572 6e61 7469 7665 6c79 2c20 6974 2063  ernatively, it c
+00041970: 616e 0a20 2020 2020 2020 2020 2020 2062  an.            b
+00041980: 6520 6120 5374 7275 6374 7572 6553 6574  e a StructureSet
+00041990: 2c20 6f72 2061 206c 6973 7420 6f72 2052  , or a list or R
+000419a0: 4f49 2f53 7472 7563 7475 7265 5365 7420  OI/StructureSet 
+000419b0: 6f62 6a65 6374 732c 0a20 2020 2020 2020  objects,.       
+000419c0: 2020 2020 2069 6e20 7768 6963 6820 6361       in which ca
+000419d0: 7365 2074 6865 2069 6e64 6976 6964 7561  se the individua
+000419e0: 6c20 524f 4973 2077 696c 6c20 6265 2063  l ROIs will be c
+000419f0: 6f6d 6269 6e65 642e 0a0a 2020 2020 2020  ombined...      
+00041a00: 2020 7a5f 6672 6163 7469 6f6e 3120 3a20    z_fraction1 : 
+00041a10: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00041a20: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00041a30: 506f 7369 7469 6f6e 2061 6c6f 6e67 207a  Position along z
+00041a40: 2061 7869 7320 6f66 2073 6c69 6365 2074   axis of slice t
+00041a50: 6872 6f75 6768 203c 7365 6c66 3e20 6f6e  hrough <self> on
+00041a60: 2077 6869 6368 0a20 2020 2020 2020 2020   which.         
+00041a70: 2020 2074 6f20 616c 6967 6e2e 2020 4966     to align.  If
+00041a80: 204e 6f6e 652c 2061 6c69 676e 6d65 6e74   None, alignment
+00041a90: 2069 7320 746f 2074 6865 2063 656e 7472   is to the centr
+00041aa0: 6f69 6420 6f66 2074 6865 0a20 2020 2020  oid of the.     
+00041ab0: 2020 2020 2020 2077 686f 6c65 2052 4f49         whole ROI
+00041ac0: 2076 6f6c 756d 652e 2020 4f74 6865 7277   volume.  Otherw
+00041ad0: 6973 652c 2061 6c69 676e 6d65 6e74 2069  ise, alignment i
+00041ae0: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
+00041af0: 2020 2020 2063 656e 7472 6f69 6420 6f66       centroid of
+00041b00: 2074 6865 2073 6c69 6365 2061 7420 7468   the slice at th
+00041b10: 6520 7370 6563 6966 6965 6420 6469 7374  e specified dist
+00041b20: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
+00041b30: 2066 726f 6d20 7468 6520 524f 4927 7320   from the ROI's 
+00041b40: 6d6f 7374 2d69 6e66 6572 696f 7220 706f  most-inferior po
+00041b50: 696e 743a 2030 2063 6f72 7265 7370 6f6e  int: 0 correspon
+00041b60: 6473 2074 6f0a 2020 2020 2020 2020 2020  ds to.          
+00041b70: 2020 7468 6520 6d6f 7374 2d69 6e66 6572    the most-infer
+00041b80: 696f 7220 706f 696e 7420 286c 6f77 6573  ior point (lowes
+00041b90: 7420 7a29 3b20 3120 636f 7272 6573 706f  t z); 1 correspo
+00041ba0: 6e64 7320 746f 2074 6865 0a20 2020 2020  nds to the.     
+00041bb0: 2020 2020 2020 206d 6f73 742d 7375 7065         most-supe
+00041bc0: 7269 6f72 2070 6f69 6e74 2028 6869 6768  rior point (high
+00041bd0: 6573 7420 7a29 2e20 2056 616c 7565 7320  est z).  Values 
+00041be0: 666f 7220 7a5f 6672 6163 7469 6f6e 0a20  for z_fraction. 
+00041bf0: 2020 2020 2020 2020 2020 206f 7574 7369             outsi
+00041c00: 6465 2074 6865 2069 6e74 6572 7661 6c20  de the interval 
+00041c10: 5b30 2c20 315d 2072 6573 756c 7420 696e  [0, 1] result in
+00041c20: 2061 2052 756e 7469 6d65 4572 726f 722e   a RuntimeError.
+00041c30: 0a0a 2020 2020 2020 2020 7a5f 6672 6163  ..        z_frac
+00041c40: 7469 6f6e 3220 3a20 666c 6f61 742c 2064  tion2 : float, d
+00041c50: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00041c60: 2020 2020 2020 2020 506f 7369 7469 6f6e          Position
+00041c70: 2061 6c6f 6e67 207a 2061 7869 7320 6f66   along z axis of
+00041c80: 2073 6c69 6365 2074 6872 6f75 6768 203c   slice through <
+00041c90: 6f74 6865 723e 206f 6e20 7768 6963 680a  other> on which.
+00041ca0: 2020 2020 2020 2020 2020 2020 746f 2061              to a
+00041cb0: 6c69 676e 2e20 2049 6620 4e6f 6e65 2c20  lign.  If None, 
+00041cc0: 616c 6967 6e6d 656e 7420 6973 2074 6f20  alignment is to 
+00041cd0: 7468 6520 6365 6e74 726f 6964 206f 6620  the centroid of 
+00041ce0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00041cf0: 7768 6f6c 6520 524f 4920 766f 6c75 6d65  whole ROI volume
+00041d00: 2e20 204f 7468 6572 7769 7365 2c20 616c  .  Otherwise, al
+00041d10: 6967 6e6d 656e 7420 6973 2074 6f20 7468  ignment is to th
+00041d20: 650a 2020 2020 2020 2020 2020 2020 6365  e.            ce
+00041d30: 6e74 726f 6964 206f 6620 7468 6520 736c  ntroid of the sl
+00041d40: 6963 6520 6174 2074 6865 2073 7065 6369  ice at the speci
+00041d50: 6669 6564 2064 6973 7461 6e63 650a 2020  fied distance.  
+00041d60: 2020 2020 2020 2020 2020 6672 6f6d 2074            from t
+00041d70: 6865 2052 4f49 2773 206d 6f73 742d 696e  he ROI's most-in
+00041d80: 6665 7269 6f72 2070 6f69 6e74 3a20 3020  ferior point: 0 
+00041d90: 636f 7272 6573 706f 6e64 7320 746f 0a20  corresponds to. 
+00041da0: 2020 2020 2020 2020 2020 2074 6865 206d             the m
+00041db0: 6f73 742d 696e 6665 7269 6f72 2070 6f69  ost-inferior poi
+00041dc0: 6e74 2028 6c6f 7765 7374 207a 293b 2031  nt (lowest z); 1
+00041dd0: 2063 6f72 7265 7370 6f6e 6473 2074 6f20   corresponds to 
+00041de0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00041df0: 6d6f 7374 2d73 7570 6572 696f 7220 706f  most-superior po
+00041e00: 696e 7420 2868 6967 6865 7374 207a 292e  int (highest z).
+00041e10: 2020 5661 6c75 6573 2066 6f72 207a 5f66    Values for z_f
+00041e20: 7261 6374 696f 6e0a 2020 2020 2020 2020  raction.        
+00041e30: 2020 2020 6f75 7473 6964 6520 7468 6520      outside the 
+00041e40: 696e 7465 7276 616c 205b 302c 2031 5d20  interval [0, 1] 
+00041e50: 7265 7375 6c74 2069 6e20 6120 5275 6e74  result in a Runt
+00041e60: 696d 6545 7272 6f72 2e0a 2020 2020 2020  imeError..      
+00041e70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00041e80: 2020 7265 7475 726e 2067 6574 5f74 7261    return get_tra
+00041e90: 6e73 6c61 7469 6f6e 5f74 6f5f 616c 6967  nslation_to_alig
+00041ea0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00041eb0: 2020 2073 656c 662c 206f 7468 6572 2c20     self, other, 
+00041ec0: 7a5f 6672 6163 7469 6f6e 312c 207a 5f66  z_fraction1, z_f
+00041ed0: 7261 6374 696f 6e32 290a 0a20 2020 2064  raction2)..    d
+00041ee0: 6566 2067 6574 5f63 6f6e 666f 726d 6974  ef get_conformit
+00041ef0: 795f 696e 6465 7828 7365 6c66 2c20 6e61  y_index(self, na
+00041f00: 6d65 733d 4e6f 6e65 2c20 2a2a 6b77 6172  mes=None, **kwar
+00041f10: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+00041f20: 0a20 2020 2020 2020 2047 6574 2063 6f6e  .        Get con
+00041f30: 666f 726d 6974 7920 696e 6465 7820 666f  formity index fo
+00041f40: 7220 524f 4973 206f 6620 7468 6520 5374  r ROIs of the St
+00041f50: 7275 6374 7572 6553 6574 2e0a 0a20 2020  ructureSet...   
+00041f60: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00041f70: 733a 2a2a 0a0a 2020 2020 2020 2020 6e61  s:**..        na
+00041f80: 6d65 7320 3a20 6c69 7374 2c20 6465 6661  mes : list, defa
+00041f90: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00041fa0: 2020 2020 204c 6973 7420 6f66 2073 7472       List of str
+00041fb0: 696e 6773 2063 6f72 7265 7370 6f6e 6469  ings correspondi
+00041fc0: 6e67 2074 6f20 524f 4920 6e61 6d65 732e  ng to ROI names.
+00041fd0: 2020 4966 206e 6f6e 2d6e 756c 6c2c 0a20    If non-null,. 
+00041fe0: 2020 2020 2020 2020 2020 2054 6865 2063             The c
+00041ff0: 6f6e 666f 726d 6974 7920 696e 6465 7820  onformity index 
+00042000: 6973 2063 616c 6375 6c61 7465 6420 7265  is calculated re
+00042010: 6c61 7469 7665 2066 6f72 2074 6865 2052  lative for the R
+00042020: 4f49 730a 2020 2020 2020 2020 2020 2020  OIs.            
+00042030: 7769 7468 2074 6865 206c 6973 7465 6420  with the listed 
+00042040: 6e61 6d65 7320 6f6e 6c79 2e20 204f 7468  names only.  Oth
+00042050: 6572 7769 7365 2c20 7468 6520 636f 6e66  erwise, the conf
+00042060: 6f72 6d69 7479 0a20 2020 2020 2020 2020  ormity.         
+00042070: 2020 2069 6e64 6578 2069 7320 6361 6c63     index is calc
+00042080: 756c 6174 6564 2072 656c 6174 6976 6520  ulated relative 
+00042090: 746f 2061 6c6c 2052 4f49 7320 696e 2074  to all ROIs in t
+000420a0: 6865 2073 7472 7563 7475 7265 0a20 2020  he structure.   
+000420b0: 2020 2020 2020 2020 2073 6574 2e0a 0a20           set... 
+000420c0: 2020 2020 2020 206b 7761 7267 730a 2020         kwargs.  
+000420d0: 2020 2020 2020 2020 2020 4b65 7977 6f72            Keywor
+000420e0: 6420 6172 6775 6d65 6e74 7320 6172 6520  d arguments are 
+000420f0: 7061 7373 6564 2074 6f0a 2020 2020 2020  passed to.      
+00042100: 2020 2020 2020 736b 7274 2e73 7472 7563        skrt.struc
+00042110: 7475 7265 732e 6765 745f 636f 6e66 6f72  tures.get_confor
+00042120: 6d69 7479 5f69 6e64 6578 2829 2e2e 6765  mity_index()..ge
+00042130: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
+00042140: 6365 7328 292e 0a20 2020 2020 2020 2020  ces()..         
+00042150: 2020 2053 6565 2064 6f63 756d 656e 7461     See documenta
+00042160: 7469 6f6e 206f 6620 7468 6973 2066 756e  tion of this fun
+00042170: 6374 696f 6e20 666f 7220 7061 7261 6d65  ction for parame
+00042180: 7465 7220 6465 7461 696c 732e 0a20 2020  ter details..   
+00042190: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000421a0: 2072 6574 7572 6e20 6765 745f 636f 6e66   return get_conf
+000421b0: 6f72 6d69 7479 5f69 6e64 6578 2873 656c  ormity_index(sel
+000421c0: 662e 6765 745f 726f 6973 286e 616d 6573  f.get_rois(names
+000421d0: 292c 202a 2a6b 7761 7267 7329 0a0a 2020  ), **kwargs)..  
+000421e0: 2020 6465 6620 6765 745f 6765 6f6d 6574    def get_geomet
+000421f0: 7279 280a 2020 2020 2020 2020 7365 6c66  ry(.        self
+00042200: 2c20 0a20 2020 2020 2020 206e 616d 655f  , .        name_
+00042210: 6173 5f69 6e64 6578 3d54 7275 652c 200a  as_index=True, .
+00042220: 2020 2020 2020 2020 6874 6d6c 3d46 616c          html=Fal
+00042230: 7365 2c20 0a20 2020 2020 2020 2063 6f6c  se, .        col
+00042240: 6f72 6564 3d46 616c 7365 2c0a 2020 2020  ored=False,.    
+00042250: 2020 2020 6772 6579 6564 5f6f 7574 3d4e      greyed_out=N
+00042260: 6f6e 652c 0a20 2020 2020 2020 2072 6f69  one,.        roi
+00042270: 5f6b 7761 7267 733d 7b7d 2c0a 2020 2020  _kwargs={},.    
+00042280: 2020 2020 2a2a 6b77 6172 6773 293a 0a20      **kwargs):. 
+00042290: 2020 2020 2020 2022 2222 4765 7420 7061         """Get pa
+000422a0: 6e64 6173 2044 6174 6146 7261 6d65 206f  ndas DataFrame o
+000422b0: 6620 6765 6f6d 6574 7269 6320 7072 6f70  f geometric prop
+000422c0: 6572 7469 6573 2066 6f72 2061 6c6c 2052  erties for all R
+000422d0: 4f49 732e 0a20 2020 2020 2020 2049 6620  OIs..        If 
+000422e0: 6e6f 2073 6c2f 6964 782f 706f 7320 6973  no sl/idx/pos is
+000422f0: 2067 6976 656e 2c20 7468 6520 6365 6e74   given, the cent
+00042300: 7261 6c20 736c 6963 6520 6f66 2065 6163  ral slice of eac
+00042310: 6820 524f 4920 7769 6c6c 2062 6520 7573  h ROI will be us
+00042320: 6564 2e0a 0a20 2020 2020 2020 202a 2a50  ed...        **P
+00042330: 6172 616d 6574 6572 732a 2a3a 0a0a 2020  arameters**:..  
+00042340: 2020 2020 2020 6e61 6d65 5f61 735f 696e        name_as_in
+00042350: 6465 7820 3a20 626f 6f6c 2c20 6465 6661  dex : bool, defa
+00042360: 756c 743d 5472 7565 0a20 2020 2020 2020  ult=True.       
+00042370: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+00042380: 6520 524f 4920 6e61 6d65 7320 7769 6c6c  e ROI names will
+00042390: 2062 6520 7573 6564 2061 7320 726f 7720   be used as row 
+000423a0: 696e 6469 6365 733b 206f 7468 6572 7769  indices; otherwi
+000423b0: 7365 2c20 7468 6579 0a20 2020 2020 2020  se, they.       
+000423c0: 2020 2020 2077 696c 6c20 6265 2067 6976       will be giv
+000423d0: 656e 2074 6865 6972 206f 776e 2063 6f6c  en their own col
+000423e0: 756d 6e2e 0a0a 2020 2020 2020 2020 6874  umn...        ht
+000423f0: 6d6c 203a 2062 6f6f 6c2c 2064 6566 6175  ml : bool, defau
+00042400: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+00042410: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+00042420: 6520 7461 626c 6520 7769 6c6c 2062 6520  e table will be 
+00042430: 636f 6e76 6572 7465 6420 746f 2048 544d  converted to HTM
+00042440: 4c20 7465 7874 2063 6f6c 6f72 2d63 6f64  L text color-cod
+00042450: 6564 2062 6173 6564 0a20 2020 2020 2020  ed based.       
+00042460: 2020 2020 206f 6e20 524f 4920 636f 6c6f       on ROI colo
+00042470: 7273 2e0a 2020 2020 2020 2020 2222 220a  rs..        """.
+00042480: 0a20 2020 2020 2020 2069 6620 6874 6d6c  .        if html
+00042490: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+000424a0: 6d65 5f61 735f 696e 6465 7820 3d20 4661  me_as_index = Fa
+000424b0: 6c73 650a 2020 2020 2020 2020 6966 2067  lse.        if g
+000424c0: 7265 7965 645f 6f75 7420 6973 204e 6f6e  reyed_out is Non
+000424d0: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+000424e0: 7265 7965 645f 6f75 7420 3d20 5b5d 0a0a  reyed_out = []..
+000424f0: 2020 2020 2020 2020 726f 7773 203d 205b          rows = [
+00042500: 5d0a 2020 2020 2020 2020 666f 7220 726f  ].        for ro
+00042510: 6920 696e 2073 656c 662e 6765 745f 726f  i in self.get_ro
+00042520: 6973 2869 676e 6f72 655f 656d 7074 793d  is(ignore_empty=
+00042530: 5472 7565 293a 0a0a 2020 2020 2020 2020  True):..        
+00042540: 2020 2020 2320 4765 7420 4461 7461 4672      # Get DataFr
+00042550: 616d 6520 666f 7220 7468 6973 2052 4f49  ame for this ROI
+00042560: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+00042570: 726f 7720 3d20 726f 692e 6765 745f 6765  row = roi.get_ge
+00042580: 6f6d 6574 7279 286e 616d 655f 6173 5f69  ometry(name_as_i
+00042590: 6e64 6578 3d6e 616d 655f 6173 5f69 6e64  ndex=name_as_ind
+000425a0: 6578 2c20 2a2a 6b77 6172 6773 290a 0a20  ex, **kwargs).. 
+000425b0: 2020 2020 2020 2020 2020 2023 2052 6570             # Rep
+000425c0: 6c61 6365 2061 6c6c 2076 616c 7565 7320  lace all values 
+000425d0: 7769 7468 2022 2d2d 2220 6966 2067 7265  with "--" if gre
+000425e0: 7969 6e67 206f 7574 2074 6869 7320 524f  ying out this RO
+000425f0: 490a 2020 2020 2020 2020 2020 2020 6966  I.            if
+00042600: 2072 6f69 2069 6e20 6772 6579 6564 5f6f   roi in greyed_o
+00042610: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
+00042620: 2020 2020 666f 7220 636f 6c20 696e 2064      for col in d
+00042630: 665f 726f 772e 636f 6c75 6d6e 733a 0a20  f_row.columns:. 
+00042640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042650: 2020 2069 6620 636f 6c20 3d3d 2022 524f     if col == "RO
+00042660: 4922 3a20 0a20 2020 2020 2020 2020 2020  I": .           
+00042670: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00042680: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00042690: 2020 2020 2020 2020 2020 6466 5f72 6f77            df_row
+000426a0: 5b63 6f6c 5d20 3d20 222d 2d22 0a0a 2020  [col] = "--"..  
+000426b0: 2020 2020 2020 2020 2020 2320 5365 7420            # Set 
+000426c0: 524f 4920 6e61 6d65 2074 6f20 6861 7665  ROI name to have
+000426d0: 2063 6f6c 6f72 6564 2062 6163 6b67 726f   colored backgro
+000426e0: 756e 6420 6966 2072 6571 7565 7374 6564  und if requested
+000426f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00042700: 636f 6c6f 7265 643a 0a20 2020 2020 2020  colored:.       
+00042710: 2020 2020 2020 2020 2063 6f6c 6f72 203d           color =
+00042720: 2072 6f69 2e67 6574 5f63 6f6c 6f72 5f66   roi.get_color_f
+00042730: 726f 6d5f 6b77 6172 6773 2872 6f69 5f6b  rom_kwargs(roi_k
+00042740: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
+00042750: 2020 2020 2020 2063 6f6c 5f73 7472 203d         col_str =
+00042760: 2067 6574 5f63 6f6c 6f72 6564 5f72 6f69   get_colored_roi
+00042770: 5f73 7472 696e 6728 0a20 2020 2020 2020  _string(.       
+00042780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042790: 2072 6f69 2c20 6772 6579 3d28 726f 6920   roi, grey=(roi 
+000427a0: 696e 2067 7265 7965 645f 6f75 7429 2c20  in greyed_out), 
+000427b0: 636f 6c6f 723d 636f 6c6f 7229 0a20 2020  color=color).   
+000427c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000427d0: 6e61 6d65 5f61 735f 696e 6465 783a 0a20  name_as_index:. 
+000427e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427f0: 2020 2064 665f 726f 772e 7265 6e61 6d65     df_row.rename
+00042800: 287b 6466 5f72 6f77 2e69 6e64 6578 5b30  ({df_row.index[0
+00042810: 5d3a 2063 6f6c 5f73 7472 7d2c 2069 6e70  ]: col_str}, inp
+00042820: 6c61 6365 3d54 7275 6529 0a20 2020 2020  lace=True).     
+00042830: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00042840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042850: 2020 2020 2064 665f 726f 772e 696c 6f63       df_row.iloc
+00042860: 5b30 2c20 305d 203d 2063 6f6c 5f73 7472  [0, 0] = col_str
+00042870: 0a0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
+00042880: 7773 2e61 7070 656e 6428 6466 5f72 6f77  ws.append(df_row
+00042890: 290a 0a20 2020 2020 2020 2064 6620 3d20  )..        df = 
+000428a0: 7064 2e63 6f6e 6361 7428 726f 7773 290a  pd.concat(rows).
+000428b0: 0a20 2020 2020 2020 2023 2052 6573 6574  .        # Reset
+000428c0: 2069 6e64 6578 2069 6620 6e6f 7420 7573   index if not us
+000428d0: 696e 6720 524f 4920 6e61 6d65 7320 6173  ing ROI names as
+000428e0: 2069 6e64 6578 0a20 2020 2020 2020 2069   index.        i
+000428f0: 6620 6e6f 7420 6e61 6d65 5f61 735f 696e  f not name_as_in
+00042900: 6465 783a 0a20 2020 2020 2020 2020 2020  dex:.           
+00042910: 2064 6620 3d20 6466 2e72 6573 6574 5f69   df = df.reset_i
+00042920: 6e64 6578 2864 726f 703d 5472 7565 290a  ndex(drop=True).
+00042930: 0a20 2020 2020 2020 2023 2043 6f6e 7665  .        # Conve
+00042940: 7274 2074 6f20 4854 4d4c 2069 6620 6e65  rt to HTML if ne
+00042950: 6564 6564 0a20 2020 2020 2020 2069 6620  eded.        if 
+00042960: 6874 6d6c 3a0a 2020 2020 2020 2020 2020  html:.          
+00042970: 2020 7265 7475 726e 2064 665f 746f 5f68    return df_to_h
+00042980: 746d 6c28 6466 290a 2020 2020 2020 2020  tml(df).        
+00042990: 7265 7475 726e 2064 660a 0a20 2020 2064  return df..    d
+000429a0: 6566 2067 6574 5f63 6f6d 7061 7269 736f  ef get_compariso
+000429b0: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
+000429c0: 200a 2020 2020 2020 2020 6f74 6865 723d   .        other=
+000429d0: 4e6f 6e65 2c20 0a20 2020 2020 2020 2063  None, .        c
+000429e0: 6f6d 705f 7479 7065 3d22 6175 746f 222c  omp_type="auto",
+000429f0: 200a 2020 2020 2020 2020 636f 6e73 656e   .        consen
+00042a00: 7375 735f 7479 7065 3d22 6d61 6a6f 7269  sus_type="majori
+00042a10: 7479 222c 200a 2020 2020 2020 2020 2a2a  ty", .        **
+00042a20: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
+00042a30: 2020 2020 2020 2222 2247 6574 2070 616e        """Get pan
+00042a40: 6461 7320 4461 7461 4672 616d 6520 6f66  das DataFrame of
+00042a50: 2063 6f6d 7061 7269 736f 6e20 6d65 7472   comparison metr
+00042a60: 6963 7320 7673 2061 2073 696e 676c 6520  ics vs a single 
+00042a70: 524f 4920 6f72 0a20 2020 2020 2020 2061  ROI or.        a
+00042a80: 6e6f 7468 6572 2053 7472 7563 7475 7265  nother Structure
+00042a90: 5365 742e 0a0a 2020 2020 2020 2020 2a2a  Set...        **
+00042aa0: 5061 7261 6d65 7465 7273 2a2a 3a0a 0a20  Parameters**:.. 
+00042ab0: 2020 2020 2020 206f 7468 6572 203a 2052         other : R
+00042ac0: 4f49 2f53 7472 7563 7475 7265 5365 742c  OI/StructureSet,
+00042ad0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00042ae0: 2020 2020 2020 2020 2020 4f62 6a65 6374            Object
+00042af0: 2074 6f20 636f 6d70 6172 6520 6f77 6e20   to compare own 
+00042b00: 524f 4973 2077 6974 682e 2043 616e 2065  ROIs with. Can e
+00042b10: 6974 6865 7220 6265 2061 2073 696e 676c  ither be a singl
+00042b20: 6520 524f 492c 2077 6869 6368 0a20 2020  e ROI, which.   
+00042b30: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
+00042b40: 2063 6f6d 7061 7265 6420 746f 2065 7665   compared to eve
+00042b50: 7279 2052 4f49 2069 6e20 7468 6973 2073  ry ROI in this s
+00042b60: 7472 7563 7475 7265 2073 6574 2c20 6f72  tructure set, or
+00042b70: 2061 6e6f 7468 6572 0a20 2020 2020 2020   another.       
+00042b80: 2020 2020 2073 7472 7563 7475 7265 2073       structure s
+00042b90: 6574 2e20 4966 204e 6f6e 652c 2061 2063  et. If None, a c
+00042ba0: 6f6d 7061 7269 736f 6e20 7769 6c6c 2062  omparison will b
+00042bb0: 6520 7065 7266 6f72 6d65 6420 6265 7477  e performed betw
+00042bc0: 6565 6e20 7468 6520 0a20 2020 2020 2020  een the .       
+00042bd0: 2020 2020 2052 4f49 7320 6f66 2074 6869       ROIs of thi
+00042be0: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
+00042bf0: 0a0a 2020 2020 2020 2020 636f 6d70 5f74  ..        comp_t
+00042c00: 7970 6520 3a20 7374 722c 2064 6566 6175  ype : str, defau
+00042c10: 6c74 3d22 6175 746f 220a 2020 2020 2020  lt="auto".      
+00042c20: 2020 2020 2020 4d65 7468 6f64 2066 6f72        Method for
+00042c30: 2073 656c 6563 7469 6e67 2077 6869 6368   selecting which
+00042c40: 2052 4f49 7320 7368 6f75 6c64 2062 6520   ROIs should be 
+00042c50: 636f 6d70 6172 6564 2069 6620 6f74 6865  compared if othe
+00042c60: 723d 4e6f 6e65 0a20 2020 2020 2020 2020  r=None.         
+00042c70: 2020 206f 7220 6f74 6865 7220 6973 2061     or other is a
+00042c80: 2053 7472 7563 7475 7265 5365 742e 204f   StructureSet. O
+00042c90: 7074 696f 6e73 2061 7265 3a0a 0a20 2020  ptions are:..   
+00042ca0: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+00042cb0: 616c 6c22 203a 2063 6f6d 7061 7265 2065  all" : compare e
+00042cc0: 7665 7279 2052 4f49 2069 6e20 6f6e 6520  very ROI in one 
+00042cd0: 7374 7275 6374 7572 6520 7365 7420 746f  structure set to
+00042ce0: 2065 7665 7279 2052 4f49 0a20 2020 2020   every ROI.     
+00042cf0: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
+00042d00: 6520 6f74 6865 7220 2872 656d 6f76 696e  e other (removin
+00042d10: 6720 636f 6d70 6172 6973 6f6e 7320 6f66  g comparisons of
+00042d20: 2061 6e20 524f 4920 746f 2069 7473 656c   an ROI to itsel
+00042d30: 6629 2e0a 2020 2020 2020 2020 2020 2020  f)..            
+00042d40: 2020 2020 2d20 2262 795f 6e61 6d65 2220      - "by_name" 
+00042d50: 3a20 636f 6d70 6172 6520 6576 6572 7920  : compare every 
+00042d60: 524f 4920 696e 206f 6e65 2073 7472 7563  ROI in one struc
+00042d70: 7475 7265 2073 6574 0a20 2020 2020 2020  ture set.       
+00042d80: 2020 2020 2020 2020 2074 6f20 6576 6572           to ever
+00042d90: 7920 524f 4920 696e 2074 6865 206f 7468  y ROI in the oth
+00042da0: 6572 2077 6974 6820 7468 6520 7361 6d65  er with the same
+00042db0: 206e 616d 652e 2055 7365 6675 6c20 7768   name. Useful wh
+00042dc0: 656e 0a20 2020 2020 2020 2020 2020 2020  en.             
+00042dd0: 2020 2063 6f6d 7061 7269 6e67 2074 776f     comparing two
+00042de0: 2073 7472 7563 7475 7265 2073 6574 7320   structure sets 
+00042df0: 636f 6e74 6169 6e69 6e67 2052 4f49 7320  containing ROIs 
+00042e00: 7769 7468 2074 6865 2073 616d 650a 2020  with the same.  
+00042e10: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00042e20: 6d65 732e 0a20 2020 2020 2020 2020 2020  mes..           
+00042e30: 2020 2020 202d 2022 636f 6e73 656e 7375       - "consensu
+00042e40: 7322 203a 2069 6620 6f74 6865 723d 4e6f  s" : if other=No
+00042e50: 6e65 2c20 636f 6d70 6172 6520 6561 6368  ne, compare each
+00042e60: 2052 4f49 2069 6e20 7468 6973 200a 2020   ROI in this .  
+00042e70: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00042e80: 7275 6374 7572 6520 7365 7420 746f 2074  ructure set to t
+00042e90: 6865 2063 6f6e 7365 6e73 7573 206f 6620  he consensus of 
+00042ea0: 616c 6c20 6f74 6865 7220 524f 4973 3b20  all other ROIs; 
+00042eb0: 6f74 6865 7277 6973 652c 0a20 2020 2020  otherwise,.     
+00042ec0: 2020 2020 2020 2020 2020 2063 6f6d 7061             compa
+00042ed0: 7265 2065 6163 6820 524f 4920 696e 2074  re each ROI in t
+00042ee0: 6869 7320 7374 7275 6374 7572 6520 7365  his structure se
+00042ef0: 7420 746f 2074 6865 2063 6f6e 7365 6e73  t to the consens
+00042f00: 7573 206f 660a 2020 2020 2020 2020 2020  us of.          
+00042f10: 2020 2020 2020 616c 6c20 524f 4973 2069        all ROIs i
+00042f20: 6e20 7468 6520 6f74 6865 7220 7374 7275  n the other stru
+00042f30: 6374 7572 6520 7365 742e 2043 6f6e 7365  cture set. Conse
+00042f40: 6e73 7573 2074 7970 6520 6973 2073 6574  nsus type is set
+00042f50: 2076 6961 0a20 2020 2020 2020 2020 2020   via.           
+00042f60: 2020 2020 2074 6865 2063 6f6e 7365 6e73       the consens
+00042f70: 7573 5f74 7970 6520 6172 6775 6d65 6e74  us_type argument
+00042f80: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042f90: 2020 2d20 2261 7574 6f22 203a 2069 6620    - "auto" : if 
+00042fa0: 6f74 6865 723d 4e6f 6e65 2c20 7573 6520  other=None, use 
+00042fb0: 2261 6c6c 2220 636f 6d70 6172 6973 6f6e  "all" comparison
+00042fc0: 2e20 4f74 6865 7277 6973 652c 200a 2020  . Otherwise, .  
+00042fd0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00042fe0: 7273 7420 6c6f 6f6b 2066 6f72 2061 6e79  rst look for any
+00042ff0: 2052 4f49 7320 7769 7468 206d 6174 6368   ROIs with match
+00043000: 696e 6720 6e61 6d65 733b 2069 6620 6174  ing names; if at
+00043010: 206c 6561 7374 206f 6e65 200a 2020 2020   least one .    
+00043020: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+00043030: 6869 6e67 2070 6169 7220 6973 2066 6f75  hing pair is fou
+00043040: 6e64 2c20 636f 6d70 6172 6520 7669 6120  nd, compare via 
+00043050: 7468 6520 2262 795f 6e61 6d65 2220 636f  the "by_name" co
+00043060: 6d70 6172 6973 6f6e 200a 2020 2020 2020  mparison .      
+00043070: 2020 2020 2020 2020 2020 7479 7065 2e20            type. 
+00043080: 4966 206e 6f20 6d61 7463 6865 7320 6172  If no matches ar
+00043090: 6520 666f 756e 642c 2063 6f6d 7061 7265  e found, compare
+000430a0: 2076 6961 2074 6865 2022 616c 6c22 2063   via the "all" c
+000430b0: 6f6d 7061 7269 736f 6e20 0a20 2020 2020  omparison .     
+000430c0: 2020 2020 2020 2020 2020 2074 7970 652e             type.
+000430d0: 0a0a 2020 2020 2020 2020 636f 6e73 656e  ..        consen
+000430e0: 7375 735f 7479 7065 203a 2073 7472 2c20  sus_type : str, 
+000430f0: 6465 6661 756c 743d 226d 616a 6f72 6974  default="majorit
+00043100: 7920 766f 7465 220a 2020 2020 2020 2020  y vote".        
+00043110: 2020 2020 4d65 7468 6f64 2066 6f72 2063      Method for c
+00043120: 616c 6375 6c61 7469 6e67 2063 6f6e 7365  alculating conse
+00043130: 6e73 7573 206f 6620 524f 4973 2069 6620  nsus of ROIs if 
+00043140: 7573 696e 6720 7468 6520 2263 6f6e 7365  using the "conse
+00043150: 6e73 7573 220a 2020 2020 2020 2020 2020  nsus".          
+00043160: 2020 636f 6d70 6172 6973 6f6e 2074 7970    comparison typ
+00043170: 652e 204f 7074 696f 6e73 2061 7265 3a0a  e. Options are:.
+00043180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043190: 202d 2022 6d61 6a6f 7269 7479 2220 3a20   - "majority" : 
+000431a0: 7573 6520 6d61 6a6f 7269 7479 2076 6f74  use majority vot
+000431b0: 6520 6f66 2052 4f49 7320 2869 2e65 2e20  e of ROIs (i.e. 
+000431c0: 766f 7865 6c73 2077 6865 7265 0a20 2020  voxels where.   
+000431d0: 2020 2020 2020 2020 2020 2020 2061 7420               at 
+000431e0: 6c65 6173 7420 6861 6c66 206f 6620 7468  least half of th
+000431f0: 6520 524f 4973 2065 7869 7374 292e 0a20  e ROIs exist).. 
+00043200: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00043210: 2022 6f76 6572 6c61 7022 203a 2075 7365   "overlap" : use
+00043220: 206f 7665 726c 6170 206f 6620 524f 4973   overlap of ROIs
+00043230: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00043240: 2020 2d20 2273 756d 2220 3a20 7573 6520    - "sum" : use 
+00043250: 7375 6d20 6f66 2052 4f49 732e 0a20 2020  sum of ROIs..   
+00043260: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+00043270: 7374 6170 6c65 2220 3a20 7573 6520 7468  staple" : use th
+00043280: 6520 5354 4150 4c45 2061 6c67 6f72 6974  e STAPLE algorit
+00043290: 686d 2074 6f20 6361 6c63 756c 6174 6520  hm to calculate 
+000432a0: 636f 6e73 656e 7375 732e 0a0a 2020 2020  consensus...    
+000432b0: 2020 2020 6874 6d6c 203a 2062 6f6f 6c2c      html : bool,
+000432c0: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+000432d0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+000432e0: 7565 2c20 7468 6520 7461 626c 6520 7769  ue, the table wi
+000432f0: 6c6c 2062 6520 636f 6e76 6572 7465 6420  ll be converted 
+00043300: 746f 2048 544d 4c20 7465 7874 2063 6f6c  to HTML text col
+00043310: 6f72 2d63 6f64 6564 2062 6173 6564 0a20  or-coded based. 
+00043320: 2020 2020 2020 2020 2020 206f 6e20 524f             on RO
+00043330: 4920 636f 6c6f 7273 2e0a 0a20 2020 2020  I colors...     
+00043340: 2020 2067 7265 7965 645f 6f75 7420 3a20     greyed_out : 
+00043350: 626f 6f6c 2c20 6465 6661 756c 743d 4e6f  bool, default=No
+00043360: 6e65 0a20 2020 2020 2020 2020 2020 204c  ne.            L
+00043370: 6973 7420 6f66 2052 4f49 7320 7468 6174  ist of ROIs that
+00043380: 2073 686f 756c 6420 6265 2067 7265 7965   should be greye
+00043390: 6420 6f75 7420 2867 6976 656e 2061 2067  d out (given a g
+000433a0: 7265 7920 6261 636b 6772 6f75 6e64 0a20  rey background. 
+000433b0: 2020 2020 2020 2020 2020 2074 6f20 7468             to th
+000433c0: 6569 7220 7465 7874 2920 6966 2072 6574  eir text) if ret
+000433d0: 7572 6e69 6e67 2061 6e20 4854 4d4c 2073  urning an HTML s
+000433e0: 7472 696e 672e 0a0a 2020 2020 2020 2020  tring...        
+000433f0: 602a 2a60 6b77 6172 6773 203a 200a 2020  `**`kwargs : .  
+00043400: 2020 2020 2020 2020 2020 4b65 7977 6f72            Keywor
+00043410: 6420 6172 6773 2074 6f20 7061 7373 2074  d args to pass t
+00043420: 6f20 524f 492e 6765 745f 636f 6d70 6172  o ROI.get_compar
+00043430: 6973 6f6e 2829 2e20 5365 6520 0a20 2020  ison(). See .   
+00043440: 2020 2020 2020 2020 2052 4f49 2e67 6574           ROI.get
+00043450: 5f63 6f6d 7061 7269 736f 6e28 2920 646f  _comparison() do
+00043460: 6375 6d65 6e74 6174 696f 6e20 666f 7220  cumentation for 
+00043470: 6465 7461 696c 732e 0a20 2020 2020 2020  details..       
+00043480: 2022 2222 0a0a 2020 2020 2020 2020 6466   """..        df
+00043490: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+000434a0: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
+000434b0: 6865 722c 2052 4f49 293a 0a20 2020 2020  her, ROI):.     
+000434c0: 2020 2020 2020 2070 6169 7273 203d 205b         pairs = [
+000434d0: 2872 6f69 2c20 6f74 6865 7229 2066 6f72  (roi, other) for
+000434e0: 2072 6f69 2069 6e20 7365 6c66 2e67 6574   roi in self.get
+000434f0: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
+00043500: 7479 3d54 7275 6529 5d0a 2020 2020 2020  ty=True)].      
+00043510: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00043520: 6528 6f74 6865 722c 2053 7472 7563 7475  e(other, Structu
+00043530: 7265 5365 7429 206f 7220 6f74 6865 7220  reSet) or other 
+00043540: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00043550: 2020 2020 2070 6169 7273 203d 2073 656c       pairs = sel
+00043560: 662e 6765 745f 636f 6d70 6172 6973 6f6e  f.get_comparison
+00043570: 5f70 6169 7273 286f 7468 6572 2c20 636f  _pairs(other, co
+00043580: 6d70 5f74 7970 652c 2063 6f6e 7365 6e73  mp_type, consens
+00043590: 7573 5f74 7970 6529 0a20 2020 2020 2020  us_type).       
+000435a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000435b0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+000435c0: 6f72 2822 3c6f 7468 6572 3e20 6d75 7374  or("<other> must
+000435d0: 2062 6520 524f 4920 6f72 2053 7472 7563   be ROI or Struc
+000435e0: 7475 7265 5365 7421 2229 0a0a 2020 2020  tureSet!")..    
+000435f0: 2020 2020 7265 7475 726e 2063 6f6d 7061      return compa
+00043600: 7265 5f72 6f69 5f70 6169 7273 2870 6169  re_roi_pairs(pai
+00043610: 7273 2c20 2a2a 6b77 6172 6773 290a 0a20  rs, **kwargs).. 
+00043620: 2020 2064 6566 2067 6574 5f63 6f6d 7061     def get_compa
+00043630: 7269 736f 6e5f 7061 6972 7328 7365 6c66  rison_pairs(self
+00043640: 2c20 6f74 6865 723d 4e6f 6e65 2c20 636f  , other=None, co
+00043650: 6d70 5f74 7970 653d 2261 7574 6f22 2c20  mp_type="auto", 
+00043660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043670: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00043680: 6e73 656e 7375 735f 7479 7065 3d22 6d61  nsensus_type="ma
+00043690: 6a6f 7269 7479 222c 200a 2020 2020 2020  jority", .      
+000436a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000436b0: 2020 2020 2020 2063 6f6e 7365 6e73 7573         consensus
+000436c0: 5f63 6f6c 6f72 3d22 626c 7565 2229 3a0a  _color="blue"):.
+000436d0: 2020 2020 2020 2020 2222 2247 6574 206c          """Get l
+000436e0: 6973 7420 6f66 2052 4f49 7320 746f 2063  ist of ROIs to c
+000436f0: 6f6d 7061 7265 2077 6974 6820 6f6e 6520  ompare with one 
+00043700: 616e 6f74 6865 722e 2222 220a 0a20 2020  another."""..   
+00043710: 2020 2020 2023 2043 6865 636b 2063 6f6d       # Check com
+00043720: 705f 7479 7065 2069 7320 7661 6c69 640a  p_type is valid.
+00043730: 2020 2020 2020 2020 7661 6c69 645f 636f          valid_co
+00043740: 6d70 5f74 7970 6573 203d 205b 2261 6c6c  mp_types = ["all
+00043750: 222c 2022 6279 5f6e 616d 6522 2c20 2263  ", "by_name", "c
+00043760: 6f6e 7365 6e73 7573 222c 2022 6175 746f  onsensus", "auto
+00043770: 225d 0a20 2020 2020 2020 2069 6620 636f  "].        if co
+00043780: 6d70 5f74 7970 6520 6e6f 7420 696e 2076  mp_type not in v
+00043790: 616c 6964 5f63 6f6d 705f 7479 7065 733a  alid_comp_types:
+000437a0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000437b0: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+000437c0: 556e 7265 636f 676e 6973 6564 2063 6f6d  Unrecognised com
+000437d0: 7061 7269 736f 6e20 7479 7065 207b 636f  parison type {co
+000437e0: 6d70 5f74 7970 657d 2229 0a0a 2020 2020  mp_type}")..    
+000437f0: 2020 2020 2320 436f 6e73 656e 7375 7320      # Consensus 
+00043800: 636f 6d70 6172 6973 6f6e 0a20 2020 2020  comparison.     
+00043810: 2020 2069 6620 636f 6d70 5f74 7970 6520     if comp_type 
+00043820: 3d3d 2022 636f 6e73 656e 7375 7322 3a0a  == "consensus":.
+00043830: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00043840: 2020 2020 2020 2020 2023 2049 6620 636f           # If co
+00043850: 6d70 6172 696e 6720 746f 2061 6e6f 7468  mparing to anoth
+00043860: 6572 2053 7472 7563 7475 7265 5365 742c  er StructureSet,
+00043870: 2074 616b 6520 636f 6e73 656e 7375 7320   take consensus 
+00043880: 6f66 2074 6861 7420 0a20 2020 2020 2020  of that .       
+00043890: 2020 2020 2023 2065 6e74 6972 6520 5374       # entire St
+000438a0: 7275 6374 7572 6553 6574 0a20 2020 2020  ructureSet.     
+000438b0: 2020 2020 2020 2069 6620 6f74 6865 7220         if other 
+000438c0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000438d0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000438e0: 7365 6e73 7573 203d 206f 7468 6572 2e67  sensus = other.g
+000438f0: 6574 5f63 6f6e 7365 6e73 7573 2863 6f6e  et_consensus(con
+00043900: 7365 6e73 7573 5f74 7970 652c 2063 6f6c  sensus_type, col
+00043910: 6f72 3d63 6f6e 7365 6e73 7573 5f63 6f6c  or=consensus_col
+00043920: 6f72 290a 2020 2020 2020 2020 2020 2020  or).            
+00043930: 2020 2020 7265 7475 726e 205b 2872 6f69      return [(roi
+00043940: 2c20 636f 6e73 656e 7375 7329 2066 6f72  , consensus) for
+00043950: 2072 6f69 2069 6e20 7365 6c66 2e67 6574   roi in self.get
+00043960: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
+00043970: 7479 3d54 7275 6529 5d0a 0a20 2020 2020  ty=True)]..     
+00043980: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+00043990: 7365 2c20 636f 6d70 6172 6520 6561 6368  se, compare each
+000439a0: 2052 4f49 2074 6f20 636f 6e73 656e 7375   ROI to consensu
+000439b0: 7320 6f66 206f 7468 6572 730a 2020 2020  s of others.    
+000439c0: 2020 2020 2020 2020 7061 6972 7320 3d20          pairs = 
+000439d0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+000439e0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e67  or roi in self.g
+000439f0: 6574 5f72 6f69 7328 6967 6e6f 7265 5f65  et_rois(ignore_e
+00043a00: 6d70 7479 3d54 7275 6529 3a0a 2020 2020  mpty=True):.    
+00043a10: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+00043a20: 732e 6170 7065 6e64 2828 726f 692c 2073  s.append((roi, s
+00043a30: 656c 662e 6765 745f 636f 6e73 656e 7375  elf.get_consensu
+00043a40: 7328 636f 6e73 656e 7375 735f 7479 7065  s(consensus_type
+00043a50: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00043a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043a80: 2020 2020 2020 2020 2063 6f6c 6f72 3d63           color=c
+00043a90: 6f6e 7365 6e73 7573 5f63 6f6c 6f72 2c0a  onsensus_color,.
+00043aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043ad0: 2020 2020 2020 6578 636c 7564 653d 726f        exclude=ro
+00043ae0: 692e 6e61 6d65 2929 290a 2020 2020 2020  i.name))).      
+00043af0: 2020 2020 2020 7265 7475 726e 2070 6169        return pai
+00043b00: 7273 0a0a 2020 2020 2020 2020 2320 5365  rs..        # Se
+00043b10: 7420 6465 6661 756c 7420 6265 6861 7669  t default behavi
+00043b20: 6f75 7220 746f 2022 616c 6c22 2069 6620  our to "all" if 
+00043b30: 6f74 6865 7220 6973 204e 6f6e 650a 2020  other is None.  
+00043b40: 2020 2020 2020 6966 206f 7468 6572 2069        if other i
+00043b50: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00043b60: 2020 2020 6f74 6865 7220 3d20 7365 6c66      other = self
+00043b70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00043b80: 636f 6d70 5f74 7970 6520 3d3d 2022 6175  comp_type == "au
+00043b90: 746f 223a 0a20 2020 2020 2020 2020 2020  to":.           
+00043ba0: 2020 2020 2063 6f6d 705f 7479 7065 203d       comp_type =
+00043bb0: 2022 616c 6c22 0a0a 2020 2020 2020 2020   "all"..        
+00043bc0: 2320 4368 6563 6b20 666f 7220 524f 4973  # Check for ROIs
+00043bd0: 2077 6974 6820 6d61 7463 6869 6e67 206e   with matching n
+00043be0: 616d 6573 2069 6620 7573 696e 6720 2261  ames if using "a
+00043bf0: 7574 6f22 206f 7220 2262 795f 6e61 6d65  uto" or "by_name
+00043c00: 220a 2020 2020 2020 2020 6d61 7463 6865  ".        matche
+00043c10: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
+00043c20: 6620 636f 6d70 5f74 7970 6520 696e 205b  f comp_type in [
+00043c30: 2261 7574 6f22 2c20 2262 795f 6e61 6d65  "auto", "by_name
+00043c40: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+00043c50: 6d61 7463 6865 7320 3d20 5b0a 2020 2020  matches = [.    
+00043c60: 2020 2020 2020 2020 2020 2020 7320 666f              s fo
+00043c70: 7220 7320 696e 2073 656c 662e 6765 745f  r s in self.get_
+00043c80: 726f 695f 6e61 6d65 7328 6967 6e6f 7265  roi_names(ignore
+00043c90: 5f65 6d70 7479 3d54 7275 6529 0a20 2020  _empty=True).   
+00043ca0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00043cb0: 7320 696e 206f 7468 6572 2e67 6574 5f72  s in other.get_r
+00043cc0: 6f69 5f6e 616d 6573 2869 676e 6f72 655f  oi_names(ignore_
+00043cd0: 656d 7074 793d 5472 7565 290a 2020 2020  empty=True).    
+00043ce0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+00043cf0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00043d00: 286d 6174 6368 6573 2920 6f72 2063 6f6d  (matches) or com
+00043d10: 705f 7479 7065 203d 3d20 2262 795f 6e61  p_type == "by_na
+00043d20: 6d65 223a 0a20 2020 2020 2020 2020 2020  me":.           
+00043d30: 2020 2020 2072 6574 7572 6e20 5b0a 2020       return [.  
+00043d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043d50: 2020 2873 656c 662e 6765 745f 726f 6928    (self.get_roi(
+00043d60: 6e61 6d65 292c 206f 7468 6572 2e67 6574  name), other.get
+00043d70: 5f72 6f69 286e 616d 6529 2920 666f 7220  _roi(name)) for 
+00043d80: 6e61 6d65 2069 6e20 6d61 7463 6865 730a  name in matches.
+00043d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043da0: 5d0a 0a20 2020 2020 2020 2023 204f 7468  ]..        # Oth
+00043db0: 6572 7769 7365 2c20 7061 6972 2065 6163  erwise, pair eac
+00043dc0: 6820 524f 4920 7769 7468 2065 7665 7279  h ROI with every
+00043dd0: 206f 7468 6572 2028 6578 6c63 7564 696e   other (exlcudin
+00043de0: 6720 7061 6972 7320 6f66 2074 6865 2073  g pairs of the s
+00043df0: 616d 650a 2020 2020 2020 2020 2320 524f  ame.        # RO
+00043e00: 4929 0a20 2020 2020 2020 2070 6169 7273  I).        pairs
+00043e10: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00043e20: 7220 726f 6931 2069 6e20 7365 6c66 2e67  r roi1 in self.g
+00043e30: 6574 5f72 6f69 7328 6967 6e6f 7265 5f65  et_rois(ignore_e
+00043e40: 6d70 7479 3d54 7275 6529 3a0a 2020 2020  mpty=True):.    
+00043e50: 2020 2020 2020 2020 666f 7220 726f 6932          for roi2
+00043e60: 2069 6e20 6f74 6865 722e 6765 745f 726f   in other.get_ro
+00043e70: 6973 2869 676e 6f72 655f 656d 7074 793d  is(ignore_empty=
+00043e80: 5472 7565 293a 0a20 2020 2020 2020 2020  True):.         
+00043e90: 2020 2020 2020 2069 6620 726f 6931 2069         if roi1 i
+00043ea0: 7320 6e6f 7420 726f 6932 2061 6e64 2028  s not roi2 and (
+00043eb0: 726f 6932 2c20 726f 6931 2920 6e6f 7420  roi2, roi1) not 
+00043ec0: 696e 2070 6169 7273 3a0a 2020 2020 2020  in pairs:.      
+00043ed0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00043ee0: 6972 732e 6170 7065 6e64 2828 726f 6931  irs.append((roi1
+00043ef0: 2c20 726f 6932 2929 0a0a 2020 2020 2020  , roi2))..      
+00043f00: 2020 7265 7475 726e 2070 6169 7273 0a0a    return pairs..
+00043f10: 2020 2020 6465 6620 6765 745f 6d69 645f      def get_mid_
+00043f20: 6964 7828 7365 6c66 2c20 7669 6577 3d22  idx(self, view="
+00043f30: 782d 7922 293a 0a20 2020 2020 2020 2022  x-y"):.        "
+00043f40: 2222 5265 7475 726e 2074 6865 2061 7272  ""Return the arr
+00043f50: 6179 2069 6e64 6578 206f 6620 7468 6520  ay index of the 
+00043f60: 736c 6963 6520 7468 6174 2063 6f6e 7461  slice that conta
+00043f70: 696e 7320 7468 6520 6d6f 7374 2052 4f49  ins the most ROI
+00043f80: 732e 2222 220a 0a20 2020 2020 2020 2069  s."""..        i
+00043f90: 6e64 6963 6573 203d 205b 5d0a 2020 2020  ndices = [].    
+00043fa0: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
+00043fb0: 656c 662e 6765 745f 726f 6973 2869 676e  elf.get_rois(ign
+00043fc0: 6f72 655f 656d 7074 793d 5472 7565 293a  ore_empty=True):
+00043fd0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+00043fe0: 6963 6573 2e65 7874 656e 6428 726f 692e  ices.extend(roi.
+00043ff0: 6765 745f 696e 6469 6365 7328 7669 6577  get_indices(view
+00044000: 2929 0a20 2020 2020 2020 2076 616c 7565  )).        value
+00044010: 732c 2063 6f75 6e74 7320 3d20 6e70 2e75  s, counts = np.u
+00044020: 6e69 7175 6528 696e 6469 6365 732c 2072  nique(indices, r
+00044030: 6574 7572 6e5f 636f 756e 7473 3d54 7275  eturn_counts=Tru
+00044040: 6529 0a20 2020 2020 2020 2023 7265 7475  e).        #retu
+00044050: 726e 206e 702e 6269 6e63 6f75 6e74 2869  rn np.bincount(i
+00044060: 6e64 6963 6573 292e 6172 676d 6178 2829  ndices).argmax()
+00044070: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00044080: 6e70 2e71 7561 6e74 696c 6528 0a20 2020  np.quantile(.   
+00044090: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000440a0: 7565 735b 636f 756e 7473 203d 3d20 636f  ues[counts == co
+000440b0: 756e 7473 2e6d 6178 2829 5d2c 2030 2e35  unts.max()], 0.5
+000440c0: 2c20 6d65 7468 6f64 3d22 6e65 6172 6573  , method="neares
+000440d0: 7422 290a 0a20 2020 2064 6566 2070 6c6f  t")..    def plo
+000440e0: 745f 636f 6d70 6172 6973 6f6e 7328 0a20  t_comparisons(. 
+000440f0: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
+00044100: 6572 3d4e 6f6e 652c 2063 6f6d 705f 7479  er=None, comp_ty
+00044110: 7065 3d22 6175 746f 222c 206f 7574 6469  pe="auto", outdi
+00044120: 723d 4e6f 6e65 2c20 6c65 6765 6e64 3d54  r=None, legend=T
+00044130: 7275 652c 200a 2020 2020 2020 2020 6e61  rue, .        na
+00044140: 6d65 733d 4e6f 6e65 2c20 6c65 6765 6e64  mes=None, legend
+00044150: 5f62 626f 785f 746f 5f61 6e63 686f 723d  _bbox_to_anchor=
+00044160: 4e6f 6e65 2c20 6c65 6765 6e64 5f6c 6f63  None, legend_loc
+00044170: 3d22 6c6f 7765 7220 6c65 6674 222c 0a20  ="lower left",. 
+00044180: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
+00044190: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+000441a0: 2222 506c 6f74 2063 6f6d 7061 7269 736f  ""Plot compariso
+000441b0: 6e20 7061 6972 732e 2222 220a 0a20 2020  n pairs."""..   
+000441c0: 2020 2020 2069 6620 6f75 7464 6972 2061       if outdir a
+000441d0: 6e64 206e 6f74 206f 732e 7061 7468 2e65  nd not os.path.e
+000441e0: 7869 7374 7328 6f75 7464 6972 293a 0a20  xists(outdir):. 
+000441f0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+00044200: 6b65 6469 7273 286f 7574 6469 7229 0a0a  kedirs(outdir)..
+00044210: 2020 2020 2020 2020 666f 7220 726f 6931          for roi1
+00044220: 2c20 726f 6932 2069 6e20 7365 6c66 2e67  , roi2 in self.g
+00044230: 6574 5f63 6f6d 7061 7269 736f 6e5f 7061  et_comparison_pa
+00044240: 6972 7328 6f74 6865 722c 2063 6f6d 705f  irs(other, comp_
+00044250: 7479 7065 293a 0a0a 2020 2020 2020 2020  type):..        
+00044260: 2020 2020 6f75 746e 616d 6520 3d20 4e6f      outname = No
+00044270: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
+00044280: 6620 6f75 7464 6972 3a0a 2020 2020 2020  f outdir:.      
+00044290: 2020 2020 2020 2020 2020 636f 6d70 5f6e            comp_n
+000442a0: 616d 6520 3d20 726f 6931 2e67 6574 5f63  ame = roi1.get_c
+000442b0: 6f6d 7061 7269 736f 6e5f 6e61 6d65 2872  omparison_name(r
+000442c0: 6f69 322c 2054 7275 6529 0a20 2020 2020  oi2, True).     
+000442d0: 2020 2020 2020 2020 2020 206f 7574 6e61             outna
+000442e0: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
+000442f0: 6e28 6f75 7464 6972 2c20 6622 7b63 6f6d  n(outdir, f"{com
+00044300: 705f 6e61 6d65 7d2e 706e 6722 290a 0a20  p_name}.png").. 
+00044310: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
+00044320: 6d65 7320 6973 204e 6f6e 6520 616e 6420  mes is None and 
+00044330: 726f 6931 2e6e 616d 6520 3d3d 2072 6f69  roi1.name == roi
+00044340: 322e 6e61 6d65 3a0a 2020 2020 2020 2020  2.name:.        
+00044350: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
+00044360: 5b73 656c 662e 6e61 6d65 2c20 6f74 6865  [self.name, othe
+00044370: 722e 6e61 6d65 5d0a 0a20 2020 2020 2020  r.name]..       
+00044380: 2020 2020 2072 6f69 312e 706c 6f74 5f63       roi1.plot_c
+00044390: 6f6d 7061 7269 736f 6e28 0a20 2020 2020  omparison(.     
+000443a0: 2020 2020 2020 2020 2020 2072 6f69 322c             roi2,
+000443b0: 206c 6567 656e 643d 6c65 6765 6e64 2c20   legend=legend, 
+000443c0: 7361 7665 5f61 733d 6f75 746e 616d 652c  save_as=outname,
+000443d0: 206e 616d 6573 3d6e 616d 6573 2c0a 2020   names=names,.  
+000443e0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+000443f0: 6765 6e64 5f62 626f 785f 746f 5f61 6e63  gend_bbox_to_anc
+00044400: 686f 723d 6c65 6765 6e64 5f62 626f 785f  hor=legend_bbox_
+00044410: 746f 5f61 6e63 686f 722c 0a20 2020 2020  to_anchor,.     
+00044420: 2020 2020 2020 2020 2020 206c 6567 656e             legen
+00044430: 645f 6c6f 633d 6c65 6765 6e64 5f6c 6f63  d_loc=legend_loc
+00044440: 2c20 2a2a 6b77 6172 6773 0a20 2020 2020  , **kwargs.     
+00044450: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00044460: 6620 706c 6f74 5f73 7572 6661 6365 5f64  f plot_surface_d
+00044470: 6973 7461 6e63 6573 280a 2020 2020 2020  istances(.      
+00044480: 2020 7365 6c66 2c20 6f74 6865 722c 206f    self, other, o
+00044490: 7574 6469 723d 4e6f 6e65 2c20 7369 676e  utdir=None, sign
+000444a0: 6564 3d46 616c 7365 2c20 636f 6d70 5f74  ed=False, comp_t
+000444b0: 7970 653d 2261 7574 6f22 2c20 2a2a 6b77  ype="auto", **kw
+000444c0: 6172 6773 0a20 2020 2029 3a0a 2020 2020  args.    ):.    
+000444d0: 2020 2020 2222 2250 6c6f 7420 7375 7266      """Plot surf
+000444e0: 6163 6520 6469 7374 616e 6365 7320 666f  ace distances fo
+000444f0: 7220 616c 6c20 524f 4920 7061 6972 732e  r all ROI pairs.
+00044500: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+00044510: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00044520: 7473 286f 7574 6469 7229 3a0a 2020 2020  ts(outdir):.    
+00044530: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
+00044540: 6972 7328 6f75 7464 6972 290a 0a20 2020  irs(outdir)..   
+00044550: 2020 2020 2066 6f72 2072 6f69 312c 2072       for roi1, r
+00044560: 6f69 3220 696e 2073 656c 662e 6765 745f  oi2 in self.get_
+00044570: 636f 6d70 6172 6973 6f6e 5f70 6169 7273  comparison_pairs
+00044580: 286f 7468 6572 2c20 636f 6d70 5f74 7970  (other, comp_typ
+00044590: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000445a0: 636f 6d70 5f6e 616d 6520 3d20 726f 6931  comp_name = roi1
+000445b0: 2e67 6574 5f63 6f6d 7061 7269 736f 6e5f  .get_comparison_
+000445c0: 6e61 6d65 2872 6f69 322c 2054 7275 6529  name(roi2, True)
+000445d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000445e0: 6f75 7464 6972 3a0a 2020 2020 2020 2020  outdir:.        
+000445f0: 2020 2020 2020 2020 6f75 746e 616d 6520          outname 
+00044600: 3d20 6f73 2e70 6174 682e 6a6f 696e 286f  = os.path.join(o
+00044610: 7574 6469 722c 2066 227b 636f 6d70 5f6e  utdir, f"{comp_n
+00044620: 616d 657d 2e70 6e67 2229 0a20 2020 2020  ame}.png").     
+00044630: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00044640: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00044650: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
+00044660: 2020 2020 2020 2020 726f 6931 2e70 6c6f          roi1.plo
+00044670: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
+00044680: 6365 7328 726f 6932 2c20 7369 676e 6564  ces(roi2, signed
+00044690: 3d73 6967 6e65 642c 2073 6176 655f 6173  =signed, save_as
+000446a0: 3d6f 7574 6e61 6d65 2c20 2a2a 6b77 6172  =outname, **kwar
+000446b0: 6773 290a 0a20 2020 2064 6566 2077 7269  gs)..    def wri
+000446c0: 7465 2873 656c 662c 206f 7574 6e61 6d65  te(self, outname
+000446d0: 3d4e 6f6e 652c 206f 7574 6469 723d 222e  =None, outdir=".
+000446e0: 222c 2065 7874 3d4e 6f6e 652c 206f 7665  ", ext=None, ove
+000446f0: 7277 7269 7465 3d46 616c 7365 2c0a 2020  rwrite=False,.  
+00044700: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00044710: 6572 5f73 6f75 7263 653d 4e6f 6e65 2c20  er_source=None, 
+00044720: 7061 7469 656e 745f 6964 3d4e 6f6e 652c  patient_id=None,
+00044730: 2070 6174 6965 6e74 5f70 6f73 6974 696f   patient_positio
+00044740: 6e3d 4e6f 6e65 2c0a 2020 2020 2020 2020  n=None,.        
+00044750: 2020 2020 2020 6d6f 6461 6c69 7479 3d4e        modality=N
+00044760: 6f6e 652c 2072 6f6f 745f 7569 643d 4e6f  one, root_uid=No
+00044770: 6e65 2c20 7665 7262 6f73 653d 5472 7565  ne, verbose=True
+00044780: 2c20 6865 6164 6572 5f65 7874 7261 733d  , header_extras=
+00044790: 7b7d 2c0a 2020 2020 2020 2020 2020 2020  {},.            
+000447a0: 2020 2a2a 6b77 6172 6773 293a 0a20 2020    **kwargs):.   
+000447b0: 2020 2020 2022 2222 5772 6974 6520 746f       """Write to
+000447c0: 2061 2064 6963 6f6d 2053 7472 7563 7475   a dicom Structu
+000447d0: 7265 5365 7420 6669 6c65 206f 7220 6469  reSet file or di
+000447e0: 7265 6374 6f72 7920 6f66 206e 6966 7469  rectory of nifti
+000447f0: 2066 696c 6573 2e22 2222 0a0a 2020 2020   files."""..    
+00044800: 2020 2020 6966 2065 7874 2069 7320 6e6f      if ext is no
+00044810: 7420 4e6f 6e65 2061 6e64 206e 6f74 2065  t None and not e
+00044820: 7874 2e73 7461 7274 7377 6974 6828 222e  xt.startswith(".
+00044830: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00044840: 6578 7420 3d20 6622 2e7b 6578 747d 220a  ext = f".{ext}".
+00044850: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+00044860: 2077 6865 7468 6572 2074 6f20 7772 6974   whether to writ
+00044870: 6520 746f 2064 6963 6f6d 2066 696c 650a  e to dicom file.
+00044880: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00044890: 7461 6e63 6528 6f75 746e 616d 652c 2073  tance(outname, s
+000448a0: 7472 2920 616e 6420 6f75 746e 616d 652e  tr) and outname.
+000448b0: 656e 6473 7769 7468 2822 2e64 636d 2229  endswith(".dcm")
+000448c0: 3a0a 2020 2020 2020 2020 2020 2020 6578  :.            ex
+000448d0: 7420 3d20 222e 6463 6d22 0a0a 2020 2020  t = ".dcm"..    
+000448e0: 2020 2020 6966 2065 7874 203d 3d20 222e      if ext == ".
+000448f0: 6463 6d22 3a0a 2020 2020 2020 2020 2020  dcm":.          
+00044900: 2020 6469 636f 6d5f 7772 6974 6572 203d    dicom_writer =
+00044910: 2044 6963 6f6d 5772 6974 6572 280a 2020   DicomWriter(.  
+00044920: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+00044930: 7464 6972 3d6f 7574 6469 722c 0a20 2020  tdir=outdir,.   
+00044940: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00044950: 613d 7365 6c66 2c0a 2020 2020 2020 2020  a=self,.        
+00044960: 2020 2020 2020 2020 6166 6669 6e65 3d4e          affine=N
+00044970: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00044980: 2020 2020 206f 7665 7277 7269 7465 3d6f       overwrite=o
+00044990: 7665 7277 7269 7465 2c0a 2020 2020 2020  verwrite,.      
+000449a0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+000449b0: 5f73 6f75 7263 653d 6865 6164 6572 5f73  _source=header_s
+000449c0: 6f75 7263 652c 0a20 2020 2020 2020 2020  ource,.         
+000449d0: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
+000449e0: 6f6e 3d4e 6f6e 652c 0a20 2020 2020 2020  on=None,.       
+000449f0: 2020 2020 2020 2020 2070 6174 6965 6e74           patient
+00044a00: 5f69 643d 7061 7469 656e 745f 6964 2c0a  _id=patient_id,.
+00044a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044a20: 7061 7469 656e 745f 706f 7369 7469 6f6e  patient_position
+00044a30: 3d70 6174 6965 6e74 5f70 6f73 6974 696f  =patient_positio
+00044a40: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00044a50: 2020 206d 6f64 616c 6974 793d 2752 5453     modality='RTS
+00044a60: 5452 5543 5427 2c0a 2020 2020 2020 2020  TRUCT',.        
+00044a70: 2020 2020 2020 2020 726f 6f74 5f75 6964          root_uid
+00044a80: 3d72 6f6f 745f 7569 642c 0a20 2020 2020  =root_uid,.     
+00044a90: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00044aa0: 725f 6578 7472 6173 3d68 6561 6465 725f  r_extras=header_
+00044ab0: 6578 7472 6173 2c0a 2020 2020 2020 2020  extras,.        
+00044ac0: 2020 2020 2020 2020 736f 7572 6365 5f74          source_t
+00044ad0: 7970 653d 7479 7065 2873 656c 6629 2e5f  ype=type(self)._
+00044ae0: 5f6e 616d 655f 5f2c 0a20 2020 2020 2020  _name__,.       
+00044af0: 2020 2020 2020 2020 206f 7574 6e61 6d65           outname
+00044b00: 203d 206f 7574 6e61 6d65 2c0a 2020 2020   = outname,.    
+00044b10: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00044b20: 2020 2020 2020 7365 6c66 2e64 6963 6f6d        self.dicom
+00044b30: 5f64 6174 6173 6574 203d 2064 6963 6f6d  _dataset = dicom
+00044b40: 5f77 7269 7465 722e 7772 6974 6528 290a  _writer.write().
+00044b50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00044b60: 7665 7262 6f73 653a 0a20 2020 2020 2020  verbose:.       
+00044b70: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00044b80: 5772 6f74 6520 6469 636f 6d20 6669 6c65  Wrote dicom file
+00044b90: 2074 6f20 6469 7265 6374 6f72 793a 222c   to directory:",
+00044ba0: 206f 7574 6469 7229 0a20 2020 2020 2020   outdir).       
+00044bb0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00044bc0: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
+00044bd0: 2c20 7772 6974 6520 746f 2069 6e64 6976  , write to indiv
+00044be0: 6964 7561 6c20 524f 4920 6669 6c65 730a  idual ROI files.
+00044bf0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00044c00: 732e 7061 7468 2e65 7869 7374 7328 6f75  s.path.exists(ou
+00044c10: 7464 6972 293a 0a20 2020 2020 2020 2020  tdir):.         
+00044c20: 2020 206f 732e 6d61 6b65 6469 7273 286f     os.makedirs(o
+00044c30: 7574 6469 7229 0a20 2020 2020 2020 2065  utdir).        e
+00044c40: 6c69 6620 6f76 6572 7772 6974 653a 0a20  lif overwrite:. 
+00044c50: 2020 2020 2020 2020 2020 2073 6875 7469             shuti
+00044c60: 6c2e 726d 7472 6565 286f 7574 6469 7229  l.rmtree(outdir)
+00044c70: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00044c80: 6d6b 6469 7228 6f75 7464 6972 290a 2020  mkdir(outdir).  
+00044c90: 2020 2020 2020 666f 7220 7320 696e 2073        for s in s
+00044ca0: 656c 662e 6765 745f 726f 6973 2829 3a0a  elf.get_rois():.
+00044cb0: 2020 2020 2020 2020 2020 2020 732e 7772              s.wr
+00044cc0: 6974 6528 6f75 7464 6972 3d6f 7574 6469  ite(outdir=outdi
+00044cd0: 722c 2065 7874 3d65 7874 2c20 7665 7262  r, ext=ext, verb
+00044ce0: 6f73 653d 7665 7262 6f73 652c 202a 2a6b  ose=verbose, **k
+00044cf0: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
+00044d00: 2020 200a 2020 2020 6465 6620 706c 6f74     .    def plot
+00044d10: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00044d20: 2020 2020 2020 2020 7669 6577 3d22 782d          view="x-
+00044d30: 7922 2c0a 2020 2020 2020 2020 706c 6f74  y",.        plot
+00044d40: 5f74 7970 653d 2263 6f6e 746f 7572 222c  _type="contour",
+00044d50: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
+00044d60: 2c0a 2020 2020 2020 2020 6964 783d 4e6f  ,.        idx=No
+00044d70: 6e65 2c0a 2020 2020 2020 2020 706f 733d  ne,.        pos=
+00044d80: 4e6f 6e65 2c0a 2020 2020 2020 2020 6178  None,.        ax
+00044d90: 3d4e 6f6e 652c 0a20 2020 2020 2020 206f  =None,.        o
+00044da0: 7061 6369 7479 3d4e 6f6e 652c 0a20 2020  pacity=None,.   
+00044db0: 2020 2020 206c 696e 6577 6964 7468 3d4e       linewidth=N
+00044dc0: 6f6e 652c 0a20 2020 2020 2020 2069 6e63  one,.        inc
+00044dd0: 6c75 6465 5f69 6d61 6765 3d54 7275 652c  lude_image=True,
+00044de0: 0a20 2020 2020 2020 2063 656e 7472 655f  .        centre_
+00044df0: 6f6e 5f72 6f69 3d4e 6f6e 652c 0a20 2020  on_roi=None,.   
+00044e00: 2020 2020 2073 686f 773d 5472 7565 2c0a       show=True,.
+00044e10: 2020 2020 2020 2020 7361 7665 5f61 733d          save_as=
+00044e20: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c65  None,.        le
+00044e30: 6765 6e64 3d46 616c 7365 2c0a 2020 2020  gend=False,.    
+00044e40: 2020 2020 6c65 6765 6e64 5f62 626f 785f      legend_bbox_
+00044e50: 746f 5f61 6e63 686f 723d 4e6f 6e65 2c0a  to_anchor=None,.
+00044e60: 2020 2020 2020 2020 6c65 6765 6e64 5f6c          legend_l
+00044e70: 6f63 3d22 6c6f 7765 7220 6c65 6674 222c  oc="lower left",
+00044e80: 0a20 2020 2020 2020 2063 6f6e 7365 6e73  .        consens
+00044e90: 7573 5f74 7970 653d 4e6f 6e65 2c0a 2020  us_type=None,.  
+00044ea0: 2020 2020 2020 6578 636c 7564 655f 6672        exclude_fr
+00044eb0: 6f6d 5f63 6f6e 7365 6e73 7573 3d4e 6f6e  om_consensus=Non
+00044ec0: 652c 0a20 2020 2020 2020 2063 6f6e 7365  e,.        conse
+00044ed0: 6e73 7573 5f63 6f6c 6f72 3d22 626c 7565  nsus_color="blue
+00044ee0: 222c 0a20 2020 2020 2020 2063 6f6e 7365  ",.        conse
+00044ef0: 6e73 7573 5f6c 696e 6577 6964 7468 3d4e  nsus_linewidth=N
+00044f00: 6f6e 652c 0a20 2020 2020 2020 2076 6f78  one,.        vox
+00044f10: 656c 5f73 697a 653d 5b31 2c20 315d 2c0a  el_size=[1, 1],.
+00044f20: 2020 2020 2020 2020 6275 6666 6572 3d35          buffer=5
+00044f30: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+00044f40: 6773 2c0a 2020 2020 293a 0a20 2020 2020  gs,.    ):.     
+00044f50: 2020 2022 2222 506c 6f74 2074 6865 2052     """Plot the R
+00044f60: 4f49 7320 696e 2074 6869 7320 7374 7275  OIs in this stru
+00044f70: 6374 7572 6520 7365 742e 0a20 2020 2020  cture set..     
+00044f80: 2020 0a20 2020 2020 2020 2049 6620 636f    .        If co
+00044f90: 6e73 656e 7375 735f 7479 7065 2069 7320  nsensus_type is 
+00044fa0: 7365 7420 746f 2061 6e79 206f 6620 276d  set to any of 'm
+00044fb0: 616a 6f72 6974 7927 2c20 2773 756d 272c  ajority', 'sum',
+00044fc0: 2027 6f76 6572 6c61 7027 2c20 6f72 2027   'overlap', or '
+00044fd0: 7374 6170 6c65 272c 0a20 2020 2020 2020  staple',.       
+00044fe0: 2074 6865 2063 6f6e 656e 7375 7320 636f   the conensus co
+00044ff0: 6e74 6f75 7220 7769 6c6c 2062 6520 706c  ntour will be pl
+00045000: 6f74 7465 6420 7261 7468 6572 2074 6861  otted rather tha
+00045010: 6e20 696e 6469 7669 6475 616c 2052 4f49  n individual ROI
+00045020: 732e 2049 660a 2020 2020 2020 2020 2765  s. If.        'e
+00045030: 7863 6c75 6465 5f66 726f 6d5f 636f 6e73  xclude_from_cons
+00045040: 656e 7375 7327 2069 7320 7365 7420 746f  ensus' is set to
+00045050: 2074 6865 206e 616d 6520 6f66 2061 6e20   the name of an 
+00045060: 524f 492c 2074 6861 7420 524f 4920 7769  ROI, that ROI wi
+00045070: 6c6c 0a20 2020 2020 2020 2062 6520 6578  ll.        be ex
+00045080: 636c 7564 6564 2066 726f 6d20 7468 6520  cluded from the 
+00045090: 636f 6e73 656e 7375 7320 6361 6c63 756c  consensus calcul
+000450a0: 6174 696f 6e20 616e 6420 706c 6f74 7465  ation and plotte
+000450b0: 6420 696e 6469 7669 6475 616c 6c79 2e0a  d individually..
+000450c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000450d0: 2020 2020 696d 6167 655f 7265 6164 7920      image_ready 
+000450e0: 3d20 6b77 6172 6773 2e70 6f70 2822 696d  = kwargs.pop("im
+000450f0: 6167 655f 7265 6164 7922 2c20 4661 6c73  age_ready", Fals
+00045100: 6529 0a20 2020 2020 2020 2069 6620 696d  e).        if im
+00045110: 6167 655f 7265 6164 7920 6f72 2028 696e  age_ready or (in
+00045120: 636c 7564 655f 696d 6167 6520 616e 6420  clude_image and 
+00045130: 7365 6c66 2e69 6d61 6765 293a 0a20 2020  self.image):.   
+00045140: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+00045150: 7265 5f73 6574 203d 2073 656c 660a 2020  re_set = self.  
+00045160: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00045170: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00045180: 655f 7365 7420 3d20 7365 6c66 2e63 6c6f  e_set = self.clo
+00045190: 6e65 2863 6f70 795f 726f 6973 3d54 7275  ne(copy_rois=Tru
+000451a0: 652c 2063 6f70 795f 726f 695f 6461 7461  e, copy_roi_data
+000451b0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+000451c0: 2020 2020 696d 203d 2073 7472 7563 7475      im = structu
+000451d0: 7265 5f73 6574 2e67 6574 5f64 756d 6d79  re_set.get_dummy
+000451e0: 5f69 6d61 6765 280a 2020 2020 2020 2020  _image(.        
+000451f0: 2020 2020 2020 2020 2020 2020 766f 7865              voxe
+00045200: 6c5f 7369 7a65 3d76 6f78 656c 5f73 697a  l_size=voxel_siz
+00045210: 652c 2062 7566 6665 723d 6275 6666 6572  e, buffer=buffer
+00045220: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
+00045230: 7275 6374 7572 655f 7365 742e 7365 745f  ructure_set.set_
+00045240: 696d 6167 6528 696d 290a 2020 2020 2020  image(im).      
+00045250: 2020 2020 2020 666f 7220 726f 6920 696e        for roi in
+00045260: 2073 7472 7563 7475 7265 5f73 6574 2e67   structure_set.g
+00045270: 6574 5f72 6f69 7328 293a 0a20 2020 2020  et_rois():.     
+00045280: 2020 2020 2020 2020 2020 2072 6f69 2e72             roi.r
+00045290: 6573 6574 5f63 6f6e 746f 7572 7328 290a  eset_contours().
+000452a0: 0a20 2020 2020 2020 2066 6f72 2072 6f69  .        for roi
+000452b0: 2069 6e20 7374 7275 6374 7572 655f 7365   in structure_se
+000452c0: 742e 6765 745f 726f 6973 2829 3a0a 2020  t.get_rois():.  
+000452d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000452e0: 692e 6372 6561 7465 5f6d 6173 6b28 290a  i.create_mask().
+000452f0: 0a20 2020 2020 2020 2023 2049 6620 6e6f  .        # If no
+00045300: 2073 6c2f 6964 782f 706f 7320 6769 7665   sl/idx/pos give
+00045310: 6e2c 2075 7365 2074 6865 2073 6c69 6365  n, use the slice
+00045320: 2077 6974 6820 7468 6520 6d6f 7374 2052   with the most R
+00045330: 4f49 730a 2020 2020 2020 2020 6966 2073  OIs.        if s
+00045340: 6c20 6973 204e 6f6e 6520 616e 6420 6964  l is None and id
+00045350: 7820 6973 204e 6f6e 6520 616e 6420 706f  x is None and po
+00045360: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00045370: 2020 2020 2020 2069 6478 203d 2073 7472         idx = str
+00045380: 7563 7475 7265 5f73 6574 2e67 6574 5f6d  ucture_set.get_m
+00045390: 6964 5f69 6478 2876 6965 7729 0a0a 2020  id_idx(view)..  
+000453a0: 2020 2020 2020 2320 456e 7375 7265 2074        # Ensure t
+000453b0: 6861 7420 6c69 6e65 7769 6474 6820 616e  hat linewidth an
+000453c0: 6420 6f70 6163 6974 7920 666f 7220 524f  d opacity for RO
+000453d0: 4920 706c 6f74 7469 6e67 2061 7265 2064  I plotting are d
+000453e0: 6566 696e 6564 2e0a 2020 2020 2020 2020  efined..        
+000453f0: 726f 695f 6b77 6172 6773 203d 207b 7d0a  roi_kwargs = {}.
+00045400: 2020 2020 2020 2020 6966 206f 7061 6369          if opaci
+00045410: 7479 2069 7320 4e6f 6e65 3a0a 2020 2020  ty is None:.    
+00045420: 2020 2020 2020 2020 6f70 6163 6974 7920          opacity 
+00045430: 3d20 302e 3320 6966 2022 6669 6c6c 6564  = 0.3 if "filled
+00045440: 2220 696e 2070 6c6f 745f 7479 7065 2065  " in plot_type e
+00045450: 6c73 6520 310a 2020 2020 2020 2020 726f  lse 1.        ro
+00045460: 695f 6b77 6172 6773 5b22 6f70 6163 6974  i_kwargs["opacit
+00045470: 7922 5d20 3d20 6f70 6163 6974 790a 2020  y"] = opacity.  
+00045480: 2020 2020 2020 6966 206c 696e 6577 6964        if linewid
+00045490: 7468 2069 7320 4e6f 6e65 3a0a 2020 2020  th is None:.    
+000454a0: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
+000454b0: 6820 3d20 6465 6661 756c 7450 6172 616d  h = defaultParam
+000454c0: 735b 226c 696e 6573 2e6c 696e 6577 6964  s["lines.linewid
+000454d0: 7468 225d 5b30 5d0a 2020 2020 2020 2020  th"][0].        
+000454e0: 726f 695f 6b77 6172 6773 5b22 6c69 6e65  roi_kwargs["line
+000454f0: 7769 6474 6822 5d20 3d20 6c69 6e65 7769  width"] = linewi
+00045500: 6474 680a 0a20 2020 2020 2020 2023 2045  dth..        # E
+00045510: 6e73 7572 6520 7468 6174 2074 6974 6c65  nsure that title
+00045520: 2069 7320 7365 7420 746f 2062 6520 6120   is set to be a 
+00045530: 7374 7269 6e67 2e0a 2020 2020 2020 2020  string..        
+00045540: 6966 206b 7761 7267 732e 6765 7428 2274  if kwargs.get("t
+00045550: 6974 6c65 222c 204e 6f6e 6529 2069 7320  itle", None) is 
+00045560: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00045570: 2020 6b77 6172 6773 5b22 7469 746c 6522    kwargs["title"
+00045580: 5d20 3d20 7374 7275 6374 7572 655f 7365  ] = structure_se
+00045590: 742e 6e61 6d65 206f 7220 2222 0a0a 2020  t.name or ""..  
+000455a0: 2020 2020 2020 2320 506c 6f74 2077 6974        # Plot wit
+000455b0: 6820 696d 6167 650a 2020 2020 2020 2020  h image.        
+000455c0: 6966 2069 6e63 6c75 6465 5f69 6d61 6765  if include_image
+000455d0: 2061 6e64 2073 7472 7563 7475 7265 5f73   and structure_s
+000455e0: 6574 2e69 6d61 6765 2069 7320 6e6f 7420  et.image is not 
+000455f0: 4e6f 6e65 3a0a 0a20 2020 2020 2020 2020  None:..         
+00045600: 2020 2072 6f69 5f6b 7761 7267 735b 2269     roi_kwargs["i
+00045610: 6d61 6765 5f72 6561 6479 225d 203d 2054  mage_ready"] = T
+00045620: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00045630: 7374 7275 6374 7572 655f 7365 742e 696d  structure_set.im
+00045640: 6167 652e 706c 6f74 280a 2020 2020 2020  age.plot(.      
+00045650: 2020 2020 2020 2020 2020 7669 6577 2c0a            view,.
+00045660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045670: 736c 3d73 6c2c 200a 2020 2020 2020 2020  sl=sl, .        
+00045680: 2020 2020 2020 2020 6964 783d 6964 782c          idx=idx,
+00045690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000456a0: 2070 6f73 3d70 6f73 2c0a 2020 2020 2020   pos=pos,.      
+000456b0: 2020 2020 2020 2020 2020 726f 6973 3d73            rois=s
+000456c0: 7472 7563 7475 7265 5f73 6574 2c0a 2020  tructure_set,.  
+000456d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000456e0: 695f 706c 6f74 5f74 7970 653d 706c 6f74  i_plot_type=plot
+000456f0: 5f74 7970 652c 0a20 2020 2020 2020 2020  _type,.         
+00045700: 2020 2020 2020 2072 6f69 5f6b 7761 7267         roi_kwarg
+00045710: 733d 726f 695f 6b77 6172 6773 2c0a 2020  s=roi_kwargs,.  
+00045720: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00045730: 6e74 7265 5f6f 6e5f 726f 693d 6365 6e74  ntre_on_roi=cent
+00045740: 7265 5f6f 6e5f 726f 692c 0a20 2020 2020  re_on_roi,.     
+00045750: 2020 2020 2020 2020 2020 2073 686f 773d             show=
+00045760: 7368 6f77 2c0a 2020 2020 2020 2020 2020  show,.          
+00045770: 2020 2020 2020 7361 7665 5f61 733d 7361        save_as=sa
+00045780: 7665 5f61 732c 0a20 2020 2020 2020 2020  ve_as,.         
+00045790: 2020 2020 2020 206c 6567 656e 643d 6c65         legend=le
+000457a0: 6765 6e64 2c0a 2020 2020 2020 2020 2020  gend,.          
+000457b0: 2020 2020 2020 6c65 6765 6e64 5f62 626f        legend_bbo
+000457c0: 785f 746f 5f61 6e63 686f 723d 6c65 6765  x_to_anchor=lege
+000457d0: 6e64 5f62 626f 785f 746f 5f61 6e63 686f  nd_bbox_to_ancho
+000457e0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+000457f0: 2020 206c 6567 656e 645f 6c6f 633d 6c65     legend_loc=le
+00045800: 6765 6e64 5f6c 6f63 2c0a 2020 2020 2020  gend_loc,.      
+00045810: 2020 2020 2020 2020 2020 636f 6e73 656e            consen
+00045820: 7375 735f 7479 7065 3d63 6f6e 7365 6e73  sus_type=consens
+00045830: 7573 5f74 7970 652c 0a20 2020 2020 2020  us_type,.       
+00045840: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00045850: 5f66 726f 6d5f 636f 6e73 656e 7375 733d  _from_consensus=
+00045860: 6578 636c 7564 655f 6672 6f6d 5f63 6f6e  exclude_from_con
+00045870: 7365 6e73 7573 2c0a 2020 2020 2020 2020  sensus,.        
+00045880: 2020 2020 2020 2020 6178 3d61 782c 0a20          ax=ax,. 
+00045890: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+000458a0: 2a6b 7761 7267 730a 2020 2020 2020 2020  *kwargs.        
+000458b0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000458c0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+000458d0: 2020 6b77 6172 6773 5b22 696d 6167 655f    kwargs["image_
+000458e0: 7265 6164 7922 5d20 3d20 5472 7565 0a0a  ready"] = True..
+000458f0: 2020 2020 2020 2020 2320 506c 6f74 2063          # Plot c
+00045900: 6f6e 7365 6e73 7573 0a20 2020 2020 2020  onsensus.       
+00045910: 2072 6f69 5f68 616e 646c 6573 203d 205b   roi_handles = [
+00045920: 5d0a 2020 2020 2020 2020 6966 2063 6f6e  ].        if con
+00045930: 7365 6e73 7573 5f74 7970 6520 6973 206e  sensus_type is n
+00045940: 6f74 204e 6f6e 653a 0a0a 2020 2020 2020  ot None:..      
+00045950: 2020 2020 2020 2320 506c 6f74 2063 6f6e        # Plot con
+00045960: 7365 6e73 7573 2063 6f6e 746f 7572 0a20  sensus contour. 
+00045970: 2020 2020 2020 2020 2020 2063 6f6e 7365             conse
+00045980: 6e73 7573 203d 2073 7472 7563 7475 7265  nsus = structure
+00045990: 5f73 6574 2e67 6574 5f63 6f6e 7365 6e73  _set.get_consens
+000459a0: 7573 280a 2020 2020 2020 2020 2020 2020  us(.            
+000459b0: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
+000459c0: 735f 7479 7065 2c20 0a20 2020 2020 2020  s_type, .       
+000459d0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+000459e0: 6f72 3d63 6f6e 7365 6e73 7573 5f63 6f6c  or=consensus_col
+000459f0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+00045a00: 2020 2020 2020 2020 6578 636c 7564 653d          exclude=
+00045a10: 6578 636c 7564 655f 6672 6f6d 5f63 6f6e  exclude_from_con
+00045a20: 7365 6e73 7573 290a 2020 2020 2020 2020  sensus).        
+00045a30: 2020 2020 636f 6e73 656e 7375 735f 6b77      consensus_kw
+00045a40: 6172 6773 203d 207b 7d20 6966 2065 7863  args = {} if exc
+00045a50: 6c75 6465 5f66 726f 6d5f 636f 6e73 656e  lude_from_consen
+00045a60: 7375 7320 6973 206e 6f74 204e 6f6e 6520  sus is not None 
+00045a70: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00045a80: 2020 2020 2020 656c 7365 206b 7761 7267        else kwarg
+00045a90: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
+00045aa0: 6e73 656e 7375 732e 6372 6561 7465 5f6d  nsensus.create_m
+00045ab0: 6173 6b28 290a 2020 2020 2020 2020 2020  ask().          
+00045ac0: 2020 636f 6e73 656e 7375 732e 696d 6167    consensus.imag
+00045ad0: 6520 3d20 636f 6e73 656e 7375 732e 6d61  e = consensus.ma
+00045ae0: 736b 2e63 6c6f 6e65 2829 0a20 2020 2020  sk.clone().     
+00045af0: 2020 2020 2020 2063 6f6e 7365 6e73 7573         consensus
+00045b00: 5f6b 7761 7267 735b 2269 6d61 6765 5f72  _kwargs["image_r
+00045b10: 6561 6479 225d 203d 2054 7275 650a 2020  eady"] = True.  
+00045b20: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+00045b30: 7365 6e73 7573 5f6c 696e 6577 6964 7468  sensus_linewidth
+00045b40: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00045b50: 2020 2020 2020 2020 2020 636f 6e73 656e            consen
+00045b60: 7375 735f 6c69 6e65 7769 6474 6820 3d20  sus_linewidth = 
+00045b70: 6465 6661 756c 7450 6172 616d 735b 226c  defaultParams["l
+00045b80: 696e 6573 2e6c 696e 6577 6964 7468 225d  ines.linewidth"]
+00045b90: 5b30 5d20 2b20 310a 0a20 2020 2020 2020  [0] + 1..       
+00045ba0: 2020 2020 2063 6f6e 7365 6e73 7573 2e70       consensus.p
+00045bb0: 6c6f 7428 0a20 2020 2020 2020 2020 2020  lot(.           
+00045bc0: 2020 2020 2076 6965 772c 2073 6c3d 736c       view, sl=sl
+00045bd0: 2c20 6964 783d 6964 782c 2070 6f73 3d70  , idx=idx, pos=p
+00045be0: 6f73 2c20 706c 6f74 5f74 7970 653d 706c  os, plot_type=pl
+00045bf0: 6f74 5f74 7970 652c 200a 2020 2020 2020  ot_type, .      
+00045c00: 2020 2020 2020 2020 2020 636f 6c6f 723d            color=
+00045c10: 636f 6e73 656e 7375 735f 636f 6c6f 722c  consensus_color,
+00045c20: 206c 696e 6577 6964 7468 3d63 6f6e 7365   linewidth=conse
+00045c30: 6e73 7573 5f6c 696e 6577 6964 7468 2c20  nsus_linewidth, 
+00045c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045c50: 206f 7061 6369 7479 3d6f 7061 6369 7479   opacity=opacity
+00045c60: 2c20 7368 6f77 3d46 616c 7365 2c20 6178  , show=False, ax
+00045c70: 3d61 782c 202a 2a63 6f6e 7365 6e73 7573  =ax, **consensus
+00045c80: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
+00045c90: 2020 2020 2020 7374 7275 6374 7572 655f        structure_
+00045ca0: 7365 742e 6178 203d 2063 6f6e 7365 6e73  set.ax = consens
+00045cb0: 7573 2e61 780a 2020 2020 2020 2020 2020  us.ax.          
+00045cc0: 2020 7374 7275 6374 7572 655f 7365 742e    structure_set.
+00045cd0: 6669 6720 3d20 636f 6e73 656e 7375 732e  fig = consensus.
+00045ce0: 6669 670a 0a20 2020 2020 2020 2020 2020  fig..           
+00045cf0: 2069 6620 6c65 6765 6e64 3a0a 2020 2020   if legend:.    
+00045d00: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+00045d10: 6861 6e64 6c65 732e 6170 7065 6e64 280a  handles.append(.
+00045d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045d30: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
+00045d40: 732e 6765 745f 7061 7463 6828 706c 6f74  s.get_patch(plot
+00045d50: 5f74 7970 652c 2063 6f6e 7365 6e73 7573  _type, consensus
+00045d60: 5f63 6f6c 6f72 2c20 6f70 6163 6974 792c  _color, opacity,
+00045d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045d80: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+00045d90: 6577 6964 7468 2c20 636f 6e73 656e 7375  ewidth, consensu
+00045da0: 732e 6e61 6d65 2929 0a0a 2020 2020 2020  s.name))..      
+00045db0: 2020 2020 2020 2320 506c 6f74 2065 7863        # Plot exc
+00045dc0: 6c75 6465 6420 524f 4920 6f6e 2074 6f70  luded ROI on top
+00045dd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00045de0: 6578 636c 7564 655f 6672 6f6d 5f63 6f6e  exclude_from_con
+00045df0: 7365 6e73 7573 2069 7320 6e6f 7420 4e6f  sensus is not No
+00045e00: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00045e10: 2020 2020 6b77 6172 6773 5b22 696e 636c      kwargs["incl
+00045e20: 7564 655f 696d 6167 6522 5d20 3d20 4661  ude_image"] = Fa
+00045e30: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00045e40: 2020 2020 6b77 6172 6773 5b22 696d 6167      kwargs["imag
+00045e50: 655f 7265 6164 7922 5d20 3d20 5472 7565  e_ready"] = True
+00045e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045e70: 2065 7863 6c75 6465 6420 3d20 7374 7275   excluded = stru
+00045e80: 6374 7572 655f 7365 742e 6765 745f 726f  cture_set.get_ro
+00045e90: 6928 6578 636c 7564 655f 6672 6f6d 5f63  i(exclude_from_c
+00045ea0: 6f6e 7365 6e73 7573 290a 2020 2020 2020  onsensus).      
+00045eb0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00045ec0: 6564 2e70 6c6f 7428 0a20 2020 2020 2020  ed.plot(.       
+00045ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045ee0: 2076 6965 772c 2073 6c3d 736c 2c20 6964   view, sl=sl, id
+00045ef0: 783d 6964 782c 2070 6f73 3d70 6f73 2c20  x=idx, pos=pos, 
+00045f00: 706c 6f74 5f74 7970 653d 706c 6f74 5f74  plot_type=plot_t
+00045f10: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+00045f20: 2020 2020 2020 2020 2020 2020 206f 7061               opa
+00045f30: 6369 7479 3d6f 7061 6369 7479 2c20 6c69  city=opacity, li
+00045f40: 6e65 7769 6474 683d 6c69 6e65 7769 6474  newidth=linewidt
+00045f50: 682c 2073 686f 773d 4661 6c73 652c 0a20  h, show=False,. 
+00045f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045f70: 2020 2020 2020 2061 783d 7374 7275 6374         ax=struct
+00045f80: 7572 655f 7365 742e 6178 2c20 2a2a 6b77  ure_set.ax, **kw
+00045f90: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
+00045fa0: 2020 2020 2020 6966 206c 6567 656e 643a        if legend:
+00045fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045fc0: 2020 2020 2072 6f69 5f68 616e 646c 6573       roi_handles
+00045fd0: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
+00045fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045ff0: 2065 7863 6c75 6465 642e 6765 745f 7061   excluded.get_pa
+00046000: 7463 6828 706c 6f74 5f74 7970 652c 2065  tch(plot_type, e
+00046010: 7863 6c75 6465 642e 636f 6c6f 722c 206f  xcluded.color, o
+00046020: 7061 6369 7479 2c0a 2020 2020 2020 2020  pacity,.        
+00046030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046040: 2020 2020 6c69 6e65 7769 6474 682c 2065      linewidth, e
+00046050: 7863 6c75 6465 642e 6e61 6d65 2929 0a0a  xcluded.name))..
+00046060: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+00046070: 6973 652c 2070 6c6f 7420 6669 7273 7420  ise, plot first 
+00046080: 524f 4920 616e 6420 6765 7420 6178 6573  ROI and get axes
+00046090: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000460a0: 2020 2020 2020 2020 2020 2069 6620 6365             if ce
+000460b0: 6e74 7265 5f6f 6e5f 726f 6920 6973 206e  ntre_on_roi is n
+000460c0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000460d0: 2020 2020 2020 2020 2063 656e 7472 616c           central
+000460e0: 203d 2073 7472 7563 7475 7265 5f73 6574   = structure_set
+000460f0: 2e67 6574 5f72 6f69 2863 656e 7472 655f  .get_roi(centre_
+00046100: 6f6e 5f72 6f69 290a 2020 2020 2020 2020  on_roi).        
+00046110: 2020 2020 2020 2020 6964 7820 3d20 6365          idx = ce
+00046120: 6e74 7261 6c2e 6765 745f 6d69 645f 6964  ntral.get_mid_id
+00046130: 7828 7669 6577 290a 2020 2020 2020 2020  x(view).        
+00046140: 2020 2020 2020 2020 736c 203d 204e 6f6e          sl = Non
+00046150: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00046160: 2020 706f 7320 3d20 4e6f 6e65 0a20 2020    pos = None.   
+00046170: 2020 2020 2020 2020 2020 2020 2066 6972               fir
+00046180: 7374 5f72 6f69 203d 2063 656e 7472 616c  st_roi = central
+00046190: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000461a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000461b0: 2020 2063 656e 7472 616c 203d 2073 7472     central = str
+000461c0: 7563 7475 7265 5f73 6574 2e67 6574 5f72  ucture_set.get_r
+000461d0: 6f69 7328 6967 6e6f 7265 5f65 6d70 7479  ois(ignore_empty
+000461e0: 3d54 7275 6529 5b30 5d0a 0a20 2020 2020  =True)[0]..     
+000461f0: 2020 2020 2020 2063 656e 7472 616c 2e70         central.p
+00046200: 6c6f 7428 7669 6577 2c20 736c 3d73 6c2c  lot(view, sl=sl,
+00046210: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
+00046220: 732c 2070 6c6f 745f 7479 7065 3d70 6c6f  s, plot_type=plo
+00046230: 745f 7479 7065 2c0a 2020 2020 2020 2020  t_type,.        
+00046240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046250: 206f 7061 6369 7479 3d6f 7061 6369 7479   opacity=opacity
+00046260: 2c20 6c69 6e65 7769 6474 683d 6c69 6e65  , linewidth=line
+00046270: 7769 6474 682c 2073 686f 773d 4661 6c73  width, show=Fals
+00046280: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00046290: 2020 2020 2020 2020 2020 2020 6178 3d61              ax=a
+000462a0: 782c 202a 2a6b 7761 7267 7329 0a0a 2020  x, **kwargs)..  
+000462b0: 2020 2020 2020 2020 2020 7374 7275 6374            struct
+000462c0: 7572 655f 7365 742e 6669 6720 3d20 6365  ure_set.fig = ce
+000462d0: 6e74 7261 6c2e 6669 670a 2020 2020 2020  ntral.fig.      
+000462e0: 2020 2020 2020 7374 7275 6374 7572 655f        structure_
+000462f0: 7365 742e 6178 203d 2063 656e 7472 616c  set.ax = central
+00046300: 2e61 780a 0a20 2020 2020 2020 2020 2020  .ax..           
+00046310: 2069 6620 6c65 6765 6e64 3a0a 2020 2020   if legend:.    
+00046320: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+00046330: 6861 6e64 6c65 732e 6170 7065 6e64 280a  handles.append(.
+00046340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046350: 2020 2020 2020 2020 6365 6e74 7261 6c2e          central.
+00046360: 6765 745f 7061 7463 6828 706c 6f74 5f74  get_patch(plot_t
+00046370: 7970 652c 2063 656e 7472 616c 2e63 6f6c  ype, central.col
+00046380: 6f72 2c20 6f70 6163 6974 792c 0a20 2020  or, opacity,.   
+00046390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000463a0: 2020 2020 2020 2020 206c 696e 6577 6964           linewid
+000463b0: 7468 2c20 6365 6e74 7261 6c2e 6e61 6d65  th, central.name
+000463c0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+000463d0: 2320 506c 6f74 206f 7468 6572 2052 4f49  # Plot other ROI
+000463e0: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
+000463f0: 7220 692c 2072 6f69 2069 6e20 656e 756d  r i, roi in enum
+00046400: 6572 6174 6528 7374 7275 6374 7572 655f  erate(structure_
+00046410: 7365 742e 6765 745f 726f 6973 2869 676e  set.get_rois(ign
+00046420: 6f72 655f 656d 7074 793d 5472 7565 2929  ore_empty=True))
+00046430: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+00046440: 2020 2069 6620 726f 6920 6973 2063 656e     if roi is cen
+00046450: 7472 616c 3a0a 2020 2020 2020 2020 2020  tral:.          
+00046460: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00046470: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+00046480: 2020 2020 706c 6f74 5f6b 7761 7267 7320      plot_kwargs 
+00046490: 3d20 7b7d 2069 6620 6920 3c20 6c65 6e28  = {} if i < len(
+000464a0: 7374 7275 6374 7572 655f 7365 742e 726f  structure_set.ro
+000464b0: 6973 2920 2d20 3120 656c 7365 206b 7761  is) - 1 else kwa
+000464c0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+000464d0: 2020 2020 726f 692e 706c 6f74 2876 6965      roi.plot(vie
+000464e0: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
+000464f0: 782c 2070 6f73 3d70 6f73 2c20 706c 6f74  x, pos=pos, plot
+00046500: 5f74 7970 653d 706c 6f74 5f74 7970 652c  _type=plot_type,
+00046510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046520: 2020 2020 2020 2020 2020 6f70 6163 6974            opacit
+00046530: 793d 6f70 6163 6974 792c 206c 696e 6577  y=opacity, linew
+00046540: 6964 7468 3d6c 696e 6577 6964 7468 2c20  idth=linewidth, 
+00046550: 7368 6f77 3d46 616c 7365 2c0a 2020 2020  show=False,.    
+00046560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046570: 2020 2020 2061 783d 7374 7275 6374 7572       ax=structur
+00046580: 655f 7365 742e 6178 2c20 2a2a 6b77 6172  e_set.ax, **kwar
+00046590: 6773 290a 0a20 2020 2020 2020 2020 2020  gs)..           
+000465a0: 2020 2020 2069 6620 6c65 6765 6e64 3a0a       if legend:.
+000465b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000465c0: 2020 2020 6966 2028 6964 7820 6973 204e      if (idx is N
+000465d0: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+000465e0: 6f6e 6520 616e 6420 736c 2069 7320 4e6f  one and sl is No
+000465f0: 6e65 2920 6f72 205c 0a20 2020 2020 2020  ne) or \.       
+00046600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046610: 726f 692e 6f6e 5f73 6c69 6365 2876 6965  roi.on_slice(vie
+00046620: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
+00046630: 782c 2070 6f73 3d70 6f73 293a 0a20 2020  x, pos=pos):.   
+00046640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046650: 2020 2020 2072 6f69 5f68 616e 646c 6573       roi_handles
+00046660: 2e61 7070 656e 6428 726f 692e 6765 745f  .append(roi.get_
+00046670: 7061 7463 6828 706c 6f74 5f74 7970 652c  patch(plot_type,
+00046680: 2072 6f69 2e63 6f6c 6f72 2c0a 2020 2020   roi.color,.    
+00046690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000466a0: 2020 2020 2020 2020 6f70 6163 6974 792c          opacity,
+000466b0: 206c 696e 6577 6964 7468 2c20 726f 692e   linewidth, roi.
+000466c0: 6e61 6d65 2929 0a0a 2020 2020 2020 2020  name))..        
+000466d0: 2320 4472 6177 206c 6567 656e 640a 2020  # Draw legend.  
+000466e0: 2020 2020 2020 6966 206c 6567 656e 6420        if legend 
+000466f0: 616e 6420 6c65 6e28 726f 695f 6861 6e64  and len(roi_hand
+00046700: 6c65 7329 3a0a 2020 2020 2020 2020 2020  les):.          
+00046710: 2020 7374 7275 6374 7572 655f 7365 742e    structure_set.
+00046720: 6178 2e6c 6567 656e 6428 6861 6e64 6c65  ax.legend(handle
+00046730: 733d 726f 695f 6861 6e64 6c65 732c 0a20  s=roi_handles,. 
+00046740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046750: 2020 2062 626f 785f 746f 5f61 6e63 686f     bbox_to_ancho
+00046760: 723d 6c65 6765 6e64 5f62 626f 785f 746f  r=legend_bbox_to
+00046770: 5f61 6e63 686f 722c 206c 6f63 3d6c 6567  _anchor, loc=leg
+00046780: 656e 645f 6c6f 632c 0a20 2020 2020 2020  end_loc,.       
+00046790: 2020 2020 2020 2020 2020 2020 2066 6163               fac
+000467a0: 6563 6f6c 6f72 3d22 7768 6974 6522 2c20  ecolor="white", 
+000467b0: 6672 616d 6561 6c70 6861 3d31 0a20 2020  framealpha=1.   
+000467c0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000467d0: 2020 2020 2320 4469 7370 6c61 7920 696d      # Display im
+000467e0: 6167 650a 2020 2020 2020 2020 706c 742e  age.        plt.
+000467f0: 7469 6768 745f 6c61 796f 7574 2829 0a20  tight_layout(). 
+00046800: 2020 2020 2020 2069 6620 7368 6f77 3a0a         if show:.
+00046810: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
+00046820: 7368 6f77 2829 0a0a 2020 2020 2020 2020  show()..        
+00046830: 2320 5361 7665 2074 6f20 6669 6c65 0a20  # Save to file. 
+00046840: 2020 2020 2020 2069 6620 7361 7665 5f61         if save_a
+00046850: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+00046860: 7472 7563 7475 7265 5f73 6574 2e66 6967  tructure_set.fig
+00046870: 2e73 6176 6566 6967 2873 6176 655f 6173  .savefig(save_as
+00046880: 290a 2020 2020 2020 2020 2020 2020 706c  ).            pl
+00046890: 742e 636c 6f73 6528 290a 0a20 2020 2064  t.close()..    d
+000468a0: 6566 2070 6c6f 745f 636f 6e73 656e 7375  ef plot_consensu
+000468b0: 7328 7365 6c66 2c20 636f 6e73 656e 7375  s(self, consensu
+000468c0: 735f 7479 7065 2c20 7669 6577 3d22 782d  s_type, view="x-
+000468d0: 7922 2c20 736c 3d4e 6f6e 652c 2069 6478  y", sl=None, idx
+000468e0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+000468f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00046900: 733d 4e6f 6e65 2c20 726f 6973 5f69 6e5f  s=None, rois_in_
+00046910: 6261 636b 6772 6f75 6e64 3d46 616c 7365  background=False
+00046920: 2c20 636f 6c6f 723d 4e6f 6e65 2c20 0a20  , color=None, . 
+00046930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046940: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00046950: 3d5b 312c 2031 5d2c 2062 7566 6665 723d  =[1, 1], buffer=
+00046960: 352c 2069 6e63 6c75 6465 5f69 6d61 6765  5, include_image
+00046970: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00046980: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00046990: 686f 773d 5472 7565 2c20 2a2a 6b77 6172  how=True, **kwar
+000469a0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+000469b0: 506c 6f74 2074 6865 2063 6f6e 7365 6e73  Plot the consens
+000469c0: 7573 2063 6f6e 746f 7572 2c20 7769 7468  us contour, with
+000469d0: 2061 6c6c 2052 4f49 7320 696e 2067 7265   all ROIs in gre
+000469e0: 7920 6265 6869 6e64 2069 7420 6966 0a20  y behind it if. 
+000469f0: 2020 2020 2020 2072 6f69 735f 696e 5f62         rois_in_b
+00046a00: 6163 6b67 726f 756e 643d 5472 7565 2e22  ackground=True."
+00046a10: 2222 0a0a 2020 2020 2020 2020 636f 6e73  ""..        cons
+00046a20: 656e 7375 7320 3d20 7365 6c66 2e67 6574  ensus = self.get
+00046a30: 5f63 6f6e 7365 6e73 7573 2863 6f6e 7365  _consensus(conse
+00046a40: 6e73 7573 5f74 7970 6529 0a0a 2020 2020  nsus_type)..    
+00046a50: 2020 2020 6966 2069 6478 2069 7320 4e6f      if idx is No
+00046a60: 6e65 2061 6e64 2073 6c20 6973 204e 6f6e  ne and sl is Non
+00046a70: 6520 616e 6420 706f 7320 6973 204e 6f6e  e and pos is Non
+00046a80: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00046a90: 6478 203d 2073 656c 662e 6765 745f 6d69  dx = self.get_mi
+00046aa0: 645f 6964 7828 7669 6577 290a 2020 2020  d_idx(view).    
+00046ab0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00046ac0: 2020 2020 2020 6964 7820 3d20 636f 6e73        idx = cons
+00046ad0: 656e 7375 732e 6765 745f 6964 7828 7669  ensus.get_idx(vi
+00046ae0: 6577 2c20 736c 2c20 6964 782c 2070 6f73  ew, sl, idx, pos
+00046af0: 290a 2020 2020 2020 2020 6178 203d 2073  ).        ax = s
+00046b00: 6b72 742e 696d 6167 652e 5f73 6c69 6365  krt.image._slice
+00046b10: 5f61 7865 735b 7669 6577 5d0a 2020 2020  _axes[view].    
+00046b20: 2020 2020 706f 7320 3d20 636f 6e73 656e      pos = consen
+00046b30: 7375 732e 6964 785f 746f 5f70 6f73 2869  sus.idx_to_pos(i
+00046b40: 6478 2c20 6178 290a 0a20 2020 2020 2020  dx, ax)..       
+00046b50: 2069 6620 636f 6e73 656e 7375 732e 656d   if consensus.em
+00046b60: 7074 793a 0a20 2020 2020 2020 2020 2020  pty:.           
+00046b70: 2070 7269 6e74 2866 227b 636f 6e73 656e   print(f"{consen
+00046b80: 7375 735f 7479 7065 7d20 636f 6e74 6f75  sus_type} contou
+00046b90: 7220 6973 2065 6d70 7479 2229 0a20 2020  r is empty").   
+00046ba0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00046bb0: 0a20 2020 2020 2020 2069 6d61 6765 5f72  .        image_r
+00046bc0: 6561 6479 203d 206b 7761 7267 732e 706f  eady = kwargs.po
+00046bd0: 7028 2269 6d61 6765 5f72 6561 6479 222c  p("image_ready",
+00046be0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+00046bf0: 6966 206e 6f74 2069 6d61 6765 5f72 6561  if not image_rea
+00046c00: 6479 2061 6e64 206e 6f74 2028 696e 636c  dy and not (incl
+00046c10: 7564 655f 696d 6167 6520 616e 6420 7365  ude_image and se
+00046c20: 6c66 2e69 6d61 6765 293a 0a20 2020 2020  lf.image):.     
+00046c30: 2020 2020 2020 2069 6d20 3d20 636f 6e73         im = cons
+00046c40: 656e 7375 732e 6765 745f 6475 6d6d 795f  ensus.get_dummy_
+00046c50: 696d 6167 6528 0a20 2020 2020 2020 2020  image(.         
+00046c60: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
+00046c70: 5f73 697a 653d 766f 7865 6c5f 7369 7a65  _size=voxel_size
+00046c80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00046c90: 2020 2020 2020 6275 6666 6572 3d62 7566        buffer=buf
+00046ca0: 6665 720a 2020 2020 2020 2020 2020 2020  fer.            
+00046cb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00046cc0: 2020 2020 2020 696d 2e74 6974 6c65 203d        im.title =
+00046cd0: 2063 6f6e 7365 6e73 7573 2e6e 616d 650a   consensus.name.
+00046ce0: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
+00046cf0: 656e 7375 732e 7365 745f 696d 6167 6528  ensus.set_image(
+00046d00: 696d 290a 2020 2020 2020 2020 2020 2020  im).            
+00046d10: 636f 6e73 656e 7375 732e 7265 7365 745f  consensus.reset_
+00046d20: 636f 6e74 6f75 7273 2829 0a20 2020 2020  contours().     
+00046d30: 2020 2063 6f6e 7365 6e73 7573 2e63 7265     consensus.cre
+00046d40: 6174 655f 6d61 736b 2829 0a0a 2020 2020  ate_mask()..    
+00046d50: 2020 2020 636f 6e73 656e 7375 732e 706c      consensus.pl
+00046d60: 6f74 2863 6f6c 6f72 3d63 6f6c 6f72 2c20  ot(color=color, 
+00046d70: 706f 733d 706f 732c 2076 6965 773d 7669  pos=pos, view=vi
+00046d80: 6577 2c20 7368 6f77 3d46 616c 7365 2c0a  ew, show=False,.
+00046d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046da0: 2020 2020 2020 2069 6d61 6765 5f72 6561         image_rea
+00046db0: 6479 3d54 7275 652c 202a 2a6b 7761 7267  dy=True, **kwarg
+00046dc0: 7329 0a0a 2020 2020 2020 2020 6966 2072  s)..        if r
+00046dd0: 6f69 735f 696e 5f62 6163 6b67 726f 756e  ois_in_backgroun
+00046de0: 643a 0a20 2020 2020 2020 2020 2020 206b  d:.            k
+00046df0: 7761 7267 735b 2261 7822 5d20 3d20 636f  wargs["ax"] = co
+00046e00: 6e73 656e 7375 732e 6178 0a20 2020 2020  nsensus.ax.     
+00046e10: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+00046e20: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
+00046e30: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
+00046e40: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00046e50: 2020 2020 726f 692e 706c 6f74 2863 6f6c      roi.plot(col
+00046e60: 6f72 3d22 6c69 6768 7467 7265 7922 2c20  or="lightgrey", 
+00046e70: 7669 6577 3d76 6965 772c 2070 6f73 3d70  view=view, pos=p
+00046e80: 6f73 2c20 7368 6f77 3d46 616c 7365 2c20  os, show=False, 
+00046e90: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00046ea0: 2020 2020 2020 636f 6e73 656e 7375 732e        consensus.
+00046eb0: 706c 6f74 2863 6f6c 6f72 3d63 6f6c 6f72  plot(color=color
+00046ec0: 2c20 7669 6577 3d76 6965 772c 2070 6f73  , view=view, pos
+00046ed0: 3d70 6f73 2c20 7368 6f77 3d46 616c 7365  =pos, show=False
+00046ee0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+00046ef0: 2020 2020 2063 6f6e 7365 6e73 7573 2e61       consensus.a
+00046f00: 782e 7365 745f 6173 7065 6374 2822 6571  x.set_aspect("eq
+00046f10: 7561 6c22 290a 0a20 2020 2020 2020 2069  ual")..        i
+00046f20: 6620 7368 6f77 3a0a 2020 2020 2020 2020  f show:.        
+00046f30: 2020 2020 706c 742e 7368 6f77 2829 0a0a      plt.show()..
+00046f40: 2020 2020 6465 6620 6765 745f 6c65 6e67      def get_leng
+00046f50: 7468 2873 656c 662c 2061 7829 3a0a 2020  th(self, ax):.  
+00046f60: 2020 2020 2020 2222 2247 6574 206c 656e        """Get len
+00046f70: 6774 6820 636f 7665 7265 6420 6279 2052  gth covered by R
+00046f80: 4f49 7320 616c 6f6e 6720 616e 2061 7869  OIs along an axi
+00046f90: 732e 2222 220a 0a20 2020 2020 2020 2065  s."""..        e
+00046fa0: 7874 656e 7420 3d20 7365 6c66 2e67 6574  xtent = self.get
+00046fb0: 5f65 7874 656e 7428 6178 3d61 7829 0a20  _extent(ax=ax). 
+00046fc0: 2020 2020 2020 2072 6574 7572 6e20 6162         return ab
+00046fd0: 7328 6578 7465 6e74 5b31 5d20 2d20 6578  s(extent[1] - ex
+00046fe0: 7465 6e74 5b30 5d29 0a0a 2020 2020 6465  tent[0])..    de
+00046ff0: 6620 6765 745f 6365 6e74 7265 2873 656c  f get_centre(sel
+00047000: 662c 202a 2a6b 7761 7267 7329 3a0a 2020  f, **kwargs):.  
+00047010: 2020 2020 2020 2222 2247 6574 2033 4420        """Get 3D 
+00047020: 6365 6e74 7265 206f 6620 7468 6520 6172  centre of the ar
+00047030: 6561 2063 6f76 6572 6564 2062 7920 524f  ea covered by RO
+00047040: 4973 2e22 2222 0a0a 2020 2020 2020 2020  Is."""..        
+00047050: 6b77 6172 6773 2e70 6f70 2822 6178 222c  kwargs.pop("ax",
+00047060: 204e 6f6e 6529 0a20 2020 2020 2020 2065   None).        e
+00047070: 7874 656e 7473 203d 205b 7365 6c66 2e67  xtents = [self.g
+00047080: 6574 5f65 7874 656e 7428 6178 3d61 782c  et_extent(ax=ax,
+00047090: 202a 2a6b 7761 7267 7329 2066 6f72 2061   **kwargs) for a
+000470a0: 7820 696e 2073 6b72 742e 696d 6167 652e  x in skrt.image.
+000470b0: 5f61 7865 735d 0a20 2020 2020 2020 2072  _axes].        r
+000470c0: 6574 7572 6e20 5b6e 702e 6d65 616e 2865  eturn [np.mean(e
+000470d0: 7829 2066 6f72 2065 7820 696e 2065 7874  x) for ex in ext
+000470e0: 656e 7473 5d0a 0a20 2020 2064 6566 2066  ents]..    def f
+000470f0: 696e 645f 6d6f 7374 5f70 6f70 756c 6174  ind_most_populat
+00047100: 6564 5f73 6c69 6365 2873 656c 662c 2076  ed_slice(self, v
+00047110: 6965 773d 2278 2d79 2229 3a0a 2020 2020  iew="x-y"):.    
+00047120: 2020 2020 2222 2246 696e 6420 7468 6520      """Find the 
+00047130: 696e 6465 7820 6f66 2074 6865 2073 6c69  index of the sli
+00047140: 6365 2077 6974 6820 7468 6520 6d6f 7374  ce with the most
+00047150: 2052 4f49 7320 6f6e 2069 742e 2222 220a   ROIs on it.""".
+00047160: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+00047170: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00047180: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
+00047190: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
+000471a0: 7074 793d 5472 7565 293a 0a20 2020 2020  pty=True):.     
+000471b0: 2020 2020 2020 2069 6e64 6963 6573 2e65         indices.e
+000471c0: 7874 656e 6428 726f 692e 6765 745f 696e  xtend(roi.get_in
+000471d0: 6469 6365 7328 7669 6577 2929 0a20 2020  dices(view)).   
+000471e0: 2020 2020 2076 616c 732c 2063 6f75 6e74       vals, count
+000471f0: 7320 3d20 6e70 2e75 6e69 7175 6528 696e  s = np.unique(in
+00047200: 6469 6365 732c 2072 6574 7572 6e5f 636f  dices, return_co
+00047210: 756e 7473 3d54 7275 6529 0a20 2020 2020  unts=True).     
+00047220: 2020 2072 6574 7572 6e20 7661 6c73 5b6e     return vals[n
+00047230: 702e 6172 676d 6178 2863 6f75 6e74 7329  p.argmax(counts)
+00047240: 5d0a 0a20 2020 2064 6566 2076 6965 7728  ]..    def view(
+00047250: 7365 6c66 2c20 696e 636c 7564 655f 696d  self, include_im
+00047260: 6167 653d 5472 7565 2c20 726f 6973 3d4e  age=True, rois=N
+00047270: 6f6e 652c 2076 6f78 656c 5f73 697a 653d  one, voxel_size=
+00047280: 5b31 2c20 315d 2c20 6275 6666 6572 3d35  [1, 1], buffer=5
+00047290: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+000472a0: 2020 2020 2022 2222 5669 6577 2074 6865       """View the
+000472b0: 2053 7472 7563 7475 7265 5365 742e 0a0a   StructureSet...
+000472c0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+000472d0: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
+000472e0: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+000472f0: 5f69 6d61 6765 203a 2062 6f6f 6c2c 2064  _image : bool, d
+00047300: 6566 6175 6c74 3d54 7275 650a 2020 2020  efault=True.    
+00047310: 2020 2020 2020 2020 4966 2054 7275 6520          If True 
+00047320: 616e 6420 7468 6973 2053 7472 7563 7475  and this Structu
+00047330: 7265 5365 7420 6861 7320 616e 2061 7373  reSet has an ass
+00047340: 6f63 6961 7465 6420 696d 6167 6520 0a20  ociated image . 
+00047350: 2020 2020 2020 2020 2020 2028 696e 2073             (in s
+00047360: 656c 662e 696d 6167 6529 2c20 7468 6520  elf.image), the 
+00047370: 696d 6167 6520 7769 6c6c 2062 6520 6469  image will be di
+00047380: 7370 6c61 7965 6420 6265 6869 6e64 2074  splayed behind t
+00047390: 6865 2052 4f49 732e 0a0a 2020 2020 2020  he ROIs...      
+000473a0: 2020 726f 6973 203a 2053 7472 7563 7475    rois : Structu
+000473b0: 7265 5365 742f 6c69 7374 2c20 6465 6661  reSet/list, defa
+000473c0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000473d0: 2020 2020 2041 6e79 206f 7468 6572 2052       Any other R
+000473e0: 4f49 7320 6f72 2053 7472 7563 7475 7265  OIs or Structure
+000473f0: 5365 7473 2074 6f20 696e 636c 7564 6520  Sets to include 
+00047400: 696e 2074 6865 2070 6c6f 742e 0a0a 2020  in the plot...  
+00047410: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00047420: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
+00047430: 3d5b 312c 2031 5d0a 2020 2020 2020 2020  =[1, 1].        
+00047440: 2020 2020 4966 2074 6865 2053 7472 7563      If the Struc
+00047450: 7475 7265 5365 7420 646f 6573 206e 6f74  tureSet does not
+00047460: 2068 6176 6520 616e 2061 7373 6f63 6961   have an associa
+00047470: 7465 6420 696d 6167 6520 616e 6420 6861  ted image and ha
+00047480: 7320 524f 4973 200a 2020 2020 2020 2020  s ROIs .        
+00047490: 2020 2020 6465 7363 7269 6265 6420 6f6e      described on
+000474a0: 6c79 2062 7920 636f 6e74 6f75 7273 2c20  ly by contours, 
+000474b0: 7468 6973 2077 696c 6c20 6265 2074 6865  this will be the
+000474c0: 2076 6f78 656c 2073 697a 6573 2075 7365   voxel sizes use
+000474d0: 6420 696e 200a 2020 2020 2020 2020 2020  d in .          
+000474e0: 2020 7468 6520 782d 7920 6469 7265 6374    the x-y direct
+000474f0: 696f 6e20 7768 656e 2063 6f6e 7665 7274  ion when convert
+00047500: 696e 6720 524f 4973 2074 6f20 6d61 736b  ing ROIs to mask
+00047510: 7320 6966 2061 206d 6173 6b20 706c 6f74  s if a mask plot
+00047520: 200a 2020 2020 2020 2020 2020 2020 7479   .            ty
+00047530: 7065 2069 7320 7365 6c65 6374 6564 2e0a  pe is selected..
+00047540: 0a20 2020 2020 2020 2062 7566 6665 7220  .        buffer 
+00047550: 3a20 696e 742c 2064 6566 6175 6c74 3d35  : int, default=5
+00047560: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00047570: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
+00047580: 2064 6f65 7320 6e6f 7420 6861 7665 2061   does not have a
+00047590: 6e20 6173 736f 6369 6174 6564 2069 6d61  n associated ima
+000475a0: 6765 2061 6e64 2068 6173 2052 4f49 730a  ge and has ROIs.
+000475b0: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+000475c0: 7269 6265 6420 6f6e 6c79 2062 7920 636f  ribed only by co
+000475d0: 6e74 6f75 7273 2c20 7468 6973 2077 696c  ntours, this wil
+000475e0: 6c20 6265 2074 6865 206e 756d 6265 7220  l be the number 
+000475f0: 6f66 2062 7566 6665 7220 766f 7865 6c73  of buffer voxels
+00047600: 200a 2020 2020 2020 2020 2020 2020 2869   .            (i
+00047610: 2e65 2e20 7768 6974 6573 7061 6365 2920  .e. whitespace) 
+00047620: 6469 7370 6c61 7965 6420 6172 6f75 6e64  displayed around
+00047630: 2074 6865 2065 7874 656e 7420 6f66 2074   the extent of t
+00047640: 6865 2052 4f49 732e 0a20 2020 2020 2020  he ROIs..       
+00047650: 2022 2222 0a0a 2020 2020 2020 2020 6672   """..        fr
+00047660: 6f6d 2073 6b72 742e 6265 7474 6572 5f76  om skrt.better_v
+00047670: 6965 7765 7220 696d 706f 7274 2042 6574  iewer import Bet
+00047680: 7465 7256 6965 7765 720a 2020 2020 2020  terViewer.      
+00047690: 2020 7365 6c66 2e6c 6f61 6428 290a 0a20    self.load().. 
+000476a0: 2020 2020 2020 2023 2053 6574 2069 6e69         # Set ini
+000476b0: 7469 616c 207a 6f6f 6d20 616d 6f75 6e74  tial zoom amount
+000476c0: 2061 6e64 2063 656e 7472 650a 2020 2020   and centre.    
+000476d0: 2020 2020 7365 6c66 2e72 6f69 735b 305d      self.rois[0]
+000476e0: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
+000476f0: 6966 2073 656c 662e 696d 6167 6520 6973  if self.image is
+00047700: 206e 6f74 204e 6f6e 6520 616e 6420 6e6f   not None and no
+00047710: 7420 7365 6c66 2e67 6574 5f72 6f69 7328  t self.get_rois(
+00047720: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
+00047730: 6529 5b30 5d2e 636f 6e74 6f75 7273 5f6f  e)[0].contours_o
+00047740: 6e6c 793a 0a20 2020 2020 2020 2020 2020  nly:.           
+00047750: 2076 6965 7720 3d20 6b77 6172 6773 2e67   view = kwargs.g
+00047760: 6574 2822 696e 6974 5f76 6965 7722 2c20  et("init_view", 
+00047770: 2278 2d79 2229 0a20 2020 2020 2020 2020  "x-y").         
+00047780: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+00047790: 2020 2061 7865 7320 3d20 736b 7274 2e69     axes = skrt.i
+000477a0: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
+000477b0: 7669 6577 5d0a 2020 2020 2020 2020 2020  view].          
+000477c0: 2020 6578 7465 6e74 7320 3d20 5b73 656c    extents = [sel
+000477d0: 662e 6765 745f 6c65 6e67 7468 2861 783d  f.get_length(ax=
+000477e0: 6178 2920 666f 7220 6178 2069 6e20 6178  ax) for ax in ax
+000477f0: 6573 5d0a 2020 2020 2020 2020 2020 2020  es].            
+00047800: 696d 5f6c 696d 7320 3d20 5b73 656c 662e  im_lims = [self.
+00047810: 696d 6167 652e 6765 745f 6c65 6e67 7468  image.get_length
+00047820: 2861 783d 6178 2920 666f 7220 6178 2069  (ax=ax) for ax i
+00047830: 6e20 6178 6573 5d0a 2020 2020 2020 2020  n axes].        
+00047840: 2020 2020 7a6f 6f6d 203d 206d 696e 285b      zoom = min([
+00047850: 696d 5f6c 696d 735b 695d 202f 2065 7874  im_lims[i] / ext
+00047860: 656e 7473 5b69 5d20 666f 7220 6920 696e  ents[i] for i in
+00047870: 2072 616e 6765 2832 295d 2920 2a20 302e   range(2)]) * 0.
+00047880: 380a 2020 2020 2020 2020 2020 2020 7a6f  8.            zo
+00047890: 6f6d 5f63 656e 7472 6520 3d20 7365 6c66  om_centre = self
+000478a0: 2e67 6574 5f63 656e 7472 6528 290a 2020  .get_centre().  
+000478b0: 2020 2020 2020 2020 2020 6966 207a 6f6f            if zoo
+000478c0: 6d20 3e20 313a 0a20 2020 2020 2020 2020  m > 1:.         
+000478d0: 2020 2020 2020 206b 7761 7267 732e 7365         kwargs.se
+000478e0: 7464 6566 6175 6c74 2822 7a6f 6f6d 222c  tdefault("zoom",
+000478f0: 207a 6f6f 6d29 0a20 2020 2020 2020 2020   zoom).         
+00047900: 2020 2020 2020 206b 7761 7267 732e 7365         kwargs.se
+00047910: 7464 6566 6175 6c74 2822 7a6f 6f6d 5f63  tdefault("zoom_c
+00047920: 656e 7472 6522 2c20 7a6f 6f6d 5f63 656e  entre", zoom_cen
+00047930: 7472 6529 0a20 2020 2020 2020 2020 2020  tre).           
+00047940: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+00047950: 2020 2320 5365 7420 696e 6974 6961 6c20    # Set initial 
+00047960: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
+00047970: 2020 6b77 6172 6773 2e73 6574 6465 6661    kwargs.setdefa
+00047980: 756c 7428 0a20 2020 2020 2020 2020 2020  ult(.           
+00047990: 2020 2020 2022 696e 6974 5f73 6c69 6365       "init_slice
+000479a0: 222c 200a 2020 2020 2020 2020 2020 2020  ", .            
+000479b0: 2020 2020 7365 6c66 2e69 6d61 6765 2e69      self.image.i
+000479c0: 6478 5f74 6f5f 736c 6963 6528 7365 6c66  dx_to_slice(self
+000479d0: 2e66 696e 645f 6d6f 7374 5f70 6f70 756c  .find_most_popul
+000479e0: 6174 6564 5f73 6c69 6365 2876 6965 7729  ated_slice(view)
+000479f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00047a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047a10: 2020 2020 2020 2020 2020 736b 7274 2e69            skrt.i
+00047a20: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
+00047a30: 5b76 6965 775d 2929 0a0a 2020 2020 2020  [view]))..      
+00047a40: 2020 6966 2022 706c 6f74 5f74 7970 6522    if "plot_type"
+00047a50: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
+00047a60: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
+00047a70: 726f 695f 706c 6f74 5f74 7970 6522 5d20  roi_plot_type"] 
+00047a80: 3d20 6b77 6172 6773 2e70 6f70 2822 706c  = kwargs.pop("pl
+00047a90: 6f74 5f74 7970 6522 290a 0a20 2020 2020  ot_type")..     
+00047aa0: 2020 2023 2045 6e73 7572 6520 7468 6174     # Ensure that
+00047ab0: 2074 6974 6c65 2069 7320 7365 7420 746f   title is set to
+00047ac0: 2062 6520 6120 7374 7269 6e67 2e0a 2020   be a string..  
+00047ad0: 2020 2020 2020 6966 206b 7761 7267 732e        if kwargs.
+00047ae0: 6765 7428 2274 6974 6c65 222c 204e 6f6e  get("title", Non
+00047af0: 6529 2069 7320 4e6f 6e65 3a0a 2020 2020  e) is None:.    
+00047b00: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
+00047b10: 7469 746c 6522 5d20 3d20 7365 6c66 2e6e  title"] = self.n
+00047b20: 616d 6520 6f72 2022 220a 0a20 2020 2020  ame or ""..     
+00047b30: 2020 2023 2056 6965 7720 7769 7468 2069     # View with i
+00047b40: 6d61 6765 0a20 2020 2020 2020 2069 6620  mage.        if 
+00047b50: 696e 636c 7564 655f 696d 6167 6520 616e  include_image an
+00047b60: 6420 7365 6c66 2e69 6d61 6765 2069 7320  d self.image is 
+00047b70: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00047b80: 2020 2020 2020 6966 2072 6f69 7320 6973        if rois is
+00047b90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00047ba0: 2020 2020 2020 2072 6f69 7320 3d20 7365         rois = se
+00047bb0: 6c66 0a20 2020 2020 2020 2020 2020 2065  lf.            e
+00047bc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00047bd0: 2020 2020 2069 6620 736b 7274 2e63 6f72       if skrt.cor
+00047be0: 652e 6973 5f6c 6973 7428 726f 6973 293a  e.is_list(rois):
+00047bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047c00: 2020 2020 2072 6f69 7320 3d20 5b73 656c       rois = [sel
+00047c10: 665d 202b 2072 6f69 730a 2020 2020 2020  f] + rois.      
+00047c20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00047c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047c40: 2020 2020 726f 6973 203d 205b 7365 6c66      rois = [self
+00047c50: 2c20 726f 6973 5d0a 2020 2020 2020 2020  , rois].        
+00047c60: 2020 2020 6276 203d 2042 6574 7465 7256      bv = BetterV
+00047c70: 6965 7765 7228 7365 6c66 2e69 6d61 6765  iewer(self.image
+00047c80: 2c20 726f 6973 3d72 6f69 732c 202a 2a6b  , rois=rois, **k
+00047c90: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
+00047ca0: 2320 5669 6577 2077 6974 686f 7574 2069  # View without i
+00047cb0: 6d61 6765 0a20 2020 2020 2020 2065 6c73  mage.        els
+00047cc0: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00047cd0: 7374 7275 6374 7572 655f 7365 745f 746d  structure_set_tm
+00047ce0: 7020 3d20 7365 6c66 0a0a 2020 2020 2020  p = self..      
+00047cf0: 2020 2020 2020 2320 4d61 6b65 2064 756d        # Make dum
+00047d00: 6d79 2069 6d61 6765 0a20 2020 2020 2020  my image.       
+00047d10: 2020 2020 2069 6d20 3d20 7365 6c66 2e67       im = self.g
+00047d20: 6574 5f64 756d 6d79 5f69 6d61 6765 2862  et_dummy_image(b
+00047d30: 7566 6665 723d 6275 6666 6572 2c20 0a20  uffer=buffer, . 
+00047d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047d60: 2020 2020 2076 6f78 656c 5f73 697a 653d       voxel_size=
+00047d70: 766f 7865 6c5f 7369 7a65 290a 2020 2020  voxel_size).    
+00047d80: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00047d90: 655f 7365 745f 746d 7020 3d20 7365 6c66  e_set_tmp = self
+00047da0: 2e63 6c6f 6e65 280a 2020 2020 2020 2020  .clone(.        
+00047db0: 2020 2020 2020 2020 636f 7079 5f72 6f69          copy_roi
+00047dc0: 733d 5472 7565 2c20 0a20 2020 2020 2020  s=True, .       
+00047dd0: 2020 2020 2020 2020 2063 6f70 795f 726f           copy_ro
+00047de0: 695f 6461 7461 3d46 616c 7365 2c0a 2020  i_data=False,.  
+00047df0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00047e00: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00047e10: 655f 7365 745f 746d 702e 7365 745f 696d  e_set_tmp.set_im
+00047e20: 6167 6528 696d 290a 2020 2020 2020 2020  age(im).        
+00047e30: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
+00047e40: 7472 7563 7475 7265 5f73 6574 5f74 6d70  tructure_set_tmp
+00047e50: 2e67 6574 5f72 6f69 7328 293a 0a20 2020  .get_rois():.   
+00047e60: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00047e70: 2e72 6573 6574 5f63 6f6e 746f 7572 7328  .reset_contours(
+00047e80: 290a 2020 2020 2020 2020 2020 2020 2222  ).            ""
+00047e90: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+00047ea0: 2073 656c 662e 726f 6973 5b30 5d2e 636f   self.rois[0].co
+00047eb0: 6e74 6f75 7273 5f6f 6e6c 7920 6f72 2054  ntours_only or T
+00047ec0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+00047ed0: 2020 2020 2069 6d20 3d20 7365 6c66 2e67       im = self.g
+00047ee0: 6574 5f64 756d 6d79 5f69 6d61 6765 2862  et_dummy_image(b
+00047ef0: 7566 6665 723d 6275 6666 6572 2c20 0a20  uffer=buffer, . 
+00047f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f20: 2020 2020 2020 2020 2076 6f78 656c 5f73           voxel_s
+00047f30: 697a 653d 766f 7865 6c5f 7369 7a65 290a  ize=voxel_size).
+00047f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f50: 7374 7275 6374 7572 655f 7365 745f 746d  structure_set_tm
+00047f60: 7020 3d20 7365 6c66 2e63 6c6f 6e65 280a  p = self.clone(.
+00047f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f80: 2020 2020 636f 7079 5f72 6f69 733d 5472      copy_rois=Tr
+00047f90: 7565 2c20 0a20 2020 2020 2020 2020 2020  ue, .           
+00047fa0: 2020 2020 2020 2020 2063 6f70 795f 726f           copy_ro
+00047fb0: 695f 6461 7461 3d46 616c 7365 0a20 2020  i_data=False.   
+00047fc0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00047fd0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00047fe0: 6f72 2072 6f69 2069 6e20 7374 7275 6374  or roi in struct
+00047ff0: 7572 655f 7365 745f 746d 702e 726f 6973  ure_set_tmp.rois
+00048000: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00048010: 2020 2020 2020 6966 2072 6f69 2e63 6f6e        if roi.con
+00048020: 746f 7572 735f 6f6e 6c79 3a0a 2020 2020  tours_only:.    
+00048030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048040: 2020 2020 726f 692e 7365 745f 696d 6167      roi.set_imag
+00048050: 6528 696d 290a 2020 2020 2020 2020 2020  e(im).          
+00048060: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00048070: 2020 2020 2020 2020 696d 203d 2073 6b72          im = skr
+00048080: 742e 696d 6167 652e 496d 6167 6528 0a20  t.image.Image(. 
+00048090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000480a0: 2020 206e 702e 6f6e 6573 2873 656c 662e     np.ones(self.
+000480b0: 726f 6973 5b30 5d2e 7368 6170 6529 202a  rois[0].shape) *
+000480c0: 2031 6534 2c0a 2020 2020 2020 2020 2020   1e4,.          
+000480d0: 2020 2020 2020 2020 2020 6166 6669 6e65            affine
+000480e0: 3d73 656c 662e 726f 6973 5b30 5d2e 6166  =self.rois[0].af
+000480f0: 6669 6e65 2c0a 2020 2020 2020 2020 2020  fine,.          
+00048100: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00048110: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00048120: 2020 2020 2069 6620 726f 6973 2069 7320       if rois is 
+00048130: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00048140: 2020 2020 2020 726f 6973 203d 2073 7472        rois = str
+00048150: 7563 7475 7265 5f73 6574 5f74 6d70 0a20  ucture_set_tmp. 
+00048160: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00048170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048180: 2069 6620 736b 7274 2e63 6f72 652e 6973   if skrt.core.is
+00048190: 5f6c 6973 7428 726f 6973 293a 0a20 2020  _list(rois):.   
+000481a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000481b0: 2072 6f69 7320 3d20 5b73 7472 7563 7475   rois = [structu
+000481c0: 7265 5f73 6574 5f74 6d70 5d20 2b20 726f  re_set_tmp] + ro
+000481d0: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
+000481e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000481f0: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00048200: 7320 3d20 5b73 7472 7563 7475 7265 5f73  s = [structure_s
+00048210: 6574 5f74 6d70 2c20 726f 6973 5d0a 2020  et_tmp, rois].  
+00048220: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+00048230: 5b22 7368 6f77 225d 203d 2046 616c 7365  ["show"] = False
+00048240: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00048250: 6e6f 7420 2272 6f69 5f6b 7761 7267 7322  not "roi_kwargs"
+00048260: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
+00048270: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+00048280: 6773 5b22 726f 695f 6b77 6172 6773 225d  gs["roi_kwargs"]
+00048290: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+000482a0: 2020 6b77 6172 6773 5b22 726f 695f 6b77    kwargs["roi_kw
+000482b0: 6172 6773 225d 5b22 696d 6167 655f 7265  args"]["image_re
+000482c0: 6164 7922 5d20 3d20 5472 7565 0a20 2020  ady"] = True.   
+000482d0: 2020 2020 2020 2020 2062 7620 3d20 4265           bv = Be
+000482e0: 7474 6572 5669 6577 6572 2869 6d2c 2072  tterViewer(im, r
+000482f0: 6f69 733d 726f 6973 2c20 2a2a 6b77 6172  ois=rois, **kwar
+00048300: 6773 290a 0a20 2020 2020 2020 2020 2020  gs)..           
+00048310: 2023 2041 646a 7573 7420 5549 0a20 2020   # Adjust UI.   
+00048320: 2020 2020 2020 2020 206e 6f5f 7569 203d           no_ui =
+00048330: 206b 7761 7267 732e 6765 7428 226e 6f5f   kwargs.get("no_
+00048340: 7569 222c 2073 6b72 742e 636f 7265 2e44  ui", skrt.core.D
+00048350: 6566 6175 6c74 7328 292e 6e6f 5f75 6929  efaults().no_ui)
+00048360: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00048370: 6e6f 7420 6e6f 5f75 693a 0a20 2020 2020  not no_ui:.     
+00048380: 2020 2020 2020 2020 2020 2062 762e 6d61             bv.ma
+00048390: 6b65 5f75 6928 6e6f 5f69 6e74 656e 7369  ke_ui(no_intensi
+000483a0: 7479 3d54 7275 6529 0a20 2020 2020 2020  ty=True).       
+000483b0: 2020 2020 2020 2020 2062 762e 7368 6f77           bv.show
+000483c0: 2829 0a0a 2020 2020 2020 2020 7265 7475  ()..        retu
+000483d0: 726e 2062 760a 0a20 2020 2064 6566 2067  rn bv..    def g
+000483e0: 6574 5f65 7874 656e 7428 7365 6c66 2c20  et_extent(self, 
+000483f0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+00048400: 2020 2022 2222 4765 7420 6d69 6e20 616e     """Get min an
+00048410: 6420 6d61 7820 6578 7465 6e74 206f 6620  d max extent of 
+00048420: 616c 6c20 524f 4973 2069 6e20 7468 6520  all ROIs in the 
+00048430: 5374 7275 6374 7572 6553 6574 2e22 2222  StructureSet."""
+00048440: 0a0a 2020 2020 2020 2020 616c 6c5f 6578  ..        all_ex
+00048450: 7465 6e74 7320 3d20 5b5d 0a20 2020 2020  tents = [].     
+00048460: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
+00048470: 6c66 2e67 6574 5f72 6f69 7328 6967 6e6f  lf.get_rois(igno
+00048480: 7265 5f65 6d70 7479 3d54 7275 6529 3a0a  re_empty=True):.
+00048490: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
+000484a0: 6578 7465 6e74 732e 6578 7465 6e64 2872  extents.extend(r
+000484b0: 6f69 2e67 6574 5f65 7874 656e 7428 2a2a  oi.get_extent(**
+000484c0: 6b77 6172 6773 2929 0a20 2020 2020 2020  kwargs)).       
+000484d0: 2072 6574 7572 6e20 6d69 6e28 616c 6c5f   return min(all_
+000484e0: 6578 7465 6e74 7329 2c20 6d61 7828 616c  extents), max(al
+000484f0: 6c5f 6578 7465 6e74 7329 0a0a 2020 2020  l_extents)..    
+00048500: 6465 6620 6765 745f 6578 7465 6e74 7328  def get_extents(
+00048510: 7365 6c66 2c20 726f 695f 6e61 6d65 733d  self, roi_names=
+00048520: 4e6f 6e65 2c20 6275 6666 6572 3d4e 6f6e  None, buffer=Non
+00048530: 652c 2062 7566 6665 725f 756e 6974 733d  e, buffer_units=
+00048540: 226d 6d22 2c0a 2020 2020 2020 2020 2020  "mm",.          
+00048550: 2020 6d65 7468 6f64 3d4e 6f6e 652c 206f    method=None, o
+00048560: 7269 6769 6e3d 4e6f 6e65 293a 0a20 2020  rigin=None):.   
+00048570: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00048580: 2047 6574 206d 696e 696d 756d 2061 6e64   Get minimum and
+00048590: 206d 6178 696d 756d 2065 7874 656e 7420   maximum extent 
+000485a0: 6f66 2053 7472 7563 7475 7265 5365 7420  of StructureSet 
+000485b0: 524f 4973 2c0a 2020 2020 2020 2020 696e  ROIs,.        in
+000485c0: 206d 6d20 616c 6f6e 6720 616c 6c20 7468   mm along all th
+000485d0: 7265 6520 6178 6573 2c20 7265 7475 726e  ree axes, return
+000485e0: 6564 2069 6e20 6f72 6465 7220 5b78 2c20  ed in order [x, 
+000485f0: 792c 207a 5d2e 0a20 2020 2020 2020 204f  y, z]..        O
+00048600: 7074 696f 6e61 6c6c 7920 6170 706c 7920  ptionally apply 
+00048610: 6120 6275 6666 6572 2074 6f20 7468 6520  a buffer to the 
+00048620: 6578 7465 6e74 7320 7375 6368 2074 6861  extents such tha
+00048630: 7420 7468 6579 2063 6f76 6572 0a20 2020  t they cover.   
+00048640: 2020 2020 206d 6f72 6520 7468 616e 2074       more than t
+00048650: 6865 2072 6567 696f 6e20 6f66 2074 6865  he region of the
+00048660: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
+00048670: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+00048680: 0a20 2020 2020 2020 2072 6f69 5f6e 616d  .        roi_nam
+00048690: 6573 203a 206c 6973 742c 2064 6566 6175  es : list, defau
+000486a0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+000486b0: 2020 2020 4c69 7374 206f 6620 6e61 6d65      List of name
+000486c0: 7320 6f66 2052 4f49 7320 746f 2062 6520  s of ROIs to be 
+000486d0: 636f 6e73 6964 6572 6564 2e20 2049 6620  considered.  If 
+000486e0: 4e6f 6e65 2c20 616c 6c20 6f66 2074 6865  None, all of the
+000486f0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+00048700: 7563 7475 7265 2073 6574 2773 2052 4f49  ucture set's ROI
+00048710: 7320 6172 6520 636f 6e73 6964 6572 6564  s are considered
+00048720: 2e0a 0a20 2020 2020 2020 2062 7566 6665  ...        buffe
+00048730: 7220 3a20 666c 6f61 742c 2064 6566 6175  r : float, defau
+00048740: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00048750: 2020 2020 4f70 7469 6f6e 616c 2062 7566      Optional buf
+00048760: 6665 7220 746f 2061 6464 2074 6f20 7468  fer to add to th
+00048770: 6520 6578 7465 6e74 732e 2055 6e69 7473  e extents. Units
+00048780: 2073 6574 2062 7920 6062 7566 6665 725f   set by `buffer_
+00048790: 756e 6974 7360 2e0a 0a20 2020 2020 2020  units`...       
+000487a0: 2062 7566 6665 725f 756e 6974 7320 3a20   buffer_units : 
+000487b0: 7374 722c 2064 6566 6175 6c74 3d22 6d6d  str, default="mm
+000487c0: 220a 2020 2020 2020 2020 2020 2020 556e  ".            Un
+000487d0: 6974 7320 666f 7220 6275 6666 6572 2c20  its for buffer, 
+000487e0: 6966 2075 7369 6e67 2e20 4361 6e20 6265  if using. Can be
+000487f0: 2022 6d6d 222c 2022 766f 7865 6c73 222c   "mm", "voxels",
+00048800: 206f 7220 2266 7261 6322 2028 7768 6963   or "frac" (whic
+00048810: 680a 2020 2020 2020 2020 2020 2020 6170  h.            ap
+00048820: 706c 6965 7320 6275 6666 6572 2061 7320  plies buffer as 
+00048830: 6120 6672 6163 7469 6f6e 206f 6620 746f  a fraction of to
+00048840: 7461 6c20 6c65 6e67 7468 2069 6e20 6561  tal length in ea
+00048850: 6368 2064 696d 656e 7369 6f6e 292e 0a0a  ch dimension)...
+00048860: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+00048870: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+00048880: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+00048890: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+000488a0: 2065 7874 656e 7420 6361 6c63 756c 6174   extent calculat
+000488b0: 696f 6e2e 2043 616e 2062 653a 200a 0a20  ion. Can be: .. 
+000488c0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+000488d0: 2022 636f 6e74 6f75 7222 3a20 6765 7420   "contour": get 
+000488e0: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
+000488f0: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
+00048900: 2063 6f6e 746f 7572 2873 292e 0a20 2020   contour(s)..   
+00048910: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00048920: 6d61 736b 223a 2067 6574 2065 7874 656e  mask": get exten
+00048930: 7420 6672 6f6d 206d 696e 2f6d 6178 2070  t from min/max p
+00048940: 6f73 6974 696f 6e73 206f 6620 766f 7865  ositions of voxe
+00048950: 6c73 2069 6e20 7468 6520 0a20 2020 2020  ls in the .     
+00048960: 2020 2020 2020 2020 2020 2020 2062 696e               bin
+00048970: 6172 7920 6d61 736b 2e0a 2020 2020 2020  ary mask..      
+00048980: 2020 2020 2020 2020 2020 2a20 4e6f 6e65            * None
+00048990: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
+000489a0: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
+000489b0: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
+000489c0: 2e0a 0a20 2020 2020 2020 206f 7269 6769  ...        origi
+000489d0: 6e20 3a20 7475 706c 652c 2064 6566 6175  n : tuple, defau
+000489e0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+000489f0: 2020 2020 5475 706c 6520 7370 6563 6966      Tuple specif
+00048a00: 7969 6e67 2074 6865 2028 782c 2079 2c20  ying the (x, y, 
+00048a10: 7a29 2063 6f6f 7264 696e 6174 6573 206f  z) coordinates o
+00048a20: 6620 7468 6520 706f 696e 740a 2020 2020  f the point.    
+00048a30: 2020 2020 2020 2020 7769 7468 2072 6573          with res
+00048a40: 7065 6374 2074 6f20 7768 6963 6820 6578  pect to which ex
+00048a50: 7465 6e74 7320 6172 6520 746f 2062 6520  tents are to be 
+00048a60: 6465 7465 726d 696e 6564 2e0a 2020 2020  determined..    
+00048a70: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
+00048a80: 2074 6865 6e20 2830 2c20 302c 2030 2920   then (0, 0, 0) 
+00048a90: 6973 2075 7365 642e 0a20 2020 2020 2020  is used..       
+00048aa0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00048ab0: 7572 6e20 7365 6c66 2e63 6f6d 6269 6e65  urn self.combine
+00048ac0: 5f72 6f69 7328 726f 695f 6e61 6d65 7329  _rois(roi_names)
+00048ad0: 2e67 6574 5f65 7874 656e 7473 280a 2020  .get_extents(.  
+00048ae0: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00048af0: 6666 6572 2c20 6275 6666 6572 5f75 6e69  ffer, buffer_uni
+00048b00: 7473 2c20 6d65 7468 6f64 2c20 6f72 6967  ts, method, orig
+00048b10: 696e 290a 0a20 2020 2064 6566 2067 6574  in)..    def get
+00048b20: 5f63 726f 705f 6c69 6d69 7473 2873 656c  _crop_limits(sel
+00048b30: 662c 2072 6f69 5f6e 616d 6573 3d4e 6f6e  f, roi_names=Non
+00048b40: 652c 2063 726f 705f 6d61 7267 696e 733d  e, crop_margins=
+00048b50: 4e6f 6e65 2c20 6d65 7468 6f64 3d4e 6f6e  None, method=Non
+00048b60: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00048b70: 2020 2020 2020 2020 4765 7420 6372 6f70          Get crop
+00048b80: 206c 696d 6974 7320 636f 7272 6573 706f   limits correspo
+00048b90: 6e64 696e 6720 746f 2053 7472 7563 7475  nding to Structu
+00048ba0: 7265 5365 7420 524f 4920 6578 7465 6e74  reSet ROI extent
+00048bb0: 7320 706c 7573 206d 6172 6769 6e73 2e0a  s plus margins..
+00048bc0: 0a20 2020 2020 2020 2054 6865 2074 7570  .        The tup
+00048bd0: 6c65 7320 6f66 206c 696d 6974 7320 7265  les of limits re
+00048be0: 7475 726e 6564 2c20 696e 2074 6865 206f  turned, in the o
+00048bf0: 7264 6572 2028 782c 2079 2c20 7a29 2063  rder (x, y, z) c
+00048c00: 616e 0a20 2020 2020 2020 2062 6520 7573  an.        be us
+00048c10: 6564 2c20 666f 7220 6578 616d 706c 652c  ed, for example,
+00048c20: 2061 7320 696e 7075 7473 2074 6f20 736b   as inputs to sk
+00048c30: 7274 2e69 6d61 6765 2e49 6d61 6765 2e63  rt.image.Image.c
+00048c40: 726f 7028 292e 0a0a 2020 2020 2020 2020  rop()...        
+00048c50: 5468 6973 206d 6574 686f 6420 6973 2073  This method is s
+00048c60: 696d 696c 6172 2074 6f20 7468 6520 6d65  imilar to the me
+00048c70: 7468 6f64 2067 6574 5f65 7874 656e 7473  thod get_extents
+00048c80: 2829 2c20 6275 7420 616c 6c6f 7773 0a20  (), but allows. 
+00048c90: 2020 2020 2020 2064 6966 6665 7265 6e74         different
+00048ca0: 206d 6172 6769 6e73 206f 6e20 6561 6368   margins on each
+00048cb0: 2073 6964 6520 6f66 2074 6865 2053 7472   side of the Str
+00048cc0: 7563 7475 7265 5365 742e 0a0a 2020 2020  uctureSet...    
+00048cd0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+00048ce0: 3a2a 2a0a 0a20 2020 2020 2020 2072 6f69  :**..        roi
+00048cf0: 5f6e 616d 6573 203a 206c 6973 742c 2064  _names : list, d
+00048d00: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00048d10: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+00048d20: 6e61 6d65 7320 6f66 2052 4f49 7320 746f  names of ROIs to
+00048d30: 2062 6520 636f 6e73 6964 6572 6564 2e20   be considered. 
+00048d40: 2049 6620 4e6f 6e65 2c20 616c 6c20 6f66   If None, all of
+00048d50: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00048d60: 2073 7472 7563 7475 7265 2073 6574 2773   structure set's
+00048d70: 2052 4f49 7320 6172 6520 636f 6e73 6964   ROIs are consid
+00048d80: 6572 6564 2e0a 0a20 2020 2020 2020 2063  ered...        c
+00048d90: 726f 705f 6d61 7267 696e 7320 3a20 666c  rop_margins : fl
+00048da0: 6f61 742f 7475 706c 652c 2064 6566 6175  oat/tuple, defau
+00048db0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00048dc0: 2020 2020 466c 6f61 7420 6f72 2074 6872      Float or thr
+00048dd0: 6565 2d65 6c65 6d65 6e74 2074 7570 6c65  ee-element tuple
+00048de0: 2073 7065 6369 6679 696e 6720 7468 6520   specifying the 
+00048df0: 6d61 7267 696e 732c 2069 6e20 6d6d 2c0a  margins, in mm,.
+00048e00: 2020 2020 2020 2020 2020 2020 746f 2062              to b
+00048e10: 6520 6164 6465 6420 746f 2053 7472 7563  e added to Struc
+00048e20: 7475 7265 5365 7420 6578 7465 6e74 732e  tureSet extents.
+00048e30: 2020 4966 2061 2066 6c6f 6174 2c20 6d69    If a float, mi
+00048e40: 6e75 7320 616e 6420 706c 7573 2074 6865  nus and plus the
+00048e50: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00048e60: 7565 2073 7065 6369 6669 6564 2061 7265  ue specified are
+00048e70: 2061 6464 6564 2074 6f20 6c6f 7765 7220   added to lower 
+00048e80: 616e 6420 7570 7065 7220 6578 7465 6e74  and upper extent
+00048e90: 7320 7265 7370 6563 7469 7665 6c79 0a20  s respectively. 
+00048ea0: 2020 2020 2020 2020 2020 2061 6c6f 6e67             along
+00048eb0: 2065 6163 6820 6178 6973 2e20 2049 6620   each axis.  If 
+00048ec0: 6120 7468 7265 652d 656c 656d 656e 7420  a three-element 
+00048ed0: 7475 706c 652c 2065 6c65 6d65 6e74 7320  tuple, elements 
+00048ee0: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+00048ef0: 7461 6b65 6e20 746f 2073 7065 6369 6679  taken to specify
+00048f00: 206d 6172 6769 6e73 2069 6e20 7468 6520   margins in the 
+00048f10: 6f72 6465 7220 2878 2c20 792c 207a 292e  order (x, y, z).
+00048f20: 2020 456c 656d 656e 7473 0a20 2020 2020    Elements.     
+00048f30: 2020 2020 2020 2063 616e 2062 6520 6569         can be ei
+00048f40: 7468 6572 2066 6c6f 6174 7320 286d 696e  ther floats (min
+00048f50: 7573 2061 6e64 2070 6c75 7320 7468 6520  us and plus the 
+00048f60: 7661 6c75 6520 6164 6465 6420 7265 7370  value added resp
+00048f70: 6563 7469 7665 6c79 0a20 2020 2020 2020  ectively.       
+00048f80: 2020 2020 2074 6f20 6c6f 7765 7220 616e       to lower an
+00048f90: 6420 7570 7065 7220 6578 7465 6e74 7329  d upper extents)
+00048fa0: 206f 7220 7477 6f2d 656c 656d 656e 7420   or two-element 
+00048fb0: 7475 706c 6573 2028 656c 656d 656e 7473  tuples (elements
+00048fc0: 2030 2061 6e64 2031 0a20 2020 2020 2020   0 and 1.       
+00048fd0: 2020 2020 2061 6464 6564 2072 6573 7065       added respe
+00048fe0: 6374 6976 656c 7920 746f 206c 6f77 6572  ctively to lower
+00048ff0: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
+00049000: 7473 292e 0a0a 2020 2020 2020 2020 6d65  ts)...        me
+00049010: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
+00049020: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00049030: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
+00049040: 7365 2066 6f72 2065 7874 656e 7420 6361  se for extent ca
+00049050: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
+00049060: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00049070: 2020 2020 2a20 2263 6f6e 746f 7572 223a      * "contour":
+00049080: 2067 6574 2065 7874 656e 7420 6672 6f6d   get extent from
+00049090: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
+000490a0: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
+000490b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000490c0: 2020 2a20 226d 6173 6b22 3a20 6765 7420    * "mask": get 
+000490d0: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
+000490e0: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
+000490f0: 2076 6f78 656c 7320 696e 2074 6865 0a20   voxels in the. 
+00049100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049110: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
+00049120: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00049130: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+00049140: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+00049150: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+00049160: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
+00049170: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00049180: 2073 656c 662e 636f 6d62 696e 655f 726f   self.combine_ro
+00049190: 6973 2872 6f69 5f6e 616d 6573 292e 6765  is(roi_names).ge
+000491a0: 745f 6372 6f70 5f6c 696d 6974 7328 0a20  t_crop_limits(. 
+000491b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000491c0: 726f 705f 6d61 7267 696e 732c 206d 6574  rop_margins, met
+000491d0: 686f 6429 0a0a 2020 2020 6465 6620 6765  hod)..    def ge
+000491e0: 745f 6262 6f78 5f63 656e 7472 655f 616e  t_bbox_centre_an
+000491f0: 645f 7769 6474 6873 2873 656c 662c 0a20  d_widths(self,. 
+00049200: 2020 2020 2020 2020 2020 2072 6f69 5f6e             roi_n
+00049210: 616d 6573 3d4e 6f6e 652c 2062 7566 6665  ames=None, buffe
+00049220: 723d 4e6f 6e65 2c20 6275 6666 6572 5f75  r=None, buffer_u
+00049230: 6e69 7473 3d22 6d6d 222c 206d 6574 686f  nits="mm", metho
+00049240: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
+00049250: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+00049260: 2063 656e 7472 6520 616e 6420 7769 6474   centre and widt
+00049270: 6873 2069 6e20 6d6d 2061 6c6f 6e67 2061  hs in mm along a
+00049280: 6c6c 2074 6872 6565 2061 7865 7320 6f66  ll three axes of
+00049290: 2061 2062 6f75 6e64 696e 6720 626f 780a   a bounding box.
+000492a0: 2020 2020 2020 2020 656e 636c 6f73 696e          enclosin
+000492b0: 6720 5374 7275 6374 7572 6553 6574 2052  g StructureSet R
+000492c0: 4f49 7320 616e 6420 6f70 7469 6f6e 616c  OIs and optional
+000492d0: 2062 7566 6665 722e 2020 4365 6e74 7265   buffer.  Centre
+000492e0: 0a20 2020 2020 2020 2061 6e64 2077 6964  .        and wid
+000492f0: 7468 7320 6172 6520 7265 7475 726e 6564  ths are returned
+00049300: 2061 7320 6120 7475 706c 6520 285b 782c   as a tuple ([x,
+00049310: 2079 2c20 7a5d 2c20 5b64 782c 2064 792c   y, z], [dx, dy,
+00049320: 2064 7a5d 292e 0a0a 2020 2020 2020 2020   dz])...        
+00049330: 4d65 7468 6f64 2070 6172 616d 6574 6572  Method parameter
+00049340: 7320 6172 6520 7061 7373 6564 2074 6f0a  s are passed to.
+00049350: 2020 2020 2020 2020 736b 7274 2e73 7472          skrt.str
+00049360: 7563 7475 7265 732e 5374 7275 6374 7572  uctures.Structur
+00049370: 6553 6574 2e67 6574 5f65 7874 656e 7473  eSet.get_extents
+00049380: 2829 2074 6f20 6f62 7461 696e 2053 7472  () to obtain Str
+00049390: 7563 7475 7265 5365 740a 2020 2020 2020  uctureSet.      
+000493a0: 2020 6578 7465 6e74 732e 2020 466f 7220    extents.  For 
+000493b0: 7061 7261 6d65 7465 7220 6578 706c 616e  parameter explan
+000493c0: 6174 696f 6e73 2c20 7365 650a 2020 2020  ations, see.    
+000493d0: 2020 2020 736b 7274 2e73 7472 7563 7475      skrt.structu
+000493e0: 7265 732e 5374 7275 6374 7572 6553 6574  res.StructureSet
+000493f0: 2e67 6574 5f65 7874 656e 7473 2829 2064  .get_extents() d
+00049400: 6f63 756d 656e 7461 7469 6f6e 2e0a 2020  ocumentation..  
+00049410: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00049420: 2020 6578 7465 6e74 7320 3d20 7365 6c66    extents = self
+00049430: 2e67 6574 5f65 7874 656e 7473 2872 6f69  .get_extents(roi
+00049440: 5f6e 616d 6573 2c20 6275 6666 6572 2c20  _names, buffer, 
+00049450: 6275 6666 6572 5f75 6e69 7473 2c20 6d65  buffer_units, me
+00049460: 7468 6f64 2920 0a20 2020 2020 2020 2063  thod) .        c
+00049470: 656e 7472 6520 3d20 5b30 2e35 202a 2028  entre = [0.5 * (
+00049480: 6578 7465 6e74 5b30 5d20 2b20 6578 7465  extent[0] + exte
+00049490: 6e74 5b31 5d29 2066 6f72 2065 7874 656e  nt[1]) for exten
+000494a0: 7420 696e 2065 7874 656e 7473 5d0a 2020  t in extents].  
+000494b0: 2020 2020 2020 7769 6474 6873 203d 205b        widths = [
+000494c0: 2865 7874 656e 745b 315d 202d 2065 7874  (extent[1] - ext
+000494d0: 656e 745b 305d 2920 666f 7220 6578 7465  ent[0]) for exte
+000494e0: 6e74 2069 6e20 6578 7465 6e74 735d 0a20  nt in extents]. 
+000494f0: 2020 2020 2020 2072 6574 7572 6e20 2863         return (c
+00049500: 656e 7472 652c 2077 6964 7468 7329 0a0a  entre, widths)..
+00049510: 2020 2020 6465 6620 6765 745f 6475 6d6d      def get_dumm
+00049520: 795f 696d 6167 6528 7365 6c66 2c20 2a2a  y_image(self, **
+00049530: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00049540: 2022 2222 4d61 6b65 2061 2064 756d 6d79   """Make a dummy
+00049550: 2069 6d61 6765 2074 6861 7420 636f 7665   image that cove
+00049560: 7273 2074 6865 2061 7265 6120 7370 616e  rs the area span
+00049570: 6e65 6420 6279 2061 6c6c 2052 4f49 7320  ned by all ROIs 
+00049580: 696e 2074 6869 730a 2020 2020 2020 2020  in this.        
+00049590: 5374 7275 6374 7572 6553 6574 2e20 5265  StructureSet. Re
+000495a0: 7475 726e 7320 616e 2049 6d61 6765 206f  turns an Image o
+000495b0: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
+000495c0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+000495d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000495e0: 2076 6f78 656c 5f73 697a 6520 3a20 6c69   voxel_size : li
+000495f0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+00049600: 0a20 2020 2020 2020 2020 2020 2056 6f78  .            Vox
+00049610: 656c 2073 697a 6520 696e 206d 6d20 696e  el size in mm in
+00049620: 2074 6865 2064 756d 6d79 2069 6d61 6765   the dummy image
+00049630: 2069 6e20 7468 6520 782d 7920 706c 616e   in the x-y plan
+00049640: 652c 2067 6976 656e 2061 7320 0a20 2020  e, given as .   
+00049650: 2020 2020 2020 2020 205b 7678 2c20 7679           [vx, vy
+00049660: 5d2e 2049 6620 3c73 6861 7065 3e20 616e  ]. If <shape> an
+00049670: 6420 3c76 6f78 656c 5f73 697a 653e 2061  d <voxel_size> a
+00049680: 7265 2062 6f74 6820 4e6f 6e65 2c20 766f  re both None, vo
+00049690: 7865 6c20 7369 7a65 7320 6f66 0a20 2020  xel sizes of.   
+000496a0: 2020 2020 2020 2020 205b 312c 2031 5d20           [1, 1] 
+000496b0: 7769 6c6c 2062 6520 7573 6564 2062 7920  will be used by 
+000496c0: 6465 6661 756c 742e 2054 6865 2076 6f78  default. The vox
+000496d0: 656c 2073 697a 6520 696e 2074 6865 207a  el size in the z
+000496e0: 2064 6972 6563 7469 6f6e 200a 2020 2020   direction .    
+000496f0: 2020 2020 2020 2020 6973 2064 6566 696e          is defin
+00049700: 6564 2062 7920 3c73 6c69 6365 5f74 6869  ed by <slice_thi
+00049710: 636b 6e65 7373 3e2e 0a0a 2020 2020 2020  ckness>...      
+00049720: 2020 7368 6170 6520 3a20 6c69 7374 2c20    shape : list, 
+00049730: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00049740: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
+00049750: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
+00049760: 2064 756d 6d79 2069 6d61 6765 2069 6e20   dummy image in 
+00049770: 7468 6520 782d 7920 706c 616e 652c 2067  the x-y plane, g
+00049780: 6976 656e 2061 730a 2020 2020 2020 2020  iven as.        
+00049790: 2020 2020 5b6e 782c 206e 795d 2e20 4f6e      [nx, ny]. On
+000497a0: 6c79 2075 7365 6420 6966 203c 766f 7865  ly used if <voxe
+000497b0: 6c5f 7369 7a65 3e20 6973 204e 6f6e 652e  l_size> is None.
+000497c0: 200a 2020 2020 2020 2020 2020 2020 5468   .            Th
+000497d0: 6520 6e75 6d62 6572 206f 6620 766f 7865  e number of voxe
+000497e0: 6c73 2069 6e20 7468 6520 7a20 6469 7265  ls in the z dire
+000497f0: 6374 696f 6e20 7769 6c6c 2062 6520 7461  ction will be ta
+00049800: 6b65 6e20 6672 6f6d 2074 6865 200a 2020  ken from the .  
+00049810: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+00049820: 206f 6620 736c 6963 6573 2069 6e20 7468   of slices in th
+00049830: 6520 782d 7920 636f 6e74 6f75 7273 2064  e x-y contours d
+00049840: 6963 7469 6f6e 6172 792e 0a0a 2020 2020  ictionary...    
+00049850: 2020 2020 6669 6c6c 5f76 616c 203a 2069      fill_val : i
+00049860: 6e74 2f66 6c6f 6174 2c20 6465 6661 756c  nt/float, defaul
+00049870: 743d 3165 340a 2020 2020 2020 2020 2020  t=1e4.          
+00049880: 2020 5661 6c75 6520 7769 7468 2077 6869    Value with whi
+00049890: 6368 2074 6865 2076 6f78 656c 7320 696e  ch the voxels in
+000498a0: 2074 6865 2064 756d 6d79 2069 6d61 6765   the dummy image
+000498b0: 2073 686f 756c 6420 6265 2066 696c 6c65   should be fille
+000498c0: 642e 200a 0a20 2020 2020 2020 2062 7566  d. ..        buf
+000498d0: 6665 7220 3a20 696e 742c 2064 6566 6175  fer : int, defau
+000498e0: 6c74 3d31 0a20 2020 2020 2020 2020 2020  lt=1.           
+000498f0: 204e 756d 6265 7220 6f66 2065 6d70 7479   Number of empty
+00049900: 2062 7566 6665 7220 766f 7865 6c73 2074   buffer voxels t
+00049910: 6f20 6164 6420 6f75 7473 6964 6520 7468  o add outside th
+00049920: 6520 524f 4920 696e 2065 6163 680a 2020  e ROI in each.  
+00049930: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+00049940: 696f 6e2e 0a0a 2020 2020 2020 2020 736c  ion...        sl
+00049950: 6963 655f 7468 6963 6b6e 6573 7320 3a20  ice_thickness : 
+00049960: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00049970: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00049980: 566f 7865 6c20 7369 7a65 2069 6e20 6d6d  Voxel size in mm
+00049990: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
+000499a0: 6167 6520 696e 2074 6865 207a 2064 6972  age in the z dir
+000499b0: 6563 7469 6f6e 2e20 2049 6620 4e6f 6e65  ection.  If None
+000499c0: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
+000499d0: 6520 7661 6c75 6520 7573 6564 2069 7320  e value used is 
+000499e0: 7468 6520 6d69 6e69 6d75 6d20 6469 7374  the minimum dist
+000499f0: 616e 6365 2062 6574 7765 656e 2073 6c69  ance between sli
+00049a00: 6365 2070 6f73 6974 696f 6e73 0a20 2020  ce positions.   
+00049a10: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
+00049a20: 782d 7920 636f 6e74 6f75 7273 2064 6963  x-y contours dic
+00049a30: 7469 6f6e 6172 792e 0a20 2020 2020 2020  tionary..       
+00049a40: 2022 2222 0a20 2020 2020 2020 2065 7874   """.        ext
+00049a50: 656e 7473 203d 205b 7365 6c66 2e67 6574  ents = [self.get
+00049a60: 5f65 7874 656e 7428 6178 3d61 7829 2066  _extent(ax=ax) f
+00049a70: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
+00049a80: 6167 652e 5f61 7865 735d 0a20 2020 2020  age._axes].     
+00049a90: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
+00049aa0: 7373 203d 206b 7761 7267 732e 706f 7028  ss = kwargs.pop(
+00049ab0: 2273 6c69 6365 5f74 6869 636b 6e65 7373  "slice_thickness
+00049ac0: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+00049ad0: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+00049ae0: 203d 2028 736c 6963 655f 7468 6963 6b6e   = (slice_thickn
+00049af0: 6573 7320 6f72 0a20 2020 2020 2020 2020  ess or.         
+00049b00: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+00049b10: 726f 6973 2869 676e 6f72 655f 656d 7074  rois(ignore_empt
+00049b20: 793d 5472 7565 295b 305d 5c0a 2020 2020  y=True)[0]\.    
+00049b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049b40: 2020 2020 2e67 6574 5f73 6c69 6365 5f74      .get_slice_t
+00049b50: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+00049b60: 7328 2929 0a20 2020 2020 2020 2072 6574  s()).        ret
+00049b70: 7572 6e20 6372 6561 7465 5f64 756d 6d79  urn create_dummy
+00049b80: 5f69 6d61 6765 2865 7874 656e 7473 2c20  _image(extents, 
+00049b90: 736c 6963 655f 7468 6963 6b6e 6573 732c  slice_thickness,
+00049ba0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00049bb0: 6465 6620 5f67 6574 5f63 6f6d 6269 6e61  def _get_combina
+00049bc0: 7469 6f6e 2873 656c 662c 206e 616d 652c  tion(self, name,
+00049bd0: 2066 6f72 6365 2c20 6578 636c 7564 652c   force, exclude,
+00049be0: 2063 6f6d 626f 5f6d 616b 6572 2c20 2a2a   combo_maker, **
+00049bf0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00049c00: 2022 2222 4569 7468 6572 2067 6574 2061   """Either get a
+00049c10: 6e20 616c 7265 6164 7920 6361 6c63 756c  n already calcul
+00049c20: 6174 6564 2063 6f6d 6269 6e61 7469 6f6e  ated combination
+00049c30: 2066 726f 6d20 7468 6520 6361 6368 650a   from the cache.
+00049c40: 2020 2020 2020 2020 6f72 2063 7265 6174          or creat
+00049c50: 6520 6974 2c20 6361 6368 6520 6974 2c20  e it, cache it, 
+00049c60: 616e 6420 7265 7475 726e 2069 742e 2222  and return it.""
+00049c70: 220a 0a20 2020 2020 2020 2023 2052 6574  "..        # Ret
+00049c80: 7572 6e20 6361 6368 6564 2072 6573 756c  urn cached resul
+00049c90: 7420 6966 2069 7420 6578 6973 7473 2061  t if it exists a
+00049ca0: 6e64 206e 6f74 2066 6f72 6369 6e67 0a20  nd not forcing. 
+00049cb0: 2020 2020 2020 2061 7474 7220 3d20 6622         attr = f"
+00049cc0: 5f7b 6e61 6d65 7d22 0a20 2020 2020 2020  _{name}".       
+00049cd0: 2069 6620 6578 636c 7564 653a 0a20 2020   if exclude:.   
+00049ce0: 2020 2020 2020 2020 2061 7474 7220 2b3d           attr +=
+00049cf0: 2066 225f 6578 636c 7564 6564 220a 2020   f"_excluded".  
+00049d00: 2020 2020 2020 6966 206e 6f74 2066 6f72        if not for
+00049d10: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00049d20: 6966 2065 7863 6c75 6465 2069 7320 4e6f  if exclude is No
+00049d30: 6e65 2061 6e64 2068 6173 6174 7472 2873  ne and hasattr(s
+00049d40: 656c 662c 2061 7474 7229 3a0a 2020 2020  elf, attr):.    
+00049d50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00049d60: 726e 2067 6574 6174 7472 2873 656c 662c  rn getattr(self,
+00049d70: 2061 7474 7229 0a20 2020 2020 2020 2020   attr).         
+00049d80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00049d90: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+00049da0: 7474 7228 7365 6c66 2c20 6174 7472 2920  ttr(self, attr) 
+00049db0: 616e 6420 6578 636c 7564 6520 696e 2067  and exclude in g
+00049dc0: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
+00049dd0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00049de0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00049df0: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
+00049e00: 7229 5b65 7863 6c75 6465 5d0a 0a20 2020  r)[exclude]..   
+00049e10: 2020 2020 2023 2047 6574 206c 6973 7420       # Get list 
+00049e20: 6f66 2052 4f49 7320 746f 2069 6e63 6c75  of ROIs to inclu
+00049e30: 6465 2069 6e20 7468 6973 2063 6f6d 6269  de in this combi
+00049e40: 6e61 7469 6f6e 2052 4f49 0a20 2020 2020  nation ROI.     
+00049e50: 2020 2069 6620 6578 636c 7564 6520 6973     if exclude is
+00049e60: 206e 6f74 204e 6f6e 653a 0a0a 2020 2020   not None:..    
+00049e70: 2020 2020 2020 2020 6966 2065 7863 6c75          if exclu
+00049e80: 6465 206e 6f74 2069 6e20 7365 6c66 2e67  de not in self.g
+00049e90: 6574 5f72 6f69 5f6e 616d 6573 2829 3a0a  et_roi_names():.
+00049ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049eb0: 7072 696e 7428 6622 524f 4920 746f 2065  print(f"ROI to e
+00049ec0: 7863 6c75 6465 207b 6578 636c 7564 657d  xclude {exclude}
+00049ed0: 206e 6f74 2066 6f75 6e64 2e22 290a 2020   not found.").  
+00049ee0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00049ef0: 7475 726e 0a0a 2020 2020 2020 2020 2020  turn..          
+00049f00: 2020 726f 6973 5f74 6f5f 696e 636c 7564    rois_to_includ
+00049f10: 6520 3d20 5b72 6f69 2066 6f72 2072 6f69  e = [roi for roi
+00049f20: 2069 6e20 7365 6c66 2e72 6f69 7320 6966   in self.rois if
+00049f30: 2072 6f69 2e6e 616d 6520 213d 2065 7863   roi.name != exc
+00049f40: 6c75 6465 5d0a 0a20 2020 2020 2020 2020  lude]..         
+00049f50: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00049f60: 7228 7365 6c66 2c20 6174 7472 293a 0a20  r(self, attr):. 
+00049f70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00049f80: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
+00049f90: 722c 207b 7d29 0a20 2020 2020 2020 2065  r, {}).        e
+00049fa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00049fb0: 2072 6f69 735f 746f 5f69 6e63 6c75 6465   rois_to_include
+00049fc0: 203d 2073 656c 662e 726f 6973 0a0a 2020   = self.rois..  
+00049fd0: 2020 2020 2020 2320 4d61 6b65 206b 7761        # Make kwa
+00049fe0: 7267 7320 666f 7220 524f 4920 6372 6561  rgs for ROI crea
+00049ff0: 7469 6f6e 0a20 2020 2020 2020 2072 6f69  tion.        roi
+0004a000: 5f6b 7761 7267 7320 3d20 7365 6c66 2e72  _kwargs = self.r
+0004a010: 6f69 5f6b 7761 7267 732e 636f 7079 2829  oi_kwargs.copy()
+0004a020: 0a20 2020 2020 2020 2072 6f69 5f6b 7761  .        roi_kwa
+0004a030: 7267 732e 7570 6461 7465 286b 7761 7267  rgs.update(kwarg
+0004a040: 7329 0a20 2020 2020 2020 2072 6f69 5f6b  s).        roi_k
+0004a050: 7761 7267 735b 226e 616d 6522 5d20 3d20  wargs["name"] = 
+0004a060: 6e61 6d65 0a20 2020 2020 2020 2072 6f69  name.        roi
+0004a070: 5f6b 7761 7267 735b 2269 6d61 6765 225d  _kwargs["image"]
+0004a080: 203d 2073 656c 662e 696d 6167 650a 2020   = self.image.  
+0004a090: 2020 2020 2020 726f 695f 6b77 6172 6773        roi_kwargs
+0004a0a0: 5b22 6166 6669 6e65 225d 203d 2072 6f69  ["affine"] = roi
+0004a0b0: 735f 746f 5f69 6e63 6c75 6465 5b30 5d2e  s_to_include[0].
+0004a0c0: 6765 745f 6166 6669 6e65 2873 7461 6e64  get_affine(stand
+0004a0d0: 6172 6469 7365 3d54 7275 6529 0a0a 2020  ardise=True)..  
+0004a0e0: 2020 2020 2020 2320 4372 6561 7465 2074        # Create t
+0004a0f0: 6865 2052 4f49 0a20 2020 2020 2020 2072  he ROI.        r
+0004a100: 6f69 203d 2063 6f6d 626f 5f6d 616b 6572  oi = combo_maker
+0004a110: 2872 6f69 735f 746f 5f69 6e63 6c75 6465  (rois_to_include
+0004a120: 2c20 2a2a 726f 695f 6b77 6172 6773 290a  , **roi_kwargs).
+0004a130: 0a20 2020 2020 2020 2023 2041 6464 2069  .        # Add i
+0004a140: 7420 746f 2074 6865 2063 6163 6865 2061  t to the cache a
+0004a150: 6e64 2072 6574 7572 6e0a 2020 2020 2020  nd return.      
+0004a160: 2020 6966 2065 7863 6c75 6465 2069 7320    if exclude is 
+0004a170: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0004a180: 2020 7365 7461 7474 7228 7365 6c66 2c20    setattr(self, 
+0004a190: 6174 7472 2c20 726f 6929 0a20 2020 2020  attr, roi).     
+0004a1a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0004a1b0: 2020 2020 2067 6574 6174 7472 2873 656c       getattr(sel
+0004a1c0: 662c 2061 7474 7229 5b65 7863 6c75 6465  f, attr)[exclude
+0004a1d0: 5d20 3d20 726f 690a 2020 2020 2020 2020  ] = roi.        
+0004a1e0: 7265 7475 726e 2072 6f69 0a0a 2020 2020  return roi..    
+0004a1f0: 6465 6620 6765 745f 636f 6e73 656e 7375  def get_consensu
+0004a200: 7328 7365 6c66 2c20 636f 6e73 656e 7375  s(self, consensu
+0004a210: 735f 7479 7065 2c20 636f 6c6f 723d 2262  s_type, color="b
+0004a220: 6c75 6522 2c20 2a2a 6b77 6172 6773 293a  lue", **kwargs):
+0004a230: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
+0004a240: 636f 6e73 656e 7375 7320 6361 6c63 756c  consensus calcul
+0004a250: 6174 696f 6e20 6675 6e63 7469 6f6e 0a20  ation function. 
+0004a260: 2020 2020 2020 2069 6620 636f 6e73 656e         if consen
+0004a270: 7375 735f 7479 7065 203d 3d20 226d 616a  sus_type == "maj
+0004a280: 6f72 6974 7922 3a0a 2020 2020 2020 2020  ority":.        
+0004a290: 2020 2020 636f 6e73 656e 7375 735f 6675      consensus_fu
+0004a2a0: 6e63 203d 2053 7472 7563 7475 7265 5365  nc = StructureSe
+0004a2b0: 742e 6765 745f 6d61 6a6f 7269 7479 5f76  t.get_majority_v
+0004a2c0: 6f74 650a 2020 2020 2020 2020 656c 6966  ote.        elif
+0004a2d0: 2063 6f6e 7365 6e73 7573 5f74 7970 6520   consensus_type 
+0004a2e0: 3d3d 2022 7375 6d22 3a0a 2020 2020 2020  == "sum":.      
+0004a2f0: 2020 2020 2020 636f 6e73 656e 7375 735f        consensus_
+0004a300: 6675 6e63 203d 2053 7472 7563 7475 7265  func = Structure
+0004a310: 5365 742e 6765 745f 7375 6d0a 2020 2020  Set.get_sum.    
+0004a320: 2020 2020 656c 6966 2063 6f6e 7365 6e73      elif consens
+0004a330: 7573 5f74 7970 6520 3d3d 2022 6f76 6572  us_type == "over
+0004a340: 6c61 7022 3a0a 2020 2020 2020 2020 2020  lap":.          
+0004a350: 2020 636f 6e73 656e 7375 735f 6675 6e63    consensus_func
+0004a360: 203d 2053 7472 7563 7475 7265 5365 742e   = StructureSet.
+0004a370: 6765 745f 6f76 6572 6c61 700a 2020 2020  get_overlap.    
+0004a380: 2020 2020 656c 6966 2063 6f6e 7365 6e73      elif consens
+0004a390: 7573 5f74 7970 6520 3d3d 2022 7374 6170  us_type == "stap
+0004a3a0: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
+0004a3b0: 2063 6f6e 7365 6e73 7573 5f66 756e 6320   consensus_func 
+0004a3c0: 3d20 5374 7275 6374 7572 6553 6574 2e67  = StructureSet.g
+0004a3d0: 6574 5f73 7461 706c 650a 2020 2020 2020  et_staple.      
+0004a3e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0004a3f0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0004a400: 7272 6f72 2866 2255 6e72 6563 6f67 6e69  rror(f"Unrecogni
+0004a410: 7365 6420 636f 6e73 656e 7375 7320 7479  sed consensus ty
+0004a420: 7065 3a20 7b63 6f6e 7365 6e73 7573 5f74  pe: {consensus_t
+0004a430: 7970 657d 2229 0a0a 2020 2020 2020 2020  ype}")..        
+0004a440: 7265 7475 726e 2063 6f6e 7365 6e73 7573  return consensus
+0004a450: 5f66 756e 6328 7365 6c66 2c20 636f 6c6f  _func(self, colo
+0004a460: 723d 636f 6c6f 722c 202a 2a6b 7761 7267  r=color, **kwarg
+0004a470: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
+0004a480: 7374 6170 6c65 2873 656c 662c 2066 6f72  staple(self, for
+0004a490: 6365 3d46 616c 7365 2c20 6578 636c 7564  ce=False, exclud
+0004a4a0: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
+0004a4b0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0004a4c0: 7420 524f 4920 6f62 6a65 6374 2072 6570  t ROI object rep
+0004a4d0: 7265 7365 6e74 696e 6720 7468 6520 5354  resenting the ST
+0004a4e0: 4150 4c45 2063 6f6d 6269 6e61 7469 6f6e  APLE combination
+0004a4f0: 206f 6620 524f 4973 2069 6e20 7468 6973   of ROIs in this
+0004a500: 200a 2020 2020 2020 2020 7374 7275 6374   .        struct
+0004a510: 7572 6520 7365 742e 2049 6620 3c65 7863  ure set. If <exc
+0004a520: 6c75 6465 3e20 6973 2073 6574 2074 6f20  lude> is set to 
+0004a530: 6120 7374 7269 6e67 2c20 7468 6520 524f  a string, the RO
+0004a540: 4920 7769 7468 2074 6861 7420 6e61 6d65  I with that name
+0004a550: 200a 2020 2020 2020 2020 7769 6c6c 2062   .        will b
+0004a560: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
+0004a570: 7468 6520 6361 6c63 756c 6174 696f 6e2e  the calculation.
+0004a580: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
+0004a590: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
+0004a5a0: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
+0004a5b0: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+0004a5c0: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
+0004a5d0: 6c73 6520 616e 6420 5354 4150 4c45 2052  lse and STAPLE R
+0004a5e0: 4f49 2068 6173 2061 6c72 6561 6479 2062  OI has already b
+0004a5f0: 6565 6e20 6372 6561 7465 642c 2074 6865  een created, the
+0004a600: 200a 2020 2020 2020 2020 2020 2020 7072   .            pr
+0004a610: 6576 696f 7573 6c79 2063 6f6d 7075 7465  eviously compute
+0004a620: 6420 524f 4920 7769 6c6c 2062 6520 7265  d ROI will be re
+0004a630: 7475 726e 6564 2e20 4966 2046 6f72 6365  turned. If Force
+0004a640: 3d54 7275 652c 2074 6865 200a 2020 2020  =True, the .    
+0004a650: 2020 2020 2020 2020 5354 4150 4c45 2052          STAPLE R
+0004a660: 4f49 2077 696c 6c20 6265 2072 6563 7265  OI will be recre
+0004a670: 6174 6564 2e0a 0a20 2020 2020 2020 2065  ated...        e
+0004a680: 7863 6c75 6465 203a 2073 7472 2c20 6465  xclude : str, de
+0004a690: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0004a6a0: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
+0004a6b0: 2061 2073 7472 696e 672c 2074 6865 2066   a string, the f
+0004a6c0: 6972 7374 2052 4f49 2069 6e20 7365 6c66  irst ROI in self
+0004a6d0: 2e72 6f69 7320 7769 7468 2074 6861 7420  .rois with that 
+0004a6e0: 6e61 6d65 2077 696c 6c20 0a20 2020 2020  name will .     
+0004a6f0: 2020 2020 2020 2062 6520 6578 636c 7564         be exclud
+0004a700: 6564 2066 726f 6d20 7468 6520 636f 6d62  ed from the comb
+0004a710: 696e 6174 696f 6e2e 2054 6869 7320 6d61  ination. This ma
+0004a720: 7920 6265 2075 7365 6675 6c20 6966 2063  y be useful if c
+0004a730: 6f6d 7061 7269 736f 6e20 0a20 2020 2020  omparison .     
+0004a740: 2020 2020 2020 206f 6620 6120 7369 6e67         of a sing
+0004a750: 6c65 2052 4f49 2077 6974 6820 7468 6520  le ROI with the 
+0004a760: 636f 6e73 656e 7375 7320 6f66 2061 6c6c  consensus of all
+0004a770: 206f 7468 6572 7320 6973 2064 6573 6972   others is desir
+0004a780: 6564 2e0a 0a20 2020 2020 2020 2060 2a2a  ed...        `**
+0004a790: 606b 7761 7267 7320 3a0a 2020 2020 2020  `kwargs :.      
+0004a7a0: 2020 2020 2020 4578 7472 6120 6b65 7977        Extra keyw
+0004a7b0: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
+0004a7c0: 2070 6173 7320 746f 2074 6865 2063 7265   pass to the cre
+0004a7d0: 6174 696f 6e20 6f66 2074 6865 2052 4f49  ation of the ROI
+0004a7e0: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
+0004a7f0: 2020 2020 7265 7072 6573 656e 7469 6e67      representing
+0004a800: 2074 6865 2063 6f6d 6269 6e61 7469 6f6e   the combination
+0004a810: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0004a820: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0004a830: 6c66 2e5f 6765 745f 636f 6d62 696e 6174  lf._get_combinat
+0004a840: 696f 6e28 2273 7461 706c 6522 2c20 666f  ion("staple", fo
+0004a850: 7263 652c 2065 7863 6c75 6465 2c20 6372  rce, exclude, cr
+0004a860: 6561 7465 5f73 7461 706c 652c 0a20 2020  eate_staple,.   
+0004a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a890: 2020 2a2a 6b77 6172 6773 290a 0a20 2020    **kwargs)..   
+0004a8a0: 2064 6566 2067 6574 5f6d 616a 6f72 6974   def get_majorit
+0004a8b0: 795f 766f 7465 2873 656c 662c 2066 6f72  y_vote(self, for
+0004a8c0: 6365 3d46 616c 7365 2c20 6578 636c 7564  ce=False, exclud
+0004a8d0: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
+0004a8e0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0004a8f0: 7420 524f 4920 6f62 6a65 6374 2072 6570  t ROI object rep
+0004a900: 7265 7365 6e74 696e 6720 7468 6520 6d61  resenting the ma
+0004a910: 6a6f 7269 7479 2076 6f74 6520 636f 6d62  jority vote comb
+0004a920: 696e 6174 696f 6e20 6f66 2052 4f49 7320  ination of ROIs 
+0004a930: 696e 200a 2020 2020 2020 2020 7468 6973  in .        this
+0004a940: 2073 7472 7563 7475 7265 2073 6574 2e20   structure set. 
+0004a950: 4966 203c 6578 636c 7564 653e 2069 7320  If <exclude> is 
+0004a960: 7365 7420 746f 2061 2073 7472 696e 672c  set to a string,
+0004a970: 2074 6865 2052 4f49 2077 6974 6820 7468   the ROI with th
+0004a980: 6174 200a 2020 2020 2020 2020 6e61 6d65  at .        name
+0004a990: 2077 696c 6c20 6265 2065 7863 6c75 6465   will be exclude
+0004a9a0: 6420 6672 6f6d 2074 6865 2063 616c 6375  d from the calcu
+0004a9b0: 6c61 7469 6f6e 2e0a 0a20 2020 2020 2020  lation...       
+0004a9c0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0004a9d0: 0a0a 2020 2020 2020 2020 666f 7263 6520  ..        force 
+0004a9e0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+0004a9f0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0004aa00: 2020 4966 2046 616c 7365 2061 6e64 206d    If False and m
+0004aa10: 616a 6f72 6974 7920 766f 7465 2052 4f49  ajority vote ROI
+0004aa20: 2068 6173 2061 6c72 6561 6479 2062 6565   has already bee
+0004aa30: 6e20 6372 6561 7465 642c 2074 6865 200a  n created, the .
+0004aa40: 2020 2020 2020 2020 2020 2020 7072 6576              prev
+0004aa50: 696f 7573 6c79 2063 6f6d 7075 7465 6420  iously computed 
+0004aa60: 524f 4920 7769 6c6c 2062 6520 7265 7475  ROI will be retu
+0004aa70: 726e 6564 2e20 4966 2046 6f72 6365 3d54  rned. If Force=T
+0004aa80: 7275 652c 2074 6865 200a 2020 2020 2020  rue, the .      
+0004aa90: 2020 2020 2020 6d61 6a6f 7269 7479 2076        majority v
+0004aaa0: 6f74 6520 524f 4920 7769 6c6c 2062 6520  ote ROI will be 
+0004aab0: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
+0004aac0: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
+0004aad0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0004aae0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+0004aaf0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+0004ab00: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
+0004ab10: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
+0004ab20: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
+0004ab30: 2020 2020 2020 2020 2020 2020 6265 2065              be e
+0004ab40: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
+0004ab50: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
+0004ab60: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
+0004ab70: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
+0004ab80: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
+0004ab90: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
+0004aba0: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
+0004abb0: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
+0004abc0: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
+0004abd0: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
+0004abe0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
+0004abf0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0004ac00: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
+0004ac10: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
+0004ac20: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
+0004ac30: 2020 2020 2020 2020 2072 6570 7265 7365           represe
+0004ac40: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
+0004ac50: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
+0004ac60: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+0004ac70: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
+0004ac80: 6269 6e61 7469 6f6e 2822 6d61 6a6f 7269  bination("majori
+0004ac90: 7479 5f76 6f74 6522 2c20 666f 7263 652c  ty_vote", force,
+0004aca0: 2065 7863 6c75 6465 2c20 0a20 2020 2020   exclude, .     
+0004acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004acd0: 6372 6561 7465 5f6d 616a 6f72 6974 795f  create_majority_
+0004ace0: 766f 7465 2c20 2a2a 6b77 6172 6773 290a  vote, **kwargs).
+0004acf0: 0a20 2020 2064 6566 2067 6574 5f73 756d  .    def get_sum
+0004ad00: 2873 656c 662c 2066 6f72 6365 3d46 616c  (self, force=Fal
+0004ad10: 7365 2c20 6578 636c 7564 653d 4e6f 6e65  se, exclude=None
+0004ad20: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+0004ad30: 2020 2020 2022 2222 4765 7420 524f 4920       """Get ROI 
+0004ad40: 6f62 6a65 6374 2072 6570 7265 7365 6e74  object represent
+0004ad50: 696e 6720 7468 6520 7375 6d20 6f66 2052  ing the sum of R
+0004ad60: 4f49 7320 696e 2074 6869 7320 7374 7275  OIs in this stru
+0004ad70: 6374 7572 6520 7365 742e 200a 2020 2020  cture set. .    
+0004ad80: 2020 2020 4966 203c 6578 636c 7564 653e      If <exclude>
+0004ad90: 2069 7320 7365 7420 746f 2061 2073 7472   is set to a str
+0004ada0: 696e 672c 2074 6865 2052 4f49 2077 6974  ing, the ROI wit
+0004adb0: 6820 7468 6174 206e 616d 6520 7769 6c6c  h that name will
+0004adc0: 2062 6520 0a20 2020 2020 2020 2065 7863   be .        exc
+0004add0: 6c75 6465 6420 6672 6f6d 2074 6865 2063  luded from the c
+0004ade0: 616c 6375 6c61 7469 6f6e 2e0a 0a20 2020  alculation...   
+0004adf0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+0004ae00: 733a 2a2a 0a0a 2020 2020 2020 2020 666f  s:**..        fo
+0004ae10: 7263 6520 3a20 626f 6f6c 2c20 6465 6661  rce : bool, defa
+0004ae20: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+0004ae30: 2020 2020 2020 4966 2046 616c 7365 2061        If False a
+0004ae40: 6e64 2073 756d 2052 4f49 2068 6173 2061  nd sum ROI has a
+0004ae50: 6c72 6561 6479 2062 6565 6e20 6372 6561  lready been crea
+0004ae60: 7465 642c 2074 6865 200a 2020 2020 2020  ted, the .      
+0004ae70: 2020 2020 2020 7072 6576 696f 7573 6c79        previously
+0004ae80: 2063 6f6d 7075 7465 6420 524f 4920 7769   computed ROI wi
+0004ae90: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
+0004aea0: 4966 2046 6f72 6365 3d54 7275 652c 2074  If Force=True, t
+0004aeb0: 6865 200a 2020 2020 2020 2020 2020 2020  he .            
+0004aec0: 7375 6d20 524f 4920 7769 6c6c 2062 6520  sum ROI will be 
+0004aed0: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
+0004aee0: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
+0004aef0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0004af00: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+0004af10: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+0004af20: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
+0004af30: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
+0004af40: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
+0004af50: 2020 2020 2020 2020 2020 2020 6265 2065              be e
+0004af60: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
+0004af70: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
+0004af80: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
+0004af90: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
+0004afa0: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
+0004afb0: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
+0004afc0: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
+0004afd0: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
+0004afe0: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
+0004aff0: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
+0004b000: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
+0004b010: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0004b020: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
+0004b030: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
+0004b040: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
+0004b050: 2020 2020 2020 2020 2072 6570 7265 7365           represe
+0004b060: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
+0004b070: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
+0004b080: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+0004b090: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
+0004b0a0: 6269 6e61 7469 6f6e 2822 7375 6d22 2c20  bination("sum", 
+0004b0b0: 666f 7263 652c 2065 7863 6c75 6465 2c20  force, exclude, 
+0004b0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b0e0: 2020 2020 2020 6372 6561 7465 5f72 6f69        create_roi
+0004b0f0: 5f73 756d 2c20 2a2a 6b77 6172 6773 290a  _sum, **kwargs).
+0004b100: 0a20 2020 2064 6566 2067 6574 5f6f 7665  .    def get_ove
+0004b110: 726c 6170 2873 656c 662c 2066 6f72 6365  rlap(self, force
+0004b120: 3d46 616c 7365 2c20 6578 636c 7564 653d  =False, exclude=
+0004b130: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+0004b140: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+0004b150: 524f 4920 6f62 6a65 6374 2072 6570 7265  ROI object repre
+0004b160: 7365 6e74 696e 6720 7468 6520 6f76 6572  senting the over
+0004b170: 6c61 7020 6f66 2052 4f49 7320 696e 2074  lap of ROIs in t
+0004b180: 6869 7320 0a20 2020 2020 2020 2073 7472  his .        str
+0004b190: 7563 7475 7265 2073 6574 2e20 4966 203c  ucture set. If <
+0004b1a0: 6578 636c 7564 653e 2069 7320 7365 7420  exclude> is set 
+0004b1b0: 746f 2061 2073 7472 696e 672c 2074 6865  to a string, the
+0004b1c0: 2052 4f49 2077 6974 6820 7468 6174 206e   ROI with that n
+0004b1d0: 616d 6520 0a20 2020 2020 2020 2077 696c  ame .        wil
+0004b1e0: 6c20 6265 2065 7863 6c75 6465 6420 6672  l be excluded fr
+0004b1f0: 6f6d 2074 6865 2063 616c 6375 6c61 7469  om the calculati
+0004b200: 6f6e 2e0a 0a20 2020 2020 2020 202a 2a50  on...        **P
+0004b210: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
+0004b220: 2020 2020 2020 666f 7263 6520 3a20 626f        force : bo
+0004b230: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+0004b240: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+0004b250: 2046 616c 7365 2061 6e64 206f 7665 726c   False and overl
+0004b260: 6170 2052 4f49 2068 6173 2061 6c72 6561  ap ROI has alrea
+0004b270: 6479 2062 6565 6e20 6372 6561 7465 642c  dy been created,
+0004b280: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
+0004b290: 2020 7072 6576 696f 7573 6c79 2063 6f6d    previously com
+0004b2a0: 7075 7465 6420 524f 4920 7769 6c6c 2062  puted ROI will b
+0004b2b0: 6520 7265 7475 726e 6564 2e20 4966 2046  e returned. If F
+0004b2c0: 6f72 6365 3d54 7275 652c 2074 6865 200a  orce=True, the .
+0004b2d0: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+0004b2e0: 6c61 7020 524f 4920 7769 6c6c 2062 6520  lap ROI will be 
+0004b2f0: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
+0004b300: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
+0004b310: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0004b320: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+0004b330: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+0004b340: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
+0004b350: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
+0004b360: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
+0004b370: 2020 2020 2020 2020 2020 2020 6265 2065              be e
+0004b380: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
+0004b390: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
+0004b3a0: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
+0004b3b0: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
+0004b3c0: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
+0004b3d0: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
+0004b3e0: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
+0004b3f0: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
+0004b400: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
+0004b410: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
+0004b420: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
+0004b430: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0004b440: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
+0004b450: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
+0004b460: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
+0004b470: 2020 2020 2020 2020 2072 6570 7265 7365           represe
+0004b480: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
+0004b490: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
+0004b4a0: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+0004b4b0: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
+0004b4c0: 6269 6e61 7469 6f6e 2822 6f76 6572 6c61  bination("overla
+0004b4d0: 7022 2c20 666f 7263 652c 2065 7863 6c75  p", force, exclu
+0004b4e0: 6465 2c20 0a20 2020 2020 2020 2020 2020  de, .           
+0004b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b500: 2020 2020 2020 2020 2020 6372 6561 7465            create
+0004b510: 5f72 6f69 5f6f 7665 726c 6170 2c20 2a2a  _roi_overlap, **
+0004b520: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
+0004b530: 2074 7261 6e73 666f 726d 2873 656c 662c   transform(self,
+0004b540: 2073 6361 6c65 3d31 2c20 7472 616e 736c   scale=1, transl
+0004b550: 6174 696f 6e3d 5b30 2c20 302c 2030 5d2c  ation=[0, 0, 0],
+0004b560: 2072 6f74 6174 696f 6e3d 5b30 2c20 302c   rotation=[0, 0,
+0004b570: 2030 5d2c 0a20 2020 2020 2020 2020 2020   0],.           
+0004b580: 2063 656e 7472 653d 5b30 2c20 302c 2030   centre=[0, 0, 0
+0004b590: 5d2c 2072 6573 616d 706c 653d 2266 696e  ], resample="fin
+0004b5a0: 6522 2c20 7265 7374 6f72 653d 5472 7565  e", restore=True
+0004b5b0: 2c20 0a20 2020 2020 2020 2020 2020 2066  , .            f
+0004b5c0: 696c 6c5f 7661 6c75 653d 4e6f 6e65 2c20  ill_value=None, 
+0004b5d0: 666f 7263 655f 636f 6e74 6f75 7273 3d46  force_contours=F
+0004b5e0: 616c 7365 2c20 6e61 6d65 733d 4e6f 6e65  alse, names=None
+0004b5f0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0004b600: 2020 2020 2020 2041 7070 6c79 2074 6872         Apply thr
+0004b610: 6565 2d64 696d 656e 7369 6f6e 616c 2073  ee-dimensional s
+0004b620: 696d 696c 6172 6974 7920 7472 616e 7366  imilarity transf
+0004b630: 6f72 6d20 746f 2073 7472 7563 7475 7265  orm to structure
+0004b640: 2d73 6574 2052 4f49 732e 0a0a 2020 2020  -set ROIs...    
+0004b650: 2020 2020 4966 2074 6865 2074 7261 6e73      If the trans
+0004b660: 666f 726d 2063 6f72 7265 7370 6f6e 6473  form corresponds
+0004b670: 2074 6f20 6120 7472 616e 736c 6174 696f   to a translatio
+0004b680: 6e20 616e 642f 6f72 2072 6f74 6174 696f  n and/or rotatio
+0004b690: 6e0a 2020 2020 2020 2020 6162 6f75 7420  n.        about 
+0004b6a0: 7468 6520 7a2d 6178 6973 2c20 616e 6420  the z-axis, and 
+0004b6b0: 6569 7468 6572 2074 6865 2072 6f69 2073  either the roi s
+0004b6c0: 6f75 7263 6520 7479 7065 2069 7320 2264  ource type is "d
+0004b6d0: 6963 6f6d 220a 2020 2020 2020 2020 6f72  icom".        or
+0004b6e0: 2066 6f72 6365 2d63 6f6e 746f 7572 7320   force-contours 
+0004b6f0: 6973 2054 7275 652c 2074 6865 2074 7261  is True, the tra
+0004b700: 6e73 666f 726d 2069 7320 6170 706c 6965  nsform is applie
+0004b710: 6420 746f 2063 6f6e 746f 7572 0a20 2020  d to contour.   
+0004b720: 2020 2020 2070 6f69 6e74 7320 616e 6420       points and 
+0004b730: 7468 6520 726f 6920 6d61 736b 2069 7320  the roi mask is 
+0004b740: 7365 7420 6173 2075 6e6c 6f61 6465 642e  set as unloaded.
+0004b750: 2020 4f74 6865 7277 6973 6520 7468 6520    Otherwise the 
+0004b760: 7472 616e 7366 6f72 6d0a 2020 2020 2020  transform.      
+0004b770: 2020 6973 2061 7070 6c69 6564 2074 6f20    is applied to 
+0004b780: 7468 6520 6d61 736b 2061 6e64 2063 6f6e  the mask and con
+0004b790: 746f 7572 7320 6172 6520 7365 7420 6173  tours are set as
+0004b7a0: 2075 6e6c 6f61 6465 642e 0a0a 2020 2020   unloaded...    
+0004b7b0: 2020 2020 5468 6520 7472 616e 7366 6f72      The transfor
+0004b7c0: 6d20 6973 2061 7070 6c69 6564 2069 6e20  m is applied in 
+0004b7d0: 7468 6520 6f72 6465 723a 2074 7261 6e73  the order: trans
+0004b7e0: 6c61 7469 6f6e 2c20 7363 616c 696e 672c  lation, scaling,
+0004b7f0: 0a20 2020 2020 2020 2072 6f74 6174 696f  .        rotatio
+0004b800: 6e2e 2020 5468 6520 6c61 7474 6572 2074  n.  The latter t
+0004b810: 776f 2061 7265 2061 626f 7574 2074 6865  wo are about the
+0004b820: 2063 656e 7472 6520 636f 6f72 6469 6e61   centre coordina
+0004b830: 7465 732e 0a0a 2020 2020 2020 2020 2a2a  tes...        **
+0004b840: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
+0004b850: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
+0004b860: 6f72 6365 5f63 6f6e 746f 7572 7320 3a20  orce_contours : 
+0004b870: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+0004b880: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0004b890: 4966 2054 7275 652c 2061 6e64 2074 6865  If True, and the
+0004b8a0: 2074 7261 6e73 666f 726d 2063 6f72 7265   transform corre
+0004b8b0: 7370 6f6e 6473 2074 6f20 6120 7472 616e  sponds to a tran
+0004b8c0: 736c 6174 696f 6e0a 2020 2020 2020 2020  slation.        
+0004b8d0: 2020 2020 616e 642f 6f72 2072 6f74 6174      and/or rotat
+0004b8e0: 696f 6e20 6162 6f75 7420 7468 6520 7a2d  ion about the z-
+0004b8f0: 6178 6973 2c20 6170 706c 7920 7472 616e  axis, apply tran
+0004b900: 7366 6f72 6d20 746f 2063 6f6e 746f 7572  sform to contour
+0004b910: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
+0004b920: 6e74 7320 696e 6465 7065 6e64 656e 746c  nts independentl
+0004b930: 7920 6f66 2074 6865 206f 7269 6769 6e61  y of the origina
+0004b940: 6c20 6461 7461 2073 6f75 7263 652e 0a0a  l data source...
+0004b950: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
+0004b960: 6c69 7374 2f4e 6f6e 652c 2064 6566 6175  list/None, defau
+0004b970: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+0004b980: 2020 2020 204c 6973 7420 6f66 2052 4f49       List of ROI
+0004b990: 7320 746f 2077 6869 6368 2074 7261 6e73  s to which trans
+0004b9a0: 666f 726d 2069 7320 746f 2062 6520 6170  form is to be ap
+0004b9b0: 706c 6965 642e 2020 4966 204e 6f6e 652c  plied.  If None,
+0004b9c0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+0004b9d0: 6e73 666f 726d 2069 7320 6170 706c 6965  nsform is applie
+0004b9e0: 6420 746f 2061 6c6c 2052 4f49 732e 0a0a  d to all ROIs...
+0004b9f0: 2020 2020 2020 2020 466f 7220 6f74 6865          For othe
+0004ba00: 7220 7061 7261 6d65 7465 7273 2c20 7365  r parameters, se
+0004ba10: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
+0004ba20: 666f 720a 2020 2020 2020 2020 736b 7274  for.        skrt
+0004ba30: 2e69 6d61 6765 2e49 6d61 6765 2e74 7261  .image.Image.tra
+0004ba40: 6e73 666f 726d 2829 2e20 204e 6f74 6520  nsform().  Note 
+0004ba50: 7468 6174 2074 6865 2060 606f 7264 6572  that the ``order
+0004ba60: 6060 0a20 2020 2020 2020 2070 6172 616d  ``.        param
+0004ba70: 6574 6572 2069 736e 2774 2061 7661 696c  eter isn't avail
+0004ba80: 6162 6c65 2066 6f72 2073 7472 7563 7475  able for structu
+0004ba90: 7265 2d73 6574 2074 7261 6e73 666f 726d  re-set transform
+0004baa0: 7320 2d20 6120 7661 6c75 6520 6f66 2030  s - a value of 0
+0004bab0: 0a20 2020 2020 2020 2069 7320 7573 6564  .        is used
+0004bac0: 2061 6c77 6179 732e 0a20 2020 2020 2020   always..       
+0004bad0: 2022 2222 0a0a 2020 2020 2020 2020 666f   """..        fo
+0004bae0: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
+0004baf0: 745f 726f 6973 286e 616d 6573 293a 0a20  t_rois(names):. 
+0004bb00: 2020 2020 2020 2020 2020 2072 6f69 2e74             roi.t
+0004bb10: 7261 6e73 666f 726d 2873 6361 6c65 2c20  ransform(scale, 
+0004bb20: 7472 616e 736c 6174 696f 6e2c 2072 6f74  translation, rot
+0004bb30: 6174 696f 6e2c 2063 656e 7472 652c 2072  ation, centre, r
+0004bb40: 6573 616d 706c 652c 0a20 2020 2020 2020  esample,.       
+0004bb50: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0004bb60: 746f 7265 2c20 6669 6c6c 5f76 616c 7565  tore, fill_value
+0004bb70: 2c20 666f 7263 655f 636f 6e74 6f75 7273  , force_contours
+0004bb80: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0004bb90: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
+0004bba0: 6164 645f 706c 616e 2873 656c 662c 2070  add_plan(self, p
+0004bbb0: 6c61 6e29 3a0a 2020 2020 2020 2020 2222  lan):.        ""
+0004bbc0: 2241 6464 2061 2050 6c61 6e20 6f62 6a65  "Add a Plan obje
+0004bbd0: 6374 2074 6f20 6265 2061 7373 6f63 6961  ct to be associa
+0004bbe0: 7465 6420 7769 7468 2074 6869 7320 7374  ted with this st
+0004bbf0: 7275 6374 7572 6520 7365 7420 616e 640a  ructure set and.
+0004bc00: 2020 2020 2020 2020 6974 7320 524f 4973          its ROIs
+0004bc10: 2e20 5468 6973 2064 6f65 7320 6e6f 7420  . This does not 
+0004bc20: 6166 6665 6374 2074 6865 2073 7472 7563  affect the struc
+0004bc30: 7475 7265 2073 6574 2061 7373 6f63 6961  ture set associa
+0004bc40: 7465 6420 7769 7468 0a20 2020 2020 2020  ted with.       
+0004bc50: 2074 6865 2050 6c61 6e20 6f62 6a65 6374   the Plan object
+0004bc60: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0004bc70: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+0004bc80: 2020 2020 706c 616e 203a 2073 6b72 742e      plan : skrt.
+0004bc90: 646f 7365 2e50 6c61 6e0a 2020 2020 2020  dose.Plan.      
+0004bca0: 2020 2020 2020 4120 506c 616e 206f 626a        A Plan obj
+0004bcb0: 6563 7420 746f 2061 7373 6967 6e20 746f  ect to assign to
+0004bcc0: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
+0004bcd0: 7365 742e 0a20 2020 2020 2020 2022 2222  set..        """
+0004bce0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0004bcf0: 2070 6c61 6e20 696e 2073 656c 662e 706c   plan in self.pl
+0004bd00: 616e 733a 0a20 2020 2020 2020 2020 2020  ans:.           
+0004bd10: 2073 656c 662e 706c 616e 732e 6170 7065   self.plans.appe
+0004bd20: 6e64 2870 6c61 6e29 0a20 2020 2020 2020  nd(plan).       
+0004bd30: 2020 2020 2073 656c 662e 706c 616e 732e       self.plans.
+0004bd40: 736f 7274 2829 0a0a 2020 2020 2020 2020  sort()..        
+0004bd50: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
+0004bd60: 656c 662e 726f 6973 3a0a 2020 2020 2020  elf.rois:.      
+0004bd70: 2020 2020 2020 2020 2020 726f 692e 6164            roi.ad
+0004bd80: 645f 706c 616e 2870 6c61 6e29 0a0a 2020  d_plan(plan)..  
+0004bd90: 2020 6465 6620 636c 6561 725f 706c 616e    def clear_plan
+0004bda0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0004bdb0: 2022 2222 436c 6561 7220 616c 6c20 706c   """Clear all pl
+0004bdc0: 616e 206d 6170 7320 6173 736f 6369 6174  an maps associat
+0004bdd0: 6564 2077 6974 6820 7468 6973 2073 7472  ed with this str
+0004bde0: 7563 7475 7265 2073 6574 2e22 2222 0a0a  ucture set."""..
+0004bdf0: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
+0004be00: 6e73 203d 205b 5d0a 0a20 2020 2064 6566  ns = []..    def
+0004be10: 2067 6574 5f70 6c61 6e73 2873 656c 6629   get_plans(self)
+0004be20: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0004be30: 7572 6e20 6c69 7374 206f 6620 506c 616e  urn list of Plan
+0004be40: 206f 626a 6563 7473 2061 7373 6f63 6961   objects associa
+0004be50: 7465 6420 7769 7468 2074 6869 7320 7374  ted with this st
+0004be60: 7275 6374 7572 6520 7365 742e 2222 220a  ructure set.""".
+0004be70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004be80: 7365 6c66 2e70 6c61 6e73 0a0a 2020 2020  self.plans..    
+0004be90: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
+0004bea0: 706f 696e 7473 2873 656c 662c 206e 5f70  points(self, n_p
+0004beb0: 6f69 6e74 3d4e 6f6e 652c 2064 7879 3d4e  oint=None, dxy=N
+0004bec0: 6f6e 652c 0a20 2020 2020 2020 2073 6d6f  one,.        smo
+0004bed0: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0004bee0: 743d 3029 3a0a 2020 2020 2020 2020 2727  t=0):.        ''
+0004bef0: 270a 2020 2020 2020 2020 5265 7475 726e  '.        Return
+0004bf00: 206e 6577 2053 7472 7563 7475 7265 5365   new StructureSe
+0004bf10: 7420 6f62 6a65 6374 2c20 7769 7468 2069  t object, with i
+0004bf20: 6e74 6572 706f 6c61 7465 6420 636f 6e74  nterpolated cont
+0004bf30: 6f75 7220 706f 696e 7473 2e0a 0a20 2020  our points...   
+0004bf40: 2020 2020 2050 6f69 6e74 7320 6172 6520       Points are 
+0004bf50: 696e 7465 7270 6f6c 6174 6564 2066 6f72  interpolated for
+0004bf60: 2065 6163 6820 636f 6e74 6f75 7220 6f66   each contour of
+0004bf70: 2065 6163 6820 524f 492e 0a0a 2020 2020   each ROI...    
+0004bf80: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+0004bf90: 3a2a 2a0a 0a20 2020 2020 2020 206e 5f70  :**..        n_p
+0004bfa0: 6f69 6e74 203a 2069 6e74 2c20 6465 6661  oint : int, defa
+0004bfb0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0004bfc0: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
+0004bfd0: 6f69 6e74 7320 7065 7220 636f 6e74 6f75  oints per contou
+0004bfe0: 722c 2061 6674 6572 2069 6e74 6572 706f  r, after interpo
+0004bff0: 6c61 7469 6f6e 2e20 2054 6869 7320 6d75  lation.  This mu
+0004c000: 7374 0a20 2020 2020 2020 2020 2020 2062  st.            b
+0004c010: 6520 7365 7420 746f 204e 6f6e 6520 666f  e set to None fo
+0004c020: 7220 6478 7920 746f 2062 6520 636f 6e73  r dxy to be cons
+0004c030: 6964 6572 6564 2e0a 0a20 2020 2020 2020  idered...       
+0004c040: 2064 7879 203a 2066 6c6f 6174 2c20 6465   dxy : float, de
+0004c050: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0004c060: 2020 2020 2020 2041 7070 726f 7869 6d61         Approxima
+0004c070: 7465 2064 6973 7461 6e63 6520 7265 7175  te distance requ
+0004c080: 6972 6564 2062 6574 7765 656e 2063 6f6e  ired between con
+0004c090: 746f 7572 2070 6f69 6e74 732e 2020 5468  tour points.  Th
+0004c0a0: 6973 2069 7320 7461 6b65 6e0a 2020 2020  is is taken.    
+0004c0b0: 2020 2020 2020 2020 696e 746f 2061 6363          into acc
+0004c0c0: 6f75 6e74 206f 6e6c 7920 6966 206e 5f70  ount only if n_p
+0004c0d0: 6f69 6e74 2069 7320 7365 7420 746f 204e  oint is set to N
+0004c0e0: 6f6e 652e 2020 466f 7220 6120 636f 6e74  one.  For a cont
+0004c0f0: 6f75 7220 6f66 0a20 2020 2020 2020 2020  our of.         
+0004c100: 2020 206c 656e 6774 6820 636f 6e74 6f75     length contou
+0004c110: 725f 6c65 6e67 7468 2c20 7468 6520 6e75  r_length, the nu
+0004c120: 6d62 6572 206f 6620 636f 6e74 6f75 7220  mber of contour 
+0004c130: 706f 696e 7473 2069 7320 7468 656e 2074  points is then t
+0004c140: 616b 656e 0a20 2020 2020 2020 2020 2020  aken.           
+0004c150: 2074 6f20 6265 206d 6178 2869 6e74 2863   to be max(int(c
+0004c160: 6f6e 746f 7572 5f6c 656e 6774 6820 2f20  ontour_length / 
+0004c170: 6478 7929 2c20 3329 2e20 200a 0a20 2020  dxy), 3).  ..   
+0004c180: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
+0004c190: 7065 725f 706f 696e 7420 3a20 666c 6f61  per_point : floa
+0004c1a0: 742c 2064 6566 6175 6c74 3d30 0a20 2020  t, default=0.   
+0004c1b0: 2020 2020 2020 2020 2050 6172 616d 6574           Paramet
+0004c1c0: 6572 2064 6574 6572 6d69 6e69 6e67 2074  er determining t
+0004c1d0: 6865 2073 6d6f 6f74 686e 6573 7320 6f66  he smoothness of
+0004c1e0: 2074 6865 2042 2d73 706c 696e 6520 6375   the B-spline cu
+0004c1f0: 7276 6520 7573 6564 0a20 2020 2020 2020  rve used.       
+0004c200: 2020 2020 2069 6e20 636f 6e74 6f75 7220       in contour 
+0004c210: 6170 7072 6f78 696d 6174 696f 6e20 666f  approximation fo
+0004c220: 7220 696e 7465 7270 6f6c 6174 696f 6e2e  r interpolation.
+0004c230: 2020 5468 6520 7072 6f64 7563 7420 6f66    The product of
+0004c240: 0a20 2020 2020 2020 2020 2020 2073 6d6f  .            smo
+0004c250: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0004c260: 7420 616e 6420 7468 6520 6e75 6d62 6572  t and the number
+0004c270: 206f 6620 636f 6e74 6f75 7220 706f 696e   of contour poin
+0004c280: 7473 2028 7370 6563 6966 6965 640a 2020  ts (specified.  
+0004c290: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+0004c2a0: 6c79 2076 6961 206e 5f70 6f69 6e74 2c20  ly via n_point, 
+0004c2b0: 6f72 2069 6e64 6972 6563 746c 7920 7669  or indirectly vi
+0004c2c0: 6120 6478 7929 2063 6f72 7265 7370 6f6e  a dxy) correspon
+0004c2d0: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
+0004c2e0: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
+0004c2f0: 7320 6f66 2073 6369 7079 2e69 6e74 6572  s of scipy.inter
+0004c300: 706f 6c61 7465 2e73 706c 7072 6570 202d  polate.splprep -
+0004c310: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
+0004c320: 6f6e 2061 743a 0a20 2020 2020 2020 200a  on at:.        .
+0004c330: 2020 2020 2020 2020 2020 2020 6874 7470              http
+0004c340: 733a 2f2f 7363 6970 792e 6769 7468 7562  s://scipy.github
+0004c350: 2e69 6f2f 6465 7664 6f63 732f 7265 6665  .io/devdocs/refe
+0004c360: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
+0004c370: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
+0004c380: 652e 7370 6c70 7265 702e 6874 6d6c 2373  e.splprep.html#s
+0004c390: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+0004c3a0: 2e73 706c 7072 6570 0a0a 2020 2020 2020  .splprep..      
+0004c3b0: 2020 2020 2020 4120 736d 6f6f 7468 6e65        A smoothne
+0004c3c0: 7373 5f70 6572 5f70 6f69 6e74 206f 6620  ss_per_point of 
+0004c3d0: 3020 666f 7263 6573 2074 6865 2042 2d73  0 forces the B-s
+0004c3e0: 706c 696e 6520 746f 2070 6173 7320 7468  pline to pass th
+0004c3f0: 726f 7567 680a 2020 2020 2020 2020 2020  rough.          
+0004c400: 2020 616c 6c20 6f66 2074 6865 2070 7265    all of the pre
+0004c410: 2d69 6e74 6572 706f 6c61 7469 6f6e 2063  -interpolation c
+0004c420: 6f6e 746f 7572 2070 6f69 6e74 732e 0a20  ontour points.. 
+0004c430: 2020 2020 2020 2027 2727 0a0a 2020 2020         '''..    
+0004c440: 2020 2020 2320 496e 7465 7270 6f6c 6174      # Interpolat
+0004c450: 6520 706f 696e 7473 2066 6f72 2074 6865  e points for the
+0004c460: 2072 6f69 730a 2020 2020 2020 2020 726f   rois.        ro
+0004c470: 6973 203d 205b 5d0a 2020 2020 2020 2020  is = [].        
+0004c480: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
+0004c490: 6765 745f 726f 6973 2829 3a0a 2020 2020  get_rois():.    
+0004c4a0: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
+0004c4b0: 656e 6428 726f 692e 696e 7465 7270 6f6c  end(roi.interpol
+0004c4c0: 6174 655f 706f 696e 7473 280a 2020 2020  ate_points(.    
+0004c4d0: 2020 2020 2020 2020 2020 2020 6e5f 706f              n_po
+0004c4e0: 696e 742c 2064 7879 2c20 736d 6f6f 7468  int, dxy, smooth
+0004c4f0: 6e65 7373 5f70 6572 5f70 6f69 6e74 2929  ness_per_point))
+0004c500: 0a0a 2020 2020 2020 2020 2320 436c 6f6e  ..        # Clon
+0004c510: 6520 7365 6c66 2c20 7468 656e 2072 6573  e self, then res
+0004c520: 6574 2073 6f75 7263 6520 616e 6420 726f  et source and ro
+0004c530: 6973 0a20 2020 2020 2020 2073 7320 3d20  is.        ss = 
+0004c540: 5374 7275 6374 7572 6553 6574 2873 656c  StructureSet(sel
+0004c550: 6629 0a20 2020 2020 2020 2073 732e 736f  f).        ss.so
+0004c560: 7572 6365 7320 3d20 726f 6973 0a20 2020  urces = rois.   
+0004c570: 2020 2020 2073 732e 726f 6973 203d 2072       ss.rois = r
+0004c580: 6f69 730a 0a20 2020 2020 2020 2072 6574  ois..        ret
+0004c590: 7572 6e20 7373 0a0a 2020 2020 6465 6620  urn ss..    def 
+0004c5a0: 6f72 6465 725f 726f 6973 2873 656c 662c  order_rois(self,
+0004c5b0: 206f 7264 6572 3d27 782b 2729 3a0a 2020   order='x+'):.  
+0004c5c0: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+0004c5d0: 2020 4f72 6465 7220 524f 4973 2062 7920    Order ROIs by 
+0004c5e0: 6f6e 6520 6f66 2074 6865 6972 2063 656e  one of their cen
+0004c5f0: 7472 6f69 6420 636f 6f72 6469 6e61 7465  troid coordinate
+0004c600: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
+0004c610: 7261 6d65 7465 723a 2a2a 0a0a 2020 2020  rameter:**..    
+0004c620: 2020 2020 6f72 6465 7220 3a20 7374 722c      order : str,
+0004c630: 2064 6566 6175 6c74 3d27 782b 270a 2020   default='x+'.  
+0004c640: 2020 2020 2020 2020 2020 5370 6563 6966            Specif
+0004c650: 6963 6174 696f 6e20 6f66 2077 6179 2069  ication of way i
+0004c660: 7420 7768 6963 6820 524f 4973 2061 7265  t which ROIs are
+0004c670: 2074 6f20 6265 206f 7264 6572 643a 0a20   to be orderd:. 
+0004c680: 2020 2020 2020 2020 2020 202d 2027 782b             - 'x+
+0004c690: 2720 3a20 696e 206f 7264 6572 206f 6620  ' : in order of 
+0004c6a0: 696e 6372 6561 7369 6e67 2078 2076 616c  increasing x val
+0004c6b0: 7565 2e0a 2020 2020 2020 2020 2020 2020  ue..            
+0004c6c0: 2d20 2778 2d27 203a 2069 6e20 6f72 6465  - 'x-' : in orde
+0004c6d0: 7220 6f66 2064 6563 7265 6173 696e 6720  r of decreasing 
+0004c6e0: 7820 7661 6c75 652e 0a20 2020 2020 2020  x value..       
+0004c6f0: 2020 2020 202d 2027 792b 2720 3a20 696e       - 'y+' : in
+0004c700: 206f 7264 6572 206f 6620 696e 6372 6561   order of increa
+0004c710: 7369 6e67 2079 2076 616c 7565 2e0a 2020  sing y value..  
+0004c720: 2020 2020 2020 2020 2020 2d20 2779 2d27            - 'y-'
+0004c730: 203a 2069 6e20 6f72 6465 7220 6f66 2064   : in order of d
+0004c740: 6563 7265 6173 696e 6720 7920 7661 6c75  ecreasing y valu
+0004c750: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
+0004c760: 2027 7a2b 2720 3a20 696e 206f 7264 6572   'z+' : in order
+0004c770: 206f 6620 696e 6372 6561 7369 6e67 207a   of increasing z
+0004c780: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+0004c790: 2020 2020 2d20 277a 2d27 203a 2069 6e20      - 'z-' : in 
+0004c7a0: 6f72 6465 7220 6f66 2064 6563 7265 6173  order of decreas
+0004c7b0: 696e 6720 7a20 7661 6c75 652e 0a20 2020  ing z value..   
+0004c7c0: 2020 2020 2027 2727 0a0a 2020 2020 2020       '''..      
+0004c7d0: 2020 6966 206f 7264 6572 206e 6f74 2069    if order not i
+0004c7e0: 6e20 5b27 782b 272c 2027 782d 272c 2027  n ['x+', 'x-', '
+0004c7f0: 792b 272c 2027 792d 272c 2027 7a2b 272c  y+', 'y-', 'z+',
+0004c800: 2027 7a2d 275d 3a0a 2020 2020 2020 2020   'z-']:.        
+0004c810: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+0004c820: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
+0004c830: 6178 6973 2066 6f72 206f 7264 6572 696e  axis for orderin
+0004c840: 672c 2061 6e64 2064 6972 6563 7469 6f6e  g, and direction
+0004c850: 2e0a 2020 2020 2020 2020 6178 6973 203d  ..        axis =
+0004c860: 2027 7879 7a27 2e66 696e 6428 6f72 6465   'xyz'.find(orde
+0004c870: 725b 305d 290a 2020 2020 2020 2020 7265  r[0]).        re
+0004c880: 7665 7273 6520 3d20 2827 2d27 2069 6e20  verse = ('-' in 
+0004c890: 6f72 6465 7229 0a0a 2020 2020 2020 2020  order)..        
+0004c8a0: 2320 4372 6561 7465 2064 6963 7469 6f6e  # Create diction
+0004c8b0: 6172 7920 7768 6572 6520 6b65 7973 2061  ary where keys a
+0004c8c0: 7265 2063 656e 7472 6f69 6420 636f 6f72  re centroid coor
+0004c8d0: 6469 6e61 7465 730a 2020 2020 2020 2020  dinates.        
+0004c8e0: 2320 616e 6420 7661 6c75 6573 2061 7265  # and values are
+0004c8f0: 206c 6973 7473 206f 6620 524f 4920 696e   lists of ROI in
+0004c900: 6469 6369 6573 2061 7420 7468 6573 6520  dicies at these 
+0004c910: 636f 6f72 6469 6e61 7465 732e 0a20 2020  coordinates..   
+0004c920: 2020 2020 2063 656e 7472 6f69 6473 203d       centroids =
+0004c930: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+0004c940: 6920 696e 2072 616e 6765 286c 656e 2873  i in range(len(s
+0004c950: 656c 662e 726f 6973 2929 3a0a 2020 2020  elf.rois)):.    
+0004c960: 2020 2020 2020 2020 7879 7a20 3d20 7365          xyz = se
+0004c970: 6c66 2e72 6f69 735b 695d 2e67 6574 5f63  lf.rois[i].get_c
+0004c980: 656e 7472 6f69 6428 295b 6178 6973 5d0a  entroid()[axis].
+0004c990: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+0004c9a0: 797a 206e 6f74 2069 6e20 6365 6e74 726f  yz not in centro
+0004c9b0: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
+0004c9c0: 2020 2020 2063 656e 7472 6f69 6473 5b78       centroids[x
+0004c9d0: 797a 5d20 3d20 5b5d 0a20 2020 2020 2020  yz] = [].       
+0004c9e0: 2020 2020 2063 656e 7472 6f69 6473 5b78       centroids[x
+0004c9f0: 797a 5d2e 6170 7065 6e64 2869 290a 0a20  yz].append(i).. 
+0004ca00: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0004ca10: 6c69 7374 206f 6620 524f 4973 206f 7264  list of ROIs ord
+0004ca20: 6572 6564 2062 7920 6365 6e74 726f 6964  ered by centroid
+0004ca30: 2063 6f6f 7264 696e 6174 652e 0a20 2020   coordinate..   
+0004ca40: 2020 2020 2072 6f69 7320 3d20 5b5d 0a20       rois = []. 
+0004ca50: 2020 2020 2020 2066 6f72 2063 656e 7472         for centr
+0004ca60: 6f69 6420 696e 2073 6f72 7465 6428 6365  oid in sorted(ce
+0004ca70: 6e74 726f 6964 732c 2072 6576 6572 7365  ntroids, reverse
+0004ca80: 3d72 6576 6572 7365 293a 0a20 2020 2020  =reverse):.     
+0004ca90: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0004caa0: 6365 6e74 726f 6964 735b 6365 6e74 726f  centroids[centro
+0004cab0: 6964 5d3a 0a20 2020 2020 2020 2020 2020  id]:.           
+0004cac0: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
+0004cad0: 2873 656c 662e 726f 6973 5b69 5d29 0a0a  (self.rois[i])..
+0004cae0: 2020 2020 2020 2020 2320 5374 6f72 6520          # Store 
+0004caf0: 7468 6520 6e65 7720 6f72 6465 7220 6f66  the new order of
+0004cb00: 2052 4f49 732e 0a20 2020 2020 2020 2073   ROIs..        s
+0004cb10: 656c 662e 726f 6973 203d 2072 6f69 730a  elf.rois = rois.
+0004cb20: 0a20 2020 2064 6566 2063 6f6d 6269 6e65  .    def combine
+0004cb30: 5f72 6f69 7328 7365 6c66 2c20 6e61 6d65  _rois(self, name
+0004cb40: 3d4e 6f6e 652c 2072 6f69 5f6e 616d 6573  =None, roi_names
+0004cb50: 3d4e 6f6e 652c 2069 6d61 6765 3d4e 6f6e  =None, image=Non
+0004cb60: 652c 206d 6574 686f 643d 4e6f 6e65 293a  e, method=None):
+0004cb70: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
+0004cb80: 2020 2020 2043 6f6d 6269 6e65 2074 776f       Combine two
+0004cb90: 206f 7220 6d6f 7265 2052 4f49 7320 6173   or more ROIs as
+0004cba0: 2061 2073 696e 676c 6520 524f 492e 0a0a   a single ROI...
+0004cbb0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0004cbc0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+0004cbd0: 206e 616d 6520 3a20 7374 722c 2064 6566   name : str, def
+0004cbe0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0004cbf0: 2020 2020 2020 4e61 6d65 2074 6f20 6265        Name to be
+0004cc00: 2067 6976 656e 2074 6f20 7468 6520 636f   given to the co
+0004cc10: 6d70 6f73 6974 6520 524f 492e 2020 4966  mposite ROI.  If
+0004cc20: 204e 6f6e 652c 2074 6865 0a20 2020 2020   None, the.     
+0004cc30: 2020 2020 2020 206e 616d 6520 6173 7369         name assi
+0004cc40: 676e 6564 2069 7320 666f 726d 6564 2062  gned is formed b
+0004cc50: 7920 6a6f 696e 696e 6720 746f 6765 7468  y joining togeth
+0004cc60: 6572 2074 6865 206e 616d 6573 0a20 2020  er the names.   
+0004cc70: 2020 2020 2020 2020 206f 6620 7468 6520           of the 
+0004cc80: 6f72 6967 696e 616c 2052 4f49 732e 0a0a  original ROIs...
+0004cc90: 2020 2020 2020 2020 726f 695f 6e61 6d65          roi_name
+0004cca0: 7320 3a20 6c69 7374 2c20 6465 6661 756c  s : list, defaul
+0004ccb0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0004ccc0: 2020 204c 6973 7420 6f66 206e 616d 6573     List of names
+0004ccd0: 206f 6620 524f 4973 2074 6f20 6265 2063   of ROIs to be c
+0004cce0: 6f6d 6269 6e65 642e 2020 4966 204e 6f6e  ombined.  If Non
+0004ccf0: 652c 2061 6c6c 206f 6620 7468 650a 2020  e, all of the.  
+0004cd00: 2020 2020 2020 2020 2020 7374 7275 6374            struct
+0004cd10: 7572 6520 7365 7427 7320 524f 4973 2061  ure set's ROIs a
+0004cd20: 7265 2063 6f6d 6269 6e65 642e 0a0a 2020  re combined...  
+0004cd30: 2020 2020 2020 696d 6167 6520 3a20 736b        image : sk
+0004cd40: 7274 2e69 6d61 6765 2e49 6d61 6765 2c20  rt.image.Image, 
+0004cd50: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+0004cd60: 2020 2020 2020 2020 2049 6d61 6765 2074           Image t
+0004cd70: 6f20 7365 7420 666f 7220 7468 6520 636f  o set for the co
+0004cd80: 6d70 6f73 6974 6520 524f 492e 2020 4966  mposite ROI.  If
+0004cd90: 204e 6f6e 652c 2075 7365 2074 6865 2069   None, use the i
+0004cda0: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
+0004cdb0: 206f 6620 7468 6520 524f 4920 7769 7468   of the ROI with
+0004cdc0: 2074 6865 2066 6972 7374 206e 616d 6520   the first name 
+0004cdd0: 696e 203c 726f 695f 6e61 6d65 733e 2e0a  in <roi_names>..
+0004cde0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
+0004cdf0: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+0004ce00: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0004ce10: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
+0004ce20: 7220 636f 6d62 696e 696e 6720 524f 4973  r combining ROIs
+0004ce30: 2e20 2043 616e 2062 653a 200a 0a20 2020  .  Can be: ..   
+0004ce40: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+0004ce50: 636f 6e74 6f75 7222 3a20 7461 6b65 2075  contour": take u
+0004ce60: 6e61 7279 2075 6e69 6f6e 206f 6620 7368  nary union of sh
+0004ce70: 6170 656c 7920 706f 6c79 676f 6e73 2e0a  apely polygons..
+0004ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ce90: 2d20 226d 6173 6b22 3a20 7375 6d20 6269  - "mask": sum bi
+0004cea0: 6e61 7279 206d 6173 6b73 2e0a 2020 2020  nary masks..    
+0004ceb0: 2020 2020 2020 2020 2020 2020 2d20 2261              - "a
+0004cec0: 7574 6f22 3a20 7573 6520 7468 6520 6465  uto": use the de
+0004ced0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+0004cee0: 6420 6f66 2074 6865 2052 4f49 2077 6974  d of the ROI wit
+0004cef0: 6820 7468 650a 2020 2020 2020 2020 2020  h the.          
+0004cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cf10: 6669 7273 7420 6e61 6d65 2069 6e20 3c72  first name in <r
+0004cf20: 6f69 5f6e 616d 6573 3e2e 0a0a 2020 2020  oi_names>...    
+0004cf30: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
+0004cf40: 2022 6175 746f 2220 6973 2075 7365 642e   "auto" is used.
+0004cf50: 0a20 2020 2020 2020 2027 2727 0a0a 2020  .        '''..  
+0004cf60: 2020 2020 2020 2320 4966 204e 6f6e 6520        # If None 
+0004cf70: 7661 6c75 6573 2070 6173 7365 642c 2073  values passed, s
+0004cf80: 6574 2064 6566 6175 6c74 2062 6568 6176  et default behav
+0004cf90: 696f 7572 2e0a 2020 2020 2020 2020 6966  iour..        if
+0004cfa0: 2072 6f69 5f6e 616d 6573 2069 7320 4e6f   roi_names is No
+0004cfb0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0004cfc0: 726f 695f 6e61 6d65 7320 3d20 7365 6c66  roi_names = self
+0004cfd0: 2e67 6574 5f72 6f69 5f6e 616d 6573 2829  .get_roi_names()
+0004cfe0: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
+0004cff0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0004d000: 2020 2020 2020 6e61 6d65 203d 2027 2b27        name = '+'
+0004d010: 2e6a 6f69 6e28 726f 695f 6e61 6d65 7329  .join(roi_names)
+0004d020: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
+0004d030: 6f64 2069 6e20 5b4e 6f6e 652c 2022 6175  od in [None, "au
+0004d040: 746f 225d 3a0a 2020 2020 2020 2020 2020  to"]:.          
+0004d050: 2020 6d65 7468 6f64 203d 2073 656c 665b    method = self[
+0004d060: 726f 695f 6e61 6d65 735b 305d 5d2e 6465  roi_names[0]].de
+0004d070: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+0004d080: 640a 2020 2020 2020 2020 6966 2069 6d61  d.        if ima
+0004d090: 6765 2069 7320 4e6f 6e65 3a0a 2020 2020  ge is None:.    
+0004d0a0: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
+0004d0b0: 7365 6c66 5b72 6f69 5f6e 616d 6573 5b30  self[roi_names[0
+0004d0c0: 5d5d 2e69 6d61 6765 0a0a 2020 2020 2020  ]].image..      
+0004d0d0: 2020 6966 2022 636f 6e74 6f75 7222 203d    if "contour" =
+0004d0e0: 3d20 6d65 7468 6f64 3a0a 2020 2020 2020  = method:.      
+0004d0f0: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
+0004d100: 2064 6963 7469 6f6e 6172 7920 636f 6e74   dictionary cont
+0004d110: 6169 6e69 6e67 2070 6f6c 7967 6f6e 7320  aining polygons 
+0004d120: 666f 7220 616c 6c20 524f 4973 2e0a 2020  for all ROIs..  
+0004d130: 2020 2020 2020 2020 2020 616c 6c5f 706f            all_po
+0004d140: 6c79 676f 6e73 203d 207b 7d0a 2020 2020  lygons = {}.    
+0004d150: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
+0004d160: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
+0004d170: 2872 6f69 5f6e 616d 6573 293a 0a20 2020  (roi_names):.   
+0004d180: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004d190: 206b 6579 2c20 706f 6c79 676f 6e73 2069   key, polygons i
+0004d1a0: 6e20 726f 692e 6765 745f 706f 6c79 676f  n roi.get_polygo
+0004d1b0: 6e73 2829 2e69 7465 6d73 2829 3a0a 2020  ns().items():.  
+0004d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d1d0: 2020 6966 206e 6f74 206b 6579 2069 6e20    if not key in 
+0004d1e0: 616c 6c5f 706f 6c79 676f 6e73 3a0a 2020  all_polygons:.  
+0004d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d200: 2020 2020 2020 616c 6c5f 706f 6c79 676f        all_polygo
+0004d210: 6e73 5b6b 6579 5d20 3d20 5b5d 0a20 2020  ns[key] = [].   
+0004d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d230: 2061 6c6c 5f70 6f6c 7967 6f6e 735b 6b65   all_polygons[ke
+0004d240: 795d 2e65 7874 656e 6428 706f 6c79 676f  y].extend(polygo
+0004d250: 6e73 290a 0a20 2020 2020 2020 2020 2020  ns)..           
+0004d260: 2023 2045 7661 6c75 6174 6520 7468 6520   # Evaluate the 
+0004d270: 756e 6172 7920 756e 696f 6e20 6f66 2070  unary union of p
+0004d280: 6f6c 7967 6f6e 7320 666f 7220 6561 6368  olygons for each
+0004d290: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
+0004d2a0: 2020 2020 616c 6c5f 706f 6c79 676f 6e73      all_polygons
+0004d2b0: 203d 207b 6b65 793a 205b 6f70 732e 756e   = {key: [ops.un
+0004d2c0: 6172 795f 756e 696f 6e28 616c 6c5f 706f  ary_union(all_po
+0004d2d0: 6c79 676f 6e73 5b6b 6579 5d29 5d0a 2020  lygons[key])].  
+0004d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d2f0: 2020 2066 6f72 206b 6579 2069 6e20 616c     for key in al
+0004d300: 6c5f 706f 6c79 676f 6e73 7d0a 0a20 2020  l_polygons}..   
+0004d310: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
+0004d320: 6520 7468 6520 636f 6d70 6f73 6974 6520  e the composite 
+0004d330: 524f 492e 0a20 2020 2020 2020 2020 2020  ROI..           
+0004d340: 2072 6f69 5f6e 6577 203d 2052 4f49 2873   roi_new = ROI(s
+0004d350: 6f75 7263 653d 616c 6c5f 706f 6c79 676f  ource=all_polygo
+0004d360: 6e73 2c20 696d 6167 653d 696d 6167 652c  ns, image=image,
+0004d370: 206e 616d 653d 6e61 6d65 290a 0a20 2020   name=name)..   
+0004d380: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0004d390: 2020 2020 2020 2023 696d 6167 655f 6973         #image_is
+0004d3a0: 5f6e 6f6e 6520 3d20 2869 6d61 6765 2069  _none = (image i
+0004d3b0: 7320 4e6f 6e65 290a 2020 2020 2020 2020  s None).        
+0004d3c0: 2020 2020 2369 6620 696d 6167 655f 6973      #if image_is
+0004d3d0: 5f6e 6f6e 653a 0a20 2020 2020 2020 2020  _none:.         
+0004d3e0: 2020 2023 2020 2020 696d 6167 6520 3d20     #    image = 
+0004d3f0: 7365 6c66 2e63 7265 6174 655f 6475 6d6d  self.create_dumm
+0004d400: 795f 696d 6167 6528 290a 2020 2020 2020  y_image().      
+0004d410: 2020 2020 2020 2320 5573 6520 6461 7461        # Use data
+0004d420: 2066 726f 6d20 6f6e 6520 6f66 2074 6865   from one of the
+0004d430: 2052 4f49 7320 6173 2061 2073 7461 7274   ROIs as a start
+0004d440: 696e 6720 706f 696e 742e 0a20 2020 2020  ing point..     
+0004d450: 2020 2020 2020 2023 726f 6930 203d 2073         #roi0 = s
+0004d460: 656c 662e 6765 745f 726f 6928 726f 695f  elf.get_roi(roi_
+0004d470: 6e61 6d65 735b 305d 290a 2020 2020 2020  names[0]).      
+0004d480: 2020 2020 2020 2372 6f69 5f6e 6577 203d        #roi_new =
+0004d490: 2052 4f49 2873 6f75 7263 653d 726f 6930   ROI(source=roi0
+0004d4a0: 2e67 6574 5f6d 6173 6b28 292e 636f 7079  .get_mask().copy
+0004d4b0: 2829 2c20 6166 6669 6e65 3d72 6f69 302e  (), affine=roi0.
+0004d4c0: 6166 6669 6e65 2c0a 2020 2020 2020 2020  affine,.        
+0004d4d0: 2020 2020 2320 2020 2020 2020 206e 616d      #        nam
+0004d4e0: 653d 6e61 6d65 2c20 696d 6167 653d 696d  e=name, image=im
+0004d4f0: 6167 6529 0a20 2020 2020 2020 2020 2020  age).           
+0004d500: 2072 6f69 5f6e 6577 203d 2073 656c 662e   roi_new = self.
+0004d510: 6765 745f 726f 6928 726f 695f 6e61 6d65  get_roi(roi_name
+0004d520: 735b 305d 292e 636c 6f6e 6528 290a 2020  s[0]).clone().  
+0004d530: 2020 2020 2020 2020 2020 726f 695f 6e65            roi_ne
+0004d540: 772e 7365 745f 696d 6167 6528 696d 6167  w.set_image(imag
+0004d550: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+0004d560: 6f69 5f6e 6577 2e63 7265 6174 655f 6d61  oi_new.create_ma
+0004d570: 736b 2829 0a0a 2020 2020 2020 2020 2020  sk()..          
+0004d580: 2020 2320 436f 6d62 696e 6520 7769 7468    # Combine with
+0004d590: 2064 6174 6120 6672 6f6d 2074 6865 206f   data from the o
+0004d5a0: 7468 6572 2052 4f49 732e 0a20 2020 2020  ther ROIs..     
+0004d5b0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0004d5c0: 7261 6e67 6528 312c 206c 656e 2872 6f69  range(1, len(roi
+0004d5d0: 5f6e 616d 6573 2929 3a0a 2020 2020 2020  _names)):.      
+0004d5e0: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
+0004d5f0: 7020 3d20 7365 6c66 2e67 6574 5f72 6f69  p = self.get_roi
+0004d600: 2872 6f69 5f6e 616d 6573 5b69 5d29 2e63  (roi_names[i]).c
+0004d610: 6c6f 6e65 2829 0a20 2020 2020 2020 2020  lone().         
+0004d620: 2020 2020 2020 2072 6f69 5f74 6d70 2e73         roi_tmp.s
+0004d630: 6574 5f69 6d61 6765 2869 6d61 6765 290a  et_image(image).
+0004d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d650: 726f 695f 746d 702e 6372 6561 7465 5f6d  roi_tmp.create_m
+0004d660: 6173 6b28 290a 2020 2020 2020 2020 2020  ask().          
+0004d670: 2020 2020 2020 726f 695f 6e65 772e 6d61        roi_new.ma
+0004d680: 736b 2e64 6174 6120 7c3d 2072 6f69 5f74  sk.data |= roi_t
+0004d690: 6d70 2e6d 6173 6b2e 6461 7461 0a0a 2020  mp.mask.data..  
+0004d6a0: 2020 2020 2020 2020 2020 2369 6620 696d            #if im
+0004d6b0: 6167 655f 6973 5f6e 6f6e 653a 0a20 2020  age_is_none:.   
+0004d6c0: 2020 2020 2020 2020 2023 2020 2020 696d           #    im
+0004d6d0: 6167 6520 3d20 4e6f 6e65 0a20 2020 2020  age = None.     
+0004d6e0: 2020 2020 2020 2072 6f69 5f6e 6577 203d         roi_new =
+0004d6f0: 2052 4f49 2873 6f75 7263 653d 726f 695f   ROI(source=roi_
+0004d700: 6e65 772e 6d61 736b 2e64 6174 612c 2069  new.mask.data, i
+0004d710: 6d61 6765 3d69 6d61 6765 2c20 6e61 6d65  mage=image, name
+0004d720: 3d6e 616d 6529 0a0a 2020 2020 2020 2020  =name)..        
+0004d730: 7265 7475 726e 2072 6f69 5f6e 6577 0a0a  return roi_new..
+0004d740: 2020 2020 6465 6620 6765 745f 6d61 736b      def get_mask
+0004d750: 5f69 6d61 6765 2873 656c 662c 206e 616d  _image(self, nam
+0004d760: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+0004d770: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+0004d780: 2069 6d61 6765 206f 626a 6563 7420 7265   image object re
+0004d790: 7072 6573 656e 7469 6e67 206d 6173 6b20  presenting mask 
+0004d7a0: 666f 7220 616c 6c20 524f 4973 206f 6620  for all ROIs of 
+0004d7b0: 7374 7275 6374 7572 6520 7365 742e 0a0a  structure set...
+0004d7c0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0004d7d0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+0004d7e0: 206e 616d 6520 3a20 7374 722c 2064 6566   name : str, def
+0004d7f0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0004d800: 2020 2020 2020 4e61 6d65 2074 6f20 6265        Name to be
+0004d810: 2067 6976 656e 2074 6f20 7468 6520 6d61   given to the ma
+0004d820: 736b 2069 6d61 6765 2e20 2049 6620 4e6f  sk image.  If No
+0004d830: 6e65 2c20 7468 650a 2020 2020 2020 2020  ne, the.        
+0004d840: 2020 2020 6e61 6d65 2061 7373 6967 6e65      name assigne
+0004d850: 6420 6973 2074 6865 206e 616d 6520 6f66  d is the name of
+0004d860: 2074 6865 2073 7472 7563 7475 7265 2073   the structure s
+0004d870: 6574 2c20 7769 7468 2073 7566 6669 780a  et, with suffix.
+0004d880: 2020 2020 2020 2020 2020 2020 225f 6d61              "_ma
+0004d890: 736b 2220 6170 7065 6e64 6564 2e0a 2020  sk" appended..  
+0004d8a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0004d8b0: 2020 6e61 6d65 203d 206e 616d 6520 6f72    name = name or
+0004d8c0: 2066 227b 7365 6c66 2e6e 616d 657d 5f6d   f"{self.name}_m
+0004d8d0: 6173 6b22 0a20 2020 2020 2020 2072 6f69  ask".        roi
+0004d8e0: 5f63 6f6d 6269 6e65 6420 3d20 7365 6c66  _combined = self
+0004d8f0: 2e63 6f6d 6269 6e65 5f72 6f69 7328 6e61  .combine_rois(na
+0004d900: 6d65 3d6e 616d 6529 0a20 2020 2020 2020  me=name).       
+0004d910: 206d 6173 6b5f 696d 6167 6520 3d20 726f   mask_image = ro
+0004d920: 695f 636f 6d62 696e 6564 2e67 6574 5f6d  i_combined.get_m
+0004d930: 6173 6b5f 696d 6167 6528 290a 2020 2020  ask_image().    
+0004d940: 2020 2020 7265 7475 726e 206d 6173 6b5f      return mask_
+0004d950: 696d 6167 650a 0a20 2020 2064 6566 2063  image..    def c
+0004d960: 726f 7028 7365 6c66 2c20 786c 696d 3d4e  rop(self, xlim=N
+0004d970: 6f6e 652c 2079 6c69 6d3d 4e6f 6e65 2c20  one, ylim=None, 
+0004d980: 7a6c 696d 3d4e 6f6e 6529 3a0a 2020 2020  zlim=None):.    
+0004d990: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0004d9a0: 4372 6f70 2061 6c6c 2052 4f49 7320 6f66  Crop all ROIs of
+0004d9b0: 2053 7472 7563 7475 7265 5365 7420 746f   StructureSet to
+0004d9c0: 2073 7065 6369 6669 6564 2072 616e 6765   specified range
+0004d9d0: 2069 6e20 782c 2079 2c20 7a2e 0a0a 2020   in x, y, z...  
+0004d9e0: 2020 2020 2020 5468 6520 7061 7261 6d65        The parame
+0004d9f0: 7465 7273 2078 6c69 6d2c 2079 6c69 6d2c  ters xlim, ylim,
+0004da00: 207a 6c69 6d20 6172 6520 7061 7373 6564   zlim are passed
+0004da10: 2074 6f20 6561 6368 2052 4f49 2773 2063   to each ROI's c
+0004da20: 726f 7028 2920 6d65 7468 6f64 2e0a 2020  rop() method..  
+0004da30: 2020 2020 2020 466f 7220 6578 706c 616e        For explan
+0004da40: 6174 696f 6e20 6f66 2074 6865 7365 2070  ation of these p
+0004da50: 6172 616d 6574 6572 732c 2073 6565 2064  arameters, see d
+0004da60: 6f63 756d 656e 7461 7469 6f6e 2066 6f72  ocumentation for
+0004da70: 0a20 2020 2020 2020 2073 6b72 742e 7374  .        skrt.st
+0004da80: 7275 6374 7572 6573 2e52 4f49 2e63 726f  ructures.ROI.cro
+0004da90: 7028 292e 0a20 2020 2020 2020 2022 2222  p()..        """
+0004daa0: 0a20 2020 2020 2020 2066 6f72 2072 6f69  .        for roi
+0004dab0: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
+0004dac0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0004dad0: 2072 6f69 2e63 726f 7028 786c 696d 2c20   roi.crop(xlim, 
+0004dae0: 796c 696d 2c20 7a6c 696d 290a 0a63 6c61  ylim, zlim)..cla
+0004daf0: 7373 2053 7472 7563 7475 7265 5365 7449  ss StructureSetI
+0004db00: 7465 7261 746f 723a 0a0a 2020 2020 6465  terator:..    de
+0004db10: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+0004db20: 2073 7472 7563 7475 7265 5f73 6574 293a   structure_set):
+0004db30: 0a20 2020 2020 2020 2073 656c 662e 6964  .        self.id
+0004db40: 7820 3d20 2d31 0a20 2020 2020 2020 2073  x = -1.        s
+0004db50: 656c 662e 7374 7275 6374 7572 655f 7365  elf.structure_se
+0004db60: 7420 3d20 7374 7275 6374 7572 655f 7365  t = structure_se
+0004db70: 740a 0a20 2020 2064 6566 205f 5f6e 6578  t..    def __nex
+0004db80: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
+0004db90: 2020 2073 656c 662e 6964 7820 2b3d 2031     self.idx += 1
+0004dba0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0004dbb0: 2e69 6478 203c 206c 656e 2873 656c 662e  .idx < len(self.
+0004dbc0: 7374 7275 6374 7572 655f 7365 742e 6765  structure_set.ge
+0004dbd0: 745f 726f 6973 2829 293a 0a20 2020 2020  t_rois()):.     
+0004dbe0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0004dbf0: 6c66 2e73 7472 7563 7475 7265 5f73 6574  lf.structure_set
+0004dc00: 2e67 6574 5f72 6f69 7328 295b 7365 6c66  .get_rois()[self
+0004dc10: 2e69 6478 5d0a 2020 2020 2020 2020 7261  .idx].        ra
+0004dc20: 6973 6520 5374 6f70 4974 6572 6174 696f  ise StopIteratio
+0004dc30: 6e0a 0a0a 6465 6620 6c6f 6164 5f72 6f69  n...def load_roi
+0004dc40: 735f 6469 636f 6d28 7061 7468 2c20 6e61  s_dicom(path, na
+0004dc50: 6d65 733d 4e6f 6e65 293a 0a20 2020 2022  mes=None):.    "
+0004dc60: 2222 4c6f 6164 2052 4f49 2873 2920 6672  ""Load ROI(s) fr
+0004dc70: 6f6d 2061 2064 6963 6f6d 2073 7472 7563  om a dicom struc
+0004dc80: 7475 7265 2073 6574 2066 696c 652e 203c  ture set file. <
+0004dc90: 6e61 6d65 3e20 6361 6e20 6265 2061 2073  name> can be a s
+0004dca0: 696e 676c 650a 2020 2020 6e61 6d65 206f  ingle.    name o
+0004dcb0: 7220 6c69 7374 206f 6620 6e61 6d65 7320  r list of names 
+0004dcc0: 6f66 2052 4f49 7320 746f 206c 6f61 642e  of ROIs to load.
+0004dcd0: 2222 220a 0a20 2020 2023 204c 6f61 6420  """..    # Load 
+0004dce0: 6469 636f 6d20 6f62 6a65 6374 0a20 2020  dicom object.   
+0004dcf0: 2074 7279 3a0a 2020 2020 2020 2020 6473   try:.        ds
+0004dd00: 203d 2070 7964 6963 6f6d 2e64 636d 7265   = pydicom.dcmre
+0004dd10: 6164 2870 6174 682c 2066 6f72 6365 3d54  ad(path, force=T
+0004dd20: 7275 6529 0a20 2020 2065 7863 6570 7420  rue).    except 
+0004dd30: 7079 6469 636f 6d2e 6572 726f 7273 2e49  pydicom.errors.I
+0004dd40: 6e76 616c 6964 4469 636f 6d45 7272 6f72  nvalidDicomError
+0004dd50: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0004dd60: 205b 5d2c 204e 6f6e 650a 2020 2020 6966   [], None.    if
+0004dd70: 206e 6f74 2068 6173 6174 7472 2864 732c   not hasattr(ds,
+0004dd80: 2022 534f 5043 6c61 7373 5549 4422 293a   "SOPClassUID"):
+0004dd90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004dda0: 5b5d 2c20 4e6f 6e65 0a20 2020 2069 6620  [], None.    if 
+0004ddb0: 6e6f 7420 2864 732e 534f 5043 6c61 7373  not (ds.SOPClass
+0004ddc0: 5549 4420 3d3d 2022 312e 322e 3834 302e  UID == "1.2.840.
+0004ddd0: 3130 3030 382e 352e 312e 342e 312e 312e  10008.5.1.4.1.1.
+0004dde0: 3438 312e 3322 293a 0a20 2020 2020 2020  481.3"):.       
+0004ddf0: 2070 7269 6e74 2866 2257 6172 6e69 6e67   print(f"Warning
+0004de00: 3a20 7b70 6174 687d 2069 7320 6e6f 7420  : {path} is not 
+0004de10: 6120 4449 434f 4d20 7374 7275 6374 7572  a DICOM structur
+0004de20: 6520 7365 7420 6669 6c65 2122 290a 2020  e set file!").  
+0004de30: 2020 2020 2020 7265 7475 726e 205b 5d2c        return [],
+0004de40: 204e 6f6e 650a 0a20 2020 2023 2047 6574   None..    # Get
+0004de50: 2052 4f49 206e 616d 6573 0a20 2020 2073   ROI names.    s
+0004de60: 6571 203d 2067 6574 5f64 6963 6f6d 5f73  eq = get_dicom_s
+0004de70: 6571 7565 6e63 6528 6473 2c20 2253 7472  equence(ds, "Str
+0004de80: 7563 7475 7265 5365 7452 4f49 2229 0a20  uctureSetROI"). 
+0004de90: 2020 2072 6f69 7320 3d20 7b7d 0a20 2020     rois = {}.   
+0004dea0: 2066 6f72 2072 6f69 2069 6e20 7365 713a   for roi in seq:
+0004deb0: 0a20 2020 2020 2020 2072 6f69 735b 696e  .        rois[in
+0004dec0: 7428 726f 692e 524f 494e 756d 6265 7229  t(roi.ROINumber)
+0004ded0: 5d20 3d20 7b22 6e61 6d65 223a 2072 6f69  ] = {"name": roi
+0004dee0: 2e52 4f49 4e61 6d65 7d0a 0a20 2020 2023  .ROIName}..    #
+0004def0: 2046 696e 6420 524f 4973 206d 6174 6368   Find ROIs match
+0004df00: 696e 6720 7265 7175 6573 7465 6420 6e61  ing requested na
+0004df10: 6d65 730a 2020 2020 6e61 6d65 735f 746f  mes.    names_to
+0004df20: 5f6c 6f61 6420 3d20 4e6f 6e65 0a20 2020  _load = None.   
+0004df30: 2069 6620 6973 696e 7374 616e 6365 286e   if isinstance(n
+0004df40: 616d 6573 2c20 7374 7229 3a0a 2020 2020  ames, str):.    
+0004df50: 2020 2020 6e61 6d65 735f 746f 5f6c 6f61      names_to_loa
+0004df60: 6420 3d20 5b6e 616d 6573 5d0a 2020 2020  d = [names].    
+0004df70: 656c 6966 2073 6b72 742e 636f 7265 2e69  elif skrt.core.i
+0004df80: 735f 6c69 7374 286e 616d 6573 293a 0a20  s_list(names):. 
+0004df90: 2020 2020 2020 206e 616d 6573 5f74 6f5f         names_to_
+0004dfa0: 6c6f 6164 203d 206e 616d 6573 0a20 2020  load = names.   
+0004dfb0: 2069 6620 6e61 6d65 735f 746f 5f6c 6f61   if names_to_loa
+0004dfc0: 643a 0a20 2020 2020 2020 2072 6f69 7320  d:.        rois 
+0004dfd0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+0004dfe0: 693a 2073 0a20 2020 2020 2020 2020 2020  i: s.           
+0004dff0: 2066 6f72 2069 2c20 7320 696e 2072 6f69   for i, s in roi
+0004e000: 732e 6974 656d 7328 290a 2020 2020 2020  s.items().      
+0004e010: 2020 2020 2020 6966 2061 6e79 280a 2020        if any(.  
+0004e020: 2020 2020 2020 2020 2020 2020 2020 5b66                [f
+0004e030: 6e6d 6174 6368 2e66 6e6d 6174 6368 2873  nmatch.fnmatch(s
+0004e040: 5b22 6e61 6d65 225d 2e6c 6f77 6572 2829  ["name"].lower()
+0004e050: 2c20 6e2e 6c6f 7765 7228 2929 2066 6f72  , n.lower()) for
+0004e060: 206e 2069 6e20 6e61 6d65 735f 746f 5f6c   n in names_to_l
+0004e070: 6f61 645d 0a20 2020 2020 2020 2020 2020  oad].           
+0004e080: 2029 0a20 2020 2020 2020 207d 0a20 2020   ).        }.   
+0004e090: 2020 2020 2069 6620 6e6f 7420 6c65 6e28       if not len(
+0004e0a0: 726f 6973 293a 0a20 2020 2020 2020 2020  rois):.         
+0004e0b0: 2020 2070 7269 6e74 2866 2257 6172 6e69     print(f"Warni
+0004e0c0: 6e67 3a20 6e6f 2052 4f49 7320 666f 756e  ng: no ROIs foun
+0004e0d0: 6420 6d61 7463 6869 6e67 206e 616d 6528  d matching name(
+0004e0e0: 7329 3a20 7b6e 616d 6573 7d22 290a 2020  s): {names}").  
+0004e0f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0004e100: 205b 5d2c 204e 6f6e 650a 0a20 2020 2023   [], None..    #
+0004e110: 2047 6574 2052 4f49 2064 6574 6169 6c73   Get ROI details
+0004e120: 0a20 2020 2072 6f69 5f73 6571 203d 2067  .    roi_seq = g
+0004e130: 6574 5f64 6963 6f6d 5f73 6571 7565 6e63  et_dicom_sequenc
+0004e140: 6528 6473 2c20 2252 4f49 436f 6e74 6f75  e(ds, "ROIContou
+0004e150: 7222 290a 2020 2020 666f 7220 726f 6920  r").    for roi 
+0004e160: 696e 2072 6f69 5f73 6571 3a0a 0a20 2020  in roi_seq:..   
+0004e170: 2020 2020 206e 756d 6265 7220 3d20 726f       number = ro
+0004e180: 692e 5265 6665 7265 6e63 6564 524f 494e  i.ReferencedROIN
+0004e190: 756d 6265 720a 2020 2020 2020 2020 6966  umber.        if
+0004e1a0: 206e 756d 6265 7220 6e6f 7420 696e 2072   number not in r
+0004e1b0: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
+0004e1c0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+0004e1d0: 2020 6461 7461 203d 207b 2263 6f6e 746f    data = {"conto
+0004e1e0: 7572 7322 3a20 7b7d 7d0a 0a20 2020 2020  urs": {}}..     
+0004e1f0: 2020 2023 2047 6574 2052 4f49 2063 6f6c     # Get ROI col
+0004e200: 6f75 720a 2020 2020 2020 2020 6966 2022  our.        if "
+0004e210: 524f 4944 6973 706c 6179 436f 6c6f 7222  ROIDisplayColor"
+0004e220: 2069 6e20 726f 693a 0a20 2020 2020 2020   in roi:.       
+0004e230: 2020 2020 2064 6174 615b 2263 6f6c 6f72       data["color
+0004e240: 225d 203d 205b 696e 7428 6329 202f 2032  "] = [int(c) / 2
+0004e250: 3535 2066 6f72 2063 2069 6e20 6c69 7374  55 for c in list
+0004e260: 2872 6f69 2e52 4f49 4469 7370 6c61 7943  (roi.ROIDisplayC
+0004e270: 6f6c 6f72 295d 0a20 2020 2020 2020 2065  olor)].        e
+0004e280: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0004e290: 2064 6174 615b 2263 6f6c 6f72 225d 203d   data["color"] =
+0004e2a0: 204e 6f6e 650a 0a20 2020 2020 2020 2023   None..        #
+0004e2b0: 2047 6574 2063 6f6e 746f 7572 730a 2020   Get contours.  
+0004e2c0: 2020 2020 2020 636f 6e74 6f75 725f 7365        contour_se
+0004e2d0: 7120 3d20 6765 745f 6469 636f 6d5f 7365  q = get_dicom_se
+0004e2e0: 7175 656e 6365 2872 6f69 2c20 2243 6f6e  quence(roi, "Con
+0004e2f0: 746f 7572 2229 0a20 2020 2020 2020 2069  tour").        i
+0004e300: 6620 636f 6e74 6f75 725f 7365 713a 0a20  f contour_seq:. 
+0004e310: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+0004e320: 2069 6e20 636f 6e74 6f75 725f 7365 713a   in contour_seq:
+0004e330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e340: 2070 6c61 6e65 5f64 6174 6120 3d20 5b0a   plane_data = [.
+0004e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e360: 2020 2020 5b66 6c6f 6174 2870 2920 666f      [float(p) fo
+0004e370: 7220 7020 696e 2063 2e43 6f6e 746f 7572  r p in c.Contour
+0004e380: 4461 7461 5b69 202a 2033 203a 2069 202a  Data[i * 3 : i *
+0004e390: 2033 202b 2033 5d5d 0a20 2020 2020 2020   3 + 3]].       
+0004e3a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004e3b0: 2069 2069 6e20 7261 6e67 6528 632e 4e75   i in range(c.Nu
+0004e3c0: 6d62 6572 4f66 436f 6e74 6f75 7250 6f69  mberOfContourPoi
+0004e3d0: 6e74 7329 0a20 2020 2020 2020 2020 2020  nts).           
+0004e3e0: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+0004e3f0: 2020 2020 2020 207a 203d 2066 6c6f 6174         z = float
+0004e400: 2863 2e43 6f6e 746f 7572 4461 7461 5b32  (c.ContourData[2
+0004e410: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0004e420: 2020 2069 6620 7a20 6e6f 7420 696e 2064     if z not in d
+0004e430: 6174 615b 2263 6f6e 746f 7572 7322 5d3a  ata["contours"]:
+0004e440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e450: 2020 2020 2064 6174 615b 2263 6f6e 746f       data["conto
+0004e460: 7572 7322 5d5b 7a5d 203d 205b 5d0a 2020  urs"][z] = [].  
+0004e470: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0004e480: 7461 5b22 636f 6e74 6f75 7273 225d 5b7a  ta["contours"][z
+0004e490: 5d2e 6170 7065 6e64 286e 702e 6172 7261  ].append(np.arra
+0004e4a0: 7928 706c 616e 655f 6461 7461 2929 0a0a  y(plane_data))..
+0004e4b0: 2020 2020 2020 2020 726f 6973 5b6e 756d          rois[num
+0004e4c0: 6265 725d 2e75 7064 6174 6528 6461 7461  ber].update(data
+0004e4d0: 290a 0a20 2020 2072 6574 7572 6e20 726f  )..    return ro
+0004e4e0: 6973 2c20 6473 0a0a 0a64 6566 2067 6574  is, ds...def get
+0004e4f0: 5f64 6963 6f6d 5f73 6571 7565 6e63 6528  _dicom_sequence(
+0004e500: 6473 3d4e 6f6e 652c 2062 6173 656e 616d  ds=None, basenam
+0004e510: 653d 2222 293a 0a0a 2020 2020 7365 7175  e=""):..    sequ
+0004e520: 656e 6365 203d 205b 5d0a 2020 2020 666f  ence = [].    fo
+0004e530: 7220 7375 6666 6978 2069 6e20 5b22 5365  r suffix in ["Se
+0004e540: 7175 656e 6365 222c 2022 7322 5d3a 0a20  quence", "s"]:. 
+0004e550: 2020 2020 2020 2061 7474 7269 6275 7465         attribute
+0004e560: 203d 2066 227b 6261 7365 6e61 6d65 7d7b   = f"{basename}{
+0004e570: 7375 6666 6978 7d22 0a20 2020 2020 2020  suffix}".       
+0004e580: 2069 6620 6861 7361 7474 7228 6473 2c20   if hasattr(ds, 
+0004e590: 6174 7472 6962 7574 6529 3a0a 2020 2020  attribute):.    
+0004e5a0: 2020 2020 2020 2020 7365 7175 656e 6365          sequence
+0004e5b0: 203d 2067 6574 6174 7472 2864 732c 2061   = getattr(ds, a
+0004e5c0: 7474 7269 6275 7465 290a 2020 2020 2020  ttribute).      
+0004e5d0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0004e5e0: 7265 7475 726e 2073 6571 7565 6e63 650a  return sequence.
+0004e5f0: 0a64 6566 2063 6f6e 746f 7572 5f74 6f5f  .def contour_to_
+0004e600: 706f 6c79 676f 6e28 636f 6e74 6f75 7229  polygon(contour)
+0004e610: 3a0a 2020 2020 2222 2243 6f6e 7665 7274  :.    """Convert
+0004e620: 2061 206c 6973 7420 6f66 2063 6f6e 746f   a list of conto
+0004e630: 7572 2070 6f69 6e74 7320 746f 2061 2053  ur points to a S
+0004e640: 6861 7065 6c79 2070 6f6c 7967 6f6e 2c20  hapely polygon, 
+0004e650: 656e 7375 7269 6e67 2074 6861 7420 0a20  ensuring that . 
+0004e660: 2020 2074 6865 2070 6f6c 7967 6f6e 2069     the polygon i
+0004e670: 7320 7661 6c69 642e 2222 220a 0a20 2020  s valid."""..   
+0004e680: 2023 2044 6973 6162 6c65 2073 6861 7065   # Disable shape
+0004e690: 6c79 2049 4e46 4f20 6d65 7373 6167 6573  ly INFO messages
+0004e6a0: 2069 7373 7565 6420 7768 656e 2061 2070   issued when a p
+0004e6b0: 6f6c 7967 6f6e 2069 736e 2774 2076 616c  olygon isn't val
+0004e6c0: 6964 3a0a 2020 2020 2320 2263 616c 6c62  id:.    # "callb
+0004e6d0: 6163 6b20 2d20 494e 464f 202d 2052 696e  ack - INFO - Rin
+0004e6e0: 6720 5365 6c66 2d69 6e74 6572 7365 6374  g Self-intersect
+0004e6f0: 696f 6e20 6174 206f 7220 6e65 6172 2070  ion at or near p
+0004e700: 6f69 6e74 220a 2020 2020 6c6f 6767 696e  oint".    loggin
+0004e710: 672e 6765 744c 6f67 6765 7228 2773 6861  g.getLogger('sha
+0004e720: 7065 6c79 2e67 656f 7327 292e 7365 744c  pely.geos').setL
+0004e730: 6576 656c 280a 2020 2020 2020 2020 2020  evel(.          
+0004e740: 2020 736b 7274 2e63 6f72 652e 4465 6661    skrt.core.Defa
+0004e750: 756c 7473 2829 2e73 6861 7065 6c79 5f6c  ults().shapely_l
+0004e760: 6f67 5f6c 6576 656c 290a 0a20 2020 2070  og_level)..    p
+0004e770: 6f6c 7967 6f6e 203d 2067 656f 6d65 7472  olygon = geometr
+0004e780: 792e 506f 6c79 676f 6e28 636f 6e74 6f75  y.Polygon(contou
+0004e790: 7229 0a0a 2020 2020 6465 6c74 6120 3d20  r)..    delta = 
+0004e7a0: 302e 3030 350a 2020 2020 6966 206e 6f74  0.005.    if not
+0004e7b0: 2070 6f6c 7967 6f6e 2e69 735f 7661 6c69   polygon.is_vali
+0004e7c0: 643a 0a20 2020 2020 2020 2074 6d70 203d  d:.        tmp =
+0004e7d0: 2067 656f 6d65 7472 792e 506f 6c79 676f   geometry.Polygo
+0004e7e0: 6e28 706f 6c79 676f 6e29 0a20 2020 2020  n(polygon).     
+0004e7f0: 2020 2062 7566 6665 7220 3d20 302e 0a20     buffer = 0.. 
+0004e800: 2020 2020 2020 2023 2054 6865 2069 6465         # The ide
+0004e810: 6120 6865 7265 2069 7320 746f 2069 6e63  a here is to inc
+0004e820: 7265 6173 6520 7468 6520 6275 6666 6572  rease the buffer
+0004e830: 2064 6973 7461 6e63 6520 756e 7469 6c0a   distance until.
+0004e840: 2020 2020 2020 2020 2320 6120 7661 6c69          # a vali
+0004e850: 6420 706f 6c79 676f 6e20 6973 206f 6274  d polygon is obt
+0004e860: 6169 6e65 642e 2020 5468 6973 2067 656e  ained.  This gen
+0004e870: 6572 616c 6c79 2073 6565 6d73 2074 6f20  erally seems to 
+0004e880: 776f 726b 2e2e 2e0a 2020 2020 2020 2020  work....        
+0004e890: 7768 696c 6520 2869 7369 6e73 7461 6e63  while (isinstanc
+0004e8a0: 6528 706f 6c79 676f 6e2c 2067 656f 6d65  e(polygon, geome
+0004e8b0: 7472 792e 4d75 6c74 6950 6f6c 7967 6f6e  try.MultiPolygon
+0004e8c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004e8d0: 2020 6f72 206e 6f74 2070 6f6c 7967 6f6e    or not polygon
+0004e8e0: 2e69 735f 7661 6c69 6429 3a0a 2020 2020  .is_valid):.    
+0004e8f0: 2020 2020 2020 2020 6275 6666 6572 202b          buffer +
+0004e900: 3d20 6465 6c74 610a 2020 2020 2020 2020  = delta.        
+0004e910: 2020 2020 706f 6c79 676f 6e20 3d20 746d      polygon = tm
+0004e920: 702e 6275 6666 6572 2862 7566 6665 7229  p.buffer(buffer)
+0004e930: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
+0004e940: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+0004e950: 2078 2c20 7920 696e 2070 6f6c 7967 6f6e   x, y in polygon
+0004e960: 2e65 7874 6572 696f 722e 636f 6f72 6473  .exterior.coords
+0004e970: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
+0004e980: 696e 7473 2e61 7070 656e 6428 2878 2c20  ints.append((x, 
+0004e990: 7929 290a 2020 2020 2020 2020 706f 6c79  y)).        poly
+0004e9a0: 676f 6e20 3d20 6765 6f6d 6574 7279 2e50  gon = geometry.P
+0004e9b0: 6f6c 7967 6f6e 2870 6f69 6e74 7329 0a0a  olygon(points)..
+0004e9c0: 2020 2020 7265 7475 726e 2070 6f6c 7967      return polyg
+0004e9d0: 6f6e 0a0a 6465 6620 706f 6c79 676f 6e5f  on..def polygon_
+0004e9e0: 746f 5f63 6f6e 746f 7572 2870 6f6c 7967  to_contour(polyg
+0004e9f0: 6f6e 293a 0a20 2020 2027 2727 0a20 2020  on):.    '''.   
+0004ea00: 2043 6f6e 7665 7274 2061 2053 6861 7065   Convert a Shape
+0004ea10: 6c79 2070 6f6c 7967 6f6e 2074 6f20 6120  ly polygon to a 
+0004ea20: 6c69 7374 206f 6620 636f 6e74 6f75 7220  list of contour 
+0004ea30: 706f 696e 7473 2e0a 0a20 2020 202a 2a50  points...    **P
+0004ea40: 6172 616d 6574 6572 3a2a 2a0a 0a20 2020  arameter:**..   
+0004ea50: 2070 6f6c 7967 6f6e 3a20 7368 6170 656c   polygon: shapel
+0004ea60: 792e 6765 6f6d 6574 7279 2e70 6f6c 7967  y.geometry.polyg
+0004ea70: 6f6e 0a20 2020 2020 2020 2053 6861 7065  on.        Shape
+0004ea80: 6c79 2070 6f6c 7967 6f6e 2e0a 0a20 2020  ly polygon...   
+0004ea90: 207a 5f70 6f6c 7967 6f6e 3a20 7a20 636f   z_polygon: z co
+0004eaa0: 6f72 6469 6e61 7465 2061 7420 7768 6963  ordinate at whic
+0004eab0: 6820 706f 6c79 676f 6e20 6973 2064 6566  h polygon is def
+0004eac0: 696e 6564 2e0a 2020 2020 2727 270a 2020  ined..    '''.  
+0004ead0: 2020 636f 6e74 6f75 725f 706f 696e 7473    contour_points
+0004eae0: 203d 205b 5d0a 2020 2020 666f 7220 782c   = [].    for x,
+0004eaf0: 2079 2069 6e20 6c69 7374 2870 6f6c 7967   y in list(polyg
+0004eb00: 6f6e 2e65 7874 6572 696f 722e 636f 6f72  on.exterior.coor
+0004eb10: 6473 293a 0a20 2020 2020 2020 2063 6f6e  ds):.        con
+0004eb20: 746f 7572 5f70 6f69 6e74 732e 6170 7065  tour_points.appe
+0004eb30: 6e64 285b 782c 2079 5d29 0a20 2020 2063  nd([x, y]).    c
+0004eb40: 6f6e 746f 7572 203d 206e 702e 6172 7261  ontour = np.arra
+0004eb50: 7928 636f 6e74 6f75 725f 706f 696e 7473  y(contour_points
+0004eb60: 290a 0a20 2020 2072 6574 7572 6e20 636f  )..    return co
+0004eb70: 6e74 6f75 720a 0a64 6566 2069 6e74 6572  ntour..def inter
+0004eb80: 706f 6c61 7465 5f70 6f69 6e74 735f 7369  polate_points_si
+0004eb90: 6e67 6c65 5f63 6f6e 746f 7572 2873 6f75  ngle_contour(sou
+0004eba0: 7263 653d 4e6f 6e65 2c20 6e5f 706f 696e  rce=None, n_poin
+0004ebb0: 743d 4e6f 6e65 2c20 6478 793d 4e6f 6e65  t=None, dxy=None
+0004ebc0: 2c0a 2020 2020 2020 2020 736d 6f6f 7468  ,.        smooth
+0004ebd0: 6e65 7373 5f70 6572 5f70 6f69 6e74 3d30  ness_per_point=0
+0004ebe0: 293a 0a20 2020 2027 2727 0a20 2020 2049  ):.    '''.    I
+0004ebf0: 6e74 6572 706f 6c61 7465 2070 6f69 6e74  nterpolate point
+0004ec00: 7320 666f 7220 6120 7369 6e67 6c65 2063  s for a single c
+0004ec10: 6f6e 746f 7572 2e0a 0a20 2020 202a 2a50  ontour...    **P
+0004ec20: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
+0004ec30: 2020 736f 7572 6365 203a 2073 6861 7065    source : shape
+0004ec40: 6c79 2e70 6f6c 7967 6f6e 2e50 6f6c 7967  ly.polygon.Polyg
+0004ec50: 6f6e 2f6e 702e 6e64 6172 7261 792f 6c69  on/np.ndarray/li
+0004ec60: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+0004ec70: 0a20 2020 2020 2020 2043 6f6e 746f 7572  .        Contour
+0004ec80: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+0004ec90: 6173 2065 6974 6865 7220 6120 7368 6170  as either a shap
+0004eca0: 656c 7920 506f 6c79 676f 6e2c 2061 206e  ely Polygon, a n
+0004ecb0: 756d 7079 0a20 2020 2020 2020 2061 7272  umpy.        arr
+0004ecc0: 6179 206f 6620 5b78 2c20 795d 2070 6169  ay of [x, y] pai
+0004ecd0: 7273 206f 7220 6120 6c69 7374 206f 6620  rs or a list of 
+0004ece0: 5b78 2c20 795d 2070 6169 7273 2e20 2054  [x, y] pairs.  T
+0004ecf0: 6865 0a20 2020 2020 2020 2072 6574 7572  he.        retur
+0004ed00: 6e65 6420 636f 6e74 6f75 7220 6861 7320  ned contour has 
+0004ed10: 7468 6520 7361 6d65 2072 6570 7265 7365  the same represe
+0004ed20: 6e74 6174 696f 6e2e 0a0a 2020 2020 6e5f  ntation...    n_
+0004ed30: 706f 696e 7420 3a20 696e 742c 2064 6566  point : int, def
+0004ed40: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0004ed50: 2020 4e75 6d62 6572 206f 6620 706f 696e    Number of poin
+0004ed60: 7473 2074 6f20 6465 6669 6e65 2063 6f6e  ts to define con
+0004ed70: 746f 7572 2c20 6166 7465 7220 696e 7465  tour, after inte
+0004ed80: 7270 6f6c 6174 696f 6e2e 2020 5468 6973  rpolation.  This
+0004ed90: 206d 7573 740a 2020 2020 2020 2020 6265   must.        be
+0004eda0: 2073 6574 2074 6f20 4e6f 6e65 2066 6f72   set to None for
+0004edb0: 2064 7879 2074 6f20 6265 2063 6f6e 7369   dxy to be consi
+0004edc0: 6465 7265 642e 0a0a 2020 2020 6478 7920  dered...    dxy 
+0004edd0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0004ede0: 3d4e 6f6e 650a 2020 2020 2020 2020 4170  =None.        Ap
+0004edf0: 7072 6f78 696d 6174 6520 6469 7374 616e  proximate distan
+0004ee00: 6365 2072 6571 7569 7265 6420 6265 7477  ce required betw
+0004ee10: 6565 6e20 636f 6e74 6f75 7220 706f 696e  een contour poin
+0004ee20: 7473 2e20 2054 6869 7320 6973 2074 616b  ts.  This is tak
+0004ee30: 656e 0a20 2020 2020 2020 2069 6e74 6f20  en.        into 
+0004ee40: 6163 636f 756e 7420 6f6e 6c79 2069 6620  account only if 
+0004ee50: 6e5f 706f 696e 7420 6973 2073 6574 2074  n_point is set t
+0004ee60: 6f20 4e6f 6e65 2e20 2046 6f72 2061 2063  o None.  For a c
+0004ee70: 6f6e 746f 7572 206f 660a 2020 2020 2020  ontour of.      
+0004ee80: 2020 6c65 6e67 7468 2063 6f6e 746f 7572    length contour
+0004ee90: 5f6c 656e 6774 682c 2074 6865 206e 756d  _length, the num
+0004eea0: 6265 7220 6f66 2063 6f6e 746f 7572 2070  ber of contour p
+0004eeb0: 6f69 6e74 7320 6973 2074 6865 6e20 7461  oints is then ta
+0004eec0: 6b65 6e0a 2020 2020 2020 2020 746f 2062  ken.        to b
+0004eed0: 6520 6d61 7828 696e 7428 636f 6e74 6f75  e max(int(contou
+0004eee0: 725f 6c65 6e67 7468 202f 2064 7879 292c  r_length / dxy),
+0004eef0: 2033 292e 2020 0a0a 2020 2020 736d 6f6f   3).  ..    smoo
+0004ef00: 7468 6e65 7373 5f70 6572 5f70 6f69 6e74  thness_per_point
+0004ef10: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+0004ef20: 743d 300a 2020 2020 2020 2020 5061 7261  t=0.        Para
+0004ef30: 6d65 7465 7220 6465 7465 726d 696e 696e  meter determinin
+0004ef40: 6720 7468 6520 736d 6f6f 7468 6e65 7373  g the smoothness
+0004ef50: 206f 6620 7468 6520 422d 7370 6c69 6e65   of the B-spline
+0004ef60: 2063 7572 7665 2075 7365 640a 2020 2020   curve used.    
+0004ef70: 2020 2020 696e 2063 6f6e 746f 7572 2061      in contour a
+0004ef80: 7070 726f 7869 6d61 7469 6f6e 2066 6f72  pproximation for
+0004ef90: 2069 6e74 6572 706f 6c61 7469 6f6e 2e20   interpolation. 
+0004efa0: 2054 6865 2070 726f 6475 6374 206f 660a   The product of.
+0004efb0: 2020 2020 2020 2020 736d 6f6f 7468 6e65          smoothne
+0004efc0: 7373 5f70 6572 5f70 6f69 6e74 2061 6e64  ss_per_point and
+0004efd0: 2074 6865 206e 756d 6265 7220 6f66 2063   the number of c
+0004efe0: 6f6e 746f 7572 2070 6f69 6e74 7320 2873  ontour points (s
+0004eff0: 7065 6369 6669 6564 0a20 2020 2020 2020  pecified.       
+0004f000: 2064 6972 6563 746c 7920 7669 6120 6e5f   directly via n_
+0004f010: 706f 696e 742c 206f 7220 696e 6469 7265  point, or indire
+0004f020: 6374 6c79 2076 6961 2064 7879 2920 636f  ctly via dxy) co
+0004f030: 7272 6573 706f 6e64 7320 746f 2074 6865  rresponds to the
+0004f040: 0a20 2020 2020 2020 2070 6172 616d 6574  .        paramet
+0004f050: 6572 2073 206f 6620 7363 6970 792e 696e  er s of scipy.in
+0004f060: 7465 7270 6f6c 6174 652e 7370 6c70 7265  terpolate.splpre
+0004f070: 7020 2d20 7365 6520 646f 6375 6d65 6e74  p - see document
+0004f080: 6174 696f 6e20 6174 3a0a 2020 2020 2020  ation at:.      
+0004f090: 2020 0a20 2020 2020 2020 2068 7474 7073    .        https
+0004f0a0: 3a2f 2f73 6369 7079 2e67 6974 6875 622e  ://scipy.github.
+0004f0b0: 696f 2f64 6576 646f 6373 2f72 6566 6572  io/devdocs/refer
+0004f0c0: 656e 6365 2f67 656e 6572 6174 6564 2f73  ence/generated/s
+0004f0d0: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+0004f0e0: 2e73 706c 7072 6570 2e68 746d 6c23 7363  .splprep.html#sc
+0004f0f0: 6970 792e 696e 7465 7270 6f6c 6174 652e  ipy.interpolate.
+0004f100: 7370 6c70 7265 700a 0a20 2020 2020 2020  splprep..       
+0004f110: 2041 2073 6d6f 6f74 686e 6573 735f 7065   A smoothness_pe
+0004f120: 725f 706f 696e 7420 6f66 2030 2066 6f72  r_point of 0 for
+0004f130: 6365 7320 7468 6520 422d 7370 6c69 6e65  ces the B-spline
+0004f140: 2074 6f20 7061 7373 2074 6872 6f75 6768   to pass through
+0004f150: 0a20 2020 2020 2020 2061 6c6c 206f 6620  .        all of 
+0004f160: 7468 6520 7072 652d 696e 7465 7270 6f6c  the pre-interpol
+0004f170: 6174 696f 6e20 636f 6e74 6f75 7220 706f  ation contour po
+0004f180: 696e 7473 2e0a 2020 2020 2727 270a 0a20  ints..    '''.. 
+0004f190: 2020 2023 2045 7874 7261 6374 206c 6973     # Extract lis
+0004f1a0: 7420 6f66 2063 6f6e 746f 7572 2070 6f69  t of contour poi
+0004f1b0: 6e74 7320 6672 6f6d 2073 6f75 7263 652e  nts from source.
+0004f1c0: 0a20 2020 2063 6f6e 746f 7572 5f6c 656e  .    contour_len
+0004f1d0: 6774 6820 3d20 4e6f 6e65 0a20 2020 2069  gth = None.    i
+0004f1e0: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
+0004f1f0: 7263 652c 2067 656f 6d65 7472 792e 706f  rce, geometry.po
+0004f200: 6c79 676f 6e2e 506f 6c79 676f 6e29 3a0a  lygon.Polygon):.
+0004f210: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+0004f220: 206c 6973 7428 706f 6c79 676f 6e5f 746f   list(polygon_to
+0004f230: 5f63 6f6e 746f 7572 2873 6f75 7263 6529  _contour(source)
+0004f240: 290a 2020 2020 2020 2020 636f 6e74 6f75  ).        contou
+0004f250: 725f 6c65 6e67 7468 203d 2073 6f75 7263  r_length = sourc
+0004f260: 652e 6c65 6e67 7468 0a20 2020 2065 6c69  e.length.    eli
+0004f270: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
+0004f280: 7263 652c 206e 702e 6e64 6172 7261 7929  rce, np.ndarray)
+0004f290: 206f 7220 6973 696e 7374 616e 6365 2873   or isinstance(s
+0004f2a0: 6f75 7263 652c 206c 6973 7429 3a0a 2020  ource, list):.  
+0004f2b0: 2020 2020 2020 706f 696e 7473 203d 206c        points = l
+0004f2c0: 6973 7428 736f 7572 6365 290a 2020 2020  ist(source).    
+0004f2d0: 656c 7365 3a0a 2020 2020 2020 2020 706f  else:.        po
+0004f2e0: 696e 7473 203d 204e 6f6e 650a 0a20 2020  ints = None..   
+0004f2f0: 2069 6620 706f 696e 7473 2069 7320 4e6f   if points is No
+0004f300: 6e65 3a0a 2020 2020 2020 2020 7072 696e  ne:.        prin
+0004f310: 7428 2755 6e72 6563 6f67 6e69 7365 6420  t('Unrecognised 
+0004f320: 736f 7572 6365 2070 6173 7365 6420 746f  source passed to
+0004f330: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+0004f340: 2020 2027 5c27 696e 7465 7270 6f6c 6174     '\'interpolat
+0004f350: 655f 706f 696e 7473 5f73 696e 676c 655f  e_points_single_
+0004f360: 636f 6e74 6f75 7228 295c 2727 290a 2020  contour()\'').  
+0004f370: 2020 2020 2020 7072 696e 7428 2753 6f75        print('Sou
+0004f380: 7263 6520 6d75 7374 2062 6520 7368 6170  rce must be shap
+0004f390: 656c 7920 506f 6c79 676f 6e20 6f72 2063  ely Polygon or c
+0004f3a0: 6f6e 746f 7572 2729 0a20 2020 2020 2020  ontour').       
+0004f3b0: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
+0004f3c0: 2020 2320 4966 206e 756d 6265 7220 6f66    # If number of
+0004f3d0: 2063 6f6e 746f 7572 2070 6f69 6e74 7320   contour points 
+0004f3e0: 6e6f 7420 7061 7373 6564 2064 6972 6563  not passed direc
+0004f3f0: 746c 792c 0a20 2020 2023 2074 7279 2074  tly,.    # try t
+0004f400: 6f20 6465 7465 726d 696e 6520 6974 7320  o determine its 
+0004f410: 7661 6c75 6520 6672 6f6d 2074 6865 2064  value from the d
+0004f420: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
+0004f430: 636f 6e74 6f75 7220 706f 696e 7473 2e0a  contour points..
+0004f440: 2020 2020 6966 206e 5f70 6f69 6e74 2069      if n_point i
+0004f450: 7320 4e6f 6e65 2061 6e64 2064 7879 3a0a  s None and dxy:.
+0004f460: 2020 2020 2020 2020 6966 2063 6f6e 746f          if conto
+0004f470: 7572 5f6c 656e 6774 6820 6973 204e 6f6e  ur_length is Non
+0004f480: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+0004f490: 6f6e 746f 7572 5f6c 656e 6774 6820 3d20  ontour_length = 
+0004f4a0: 636f 6e74 6f75 725f 746f 5f70 6f6c 7967  contour_to_polyg
+0004f4b0: 6f6e 2873 6f75 7263 6529 2e6c 656e 6774  on(source).lengt
+0004f4c0: 680a 2020 2020 2020 2020 6e5f 706f 696e  h.        n_poin
+0004f4d0: 7420 3d20 6d61 7828 696e 7428 636f 6e74  t = max(int(cont
+0004f4e0: 6f75 725f 6c65 6e67 7468 202f 2064 7879  our_length / dxy
+0004f4f0: 292c 2033 290a 2020 2020 6966 206e 5f70  ), 3).    if n_p
+0004f500: 6f69 6e74 2069 7320 4e6f 6e65 3a0a 2020  oint is None:.  
+0004f510: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
+0004f520: 696e 7465 7270 6f6c 6174 696f 6e20 7065  interpolation pe
+0004f530: 7266 6f72 6d65 6427 290a 2020 2020 2020  rformed').      
+0004f540: 2020 7072 696e 7428 274e 756d 6265 7220    print('Number 
+0004f550: 6f66 2063 6f6e 746f 7572 2070 6f69 6e74  of contour point
+0004f560: 7320 286e 5f70 6f69 6e74 2920 6f72 2064  s (n_point) or d
+0004f570: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
+0004f580: 706f 696e 7473 270a 2020 2020 2020 2020  points'.        
+0004f590: 2020 2020 2020 2020 276d 7573 7420 6265          'must be
+0004f5a0: 2073 7065 6369 6669 6564 2e27 290a 2020   specified.').  
+0004f5b0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0004f5c0: 650a 0a20 2020 2023 204d 616b 6520 6c61  e..    # Make la
+0004f5d0: 7374 2070 6f69 6e74 2074 6865 2073 616d  st point the sam
+0004f5e0: 6520 6173 2074 6865 2066 6972 7374 2c20  e as the first, 
+0004f5f0: 746f 2065 6e73 7572 6520 636c 6f73 6564  to ensure closed
+0004f600: 2063 7572 7665 2e0a 2020 2020 706f 696e   curve..    poin
+0004f610: 7473 2e61 7070 656e 6428 706f 696e 7473  ts.append(points
+0004f620: 5b30 5d29 0a0a 2020 2020 2320 4469 7363  [0])..    # Disc
+0004f630: 6172 6420 706f 696e 7473 2074 6861 7420  ard points that 
+0004f640: 6172 656e 2774 2073 6570 6172 6174 6564  aren't separated
+0004f650: 2066 726f 6d20 7468 6520 7072 6563 6565   from the precee
+0004f660: 6469 6e67 2070 6f69 6e74 0a20 2020 2023  ding point.    #
+0004f670: 2062 7920 6174 206c 6561 7374 2073 6f6d   by at least som
+0004f680: 6520 6d69 6e69 6d75 6d20 6469 7374 616e  e minimum distan
+0004f690: 6365 2e0a 2020 2020 6478 795f 6d69 6e20  ce..    dxy_min 
+0004f6a0: 3d20 302e 3030 310a 2020 2020 785f 6c61  = 0.001.    x_la
+0004f6b0: 7374 2c20 795f 6c61 7374 203d 2070 6f69  st, y_last = poi
+0004f6c0: 6e74 735b 305d 0a20 2020 2078 5f76 616c  nts[0].    x_val
+0004f6d0: 7565 732c 2079 5f76 616c 7565 7320 3d20  ues, y_values = 
+0004f6e0: 285b 785f 6c61 7374 5d2c 205b 795f 6c61  ([x_last], [y_la
+0004f6f0: 7374 5d29 0a20 2020 2066 6f72 2069 2069  st]).    for i i
+0004f700: 6e20 7261 6e67 6528 312c 206c 656e 2870  n range(1, len(p
+0004f710: 6f69 6e74 7329 293a 0a20 2020 2020 2020  oints)):.       
+0004f720: 2078 2c20 7920 3d20 706f 696e 7473 5b69   x, y = points[i
+0004f730: 5d0a 2020 2020 2020 2020 6966 2028 6162  ].        if (ab
+0004f740: 7328 7820 2d20 785f 6c61 7374 2920 3e20  s(x - x_last) > 
+0004f750: 6478 795f 6d69 6e29 206f 7220 2861 6273  dxy_min) or (abs
+0004f760: 2879 202d 2079 5f6c 6173 7429 203e 2064  (y - y_last) > d
+0004f770: 7879 5f6d 696e 293a 0a20 2020 2020 2020  xy_min):.       
+0004f780: 2020 2020 2078 5f76 616c 7565 732e 6170       x_values.ap
+0004f790: 7065 6e64 2870 6f69 6e74 735b 695d 5b30  pend(points[i][0
+0004f7a0: 5d29 0a20 2020 2020 2020 2020 2020 2079  ]).            y
+0004f7b0: 5f76 616c 7565 732e 6170 7065 6e64 2870  _values.append(p
+0004f7c0: 6f69 6e74 735b 695d 5b31 5d29 0a20 2020  oints[i][1]).   
+0004f7d0: 2020 2020 2078 5f6c 6173 742c 2079 5f6c       x_last, y_l
+0004f7e0: 6173 7420 3d20 706f 696e 7473 5b69 5d0a  ast = points[i].
+0004f7f0: 0a20 2020 2078 5f76 616c 7565 7320 3d20  .    x_values = 
+0004f800: 6e70 2e61 7272 6179 2878 5f76 616c 7565  np.array(x_value
+0004f810: 7329 0a20 2020 2079 5f76 616c 7565 7320  s).    y_values 
+0004f820: 3d20 6e70 2e61 7272 6179 2879 5f76 616c  = np.array(y_val
+0004f830: 7565 7329 0a0a 2020 2020 2320 496e 7465  ues)..    # Inte
+0004f840: 7270 6f6c 6174 6520 636f 6e74 6f75 7220  rpolate contour 
+0004f850: 706f 696e 7473 2e0a 2020 2020 736d 6f6f  points..    smoo
+0004f860: 7468 6e65 7373 203d 2073 6d6f 6f74 686e  thness = smoothn
+0004f870: 6573 735f 7065 725f 706f 696e 7420 2a20  ess_per_point * 
+0004f880: 6c65 6e28 785f 7661 6c75 6573 290a 2020  len(x_values).  
+0004f890: 2020 7472 793a 0a23 2020 2020 2020 2020    try:.#        
+0004f8a0: 7769 7468 2077 6172 6e69 6e67 732e 6361  with warnings.ca
+0004f8b0: 7463 685f 7761 726e 696e 6773 2829 3a0a  tch_warnings():.
+0004f8c0: 2320 2020 2020 2020 2020 2020 2077 6172  #            war
+0004f8d0: 6e69 6e67 732e 6669 6c74 6572 7761 726e  nings.filterwarn
+0004f8e0: 696e 6773 2822 6967 6e6f 7265 222c 206d  ings("ignore", m
+0004f8f0: 6573 7361 6765 3d22 5365 7474 696e 6720  essage="Setting 
+0004f900: 7822 290a 2020 2020 2020 2020 2020 2020  x").            
+0004f910: 7463 6b2c 2075 203d 2069 6e74 6572 706f  tck, u = interpo
+0004f920: 6c61 7465 2e73 706c 7072 6570 280a 2020  late.splprep(.  
+0004f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f940: 2020 5b78 5f76 616c 7565 732c 2079 5f76    [x_values, y_v
+0004f950: 616c 7565 735d 2c20 733d 736d 6f6f 7468  alues], s=smooth
+0004f960: 6e65 7373 2c20 7065 723d 5472 7565 290a  ness, per=True).
+0004f970: 2020 2020 6578 6365 7074 2054 7970 6545      except TypeE
+0004f980: 7272 6f72 2061 7320 7072 6f62 6c65 6d3a  rror as problem:
+0004f990: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
+0004f9a0: 5741 524e 494e 473a 2050 726f 626c 656d  WARNING: Problem
+0004f9b0: 2069 6e20 696e 7465 7270 6f6c 6174 655f   in interpolate_
+0004f9c0: 636f 6e74 6f75 725f 706f 696e 7473 2829  contour_points()
+0004f9d0: 3a22 2c20 7072 6f62 6c65 6d29 0a20 2020  :", problem).   
+0004f9e0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0004f9f0: 0a0a 2020 2020 7869 5f76 616c 7565 732c  ..    xi_values,
+0004fa00: 2079 695f 7661 6c75 6573 203d 2069 6e74   yi_values = int
+0004fa10: 6572 706f 6c61 7465 2e73 706c 6576 280a  erpolate.splev(.
+0004fa20: 2020 2020 2020 2020 6e70 2e6c 696e 7370          np.linsp
+0004fa30: 6163 6528 302e 2c20 312e 2c20 6e5f 706f  ace(0., 1., n_po
+0004fa40: 696e 7420 2b20 3129 2c20 7463 6b29 0a0a  int + 1), tck)..
+0004fa50: 2020 2020 2320 5374 6f72 6520 706f 696e      # Store poin
+0004fa60: 7473 2069 6e20 6120 666f 726d 2074 6861  ts in a form tha
+0004fa70: 7420 6d61 7920 6265 2063 6f6e 7665 7274  t may be convert
+0004fa80: 6564 2074 6f20 6120 6e75 6d70 7920 6172  ed to a numpy ar
+0004fa90: 7261 792e 0a20 2020 2070 6f69 6e74 735f  ray..    points_
+0004faa0: 696e 7465 7270 6f6c 6174 6564 203d 206c  interpolated = l
+0004fab0: 6973 7428 7a69 7028 7869 5f76 616c 7565  ist(zip(xi_value
+0004fac0: 732c 2079 695f 7661 6c75 6573 2929 0a20  s, yi_values)). 
+0004fad0: 2020 2070 6f69 6e74 735f 696e 7465 7270     points_interp
+0004fae0: 6f6c 6174 6564 203d 205b 7879 2066 6f72  olated = [xy for
+0004faf0: 2078 7920 696e 2070 6f69 6e74 735f 696e   xy in points_in
+0004fb00: 7465 7270 6f6c 6174 6564 5d0a 0a20 2020  terpolated]..   
+0004fb10: 2023 2052 6574 7572 6e20 696e 7465 7270   # Return interp
+0004fb20: 6f6c 6174 6564 2063 6f6e 746f 7572 2069  olated contour i
+0004fb30: 6e20 7468 6520 7361 6d65 2072 6570 7265  n the same repre
+0004fb40: 7365 6e74 6174 696f 6e20 6173 2074 6865  sentation as the
+0004fb50: 2073 6f75 7263 652e 0a20 2020 2069 6620   source..    if 
+0004fb60: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
+0004fb70: 652c 2067 656f 6d65 7472 792e 706f 6c79  e, geometry.poly
+0004fb80: 676f 6e2e 506f 6c79 676f 6e29 3a0a 2020  gon.Polygon):.  
+0004fb90: 2020 2020 2020 6f75 745f 6f62 6a65 6374        out_object
+0004fba0: 203d 2067 656f 6d65 7472 792e 706f 6c79   = geometry.poly
+0004fbb0: 676f 6e2e 506f 6c79 676f 6e28 706f 696e  gon.Polygon(poin
+0004fbc0: 7473 5f69 6e74 6572 706f 6c61 7465 6429  ts_interpolated)
+0004fbd0: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
+0004fbe0: 616e 6365 2873 6f75 7263 652c 206e 702e  ance(source, np.
+0004fbf0: 6e64 6172 7261 7929 3a0a 2020 2020 2020  ndarray):.      
+0004fc00: 2020 6f75 745f 6f62 6a65 6374 203d 206e    out_object = n
+0004fc10: 702e 6172 7261 7928 706f 696e 7473 5f69  p.array(points_i
+0004fc20: 6e74 6572 706f 6c61 7465 6429 0a20 2020  nterpolated).   
+0004fc30: 2065 6c73 653a 0a20 2020 2020 2020 206f   else:.        o
+0004fc40: 7574 5f6f 626a 6563 7420 3d20 706f 696e  ut_object = poin
+0004fc50: 7473 5f69 6e74 6572 706f 6c61 7465 640a  ts_interpolated.
+0004fc60: 0a20 2020 2072 6574 7572 6e20 6f75 745f  .    return out_
+0004fc70: 6f62 6a65 6374 0a0a 6465 6620 7772 6974  object..def writ
+0004fc80: 655f 7374 7275 6374 7572 655f 7365 745f  e_structure_set_
+0004fc90: 6469 636f 6d28 0a20 2020 206f 7574 6e61  dicom(.    outna
+0004fca0: 6d65 2c20 0a20 2020 2072 6f69 732c 200a  me, .    rois, .
+0004fcb0: 2020 2020 696d 6167 653d 4e6f 6e65 2c20      image=None, 
+0004fcc0: 0a20 2020 2061 6666 696e 653d 4e6f 6e65  .    affine=None
+0004fcd0: 2c20 0a20 2020 2073 6861 7065 3d4e 6f6e  , .    shape=Non
+0004fce0: 652c 0a20 2020 206f 7269 656e 7461 7469  e,.    orientati
+0004fcf0: 6f6e 3d4e 6f6e 652c 200a 2020 2020 6865  on=None, .    he
+0004fd00: 6164 6572 5f73 6f75 7263 653d 4e6f 6e65  ader_source=None
+0004fd10: 2c20 0a20 2020 2070 6174 6965 6e74 5f69  , .    patient_i
+0004fd20: 643d 4e6f 6e65 2c0a 2020 2020 6d6f 6461  d=None,.    moda
+0004fd30: 6c69 7479 3d4e 6f6e 652c 200a 2020 2020  lity=None, .    
+0004fd40: 726f 6f74 5f75 6964 3d4e 6f6e 650a 293a  root_uid=None.):
+0004fd50: 0a0a 2020 2020 2320 4368 6563 6b20 7765  ..    # Check we
+0004fd60: 2068 6176 6520 7468 6520 7265 6c65 7661   have the releva
+0004fd70: 6e74 2069 6e66 6f0a 2020 2020 6966 206e  nt info.    if n
+0004fd80: 6f74 2069 6d61 6765 2061 6e64 2028 6e6f  ot image and (no
+0004fd90: 7420 6166 6669 6e65 206f 7220 6e6f 7420  t affine or not 
+0004fda0: 7368 6170 6529 3a0a 2020 2020 2020 2020  shape):.        
+0004fdb0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+0004fdc0: 6f72 2822 4d75 7374 2070 726f 7669 6465  or("Must provide
+0004fdd0: 2065 6974 6865 7220 616e 2069 6d61 6765   either an image
+0004fde0: 206f 7220 616e 2061 6666 696e 6520 6d61   or an affine ma
+0004fdf0: 7472 6978 2022 0a20 2020 2020 2020 2020  trix ".         
+0004fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fe10: 2020 2261 6e64 2073 6861 7065 2122 290a    "and shape!").
+0004fe20: 0a20 2020 2023 2054 7279 2067 6574 7469  .    # Try getti
+0004fe30: 6e67 2064 6963 6f6d 2064 6174 6173 6574  ng dicom dataset
+0004fe40: 2066 726f 6d20 696d 6167 650a 2020 2020   from image.    
+0004fe50: 6473 203d 204e 6f6e 650a 2020 2020 6966  ds = None.    if
+0004fe60: 2069 6d61 6765 3a0a 2020 2020 2020 2020   image:.        
+0004fe70: 6966 2068 6173 6174 7472 2869 6d61 6765  if hasattr(image
+0004fe80: 2c20 2264 6963 6f6d 5f64 6174 6173 6574  , "dicom_dataset
+0004fe90: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0004fea0: 6473 203d 2069 6d61 6765 2e64 6963 6f6d  ds = image.dicom
+0004feb0: 5f64 6174 6173 6574 0a20 2020 2020 2020  _dataset.       
+0004fec0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0004fed0: 2020 2064 7320 3d20 736b 7274 2e69 6d61     ds = skrt.ima
+0004fee0: 6765 2e63 7265 6174 655f 6469 636f 6d28  ge.create_dicom(
+0004fef0: 290a 2020 2020 2020 2020 2020 2020 6473  ).            ds
+0004ff00: 2e73 6574 5f67 656f 6d65 7472 7928 0a20  .set_geometry(. 
+0004ff10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004ff20: 6d61 6765 2e67 6574 5f61 6666 696e 6528  mage.get_affine(
+0004ff30: 292c 2069 6d61 6765 2e67 6574 5f64 6174  ), image.get_dat
+0004ff40: 6128 292e 7368 6170 652c 0a20 2020 2020  a().shape,.     
+0004ff50: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0004ff60: 2e67 6574 5f6f 7269 656e 7461 7469 6f6e  .get_orientation
+0004ff70: 5f76 6563 746f 7228 696d 6167 652e 6765  _vector(image.ge
+0004ff80: 745f 6166 6669 6e65 2c20 2264 6963 6f6d  t_affine, "dicom
+0004ff90: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+0004ffa0: 0a0a 2020 2020 2320 4f74 6865 7277 6973  ..    # Otherwis
+0004ffb0: 652c 2063 7265 6174 6520 6672 6573 6820  e, create fresh 
+0004ffc0: 6469 636f 6d20 6461 7461 7365 740a 2020  dicom dataset.  
+0004ffd0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0004ffe0: 6473 203d 2073 6b72 742e 696d 6167 652e  ds = skrt.image.
+0004fff0: 6372 6561 7465 5f64 6963 6f6d 2870 6174  create_dicom(pat
+00050000: 6965 6e74 5f69 642c 206d 6f64 616c 6974  ient_id, modalit
+00050010: 792c 2072 6f6f 745f 7569 6429 0a20 2020  y, root_uid).   
+00050020: 2020 2020 2064 732e 7365 745f 6765 6f6d       ds.set_geom
+00050030: 6574 7279 2861 6666 696e 652c 2073 6861  etry(affine, sha
+00050040: 7065 2c20 6f72 6965 6e74 6174 696f 6e29  pe, orientation)
+00050050: 0a0a 2020 2020 2320 4164 6a75 7374 2064  ..    # Adjust d
+00050060: 6174 6173 6574 2074 6f20 6265 2066 6f72  ataset to be for
+00050070: 2053 7472 7563 7475 7265 5365 7420 696e   StructureSet in
+00050080: 7374 6561 6420 6f66 2069 6d61 6765 0a0a  stead of image..
+00050090: 0a64 6566 2064 6963 6f6d 5f64 6174 6173  .def dicom_datas
+000500a0: 6574 5f74 6f5f 7374 7275 6374 7572 655f  et_to_structure_
+000500b0: 7365 7428 6473 293a 0a20 2020 2027 2727  set(ds):.    '''
+000500c0: 436f 6e76 6572 7420 616e 2065 7869 7374  Convert an exist
+000500d0: 696e 6720 696d 6167 6520 6469 636f 6d20  ing image dicom 
+000500e0: 6461 7461 7365 7420 746f 2061 2053 7472  dataset to a Str
+000500f0: 7563 7475 7265 5365 7420 6461 7461 7365  uctureSet datase
+00050100: 742e 2727 270a 0a20 2020 2023 2041 646a  t.'''..    # Adj
+00050110: 7573 7420 636c 6173 7320 5549 4473 0a20  ust class UIDs. 
+00050120: 2020 2064 732e 6669 6c65 5f6d 6574 612e     ds.file_meta.
+00050130: 496d 706c 656d 656e 7461 7469 6f6e 436c  ImplementationCl
+00050140: 6173 7355 4944 203d 2022 392e 392e 392e  assUID = "9.9.9.
+00050150: 3130 302e 302e 302e 312e 302e 392e 362e  100.0.0.1.0.9.6.
+00050160: 302e 302e 3122 0a20 2020 2064 732e 6669  0.0.1".    ds.fi
+00050170: 6c65 5f6d 6574 612e 4d65 6469 6153 746f  le_meta.MediaSto
+00050180: 7261 6765 534f 5043 6c61 7373 5549 4420  rageSOPClassUID 
+00050190: 3d20 2231 2e32 2e38 3430 2e31 3030 3038  = "1.2.840.10008
+000501a0: 2e35 2e31 2e34 2e31 2e31 2e34 3831 2e33  .5.1.4.1.1.481.3
+000501b0: 220a 0a20 2020 2023 2041 7373 6967 6e20  "..    # Assign 
+000501c0: 656d 7074 7920 7365 7175 656e 6365 730a  empty sequences.
+000501d0: 2020 2020 6473 2e52 6566 6572 656e 6365      ds.Reference
+000501e0: 6446 7261 6d65 6f66 5265 6665 7265 6e63  dFrameofReferenc
+000501f0: 6553 6571 7565 6e63 6520 3d20 5365 7175  eSequence = Sequ
+00050200: 656e 6365 2829 0a20 2020 2064 732e 5374  ence().    ds.St
+00050210: 7275 6374 7572 6553 6574 524f 4953 6571  ructureSetROISeq
+00050220: 7565 6e63 6520 3d20 5365 7175 656e 6365  uence = Sequence
+00050230: 2829 0a20 2020 2064 732e 5254 524f 494f  ().    ds.RTROIO
+00050240: 6273 6572 7661 7469 6f6e 7353 6571 7565  bservationsSeque
+00050250: 6e63 6520 3d20 5365 7175 656e 6365 2829  nce = Sequence()
+00050260: 0a20 2020 2064 732e 524f 4943 6f6e 746f  .    ds.ROIConto
+00050270: 7572 5365 7175 656e 6365 203d 2053 6571  urSequence = Seq
+00050280: 7565 6e63 6528 290a 0a20 2020 2023 2041  uence()..    # A
+00050290: 7373 6967 6e20 7374 7275 6374 7572 6520  ssign structure 
+000502a0: 7365 7420 7072 6f70 6572 7469 6573 0a20  set properties. 
+000502b0: 2020 2064 732e 5374 7275 6374 7572 6553     ds.StructureS
+000502c0: 6574 4c61 6265 6c20 3d20 2222 0a20 2020  etLabel = "".   
+000502d0: 2064 732e 5374 7275 6374 7572 6553 6574   ds.StructureSet
+000502e0: 4461 7465 203d 2064 732e 496e 7374 616e  Date = ds.Instan
+000502f0: 6365 4372 6561 7469 6f6e 4461 7465 0a20  ceCreationDate. 
+00050300: 2020 2064 732e 5374 7275 6374 7572 6553     ds.StructureS
+00050310: 6574 5469 6d65 203d 2064 732e 496e 7374  etTime = ds.Inst
+00050320: 616e 6365 4372 6561 7469 6f6e 5469 6d65  anceCreationTime
+00050330: 0a0a 2020 2020 2320 4173 7369 676e 2066  ..    # Assign f
+00050340: 7261 6d65 206f 6620 7265 6665 7265 6e63  rame of referenc
+00050350: 650a 0a0a 6465 6620 6372 6561 7465 5f64  e...def create_d
+00050360: 756d 6d79 5f69 6d61 6765 280a 2020 2020  ummy_image(.    
+00050370: 6578 7465 6e74 732c 200a 2020 2020 736c  extents, .    sl
+00050380: 6963 655f 7468 6963 6b6e 6573 732c 0a20  ice_thickness,. 
+00050390: 2020 2073 6861 7065 3d4e 6f6e 652c 200a     shape=None, .
+000503a0: 2020 2020 766f 7865 6c5f 7369 7a65 3d4e      voxel_size=N
+000503b0: 6f6e 652c 0a20 2020 2066 696c 6c5f 7661  one,.    fill_va
+000503c0: 6c3d 3165 342c 0a20 2020 2062 7566 6665  l=1e4,.    buffe
+000503d0: 723d 320a 293a 0a20 2020 2022 2222 4d61  r=2.):.    """Ma
+000503e0: 6b65 2061 2064 756d 6d79 2069 6d61 6765  ke a dummy image
+000503f0: 2074 6861 7420 636f 7665 7273 2074 6865   that covers the
+00050400: 2061 7265 6120 7370 616e 6e65 6420 6279   area spanned by
+00050410: 203c 6578 7465 6e74 733e 2070 6c75 7320   <extents> plus 
+00050420: 6120 0a20 2020 2062 7566 6665 722e 0a0a  a .    buffer...
+00050430: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+00050440: 3a2a 2a0a 2020 2020 0a20 2020 2065 7874  :**.    .    ext
+00050450: 656e 7473 203a 206c 6973 740a 2020 2020  ents : list.    
+00050460: 2020 2020 4c69 7374 206f 6620 5b6d 696e      List of [min
+00050470: 2c20 6d61 785d 2065 7874 656e 7473 2069  , max] extents i
+00050480: 6e20 6d6d 2061 6c6f 6e67 2065 6163 6820  n mm along each 
+00050490: 6f66 2074 6865 2074 6872 6565 2061 7865  of the three axe
+000504a0: 7320 696e 200a 2020 2020 2020 2020 6f72  s in .        or
+000504b0: 6465 7220 5b78 2c20 792c 207a 5d2e 0a0a  der [x, y, z]...
+000504c0: 2020 2020 736c 6963 655f 7468 6963 6b6e      slice_thickn
+000504d0: 6573 7320 3a20 666c 6f61 740a 2020 2020  ess : float.    
+000504e0: 2020 2020 536c 6963 6520 7468 6963 6b6e      Slice thickn
+000504f0: 6573 7320 696e 206d 6d2e 0a0a 2020 2020  ess in mm...    
+00050500: 766f 7865 6c5f 7369 7a65 203a 206c 6973  voxel_size : lis
+00050510: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00050520: 2020 2020 2020 2020 566f 7865 6c20 7369          Voxel si
+00050530: 7a65 2069 6e20 6d6d 2069 6e20 7468 6520  ze in mm in the 
+00050540: 6475 6d6d 7920 696d 6167 6520 696e 2074  dummy image in t
+00050550: 6865 2078 2d79 2070 6c61 6e65 2c20 6769  he x-y plane, gi
+00050560: 7665 6e20 6173 200a 2020 2020 2020 2020  ven as .        
+00050570: 5b76 782c 2076 795d 2e20 4966 203c 7368  [vx, vy]. If <sh
+00050580: 6170 653e 2061 6e64 203c 766f 7865 6c5f  ape> and <voxel_
+00050590: 7369 7a65 3e20 6172 6520 626f 7468 204e  size> are both N
+000505a0: 6f6e 652c 2076 6f78 656c 2073 697a 6573  one, voxel sizes
+000505b0: 206f 660a 2020 2020 2020 2020 5b31 2c20   of.        [1, 
+000505c0: 315d 2077 696c 6c20 6265 2075 7365 6420  1] will be used 
+000505d0: 6279 2064 6566 6175 6c74 2e20 5468 6520  by default. The 
+000505e0: 766f 7865 6c20 7369 7a65 2069 6e20 7468  voxel size in th
+000505f0: 6520 7a20 6469 7265 6374 696f 6e20 0a20  e z direction . 
+00050600: 2020 2020 2020 2077 696c 6c20 6265 2074         will be t
+00050610: 616b 656e 2066 726f 6d20 7468 6520 6d69  aken from the mi
+00050620: 6e69 6d75 6d20 6469 7374 616e 6365 2062  nimum distance b
+00050630: 6574 7765 656e 2073 6c69 6365 2070 6f73  etween slice pos
+00050640: 6974 696f 6e73 2069 6e20 0a20 2020 2020  itions in .     
+00050650: 2020 2074 6865 2078 2d79 2063 6f6e 746f     the x-y conto
+00050660: 7572 7320 6469 6374 696f 6e61 7279 2e0a  urs dictionary..
+00050670: 0a20 2020 2073 6861 7065 203a 206c 6973  .    shape : lis
+00050680: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00050690: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+000506a0: 6620 766f 7865 6c73 2069 6e20 7468 6520  f voxels in the 
+000506b0: 6475 6d6d 7920 696d 6167 6520 696e 2074  dummy image in t
+000506c0: 6865 2078 2d79 2070 6c61 6e65 2c20 6769  he x-y plane, gi
+000506d0: 7665 6e20 6173 0a20 2020 2020 2020 205b  ven as.        [
+000506e0: 6e78 2c20 6e79 5d2e 204f 6e6c 7920 7573  nx, ny]. Only us
+000506f0: 6564 2069 6620 3c76 6f78 656c 5f73 697a  ed if <voxel_siz
+00050700: 653e 2069 7320 4e6f 6e65 2e20 0a20 2020  e> is None. .   
+00050710: 2020 2020 2054 6865 206e 756d 6265 7220       The number 
+00050720: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
+00050730: 207a 2064 6972 6563 7469 6f6e 2077 696c   z direction wil
+00050740: 6c20 6265 2074 616b 656e 2066 726f 6d20  l be taken from 
+00050750: 7468 6520 0a20 2020 2020 2020 206e 756d  the .        num
+00050760: 6265 7220 6f66 2073 6c69 6365 7320 696e  ber of slices in
+00050770: 2074 6865 2078 2d79 2063 6f6e 746f 7572   the x-y contour
+00050780: 7320 6469 6374 696f 6e61 7279 2e0a 0a20  s dictionary... 
+00050790: 2020 2066 696c 6c5f 7661 6c20 3a20 696e     fill_val : in
+000507a0: 742f 666c 6f61 742c 2064 6566 6175 6c74  t/float, default
+000507b0: 3d31 6534 0a20 2020 2020 2020 2056 616c  =1e4.        Val
+000507c0: 7565 2077 6974 6820 7768 6963 6820 7468  ue with which th
+000507d0: 6520 766f 7865 6c73 2069 6e20 7468 6520  e voxels in the 
+000507e0: 6475 6d6d 7920 696d 6167 6520 7368 6f75  dummy image shou
+000507f0: 6c64 2062 6520 6669 6c6c 6564 2e20 0a0a  ld be filled. ..
+00050800: 2020 2020 6275 6666 6572 203a 2066 6c6f      buffer : flo
+00050810: 6174 2c20 6465 6661 756c 743d 320a 2020  at, default=2.  
+00050820: 2020 2020 2020 4275 6666 6572 2061 6d6f        Buffer amo
+00050830: 756e 7420 6f66 2077 6869 7465 7370 6163  unt of whitespac
+00050840: 6520 696e 206d 6d20 746f 2061 6464 206f  e in mm to add o
+00050850: 7574 7369 6465 2074 6865 2052 4f49 2069  utside the ROI i
+00050860: 6e20 6561 6368 200a 2020 2020 2020 2020  n each .        
+00050870: 6469 7265 6374 696f 6e2e 0a20 2020 2022  direction..    "
+00050880: 2222 0a0a 2020 2020 2320 4173 7369 676e  ""..    # Assign
+00050890: 2064 6566 6175 6c74 2076 6f78 656c 2073   default voxel s
+000508a0: 697a 650a 2020 2020 6966 2073 6861 7065  ize.    if shape
+000508b0: 2069 7320 4e6f 6e65 2061 6e64 2076 6f78   is None and vox
+000508c0: 656c 5f73 697a 6520 6973 204e 6f6e 653a  el_size is None:
+000508d0: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
+000508e0: 697a 6520 3d20 5b31 2c20 315d 0a20 2020  ize = [1, 1].   
+000508f0: 2069 6620 6e6f 7420 736b 7274 2e63 6f72   if not skrt.cor
+00050900: 652e 6973 5f6c 6973 7428 766f 7865 6c5f  e.is_list(voxel_
+00050910: 7369 7a65 293a 0a20 2020 2020 2020 2076  size):.        v
+00050920: 6f78 656c 5f73 697a 6520 3d20 5b76 6f78  oxel_size = [vox
+00050930: 656c 5f73 697a 655d 202a 2032 0a0a 2020  el_size] * 2..  
+00050940: 2020 2320 4361 6c63 756c 6174 6520 766f    # Calculate vo
+00050950: 7865 6c20 7369 7a65 7320 6672 6f6d 2073  xel sizes from s
+00050960: 6861 7065 0a20 2020 2069 6620 7368 6170  hape.    if shap
+00050970: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00050980: 2020 2020 2020 2073 6861 7065 203d 206c         shape = l
+00050990: 6973 7428 7368 6170 6529 0a20 2020 2020  ist(shape).     
+000509a0: 2020 2069 6620 6c65 6e28 7368 6170 6529     if len(shape)
+000509b0: 2021 3d20 323a 0a20 2020 2020 2020 2020   != 2:.         
+000509c0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+000509d0: 6f72 2822 5368 6170 6520 7368 6f75 6c64  or("Shape should
+000509e0: 2062 6520 6120 6c69 7374 206f 6620 7477   be a list of tw
+000509f0: 6f20 7661 6c75 6573 2022 0a20 2020 2020  o values ".     
+00050a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050a10: 2020 2020 2020 2022 7370 6563 6966 7969         "specifyi
+00050a20: 6e67 2064 756d 6d79 2069 6d61 6765 2073  ng dummy image s
+00050a30: 6861 7065 2069 6e20 7468 6520 5b78 2c20  hape in the [x, 
+00050a40: 795d 2022 0a20 2020 2020 2020 2020 2020  y] ".           
+00050a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050a60: 2022 6469 7265 6374 696f 6e73 2e22 290a   "directions.").
+00050a70: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
+00050a80: 6c61 7465 2076 6f78 656c 2073 697a 6520  late voxel size 
+00050a90: 6966 2052 4f49 2065 7874 656e 7420 706c  if ROI extent pl
+00050aa0: 7573 2062 7566 6665 7220 6973 2064 6976  us buffer is div
+00050ab0: 6964 6564 2062 7920 7368 6170 650a 2020  ided by shape.  
+00050ac0: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00050ad0: 203d 205b 286d 6178 2865 7829 202d 206d   = [(max(ex) - m
+00050ae0: 696e 2865 7829 202b 2032 202a 2062 7566  in(ex) + 2 * buf
+00050af0: 6665 7229 202f 2073 6861 7065 5b69 5d0a  fer) / shape[i].
+00050b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050b10: 2020 2020 2020 666f 7220 692c 2065 7820        for i, ex 
+00050b20: 696e 2065 6e75 6d65 7261 7465 2865 7874  in enumerate(ext
+00050b30: 656e 7473 5b3a 325d 295d 0a0a 2020 2020  ents[:2])]..    
+00050b40: 2320 4f74 6865 7277 6973 652c 2063 616c  # Otherwise, cal
+00050b50: 6375 6c61 7465 2073 6861 7065 2066 726f  culate shape fro
+00050b60: 6d20 766f 7865 6c20 7369 7a65 730a 2020  m voxel sizes.  
+00050b70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00050b80: 766f 7865 6c5f 7369 7a65 203d 206c 6973  voxel_size = lis
+00050b90: 7428 766f 7865 6c5f 7369 7a65 290a 2020  t(voxel_size).  
+00050ba0: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00050bb0: 2043 616c 6375 6c61 7465 206e 756d 6265   Calculate numbe
+00050bc0: 7220 6f66 2076 6f78 656c 7320 6e65 6564  r of voxels need
+00050bd0: 6564 2074 6f20 636f 7665 7220 524f 4920  ed to cover ROI 
+00050be0: 706c 7573 2062 7566 6665 7220 6561 6368  plus buffer each
+00050bf0: 2073 6964 650a 2020 2020 2020 2020 7368   side.        sh
+00050c00: 6170 6520 3d20 5b28 6e70 2e63 6569 6c28  ape = [(np.ceil(
+00050c10: 286d 6178 2865 7829 202d 206d 696e 2865  (max(ex) - min(e
+00050c20: 7829 2920 2b20 3220 2a20 6275 6666 6572  x)) + 2 * buffer
+00050c30: 2920 2f20 766f 7865 6c5f 7369 7a65 5b69  ) / voxel_size[i
+00050c40: 5d29 200a 2020 2020 2020 2020 2020 2020  ]) .            
+00050c50: 2020 2020 2066 6f72 2069 2c20 6578 2069       for i, ex i
+00050c60: 6e20 656e 756d 6572 6174 6528 6578 7465  n enumerate(exte
+00050c70: 6e74 735b 3a32 5d29 5d0a 0a20 2020 2023  nts[:2])]..    #
+00050c80: 2047 6574 207a 2076 6f78 656c 2073 697a   Get z voxel siz
+00050c90: 6520 616e 6420 7368 6170 650a 2020 2020  e and shape.    
+00050ca0: 766f 7865 6c5f 7369 7a65 2e61 7070 656e  voxel_size.appen
+00050cb0: 6428 736c 6963 655f 7468 6963 6b6e 6573  d(slice_thicknes
+00050cc0: 7329 0a20 2020 2073 6861 7065 5f7a 203d  s).    shape_z =
+00050cd0: 2028 6d61 7828 6578 7465 6e74 735b 325d   (max(extents[2]
+00050ce0: 2920 2d20 6d69 6e28 6578 7465 6e74 735b  ) - min(extents[
+00050cf0: 325d 2929 202f 2073 6c69 6365 5f74 6869  2])) / slice_thi
+00050d00: 636b 6e65 7373 0a0a 2020 2020 2320 4164  ckness..    # Ad
+00050d10: 6420 6e65 6172 6573 7420 696e 7465 6765  d nearest intege
+00050d20: 7220 6e75 6d62 6572 206f 6620 6275 6666  r number of buff
+00050d30: 6572 2076 6f78 656c 730a 2020 2020 6e5f  er voxels.    n_
+00050d40: 6275 6666 5f7a 203d 206e 702e 6365 696c  buff_z = np.ceil
+00050d50: 2862 7566 6665 7220 2f20 736c 6963 655f  (buffer / slice_
+00050d60: 7468 6963 6b6e 6573 7329 0a20 2020 2073  thickness).    s
+00050d70: 6861 7065 2e61 7070 656e 6428 7368 6170  hape.append(shap
+00050d80: 655f 7a20 2b20 3220 2a20 6e5f 6275 6666  e_z + 2 * n_buff
+00050d90: 5f7a 290a 2020 2020 7368 6170 6520 3d20  _z).    shape = 
+00050da0: 5b69 6e74 2873 2920 666f 7220 7320 696e  [int(s) for s in
+00050db0: 2073 6861 7065 5d0a 0a20 2020 2023 2047   shape]..    # G
+00050dc0: 6574 206f 7269 6769 6e20 706f 7369 7469  et origin positi
+00050dd0: 6f6e 3b20 656e 7375 7265 2074 6861 7420  on; ensure that 
+00050de0: 6f72 6967 696e 2070 6f69 6e74 7320 746f  origin points to
+00050df0: 2063 656e 7472 6520 6f66 2062 7566 6665   centre of buffe
+00050e00: 7220 766f 7865 6c20 0a20 2020 2023 206f  r voxel .    # o
+00050e10: 7574 7369 6465 2052 4f49 0a20 2020 206f  utside ROI.    o
+00050e20: 7269 6769 6e20 3d20 5b6d 696e 2865 7829  rigin = [min(ex)
+00050e30: 202b 2061 6273 2876 6f78 656c 5f73 697a   + abs(voxel_siz
+00050e40: 655b 695d 2920 2a20 302e 3520 2d20 6275  e[i]) * 0.5 - bu
+00050e50: 6666 6572 0a20 2020 2020 2020 2020 2020  ffer.           
+00050e60: 2020 2066 6f72 2069 2c20 6578 2069 6e20     for i, ex in 
+00050e70: 656e 756d 6572 6174 6528 6578 7465 6e74  enumerate(extent
+00050e80: 735b 3a32 5d29 5d0a 2020 2020 6f72 6967  s[:2])].    orig
+00050e90: 696e 2e61 7070 656e 6428 6d69 6e28 6578  in.append(min(ex
+00050ea0: 7465 6e74 735b 325d 2920 2d20 6162 7328  tents[2]) - abs(
+00050eb0: 736c 6963 655f 7468 6963 6b6e 6573 7329  slice_thickness)
+00050ec0: 202a 2028 6e5f 6275 6666 5f7a 202d 2030   * (n_buff_z - 0
+00050ed0: 2e35 2929 0a0a 2020 2020 2320 4372 6561  .5))..    # Crea
+00050ee0: 7465 2069 6d61 6765 0a20 2020 2072 6574  te image.    ret
+00050ef0: 7572 6e20 736b 7274 2e69 6d61 6765 2e49  urn skrt.image.I
+00050f00: 6d61 6765 280a 2020 2020 2020 2020 6e70  mage(.        np
+00050f10: 2e6f 6e65 7328 2873 6861 7065 5b31 5d2c  .ones((shape[1],
+00050f20: 2073 6861 7065 5b30 5d2c 2073 6861 7065   shape[0], shape
+00050f30: 5b32 5d29 2920 2a20 6669 6c6c 5f76 616c  [2])) * fill_val
+00050f40: 2c0a 2020 2020 2020 2020 766f 7865 6c5f  ,.        voxel_
+00050f50: 7369 7a65 3d76 6f78 656c 5f73 697a 652c  size=voxel_size,
+00050f60: 0a20 2020 2020 2020 206f 7269 6769 6e3d  .        origin=
+00050f70: 6f72 6967 696e 0a20 2020 2029 0a0a 0a64  origin.    )...d
+00050f80: 6566 2063 7265 6174 655f 7374 6170 6c65  ef create_staple
+00050f90: 2872 6f69 732c 202a 2a6b 7761 7267 7329  (rois, **kwargs)
+00050fa0: 3a0a 2020 2020 2222 2243 7265 6174 6520  :.    """Create 
+00050fb0: 5354 4150 4c45 2052 4f49 2066 726f 6d20  STAPLE ROI from 
+00050fc0: 6c69 7374 206f 6620 524f 4973 2e22 2222  list of ROIs."""
+00050fd0: 0a0a 2020 2020 2320 5472 7920 696d 706f  ..    # Try impo
+00050fe0: 7274 2053 696d 706c 6549 544b 0a20 2020  rt SimpleITK.   
+00050ff0: 2074 7279 3a0a 2020 2020 2020 2020 696d   try:.        im
+00051000: 706f 7274 2053 696d 706c 6549 544b 2061  port SimpleITK a
+00051010: 7320 7369 746b 0a20 2020 2065 7863 6570  s sitk.    excep
+00051020: 7420 4d6f 6475 6c65 4e6f 7446 6f75 6e64  t ModuleNotFound
+00051030: 4572 726f 723a 0a20 2020 2020 2020 2072  Error:.        r
+00051040: 6169 7365 204d 6f64 756c 654e 6f74 466f  aise ModuleNotFo
+00051050: 756e 6445 7272 6f72 2822 5369 6d70 6c65  undError("Simple
+00051060: 4954 4b20 6973 2072 6571 7569 7265 6420  ITK is required 
+00051070: 746f 2063 616c 6375 6c61 7465 2053 5441  to calculate STA
+00051080: 504c 4520 636f 6e74 6f75 722e 2022 0a20  PLE contour. ". 
+00051090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000510a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000510b0: 2022 5472 7920 696e 7374 616c 6c69 6e67   "Try installing
+000510c0: 2076 6961 3a20 7069 7020 696e 7374 616c   via: pip instal
+000510d0: 6c20 7369 6d70 6c65 6974 6b22 290a 0a20  l simpleitk").. 
+000510e0: 2020 2023 2047 6574 2053 5441 504c 4520     # Get STAPLE 
+000510f0: 6d61 736b 0a20 2020 2072 6f69 5f61 7272  mask.    roi_arr
+00051100: 6179 7320 3d20 5b5d 0a20 2020 2066 6f72  ays = [].    for
+00051110: 2072 6f69 2069 6e20 726f 6973 3a0a 2020   roi in rois:.  
+00051120: 2020 2020 2020 726f 695f 6172 7261 7973        roi_arrays
+00051130: 2e61 7070 656e 6428 7369 746b 2e47 6574  .append(sitk.Get
+00051140: 496d 6167 6546 726f 6d41 7272 6179 2872  ImageFromArray(r
+00051150: 6f69 2e67 6574 5f6d 6173 6b28 0a20 2020  oi.get_mask(.   
+00051160: 2020 2020 2020 2020 2073 7461 6e64 6172           standar
+00051170: 6469 7365 3d54 7275 6529 2e61 7374 7970  dise=True).astyp
+00051180: 6528 696e 7429 2929 0a20 2020 2070 726f  e(int))).    pro
+00051190: 6273 203d 2073 6974 6b2e 4765 7441 7272  bs = sitk.GetArr
+000511a0: 6179 4672 6f6d 496d 6167 6528 7369 746b  ayFromImage(sitk
+000511b0: 2e53 5441 504c 4528 726f 695f 6172 7261  .STAPLE(roi_arra
+000511c0: 7973 2c20 3129 290a 2020 2020 6d61 736b  ys, 1)).    mask
+000511d0: 203d 2070 726f 6273 203e 2030 2e39 350a   = probs > 0.95.
+000511e0: 0a20 2020 2023 2043 7265 6174 6520 5354  .    # Create ST
+000511f0: 4150 4c45 2052 4f49 206f 626a 6563 740a  APLE ROI object.
+00051200: 2020 2020 7265 7475 726e 2052 4f49 286d      return ROI(m
+00051210: 6173 6b2c 202a 2a6b 7761 7267 7329 0a0a  ask, **kwargs)..
+00051220: 0a64 6566 2063 7265 6174 655f 6d61 6a6f  .def create_majo
+00051230: 7269 7479 5f76 6f74 6528 726f 6973 2c20  rity_vote(rois, 
+00051240: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
+00051250: 2222 4372 6561 7465 206d 616a 6f72 6974  ""Create majorit
+00051260: 7920 766f 7465 2052 4f49 2066 726f 6d20  y vote ROI from 
+00051270: 6c69 7374 206f 6620 524f 4973 2e22 2222  list of ROIs."""
+00051280: 0a0a 2020 2020 6d61 736b 203d 2072 6f69  ..    mask = roi
+00051290: 735b 305d 2e67 6574 5f6d 6173 6b28 7374  s[0].get_mask(st
+000512a0: 616e 6461 7264 6973 653d 5472 7565 292e  andardise=True).
+000512b0: 6173 7479 7065 2869 6e74 290a 2020 2020  astype(int).    
+000512c0: 666f 7220 726f 6920 696e 2072 6f69 735b  for roi in rois[
+000512d0: 313a 5d3a 0a20 2020 2020 2020 206d 6173  1:]:.        mas
+000512e0: 6b20 2b3d 2072 6f69 2e67 6574 5f6d 6173  k += roi.get_mas
+000512f0: 6b28 7374 616e 6461 7264 6973 653d 5472  k(standardise=Tr
+00051300: 7565 292e 6173 7479 7065 2869 6e74 290a  ue).astype(int).
+00051310: 2020 2020 6d61 736b 203d 206d 6173 6b20      mask = mask 
+00051320: 3e3d 206c 656e 2872 6f69 7329 202f 2032  >= len(rois) / 2
+00051330: 0a20 2020 2072 6574 7572 6e20 524f 4928  .    return ROI(
+00051340: 6d61 736b 2c20 2a2a 6b77 6172 6773 290a  mask, **kwargs).
+00051350: 0a0a 6465 6620 6372 6561 7465 5f72 6f69  ..def create_roi
+00051360: 5f73 756d 2872 6f69 732c 202a 2a6b 7761  _sum(rois, **kwa
+00051370: 7267 7329 3a0a 2020 2020 2222 2243 7265  rgs):.    """Cre
+00051380: 6174 6520 524f 4920 6672 6f6d 2073 756d  ate ROI from sum
+00051390: 206f 6620 6c69 7374 206f 6620 524f 4973   of list of ROIs
+000513a0: 2e22 2222 0a0a 2020 2020 6d61 736b 203d  ."""..    mask =
+000513b0: 2072 6f69 735b 305d 2e67 6574 5f6d 6173   rois[0].get_mas
+000513c0: 6b28 7374 616e 6461 7264 6973 653d 5472  k(standardise=Tr
+000513d0: 7565 292e 636f 7079 2829 0a20 2020 2066  ue).copy().    f
+000513e0: 6f72 2072 6f69 2069 6e20 726f 6973 5b31  or roi in rois[1
+000513f0: 3a5d 3a0a 2020 2020 2020 2020 6d61 736b  :]:.        mask
+00051400: 202b 3d20 726f 692e 6765 745f 6d61 736b   += roi.get_mask
+00051410: 2873 7461 6e64 6172 6469 7365 3d54 7275  (standardise=Tru
+00051420: 6529 0a20 2020 2072 6574 7572 6e20 524f  e).    return RO
+00051430: 4928 6d61 736b 2c20 2a2a 6b77 6172 6773  I(mask, **kwargs
+00051440: 290a 0a0a 6465 6620 6372 6561 7465 5f72  )...def create_r
+00051450: 6f69 5f6f 7665 726c 6170 2872 6f69 732c  oi_overlap(rois,
+00051460: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00051470: 2222 2243 7265 6174 6520 524f 4920 6672  """Create ROI fr
+00051480: 6f6d 206f 7665 726c 6170 206f 6620 6c69  om overlap of li
+00051490: 7374 206f 6620 524f 4973 2e22 2222 0a0a  st of ROIs."""..
+000514a0: 2020 2020 6d61 736b 203d 2072 6f69 735b      mask = rois[
+000514b0: 305d 2e67 6574 5f6d 6173 6b28 7374 616e  0].get_mask(stan
+000514c0: 6461 7264 6973 653d 5472 7565 292e 636f  dardise=True).co
+000514d0: 7079 2829 0a20 2020 2066 6f72 2072 6f69  py().    for roi
+000514e0: 2069 6e20 726f 6973 5b31 3a5d 3a0a 2020   in rois[1:]:.  
+000514f0: 2020 2020 2020 6d61 736b 202a 3d20 726f        mask *= ro
+00051500: 692e 6765 745f 6d61 736b 2873 7461 6e64  i.get_mask(stand
+00051510: 6172 6469 7365 3d54 7275 6529 0a20 2020  ardise=True).   
+00051520: 2072 6574 7572 6e20 524f 4928 6d61 736b   return ROI(mask
+00051530: 2c20 2a2a 6b77 6172 6773 290a 0a0a 6465  , **kwargs)...de
+00051540: 6620 6466 5f74 6f5f 6874 6d6c 2864 6629  f df_to_html(df)
+00051550: 3a0a 2020 2020 2222 2243 6f6e 7665 7274  :.    """Convert
+00051560: 2061 2070 616e 6461 7320 4461 7461 4672   a pandas DataFr
+00051570: 616d 6520 746f 2068 746d 6c2e 2222 220a  ame to html.""".
+00051580: 0a20 2020 2023 2043 6f6e 7665 7274 2064  .    # Convert d
+00051590: 6174 6166 7261 6d65 2074 6f20 4854 4d4c  ataframe to HTML
+000515a0: 0a20 2020 2068 746d 6c20 3d20 6466 2e66  .    html = df.f
+000515b0: 696c 6c6e 6128 27e2 8094 2729 2e74 6f5f  illna('...').to_
+000515c0: 6874 6d6c 2869 6e64 6578 3d46 616c 7365  html(index=False
+000515d0: 290a 2020 2020 6874 6d6c 203d 2068 746d  ).    html = htm
+000515e0: 6c2e 7265 706c 6163 6528 225e 3322 2c20  l.replace("^3", 
+000515f0: 223c 7375 703e 333c 2f73 7570 3e22 292e  "<sup>3</sup>").
+00051600: 7265 706c 6163 6528 225e 3222 2c20 223c  replace("^2", "<
+00051610: 7375 703e 323c 2f73 7570 3e22 290a 0a20  sup>2</sup>").. 
+00051620: 2020 2023 2041 6464 2068 6561 6465 7220     # Add header 
+00051630: 7769 7468 2073 7479 6c65 2064 6574 6169  with style detai
+00051640: 6c73 0a20 2020 2068 6561 6465 7220 3d20  ls.    header = 
+00051650: 2222 220a 2020 2020 2020 2020 3c68 6561  """.        <hea
+00051660: 643e 0a20 2020 2020 2020 2020 2020 203c  d>.            <
+00051670: 7374 796c 653e 0a20 2020 2020 2020 2020  style>.         
+00051680: 2020 2020 2020 2074 682c 2074 6420 7b0a         th, td {.
+00051690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000516a0: 2020 2020 7061 6464 696e 673a 2032 7078      padding: 2px
+000516b0: 2032 7078 3b0a 2020 2020 2020 2020 2020   2px;.          
+000516c0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+000516d0: 2020 2020 2020 2020 7468 207b 0a20 2020          th {.   
+000516e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000516f0: 2062 6163 6b67 726f 756e 642d 636f 6c6f   background-colo
+00051700: 723a 2074 7261 6e73 7061 7265 6e74 3b0a  r: transparent;.
+00051710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051720: 2020 2020 7465 7874 2d61 6c69 676e 3a20      text-align: 
+00051730: 6365 6e74 6572 3b0a 2020 2020 2020 2020  center;.        
+00051740: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00051750: 2020 2020 2020 3c2f 7374 796c 653e 0a20        </style>. 
+00051760: 2020 2020 2020 203c 2f68 6561 643e 0a20         </head>. 
+00051770: 2020 2022 2222 0a20 2020 2074 6162 6c65     """.    table
+00051780: 5f68 746d 6c20 3d20 280a 2020 2020 2020  _html = (.      
+00051790: 2020 2868 6561 6465 7220 2b20 6874 6d6c    (header + html
+000517a0: 290a 2020 2020 2020 2020 2e72 6570 6c61  ).        .repla
+000517b0: 6365 2822 2667 743b 222c 2022 3e22 290a  ce("&gt;", ">").
+000517c0: 2020 2020 2020 2020 2e72 6570 6c61 6365          .replace
+000517d0: 2822 266c 743b 222c 2022 3c22 290a 2020  ("&lt;", "<").  
+000517e0: 2020 2020 2020 2e72 6570 6c61 6365 2822        .replace("
+000517f0: 2661 6d70 3b22 2c20 2226 2229 0a20 2020  &amp;", "&").   
+00051800: 2029 0a20 2020 2072 6574 7572 6e20 7461   ).    return ta
+00051810: 626c 655f 6874 6d6c 0a0a 0a64 6566 2062  ble_html...def b
+00051820: 6573 745f 7465 7874 5f63 6f6c 6f72 2872  est_text_color(r
+00051830: 6564 2c20 6772 6565 6e2c 2062 6c75 6529  ed, green, blue)
+00051840: 3a0a 2020 2020 6966 2028 7265 6420 2a20  :.    if (red * 
+00051850: 302e 3239 3920 2b20 6772 6565 6e20 2a20  0.299 + green * 
+00051860: 302e 3538 3720 2b20 626c 7565 202a 2030  0.587 + blue * 0
+00051870: 2e31 3134 2920 3e20 3138 363a 0a20 2020  .114) > 186:.   
+00051880: 2020 2020 2072 6574 7572 6e20 2262 6c61       return "bla
+00051890: 636b 220a 2020 2020 7265 7475 726e 2022  ck".    return "
+000518a0: 7768 6974 6522 0a0a 0a64 6566 2067 6574  white"...def get
+000518b0: 5f63 6f6c 6f72 6564 5f72 6f69 5f73 7472  _colored_roi_str
+000518c0: 696e 6728 726f 692c 2067 7265 793d 4661  ing(roi, grey=Fa
+000518d0: 6c73 652c 2063 6f6c 6f72 3d4e 6f6e 6529  lse, color=None)
+000518e0: 3a0a 2020 2020 2222 2247 6574 2052 4f49  :.    """Get ROI
+000518f0: 206e 616d 6520 696e 2048 544d 4c20 7769   name in HTML wi
+00051900: 7468 2062 6163 6b67 726f 756e 6420 636f  th background co
+00051910: 6c6f 7220 6672 6f6d 2072 6f69 2e63 6f6c  lor from roi.col
+00051920: 6f72 2e20 4966 2067 7265 793d 5472 7565  or. If grey=True
+00051930: 2c0a 2020 2020 7468 6520 6261 636b 6772  ,.    the backgr
+00051940: 6f75 6e64 2063 6f6c 6f72 2077 696c 6c20  ound color will 
+00051950: 6265 2067 7265 792e 2222 220a 0a20 2020  be grey."""..   
+00051960: 2069 6620 636f 6c6f 7220 6973 204e 6f6e   if color is Non
+00051970: 653a 0a20 2020 2020 2020 2063 6f6c 6f72  e:.        color
+00051980: 203d 2072 6f69 2e63 6f6c 6f72 0a20 2020   = roi.color.   
+00051990: 2069 6620 6772 6579 3a0a 2020 2020 2020   if grey:.      
+000519a0: 2020 7265 642c 2067 7265 656e 2c20 626c    red, green, bl
+000519b0: 7565 203d 2032 3535 2c20 3235 352c 2032  ue = 255, 255, 2
+000519c0: 3535 0a20 2020 2020 2020 2072 6564 2c20  55.        red, 
+000519d0: 6772 6565 6e2c 2062 6c75 6520 3d20 3132  green, blue = 12
+000519e0: 382c 2031 3238 2c20 3132 380a 2020 2020  8, 128, 128.    
+000519f0: 2020 2020 7465 7874 5f63 6f6c 203d 2032      text_col = 2
+00051a00: 3030 2c20 3230 302c 2032 3030 0a20 2020  00, 200, 200.   
+00051a10: 2020 2020 2023 2041 766f 6964 2073 6574       # Avoid set
+00051a20: 7469 6e67 2063 6f6c 6f75 7220 666f 7220  ting colour for 
+00051a30: 6772 6579 6564 206f 7574 2052 4f49 732e  greyed out ROIs.
+00051a40: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
+00051a50: 6769 7665 7320 676f 6f64 2072 6561 6461  gives good reada
+00051a60: 6269 6c69 7479 2066 6f72 2062 6f74 6820  bility for both 
+00051a70: 6461 726b 2061 6e64 206c 6967 6874 2074  dark and light t
+00051a80: 6865 6d65 732e 0a20 2020 2020 2020 2072  hemes..        r
+00051a90: 6574 7572 6e20 2827 3c70 3e26 6e62 7370  eturn ('<p>&nbsp
+00051aa0: 3b7b 7d26 6e62 7370 3b3c 2f70 3e27 292e  ;{}&nbsp;</p>').
+00051ab0: 666f 726d 6174 2872 6f69 2e6e 616d 6529  format(roi.name)
+00051ac0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00051ad0: 2020 2072 6564 2c20 6772 6565 6e2c 2062     red, green, b
+00051ae0: 6c75 6520 3d20 5b63 202a 2032 3535 2066  lue = [c * 255 f
+00051af0: 6f72 2063 2069 6e20 636f 6c6f 725b 3a33  or c in color[:3
+00051b00: 5d5d 0a20 2020 2020 2020 2074 6578 745f  ]].        text_
+00051b10: 636f 6c20 3d20 6265 7374 5f74 6578 745f  col = best_text_
+00051b20: 636f 6c6f 7228 7265 642c 2067 7265 656e  color(red, green
+00051b30: 2c20 626c 7565 290a 2020 2020 7265 7475  , blue).    retu
+00051b40: 726e 2028 0a20 2020 2020 2020 2027 3c70  rn (.        '<p
+00051b50: 2073 7479 6c65 3d22 6261 636b 6772 6f75   style="backgrou
+00051b60: 6e64 2d63 6f6c 6f72 3a20 7267 6228 7b7d  nd-color: rgb({}
+00051b70: 2c20 7b7d 2c20 7b7d 293b 2027 0a20 2020  , {}, {}); '.   
+00051b80: 2020 2020 2027 636f 6c6f 723a 207b 7d3b       'color: {};
+00051b90: 223e 266e 6273 703b 7b7d 266e 6273 703b  ">&nbsp;{}&nbsp;
+00051ba0: 3c2f 703e 270a 2020 2020 292e 666f 726d  </p>'.    ).form
+00051bb0: 6174 2872 6564 2c20 6772 6565 6e2c 2062  at(red, green, b
+00051bc0: 6c75 652c 2074 6578 745f 636f 6c2c 2072  lue, text_col, r
+00051bd0: 6f69 2e6e 616d 6529 0a0a 6465 6620 636f  oi.name)..def co
+00051be0: 6d70 6172 655f 726f 695f 7061 6972 7328  mpare_roi_pairs(
+00051bf0: 0a20 2020 2070 6169 7273 2c20 0a20 2020  .    pairs, .   
+00051c00: 2068 746d 6c3d 4661 6c73 652c 0a20 2020   html=False,.   
+00051c10: 206e 616d 655f 6173 5f69 6e64 6578 3d54   name_as_index=T
+00051c20: 7275 652c 0a20 2020 2067 7265 7965 645f  rue,.    greyed_
+00051c30: 6f75 743d 4e6f 6e65 2c0a 2020 2020 636f  out=None,.    co
+00051c40: 6c6f 7265 643d 4661 6c73 652c 0a20 2020  lored=False,.   
+00051c50: 2072 6f69 5f6b 7761 7267 733d 7b7d 2c0a   roi_kwargs={},.
+00051c60: 2020 2020 2a2a 6b77 6172 6773 0a29 3a0a      **kwargs.):.
+00051c70: 2020 2020 6966 2068 746d 6c3a 0a20 2020      if html:.   
+00051c80: 2020 2020 206e 616d 655f 6173 5f69 6e64       name_as_ind
+00051c90: 6578 203d 2046 616c 7365 0a20 2020 2069  ex = False.    i
+00051ca0: 6620 6772 6579 6564 5f6f 7574 2069 7320  f greyed_out is 
+00051cb0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6772  None:.        gr
+00051cc0: 6579 6564 5f6f 7574 203d 205b 5d0a 2020  eyed_out = [].  
+00051cd0: 2020 6466 7320 3d20 5b5d 0a20 2020 2066    dfs = [].    f
+00051ce0: 6f72 2072 6f69 312c 2072 6f69 3220 696e  or roi1, roi2 in
+00051cf0: 2070 6169 7273 3a0a 0a20 2020 2020 2020   pairs:..       
+00051d00: 2023 2047 6574 2044 6174 6146 7261 6d65   # Get DataFrame
+00051d10: 2066 6f72 2074 6869 7320 7061 6972 0a20   for this pair. 
+00051d20: 2020 2020 2020 2064 665f 726f 7720 3d20         df_row = 
+00051d30: 726f 6931 2e67 6574 5f63 6f6d 7061 7269  roi1.get_compari
+00051d40: 736f 6e28 726f 6932 2c20 6e61 6d65 5f61  son(roi2, name_a
+00051d50: 735f 696e 6465 783d 6e61 6d65 5f61 735f  s_index=name_as_
+00051d60: 696e 6465 782c 0a20 2020 2020 2020 2020  index,.         
+00051d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051d80: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+00051d90: 6172 6773 290a 0a20 2020 2020 2020 2023  args)..        #
+00051da0: 2052 6570 6c61 6365 2076 616c 7565 7320   Replace values 
+00051db0: 7769 7468 2022 2d2d 2220 6966 2065 6974  with "--" if eit
+00051dc0: 6865 7220 524f 4920 6973 2067 7265 7965  her ROI is greye
+00051dd0: 6420 6f75 740a 2020 2020 2020 2020 6772  d out.        gr
+00051de0: 6579 203d 2072 6f69 3120 696e 2067 7265  ey = roi1 in gre
+00051df0: 7965 645f 6f75 7420 6f72 2072 6f69 3220  yed_out or roi2 
+00051e00: 696e 2067 7265 7965 645f 6f75 740a 2020  in greyed_out.  
+00051e10: 2020 2020 2020 6966 2067 7265 793a 0a20        if grey:. 
+00051e20: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+00051e30: 6f6c 2069 6e20 6466 5f72 6f77 2e63 6f6c  ol in df_row.col
+00051e40: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
+00051e50: 2020 2020 2020 6966 2063 6f6c 203d 3d20        if col == 
+00051e60: 2252 4f49 223a 200a 2020 2020 2020 2020  "ROI": .        
+00051e70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00051e80: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00051e90: 2020 2020 2064 665f 726f 775b 636f 6c5d       df_row[col]
+00051ea0: 203d 2022 2d2d 220a 0a20 2020 2020 2020   = "--"..       
+00051eb0: 2023 2041 646a 7573 7420 636f 6d70 6172   # Adjust compar
+00051ec0: 6973 6f6e 206e 616d 650a 2020 2020 2020  ison name.      
+00051ed0: 2020 636f 6d70 5f6e 616d 6520 3d20 726f    comp_name = ro
+00051ee0: 6931 2e67 6574 5f63 6f6d 7061 7269 736f  i1.get_compariso
+00051ef0: 6e5f 6e61 6d65 2872 6f69 322c 2063 6f6c  n_name(roi2, col
+00051f00: 6f72 6564 3d63 6f6c 6f72 6564 2c20 6772  ored=colored, gr
+00051f10: 6579 3d67 7265 792c 0a20 2020 2020 2020  ey=grey,.       
+00051f20: 2020 2020 2020 2020 2072 6f69 5f6b 7761           roi_kwa
+00051f30: 7267 733d 726f 695f 6b77 6172 6773 290a  rgs=roi_kwargs).
+00051f40: 2020 2020 2020 2020 6966 206e 616d 655f          if name_
+00051f50: 6173 5f69 6e64 6578 3a0a 2020 2020 2020  as_index:.      
+00051f60: 2020 2020 2020 6466 5f72 6f77 2e72 656e        df_row.ren
+00051f70: 616d 6528 7b64 665f 726f 772e 696e 6465  ame({df_row.inde
+00051f80: 785b 305d 3a20 636f 6d70 5f6e 616d 657d  x[0]: comp_name}
+00051f90: 2c20 696e 706c 6163 653d 5472 7565 290a  , inplace=True).
+00051fa0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00051fb0: 2020 2020 2020 2020 2020 6466 5f72 6f77            df_row
+00051fc0: 2e69 6c6f 635b 302c 2030 5d20 3d20 636f  .iloc[0, 0] = co
+00051fd0: 6d70 5f6e 616d 650a 0a20 2020 2020 2020  mp_name..       
+00051fe0: 2064 6673 2e61 7070 656e 6428 6466 5f72   dfs.append(df_r
+00051ff0: 6f77 290a 0a20 2020 2069 676e 6f72 655f  ow)..    ignore_
+00052000: 696e 6465 7820 3d20 4661 6c73 6520 6966  index = False if
+00052010: 206e 616d 655f 6173 5f69 6e64 6578 2065   name_as_index e
+00052020: 6c73 6520 5472 7565 0a20 2020 2064 6620  lse True.    df 
+00052030: 3d20 7064 2e63 6f6e 6361 7428 6466 732c  = pd.concat(dfs,
+00052040: 2069 676e 6f72 655f 696e 6465 783d 6967   ignore_index=ig
+00052050: 6e6f 7265 5f69 6e64 6578 2920 6966 2064  nore_index) if d
+00052060: 6673 2065 6c73 6520 4e6f 6e65 0a20 2020  fs else None.   
+00052070: 2069 6620 6874 6d6c 3a0a 2020 2020 2020   if html:.      
+00052080: 2020 7265 7475 726e 2064 665f 746f 5f68    return df_to_h
+00052090: 746d 6c28 6466 290a 2020 2020 7265 7475  tml(df).    retu
+000520a0: 726e 2064 660a 0a64 6566 2067 6574 5f63  rn df..def get_c
+000520b0: 6f6e 666f 726d 6974 795f 696e 6465 7828  onformity_index(
+000520c0: 0a20 2020 2072 6f69 732c 0a20 2020 2063  .    rois,.    c
+000520d0: 695f 7479 7065 3d22 6765 6e22 2c0a 2020  i_type="gen",.  
+000520e0: 2020 7369 6e67 6c65 5f73 6c69 6365 3d46    single_slice=F
+000520f0: 616c 7365 2c0a 2020 2020 7669 6577 3d22  alse,.    view="
+00052100: 782d 7922 2c20 0a20 2020 2073 6c3d 4e6f  x-y", .    sl=No
+00052110: 6e65 2c20 0a20 2020 2069 6478 3d4e 6f6e  ne, .    idx=Non
+00052120: 652c 200a 2020 2020 706f 733d 4e6f 6e65  e, .    pos=None
+00052130: 2c20 0a20 2020 206d 6574 686f 643d 4e6f  , .    method=No
+00052140: 6e65 2c0a 2020 2020 666c 6174 7465 6e3d  ne,.    flatten=
+00052150: 4661 6c73 652c 0a20 2020 2029 3a0a 2020  False,.    ):.  
+00052160: 2020 2222 220a 2020 2020 4765 7420 636f    """.    Get co
+00052170: 6e66 6f72 6d69 7479 2069 6e64 6578 2066  nformity index f
+00052180: 6f72 2074 776f 206f 7220 6d6f 7265 2052  or two or more R
+00052190: 4f49 732e 0a0a 2020 2020 5468 6520 636f  OIs...    The co
+000521a0: 6e66 6f72 6d69 7479 2069 6e64 6578 206d  nformity index m
+000521b0: 6179 2062 6520 6361 6c63 756c 6174 6564  ay be calculated
+000521c0: 2067 6c6f 6261 6c6c 7920 6f72 2066 6f72   globally or for
+000521d0: 2061 2073 696e 676c 6520 736c 6963 652e   a single slice.
+000521e0: 0a0a 2020 2020 5468 6973 2066 756e 6374  ..    This funct
+000521f0: 696f 6e20 7265 7475 726e 7320 6569 7468  ion returns eith
+00052200: 6572 2074 6865 2076 616c 7565 206f 6620  er the value of 
+00052210: 6f6e 6520 6f66 2074 6865 2074 6872 6565  one of the three
+00052220: 2074 7970 6573 0a20 2020 206f 6620 636f   types.    of co
+00052230: 6e66 6f72 6d69 7479 2069 6e64 6578 2028  nformity index (
+00052240: 2267 656e 2220 2866 6f72 2067 656e 6572  "gen" (for gener
+00052250: 616c 6973 6564 292c 2022 7061 6972 7322  alised), "pairs"
+00052260: 2c20 2263 6f6d 6d6f 6e22 290a 2020 2020  , "common").    
+00052270: 7265 6665 7272 6564 2074 6f20 696e 3a0a  referred to in:.
+00052280: 2020 2020 6874 7470 733a 2f2f 646f 692e      https://doi.
+00052290: 6f72 672f 3130 2e31 3038 382f 3030 3331  org/10.1088/0031
+000522a0: 2d39 3135 352f 3534 2f39 2f30 3138 0a20  -9155/54/9/018. 
+000522b0: 2020 206f 7220 6120 736b 7274 2e63 6f72     or a skrt.cor
+000522c0: 652e 4461 7461 206f 626a 6563 7420 7769  e.Data object wi
+000522d0: 7468 2074 6865 2076 616c 7565 7320 6f66  th the values of
+000522e0: 2061 6c6c 2074 6872 6565 2e0a 2020 2020   all three..    
+000522f0: 466f 7220 7468 6520 6361 7365 206f 6620  For the case of 
+00052300: 7477 6f20 524f 4973 2c20 7468 6520 7468  two ROIs, the th
+00052310: 7265 6520 6d65 7472 6963 7320 6172 6520  ree metrics are 
+00052320: 616c 6c20 6571 7569 7661 6c65 6e74 0a20  all equivalent. 
+00052330: 2020 2074 6f20 7468 6520 4a61 6363 6172     to the Jaccar
+00052340: 6420 636f 6e66 6f72 6d69 7479 2069 6e64  d conformity ind
+00052350: 6578 2e0a 0a20 2020 202a 2a50 6172 616d  ex...    **Param
+00052360: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+00052370: 200a 2020 2020 726f 6973 203a 206c 6973   .    rois : lis
+00052380: 740a 2020 2020 2020 2020 4c69 7374 206f  t.        List o
+00052390: 6620 7477 6f20 6f72 206d 6f72 6520 736b  f two or more sk
+000523a0: 7274 2e73 7472 7563 7475 7265 732e 524f  rt.structures.RO
+000523b0: 4920 6f62 6a65 6374 7320 666f 7220 7768  I objects for wh
+000523c0: 6963 6820 636f 6e66 6f72 6d69 7479 0a20  ich conformity. 
+000523d0: 2020 2020 2020 2069 6e64 6578 2069 7320         index is 
+000523e0: 746f 2062 6520 6361 6c63 756c 6174 6564  to be calculated
+000523f0: 2e0a 0a20 2020 2063 695f 7479 7065 3a20  ...    ci_type: 
+00052400: 7374 722c 2064 6566 6175 6c74 3d22 6765  str, default="ge
+00052410: 6e22 0a20 2020 2020 2020 2054 7970 6520  n".        Type 
+00052420: 6f66 2063 6f6e 666f 726d 6974 7920 696e  of conformity in
+00052430: 6465 7820 746f 2062 6520 7265 7475 726e  dex to be return
+00052440: 6564 2c20 6672 6f6d 2022 6765 6e22 2028  ed, from "gen" (
+00052450: 666f 7220 6765 6e65 7261 6c69 7365 6429  for generalised)
+00052460: 2c0a 2020 2020 2020 2020 2270 6169 7273  ,.        "pairs
+00052470: 222c 2022 636f 6d6d 6f6e 222e 2020 4966  ", "common".  If
+00052480: 2073 6574 2074 6f20 2261 6c6c 222c 2061   set to "all", a
+00052490: 2073 6b72 742e 636f 7265 2e44 6174 6120   skrt.core.Data 
+000524a0: 6f62 6a65 6374 2077 6974 680a 2020 2020  object with.    
+000524b0: 2020 2020 7661 6c75 6573 2066 6f72 2074      values for t
+000524c0: 6865 2074 6872 6565 2074 7970 6573 206f  he three types o
+000524d0: 6620 636f 6e66 6f72 6d69 7479 2069 6e64  f conformity ind
+000524e0: 6578 2069 7320 7265 7475 726e 6564 2e0a  ex is returned..
+000524f0: 0a20 2020 2073 696e 676c 655f 736c 6963  .    single_slic
+00052500: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
+00052510: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00052520: 4966 2046 616c 7365 2c20 7468 6520 676c  If False, the gl
+00052530: 6f62 616c 2033 4420 4469 6365 2073 636f  obal 3D Dice sco
+00052540: 7265 206f 6620 7468 6520 6675 6c6c 2052  re of the full R
+00052550: 4f49 7320 7769 6c6c 2062 6520 7265 7475  OIs will be retu
+00052560: 726e 6564 3b0a 2020 2020 2020 2020 6f74  rned;.        ot
+00052570: 6865 7277 6973 652c 2074 6865 2032 4420  herwise, the 2D 
+00052580: 4469 6365 2073 636f 7265 206f 6e20 6120  Dice score on a 
+00052590: 7369 6e67 6c65 2073 6c69 6365 2077 696c  single slice wil
+000525a0: 6c20 6265 2072 6574 7572 6e65 642e 0a0a  l be returned...
+000525b0: 2020 2020 7669 6577 203a 2073 7472 2c20      view : str, 
+000525c0: 6465 6661 756c 743d 2278 2d79 220a 2020  default="x-y".  
+000525d0: 2020 2020 2020 4f72 6965 6e74 6174 696f        Orientatio
+000525e0: 6e20 6f66 2073 6c69 6365 206f 6e20 7768  n of slice on wh
+000525f0: 6963 6820 746f 2067 6574 2044 6963 6520  ich to get Dice 
+00052600: 7363 6f72 652e 204f 6e6c 7920 7573 6564  score. Only used
+00052610: 2069 6620 0a20 2020 2020 2020 2073 696e   if .        sin
+00052620: 676c 655f 736c 6963 653d 5472 7565 2e20  gle_slice=True. 
+00052630: 4966 2075 7369 6e67 2c20 3c61 783e 206d  If using, <ax> m
+00052640: 7573 7420 6265 2061 6e20 6178 6973 2074  ust be an axis t
+00052650: 6861 7420 6c69 6573 2061 6c6f 6e67 0a20  hat lies along. 
+00052660: 2020 2020 2020 2074 6865 2073 6c69 6365         the slice
+00052670: 2069 6e20 7468 6973 206f 7269 656e 7461   in this orienta
+00052680: 7469 6f6e 2e0a 0a20 2020 2073 6c20 3a20  tion...    sl : 
+00052690: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+000526a0: 650a 2020 2020 2020 2020 536c 6963 6520  e.        Slice 
+000526b0: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
+000526c0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+000526d0: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+000526e0: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+000526f0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+00052700: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+00052710: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
+00052720: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
+00052730: 7365 642e 0a0a 2020 2020 6964 7820 3a20  sed...    idx : 
+00052740: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+00052750: 650a 2020 2020 2020 2020 4172 7261 7920  e.        Array 
+00052760: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
+00052770: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+00052780: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+00052790: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+000527a0: 0a20 2020 2020 2020 203c 7369 6e67 6c65  .        <single
+000527b0: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
+000527c0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+000527d0: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
+000527e0: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
+000527f0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
+00052800: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00052810: 2020 2020 536c 6963 6520 706f 7369 7469      Slice positi
+00052820: 6f6e 2069 6e20 6d6d 2e20 4966 206e 6f6e  on in mm. If non
+00052830: 6520 6f66 203c 736c 3e2c 203c 6964 783e  e of <sl>, <idx>
+00052840: 206f 7220 3c70 6f73 3e20 6172 6520 7375   or <pos> are su
+00052850: 7070 6c69 6564 2062 7574 0a20 2020 2020  pplied but.     
+00052860: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
+00052870: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+00052880: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00052890: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
+000528a0: 2075 7365 642e 0a0a 2020 2020 6d65 7468   used...    meth
+000528b0: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
+000528c0: 743d 4e6f 6e65 0a20 2020 2020 2020 204d  t=None.        M
+000528d0: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+000528e0: 2044 6963 6520 7363 6f72 6520 6361 6c63   Dice score calc
+000528f0: 756c 6174 696f 6e2e 2043 616e 2062 653a  ulation. Can be:
+00052900: 200a 2020 2020 2020 2020 2d20 2263 6f6e   .        - "con
+00052910: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
+00052920: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
+00052930: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
+00052940: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+00052950: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
+00052960: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
+00052970: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
+00052980: 736b 732e 0a20 2020 2020 2020 202d 204e  sks..        - N
+00052990: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
+000529a0: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
+000529b0: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+000529c0: 686f 642e 0a20 2020 2020 2020 2046 6f72  hod..        For
+000529d0: 206d 6f72 6520 7468 616e 2074 776f 2052   more than two R
+000529e0: 4f49 7320 616e 6420 3c63 695f 7479 7065  OIs and <ci_type
+000529f0: 3e20 2263 6f6d 6d6f 6e22 2c20 6f6e 6c79  > "common", only
+00052a00: 2074 6865 2022 6d61 736b 220a 2020 2020   the "mask".    
+00052a10: 2020 2020 6d65 7468 6f64 2069 7320 696d      method is im
+00052a20: 706c 656d 656e 7465 642e 0a0a 2020 2020  plemented...    
+00052a30: 666c 6174 7465 6e20 3a20 626f 6f6c 2c20  flatten : bool, 
+00052a40: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+00052a50: 2020 2020 2020 4966 2054 7275 652c 2061        If True, a
+00052a60: 6c6c 2073 6c69 6365 7320 7769 6c6c 2062  ll slices will b
+00052a70: 6520 666c 6174 7465 6e65 6420 696e 2074  e flattened in t
+00052a80: 6865 2067 6976 656e 206f 7269 656e 7461  he given orienta
+00052a90: 7469 6f6e 2061 6e64 0a20 2020 2020 2020  tion and.       
+00052aa0: 2074 6865 2044 6963 6520 7363 6f72 6520   the Dice score 
+00052ab0: 6f66 2074 6865 2066 6c61 7474 656e 6564  of the flattened
+00052ac0: 2073 6c69 6365 7320 7769 6c6c 2062 6520   slices will be 
+00052ad0: 7265 7475 726e 6564 2e20 4f6e 6c79 200a  returned. Only .
+00052ae0: 2020 2020 2020 2020 6176 6169 6c61 626c          availabl
+00052af0: 6520 6966 206d 6574 686f 643d 226d 6173  e if method="mas
+00052b00: 6b22 2e0a 2020 2020 2222 220a 0a20 2020  k"..    """..   
+00052b10: 2023 2052 6571 7569 7265 2076 616c 6964   # Require valid
+00052b20: 2069 6e70 7574 732e 0a20 2020 2069 6620   inputs..    if 
+00052b30: 6c65 6e28 726f 6973 2920 3c20 3220 6f72  len(rois) < 2 or
+00052b40: 2063 695f 7479 7065 206e 6f74 2069 6e20   ci_type not in 
+00052b50: 5b22 636f 6d6d 6f6e 222c 2022 6765 6e22  ["common", "gen"
+00052b60: 2c20 2270 6169 7273 222c 2022 616c 6c22  , "pairs", "all"
+00052b70: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
+00052b80: 6e0a 0a20 2020 2023 2049 6e69 7469 616c  n..    # Initial
+00052b90: 6973 6520 4461 7461 206f 626a 6563 7420  ise Data object 
+00052ba0: 666f 7220 636f 6e66 6f72 6d69 7479 2069  for conformity i
+00052bb0: 6e64 6963 6573 2e0a 2020 2020 6369 203d  ndices..    ci =
+00052bc0: 2073 6b72 742e 636f 7265 2e44 6174 6128   skrt.core.Data(
+00052bd0: 7b22 636f 6d6d 6f6e 223a 2030 2c20 2267  {"common": 0, "g
+00052be0: 656e 223a 302c 2022 7061 6972 7322 3a30  en":0, "pairs":0
+00052bf0: 7d29 0a0a 2020 2020 2320 4465 616c 2077  })..    # Deal w
+00052c00: 6974 6820 6361 7365 7320 2267 656e 2220  ith cases "gen" 
+00052c10: 616e 6420 2270 6169 7273 222e 0a20 2020  and "pairs"..   
+00052c20: 2023 0a20 2020 2023 2046 6f72 2022 6765   #.    # For "ge
+00052c30: 6e22 2c20 7468 6520 636f 6e66 6f72 6d69  n", the conformi
+00052c40: 7479 2069 6e64 6578 2069 7320 6361 6c63  ty index is calc
+00052c50: 756c 6174 6564 2061 7320 7468 6520 7261  ulated as the ra
+00052c60: 7469 6f20 6f66 0a20 2020 2023 2028 3129  tio of.    # (1)
+00052c70: 2074 6865 2073 756d 206f 6620 7468 6520   the sum of the 
+00052c80: 696e 7465 7273 6563 7469 6f6e 7320 666f  intersections fo
+00052c90: 7220 616c 6c20 7061 6972 7320 746f 2028  r all pairs to (
+00052ca0: 3229 2074 6865 2073 756d 206f 660a 2020  2) the sum of.  
+00052cb0: 2020 2320 7468 6520 756e 696f 6e73 2066    # the unions f
+00052cc0: 6f72 2061 6c6c 2070 6169 7273 2e0a 2020  or all pairs..  
+00052cd0: 2020 230a 2020 2020 2320 466f 7220 2270    #.    # For "p
+00052ce0: 6169 7273 2c20 7468 6520 636f 6e66 6f72  airs, the confor
+00052cf0: 6d69 7479 2069 6e64 6578 2069 7320 6361  mity index is ca
+00052d00: 6c63 7561 6c74 6564 2061 7320 7468 6520  lcualted as the 
+00052d10: 6d65 616e 206f 6620 7468 650a 2020 2020  mean of the.    
+00052d20: 2320 4a61 6363 6172 6420 636f 6e66 6f72  # Jaccard confor
+00052d30: 6d69 7479 2069 6e64 6963 6573 2066 6f72  mity indices for
+00052d40: 2061 6c6c 2070 6169 7273 2e0a 0a20 2020   all pairs...   
+00052d50: 206e 756d 6572 6174 6f72 203d 2030 0a20   numerator = 0. 
+00052d60: 2020 2064 656e 6f6d 696e 6174 6f72 203d     denominator =
+00052d70: 2030 0a20 2020 206e 5f70 6169 7220 3d20   0.    n_pair = 
+00052d80: 300a 2020 2020 666f 7220 6964 7831 2069  0.    for idx1 i
+00052d90: 6e20 7261 6e67 6528 6c65 6e28 726f 6973  n range(len(rois
+00052da0: 2920 2d20 3129 3a0a 2020 2020 2020 2020  ) - 1):.        
+00052db0: 666f 7220 6964 7832 2069 6e20 7261 6e67  for idx2 in rang
+00052dc0: 6528 6964 7831 202b 2031 2c20 6c65 6e28  e(idx1 + 1, len(
+00052dd0: 726f 6973 2929 3a0a 2020 2020 2020 2020  rois)):.        
+00052de0: 2020 2020 726f 6931 203d 2072 6f69 735b      roi1 = rois[
+00052df0: 6964 7831 5d0a 2020 2020 2020 2020 2020  idx1].          
+00052e00: 2020 726f 6932 203d 2072 6f69 735b 6964    roi2 = rois[id
+00052e10: 7832 5d0a 2020 2020 2020 2020 2020 2020  x2].            
+00052e20: 696e 7465 7273 6563 7469 6f6e 2c20 756e  intersection, un
+00052e30: 696f 6e2c 206d 6561 6e5f 7369 7a65 203d  ion, mean_size =
+00052e40: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00052e50: 2020 2020 2020 2072 6f69 312e 6765 745f         roi1.get_
+00052e60: 696e 7465 7273 6563 7469 6f6e 5f75 6e69  intersection_uni
+00052e70: 6f6e 5f73 697a 6528 726f 6932 2c20 7369  on_size(roi2, si
+00052e80: 6e67 6c65 5f73 6c69 6365 2c0a 2020 2020  ngle_slice,.    
+00052e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052ea0: 2020 2020 7669 6577 2c20 736c 2c20 6964      view, sl, id
+00052eb0: 782c 2070 6f73 2c20 6d65 7468 6f64 2c20  x, pos, method, 
+00052ec0: 666c 6174 7465 6e29 290a 2020 2020 2020  flatten)).      
+00052ed0: 2020 2020 2020 6e75 6d65 7261 746f 7220        numerator 
+00052ee0: 2b3d 2069 6e74 6572 7365 6374 696f 6e0a  += intersection.
+00052ef0: 2020 2020 2020 2020 2020 2020 6465 6e6f              deno
+00052f00: 6d69 6e61 746f 7220 2b3d 2075 6e69 6f6e  minator += union
+00052f10: 0a20 2020 2020 2020 2020 2020 2063 692e  .            ci.
+00052f20: 7061 6972 7320 2b3d 2069 6e74 6572 7365  pairs += interse
+00052f30: 6374 696f 6e20 2f20 756e 696f 6e0a 2020  ction / union.  
+00052f40: 2020 2020 2020 2020 2020 6e5f 7061 6972            n_pair
+00052f50: 202b 3d20 310a 0a20 2020 2063 692e 6765   += 1..    ci.ge
+00052f60: 6e20 3d20 6e75 6d65 7261 746f 7220 2f20  n = numerator / 
+00052f70: 6465 6e6f 6d69 6e61 746f 720a 2020 2020  denominator.    
+00052f80: 6369 2e70 6169 7273 202f 3d20 6e5f 7061  ci.pairs /= n_pa
+00052f90: 6972 0a0a 2020 2020 2320 4465 616c 2077  ir..    # Deal w
+00052fa0: 6974 6820 6361 7365 2022 636f 6d6d 6f6e  ith case "common
+00052fb0: 222e 0a20 2020 2023 0a20 2020 2023 2054  "..    #.    # T
+00052fc0: 6865 2063 6f6e 666f 726d 6974 7920 696e  he conformity in
+00052fd0: 6465 7820 6973 2063 616c 6375 6c61 7465  dex is calculate
+00052fe0: 6420 6173 2074 6865 2072 6174 696f 206f  d as the ratio o
+00052ff0: 660a 2020 2020 2320 2831 2920 7468 6520  f.    # (1) the 
+00053000: 636f 6d6d 6f6e 2069 6e74 6572 7365 6374  common intersect
+00053010: 696f 6e20 6f66 2061 6c6c 2052 4f49 7320  ion of all ROIs 
+00053020: 746f 2028 3229 2074 6865 2063 6f6d 6269  to (2) the combi
+00053030: 6e65 6420 756e 696f 6e0a 2020 2020 2320  ned union.    # 
+00053040: 6f66 2061 6c6c 2052 4f49 732e 0a20 2020  of all ROIs..   
+00053050: 2069 6620 3220 3d3d 206c 656e 2872 6f69   if 2 == len(roi
+00053060: 7329 3a0a 2020 2020 2020 2020 696e 7465  s):.        inte
+00053070: 7273 6563 7469 6f6e 2c20 756e 696f 6e2c  rsection, union,
+00053080: 206d 6561 6e5f 7369 7a65 203d 2028 0a20   mean_size = (. 
+00053090: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000530a0: 6f69 735b 305d 2e67 6574 5f69 6e74 6572  ois[0].get_inter
+000530b0: 7365 6374 696f 6e5f 756e 696f 6e5f 7369  section_union_si
+000530c0: 7a65 2872 6f69 735b 315d 2c20 7369 6e67  ze(rois[1], sing
+000530d0: 6c65 5f73 6c69 6365 2c0a 2020 2020 2020  le_slice,.      
+000530e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000530f0: 2020 7669 6577 2c20 736c 2c20 6964 782c    view, sl, idx,
+00053100: 2070 6f73 2c20 6d65 7468 6f64 2c20 666c   pos, method, fl
+00053110: 6174 7465 6e29 290a 2020 2020 2020 2020  atten)).        
+00053120: 6369 2e63 6f6d 6d6f 6e20 3d20 696e 7465  ci.common = inte
+00053130: 7273 6563 7469 6f6e 202f 2075 6e69 6f6e  rsection / union
+00053140: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00053150: 2020 2069 6620 6e6f 7420 7369 6e67 6c65     if not single
+00053160: 5f73 6c69 6365 3a0a 2020 2020 2020 2020  _slice:.        
+00053170: 2020 2020 6d61 736b 5f69 6e74 6572 7365      mask_interse
+00053180: 6374 696f 6e20 3d20 726f 6973 5b30 5d2e  ction = rois[0].
+00053190: 636c 6f6e 6528 292e 6765 745f 6d61 736b  clone().get_mask
+000531a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000531b0: 2020 2020 2020 7669 6577 2c20 666c 6174        view, flat
+000531c0: 7465 6e2c 2073 7461 6e64 6172 6469 7365  ten, standardise
+000531d0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+000531e0: 2020 206d 6173 6b5f 756e 696f 6e20 3d20     mask_union = 
+000531f0: 726f 6973 5b30 5d2e 636c 6f6e 6528 292e  rois[0].clone().
+00053200: 6765 745f 6d61 736b 280a 2020 2020 2020  get_mask(.      
+00053210: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+00053220: 6577 2c20 666c 6174 7465 6e2c 2073 7461  ew, flatten, sta
+00053230: 6e64 6172 6469 7365 3d54 7275 6529 0a20  ndardise=True). 
+00053240: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00053250: 2020 2020 2020 2020 206d 6173 6b5f 696e           mask_in
+00053260: 7465 7273 6563 7469 6f6e 203d 2072 6f69  tersection = roi
+00053270: 735b 305d 2e63 6c6f 6e65 2829 2e67 6574  s[0].clone().get
+00053280: 5f73 6c69 6365 280a 2020 2020 2020 2020  _slice(.        
+00053290: 2020 2020 2020 2020 2020 2020 7669 6577              view
+000532a0: 2c20 736c 2c20 6964 782c 2070 6f73 290a  , sl, idx, pos).
+000532b0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+000532c0: 5f75 6e69 6f6e 203d 2072 6f69 735b 305d  _union = rois[0]
+000532d0: 2e63 6c6f 6e65 2829 2e67 6574 5f73 6c69  .clone().get_sli
+000532e0: 6365 2876 6965 772c 2073 6c2c 2069 6478  ce(view, sl, idx
+000532f0: 2c20 706f 7329 0a0a 2020 2020 2020 2020  , pos)..        
+00053300: 666f 7220 726f 6920 696e 2072 6f69 735b  for roi in rois[
+00053310: 313a 5d3a 0a20 2020 2020 2020 2020 2020  1:]:.           
+00053320: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
+00053330: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
+00053340: 2020 2020 2020 6d61 736b 203d 2072 6f69        mask = roi
+00053350: 2e67 6574 5f6d 6173 6b28 7669 6577 2c20  .get_mask(view, 
+00053360: 666c 6174 7465 6e2c 2073 7461 6e64 6172  flatten, standar
+00053370: 6469 7365 3d54 7275 6529 0a20 2020 2020  dise=True).     
+00053380: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00053390: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+000533a0: 6b20 3d20 726f 692e 6765 745f 736c 6963  k = roi.get_slic
+000533b0: 6528 7669 6577 2c20 736c 2c20 6964 782c  e(view, sl, idx,
+000533c0: 2070 6f73 290a 0a20 2020 2020 2020 2020   pos)..         
+000533d0: 2020 206d 6173 6b5f 696e 7465 7273 6563     mask_intersec
+000533e0: 7469 6f6e 203d 2028 6d61 736b 5f69 6e74  tion = (mask_int
+000533f0: 6572 7365 6374 696f 6e20 2620 6d61 736b  ersection & mask
+00053400: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00053410: 736b 5f75 6e69 6f6e 203d 2028 6d61 736b  sk_union = (mask
+00053420: 5f75 6e69 6f6e 207c 206d 6173 6b29 0a0a  _union | mask)..
+00053430: 2020 2020 2020 2020 6369 2e63 6f6d 6d6f          ci.commo
+00053440: 6e20 3d20 6d61 736b 5f69 6e74 6572 7365  n = mask_interse
+00053450: 6374 696f 6e2e 7375 6d28 2920 2f20 6d61  ction.sum() / ma
+00053460: 736b 5f75 6e69 6f6e 2e73 756d 2829 0a0a  sk_union.sum()..
+00053470: 2020 2020 7265 7475 726e 2067 6574 6174      return getat
+00053480: 7472 2863 692c 2063 695f 7479 7065 2c20  tr(ci, ci_type, 
+00053490: 6369 290a 0a64 6566 2067 6574 5f72 6f69  ci)..def get_roi
+000534a0: 5f73 6c69 6365 2872 6f69 2c20 7a5f 6672  _slice(roi, z_fr
+000534b0: 6163 7469 6f6e 3d31 2c20 7375 6666 6978  action=1, suffix
+000534c0: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
+000534d0: 2020 2020 4765 7420 524f 4920 6f62 6a65      Get ROI obje
+000534e0: 6374 2063 6f72 7265 7370 6f6e 6469 6e67  ct corresponding
+000534f0: 2074 6f20 782d 7920 736c 6963 6520 7468   to x-y slice th
+00053500: 726f 7567 6820 696e 7075 7420 524f 492e  rough input ROI.
+00053510: 0a0a 2020 2020 2a2a 5061 7261 6d65 7465  ..    **Paramete
+00053520: 7273 3a2a 2a0a 0a20 2020 2072 6f69 203a  rs:**..    roi :
+00053530: 2073 6b72 742e 7374 7275 6374 7572 6573   skrt.structures
+00053540: 2e52 4f49 0a20 2020 2020 2020 2052 4f49  .ROI.        ROI
+00053550: 206f 626a 6563 7420 666f 7220 7768 6963   object for whic
+00053560: 6820 736c 6963 6520 6973 2074 6f20 6265  h slice is to be
+00053570: 206f 6274 6169 6e65 642e 0a0a 2020 2020   obtained...    
+00053580: 7a5f 6672 6163 7469 6f6e 203a 2066 6c6f  z_fraction : flo
+00053590: 6174 2c20 6465 6661 756c 743d 310a 2020  at, default=1.  
+000535a0: 2020 2020 2020 506f 7369 7469 6f6e 2061        Position a
+000535b0: 6c6f 6e67 207a 2061 7869 7320 6174 2077  long z axis at w
+000535c0: 6869 6368 2074 6f20 7461 6b65 2073 6c69  hich to take sli
+000535d0: 6365 2074 6872 6f75 6768 2052 4f49 2e0a  ce through ROI..
+000535e0: 2020 2020 2020 2020 5468 6520 706f 7369          The posi
+000535f0: 7469 6f6e 2069 7320 7370 6563 6966 6965  tion is specifie
+00053600: 6420 6173 2074 6865 2066 7261 6374 696f  d as the fractio
+00053610: 6e61 6c20 6469 7374 616e 6365 0a20 2020  nal distance.   
+00053620: 2020 2020 2066 726f 6d20 7468 6520 524f       from the RO
+00053630: 4927 7320 6d6f 7374 2d69 6e66 6572 696f  I's most-inferio
+00053640: 7220 706f 696e 743a 2030 2063 6f72 7265  r point: 0 corre
+00053650: 7370 6f6e 6473 2074 6f0a 2020 2020 2020  sponds to.      
+00053660: 2020 7468 6520 6d6f 7374 2d69 6e66 6572    the most-infer
+00053670: 696f 7220 706f 696e 7420 286c 6f77 6573  ior point (lowes
+00053680: 7420 7a29 3b20 3120 636f 7272 6573 706f  t z); 1 correspo
+00053690: 6e64 7320 746f 2074 6865 0a20 2020 2020  nds to the.     
+000536a0: 2020 206d 6f73 742d 7375 7065 7269 6f72     most-superior
+000536b0: 2070 6f69 6e74 2028 6869 6768 6573 7420   point (highest 
+000536c0: 7a29 2e20 2056 616c 7565 7320 666f 7220  z).  Values for 
+000536d0: 7a5f 6672 6163 7469 6f6e 0a20 2020 2020  z_fraction.     
+000536e0: 2020 206f 7574 7369 6465 2074 6865 2069     outside the i
+000536f0: 6e74 6572 7661 6c20 5b30 2c20 315d 2072  nterval [0, 1] r
+00053700: 6573 756c 7420 696e 2061 2052 756e 7469  esult in a Runti
+00053710: 6d65 4572 726f 722e 0a0a 2020 2020 7375  meError...    su
+00053720: 6666 6978 203a 2073 7472 2c20 6465 6661  ffix : str, defa
+00053730: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00053740: 2053 7566 6669 7820 746f 2061 7070 656e   Suffix to appen
+00053750: 6420 746f 206e 616d 6520 6f66 2069 6e70  d to name of inp
+00053760: 7574 2052 4f49 2c20 746f 2066 6f72 6d20  ut ROI, to form 
+00053770: 6e61 6d65 0a20 2020 2020 2020 206f 6620  name.        of 
+00053780: 6f75 7470 7574 2052 4f49 2e20 2049 6620  output ROI.  If 
+00053790: 4e6f 6e65 2c20 6170 7065 6e64 207a 5f66  None, append z_f
+000537a0: 7261 6374 696f 6e2c 2077 6974 6820 7661  raction, with va
+000537b0: 6c75 650a 2020 2020 2020 2020 6769 7665  lue.        give
+000537c0: 6e20 746f 2074 776f 2064 6563 696d 616c  n to two decimal
+000537d0: 2070 6c61 6365 732e 0a20 2020 2022 2222   places..    """
+000537e0: 0a20 2020 2023 2043 6865 636b 2074 6861  .    # Check tha
+000537f0: 7420 7a5f 6672 6163 7469 6f6e 2069 7320  t z_fraction is 
+00053800: 696e 2061 6c6c 6f77 6564 2069 6e74 6572  in allowed inter
+00053810: 7661 6c2e 0a20 2020 2069 6620 7a5f 6672  val..    if z_fr
+00053820: 6163 7469 6f6e 203c 2030 206f 7220 7a5f  action < 0 or z_
+00053830: 6672 6163 7469 6f6e 203e 2031 3a0a 2020  fraction > 1:.  
+00053840: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
+00053850: 696d 6545 7272 6f72 2866 227a 5f66 7261  imeError(f"z_fra
+00053860: 6374 696f 6e3d 7b7a 5f66 7261 6374 696f  ction={z_fractio
+00053870: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
+00053880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053890: 2220 6f75 7473 6964 6520 616c 6c6f 7765  " outside allowe
+000538a0: 6420 696e 7465 7276 616c 205b 302c 2031  d interval [0, 1
+000538b0: 5d22 290a 0a20 2020 2023 2044 6574 6572  ]")..    # Deter
+000538c0: 6d69 6e65 2074 6865 2069 6e64 6578 206f  mine the index o
+000538d0: 6620 7468 6520 696d 6167 6520 736c 6963  f the image slic
+000538e0: 6520 6174 2077 6869 6368 2074 6f20 7461  e at which to ta
+000538f0: 6b65 2052 4f49 2073 6c69 6365 2e0a 2020  ke ROI slice..  
+00053900: 2020 706f 7331 2c20 706f 7332 203d 2072    pos1, pos2 = r
+00053910: 6f69 2e67 6574 5f65 7874 656e 7428 290a  oi.get_extent().
+00053920: 2020 2020 706f 7320 3d20 706f 7331 202b      pos = pos1 +
+00053930: 207a 5f66 7261 6374 696f 6e20 2a20 2870   z_fraction * (p
+00053940: 6f73 3220 2d20 706f 7331 290a 2020 2020  os2 - pos1).    
+00053950: 6964 7820 3d20 726f 692e 706f 735f 746f  idx = roi.pos_to
+00053960: 5f69 6478 2870 6f73 2c20 227a 2229 0a0a  _idx(pos, "z")..
+00053970: 2020 2020 2320 4f62 7461 696e 2063 6f6e      # Obtain con
+00053980: 746f 7572 7320 666f 7220 7265 7175 6972  tours for requir
+00053990: 6564 2073 6c69 6365 2c20 616e 6420 636f  ed slice, and co
+000539a0: 6e76 6572 7420 746f 2052 4f49 206f 626a  nvert to ROI obj
+000539b0: 6563 742e 0a20 2020 2063 6f6e 746f 7572  ect..    contour
+000539c0: 7320 3d20 726f 692e 6765 745f 636f 6e74  s = roi.get_cont
+000539d0: 6f75 7273 2869 6478 5f61 735f 6b65 793d  ours(idx_as_key=
+000539e0: 5472 7565 295b 6964 785d 0a20 2020 2072  True)[idx].    r
+000539f0: 6f69 5f73 6c69 6365 203d 2052 4f49 287b  oi_slice = ROI({
+00053a00: 726f 692e 6964 785f 746f 5f70 6f73 2869  roi.idx_to_pos(i
+00053a10: 6478 2c20 227a 2229 3a20 636f 6e74 6f75  dx, "z"): contou
+00053a20: 7273 7d29 0a0a 2020 2020 7375 6666 6978  rs})..    suffix
+00053a30: 203d 2066 227b 7a5f 6672 6163 7469 6f6e   = f"{z_fraction
+00053a40: 3a2e 3266 7d22 2069 6620 7375 6666 6978  :.2f}" if suffix
+00053a50: 2069 7320 4e6f 6e65 2065 6c73 6520 7375   is None else su
+00053a60: 6666 6978 0a20 2020 2069 6620 7375 6666  ffix.    if suff
+00053a70: 6978 3a0a 2020 2020 2020 2020 726f 695f  ix:.        roi_
+00053a80: 736c 6963 652e 6e61 6d65 203d 2066 227b  slice.name = f"{
+00053a90: 726f 692e 6e61 6d65 7d5f 7b73 7566 6669  roi.name}_{suffi
+00053aa0: 787d 220a 2020 2020 656c 7365 3a0a 2020  x}".    else:.  
+00053ab0: 2020 2020 2020 726f 695f 736c 6963 652e        roi_slice.
+00053ac0: 6e61 6d65 203d 2073 7472 2872 6f69 2e6e  name = str(roi.n
+00053ad0: 616d 6529 0a0a 2020 2020 7265 7475 726e  ame)..    return
+00053ae0: 2072 6f69 5f73 6c69 6365 0a0a 6465 6620   roi_slice..def 
+00053af0: 6765 745f 6d65 7472 6963 5f6d 6574 686f  get_metric_metho
+00053b00: 6428 6d65 7472 6963 293a 0a20 2020 2022  d(metric):.    "
+00053b10: 2222 0a20 2020 204d 6170 2062 6574 7765  "".    Map betwe
+00053b20: 656e 206d 6574 7269 6320 6964 656e 7469  en metric identi
+00053b30: 6669 6572 2061 7320 6c69 7374 6564 2069  fier as listed i
+00053b40: 6e20 6765 745f 636f 6d70 6172 6973 6f6e  n get_comparison
+00053b50: 5f6d 6574 7269 6373 2829 0a20 2020 2061  _metrics().    a
+00053b60: 6e64 206e 616d 6520 6f66 2052 4f49 206d  nd name of ROI m
+00053b70: 6574 686f 6420 666f 7220 6361 6c63 756c  ethod for calcul
+00053b80: 6174 696e 6720 7468 6520 6d65 7472 6963  ating the metric
+00053b90: 2e0a 2020 2020 0a20 2020 2054 6869 7320  ..    .    This 
+00053ba0: 6675 6e63 7469 6f6e 2069 7320 7573 6564  function is used
+00053bb0: 2069 6e20 524f 492e 6765 745f 6d65 7472   in ROI.get_metr
+00053bc0: 6963 5f62 795f 736c 6963 6528 2920 746f  ic_by_slice() to
+00053bd0: 2064 6574 6572 6d69 6e65 0a20 2020 2074   determine.    t
+00053be0: 6865 206d 6574 686f 6420 746f 2062 6520  he method to be 
+00053bf0: 6361 6c6c 6564 2066 6f72 2065 6163 6820  called for each 
+00053c00: 6d65 7472 6963 2e0a 2020 2020 2222 220a  metric..    """.
+00053c10: 2020 2020 2320 4b65 7973 2061 7265 206d      # Keys are m
+00053c20: 6574 7269 6320 6964 656e 7469 6669 6572  etric identifier
+00053c30: 733b 2076 616c 7565 7320 6172 6520 6e61  s; values are na
+00053c40: 6d65 7320 6f66 2052 4f49 206d 6574 686f  mes of ROI metho
+00053c50: 6473 0a20 2020 2023 2066 6f72 206d 6574  ds.    # for met
+00053c60: 7269 6320 6361 6c63 756c 6174 696f 6e2e  ric calculation.
+00053c70: 0a20 2020 2023 204d 6574 7269 6373 2061  .    # Metrics a
+00053c80: 7265 2069 6e63 6c75 6465 6420 696e 2074  re included in t
+00053c90: 6865 2064 6963 7469 6f6e 6172 7920 6f6e  he dictionary on
+00053ca0: 6c79 2069 6620 6964 656e 7469 6669 6572  ly if identifier
+00053cb0: 2061 6e64 206d 6574 686f 640a 2020 2020   and method.    
+00053cc0: 2320 6e61 6d65 2061 7265 2064 6966 6665  # name are diffe
+00053cd0: 7265 6e74 2e0a 2020 2020 6d61 7070 696e  rent..    mappin
+00053ce0: 6773 203d 207b 0a20 2020 2020 2020 2020  gs = {.         
+00053cf0: 2020 2022 6162 735f 6365 6e74 726f 6964     "abs_centroid
+00053d00: 223a 2022 6162 735f 6365 6e74 726f 6964  ": "abs_centroid
+00053d10: 5f64 6973 7461 6e63 6522 2c0a 2020 2020  _distance",.    
+00053d20: 2020 2020 2020 2020 2263 656e 7472 6f69          "centroi
+00053d30: 6422 3a20 2263 656e 7472 6f69 645f 6469  d": "centroid_di
+00053d40: 7374 616e 6365 222c 0a20 2020 2020 2020  stance",.       
+00053d50: 2020 2020 2022 7265 6c5f 6172 6561 5f64       "rel_area_d
+00053d60: 6966 6622 3a20 2272 656c 6174 6976 655f  iff": "relative_
+00053d70: 6172 6561 5f64 6966 6622 2c0a 2020 2020  area_diff",.    
+00053d80: 2020 2020 2020 2020 7d0a 2020 2020 7265          }.    re
+00053d90: 7475 726e 206d 6170 7069 6e67 732e 6765  turn mappings.ge
+00053da0: 7428 6d65 7472 6963 2c20 6d65 7472 6963  t(metric, metric
+00053db0: 290a 0a64 6566 2067 6574 5f63 6f6d 7061  )..def get_compa
+00053dc0: 7269 736f 6e5f 6d65 7472 6963 7328 6365  rison_metrics(ce
+00053dd0: 6e74 726f 6964 5f63 6f6d 706f 6e65 6e74  ntroid_component
+00053de0: 733d 4661 6c73 652c 2073 6c69 6365 5f73  s=False, slice_s
+00053df0: 7461 7473 3d4e 6f6e 652c 0a20 2020 2020  tats=None,.     
+00053e00: 2020 2064 6566 6175 6c74 5f62 795f 736c     default_by_sl
+00053e10: 6963 653d 4e6f 6e65 2c20 7669 6577 3d22  ice=None, view="
+00053e20: 782d 7922 293a 0a20 2020 2022 2222 0a20  x-y"):.    """. 
+00053e30: 2020 2047 6574 206c 6973 7420 6f66 2063     Get list of c
+00053e40: 6f6d 7061 7269 736f 6e20 6d65 7472 6963  omparison metric
+00053e50: 732e 0a0a 2020 2020 416c 6c20 6d65 7472  s...    All metr
+00053e60: 6963 7320 6c69 7374 6564 2068 6572 6520  ics listed here 
+00053e70: 7368 6f75 6c64 2062 6520 7265 636f 676e  should be recogn
+00053e80: 6973 6564 2062 7920 524f 492e 6765 745f  ised by ROI.get_
+00053e90: 636f 6d70 6172 6973 6f6e 2829 2c0a 2020  comparison(),.  
+00053ea0: 2020 616e 6420 616c 6c20 6d65 7472 6963    and all metric
+00053eb0: 7320 7265 636f 676e 6973 6564 2062 7920  s recognised by 
+00053ec0: 524f 492e 6765 745f 636f 6d70 6172 6973  ROI.get_comparis
+00053ed0: 6f6e 2829 2073 686f 756c 6420 6265 206c  on() should be l
+00053ee0: 6973 7465 6420 6865 7265 2e0a 0a20 2020  isted here...   
+00053ef0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00053f00: 0a0a 2020 2020 6365 6e74 726f 6964 5f63  ..    centroid_c
+00053f10: 6f6d 706f 6e65 6e74 7320 3a20 626f 6f6c  omponents : bool
+00053f20: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+00053f30: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00053f40: 2072 6570 6c61 6365 206d 6574 7269 6373   replace metrics
+00053f50: 2022 6365 6e74 726f 6964 2220 616e 6420   "centroid" and 
+00053f60: 2263 656e 7472 6f69 645f 736c 6963 6522  "centroid_slice"
+00053f70: 2062 7920 7468 650a 2020 2020 2020 2020   by the.        
+00053f80: 6d65 7472 6963 7320 666f 7220 7468 6569  metrics for thei
+00053f90: 7220 636f 6d70 6f6e 656e 7473 2e0a 0a20  r components... 
+00053fa0: 2020 2073 6c69 6365 5f73 7461 7473 203a     slice_stats :
+00053fb0: 2073 7472 2f6c 6973 742f 6469 6374 2c20   str/list/dict, 
+00053fc0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00053fd0: 2020 2020 2053 7065 6369 6669 6361 7469       Specificati
+00053fe0: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
+00053ff0: 2074 6f20 6265 2063 616c 6375 6c61 7465   to be calculate
+00054000: 6420 7265 6c61 7469 7665 0a20 2020 2020  d relative.     
+00054010: 2020 2074 6f20 736c 6963 652d 6279 2d73     to slice-by-s
+00054020: 6c69 6365 206d 6574 7269 6320 7661 6c75  lice metric valu
+00054030: 6573 2e0a 0a20 2020 2020 2020 2041 2073  es...        A s
+00054040: 7461 7469 7374 6963 2069 7320 7370 6563  tatistic is spec
+00054050: 6966 6965 6420 6279 2074 6865 206e 616d  ified by the nam
+00054060: 6520 6f66 2074 6865 2066 756e 6374 696f  e of the functio
+00054070: 6e20 666f 720a 2020 2020 2020 2020 6974  n for.        it
+00054080: 7320 6361 6c63 756c 6174 696f 6e20 696e  s calculation in
+00054090: 2074 6865 2050 7974 686f 6e20 7374 6174   the Python stat
+000540a0: 6973 7469 6373 206d 6f64 756c 653a 0a0a  istics module:..
+000540b0: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+000540c0: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+000540d0: 332f 6c69 6272 6172 792f 7374 6174 6973  3/library/statis
+000540e0: 7469 6373 2e68 746d 6c0a 0a20 2020 2020  tics.html..     
+000540f0: 2020 2046 6f72 2069 7473 2075 7365 2068     For its use h
+00054100: 6572 652c 2074 6865 2072 656c 6576 616e  ere, the relevan
+00054110: 7420 6675 6e63 7469 6f6e 206d 7573 7420  t function must 
+00054120: 7265 7175 6972 650a 2020 2020 2020 2020  require.        
+00054130: 6120 7369 6e67 6c65 2d76 6172 6961 626c  a single-variabl
+00054140: 6520 696e 7075 742c 206d 7573 7420 6e6f  e input, must no
+00054150: 7420 7265 7175 6972 6520 616e 7920 6b65  t require any ke
+00054160: 7977 6f72 640a 2020 2020 2020 2020 6172  yword.        ar
+00054170: 6775 6d65 6e74 732c 2061 6e64 206d 7573  guments, and mus
+00054180: 7420 7265 7475 726e 2061 2073 696e 676c  t return a singl
+00054190: 6520 6e75 6d62 6572 2e0a 0a20 2020 2020  e number...     
+000541a0: 2020 2041 7661 696c 6162 6c65 206f 7074     Available opt
+000541b0: 696f 6e73 2069 6e63 6c75 6465 3a20 226d  ions include: "m
+000541c0: 6561 6e22 2c20 226d 6564 6961 6e22 2c20  ean", "median", 
+000541d0: 226d 6f64 6522 2c0a 2020 2020 2020 2020  "mode",.        
+000541e0: 2273 7464 6576 222e 0a0a 2020 2020 2020  "stdev"...      
+000541f0: 2053 7461 7469 7374 6963 7320 746f 2062   Statistics to b
+00054200: 6520 6361 6c63 756c 6174 6564 2063 616e  e calculated can
+00054210: 2062 6520 7370 6563 6966 6965 6420 7573   be specified us
+00054220: 696e 6720 616e 7920 6f66 0a20 2020 2020  ing any of.     
+00054230: 2020 7468 6520 666f 6c6c 6f77 696e 673a    the following:
+00054240: 0a0a 2020 2020 2020 202d 2053 7472 696e  ..       - Strin
+00054250: 6720 7370 6563 6966 7969 6e67 2073 696e  g specifying sin
+00054260: 676c 6520 7374 6174 6973 7469 6320 746f  gle statistic to
+00054270: 2062 6520 6361 6c63 756c 6174 6564 2c0a   be calculated,.
+00054280: 2020 2020 2020 2020 2077 6974 6820 736c           with sl
+00054290: 6963 6573 2063 6f6e 7369 6465 7265 6420  ices considered 
+000542a0: 6173 2067 6976 656e 2062 7920 3c64 6566  as given by <def
+000542b0: 6175 6c74 5f62 795f 736c 6963 653e 2c0a  ault_by_slice>,.
+000542c0: 2020 2020 2020 2020 2066 6f72 2065 7861           for exa
+000542d0: 6d70 6c65 3a20 226d 6561 6e22 3b0a 2020  mple: "mean";.  
+000542e0: 2020 2020 202d 204c 6973 7420 7370 6563       - List spec
+000542f0: 6966 7969 6e67 206d 756c 7469 706c 6520  ifying multiple 
+00054300: 7374 6174 6973 7469 6373 2074 6f20 6265  statistics to be
+00054310: 2063 616c 6375 6c61 7465 642c 0a20 2020   calculated,.   
+00054320: 2020 2020 2020 7769 7468 2073 6c69 6365        with slice
+00054330: 7320 636f 6e73 6964 6572 6564 2061 7320  s considered as 
+00054340: 6769 7665 6e20 6279 203c 6465 6661 756c  given by <defaul
+00054350: 745f 6279 5f73 6c69 6365 3e2c 0a20 2020  t_by_slice>,.   
+00054360: 2020 2020 2020 666f 7220 6578 616d 706c        for exampl
+00054370: 653a 205b 226d 6561 6e22 2c20 2273 7464  e: ["mean", "std
+00054380: 6576 225d 3b0a 2020 2020 2020 202d 2044  ev"];.       - D
+00054390: 6963 7469 6f6e 6172 7920 7768 6572 6520  ictionary where 
+000543a0: 6b65 7973 2073 7065 6369 6679 2073 6c69  keys specify sli
+000543b0: 6365 7320 746f 2062 6520 636f 6e73 6964  ces to be consid
+000543c0: 6572 6564 2c0a 2020 2020 2020 2020 2061  ered,.         a
+000543d0: 6e64 2076 616c 7565 7320 7370 6563 6966  nd values specif
+000543e0: 7920 7374 6174 6973 7469 6373 2028 7374  y statistics (st
+000543f0: 7269 6e67 206f 7220 6c69 7374 292c 2066  ring or list), f
+00054400: 6f72 0a20 2020 2020 2020 2020 6578 616d  or.         exam
+00054410: 706c 653a 207b 2275 6e69 6f6e 223a 205b  ple: {"union": [
+00054420: 226d 6561 6e22 2c20 2273 7464 6576 225d  "mean", "stdev"]
+00054430: 7d2e 2020 5661 6c69 6420 736c 6963 650a  }.  Valid slice.
+00054440: 2020 2020 2020 2020 2073 7065 6369 6669           specifi
+00054450: 6361 7469 6f6e 7320 6172 6520 6173 206c  cations are as l
+00054460: 6973 7465 6420 666f 7220 3c64 6566 6175  isted for <defau
+00054470: 6c74 5f62 795f 736c 6963 653e 2e0a 0a20  lt_by_slice>... 
+00054480: 2020 2064 6566 6175 6c74 5f62 795f 736c     default_by_sl
+00054490: 6963 653a 2073 7472 2c20 6465 6661 756c  ice: str, defaul
+000544a0: 743d 4e6f 6e65 0a20 2020 2020 2020 2044  t=None.        D
+000544b0: 6566 6175 6c74 2073 7065 6369 6669 6361  efault specifica
+000544c0: 7469 6f6e 206f 6620 736c 6963 6573 2074  tion of slices t
+000544d0: 6f20 6265 2063 6f6e 7369 6465 7265 6420  o be considered 
+000544e0: 7768 656e 0a20 2020 2020 2020 2063 616c  when.        cal
+000544f0: 6375 6c61 7469 6e67 2073 6c69 6365 2d62  culating slice-b
+00054500: 792d 736c 6963 6520 7374 6174 6973 7469  y-slice statisti
+00054510: 6373 2066 6f72 2061 206d 6574 7269 6320  cs for a metric 
+00054520: 636f 6d70 6172 696e 670a 2020 2020 2020  comparing.      
+00054530: 2020 7477 6f20 524f 4973 2c20 726f 6931    two ROIs, roi1
+00054540: 2061 6e64 2072 6f69 322e 2020 5468 6520   and roi2.  The 
+00054550: 7661 6c69 6420 7370 6563 6966 6963 6174  valid specificat
+00054560: 696f 6e73 2061 7265 3a0a 0a20 2020 2020  ions are:..     
+00054570: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+00054580: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+00054590: 7320 636f 6e74 6169 6e69 6e67 2072 6f69  s containing roi
+000545a0: 313b 0a20 2020 2020 2020 202d 2022 7269  1;.        - "ri
+000545b0: 6768 7422 3a20 636f 6e73 6964 6572 206f  ght": consider o
+000545c0: 6e6c 7920 736c 6963 6573 2063 6f6e 7461  nly slices conta
+000545d0: 696e 696e 6720 726f 6932 3b0a 2020 2020  ining roi2;.    
+000545e0: 2020 2020 2d20 2275 6e69 6f6e 223a 2063      - "union": c
+000545f0: 6f6e 7369 6465 7220 736c 6963 6573 2063  onsider slices c
+00054600: 6f6e 7461 696e 696e 6720 6569 7468 6572  ontaining either
+00054610: 206f 6620 726f 6931 2061 6e64 2072 6f69   of roi1 and roi
+00054620: 323b 0a20 2020 2020 2020 202d 2022 696e  2;.        - "in
+00054630: 7465 7273 6563 7469 6f6e 223a 2063 6f6e  tersection": con
+00054640: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
+00054650: 7461 696e 696e 6720 626f 7468 2072 6f69  taining both roi
+00054660: 3120 616e 6420 726f 6932 2e0a 0a20 2020  1 and roi2...   
+00054670: 2020 2020 2049 6620 4e6f 6e65 2c20 7573       If None, us
+00054680: 6520 736b 7274 2e63 6f72 652e 4465 6661  e skrt.core.Defa
+00054690: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
+000546a0: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+000546b0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+000546c0: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+000546d0: 7269 656e 7461 7469 6f6e 2074 6f20 636f  rientation to co
+000546e0: 6e73 6964 6572 2077 6865 6e20 7461 6b69  nsider when taki
+000546f0: 6e67 2063 656e 7472 6f69 6420 636f 6d70  ng centroid comp
+00054700: 6f6e 656e 7473 2072 656c 6174 6976 650a  onents relative.
+00054710: 2020 2020 2020 2020 2020 2020 746f 2061              to a
+00054720: 2073 6c69 6365 2e20 2043 616e 2062 6520   slice.  Can be 
+00054730: 2278 2d79 222c 2022 782d 7a22 2c20 2279  "x-y", "x-z", "y
+00054740: 2d78 222c 2022 792d 7a22 2c20 227a 2d78  -x", "y-z", "z-x
+00054750: 222c 206f 7220 227a 2d79 222e 0a20 2020  ", or "z-y"..   
+00054760: 2022 2222 0a20 2020 206d 6574 7269 6373   """.    metrics
+00054770: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00054780: 2022 6162 735f 6365 6e74 726f 6964 222c   "abs_centroid",
+00054790: 0a20 2020 2020 2020 2020 2020 2022 6162  .            "ab
+000547a0: 735f 6365 6e74 726f 6964 5f66 6c61 7422  s_centroid_flat"
+000547b0: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
+000547c0: 6273 5f63 656e 7472 6f69 645f 736c 6963  bs_centroid_slic
+000547d0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+000547e0: 2261 6273 5f63 656e 7472 6f69 645f 736c  "abs_centroid_sl
+000547f0: 6963 655f 7374 6174 7322 2c0a 2020 2020  ice_stats",.    
+00054800: 2020 2020 2020 2020 2261 7265 615f 6469          "area_di
+00054810: 6666 222c 0a20 2020 2020 2020 2020 2020  ff",.           
+00054820: 2022 6172 6561 5f64 6966 665f 666c 6174   "area_diff_flat
+00054830: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00054840: 6172 6561 5f64 6966 665f 736c 6963 655f  area_diff_slice_
+00054850: 7374 6174 7322 2c0a 2020 2020 2020 2020  stats",.        
+00054860: 2020 2020 2261 7265 615f 7261 7469 6f22      "area_ratio"
+00054870: 2c0a 2020 2020 2020 2020 2020 2020 2261  ,.            "a
+00054880: 7265 615f 7261 7469 6f5f 666c 6174 222c  rea_ratio_flat",
+00054890: 0a20 2020 2020 2020 2020 2020 2022 6172  .            "ar
+000548a0: 6561 5f72 6174 696f 5f73 6c69 6365 5f73  ea_ratio_slice_s
+000548b0: 7461 7473 222c 0a20 2020 2020 2020 2020  tats",.         
+000548c0: 2020 2022 6365 6e74 726f 6964 222c 0a20     "centroid",. 
+000548d0: 2020 2020 2020 2020 2020 2022 6365 6e74             "cent
+000548e0: 726f 6964 5f73 6c69 6365 222c 0a20 2020  roid_slice",.   
+000548f0: 2020 2020 2020 2020 2022 6365 6e74 726f           "centro
+00054900: 6964 5f73 6c69 6365 5f73 7461 7473 222c  id_slice_stats",
+00054910: 0a20 2020 2020 2020 2020 2020 2022 6469  .            "di
+00054920: 6365 222c 0a20 2020 2020 2020 2020 2020  ce",.           
+00054930: 2022 6469 6365 5f66 6c61 7422 2c0a 2020   "dice_flat",.  
+00054940: 2020 2020 2020 2020 2020 2264 6963 655f            "dice_
+00054950: 736c 6963 6522 2c0a 2020 2020 2020 2020  slice",.        
+00054960: 2020 2020 2264 6963 655f 736c 6963 655f      "dice_slice_
+00054970: 7374 6174 7322 2c0a 2020 2020 2020 2020  stats",.        
+00054980: 2020 2020 2268 6175 7364 6f72 6666 5f64      "hausdorff_d
+00054990: 6973 7461 6e63 6522 2c0a 2020 2020 2020  istance",.      
+000549a0: 2020 2020 2020 2268 6175 7364 6f72 6666        "hausdorff
+000549b0: 5f64 6973 7461 6e63 655f 666c 6174 222c  _distance_flat",
+000549c0: 0a20 2020 2020 2020 2020 2020 2022 6a61  .            "ja
+000549d0: 6363 6172 6422 2c0a 2020 2020 2020 2020  ccard",.        
+000549e0: 2020 2020 226a 6163 6361 7264 5f66 6c61      "jaccard_fla
+000549f0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00054a00: 226a 6163 6361 7264 5f73 6c69 6365 222c  "jaccard_slice",
+00054a10: 0a20 2020 2020 2020 2020 2020 2022 6a61  .            "ja
+00054a20: 6363 6172 645f 736c 6963 655f 7374 6174  ccard_slice_stat
+00054a30: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+00054a40: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
+00054a50: 6f5f 636f 6e66 6f72 6d69 7479 222c 0a20  o_conformity",. 
+00054a60: 2020 2020 2020 2020 2020 2022 6d65 616e             "mean
+00054a70: 5f64 6973 7461 6e63 655f 746f 5f63 6f6e  _distance_to_con
+00054a80: 666f 726d 6974 795f 666c 6174 222c 0a20  formity_flat",. 
+00054a90: 2020 2020 2020 2020 2020 2022 6d65 616e             "mean
+00054aa0: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
+00054ab0: 6469 7374 616e 6365 222c 0a20 2020 2020  distance",.     
+00054ac0: 2020 2020 2020 2022 6d65 616e 5f73 6967         "mean_sig
+00054ad0: 6e65 645f 7375 7266 6163 655f 6469 7374  ned_surface_dist
+00054ae0: 616e 6365 5f66 6c61 7422 2c0a 2020 2020  ance_flat",.    
+00054af0: 2020 2020 2020 2020 226d 6561 6e5f 7375          "mean_su
+00054b00: 7266 6163 655f 6469 7374 616e 6365 222c  rface_distance",
+00054b10: 0a20 2020 2020 2020 2020 2020 2022 6d65  .            "me
+00054b20: 616e 5f73 7572 6661 6365 5f64 6973 7461  an_surface_dista
+00054b30: 6e63 655f 666c 6174 222c 0a20 2020 2020  nce_flat",.     
+00054b40: 2020 2020 2020 2022 6d65 616e 5f6f 7665         "mean_ove
+00054b50: 725f 636f 6e74 6f75 7269 6e67 222c 0a20  r_contouring",. 
+00054b60: 2020 2020 2020 2020 2020 2022 6d65 616e             "mean
+00054b70: 5f6f 7665 725f 636f 6e74 6f75 7269 6e67  _over_contouring
+00054b80: 5f66 6c61 7422 2c0a 2020 2020 2020 2020  _flat",.        
+00054b90: 2020 2020 226d 6561 6e5f 756e 6465 725f      "mean_under_
+00054ba0: 636f 6e74 6f75 7269 6e67 222c 0a20 2020  contouring",.   
+00054bb0: 2020 2020 2020 2020 2022 6d65 616e 5f75           "mean_u
+00054bc0: 6e64 6572 5f63 6f6e 746f 7572 696e 675f  nder_contouring_
+00054bd0: 666c 6174 222c 0a20 2020 2020 2020 2020  flat",.         
+00054be0: 2020 2022 7265 6c5f 6172 6561 5f64 6966     "rel_area_dif
+00054bf0: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
+00054c00: 2272 656c 5f61 7265 615f 6469 6666 5f66  "rel_area_diff_f
+00054c10: 6c61 7422 2c0a 2020 2020 2020 2020 2020  lat",.          
+00054c20: 2020 2272 656c 5f61 7265 615f 6469 6666    "rel_area_diff
+00054c30: 5f73 6c69 6365 5f73 7461 7473 222c 0a20  _slice_stats",. 
+00054c40: 2020 2020 2020 2020 2020 2022 7265 6c5f             "rel_
+00054c50: 766f 6c75 6d65 5f64 6966 6622 2c0a 2020  volume_diff",.  
+00054c60: 2020 2020 2020 2020 2020 2272 6d73 5f73            "rms_s
+00054c70: 6967 6e65 645f 7375 7266 6163 655f 6469  igned_surface_di
+00054c80: 7374 616e 6365 222c 0a20 2020 2020 2020  stance",.       
+00054c90: 2020 2020 2022 726d 735f 7369 676e 6564       "rms_signed
+00054ca0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+00054cb0: 655f 666c 6174 222c 0a20 2020 2020 2020  e_flat",.       
+00054cc0: 2020 2020 2022 726d 735f 7375 7266 6163       "rms_surfac
+00054cd0: 655f 6469 7374 616e 6365 222c 0a20 2020  e_distance",.   
+00054ce0: 2020 2020 2020 2020 2022 726d 735f 7375           "rms_su
+00054cf0: 7266 6163 655f 6469 7374 616e 6365 5f66  rface_distance_f
+00054d00: 6c61 7422 2c0a 2020 2020 2020 2020 2020  lat",.          
+00054d10: 2020 2276 6f6c 756d 655f 6469 6666 222c    "volume_diff",
+00054d20: 0a20 2020 2020 2020 2020 2020 2022 766f  .            "vo
+00054d30: 6c75 6d65 5f72 6174 696f 222c 0a20 2020  lume_ratio",.   
+00054d40: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
+00054d50: 2320 5265 706c 6163 6520 6365 6e74 726f  # Replace centro
+00054d60: 6964 2076 6563 746f 7273 2062 7920 636f  id vectors by co
+00054d70: 6d70 6f6e 656e 7473 2e0a 2020 2020 6966  mponents..    if
+00054d80: 2063 656e 7472 6f69 645f 636f 6d70 6f6e   centroid_compon
+00054d90: 656e 7473 3a0a 2020 2020 2020 2020 6365  ents:.        ce
+00054da0: 6e74 726f 6964 7320 3d20 7b0a 2020 2020  ntroids = {.    
+00054db0: 2020 2020 2020 2020 2020 2020 2263 656e              "cen
+00054dc0: 7472 6f69 6422 3a20 5b22 6365 6e74 726f  troid": ["centro
+00054dd0: 6964 5f78 222c 2022 6365 6e74 726f 6964  id_x", "centroid
+00054de0: 5f79 222c 2022 6365 6e74 726f 6964 5f7a  _y", "centroid_z
+00054df0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+00054e00: 2020 2020 2263 656e 7472 6f69 645f 736c      "centroid_sl
+00054e10: 6963 6522 3a20 5b5d 0a20 2020 2020 2020  ice": [].       
+00054e20: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00054e30: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
+00054e40: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00054e50: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+00054e60: 6f69 6473 5b22 6365 6e74 726f 6964 5f73  oids["centroid_s
+00054e70: 6c69 6365 5f73 7461 7473 225d 203d 205b  lice_stats"] = [
+00054e80: 5d0a 0a20 2020 2020 2020 2066 6f72 2069  ]..        for i
+00054e90: 5f61 7820 696e 2073 6b72 742e 696d 6167  _ax in skrt.imag
+00054ea0: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
+00054eb0: 775d 3a0a 2020 2020 2020 2020 2020 2020  w]:.            
+00054ec0: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
+00054ed0: 5f61 7865 735b 695f 6178 5d0a 2020 2020  _axes[i_ax].    
+00054ee0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+00054ef0: 735b 2263 656e 7472 6f69 645f 736c 6963  s["centroid_slic
+00054f00: 6522 5d2e 6170 7065 6e64 2866 2263 656e  e"].append(f"cen
+00054f10: 7472 6f69 645f 736c 6963 655f 7b61 787d  troid_slice_{ax}
+00054f20: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00054f30: 6966 2073 6c69 6365 5f73 7461 7473 2069  if slice_stats i
+00054f40: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00054f50: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+00054f60: 726f 6964 735b 2263 656e 7472 6f69 645f  roids["centroid_
+00054f70: 736c 6963 655f 7374 6174 7322 5d2e 6170  slice_stats"].ap
+00054f80: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
+00054f90: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00054fa0: 6365 6e74 726f 6964 5f7b 6178 7d5f 736c  centroid_{ax}_sl
+00054fb0: 6963 655f 7374 6174 7322 290a 0a20 2020  ice_stats")..   
+00054fc0: 2020 2020 2066 6f72 2076 6563 746f 722c       for vector,
+00054fd0: 2063 6f6d 706f 6e65 6e74 7320 696e 2063   components in c
+00054fe0: 656e 7472 6f69 6473 2e69 7465 6d73 2829  entroids.items()
+00054ff0: 3a0a 2020 2020 2020 2020 2020 2020 6964  :.            id
+00055000: 7820 3d20 6d65 7472 6963 732e 696e 6465  x = metrics.inde
+00055010: 7828 7665 6374 6f72 290a 2020 2020 2020  x(vector).      
+00055020: 2020 2020 2020 6d65 7472 6963 735b 6964        metrics[id
+00055030: 7820 3a20 6964 7820 2b20 315d 203d 2063  x : idx + 1] = c
+00055040: 6f6d 706f 6e65 6e74 730a 0a20 2020 2023  omponents..    #
+00055050: 2052 656d 6f76 6520 6d65 7472 6963 7320   Remove metrics 
+00055060: 7769 7468 2073 7566 6669 7820 2273 6c69  with suffix "sli
+00055070: 6365 5f73 7461 7473 222c 0a20 2020 2023  ce_stats",.    #
+00055080: 2061 6e64 2072 6570 6c61 6365 2077 6974   and replace wit
+00055090: 6820 7370 6563 6966 6963 206d 6574 7269  h specific metri
+000550a0: 6373 2072 656c 6174 696e 6720 746f 2073  cs relating to s
+000550b0: 6c69 6365 2d62 792d 736c 6963 6520 7374  lice-by-slice st
+000550c0: 6174 6973 7469 6373 2e0a 2020 2020 6966  atistics..    if
+000550d0: 2073 6c69 6365 5f73 7461 7473 2069 7320   slice_stats is 
+000550e0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000550f0: 2020 736c 6963 655f 7374 6174 735f 6d65    slice_stats_me
+00055100: 7472 6963 7320 3d20 5b5d 0a20 2020 2020  trics = [].     
+00055110: 2020 206d 6574 7269 6373 3220 3d20 5b5d     metrics2 = []
+00055120: 0a20 2020 2020 2020 2066 6f72 206d 6574  .        for met
+00055130: 7269 6320 696e 206d 6574 7269 6373 3a0a  ric in metrics:.
+00055140: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+00055150: 736c 6963 655f 7374 6174 7322 2069 6e20  slice_stats" in 
+00055160: 6d65 7472 6963 3a0a 2020 2020 2020 2020  metric:.        
+00055170: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+00055180: 6174 735f 6d65 7472 6963 732e 6170 7065  ats_metrics.appe
+00055190: 6e64 286d 6574 7269 632e 7370 6c69 7428  nd(metric.split(
+000551a0: 225f 736c 6963 655f 7374 6174 7322 295b  "_slice_stats")[
+000551b0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+000551c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000551d0: 2020 2020 2020 6d65 7472 6963 7332 2e61        metrics2.a
+000551e0: 7070 656e 6428 6d65 7472 6963 290a 0a20  ppend(metric).. 
+000551f0: 2020 2020 2020 2066 6f72 2062 795f 736c         for by_sl
+00055200: 6963 652c 2073 7461 7473 2069 6e20 280a  ice, stats in (.
+00055210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055220: 6578 7061 6e64 5f73 6c69 6365 5f73 7461  expand_slice_sta
+00055230: 7473 2873 6c69 6365 5f73 7461 7473 2c20  ts(slice_stats, 
+00055240: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00055250: 292e 6974 656d 7328 2929 3a0a 2020 2020  ).items()):.    
+00055260: 2020 2020 2020 2020 666f 7220 6d65 7472          for metr
+00055270: 6963 2069 6e20 736c 6963 655f 7374 6174  ic in slice_stat
+00055280: 735f 6d65 7472 6963 733a 0a20 2020 2020  s_metrics:.     
+00055290: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+000552a0: 7461 7420 696e 2073 7461 7473 3a0a 2020  tat in stats:.  
+000552b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000552c0: 2020 6d65 7472 6963 7332 2e61 7070 656e    metrics2.appen
+000552d0: 6428 6622 7b6d 6574 7269 637d 5f73 6c69  d(f"{metric}_sli
+000552e0: 6365 5f7b 6279 5f73 6c69 6365 7d5f 7b73  ce_{by_slice}_{s
+000552f0: 7461 747d 2229 0a20 2020 2020 2020 206d  tat}").        m
+00055300: 6574 7269 6373 203d 206d 6574 7269 6373  etrics = metrics
+00055310: 320a 0a20 2020 2072 6574 7572 6e20 736f  2..    return so
+00055320: 7274 6564 286d 6574 7269 6373 290a 0a64  rted(metrics)..d
+00055330: 6566 2067 6574 5f63 6f6e 7365 6e73 7573  ef get_consensus
+00055340: 5f74 7970 6573 2829 3a0a 2020 2020 2222  _types():.    ""
+00055350: 220a 2020 2020 4765 7420 6c69 7374 206f  ".    Get list o
+00055360: 6620 636f 6e73 656e 7375 7320 7479 7065  f consensus type
+00055370: 732e 0a0a 2020 2020 416c 6c20 636f 6e73  s...    All cons
+00055380: 656e 7375 7320 7479 7065 7320 6c69 7374  ensus types list
+00055390: 6564 2068 6572 6520 7368 6f75 6c64 2062  ed here should b
+000553a0: 6520 7265 636f 676e 6973 6564 2062 790a  e recognised by.
+000553b0: 2020 2020 5374 7275 6374 7572 6553 6574      StructureSet
+000553c0: 2e67 6574 5f63 6f6e 7365 6e73 7573 2829  .get_consensus()
+000553d0: 2c20 616e 6420 616c 6c20 636f 6e73 656e  , and all consen
+000553e0: 7375 7320 7479 7065 7320 7265 636f 676e  sus types recogn
+000553f0: 6973 6564 0a20 2020 2062 7920 5374 7275  ised.    by Stru
+00055400: 6374 7572 6553 6574 2e67 6574 5f63 6f6e  ctureSet.get_con
+00055410: 7365 6e73 7573 2073 686f 756c 6420 6265  sensus should be
+00055420: 206c 6973 7465 6420 6865 7265 2e0a 2020   listed here..  
+00055430: 2020 2222 220a 2020 2020 7265 7475 726e    """.    return
+00055440: 205b 0a20 2020 2020 2020 2020 2020 2022   [.            "
+00055450: 6d61 6a6f 7269 7479 222c 0a20 2020 2020  majority",.     
+00055460: 2020 2020 2020 2022 6f76 6572 6c61 7022         "overlap"
+00055470: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00055480: 7461 706c 6522 2c0a 2020 2020 2020 2020  taple",.        
+00055490: 2020 2020 2273 756d 222c 0a20 2020 2020      "sum",.     
+000554a0: 2020 2020 2020 205d 0a0a 6465 6620 6765         ]..def ge
+000554b0: 745f 6279 5f73 6c69 6365 5f6d 6574 686f  t_by_slice_metho
+000554c0: 6473 2829 3a0a 2020 2020 2222 220a 2020  ds():.    """.  
+000554d0: 2020 4765 7420 6c69 7374 206f 6620 6d65    Get list of me
+000554e0: 7468 6f64 7320 666f 7220 6465 6669 6e69  thods for defini
+000554f0: 6e67 2073 6c69 6365 7320 746f 2062 6520  ng slices to be 
+00055500: 636f 6e73 6964 6572 6564 0a20 2020 2066  considered.    f
+00055510: 6f72 2073 6c69 6365 2d62 792d 736c 6963  or slice-by-slic
+00055520: 6520 524f 4920 636f 6d70 6172 6973 6f6e  e ROI comparison
+00055530: 732e 0a20 2020 2022 2222 0a20 2020 2072  s..    """.    r
+00055540: 6574 7572 6e20 5b22 6c65 6674 222c 2022  eturn ["left", "
+00055550: 7269 6768 7422 2c20 2275 6e69 6f6e 222c  right", "union",
+00055560: 2022 696e 7465 7273 6563 7469 6f6e 225d   "intersection"]
+00055570: 0a0a 6465 6620 6765 745f 616c 6c5f 726f  ..def get_all_ro
+00055580: 6973 286f 626a 733d 4e6f 6e65 293a 0a20  is(objs=None):. 
+00055590: 2020 2022 2222 0a20 2020 2043 7265 6174     """.    Creat
+000555a0: 6520 6c69 7374 206f 6620 524f 4973 2066  e list of ROIs f
+000555b0: 726f 6d20 6172 6269 7472 6172 7920 636f  rom arbitrary co
+000555c0: 6d62 696e 6174 696f 6e20 6f66 2052 4f49  mbination of ROI
+000555d0: 7320 616e 6420 5374 7275 6374 7572 6553  s and StructureS
+000555e0: 6574 732e 0a0a 2020 2020 2a2a 5061 7261  ets...    **Para
+000555f0: 6d65 7465 7273 3a2a 2a0a 0a20 2020 206f  meters:**..    o
+00055600: 626a 7320 3a20 524f 492f 5374 7275 6374  bjs : ROI/Struct
+00055610: 7572 6553 6574 2f6c 6973 742c 2064 6566  ureSet/list, def
+00055620: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00055630: 2020 4f62 6a65 6374 2873 2920 6672 6f6d    Object(s) from
+00055640: 2077 6869 6368 2061 206c 6973 7420 6f66   which a list of
+00055650: 2052 4f49 7320 6973 2074 6f20 6265 2063   ROIs is to be c
+00055660: 7265 6174 6564 2e20 2054 6865 0a20 2020  reated.  The.   
+00055670: 2020 2020 206f 626a 6563 7428 7329 2063       object(s) c
+00055680: 616e 2062 6520 6120 7369 6e67 6c65 2073  an be a single s
+00055690: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
+000556a0: 4f49 206f 626a 6563 742c 2061 2073 696e  OI object, a sin
+000556b0: 676c 650a 2020 2020 2020 2020 736b 7274  gle.        skrt
+000556c0: 2e73 7472 7563 7475 7265 732e 5374 7275  .structures.Stru
+000556d0: 6374 7572 6553 6574 206f 626a 6563 742c  ctureSet object,
+000556e0: 206f 7220 6120 6c69 7374 2063 6f6e 7461   or a list conta
+000556f0: 696e 696e 6720 616e 790a 2020 2020 2020  ining any.      
+00055700: 2020 636f 6d62 696e 6174 696f 6e20 6f66    combination of
+00055710: 2052 4f49 2061 6e64 2053 7472 7563 7475   ROI and Structu
+00055720: 7265 5365 7420 6f62 6a65 6374 732e 0a20  reSet objects.. 
+00055730: 2020 2022 2222 0a20 2020 2023 2045 6e73     """.    # Ens
+00055740: 7572 6520 7468 6174 206f 626a 7320 6973  ure that objs is
+00055750: 2061 206c 6973 740a 2020 2020 6966 2069   a list.    if i
+00055760: 7373 7562 636c 6173 7328 7479 7065 286f  ssubclass(type(o
+00055770: 626a 7329 2c20 2852 4f49 2c20 5374 7275  bjs), (ROI, Stru
+00055780: 6374 7572 6553 6574 2929 3a0a 2020 2020  ctureSet)):.    
+00055790: 2020 2020 6f62 6a73 203d 205b 6f62 6a73      objs = [objs
+000557a0: 5d0a 2020 2020 656c 6966 206f 626a 7320  ].    elif objs 
+000557b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000557c0: 206f 626a 7320 3d20 5b5d 0a0a 2020 2020   objs = []..    
+000557d0: 2320 4372 6561 7465 2061 206c 6973 7420  # Create a list 
+000557e0: 636f 6e74 6169 6e69 6e67 2061 6c6c 2075  containing all u
+000557f0: 6e69 7175 6520 726f 6973 2e0a 2020 2020  nique rois..    
+00055800: 616c 6c5f 726f 6973 203d 205b 5d0a 2020  all_rois = [].  
+00055810: 2020 666f 7220 6974 656d 2069 6e20 6f62    for item in ob
+00055820: 6a73 3a0a 2020 2020 2020 2020 6966 2069  js:.        if i
+00055830: 7373 7562 636c 6173 7328 7479 7065 2869  ssubclass(type(i
+00055840: 7465 6d29 2c20 524f 4929 3a0a 2020 2020  tem), ROI):.    
+00055850: 2020 2020 2020 2020 6361 6e64 6964 6174          candidat
+00055860: 655f 726f 6973 203d 205b 6974 656d 5d0a  e_rois = [item].
+00055870: 2020 2020 2020 2020 656c 6966 2069 7373          elif iss
+00055880: 7562 636c 6173 7328 7479 7065 2869 7465  ubclass(type(ite
+00055890: 6d29 2c20 5374 7275 6374 7572 6553 6574  m), StructureSet
+000558a0: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+000558b0: 616e 6469 6461 7465 5f72 6f69 7320 3d20  andidate_rois = 
+000558c0: 6974 656d 2e67 6574 5f72 6f69 7328 290a  item.get_rois().
+000558d0: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
+000558e0: 696e 2063 616e 6469 6461 7465 5f72 6f69  in candidate_roi
+000558f0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00055900: 6620 6e6f 7420 726f 6920 696e 2061 6c6c  f not roi in all
+00055910: 5f72 6f69 733a 0a20 2020 2020 2020 2020  _rois:.         
+00055920: 2020 2020 2020 2061 6c6c 5f72 6f69 732e         all_rois.
+00055930: 6170 7065 6e64 2872 6f69 290a 0a20 2020  append(roi)..   
+00055940: 2072 6574 7572 6e20 616c 6c5f 726f 6973   return all_rois
+00055950: 0a0a 6465 6620 6765 745f 7472 616e 736c  ..def get_transl
+00055960: 6174 696f 6e5f 746f 5f61 6c69 676e 2872  ation_to_align(r
+00055970: 6f69 312c 2072 6f69 322c 207a 5f66 7261  oi1, roi2, z_fra
+00055980: 6374 696f 6e31 3d4e 6f6e 652c 207a 5f66  ction1=None, z_f
+00055990: 7261 6374 696f 6e32 3d4e 6f6e 6529 3a0a  raction2=None):.
+000559a0: 2020 2020 2222 220a 2020 2020 4465 7465      """.    Dete
+000559b0: 726d 696e 6520 7472 616e 736c 6174 696f  rmine translatio
+000559c0: 6e20 666f 7220 616c 6967 6e69 6e67 203c  n for aligning <
+000559d0: 726f 6931 3e20 746f 203c 726f 6932 3e2e  roi1> to <roi2>.
+000559e0: 0a0a 2020 2020 2a2a 5061 7261 6d65 7465  ..    **Paramete
+000559f0: 7273 3a2a 2a0a 0a20 2020 2072 6f69 3120  rs:**..    roi1 
+00055a00: 3a20 524f 492f 5374 7275 6374 7572 6553  : ROI/StructureS
+00055a10: 6574 2f6c 6973 740a 2020 2020 2020 2020  et/list.        
+00055a20: 524f 4920 7468 6174 2069 7320 746f 2062  ROI that is to b
+00055a30: 6520 7472 616e 736c 6174 696f 6e20 746f  e translation to
+00055a40: 2061 6368 6965 7665 2074 6865 2061 6c69   achieve the ali
+00055a50: 676e 6d65 6e74 2e20 2054 6869 730a 2020  gnment.  This.  
+00055a60: 2020 2020 2020 6361 6e20 6265 2073 7065        can be spe
+00055a70: 6369 6669 6564 2064 6972 6563 746c 7920  cified directly 
+00055a80: 6173 2061 2073 696e 676c 6520 524f 492e  as a single ROI.
+00055a90: 2020 416c 7465 726e 6174 6976 656c 792c    Alternatively,
+00055aa0: 0a20 2020 2020 2020 2069 7420 6361 6e20  .        it can 
+00055ab0: 6265 2061 2053 7472 7563 7475 7265 5365  be a StructureSe
+00055ac0: 742c 206f 7220 6120 6c69 7374 206f 7220  t, or a list or 
+00055ad0: 524f 492f 5374 7275 6374 7572 6553 6574  ROI/StructureSet
+00055ae0: 206f 626a 6563 7473 2c0a 2020 2020 2020   objects,.      
+00055af0: 2020 696e 2077 6869 6368 2063 6173 6520    in which case 
+00055b00: 7468 6520 696e 6469 7669 6475 616c 2052  the individual R
+00055b10: 4f49 7320 7769 6c6c 2062 6520 636f 6d62  OIs will be comb
+00055b20: 696e 6564 2e0a 0a20 2020 2072 6f69 3220  ined...    roi2 
+00055b30: 3a20 524f 492f 5374 7275 6374 7572 6553  : ROI/StructureS
+00055b40: 6574 2f6c 6973 740a 2020 2020 2020 2020  et/list.        
+00055b50: 524f 4920 7769 7468 2077 6869 6368 2061  ROI with which a
+00055b60: 6c69 676e 6d65 6e74 2069 7320 746f 2062  lignment is to b
+00055b70: 6520 7065 7266 6f72 6d65 642e 2020 5468  e performed.  Th
+00055b80: 6973 2063 616e 2062 650a 2020 2020 2020  is can be.      
+00055b90: 2020 7370 6563 6966 6965 6420 6469 7265    specified dire
+00055ba0: 6374 6c79 2061 7320 6120 7369 6e67 6c65  ctly as a single
+00055bb0: 2052 4f49 2e20 2041 6c74 6572 6e61 7469   ROI.  Alternati
+00055bc0: 7665 6c79 2c20 6974 2063 616e 0a20 2020  vely, it can.   
+00055bd0: 2020 2020 2062 6520 6120 5374 7275 6374       be a Struct
+00055be0: 7572 6553 6574 2c20 6f72 2061 206c 6973  ureSet, or a lis
+00055bf0: 7420 6f72 2052 4f49 2f53 7472 7563 7475  t or ROI/Structu
+00055c00: 7265 5365 7420 6f62 6a65 6374 732c 0a20  reSet objects,. 
+00055c10: 2020 2020 2020 2069 6e20 7768 6963 6820         in which 
+00055c20: 6361 7365 2074 6865 2069 6e64 6976 6964  case the individ
+00055c30: 7561 6c20 524f 4973 2077 696c 6c20 6265  ual ROIs will be
+00055c40: 2063 6f6d 6269 6e65 642e 0a0a 2020 2020   combined...    
+00055c50: 7a5f 6672 6163 7469 6f6e 3120 3a20 666c  z_fraction1 : fl
+00055c60: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
+00055c70: 650a 2020 2020 2020 2020 506f 7369 7469  e.        Positi
+00055c80: 6f6e 2061 6c6f 6e67 207a 2061 7869 7320  on along z axis 
+00055c90: 6f66 2073 6c69 6365 2074 6872 6f75 6768  of slice through
+00055ca0: 203c 726f 6931 3e20 6f6e 2077 6869 6368   <roi1> on which
+00055cb0: 0a20 2020 2020 2020 2074 6f20 616c 6967  .        to alig
+00055cc0: 6e2e 2020 4966 204e 6f6e 652c 2061 6c69  n.  If None, ali
+00055cd0: 676e 6d65 6e74 2069 7320 746f 2074 6865  gnment is to the
+00055ce0: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
+00055cf0: 0a20 2020 2020 2020 2077 686f 6c65 2052  .        whole R
+00055d00: 4f49 2076 6f6c 756d 652e 2020 4f74 6865  OI volume.  Othe
+00055d10: 7277 6973 652c 2061 6c69 676e 6d65 6e74  rwise, alignment
+00055d20: 2069 7320 746f 2074 6865 0a20 2020 2020   is to the.     
+00055d30: 2020 2063 656e 7472 6f69 6420 6f66 2074     centroid of t
+00055d40: 6865 2073 6c69 6365 2061 7420 7468 6520  he slice at the 
+00055d50: 7370 6563 6966 6965 6420 6469 7374 616e  specified distan
+00055d60: 6365 0a20 2020 2020 2020 2066 726f 6d20  ce.        from 
+00055d70: 7468 6520 524f 4927 7320 6d6f 7374 2d69  the ROI's most-i
+00055d80: 6e66 6572 696f 7220 706f 696e 743a 2030  nferior point: 0
+00055d90: 2063 6f72 7265 7370 6f6e 6473 2074 6f0a   corresponds to.
+00055da0: 2020 2020 2020 2020 7468 6520 6d6f 7374          the most
+00055db0: 2d69 6e66 6572 696f 7220 706f 696e 7420  -inferior point 
+00055dc0: 286c 6f77 6573 7420 7a29 3b20 3120 636f  (lowest z); 1 co
+00055dd0: 7272 6573 706f 6e64 7320 746f 2074 6865  rresponds to the
+00055de0: 0a20 2020 2020 2020 206d 6f73 742d 7375  .        most-su
+00055df0: 7065 7269 6f72 2070 6f69 6e74 2028 6869  perior point (hi
+00055e00: 6768 6573 7420 7a29 2e20 2056 616c 7565  ghest z).  Value
+00055e10: 7320 666f 7220 7a5f 6672 6163 7469 6f6e  s for z_fraction
+00055e20: 0a20 2020 2020 2020 206f 7574 7369 6465  .        outside
+00055e30: 2074 6865 2069 6e74 6572 7661 6c20 5b30   the interval [0
+00055e40: 2c20 315d 2072 6573 756c 7420 696e 2061  , 1] result in a
+00055e50: 2052 756e 7469 6d65 4572 726f 722e 0a0a   RuntimeError...
+00055e60: 2020 2020 7a5f 6672 6163 7469 6f6e 3220      z_fraction2 
+00055e70: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00055e80: 3d4e 6f6e 650a 2020 2020 2020 2020 506f  =None.        Po
+00055e90: 7369 7469 6f6e 2061 6c6f 6e67 207a 2061  sition along z a
+00055ea0: 7869 7320 6f66 2073 6c69 6365 2074 6872  xis of slice thr
+00055eb0: 6f75 6768 203c 726f 6932 3e20 6f6e 2077  ough <roi2> on w
+00055ec0: 6869 6368 0a20 2020 2020 2020 2074 6f20  hich.        to 
+00055ed0: 616c 6967 6e2e 2020 4966 204e 6f6e 652c  align.  If None,
+00055ee0: 2061 6c69 676e 6d65 6e74 2069 7320 746f   alignment is to
+00055ef0: 2074 6865 2063 656e 7472 6f69 6420 6f66   the centroid of
+00055f00: 2074 6865 0a20 2020 2020 2020 2077 686f   the.        who
+00055f10: 6c65 2052 4f49 2076 6f6c 756d 652e 2020  le ROI volume.  
+00055f20: 4f74 6865 7277 6973 652c 2061 6c69 676e  Otherwise, align
+00055f30: 6d65 6e74 2069 7320 746f 2074 6865 0a20  ment is to the. 
+00055f40: 2020 2020 2020 2063 656e 7472 6f69 6420         centroid 
+00055f50: 6f66 2074 6865 2073 6c69 6365 2061 7420  of the slice at 
+00055f60: 7468 6520 7370 6563 6966 6965 6420 6469  the specified di
+00055f70: 7374 616e 6365 0a20 2020 2020 2020 2066  stance.        f
+00055f80: 726f 6d20 7468 6520 524f 4927 7320 6d6f  rom the ROI's mo
+00055f90: 7374 2d69 6e66 6572 696f 7220 706f 696e  st-inferior poin
+00055fa0: 743a 2030 2063 6f72 7265 7370 6f6e 6473  t: 0 corresponds
+00055fb0: 2074 6f0a 2020 2020 2020 2020 7468 6520   to.        the 
+00055fc0: 6d6f 7374 2d69 6e66 6572 696f 7220 706f  most-inferior po
+00055fd0: 696e 7420 286c 6f77 6573 7420 7a29 3b20  int (lowest z); 
+00055fe0: 3120 636f 7272 6573 706f 6e64 7320 746f  1 corresponds to
+00055ff0: 2074 6865 0a20 2020 2020 2020 206d 6f73   the.        mos
+00056000: 742d 7375 7065 7269 6f72 2070 6f69 6e74  t-superior point
+00056010: 2028 6869 6768 6573 7420 7a29 2e20 2056   (highest z).  V
+00056020: 616c 7565 7320 666f 7220 7a5f 6672 6163  alues for z_frac
+00056030: 7469 6f6e 0a20 2020 2020 2020 206f 7574  tion.        out
+00056040: 7369 6465 2074 6865 2069 6e74 6572 7661  side the interva
+00056050: 6c20 5b30 2c20 315d 2072 6573 756c 7420  l [0, 1] result 
+00056060: 696e 2061 2052 756e 7469 6d65 4572 726f  in a RuntimeErro
+00056070: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
+00056080: 2020 2023 2043 7265 6174 6520 6c69 7374     # Create list
+00056090: 206f 6620 7477 6f20 7369 6e67 6c65 2052   of two single R
+000560a0: 4f49 732e 0a20 2020 2072 6f69 7320 3d20  OIs..    rois = 
+000560b0: 5b5d 0a20 2020 2066 6f72 2072 6f69 2069  [].    for roi i
+000560c0: 6e20 5b72 6f69 312c 2072 6f69 325d 3a0a  n [roi1, roi2]:.
+000560d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000560e0: 7461 6e63 6528 726f 692c 2052 4f49 293a  tance(roi, ROI):
+000560f0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00056100: 746f 7265 2073 696e 676c 6520 524f 4920  tore single ROI 
+00056110: 6469 7265 6374 6c79 2e0a 2020 2020 2020  directly..      
+00056120: 2020 2020 2020 726f 6973 2e61 7070 656e        rois.appen
+00056130: 6428 726f 6929 0a20 2020 2020 2020 2065  d(roi).        e
+00056140: 6c69 6620 6973 696e 7374 616e 6365 2872  lif isinstance(r
+00056150: 6f69 2c20 5374 7275 6374 7572 6553 6574  oi, StructureSet
+00056160: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+00056170: 2043 6f6d 6269 6e65 2052 4f49 7320 6f66   Combine ROIs of
+00056180: 2053 7472 7563 7475 7265 5365 742e 0a20   StructureSet.. 
+00056190: 2020 2020 2020 2020 2020 2072 6f69 732e             rois.
+000561a0: 6170 7065 6e64 2872 6f69 2e63 6f6d 6269  append(roi.combi
+000561b0: 6e65 5f72 6f69 7328 2929 0a20 2020 2020  ne_rois()).     
+000561c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000561d0: 2020 2020 2023 2043 6f6d 6269 6e65 2052       # Combine R
+000561e0: 4f49 7320 6672 6f6d 206c 6973 742e 0a20  OIs from list.. 
+000561f0: 2020 2020 2020 2020 2020 2072 6f69 732e             rois.
+00056200: 6170 7065 6e64 2853 7472 7563 7475 7265  append(Structure
+00056210: 5365 7428 6765 745f 616c 6c5f 726f 6973  Set(get_all_rois
+00056220: 2872 6f69 2929 2e63 6f6d 6269 6e65 5f72  (roi)).combine_r
+00056230: 6f69 7328 2929 0a0a 2020 2020 2320 4361  ois())..    # Ca
+00056240: 6c63 756c 6174 6520 616c 6967 6e6d 656e  lculate alignmen
+00056250: 7420 706f 696e 7473 2e0a 2020 2020 6365  t points..    ce
+00056260: 6e74 726f 6964 7320 3d20 5b5d 0a20 2020  ntroids = [].   
+00056270: 2066 6f72 2072 6f69 2c20 7a5f 6672 6163   for roi, z_frac
+00056280: 7469 6f6e 2069 6e20 7a69 7028 726f 6973  tion in zip(rois
+00056290: 2c20 5b7a 5f66 7261 6374 696f 6e31 2c20  , [z_fraction1, 
+000562a0: 7a5f 6672 6163 7469 6f6e 325d 293a 0a20  z_fraction2]):. 
+000562b0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
+000562c0: 7465 2063 656e 7472 6f69 6420 666f 7220  te centroid for 
+000562d0: 7468 6520 7768 6f6c 6520 524f 4920 766f  the whole ROI vo
+000562e0: 6c75 6d65 2e0a 2020 2020 2020 2020 6966  lume..        if
+000562f0: 207a 5f66 7261 6374 696f 6e20 6973 204e   z_fraction is N
+00056300: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00056310: 2063 656e 7472 6f69 6473 2e61 7070 656e   centroids.appen
+00056320: 6428 726f 692e 6765 745f 6365 6e74 726f  d(roi.get_centro
+00056330: 6964 2829 290a 2020 2020 2020 2020 2320  id()).        # 
+00056340: 4361 6c63 756c 6174 6520 6365 6e74 726f  Calculate centro
+00056350: 6964 2066 6f72 2073 6c69 6365 2061 7420  id for slice at 
+00056360: 7370 6563 6966 6965 6420 706f 7369 7469  specified positi
+00056370: 6f6e 2e0a 2020 2020 2020 2020 656c 7365  on..        else
+00056380: 3a0a 2020 2020 2020 2020 2020 2020 6365  :.            ce
+00056390: 6e74 726f 6964 732e 6170 7065 6e64 2872  ntroids.append(r
+000563a0: 6f69 2e67 6574 5f72 6f69 5f73 6c69 6365  oi.get_roi_slice
+000563b0: 287a 5f66 7261 6374 696f 6e29 2e67 6574  (z_fraction).get
+000563c0: 5f63 656e 7472 6f69 6428 2929 0a0a 2020  _centroid())..  
+000563d0: 2020 7265 7475 726e 2074 7570 6c65 2863    return tuple(c
+000563e0: 656e 7472 6f69 6473 5b31 5d20 2d20 6365  entroids[1] - ce
+000563f0: 6e74 726f 6964 735b 305d 290a 0a64 6566  ntroids[0])..def
+00056400: 2067 6574 5f73 6c69 6365 5f70 6f73 6974   get_slice_posit
+00056410: 696f 6e73 2872 6f69 312c 2072 6f69 323d  ions(roi1, roi2=
+00056420: 4e6f 6e65 2c20 7669 6577 3d22 782d 7922  None, view="x-y"
+00056430: 2c20 706f 7369 7469 6f6e 5f61 735f 6964  , position_as_id
+00056440: 783d 4661 6c73 652c 0a20 2020 2020 2020  x=False,.       
+00056450: 206d 6574 686f 643d 4e6f 6e65 293a 0a20   method=None):. 
+00056460: 2020 2022 2222 0a20 2020 2047 6574 206f     """.    Get o
+00056470: 7264 6572 6564 206c 6973 7420 6f66 2073  rdered list of s
+00056480: 6c69 6365 2070 6f73 6974 696f 6e73 2066  lice positions f
+00056490: 6f72 2065 6974 6865 7220 6f72 2062 6f74  or either or bot
+000564a0: 6820 6f66 2061 2070 6169 7220 6f66 2052  h of a pair of R
+000564b0: 4f49 732e 0a0a 2020 2020 2a2a 5061 7261  OIs...    **Para
+000564c0: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2072  meters:**..    r
+000564d0: 6f69 3120 3a20 736b 7274 2e73 7472 7563  oi1 : skrt.struc
+000564e0: 7475 7265 732e 524f 490a 2020 2020 2020  tures.ROI.      
+000564f0: 2020 524f 492c 206f 7220 6f6e 6520 6f66    ROI, or one of
+00056500: 2061 2070 6169 7220 6f66 2052 4f49 732c   a pair of ROIs,
+00056510: 2066 6f72 2077 6869 6368 2073 6c69 6365   for which slice
+00056520: 2069 6e66 6f72 6d61 7469 6f6e 2069 7320   information is 
+00056530: 746f 0a20 2020 2020 2020 2062 6520 6f62  to.        be ob
+00056540: 7461 696e 6564 2e0a 0a20 2020 2072 6f69  tained...    roi
+00056550: 3220 3a20 736b 7274 2e73 7472 7563 7475  2 : skrt.structu
+00056560: 7265 732e 524f 492c 2064 6566 6175 6c74  res.ROI, default
+00056570: 3d4e 6f6e 650a 2020 2020 2020 2020 4966  =None.        If
+00056580: 206e 6f74 204e 6f6e 652c 2073 6563 6f6e   not None, secon
+00056590: 6420 696e 2061 2070 6169 7220 6f66 2052  d in a pair of R
+000565a0: 4f49 7320 666f 7220 7768 6963 6820 736c  OIs for which sl
+000565b0: 6963 6520 696e 666f 726d 6174 696f 6e0a  ice information.
+000565c0: 2020 2020 2020 2020 6973 2074 6f20 6265          is to be
+000565d0: 206f 6274 6169 6e65 642e 0a0a 2020 2020   obtained...    
+000565e0: 7669 6577 203a 2073 7472 2c20 6465 6661  view : str, defa
+000565f0: 756c 743d 2278 2d79 220a 2020 2020 2020  ult="x-y".      
+00056600: 2020 5669 6577 2069 6e20 7768 6963 6820    View in which 
+00056610: 746f 206f 6274 6169 6e20 736c 6963 6573  to obtain slices
+00056620: 2e0a 0a20 2020 2070 6f73 6974 696f 6e5f  ...    position_
+00056630: 6173 5f69 6478 203a 2062 6f6f 6c2c 2064  as_idx : bool, d
+00056640: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+00056650: 2020 2020 2049 6620 5472 7565 2c20 7265       If True, re
+00056660: 7475 726e 2070 6f73 6974 696f 6e73 2061  turn positions a
+00056670: 7320 736c 6963 6520 696e 6469 6365 733b  s slice indices;
+00056680: 2069 6620 4661 6c73 652c 0a20 2020 2020   if False,.     
+00056690: 2020 2072 6574 7572 6e20 706f 7369 7469     return positi
+000566a0: 6f6e 7320 6173 2073 6c69 6365 207a 2d63  ons as slice z-c
+000566b0: 6f6f 7264 696e 6174 6573 2028 6d6d 292e  oordinates (mm).
+000566c0: 0a0a 2020 2020 6d65 7468 6f64 3a20 7374  ..    method: st
+000566d0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+000566e0: 2020 2020 2020 2020 5374 7269 6e67 2073          String s
+000566f0: 7065 6369 6679 696e 6720 736c 6963 6573  pecifying slices
+00056700: 2066 6f72 2077 6869 6368 2070 6f73 6974   for which posit
+00056710: 696f 6e73 2061 7265 2074 6f20 6265 206f  ions are to be o
+00056720: 6274 6169 6e65 642c 0a20 2020 2020 2020  btained,.       
+00056730: 2066 6f72 2052 4f49 7320 726f 6931 2c20   for ROIs roi1, 
+00056740: 726f 6932 3a0a 0a20 2020 2020 2020 202d  roi2:..        -
+00056750: 2022 6c65 6674 2220 286f 7220 726f 6932   "left" (or roi2
+00056760: 2069 7320 4e6f 6e65 293a 2072 6574 7572   is None): retur
+00056770: 6e20 706f 7369 7469 6f6e 7320 6f66 2073  n positions of s
+00056780: 6c69 6365 7320 636f 6e74 6169 6e69 6e67  lices containing
+00056790: 2072 6f69 313b 0a20 2020 2020 2020 202d   roi1;.        -
+000567a0: 2022 7269 6768 7422 3a20 7265 7475 726e   "right": return
+000567b0: 2070 6f73 6974 696f 6e73 206f 6620 736c   positions of sl
+000567c0: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+000567d0: 726f 6932 3b0a 2020 2020 2020 2020 2d20  roi2;.        - 
+000567e0: 2275 6e69 6f6e 223a 2072 6574 7572 6e20  "union": return 
+000567f0: 706f 7369 7469 6f6e 7320 6f66 2073 6c69  positions of sli
+00056800: 6365 7320 636f 6e74 6169 6e69 6e67 2065  ces containing e
+00056810: 6974 6865 7220 726f 6931 206f 7220 726f  ither roi1 or ro
+00056820: 6932 3b0a 2020 2020 2020 2020 2d20 2269  i2;.        - "i
+00056830: 6e74 6572 7365 6374 696f 6e22 3a20 7265  ntersection": re
+00056840: 7475 726e 2070 6f73 6974 696f 6e73 206f  turn positions o
+00056850: 6620 736c 6963 6573 2063 6f6e 7461 696e  f slices contain
+00056860: 696e 6720 626f 7468 0a20 2020 2020 2020  ing both.       
+00056870: 2020 2072 6f69 3120 616e 6420 726f 6932     roi1 and roi2
+00056880: 2e0a 0a20 2020 2020 2020 2049 6620 4e6f  ...        If No
+00056890: 6e65 2c20 7661 6c75 6520 6f66 2073 6b72  ne, value of skr
+000568a0: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
+000568b0: 292e 6279 5f73 6c69 6365 2069 7320 7573  ).by_slice is us
+000568c0: 6564 2e0a 2020 2020 2222 220a 2020 2020  ed..    """.    
+000568d0: 6d65 7468 6f64 203d 206d 6574 686f 6420  method = method 
+000568e0: 6f72 2073 6b72 742e 636f 7265 2e44 6566  or skrt.core.Def
+000568f0: 6175 6c74 7328 292e 6279 5f73 6c69 6365  aults().by_slice
+00056900: 0a20 2020 2069 6620 6d65 7468 6f64 206e  .    if method n
+00056910: 6f74 2069 6e20 6765 745f 6279 5f73 6c69  ot in get_by_sli
+00056920: 6365 5f6d 6574 686f 6473 2829 3a0a 2020  ce_methods():.  
+00056930: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
+00056940: 696d 6545 7272 6f72 2866 224d 6574 686f  imeError(f"Metho
+00056950: 6420 6d75 7374 2062 6520 6f6e 6520 6f66  d must be one of
+00056960: 207b 6765 745f 6279 5f73 6c69 6365 5f6d   {get_by_slice_m
+00056970: 6574 686f 6473 2829 7d22 0a20 2020 2020  ethods()}".     
+00056980: 2020 2022 202d 206e 6f74 2027 7b6d 6574     " - not '{met
+00056990: 686f 647d 2722 290a 0a20 2020 2069 6e64  hod}'")..    ind
+000569a0: 6963 6573 203d 204e 6f6e 650a 0a20 2020  ices = None..   
+000569b0: 2069 6e64 6963 6573 3120 3d20 726f 6931   indices1 = roi1
+000569c0: 2e67 6574 5f69 6e64 6963 6573 2876 6965  .get_indices(vie
+000569d0: 773d 7669 6577 2c20 6d65 7468 6f64 3d22  w=view, method="
+000569e0: 6d61 736b 2229 0a20 2020 2069 6620 6e6f  mask").    if no
+000569f0: 7420 6973 7375 6263 6c61 7373 2874 7970  t issubclass(typ
+00056a00: 6528 726f 6932 292c 2052 4f49 2920 6f72  e(roi2), ROI) or
+00056a10: 2022 6c65 6674 2220 3d3d 206d 6574 686f   "left" == metho
+00056a20: 643a 0a20 2020 2020 2020 2069 6e64 6963  d:.        indic
+00056a30: 6573 203d 2069 6e64 6963 6573 310a 0a20  es = indices1.. 
+00056a40: 2020 2069 6620 696e 6469 6365 7320 6973     if indices is
+00056a50: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+00056a60: 6e64 6963 6573 3220 3d20 726f 6932 2e67  ndices2 = roi2.g
+00056a70: 6574 5f69 6e64 6963 6573 2876 6965 773d  et_indices(view=
+00056a80: 7669 6577 2c20 6d65 7468 6f64 3d22 6d61  view, method="ma
+00056a90: 736b 2229 0a20 2020 2020 2020 2069 6620  sk").        if 
+00056aa0: 2272 6967 6874 2220 3d3d 206d 6574 686f  "right" == metho
+00056ab0: 643a 0a20 2020 2020 2020 2020 2020 2069  d:.            i
+00056ac0: 6e64 6963 6573 203d 2069 6e64 6963 6573  ndices = indices
+00056ad0: 320a 2020 2020 2020 2020 0a20 2020 2069  2.        .    i
+00056ae0: 6620 696e 6469 6365 7320 6973 204e 6f6e  f indices is Non
+00056af0: 653a 0a20 2020 2020 2020 2069 6620 2275  e:.        if "u
+00056b00: 6e69 6f6e 2220 3d3d 206d 6574 686f 643a  nion" == method:
+00056b10: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+00056b20: 6963 6573 203d 206c 6973 7428 7365 7428  ices = list(set(
+00056b30: 696e 6469 6365 7331 292e 756e 696f 6e28  indices1).union(
+00056b40: 7365 7428 696e 6469 6365 7332 2929 290a  set(indices2))).
+00056b50: 0a20 2020 2069 6620 696e 6469 6365 7320  .    if indices 
+00056b60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00056b70: 2069 6620 2269 6e74 6572 7365 6374 696f   if "intersectio
+00056b80: 6e22 203d 3d20 6d65 7468 6f64 3a0a 2020  n" == method:.  
+00056b90: 2020 2020 2020 2020 2020 696e 6469 6365            indice
+00056ba0: 7320 3d20 6c69 7374 2873 6574 2869 6e64  s = list(set(ind
+00056bb0: 6963 6573 3129 2e69 6e74 6572 7365 6374  ices1).intersect
+00056bc0: 696f 6e28 7365 7428 696e 6469 6365 7332  ion(set(indices2
+00056bd0: 2929 290a 0a20 2020 2069 6620 696e 6469  )))..    if indi
+00056be0: 6365 7320 6973 206e 6f74 204e 6f6e 653a  ces is not None:
+00056bf0: 0a20 2020 2020 2020 2069 6620 706f 7369  .        if posi
+00056c00: 7469 6f6e 5f61 735f 6964 783a 0a20 2020  tion_as_idx:.   
+00056c10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00056c20: 736f 7274 6564 2869 6e64 6963 6573 290a  sorted(indices).
+00056c30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00056c40: 2020 2020 2020 2020 2020 6178 203d 2073            ax = s
+00056c50: 6b72 742e 696d 6167 652e 5f73 6c69 6365  krt.image._slice
+00056c60: 5f61 7865 735b 7669 6577 5d0a 2020 2020  _axes[view].    
+00056c70: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00056c80: 6f72 7465 6428 5b72 6f69 312e 6964 785f  orted([roi1.idx_
+00056c90: 746f 5f70 6f73 2869 6478 2c20 6178 2920  to_pos(idx, ax) 
+00056ca0: 666f 7220 6964 7820 696e 2069 6e64 6963  for idx in indic
+00056cb0: 6573 5d29 0a0a 6465 6620 6578 7061 6e64  es])..def expand
+00056cc0: 5f73 6c69 6365 5f73 7461 7473 2873 6c69  _slice_stats(sli
+00056cd0: 6365 5f73 7461 7473 3d4e 6f6e 652c 2064  ce_stats=None, d
+00056ce0: 6566 6175 6c74 5f62 795f 736c 6963 653d  efault_by_slice=
+00056cf0: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
+00056d00: 2020 2045 7870 616e 6420 7370 6563 6966     Expand specif
+00056d10: 6963 6174 696f 6e20 6f66 2073 7461 7469  ication of stati
+00056d20: 7374 6963 7320 746f 2063 616c 6375 6c61  stics to calcula
+00056d30: 7465 2066 6f72 2052 4f49 2063 6f6d 7061  te for ROI compa
+00056d40: 7269 736f 6e0a 2020 2020 6d65 7472 6963  rison.    metric
+00056d50: 7320 6576 616c 7561 7465 6420 736c 6963  s evaluated slic
+00056d60: 6520 6279 2073 6c69 6365 2e0a 0a20 2020  e by slice...   
+00056d70: 2041 2064 6963 7469 6f6e 6172 7920 6973   A dictionary is
+00056d80: 2072 6574 7572 6e65 642c 2077 6865 7265   returned, where
+00056d90: 206b 6579 7320 6769 7665 2074 6865 2073   keys give the s
+00056da0: 6c69 6365 7320 746f 2062 6520 636f 6e73  lices to be cons
+00056db0: 6964 6572 6564 0a20 2020 2066 6f72 2063  idered.    for c
+00056dc0: 616c 6375 6c61 7469 6e67 2073 7461 7469  alculating stati
+00056dd0: 7374 6963 732c 2061 6e64 2076 616c 7565  stics, and value
+00056de0: 7320 6172 6520 6c69 7374 7320 6f66 206d  s are lists of m
+00056df0: 6574 7269 6373 2e0a 0a20 2020 202a 2a50  etrics...    **P
+00056e00: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
+00056e10: 2020 736c 6963 655f 7374 6174 7320 3a20    slice_stats : 
+00056e20: 7374 722f 6c69 7374 2f64 6963 742c 2064  str/list/dict, d
+00056e30: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00056e40: 2020 2020 5370 6563 6966 6963 6174 696f      Specificatio
+00056e50: 6e20 6f66 2073 7461 7469 7374 6963 7320  n of statistics 
+00056e60: 746f 2062 6520 6361 6c63 756c 6174 6564  to be calculated
+00056e70: 2072 656c 6174 6976 650a 2020 2020 2020   relative.      
+00056e80: 2020 746f 2073 6c69 6365 2d62 792d 736c    to slice-by-sl
+00056e90: 6963 6520 6d65 7472 6963 2076 616c 7565  ice metric value
+00056ea0: 732e 0a0a 2020 2020 2020 2020 4120 7374  s...        A st
+00056eb0: 6174 6973 7469 6320 6973 2073 7065 6369  atistic is speci
+00056ec0: 6669 6564 2062 7920 7468 6520 6e61 6d65  fied by the name
+00056ed0: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+00056ee0: 2066 6f72 0a20 2020 2020 2020 2069 7473   for.        its
+00056ef0: 2063 616c 6375 6c61 7469 6f6e 2069 6e20   calculation in 
+00056f00: 7468 6520 5079 7468 6f6e 2073 7461 7469  the Python stati
+00056f10: 7374 6963 7320 6d6f 6475 6c65 3a0a 0a20  stics module:.. 
+00056f20: 2020 2020 2020 2068 7474 7073 3a2f 2f64         https://d
+00056f30: 6f63 732e 7079 7468 6f6e 2e6f 7267 2f33  ocs.python.org/3
+00056f40: 2f6c 6962 7261 7279 2f73 7461 7469 7374  /library/statist
+00056f50: 6963 732e 6874 6d6c 0a0a 2020 2020 2020  ics.html..      
+00056f60: 2020 466f 7220 6974 7320 7573 6520 6865    For its use he
+00056f70: 7265 2c20 7468 6520 7265 6c65 7661 6e74  re, the relevant
+00056f80: 2066 756e 6374 696f 6e20 6d75 7374 2072   function must r
+00056f90: 6571 7569 7265 0a20 2020 2020 2020 2061  equire.        a
+00056fa0: 2073 696e 676c 652d 7661 7269 6162 6c65   single-variable
+00056fb0: 2069 6e70 7574 2c20 6d75 7374 206e 6f74   input, must not
+00056fc0: 2072 6571 7569 7265 2061 6e79 206b 6579   require any key
+00056fd0: 776f 7264 0a20 2020 2020 2020 2061 7267  word.        arg
+00056fe0: 756d 656e 7473 2c20 616e 6420 6d75 7374  uments, and must
+00056ff0: 2072 6574 7572 6e20 6120 7369 6e67 6c65   return a single
+00057000: 206e 756d 6265 722e 0a0a 2020 2020 2020   number...      
+00057010: 2020 4176 6169 6c61 626c 6520 6f70 7469    Available opti
+00057020: 6f6e 7320 696e 636c 7564 653a 2022 6d65  ons include: "me
+00057030: 616e 222c 2022 6d65 6469 616e 222c 2022  an", "median", "
+00057040: 6d6f 6465 222c 0a20 2020 2020 2020 2022  mode",.        "
+00057050: 7374 6465 7622 2e0a 0a20 2020 2020 2020  stdev"...       
+00057060: 5374 6174 6973 7469 6373 2074 6f20 6265  Statistics to be
+00057070: 2063 616c 6375 6c61 7465 6420 6361 6e20   calculated can 
+00057080: 6265 2073 7065 6369 6669 6564 2075 7369  be specified usi
+00057090: 6e67 2061 6e79 206f 660a 2020 2020 2020  ng any of.      
+000570a0: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
+000570b0: 0a20 2020 2020 2020 2d20 5374 7269 6e67  .       - String
+000570c0: 2073 7065 6369 6679 696e 6720 7369 6e67   specifying sing
+000570d0: 6c65 2073 7461 7469 7374 6963 2074 6f20  le statistic to 
+000570e0: 6265 2063 616c 6375 6c61 7465 642c 0a20  be calculated,. 
+000570f0: 2020 2020 2020 2020 7769 7468 2073 6c69          with sli
+00057100: 6365 7320 636f 6e73 6964 6572 6564 2061  ces considered a
+00057110: 7320 6769 7665 6e20 6279 203c 6465 6661  s given by <defa
+00057120: 756c 745f 6279 5f73 6c69 6365 3e2c 0a20  ult_by_slice>,. 
+00057130: 2020 2020 2020 2020 666f 7220 6578 616d          for exam
+00057140: 706c 653a 2022 6d65 616e 223b 0a20 2020  ple: "mean";.   
+00057150: 2020 2020 2d20 4c69 7374 2073 7065 6369      - List speci
+00057160: 6679 696e 6720 6d75 6c74 6970 6c65 2073  fying multiple s
+00057170: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+00057180: 6361 6c63 756c 6174 6564 2c0a 2020 2020  calculated,.    
+00057190: 2020 2020 2077 6974 6820 736c 6963 6573       with slices
+000571a0: 2063 6f6e 7369 6465 7265 6420 6173 2067   considered as g
+000571b0: 6976 656e 2062 7920 3c64 6566 6175 6c74  iven by <default
+000571c0: 5f62 795f 736c 6963 653e 2c0a 2020 2020  _by_slice>,.    
+000571d0: 2020 2020 2066 6f72 2065 7861 6d70 6c65       for example
+000571e0: 3a20 5b22 6d65 616e 222c 2022 7374 6465  : ["mean", "stde
+000571f0: 7622 5d3b 0a20 2020 2020 2020 2d20 4469  v"];.       - Di
+00057200: 6374 696f 6e61 7279 2077 6865 7265 206b  ctionary where k
+00057210: 6579 7320 7370 6563 6966 7920 736c 6963  eys specify slic
+00057220: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
+00057230: 7265 642c 0a20 2020 2020 2020 2020 616e  red,.         an
+00057240: 6420 7661 6c75 6573 2073 7065 6369 6679  d values specify
+00057250: 2073 7461 7469 7374 6963 7320 2873 7472   statistics (str
+00057260: 696e 6720 6f72 206c 6973 7429 2c20 666f  ing or list), fo
+00057270: 720a 2020 2020 2020 2020 2065 7861 6d70  r.         examp
+00057280: 6c65 3a20 7b22 756e 696f 6e22 3a20 5b22  le: {"union": ["
+00057290: 6d65 616e 222c 2022 7374 6465 7622 5d7d  mean", "stdev"]}
+000572a0: 2e20 2056 616c 6964 2073 6c69 6365 0a20  .  Valid slice. 
+000572b0: 2020 2020 2020 2020 7370 6563 6966 6963          specific
+000572c0: 6174 696f 6e73 2061 7265 2061 7320 6c69  ations are as li
+000572d0: 7374 6564 2066 6f72 203c 6465 6661 756c  sted for <defaul
+000572e0: 745f 6279 5f73 6c69 6365 3e2e 0a0a 2020  t_by_slice>...  
+000572f0: 2020 6465 6661 756c 745f 6279 5f73 6c69    default_by_sli
+00057300: 6365 3a20 7374 722c 2064 6566 6175 6c74  ce: str, default
+00057310: 3d4e 6f6e 650a 2020 2020 2020 2020 4465  =None.        De
+00057320: 6661 756c 7420 7370 6563 6966 6963 6174  fault specificat
+00057330: 696f 6e20 6f66 2073 6c69 6365 7320 746f  ion of slices to
+00057340: 2062 6520 636f 6e73 6964 6572 6564 2077   be considered w
+00057350: 6865 6e0a 2020 2020 2020 2020 6361 6c63  hen.        calc
+00057360: 756c 6174 696e 6720 736c 6963 652d 6279  ulating slice-by
+00057370: 2d73 6c69 6365 2073 7461 7469 7374 6963  -slice statistic
+00057380: 7320 666f 7220 6120 6d65 7472 6963 2063  s for a metric c
+00057390: 6f6d 7061 7269 6e67 0a20 2020 2020 2020  omparing.       
+000573a0: 2074 776f 2052 4f49 732c 2072 6f69 3120   two ROIs, roi1 
+000573b0: 616e 6420 726f 6932 2e20 2054 6865 2076  and roi2.  The v
+000573c0: 616c 6964 2073 7065 6369 6669 6361 7469  alid specificati
+000573d0: 6f6e 7320 6172 653a 0a0a 2020 2020 2020  ons are:..      
+000573e0: 2020 2d20 226c 6566 7422 3a20 636f 6e73    - "left": cons
+000573f0: 6964 6572 206f 6e6c 7920 736c 6963 6573  ider only slices
+00057400: 2063 6f6e 7461 696e 696e 6720 726f 6931   containing roi1
+00057410: 3b0a 2020 2020 2020 2020 2d20 2272 6967  ;.        - "rig
+00057420: 6874 223a 2063 6f6e 7369 6465 7220 6f6e  ht": consider on
+00057430: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+00057440: 6e69 6e67 2072 6f69 323b 0a20 2020 2020  ning roi2;.     
+00057450: 2020 202d 2022 756e 696f 6e22 3a20 636f     - "union": co
+00057460: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
+00057470: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
+00057480: 6f66 2072 6f69 3120 616e 6420 726f 6932  of roi1 and roi2
+00057490: 3b0a 2020 2020 2020 2020 2d20 2269 6e74  ;.        - "int
+000574a0: 6572 7365 6374 696f 6e22 3a20 636f 6e73  ersection": cons
+000574b0: 6964 6572 2073 6c69 6365 7320 636f 6e74  ider slices cont
+000574c0: 6169 6e69 6e67 2062 6f74 6820 726f 6931  aining both roi1
+000574d0: 2061 6e64 2072 6f69 322e 0a0a 2020 2020   and roi2...    
+000574e0: 2020 2020 4966 204e 6f6e 652c 2075 7365      If None, use
+000574f0: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
+00057500: 6c74 7328 292e 6279 5f73 6c69 6365 0a20  lts().by_slice. 
+00057510: 2020 2022 2222 0a20 2020 2069 6620 6e6f     """.    if no
+00057520: 7420 736c 6963 655f 7374 6174 733a 0a20  t slice_stats:. 
+00057530: 2020 2020 2020 2072 6574 7572 6e20 7b7d         return {}
+00057540: 0a0a 2020 2020 2320 5365 7420 6465 6661  ..    # Set defa
+00057550: 756c 7420 6d65 7468 6f64 2066 6f72 2073  ult method for s
+00057560: 6c69 6365 2073 656c 6563 7469 6f6e 2e0a  lice selection..
+00057570: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
+00057580: 6c69 6365 203d 2064 6566 6175 6c74 5f62  lice = default_b
+00057590: 795f 736c 6963 6520 6f72 2073 6b72 742e  y_slice or skrt.
+000575a0: 636f 7265 2e44 6566 6175 6c74 7328 292e  core.Defaults().
+000575b0: 6279 5f73 6c69 6365 0a0a 2020 2020 2320  by_slice..    # 
+000575c0: 456e 7375 7265 2074 6861 7420 736c 6963  Ensure that slic
+000575d0: 655f 7374 6174 7320 6973 2061 2064 6963  e_stats is a dic
+000575e0: 7469 6f6e 6172 792e 0a20 2020 2069 6620  tionary..    if 
+000575f0: 6973 696e 7374 616e 6365 2873 6c69 6365  isinstance(slice
+00057600: 5f73 7461 7473 2c20 7374 7229 3a0a 2020  _stats, str):.  
+00057610: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
+00057620: 7320 3d20 7b64 6566 6175 6c74 5f62 795f  s = {default_by_
+00057630: 736c 6963 653a 205b 736c 6963 655f 7374  slice: [slice_st
+00057640: 6174 735d 7d0a 0a20 2020 2065 6c69 6620  ats]}..    elif 
+00057650: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
+00057660: 7428 736c 6963 655f 7374 6174 7329 3a0a  t(slice_stats):.
+00057670: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+00057680: 6174 7320 3d20 7b64 6566 6175 6c74 5f62  ats = {default_b
+00057690: 795f 736c 6963 653a 2073 6c69 6365 5f73  y_slice: slice_s
+000576a0: 7461 7473 7d0a 0a20 2020 2065 6c69 6620  tats}..    elif 
+000576b0: 6973 696e 7374 616e 6365 2873 6c69 6365  isinstance(slice
+000576c0: 5f73 7461 7473 2c20 6469 6374 293a 0a20  _stats, dict):. 
+000576d0: 2020 2020 2020 2063 6865 636b 6564 5f73         checked_s
+000576e0: 6c69 6365 5f73 7461 7473 203d 207b 7d0a  lice_stats = {}.
+000576f0: 2020 2020 2020 2020 666f 7220 6279 5f73          for by_s
+00057700: 6c69 6365 2c20 7374 6174 7320 696e 2073  lice, stats in s
+00057710: 6c69 6365 5f73 7461 7473 2e69 7465 6d73  lice_stats.items
+00057720: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00057730: 6966 2069 7369 6e73 7461 6e63 6528 7374  if isinstance(st
+00057740: 6174 732c 2073 7472 293a 0a20 2020 2020  ats, str):.     
+00057750: 2020 2020 2020 2020 2020 2063 6865 636b             check
+00057760: 6564 5f73 6c69 6365 5f73 7461 7473 5b62  ed_slice_stats[b
+00057770: 795f 736c 6963 655d 203d 205b 7374 6174  y_slice] = [stat
+00057780: 735d 0a20 2020 2020 2020 2020 2020 2065  s].            e
+00057790: 6c69 6620 736b 7274 2e63 6f72 652e 6973  lif skrt.core.is
+000577a0: 5f6c 6973 7428 7374 6174 7329 3a0a 2020  _list(stats):.  
+000577b0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+000577c0: 6563 6b65 645f 736c 6963 655f 7374 6174  ecked_slice_stat
+000577d0: 735b 6279 5f73 6c69 6365 5d20 3d20 6c69  s[by_slice] = li
+000577e0: 7374 2873 7461 7473 290a 2020 2020 2020  st(stats).      
+000577f0: 2020 736c 6963 655f 7374 6174 7320 3d20    slice_stats = 
+00057800: 6368 6563 6b65 645f 736c 6963 655f 7374  checked_slice_st
+00057810: 6174 730a 0a20 2020 2069 6620 6973 696e  ats..    if isin
+00057820: 7374 616e 6365 2873 6c69 6365 5f73 7461  stance(slice_sta
+00057830: 7473 2c20 6469 6374 293a 0a20 2020 2020  ts, dict):.     
+00057840: 2020 2072 6574 7572 6e20 736c 6963 655f     return slice_
+00057850: 7374 6174 730a 0a20 2020 2072 6574 7572  stats..    retur
+00057860: 6e20 7b7d 0a                             n {}.
```

### Comparing `scikit-rt-0.4.8/src/skrt/viewer/core.py` & `scikit-rt-0.4.9/src/skrt/viewer/core.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/src/skrt/viewer/viewer.py` & `scikit-rt-0.4.9/src/skrt/viewer/viewer.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_01_setup.py` & `scikit-rt-0.4.9/tests/test_01_setup.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_application.py` & `scikit-rt-0.4.9/tests/test_application.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_core.py` & `scikit-rt-0.4.9/tests/test_core.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_dose.py` & `scikit-rt-0.4.9/tests/test_dose.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_image.py` & `scikit-rt-0.4.9/tests/test_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_multi.py` & `scikit-rt-0.4.9/tests/test_multi.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_patient.py` & `scikit-rt-0.4.9/tests/test_patient.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_qv_image.py` & `scikit-rt-0.4.9/tests/test_qv_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_qv_quickviewer.py` & `scikit-rt-0.4.9/tests/test_qv_quickviewer.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_qv_struct_loader.py` & `scikit-rt-0.4.9/tests/test_qv_struct_loader.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_qv_struct_metrics.py` & `scikit-rt-0.4.9/tests/test_qv_struct_metrics.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_qv_structs.py` & `scikit-rt-0.4.9/tests/test_qv_structs.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_registration.py` & `scikit-rt-0.4.9/tests/test_registration.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_roi_metrics.py` & `scikit-rt-0.4.9/tests/test_roi_metrics.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_segmentation.py` & `scikit-rt-0.4.9/tests/test_segmentation.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_structs.py` & `scikit-rt-0.4.9/tests/test_structs.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_synthetic_image.py` & `scikit-rt-0.4.9/tests/test_synthetic_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.8/tests/test_viewer.py` & `scikit-rt-0.4.9/tests/test_viewer.py`

 * *Files identical despite different names*

